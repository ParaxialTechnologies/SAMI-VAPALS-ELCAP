KIDS Distribution saved on May 25, 2021@10:13:38
Released SAMI*18.0*11 SEQ #11 T9 (1.18.0.11-t9+i11)
**KIDS**:SAMI*18.0*11^

**INSTALL NAME**
SAMI*18.0*11
"BLD",11508,0)
SAMI*18.0*11^SAMI^0^3210525^n
"BLD",11508,1,0)
^^1^1^3210329^
"BLD",11508,1,1,0)
Critical bugs fixed in Intake, CT eval, and reports
"BLD",11508,4,0)
^9.64PA^^
"BLD",11508,6)
^11
"BLD",11508,6.3)
19
"BLD",11508,"KRN",0)
^9.67PA^1.5^25
"BLD",11508,"KRN",.4,0)
.4
"BLD",11508,"KRN",.401,0)
.401
"BLD",11508,"KRN",.402,0)
.402
"BLD",11508,"KRN",.403,0)
.403
"BLD",11508,"KRN",.5,0)
.5
"BLD",11508,"KRN",.84,0)
.84
"BLD",11508,"KRN",1.5,0)
1.5
"BLD",11508,"KRN",1.6,0)
1.6
"BLD",11508,"KRN",1.61,0)
1.61
"BLD",11508,"KRN",1.62,0)
1.62
"BLD",11508,"KRN",3.6,0)
3.6
"BLD",11508,"KRN",3.8,0)
3.8
"BLD",11508,"KRN",9.2,0)
9.2
"BLD",11508,"KRN",9.8,0)
9.8
"BLD",11508,"KRN",9.8,"NM",0)
^9.68A^14^14
"BLD",11508,"KRN",9.8,"NM",1,0)
SAMINOT1^^0^B444173065
"BLD",11508,"KRN",9.8,"NM",2,0)
SAMIUR^^0^B536094535
"BLD",11508,"KRN",9.8,"NM",3,0)
SAMINUL^^0^B102256
"BLD",11508,"KRN",9.8,"NM",4,0)
SAMICSV^^0^B60401322
"BLD",11508,"KRN",9.8,"NM",5,0)
SAMIUR2^^0^B1106323315
"BLD",11508,"KRN",9.8,"NM",6,0)
SAMIHL7^^0^B192849190
"BLD",11508,"KRN",9.8,"NM",7,0)
SAMICAS3^^0^B461797894
"BLD",11508,"KRN",9.8,"NM",8,0)
SAMISAV^^0^B121113964
"BLD",11508,"KRN",9.8,"NM",9,0)
SAMICTTA^^0^B35698365
"BLD",11508,"KRN",9.8,"NM",10,0)
SAMICTT1^^0^B122873178
"BLD",11508,"KRN",9.8,"NM",11,0)
SAMICTT0^^0^B97674764
"BLD",11508,"KRN",9.8,"NM",12,0)
SAMICTUL^^0^B103375
"BLD",11508,"KRN",9.8,"NM",13,0)
SAMICUL^^0^B135532
"BLD",11508,"KRN",9.8,"NM",14,0)
SAMICTC1^^0^B246702028
"BLD",11508,"KRN",9.8,"NM","B","SAMICAS3",7)

"BLD",11508,"KRN",9.8,"NM","B","SAMICSV",4)

"BLD",11508,"KRN",9.8,"NM","B","SAMICTC1",14)

"BLD",11508,"KRN",9.8,"NM","B","SAMICTT0",11)

"BLD",11508,"KRN",9.8,"NM","B","SAMICTT1",10)

"BLD",11508,"KRN",9.8,"NM","B","SAMICTTA",9)

"BLD",11508,"KRN",9.8,"NM","B","SAMICTUL",12)

"BLD",11508,"KRN",9.8,"NM","B","SAMICUL",13)

"BLD",11508,"KRN",9.8,"NM","B","SAMIHL7",6)

"BLD",11508,"KRN",9.8,"NM","B","SAMINOT1",1)

"BLD",11508,"KRN",9.8,"NM","B","SAMINUL",3)

"BLD",11508,"KRN",9.8,"NM","B","SAMISAV",8)

"BLD",11508,"KRN",9.8,"NM","B","SAMIUR",2)

"BLD",11508,"KRN",9.8,"NM","B","SAMIUR2",5)

"BLD",11508,"KRN",19,0)
19
"BLD",11508,"KRN",19.1,0)
19.1
"BLD",11508,"KRN",101,0)
101
"BLD",11508,"KRN",409.61,0)
409.61
"BLD",11508,"KRN",771,0)
771
"BLD",11508,"KRN",779.2,0)
779.2
"BLD",11508,"KRN",870,0)
870
"BLD",11508,"KRN",8989.51,0)
8989.51
"BLD",11508,"KRN",8989.52,0)
8989.52
"BLD",11508,"KRN",8993,0)
8993
"BLD",11508,"KRN",8994,0)
8994
"BLD",11508,"KRN","B",.4,.4)

"BLD",11508,"KRN","B",.401,.401)

"BLD",11508,"KRN","B",.402,.402)

"BLD",11508,"KRN","B",.403,.403)

"BLD",11508,"KRN","B",.5,.5)

"BLD",11508,"KRN","B",.84,.84)

"BLD",11508,"KRN","B",1.5,1.5)

"BLD",11508,"KRN","B",1.6,1.6)

"BLD",11508,"KRN","B",1.61,1.61)

"BLD",11508,"KRN","B",1.62,1.62)

"BLD",11508,"KRN","B",3.6,3.6)

"BLD",11508,"KRN","B",3.8,3.8)

"BLD",11508,"KRN","B",9.2,9.2)

"BLD",11508,"KRN","B",9.8,9.8)

"BLD",11508,"KRN","B",19,19)

"BLD",11508,"KRN","B",19.1,19.1)

"BLD",11508,"KRN","B",101,101)

"BLD",11508,"KRN","B",409.61,409.61)

"BLD",11508,"KRN","B",771,771)

"BLD",11508,"KRN","B",779.2,779.2)

"BLD",11508,"KRN","B",870,870)

"BLD",11508,"KRN","B",8989.51,8989.51)

"BLD",11508,"KRN","B",8989.52,8989.52)

"BLD",11508,"KRN","B",8993,8993)

"BLD",11508,"KRN","B",8994,8994)

"BLD",11508,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11508,"QUES",0)
^9.62^^
"BLD",11508,"REQB",0)
^9.611^10^9
"BLD",11508,"REQB",1,0)
SAMI*18.0*2^2
"BLD",11508,"REQB",2,0)
SAMI 18.0T05^2
"BLD",11508,"REQB",3,0)
SAMI*18.0*6^2
"BLD",11508,"REQB",5,0)
SAMI*18.0*8^2
"BLD",11508,"REQB",6,0)
SAMI*18.0*9^2
"BLD",11508,"REQB",7,0)
SAMI*18.0*10^2
"BLD",11508,"REQB",8,0)
SAMI*18.0*7^2
"BLD",11508,"REQB",9,0)
SAMI*18.0*3^2
"BLD",11508,"REQB",10,0)
SAMI*18.0*4^2
"BLD",11508,"REQB","B","SAMI 18.0T05",2)

"BLD",11508,"REQB","B","SAMI*18.0*10",7)

"BLD",11508,"REQB","B","SAMI*18.0*2",1)

"BLD",11508,"REQB","B","SAMI*18.0*3",9)

"BLD",11508,"REQB","B","SAMI*18.0*4",10)

"BLD",11508,"REQB","B","SAMI*18.0*6",3)

"BLD",11508,"REQB","B","SAMI*18.0*7",8)

"BLD",11508,"REQB","B","SAMI*18.0*8",5)

"BLD",11508,"REQB","B","SAMI*18.0*9",6)

"MBREQ")
0
"PKG",230,-1)
1^1
"PKG",230,0)
SAMI^SAMI^SCREENING APPLICATIONS MANAGEMENT - IELCAP
"PKG",230,22,0)
^9.49I^1^1
"PKG",230,22,1,0)
18.0^3191203
"PKG",230,22,1,"PAH",1,0)
11^3210525^66
"PKG",230,22,1,"PAH",1,1,0)
^^1^1^3210525
"PKG",230,22,1,"PAH",1,1,1,0)
Critical bugs fixed in Intake, CT eval, and reports
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","SAMICAS3")
0^7^B461797894
"RTN","SAMICAS3",1,0)
SAMICAS3 ;ven/gpl - ielcap: case review page (cont) ;2021-05-25T14:52Z
"RTN","SAMICAS3",2,0)
 ;;18.0;SAMI;**3,9,11**;2020-01;Build 19
"RTN","SAMICAS3",3,0)
 ;;1.18.0.11+i11
"RTN","SAMICAS3",4,0)
 ;
"RTN","SAMICAS3",5,0)
 ; SAMICAS3 contains ppis and other subroutines to support processing
"RTN","SAMICAS3",6,0)
 ; of the VAPALS case review page.
"RTN","SAMICAS3",7,0)
 ;
"RTN","SAMICAS3",8,0)
 quit  ; no entry from top
"RTN","SAMICAS3",9,0)
 ;
"RTN","SAMICAS3",10,0)
 ;
"RTN","SAMICAS3",11,0)
 ;
"RTN","SAMICAS3",12,0)
 ;@section 0 primary development: see routine %wful
"RTN","SAMICAS3",13,0)
 ;
"RTN","SAMICAS3",14,0)
 ;
"RTN","SAMICAS3",15,0)
 ;
"RTN","SAMICAS3",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICAS3",17,0)
 ;@documentation see SAMICUL
"RTN","SAMICAS3",18,0)
 ;@contents
"RTN","SAMICAS3",19,0)
 ; WSNFPOST post new form selection (post service)
"RTN","SAMICAS3",20,0)
 ; MKSBFORM create background form
"RTN","SAMICAS3",21,0)
 ;
"RTN","SAMICAS3",22,0)
 ; $$PREVNOD key of latest form including nodule grid
"RTN","SAMICAS3",23,0)
 ; $$LASTCMP date & key of last comparison scan
"RTN","SAMICAS3",24,0)
 ; $$PRIORCMP dates of all scans before last comparison scan
"RTN","SAMICAS3",25,0)
 ; $$KEY2DT date to put in prior scans field
"RTN","SAMICAS3",26,0)
 ; SORTFRMS sorts all forms for patient sid by date
"RTN","SAMICAS3",27,0)
 ;
"RTN","SAMICAS3",28,0)
 ; MKCEFORM create ct evaluation form
"RTN","SAMICAS3",29,0)
 ; MKFUFORM create follow-up form
"RTN","SAMICAS3",30,0)
 ; $$BASELNDT last previous baseline ct date
"RTN","SAMICAS3",31,0)
 ; MKPTFORM create pet evaluation form
"RTN","SAMICAS3",32,0)
 ; MKITFORM create intervention form
"RTN","SAMICAS3",33,0)
 ; MKBXFORM create biopsy form
"RTN","SAMICAS3",34,0)
 ; CASETBL generates case review table
"RTN","SAMICAS3",35,0)
 ;
"RTN","SAMICAS3",36,0)
 ;
"RTN","SAMICAS3",37,0)
 ;
"RTN","SAMICAS3",38,0)
 ;@section 1 WSNFPOST & related subroutines
"RTN","SAMICAS3",39,0)
 ;
"RTN","SAMICAS3",40,0)
 ;
"RTN","SAMICAS3",41,0)
 ;
"RTN","SAMICAS3",42,0)
 ;;@ppi WSNFPOST^SAMICAS3, post new form selection (post service)
"RTN","SAMICAS3",43,0)
WSNFPOST ; post new form selection (post service)
"RTN","SAMICAS3",44,0)
 ;
"RTN","SAMICAS3",45,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",46,0)
 ;
"RTN","SAMICAS3",47,0)
 ;ven/gpl;web service;procedure;
"RTN","SAMICAS3",48,0)
 ;@web service
"RTN","SAMICAS3",49,0)
 ; web service SAMICASE-wsNuFormPost
"RTN","SAMICAS3",50,0)
 ;@called by
"RTN","SAMICAS3",51,0)
 ; WSNFPOST^SAMICASE
"RTN","SAMICAS3",52,0)
 ;@calls
"RTN","SAMICAS3",53,0)
 ; parseBody^%wf
"RTN","SAMICAS3",54,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMICAS3",55,0)
 ; $$KEYDATE^SAMIHOM3
"RTN","SAMICAS3",56,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",57,0)
 ; $$KEY2FM^SAMICAS2
"RTN","SAMICAS3",58,0)
 ; $$FMADD^XLFDT
"RTN","SAMICAS3",59,0)
 ; WSCASE^SAMICASE
"RTN","SAMICAS3",60,0)
 ; MKSBFORM^SAMICAS3
"RTN","SAMICAS3",61,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS3",62,0)
 ; MKFUFORM^SAMICAS3
"RTN","SAMICAS3",63,0)
 ; MKBXFORM^SAMICAS3
"RTN","SAMICAS3",64,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS3",65,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS3",66,0)
 ; wsGetForm^%wf
"RTN","SAMICAS3",67,0)
 ;@input
"RTN","SAMICAS3",68,0)
 ; .ARGS
"RTN","SAMICAS3",69,0)
 ; .ARGS("form")
"RTN","SAMICAS3",70,0)
 ; .ARGS("studyid")
"RTN","SAMICAS3",71,0)
 ; .ARGS("sid")
"RTN","SAMICAS3",72,0)
 ; .BODY
"RTN","SAMICAS3",73,0)
 ; .BODY(1) (e.g. "samiroute=casereview&dfn="_dfn_"&studyid="_studyid)
"RTN","SAMICAS3",74,0)
 ;@output
"RTN","SAMICAS3",75,0)
 ; @RESULT
"RTN","SAMICAS3",76,0)
 ;@tests
"RTN","SAMICAS3",77,0)
 ; SAMIUTS2
"RTN","SAMICAS3",78,0)
 ;
"RTN","SAMICAS3",79,0)
 ;@stanza 2 get new form
"RTN","SAMICAS3",80,0)
 ;
"RTN","SAMICAS3",81,0)
 new vars,bdy
"RTN","SAMICAS3",82,0)
 set bdy=$get(BODY(1))
"RTN","SAMICAS3",83,0)
 do parseBody^%wf("vars",.bdy)
"RTN","SAMICAS3",84,0)
 merge vars=ARGS
"RTN","SAMICAS3",85,0)
 merge ^SAMIUL("nuform","vars")=vars
"RTN","SAMICAS3",86,0)
 ;
"RTN","SAMICAS3",87,0)
 new sid set sid=$get(vars("studyid"))
"RTN","SAMICAS3",88,0)
 if sid="" set sid=$get(ARGS("sid"))
"RTN","SAMICAS3",89,0)
 if sid="" do  quit  ;
"RTN","SAMICAS3",90,0)
 . do GETHOME^SAMIHOM3(.RESULT,.ARGS) ; on error return to home page
"RTN","SAMICAS3",91,0)
 . quit
"RTN","SAMICAS3",92,0)
 ;
"RTN","SAMICAS3",93,0)
 set nuform=$get(vars("form"))
"RTN","SAMICAS3",94,0)
 if nuform="" set nuform="ceform"
"RTN","SAMICAS3",95,0)
 ;
"RTN","SAMICAS3",96,0)
 new datekey set datekey=$$KEYDATE^SAMIHOM3($$NOW^XLFDT)
"RTN","SAMICAS3",97,0)
 ;
"RTN","SAMICAS3",98,0)
 ; check to see if form already exists
"RTN","SAMICAS3",99,0)
 ;
"RTN","SAMICAS3",100,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",101,0)
 new collide set collide=0 ; duplicate form for today - backdate forms scenario
"RTN","SAMICAS3",102,0)
 if $data(@root@("graph",sid,nuform_"-"_datekey)) do  ; already exists
"RTN","SAMICAS3",103,0)
 . set collide=1
"RTN","SAMICAS3",104,0)
 . if nuform="siform" quit
"RTN","SAMICAS3",105,0)
 . if nuform="sbform" quit  ; do not create multiple background forms
"RTN","SAMICAS3",106,0)
 . new lastone
"RTN","SAMICAS3",107,0)
 . set lastone=$order(@root@("graph",sid,nuform_"-a  "),-1)
"RTN","SAMICAS3",108,0)
 . quit:lastone=""
"RTN","SAMICAS3",109,0)
 . set newfm=$$KEY2FM^SAMICASE(lastone)
"RTN","SAMICAS3",110,0)
 . set datekey=$$KEYDATE^SAMIHOM3($$FMADD^XLFDT(newfm,1)) ; add one day to the last form
"RTN","SAMICAS3",111,0)
 . quit
"RTN","SAMICAS3",112,0)
 ;
"RTN","SAMICAS3",113,0)
 ; code to not allow two same forms for a patient a day
"RTN","SAMICAS3",114,0)
 ;
"RTN","SAMICAS3",115,0)
 if collide=1 do  quit  ;
"RTN","SAMICAS3",116,0)
 . set ARGS("errorMessage")="Form already exists for today"
"RTN","SAMICAS3",117,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",118,0)
 . do WSCASE^SAMICASE(.RESULT,.ARGS)
"RTN","SAMICAS3",119,0)
 . quit
"RTN","SAMICAS3",120,0)
 ;
"RTN","SAMICAS3",121,0)
 if nuform="sbform" do  ;
"RTN","SAMICAS3",122,0)
 . new oldkey set oldkey=$order(@root@("graph",sid,"sbform"))
"RTN","SAMICAS3",123,0)
 . if $extract(oldkey,1,6)="sbform" do  quit  ;
"RTN","SAMICAS3",124,0)
 . . set ARGS("key")=oldkey
"RTN","SAMICAS3",125,0)
 . . set ARGS("studyid")=sid
"RTN","SAMICAS3",126,0)
 . . set ARGS("form")="vapals:sbform"
"RTN","SAMICAS3",127,0)
 . . quit
"RTN","SAMICAS3",128,0)
 . new key set key="sbform-"_datekey
"RTN","SAMICAS3",129,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",130,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",131,0)
 . set ARGS("form")="vapals:sbform"
"RTN","SAMICAS3",132,0)
 . do MKSBFORM(sid,key)
"RTN","SAMICAS3",133,0)
 . quit
"RTN","SAMICAS3",134,0)
 ;
"RTN","SAMICAS3",135,0)
 if nuform="ceform" do  ;
"RTN","SAMICAS3",136,0)
 . new key set key="ceform-"_datekey
"RTN","SAMICAS3",137,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",138,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",139,0)
 . set ARGS("form")="vapals:ceform"
"RTN","SAMICAS3",140,0)
 . do MKCEFORM(sid,key)
"RTN","SAMICAS3",141,0)
 . quit
"RTN","SAMICAS3",142,0)
 ;
"RTN","SAMICAS3",143,0)
 if nuform="fuform" do  ;
"RTN","SAMICAS3",144,0)
 . new key set key="fuform-"_datekey
"RTN","SAMICAS3",145,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",146,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",147,0)
 . set ARGS("form")="vapals:fuform"
"RTN","SAMICAS3",148,0)
 . do MKFUFORM(sid,key)
"RTN","SAMICAS3",149,0)
 . quit
"RTN","SAMICAS3",150,0)
 ;
"RTN","SAMICAS3",151,0)
 if nuform="bxform" do  ;
"RTN","SAMICAS3",152,0)
 . new key set key="bxform-"_datekey
"RTN","SAMICAS3",153,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",154,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",155,0)
 . set ARGS("form")="vapals:bxform"
"RTN","SAMICAS3",156,0)
 . do MKBXFORM(sid,key)
"RTN","SAMICAS3",157,0)
 . quit
"RTN","SAMICAS3",158,0)
 ;
"RTN","SAMICAS3",159,0)
 if nuform="ptform" do  ;
"RTN","SAMICAS3",160,0)
 . new key set key="ptform-"_datekey
"RTN","SAMICAS3",161,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",162,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",163,0)
 . set ARGS("form")="vapals:ptform"
"RTN","SAMICAS3",164,0)
 . do MKPTFORM(sid,key)
"RTN","SAMICAS3",165,0)
 . quit
"RTN","SAMICAS3",166,0)
 ;
"RTN","SAMICAS3",167,0)
 if nuform="itform" do  ;
"RTN","SAMICAS3",168,0)
 . new key set key="itform-"_datekey
"RTN","SAMICAS3",169,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",170,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",171,0)
 . set ARGS("form")="vapals:itform"
"RTN","SAMICAS3",172,0)
 . do MKITFORM(sid,key)
"RTN","SAMICAS3",173,0)
 . quit
"RTN","SAMICAS3",174,0)
 ;
"RTN","SAMICAS3",175,0)
 do wsGetForm^%wf(.RESULT,.ARGS)
"RTN","SAMICAS3",176,0)
 ;
"RTN","SAMICAS3",177,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",178,0)
 ;
"RTN","SAMICAS3",179,0)
 quit  ; end of ppi WSNFPOST^SAMICAS3
"RTN","SAMICAS3",180,0)
 ;
"RTN","SAMICAS3",181,0)
 ;
"RTN","SAMICAS3",182,0)
 ;
"RTN","SAMICAS3",183,0)
MKSBFORM(sid,key) ; create background form
"RTN","SAMICAS3",184,0)
 ;
"RTN","SAMICAS3",185,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",186,0)
 ;
"RTN","SAMICAS3",187,0)
 ;ven/gpl;private;procedure;
"RTN","SAMICAS3",188,0)
 ;@called-by
"RTN","SAMICAS3",189,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",190,0)
 ;@calls
"RTN","SAMICAS3",191,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",192,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",193,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",194,0)
 ;@input
"RTN","SAMICAS3",195,0)
 ; sid = study id
"RTN","SAMICAS3",196,0)
 ; key = form key, e.g. sbform-2021-05-25
"RTN","SAMICAS3",197,0)
 ;@output
"RTN","SAMICAS3",198,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",199,0)
 ;@examples [tbd]
"RTN","SAMICAS3",200,0)
 ;@tests [tbd]
"RTN","SAMICAS3",201,0)
 ;
"RTN","SAMICAS3",202,0)
 ;@stanza 2 create background form
"RTN","SAMICAS3",203,0)
 ;
"RTN","SAMICAS3",204,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",205,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",206,0)
 quit:+sien=0
"RTN","SAMICAS3",207,0)
 ;
"RTN","SAMICAS3",208,0)
 new cdate set cdate=$piece(key,"sbform-",2)
"RTN","SAMICAS3",209,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",210,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",211,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",212,0)
 ;
"RTN","SAMICAS3",213,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",214,0)
 ;
"RTN","SAMICAS3",215,0)
 quit  ; end of MKSBFORM
"RTN","SAMICAS3",216,0)
 ;
"RTN","SAMICAS3",217,0)
 ;
"RTN","SAMICAS3",218,0)
 ;
"RTN","SAMICAS3",219,0)
PREVNOD(sid) ; key of latest form including nodule grid
"RTN","SAMICAS3",220,0)
 ;
"RTN","SAMICAS3",221,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",222,0)
 ;
"RTN","SAMICAS3",223,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",224,0)
 ;@called-by none [commented out in MKCEFORM,MKPTFORM,MKBXFORM]
"RTN","SAMICAS3",225,0)
 ;@calls
"RTN","SAMICAS3",226,0)
 ; SORTFRMS
"RTN","SAMICAS3",227,0)
 ;@input
"RTN","SAMICAS3",228,0)
 ; sid = study id
"RTN","SAMICAS3",229,0)
 ;@output = key of latest form incl nodule grid
"RTN","SAMICAS3",230,0)
 ;@examples [tbd]
"RTN","SAMICAS3",231,0)
 ;@tests [tbd]
"RTN","SAMICAS3",232,0)
 ;
"RTN","SAMICAS3",233,0)
 ; used for nodule copy
"RTN","SAMICAS3",234,0)
 ;
"RTN","SAMICAS3",235,0)
 ;
"RTN","SAMICAS3",236,0)
 ;@stanza 2 calculate key of latest form incl nodule grid
"RTN","SAMICAS3",237,0)
 ;
"RTN","SAMICAS3",238,0)
 new retkey set retkey=""
"RTN","SAMICAS3",239,0)
 new fary
"RTN","SAMICAS3",240,0)
 do SORTFRMS(.fary,sid)
"RTN","SAMICAS3",241,0)
 ;
"RTN","SAMICAS3",242,0)
 new tdt set tdt=""
"RTN","SAMICAS3",243,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",244,0)
 . new tmpkey set tmpkey=""
"RTN","SAMICAS3",245,0)
 . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",246,0)
 . . if tmpkey["ceform" set retkey=tmpkey
"RTN","SAMICAS3",247,0)
 . . if tmpkey["ptform" set retkey=tmpkey
"RTN","SAMICAS3",248,0)
 . . if tmpkey["bxform" set retkey=tmpkey
"RTN","SAMICAS3",249,0)
 . . quit
"RTN","SAMICAS3",250,0)
 . quit
"RTN","SAMICAS3",251,0)
 ;
"RTN","SAMICAS3",252,0)
 ;
"RTN","SAMICAS3",253,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",254,0)
 ;
"RTN","SAMICAS3",255,0)
 quit retkey ; end of $$PREVNOD
"RTN","SAMICAS3",256,0)
 ;
"RTN","SAMICAS3",257,0)
 ;
"RTN","SAMICAS3",258,0)
 ;
"RTN","SAMICAS3",259,0)
LASTCMP(sid,retkey) ; date & key of last comparison scan
"RTN","SAMICAS3",260,0)
 ;
"RTN","SAMICAS3",261,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",262,0)
 ;
"RTN","SAMICAS3",263,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",264,0)
 ;@called-by
"RTN","SAMICAS3",265,0)
 ; MKCEFORM
"RTN","SAMICAS3",266,0)
 ; MKPTFORM
"RTN","SAMICAS3",267,0)
 ; MKITFORM
"RTN","SAMICAS3",268,0)
 ; MKBXFORM
"RTN","SAMICAS3",269,0)
 ;@calls
"RTN","SAMICAS3",270,0)
 ; SORTFRMS
"RTN","SAMICAS3",271,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS3",272,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMICAS3",273,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",274,0)
 ;@input
"RTN","SAMICAS3",275,0)
 ; sid = study id
"RTN","SAMICAS3",276,0)
 ;@output = date of last comparison scan
"RTN","SAMICAS3",277,0)
 ; .retkey = key of last comparison scan
"RTN","SAMICAS3",278,0)
 ;@examples [tbd]
"RTN","SAMICAS3",279,0)
 ;@tests [tbd]
"RTN","SAMICAS3",280,0)
 ;
"RTN","SAMICAS3",281,0)
 ;
"RTN","SAMICAS3",282,0)
 ;@stanza 2 calculate date & key of last comparison scan
"RTN","SAMICAS3",283,0)
 ;
"RTN","SAMICAS3",284,0)
 set retkey=""
"RTN","SAMICAS3",285,0)
 new fary
"RTN","SAMICAS3",286,0)
 do SORTFRMS(.fary,sid)
"RTN","SAMICAS3",287,0)
 ;
"RTN","SAMICAS3",288,0)
 new tdt set tdt=$piece($$NOW^XLFDT,".",1)+1 ; start with today
"RTN","SAMICAS3",289,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",290,0)
 . new tmpkey set tmpkey=""
"RTN","SAMICAS3",291,0)
 . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",292,0)
 . . if tmpkey["ceform" set retkey=tmpkey
"RTN","SAMICAS3",293,0)
 . . quit
"RTN","SAMICAS3",294,0)
 . quit
"RTN","SAMICAS3",295,0)
 ;
"RTN","SAMICAS3",296,0)
 new retdt set retdt=-1
"RTN","SAMICAS3",297,0)
 if retkey'="" do  ;
"RTN","SAMICAS3",298,0)
 . new fmdt set fmdt=$$KEY2FM^SAMICASE(retkey)
"RTN","SAMICAS3",299,0)
 . set retdt=$$VAPALSDT^SAMICASE(fmdt)
"RTN","SAMICAS3",300,0)
 . quit
"RTN","SAMICAS3",301,0)
 ;
"RTN","SAMICAS3",302,0)
 ;
"RTN","SAMICAS3",303,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",304,0)
 ;
"RTN","SAMICAS3",305,0)
 quit retdt ; end of $$LASTCMP
"RTN","SAMICAS3",306,0)
 ;
"RTN","SAMICAS3",307,0)
 ;
"RTN","SAMICAS3",308,0)
 ;
"RTN","SAMICAS3",309,0)
PRIORCMP(sid) ; dates of all scans before last comparison scan
"RTN","SAMICAS3",310,0)
 ;
"RTN","SAMICAS3",311,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",312,0)
 ;
"RTN","SAMICAS3",313,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",314,0)
 ;@called-by
"RTN","SAMICAS3",315,0)
 ; MKCEFORM
"RTN","SAMICAS3",316,0)
 ; MKPTFORM
"RTN","SAMICAS3",317,0)
 ; MKITFORM
"RTN","SAMICAS3",318,0)
 ;@calls
"RTN","SAMICAS3",319,0)
 ; SORTFRMS
"RTN","SAMICAS3",320,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS3",321,0)
 ; $$KEY2DT
"RTN","SAMICAS3",322,0)
 ;@input
"RTN","SAMICAS3",323,0)
 ; sid = study id
"RTN","SAMICAS3",324,0)
 ;@output = dates of all scans before last comparison scan
"RTN","SAMICAS3",325,0)
 ;@examples [tbd]
"RTN","SAMICAS3",326,0)
 ;@tests [tbd]
"RTN","SAMICAS3",327,0)
 ;
"RTN","SAMICAS3",328,0)
 ;
"RTN","SAMICAS3",329,0)
 ;@stanza 2 calculate dates of all scans before last comparison scan
"RTN","SAMICAS3",330,0)
 ;
"RTN","SAMICAS3",331,0)
 new retstr set retstr=""
"RTN","SAMICAS3",332,0)
 new lastcmp set lastcmp=""
"RTN","SAMICAS3",333,0)
 new fary
"RTN","SAMICAS3",334,0)
 do SORTFRMS(.fary,sid)
"RTN","SAMICAS3",335,0)
 ;
"RTN","SAMICAS3",336,0)
 new tdt set tdt=$piece($$NOW^XLFDT,".",1)+1 ; start with today
"RTN","SAMICAS3",337,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  do  ; 
"RTN","SAMICAS3",338,0)
 . ;
"RTN","SAMICAS3",339,0)
 . if lastcmp="" do  ; first find the last comparison scan
"RTN","SAMICAS3",340,0)
 . . new tmpkey set tmpkey=""
"RTN","SAMICAS3",341,0)
 . . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:lastcmp'=""  do  ; 
"RTN","SAMICAS3",342,0)
 . . . if tmpkey["ceform" set lastcmp=tmpkey
"RTN","SAMICAS3",343,0)
 . . . quit
"RTN","SAMICAS3",344,0)
 . . quit
"RTN","SAMICAS3",345,0)
 . ;
"RTN","SAMICAS3",346,0)
 . do  ;
"RTN","SAMICAS3",347,0)
 . . ; next add all previous scans to retstr
"RTN","SAMICAS3",348,0)
 . . new tmpkey2 set tmpkey2=""
"RTN","SAMICAS3",349,0)
 . . for  set tmpkey2=$order(fary(tdt,tmpkey2)) quit:tmpkey2=""  do  ; 
"RTN","SAMICAS3",350,0)
 . . . if tmpkey2["ceform" do  ; convert to external date
"RTN","SAMICAS3",351,0)
 . . . . set retstr=$$KEY2DT(tmpkey2)_retstr
"RTN","SAMICAS3",352,0)
 . . . . quit
"RTN","SAMICAS3",353,0)
 . . . quit
"RTN","SAMICAS3",354,0)
 . . quit
"RTN","SAMICAS3",355,0)
 . quit
"RTN","SAMICAS3",356,0)
 ;
"RTN","SAMICAS3",357,0)
 if $extract(retstr,$length(retstr))="," do
"RTN","SAMICAS3",358,0)
 . set retstr=$extract(retstr,1,$length(retstr)-1)
"RTN","SAMICAS3",359,0)
 . quit
"RTN","SAMICAS3",360,0)
 ;
"RTN","SAMICAS3",361,0)
 ;
"RTN","SAMICAS3",362,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",363,0)
 ;
"RTN","SAMICAS3",364,0)
 quit retstr ; end of $$PRIORCMP
"RTN","SAMICAS3",365,0)
 ;
"RTN","SAMICAS3",366,0)
 ;
"RTN","SAMICAS3",367,0)
 ;
"RTN","SAMICAS3",368,0)
KEY2DT(key) ; date to put in prior scans field
"RTN","SAMICAS3",369,0)
 ;
"RTN","SAMICAS3",370,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",371,0)
 ;
"RTN","SAMICAS3",372,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",373,0)
 ;@called-by
"RTN","SAMICAS3",374,0)
 ; $$PRIORCMP
"RTN","SAMICAS3",375,0)
 ;@calls
"RTN","SAMICAS3",376,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMICAS3",377,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",378,0)
 ;@input
"RTN","SAMICAS3",379,0)
 ; key = form key, e.g. ctform-2021-05-25
"RTN","SAMICAS3",380,0)
 ;@output = date to put in prior scans field
"RTN","SAMICAS3",381,0)
 ;@examples [tbd]
"RTN","SAMICAS3",382,0)
 ;@tests [tbd]
"RTN","SAMICAS3",383,0)
 ;
"RTN","SAMICAS3",384,0)
 ;
"RTN","SAMICAS3",385,0)
 ;@stanza 2 calculate prior scans date
"RTN","SAMICAS3",386,0)
 ;
"RTN","SAMICAS3",387,0)
 new retstr2 set retstr2=""
"RTN","SAMICAS3",388,0)
 new fmdt set fmdt=$$KEY2FM^SAMICASE(tmpkey2)
"RTN","SAMICAS3",389,0)
 set retstr2=$$VAPALSDT^SAMICASE(fmdt)_","_retstr2
"RTN","SAMICAS3",390,0)
 ;
"RTN","SAMICAS3",391,0)
 ;
"RTN","SAMICAS3",392,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",393,0)
 ;
"RTN","SAMICAS3",394,0)
 quit retstr2 ; end of $$KEY2DT
"RTN","SAMICAS3",395,0)
 ;
"RTN","SAMICAS3",396,0)
 ;
"RTN","SAMICAS3",397,0)
 ;
"RTN","SAMICAS3",398,0)
SORTFRMS(ARY,sid) ; sorts all forms for patient sid by date
"RTN","SAMICAS3",399,0)
 ;
"RTN","SAMICAS3",400,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",401,0)
 ;
"RTN","SAMICAS3",402,0)
 ;ven/gpl;private;procedure;clean;silent;sac;
"RTN","SAMICAS3",403,0)
 ;@called-by
"RTN","SAMICAS3",404,0)
 ; $$PREVNOD
"RTN","SAMICAS3",405,0)
 ; $$LASTCMP
"RTN","SAMICAS3",406,0)
 ; $$PRIORCMP
"RTN","SAMICAS3",407,0)
 ;@calls
"RTN","SAMICAS3",408,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",409,0)
 ; ^%DT
"RTN","SAMICAS3",410,0)
 ; ^%ZTER
"RTN","SAMICAS3",411,0)
 ;@input
"RTN","SAMICAS3",412,0)
 ; sid = study id
"RTN","SAMICAS3",413,0)
 ;@output
"RTN","SAMICAS3",414,0)
 ; .ARY: sorted array of all forms for patient by date
"RTN","SAMICAS3",415,0)
 ;  ARY(fmdate,key)=""
"RTN","SAMICAS3",416,0)
 ;@examples [tbd]
"RTN","SAMICAS3",417,0)
 ;@tests [tbd]
"RTN","SAMICAS3",418,0)
 ;
"RTN","SAMICAS3",419,0)
 ;
"RTN","SAMICAS3",420,0)
 ;@stanza 2 sort patient's forms by date
"RTN","SAMICAS3",421,0)
 ;
"RTN","SAMICAS3",422,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",423,0)
 quit:'$data(@root@("graph",sid))
"RTN","SAMICAS3",424,0)
 new froot set froot=$name(@root@("graph",sid))
"RTN","SAMICAS3",425,0)
 ;
"RTN","SAMICAS3",426,0)
 new zi set zi=""
"RTN","SAMICAS3",427,0)
 for  set zi=$order(@froot@(zi)) quit:zi=""  do  ;
"RTN","SAMICAS3",428,0)
 . new ftype set ftype=$piece(zi,"-",1)
"RTN","SAMICAS3",429,0)
 . new fdate set fdate=$piece(zi,ftype_"-",2)
"RTN","SAMICAS3",430,0)
 . new X,Y
"RTN","SAMICAS3",431,0)
 . set X=fdate
"RTN","SAMICAS3",432,0)
 . do ^%DT
"RTN","SAMICAS3",433,0)
 . if Y=-1 do ^%ZTER quit  ;
"RTN","SAMICAS3",434,0)
 . set ARY(Y,zi)=""
"RTN","SAMICAS3",435,0)
 . quit
"RTN","SAMICAS3",436,0)
 ;
"RTN","SAMICAS3",437,0)
 ;
"RTN","SAMICAS3",438,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",439,0)
 ;
"RTN","SAMICAS3",440,0)
 quit  ; end of SORTFRMS
"RTN","SAMICAS3",441,0)
 ;
"RTN","SAMICAS3",442,0)
 ;
"RTN","SAMICAS3",443,0)
 ;
"RTN","SAMICAS3",444,0)
MKCEFORM(sid,key) ; create ct evaluation form
"RTN","SAMICAS3",445,0)
 ;
"RTN","SAMICAS3",446,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",447,0)
 ;
"RTN","SAMICAS3",448,0)
 ;ven/gpl;private;procedure;clean;silent;sac;
"RTN","SAMICAS3",449,0)
 ;@called-by
"RTN","SAMICAS3",450,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",451,0)
 ;@calls
"RTN","SAMICAS3",452,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",453,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",454,0)
 ; $$LASTCMP
"RTN","SAMICAS3",455,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",456,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",457,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS3",458,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",459,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",460,0)
 ; $$PRIORCMP^SAMICAS3
"RTN","SAMICAS3",461,0)
 ;@input
"RTN","SAMICAS3",462,0)
 ; sid = study id
"RTN","SAMICAS3",463,0)
 ; key = form key, e.g. ceform-2021-05-25
"RTN","SAMICAS3",464,0)
 ;@output
"RTN","SAMICAS3",465,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",466,0)
 ;@examples [tbd]
"RTN","SAMICAS3",467,0)
 ;@tests [tbd]
"RTN","SAMICAS3",468,0)
 ;
"RTN","SAMICAS3",469,0)
 ;
"RTN","SAMICAS3",470,0)
 ;@stanza 2 create ct eval form
"RTN","SAMICAS3",471,0)
 ;
"RTN","SAMICAS3",472,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",473,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",474,0)
 quit:+sien=0
"RTN","SAMICAS3",475,0)
 new cdate set cdate=$piece(key,"ceform-",2)
"RTN","SAMICAS3",476,0)
 ;
"RTN","SAMICAS3",477,0)
 ; nodule copy
"RTN","SAMICAS3",478,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",479,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",480,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",481,0)
 . new target,source
"RTN","SAMICAS3",482,0)
 . set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",483,0)
 . set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",484,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",485,0)
 . quit
"RTN","SAMICAS3",486,0)
 ; end nodule copy
"RTN","SAMICAS3",487,0)
 ;
"RTN","SAMICAS3",488,0)
 ; new items,prevct
"RTN","SAMICAS3",489,0)
 ; do GETITEMS^SAMICASE("items",sid)
"RTN","SAMICAS3",490,0)
 ; set prevct=""
"RTN","SAMICAS3",491,0)
 ; if $data(items("type","vapals:ceform")) do  ; previous cteval exists
"RTN","SAMICAS3",492,0)
 ; . set prevct=$order(items("type","vapals:ceform",""),-1) ; latest ceform
"RTN","SAMICAS3",493,0)
 ; . quit
"RTN","SAMICAS3",494,0)
 ; if prevct'="" do  ;
"RTN","SAMICAS3",495,0)
 ; . new target,source
"RTN","SAMICAS3",496,0)
 ; . set source=$name(@root@("graph",sid,prevct))
"RTN","SAMICAS3",497,0)
 ; . set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",498,0)
 ; . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",499,0)
 ; . quit
"RTN","SAMICAS3",500,0)
 ;
"RTN","SAMICAS3",501,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",502,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",503,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",504,0)
 ;
"RTN","SAMICAS3",505,0)
 ; set baseline CT date and last comparison scan date
"RTN","SAMICAS3",506,0)
 do  ;
"RTN","SAMICAS3",507,0)
 . new basedt
"RTN","SAMICAS3",508,0)
 . set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",509,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",510,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",511,0)
 . if lastdt=-1 set lastdt=basedt
"RTN","SAMICAS3",512,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS3(sid)
"RTN","SAMICAS3",513,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",514,0)
 . if priordt="" set priordt=lastdt
"RTN","SAMICAS3",515,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",516,0)
 . set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",517,0)
 . set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",518,0)
 . quit
"RTN","SAMICAS3",519,0)
 ;
"RTN","SAMICAS3",520,0)
 ;
"RTN","SAMICAS3",521,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",522,0)
 ;
"RTN","SAMICAS3",523,0)
 quit  ; end of MKCEFORM
"RTN","SAMICAS3",524,0)
 ;
"RTN","SAMICAS3",525,0)
 ;
"RTN","SAMICAS3",526,0)
 ;
"RTN","SAMICAS3",527,0)
MKFUFORM(sid,key) ; create Follow-up form
"RTN","SAMICAS3",528,0)
 ;
"RTN","SAMICAS3",529,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",530,0)
 ;
"RTN","SAMICAS3",531,0)
 ;ven/gpl;private;procedure;clean;silent;sac;
"RTN","SAMICAS3",532,0)
 ;@called-by
"RTN","SAMICAS3",533,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",534,0)
 ;@calls
"RTN","SAMICAS3",535,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",536,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",537,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMICAS3",538,0)
 ; $$BASELNDT
"RTN","SAMICAS3",539,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",540,0)
 ;@input
"RTN","SAMICAS3",541,0)
 ; sid = study id
"RTN","SAMICAS3",542,0)
 ; key = form key, e.g. fuform-2021-05-25
"RTN","SAMICAS3",543,0)
 ;@output
"RTN","SAMICAS3",544,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",545,0)
 ;@examples [tbd]
"RTN","SAMICAS3",546,0)
 ;@tests [tbd]
"RTN","SAMICAS3",547,0)
 ;
"RTN","SAMICAS3",548,0)
 ;
"RTN","SAMICAS3",549,0)
 ;@stanza 2 create Follow-up form
"RTN","SAMICAS3",550,0)
 ;
"RTN","SAMICAS3",551,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",552,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",553,0)
 quit:+sien=0
"RTN","SAMICAS3",554,0)
 ;
"RTN","SAMICAS3",555,0)
 new cdate set cdate=$piece(key,"fuform-",2)
"RTN","SAMICAS3",556,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",557,0)
 ;
"RTN","SAMICAS3",558,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",559,0)
 set @root@("graph",sid,key,"sidof")=$$KEY2DSPD^SAMICAS2(cdate)
"RTN","SAMICAS3",560,0)
 set @root@("graph",sid,key,"sidoe")=$$BASELNDT(sid)
"RTN","SAMICAS3",561,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",562,0)
 ;
"RTN","SAMICAS3",563,0)
 ;
"RTN","SAMICAS3",564,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",565,0)
 ;
"RTN","SAMICAS3",566,0)
 quit  ; end of MKFUFORM
"RTN","SAMICAS3",567,0)
 ;
"RTN","SAMICAS3",568,0)
 ;
"RTN","SAMICAS3",569,0)
 ;
"RTN","SAMICAS3",570,0)
BASELNDT(sid) ; last previous baseline ct date
"RTN","SAMICAS3",571,0)
 ;
"RTN","SAMICAS3",572,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",573,0)
 ;
"RTN","SAMICAS3",574,0)
 ;ven/gpl;private;function;clean;silent;sac
"RTN","SAMICAS3",575,0)
 ;@called-by
"RTN","SAMICAS3",576,0)
 ; MKCEFORM
"RTN","SAMICAS3",577,0)
 ; MKFUFORM
"RTN","SAMICAS3",578,0)
 ; MKPTFORM
"RTN","SAMICAS3",579,0)
 ; MKITFORM
"RTN","SAMICAS3",580,0)
 ;@calls
"RTN","SAMICAS3",581,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",582,0)
 ; GETITEMS^SAMICASE
"RTN","SAMICAS3",583,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMICAS3",584,0)
 ;@input
"RTN","SAMICAS3",585,0)
 ; sid = study id
"RTN","SAMICAS3",586,0)
 ;@output = last previous baseline ct date
"RTN","SAMICAS3",587,0)
 ;@examples [tbd]
"RTN","SAMICAS3",588,0)
 ;@tests [tbd]
"RTN","SAMICAS3",589,0)
 ;
"RTN","SAMICAS3",590,0)
 ;
"RTN","SAMICAS3",591,0)
 ;@stanza 2 calculate last previous baseline ct date
"RTN","SAMICAS3",592,0)
 ;
"RTN","SAMICAS3",593,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",594,0)
 new groot set groot=$name(@root@("graph",sid))
"RTN","SAMICAS3",595,0)
 new items set items=""
"RTN","SAMICAS3",596,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMICAS3",597,0)
 quit:'$data(items) ""
"RTN","SAMICAS3",598,0)
 ;
"RTN","SAMICAS3",599,0)
 new bdate set bdate=""
"RTN","SAMICAS3",600,0)
 new bkey set bkey=""
"RTN","SAMICAS3",601,0)
 new done set done=0
"RTN","SAMICAS3",602,0)
 for  set bkey=$order(items("type","vapals:ceform",bkey)) quit:bkey=""  do  ;
"RTN","SAMICAS3",603,0)
 . ; write !,bkey," ",$get(@groot@(bkey,"cetex"))
"RTN","SAMICAS3",604,0)
 . if $get(@groot@(bkey,"cetex"))="b" do  ;
"RTN","SAMICAS3",605,0)
 . . set done=1
"RTN","SAMICAS3",606,0)
 . . set bdate=$piece(bkey,"ceform-",2)
"RTN","SAMICAS3",607,0)
 . . quit
"RTN","SAMICAS3",608,0)
 . quit
"RTN","SAMICAS3",609,0)
 set bdate=$$KEY2DSPD^SAMICAS2(bdate)
"RTN","SAMICAS3",610,0)
 ;
"RTN","SAMICAS3",611,0)
 ;
"RTN","SAMICAS3",612,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",613,0)
 ;
"RTN","SAMICAS3",614,0)
 quit bdate ; end of $$BASELNDT
"RTN","SAMICAS3",615,0)
 ;
"RTN","SAMICAS3",616,0)
 ;
"RTN","SAMICAS3",617,0)
 ;
"RTN","SAMICAS3",618,0)
MKPTFORM(sid,key) ; create pet evaluation form
"RTN","SAMICAS3",619,0)
 ;
"RTN","SAMICAS3",620,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",621,0)
 ;
"RTN","SAMICAS3",622,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",623,0)
 ;@called-by
"RTN","SAMICAS3",624,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",625,0)
 ;@calls
"RTN","SAMICAS3",626,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",627,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",628,0)
 ; $$LASTCMP
"RTN","SAMICAS3",629,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",630,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",631,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS3",632,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",633,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",634,0)
 ; $$PRIORCMP^SAMICAS3
"RTN","SAMICAS3",635,0)
 ;@input
"RTN","SAMICAS3",636,0)
 ; sid = study id
"RTN","SAMICAS3",637,0)
 ; key = form key, e.g. ptform-2021-05-25
"RTN","SAMICAS3",638,0)
 ;@output
"RTN","SAMICAS3",639,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",640,0)
 ;@examples [tbd]
"RTN","SAMICAS3",641,0)
 ;@tests [tbd]
"RTN","SAMICAS3",642,0)
 ;
"RTN","SAMICAS3",643,0)
 ;
"RTN","SAMICAS3",644,0)
 ;@stanza 2 create pet eval form
"RTN","SAMICAS3",645,0)
 ;
"RTN","SAMICAS3",646,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",647,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",648,0)
 quit:+sien=0
"RTN","SAMICAS3",649,0)
 ;
"RTN","SAMICAS3",650,0)
 ; nodule copy
"RTN","SAMICAS3",651,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",652,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",653,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",654,0)
 . new target,source
"RTN","SAMICAS3",655,0)
 . set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",656,0)
 . set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",657,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",658,0)
 . quit
"RTN","SAMICAS3",659,0)
 ; end nodule copy
"RTN","SAMICAS3",660,0)
 ;
"RTN","SAMICAS3",661,0)
 new cdate set cdate=$piece(key,"ptform-",2)
"RTN","SAMICAS3",662,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",663,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",664,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",665,0)
 ;
"RTN","SAMICAS3",666,0)
 do  ;
"RTN","SAMICAS3",667,0)
 . new basedt
"RTN","SAMICAS3",668,0)
 . set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",669,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",670,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",671,0)
 . if lastdt=-1 set lastdt=basedt
"RTN","SAMICAS3",672,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS3(sid)
"RTN","SAMICAS3",673,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",674,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",675,0)
 . ; set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",676,0)
 . set @root@("graph",sid,key,"cedos")=lastdt ; it's different than on the ce
"RTN","SAMICAS3",677,0)
 . ; set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",678,0)
 . quit
"RTN","SAMICAS3",679,0)
 ;
"RTN","SAMICAS3",680,0)
 ;
"RTN","SAMICAS3",681,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",682,0)
 ;
"RTN","SAMICAS3",683,0)
 quit  ; end of MKPTFORM
"RTN","SAMICAS3",684,0)
 ;
"RTN","SAMICAS3",685,0)
 ;
"RTN","SAMICAS3",686,0)
 ;
"RTN","SAMICAS3",687,0)
MKITFORM(sid,key) ; create intervention form
"RTN","SAMICAS3",688,0)
 ;
"RTN","SAMICAS3",689,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",690,0)
 ;
"RTN","SAMICAS3",691,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",692,0)
 ;@called-by
"RTN","SAMICAS3",693,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",694,0)
 ;@calls
"RTN","SAMICAS3",695,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",696,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",697,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",698,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS3",699,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",700,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",701,0)
 ; $$PRIORCMP^SAMICAS3
"RTN","SAMICAS3",702,0)
 ;@input
"RTN","SAMICAS3",703,0)
 ; sid = study id
"RTN","SAMICAS3",704,0)
 ; key = form key, e.g. itform-2021-05-25
"RTN","SAMICAS3",705,0)
 ;@output
"RTN","SAMICAS3",706,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",707,0)
 ;@examples [tbd]
"RTN","SAMICAS3",708,0)
 ;@tests [tbd]
"RTN","SAMICAS3",709,0)
 ;
"RTN","SAMICAS3",710,0)
 ;
"RTN","SAMICAS3",711,0)
 ;@stanza 2 create intervention form
"RTN","SAMICAS3",712,0)
 ;
"RTN","SAMICAS3",713,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",714,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",715,0)
 quit:+sien=0
"RTN","SAMICAS3",716,0)
 ;
"RTN","SAMICAS3",717,0)
 new cdate set cdate=$piece(key,"itform-",2)
"RTN","SAMICAS3",718,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",719,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",720,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",721,0)
 ;
"RTN","SAMICAS3",722,0)
 do  ;
"RTN","SAMICAS3",723,0)
 . new basedt
"RTN","SAMICAS3",724,0)
 . set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",725,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",726,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",727,0)
 . if lastdt=-1 set lastdt=basedt
"RTN","SAMICAS3",728,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS3(sid)
"RTN","SAMICAS3",729,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",730,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",731,0)
 . ; set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",732,0)
 . set @root@("graph",sid,key,"cedos")=lastdt ; it's different than on the ce
"RTN","SAMICAS3",733,0)
 . ; set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",734,0)
 . quit
"RTN","SAMICAS3",735,0)
 ;
"RTN","SAMICAS3",736,0)
 ;
"RTN","SAMICAS3",737,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",738,0)
 ;
"RTN","SAMICAS3",739,0)
 quit  ; end of MKITFORM
"RTN","SAMICAS3",740,0)
 ;
"RTN","SAMICAS3",741,0)
 ;
"RTN","SAMICAS3",742,0)
 ;
"RTN","SAMICAS3",743,0)
MKBXFORM(sid,key) ; create biopsy form
"RTN","SAMICAS3",744,0)
 ;
"RTN","SAMICAS3",745,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",746,0)
 ;
"RTN","SAMICAS3",747,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",748,0)
 ;@called-by
"RTN","SAMICAS3",749,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",750,0)
 ;@calls
"RTN","SAMICAS3",751,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",752,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",753,0)
 ; $$LASTCMP
"RTN","SAMICAS3",754,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",755,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",756,0)
 ;@input
"RTN","SAMICAS3",757,0)
 ; sid = study id
"RTN","SAMICAS3",758,0)
 ; key = form key, e.g. bxform-2021-05-25
"RTN","SAMICAS3",759,0)
 ;@output
"RTN","SAMICAS3",760,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",761,0)
 ;@examples [tbd]
"RTN","SAMICAS3",762,0)
 ;@tests [tbd]
"RTN","SAMICAS3",763,0)
 ;
"RTN","SAMICAS3",764,0)
 ;
"RTN","SAMICAS3",765,0)
 ;@stanza 2 create background form
"RTN","SAMICAS3",766,0)
 ;
"RTN","SAMICAS3",767,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",768,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",769,0)
 quit:+sien=0
"RTN","SAMICAS3",770,0)
 new cdate set cdate=$piece(key,"bxform-",2)
"RTN","SAMICAS3",771,0)
 ;
"RTN","SAMICAS3",772,0)
 ; nodule copy
"RTN","SAMICAS3",773,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",774,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",775,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",776,0)
 . new target,source
"RTN","SAMICAS3",777,0)
 . set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",778,0)
 . set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",779,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",780,0)
 . quit
"RTN","SAMICAS3",781,0)
 ; end nodule copy
"RTN","SAMICAS3",782,0)
 ;
"RTN","SAMICAS3",783,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",784,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",785,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",786,0)
 ;
"RTN","SAMICAS3",787,0)
 ;
"RTN","SAMICAS3",788,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",789,0)
 ;
"RTN","SAMICAS3",790,0)
 quit  ; end of MKBXFORM
"RTN","SAMICAS3",791,0)
 ;
"RTN","SAMICAS3",792,0)
 ;
"RTN","SAMICAS3",793,0)
 ;
"RTN","SAMICAS3",794,0)
CASETBL(ary) ; generates case review table
"RTN","SAMICAS3",795,0)
 ;
"RTN","SAMICAS3",796,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",797,0)
 ;
"RTN","SAMICAS3",798,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",799,0)
 ;@called by none
"RTN","SAMICAS3",800,0)
 ;@calls
"RTN","SAMICAS3",801,0)
 ;@input
"RTN","SAMICAS3",802,0)
 ; ary = name of array (passed by name, will be cleared)
"RTN","SAMICAS3",803,0)
 ;@output
"RTN","SAMICAS3",804,0)
 ; @ary
"RTN","SAMICAS3",805,0)
 ;@tests
"RTN","SAMICAS3",806,0)
 ; SAMIUTS2
"RTN","SAMICAS3",807,0)
 ;
"RTN","SAMICAS3",808,0)
 ;
"RTN","SAMICAS3",809,0)
 ;@stanza 2 build table
"RTN","SAMICAS3",810,0)
 ;
"RTN","SAMICAS3",811,0)
 kill @ary
"RTN","SAMICAS3",812,0)
 ;
"RTN","SAMICAS3",813,0)
 set @ary@("siform","form")="siform"
"RTN","SAMICAS3",814,0)
 set @ary@("siform","js")="subPr"
"RTN","SAMICAS3",815,0)
 set @ary@("siform","name")="Intake"
"RTN","SAMICAS3",816,0)
 set @ary@("siform","image")="preview.gif"
"RTN","SAMICAS3",817,0)
 ;
"RTN","SAMICAS3",818,0)
 set @ary@("nuform","form")="nuform"
"RTN","SAMICAS3",819,0)
 set @ary@("nuform","js")="subFr"
"RTN","SAMICAS3",820,0)
 set @ary@("nuform","name")="New Form"
"RTN","SAMICAS3",821,0)
 set @ary@("nuform","image")="nform.gif"
"RTN","SAMICAS3",822,0)
 ;
"RTN","SAMICAS3",823,0)
 set @ary@("sched","form")="sched"
"RTN","SAMICAS3",824,0)
 set @ary@("sched","js")="subSc"
"RTN","SAMICAS3",825,0)
 set @ary@("sched","name")="Schedule"
"RTN","SAMICAS3",826,0)
 set @ary@("sched","image")="schedule.gif"
"RTN","SAMICAS3",827,0)
 ;
"RTN","SAMICAS3",828,0)
 set @ary@("sbform","form")="sbform"
"RTN","SAMICAS3",829,0)
 set @ary@("sbform","js")="subPr"
"RTN","SAMICAS3",830,0)
 set @ary@("sbform","name")="Background"
"RTN","SAMICAS3",831,0)
 set @ary@("sbform","image")="preview.gif"
"RTN","SAMICAS3",832,0)
 ;
"RTN","SAMICAS3",833,0)
 set @ary@("ceform","form")="ceform"
"RTN","SAMICAS3",834,0)
 set @ary@("ceform","js")="subPr"
"RTN","SAMICAS3",835,0)
 set @ary@("ceform","name")="CT Evaluation"
"RTN","SAMICAS3",836,0)
 set @ary@("ceform","image")="preview.gif"
"RTN","SAMICAS3",837,0)
 ;
"RTN","SAMICAS3",838,0)
 set @ary@("report","form")="report"
"RTN","SAMICAS3",839,0)
 set @ary@("report","js")="subRp"
"RTN","SAMICAS3",840,0)
 set @ary@("report","name")="Report"
"RTN","SAMICAS3",841,0)
 set @ary@("report","image")="report.gif"
"RTN","SAMICAS3",842,0)
 ;
"RTN","SAMICAS3",843,0)
 set @ary@("ptform","form")="ptform"
"RTN","SAMICAS3",844,0)
 set @ary@("ptform","js")="subPr"
"RTN","SAMICAS3",845,0)
 set @ary@("ptform","name")="PET Evaluation"
"RTN","SAMICAS3",846,0)
 set @ary@("ptform","image")="preview.gif"
"RTN","SAMICAS3",847,0)
 ;
"RTN","SAMICAS3",848,0)
 set @ary@("bxform","form")="bxform"
"RTN","SAMICAS3",849,0)
 set @ary@("bxform","js")="subPr"
"RTN","SAMICAS3",850,0)
 set @ary@("bxform","name")="Biopsy"
"RTN","SAMICAS3",851,0)
 set @ary@("bxform","image")="preview.gif"
"RTN","SAMICAS3",852,0)
 ;
"RTN","SAMICAS3",853,0)
 set @ary@("rbform","form")="rbform"
"RTN","SAMICAS3",854,0)
 set @ary@("rbform","js")="subPr"
"RTN","SAMICAS3",855,0)
 set @ary@("rbform","name")="Intervention"
"RTN","SAMICAS3",856,0)
 set @ary@("rbform","image")="preview.gif"
"RTN","SAMICAS3",857,0)
 ;
"RTN","SAMICAS3",858,0)
 set @ary@("ceform","form")="ceform"
"RTN","SAMICAS3",859,0)
 set @ary@("ceform","js")="subPr"
"RTN","SAMICAS3",860,0)
 set @ary@("ceform","name")="CT Evaluation"
"RTN","SAMICAS3",861,0)
 set @ary@("ceform","image")="preview.gif"
"RTN","SAMICAS3",862,0)
 ;
"RTN","SAMICAS3",863,0)
 ;
"RTN","SAMICAS3",864,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",865,0)
 ;
"RTN","SAMICAS3",866,0)
 quit  ; end of CASETBL
"RTN","SAMICAS3",867,0)
 ;
"RTN","SAMICAS3",868,0)
 ;
"RTN","SAMICAS3",869,0)
 ;
"RTN","SAMICAS3",870,0)
EOR ; end of routine SAMICAS3
"RTN","SAMICSV")
0^4^B60401322
"RTN","SAMICSV",1,0)
SAMICSV ;ven/gpl - csv export ;2021-05-21T20:47Z
"RTN","SAMICSV",2,0)
 ;;18.0;SAMI;**7,11**;2020-01;Build 19
"RTN","SAMICSV",3,0)
 ;;1.18.0.11+i11
"RTN","SAMICSV",4,0)
 ;
"RTN","SAMICSV",5,0)
 ; SAMICSV contains a direct-mode interface to produce the VAPALS-
"RTN","SAMICSV",6,0)
 ; ELCAP CSV export.
"RTN","SAMICSV",7,0)
 ;
"RTN","SAMICSV",8,0)
 ; allow entry from top, fallthrough to EN
"RTN","SAMICSV",9,0)
 ;
"RTN","SAMICSV",10,0)
 ;
"RTN","SAMICSV",11,0)
 ;
"RTN","SAMICSV",12,0)
 ;@section 0 primary development
"RTN","SAMICSV",13,0)
 ;
"RTN","SAMICSV",14,0)
 ;
"RTN","SAMICSV",15,0)
 ;
"RTN","SAMICSV",16,0)
 ;@routine-credits
"RTN","SAMICSV",17,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMICSV",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICSV",19,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMICSV",20,0)
 ; http://vistaexpertise.net
"RTN","SAMICSV",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMICSV",22,0)
 ;@license see routine SAMIUL
"RTN","SAMICSV",23,0)
 ;
"RTN","SAMICSV",24,0)
 ;@last-updated 2021-05-21T20:47Z
"RTN","SAMICSV",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMICSV",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMICSV",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMICSV",28,0)
 ;@version 1.18.0.11+i11
"RTN","SAMICSV",29,0)
 ;@release-date 2020-01
"RTN","SAMICSV",30,0)
 ;@patch-list **7,11**
"RTN","SAMICSV",31,0)
 ;
"RTN","SAMICSV",32,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMICSV",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMICSV",34,0)
 ;@additional-dev Kenneth McGlothlen (mcglk)
"RTN","SAMICSV",35,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICSV",36,0)
 ;
"RTN","SAMICSV",37,0)
 ;@module-credits
"RTN","SAMICSV",38,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICSV",39,0)
 ; (VA-PALS)
"RTN","SAMICSV",40,0)
 ; http://va-pals.org/
"RTN","SAMICSV",41,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICSV",42,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICSV",43,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICSV",44,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICSV",45,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMICSV",46,0)
 ; http://ielcap.com/
"RTN","SAMICSV",47,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICSV",48,0)
 ; http://paraxialtech.com/
"RTN","SAMICSV",49,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICSV",50,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICSV",51,0)
 ;
"RTN","SAMICSV",52,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICSV",53,0)
 ;
"RTN","SAMICSV",54,0)
 ; 2020-08-20/09-24 ven/gpl 1.18.0.7+i7 9486abb2,5ae08772,ba0bcb82,
"RTN","SAMICSV",55,0)
 ; 1a2a1bf6,16511893
"RTN","SAMICSV",56,0)
 ;  SAMICSV: new routine, test build for extracting form data to csv
"RTN","SAMICSV",57,0)
 ; files, upgrade change site to handle patients without forms, audit
"RTN","SAMICSV",58,0)
 ; report, select from 7 forms for extract, fix dictionary spelling
"RTN","SAMICSV",59,0)
 ; for followup form, fix bug of line feeds in csv output interrupting
"RTN","SAMICSV",60,0)
 ; excel load.
"RTN","SAMICSV",61,0)
 ;
"RTN","SAMICSV",62,0)
 ; 2021-03-25 ven/gpl 1.18.0.11+i11 e28a34d3
"RTN","SAMICSV",63,0)
 ;  SAMICSV: remove line feeds from variables.
"RTN","SAMICSV",64,0)
 ;
"RTN","SAMICSV",65,0)
 ; 2021-03-30 ven/toad 1.18.0.11+i11 7b14bb2
"RTN","SAMICSV",66,0)
 ;  SAMICSV: bump version, date, patch list, create hdr comments, lt
"RTN","SAMICSV",67,0)
 ; refactor.
"RTN","SAMICSV",68,0)
 ;
"RTN","SAMICSV",69,0)
 ; 2021-04-15 ven/gpl 1.18.0.11+i11 f9795a5,5aa13f1
"RTN","SAMICSV",70,0)
 ;  SAMICSV: fix double quotes in csv output, correct csv format no
"RTN","SAMICSV",71,0)
 ; quotes for null cells.
"RTN","SAMICSV",72,0)
 ;
"RTN","SAMICSV",73,0)
 ; 2021-05-21 ven/mcglk&toad 1.18.0.11+i11
"RTN","SAMICSV",74,0)
 ;  SAMICSV: bump version, date.
"RTN","SAMICSV",75,0)
 ;
"RTN","SAMICSV",76,0)
 ;
"RTN","SAMICSV",77,0)
 ;
"RTN","SAMICSV",78,0)
 ;@contents
"RTN","SAMICSV",79,0)
 ; EN entry point to generate csv files from forms for a site
"RTN","SAMICSV",80,0)
 ; ONEFORM process one form for a site
"RTN","SAMICSV",81,0)
 ; $$FNAME filename for site/form
"RTN","SAMICSV",82,0)
 ; DDICT data dictionary for form
"RTN","SAMICSV",83,0)
 ; $$SAYFORM prompts for form
"RTN","SAMICSV",84,0)
 ;
"RTN","SAMICSV",85,0)
 ;
"RTN","SAMICSV",86,0)
 ;
"RTN","SAMICSV",87,0)
EN ; entry point to generate csv files from forms for a site
"RTN","SAMICSV",88,0)
 ;
"RTN","SAMICSV",89,0)
 ; first pick a site
"RTN","SAMICSV",90,0)
 N X,Y,DIC,SITEIEN,SITEID
"RTN","SAMICSV",91,0)
 S DIC=311.12
"RTN","SAMICSV",92,0)
 S DIC(0)="AEMQ"
"RTN","SAMICSV",93,0)
 D ^DIC
"RTN","SAMICSV",94,0)
 I Y<1 Q  ; EXIT
"RTN","SAMICSV",95,0)
 S SITENUM=$P(Y,"^",2)
"RTN","SAMICSV",96,0)
 S SITEID=$$SITEID^SAMISITE(SITENUM)
"RTN","SAMICSV",97,0)
 Q:SITEID=""
"RTN","SAMICSV",98,0)
 ;
"RTN","SAMICSV",99,0)
 N SAMIFORM S SAMIFORM=$$SAYFORM()
"RTN","SAMICSV",100,0)
 Q:SAMIFORM=-1
"RTN","SAMICSV",101,0)
 ;
"RTN","SAMICSV",102,0)
 ; prompt for the directory
"RTN","SAMICSV",103,0)
 N SAMIDIR
"RTN","SAMICSV",104,0)
 D GETDIR^SAMIFDM(.SAMIDIR)
"RTN","SAMICSV",105,0)
 Q:SAMIDIR=""
"RTN","SAMICSV",106,0)
 ;
"RTN","SAMICSV",107,0)
 d ONEFORM(SITEID,SAMIFORM,SAMIDIR) ; process one form for a site
"RTN","SAMICSV",108,0)
 ;
"RTN","SAMICSV",109,0)
 quit  ; end of EN
"RTN","SAMICSV",110,0)
 ;
"RTN","SAMICSV",111,0)
 ;
"RTN","SAMICSV",112,0)
 ;
"RTN","SAMICSV",113,0)
ONEFORM(SITEID,SAMIFORM,SAMIDIR) ; process one form for a site
"RTN","SAMICSV",114,0)
 ;
"RTN","SAMICSV",115,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICSV",116,0)
 n groot s groot=$na(@root@("graph"))
"RTN","SAMICSV",117,0)
 n SAMII S SAMII=SITEID
"RTN","SAMICSV",118,0)
 n cnt s cnt=0
"RTN","SAMICSV",119,0)
 n forms s forms=0
"RTN","SAMICSV",120,0)
 ;
"RTN","SAMICSV",121,0)
 n SAMIOUT S SAMIOUT=$NA(^TMP("SAMICSV",$J))
"RTN","SAMICSV",122,0)
 k @SAMIOUT
"RTN","SAMICSV",123,0)
 ;
"RTN","SAMICSV",124,0)
 n DICT
"RTN","SAMICSV",125,0)
 d DDICT("DICT",SAMIFORM) ; get the data dictionary for this form
"RTN","SAMICSV",126,0)
 q:'$d(DICT)
"RTN","SAMICSV",127,0)
 ;
"RTN","SAMICSV",128,0)
 N SAMIN S SAMIN=1
"RTN","SAMICSV",129,0)
 N SAMIJJ s SAMIJJ=0
"RTN","SAMICSV",130,0)
 N OFFSET S OFFSET=0
"RTN","SAMICSV",131,0)
 I SAMIFORM="siform" d  ;
"RTN","SAMICSV",132,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",133,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="saminame"
"RTN","SAMICSV",134,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",135,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="ssn"
"RTN","SAMICSV",136,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",137,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="last5"
"RTN","SAMICSV",138,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",139,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="sex"
"RTN","SAMICSV",140,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",141,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="sbdob"
"RTN","SAMICSV",142,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",143,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="samiru"
"RTN","SAMICSV",144,0)
 f  s SAMIJJ=$o(DICT(SAMIJJ)) q:+SAMIJJ=0  d  ;
"RTN","SAMICSV",145,0)
 . s $p(@SAMIOUT@(SAMIN),"|",SAMIJJ+OFFSET)=DICT(SAMIJJ) ; csv header
"RTN","SAMICSV",146,0)
 s @SAMIOUT@(SAMIN)="siteid|samistudyid|form|"_@SAMIOUT@(SAMIN)
"RTN","SAMICSV",147,0)
 ;S @SAMIOUT@(SAMIN)=@SAMIOUT@(SAMIN)_$C(13,10) ; carriage return line feed
"RTN","SAMICSV",148,0)
 ; 
"RTN","SAMICSV",149,0)
 f  s SAMII=$o(@groot@(SAMII)) q:SAMII=""  q:$e(SAMII,1,3)'[SITEID  d  ;
"RTN","SAMICSV",150,0)
 . s cnt=cnt+1
"RTN","SAMICSV",151,0)
 . w !,SAMII
"RTN","SAMICSV",152,0)
 . N SAMIJ S SAMIJ=SAMIFORM
"RTN","SAMICSV",153,0)
 . n done s done=0
"RTN","SAMICSV",154,0)
 . f  s SAMIJ=$O(@groot@(SAMII,SAMIJ)) q:SAMIJ=""  q:done  d  ;
"RTN","SAMICSV",155,0)
 . . i $e(SAMIJ,1,$l(SAMIFORM))'=SAMIFORM s done=1 q  ;
"RTN","SAMICSV",156,0)
 . . s forms=forms+1
"RTN","SAMICSV",157,0)
 . . n jj s jj=0
"RTN","SAMICSV",158,0)
 . . s SAMIN=SAMIN+1
"RTN","SAMICSV",159,0)
 . . S OFFSET=0
"RTN","SAMICSV",160,0)
 . . I SAMIFORM="siform" d  ;
"RTN","SAMICSV",161,0)
 . . . n kk s kk=$o(@root@("sid",SAMII,""))
"RTN","SAMICSV",162,0)
 . . . q:kk=""
"RTN","SAMICSV",163,0)
 . . . S OFFSET=OFFSET+1
"RTN","SAMICSV",164,0)
 . . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"saminame"))
"RTN","SAMICSV",165,0)
 . . . S OFFSET=OFFSET+1
"RTN","SAMICSV",166,0)
 . . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"ssn"))
"RTN","SAMICSV",167,0)
 . . . S OFFSET=OFFSET+1
"RTN","SAMICSV",168,0)
 . . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"last5"))
"RTN","SAMICSV",169,0)
 . . . S OFFSET=OFFSET+1
"RTN","SAMICSV",170,0)
 . . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"sex"))
"RTN","SAMICSV",171,0)
 . . . S OFFSET=OFFSET+1
"RTN","SAMICSV",172,0)
 . . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"sbdob"))
"RTN","SAMICSV",173,0)
 . . . S OFFSET=OFFSET+1
"RTN","SAMICSV",174,0)
 . . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"samiru"))
"RTN","SAMICSV",175,0)
 . . f  s jj=$o(DICT(jj)) q:+jj=0  d  ;
"RTN","SAMICSV",176,0)
 . . . ;s $P(@SAMIOUT@(SAMIN),"|",OFFSET+jj)=""""_$g(@groot@(SAMII,SAMIJ,DICT(jj)))_""""
"RTN","SAMICSV",177,0)
 . . . n val
"RTN","SAMICSV",178,0)
 . . . ;s val=$g(@groot@(SAMII,SAMIJ,DICT(jj)))_""""
"RTN","SAMICSV",179,0)
 . . . s val=$g(@groot@(SAMII,SAMIJ,DICT(jj)))
"RTN","SAMICSV",180,0)
 . . . i val'="" d  ;
"RTN","SAMICSV",181,0)
 . . . . s val=$tr(val,$char(11))
"RTN","SAMICSV",182,0)
 . . . . s val=$tr(val,$char(13))
"RTN","SAMICSV",183,0)
 . . . . d findReplaceAll^%ts(.val,"""","""""")
"RTN","SAMICSV",184,0)
 . . . . s val=""""_val_""""
"RTN","SAMICSV",185,0)
 . . . s $P(@SAMIOUT@(SAMIN),"|",OFFSET+jj)=val
"RTN","SAMICSV",186,0)
 . . S @SAMIOUT@(SAMIN)=SITEID_"|"_SAMII_"|"_SAMIJ_"|"_@SAMIOUT@(SAMIN)
"RTN","SAMICSV",187,0)
 . . ;s @SAMIOUT@(SAMIN)=@SAMIOUT@(SAMIN)_$C(13,10)
"RTN","SAMICSV",188,0)
 . ;b
"RTN","SAMICSV",189,0)
 ;ZWR @SAMIOUT@(*)
"RTN","SAMICSV",190,0)
 w !,cnt_" patients, "_forms_" forms"
"RTN","SAMICSV",191,0)
 n filename s filename=$$FNAME(SITEID,SAMIFORM)
"RTN","SAMICSV",192,0)
 d GTF^%ZISH($na(@SAMIOUT@(1)),3,SAMIDIR,filename)
"RTN","SAMICSV",193,0)
 w !,"file "_filename_" written to directory "_SAMIDIR
"RTN","SAMICSV",194,0)
 ;
"RTN","SAMICSV",195,0)
 quit  ; end of ONEFORM
"RTN","SAMICSV",196,0)
 ;
"RTN","SAMICSV",197,0)
 ;
"RTN","SAMICSV",198,0)
 ;
"RTN","SAMICSV",199,0)
FNAME(SITE,FORM) ; extrinsic returns the filename for the site/form
"RTN","SAMICSV",200,0)
 ;
"RTN","SAMICSV",201,0)
 quit SITE_"-"_FORM_"-"_$$FMTHL7^XLFDT($$HTFM^XLFDT($H))_".csv" ; end of $$FNAME
"RTN","SAMICSV",202,0)
 ;
"RTN","SAMICSV",203,0)
 ;
"RTN","SAMICSV",204,0)
 ;
"RTN","SAMICSV",205,0)
DDICT(RTN,FORM) ; data dictionary for FORM, returned in RTN, passed by
"RTN","SAMICSV",206,0)
 ; name
"RTN","SAMICSV",207,0)
 ;
"RTN","SAMICSV",208,0)
 K @RTN
"RTN","SAMICSV",209,0)
 ;
"RTN","SAMICSV",210,0)
 N USEGR S USEGR=""
"RTN","SAMICSV",211,0)
 I FORM="siform" S USEGR="form fields - intake"
"RTN","SAMICSV",212,0)
 I FORM="sbform" S USEGR="form fields - background"
"RTN","SAMICSV",213,0)
 I FORM="ceform" S USEGR="form fields - ct evaluation"
"RTN","SAMICSV",214,0)
 I FORM="fuform" S USEGR="form fields - follow up"
"RTN","SAMICSV",215,0)
 I FORM="bxform" S USEGR="form fields - biopsy"
"RTN","SAMICSV",216,0)
 I FORM="itform" S USEGR="form fields - intervention"
"RTN","SAMICSV",217,0)
 I FORM="ptform" S USEGR="form fields - pet evaluation"
"RTN","SAMICSV",218,0)
 ;
"RTN","SAMICSV",219,0)
 Q:USEGR=""
"RTN","SAMICSV",220,0)
 N root s root=$$setroot^%wd(USEGR)
"RTN","SAMICSV",221,0)
 Q:$g(root)=""
"RTN","SAMICSV",222,0)
 N II S II=0
"RTN","SAMICSV",223,0)
 f  s II=$o(@root@("field",II)) q:+II=0  d  ;
"RTN","SAMICSV",224,0)
 . s @RTN@(II)=$g(@root@("field",II,"input",1,"name"))
"RTN","SAMICSV",225,0)
 ;
"RTN","SAMICSV",226,0)
 quit  ; end of DDICT
"RTN","SAMICSV",227,0)
 ;
"RTN","SAMICSV",228,0)
 ;
"RTN","SAMICSV",229,0)
 ;
"RTN","SAMICSV",230,0)
 ;^%wd(17.040801,"B","form fields - background",437)=""
"RTN","SAMICSV",231,0)
 ;^%wd(17.040801,"B","form fields - biopsy",438)=""
"RTN","SAMICSV",232,0)
 ;^%wd(17.040801,"B","form fields - ct evaluation",439)=""
"RTN","SAMICSV",233,0)
 ;^%wd(17.040801,"B","form fields - follow up",440)=""
"RTN","SAMICSV",234,0)
 ;^%wd(17.040801,"B","form fields - follow-up",359)=""
"RTN","SAMICSV",235,0)
 ;^%wd(17.040801,"B","form fields - intake",491)=""
"RTN","SAMICSV",236,0)
 ;^%wd(17.040801,"B","form fields - intervention",442)=""
"RTN","SAMICSV",237,0)
 ;^%wd(17.040801,"B","form fields - pet evaluation",443)=""
"RTN","SAMICSV",238,0)
 ;
"RTN","SAMICSV",239,0)
 ;
"RTN","SAMICSV",240,0)
 ;
"RTN","SAMICSV",241,0)
SAYFORM() ; prompts for the form
"RTN","SAMICSV",242,0)
 ;
"RTN","SAMICSV",243,0)
 N ZI,ZF,DIR
"RTN","SAMICSV",244,0)
 S ZF(1)="siform"
"RTN","SAMICSV",245,0)
 S ZF(2)="sbform"
"RTN","SAMICSV",246,0)
 S ZF(3)="ceform"
"RTN","SAMICSV",247,0)
 S ZF(4)="fuform"
"RTN","SAMICSV",248,0)
 S ZF(5)="bxform"
"RTN","SAMICSV",249,0)
 S ZF(6)="itform"
"RTN","SAMICSV",250,0)
 S ZF(7)="ptform"
"RTN","SAMICSV",251,0)
 K DIR
"RTN","SAMICSV",252,0)
 S DIR(0)="SO^"
"RTN","SAMICSV",253,0)
 F ZI=1:1:7 S DIR(0)=DIR(0)_ZI_":"_ZF(ZI)_";"
"RTN","SAMICSV",254,0)
 S DIR("L")="Select form to extract:"
"RTN","SAMICSV",255,0)
 S DIR("L",1)="1 Intake form (siform)"
"RTN","SAMICSV",256,0)
 S DIR("L",2)="2 Background form (sbform)"
"RTN","SAMICSV",257,0)
 S DIR("L",3)="3 CT Evaluation form (ceform)"
"RTN","SAMICSV",258,0)
 S DIR("L",4)="4 Followup form (fuform)"
"RTN","SAMICSV",259,0)
 S DIR("L",5)="5 Biopsy form (bxform)"
"RTN","SAMICSV",260,0)
 S DIR("L",6)="6 Intervention form (itform)"
"RTN","SAMICSV",261,0)
 S DIR("L",7)="7 Pet Evaluation form (ptform)"
"RTN","SAMICSV",262,0)
 D ^DIR
"RTN","SAMICSV",263,0)
 ;
"RTN","SAMICSV",264,0)
 Q:X="" -1
"RTN","SAMICSV",265,0)
 quit ZF(X) ; end of $$SAYFORM
"RTN","SAMICSV",266,0)
 ;
"RTN","SAMICSV",267,0)
 ;
"RTN","SAMICSV",268,0)
 ;
"RTN","SAMICSV",269,0)
EOR ; end of routine SAMICSV
"RTN","SAMICTC1")
0^14^B246702028
"RTN","SAMICTC1",1,0)
SAMICTC1 ;ven/gpl - ceform copy ;2021-05-25T15:44Z
"RTN","SAMICTC1",2,0)
 ;;18.0;SAMI;**11**;2020-01;Build 19
"RTN","SAMICTC1",3,0)
 ;;1.18.0.11+i11
"RTN","SAMICTC1",4,0)
 ;
"RTN","SAMICTC1",5,0)
 ; SAMICTC1 & 2 selectively copy fields from a patient's most recent
"RTN","SAMICTC1",6,0)
 ; existing CT Evaluation Form to a brand new form when it is created.
"RTN","SAMICTC1",7,0)
 ; They support the Create Form feature of the Case Review Page.
"RTN","SAMICTC1",8,0)
 ;
"RTN","SAMICTC1",9,0)
 quit  ; no entry from top
"RTN","SAMICTC1",10,0)
 ;
"RTN","SAMICTC1",11,0)
 ;
"RTN","SAMICTC1",12,0)
 ;
"RTN","SAMICTC1",13,0)
 ;@section 0 primary development
"RTN","SAMICTC1",14,0)
 ;
"RTN","SAMICTC1",15,0)
 ;
"RTN","SAMICTC1",16,0)
 ;
"RTN","SAMICTC1",17,0)
 ;@license: see routine SAMIUL
"RTN","SAMICTC1",18,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTC1",19,0)
 ;@contents
"RTN","SAMICTC1",20,0)
 ; CTCOPY copy ct eval form selectively
"RTN","SAMICTC1",21,0)
 ; GENCTCPY generates copy routine from graph
"RTN","SAMICTC1",22,0)
 ;
"RTN","SAMICTC1",23,0)
 ;
"RTN","SAMICTC1",24,0)
 ;
"RTN","SAMICTC1",25,0)
 ;@section 1 wsi WSREPORT & related subroutines
"RTN","SAMICTC1",26,0)
 ;
"RTN","SAMICTC1",27,0)
 ;
"RTN","SAMICTC1",28,0)
 ;
"RTN","SAMICTC1",29,0)
 ;@ppi CTCOPY^SAMICTC1
"RTN","SAMICTC1",30,0)
CTCOPY(FROM,TO,key) ; copy ct eval form selectively
"RTN","SAMICTC1",31,0)
 ;
"RTN","SAMICTC1",32,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTC1",33,0)
 ;
"RTN","SAMICTC1",34,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICTC1",35,0)
 ;@called-by
"RTN","SAMICTC1",36,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICTC1",37,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICTC1",38,0)
 ; MKBXFORM^SAMICAS3
"RTN","SAMICTC1",39,0)
 ;@calls
"RTN","SAMICTC1",40,0)
 ; CTCOPY2^SAMICTC2
"RTN","SAMICTC1",41,0)
 ;@input
"RTN","SAMICTC1",42,0)
 ; FROM = existing source form array root
"RTN","SAMICTC1",43,0)
 ; TO = new target form array root
"RTN","SAMICTC1",44,0)
 ; key = form key, e.g. ceform-2021-05-25
"RTN","SAMICTC1",45,0)
 ;@output
"RTN","SAMICTC1",46,0)
 ; @TO: selected fields copied f/source form t/target form
"RTN","SAMICTC1",47,0)
 ;
"RTN","SAMICTC1",48,0)
 ;
"RTN","SAMICTC1",49,0)
 ;@stanza 2 copy is it new fields
"RTN","SAMICTC1",50,0)
 ;
"RTN","SAMICTC1",51,0)
 if $get(key)="" set key="ce"
"RTN","SAMICTC1",52,0)
 ;
"RTN","SAMICTC1",53,0)
 if key'["ce" do  ; all forms except ct eval form
"RTN","SAMICTC1",54,0)
 . set @TO@("cect1ch")=$get(@FROM@("cect1ch"))
"RTN","SAMICTC1",55,0)
 . set @TO@("cect2ch")=$get(@FROM@("cect2ch"))
"RTN","SAMICTC1",56,0)
 . set @TO@("cect3ch")=$get(@FROM@("cect3ch"))
"RTN","SAMICTC1",57,0)
 . set @TO@("cect4ch")=$get(@FROM@("cect4ch"))
"RTN","SAMICTC1",58,0)
 . set @TO@("cect5ch")=$get(@FROM@("cect5ch"))
"RTN","SAMICTC1",59,0)
 . set @TO@("cect6ch")=$get(@FROM@("cect6ch"))
"RTN","SAMICTC1",60,0)
 . set @TO@("cect7ch")=$get(@FROM@("cect7ch"))
"RTN","SAMICTC1",61,0)
 . set @TO@("cect8ch")=$get(@FROM@("cect8ch"))
"RTN","SAMICTC1",62,0)
 . set @TO@("cect9ch")=$get(@FROM@("cect9ch"))
"RTN","SAMICTC1",63,0)
 . quit
"RTN","SAMICTC1",64,0)
 ;
"RTN","SAMICTC1",65,0)
 else  do  ;
"RTN","SAMICTC1",66,0)
 . new cei,isnew,savals
"RTN","SAMICTC1",67,0)
 . set savals("pw")="" ; Prev seen, resolved
"RTN","SAMICTC1",68,0)
 . set savals("px")="" ; Prev seen, not a nodule 
"RTN","SAMICTC1",69,0)
 . set savals("pr")="" ; Prev seen, resected
"RTN","SAMICTC1",70,0)
 . set savals("pk")="" ; Not in outside report
"RTN","SAMICTC1",71,0)
 . set savals("pv")="" ; Not included in scan
"RTN","SAMICTC1",72,0)
 . for cei=1:1:9 do  ;
"RTN","SAMICTC1",73,0)
 . . set isnew=$get(@FROM@("cect"_cei_"ch"))
"RTN","SAMICTC1",74,0)
 . . if $data(savals(isnew)) set @TO@("cect"_cei_"ch")=isnew
"RTN","SAMICTC1",75,0)
 . . quit
"RTN","SAMICTC1",76,0)
 . quit
"RTN","SAMICTC1",77,0)
 ;
"RTN","SAMICTC1",78,0)
 ;
"RTN","SAMICTC1",79,0)
 ;@stanza 3 copy most fields
"RTN","SAMICTC1",80,0)
 ;
"RTN","SAMICTC1",81,0)
 ; the following is generated from a graph - see GENCTCOPY below
"RTN","SAMICTC1",82,0)
 set @TO@("ceanod")=$get(@FROM@("ceanod")) ; 
"RTN","SAMICTC1",83,0)
 set @TO@("cennod")=$get(@FROM@("cennod")) ; 
"RTN","SAMICTC1",84,0)
 ;
"RTN","SAMICTC1",85,0)
 set @TO@("cect1en")=$get(@FROM@("cect1en")) ; Endobronchial
"RTN","SAMICTC1",86,0)
 set @TO@("cect2en")=$get(@FROM@("cect2en")) ; Endobronchial
"RTN","SAMICTC1",87,0)
 set @TO@("cect3en")=$get(@FROM@("cect3en")) ; Endobronchial
"RTN","SAMICTC1",88,0)
 set @TO@("cect4en")=$get(@FROM@("cect4en")) ; Endobronchial
"RTN","SAMICTC1",89,0)
 set @TO@("cect5en")=$get(@FROM@("cect5en")) ; Endobronchial
"RTN","SAMICTC1",90,0)
 set @TO@("cect6en")=$get(@FROM@("cect6en")) ; Endobronchial
"RTN","SAMICTC1",91,0)
 set @TO@("cect7en")=$get(@FROM@("cect7en")) ; Endobronchial
"RTN","SAMICTC1",92,0)
 set @TO@("cect8en")=$get(@FROM@("cect8en")) ; Endobronchial
"RTN","SAMICTC1",93,0)
 set @TO@("cect9en")=$get(@FROM@("cect9en")) ; Endobronchial
"RTN","SAMICTC1",94,0)
 set @TO@("cect10en")=$get(@FROM@("cect10en")) ; Endobronchial
"RTN","SAMICTC1",95,0)
 ;
"RTN","SAMICTC1",96,0)
 set @TO@("cect1ll")=$get(@FROM@("cect1ll")) ; Most likely location
"RTN","SAMICTC1",97,0)
 set @TO@("cect2ll")=$get(@FROM@("cect2ll")) ; Most likely location
"RTN","SAMICTC1",98,0)
 set @TO@("cect3ll")=$get(@FROM@("cect3ll")) ; Most likely location
"RTN","SAMICTC1",99,0)
 set @TO@("cect4ll")=$get(@FROM@("cect4ll")) ; Most likely location
"RTN","SAMICTC1",100,0)
 set @TO@("cect5ll")=$get(@FROM@("cect5ll")) ; Most likely location
"RTN","SAMICTC1",101,0)
 set @TO@("cect6ll")=$get(@FROM@("cect6ll")) ; Most likely location
"RTN","SAMICTC1",102,0)
 set @TO@("cect7ll")=$get(@FROM@("cect7ll")) ; Most likely location
"RTN","SAMICTC1",103,0)
 set @TO@("cect8ll")=$get(@FROM@("cect8ll")) ; Most likely location
"RTN","SAMICTC1",104,0)
 set @TO@("cect9ll")=$get(@FROM@("cect9ll")) ; Most likely location
"RTN","SAMICTC1",105,0)
 set @TO@("cect10ll")=$get(@FROM@("cect10ll")) ; Most likely location
"RTN","SAMICTC1",106,0)
 ;
"RTN","SAMICTC1",107,0)
 set @TO@("cect1sn")=$get(@FROM@("cect1sn")) ; CT Series Number
"RTN","SAMICTC1",108,0)
 set @TO@("cect2sn")=$get(@FROM@("cect2sn")) ; CT Series Number
"RTN","SAMICTC1",109,0)
 set @TO@("cect3sn")=$get(@FROM@("cect3sn")) ; CT Series Number
"RTN","SAMICTC1",110,0)
 set @TO@("cect4sn")=$get(@FROM@("cect4sn")) ; CT Series Number
"RTN","SAMICTC1",111,0)
 set @TO@("cect5sn")=$get(@FROM@("cect5sn")) ; CT Series Number
"RTN","SAMICTC1",112,0)
 set @TO@("cect6sn")=$get(@FROM@("cect6sn")) ; CT Series Number
"RTN","SAMICTC1",113,0)
 set @TO@("cect7sn")=$get(@FROM@("cect7sn")) ; CT Series Number
"RTN","SAMICTC1",114,0)
 set @TO@("cect8sn")=$get(@FROM@("cect8sn")) ; CT Series Number
"RTN","SAMICTC1",115,0)
 set @TO@("cect9sn")=$get(@FROM@("cect9sn")) ; CT Series Number
"RTN","SAMICTC1",116,0)
 set @TO@("cect10sn")=$get(@FROM@("cect10sn")) ; CT Series Number
"RTN","SAMICTC1",117,0)
 ;
"RTN","SAMICTC1",118,0)
 set @TO@("cect1inl")=$get(@FROM@("cect1inl")) ; CT Image Number (Low
"RTN","SAMICTC1",119,0)
 set @TO@("cect1inh")=$get(@FROM@("cect1inh")) ; CT Image Number (Hig
"RTN","SAMICTC1",120,0)
 set @TO@("cect2inl")=$get(@FROM@("cect2inl")) ; CT Image Number (Low
"RTN","SAMICTC1",121,0)
 set @TO@("cect2inh")=$get(@FROM@("cect2inh")) ; CT Image Number (Hig
"RTN","SAMICTC1",122,0)
 set @TO@("cect3inl")=$get(@FROM@("cect3inl")) ; CT Image Number (Low
"RTN","SAMICTC1",123,0)
 set @TO@("cect3inh")=$get(@FROM@("cect3inh")) ; CT Image Number (Hig
"RTN","SAMICTC1",124,0)
 set @TO@("cect4inl")=$get(@FROM@("cect4inl")) ; CT Image Number (Low
"RTN","SAMICTC1",125,0)
 set @TO@("cect4inh")=$get(@FROM@("cect4inh")) ; CT Image Number (Hig
"RTN","SAMICTC1",126,0)
 set @TO@("cect5inl")=$get(@FROM@("cect5inl")) ; CT Image Number (Low
"RTN","SAMICTC1",127,0)
 set @TO@("cect5inh")=$get(@FROM@("cect5inh")) ; CT Image Number (Hig
"RTN","SAMICTC1",128,0)
 set @TO@("cect6inl")=$get(@FROM@("cect6inl")) ; CT Image Number (Low
"RTN","SAMICTC1",129,0)
 set @TO@("cect6inh")=$get(@FROM@("cect6inh")) ; CT Image Number (Hig
"RTN","SAMICTC1",130,0)
 set @TO@("cect7inl")=$get(@FROM@("cect7inl")) ; CT Image Number (Low
"RTN","SAMICTC1",131,0)
 set @TO@("cect7inh")=$get(@FROM@("cect7inh")) ; CT Image Number (Hig
"RTN","SAMICTC1",132,0)
 set @TO@("cect8inl")=$get(@FROM@("cect8inl")) ; CT Image Number (Low
"RTN","SAMICTC1",133,0)
 set @TO@("cect8inh")=$get(@FROM@("cect8inh")) ; CT Image Number (Hig
"RTN","SAMICTC1",134,0)
 set @TO@("cect9inl")=$get(@FROM@("cect9inl")) ; CT Image Number (Low
"RTN","SAMICTC1",135,0)
 set @TO@("cect9inh")=$get(@FROM@("cect9inh")) ; CT Image Number (Hig
"RTN","SAMICTC1",136,0)
 set @TO@("cect10inl")=$get(@FROM@("cect10inl")) ; CT Image Number (Low
"RTN","SAMICTC1",137,0)
 set @TO@("cect10inh")=$get(@FROM@("cect10inh")) ; CT Image Number (Hig
"RTN","SAMICTC1",138,0)
 ;
"RTN","SAMICTC1",139,0)
 set @TO@("cect1st")=$get(@FROM@("cect1st")) ; Nodule status
"RTN","SAMICTC1",140,0)
 set @TO@("cect2st")=$get(@FROM@("cect2st")) ; Nodule status
"RTN","SAMICTC1",141,0)
 set @TO@("cect3st")=$get(@FROM@("cect3st")) ; Nodule status
"RTN","SAMICTC1",142,0)
 set @TO@("cect4st")=$get(@FROM@("cect4st")) ; Nodule status
"RTN","SAMICTC1",143,0)
 set @TO@("cect5st")=$get(@FROM@("cect5st")) ; Nodule status
"RTN","SAMICTC1",144,0)
 set @TO@("cect6st")=$get(@FROM@("cect6st")) ; Nodule status
"RTN","SAMICTC1",145,0)
 set @TO@("cect7st")=$get(@FROM@("cect7st")) ; Nodule status
"RTN","SAMICTC1",146,0)
 set @TO@("cect8st")=$get(@FROM@("cect8st")) ; Nodule status
"RTN","SAMICTC1",147,0)
 set @TO@("cect9st")=$get(@FROM@("cect9st")) ; Nodule status
"RTN","SAMICTC1",148,0)
 set @TO@("cect10st")=$get(@FROM@("cect10st")) ; Nodule status
"RTN","SAMICTC1",149,0)
 ;
"RTN","SAMICTC1",150,0)
 set @TO@("cect1nt")=$get(@FROM@("cect1nt")) ; Nodule Consistency
"RTN","SAMICTC1",151,0)
 set @TO@("cect2nt")=$get(@FROM@("cect2nt")) ; Nodule Consistency
"RTN","SAMICTC1",152,0)
 set @TO@("cect3nt")=$get(@FROM@("cect3nt")) ; Nodule Consistency
"RTN","SAMICTC1",153,0)
 set @TO@("cect4nt")=$get(@FROM@("cect4nt")) ; Nodule Consistency
"RTN","SAMICTC1",154,0)
 set @TO@("cect5nt")=$get(@FROM@("cect5nt")) ; Nodule Consistency
"RTN","SAMICTC1",155,0)
 set @TO@("cect6nt")=$get(@FROM@("cect6nt")) ; Nodule Consistency
"RTN","SAMICTC1",156,0)
 set @TO@("cect7nt")=$get(@FROM@("cect7nt")) ; Nodule Consistency
"RTN","SAMICTC1",157,0)
 set @TO@("cect8nt")=$get(@FROM@("cect8nt")) ; Nodule Consistency
"RTN","SAMICTC1",158,0)
 set @TO@("cect9nt")=$get(@FROM@("cect9nt")) ; Nodule Consistency
"RTN","SAMICTC1",159,0)
 set @TO@("cect10nt")=$get(@FROM@("cect10nt")) ; Nodule Consistency
"RTN","SAMICTC1",160,0)
 ;
"RTN","SAMICTC1",161,0)
 set @TO@("cect1sl")=$get(@FROM@("cect1sl")) ; Length (mm)
"RTN","SAMICTC1",162,0)
 set @TO@("cect2sl")=$get(@FROM@("cect2sl")) ; Length (mm)
"RTN","SAMICTC1",163,0)
 set @TO@("cect3sl")=$get(@FROM@("cect3sl")) ; Length (mm)
"RTN","SAMICTC1",164,0)
 set @TO@("cect4sl")=$get(@FROM@("cect4sl")) ; Length (mm)
"RTN","SAMICTC1",165,0)
 set @TO@("cect5sl")=$get(@FROM@("cect5sl")) ; Length (mm)
"RTN","SAMICTC1",166,0)
 set @TO@("cect6sl")=$get(@FROM@("cect6sl")) ; Length (mm)
"RTN","SAMICTC1",167,0)
 set @TO@("cect7sl")=$get(@FROM@("cect7sl")) ; Length (mm)
"RTN","SAMICTC1",168,0)
 set @TO@("cect8sl")=$get(@FROM@("cect8sl")) ; Length (mm)
"RTN","SAMICTC1",169,0)
 set @TO@("cect9sl")=$get(@FROM@("cect9sl")) ; Length (mm)
"RTN","SAMICTC1",170,0)
 set @TO@("cect10sl")=$get(@FROM@("cect10sl")) ; Length (mm)
"RTN","SAMICTC1",171,0)
 ;
"RTN","SAMICTC1",172,0)
 set @TO@("cect1sw")=$get(@FROM@("cect1sw")) ; Maximum Width
"RTN","SAMICTC1",173,0)
 set @TO@("cect2sw")=$get(@FROM@("cect2sw")) ; Maximum Width
"RTN","SAMICTC1",174,0)
 set @TO@("cect3sw")=$get(@FROM@("cect3sw")) ; Maximum Width
"RTN","SAMICTC1",175,0)
 set @TO@("cect4sw")=$get(@FROM@("cect4sw")) ; Maximum Width
"RTN","SAMICTC1",176,0)
 set @TO@("cect5sw")=$get(@FROM@("cect5sw")) ; Maximum Width
"RTN","SAMICTC1",177,0)
 set @TO@("cect6sw")=$get(@FROM@("cect6sw")) ; Maximum Width
"RTN","SAMICTC1",178,0)
 set @TO@("cect7sw")=$get(@FROM@("cect7sw")) ; Maximum Width
"RTN","SAMICTC1",179,0)
 set @TO@("cect8sw")=$get(@FROM@("cect8sw")) ; Maximum Width
"RTN","SAMICTC1",180,0)
 set @TO@("cect9sw")=$get(@FROM@("cect9sw")) ; Maximum Width
"RTN","SAMICTC1",181,0)
 set @TO@("cect10sw")=$get(@FROM@("cect10sw")) ; Maximum Width
"RTN","SAMICTC1",182,0)
 ;
"RTN","SAMICTC1",183,0)
 set @TO@("cect1sh")=$get(@FROM@("cect1sh")) ; Height
"RTN","SAMICTC1",184,0)
 set @TO@("cect2sh")=$get(@FROM@("cect2sh")) ; Height
"RTN","SAMICTC1",185,0)
 set @TO@("cect3sh")=$get(@FROM@("cect3sh")) ; Height
"RTN","SAMICTC1",186,0)
 set @TO@("cect4sh")=$get(@FROM@("cect4sh")) ; Height
"RTN","SAMICTC1",187,0)
 set @TO@("cect5sh")=$get(@FROM@("cect5sh")) ; Height
"RTN","SAMICTC1",188,0)
 set @TO@("cect6sh")=$get(@FROM@("cect6sh")) ; Height
"RTN","SAMICTC1",189,0)
 set @TO@("cect7sh")=$get(@FROM@("cect7sh")) ; Height
"RTN","SAMICTC1",190,0)
 set @TO@("cect8sh")=$get(@FROM@("cect8sh")) ; Height
"RTN","SAMICTC1",191,0)
 set @TO@("cect9sh")=$get(@FROM@("cect9sh")) ; Height
"RTN","SAMICTC1",192,0)
 set @TO@("cect10sh")=$get(@FROM@("cect10sh")) ; Height
"RTN","SAMICTC1",193,0)
 ;
"RTN","SAMICTC1",194,0)
 set @TO@("cect1sv")=$get(@FROM@("cect1sv")) ; Volume
"RTN","SAMICTC1",195,0)
 set @TO@("cect2sv")=$get(@FROM@("cect2sv")) ; Volume
"RTN","SAMICTC1",196,0)
 set @TO@("cect3sv")=$get(@FROM@("cect3sv")) ; Volume
"RTN","SAMICTC1",197,0)
 set @TO@("cect4sv")=$get(@FROM@("cect4sv")) ; Volume
"RTN","SAMICTC1",198,0)
 set @TO@("cect5sv")=$get(@FROM@("cect5sv")) ; Volume
"RTN","SAMICTC1",199,0)
 set @TO@("cect6sv")=$get(@FROM@("cect6sv")) ; Volume
"RTN","SAMICTC1",200,0)
 set @TO@("cect7sv")=$get(@FROM@("cect7sv")) ; Volume
"RTN","SAMICTC1",201,0)
 set @TO@("cect8sv")=$get(@FROM@("cect8sv")) ; Volume
"RTN","SAMICTC1",202,0)
 set @TO@("cect9sv")=$get(@FROM@("cect9sv")) ; Volume
"RTN","SAMICTC1",203,0)
 set @TO@("cect10sv")=$get(@FROM@("cect10sv")) ; Volume
"RTN","SAMICTC1",204,0)
 ;
"RTN","SAMICTC1",205,0)
 set @TO@("cect1ssl")=$get(@FROM@("cect1ssl")) ; Solid Comp. Length
"RTN","SAMICTC1",206,0)
 set @TO@("cect1ssw")=$get(@FROM@("cect1ssw")) ; Solid Comp. Width
"RTN","SAMICTC1",207,0)
 set @TO@("cect2ssl")=$get(@FROM@("cect2ssl")) ; Solid Comp. Length
"RTN","SAMICTC1",208,0)
 set @TO@("cect2ssw")=$get(@FROM@("cect2ssw")) ; Solid Comp. Width
"RTN","SAMICTC1",209,0)
 set @TO@("cect3ssl")=$get(@FROM@("cect3ssl")) ; Solid Comp. Length
"RTN","SAMICTC1",210,0)
 set @TO@("cect3ssw")=$get(@FROM@("cect3ssw")) ; Solid Comp. Width
"RTN","SAMICTC1",211,0)
 set @TO@("cect4ssl")=$get(@FROM@("cect4ssl")) ; Solid Comp. Length
"RTN","SAMICTC1",212,0)
 set @TO@("cect4ssw")=$get(@FROM@("cect4ssw")) ; Solid Comp. Width
"RTN","SAMICTC1",213,0)
 set @TO@("cect5ssl")=$get(@FROM@("cect5ssl")) ; Solid Comp. Length
"RTN","SAMICTC1",214,0)
 set @TO@("cect5ssw")=$get(@FROM@("cect5ssw")) ; Solid Comp. Width
"RTN","SAMICTC1",215,0)
 set @TO@("cect6ssl")=$get(@FROM@("cect6ssl")) ; Solid Comp. Length
"RTN","SAMICTC1",216,0)
 set @TO@("cect6ssw")=$get(@FROM@("cect6ssw")) ; Solid Comp. Width
"RTN","SAMICTC1",217,0)
 set @TO@("cect7ssl")=$get(@FROM@("cect7ssl")) ; Solid Comp. Length
"RTN","SAMICTC1",218,0)
 set @TO@("cect7ssw")=$get(@FROM@("cect7ssw")) ; Solid Comp. Width
"RTN","SAMICTC1",219,0)
 set @TO@("cect8ssl")=$get(@FROM@("cect8ssl")) ; Solid Comp. Length
"RTN","SAMICTC1",220,0)
 set @TO@("cect8ssw")=$get(@FROM@("cect8ssw")) ; Solid Comp. Width
"RTN","SAMICTC1",221,0)
 set @TO@("cect9ssl")=$get(@FROM@("cect9ssl")) ; Solid Comp. Length
"RTN","SAMICTC1",222,0)
 set @TO@("cect9ssw")=$get(@FROM@("cect9ssw")) ; Solid Comp. Width
"RTN","SAMICTC1",223,0)
 set @TO@("cect10ssl")=$get(@FROM@("cect10ssl")) ; Solid Comp. Length
"RTN","SAMICTC1",224,0)
 set @TO@("cect10ssw")=$get(@FROM@("cect10ssw")) ; Solid Comp. Width
"RTN","SAMICTC1",225,0)
 ;
"RTN","SAMICTC1",226,0)
 set @TO@("cect1se")=$get(@FROM@("cect1se")) ; n
"RTN","SAMICTC1",227,0)
 set @TO@("cect1se")=$get(@FROM@("cect1se")) ;                 No
"RTN","SAMICTC1",228,0)
 set @TO@("cect2se")=$get(@FROM@("cect2se")) ; n
"RTN","SAMICTC1",229,0)
 set @TO@("cect2se")=$get(@FROM@("cect2se")) ;                 No
"RTN","SAMICTC1",230,0)
 set @TO@("cect3se")=$get(@FROM@("cect3se")) ; n
"RTN","SAMICTC1",231,0)
 set @TO@("cect3se")=$get(@FROM@("cect3se")) ;                 No
"RTN","SAMICTC1",232,0)
 set @TO@("cect4se")=$get(@FROM@("cect4se")) ; n
"RTN","SAMICTC1",233,0)
 set @TO@("cect4se")=$get(@FROM@("cect4se")) ;                 No
"RTN","SAMICTC1",234,0)
 set @TO@("cect5se")=$get(@FROM@("cect5se")) ; n
"RTN","SAMICTC1",235,0)
 set @TO@("cect5se")=$get(@FROM@("cect5se")) ;                 No
"RTN","SAMICTC1",236,0)
 set @TO@("cect6se")=$get(@FROM@("cect6se")) ; n
"RTN","SAMICTC1",237,0)
 set @TO@("cect6se")=$get(@FROM@("cect6se")) ;                 No
"RTN","SAMICTC1",238,0)
 set @TO@("cect7se")=$get(@FROM@("cect7se")) ; n
"RTN","SAMICTC1",239,0)
 set @TO@("cect7se")=$get(@FROM@("cect7se")) ;                 No
"RTN","SAMICTC1",240,0)
 set @TO@("cect8se")=$get(@FROM@("cect8se")) ; n
"RTN","SAMICTC1",241,0)
 set @TO@("cect8se")=$get(@FROM@("cect8se")) ;                 No
"RTN","SAMICTC1",242,0)
 set @TO@("cect9se")=$get(@FROM@("cect9se")) ; n
"RTN","SAMICTC1",243,0)
 set @TO@("cect9se")=$get(@FROM@("cect9se")) ;                 No
"RTN","SAMICTC1",244,0)
 set @TO@("cect10se")=$get(@FROM@("cect10se")) ; n
"RTN","SAMICTC1",245,0)
 set @TO@("cect10se")=$get(@FROM@("cect10se")) ;                 No
"RTN","SAMICTC1",246,0)
 ;
"RTN","SAMICTC1",247,0)
 set @TO@("cectin")=$get(@FROM@("cectin")) ; 1
"RTN","SAMICTC1",248,0)
 set @TO@("cectin")=$get(@FROM@("cectin")) ; 2
"RTN","SAMICTC1",249,0)
 ;
"RTN","SAMICTC1",250,0)
 set @TO@("cect1sp")=$get(@FROM@("cect1sp")) ; n
"RTN","SAMICTC1",251,0)
 set @TO@("cect1sp")=$get(@FROM@("cect1sp")) ;                 No
"RTN","SAMICTC1",252,0)
 set @TO@("cect2sp")=$get(@FROM@("cect2sp")) ; n
"RTN","SAMICTC1",253,0)
 set @TO@("cect2sp")=$get(@FROM@("cect2sp")) ;                 No
"RTN","SAMICTC1",254,0)
 set @TO@("cect3sp")=$get(@FROM@("cect3sp")) ; n
"RTN","SAMICTC1",255,0)
 set @TO@("cect3sp")=$get(@FROM@("cect3sp")) ;                 No
"RTN","SAMICTC1",256,0)
 set @TO@("cect4sp")=$get(@FROM@("cect4sp")) ; n
"RTN","SAMICTC1",257,0)
 set @TO@("cect4sp")=$get(@FROM@("cect4sp")) ;                 No
"RTN","SAMICTC1",258,0)
 set @TO@("cect5sp")=$get(@FROM@("cect5sp")) ; n
"RTN","SAMICTC1",259,0)
 set @TO@("cect5sp")=$get(@FROM@("cect5sp")) ;                 No
"RTN","SAMICTC1",260,0)
 set @TO@("cect6sp")=$get(@FROM@("cect6sp")) ; n
"RTN","SAMICTC1",261,0)
 set @TO@("cect6sp")=$get(@FROM@("cect6sp")) ;                 No
"RTN","SAMICTC1",262,0)
 set @TO@("cect7sp")=$get(@FROM@("cect7sp")) ; n
"RTN","SAMICTC1",263,0)
 set @TO@("cect7sp")=$get(@FROM@("cect7sp")) ;                 No
"RTN","SAMICTC1",264,0)
 set @TO@("cect8sp")=$get(@FROM@("cect8sp")) ; n
"RTN","SAMICTC1",265,0)
 set @TO@("cect8sp")=$get(@FROM@("cect8sp")) ;                 No
"RTN","SAMICTC1",266,0)
 set @TO@("cect9sp")=$get(@FROM@("cect9sp")) ; n
"RTN","SAMICTC1",267,0)
 set @TO@("cect9sp")=$get(@FROM@("cect9sp")) ;                 No
"RTN","SAMICTC1",268,0)
 set @TO@("cect10sp")=$get(@FROM@("cect10sp")) ; n
"RTN","SAMICTC1",269,0)
 set @TO@("cect10sp")=$get(@FROM@("cect10sp")) ;                 No
"RTN","SAMICTC1",270,0)
 ;
"RTN","SAMICTC1",271,0)
 set @TO@("cect1pld")=$get(@FROM@("cect1pld")) ; Distance
"RTN","SAMICTC1",272,0)
 set @TO@("cect2pld")=$get(@FROM@("cect2pld")) ; Distance
"RTN","SAMICTC1",273,0)
 set @TO@("cect3pld")=$get(@FROM@("cect3pld")) ; Distance
"RTN","SAMICTC1",274,0)
 set @TO@("cect4pld")=$get(@FROM@("cect4pld")) ; Distance
"RTN","SAMICTC1",275,0)
 set @TO@("cect5pld")=$get(@FROM@("cect5pld")) ; Distance
"RTN","SAMICTC1",276,0)
 set @TO@("cect6pld")=$get(@FROM@("cect6pld")) ; Distance
"RTN","SAMICTC1",277,0)
 set @TO@("cect7pld")=$get(@FROM@("cect7pld")) ; Distance
"RTN","SAMICTC1",278,0)
 set @TO@("cect8pld")=$get(@FROM@("cect8pld")) ; Distance
"RTN","SAMICTC1",279,0)
 set @TO@("cect9pld")=$get(@FROM@("cect9pld")) ; Distance
"RTN","SAMICTC1",280,0)
 set @TO@("cect10pld")=$get(@FROM@("cect10pld")) ; Distance
"RTN","SAMICTC1",281,0)
 ;
"RTN","SAMICTC1",282,0)
 set @TO@("cect1co")=$get(@FROM@("cect1co")) ; Comment
"RTN","SAMICTC1",283,0)
 set @TO@("cect2co")=$get(@FROM@("cect2co")) ; Comment
"RTN","SAMICTC1",284,0)
 set @TO@("cect3co")=$get(@FROM@("cect3co")) ; Comment
"RTN","SAMICTC1",285,0)
 set @TO@("cect4co")=$get(@FROM@("cect4co")) ; Comment
"RTN","SAMICTC1",286,0)
 set @TO@("cect5co")=$get(@FROM@("cect5co")) ; Comment
"RTN","SAMICTC1",287,0)
 set @TO@("cect6co")=$get(@FROM@("cect6co")) ; Comment
"RTN","SAMICTC1",288,0)
 set @TO@("cect7co")=$get(@FROM@("cect7co")) ; Comment
"RTN","SAMICTC1",289,0)
 set @TO@("cect8co")=$get(@FROM@("cect8co")) ; Comment
"RTN","SAMICTC1",290,0)
 set @TO@("cect9co")=$get(@FROM@("cect9co")) ; Comment
"RTN","SAMICTC1",291,0)
 set @TO@("cect10co")=$get(@FROM@("cect10co")) ; Comment
"RTN","SAMICTC1",292,0)
 ;
"RTN","SAMICTC1",293,0)
 set @TO@("cect1pd")=$get(@FROM@("cect1pd")) ; Pathologic diagnosis
"RTN","SAMICTC1",294,0)
 set @TO@("cect2pd")=$get(@FROM@("cect2pd")) ; Pathologic diagnosis
"RTN","SAMICTC1",295,0)
 set @TO@("cect3pd")=$get(@FROM@("cect3pd")) ; Pathologic diagnosis
"RTN","SAMICTC1",296,0)
 set @TO@("cect4pd")=$get(@FROM@("cect4pd")) ; Pathologic diagnosis
"RTN","SAMICTC1",297,0)
 set @TO@("cect5pd")=$get(@FROM@("cect5pd")) ; Pathologic diagnosis
"RTN","SAMICTC1",298,0)
 set @TO@("cect6pd")=$get(@FROM@("cect6pd")) ; Pathologic diagnosis
"RTN","SAMICTC1",299,0)
 set @TO@("cect7pd")=$get(@FROM@("cect7pd")) ; Pathologic diagnosis
"RTN","SAMICTC1",300,0)
 set @TO@("cect8pd")=$get(@FROM@("cect8pd")) ; Pathologic diagnosis
"RTN","SAMICTC1",301,0)
 set @TO@("cect9pd")=$get(@FROM@("cect9pd")) ; Pathologic diagnosis
"RTN","SAMICTC1",302,0)
 set @TO@("cect10pd")=$get(@FROM@("cect10pd")) ; Pathologic diagnosis
"RTN","SAMICTC1",303,0)
 ;
"RTN","SAMICTC1",304,0)
 set @TO@("cectancn")=$get(@FROM@("cectancn")) ; 1
"RTN","SAMICTC1",305,0)
 set @TO@("cectacn")=$get(@FROM@("cectacn")) ; 1
"RTN","SAMICTC1",306,0)
 ;
"RTN","SAMICTC1",307,0)
 set @TO@("ceem")=$get(@FROM@("ceem")) ; nv
"RTN","SAMICTC1",308,0)
 set @TO@("ceem")=$get(@FROM@("ceem")) ; no
"RTN","SAMICTC1",309,0)
 ;
"RTN","SAMICTC1",310,0)
 set @TO@("ceoca")=$get(@FROM@("ceoca")) ; n
"RTN","SAMICTC1",311,0)
 set @TO@("ceoca")=$get(@FROM@("ceoca")) ; y
"RTN","SAMICTC1",312,0)
 ;
"RTN","SAMICTC1",313,0)
 set @TO@("ceccv")=$get(@FROM@("ceccv")) ; e
"RTN","SAMICTC1",314,0)
 set @TO@("cecclm")=$get(@FROM@("cecclm")) ;               Left m
"RTN","SAMICTC1",315,0)
 set @TO@("ceccld")=$get(@FROM@("ceccld")) ;               LAD
"RTN","SAMICTC1",316,0)
 set @TO@("cecccf")=$get(@FROM@("cecccf")) ;               Circum
"RTN","SAMICTC1",317,0)
 set @TO@("ceccrc")=$get(@FROM@("ceccrc")) ;               RCA
"RTN","SAMICTC1",318,0)
 ;
"RTN","SAMICTC1",319,0)
 set @TO@("pa")=$get(@FROM@("pa")) ; n
"RTN","SAMICTC1",320,0)
 set @TO@("pa")=$get(@FROM@("pa")) ;            No
"RTN","SAMICTC1",321,0)
 ;
"RTN","SAMICTC1",322,0)
 ;
"RTN","SAMICTC1",323,0)
 ;@stanza 4 continue copy in 2nd routine
"RTN","SAMICTC1",324,0)
 ;
"RTN","SAMICTC1",325,0)
 do CTCOPY2^SAMICTC2(FROM,TO)
"RTN","SAMICTC1",326,0)
 ;
"RTN","SAMICTC1",327,0)
 ;
"RTN","SAMICTC1",328,0)
 ;@stanza 5 termination
"RTN","SAMICTC1",329,0)
 ;
"RTN","SAMICTC1",330,0)
 quit  ; end of ppi CTCOPY^SAMICTC1
"RTN","SAMICTC1",331,0)
 ;
"RTN","SAMICTC1",332,0)
 ;
"RTN","SAMICTC1",333,0)
 ;
"RTN","SAMICTC1",334,0)
 ;@dmi GENCTCOPY^SAMICTC1
"RTN","SAMICTC1",335,0)
GENCTCPY ; generate copy routine from graph
"RTN","SAMICTC1",336,0)
 ;
"RTN","SAMICTC1",337,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTC1",338,0)
 ;
"RTN","SAMICTC1",339,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICTC1",340,0)
 ;@called-by SAMI developer from direct mode
"RTN","SAMICTC1",341,0)
 ;@calls
"RTN","SAMICTC1",342,0)
 ; $$setroot^%wd
"RTN","SAMICTC1",343,0)
 ;@input
"RTN","SAMICTC1",344,0)
 ; ceform-fields graph
"RTN","SAMICTC1",345,0)
 ;@output
"RTN","SAMICTC1",346,0)
 ; writes compiled code to current device
"RTN","SAMICTC1",347,0)
 ;
"RTN","SAMICTC1",348,0)
 ;
"RTN","SAMICTC1",349,0)
 ;@stanza 2 compile code to copy most fields
"RTN","SAMICTC1",350,0)
 ;
"RTN","SAMICTC1",351,0)
 new root set root=$$setroot^%wd("ceform-fields")
"RTN","SAMICTC1",352,0)
 new fldf set fldf=$name(@root@("field"))
"RTN","SAMICTC1",353,0)
 ;
"RTN","SAMICTC1",354,0)
 write !,"generating copy from ",fldf
"RTN","SAMICTC1",355,0)
 ;
"RTN","SAMICTC1",356,0)
 new zi set zi=0
"RTN","SAMICTC1",357,0)
 for  do  quit:'zi
"RTN","SAMICTC1",358,0)
 . set zi=$order(@fldf@(zi))
"RTN","SAMICTC1",359,0)
 . quit:'zi
"RTN","SAMICTC1",360,0)
 . ;
"RTN","SAMICTC1",361,0)
 . quit:$get(@fldf@(zi,"copy"))'=1  ; only want copy fields
"RTN","SAMICTC1",362,0)
 . ;
"RTN","SAMICTC1",363,0)
 . new name,label
"RTN","SAMICTC1",364,0)
 . set name=$get(@fldf@(zi,"name"))
"RTN","SAMICTC1",365,0)
 . set label=$get(@fldf@(zi,"label"))
"RTN","SAMICTC1",366,0)
 . set label=$extract(label,1,20)
"RTN","SAMICTC1",367,0)
 . quit:name=""
"RTN","SAMICTC1",368,0)
 . ;
"RTN","SAMICTC1",369,0)
 . write !," set @TO@("""_name_""")=$get(@FROM@("""_name_""")) ; "_label
"RTN","SAMICTC1",370,0)
 . quit
"RTN","SAMICTC1",371,0)
 ;
"RTN","SAMICTC1",372,0)
 ;
"RTN","SAMICTC1",373,0)
 ;@stanza 3 termination
"RTN","SAMICTC1",374,0)
 ;
"RTN","SAMICTC1",375,0)
 quit  ; end of dmi GENCTCOPY^SAMICTC1
"RTN","SAMICTC1",376,0)
 ;
"RTN","SAMICTC1",377,0)
 ;
"RTN","SAMICTC1",378,0)
 ;
"RTN","SAMICTC1",379,0)
EOR ; end of routine SAMICTC1
"RTN","SAMICTT0")
0^11^B97674764
"RTN","SAMICTT0",1,0)
SAMICTT0 ;ven/gpl - ctreport text main ;2021-05-21T20:47Z
"RTN","SAMICTT0",2,0)
 ;;18.0;SAMI;**4,10,11**;2020-01;Build 19
"RTN","SAMICTT0",3,0)
 ;;1.18.0.11+i11
"RTN","SAMICTT0",4,0)
 ;
"RTN","SAMICTT0",5,0)
 ; SAMICTT0 contains a web route & associated subroutines to produce
"RTN","SAMICTT0",6,0)
 ; the ELCAP CT Report in text format (route ctreport, format text).
"RTN","SAMICTT0",7,0)
 ; SAMICTT* routines serve web service interfaces WSVAPALS^SAMIHOM3
"RTN","SAMICTT0",8,0)
 ; (the main VAPALS-ELCAP post web service) & WSHOME^SAMIHOM3 (the
"RTN","SAMICTT0",9,0)
 ; VAPALS-ELCAP home-page service).
"RTN","SAMICTT0",10,0)
 ;
"RTN","SAMICTT0",11,0)
 quit  ; no entry from top
"RTN","SAMICTT0",12,0)
 ;
"RTN","SAMICTT0",13,0)
 ;
"RTN","SAMICTT0",14,0)
 ;
"RTN","SAMICTT0",15,0)
 ;@section 0 primary development
"RTN","SAMICTT0",16,0)
 ;
"RTN","SAMICTT0",17,0)
 ;
"RTN","SAMICTT0",18,0)
 ;
"RTN","SAMICTT0",19,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT0",20,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT0",21,0)
 ;@contents
"RTN","SAMICTT0",22,0)
 ; WSREPORT web route: ctreport in text format
"RTN","SAMICTT0",23,0)
 ; OUT output a line of ct report
"RTN","SAMICTT0",24,0)
 ; OUTOLD old version of out
"RTN","SAMICTT0",25,0)
 ; HOUT output a ct report header line
"RTN","SAMICTT0",26,0)
 ; $$XVAL patient value for var
"RTN","SAMICTT0",27,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTT0",28,0)
 ; GETFILTR fill in the filter for Ct Eval for sid
"RTN","SAMICTT0",29,0)
 ; T1 test
"RTN","SAMICTT0",30,0)
 ;
"RTN","SAMICTT0",31,0)
 ;
"RTN","SAMICTT0",32,0)
 ;
"RTN","SAMICTT0",33,0)
 ;@section 1 wsi WSREPORT & related subroutines
"RTN","SAMICTT0",34,0)
 ;
"RTN","SAMICTT0",35,0)
 ;
"RTN","SAMICTT0",36,0)
 ;
"RTN","SAMICTT0",37,0)
 ;@wsr WSREPORT^SAMICTT0
"RTN","SAMICTT0",38,0)
WSREPORT(return,filter) ; web route: ctreport in text format
"RTN","SAMICTT0",39,0)
 ;
"RTN","SAMICTT0",40,0)
 ;@called-by
"RTN","SAMICTT0",41,0)
 ; WSNOTE^SAMINOT3
"RTN","SAMICTT0",42,0)
 ;  (called-by wsi WSVAPALS^SAMIHOM3)
"RTN","SAMICTT0",43,0)
 ;    (called by wsi WSHOME^SAMIHOM3)
"RTN","SAMICTT0",44,0)
 ;  (sibling to wri WSREPORT^SAMICTR0, keep in sync)
"RTN","SAMICTT0",45,0)
 ;@calls
"RTN","SAMICTT0",46,0)
 ; INIT2GPH^SAMICTD2
"RTN","SAMICTT0",47,0)
 ; $$setroot^%wd
"RTN","SAMICTT0",48,0)
 ; $$XVAL
"RTN","SAMICTT0",49,0)
 ; OUT
"RTN","SAMICTT0",50,0)
 ; $$XSUB
"RTN","SAMICTT0",51,0)
 ; HOUT
"RTN","SAMICTT0",52,0)
 ; NODULES^SAMICTT1
"RTN","SAMICTT0",53,0)
 ; OTHRLUNG^SAMICTT2
"RTN","SAMICTT0",54,0)
 ; EMPHYS^SAMICTT3
"RTN","SAMICTT0",55,0)
 ; BREAST^SAMICTT4
"RTN","SAMICTT0",56,0)
 ; IMPRSN^SAMICTT9
"RTN","SAMICTT0",57,0)
 ; RCMND^SAMICTTA
"RTN","SAMICTT0",58,0)
 ;
"RTN","SAMICTT0",59,0)
 s debug=0
"RTN","SAMICTT0",60,0)
 n outmode s outmode="go"
"RTN","SAMICTT0",61,0)
 n line s line=""
"RTN","SAMICTT0",62,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMICTT0",63,0)
 ;
"RTN","SAMICTT0",64,0)
 ;s rtn=$na(^TMP("SAMICTT",$J))
"RTN","SAMICTT0",65,0)
 s rtn="return"
"RTN","SAMICTT0",66,0)
 k @rtn
"RTN","SAMICTT0",67,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMICTT0",68,0)
 ;
"RTN","SAMICTT0",69,0)
 n cnt s cnt=0 ; line number
"RTN","SAMICTT0",70,0)
 ;
"RTN","SAMICTT0",71,0)
 ; set up dictionary and patient values
"RTN","SAMICTT0",72,0)
 ;
"RTN","SAMICTT0",73,0)
 n dict,vals
"RTN","SAMICTT0",74,0)
 ;d INIT^SAMICTD2("dict")
"RTN","SAMICTT0",75,0)
 s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT0",76,0)
 s dict=$na(@dict@("cteval-dict"))
"RTN","SAMICTT0",77,0)
 i $g(@dict@("pet"))="" d INIT2GPH^SAMICTD2 ; init dictionary 1st time
"RTN","SAMICTT0",78,0)
 n si
"RTN","SAMICTT0",79,0)
 s si=$g(filter("studyid"))
"RTN","SAMICTT0",80,0)
 i si="" d  ;
"RTN","SAMICTT0",81,0)
 . s si="XXX00102"
"RTN","SAMICTT0",82,0)
 q:si=""
"RTN","SAMICTT0",83,0)
 n samikey
"RTN","SAMICTT0",84,0)
 s samikey=$g(filter("form"))
"RTN","SAMICTT0",85,0)
 i samikey="" d  ;
"RTN","SAMICTT0",86,0)
 . s samikey="ceform-2018-10-09"
"RTN","SAMICTT0",87,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICTT0",88,0)
 i $g(filter("studyid"))="" s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICTT0",89,0)
 s vals=$na(@root@("graph",si,samikey))
"RTN","SAMICTT0",90,0)
 ;W !,vals
"RTN","SAMICTT0",91,0)
 ;zwr @vals@(*)
"RTN","SAMICTT0",92,0)
 i '$d(@vals) d  q  ;
"RTN","SAMICTT0",93,0)
 . w !,"error, patient values not found"
"RTN","SAMICTT0",94,0)
 ;
"RTN","SAMICTT0",95,0)
 ; report parameters
"RTN","SAMICTT0",96,0)
 ;
"RTN","SAMICTT0",97,0)
 n nt,sectionheader,dummy,cac,tex,para,legout
"RTN","SAMICTT0",98,0)
 ;; n lang,lanread
"RTN","SAMICTT0",99,0)
 ;
"RTN","SAMICTT0",100,0)
 s nt=1
"RTN","SAMICTT0",101,0)
 s sectionheader=1
"RTN","SAMICTT0",102,0)
 ;;s dummy="******"
"RTN","SAMICTT0",103,0)
 s cac=""
"RTN","SAMICTT0",104,0)
 n cacrec s cacrec=""
"RTN","SAMICTT0",105,0)
 ;;s tex=0
"RTN","SAMICTT0",106,0)
 ;s para="<p>"
"RTN","SAMICTT0",107,0)
 ;s para=$char(13,10)
"RTN","SAMICTT0",108,0)
 s para=""
"RTN","SAMICTT0",109,0)
 ;;s legout=0
"RTN","SAMICTT0",110,0)
 n qheader s qheader=0
"RTN","SAMICTT0",111,0)
 ;
"RTN","SAMICTT0",112,0)
 n lang s lang=""
"RTN","SAMICTT0",113,0)
 n langread s langread=0
"RTN","SAMICTT0",114,0)
 ;
"RTN","SAMICTT0",115,0)
 n auth s auth("perm")="a"
"RTN","SAMICTT0",116,0)
 s auth("inst")=$g(filter("auth"))
"RTN","SAMICTT0",117,0)
 ;
"RTN","SAMICTT0",118,0)
 n newct s newct=0
"RTN","SAMICTT0",119,0)
 i $$XVAL("ceoppa",vals)'="" s newct=1
"RTN","SAMICTT0",120,0)
 ;
"RTN","SAMICTT0",121,0)
 n registryForm s registryForm=0
"RTN","SAMICTT0",122,0)
 i $$XVAL("ceaf",vals)'="" s registryForm=1
"RTN","SAMICTT0",123,0)
 ;
"RTN","SAMICTT0",124,0)
 ;d OUT("<HTML>")
"RTN","SAMICTT0",125,0)
 ;d OUT("<HEAD>")
"RTN","SAMICTT0",126,0)
 ;d OUT("<!-- Calling TR: CT Evaluation Report -->")
"RTN","SAMICTT0",127,0)
 ;d OUT("<TITLE>CT Evaluation Report</TITLE>")
"RTN","SAMICTT0",128,0)
 ;d OUT("<link rel='stylesheet' href='/css/report.css'>")
"RTN","SAMICTT0",129,0)
 ;d OUT("</HEAD>")
"RTN","SAMICTT0",130,0)
 ;d OUT("<BODY BGCOLOR=""#ffffff"" TEXT=""#000000"">")
"RTN","SAMICTT0",131,0)
 ;;d OUT("<TABLE border=""0"" cellspacing=""0"" cellpadding=""3"" WIDTH=""640""><TR><TD>")
"RTN","SAMICTT0",132,0)
 ;d OUT("<FONT SIZE=""+2""><CENTER>")
"RTN","SAMICTT0",133,0)
 ;d OUT("<!-- Calling TR: CT Evaluation Report -->")
"RTN","SAMICTT0",134,0)
 ;d OUT("<B>CT Evaluation Report</B>")
"RTN","SAMICTT0",135,0)
 d OUT("CT Evaluation Report")
"RTN","SAMICTT0",136,0)
 ;d OUT("</CENTER></FONT>")
"RTN","SAMICTT0",137,0)
 ;d OUT("</TD></TR><TR><TD>")
"RTN","SAMICTT0",138,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT0",139,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT0",140,0)
 ;
"RTN","SAMICTT0",141,0)
 ;d OUT("<!-- patient information -->")
"RTN","SAMICTT0",142,0)
 ;d OUT("<TR><TD><TABLE border=""0"" cellspacing=""0"" cellpadding=""3"" WIDTH=""640"">")
"RTN","SAMICTT0",143,0)
 ;
"RTN","SAMICTT0",144,0)
 ; generate header
"RTN","SAMICTT0",145,0)
 ;
"RTN","SAMICTT0",146,0)
 d  ;
"RTN","SAMICTT0",147,0)
 . n pname
"RTN","SAMICTT0",148,0)
 . ;s pname=$$XVAL("sinamel",vals)_", "_$$XVAL("sinamef",vals)
"RTN","SAMICTT0",149,0)
 . s pname=$$XVAL("saminame",vals)
"RTN","SAMICTT0",150,0)
 . d OUT("Participant Name: "_pname)
"RTN","SAMICTT0",151,0)
 ;d OUT("<TR><TD WIDTH=""180""><B>Participant Name:</B></TD><TD WIDTH=""365"">")
"RTN","SAMICTT0",152,0)
 ;d OUT($$XVAL("sinamel",vals)_", "_$$XVAL("sinamef",vals))
"RTN","SAMICTT0",153,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",154,0)
 ;
"RTN","SAMICTT0",155,0)
 d  ;
"RTN","SAMICTT0",156,0)
 . n sid s sid=$$XVAL("sisid",vals)
"RTN","SAMICTT0",157,0)
 . d OUT("Study ID: "_sid)
"RTN","SAMICTT0",158,0)
 ;d OUT("<TD WIDTH=""120""><B>Study ID:</B></TD><TD WIDTH=""75"">")
"RTN","SAMICTT0",159,0)
 ;d OUT($$XVAL("sisid",vals))
"RTN","SAMICTT0",160,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",161,0)
 ;
"RTN","SAMICTT0",162,0)
 d  ;
"RTN","SAMICTT0",163,0)
 . n etype s etype=$$XSUB("cetex",vals,dict)_" "_$$XSUB("cectp",vals,dict)
"RTN","SAMICTT0",164,0)
 . d OUT("Type of Examination: "_etype)
"RTN","SAMICTT0",165,0)
 ;d OUT("<TR><TD><B>Type of Examination:</B></TD><TD>")
"RTN","SAMICTT0",166,0)
 ;d OUT($$XSUB("cetex",vals,dict)_" "_$$XSUB("cectp",vals,dict))
"RTN","SAMICTT0",167,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",168,0)
 ;d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",169,0)
 ;
"RTN","SAMICTT0",170,0)
 d  ;
"RTN","SAMICTT0",171,0)
 . n edate s edate=$$XVAL("cedos",vals)
"RTN","SAMICTT0",172,0)
 . d OUT("Examination Date: "_edate)
"RTN","SAMICTT0",173,0)
 ;d OUT("<TR><TD><B>Examination Date:</B></TD><TD>")
"RTN","SAMICTT0",174,0)
 ;d OUT($$XVAL("cedos",vals))
"RTN","SAMICTT0",175,0)
 ;
"RTN","SAMICTT0",176,0)
 ;i $$XVAL("sidob",vals)'=-1 d  ;
"RTN","SAMICTT0",177,0)
 ;. d OUT("<TD><B>Date of Birth:</B></TD><TD>")
"RTN","SAMICTT0",178,0)
 ;. d OUT($$XVAL("sidob",vals))
"RTN","SAMICTT0",179,0)
 ;e  d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",180,0)
 ;
"RTN","SAMICTT0",181,0)
 d  ;
"RTN","SAMICTT0",182,0)
 . n dob s dob=$$XVAL("sidob",vals)
"RTN","SAMICTT0",183,0)
 . i dob>0 d OUT("Date of Birth: "_dob)
"RTN","SAMICTT0",184,0)
 . d OUT("")
"RTN","SAMICTT0",185,0)
 ;i $$XVAL("sidob",vals)>0 d  ;
"RTN","SAMICTT0",186,0)
 ;. d OUT("<TD><B>Date of Birth:</B></TD><TD>")
"RTN","SAMICTT0",187,0)
 ;. d OUT($$XVAL("sidob",vals))
"RTN","SAMICTT0",188,0)
 ;. d OUT("</TD></TR>")
"RTN","SAMICTT0",189,0)
 ;e  d  ;
"RTN","SAMICTT0",190,0)
 ;. d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",191,0)
 ;
"RTN","SAMICTT0",192,0)
 ;# End of Header
"RTN","SAMICTT0",193,0)
 ;
"RTN","SAMICTT0",194,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTT0",195,0)
 ;;d OUT("</TD></TR><TR><TD>")
"RTN","SAMICTT0",196,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT0",197,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT0",198,0)
 ;d OUT("<!-- report -->")
"RTN","SAMICTT0",199,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTT0",200,0)
 ;d OUT("<FONT SIZE=""+2""><B>")
"RTN","SAMICTT0",201,0)
 ;d OUT("Report:")
"RTN","SAMICTT0",202,0)
 ;d OUT("</B></FONT>")
"RTN","SAMICTT0",203,0)
 ;d OUT("</TD></TR><TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTT0",204,0)
 d OUT("Report:")
"RTN","SAMICTT0",205,0)
 ;
"RTN","SAMICTT0",206,0)
 s outmode="hold"
"RTN","SAMICTT0",207,0)
 s line=""
"RTN","SAMICTT0",208,0)
 i $$XVAL("ceclin",vals)'="" d  ;
"RTN","SAMICTT0",209,0)
 . d HOUT("Clinical Information: ")
"RTN","SAMICTT0",210,0)
 . d OUT($$XVAL("ceclin",vals))
"RTN","SAMICTT0",211,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT0",212,0)
 ;
"RTN","SAMICTT0",213,0)
 s outmode="hold"
"RTN","SAMICTT0",214,0)
 n nopri s nopri=1
"RTN","SAMICTT0",215,0)
 d HOUT("Comparison CT Scans: ")
"RTN","SAMICTT0",216,0)
 if $$XVAL("cedcs",vals)'="" d  ;
"RTN","SAMICTT0",217,0)
 . d OUT($$XSUB("cetex",vals,dict)_". ")
"RTN","SAMICTT0",218,0)
 . d OUT("Comparisons: "_$$XVAL("cedcs",vals))
"RTN","SAMICTT0",219,0)
 . s nopri=0
"RTN","SAMICTT0",220,0)
 if $$XVAL("cedps",vals)'="" d  ;
"RTN","SAMICTT0",221,0)
 . d OUT(" "_$$XVAL("cedps",vals))
"RTN","SAMICTT0",222,0)
 . s nopri=0
"RTN","SAMICTT0",223,0)
 d:nopri OUT("None")
"RTN","SAMICTT0",224,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT0",225,0)
 ;
"RTN","SAMICTT0",226,0)
 s outmode="hold"
"RTN","SAMICTT0",227,0)
 d HOUT(" Description: ")
"RTN","SAMICTT0",228,0)
 i $$XVAL("cectp",vals)="i" d  ;
"RTN","SAMICTT0",229,0)
 . d OUT("Limited Diagnostic CT examination was performed. ")
"RTN","SAMICTT0",230,0)
 e  d  ;
"RTN","SAMICTT0",231,0)
 . d OUT("CT examination of the entire thorax was performed at "_$$XSUB("cectp",vals,dict)_" settings. ")
"RTN","SAMICTT0",232,0)
 ;
"RTN","SAMICTT0",233,0)
 i $$XVAL("cectrst",vals)'="" d  ;
"RTN","SAMICTT0",234,0)
 . d OUT(" Images were obtained at "_$$XVAL("cectrst",vals)_" mm slice thickness. ")
"RTN","SAMICTT0",235,0)
 . d OUT(" Multiplanar reconstructions were performed. ")
"RTN","SAMICTT0",236,0)
 ;
"RTN","SAMICTT0",237,0)
 i newct d  ;
"RTN","SAMICTT0",238,0)
 . n nvadbo s nvadbo=1
"RTN","SAMICTT0",239,0)
 . n ii
"RTN","SAMICTT0",240,0)
 . f ii="ceoaa","ceaga","ceasa","ceala","ceapa","ceaaa","ceaka" d  ;
"RTN","SAMICTT0",241,0)
 . . i $$XVAL(ii,vals)="y" set nvadbo=0
"RTN","SAMICTT0",242,0)
 . ;
"RTN","SAMICTT0",243,0)
 . i nvadbo=1 d  ;
"RTN","SAMICTT0",244,0)
 . . d OUT("Upper abdominal images were not acquired on the current scan due to its limited nature. ")
"RTN","SAMICTT0",245,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT0",246,0)
 ;
"RTN","SAMICTT0",247,0)
 ; lung nodules
"RTN","SAMICTT0",248,0)
 ;
"RTN","SAMICTT0",249,0)
 ;d OUT("")
"RTN","SAMICTT0",250,0)
 d HOUT("Lung Nodules:")
"RTN","SAMICTT0",251,0)
 ;d OUT("")
"RTN","SAMICTT0",252,0)
 ;
"RTN","SAMICTT0",253,0)
 ; see if there are any nodules using the cectXch fields
"RTN","SAMICTT0",254,0)
 ;
"RTN","SAMICTT0",255,0)
 n ij,hasnodules s hasnodules=0
"RTN","SAMICTT0",256,0)
 f ij=1:1:10 i ($$XVAL("cect"_ij_"ch",vals)'="")&($$XVAL("cect"_ij_"ch",vals)'="-") s hasnodules=1
"RTN","SAMICTT0",257,0)
 ;
"RTN","SAMICTT0",258,0)
 ; check for small nodule checkboxes
"RTN","SAMICTT0",259,0)
 i $$XVAL("cectancn",vals)=1 s hasnodules=1
"RTN","SAMICTT0",260,0)
 i $$XVAL("cectacn",vals)=1 s hasnodules=1
"RTN","SAMICTT0",261,0)
 ;
"RTN","SAMICTT0",262,0)
 i hasnodules=0 d  ;
"RTN","SAMICTT0",263,0)
 . d OUT(para)
"RTN","SAMICTT0",264,0)
 . d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",265,0)
 ;
"RTN","SAMICTT0",266,0)
 ;i $$XVAL("cennod",vals)="" d  ;
"RTN","SAMICTT0",267,0)
 ;. d OUT(para)
"RTN","SAMICTT0",268,0)
 ;. d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",269,0)
 ;e  i $$XVAL("ceanod",vals)="n" d  ;
"RTN","SAMICTT0",270,0)
 ;. d OUT(para)
"RTN","SAMICTT0",271,0)
 ;. d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",272,0)
 ;
"RTN","SAMICTT0",273,0)
 d NODULES^SAMICTT1(rtn,.vals,.dict)
"RTN","SAMICTT0",274,0)
 ;
"RTN","SAMICTT0",275,0)
 d OTHRLUNG^SAMICTT2(rtn,.vals,.dict)
"RTN","SAMICTT0",276,0)
 ;
"RTN","SAMICTT0",277,0)
 d EMPHYS^SAMICTT3(rtn,.vals,.dict)
"RTN","SAMICTT0",278,0)
 ;
"RTN","SAMICTT0",279,0)
 d BREAST^SAMICTT4(rtn,.vals,.dict)
"RTN","SAMICTT0",280,0)
 ;
"RTN","SAMICTT0",281,0)
 d IMPRSN^SAMICTT9(rtn,.vals,.dict)
"RTN","SAMICTT0",282,0)
 ;
"RTN","SAMICTT0",283,0)
 d RCMND^SAMICTTA(rtn,.vals,.dict)
"RTN","SAMICTT0",284,0)
 ;
"RTN","SAMICTT0",285,0)
 ; etc etc
"RTN","SAMICTT0",286,0)
 ;
"RTN","SAMICTT0",287,0)
 d  ;
"RTN","SAMICTT0",288,0)
 . d OUT("References:")
"RTN","SAMICTT0",289,0)
 . d OUT("Recommendations for nodules and other findings are detailed in the I-ELCAP Protocol. ")
"RTN","SAMICTT0",290,0)
 . d OUT("A summary and the full I-ELCAP protocol can be viewed at: http://ielcap.org/protocols")
"RTN","SAMICTT0",291,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTT0",292,0)
 ;d OUT("<p><br></p><p><b>References:</b><br></p>")
"RTN","SAMICTT0",293,0)
 ;d OUT("<p>Recommendations for nodules and other findings are detailed in the I-ELCAP Protocol.<BR>")
"RTN","SAMICTT0",294,0)
 ;d OUT("A summary and the full I-ELCAP protocol can be viewed at: <a href=""http://ielcap.org/protocols"">http://ielcap.org/protocols</a></p>")
"RTN","SAMICTT0",295,0)
 ;d OUT("</TD></TR></TABLE></TD></TR></TABLE>")
"RTN","SAMICTT0",296,0)
 ;s debug=1
"RTN","SAMICTT0",297,0)
 d:$g(debug)  ;
"RTN","SAMICTT0",298,0)
 . n zi s zi=""
"RTN","SAMICTT0",299,0)
 . f  s zi=$o(@vals@(zi)) q:zi=""  d  ;
"RTN","SAMICTT0",300,0)
 . . d OUT(zi_" "_$g(@vals@(zi)))
"RTN","SAMICTT0",301,0)
 ;d OUT("</BODY></HTML>")
"RTN","SAMICTT0",302,0)
 ;
"RTN","SAMICTT0",303,0)
 quit  ; end of wsr WSREPORT^SAMICTT0
"RTN","SAMICTT0",304,0)
 ;
"RTN","SAMICTT0",305,0)
 ;
"RTN","SAMICTT0",306,0)
 ;
"RTN","SAMICTT0",307,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT0",308,0)
 ;
"RTN","SAMICTT0",309,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT0",310,0)
 s cnt=cnt+1
"RTN","SAMICTT0",311,0)
 n lnn
"RTN","SAMICTT0",312,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT0",313,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",314,0)
 i outmode="go" d  ;
"RTN","SAMICTT0",315,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT0",316,0)
 . s line=""
"RTN","SAMICTT0",317,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",318,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT0",319,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT0",320,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT0",321,0)
 . n zs s zs=$STACK
"RTN","SAMICTT0",322,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT0",323,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT0",324,0)
 ;
"RTN","SAMICTT0",325,0)
 quit  ; end of OUT
"RTN","SAMICTT0",326,0)
 ;
"RTN","SAMICTT0",327,0)
 ;
"RTN","SAMICTT0",328,0)
 ;
"RTN","SAMICTT0",329,0)
OUTOLD(ln) ; old version of out
"RTN","SAMICTT0",330,0)
 ;
"RTN","SAMICTT0",331,0)
 s cnt=cnt+1
"RTN","SAMICTT0",332,0)
 n lnn
"RTN","SAMICTT0",333,0)
 ;s debug=1
"RTN","SAMICTT0",334,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",335,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT0",336,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT0",337,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT0",338,0)
 . n zs s zs=$STACK
"RTN","SAMICTT0",339,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT0",340,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT0",341,0)
 ;
"RTN","SAMICTT0",342,0)
 quit  ; end of OUTOLD
"RTN","SAMICTT0",343,0)
 ;
"RTN","SAMICTT0",344,0)
 ;
"RTN","SAMICTT0",345,0)
 ;
"RTN","SAMICTT0",346,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTT0",347,0)
 ;
"RTN","SAMICTT0",348,0)
 d OUT(ln)
"RTN","SAMICTT0",349,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT0",350,0)
 ;
"RTN","SAMICTT0",351,0)
 quit  ; end of HOUT
"RTN","SAMICTT0",352,0)
 ;
"RTN","SAMICTT0",353,0)
 ;
"RTN","SAMICTT0",354,0)
 ;
"RTN","SAMICTT0",355,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT0",356,0)
 ;
"RTN","SAMICTT0",357,0)
 ;@input
"RTN","SAMICTT0",358,0)
 ; @vals is passed by name
"RTN","SAMICTT0",359,0)
 ;
"RTN","SAMICTT0",360,0)
 n zr
"RTN","SAMICTT0",361,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT0",362,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT0",363,0)
 ;
"RTN","SAMICTT0",364,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT0",365,0)
 ;
"RTN","SAMICTT0",366,0)
 ;
"RTN","SAMICTT0",367,0)
 ;
"RTN","SAMICTT0",368,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT0",369,0)
 ;
"RTN","SAMICTT0",370,0)
 ; vals and dict are passed by name
"RTN","SAMICTT0",371,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT0",372,0)
 ;
"RTN","SAMICTT0",373,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT0",374,0)
 n zr,zv,zdx
"RTN","SAMICTT0",375,0)
 s zdx=$g(valdx)
"RTN","SAMICTT0",376,0)
 i zdx="" s zdx=var
"RTN","SAMICTT0",377,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT0",378,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT0",379,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT0",380,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT0",381,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT0",382,0)
 ;
"RTN","SAMICTT0",383,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT0",384,0)
 ;
"RTN","SAMICTT0",385,0)
 ;
"RTN","SAMICTT0",386,0)
 ;
"RTN","SAMICTT0",387,0)
GETFILTR(filter,sid) ; fill in the filter for Ct Eval for sid
"RTN","SAMICTT0",388,0)
 ;
"RTN","SAMICTT0",389,0)
 s filter("studyid")=sid
"RTN","SAMICTT0",390,0)
 n items,zform
"RTN","SAMICTT0",391,0)
 d GETITEMS^SAMICASE("items",sid)
"RTN","SAMICTT0",392,0)
 s zform=$o(items("ceform"))
"RTN","SAMICTT0",393,0)
 s filter("form")=zform
"RTN","SAMICTT0",394,0)
 ;zwr filter
"RTN","SAMICTT0",395,0)
 ;
"RTN","SAMICTT0",396,0)
 quit  ; end of GETFILTR
"RTN","SAMICTT0",397,0)
 ;
"RTN","SAMICTT0",398,0)
 ;
"RTN","SAMICTT0",399,0)
 ;
"RTN","SAMICTT0",400,0)
T1(grtn,debug) ; test
"RTN","SAMICTT0",401,0)
 ;
"RTN","SAMICTT0",402,0)
 n filter
"RTN","SAMICTT0",403,0)
 ;n sid s sid="XXX00333"
"RTN","SAMICTT0",404,0)
 ;n sid s sid="XXX00484"
"RTN","SAMICTT0",405,0)
 n sid s sid="XXX9000001"
"RTN","SAMICTT0",406,0)
 d GETFILTR(.filter,sid)
"RTN","SAMICTT0",407,0)
 i $g(debug)=1 s filter("debug")=1
"RTN","SAMICTT0",408,0)
 d WSNOTE^SAMINOT3(.grtn,.filter)
"RTN","SAMICTT0",409,0)
 ;d WSREPORT^SAMICTT0(.grtn,.filter)
"RTN","SAMICTT0",410,0)
 ;
"RTN","SAMICTT0",411,0)
 quit  ; end of T1
"RTN","SAMICTT0",412,0)
 ;
"RTN","SAMICTT0",413,0)
 ;
"RTN","SAMICTT0",414,0)
 ;
"RTN","SAMICTT0",415,0)
EOR ; end of routine SAMICTT0
"RTN","SAMICTT1")
0^10^B122873178
"RTN","SAMICTT1",1,0)
SAMICTT1 ;ven/gpl - ctreport text nodules ;2021-05-21T20:47Z
"RTN","SAMICTT1",2,0)
 ;;18.0;SAMI;**4,10,11**;2020-01;Build 19
"RTN","SAMICTT1",3,0)
 ;;1.18.0.11+i11
"RTN","SAMICTT1",4,0)
 ;
"RTN","SAMICTT1",5,0)
 ; SAMICTT1 creates the Nodules section of the ELCAP CT Report in text
"RTN","SAMICTT1",6,0)
 ; format.
"RTN","SAMICTT1",7,0)
 ;
"RTN","SAMICTT1",8,0)
 quit  ; no entry from top
"RTN","SAMICTT1",9,0)
 ;
"RTN","SAMICTT1",10,0)
 ;
"RTN","SAMICTT1",11,0)
 ;
"RTN","SAMICTT1",12,0)
 ;@section 0 primary development
"RTN","SAMICTT1",13,0)
 ;
"RTN","SAMICTT1",14,0)
 ;
"RTN","SAMICTT1",15,0)
 ;
"RTN","SAMICTT1",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT1",17,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT1",18,0)
 ;@contents
"RTN","SAMICTT1",19,0)
 ; NODULES nodules section of ctreport in text format
"RTN","SAMICTT1",20,0)
 ; OUT output a line of ct report
"RTN","SAMICTT1",21,0)
 ; HOUT output a ct report header line
"RTN","SAMICTT1",22,0)
 ; $$XVAL patient value for var
"RTN","SAMICTT1",23,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTT1",24,0)
 ;
"RTN","SAMICTT1",25,0)
 ;
"RTN","SAMICTT1",26,0)
 ;
"RTN","SAMICTT1",27,0)
 ;@section 1 NODULES & related subroutines
"RTN","SAMICTT1",28,0)
 ;
"RTN","SAMICTT1",29,0)
 ;
"RTN","SAMICTT1",30,0)
 ;
"RTN","SAMICTT1",31,0)
NODULES(rtn,vals,dict) ; nodules section of ctreport in text format
"RTN","SAMICTT1",32,0)
 ;
"RTN","SAMICTT1",33,0)
 ;@called-by
"RTN","SAMICTT1",34,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT1",35,0)
 ;@calls
"RTN","SAMICTT1",36,0)
 ; $$XVAL
"RTN","SAMICTT1",37,0)
 ; OUT
"RTN","SAMICTT1",38,0)
 ; $$XSUB
"RTN","SAMICTT1",39,0)
 ; HOUT
"RTN","SAMICTT1",40,0)
 ;@input
"RTN","SAMICTT1",41,0)
 ; rtn
"RTN","SAMICTT1",42,0)
 ; vals
"RTN","SAMICTT1",43,0)
 ; dict
"RTN","SAMICTT1",44,0)
 ;@output
"RTN","SAMICTT1",45,0)
 ; nodules section added to cteval report
"RTN","SAMICTT1",46,0)
 ;
"RTN","SAMICTT1",47,0)
 ;# Report on Nodules
"RTN","SAMICTT1",48,0)
 n firstitem
"RTN","SAMICTT1",49,0)
 set firstitem=0
"RTN","SAMICTT1",50,0)
 n outmode s outmode="hold"
"RTN","SAMICTT1",51,0)
 n line s line=""
"RTN","SAMICTT1",52,0)
 n ii set ii=1
"RTN","SAMICTT1",53,0)
 ;# Information for each nodule
"RTN","SAMICTT1",54,0)
 f ii=1:1:10 d  ;
"RTN","SAMICTT1",55,0)
 . i $$XSUB("cectch",vals,dict,"cect"_ii_"ch")="px" q  ;
"RTN","SAMICTT1",56,0)
 . i $$XSUB("cectch",vals,dict,"cect"_ii_"ch")="" q  ;
"RTN","SAMICTT1",57,0)
 . i firstitem=0 d  ;
"RTN","SAMICTT1",58,0)
 . . ;d OUT("<!-- begin nodule info -->")
"RTN","SAMICTT1",59,0)
 . . ;d OUT("<UL TYPE=disc>")
"RTN","SAMICTT1",60,0)
 . . set firstitem=1
"RTN","SAMICTT1",61,0)
 . ;
"RTN","SAMICTT1",62,0)
 . ;d OUT("<LI>")
"RTN","SAMICTT1",63,0)
 . n specialcase s specialcase=0
"RTN","SAMICTT1",64,0)
 . n ij,ik
"RTN","SAMICTT1",65,0)
 . s ik=$$XVAL("cect"_ii_"ch",vals)
"RTN","SAMICTT1",66,0)
 . ;f ij="pw","px","pr","pv" i ij=ik s specialcase=1
"RTN","SAMICTT1",67,0)
 . i "pwpxprpv"[ik s specialcase=1
"RTN","SAMICTT1",68,0)
 . ;
"RTN","SAMICTT1",69,0)
 . ;# Example Sentence
"RTN","SAMICTT1",70,0)
 . ;# LUL Nodule 1 is non-calcified, non-solid, 6 mm x 6 mm (with 3 x 3) solid component), smooth edge, previously seen and unchanged. (Series 2, Image 65)
"RTN","SAMICTT1",71,0)
 . ;# [LOCATION] Nodule [N] is [CALCIFICATION], [SOLID], [L] mm x mm, [SMOOTH], [NEW].  (Series [Series], Image [ImageNum]).
"RTN","SAMICTT1",72,0)
 . ;
"RTN","SAMICTT1",73,0)
 . n spic s spic=""
"RTN","SAMICTT1",74,0)
 . i $$XVAL("cect"_ii_"sp",vals)="y" s spic="spiculated, "
"RTN","SAMICTT1",75,0)
 . ;
"RTN","SAMICTT1",76,0)
 . n calcification,calcstr,status
"RTN","SAMICTT1",77,0)
 . s status=$$XVAL("cect"_ii_"st",vals)
"RTN","SAMICTT1",78,0)
 . s @vals@("cect"_ii_"ca")=$s(status="bc":"y",status="pc":"q",1:"n")
"RTN","SAMICTT1",79,0)
 . s calcification=$$XSUB("cectca",vals,dict,"cect"_ii_"ca")
"RTN","SAMICTT1",80,0)
 . i calcification="" s calcstr="is "_spic_$$XSUB("cectnt",vals,dict,"cect"_ii_"nt")_", "
"RTN","SAMICTT1",81,0)
 . e  s calcstr="is "_calcification_", "_spic_$$XSUB("cectnt",vals,dict,"cect"_ii_"nt")_", "
"RTN","SAMICTT1",82,0)
 . ;
"RTN","SAMICTT1",83,0)
 . n vssl,vssw,vsl,vsw,avgs,avgss
"RTN","SAMICTT1",84,0)
 . s (vssl,vssw,vsl,vsw,avgs,avgss)=0
"RTN","SAMICTT1",85,0)
 . s vssl=$$XVAL("cect"_ii_"ssl",vals)
"RTN","SAMICTT1",86,0)
 . i vssl'=0 d  ;
"RTN","SAMICTT1",87,0)
 . . s vssw=$$XVAL("cect"_ii_"ssw",vals)
"RTN","SAMICTT1",88,0)
 . . s avgss=(vssl+vssw)/2
"RTN","SAMICTT1",89,0)
 . . s avgss=$j(avgss,1,1)
"RTN","SAMICTT1",90,0)
 . s vsl=$$XVAL("cect"_ii_"sl",vals)
"RTN","SAMICTT1",91,0)
 . s vsw=$$XVAL("cect"_ii_"sw",vals)
"RTN","SAMICTT1",92,0)
 . s avgs=(vsl+vsw)/2
"RTN","SAMICTT1",93,0)
 . s avgs=$j(avgs,1,1)
"RTN","SAMICTT1",94,0)
 . n scomp
"RTN","SAMICTT1",95,0)
 . s scomp=""
"RTN","SAMICTT1",96,0)
 . i $$XVAL("cect"_ii_"ssl",vals)'="" d  ;
"RTN","SAMICTT1",97,0)
 . . ;s scomp=" (solid component "_$$XVAL("cect"_ii_"ssl",vals)_" mm x "_$$XVAL("cect"_ii_"ssw",vals)_" mm average diameter "_avgss_" mm)"
"RTN","SAMICTT1",98,0)
 . . s scomp=", solid component "_$$XVAL("cect"_ii_"ssl",vals)_" mm x "_$$XVAL("cect"_ii_"ssw",vals)_" mm (average diameter of "_avgss_" mm)"
"RTN","SAMICTT1",99,0)
 . ;
"RTN","SAMICTT1",100,0)
 . s calcstr=calcstr_$$XVAL("cect"_ii_"sl",vals)_" mm x "_$$XVAL("cect"_ii_"sw",vals)_" mm (average diameter of "_avgs_" mm)"_scomp_", "
"RTN","SAMICTT1",101,0)
 . ;
"RTN","SAMICTT1",102,0)
 . n smooth
"RTN","SAMICTT1",103,0)
 . ;s smooth=$$XSUB("cectse",vals,dict,"cect"_ii_"se")
"RTN","SAMICTT1",104,0)
 . s smooth=$$XVAL("cect"_ii_"se",vals)
"RTN","SAMICTT1",105,0)
 . i smooth="y" s calcstr=calcstr_"smooth edges, "
"RTN","SAMICTT1",106,0)
 . ;e  s calcstr=calcstr_smooth_" edges, " ;nothing if not smooth
"RTN","SAMICTT1",107,0)
 . ;
"RTN","SAMICTT1",108,0)
 . ; adding distance from costal pleura
"RTN","SAMICTT1",109,0)
 . n pldstr
"RTN","SAMICTT1",110,0)
 . s pldstr="within "_$$XVAL("cect"_ii_"pld",vals)_" mm of the costal pleura"
"RTN","SAMICTT1",111,0)
 . ;
"RTN","SAMICTT1",112,0)
 . n skip s skip=0
"RTN","SAMICTT1",113,0)
 . ;# 3 cases: parenchymal, endobronchial, and both
"RTN","SAMICTT1",114,0)
 . ;
"RTN","SAMICTT1",115,0)
 . n en,loc,nloc,endo,ll
"RTN","SAMICTT1",116,0)
 . s loc=""
"RTN","SAMICTT1",117,0)
 . s nloc=""
"RTN","SAMICTT1",118,0)
 . s en=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",119,0)
 . s ll=$$XVAL("cect"_ii_"ll",vals)
"RTN","SAMICTT1",120,0)
 . i ($l(en)<2)!(en="no")!(en="") d  ;
"RTN","SAMICTT1",121,0)
 . . ;# 1) parenchymal only
"RTN","SAMICTT1",122,0)
 . . n X,Y s X=ll
"RTN","SAMICTT1",123,0)
 . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",124,0)
 . . s loc=Y
"RTN","SAMICTT1",125,0)
 . . s nloc=Y
"RTN","SAMICTT1",126,0)
 . . s endo="Nodule"
"RTN","SAMICTT1",127,0)
 . e  d  ;
"RTN","SAMICTT1",128,0)
 . . i ll="end" d  ;
"RTN","SAMICTT1",129,0)
 . . . ;# 2) Endobronchial only
"RTN","SAMICTT1",130,0)
 . . . i en="tr" d  ;
"RTN","SAMICTT1",131,0)
 . . . . s endo="Endotracheal Nodule"
"RTN","SAMICTT1",132,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",133,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",134,0)
 . . . . e  d  ;
"RTN","SAMICTT1",135,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cectch"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",136,0)
 . . . . . . d OUT(endo_" "_ii_" "_calcstr_" is seen. ")
"RTN","SAMICTT1",137,0)
 . . . . . e  d OUT(endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",138,0)
 . . . . s skip=1
"RTN","SAMICTT1",139,0)
 . . . i en="rm" d  ;
"RTN","SAMICTT1",140,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",141,0)
 . . . . s nloc=$$XSUB("cecten",vals,dict,"cect"_ii_"en")
"RTN","SAMICTT1",142,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",143,0)
 . . . . . ;d OUT("Previously seen "_nloc_" "_endo_" "_ii_" ")
"RTN","SAMICTT1",144,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" in the "_nloc_" "_calcstr_" ")
"RTN","SAMICTT1",145,0)
 . . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",146,0)
 . . . . e  d  ;
"RTN","SAMICTT1",147,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",148,0)
 . . . . . . ;d OUT(nloc_" "_endo_" "_ii_". ")
"RTN","SAMICTT1",149,0)
 . . . . . . d OUT(endo_" "_ii_" is seen in the "_nloc_" "_calcstr_". ")
"RTN","SAMICTT1",150,0)
 . . . . . ;e  d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",151,0)
 . . . . . e  d OUT(endo_" "_ii_" in the "_nloc_" "_calcstr_", "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",152,0)
 . . . . s skip=1
"RTN","SAMICTT1",153,0)
 . . . i en="bi" d  ;
"RTN","SAMICTT1",154,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",155,0)
 . . . . s loc=$$XSUB("cecten",vals,dict,"cect"_ii_"en")
"RTN","SAMICTT1",156,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",157,0)
 . . . . . ;d OUT("Previously seen "_endo_" "_ii_" in the "_loc)
"RTN","SAMICTT1",158,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" in the "_nloc_" "_calcstr_" ")
"RTN","SAMICTT1",159,0)
 . . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",160,0)
 . . . . e  d  ;
"RTN","SAMICTT1",161,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",162,0)
 . . . . . . ;d OUT(endo_" "_ii_" is seen in the "_loc_". ")
"RTN","SAMICTT1",163,0)
 . . . . . . d OUT(endo_" "_ii_" is seen in the "_loc_" "_calcstr_". ")
"RTN","SAMICTT1",164,0)
 . . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",165,0)
 . . . . s skip=1
"RTN","SAMICTT1",166,0)
 . . . i skip=0 d  ; "default"
"RTN","SAMICTT1",167,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",168,0)
 . . . . n X,Y
"RTN","SAMICTT1",169,0)
 . . . . s X=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",170,0)
 . . . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",171,0)
 . . . . s nloc=Y
"RTN","SAMICTT1",172,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",173,0)
 . . . . . d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_", likely endobronchial. ")
"RTN","SAMICTT1",174,0)
 . . . . e  d  ;
"RTN","SAMICTT1",175,0)
 . . . . . ;i ($$XVAL("cetex",vals)="b")&($$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n") d  ;
"RTN","SAMICTT1",176,0)
 . . . . . i (($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n")) d  ; gpl 1002
"RTN","SAMICTT1",177,0)
 . . . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" likely endobronchial. ")
"RTN","SAMICTT1",178,0)
 . . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_" likely endobronchial. ")
"RTN","SAMICTT1",179,0)
 . . . . s skip=1
"RTN","SAMICTT1",180,0)
 . . e  d  ;
"RTN","SAMICTT1",181,0)
 . . . s endo="Nodule"
"RTN","SAMICTT1",182,0)
 . . . s loc=$$XSUB("cectll",vals,dict,"cect"_ii_"ll")
"RTN","SAMICTT1",183,0)
 . . . n X,Y
"RTN","SAMICTT1",184,0)
 . . . s X=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",185,0)
 . . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",186,0)
 . . . s nloc=Y
"RTN","SAMICTT1",187,0)
 . . . i specialcase=1 d  ;
"RTN","SAMICTT1",188,0)
 . . . . d OUT(nloc_" "_endo_" "_ii_" previously seen with possible endobronchial component")
"RTN","SAMICTT1",189,0)
 . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",190,0)
 . . . e  d  ;
"RTN","SAMICTT1",191,0)
 . . . . ;i ($$XVAL("cetex",vals)="b")&($$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n") d  ;
"RTN","SAMICTT1",192,0)
 . . . . i (($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n")) d  ; gpl 1002
"RTN","SAMICTT1",193,0)
 . . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" with possible endobronchial component")
"RTN","SAMICTT1",194,0)
 . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" with possible endobronchial component "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",195,0)
 . . . s skip=1
"RTN","SAMICTT1",196,0)
 . i specialcase=1 d  ;
"RTN","SAMICTT1",197,0)
 . . i skip=0 d  ;
"RTN","SAMICTT1",198,0)
 . . . d OUT("Previously seen "_nloc_" "_endo_" "_ii_" ")
"RTN","SAMICTT1",199,0)
 . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",200,0)
 . e  d  ;
"RTN","SAMICTT1",201,0)
 . . i skip=0 d  ;
"RTN","SAMICTT1",202,0)
 . . . ;# pleural distance only goes here
"RTN","SAMICTT1",203,0)
 . . . i $$XVAL("cect"_ii_"pld",vals)'="" s calcstr=calcstr_" "_pldstr_","
"RTN","SAMICTT1",204,0)
 . . . ;# Special Handling for "newly seen" on baseline
"RTN","SAMICTT1",205,0)
 . . . ;i ($$XVAL("cetex",vals)="b")&($$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n") d  ;
"RTN","SAMICTT1",206,0)
 . . . i (($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n")) d  ; gpl 1002
"RTN","SAMICTT1",207,0)
 . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr)
"RTN","SAMICTT1",208,0)
 . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_" ")
"RTN","SAMICTT1",209,0)
 . . d OUT(" (Series "_$$XVAL("cect"_ii_"sn",vals)_",") ; added from 1114 gpl1
"RTN","SAMICTT1",210,0)
 . . ;i $$XVAL("cect"_ii_"inl",vals)=$$XVAL("cect"_ii_"inh",vals) d  ;
"RTN","SAMICTT1",211,0)
 . . ;. d OUT(" image "_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",212,0)
 . . ;e  d  ;
"RTN","SAMICTT1",213,0)
 . . ;. d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",214,0)
 . . i $$XVAL("cect"_ii_"inh",vals)="" d  ;
"RTN","SAMICTT1",215,0)
 . . . d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_"). ")
"RTN","SAMICTT1",216,0)
 . . e  d  ;
"RTN","SAMICTT1",217,0)
 . . . d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_"-"_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",218,0)
 . . i $$XVAL("cect"_ii_"co",vals)'="" d OUT($$XVAL("cect"_ii_"co",vals)_". ") ;1122 gpl1
"RTN","SAMICTT1",219,0)
 . . n ac
"RTN","SAMICTT1",220,0)
 . . s ac=$$XVAL("cect"_ii_"ac",vals)
"RTN","SAMICTT1",221,0)
 . . i ac'="" i (ac'="-") i (ac'="s") d  ;
"RTN","SAMICTT1",222,0)
 . . . d OUT($$XSUB("cectac",vals,dict,"cect"_ii_"ac")_" recommended. ")
"RTN","SAMICTT1",223,0)
 . ;
"RTN","SAMICTT1",224,0)
 . ; end of nodule processing
"RTN","SAMICTT1",225,0)
 . ;
"RTN","SAMICTT1",226,0)
 . s outmode="go"
"RTN","SAMICTT1",227,0)
 . d OUT("")
"RTN","SAMICTT1",228,0)
 . s outmode="hold"
"RTN","SAMICTT1",229,0)
 i firstitem'=0 d  ;
"RTN","SAMICTT1",230,0)
 . ;d OUT("</UL>")
"RTN","SAMICTT1",231,0)
 . ;d OUT("<!-- end nodule info -->")
"RTN","SAMICTT1",232,0)
 ;d OUT("</p>")
"RTN","SAMICTT1",233,0)
 ;
"RTN","SAMICTT1",234,0)
 ; added 5/19/21 gpl
"RTN","SAMICTT1",235,0)
 s outmode="go"
"RTN","SAMICTT1",236,0)
 i $$XVAL("cectancn",vals)=1 d OUT("Small non-calcified nodules are present ")
"RTN","SAMICTT1",237,0)
 i $$XVAL("cectacn",vals)=1 d OUT("Small calcified nodules are present ")
"RTN","SAMICTT1",238,0)
 d OUT(" ")
"RTN","SAMICTT1",239,0)
 ;
"RTN","SAMICTT1",240,0)
 quit  ; end of NODULES
"RTN","SAMICTT1",241,0)
 ;
"RTN","SAMICTT1",242,0)
 ;
"RTN","SAMICTT1",243,0)
 ;
"RTN","SAMICTT1",244,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT1",245,0)
 ;
"RTN","SAMICTT1",246,0)
 ;@called-by
"RTN","SAMICTT1",247,0)
 ; NODULES
"RTN","SAMICTT1",248,0)
 ;@calls none
"RTN","SAMICTT1",249,0)
 ;@input
"RTN","SAMICTT1",250,0)
 ; ln = output to add
"RTN","SAMICTT1",251,0)
 ;@output
"RTN","SAMICTT1",252,0)
 ; line added to report
"RTN","SAMICTT1",253,0)
 ;
"RTN","SAMICTT1",254,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT1",255,0)
 s cnt=cnt+1
"RTN","SAMICTT1",256,0)
 n lnn
"RTN","SAMICTT1",257,0)
 ;s debug=1
"RTN","SAMICTT1",258,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT1",259,0)
 i outmode="go" d  ;
"RTN","SAMICTT1",260,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT1",261,0)
 . s line=""
"RTN","SAMICTT1",262,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT1",263,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT1",264,0)
 ;
"RTN","SAMICTT1",265,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT1",266,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT1",267,0)
 . n zs s zs=$STACK
"RTN","SAMICTT1",268,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT1",269,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT1",270,0)
 ;
"RTN","SAMICTT1",271,0)
 quit  ; end of OUT
"RTN","SAMICTT1",272,0)
 ;
"RTN","SAMICTT1",273,0)
 ;
"RTN","SAMICTT1",274,0)
 ;
"RTN","SAMICTT1",275,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTT1",276,0)
 ;
"RTN","SAMICTT1",277,0)
 ;@called-by
"RTN","SAMICTT1",278,0)
 ; NODULES
"RTN","SAMICTT1",279,0)
 ;@calls
"RTN","SAMICTT1",280,0)
 ; OUT
"RTN","SAMICTT1",281,0)
 ;@input
"RTN","SAMICTT1",282,0)
 ; ln = header output to add
"RTN","SAMICTT1",283,0)
 ;@output
"RTN","SAMICTT1",284,0)
 ; header line added to report
"RTN","SAMICTT1",285,0)
 ;
"RTN","SAMICTT1",286,0)
 d OUT(ln)
"RTN","SAMICTT1",287,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT1",288,0)
 ;
"RTN","SAMICTT1",289,0)
 quit  ; end of HOUT
"RTN","SAMICTT1",290,0)
 ;
"RTN","SAMICTT1",291,0)
 ;
"RTN","SAMICTT1",292,0)
 ;
"RTN","SAMICTT1",293,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT1",294,0)
 ;
"RTN","SAMICTT1",295,0)
 ;@called-by
"RTN","SAMICTT1",296,0)
 ; NODULES
"RTN","SAMICTT1",297,0)
 ;@calls none
"RTN","SAMICTT1",298,0)
 ;@input
"RTN","SAMICTT1",299,0)
 ; val
"RTN","SAMICTT1",300,0)
 ; vals is passed by name
"RTN","SAMICTT1",301,0)
 ;@output = patient value for var
"RTN","SAMICTT1",302,0)
 ;
"RTN","SAMICTT1",303,0)
 n zr
"RTN","SAMICTT1",304,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT1",305,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT1",306,0)
 ;
"RTN","SAMICTT1",307,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT1",308,0)
 ;
"RTN","SAMICTT1",309,0)
 ;
"RTN","SAMICTT1",310,0)
 ;
"RTN","SAMICTT1",311,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT1",312,0)
 ;
"RTN","SAMICTT1",313,0)
 ;@called-by
"RTN","SAMICTT1",314,0)
 ; NODULES
"RTN","SAMICTT1",315,0)
 ;@calls none
"RTN","SAMICTT1",316,0)
 ;@input
"RTN","SAMICTT1",317,0)
 ; val
"RTN","SAMICTT1",318,0)
 ; vals and dict are passed by name
"RTN","SAMICTT1",319,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT1",320,0)
 ;@output = dictionary value for var
"RTN","SAMICTT1",321,0)
 ;
"RTN","SAMICTT1",322,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT1",323,0)
 n zr,zv,zdx
"RTN","SAMICTT1",324,0)
 s zdx=$g(valdx)
"RTN","SAMICTT1",325,0)
 i zdx="" s zdx=var
"RTN","SAMICTT1",326,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT1",327,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT1",328,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT1",329,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT1",330,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT1",331,0)
 ;
"RTN","SAMICTT1",332,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT1",333,0)
 ;
"RTN","SAMICTT1",334,0)
 ;
"RTN","SAMICTT1",335,0)
 ;
"RTN","SAMICTT1",336,0)
EOR ; end of routine SAMICTT1
"RTN","SAMICTTA")
0^9^B35698365
"RTN","SAMICTTA",1,0)
SAMICTTA ;ven/gpl - ctreport text recommendations ;2021-05-21T20:47Z
"RTN","SAMICTTA",2,0)
 ;;18.0;SAMI;**4,10,11**;2020-01;Build 19
"RTN","SAMICTTA",3,0)
 ;;1.18.0.11+i11
"RTN","SAMICTTA",4,0)
 ;
"RTN","SAMICTTA",5,0)
 ; SAMICTTA creates the Recommendations section of the ELCAP CT Report
"RTN","SAMICTTA",6,0)
 ; in text format.
"RTN","SAMICTTA",7,0)
 ;
"RTN","SAMICTTA",8,0)
 quit  ; no entry from top
"RTN","SAMICTTA",9,0)
 ;
"RTN","SAMICTTA",10,0)
 ;
"RTN","SAMICTTA",11,0)
 ;
"RTN","SAMICTTA",12,0)
 ;@section 0 primary development
"RTN","SAMICTTA",13,0)
 ;
"RTN","SAMICTTA",14,0)
 ;
"RTN","SAMICTTA",15,0)
 ;
"RTN","SAMICTTA",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICTTA",17,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTTA",18,0)
 ;@contents
"RTN","SAMICTTA",19,0)
 ; RCMND recommendations section of ctreport in text format
"RTN","SAMICTTA",20,0)
 ; OUT output a line of ct report
"RTN","SAMICTTA",21,0)
 ; HOUT output a ct report header line
"RTN","SAMICTTA",22,0)
 ; $$XVAL patient value for var
"RTN","SAMICTTA",23,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTTA",24,0)
 ;
"RTN","SAMICTTA",25,0)
 ;
"RTN","SAMICTTA",26,0)
 ;
"RTN","SAMICTTA",27,0)
 ;@section 1 RCMND & related subroutines
"RTN","SAMICTTA",28,0)
 ;
"RTN","SAMICTTA",29,0)
 ;
"RTN","SAMICTTA",30,0)
 ;
"RTN","SAMICTTA",31,0)
RCMND(rtn,vals,dict) ; recommendations section of ctreport text format
"RTN","SAMICTTA",32,0)
 ;
"RTN","SAMICTTA",33,0)
 ; repgen14
"RTN","SAMICTTA",34,0)
 ;
"RTN","SAMICTTA",35,0)
 ;@called-by
"RTN","SAMICTTA",36,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTTA",37,0)
 ;@calls
"RTN","SAMICTTA",38,0)
 ; $$XVAL
"RTN","SAMICTTA",39,0)
 ; OUT
"RTN","SAMICTTA",40,0)
 ; $$XSUB
"RTN","SAMICTTA",41,0)
 ;@input
"RTN","SAMICTTA",42,0)
 ; rtn
"RTN","SAMICTTA",43,0)
 ; vals
"RTN","SAMICTTA",44,0)
 ; dict
"RTN","SAMICTTA",45,0)
 ;@output
"RTN","SAMICTTA",46,0)
 ; create impressions section of ct report in text format
"RTN","SAMICTTA",47,0)
 ;
"RTN","SAMICTTA",48,0)
 ;# Recommendation
"RTN","SAMICTTA",49,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",50,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTTA",51,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",52,0)
 ;d OUT("<!-- Recommendation -->")
"RTN","SAMICTTA",53,0)
 ;
"RTN","SAMICTTA",54,0)
 i $$XVAL("cefu",vals)'="nf" d  ; 2445-2450 gpl1
"RTN","SAMICTTA",55,0)
 . ;d OUT("<TR><TD><FONT SIZE=""+2""><B>")
"RTN","SAMICTTA",56,0)
 . ;d OUT("<FONT SIZE=""+2""><B>")
"RTN","SAMICTTA",57,0)
 . d OUT("")
"RTN","SAMICTTA",58,0)
 . d OUT("Recommendations:")
"RTN","SAMICTTA",59,0)
 . d OUT("")
"RTN","SAMICTTA",60,0)
 . ;d OUT("</B></FONT>")
"RTN","SAMICTTA",61,0)
 . ;d OUT("</TD></TR><TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",62,0)
 ;
"RTN","SAMICTTA",63,0)
 n fuw
"RTN","SAMICTTA",64,0)
 s fuw=$$XSUB("cefuw",vals,dict)
"RTN","SAMICTTA",65,0)
 ;d OUT("fuw= "_fuw)
"RTN","SAMICTTA",66,0)
 ;d OUT("vals= "_vals)
"RTN","SAMICTTA",67,0)
 ;d OUT(" dict= "_dict)
"RTN","SAMICTTA",68,0)
 ;d OUT($o(@vals@("cefuw","")))
"RTN","SAMICTTA",69,0)
 ;zwr @vals@(*)
"RTN","SAMICTTA",70,0)
 ;zwr @dict@(*)
"RTN","SAMICTTA",71,0)
 ;i fuw="" d  ;
"RTN","SAMICTTA",72,0)
 ;. d OUT(para_"<B>"_$$XSUB("cefu",vals,dict)_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",73,0)
 ;e  d  ;
"RTN","SAMICTTA",74,0)
 ;. d OUT(para_"<B>"_$$XSUB("cefu",vals,dict)_" "_fuw_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",75,0)
 i fuw="" d  ;
"RTN","SAMICTTA",76,0)
 . ;d OUT(para_"<B>A followup CT scan is recommended on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",77,0)
 . i $$XVAL("cefud",vals)="" q  ; no date given
"RTN","SAMICTTA",78,0)
 . d OUT("A followup CT scan is recommended on "_$$XVAL("cefud",vals)_". ") d OUT("")
"RTN","SAMICTTA",79,0)
 e  d  ;
"RTN","SAMICTTA",80,0)
 . ;d OUT(para_"<B>A followup CT scan is recommended "_fuw_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",81,0)
 . d OUT("A followup CT scan is recommended "_fuw_" on "_$$XVAL("cefud",vals)_". ") d OUT("")
"RTN","SAMICTTA",82,0)
 ;
"RTN","SAMICTTA",83,0)
 ; #Other followup
"RTN","SAMICTTA",84,0)
 n zfu,ofu,tofu,comma
"RTN","SAMICTTA",85,0)
 s comma=0,tofu=""
"RTN","SAMICTTA",86,0)
 s ofu=""
"RTN","SAMICTTA",87,0)
 f zfu="cefuaf","cefucc","cefupe","cefufn","cefubr","cefupc","cefutb" d  ;
"RTN","SAMICTTA",88,0)
 . i $$XVAL(zfu,vals)="y" s ofu=ofu_zfu
"RTN","SAMICTTA",89,0)
 i $$XVAL("cefuo",vals)'="" s ofu=ofu_"cefuo"
"RTN","SAMICTTA",90,0)
 i ofu'="" d  ;
"RTN","SAMICTTA",91,0)
 . s tofu="Followup: "
"RTN","SAMICTTA",92,0)
 . i ofu["cefuaf" s tofu=tofu_"Antibiotics" s comma=1
"RTN","SAMICTTA",93,0)
 . i ofu["cefucc" s tofu=tofu_$s(comma:", ",1:"")_"Diagnostic CT" s comma=1
"RTN","SAMICTTA",94,0)
 . i ofu["cefupe" s tofu=tofu_$s(comma:", ",1:"")_"PET" s comma=1
"RTN","SAMICTTA",95,0)
 . i ofu["cefufn" s tofu=tofu_$s(comma:", ",1:"")_"Percutaneous biopsy" s comma=1
"RTN","SAMICTTA",96,0)
 . i ofu["cefubr" s tofu=tofu_$s(comma:", ",1:"")_"Bronchoscopy" s comma=1
"RTN","SAMICTTA",97,0)
 . i ofu["cefupc" s tofu=tofu_$s(comma:", ",1:"")_"Pulmonary consultation" s comma=1
"RTN","SAMICTTA",98,0)
 . i ofu["cefutb" s tofu=tofu_$s(comma:", ",1:"")_"Refer to tumor board" s comma=1
"RTN","SAMICTTA",99,0)
 . i ofu["cefuo" s tofu=tofu_$s(comma:", ",1:"")_$$XVAL("cefuoo",vals) s comma=1
"RTN","SAMICTTA",100,0)
 i ofu'="" d OUT(para_tofu_para) d OUT("")
"RTN","SAMICTTA",101,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",102,0)
 ; # LungRADS
"RTN","SAMICTTA",103,0)
 ;
"RTN","SAMICTTA",104,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTTA",105,0)
 ;n lrstyle
"RTN","SAMICTTA",106,0)
 ;i $$XVAL("celrc",vals)'="" s lrstyle=1 ; dom's style
"RTN","SAMICTTA",107,0)
 ;e  s lrstyle=0 ; artit's style
"RTN","SAMICTTA",108,0)
 ;s lrstyle=0
"RTN","SAMICTTA",109,0)
 ;
"RTN","SAMICTTA",110,0)
 d  ;
"RTN","SAMICTTA",111,0)
 . q  ; LUNGRADS moved to SAMICTR4
"RTN","SAMICTTA",112,0)
 . n lradModifiers
"RTN","SAMICTTA",113,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTTA",114,0)
 . ;
"RTN","SAMICTTA",115,0)
 . i ($$XVAL("celrad",vals)'="-")&($$XVAL("celrad",vals)'="") d  ;
"RTN","SAMICTTA",116,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTTA",117,0)
 . . d OUT(para)
"RTN","SAMICTTA",118,0)
 ;
"RTN","SAMICTTA",119,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",120,0)
 ;
"RTN","SAMICTTA",121,0)
 ;d OUT("<TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",122,0)
 ;
"RTN","SAMICTTA",123,0)
 ;# Check if Study is Completed
"RTN","SAMICTTA",124,0)
 ;# Find Current Study ID
"RTN","SAMICTTA",125,0)
 ;# locate most recent followup
"RTN","SAMICTTA",126,0)
 ;# get status (sies)
"RTN","SAMICTTA",127,0)
 ;# if sc=Study Complete and cefu=rs
"RTN","SAMICTTA",128,0)
 ;
"RTN","SAMICTTA",129,0)
 n patstatus
"RTN","SAMICTTA",130,0)
 s patstatus=$$XVAL("cedos",vals)
"RTN","SAMICTTA",131,0)
 ;i patstatus="sc" d OUT(para_$g(@dict@("study_complete")))
"RTN","SAMICTTA",132,0)
 i patstatus="sc" d OUT($g(@dict@("study_complete"))) d OUT("")
"RTN","SAMICTTA",133,0)
 ;
"RTN","SAMICTTA",134,0)
 ;# Radiologist
"RTN","SAMICTTA",135,0)
 i $$XVAL("cerad",vals)'="" d  ;
"RTN","SAMICTTA",136,0)
 . d OUT("Interpreted by: "_$$XVAL("cerad",vals)) d OUT("")
"RTN","SAMICTTA",137,0)
 ;
"RTN","SAMICTTA",138,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",139,0)
 ; # LungRADS
"RTN","SAMICTTA",140,0)
 ;
"RTN","SAMICTTA",141,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTTA",142,0)
 n lrstyle
"RTN","SAMICTTA",143,0)
 i $$XVAL("celrc",vals)'="" s lrstyle=1 ; dom's style
"RTN","SAMICTTA",144,0)
 e  s lrstyle=0 ; artit's style
"RTN","SAMICTTA",145,0)
 s lrstyle=0
"RTN","SAMICTTA",146,0)
 ;
"RTN","SAMICTTA",147,0)
 d  ;
"RTN","SAMICTTA",148,0)
 . ;q  ; LUNGRADS moved to SAMICTR4
"RTN","SAMICTTA",149,0)
 . n lradModifiers
"RTN","SAMICTTA",150,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTTA",151,0)
 . ;
"RTN","SAMICTTA",152,0)
 . i ($$XVAL("celrad",vals)'="-")&($$XVAL("celrad",vals)'="") d  ;
"RTN","SAMICTTA",153,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTTA",154,0)
 . . d OUT("")
"RTN","SAMICTTA",155,0)
 ;
"RTN","SAMICTTA",156,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",157,0)
 ;
"RTN","SAMICTTA",158,0)
 ;d OUT("<TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",159,0)
 ;
"RTN","SAMICTTA",160,0)
 quit  ; end of RCMND
"RTN","SAMICTTA",161,0)
 ;
"RTN","SAMICTTA",162,0)
 ;
"RTN","SAMICTTA",163,0)
 ;
"RTN","SAMICTTA",164,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTTA",165,0)
 ;
"RTN","SAMICTTA",166,0)
 ;@called-by
"RTN","SAMICTTA",167,0)
 ; RCMND
"RTN","SAMICTTA",168,0)
 ;@calls none
"RTN","SAMICTTA",169,0)
 ;@input
"RTN","SAMICTTA",170,0)
 ; ln = output to add
"RTN","SAMICTTA",171,0)
 ;@output
"RTN","SAMICTTA",172,0)
 ; line added to ct report
"RTN","SAMICTTA",173,0)
 ;
"RTN","SAMICTTA",174,0)
 s cnt=cnt+1
"RTN","SAMICTTA",175,0)
 n lnn
"RTN","SAMICTTA",176,0)
 ;s debug=1
"RTN","SAMICTTA",177,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTTA",178,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTTA",179,0)
 ;
"RTN","SAMICTTA",180,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTTA",181,0)
 . i ln["<T" q  ; no markup
"RTN","SAMICTTA",182,0)
 . i ln["</" q  ; no markup
"RTN","SAMICTTA",183,0)
 . n zs s zs=$STACK
"RTN","SAMICTTA",184,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTTA",185,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTTA",186,0)
 ;
"RTN","SAMICTTA",187,0)
 quit  ; end of OUT
"RTN","SAMICTTA",188,0)
 ;
"RTN","SAMICTTA",189,0)
 ;
"RTN","SAMICTTA",190,0)
 ;
"RTN","SAMICTTA",191,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTTA",192,0)
 ;
"RTN","SAMICTTA",193,0)
 ;@called-by none
"RTN","SAMICTTA",194,0)
 ;@calls
"RTN","SAMICTTA",195,0)
 ; OUT
"RTN","SAMICTTA",196,0)
 ;@input
"RTN","SAMICTTA",197,0)
 ; ln = header output to add
"RTN","SAMICTTA",198,0)
 ;@output
"RTN","SAMICTTA",199,0)
 ; header line added to ct report
"RTN","SAMICTTA",200,0)
 ;
"RTN","SAMICTTA",201,0)
 d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTTA",202,0)
 ;
"RTN","SAMICTTA",203,0)
 quit  ; end of HOUT
"RTN","SAMICTTA",204,0)
 ;
"RTN","SAMICTTA",205,0)
 ;
"RTN","SAMICTTA",206,0)
 ;
"RTN","SAMICTTA",207,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTTA",208,0)
 ;
"RTN","SAMICTTA",209,0)
 ;@called-by
"RTN","SAMICTTA",210,0)
 ; RCMND
"RTN","SAMICTTA",211,0)
 ;@calls none
"RTN","SAMICTTA",212,0)
 ;@input
"RTN","SAMICTTA",213,0)
 ; var
"RTN","SAMICTTA",214,0)
 ; vals is passed by name
"RTN","SAMICTTA",215,0)
 ;@output = patient value for var
"RTN","SAMICTTA",216,0)
 ;
"RTN","SAMICTTA",217,0)
 n zr
"RTN","SAMICTTA",218,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTTA",219,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTTA",220,0)
 ;
"RTN","SAMICTTA",221,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTTA",222,0)
 ;
"RTN","SAMICTTA",223,0)
 ;
"RTN","SAMICTTA",224,0)
 ;
"RTN","SAMICTTA",225,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTTA",226,0)
 ;
"RTN","SAMICTTA",227,0)
 ;@called-by
"RTN","SAMICTTA",228,0)
 ; RCMND
"RTN","SAMICTTA",229,0)
 ;@calls none
"RTN","SAMICTTA",230,0)
 ;@input
"RTN","SAMICTTA",231,0)
 ; var
"RTN","SAMICTTA",232,0)
 ; vals and dict are passed by name
"RTN","SAMICTTA",233,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTTA",234,0)
 ;@output = dictionary value for var
"RTN","SAMICTTA",235,0)
 ;
"RTN","SAMICTTA",236,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTTA",237,0)
 n zr,zv,zdx
"RTN","SAMICTTA",238,0)
 s zdx=$g(valdx)
"RTN","SAMICTTA",239,0)
 i zdx="" s zdx=var
"RTN","SAMICTTA",240,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTTA",241,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTTA",242,0)
 i zv="" s zr="" q zr
"RTN","SAMICTTA",243,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTTA",244,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTTA",245,0)
 ;
"RTN","SAMICTTA",246,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTTA",247,0)
 ;
"RTN","SAMICTTA",248,0)
 ;
"RTN","SAMICTTA",249,0)
 ;
"RTN","SAMICTTA",250,0)
EOR ; end of routine SAMICTTA
"RTN","SAMICTUL")
0^12^B103375
"RTN","SAMICTUL",1,0)
SAMICTUL ;ven/gpl - ct report & copy log ;2021-05-25T15:44Z
"RTN","SAMICTUL",2,0)
 ;;18.0;SAMI;**10,11**;2020-01;Build 19
"RTN","SAMICTUL",3,0)
 ;;1.18.0.11+i11
"RTN","SAMICTUL",4,0)
 ;
"RTN","SAMICTUL",5,0)
 ; SAMICTUL contains routine & module info & the primary development
"RTN","SAMICTUL",6,0)
 ; log for VAPALS-ELCAP's CT Report ctreport web service route, which
"RTN","SAMICTUL",7,0)
 ; is implemented by the SAMICTR* (html) and SAMICTT* (text)
"RTN","SAMICTUL",8,0)
 ; routines. It also contains the log for the SAMICTC* routines that
"RTN","SAMICTUL",9,0)
 ; implement the ct form copy operation.
"RTN","SAMICTUL",10,0)
 ; SAMICTUL contains no public interfaces or executable code.
"RTN","SAMICTUL",11,0)
 ;
"RTN","SAMICTUL",12,0)
 quit  ; no entry from top
"RTN","SAMICTUL",13,0)
 ;
"RTN","SAMICTUL",14,0)
 ;
"RTN","SAMICTUL",15,0)
 ;
"RTN","SAMICTUL",16,0)
 ;@section 0 primary development
"RTN","SAMICTUL",17,0)
 ;
"RTN","SAMICTUL",18,0)
 ;
"RTN","SAMICTUL",19,0)
 ;
"RTN","SAMICTUL",20,0)
 ;@routine-credits
"RTN","SAMICTUL",21,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMICTUL",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICTUL",23,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMICTUL",24,0)
 ; http://vistaexpertise.net
"RTN","SAMICTUL",25,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMICTUL",26,0)
 ;@license Apache 2.0
"RTN","SAMICTUL",27,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMICTUL",28,0)
 ;
"RTN","SAMICTUL",29,0)
 ;@last-updated 2021-05-25T15:44Z
"RTN","SAMICTUL",30,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMICTUL",31,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMICTUL",32,0)
 ;@version 1.18.0.11+i11
"RTN","SAMICTUL",33,0)
 ;@release-date 2020-01
"RTN","SAMICTUL",34,0)
 ;@patch-list **10,11**
"RTN","SAMICTUL",35,0)
 ;
"RTN","SAMICTUL",36,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMICTUL",37,0)
 ; toad@vistaexpertise.net
"RTN","SAMICTUL",38,0)
 ;@additional-dev Alexis Carlson (arc)
"RTN","SAMICTUL",39,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMICTUL",40,0)
 ;@additional-dev Kenneth McGlothlen (mcglk)
"RTN","SAMICTUL",41,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICTUL",42,0)
 ;
"RTN","SAMICTUL",43,0)
 ;@module-credits
"RTN","SAMICTUL",44,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICTUL",45,0)
 ; (VA-PALS)
"RTN","SAMICTUL",46,0)
 ; http://va-pals.org/
"RTN","SAMICTUL",47,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICTUL",48,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICTUL",49,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICTUL",50,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICTUL",51,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMICTUL",52,0)
 ; http://ielcap.com/
"RTN","SAMICTUL",53,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICTUL",54,0)
 ; http://paraxialtech.com/
"RTN","SAMICTUL",55,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICTUL",56,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICTUL",57,0)
 ;
"RTN","SAMICTUL",58,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICTUL",59,0)
 ;
"RTN","SAMICTUL",60,0)
 ; 2018-10-14 ven/arc 1.18.0 f6e1229
"RTN","SAMICTUL",61,0)
 ;  SAMICTC1: turn on copy forward for cteval new forms
"RTN","SAMICTUL",62,0)
 ;
"RTN","SAMICTUL",63,0)
 ; 2018-12-11/2019-01-22 ven/lgc 1.18.0 3ceb74b,3bb70c8,5368121
"RTN","SAMICTUL",64,0)
 ;  SAMICTC1,2: update for sac compliance, add license info.
"RTN","SAMICTUL",65,0)
 ;
"RTN","SAMICTUL",66,0)
 ; 2020-02-01/03 ven/arc 1.18.0.4+i4 d47135a5,bc32c1cb,5b2e4525,
"RTN","SAMICTUL",67,0)
 ;  7bcd14a2,1c96fe0e,cb0075e8,5e553dd2,9cde6840,dcea0048e,98b7b273,
"RTN","SAMICTUL",68,0)
 ; a4f98f19
"RTN","SAMICTUL",69,0)
 ;  SAMICTT0,1,2,3,4,9,A: routines (starting as copies of SAMICTR*) to
"RTN","SAMICTUL",70,0)
 ; implement ctreport in text format, start convert nodules to text,
"RTN","SAMICTUL",71,0)
 ; add'l lung findings, fix parag spacing, add impressions sect,
"RTN","SAMICTUL",72,0)
 ; recommendations sect, add'l sects on other abnormalities, breast
"RTN","SAMICTUL",73,0)
 ; abnorm sect, other abnorm sect, tweak format, make it more compact.
"RTN","SAMICTUL",74,0)
 ;
"RTN","SAMICTUL",75,0)
 ; 2021-02-18 ven/gpl 1.18.0.10+i10 38fb2d70
"RTN","SAMICTUL",76,0)
 ;  SAMICTT0,1,2,3,4,9,A: ct report - insert space after every period.
"RTN","SAMICTUL",77,0)
 ;
"RTN","SAMICTUL",78,0)
 ; 2021-03-04/16 ven/gpl 1.18.0.10+i10 e09d5f16,3ea26de9,91793ba3
"RTN","SAMICTUL",79,0)
 ;  SAMICTT1,3,4: ct report: fix normal cardiac default output, CAC
"RTN","SAMICTUL",80,0)
 ; logic, other enhancements.
"RTN","SAMICTUL",81,0)
 ;
"RTN","SAMICTUL",82,0)
 ; 2021-03-23 ven/gpl 1.18.0.10+i10 a68f7f31
"RTN","SAMICTUL",83,0)
 ;  SAMICTT3: fix CAC problem.
"RTN","SAMICTUL",84,0)
 ;
"RTN","SAMICTUL",85,0)
 ; 2021-03-21/23 ven/toad 1.18.0.10+i10 96f461d
"RTN","SAMICTUL",86,0)
 ;  SAMICTUL: create development log routine.
"RTN","SAMICTUL",87,0)
 ;  SAMICTT0,1,2,3,4,9,A: bump date & version, lt refactor.
"RTN","SAMICTUL",88,0)
 ;
"RTN","SAMICTUL",89,0)
 ; 2021-05-14 ven/gpl 1.18.0.11+i11 0a01cf2
"RTN","SAMICTUL",90,0)
 ;  SAMICTTA: in RCMND change to ctreport for no followup ct w/other
"RTN","SAMICTUL",91,0)
 ; followup recommendations, "Followup" instead of "Other Followup."
"RTN","SAMICTUL",92,0)
 ;
"RTN","SAMICTUL",93,0)
 ; 2021-05-19 ven/gpl 1.18.0.11+i11 a21b056,139c6a5
"RTN","SAMICTUL",94,0)
 ;  SAMICTT0: in WSREPORT check for small nodule checkboxes.
"RTN","SAMICTUL",95,0)
 ;  SAMICTT1: in NODULES urgent fix to add to ct report "Small [non-]
"RTN","SAMICTUL",96,0)
 ; calcified nodules are present."
"RTN","SAMICTUL",97,0)
 ;
"RTN","SAMICTUL",98,0)
 ; 2021-05-20/21 ven/mcglk&toad 1.18.0.11+i11 43a4557,129e96b
"RTN","SAMICTUL",99,0)
 ;  SAMICTT0,1: bump version & dates.
"RTN","SAMICTUL",100,0)
 ;
"RTN","SAMICTUL",101,0)
 ; 2021-05-24 ven/gpl 1.18.0.11+i11 4aba1a9
"RTN","SAMICTUL",102,0)
 ;  SAMICTC1: in CTCOPY add new param key to control two new opening
"RTN","SAMICTUL",103,0)
 ; blocks, critical fix to copy forward for Is It New field for new ct
"RTN","SAMICTUL",104,0)
 ; eval forms.
"RTN","SAMICTUL",105,0)
 ;
"RTN","SAMICTUL",106,0)
 ; 2021-05-25 ven/toad 1.18.0.11+i11
"RTN","SAMICTUL",107,0)
 ;  SAMICTC1: bump version & dates; passim annotate & lt refactor.
"RTN","SAMICTUL",108,0)
 ;  SAMICTUL: add SAMICTC* routines to log.
"RTN","SAMICTUL",109,0)
 ;
"RTN","SAMICTUL",110,0)
 ;@contents
"RTN","SAMICTUL",111,0)
 ; SAMICTC1 ceform copy
"RTN","SAMICTUL",112,0)
 ; SAMICTC2 ceform copy continued
"RTN","SAMICTUL",113,0)
 ;
"RTN","SAMICTUL",114,0)
 ; SAMICTT0 ctreport text main
"RTN","SAMICTUL",115,0)
 ; SAMICTT1 ctreport text nodules
"RTN","SAMICTUL",116,0)
 ; SAMICTT2 ctreport text other lung
"RTN","SAMICTUL",117,0)
 ; SAMICTT3 ctreport text emphysema
"RTN","SAMICTUL",118,0)
 ; SAMICTT4 ctreport text breast abnorm
"RTN","SAMICTUL",119,0)
 ; SAMICTT9 ctreport text impressions
"RTN","SAMICTUL",120,0)
 ; SAMICTTA ctreport text recommendations
"RTN","SAMICTUL",121,0)
 ; SAMICTUL ctreport log
"RTN","SAMICTUL",122,0)
 ;
"RTN","SAMICTUL",123,0)
 ; SAMICTR* ctreport html format
"RTN","SAMICTUL",124,0)
 ; SAMIUTR* test the SAMICTR routines
"RTN","SAMICTUL",125,0)
 ;
"RTN","SAMICTUL",126,0)
 ;
"RTN","SAMICTUL",127,0)
 ;
"RTN","SAMICTUL",128,0)
EOR ; end of routine SAMICTUL
"RTN","SAMICUL")
0^13^B135532
"RTN","SAMICUL",1,0)
SAMICUL ;ven/gpl - ielcap: case review page log ;2021-05-25T15:28Z
"RTN","SAMICUL",2,0)
 ;;18.0;SAMI;**9,11**;2020-01;Build 19
"RTN","SAMICUL",3,0)
 ;;1.18.0.11+i11
"RTN","SAMICUL",4,0)
 ;
"RTN","SAMICUL",5,0)
 ; SAMICASE contains subroutines for producing the ELCAP Case
"RTN","SAMICUL",6,0)
 ; Review Page.
"RTN","SAMICUL",7,0)
 ; SAMICUL contains the development log for the SAMICA* routines.
"RTN","SAMICUL",8,0)
 ; It contains no executable code.
"RTN","SAMICUL",9,0)
 ;
"RTN","SAMICUL",10,0)
 quit  ; no entry from top
"RTN","SAMICUL",11,0)
 ;
"RTN","SAMICUL",12,0)
 ;
"RTN","SAMICUL",13,0)
 ;
"RTN","SAMICUL",14,0)
 ;@section 0 primary development
"RTN","SAMICUL",15,0)
 ;
"RTN","SAMICUL",16,0)
 ;
"RTN","SAMICUL",17,0)
 ;
"RTN","SAMICUL",18,0)
 ;@routine-credits
"RTN","SAMICUL",19,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMICUL",20,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICUL",21,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMICUL",22,0)
 ; http://vistaexpertise.net
"RTN","SAMICUL",23,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMICUL",24,0)
 ;@license see routine SAMIUL
"RTN","SAMICUL",25,0)
 ;
"RTN","SAMICUL",26,0)
 ;@last-updated 2021-05-25T15:28Z
"RTN","SAMICUL",27,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMICUL",28,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMICUL",29,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMICUL",30,0)
 ;@version 1.18.0.11+i11
"RTN","SAMICUL",31,0)
 ;@release-date 2020-01
"RTN","SAMICUL",32,0)
 ;@patch-list **9,11**
"RTN","SAMICUL",33,0)
 ;
"RTN","SAMICUL",34,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMICUL",35,0)
 ; toad@vistaexpertise.net
"RTN","SAMICUL",36,0)
 ;@additional-dev Linda M. R. Yaw (lmry)
"RTN","SAMICUL",37,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMICUL",38,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMICUL",39,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMICUL",40,0)
 ;@additional-dev Domenick DiNatale (ddn)
"RTN","SAMICUL",41,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMICUL",42,0)
 ;@additional-dev Kenneth McGlothlen (mcglk)
"RTN","SAMICUL",43,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICUL",44,0)
 ;
"RTN","SAMICUL",45,0)
 ;@module-credits
"RTN","SAMICUL",46,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICUL",47,0)
 ; (VA-PALS)
"RTN","SAMICUL",48,0)
 ; http://va-pals.org/
"RTN","SAMICUL",49,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICUL",50,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICUL",51,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICUL",52,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICUL",53,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMICUL",54,0)
 ; http://ielcap.com/
"RTN","SAMICUL",55,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICUL",56,0)
 ; http://paraxialtech.com/
"RTN","SAMICUL",57,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICUL",58,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICUL",59,0)
 ;
"RTN","SAMICUL",60,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICUL",61,0)
 ;
"RTN","SAMICUL",62,0)
 ; 2018-01-14 ven/gpl 1.18.0-t04 SAMICASE: split from routine SAMIFRM,
"RTN","SAMICUL",63,0)
 ; include wsCASE, GETTMPL, GETITEMS, casetbl.
"RTN","SAMICUL",64,0)
 ;
"RTN","SAMICUL",65,0)
 ; 2018-02-05/08 ven/toad 1.18.0-t04
"RTN","SAMICUL",66,0)
 ;  SAMICASE: update style, license, & attribution, spell out language
"RTN","SAMICUL",67,0)
 ; elements, add white space & do-dot quits, r/replaceAll^%wfhfrom w/
"RTN","SAMICUL",68,0)
 ; replaceAll^%wf, r/$$getTemplate^%wfhform w/$$getTemplate^%wf.
"RTN","SAMICUL",69,0)
 ;
"RTN","SAMICUL",70,0)
 ; 2018-02-14 ven/toad 1.18.0-t04
"RTN","SAMICUL",71,0)
 ; SAMICASE: r/replaceAll^%wf w/findReplaceAll^%wf, r/ln w/line, add
"RTN","SAMICUL",72,0)
 ; @calls & @called-by tags, break up some long lines.
"RTN","SAMICUL",73,0)
 ;
"RTN","SAMICUL",74,0)
 ; 2018-02-27 ven/gpl 1.18.0-t04
"RTN","SAMICUL",75,0)
 ;  SAMICASE: new subroutines $$KEY2DSPD, $$GETDTKEY; in wsCASE get
"RTN","SAMICUL",76,0)
 ; 1st & last names from graph, fix paths, key forms in graph w/date.
"RTN","SAMICUL",77,0)
 ;
"RTN","SAMICUL",78,0)
 ; 2018-03-01 ven/toad 1.18.0-t04
"RTN","SAMICUL",79,0)
 ;  SAMICASE: refactor & reorganize new code, add header comments, r/
"RTN","SAMICUL",80,0)
 ; findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",81,0)
 ;
"RTN","SAMICUL",82,0)
 ; 2018-03-06 ven/gpl 1.18.0-t04
"RTN","SAMICUL",83,0)
 ;  SAMICASE: add New Form button, list rest of forms for patient, add
"RTN","SAMICUL",84,0)
 ; web services wsNuForm & wsNuFormPost & method MKCEFORM, extend
"RTN","SAMICUL",85,0)
 ; GETITEMS to get rest of forms.
"RTN","SAMICUL",86,0)
 ;
"RTN","SAMICUL",87,0)
 ; 2018-03-07/08 ven/toad 1.18.0-t04
"RTN","SAMICUL",88,0)
 ;  SAMICASE: merge George changes w/ rest, add white space, spell out
"RTN","SAMICUL",89,0)
 ; M elements, add hdr comments to new subroutines, r/findReplace^%wf
"RTN","SAMICUL",90,0)
 ; & replaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",91,0)
 ;
"RTN","SAMICUL",92,0)
 ; 2018-03-11 ven/gpl 1.18.0-t04 9bd663ee
"RTN","SAMICUL",93,0)
 ;  SAMICAS2: vapals forms working.
"RTN","SAMICUL",94,0)
 ;
"RTN","SAMICUL",95,0)
 ; 2018-03-12 ven/gpl 1.18.0-t04 8c36c6a7
"RTN","SAMICUL",96,0)
 ;  SAMICAS2: new form works now & charts on home page.
"RTN","SAMICUL",97,0)
 ;
"RTN","SAMICUL",98,0)
 ; 2018-03-14 ven/gpl 1.18.0-t04 9653650a
"RTN","SAMICUL",99,0)
 ;  SAMICAS2: revised casereview page link, fixed external url
"RTN","SAMICUL",100,0)
 ; preservation.
"RTN","SAMICUL",101,0)
 ;
"RTN","SAMICUL",102,0)
 ; 2018-03-21 ven/gpl 1.18.0-t04 48868561
"RTN","SAMICUL",103,0)
 ;  SAMICAS2: max date insertion, case review navigation changed to
"RTN","SAMICUL",104,0)
 ; post, date order for CT Eval in case review.
"RTN","SAMICUL",105,0)
 ;
"RTN","SAMICUL",106,0)
 ; 2018-03-26 ven/gpl 1.18.0-t04 5fa4ee96
"RTN","SAMICUL",107,0)
 ;  SAMICAS2: changes to support incomplete forms display &
"RTN","SAMICUL",108,0)
 ; processing.
"RTN","SAMICUL",109,0)
 ;
"RTN","SAMICUL",110,0)
 ; 2018-03-27 ven/gpl 1.18.0-t04 cace9756
"RTN","SAMICUL",111,0)
 ;  SAMICAS2: siforms are always complete.
"RTN","SAMICUL",112,0)
 ;
"RTN","SAMICUL",113,0)
 ; 2018-04-02 ven/gpl 1.18.0-t04 00da9146
"RTN","SAMICUL",114,0)
 ;  SAMICAS2: added followup form.
"RTN","SAMICUL",115,0)
 ;
"RTN","SAMICUL",116,0)
 ; 2018-04-24 ven/gpl 1.18.0-t04 22e39d87
"RTN","SAMICUL",117,0)
 ;  SAMICAS2: added pet & biopsy forms.
"RTN","SAMICUL",118,0)
 ;
"RTN","SAMICUL",119,0)
 ; 2018-05-01 ven/gpl 1.18.0-t04 f1751c43
"RTN","SAMICUL",120,0)
 ;  SAMICAS2: fix problem with new forms: followup & pet.
"RTN","SAMICUL",121,0)
 ;
"RTN","SAMICUL",122,0)
 ; 2018-05-18 ven/lgc 1.18.0-t04 9eba8f8c
"RTN","SAMICUL",123,0)
 ;  SAMICAS2: conversion to new graph and simplified forms processing.
"RTN","SAMICUL",124,0)
 ;
"RTN","SAMICUL",125,0)
 ; 2018-05-21 ven/lgc 1.18.0-t04 0d7ed2f7
"RTN","SAMICUL",126,0)
 ;  SAMICAS2: changes for new navigation html.
"RTN","SAMICUL",127,0)
 ;
"RTN","SAMICUL",128,0)
 ; 2018-06-14 ven/lgc 1.18.0-t04 d71f4fe4
"RTN","SAMICUL",129,0)
 ;  SAMICAS2: changes to make the background form optional.
"RTN","SAMICUL",130,0)
 ;
"RTN","SAMICUL",131,0)
 ; 2018-06-20 ven/lgc 1.18.0-t04 bf03b07f
"RTN","SAMICUL",132,0)
 ;  SAMICAS2: corrections for new forms processing navigation.
"RTN","SAMICUL",133,0)
 ;
"RTN","SAMICUL",134,0)
 ; 2018-07-01 ven/lgc 1.18.0-t04 2e1541dc,8b0a4329
"RTN","SAMICUL",135,0)
 ;  SAMICAS2: add intervention forms to case review page, 1st version
"RTN","SAMICUL",136,0)
 ; of ct eval report.
"RTN","SAMICUL",137,0)
 ;
"RTN","SAMICUL",138,0)
 ; 2018-07-04 ven/lgc 1.18.0-t04 b28c1658
"RTN","SAMICUL",139,0)
 ;  SAMICAS2: fix a typo.
"RTN","SAMICUL",140,0)
 ;
"RTN","SAMICUL",141,0)
 ; 2018-07-10 ven/lgc 1.18.0-t04 2e9662b4
"RTN","SAMICUL",142,0)
 ;  SAMICAS2: repair SAMIHOM3 & redact report link.
"RTN","SAMICUL",143,0)
 ;
"RTN","SAMICUL",144,0)
 ; 2018-08-19 ven/lgc 1.18.0-t04 2ce0cab4
"RTN","SAMICUL",145,0)
 ;  SAMICAS2: use ssn instead of last5 where available.
"RTN","SAMICUL",146,0)
 ;
"RTN","SAMICUL",147,0)
 ; 2018-08-20 ven/lgc 1.18.0-t04 955fd484
"RTN","SAMICUL",148,0)
 ;  SAMICAS2: fix case review page cr lf issue.
"RTN","SAMICUL",149,0)
 ;
"RTN","SAMICUL",150,0)
 ; 2018-08-22 ven/gpl 1.18.0-t04 d67a2fe5
"RTN","SAMICUL",151,0)
 ;  SAMICAS2: turn off ctreport.
"RTN","SAMICUL",152,0)
 ;
"RTN","SAMICUL",153,0)
 ; 2018-08-30 ven/lgc 1.18.0-t04 125f1c8b
"RTN","SAMICUL",154,0)
 ;  SAMICAS2: add type index to getItems to help find last previous
"RTN","SAMICUL",155,0)
 ; form of a type.
"RTN","SAMICUL",156,0)
 ;
"RTN","SAMICUL",157,0)
 ; 2018-09-04 ven/lgc 1.18.0-t04 3e6e326f
"RTN","SAMICUL",158,0)
 ;  SAMICAS2: hide report link.
"RTN","SAMICUL",159,0)
 ;
"RTN","SAMICUL",160,0)
 ; 2018-10-14 ven/lgc 1.18.0-t04 f6e1229f
"RTN","SAMICUL",161,0)
 ;  SAMICAS2: turn on copy forward for cteval new forms.
"RTN","SAMICUL",162,0)
 ;
"RTN","SAMICUL",163,0)
 ; 2018-10-26 ven/lgc 1.18.0-t04 f19bf1ae
"RTN","SAMICUL",164,0)
 ;  SAMICAS2: ability to add multiple forms on same day.
"RTN","SAMICUL",165,0)
 ;
"RTN","SAMICUL",166,0)
 ; 2018-11-07 ven/gpl 1.18.0-t04 c76b2eac
"RTN","SAMICUL",167,0)
 ;  SAMICAS2: defend against unit test patient 1.
"RTN","SAMICUL",168,0)
 ;
"RTN","SAMICUL",169,0)
 ; 2018-11-13 ven/toad 1.18.0-t04
"RTN","SAMICUL",170,0)
 ;  SAMICAS2: SAMIHOM2 > SAMIHOM3.
"RTN","SAMICUL",171,0)
 ;
"RTN","SAMICUL",172,0)
 ; 2018-11-14 ven/lgc 1.18.0-t04 6e9799ba
"RTN","SAMICUL",173,0)
 ;  SAMICUL: fix graphstore forms.
"RTN","SAMICUL",174,0)
 ;
"RTN","SAMICUL",175,0)
 ; 2018-11-28 ven/lgc 1.18.0-t04 a9539464
"RTN","SAMICUL",176,0)
 ;  SAMICAS2: work on sac compliance.
"RTN","SAMICUL",177,0)
 ;
"RTN","SAMICUL",178,0)
 ; 2018-12-11 ven/lgc 1.18.0-t04 3ceb74b5
"RTN","SAMICUL",179,0)
 ;  SAMICAS2: update for sac compliance.
"RTN","SAMICUL",180,0)
 ;
"RTN","SAMICUL",181,0)
 ; 2018-12-19/20 ven/lgc 1.18.0-t04 7a5d3400,a14554c1
"RTN","SAMICUL",182,0)
 ;  SAMICAS2: more sac compliance, r/^gpl w/^SAMIGPL.
"RTN","SAMICUL",183,0)
 ;
"RTN","SAMICUL",184,0)
 ; 2018-12-26 ven/lgc 1.18.0-t04 8dd6f34d,51eb1635
"RTN","SAMICUL",185,0)
 ;  SAMICAS2: update for sac compliance, fix accidental reversions.
"RTN","SAMICUL",186,0)
 ;
"RTN","SAMICUL",187,0)
 ; 2019-01-10 ven/lgc 1.18.0-t04 2daba010
"RTN","SAMICUL",188,0)
 ;  SAMICAS2: update for SAC compliance.
"RTN","SAMICUL",189,0)
 ;
"RTN","SAMICUL",190,0)
 ; 2019-01-22 ven/lgc 1.18.0-t04 53681219,5ddb29c5
"RTN","SAMICUL",191,0)
 ;  SAMICAS2: add license info to each SAMI routine; edit for lower
"RTN","SAMICUL",192,0)
 ; case initials.
"RTN","SAMICUL",193,0)
 ;
"RTN","SAMICUL",194,0)
 ; 2019-02-18 ven/lgc 1.18.0-t04 76874314
"RTN","SAMICUL",195,0)
 ;  SAMICAS2,SAMICAS3: update recently edited routines.
"RTN","SAMICUL",196,0)
 ;
"RTN","SAMICUL",197,0)
 ; 2019-03-13 ven/lmry 1.18.0-t04 ef66ef16
"RTN","SAMICUL",198,0)
 ;  SAMICAS2: spell out some elements missed earlier.
"RTN","SAMICUL",199,0)
 ;
"RTN","SAMICUL",200,0)
 ; 2019-03-14 ven/lmry 1.18.0-t04 038507e2
"RTN","SAMICUL",201,0)
 ;  SAMICAS3: spell out some missed M elements, fix copy/paste errors
"RTN","SAMICUL",202,0)
 ; in comments for MKFUFORM, MKBXFORM, & MKPTFORM.
"RTN","SAMICUL",203,0)
 ;
"RTN","SAMICUL",204,0)
 ; 2019-04-16 ven/lgc 1.18.0-t04 e54b76d1
"RTN","SAMICUL",205,0)
 ;  SAMICAS2: update for SAMIFORM project.
"RTN","SAMICUL",206,0)
 ;
"RTN","SAMICUL",207,0)
 ; 2019-04-23 ven/gpl 1.18.0-t04 ce322911
"RTN","SAMICUL",208,0)
 ;  SAMICAS2: add intake notes to case review page.
"RTN","SAMICUL",209,0)
 ;
"RTN","SAMICUL",210,0)
 ; 2019-06-18 ven/lgc 1.18.0-t04 91022482
"RTN","SAMICUL",211,0)
 ;  SAMICAS3: switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMICUL",212,0)
 ;
"RTN","SAMICUL",213,0)
 ; 2019-07-01 ven/gpl 1.18.0-t04 cc87cc44
"RTN","SAMICUL",214,0)
 ;  SAMICAS3: prevent >1 bkgd form/patient.
"RTN","SAMICUL",215,0)
 ;
"RTN","SAMICUL",216,0)
 ; 2019-07-07 ven/gpl 1.18.0-t04 776f7451
"RTN","SAMICUL",217,0)
 ;  SAMICAS3: resolving can't create bkgd form, branch messed up.
"RTN","SAMICUL",218,0)
 ;
"RTN","SAMICUL",219,0)
 ; 2019-08-01 ven/lgc 1.18.0-t04 d710f27d
"RTN","SAMICUL",220,0)
 ;  SAMICAS2: pull displayed facility code from Vista parameter.
"RTN","SAMICUL",221,0)
 ;
"RTN","SAMICUL",222,0)
 ; 2019-09-26 ven/gpl 1.18.0-t04 92b12324 vap-420
"RTN","SAMICUL",223,0)
 ;  SAMICAS3: prefill form date & date of baseline ct on new followup
"RTN","SAMICUL",224,0)
 ; form.
"RTN","SAMICUL",225,0)
 ;
"RTN","SAMICUL",226,0)
 ; 2019-10-01 par/ddn 1.18.0-t04 4caf1a98 vap-344
"RTN","SAMICUL",227,0)
 ;  SAMICAS2: use proper capitalization of the word "veteran".
"RTN","SAMICUL",228,0)
 ;
"RTN","SAMICUL",229,0)
 ; 2020-01-11 ven/lgc 1.18.0.1+i1 5651698a
"RTN","SAMICUL",230,0)
 ;  SAMICAS2,SAMICAS3: fix duplicate form overwriting.
"RTN","SAMICUL",231,0)
 ;
"RTN","SAMICUL",232,0)
 ; 2020-01-17 ven/lgc 1.18.0.1+i1 8557207f
"RTN","SAMICUL",233,0)
 ;  SAMICAS2: followup note.
"RTN","SAMICUL",234,0)
 ;
"RTN","SAMICUL",235,0)
 ; 2020-01-25 ven/lgc 1.18.0.3+i3 6a07a860,6a947567
"RTN","SAMICUL",236,0)
 ;  SAMICAS3: nodule copy & fix to ru, fix subtle bug in nodule copy.
"RTN","SAMICUL",237,0)
 ;
"RTN","SAMICUL",238,0)
 ; 2020-04-11 ven/gpl 1.18.0.5+i5 666f5b91,2f2c29c1
"RTN","SAMICUL",239,0)
 ;  SAMICAS2: multi-tenancy.
"RTN","SAMICUL",240,0)
 ;
"RTN","SAMICUL",241,0)
 ; 2020-05-12 ven/gpl 1.18.0.5+i5 ad11e0ea
"RTN","SAMICUL",242,0)
 ;  SAMICAS2: fix SITE on case review page.
"RTN","SAMICUL",243,0)
 ;
"RTN","SAMICUL",244,0)
 ; 2020-11-12 ven/gpl 1.18.0.9+i9 cec1ccd6
"RTN","SAMICUL",245,0)
 ;  SAMICAS2,SAMICAS3: ceform date refill upgrade.
"RTN","SAMICUL",246,0)
 ;
"RTN","SAMICUL",247,0)
 ; 2020-11-13 ven/gpl 1.18.0.9+i9 dce3c568
"RTN","SAMICUL",248,0)
 ;  SAMICAS3: prefill ceform prior scans text field.
"RTN","SAMICUL",249,0)
 ;
"RTN","SAMICUL",250,0)
 ; 2021-02-18 ven/gpl 1.18.0.9+i9 af2a0b8a
"RTN","SAMICUL",251,0)
 ;  SAMICAS3: copy last previous CT nodules instead of last nodules in
"RTN","SAMICUL",252,0)
 ; any form.
"RTN","SAMICUL",253,0)
 ;
"RTN","SAMICUL",254,0)
 ; 2021-02-21 ven/gpl 1.18.0.9+i9 3fd704fb
"RTN","SAMICUL",255,0)
 ;  SAMICAS3: fix bug in prefill logic.
"RTN","SAMICUL",256,0)
 ;
"RTN","SAMICUL",257,0)
 ; 2021-03-02 ven/gpl 1.18.0.9+i9 479dc041
"RTN","SAMICUL",258,0)
 ;  SAMICAS2: return error msg if no CT Eval form exists when
"RTN","SAMICUL",259,0)
 ; generating a FU note.
"RTN","SAMICUL",260,0)
 ;
"RTN","SAMICUL",261,0)
 ; 2021-03-10 ven/toad 1.18.0.9+i9 a46a2cc1
"RTN","SAMICUL",262,0)
 ;  SAMICUL: update log, convert to new vistaver schema.
"RTN","SAMICUL",263,0)
 ;  SAMICAS2,SAMICAS3: bump date & patch list, update contents, lt
"RTN","SAMICUL",264,0)
 ; refactor.
"RTN","SAMICUL",265,0)
 ;
"RTN","SAMICUL",266,0)
 ; 2021-03-17 ven/toad 1.18.0.9+i9 62da30b
"RTN","SAMICUL",267,0)
 ;  SAMICAS2: fix xindex errors: in WSCASE add missing space between
"RTN","SAMICUL",268,0)
 ; do & comment to prevent syntax error reported as block mismatch.
"RTN","SAMICUL",269,0)
 ;  SAMICAS3: remove extra spaces at ends of 3 lines.
"RTN","SAMICUL",270,0)
 ;
"RTN","SAMICUL",271,0)
 ; 2021-04-16 ven/gpl 1.18.0.11+i11 ac82eec
"RTN","SAMICUL",272,0)
 ;  SAMICAS3: include baseline scan in prior scans field on prefill.
"RTN","SAMICUL",273,0)
 ;
"RTN","SAMICUL",274,0)
 ; 2021-05-14/19 ven/gpl 1.18.0.11+i11 0cbee7b,a21b056,139c6a5,0a0cccc
"RTN","SAMICUL",275,0)
 ;  SAMICAS3: improved CT eval prefill of past scan dates, urgent
"RTN","SAMICUL",276,0)
 ; fixes to CT Report & intervention & pet form prefill.
"RTN","SAMICUL",277,0)
 ;
"RTN","SAMICUL",278,0)
 ; 2021-05-20/21 ven/mcglk&toad 1.18.0.11+i11 43a4557,424ea11,129e96b
"RTN","SAMICUL",279,0)
 ;  SAMICAS3: bump version & dates.
"RTN","SAMICUL",280,0)
 ;
"RTN","SAMICUL",281,0)
 ; 2021-05-24 ven/gpl 1.18.0.11+i11 4aba1a9
"RTN","SAMICUL",282,0)
 ;  SAMICAS3: in MKCEFORM,MKPTFORM,MKBXFORM pass key to
"RTN","SAMICUL",283,0)
 ; CTCOPY^SAMICTC1 to modulate node-copy operation; critical fix to
"RTN","SAMICUL",284,0)
 ; copy forward for is it new field for new ct eval forms.
"RTN","SAMICUL",285,0)
 ;
"RTN","SAMICUL",286,0)
 ; 2021-05-25 ven/toad 1.18.0.11_i11
"RTN","SAMICUL",287,0)
 ;  SAMICAS3: bump date; passim lt refactor.
"RTN","SAMICUL",288,0)
 ;
"RTN","SAMICUL",289,0)
 ;
"RTN","SAMICUL",290,0)
 ;
"RTN","SAMICUL",291,0)
EOR ; end of routine SAMICUL
"RTN","SAMIHL7")
0^6^B192849190
"RTN","SAMIHL7",1,0)
SAMIHL7 ;ven/lgc&arc - HL7 utilities ;2021-05-21T20:47Z
"RTN","SAMIHL7",2,0)
 ;;18.0;SAMI;**11**;2020-01;Build 19
"RTN","SAMIHL7",3,0)
 ;;1.18.0.11+i11
"RTN","SAMIHL7",4,0)
 ;
"RTN","SAMIHL7",5,0)
 ; SAMIHL7 contains subroutines for manipulating VAPALS-ELCAP HL7
"RTN","SAMIHL7",6,0)
 ; messages.
"RTN","SAMIHL7",7,0)
 ;
"RTN","SAMIHL7",8,0)
 quit  ; no entry from top
"RTN","SAMIHL7",9,0)
 ;
"RTN","SAMIHL7",10,0)
 ;
"RTN","SAMIHL7",11,0)
 ;
"RTN","SAMIHL7",12,0)
 ;@section 0 primary development
"RTN","SAMIHL7",13,0)
 ;
"RTN","SAMIHL7",14,0)
 ;
"RTN","SAMIHL7",15,0)
 ;
"RTN","SAMIHL7",16,0)
 ;@routine-credits
"RTN","SAMIHL7",17,0)
 ;@primary-dev Larry G. Carlson (lgc)
"RTN","SAMIHL7",18,0)
 ; lgc@vistaexpertise.net
"RTN","SAMIHL7",19,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMIHL7",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIHL7",21,0)
 ;@copyright 2017/2021, lgc, all rights reserved
"RTN","SAMIHL7",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIHL7",23,0)
 ;
"RTN","SAMIHL7",24,0)
 ;@last-updated 2021-05-21T20:47Z
"RTN","SAMIHL7",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIHL7",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIHL7",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIHL7",28,0)
 ;@version 1.18.0.11+i11
"RTN","SAMIHL7",29,0)
 ;@release-date 2020-01
"RTN","SAMIHL7",30,0)
 ;@patch-list **11**
"RTN","SAMIHL7",31,0)
 ;
"RTN","SAMIHL7",32,0)
 ;@additional-dev Alexis R. Carlson (arc)
"RTN","SAMIHL7",33,0)
 ; arc@vistaexpertise.net
"RTN","SAMIHL7",34,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMIHL7",35,0)
 ; toad@vistaexpertise.net
"RTN","SAMIHL7",36,0)
 ;@additional-dev Kenneth McGlothlen (mcglk)
"RTN","SAMIHL7",37,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIHL7",38,0)
 ;
"RTN","SAMIHL7",39,0)
 ;@module-credits
"RTN","SAMIHL7",40,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIHL7",41,0)
 ; (VA-PALS)
"RTN","SAMIHL7",42,0)
 ; http://va-pals.org/
"RTN","SAMIHL7",43,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIHL7",44,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIHL7",45,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIHL7",46,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIHL7",47,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIHL7",48,0)
 ; http://ielcap.com/
"RTN","SAMIHL7",49,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIHL7",50,0)
 ; http://paraxialtech.com/
"RTN","SAMIHL7",51,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIHL7",52,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIHL7",53,0)
 ;
"RTN","SAMIHL7",54,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIHL7",55,0)
 ;
"RTN","SAMIHL7",56,0)
 ; 2019-10-03/28 ven/lgc 1.18.0 d01fd10,ff6cea0,3670fb3,613e8ff
"RTN","SAMIHL7",57,0)
 ; ,82979cc
"RTN","SAMIHL7",58,0)
 ;  SAMIHL7: HL7 routines to populate & update patient-lookup graph,
"RTN","SAMIHL7",59,0)
 ; reorganize HL7 routines & work on unit tests, change how gender is
"RTN","SAMIHL7",60,0)
 ; handled, update unit test routines for dfn 1, further updates to
"RTN","SAMIHL7",61,0)
 ; SAMI unit tests.
"RTN","SAMIHL7",62,0)
 ;
"RTN","SAMIHL7",63,0)
 ; 2020-01-16 ven/lgc&arc 1.18.0 0a2af96
"RTN","SAMIHL7",64,0)
 ;  SAMIHL7: bulk commit due to switch to cache.
"RTN","SAMIHL7",65,0)
 ;
"RTN","SAMIHL7",66,0)
 ; 2020-07-28 ven/lgc 1.18.0.11+i11 c08b051
"RTN","SAMIHL7",67,0)
 ;  SAMIHL7: update for ORU messaging.
"RTN","SAMIHL7",68,0)
 ;
"RTN","SAMIHL7",69,0)
 ; 2021-04-14/20 ven/gpl 1.18.0.11+i11 3a5756a,d7182d7
"RTN","SAMIHL7",70,0)
 ;  SAMIHL7: fix for duplicate patients fr/HL7, fix for updating 
"RTN","SAMIHL7",71,0)
 ; patient-lookup graph on receipt of 2nd order.
"RTN","SAMIHL7",72,0)
 ;
"RTN","SAMIHL7",73,0)
 ; 2021-05-20/21 ven/mcglk&toad 1.18.0.11+i11
"RTN","SAMIHL7",74,0)
 ;  SAMIHL7: build hdr comments & dev log, lt refactor, bump version.
"RTN","SAMIHL7",75,0)
 ;
"RTN","SAMIHL7",76,0)
 ;@contents
"RTN","SAMIHL7",77,0)
 ; UPDTPTL-UPDTPTL1-MATCHLOG update patient-lookup w/patient-fields array
"RTN","SAMIHL7",78,0)
 ; CAPTORM save all ORM fields in patient-lookup
"RTN","SAMIHL7",79,0)
 ; KILLREF kill old field in patient-lookup root
"RTN","SAMIHL7",80,0)
 ; ACK force a com ACK
"RTN","SAMIHL7",81,0)
 ;
"RTN","SAMIHL7",82,0)
 ;
"RTN","SAMIHL7",83,0)
 ;
"RTN","SAMIHL7",84,0)
 ;@section 1 example incoming fields array
"RTN","SAMIHL7",85,0)
 ;
"RTN","SAMIHL7",86,0)
 ;
"RTN","SAMIHL7",87,0)
 ;
"RTN","SAMIHL7",88,0)
 ;fields("PID","segment")="PID|1||000002341||ZZTEST^MACHO^^^^^L||19271106000000|M|||7726 W ORCHID ST^^PHOENIX^AZ^85017||||||||000002341|"
"RTN","SAMIHL7",89,0)
 ;fields("PIV","segment")="PV1||O|PHX-PULM RN LSS PHONE|||||244088^GARCIA^DANIEL^P"
"RTN","SAMIHL7",90,0)
 ;fields("OBR","segment")="OBR||||PHO_LUNG^LUNG|"
"RTN","SAMIHL7",91,0)
 ;fields("ORC","segment")="ORC|NW|3200616135751|||NW||||20200616135751||||||20200616135751"
"RTN","SAMIHL7",92,0)
 ;
"RTN","SAMIHL7",93,0)
 ;fields("ORM",6799278.886493,"assignedlocation")="PHX-PULM RN LSS PHONE"
"RTN","SAMIHL7",94,0)
 ;fields("ORM",6799278.886493,"fulladdress")="7726 W ORCHID ST^^PHOENIX^AZ^85017"
"RTN","SAMIHL7",95,0)
 ;fields("ORM",6799278.886493,"msgid")="99000023ORM"
"RTN","SAMIHL7",96,0)
 ;fields("ORM",6799278.886493,"order")="PHO_LUNG"
"RTN","SAMIHL7",97,0)
 ;fields("ORM",6799278.886493,"order2")="LUNG"
"RTN","SAMIHL7",98,0)
 ;fields("ORM",6799278.886493,"ordercontrol")="NW"
"RTN","SAMIHL7",99,0)
 ;fields("ORM",6799278.886493,"ordereffectivedt")=20200616135751
"RTN","SAMIHL7",100,0)
 ;fields("ORM",6799278.886493,"ordernumber")=3200616135751
"RTN","SAMIHL7",101,0)
 ;fields("ORM",6799278.886493,"orderstatus")="NW"
"RTN","SAMIHL7",102,0)
 ;fields("ORM",6799278.886493,"patientclass")="O"
"RTN","SAMIHL7",103,0)
 ;fields("ORM",6799278.886493,"providerien")=244088
"RTN","SAMIHL7",104,0)
 ;fields("ORM",6799278.886493,"providernm")="GARCIA,DANIEL,P"
"RTN","SAMIHL7",105,0)
 ;fields("ORM",6799278.886493,"siteid")="PHO"
"RTN","SAMIHL7",106,0)
 ;fields("ORM",6799278.886493,"transactiondt")=20200616135751
"RTN","SAMIHL7",107,0)
 ;
"RTN","SAMIHL7",108,0)
 ; fields("address1")="7726 W ORCHID ST"
"RTN","SAMIHL7",109,0)
 ; fields("city")="PHOENIX"
"RTN","SAMIHL7",110,0)
 ; fields("icn")=""
"RTN","SAMIHL7",111,0)
 ; fields("last5")="Z2341"
"RTN","SAMIHL7",112,0)
 ; fields("phone")=""
"RTN","SAMIHL7",113,0)
 ; fields("saminame")="Zztest,Macho"
"RTN","SAMIHL7",114,0)
 ; fields("sbdob")=19271106000000
"RTN","SAMIHL7",115,0)
 ; fields("sex")="M"
"RTN","SAMIHL7",116,0)
 ; fields("sinamef")="Macho"
"RTN","SAMIHL7",117,0)
 ; fields("sinamel")="Zztest"
"RTN","SAMIHL7",118,0)
 ; fields("siteid")="PHO"
"RTN","SAMIHL7",119,0)
 ; fields("ssn")="000002341"
"RTN","SAMIHL7",120,0)
 ; fields("state")="AZ"
"RTN","SAMIHL7",121,0)
 ; fields("zip")=85017
"RTN","SAMIHL7",122,0)
 ;
"RTN","SAMIHL7",123,0)
 ;
"RTN","SAMIHL7",124,0)
 ;
"RTN","SAMIHL7",125,0)
 ;@section 2 ppis & subroutines
"RTN","SAMIHL7",126,0)
 ;
"RTN","SAMIHL7",127,0)
 ;
"RTN","SAMIHL7",128,0)
 ;
"RTN","SAMIHL7",129,0)
 ;@ppi UPDTPTL^SAMIHL7
"RTN","SAMIHL7",130,0)
UPDTPTL(fields) ; update patient-lookup w/patient-fields array
"RTN","SAMIHL7",131,0)
 ;
"RTN","SAMIHL7",132,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHL7",133,0)
 ;
"RTN","SAMIHL7",134,0)
 ;;ppi;procedure;???;silent;sac
"RTN","SAMIHL7",135,0)
 ;@falls-thru-to
"RTN","SAMIHL7",136,0)
 ; UPDTPTL1-MATCHLOG
"RTN","SAMIHL7",137,0)
 ;@called-by
"RTN","SAMIHL7",138,0)
 ; MSH^SAMIADT [<= EN^SAMIADT <= old HL7 app, no longer used]
"RTN","SAMIHL7",139,0)
 ; PID^SAMIADT [<= EN^SAMIADT <= old HL7 app, no longer used]
"RTN","SAMIHL7",140,0)
 ; EN^SAMIORM [<= hl7 app INST-MCAR <= HL7, main vapals hl7 entry]
"RTN","SAMIHL7",141,0)
 ; IMPRTPTS^SAMIPI [patient-lookup graph import & export utils]
"RTN","SAMIHL7",142,0)
 ; ACK^SAMITIU [<= old HL7 app, no longer used]
"RTN","SAMIHL7",143,0)
 ; RECTIU^SAMITIU
"RTN","SAMIHL7",144,0)
 ; RECTIU^SAMIVHL [HL7 TIU processing for VAPALS, no longer used?]
"RTN","SAMIHL7",145,0)
 ;@calls none
"RTN","SAMIHL7",146,0)
 ;@input
"RTN","SAMIHL7",147,0)
 ; fields = array of patient data
"RTN","SAMIHL7",148,0)
 ;@output
"RTN","SAMIHL7",149,0)
 ; existing entry in patient-lookup graph updated
"RTN","SAMIHL7",150,0)
 ; or new patient entered
"RTN","SAMIHL7",151,0)
 ;
"RTN","SAMIHL7",152,0)
 ;
"RTN","SAMIHL7",153,0)
 ;@stanza 2 setup
"RTN","SAMIHL7",154,0)
 ;
"RTN","SAMIHL7",155,0)
 kill ^KBAP("SAMIHL7")
"RTN","SAMIHL7",156,0)
 set ^KBAP("SAMIHL7","UPDTPTL")=""
"RTN","SAMIHL7",157,0)
 ;
"RTN","SAMIHL7",158,0)
 ; bail if we didn't get a fields array
"RTN","SAMIHL7",159,0)
 quit:'$data(fields)
"RTN","SAMIHL7",160,0)
 ;
"RTN","SAMIHL7",161,0)
 ;
"RTN","SAMIHL7",162,0)
UPDTPTL1 ;
"RTN","SAMIHL7",163,0)
 ;
"RTN","SAMIHL7",164,0)
 ;@falls-thru-from
"RTN","SAMIHL7",165,0)
 ; UPDTPTL
"RTN","SAMIHL7",166,0)
 ;@falls-thru-to
"RTN","SAMIHL7",167,0)
 ; MATCHLOG
"RTN","SAMIHL7",168,0)
 ;@called-by none
"RTN","SAMIHL7",169,0)
 ;@calls none
"RTN","SAMIHL7",170,0)
 ;
"RTN","SAMIHL7",171,0)
 set ^KBAP("SAMIHL7","UPDTPTL1")=""
"RTN","SAMIHL7",172,0)
 ;
"RTN","SAMIHL7",173,0)
 new rootpl s rootpl=$$setroot^%wd("patient-lookup")
"RTN","SAMIHL7",174,0)
 new ptienssn set ptienssn=0 ; patient ssn
"RTN","SAMIHL7",175,0)
 new ptiennm set ptiennm=0 ; patient name
"RTN","SAMIHL7",176,0)
 new ptiendob set ptiendob=0 ; patient dob
"RTN","SAMIHL7",177,0)
 new ptienssntmp set ptienssntmp=0 ; patient 1st ssn xref match
"RTN","SAMIHL7",178,0)
 new ptien set ptien=0 ; patient ien
"RTN","SAMIHL7",179,0)
 new newpat set newpat=1 ; new patient: default to true
"RTN","SAMIHL7",180,0)
 ;
"RTN","SAMIHL7",181,0)
 ; look for existing patients w/matching ssn. If one has matching name
"RTN","SAMIHL7",182,0)
 ; we don't make new patient; we update existing w/changelog.
"RTN","SAMIHL7",183,0)
 ;
"RTN","SAMIHL7",184,0)
 do
"RTN","SAMIHL7",185,0)
 . quit:'$length($get(fields("ssn")))  ; existing ssn
"RTN","SAMIHL7",186,0)
 . quit:'$data(@rootpl@("ssn",$get(fields("ssn"))))  ; matches lkup?
"RTN","SAMIHL7",187,0)
 . set ptienssntmp=$order(@rootpl@("ssn",$get(fields("ssn")),0)) ;save
"RTN","SAMIHL7",188,0)
 . for  do  quit:'ptienssn  quit:ptiennm
"RTN","SAMIHL7",189,0)
 . . set ptienssn=$order(@rootpl@("ssn",$get(fields("ssn")),ptienssn))
"RTN","SAMIHL7",190,0)
 . . quit:'ptienssn
"RTN","SAMIHL7",191,0)
 . . ;
"RTN","SAMIHL7",192,0)
 . . quit:'$length($get(fields("saminame")))
"RTN","SAMIHL7",193,0)
 . . new name set name=fields("saminame") ; existing name
"RTN","SAMIHL7",194,0)
 . . new chkname set chkname=@rootpl@(ptienssn,"saminame") ; new name
"RTN","SAMIHL7",195,0)
 . . quit:$$UP^XLFSTR(chkname)'=$$UP^XLFSTR(name)  ; uppercase equal?
"RTN","SAMIHL7",196,0)
 . . set ptiennm=ptienssn ; we have a match!
"RTN","SAMIHL7",197,0)
 . . quit
"RTN","SAMIHL7",198,0)
 . quit
"RTN","SAMIHL7",199,0)
 ;
"RTN","SAMIHL7",200,0)
 set ^KBAP("SAMIHL7","UPDTPTL1","A")=""
"RTN","SAMIHL7",201,0)
 ;
"RTN","SAMIHL7",202,0)
 if ptienssn,ptiennm do
"RTN","SAMIHL7",203,0)
 . new fixdob set fixdob=@rootpl@(ptienssn,"sbdob")
"RTN","SAMIHL7",204,0)
 . new year set year=$piece(fixdob,"-")
"RTN","SAMIHL7",205,0)
 . new month
"RTN","SAMIHL7",206,0)
 . set month=$translate($justify($piece(fixdob,"-",2),2)," ","0")
"RTN","SAMIHL7",207,0)
 . new day
"RTN","SAMIHL7",208,0)
 . set day=$translate($justify($piece(fixdob,"-",3),2)," ","0")
"RTN","SAMIHL7",209,0)
 . set fixdob=year_"-"_month_"-"_day
"RTN","SAMIHL7",210,0)
 . if $length($get(fields("sbdob"))),fixdob=fields("sbdob") do
"RTN","SAMIHL7",211,0)
 . . set ptiendob=ptienssn
"RTN","SAMIHL7",212,0)
 . . quit
"RTN","SAMIHL7",213,0)
 . set newpat=0 ; not a new patient
"RTN","SAMIHL7",214,0)
 . set ptien=ptienssn ; existing patient!
"RTN","SAMIHL7",215,0)
 ;
"RTN","SAMIHL7",216,0)
 ;
"RTN","SAMIHL7",217,0)
 set ^KBAP("SAMIHL7","UPDTPTL1","B")=""
"RTN","SAMIHL7",218,0)
 ;
"RTN","SAMIHL7",219,0)
 ; if no name match, restore ptienssn to 1st ssn xref match
"RTN","SAMIHL7",220,0)
 set:'ptienssn ptienssn=ptienssntmp
"RTN","SAMIHL7",221,0)
 ;
"RTN","SAMIHL7",222,0)
 ; if existing patient, save existing data
"RTN","SAMIHL7",223,0)
 new oldarr
"RTN","SAMIHL7",224,0)
 merge:ptien oldarr=@rootpl@(ptien)
"RTN","SAMIHL7",225,0)
 ;
"RTN","SAMIHL7",226,0)
 ;
"RTN","SAMIHL7",227,0)
 set ^KBAP("SAMIHL7","UPDTPTL1","C")=""
"RTN","SAMIHL7",228,0)
 ;
"RTN","SAMIHL7",229,0)
 ; if new patient, get next ptien to use & set dfn
"RTN","SAMIHL7",230,0)
 if '$get(ptien) do
"RTN","SAMIHL7",231,0)
 . set ptien=$order(@rootpl@(999999999),-1)+1
"RTN","SAMIHL7",232,0)
 . set fields("dfn")=ptien
"RTN","SAMIHL7",233,0)
 . set newpat=1
"RTN","SAMIHL7",234,0)
 . quit
"RTN","SAMIHL7",235,0)
 ;
"RTN","SAMIHL7",236,0)
 ;
"RTN","SAMIHL7",237,0)
 set ^KBAP("SAMIHL7","UPDTPTL1","D")=""
"RTN","SAMIHL7",238,0)
 ;
"RTN","SAMIHL7",239,0)
 set ^KBAP("SAMIHL7","ptien","newpat")=$get(ptien)_"^"_$get(newpat)
"RTN","SAMIHL7",240,0)
 set ^KBAP("SAMIHL7","fields(dfn)")=$get(fields("dfn"))
"RTN","SAMIHL7",241,0)
 ;
"RTN","SAMIHL7",242,0)
 ; bail if for some reason we didn't get next patient ien
"RTN","SAMIHL7",243,0)
 quit:'ptien
"RTN","SAMIHL7",244,0)
 ;
"RTN","SAMIHL7",245,0)
 merge ^KBAP("SAMIHL7","fields")=fields
"RTN","SAMIHL7",246,0)
 set ^KBAP("SAMIHL7","ptien")=$get(ptien)
"RTN","SAMIHL7",247,0)
 ;
"RTN","SAMIHL7",248,0)
 ;
"RTN","SAMIHL7",249,0)
MATCHLOG ; build MATCHLOG
"RTN","SAMIHL7",250,0)
 ;
"RTN","SAMIHL7",251,0)
 ;@falls-thru-from
"RTN","SAMIHL7",252,0)
 ; UPDTPTL-UPDTPTL1
"RTN","SAMIHL7",253,0)
 ;@called-by none
"RTN","SAMIHL7",254,0)
 ;@calls
"RTN","SAMIHL7",255,0)
 ; $$FMTE^XLFDT
"RTN","SAMIHL7",256,0)
 ; $$NOW^XLFDT
"RTN","SAMIHL7",257,0)
 ; $$UP^XLFSTR
"RTN","SAMIHL7",258,0)
 ; $$HTE^XLFDT
"RTN","SAMIHL7",259,0)
 ; KILLREF
"RTN","SAMIHL7",260,0)
 ; CAPTORM
"RTN","SAMIHL7",261,0)
 ;
"RTN","SAMIHL7",262,0)
 ; If adding new patient, check whether we had a match for ssn or name
"RTN","SAMIHL7",263,0)
 ; on an existing patient (with precedence to the ssn). If so set
"RTN","SAMIHL7",264,0)
 ; MATCHLOG = new patient ien & add index to existing patient.
"RTN","SAMIHL7",265,0)
 ;
"RTN","SAMIHL7",266,0)
 new var
"RTN","SAMIHL7",267,0)
 new newptien set newptien=""
"RTN","SAMIHL7",268,0)
 if newpat do
"RTN","SAMIHL7",269,0)
 . set newptien=ptien ; ien of the new patient being added
"RTN","SAMIHL7",270,0)
 . ;
"RTN","SAMIHL7",271,0)
 . ; if 1 or more existing entries w/this ssn, set MATCHLOG
"RTN","SAMIHL7",272,0)
 . ;
"RTN","SAMIHL7",273,0)
 . if ptienssn do  quit
"RTN","SAMIHL7",274,0)
 . . new ssnien set ssnien=0
"RTN","SAMIHL7",275,0)
 . . for  do  quit:'ssnien
"RTN","SAMIHL7",276,0)
 . . . set ssnien=$order(@rootpl@("ssn",$get(fields("ssn")),ssnien))
"RTN","SAMIHL7",277,0)
 . . . quit:'ssnien
"RTN","SAMIHL7",278,0)
 . . . set @rootpl@(ssnien,"HL7MATCHLOG")=newptien
"RTN","SAMIHL7",279,0)
 . . . set @rootpl@("HL7MATCHLOG",ssnien,newptien)=""
"RTN","SAMIHL7",280,0)
 . . . use $principal
"RTN","SAMIHL7",281,0)
 . . . write !,"HL7MATCHLOG ssn","--- ssnien=",ssnien
"RTN","SAMIHL7",282,0)
 . . . write "--- newptien=",newptien
"RTN","SAMIHL7",283,0)
 . . . quit
"RTN","SAMIHL7",284,0)
 . . quit
"RTN","SAMIHL7",285,0)
 . ;
"RTN","SAMIHL7",286,0)
 . ; if 1 or more existing entries w/this patient name, set MATCHLOG
"RTN","SAMIHL7",287,0)
 . ;
"RTN","SAMIHL7",288,0)
 . if ptiennm do
"RTN","SAMIHL7",289,0)
 . . new pnien set pnien=0
"RTN","SAMIHL7",290,0)
 . . for  do  quit:'pnien
"RTN","SAMIHL7",291,0)
 . . . set pnien=$order(@rootpl@("name",$g(fields("saminame")),pnien))
"RTN","SAMIHL7",292,0)
 . . . quit:'pnien
"RTN","SAMIHL7",293,0)
 . . . set @rootpl@(pnien,"HL7MATCHLOG")=newptien
"RTN","SAMIHL7",294,0)
 . . . set @rootpl@("HL7MATCHLOG",pnien,newptien)=""
"RTN","SAMIHL7",295,0)
 . . . use $principal
"RTN","SAMIHL7",296,0)
 . . . write !,"HL7MATCHLOG name","---",pnien
"RTN","SAMIHL7",297,0)
 . . . quit
"RTN","SAMIHL7",298,0)
 . . quit
"RTN","SAMIHL7",299,0)
 . quit
"RTN","SAMIHL7",300,0)
 ;
"RTN","SAMIHL7",301,0)
 ;
"RTN","SAMIHL7",302,0)
 new field set field=""
"RTN","SAMIHL7",303,0)
 ; run through every fields subscript and set the
"RTN","SAMIHL7",304,0)
 ;   appropriate subscript patient entry in patient-lookup
"RTN","SAMIHL7",305,0)
 for  do  quit:field=""
"RTN","SAMIHL7",306,0)
 . set field=$order(fields(field))
"RTN","SAMIHL7",307,0)
 . quit:field=""
"RTN","SAMIHL7",308,0)
 . ;
"RTN","SAMIHL7",309,0)
 . ; new patient ====================================
"RTN","SAMIHL7",310,0)
 . ; if new patient just set all patient-lookup field w/data in field
"RTN","SAMIHL7",311,0)
 . ; array.
"RTN","SAMIHL7",312,0)
 . ;
"RTN","SAMIHL7",313,0)
 . ; Load ORM message data later
"RTN","SAMIHL7",314,0)
 . ;
"RTN","SAMIHL7",315,0)
 . if newpat do
"RTN","SAMIHL7",316,0)
 . . quit:field="ORM"
"RTN","SAMIHL7",317,0)
 . . set @rootpl@(ptien,field)=fields(field)
"RTN","SAMIHL7",318,0)
 . . quit
"RTN","SAMIHL7",319,0)
 . ;
"RTN","SAMIHL7",320,0)
 . ; old patient ====================================
"RTN","SAMIHL7",321,0)
 . ; if not new patient, only store field results that are NOT null.
"RTN","SAMIHL7",322,0)
 . ; Never overwrite existing patient's dfn; store dfn just received
"RTN","SAMIHL7",323,0)
 . ; in remotedfn field
"RTN","SAMIHL7",324,0)
 . ;
"RTN","SAMIHL7",325,0)
 . ; With existing patients, if new data for field doesn't match
"RTN","SAMIHL7",326,0)
 . ; pre-existing, save pre-existing data in changelog entry
"RTN","SAMIHL7",327,0)
 . ;
"RTN","SAMIHL7",328,0)
 . if '$get(newpat),fields(field)'="" do
"RTN","SAMIHL7",329,0)
 . . quit:field="ORM"
"RTN","SAMIHL7",330,0)
 . . quit:field="dfn"
"RTN","SAMIHL7",331,0)
 . . ;
"RTN","SAMIHL7",332,0)
 . . if $get(@rootpl@(ptien,field))'=fields(field) do
"RTN","SAMIHL7",333,0)
 . . . new now set now=$$FMTE^XLFDT($$NOW^XLFDT,5)
"RTN","SAMIHL7",334,0)
 . . . set @rootpl@(ptien,"hl7changelog",now,field)=fields(field)
"RTN","SAMIHL7",335,0)
 . . . quit
"RTN","SAMIHL7",336,0)
 . . set @rootpl@(ptien,field)=fields(field)
"RTN","SAMIHL7",337,0)
 . . quit
"RTN","SAMIHL7",338,0)
 . ;
"RTN","SAMIHL7",339,0)
 . ; indices =========================================
"RTN","SAMIHL7",340,0)
 . ; set all indices for old & new patients for this field
"RTN","SAMIHL7",341,0)
 . ; note: we must kill any existing earlier indices on existing
"RTN","SAMIHL7",342,0)
 . ; patients to prevent duplicate pointers
"RTN","SAMIHL7",343,0)
 . ;
"RTN","SAMIHL7",344,0)
 . quit:$get(fields(field))=""
"RTN","SAMIHL7",345,0)
 . ;
"RTN","SAMIHL7",346,0)
 . ; field=dfn =====================================
"RTN","SAMIHL7",347,0)
 . if field="dfn" do
"RTN","SAMIHL7",348,0)
 . . if newpat do
"RTN","SAMIHL7",349,0)
 . . . set @rootpl@("dfn",fields(field),ptien)=""
"RTN","SAMIHL7",350,0)
 . . . quit
"RTN","SAMIHL7",351,0)
 . . quit
"RTN","SAMIHL7",352,0)
 . ;
"RTN","SAMIHL7",353,0)
 . ; didn't get DFN from VA server (only ssn) so can't set remotedfn
"RTN","SAMIHL7",354,0)
 . ; field
"RTN","SAMIHL7",355,0)
 . set @rootpl@(ptien,"remotedfn")=""
"RTN","SAMIHL7",356,0)
 . ;
"RTN","SAMIHL7",357,0)
 . ; field=icn =====================================
"RTN","SAMIHL7",358,0)
 . if field="icn" do
"RTN","SAMIHL7",359,0)
 . . set @rootpl@("icn",fields(field),ptien)=""
"RTN","SAMIHL7",360,0)
 . . quit
"RTN","SAMIHL7",361,0)
 . ;
"RTN","SAMIHL7",362,0)
 . ; field=last5 ===================================
"RTN","SAMIHL7",363,0)
 . if field="last5" do
"RTN","SAMIHL7",364,0)
 . . if '$get(newpat) do
"RTN","SAMIHL7",365,0)
 . . . do KILLREF(field,$get(oldarr(field)),ptien)
"RTN","SAMIHL7",366,0)
 . . . quit
"RTN","SAMIHL7",367,0)
 . . set @rootpl@("last5",fields(field),ptien)=""
"RTN","SAMIHL7",368,0)
 . . quit
"RTN","SAMIHL7",369,0)
 . ;
"RTN","SAMIHL7",370,0)
 . ; field=saminame ================================
"RTN","SAMIHL7",371,0)
 . if field="saminame" do
"RTN","SAMIHL7",372,0)
 . . if '$get(newpat) do
"RTN","SAMIHL7",373,0)
 . . . do KILLREF(field,$get(oldarr(field)),ptien)
"RTN","SAMIHL7",374,0)
 . . . do KILLREF("name",$get(oldarr("name")),ptien)
"RTN","SAMIHL7",375,0)
 . . . do KILLREF("name",$$UP^XLFSTR($get(oldarr("name"))),ptien)
"RTN","SAMIHL7",376,0)
 . . . quit
"RTN","SAMIHL7",377,0)
 . . set @rootpl@("name",fields(field),ptien)=""
"RTN","SAMIHL7",378,0)
 . . set @rootpl@("saminame",fields(field),ptien)=""
"RTN","SAMIHL7",379,0)
 . . set @rootpl@("name",$$UP^XLFSTR(fields(field)),ptien)=""
"RTN","SAMIHL7",380,0)
 . . quit
"RTN","SAMIHL7",381,0)
 . ;
"RTN","SAMIHL7",382,0)
 . ; field=sinamef ==================================
"RTN","SAMIHL7",383,0)
 . if field="sinamef" do
"RTN","SAMIHL7",384,0)
 . . if '$get(newpat) do
"RTN","SAMIHL7",385,0)
 . . . do KILLREF(field,$get(oldarr(field)),ptien)
"RTN","SAMIHL7",386,0)
 . . . quit
"RTN","SAMIHL7",387,0)
 . . set @rootpl@(field,fields(field),ptien)=""
"RTN","SAMIHL7",388,0)
 . . quit
"RTN","SAMIHL7",389,0)
 . ;
"RTN","SAMIHL7",390,0)
 . ; field=sinamel ==================================
"RTN","SAMIHL7",391,0)
 . if field="sinamel" do
"RTN","SAMIHL7",392,0)
 . . if '$get(newpat) do
"RTN","SAMIHL7",393,0)
 . . . do KILLREF(field,$get(oldarr(field)),ptien)
"RTN","SAMIHL7",394,0)
 . . . quit
"RTN","SAMIHL7",395,0)
 . . set @rootpl@(field,fields(field),ptien)=""
"RTN","SAMIHL7",396,0)
 . . quit
"RTN","SAMIHL7",397,0)
 . ;
"RTN","SAMIHL7",398,0)
 . ; field=ssn ======================================
"RTN","SAMIHL7",399,0)
 . if field="ssn" do
"RTN","SAMIHL7",400,0)
 . . if '$get(newpat) do
"RTN","SAMIHL7",401,0)
 . . . do KILLREF(field,$get(oldarr(field)),ptien)
"RTN","SAMIHL7",402,0)
 . . . quit
"RTN","SAMIHL7",403,0)
 . . set @rootpl@(field,fields(field),ptien)=""
"RTN","SAMIHL7",404,0)
 . . quit
"RTN","SAMIHL7",405,0)
 . quit
"RTN","SAMIHL7",406,0)
 ;
"RTN","SAMIHL7",407,0)
 ;
"RTN","SAMIHL7",408,0)
 set @rootpl@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHL7",409,0)
 ;
"RTN","SAMIHL7",410,0)
 ; set so SAMIORM can use ptien to file HL7 messages
"RTN","SAMIHL7",411,0)
 set fields("ptien")=$get(ptien)
"RTN","SAMIHL7",412,0)
 ;
"RTN","SAMIHL7",413,0)
 ; now capture most recent ORM message
"RTN","SAMIHL7",414,0)
 do CAPTORM(.fields,rootpl,ptien)
"RTN","SAMIHL7",415,0)
 ;
"RTN","SAMIHL7",416,0)
 merge ^KBAP("SAMIHL7","fields")=fields
"RTN","SAMIHL7",417,0)
 ;
"RTN","SAMIHL7",418,0)
 quit  ; end of UPDTPTL-UPDTPTL1-MATCHLOG
"RTN","SAMIHL7",419,0)
 ;
"RTN","SAMIHL7",420,0)
 ;
"RTN","SAMIHL7",421,0)
 ;
"RTN","SAMIHL7",422,0)
CAPTORM(fields,rootpl,ptien) ; save all ORM fields in patient-lookup
"RTN","SAMIHL7",423,0)
 ;
"RTN","SAMIHL7",424,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHL7",425,0)
 ;
"RTN","SAMIHL7",426,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIHL7",427,0)
 ;@called-by
"RTN","SAMIHL7",428,0)
 ; UPDTPTL-UPDTPTL1-MATCHLOG
"RTN","SAMIHL7",429,0)
 ;@calls none
"RTN","SAMIHL7",430,0)
 ;@input
"RTN","SAMIHL7",431,0)
 ; .fields = fields array
"RTN","SAMIHL7",432,0)
 ; rootpl = patient-lookup root
"RTN","SAMIHL7",433,0)
 ; ptien = patient ien
"RTN","SAMIHL7",434,0)
 ;@output
"RTN","SAMIHL7",435,0)
 ; ORM fields are saved in patient-lookup
"RTN","SAMIHL7",436,0)
 ;
"RTN","SAMIHL7",437,0)
 ;
"RTN","SAMIHL7",438,0)
 ;@stanza 2 remove old field result from patient-lookup root
"RTN","SAMIHL7",439,0)
 ;
"RTN","SAMIHL7",440,0)
 new node set node=$name(fields("ORM"))
"RTN","SAMIHL7",441,0)
 new snode set snode=$piece(node,")")
"RTN","SAMIHL7",442,0)
 new invdt
"RTN","SAMIHL7",443,0)
 for  do   quit:node'[snode
"RTN","SAMIHL7",444,0)
 . set node=$query(@node)
"RTN","SAMIHL7",445,0)
 . quit:node'[snode
"RTN","SAMIHL7",446,0)
 . set invdt=$qsubscript(node,2)
"RTN","SAMIHL7",447,0)
 . set @rootpl@(ptien,"ORM",invdt,$qsubscript(node,3))=@node
"RTN","SAMIHL7",448,0)
 . quit
"RTN","SAMIHL7",449,0)
 ;
"RTN","SAMIHL7",450,0)
 ;
"RTN","SAMIHL7",451,0)
 ;@stanza 3 termination
"RTN","SAMIHL7",452,0)
 ;
"RTN","SAMIHL7",453,0)
 quit  ; end of CAPTORM
"RTN","SAMIHL7",454,0)
 ;
"RTN","SAMIHL7",455,0)
 ;
"RTN","SAMIHL7",456,0)
 ;
"RTN","SAMIHL7",457,0)
KILLREF(field,oldrslt,ptien) ; kill old field in patient-lookup root
"RTN","SAMIHL7",458,0)
 ;
"RTN","SAMIHL7",459,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHL7",460,0)
 ;
"RTN","SAMIHL7",461,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIHL7",462,0)
 ;@called-by
"RTN","SAMIHL7",463,0)
 ; UPDTPTL-UPDTPTL1-MATCHLOG
"RTN","SAMIHL7",464,0)
 ;@calls none
"RTN","SAMIHL7",465,0)
 ;@input
"RTN","SAMIHL7",466,0)
 ; ]rootpl = patient-lookup root
"RTN","SAMIHL7",467,0)
 ; field = name of field to kill
"RTN","SAMIHL7",468,0)
 ; oldrslt = old field value to kill
"RTN","SAMIHL7",469,0)
 ; ptien = patient ien
"RTN","SAMIHL7",470,0)
 ;@output
"RTN","SAMIHL7",471,0)
 ; field is killed
"RTN","SAMIHL7",472,0)
 ;
"RTN","SAMIHL7",473,0)
 ;
"RTN","SAMIHL7",474,0)
 ;@stanza 2 remove old field result from patient-lookup root
"RTN","SAMIHL7",475,0)
 ;
"RTN","SAMIHL7",476,0)
 quit:$get(oldrslt)=""
"RTN","SAMIHL7",477,0)
 kill @rootpl@(field,oldrslt,ptien)
"RTN","SAMIHL7",478,0)
 ;
"RTN","SAMIHL7",479,0)
 ;
"RTN","SAMIHL7",480,0)
 ;@stanza 3 termination
"RTN","SAMIHL7",481,0)
 ;
"RTN","SAMIHL7",482,0)
 quit  ; end of KILLREF
"RTN","SAMIHL7",483,0)
 ;
"RTN","SAMIHL7",484,0)
 ;
"RTN","SAMIHL7",485,0)
 ;
"RTN","SAMIHL7",486,0)
 ;@ppi ACK^SAMIHL7
"RTN","SAMIHL7",487,0)
ACK ; force a com ACK
"RTN","SAMIHL7",488,0)
 ;
"RTN","SAMIHL7",489,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHL7",490,0)
 ;
"RTN","SAMIHL7",491,0)
 ;;ppi;procedure;shell;silent;sac
"RTN","SAMIHL7",492,0)
 ;@called-by
"RTN","SAMIHL7",493,0)
 ; MSH^SAMIADT [<= EN^SAMIADT <= old HL7 app, no longer used]
"RTN","SAMIHL7",494,0)
 ; EN^SAMIORM [<= hl7 app INST-MCAR <= HL7, main vapals hl7 entry]
"RTN","SAMIHL7",495,0)
 ; EN-ACK^SAMITIU [<= old HL7 app, no longer used]
"RTN","SAMIHL7",496,0)
 ;@calls
"RTN","SAMIHL7",497,0)
 ; GENACK^HLMA1
"RTN","SAMIHL7",498,0)
 ;@input
"RTN","SAMIHL7",499,0)
 ;  expects all HL7 variables captured on message reception to be in
"RTN","SAMIHL7",500,0)
 ;  environment, incl:
"RTN","SAMIHL7",501,0)
 ; ]HL("EID")
"RTN","SAMIHL7",502,0)
 ; ]HL("EIDS")
"RTN","SAMIHL7",503,0)
 ; ]HLA
"RTN","SAMIHL7",504,0)
 ; ]HLA("HLA")
"RTN","SAMIHL7",505,0)
 ; ]HLREC("FS")
"RTN","SAMIHL7",506,0)
 ; ]HLREC("MID")
"RTN","SAMIHL7",507,0)
 ;@output
"RTN","SAMIHL7",508,0)
 ;  sends com ACK through appropriate link
"RTN","SAMIHL7",509,0)
 ; ]HLA("HLA",1)
"RTN","SAMIHL7",510,0)
 ; ]HLMTIENA
"RTN","SAMIHL7",511,0)
 ; ]HLP
"RTN","SAMIHL7",512,0)
 ; ]HLP("NAMESPACE")
"RTN","SAMIHL7",513,0)
 ; ^KBAP("SAMIHL7","HLA")
"RTN","SAMIHL7",514,0)
 ;
"RTN","SAMIHL7",515,0)
 ;
"RTN","SAMIHL7",516,0)
 ;@stanza 2 send HL7 ack message
"RTN","SAMIHL7",517,0)
 ;
"RTN","SAMIHL7",518,0)
 kill HLA("HLA")
"RTN","SAMIHL7",519,0)
 set HLA("HLA",1)="MSA"_HLREC("FS")_"CA"_HLREC("FS")_HLREC("MID")
"RTN","SAMIHL7",520,0)
 ;
"RTN","SAMIHL7",521,0)
 if $data(HLA("HLA")) do  quit
"RTN","SAMIHL7",522,0)
 . set HLP("NAMESPACE")="HL"
"RTN","SAMIHL7",523,0)
 . merge ^KBAP("SAMIHL7","HLA")=HLA
"RTN","SAMIHL7",524,0)
 . do GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"LM",1,.HLMTIENA,"",.HLP)
"RTN","SAMIHL7",525,0)
 . quit
"RTN","SAMIHL7",526,0)
 ;
"RTN","SAMIHL7",527,0)
 ;
"RTN","SAMIHL7",528,0)
 ;@stanza 3 termination
"RTN","SAMIHL7",529,0)
 ;
"RTN","SAMIHL7",530,0)
 quit  ; end of ACK
"RTN","SAMIHL7",531,0)
 ;
"RTN","SAMIHL7",532,0)
 ;
"RTN","SAMIHL7",533,0)
 ;
"RTN","SAMIHL7",534,0)
EOR ; end of routine SAMIHL7
"RTN","SAMINOT1")
0^1^B444173065
"RTN","SAMINOT1",1,0)
SAMINOT1 ;ven/gpl - text notes ;2021-05-21T20:47Z
"RTN","SAMINOT1",2,0)
 ;;18.0;SAMI;**2,6,8,10,11**;2020-01;Build 19
"RTN","SAMINOT1",3,0)
 ;;1.18.0.11+i11
"RTN","SAMINOT1",4,0)
 ;
"RTN","SAMINOT1",5,0)
 ; SAMINOT1 contains a web service & associated subroutines to produce
"RTN","SAMINOT1",6,0)
 ; VAPALS-ELCAP text notes.
"RTN","SAMINOT1",7,0)
 ;
"RTN","SAMINOT1",8,0)
 quit  ; no entry from top
"RTN","SAMINOT1",9,0)
 ;
"RTN","SAMINOT1",10,0)
 ;
"RTN","SAMINOT1",11,0)
 ;
"RTN","SAMINOT1",12,0)
 ;@section 0 primary development
"RTN","SAMINOT1",13,0)
 ;
"RTN","SAMINOT1",14,0)
 ;
"RTN","SAMINOT1",15,0)
 ;
"RTN","SAMINOT1",16,0)
 ;@routine-credits
"RTN","SAMINOT1",17,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMINOT1",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMINOT1",19,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMINOT1",20,0)
 ; http://vistaexpertise.net
"RTN","SAMINOT1",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMINOT1",22,0)
 ;@license see routine SAMIUL
"RTN","SAMINOT1",23,0)
 ;
"RTN","SAMINOT1",24,0)
 ;@last-updated 2021-05-21T20:47Z
"RTN","SAMINOT1",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMINOT1",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMINOT1",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMINOT1",28,0)
 ;@version 1.18.0.10+i11
"RTN","SAMINOT1",29,0)
 ;@release-date 2020-01
"RTN","SAMINOT1",30,0)
 ;@patch-list **2,6,8,10,11**
"RTN","SAMINOT1",31,0)
 ;
"RTN","SAMINOT1",32,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMINOT1",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMINOT1",34,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMINOT1",35,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMINOT1",36,0)
 ;@additional-dev Linda M. R. Yaw (lmry)
"RTN","SAMINOT1",37,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMINOT1",38,0)
 ;@additional-dev Alexis R. Carlson (arc)
"RTN","SAMINOT1",39,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMINOT1",40,0)
 ;@additional-dev Domenic DiNatale (dom)
"RTN","SAMINOT1",41,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMINOT1",42,0)
 ;
"RTN","SAMINOT1",43,0)
 ;@module-credits
"RTN","SAMINOT1",44,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMINOT1",45,0)
 ; (VA-PALS)
"RTN","SAMINOT1",46,0)
 ; http://va-pals.org/
"RTN","SAMINOT1",47,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMINOT1",48,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMINOT1",49,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMINOT1",50,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMINOT1",51,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMINOT1",52,0)
 ; http://ielcap.com/
"RTN","SAMINOT1",53,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMINOT1",54,0)
 ; http://paraxialtech.com/
"RTN","SAMINOT1",55,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMINOT1",56,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMINOT1",57,0)
 ;
"RTN","SAMINOT1",58,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMINOT1",59,0)
 ; see routine SAMINUL
"RTN","SAMINOT1",60,0)
 ;
"RTN","SAMINOT1",61,0)
 ;
"RTN","SAMINOT1",62,0)
 ;
"RTN","SAMINOT1",63,0)
 ;@section 1 wsi WSNOTE^SAMINOT1 & related subroutines
"RTN","SAMINOT1",64,0)
 ;
"RTN","SAMINOT1",65,0)
 ;
"RTN","SAMINOT1",66,0)
 ;
"RTN","SAMINOT1",67,0)
EXISTCE(SID,FORM) ; extrinsic returns "true" or "false"
"RTN","SAMINOT1",68,0)
 ;
"RTN","SAMINOT1",69,0)
 ; if a Chart Eligibility Note exists
"RTN","SAMINOT1",70,0)
 ;
"RTN","SAMINOT1",71,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",72,0)
 n gvals s gvals=$na(@root@("graph",SID,FORM))
"RTN","SAMINOT1",73,0)
 ;i $g(@root@("graph",SID,FORM,"sicechrt"))="y" q "true"
"RTN","SAMINOT1",74,0)
 i $g(@gvals@("chart-eligibility-complete"))="true" q "true"
"RTN","SAMINOT1",75,0)
 ;
"RTN","SAMINOT1",76,0)
 quit "false" ; end of $$EXISTCE
"RTN","SAMINOT1",77,0)
 ;
"RTN","SAMINOT1",78,0)
 ;
"RTN","SAMINOT1",79,0)
 ;
"RTN","SAMINOT1",80,0)
EXISTPRE(SID,FORM) ; extrinsic returns "true" or "false"
"RTN","SAMINOT1",81,0)
 ;
"RTN","SAMINOT1",82,0)
 ; if a Pre-enrollment Note exists
"RTN","SAMINOT1",83,0)
 ;
"RTN","SAMINOT1",84,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",85,0)
 n gvals s gvals=$na(@root@("graph",SID,FORM))
"RTN","SAMINOT1",86,0)
 ;i $g(@root@("graph",SID,FORM,"sipedisc"))="y" q "true"
"RTN","SAMINOT1",87,0)
 ;i $g(@gvals@("pre-note-complete"))="true" i $g(@gvals@("siperslt"))="y" q "true"
"RTN","SAMINOT1",88,0)
 i $g(@gvals@("pre-note-complete"))="true" q "true"
"RTN","SAMINOT1",89,0)
 ;
"RTN","SAMINOT1",90,0)
 quit "false" ; end of $$EXISTPRE
"RTN","SAMINOT1",91,0)
 ;
"RTN","SAMINOT1",92,0)
 ;
"RTN","SAMINOT1",93,0)
 ;
"RTN","SAMINOT1",94,0)
EXISTINT(SID,FORM) ; extrinsic returns "true" or "false"
"RTN","SAMINOT1",95,0)
 ;
"RTN","SAMINOT1",96,0)
 ; if an Intake Note exists
"RTN","SAMINOT1",97,0)
 ;
"RTN","SAMINOT1",98,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",99,0)
 i $g(@root@("graph",SID,FORM,"sistatus"))="y" q "true"
"RTN","SAMINOT1",100,0)
 ;
"RTN","SAMINOT1",101,0)
 quit "false" ; end of $$EXISTINT
"RTN","SAMINOT1",102,0)
 ;
"RTN","SAMINOT1",103,0)
 ;
"RTN","SAMINOT1",104,0)
 ;
"RTN","SAMINOT1",105,0)
WSNOTE(return,filter) ; web service which returns a text note
"RTN","SAMINOT1",106,0)
 ;
"RTN","SAMINOT1",107,0)
 n debug s debug=0
"RTN","SAMINOT1",108,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMINOT1",109,0)
 ;
"RTN","SAMINOT1",110,0)
 k return
"RTN","SAMINOT1",111,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMINOT1",112,0)
 ;
"RTN","SAMINOT1",113,0)
 n si
"RTN","SAMINOT1",114,0)
 s si=$g(filter("studyid"))
"RTN","SAMINOT1",115,0)
 i si="" d  ;
"RTN","SAMINOT1",116,0)
 . s si="XXX00333"
"RTN","SAMINOT1",117,0)
 q:si=""
"RTN","SAMINOT1",118,0)
 ;
"RTN","SAMINOT1",119,0)
 n samikey
"RTN","SAMINOT1",120,0)
 s samikey=$g(filter("form"))
"RTN","SAMINOT1",121,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",122,0)
 i samikey="" d  ;
"RTN","SAMINOT1",123,0)
 . s samikey=$o(@root@("graph",si,"siform"))
"RTN","SAMINOT1",124,0)
 . ;w !,samikey
"RTN","SAMINOT1",125,0)
 . ;b
"RTN","SAMINOT1",126,0)
 ;
"RTN","SAMINOT1",127,0)
 n vals
"RTN","SAMINOT1",128,0)
 m vals=@root@("graph",si,samikey)
"RTN","SAMINOT1",129,0)
 ;
"RTN","SAMINOT1",130,0)
 n note,nien,ntype
"RTN","SAMINOT1",131,0)
 s ntype=""
"RTN","SAMINOT1",132,0)
 s note=""
"RTN","SAMINOT1",133,0)
 s nien=$g(filter("nien"))
"RTN","SAMINOT1",134,0)
 i nien="" d
"RTN","SAMINOT1",135,0)
 . s:$g(vals("samistatus"))="complete" ntype="intake"
"RTN","SAMINOT1",136,0)
 . s:$g(vals("samistatus"))="chart-eligibility" ntype="eligibility"
"RTN","SAMINOT1",137,0)
 . s:$g(vals("samistatus"))="pre-enrollment-discussion" ntype="pre-note"
"RTN","SAMINOT1",138,0)
 . q:ntype=""
"RTN","SAMINOT1",139,0)
 . ;d nien=$$NTTYPE add code to pull the latest note by type
"RTN","SAMINOT1",140,0)
 q:nien=""
"RTN","SAMINOT1",141,0)
 n notebase
"RTN","SAMINOT1",142,0)
 s notebase=$$NTLOCN(si,samikey,nien) ; global location for the note
"RTN","SAMINOT1",143,0)
 s note=$na(@notebase@("text"))
"RTN","SAMINOT1",144,0)
 i '$d(@note) q
"RTN","SAMINOT1",145,0)
 ;
"RTN","SAMINOT1",146,0)
 new temp,tout
"RTN","SAMINOT1",147,0)
 do GETTMPL^SAMICASE("temp","vapals:note")
"RTN","SAMINOT1",148,0)
 quit:'$data(temp)
"RTN","SAMINOT1",149,0)
 ;
"RTN","SAMINOT1",150,0)
 n cnt s cnt=0
"RTN","SAMINOT1",151,0)
 n zi s zi=""
"RTN","SAMINOT1",152,0)
 ;
"RTN","SAMINOT1",153,0)
 f  s zi=$o(temp(zi)) q:zi=""  d  ;
"RTN","SAMINOT1",154,0)
 . ;
"RTN","SAMINOT1",155,0)
 . n line s line=temp(zi)
"RTN","SAMINOT1",156,0)
 . D LOAD^SAMIFORM(.line,samikey,si,.filter,.vals)
"RTN","SAMINOT1",157,0)
 . s temp(zi)=line
"RTN","SAMINOT1",158,0)
 . ;
"RTN","SAMINOT1",159,0)
 . s cnt=cnt+1
"RTN","SAMINOT1",160,0)
 . s tout(cnt)=temp(zi)
"RTN","SAMINOT1",161,0)
 . ;
"RTN","SAMINOT1",162,0)
 . i temp(zi)["report-text" d  ;
"RTN","SAMINOT1",163,0)
 . . i temp(zi)["#" q  ;
"RTN","SAMINOT1",164,0)
 . . n zj s zj=""
"RTN","SAMINOT1",165,0)
 . . f  s zj=$o(@note@(zj)) q:zj=""  d  ;
"RTN","SAMINOT1",166,0)
 . . . s cnt=cnt+1
"RTN","SAMINOT1",167,0)
 . . . ;s tout(cnt)=@note@(zj)_"<br>"
"RTN","SAMINOT1",168,0)
 . . . s tout(cnt)=@note@(zj)_$char(13,10)
"RTN","SAMINOT1",169,0)
 m return=tout
"RTN","SAMINOT1",170,0)
 ;
"RTN","SAMINOT1",171,0)
 quit  ; end of WSNOTE
"RTN","SAMINOT1",172,0)
 ;
"RTN","SAMINOT1",173,0)
 ;
"RTN","SAMINOT1",174,0)
 ;
"RTN","SAMINOT1",175,0)
NOTE(filter) ; extrnisic which creates a note
"RTN","SAMINOT1",176,0)
 ;
"RTN","SAMINOT1",177,0)
 ; returns 1 if successful, 0 if not
"RTN","SAMINOT1",178,0)
 ;
"RTN","SAMINOT1",179,0)
 ; set up patient values
"RTN","SAMINOT1",180,0)
 ;
"RTN","SAMINOT1",181,0)
 n vals
"RTN","SAMINOT1",182,0)
 ;
"RTN","SAMINOT1",183,0)
 n si
"RTN","SAMINOT1",184,0)
 s si=$g(filter("studyid"))
"RTN","SAMINOT1",185,0)
 i si="" d  ;
"RTN","SAMINOT1",186,0)
 . s si="XXX00333"
"RTN","SAMINOT1",187,0)
 q:si=""
"RTN","SAMINOT1",188,0)
 ;
"RTN","SAMINOT1",189,0)
 n samikey
"RTN","SAMINOT1",190,0)
 s samikey=$g(filter("form"))
"RTN","SAMINOT1",191,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",192,0)
 i samikey="" d  ;
"RTN","SAMINOT1",193,0)
 . s samikey=$o(@root@("graph",si,"siform"))
"RTN","SAMINOT1",194,0)
 . ;w !,samikey
"RTN","SAMINOT1",195,0)
 . ;b
"RTN","SAMINOT1",196,0)
 ;
"RTN","SAMINOT1",197,0)
 s vals=$na(@root@("graph",si,samikey))
"RTN","SAMINOT1",198,0)
 ;
"RTN","SAMINOT1",199,0)
 i '$d(@vals) d  q 0 ;
"RTN","SAMINOT1",200,0)
 . ;w !,"error, patient values not found"
"RTN","SAMINOT1",201,0)
 ;zwr @vals@(*)
"RTN","SAMINOT1",202,0)
 ;
"RTN","SAMINOT1",203,0)
 k ^SAMIUL("NOTE")
"RTN","SAMINOT1",204,0)
 m ^SAMIUL("NOTE","vals")=@vals
"RTN","SAMINOT1",205,0)
 m ^SAMIUL("NOTE","filter")=filter
"RTN","SAMINOT1",206,0)
 ;
"RTN","SAMINOT1",207,0)
 n didnote s didnote=0
"RTN","SAMINOT1",208,0)
 ;
"RTN","SAMINOT1",209,0)
 i $g(@vals@("samistatus"))="chart-eligibility" d  ;
"RTN","SAMINOT1",210,0)
 . q:$g(@vals@("chart-eligibility-complete"))="true"
"RTN","SAMINOT1",211,0)
 . d MKEL(si,samikey,vals,.filter) ;
"RTN","SAMINOT1",212,0)
 . s didnote=1
"RTN","SAMINOT1",213,0)
 ;
"RTN","SAMINOT1",214,0)
 i $g(@vals@("samistatus"))="pre-enrollment-discussion" d  ;
"RTN","SAMINOT1",215,0)
 . q:$g(@vals@("pre-note-complete"))="true"
"RTN","SAMINOT1",216,0)
 . d MKPRE(si,samikey,vals,.filter) ;
"RTN","SAMINOT1",217,0)
 . s didnote=1
"RTN","SAMINOT1",218,0)
 ;
"RTN","SAMINOT1",219,0)
 i $g(@vals@("samistatus"))="complete" d  ;
"RTN","SAMINOT1",220,0)
 . q:$$HASINNT(vals)
"RTN","SAMINOT1",221,0)
 . d MKIN(si,samikey,vals,.filter) ;
"RTN","SAMINOT1",222,0)
 . s didnote=1
"RTN","SAMINOT1",223,0)
 ;
"RTN","SAMINOT1",224,0)
 n nien s nien=0
"RTN","SAMINOT1",225,0)
 i didnote=1 s nien=$$NTIEN(si,samikey)
"RTN","SAMINOT1",226,0)
 ;
"RTN","SAMINOT1",227,0)
 quit nien ; end of $$NOTE
"RTN","SAMINOT1",228,0)
 ;
"RTN","SAMINOT1",229,0)
 ;
"RTN","SAMINOT1",230,0)
 ;
"RTN","SAMINOT1",231,0)
HASINNT(vals) ; extrinsic returns 1 if intake note is present
"RTN","SAMINOT1",232,0)
 ;
"RTN","SAMINOT1",233,0)
 ; else returns 0
"RTN","SAMINOT1",234,0)
 ;
"RTN","SAMINOT1",235,0)
 n zzi,zzrtn s (zzi,zzrtn)=0
"RTN","SAMINOT1",236,0)
 q:'$d(@vals)
"RTN","SAMINOT1",237,0)
 f  s zzi=$o(@vals@("notes",zzi)) q:+zzi=0  d  ;
"RTN","SAMINOT1",238,0)
 . i $g(@vals@("notes",zzi,"name"))["Intake" s zzrtn=1
"RTN","SAMINOT1",239,0)
 ;
"RTN","SAMINOT1",240,0)
 quit zzrtn ; end of $$HASINNT
"RTN","SAMINOT1",241,0)
 ;
"RTN","SAMINOT1",242,0)
 ;
"RTN","SAMINOT1",243,0)
 ;
"RTN","SAMINOT1",244,0)
MKEL(sid,form,vals,filter) ;
"RTN","SAMINOT1",245,0)
 ;
"RTN","SAMINOT1",246,0)
 n cnt s cnt=0
"RTN","SAMINOT1",247,0)
 ;n dest s dest=$na(@vals@("eligibility-note"))
"RTN","SAMINOT1",248,0)
 n dest s dest=$$MKNT(vals,"Eligibility Note","eligibility",.filter)
"RTN","SAMINOT1",249,0)
 k @dest
"RTN","SAMINOT1",250,0)
 d OUT("Lung Screening Program Chart Eligibility Note")
"RTN","SAMINOT1",251,0)
 d OUT("")
"RTN","SAMINOT1",252,0)
 d ELNOTE(vals,dest,cnt)
"RTN","SAMINOT1",253,0)
 ;
"RTN","SAMINOT1",254,0)
 quit  ; end of MKEL
"RTN","SAMINOT1",255,0)
 ;
"RTN","SAMINOT1",256,0)
 ;
"RTN","SAMINOT1",257,0)
 ;
"RTN","SAMINOT1",258,0)
MKPRE(sid,form,vals,filter) ;
"RTN","SAMINOT1",259,0)
 ;
"RTN","SAMINOT1",260,0)
 n cnt s cnt=0
"RTN","SAMINOT1",261,0)
 ;n dest s dest=$na(@vals@("pre-note"))
"RTN","SAMINOT1",262,0)
 n dest s dest=$$MKNT(vals,"Pre-enrollment Discussion Note","prenote",.filter)
"RTN","SAMINOT1",263,0)
 k @dest
"RTN","SAMINOT1",264,0)
 i $g(@vals@("chart-eligibility-complete"))'="true" d  ;
"RTN","SAMINOT1",265,0)
 . d OUT("Lung Screening Program Chart Eligibility and Pre-enrollment Discussion Note")
"RTN","SAMINOT1",266,0)
 . d OUT("")
"RTN","SAMINOT1",267,0)
 . d ELNOTE(vals,dest,cnt)
"RTN","SAMINOT1",268,0)
 i $g(@vals@("chart-eligibility-complete"))="true" d  ;
"RTN","SAMINOT1",269,0)
 . d OUT("Lung Screening Program Pre-enrollment Discussion Note")
"RTN","SAMINOT1",270,0)
 . d OUT("")
"RTN","SAMINOT1",271,0)
 d PRENOTE(vals,dest,cnt)
"RTN","SAMINOT1",272,0)
 ;
"RTN","SAMINOT1",273,0)
 quit  ; end of MKPRE
"RTN","SAMINOT1",274,0)
 ;
"RTN","SAMINOT1",275,0)
 ;
"RTN","SAMINOT1",276,0)
 ;
"RTN","SAMINOT1",277,0)
MKIN(sid,form,vals,filter) ;
"RTN","SAMINOT1",278,0)
 ;
"RTN","SAMINOT1",279,0)
 n cnt s cnt=0
"RTN","SAMINOT1",280,0)
 ;n dest s dest=$na(@vals@("intake-note"))
"RTN","SAMINOT1",281,0)
 n dest s dest=$$MKNT(vals,"Intake Note","intake",.filter)
"RTN","SAMINOT1",282,0)
 k @dest
"RTN","SAMINOT1",283,0)
 d OUT("Lung Screening Program Intake Note")
"RTN","SAMINOT1",284,0)
 d OUT("")
"RTN","SAMINOT1",285,0)
 i $g(@vals@("chart-eligibility-complete"))'="true" d  ;
"RTN","SAMINOT1",286,0)
 . d ELNOTE(vals,dest,cnt)
"RTN","SAMINOT1",287,0)
 i $g(@vals@("pre-note-complete"))'="true" d  ;
"RTN","SAMINOT1",288,0)
 . d PRENOTE(vals,dest,cnt)
"RTN","SAMINOT1",289,0)
 d INNOTE(vals,dest,cnt)
"RTN","SAMINOT1",290,0)
 ;
"RTN","SAMINOT1",291,0)
 quit  ; end of MKIN
"RTN","SAMINOT1",292,0)
 ;
"RTN","SAMINOT1",293,0)
 ;
"RTN","SAMINOT1",294,0)
 ;
"RTN","SAMINOT1",295,0)
MKNT(vals,title,ntype,filter) ; extrinsic makes a note date=now returns 
"RTN","SAMINOT1",296,0)
 ;
"RTN","SAMINOT1",297,0)
 ; global addr. filter must be passed by reference
"RTN","SAMINOT1",298,0)
 ;
"RTN","SAMINOT1",299,0)
 n ntdt s ntdt=$$NTDTTM($$NOW^XLFDT)
"RTN","SAMINOT1",300,0)
 n ntptr
"RTN","SAMINOT1",301,0)
 s ntptr=$$MKNTLOC(vals,title,ntdt,$g(ntype),.filter)
"RTN","SAMINOT1",302,0)
 ;
"RTN","SAMINOT1",303,0)
 quit ntptr ; end of $$MKNT
"RTN","SAMINOT1",304,0)
 ;
"RTN","SAMINOT1",305,0)
 ;
"RTN","SAMINOT1",306,0)
 ;
"RTN","SAMINOT1",307,0)
MKNTLOC(vals,title,ndate,ntype,filter) ; extrinsic returns the 
"RTN","SAMINOT1",308,0)
 ;
"RTN","SAMINOT1",309,0)
 ;location for the note
"RTN","SAMINOT1",310,0)
 ;
"RTN","SAMINOT1",311,0)
 n nien
"RTN","SAMINOT1",312,0)
 s nien=$o(@vals@("notes",""),-1)+1
"RTN","SAMINOT1",313,0)
 s filter("nien")=nien
"RTN","SAMINOT1",314,0)
 n nloc s nloc=$na(@vals@("notes",nien))
"RTN","SAMINOT1",315,0)
 s @nloc@("name")=title_" "_$g(ndate)
"RTN","SAMINOT1",316,0)
 s @nloc@("date")=$g(ndate)
"RTN","SAMINOT1",317,0)
 s @nloc@("type")=$g(ntype)
"RTN","SAMINOT1",318,0)
 ;
"RTN","SAMINOT1",319,0)
 quit $name(@nloc@("text")) ; end of $$MKNTLOC
"RTN","SAMINOT1",320,0)
 ;
"RTN","SAMINOT1",321,0)
 ;
"RTN","SAMINOT1",322,0)
 ;
"RTN","SAMINOT1",323,0)
NTDTTM(ZFMDT) ; extrinsic returns the date and time in Note format
"RTN","SAMINOT1",324,0)
 ;
"RTN","SAMINOT1",325,0)
 ; ZFMDT is the fileman date/time to translate
"RTN","SAMINOT1",326,0)
 ;
"RTN","SAMINOT1",327,0)
 quit $$FMTE^XLFDT(ZFMDT,"5") ; end of $$NTDTTM
"RTN","SAMINOT1",328,0)
 ;
"RTN","SAMINOT1",329,0)
 ;
"RTN","SAMINOT1",330,0)
 ;
"RTN","SAMINOT1",331,0)
NTLOCN(sid,form,nien) ; extrinsic returns the location of the Nth note
"RTN","SAMINOT1",332,0)
 ;
"RTN","SAMINOT1",333,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",334,0)
 ;
"RTN","SAMINOT1",335,0)
 quit $name(@root@("graph",sid,form,"notes",nien)) ; end of $$NTLOCN
"RTN","SAMINOT1",336,0)
 ;
"RTN","SAMINOT1",337,0)
 ;
"RTN","SAMINOT1",338,0)
 ;
"RTN","SAMINOT1",339,0)
NTLAST(sid,form,ntype) ; extrinsic returns the location of the latest note
"RTN","SAMINOT1",340,0)
 ;
"RTN","SAMINOT1",341,0)
 ; of the type ntype
"RTN","SAMINOT1",342,0)
 ;
"RTN","SAMINOT1",343,0)
 quit  ; end of NTLAST
"RTN","SAMINOT1",344,0)
 ;
"RTN","SAMINOT1",345,0)
 ;
"RTN","SAMINOT1",346,0)
 ;
"RTN","SAMINOT1",347,0)
NTIEN(sid,form) ; extrinsic which returns the latest note for this form
"RTN","SAMINOT1",348,0)
 ;
"RTN","SAMINOT1",349,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",350,0)
 n rtn s rtn=$o(@root@("graph",sid,form,"notes"," "),-1)
"RTN","SAMINOT1",351,0)
 ;
"RTN","SAMINOT1",352,0)
 quit rtn ; end of $$NTIEN
"RTN","SAMINOT1",353,0)
 ;
"RTN","SAMINOT1",354,0)
 ;
"RTN","SAMINOT1",355,0)
 ;
"RTN","SAMINOT1",356,0)
NTLIST(nlist,sid,form) ; returns the note list in nlist, passed by ref
"RTN","SAMINOT1",357,0)
 ;
"RTN","SAMINOT1",358,0)
 n zn,root,gn
"RTN","SAMINOT1",359,0)
 s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",360,0)
 s zn=0
"RTN","SAMINOT1",361,0)
 s gn=$na(@root@("graph",sid,form,"notes"))
"RTN","SAMINOT1",362,0)
 q:'$d(@gn)
"RTN","SAMINOT1",363,0)
 f  s zn=$o(@gn@(zn)) q:+zn=0  d  ;
"RTN","SAMINOT1",364,0)
 . s @nlist@(zn,"name")=@gn@(zn,"name")
"RTN","SAMINOT1",365,0)
 . s @nlist@(zn,"nien")=zn
"RTN","SAMINOT1",366,0)
 ;
"RTN","SAMINOT1",367,0)
 quit  ; end of NTLIST
"RTN","SAMINOT1",368,0)
 ;
"RTN","SAMINOT1",369,0)
 ;
"RTN","SAMINOT1",370,0)
 ;
"RTN","SAMINOT1",371,0)
TLST ;
"RTN","SAMINOT1",372,0)
 ;
"RTN","SAMINOT1",373,0)
 set SID="XXX00677"
"RTN","SAMINOT1",374,0)
 set FORM="siform-2019-04-23"
"RTN","SAMINOT1",375,0)
 do NTLIST("G",SID,FORM)
"RTN","SAMINOT1",376,0)
 ;ZWR G
"RTN","SAMINOT1",377,0)
 ;
"RTN","SAMINOT1",378,0)
 quit  ; end of TLST
"RTN","SAMINOT1",379,0)
 ;
"RTN","SAMINOT1",380,0)
 ;
"RTN","SAMINOT1",381,0)
 ;
"RTN","SAMINOT1",382,0)
ELNOTE(vals,dest,cnt) ; eligibility NOTE TEXT
"RTN","SAMINOT1",383,0)
 ;
"RTN","SAMINOT1",384,0)
 D OUT("")
"RTN","SAMINOT1",385,0)
 D OUT("Date of chart review: "_$$XVAL("sidc",vals))
"RTN","SAMINOT1",386,0)
 D GLOUT("The participant was identified as a potential lung screening candidate by: ")
"RTN","SAMINOT1",387,0)
 D GLOUT($$XVAL("siceiden",vals),4)
"RTN","SAMINOT1",388,0)
 if $$XVAL("siceiden",vals)="referral" d  ;
"RTN","SAMINOT1",389,0)
 . D OUT("Date of Referral: "_$$XVAL("sicerfdt",vals))
"RTN","SAMINOT1",390,0)
 . n spec s spec=""
"RTN","SAMINOT1",391,0)
 . s:$$XVAL("sicerfpc",vals)="y" spec=spec_" Primary Care"
"RTN","SAMINOT1",392,0)
 . s:$$XVAL("sicerfwh",vals)="y" spec=spec_" Women's Health"
"RTN","SAMINOT1",393,0)
 . s:$$XVAL("sicerfge",vals)="y" spec=spec_" Geriatrics"
"RTN","SAMINOT1",394,0)
 . s:$$XVAL("sicerfpu",vals)="y" spec=spec_" Pulmonology"
"RTN","SAMINOT1",395,0)
 . s:$$XVAL("sicerfon",vals)="y" spec=spec_" Oncology"
"RTN","SAMINOT1",396,0)
 . s:$$XVAL("sicerfsc",vals)="y" spec=spec_" Smoking Cessation"
"RTN","SAMINOT1",397,0)
 . s:$$XVAL("sicerfot",vals)="y" spec=spec_" "_$$XVAL("sicerfoo",vals)
"RTN","SAMINOT1",398,0)
 . D GLOUT("Specialty of referring provider: ")
"RTN","SAMINOT1",399,0)
 . D GLOUT(spec,4)
"RTN","SAMINOT1",400,0)
 n elig
"RTN","SAMINOT1",401,0)
 s elig=$$XVAL("sicechrt",vals)
"RTN","SAMINOT1",402,0)
 D OUT("The participant is eligible based on chart review: "_$s(elig="y":"Yes",1:"no"))
"RTN","SAMINOT1",403,0)
 D OUT("")
"RTN","SAMINOT1",404,0)
 s @vals@("chart-eligibility-complete")="true"
"RTN","SAMINOT1",405,0)
 ;
"RTN","SAMINOT1",406,0)
 quit  ; end of ELNOTE
"RTN","SAMINOT1",407,0)
 ;
"RTN","SAMINOT1",408,0)
 ;
"RTN","SAMINOT1",409,0)
 ;
"RTN","SAMINOT1",410,0)
PRENOTE(vals,dest,cnt) ;
"RTN","SAMINOT1",411,0)
 ;
"RTN","SAMINOT1",412,0)
 i $g(@vals@("sipedisc"))'="y" q  ; no prelim discussion
"RTN","SAMINOT1",413,0)
 D OUT("")
"RTN","SAMINOT1",414,0)
 ;d OUT("A pre-enrollment discussion was held.")
"RTN","SAMINOT1",415,0)
 ;[If Yes is selected then add the following 5 lines]
"RTN","SAMINOT1",416,0)
 D OUT("The program attempted to reach the Veteran to discuss lung screening.")
"RTN","SAMINOT1",417,0)
 D OUT("Date of pre-enrollment discussion: "_$$XVAL("sipedc",vals))
"RTN","SAMINOT1",418,0)
 n via s via=""
"RTN","SAMINOT1",419,0)
 s:$$XVAL("sipecnip",vals)="1" via=via_" In person"
"RTN","SAMINOT1",420,0)
 s:$$XVAL("sipecnte",vals)="1" via=via_" Telephone"
"RTN","SAMINOT1",421,0)
 s:$$XVAL("sipecnth",vals)="1" via=via_" TeleHealth"
"RTN","SAMINOT1",422,0)
 s:$$XVAL("sipecnml",vals)="1" via=via_" Mailed Letter"
"RTN","SAMINOT1",423,0)
 s:$$XVAL("sipecnpp",vals)="1" via=via_" Message in patient portal"
"RTN","SAMINOT1",424,0)
 s:$$XVAL("sipecnvd",vals)="1" via=via_" Video-on-Demand (VOD)"
"RTN","SAMINOT1",425,0)
 s:$$XVAL("sipecnot",vals)="1" via=via_" "_$$XVAL("sipecnoo",vals)
"RTN","SAMINOT1",426,0)
 ;D OUT("The lung screening program reached the potential candidate or was contacted via:"_via)
"RTN","SAMINOT1",427,0)
 D GLOUT("The lung screening program reached the potential candidate or was contacted via:")
"RTN","SAMINOT1",428,0)
 D GLOUT(via,4)
"RTN","SAMINOT1",429,0)
 ;D OUT("The pre-enrollment discussion with the participant resulted in: "_$$SUBRSLT($$XVAL("siperslt",vals)))
"RTN","SAMINOT1",430,0)
 D OUT("The pre-enrollment discussion with the participant resulted in: ")
"RTN","SAMINOT1",431,0)
 D GLOUT($$SUBRSLT($$XVAL("siperslt",vals)),4)
"RTN","SAMINOT1",432,0)
 D OUT("Comments: ")
"RTN","SAMINOT1",433,0)
 D GLOUT($$XVAL("sipecmnt",vals),4)
"RTN","SAMINOT1",434,0)
 ;
"RTN","SAMINOT1",435,0)
 s @vals@("pre-note-complete")="true"
"RTN","SAMINOT1",436,0)
 ;
"RTN","SAMINOT1",437,0)
 quit  ; end of PRENOTE
"RTN","SAMINOT1",438,0)
 ;
"RTN","SAMINOT1",439,0)
 ;
"RTN","SAMINOT1",440,0)
 ;
"RTN","SAMINOT1",441,0)
SUBRSLT(XVAL) ; translation of discussion result
"RTN","SAMINOT1",442,0)
 ;
"RTN","SAMINOT1",443,0)
 q:XVAL="y" "Participant is interested in discussing lung screening. The program will proceed with enrollment process."
"RTN","SAMINOT1",444,0)
 q:XVAL="u" "Participant is unsure of lung screening. Ok to contact in the future."
"RTN","SAMINOT1",445,0)
 q:XVAL="nn" "Participant is not interested in discussing lung screening at this time. Ok to contact in the future."
"RTN","SAMINOT1",446,0)
 q:XVAL="nf" "Participant is not interested in discussing lung screening in the future."
"RTN","SAMINOT1",447,0)
 q:XVAL="na" "Unable to reach participant at this time"
"RTN","SAMINOT1",448,0)
 ;
"RTN","SAMINOT1",449,0)
 quit "" ; end of $$SUBRSLT
"RTN","SAMINOT1",450,0)
 ;
"RTN","SAMINOT1",451,0)
 ;
"RTN","SAMINOT1",452,0)
 ;
"RTN","SAMINOT1",453,0)
INNOTE(vals,dest,cnt) ;
"RTN","SAMINOT1",454,0)
 ;
"RTN","SAMINOT1",455,0)
 ;Lung Screening Program Intake Note
"RTN","SAMINOT1",456,0)
 ;
"RTN","SAMINOT1",457,0)
 ;Date of intake discussion contact:       [Date]
"RTN","SAMINOT1",458,0)
 ;How did you learn about the Lung Screening Program?:  [Selection]
"RTN","SAMINOT1",459,0)
 ;Primary address verified:                 [Yes/No]
"RTN","SAMINOT1",460,0)
 ;Rural status:                                        [Urban/Rural/Unknown]
"RTN","SAMINOT1",461,0)
 ;Preferred address and contact number:
"RTN","SAMINOT1",462,0)
 ;     [Address 1]
"RTN","SAMINOT1",463,0)
 ;           [Address 2]
"RTN","SAMINOT1",464,0)
 ;              [Address]
"RTN","SAMINOT1",465,0)
 ;
"RTN","SAMINOT1",466,0)
 ;Ever smoked?:            [Ever Smoked Text]
"RTN","SAMINOT1",467,0)
 ;Smoking Status:          [Never Smoked/Past/Current/Willing to Quit]
"RTN","SAMINOT1",468,0)
 ;CIGs per day:               [Input Number]
"RTN","SAMINOT1",469,0)
 ;PPD:                              [Computed Number]
"RTN","SAMINOT1",470,0)
 ;# of years:                    [Input Number]
"RTN","SAMINOT1",471,0)
 ;Pack Years:                   [Computed Number]
"RTN","SAMINOT1",472,0)
 ;
"RTN","SAMINOT1",473,0)
 ;[If a Quit Date is entered add the following line]
"RTN","SAMINOT1",474,0)
 ;Quit smoking on:         [Date]
"RTN","SAMINOT1",475,0)
 ;
"RTN","SAMINOT1",476,0)
 ;[If Smoking Cessation education text is entered add the following line]
"RTN","SAMINOT1",477,0)
 ;Smoking cessation education provided: [Show Input Text]
"RTN","SAMINOT1",478,0)
 ;
"RTN","SAMINOT1",479,0)
 ;[If a Lung Cancer Dx date is entered show the following 1 to 2 lines]
"RTN","SAMINOT1",480,0)
 ;Prior lung cancer diagnosis date: [Date]
"RTN","SAMINOT1",481,0)
 ;[If a location not in the VA is specified show the next line]
"RTN","SAMINOT1",482,0)
 ;Location where prior lung cancer diagnosis was made: [Location Text]
"RTN","SAMINOT1",483,0)
 ;
"RTN","SAMINOT1",484,0)
 ;[If Any Prior CT Date is entered show the following 1 to 2 lines]
"RTN","SAMINOT1",485,0)
 ;Prior CT:                   [Date]
"RTN","SAMINOT1",486,0)
 ;[If a location not in the VA is specified show the next line]
"RTN","SAMINOT1",487,0)
 ;Location where prior lung cancer diagnosis was made: [Location Text]
"RTN","SAMINOT1",488,0)
 ;
"RTN","SAMINOT1",489,0)
 ;Shared Decision Making:
"RTN","SAMINOT1",490,0)
 ;
"RTN","SAMINOT1",491,0)
 d OUT(" ")
"RTN","SAMINOT1",492,0)
 d OUT("   "_"Date of intake discussion contact: "_$$XVAL("sidc",vals))
"RTN","SAMINOT1",493,0)
 n learn s learn=""
"RTN","SAMINOT1",494,0)
 s:$$XVAL("silnip",vals) learn=learn_" In person"
"RTN","SAMINOT1",495,0)
 s:$$XVAL("silnph",vals) learn=learn_" Telephone"
"RTN","SAMINOT1",496,0)
 s:$$XVAL("silnth",vals) learn=learn_" TeleHealth"
"RTN","SAMINOT1",497,0)
 s:$$XVAL("silnml",vals) learn=learn_" Mailed letter"
"RTN","SAMINOT1",498,0)
 s:$$XVAL("silnpp",vals) learn=learn_" Message in patient portal"
"RTN","SAMINOT1",499,0)
 s:$$XVAL("silnvd",vals) learn=learn_" Video-on-Demand (VOD)"
"RTN","SAMINOT1",500,0)
 s:$$XVAL("silnot",vals) learn=learn_" "_$$XVAL("silnoo",vals)
"RTN","SAMINOT1",501,0)
 ;d GLOUT("   "_"How did you learn about the Lung Screening Program?: "_learn,4)
"RTN","SAMINOT1",502,0)
 d GLOUT("How did you learn about the Lung Screening Program?: ",4)
"RTN","SAMINOT1",503,0)
 d GLOUT(learn,6)
"RTN","SAMINOT1",504,0)
 n verified s verified=""
"RTN","SAMINOT1",505,0)
 s:$$XVAL("sipav",vals)="y" verified="Yes"
"RTN","SAMINOT1",506,0)
 s:$$XVAL("sipav",vals)="n" verified="No"
"RTN","SAMINOT1",507,0)
 d OUT("   "_"Primary address verified: "_verified)
"RTN","SAMINOT1",508,0)
 n rural s rural=""
"RTN","SAMINOT1",509,0)
 s:$$XVAL("sirs",vals)="r" rural="rural"
"RTN","SAMINOT1",510,0)
 s:$$XVAL("sirs",vals)="u" rural="urban"
"RTN","SAMINOT1",511,0)
 d OUT("   "_""_"Rural status: "_rural)
"RTN","SAMINOT1",512,0)
 d OUT("   "_"Preferred address and contact number: ")
"RTN","SAMINOT1",513,0)
 n pa s pa=""
"RTN","SAMINOT1",514,0)
 i $$XVAL("sipsa",vals)'="" d  ;
"RTN","SAMINOT1",515,0)
 . d OUT("      "_$$XVAL("sipsa",vals))
"RTN","SAMINOT1",516,0)
 . n csz s csz=""
"RTN","SAMINOT1",517,0)
 . s:$$XVAL("sipc",vals)'="" csz=$$XVAL("sipc",vals)
"RTN","SAMINOT1",518,0)
 . s:$$XVAL("sips",vals)'="" csz=csz_", "_$$XVAL("sips",vals)
"RTN","SAMINOT1",519,0)
 . s:$$XVAL("sipz",vals)'="" csz=csz_" "_$$XVAL("sipz",vals)
"RTN","SAMINOT1",520,0)
 . d OUT("      "_csz)
"RTN","SAMINOT1",521,0)
 d:$$XVAL("sippn",vals)'="" OUT("      "_$$XVAL("sippn",vals))
"RTN","SAMINOT1",522,0)
 d OUT("   "_"Ever smoked?: ")
"RTN","SAMINOT1",523,0)
 d GLOUT($$XVAL("sies",vals),6)
"RTN","SAMINOT1",524,0)
 n sstatus s sstatus=""
"RTN","SAMINOT1",525,0)
 s:$$XVAL("siesm",vals)="n" sstatus=sstatus_" Never smoked"
"RTN","SAMINOT1",526,0)
 s:$$XVAL("siesm",vals)="p" sstatus=sstatus_" Past"
"RTN","SAMINOT1",527,0)
 s:$$XVAL("siesm",vals)="c" sstatus=sstatus_" Current"
"RTN","SAMINOT1",528,0)
 s:$$XVAL("siesq",vals)=1 sstatus=sstatus_" Willing to quit"
"RTN","SAMINOT1",529,0)
 d OUT("   Smoking Status: "_sstatus)
"RTN","SAMINOT1",530,0)
 d OUT("   "_"CIGs per day: ")
"RTN","SAMINOT1",531,0)
 d OUT("      "_$$XVAL("sicpd",vals))
"RTN","SAMINOT1",532,0)
 d OUT("   "_"PPD: ")
"RTN","SAMINOT1",533,0)
 d OUT("      "_$$XVAL("sippd",vals))
"RTN","SAMINOT1",534,0)
 d OUT("   "_"# of years: ")
"RTN","SAMINOT1",535,0)
 d OUT("      "_$$XVAL("sisny",vals))
"RTN","SAMINOT1",536,0)
 d OUT("   "_"PPY: ")
"RTN","SAMINOT1",537,0)
 d OUT("      "_$$XVAL("sippy",vals))
"RTN","SAMINOT1",538,0)
 d OUT("")
"RTN","SAMINOT1",539,0)
 i $$XVAL("siq",vals)'="" d  ;
"RTN","SAMINOT1",540,0)
 . d OUT("Quit smoking on: "_$$XVAL("siq",vals))
"RTN","SAMINOT1",541,0)
 . d OUT("")
"RTN","SAMINOT1",542,0)
 i $$XVAL("sicep",vals)'="" d  ;
"RTN","SAMINOT1",543,0)
 . d OUT("Smoking cessation education provided:")
"RTN","SAMINOT1",544,0)
 . d GLOUT("    "_$$XVAL("sicep",vals),4)
"RTN","SAMINOT1",545,0)
 i $$XVAL("sicadx",vals)'="" d
"RTN","SAMINOT1",546,0)
 . d OUT("Prior lung cancer diagnosis date: "_$$XVAL("sicadx",vals))
"RTN","SAMINOT1",547,0)
 . i $$XVAL("sicadxl",vals)'="" d  ;
"RTN","SAMINOT1",548,0)
 . . d OUT("Location where prior lung cancer diagnosis was made:")
"RTN","SAMINOT1",549,0)
 . . d GLOUT("    "_$$XVAL("sicadxl",vals),4)
"RTN","SAMINOT1",550,0)
 i $$XVAL("siptct",vals)'="" d
"RTN","SAMINOT1",551,0)
 . d OUT("Prior CT: "_$$XVAL("siptct",vals))
"RTN","SAMINOT1",552,0)
 . i $$XVAL("siptctl",vals)'="" d  ;
"RTN","SAMINOT1",553,0)
 . . d OUT("Location where prior CT was made:")
"RTN","SAMINOT1",554,0)
 . . d GLOUT("    "_$$XVAL("siptctl",vals),4)
"RTN","SAMINOT1",555,0)
 d OUT(" ")
"RTN","SAMINOT1",556,0)
 d OUT("Shared Decision Making: ")
"RTN","SAMINOT1",557,0)
 d OUT(" ")
"RTN","SAMINOT1",558,0)
 n shareddm
"RTN","SAMINOT1",559,0)
 s shareddm=+$$XVAL("siidmdc",vals)
"RTN","SAMINOT1",560,0)
 i shareddm=1 d SDM(dest)
"RTN","SAMINOT1",561,0)
 e  d OUT("Shared decision making was not applicable")
"RTN","SAMINOT1",562,0)
 d OUT(" ")
"RTN","SAMINOT1",563,0)
 n ldct s ldct=""
"RTN","SAMINOT1",564,0)
 s:$$XVAL("sildct",vals)="n" ldct="No"
"RTN","SAMINOT1",565,0)
 s:$$XVAL("sildct",vals)="l" ldct="No"
"RTN","SAMINOT1",566,0)
 s:$$XVAL("sildct",vals)="y" ldct="Yes"
"RTN","SAMINOT1",567,0)
 d GLOUT("The veteran has decided to enroll in the Lung Screening Program: "_ldct)
"RTN","SAMINOT1",568,0)
 i $$XVAL("sildct",vals)="l" d  ;
"RTN","SAMINOT1",569,0)
 . d GLOUT("The veteran has indicated it is okay to contact in the future to discuss enrolling in the Lung Screening Program.",4)
"RTN","SAMINOT1",570,0)
 i ldct="Yes" d  ;
"RTN","SAMINOT1",571,0)
 . d OUT("LDCT ordered: "_ldct)
"RTN","SAMINOT1",572,0)
 . d OUT("    "_"Veteran enrolled in the LSS program. Results and coordination of care ")
"RTN","SAMINOT1",573,0)
 . d OUT("    "_"will be made by the LSS team.  ")
"RTN","SAMINOT1",574,0)
 . i $$XVAL("siclin",vals)'="" d  ;
"RTN","SAMINOT1",575,0)
 . . quit
"RTN","SAMINOT1",576,0)
 . quit
"RTN","SAMINOT1",577,0)
 n tmpclin s tmpclin=$$XVAL("siclin",vals)
"RTN","SAMINOT1",578,0)
 i tmpclin'="" d  ;
"RTN","SAMINOT1",579,0)
 . d OUT("Clinical Indications for Initial Screening CT:")
"RTN","SAMINOT1",580,0)
 . d GLOUT("    "_tmpclin,4)
"RTN","SAMINOT1",581,0)
 ;
"RTN","SAMINOT1",582,0)
 ;The veteran has decided to enroll in the Lung Screening Program: [Yes/No]
"RTN","SAMINOT1",583,0)
 ;
"RTN","SAMINOT1",584,0)
 ;[If Not enroll at this time but okay to contact in the future, add the following line]
"RTN","SAMINOT1",585,0)
 ;The veteran has indicated it is okay to contact in the future to discuss enrolling in the Lung Screening Program.
"RTN","SAMINOT1",586,0)
 ;
"RTN","SAMINOT1",587,0)
 ;[If Yes is answered for enrollment add the following two lines]
"RTN","SAMINOT1",588,0)
 ;LDCT ordered:                Yes
"RTN","SAMINOT1",589,0)
 ;Veteran enrolled in the Lung Screening Program. Results and coordination of care will be made by the Lung Screening Program team.
"RTN","SAMINOT1",590,0)
 ;
"RTN","SAMINOT1",591,0)
 ;[If Clinical Indication text is provided add them to the note]
"RTN","SAMINOT1",592,0)
 ;Clinical Indications:          [Show Input Text]
"RTN","SAMINOT1",593,0)
 ;
"RTN","SAMINOT1",594,0)
 ;
"RTN","SAMINOT1",595,0)
 quit  ; end of INNOTE
"RTN","SAMINOT1",596,0)
 ;
"RTN","SAMINOT1",597,0)
 ;
"RTN","SAMINOT1",598,0)
 ;
"RTN","SAMINOT1",599,0)
SDM(ary) ; adds Shared Decision Making text to array ary, passed by name
"RTN","SAMINOT1",600,0)
 ;
"RTN","SAMINOT1",601,0)
 n ii s ii=$o(@ary@(" "),-1)
"RTN","SAMINOT1",602,0)
 s ii=ii+1
"RTN","SAMINOT1",603,0)
 s @ary@(ii)="Veteran of age and exposure to cigarette smoke as described above, and "
"RTN","SAMINOT1",604,0)
 s ii=ii+1
"RTN","SAMINOT1",605,0)
 s @ary@(ii)="without a current diagnosis or obvious symptoms suggestive of lung cancer, "
"RTN","SAMINOT1",606,0)
 s ii=ii+1
"RTN","SAMINOT1",607,0)
 s @ary@(ii)="has been educated today about the estimated risk for lung cancer, the "
"RTN","SAMINOT1",608,0)
 s ii=ii+1
"RTN","SAMINOT1",609,0)
 s @ary@(ii)="possibility of cure or life prolonging if an early lung cancer were to be "
"RTN","SAMINOT1",610,0)
 s ii=ii+1
"RTN","SAMINOT1",611,0)
 s @ary@(ii)="found during screening, the possibility of imaging abnormalities not being "
"RTN","SAMINOT1",612,0)
 s ii=ii+1
"RTN","SAMINOT1",613,0)
 s @ary@(ii)="lung cancer, the possibility of complications from additional diagnostic "
"RTN","SAMINOT1",614,0)
 s ii=ii+1
"RTN","SAMINOT1",615,0)
 s @ary@(ii)="procedures, and the approximate amount of radiation exposure associated "
"RTN","SAMINOT1",616,0)
 s ii=ii+1
"RTN","SAMINOT1",617,0)
 s @ary@(ii)="with each screening procedure. In addition, the Veteran has been educated "
"RTN","SAMINOT1",618,0)
 s ii=ii+1
"RTN","SAMINOT1",619,0)
 s @ary@(ii)="today about the importance of adhering to annual lung screening, the "
"RTN","SAMINOT1",620,0)
 s ii=ii+1
"RTN","SAMINOT1",621,0)
 s @ary@(ii)="possible impact of other medical conditions on the overall health status, "
"RTN","SAMINOT1",622,0)
 s ii=ii+1
"RTN","SAMINOT1",623,0)
 s @ary@(ii)="the importance of avoiding exposure to cigarette smoke, available tobacco "
"RTN","SAMINOT1",624,0)
 s ii=ii+1
"RTN","SAMINOT1",625,0)
 s @ary@(ii)="cessation programs and available lung screening services at this site. "
"RTN","SAMINOT1",626,0)
 s ii=ii+1
"RTN","SAMINOT1",627,0)
 s @ary@(ii)="Education material was provided to the veteran. "
"RTN","SAMINOT1",628,0)
 s ii=ii+1
"RTN","SAMINOT1",629,0)
 ;s @ary@(ii)="Based on this information, the Veteran has opted for "
"RTN","SAMINOT1",630,0)
 ;
"RTN","SAMINOT1",631,0)
 quit  ; end of SDM
"RTN","SAMINOT1",632,0)
 ;
"RTN","SAMINOT1",633,0)
 ;
"RTN","SAMINOT1",634,0)
 ;
"RTN","SAMINOT1",635,0)
GLOUT(ln,indent) ; glob out first wrap ln then put it in dest
"RTN","SAMINOT1",636,0)
 ;
"RTN","SAMINOT1",637,0)
 n arytmp
"RTN","SAMINOT1",638,0)
 s arytmp(1)=ln
"RTN","SAMINOT1",639,0)
 i $g(indent)="" s indent=1
"RTN","SAMINOT1",640,0)
 d wrap^%tt("arytmp",indent_":80")
"RTN","SAMINOT1",641,0)
 n ii s ii=""
"RTN","SAMINOT1",642,0)
 f  s ii=$o(arytmp(ii)) q:ii=""  d  ;
"RTN","SAMINOT1",643,0)
 . d OUT(arytmp(ii))
"RTN","SAMINOT1",644,0)
 ;
"RTN","SAMINOT1",645,0)
 quit  ; end of GLOUT
"RTN","SAMINOT1",646,0)
 ;
"RTN","SAMINOT1",647,0)
 ;
"RTN","SAMINOT1",648,0)
 ;
"RTN","SAMINOT1",649,0)
OUT(ln) ;
"RTN","SAMINOT1",650,0)
 ;
"RTN","SAMINOT1",651,0)
 s cnt=cnt+1
"RTN","SAMINOT1",652,0)
 n lnn
"RTN","SAMINOT1",653,0)
 ;s debug=1
"RTN","SAMINOT1",654,0)
 s lnn=$o(@dest@(" "),-1)+1
"RTN","SAMINOT1",655,0)
 s @dest@(lnn)=ln
"RTN","SAMINOT1",656,0)
 ;
"RTN","SAMINOT1",657,0)
 ;i $g(debug)=1 d  ;
"RTN","SAMINOT1",658,0)
 ;. i ln["<" q  ; no markup
"RTN","SAMINOT1",659,0)
 ;. n zs s zs=$STACK
"RTN","SAMINOT1",660,0)
 ;. n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMINOT1",661,0)
 ;. s @dest@(lnn)=zp_":"_ln
"RTN","SAMINOT1",662,0)
 ;
"RTN","SAMINOT1",663,0)
 quit  ; end of OUT
"RTN","SAMINOT1",664,0)
 ;
"RTN","SAMINOT1",665,0)
 ;
"RTN","SAMINOT1",666,0)
 ;
"RTN","SAMINOT1",667,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMINOT1",668,0)
 ;
"RTN","SAMINOT1",669,0)
 ; vals is passed by name
"RTN","SAMINOT1",670,0)
 ;
"RTN","SAMINOT1",671,0)
 n zr
"RTN","SAMINOT1",672,0)
 s zr=$g(@vals@(var))
"RTN","SAMINOT1",673,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMINOT1",674,0)
 ;
"RTN","SAMINOT1",675,0)
 quit zr ; end of $$XVAL
"RTN","SAMINOT1",676,0)
 ;
"RTN","SAMINOT1",677,0)
 ;
"RTN","SAMINOT1",678,0)
 ;
"RTN","SAMINOT1",679,0)
EOR ; end of routine SAMINOT1
"RTN","SAMINUL")
0^3^B102256
"RTN","SAMINUL",1,0)
SAMINUL ;ven/gpl - ielcap: note log ;2021-05-21T20:47Z
"RTN","SAMINUL",2,0)
 ;;18.0;SAMI;**9,10,11**;2020-01;Build 19
"RTN","SAMINUL",3,0)
 ;;1.18.0.11+i11
"RTN","SAMINUL",4,0)
 ;
"RTN","SAMINUL",5,0)
 ; SAMINOTE contains subroutines for producing the ELCAP Note Pages.
"RTN","SAMINUL",6,0)
 ; SAMINUL contains the development log for the SAMINOT* routines.
"RTN","SAMINUL",7,0)
 ; It contains no executable code.
"RTN","SAMINUL",8,0)
 ;
"RTN","SAMINUL",9,0)
 quit  ; no entry from top
"RTN","SAMINUL",10,0)
 ;
"RTN","SAMINUL",11,0)
 ;
"RTN","SAMINUL",12,0)
 ;
"RTN","SAMINUL",13,0)
 ;@section 0 primary development
"RTN","SAMINUL",14,0)
 ;
"RTN","SAMINUL",15,0)
 ;
"RTN","SAMINUL",16,0)
 ;
"RTN","SAMINUL",17,0)
 ;@routine-credits
"RTN","SAMINUL",18,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMINUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMINUL",20,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMINUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMINUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMINUL",23,0)
 ;@license see routine SAMIUL
"RTN","SAMINUL",24,0)
 ;
"RTN","SAMINUL",25,0)
 ;@last-updated 2021-05-21T20:47Z
"RTN","SAMINUL",26,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMINUL",27,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMINUL",28,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMINUL",29,0)
 ;@version 1.18.0.10+i11
"RTN","SAMINUL",30,0)
 ;@release-date 2020-01
"RTN","SAMINUL",31,0)
 ;@patch-list **9,10,11**
"RTN","SAMINUL",32,0)
 ;
"RTN","SAMINUL",33,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMINUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMINUL",35,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMINUL",36,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMINUL",37,0)
 ;@additional-dev Linda M. R. Yaw (lmry)
"RTN","SAMINUL",38,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMINUL",39,0)
 ;@additional-dev Alexis R. Carlson (arc)
"RTN","SAMINUL",40,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMINUL",41,0)
 ;@additional-dev Domenic DiNatale (dom)
"RTN","SAMINUL",42,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMINUL",43,0)
 ;@additional-dev Kenneth McGlothlen (mcglk)
"RTN","SAMINUL",44,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMINUL",45,0)
 ;
"RTN","SAMINUL",46,0)
 ;@module-credits
"RTN","SAMINUL",47,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMINUL",48,0)
 ; (VA-PALS)
"RTN","SAMINUL",49,0)
 ; http://va-pals.org/
"RTN","SAMINUL",50,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMINUL",51,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMINUL",52,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMINUL",53,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMINUL",54,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMINUL",55,0)
 ; http://ielcap.com/
"RTN","SAMINUL",56,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMINUL",57,0)
 ; http://paraxialtech.com/
"RTN","SAMINUL",58,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMINUL",59,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMINUL",60,0)
 ;
"RTN","SAMINUL",61,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMINUL",62,0)
 ;
"RTN","SAMINUL",63,0)
 ; 2019-04-04/18 ven/gpl 1.18.0-t04 c0bb7dbf,f7b48936,9d1f2cdc,
"RTN","SAMINUL",64,0)
 ;  ba5f366d,5b2e32dc,ce322911
"RTN","SAMINUL",65,0)
 ;  SAMINOT1: flags for intake form, fix crash on intake form, initial
"RTN","SAMINUL",66,0)
 ; version of new intake notes, revise text for pre-enrollment
"RTN","SAMINUL",67,0)
 ; discusstion note, complete new intake notes, add intake notes to
"RTN","SAMINUL",68,0)
 ; case review page.
"RTN","SAMINUL",69,0)
 ;
"RTN","SAMINUL",70,0)
 ; 2019-04-16/23 ven/lgc 1.18.0-t04 e54b76d1,21388d8a,f0505e51,
"RTN","SAMINUL",71,0)
 ;  89bffd3b
"RTN","SAMINUL",72,0)
 ;  SAMINOT1: SAMIFRM2 > SAMIFORM, remove spaces at end of lines,
"RTN","SAMINUL",73,0)
 ; control characters, SAMISUB2 > LOAD.
"RTN","SAMINUL",74,0)
 ;
"RTN","SAMINUL",75,0)
 ; 2019-04-23 ven/toad 1.18.0-t04 423a3946
"RTN","SAMINUL",76,0)
 ;  SAMINOT1: resolve gpl/lgc collision, restore SAMISUB2 > LOAD.
"RTN","SAMINUL",77,0)
 ;
"RTN","SAMINUL",78,0)
 ; 2019-04-30 ven/gpl 1.18.0-t04 cf73510c
"RTN","SAMINUL",79,0)
 ;  SAMINOT1: additions to intake note for prior scans & format.
"RTN","SAMINUL",80,0)
 ;
"RTN","SAMINUL",81,0)
 ; 2019-05-07 ven/lmry 1.18.0-t04 4a8ead45
"RTN","SAMINUL",82,0)
 ;  SAMINOT1: edit SAMINOT1 for XINDEX.
"RTN","SAMINUL",83,0)
 ;
"RTN","SAMINUL",84,0)
 ; 2019-05-07 ven/lgc 1.18.0-t04 f63ef57c
"RTN","SAMINUL",85,0)
 ;  SAMINOT1: cleanup for XINDEX.
"RTN","SAMINUL",86,0)
 ;
"RTN","SAMINUL",87,0)
 ; 2019-06-18 ven/arc 1.18.0-t04 91022482
"RTN","SAMINUL",88,0)
 ;  SAMINOT1: ^SAMIGPL > ^SAMIUL.
"RTN","SAMINUL",89,0)
 ;
"RTN","SAMINUL",90,0)
 ; 2019-07-01 ven/gpl 1.18.0-t04 72868e60
"RTN","SAMINUL",91,0)
 ;  SAMINOT1: update shared decision making text in intake note.
"RTN","SAMINUL",92,0)
 ;
"RTN","SAMINUL",93,0)
 ; 2019-08-03/14 ven/gpl 1.18.0-t04 bea65f7b,578f61d4
"RTN","SAMINUL",94,0)
 ;  SAMINOT1: fix bugs in Have you ever smoked processing in changelog
"RTN","SAMINUL",95,0)
 ; & intake note, restored ever smoked comment field to intake note.
"RTN","SAMINUL",96,0)
 ;
"RTN","SAMINUL",97,0)
 ; 2019-09-06 par/dom 1.18.0-t04 2ff47189 VAP-452
"RTN","SAMINUL",98,0)
 ;  SAMINOT1: patient > participant.
"RTN","SAMINUL",99,0)
 ;
"RTN","SAMINUL",100,0)
 ; 2019-09-26 ven/gpl 1.18.0-t04 92b12324 VAP-420
"RTN","SAMINUL",101,0)
 ;  SAMINOT1: smoking history.
"RTN","SAMINUL",102,0)
 ;
"RTN","SAMINUL",103,0)
 ; 2019-10-01 par/dom 1.18.0-t04 37c418a1,4caf1a98 VAP-457,344
"RTN","SAMINUL",104,0)
 ;  SAMINOT1: remove thorax, capitalization consistency.
"RTN","SAMINUL",105,0)
 ;
"RTN","SAMINUL",106,0)
 ; 2020-01-17/20 ven/lgc 1.18.0.1+i1 8557207f,d7d24834,0301ad95.
"RTN","SAMINUL",107,0)
 ;  659f2526,0ff2b83f,49615242,5bf7c398,dc5f618c
"RTN","SAMINUL",108,0)
 ;  SAMINOT2: followup note, fixed typos in VC note, followup LCS note
"RTN","SAMINUL",109,0)
 ; minus CT Eval pulls, LCS note with CT Eval extracts, fixed bug in
"RTN","SAMINUL",110,0)
 ; LSC CT eval extract, include entire impression section of CT Eval
"RTN","SAMINUL",111,0)
 ; report in LCS Note, improved import of impressions, limit to one
"RTN","SAMINUL",112,0)
 ; note per followup form.
"RTN","SAMINUL",113,0)
 ;
"RTN","SAMINUL",114,0)
 ; 2020-01-23 ven/arc 1.18.0.2+i2 9a24242a
"RTN","SAMINUL",115,0)
 ;  SAMINOT1: fix word wrap on intake note & typos in ct
"RTN","SAMINUL",116,0)
 ; eval report.
"RTN","SAMINUL",117,0)
 ;
"RTN","SAMINUL",118,0)
 ; 2020-08-12 ven/gpl 1.18.0.6+i6 781744c3
"RTN","SAMINUL",119,0)
 ;  SAMINOT1: chg to support hl7 transmission of notes.
"RTN","SAMINUL",120,0)
 ;
"RTN","SAMINUL",121,0)
 ; 2020-09-22 ven/gpl 1.18.0.6+i6 06459eda
"RTN","SAMINUL",122,0)
 ;  SAMINOT1: fix to match kids file.
"RTN","SAMINUL",123,0)
 ;
"RTN","SAMINUL",124,0)
 ; 2021-02-01/24 ven/gpl 1.18.0.8+i8 8e4ec441,cde71a55
"RTN","SAMINUL",125,0)
 ;  SAMINOT1: fix intake note format, fix error that sent note twice
"RTN","SAMINUL",126,0)
 ; to VistA.
"RTN","SAMINUL",127,0)
 ;
"RTN","SAMINUL",128,0)
 ; 2021-03-02 ven/gpl 1.18.0.9+i9 479dc041
"RTN","SAMINUL",129,0)
 ;  SAMINOT2: return error message if no ct eval form exists when
"RTN","SAMINUL",130,0)
 ; generating a fu note.
"RTN","SAMINUL",131,0)
 ;
"RTN","SAMINUL",132,0)
 ; 2021-03-15/16 ven/toad 1.18.0.9+i9 a46a2cc1
"RTN","SAMINUL",133,0)
 ;  SAMINUL: create routine.
"RTN","SAMINUL",134,0)
 ;  SAMINOT2: bump date & patch list, add contents, lt refactor.
"RTN","SAMINUL",135,0)
 ;
"RTN","SAMINUL",136,0)
 ; 2021-03-17 ven/toad 1.18.0.9+i9 62da30b4
"RTN","SAMINUL",137,0)
 ; SAMINOT2: remove blank from end of 1 line.
"RTN","SAMINUL",138,0)
 ;
"RTN","SAMINUL",139,0)
 ; 2021-03-22 ven/gpl 1.18.0.10+i10 6319a1eb
"RTN","SAMINUL",140,0)
 ;  SAMINOT1: fix logic bug in detecting pre-enrollment existing.
"RTN","SAMINUL",141,0)
 ;
"RTN","SAMINUL",142,0)
 ; 2021-03-23 ven/toad 1.18.0.10+i10 96f461d0
"RTN","SAMINUL",143,0)
 ;  SAMINOT1: bump date & patch list, lt refactor.
"RTN","SAMINUL",144,0)
 ;
"RTN","SAMINUL",145,0)
 ; 2021-03-29 ven/gpl 1.18.0.11+i11 6cd83445 VAP-483
"RTN","SAMINUL",146,0)
 ;  SAMINOT1: allow N/A for shared decision making on intake form:
"RTN","SAMINUL",147,0)
 ; in INNOTE new & set shareddm & use to call SDM or report n/a, based
"RTN","SAMINUL",148,0)
 ; on siidmdc.
"RTN","SAMINUL",149,0)
 ;
"RTN","SAMINUL",150,0)
 ; 2021-03-30/05-21 ven/mcglk&toad 1.18.0.11+i11 7b14bb2,
"RTN","SAMINUL",151,0)
 ;  SAMINOT1: bump version, date, log, add quit to stop block mismatch
"RTN","SAMINUL",152,0)
 ; complaint from XINDEX.
"RTN","SAMINUL",153,0)
 ;
"RTN","SAMINUL",154,0)
 ;
"RTN","SAMINUL",155,0)
 ;
"RTN","SAMINUL",156,0)
EOR ; end of routine SAMINUL
"RTN","SAMISAV")
0^8^B121113964
"RTN","SAMISAV",1,0)
SAMISAV ;ven/gpl - SAMI save routines ;2021-05-21T20:47Z
"RTN","SAMISAV",2,0)
 ;;18.0;SAMI;**5,11**;2020-01;Build 19
"RTN","SAMISAV",3,0)
 ;;1.18.0.11+i11
"RTN","SAMISAV",4,0)
 ;
"RTN","SAMISAV",5,0)
 ; SAMISAV contains subroutines for saving forms.
"RTN","SAMISAV",6,0)
 ;
"RTN","SAMISAV",7,0)
 quit  ; no entry from top
"RTN","SAMISAV",8,0)
 ;
"RTN","SAMISAV",9,0)
 ;
"RTN","SAMISAV",10,0)
 ;
"RTN","SAMISAV",11,0)
 ;@section 0 primary development
"RTN","SAMISAV",12,0)
 ;
"RTN","SAMISAV",13,0)
 ;
"RTN","SAMISAV",14,0)
 ;
"RTN","SAMISAV",15,0)
 ;@routine-credits
"RTN","SAMISAV",16,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMISAV",17,0)
 ; gpl@vistaexpertise.net
"RTN","SAMISAV",18,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMISAV",19,0)
 ; http://vistaexpertise.net
"RTN","SAMISAV",20,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMISAV",21,0)
 ;@license see routine SAMIUL
"RTN","SAMISAV",22,0)
 ;
"RTN","SAMISAV",23,0)
 ;@last-updated 2021-05-21T20:47Z
"RTN","SAMISAV",24,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMISAV",25,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMISAV",26,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMISAV",27,0)
 ;@version 1.18.0.11+i11
"RTN","SAMISAV",28,0)
 ;@release-date 2020-01
"RTN","SAMISAV",29,0)
 ;@patch-list **5,11**
"RTN","SAMISAV",30,0)
 ;
"RTN","SAMISAV",31,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMISAV",32,0)
 ; lgc@vistaexpertise.net
"RTN","SAMISAV",33,0)
 ;@additional-dev Alexis R. Carlson (arc)
"RTN","SAMISAV",34,0)
 ; arc@vistaexpertise.net
"RTN","SAMISAV",35,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMISAV",36,0)
 ; toad@vistaexpertise.net
"RTN","SAMISAV",37,0)
 ;@additional-dev Kenneth McGlothlen (mcglk)
"RTN","SAMISAV",38,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMISAV",39,0)
 ;
"RTN","SAMISAV",40,0)
 ;@module-credits
"RTN","SAMISAV",41,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMISAV",42,0)
 ; (VA-PALS)
"RTN","SAMISAV",43,0)
 ; http://va-pals.org/
"RTN","SAMISAV",44,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMISAV",45,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMISAV",46,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMISAV",47,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMISAV",48,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMISAV",49,0)
 ; http://ielcap.com/
"RTN","SAMISAV",50,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMISAV",51,0)
 ; http://paraxialtech.com/
"RTN","SAMISAV",52,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMISAV",53,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMISAV",54,0)
 ;
"RTN","SAMISAV",55,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMISAV",56,0)
 ;
"RTN","SAMISAV",57,0)
 ; 2018-10-29/11-09 ven/lgc&arc 1.18.0 3d36564,482f522,949f150
"RTN","SAMISAV",58,0)
 ;  SAMISAV: followup report, new input form features, report menu
"RTN","SAMISAV",59,0)
 ; fix, fixed submit save bug.
"RTN","SAMISAV",60,0)
 ;
"RTN","SAMISAV",61,0)
 ; 2018-12-11/27 ven/lgc&arc 1.18.0 3ceb74b,a14554c,8dd6f34,51eb163,
"RTN","SAMISAV",62,0)
 ; f2738f8
"RTN","SAMISAV",63,0)
 ;  SAMISAV: update routines for sac compliance, r/^gpl w/^SAMIGPL,
"RTN","SAMISAV",64,0)
 ; update routines for sac compliance, fix accidental reversions.
"RTN","SAMISAV",65,0)
 ;
"RTN","SAMISAV",66,0)
 ; 2019-01-22 ven/lgc 1.18.0 5368121
"RTN","SAMISAV",67,0)
 ;  SAMISAV: add license info.
"RTN","SAMISAV",68,0)
 ;
"RTN","SAMISAV",69,0)
 ; 2019-02-18 ven/lgc 1.18.0 7687431
"RTN","SAMISAV",70,0)
 ;  SAMISAV: update recently edited routines
"RTN","SAMISAV",71,0)
 ;
"RTN","SAMISAV",72,0)
 ; 2019-06-18 ven/arc 1.18.0 9102248
"RTN","SAMISAV",73,0)
 ;  SAMISAV: r/^SAMIGPL w/^SAMIUL.
"RTN","SAMISAV",74,0)
 ;
"RTN","SAMISAV",75,0)
 ; 2019-08-14 ven/gpl 1.18.0 d73fec6 VAP-417
"RTN","SAMISAV",76,0)
 ;  SAMISAV: add communications log to intake form.
"RTN","SAMISAV",77,0)
 ;
"RTN","SAMISAV",78,0)
 ; 2019-09-26 ven/gpl 1.18.0 92b1232
"RTN","SAMISAV",79,0)
 ;  SAMISAV: mods for smoking history.
"RTN","SAMISAV",80,0)
 ;
"RTN","SAMISAV",81,0)
 ; 2020-04-10 ven/gpl 1.18.0.5+i5 56bfaed
"RTN","SAMISAV",82,0)
 ;  SAMISAV: multi-tenancy change.
"RTN","SAMISAV",83,0)
 ;
"RTN","SAMISAV",84,0)
 ; 2021-05-13 ven/gpl 1.18.0.11+i11 1c03fd6
"RTN","SAMISAV",85,0)
 ;  SAMISAV: fix date save on intervention, pet, & biopsy forms.
"RTN","SAMISAV",86,0)
 ;
"RTN","SAMISAV",87,0)
 ; 2021-05-20/21 ven/mcglk&toad 1.18.0.11+i11
"RTN","SAMISAV",88,0)
 ;  SAMIHL7: build hdr comments & dev log, lt refactor, bump version.
"RTN","SAMISAV",89,0)
 ;
"RTN","SAMISAV",90,0)
 ;@contents
"RTN","SAMISAV",91,0)
 ; $$SAVFILTR saves form & returns key
"RTN","SAMISAV",92,0)
 ; COMLOG add to communications log
"RTN","SAMISAV",93,0)
 ;
"RTN","SAMISAV",94,0)
 ;
"RTN","SAMISAV",95,0)
 ;
"RTN","SAMISAV",96,0)
 ;@section 1 subroutines
"RTN","SAMISAV",97,0)
 ;
"RTN","SAMISAV",98,0)
 ;
"RTN","SAMISAV",99,0)
 ;
"RTN","SAMISAV",100,0)
SAVFILTR(sid,form,vars) ; saves form & returns key
"RTN","SAMISAV",101,0)
 ;
"RTN","SAMISAV",102,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMISAV",103,0)
 ;
"RTN","SAMISAV",104,0)
 ;;private;function;clean;silent;sac
"RTN","SAMISAV",105,0)
 ;@called-by
"RTN","SAMISAV",106,0)
 ;@calls
"RTN","SAMISAV",107,0)
 ; $$SITENM2^SAMISITE
"RTN","SAMISAV",108,0)
 ; $$setroot^%wd
"RTN","SAMISAV",109,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMISAV",110,0)
 ;@input
"RTN","SAMISAV",111,0)
 ;@output = form key to use for saving
"RTN","SAMISAV",112,0)
 ; It will relocate the graph for the form if required based on dates
"RTN","SAMISAV",113,0)
 ;  entered on the form.
"RTN","SAMISAV",114,0)
 ; processing for multi-tenancy: if siteid not provided, but studyid
"RTN","SAMISAV",115,0)
 ;  is, look up & set siteid.
"RTN","SAMISAV",116,0)
 ;@thruput
"RTN","SAMISAV",117,0)
 ; sid = study id
"RTN","SAMISAV",118,0)
 ; form = form key
"RTN","SAMISAV",119,0)
 ; vars = form variables
"RTN","SAMISAV",120,0)
 ;
"RTN","SAMISAV",121,0)
 ;
"RTN","SAMISAV",122,0)
 ;@stanza 2 setup
"RTN","SAMISAV",123,0)
 ;
"RTN","SAMISAV",124,0)
 if '$data(vars("siteid")) do  ;
"RTN","SAMISAV",125,0)
 . quit:$get(sid)=""
"RTN","SAMISAV",126,0)
 . new sym set sym=$extract(sid,1,3) ; first 3 chars in studyid
"RTN","SAMISAV",127,0)
 . quit:$$SITENM2^SAMISITE(sym)=-1
"RTN","SAMISAV",128,0)
 . set vars("siteid")=sym
"RTN","SAMISAV",129,0)
 . set vars("site")=sym
"RTN","SAMISAV",130,0)
 . quit
"RTN","SAMISAV",131,0)
 ;
"RTN","SAMISAV",132,0)
 new useform set useform=form ; by default, form unchanged
"RTN","SAMISAV",133,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMISAV",134,0)
 new type set type=$piece(form,"-",1)
"RTN","SAMISAV",135,0)
 ;
"RTN","SAMISAV",136,0)
 ;
"RTN","SAMISAV",137,0)
 ;@stanza 3 ct evaluation form
"RTN","SAMISAV",138,0)
 ;
"RTN","SAMISAV",139,0)
 if type="ceform" do
"RTN","SAMISAV",140,0)
 . merge ^SAMIUL("samisav","vals")=vars
"RTN","SAMISAV",141,0)
 . new formdate set formdate=$get(vars("cedos")) ; ct scan date f/form
"RTN","SAMISAV",142,0)
 . quit:formdate=""
"RTN","SAMISAV",143,0)
 . new fdate set fdate=$$KEY2FM^SAMICASE(formdate) ; cnvt to fm date
"RTN","SAMISAV",144,0)
 . quit:fdate=""
"RTN","SAMISAV",145,0)
 . quit:fdate<0
"RTN","SAMISAV",146,0)
 . new fmcurrent set fmcurrent=$$KEY2FM^SAMICASE(form) ; key,fm format
"RTN","SAMISAV",147,0)
 . if fdate'=fmcurrent do  ;
"RTN","SAMISAV",148,0)
 . . new moveto set moveto="ceform-"_$$KEYDATE^SAMIHOM3(fdate)
"RTN","SAMISAV",149,0)
 . . ; w !,"old: ",fmcurrent," new: ",fdate," ... date must be changed
"RTN","SAMISAV",150,0)
 . . kill ^SAMIUL("samisav")
"RTN","SAMISAV",151,0)
 . . set ^SAMIUL("samisav","current")=form_"^"_fmcurrent
"RTN","SAMISAV",152,0)
 . . set ^SAMIUL("samisav","incoming")=formdate_"^"_fdate
"RTN","SAMISAV",153,0)
 . . set ^SAMIUL("samisav","conclusion")="graph must be moved to: "_moveto
"RTN","SAMISAV",154,0)
 . . merge ^SAMIUL("samisav","vals")=vars
"RTN","SAMISAV",155,0)
 . . merge @root@("graph",sid,moveto)=@root@("graph",sid,form)
"RTN","SAMISAV",156,0)
 . . kill @root@("graph",sid,form)
"RTN","SAMISAV",157,0)
 . . set useform=moveto
"RTN","SAMISAV",158,0)
 . . quit
"RTN","SAMISAV",159,0)
 . quit
"RTN","SAMISAV",160,0)
 ;
"RTN","SAMISAV",161,0)
 ;
"RTN","SAMISAV",162,0)
 ;@stanza 4 followup form
"RTN","SAMISAV",163,0)
 ;
"RTN","SAMISAV",164,0)
 if type="fuform" do
"RTN","SAMISAV",165,0)
 . merge ^SAMIUL("samisav","vals")=vars
"RTN","SAMISAV",166,0)
 . new formdate set formdate=$get(vars("sidof")) ; CT scan date f/form
"RTN","SAMISAV",167,0)
 . quit:formdate=""
"RTN","SAMISAV",168,0)
 . new fdate set fdate=$$KEY2FM^SAMICASE(formdate) ; cnvt to fm date
"RTN","SAMISAV",169,0)
 . quit:fdate=""
"RTN","SAMISAV",170,0)
 . quit:fdate<0
"RTN","SAMISAV",171,0)
 . new fmcurrent set fmcurrent=$$KEY2FM^SAMICASE(form) ; key,fm format
"RTN","SAMISAV",172,0)
 . if fdate'=fmcurrent do  ;
"RTN","SAMISAV",173,0)
 . . new moveto set moveto="fuform-"_$$KEYDATE^SAMIHOM3(fdate)
"RTN","SAMISAV",174,0)
 . . ; w !,"old: ",fmcurrent," new: ",fdate," ... date must be changed
"RTN","SAMISAV",175,0)
 . . kill ^SAMIUL("samisav")
"RTN","SAMISAV",176,0)
 . . set ^SAMIUL("samisav","current")=form_"^"_fmcurrent
"RTN","SAMISAV",177,0)
 . . set ^SAMIUL("samisav","incoming")=formdate_"^"_fdate
"RTN","SAMISAV",178,0)
 . . set ^SAMIUL("samisav","conclusion")="graph must be moved to: "_moveto
"RTN","SAMISAV",179,0)
 . . merge ^SAMIUL("samisav","vals")=vars
"RTN","SAMISAV",180,0)
 . . merge @root@("graph",sid,moveto)=@root@("graph",sid,form)
"RTN","SAMISAV",181,0)
 . . kill @root@("graph",sid,form)
"RTN","SAMISAV",182,0)
 . . set useform=moveto
"RTN","SAMISAV",183,0)
 . . quit
"RTN","SAMISAV",184,0)
 . quit
"RTN","SAMISAV",185,0)
 ;
"RTN","SAMISAV",186,0)
 ;
"RTN","SAMISAV",187,0)
 ;@stanza 5 intake form
"RTN","SAMISAV",188,0)
 ;
"RTN","SAMISAV",189,0)
 if type="siform" do
"RTN","SAMISAV",190,0)
 . set vars("samifirsttime")="false"
"RTN","SAMISAV",191,0)
 . do COMLOG(.sid,.form,.vars) ; add to communication log
"RTN","SAMISAV",192,0)
 . new formdate set formdate=$get(vars("sidc")) ; CT scan date f/form
"RTN","SAMISAV",193,0)
 . quit:formdate=""
"RTN","SAMISAV",194,0)
 . new fdate set fdate=$$KEY2FM^SAMICASE(formdate) ; cnvt to fm date
"RTN","SAMISAV",195,0)
 . quit:fdate=""
"RTN","SAMISAV",196,0)
 . quit:fdate<0
"RTN","SAMISAV",197,0)
 . new fmcurrent set fmcurrent=$$KEY2FM^SAMICASE(form) ; key,fm format
"RTN","SAMISAV",198,0)
 . if fdate'=fmcurrent do  ;
"RTN","SAMISAV",199,0)
 . . new moveto set moveto="siform-"_$$KEYDATE^SAMIHOM3(fdate)
"RTN","SAMISAV",200,0)
 . . ; w !,"old: ",fmcurrent," new: ",fdate," ... date must be changed
"RTN","SAMISAV",201,0)
 . . kill ^SAMIUL("samisav")
"RTN","SAMISAV",202,0)
 . . set ^SAMIUL("samisav","current")=form_"^"_fmcurrent
"RTN","SAMISAV",203,0)
 . . set ^SAMIUL("samisav","incoming")=formdate_"^"_fdate
"RTN","SAMISAV",204,0)
 . . set ^SAMIUL("samisav","conclusion")="graph must be moved to: "_moveto
"RTN","SAMISAV",205,0)
 . . merge @root@("graph",sid,moveto)=@root@("graph",sid,form)
"RTN","SAMISAV",206,0)
 . . kill @root@("graph",sid,form)
"RTN","SAMISAV",207,0)
 . . set useform=moveto
"RTN","SAMISAV",208,0)
 . . quit
"RTN","SAMISAV",209,0)
 . quit
"RTN","SAMISAV",210,0)
 ;
"RTN","SAMISAV",211,0)
 ;
"RTN","SAMISAV",212,0)
 ;@stanza 6 biopsy form
"RTN","SAMISAV",213,0)
 ;
"RTN","SAMISAV",214,0)
 if type="bxform" do
"RTN","SAMISAV",215,0)
 . new formdate set formdate=$get(vars("bxdos")) ; biopsy date f/form
"RTN","SAMISAV",216,0)
 . if formdate="" set formdate=$get(vars("rbmed")) ; mediastinoscopy d
"RTN","SAMISAV",217,0)
 . quit:formdate=""
"RTN","SAMISAV",218,0)
 . new fdate set fdate=$$KEY2FM^SAMICASE(formdate) ; cnvt to fm date
"RTN","SAMISAV",219,0)
 . quit:fdate=""
"RTN","SAMISAV",220,0)
 . quit:fdate<0
"RTN","SAMISAV",221,0)
 . new fmcurrent set fmcurrent=$$KEY2FM^SAMICASE(form) ; key,fm format
"RTN","SAMISAV",222,0)
 . if fdate'=fmcurrent do  ;
"RTN","SAMISAV",223,0)
 . . new moveto set moveto="bxform-"_$$KEYDATE^SAMIHOM3(fdate)
"RTN","SAMISAV",224,0)
 . . ; w !,"old: ",fmcurrent," new: ",fdate," ... date must be changed
"RTN","SAMISAV",225,0)
 . . kill ^SAMIUL("samisav")
"RTN","SAMISAV",226,0)
 . . set ^SAMIUL("samisav","current")=form_"^"_fmcurrent
"RTN","SAMISAV",227,0)
 . . set ^SAMIUL("samisav","incoming")=formdate_"^"_fdate
"RTN","SAMISAV",228,0)
 . . set ^SAMIUL("samisav","conclusion")="graph must be moved to: "_moveto
"RTN","SAMISAV",229,0)
 . . merge @root@("graph",sid,moveto)=@root@("graph",sid,form)
"RTN","SAMISAV",230,0)
 . . kill @root@("graph",sid,form)
"RTN","SAMISAV",231,0)
 . . set useform=moveto
"RTN","SAMISAV",232,0)
 . . quit
"RTN","SAMISAV",233,0)
 . quit
"RTN","SAMISAV",234,0)
 ;
"RTN","SAMISAV",235,0)
 ;
"RTN","SAMISAV",236,0)
 ;@stanza 7 intervention form
"RTN","SAMISAV",237,0)
 ;
"RTN","SAMISAV",238,0)
 if type="itform" do
"RTN","SAMISAV",239,0)
 . new formdate set formdate=$get(vars("rbsud")) ; treatment date
"RTN","SAMISAV",240,0)
 . if formdate="" set formdate=$get(vars("rbdos")) ;1st intervention d
"RTN","SAMISAV",241,0)
 . if formdate="" set formdate=$get(vars("rbdmr")) ; last intervention
"RTN","SAMISAV",242,0)
 . quit:formdate=""
"RTN","SAMISAV",243,0)
 . new fdate set fdate=$$KEY2FM^SAMICASE(formdate) ; cnvt to fm date
"RTN","SAMISAV",244,0)
 . quit:fdate=""
"RTN","SAMISAV",245,0)
 . quit:fdate<0
"RTN","SAMISAV",246,0)
 . new fmcurrent set fmcurrent=$$KEY2FM^SAMICASE(form) ; key,fm format
"RTN","SAMISAV",247,0)
 . if fdate'=fmcurrent do  ;
"RTN","SAMISAV",248,0)
 . . new moveto set moveto="itform-"_$$KEYDATE^SAMIHOM3(fdate)
"RTN","SAMISAV",249,0)
 . . ; w !,"old: ",fmcurrent," new: ",fdate," ... date must be changed
"RTN","SAMISAV",250,0)
 . . kill ^SAMIUL("samisav")
"RTN","SAMISAV",251,0)
 . . set ^SAMIUL("samisav","current")=form_"^"_fmcurrent
"RTN","SAMISAV",252,0)
 . . set ^SAMIUL("samisav","incoming")=formdate_"^"_fdate
"RTN","SAMISAV",253,0)
 . . set ^SAMIUL("samisav","conclusion")="graph must be moved to: "_moveto
"RTN","SAMISAV",254,0)
 . . merge @root@("graph",sid,moveto)=@root@("graph",sid,form)
"RTN","SAMISAV",255,0)
 . . kill @root@("graph",sid,form)
"RTN","SAMISAV",256,0)
 . . set useform=moveto
"RTN","SAMISAV",257,0)
 . . quit
"RTN","SAMISAV",258,0)
 . quit
"RTN","SAMISAV",259,0)
 ;
"RTN","SAMISAV",260,0)
 ;
"RTN","SAMISAV",261,0)
 ;@stanza 8 pet evaluation form
"RTN","SAMISAV",262,0)
 ;
"RTN","SAMISAV",263,0)
 if type="ptform" do
"RTN","SAMISAV",264,0)
 . new formdate set formdate=$get(vars("ptdos")) ; treatment date
"RTN","SAMISAV",265,0)
 . quit:formdate=""
"RTN","SAMISAV",266,0)
 . new fdate set fdate=$$KEY2FM^SAMICASE(formdate) ; cnvt to fm date
"RTN","SAMISAV",267,0)
 . quit:fdate=""
"RTN","SAMISAV",268,0)
 . quit:fdate<0
"RTN","SAMISAV",269,0)
 . new fmcurrent set fmcurrent=$$KEY2FM^SAMICASE(form) ; key,fm format
"RTN","SAMISAV",270,0)
 . if fdate'=fmcurrent do  ;
"RTN","SAMISAV",271,0)
 . . new moveto set moveto="ptform-"_$$KEYDATE^SAMIHOM3(fdate)
"RTN","SAMISAV",272,0)
 . . ; w !,"old: ",fmcurrent," new: ",fdate," ... date must be changed
"RTN","SAMISAV",273,0)
 . . kill ^SAMIUL("samisav")
"RTN","SAMISAV",274,0)
 . . set ^SAMIUL("samisav","current")=form_"^"_fmcurrent
"RTN","SAMISAV",275,0)
 . . set ^SAMIUL("samisav","incoming")=formdate_"^"_fdate
"RTN","SAMISAV",276,0)
 . . set ^SAMIUL("samisav","conclusion")="graph must be moved to: "_moveto
"RTN","SAMISAV",277,0)
 . . merge @root@("graph",sid,moveto)=@root@("graph",sid,form)
"RTN","SAMISAV",278,0)
 . . kill @root@("graph",sid,form)
"RTN","SAMISAV",279,0)
 . . set useform=moveto
"RTN","SAMISAV",280,0)
 . . quit
"RTN","SAMISAV",281,0)
 . quit
"RTN","SAMISAV",282,0)
 ;
"RTN","SAMISAV",283,0)
 ;
"RTN","SAMISAV",284,0)
 ;@stanza 9 termination
"RTN","SAMISAV",285,0)
 ;
"RTN","SAMISAV",286,0)
 quit useform ; return form key ; end of $$SAVFILTR
"RTN","SAMISAV",287,0)
 ;
"RTN","SAMISAV",288,0)
 ;
"RTN","SAMISAV",289,0)
 ;
"RTN","SAMISAV",290,0)
COMLOG(sid,form,vars) ; add to communications log
"RTN","SAMISAV",291,0)
 ;
"RTN","SAMISAV",292,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMISAV",293,0)
 ;
"RTN","SAMISAV",294,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMISAV",295,0)
 ;@called-by
"RTN","SAMISAV",296,0)
 ; SAVFILTR
"RTN","SAMISAV",297,0)
 ;@calls
"RTN","SAMISAV",298,0)
 ; $$setroot^%wd
"RTN","SAMISAV",299,0)
 ; LOGIT^SAMICLOG
"RTN","SAMISAV",300,0)
 ;@input
"RTN","SAMISAV",301,0)
 ; sid = study id
"RTN","SAMISAV",302,0)
 ; form = form key
"RTN","SAMISAV",303,0)
 ; vars("sipcrn") = new comm log entry
"RTN","SAMISAV",304,0)
 ;@output
"RTN","SAMISAV",305,0)
 ; comm log updated to include new comm log entry
"RTN","SAMISAV",306,0)
 ; vars("sipcrn") = cleared after being saved
"RTN","SAMISAV",307,0)
 ;
"RTN","SAMISAV",308,0)
 ;
"RTN","SAMISAV",309,0)
 ;@stanza 2 add new entry to comm log
"RTN","SAMISAV",310,0)
 ;
"RTN","SAMISAV",311,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMISAV",312,0)
 merge vars("comlog")=@root@("graph",sid,form,"comlog")
"RTN","SAMISAV",313,0)
 new COMLOGRT ; communication log root
"RTN","SAMISAV",314,0)
 set COMLOGRT=$name(@root@("graph",sid,form,"comlog"))
"RTN","SAMISAV",315,0)
 ;
"RTN","SAMISAV",316,0)
 if $get(vars("sipcrn"))'="" do  ; new comm log entry available
"RTN","SAMISAV",317,0)
 . do LOGIT^SAMICLOG(COMLOGRT,vars("sipcrn"))
"RTN","SAMISAV",318,0)
 . set vars("sipcrn")=""
"RTN","SAMISAV",319,0)
 . quit
"RTN","SAMISAV",320,0)
 ;
"RTN","SAMISAV",321,0)
 ;
"RTN","SAMISAV",322,0)
 ;@stanza 3 termination
"RTN","SAMISAV",323,0)
 ;
"RTN","SAMISAV",324,0)
 quit  ; end of COMLOG
"RTN","SAMISAV",325,0)
 ;
"RTN","SAMISAV",326,0)
 ;
"RTN","SAMISAV",327,0)
 ;
"RTN","SAMISAV",328,0)
EOR ; end of routine SAMISAV
"RTN","SAMIUR")
0^2^B536094535
"RTN","SAMIUR",1,0)
SAMIUR ;ven/gpl - user reports ;2021-05-21T20:47Z
"RTN","SAMIUR",2,0)
 ;;18.0;SAMI;**5,10,11**;2020-01;Build 19
"RTN","SAMIUR",3,0)
 ;;1.18.0.11+i11
"RTN","SAMIUR",4,0)
 ;
"RTN","SAMIUR",5,0)
 ; SAMIUR contains a web service & associated subroutines to produce
"RTN","SAMIUR",6,0)
 ; VAPALS-ELCAP user reports.
"RTN","SAMIUR",7,0)
 ;
"RTN","SAMIUR",8,0)
 quit  ; no entry from top
"RTN","SAMIUR",9,0)
 ;
"RTN","SAMIUR",10,0)
 ;
"RTN","SAMIUR",11,0)
 ;
"RTN","SAMIUR",12,0)
 ;@section 0 primary development
"RTN","SAMIUR",13,0)
 ;
"RTN","SAMIUR",14,0)
 ;
"RTN","SAMIUR",15,0)
 ;
"RTN","SAMIUR",16,0)
 ;@routine-credits
"RTN","SAMIUR",17,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMIUR",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUR",19,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMIUR",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIUR",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIUR",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIUR",23,0)
 ;
"RTN","SAMIUR",24,0)
 ;@last-updated 2021-05-21T20:47Z
"RTN","SAMIUR",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIUR",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIUR",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUR",28,0)
 ;@version 1.18.0.11+i11
"RTN","SAMIUR",29,0)
 ;@release-date 2020-01
"RTN","SAMIUR",30,0)
 ;@patch-list **5,10,11**
"RTN","SAMIUR",31,0)
 ;
"RTN","SAMIUR",32,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMIUR",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUR",34,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMIUR",35,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIUR",36,0)
 ;@additional-dev Alexis R. Carlson (arc)
"RTN","SAMIUR",37,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIUR",38,0)
 ;@additional-dev Kenneth McGlothlen (mcglk)
"RTN","SAMIUR",39,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIUR",40,0)
 ;
"RTN","SAMIUR",41,0)
 ;@module-credits
"RTN","SAMIUR",42,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIUR",43,0)
 ; (VA-PALS)
"RTN","SAMIUR",44,0)
 ; http://va-pals.org/
"RTN","SAMIUR",45,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIUR",46,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIUR",47,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIUR",48,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIUR",49,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIUR",50,0)
 ; http://ielcap.com/
"RTN","SAMIUR",51,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIUR",52,0)
 ; http://paraxialtech.com/
"RTN","SAMIUR",53,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIUR",54,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIUR",55,0)
 ;
"RTN","SAMIUR",56,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUR",57,0)
 ;
"RTN","SAMIUR",58,0)
 ; 2020-02-10/12 ven/gpl 1.18.0-t04 d543f7bb,f9869dfb,0e4d8b9a
"RTN","SAMIUR",59,0)
 ;  SAMIUR: 1st version of revised user reports, progress on user
"RTN","SAMIUR",60,0)
 ; reports, fixed a bug in enrollment report.
"RTN","SAMIUR",61,0)
 ;
"RTN","SAMIUR",62,0)
 ; 2020-02-18 ven/lgc 1.18.0-t04 76874314
"RTN","SAMIUR",63,0)
 ;  SAMIUR: update recently edited routines.
"RTN","SAMIUR",64,0)
 ;
"RTN","SAMIUR",65,0)
 ; 2020-03-10/12 ven/gpl 1.18.0-t04 8de06b06,4ad52d64
"RTN","SAMIUR",66,0)
 ;  SAMIUR: user report date filtering, fix end date logic in UR.
"RTN","SAMIUR",67,0)
 ;
"RTN","SAMIUR",68,0)
 ; 2020-04-16/23 ven/lgc 1.18.0-t04 e54b76d1b,89bffd3b
"RTN","SAMIUR",69,0)
 ;  SAMIUR: SAMIFRM2 > SAMIFORM, SAMISUB2 > LOAD.
"RTN","SAMIUR",70,0)
 ;
"RTN","SAMIUR",71,0)
 ; 2020-08-04 ven/gpl 1.18.0-t04 cd865e2b VPA-438
"RTN","SAMIUR",72,0)
 ;  SAMIUR: requested changes to followup report.
"RTN","SAMIUR",73,0)
 ;
"RTN","SAMIUR",74,0)
 ; 2020-09-26 ven/gpl 1.18.0-t04 92b12324 VAP-420
"RTN","SAMIUR",75,0)
 ;  SAMIUR: add smoking history.
"RTN","SAMIUR",76,0)
 ;
"RTN","SAMIUR",77,0)
 ; 2020-01-01/05 ven/arc 1.18.0 399f8547,62e3200f
"RTN","SAMIUR",78,0)
 ;  SAMIUR: unmatched participant processing.
"RTN","SAMIUR",79,0)
 ;
"RTN","SAMIUR",80,0)
 ; 2020-04-29/05-13 ven/gpl 1.18.0.5+i5 e8b8ea2d,61c7d208
"RTN","SAMIUR",81,0)
 ;  SAMIUR: fixes for reports, worklist functionality.
"RTN","SAMIUR",82,0)
 ;
"RTN","SAMIUR",83,0)
 ; 2021-03-22/23 ven/gpl 1.18.0.10+i10 256efe63,ba81b86a2
"RTN","SAMIUR",84,0)
 ;  SAMIUR: sort all reports by name, added row totals to reports.
"RTN","SAMIUR",85,0)
 ;
"RTN","SAMIUR",86,0)
 ; 2021-03-23 ven/toad 1.18.0.10+i10 96f461d0,af86e0eb
"RTN","SAMIUR",87,0)
 ;  SAMIUR: add version info & dev log, lt refactor, fix XINDEX
"RTN","SAMIUR",88,0)
 ; errors.
"RTN","SAMIUR",89,0)
 ;
"RTN","SAMIUR",90,0)
 ; 2021-03-29 ven/gpl 1.18.0.11+i11 e809f2a2
"RTN","SAMIUR",91,0)
 ;  SAMIUR: prevent crash when reports have no matches: in WSREPORT
"RTN","SAMIUR",92,0)
 ; set SRT="" and uncomment zwrite SRT; in WKLIST add 2 commented-out
"RTN","SAMIUR",93,0)
 ; debugging lines.
"RTN","SAMIUR",94,0)
 ;
"RTN","SAMIUR",95,0)
 ; 2021-03-30 ven/toad 1.18.0.11+i11 7b14bb2
"RTN","SAMIUR",96,0)
 ;  SAMIUR: bump version, date, log; in WSREPORT comment zwrite SRT.
"RTN","SAMIUR",97,0)
 ;
"RTN","SAMIUR",98,0)
 ; 2021-03-31 ven/gpl 1.18.0.11+i11 66d89cd
"RTN","SAMIUR",99,0)
 ;  SAMIUR: sort on all uppercase names for reports
"RTN","SAMIUR",100,0)
 ;
"RTN","SAMIUR",101,0)
 ; 2021-04-13 ven/gpl 1.18.0.11+i11 a12765b
"RTN","SAMIUR",102,0)
 ;  SAMIUR: inactive report created.
"RTN","SAMIUR",103,0)
 ;
"RTN","SAMIUR",104,0)
 ; 2021-05-20/21 ven/mcglk&toad 1.18.0.11+i11
"RTN","SAMIUR",105,0)
 ;  SAMIUR: annotate, lt refactor, bump version.
"RTN","SAMIUR",106,0)
 ;
"RTN","SAMIUR",107,0)
 ;@contents
"RTN","SAMIUR",108,0)
 ; WSREPORT generate report based on params in filter
"RTN","SAMIUR",109,0)
 ; SORT sort patients by name
"RTN","SAMIUR",110,0)
 ; NUHREF create nuhref link to casereview for all patients
"RTN","SAMIUR",111,0)
 ; PNAME page name for report
"RTN","SAMIUR",112,0)
 ;
"RTN","SAMIUR",113,0)
 ; SELECT select patients for report
"RTN","SAMIUR",114,0)
 ; UNMAT build unmatched persons list
"RTN","SAMIUR",115,0)
 ; WKLIST build work list
"RTN","SAMIUR",116,0)
 ;
"RTN","SAMIUR",117,0)
 ;
"RTN","SAMIUR",118,0)
 ;
"RTN","SAMIUR",119,0)
 ;@section 1 wsreport subroutines
"RTN","SAMIUR",120,0)
 ;
"RTN","SAMIUR",121,0)
 ;
"RTN","SAMIUR",122,0)
 ;
"RTN","SAMIUR",123,0)
WSREPORT(SAMIRTN,filter) ; generate report based on params in filter
"RTN","SAMIUR",124,0)
 ;
"RTN","SAMIUR",125,0)
 ;@called-by
"RTN","SAMIUR",126,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIUR",127,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIUR",128,0)
 ;@calls
"RTN","SAMIUR",129,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIUR",130,0)
 ; getThis^%wd
"RTN","SAMIUR",131,0)
 ; SELECT
"RTN","SAMIUR",132,0)
 ; LOAD^SAMIFORM
"RTN","SAMIUR",133,0)
 ; $$PNAME
"RTN","SAMIUR",134,0)
 ; findReplace^%ts
"RTN","SAMIUR",135,0)
 ; RPTTBL^SAMIUR2
"RTN","SAMIUR",136,0)
 ; NUHREF
"RTN","SAMIUR",137,0)
 ; SORT
"RTN","SAMIUR",138,0)
 ; @RPT(ir,"routine"): [from report def table from RPTTBL^SAMIUR2]
"RTN","SAMIUR",139,0)
 ;  format = $$<tag>^SAMIUR2, where tag =
"RTN","SAMIUR",140,0)
 ;  AGE       BLINEDT   CONTACT   CTPROT   DOB      FUDATE    GENDER
"RTN","SAMIUR",141,0)
 ;  IFORM     LASTEXM   MANPAT    MATCH    NAME     PACKYRS   POSSIBLE
"RTN","SAMIUR",142,0)
 ;  RECOM     RURAL     SID       SMHIS    SMKSTAT  SSN       STUDYDT
"RTN","SAMIUR",143,0)
 ;  STUDYTYP  VALS      WHEN      WORKPAT
"RTN","SAMIUR",144,0)
 ;
"RTN","SAMIUR",145,0)
 ; here are the user reports that are defined:
"RTN","SAMIUR",146,0)
 ;  1. followup
"RTN","SAMIUR",147,0)
 ;  2. activity
"RTN","SAMIUR",148,0)
 ;  3. missingct
"RTN","SAMIUR",149,0)
 ;  4. incomplete
"RTN","SAMIUR",150,0)
 ;  5. outreach
"RTN","SAMIUR",151,0)
 ;  6. enrollment
"RTN","SAMIUR",152,0)
 ;  7. worklist
"RTN","SAMIUR",153,0)
 ; the report to generate is passed in parameter samireporttype
"RTN","SAMIUR",154,0)
 ;
"RTN","SAMIUR",155,0)
 new debug set debug=0
"RTN","SAMIUR",156,0)
 if $get(filter("debug"))=1 set debug=1
"RTN","SAMIUR",157,0)
 if $get(filter("debug"))=1 set debug=1
"RTN","SAMIUR",158,0)
 kill SAMIRTN
"RTN","SAMIUR",159,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMIUR",160,0)
 ;
"RTN","SAMIUR",161,0)
 new type,temp
"RTN","SAMIUR",162,0)
 set type=$get(filter("samireporttype"))
"RTN","SAMIUR",163,0)
 if type="" do  quit  ; report type missing
"RTN","SAMIUR",164,0)
 . do GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",165,0)
 . quit
"RTN","SAMIUR",166,0)
 ;
"RTN","SAMIUR",167,0)
 do getThis^%wd("temp","table.html") ; page template
"RTN","SAMIUR",168,0)
 quit:'$data(temp)
"RTN","SAMIUR",169,0)
 ;
"RTN","SAMIUR",170,0)
 new SAMIPATS
"RTN","SAMIUR",171,0)
 ; set pats=""
"RTN","SAMIUR",172,0)
 new datephrase
"RTN","SAMIUR",173,0)
 do SELECT(.SAMIPATS,type,.datephrase,.filter) ; select pats for report
"RTN","SAMIUR",174,0)
 ; quit:'$data(SAMIPATS)
"RTN","SAMIUR",175,0)
 ;
"RTN","SAMIUR",176,0)
 new ln,cnt,ii
"RTN","SAMIUR",177,0)
 set (ii,ln,cnt)=0
"RTN","SAMIUR",178,0)
 for  do  quit:'ii  quit:$get(temp(ii))["<thead"
"RTN","SAMIUR",179,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",180,0)
 . quit:'ii
"RTN","SAMIUR",181,0)
 . quit:$get(temp(ii))["<thead"
"RTN","SAMIUR",182,0)
 . ;
"RTN","SAMIUR",183,0)
 . set cnt=cnt+1
"RTN","SAMIUR",184,0)
 . set ln=$get(temp(ii))
"RTN","SAMIUR",185,0)
 . new samikey,si
"RTN","SAMIUR",186,0)
 . set (samikey,si)=""
"RTN","SAMIUR",187,0)
 . do LOAD^SAMIFORM(.ln,samikey,si,.filter)
"RTN","SAMIUR",188,0)
 . ; if ln["PAGE NAME" do
"RTN","SAMIUR",189,0)
 . ; . do findReplace^%ts(.ln,"PAGE NAME",$$PNAME(type,datephrase))
"RTN","SAMIUR",190,0)
 . ; . quit
"RTN","SAMIUR",191,0)
 . if ln["PAGE NAME" do
"RTN","SAMIUR",192,0)
 . . do findReplace^%ts(.ln,"PAGE NAME",$$PNAME(type,""))
"RTN","SAMIUR",193,0)
 . . quit
"RTN","SAMIUR",194,0)
 . if ln["CRITERIA" do
"RTN","SAMIUR",195,0)
 . . do findReplace^%ts(.ln,"CRITERIA",datephrase)
"RTN","SAMIUR",196,0)
 . . quit
"RTN","SAMIUR",197,0)
 . if ln["@@REPORTTYPE@@" do
"RTN","SAMIUR",198,0)
 . . do findReplace^%ts(.ln,"@@REPORTTYPE@@",type)
"RTN","SAMIUR",199,0)
 . . quit
"RTN","SAMIUR",200,0)
 . ;
"RTN","SAMIUR",201,0)
 . if ln["name=""start-date""" do
"RTN","SAMIUR",202,0)
 . . do findReplace^%ts(.ln,"start-date""","start-date"" value="""_$g(filter("start-date"))_"""")
"RTN","SAMIUR",203,0)
 . . quit
"RTN","SAMIUR",204,0)
 . if ln["name=""end-date""" do
"RTN","SAMIUR",205,0)
 . . do findReplace^%ts(.ln,"end-date""","end-date"" value="""_$g(filter("end-date"))_"""")
"RTN","SAMIUR",206,0)
 . . quit
"RTN","SAMIUR",207,0)
 . ;
"RTN","SAMIUR",208,0)
 . set SAMIRTN(cnt)=ln
"RTN","SAMIUR",209,0)
 . quit
"RTN","SAMIUR",210,0)
 ;
"RTN","SAMIUR",211,0)
 new RPT,ik
"RTN","SAMIUR",212,0)
 do RPTTBL^SAMIUR2(.RPT,type) ; load report definition table
"RTN","SAMIUR",213,0)
 if '$data(RPT) do  quit  ; don't know about this report
"RTN","SAMIUR",214,0)
 . do GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",215,0)
 . quit
"RTN","SAMIUR",216,0)
 ;
"RTN","SAMIUR",217,0)
 ; output header
"RTN","SAMIUR",218,0)
 ;
"RTN","SAMIUR",219,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="<thead><tr>"
"RTN","SAMIUR",220,0)
 set cnt=cnt+1
"RTN","SAMIUR",221,0)
 new totcnt set totcnt=cnt
"RTN","SAMIUR",222,0)
 ;
"RTN","SAMIUR",223,0)
 set ir=""
"RTN","SAMIUR",224,0)
 for  do  quit:ir=""  ;
"RTN","SAMIUR",225,0)
 . set ir=$order(RPT(ir))
"RTN","SAMIUR",226,0)
 . quit:ir=""
"RTN","SAMIUR",227,0)
 . set cnt=cnt+1
"RTN","SAMIUR",228,0)
 . set SAMIRTN(cnt)="<th>"_$get(RPT(ir,"header"))_"</th>"
"RTN","SAMIUR",229,0)
 . quit
"RTN","SAMIUR",230,0)
 ;
"RTN","SAMIUR",231,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="</tr></thead>"
"RTN","SAMIUR",232,0)
 ;
"RTN","SAMIUR",233,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="<tbody>"
"RTN","SAMIUR",234,0)
 ;
"RTN","SAMIUR",235,0)
 if type'="worklist" do  ;
"RTN","SAMIUR",236,0)
 . do NUHREF(.SAMIPATS) ; create the nuhref link for all patients
"RTN","SAMIUR",237,0)
 . quit
"RTN","SAMIUR",238,0)
 ;
"RTN","SAMIUR",239,0)
 new SRT set SRT=""
"RTN","SAMIUR",240,0)
 if $get(filter("sort"))="" set filter("sort")="name"
"RTN","SAMIUR",241,0)
 do SORT(.SRT,.SAMIPATS,.filter)
"RTN","SAMIUR",242,0)
 ; zwrite SRT
"RTN","SAMIUR",243,0)
 ;
"RTN","SAMIUR",244,0)
 ; set ij=0
"RTN","SAMIUR",245,0)
 ; for  do  quit:'ij  ;
"RTN","SAMIUR",246,0)
 ; . set ij=$order(SAMIPATS(ij))
"RTN","SAMIUR",247,0)
 ; . quit:'ij  
"RTN","SAMIUR",248,0)
 ; . new ij2 set ij2=0
"RTN","SAMIUR",249,0)
 ; . for  do  quit:'ij2  ;
"RTN","SAMIUR",250,0)
 ; . . set ij2=$order(SAMIPATS(ij,ij2))
"RTN","SAMIUR",251,0)
 ; . . quit:'ij2  
"RTN","SAMIUR",252,0)
 ; . . new dfn set dfn=ij2
"RTN","SAMIUR",253,0)
 ; . . quit
"RTN","SAMIUR",254,0)
 ; . quit
"RTN","SAMIUR",255,0)
 ;
"RTN","SAMIUR",256,0)
 new iz,ij,ij2,dfn,rows
"RTN","SAMIUR",257,0)
 set rows=0
"RTN","SAMIUR",258,0)
 set (iz,ij,ij2,dfn)=""
"RTN","SAMIUR",259,0)
 for  do  quit:iz=""  ;
"RTN","SAMIUR",260,0)
 . set iz=$order(SRT(iz))
"RTN","SAMIUR",261,0)
 . quit:iz=""
"RTN","SAMIUR",262,0)
 . set ij=$order(SRT(iz,""))
"RTN","SAMIUR",263,0)
 . set dfn=$order(SRT(iz,ij,""))
"RTN","SAMIUR",264,0)
 . do  ;
"RTN","SAMIUR",265,0)
 . . set cnt=cnt+1 set SAMIRTN(cnt)="<tr>"
"RTN","SAMIUR",266,0)
 . . set ir=""
"RTN","SAMIUR",267,0)
 . . for  do  quit:ir=""  ;
"RTN","SAMIUR",268,0)
 . . . set ir=$order(RPT(ir))
"RTN","SAMIUR",269,0)
 . . . quit:ir=""
"RTN","SAMIUR",270,0)
 . . . set cnt=cnt+1
"RTN","SAMIUR",271,0)
 . . . new XR,XRV
"RTN","SAMIUR",272,0)
 . . . ; set XR=$get(RPT(ir,"routine"))_"("_ij_",.SAMIPATS)"
"RTN","SAMIUR",273,0)
 . . . set XR="set XRV="_$get(RPT(ir,"routine"))_"("_ij_","_dfn_",.SAMIPATS)"
"RTN","SAMIUR",274,0)
 . . . ; set XRV=@XR
"RTN","SAMIUR",275,0)
 . . . xecute XR ; call report-field handlers in ^SAMIUR2
"RTN","SAMIUR",276,0)
 . . . set SAMIRTN(cnt)="<td>"_$get(XRV)_"</td>"
"RTN","SAMIUR",277,0)
 . . . quit
"RTN","SAMIUR",278,0)
 . . ;
"RTN","SAMIUR",279,0)
 . . set cnt=cnt+1
"RTN","SAMIUR",280,0)
 . . set SAMIRTN(cnt)="</tr>"
"RTN","SAMIUR",281,0)
 . . set rows=rows+1
"RTN","SAMIUR",282,0)
 . . quit
"RTN","SAMIUR",283,0)
 . quit
"RTN","SAMIUR",284,0)
 ;
"RTN","SAMIUR",285,0)
 set cnt=cnt+1
"RTN","SAMIUR",286,0)
 set SAMIRTN(cnt)="<tr><td>Total: "_rows_"</td></tr>"
"RTN","SAMIUR",287,0)
 set SAMIRTN(totcnt)="<td>Total: "_rows_"</td></tr><tr>"
"RTN","SAMIUR",288,0)
 ;
"RTN","SAMIUR",289,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="</tbody>"
"RTN","SAMIUR",290,0)
 for  do  quit:temp(ii)["</tbody>"  ;
"RTN","SAMIUR",291,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",292,0)
 . quit:temp(ii)["</tbody>"
"RTN","SAMIUR",293,0)
 . ; skip past template headers & blank body
"RTN","SAMIUR",294,0)
 . quit
"RTN","SAMIUR",295,0)
 ;
"RTN","SAMIUR",296,0)
 for  do  quit:'ii  ;
"RTN","SAMIUR",297,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",298,0)
 . quit:'ii
"RTN","SAMIUR",299,0)
 . set cnt=cnt+1
"RTN","SAMIUR",300,0)
 . set ln=$get(temp(ii))
"RTN","SAMIUR",301,0)
 . new samikey,si
"RTN","SAMIUR",302,0)
 . set (samikey,si)=""
"RTN","SAMIUR",303,0)
 . do LOAD^SAMIFORM(.ln,samikey,si,.filter)
"RTN","SAMIUR",304,0)
 . set SAMIRTN(cnt)=ln
"RTN","SAMIUR",305,0)
 . quit
"RTN","SAMIUR",306,0)
 ;
"RTN","SAMIUR",307,0)
 quit  ; end of WSREPORT
"RTN","SAMIUR",308,0)
 ;
"RTN","SAMIUR",309,0)
 ;
"RTN","SAMIUR",310,0)
 ;
"RTN","SAMIUR",311,0)
SORT(SRTN,SAMIPATS,FILTER) ; sort patients by name
"RTN","SAMIUR",312,0)
 ;
"RTN","SAMIUR",313,0)
 ;@called-by
"RTN","SAMIUR",314,0)
 ; WSREPORT
"RTN","SAMIUR",315,0)
 ;@calls
"RTN","SAMIUR",316,0)
 ; $$UPCASE^XLFMSMT
"RTN","SAMIUR",317,0)
 ;
"RTN","SAMIUR",318,0)
 new typ set typ=$get(FILTER("sort"))
"RTN","SAMIUR",319,0)
 if typ="" set typ="name"
"RTN","SAMIUR",320,0)
 new iz,dt,dfn,nm
"RTN","SAMIUR",321,0)
 set (dt,dfn,nm)="" ; note: should dfn be initialized inside loop?
"RTN","SAMIUR",322,0)
 set iz=0
"RTN","SAMIUR",323,0)
 ;
"RTN","SAMIUR",324,0)
 new indx
"RTN","SAMIUR",325,0)
 for  do  quit:'dt  ;
"RTN","SAMIUR",326,0)
 . set dt=$order(SAMIPATS(dt))
"RTN","SAMIUR",327,0)
 . quit:'dt
"RTN","SAMIUR",328,0)
 . ; note: dfn not re-initialized to "" here; should it be?
"RTN","SAMIUR",329,0)
 . for  do  quit:'dfn  ;
"RTN","SAMIUR",330,0)
 . . set dfn=$order(SAMIPATS(dt,dfn))
"RTN","SAMIUR",331,0)
 . . quit:'dfn
"RTN","SAMIUR",332,0)
 . . if typ="name" do  ;
"RTN","SAMIUR",333,0)
 . . . set nm=$get(SAMIPATS(dt,dfn,"name"))
"RTN","SAMIUR",334,0)
 . . . set nm=$$UPCASE^XLFMSMT(nm)
"RTN","SAMIUR",335,0)
 . . . if nm="" set nm=" "
"RTN","SAMIUR",336,0)
 . . . set indx(nm,dt,dfn)=""
"RTN","SAMIUR",337,0)
 . . . quit
"RTN","SAMIUR",338,0)
 . . quit
"RTN","SAMIUR",339,0)
 . quit
"RTN","SAMIUR",340,0)
 ;
"RTN","SAMIUR",341,0)
 new iiz set iiz=""
"RTN","SAMIUR",342,0)
 set (dt,dfn)="" ; note: here, too, should inits be inside loops?
"RTN","SAMIUR",343,0)
 for  do  quit:iiz=""  ;
"RTN","SAMIUR",344,0)
 . set iiz=$order(indx(iiz))
"RTN","SAMIUR",345,0)
 . quit:iiz=""
"RTN","SAMIUR",346,0)
 . for  do  quit:dt=""  ;
"RTN","SAMIUR",347,0)
 . . set dt=$order(indx(iiz,dt))
"RTN","SAMIUR",348,0)
 . . quit:dt=""
"RTN","SAMIUR",349,0)
 . . for  do  quit:dfn=""  ;
"RTN","SAMIUR",350,0)
 . . . set dfn=$order(indx(iiz,dt,dfn))
"RTN","SAMIUR",351,0)
 . . . quit:dfn=""
"RTN","SAMIUR",352,0)
 . . . set iz=iz+1
"RTN","SAMIUR",353,0)
 . . . set SRTN(iz,dt,dfn)=iiz
"RTN","SAMIUR",354,0)
 . . . quit
"RTN","SAMIUR",355,0)
 . . quit
"RTN","SAMIUR",356,0)
 . quit
"RTN","SAMIUR",357,0)
 ;
"RTN","SAMIUR",358,0)
 quit  ; end of SORT
"RTN","SAMIUR",359,0)
 ;
"RTN","SAMIUR",360,0)
 ;
"RTN","SAMIUR",361,0)
 ;
"RTN","SAMIUR",362,0)
NUHREF(SAMIPATS) ; create nuhref link to casereview for all patients
"RTN","SAMIUR",363,0)
 ;
"RTN","SAMIUR",364,0)
 ;@called-by
"RTN","SAMIUR",365,0)
 ; WSREPORT
"RTN","SAMIUR",366,0)
 ;@calls
"RTN","SAMIUR",367,0)
 ; $$setroot^%wd
"RTN","SAMIUR",368,0)
 ; $$GETSSN^SAMIFORM
"RTN","SAMIUR",369,0)
 ;
"RTN","SAMIUR",370,0)
 new ij
"RTN","SAMIUR",371,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",372,0)
 set ij=0
"RTN","SAMIUR",373,0)
 for  do  quit:'ij  ;
"RTN","SAMIUR",374,0)
 . set ij=$order(SAMIPATS(ij))
"RTN","SAMIUR",375,0)
 . quit:'j
"RTN","SAMIUR",376,0)
 . new ij2 set ij2=0
"RTN","SAMIUR",377,0)
 . for  do  quit:'ij2  ;
"RTN","SAMIUR",378,0)
 . . set ij2=$order(SAMIPATS(ij,ij2))
"RTN","SAMIUR",379,0)
 . . quit:'ij2
"RTN","SAMIUR",380,0)
 . . ;
"RTN","SAMIUR",381,0)
 . . new dfn set dfn=ij2
"RTN","SAMIUR",382,0)
 . . set SAMIPATS(ij,dfn,"sid")=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR",383,0)
 . . set SAMIPATS(ij,dfn,"name")=$get(@root@(dfn,"saminame"))
"RTN","SAMIUR",384,0)
 . . ;
"RTN","SAMIUR",385,0)
 . . new sid set sid=SAMIPATS(ij,dfn,"sid")
"RTN","SAMIUR",386,0)
 . . set SAMIPATS(ij,dfn,"ssn")=$$GETSSN^SAMIFORM(sid)
"RTN","SAMIUR",387,0)
 . . new name set name=SAMIPATS(ij,dfn,"name")
"RTN","SAMIUR",388,0)
 . . ;
"RTN","SAMIUR",389,0)
 . . new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR",390,0)
 . . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""casereview"">"
"RTN","SAMIUR",391,0)
 . . set nuhref=nuhref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMIUR",392,0)
 . . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",393,0)
 . . set SAMIPATS(ij,dfn,"nuhref")=nuhref
"RTN","SAMIUR",394,0)
 . . quit
"RTN","SAMIUR",395,0)
 . quit
"RTN","SAMIUR",396,0)
 ;
"RTN","SAMIUR",397,0)
 quit  ; end of NUHREF
"RTN","SAMIUR",398,0)
 ;
"RTN","SAMIUR",399,0)
 ;
"RTN","SAMIUR",400,0)
 ;
"RTN","SAMIUR",401,0)
PNAME(type,phrase) ; page name for report
"RTN","SAMIUR",402,0)
 ;
"RTN","SAMIUR",403,0)
 ;@called-by
"RTN","SAMIUR",404,0)
 ; WSREPORT
"RTN","SAMIUR",405,0)
 ;@calls none
"RTN","SAMIUR",406,0)
 ;
"RTN","SAMIUR",407,0)
 ; extrinsic returns the PAGE NAME for the report
"RTN","SAMIUR",408,0)
 ;
"RTN","SAMIUR",409,0)
 ; if type="followup" quit "Followup next 30 days -"_$get(phrase)
"RTN","SAMIUR",410,0)
 if type="followup" quit "Followup "_$get(phrase)
"RTN","SAMIUR",411,0)
 ; if type="activity" quit "Activity last 30 days -"_$get(phrase)
"RTN","SAMIUR",412,0)
 if type="activity" quit "Activity "_$get(phrase)
"RTN","SAMIUR",413,0)
 if type="missingct" quit "Intake but no CT Evaluation"_$get(phrase)
"RTN","SAMIUR",414,0)
 if type="incomplete" quit "Incomplete Forms"_$get(phrase)
"RTN","SAMIUR",415,0)
 if type="outreach" quit "Outreach"_$get(phrase)
"RTN","SAMIUR",416,0)
 if type="enrollment" quit "Enrollment"_$get(phrase)
"RTN","SAMIUR",417,0)
 if type="inactive" quit "Inactive"_$get(phrase)
"RTN","SAMIUR",418,0)
 ;
"RTN","SAMIUR",419,0)
 quit "" ; end of $$PNAME
"RTN","SAMIUR",420,0)
 ;
"RTN","SAMIUR",421,0)
 ;
"RTN","SAMIUR",422,0)
 ;
"RTN","SAMIUR",423,0)
 ;@section 2 select subroutines
"RTN","SAMIUR",424,0)
 ;
"RTN","SAMIUR",425,0)
 ;
"RTN","SAMIUR",426,0)
 ;
"RTN","SAMIUR",427,0)
SELECT(SAMIPATS,ztype,datephrase,filter) ; select patients for report
"RTN","SAMIUR",428,0)
 ;
"RTN","SAMIUR",429,0)
 ;@called-by
"RTN","SAMIUR",430,0)
 ; WSREPORT
"RTN","SAMIUR",431,0)
 ;@calls
"RTN","SAMIUR",432,0)
 ; UNMAT
"RTN","SAMIUR",433,0)
 ; WKLIST
"RTN","SAMIUR",434,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMIUR",435,0)
 ; $$NOW^XLFDT
"RTN","SAMIUR",436,0)
 ; $$FMADD^XLFDT
"RTN","SAMIUR",437,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMIUR",438,0)
 ; $$setroot^%wd
"RTN","SAMIUR",439,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIUR",440,0)
 ;
"RTN","SAMIUR",441,0)
 ; merge ^gpl("select")=filter
"RTN","SAMIUR",442,0)
 new type set type=ztype
"RTN","SAMIUR",443,0)
 if type="unmatched" do  quit  ;
"RTN","SAMIUR",444,0)
 . do UNMAT(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",445,0)
 . quit
"RTN","SAMIUR",446,0)
 if type="worklist" do  quit  ;
"RTN","SAMIUR",447,0)
 . do WKLIST(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",448,0)
 . quit
"RTN","SAMIUR",449,0)
 if $get(type)="" set type="enrollment"
"RTN","SAMIUR",450,0)
 if type="cumpy" set type="enrollment"
"RTN","SAMIUR",451,0)
 new site set site=$get(filter("siteid"))
"RTN","SAMIUR",452,0)
 ;
"RTN","SAMIUR",453,0)
 new strdt,enddt,fmstrdt,fmenddt
"RTN","SAMIUR",454,0)
 set strdt=$get(filter("start-date"))
"RTN","SAMIUR",455,0)
 set fmstrdt=$$KEY2FM^SAMICASE(strdt)
"RTN","SAMIUR",456,0)
 if fmstrdt=-1 do  ;
"RTN","SAMIUR",457,0)
 . set fmstrdt=2000101
"RTN","SAMIUR",458,0)
 . if type="followup" set fmstrdt=$$NOW^XLFDT
"RTN","SAMIUR",459,0)
 . if type="activity" set fmstrdt=$$FMADD^XLFDT($$NOW^XLFDT,-31)
"RTN","SAMIUR",460,0)
 . quit
"RTN","SAMIUR",461,0)
 if strdt="" set filter("start-date")=$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",462,0)
 ;
"RTN","SAMIUR",463,0)
 set enddt=$get(filter("end-date"))
"RTN","SAMIUR",464,0)
 set fmenddt=$$KEY2FM^SAMICASE(enddt)
"RTN","SAMIUR",465,0)
 if fmenddt=-1 do  ;
"RTN","SAMIUR",466,0)
 . set fmenddt=$$NOW^XLFDT
"RTN","SAMIUR",467,0)
 . if type="followup" set fmenddt=$$FMADD^XLFDT($$NOW^XLFDT,31)
"RTN","SAMIUR",468,0)
 . quit
"RTN","SAMIUR",469,0)
 if enddt="" set filter("end-date")=$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",470,0)
 ;
"RTN","SAMIUR",471,0)
 set datephrase=""
"RTN","SAMIUR",472,0)
 new zi set zi=0
"RTN","SAMIUR",473,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",474,0)
 ;
"RTN","SAMIUR",475,0)
 for  do  quit:'zi  ;
"RTN","SAMIUR",476,0)
 . set zi=$order(@root@(zi))
"RTN","SAMIUR",477,0)
 . quit:'zi
"RTN","SAMIUR",478,0)
 . ;
"RTN","SAMIUR",479,0)
 . new sid set sid=$get(@root@(zi,"samistudyid"))
"RTN","SAMIUR",480,0)
 . quit:sid=""
"RTN","SAMIUR",481,0)
 . quit:$extract(sid,1,3)'=site
"RTN","SAMIUR",482,0)
 . ;
"RTN","SAMIUR",483,0)
 . new items set items=""
"RTN","SAMIUR",484,0)
 . do GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR",485,0)
 . quit:'$data(items)
"RTN","SAMIUR",486,0)
 . ;
"RTN","SAMIUR",487,0)
 . new efmdate,edate,siform,ceform,cefud,fmcefud,cedos,fmcedos
"RTN","SAMIUR",488,0)
 . set siform=$order(items("siform-"))
"RTN","SAMIUR",489,0)
 . new inactive set inactive=$get(@root@("graph",sid,siform,"sistatus"))
"RTN","SAMIUR",490,0)
 . if type="inactive",inactive'="inactive" quit  ; for inactive report
"RTN","SAMIUR",491,0)
 . if type'="inactive",inactive="inactive" quit  ; for other reports
"RTN","SAMIUR",492,0)
 . ;
"RTN","SAMIUR",493,0)
 . set ceform=$order(items("ceform-a"),-1)
"RTN","SAMIUR",494,0)
 . set (cefud,fmcefud,cedos,fmcedos)=""
"RTN","SAMIUR",495,0)
 . if ceform'="" do  ;
"RTN","SAMIUR",496,0)
 . . set cefud=$get(@root@("graph",sid,ceform,"cefud"))
"RTN","SAMIUR",497,0)
 . . if cefud'="" set fmcefud=$$KEY2FM^SAMICASE(cefud)
"RTN","SAMIUR",498,0)
 . . set cedos=$get(@root@("graph",sid,ceform,"cedos"))
"RTN","SAMIUR",499,0)
 . . if cedos'="" set fmcedos=$$KEY2FM^SAMICASE(cedos)
"RTN","SAMIUR",500,0)
 . . quit
"RTN","SAMIUR",501,0)
 . ;
"RTN","SAMIUR",502,0)
 . set edate=$get(@root@("graph",sid,siform,"sidc"))
"RTN","SAMIUR",503,0)
 . if edate="" set edate=$get(@root@("graph",sid,siform,"samicreatedate"))
"RTN","SAMIUR",504,0)
 . set efmdate=$$KEY2FM^SAMICASE(edate)
"RTN","SAMIUR",505,0)
 . set edate=$$VAPALSDT^SAMICASE(efmdate)
"RTN","SAMIUR",506,0)
 . ;
"RTN","SAMIUR",507,0)
 . if type="followup" do  ;
"RTN","SAMIUR",508,0)
 . . ; new nplus30 set nplus30=$$FMADD^XLFDT($$NOW^XLFDT,31)
"RTN","SAMIUR",509,0)
 . . if +fmcefud<fmstrdt quit  ; before start date
"RTN","SAMIUR",510,0)
 . . if +fmcefud<(fmenddt+1) do  ; before end date
"RTN","SAMIUR",511,0)
 . . . quit:ceform=""  ; no ct eval so no followup date
"RTN","SAMIUR",512,0)
 . . . set SAMIPATS(fmcefud,zi,"edate")=edate
"RTN","SAMIUR",513,0)
 . . . set SAMIPATS(fmcefud,zi)=""
"RTN","SAMIUR",514,0)
 . . . if ceform="" set cefud="baseline"
"RTN","SAMIUR",515,0)
 . . . set SAMIPATS(fmcefud,zi,"cefud")=cefud
"RTN","SAMIUR",516,0)
 . . . set SAMIPATS(fmcefud,zi,"cedos")=cedos
"RTN","SAMIUR",517,0)
 . . . set SAMIPATS(fmcefud,zi,"ceform")=ceform
"RTN","SAMIUR",518,0)
 . . . set SAMIPATS(fmcefud,zi,"ceform-vals")=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR",519,0)
 . . . set SAMIPATS(fmcefud,zi,"siform")=siform
"RTN","SAMIUR",520,0)
 . . . set SAMIPATS(fmcefud,zi,"siform-vals")=$name(@root@("graph",sid,siform))
"RTN","SAMIUR",521,0)
 . . . merge SAMIPATS(fmcefud,zi,"items")=items
"RTN","SAMIUR",522,0)
 . . . quit
"RTN","SAMIUR",523,0)
 . . set datephrase=" before "_$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",524,0)
 . . quit
"RTN","SAMIUR",525,0)
 . ;
"RTN","SAMIUR",526,0)
 . if type="activity" do  ;
"RTN","SAMIUR",527,0)
 . . ; new nminus30 set nminus30=$$FMADD^XLFDT($$NOW^XLFDT,-31)
"RTN","SAMIUR",528,0)
 . . new anyform set anyform=$order(items("sort",""),-1)
"RTN","SAMIUR",529,0)
 . . new fmanyform set fmanyform=$$KEY2FM^SAMICASE(anyform)
"RTN","SAMIUR",530,0)
 . . if fmanyform<fmstrdt quit  ; before the start date
"RTN","SAMIUR",531,0)
 . . ; if fmanyform<(fmenddt+1)!(efmdate>fmenddt) do  ; need any new form
"RTN","SAMIUR",532,0)
 . . if fmanyform<(fmenddt+1)  do  ;
"RTN","SAMIUR",533,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",534,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",535,0)
 . . . if ceform="" set cefud="baseline"
"RTN","SAMIUR",536,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",537,0)
 . . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",538,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",539,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",540,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",541,0)
 . . . quit
"RTN","SAMIUR",542,0)
 . . set datephrase=" after "_$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",543,0)
 . . quit
"RTN","SAMIUR",544,0)
 . ;
"RTN","SAMIUR",545,0)
 . ; date filter for all the rest of the reports
"RTN","SAMIUR",546,0)
 . ;
"RTN","SAMIUR",547,0)
 . quit:efmdate<fmstrdt  ; before the start date
"RTN","SAMIUR",548,0)
 . quit:efmdate>(fmenddt+1)  ; after the end date
"RTN","SAMIUR",549,0)
 . ;
"RTN","SAMIUR",550,0)
 . if type="incomplete" do  ;
"RTN","SAMIUR",551,0)
 . . new complete set complete=1
"RTN","SAMIUR",552,0)
 . . new zj set zj=""
"RTN","SAMIUR",553,0)
 . . new gr set gr=$name(@root@("graph",sid))
"RTN","SAMIUR",554,0)
 . . for  do  quit:zj=""  ;
"RTN","SAMIUR",555,0)
 . . . set zj=$order(@gr@(zj))
"RTN","SAMIUR",556,0)
 . . . quit:zj=""
"RTN","SAMIUR",557,0)
 . . . if $get(@gr@(zj,"samistatus"))="incomplete" do  ;
"RTN","SAMIUR",558,0)
 . . . . set complete=0
"RTN","SAMIUR",559,0)
 . . . . set SAMIPATS(efmdate,zi,"iform")=$get(SAMIPATS(efmdate,zi,"iform"))_" "_zj
"RTN","SAMIUR",560,0)
 . . . . quit
"RTN","SAMIUR",561,0)
 . . . quit
"RTN","SAMIUR",562,0)
 . . ;
"RTN","SAMIUR",563,0)
 . . if complete=0 do  ; has incomplete form(s) 
"RTN","SAMIUR",564,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",565,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",566,0)
 . . . if ceform="" set cefud="baseline"
"RTN","SAMIUR",567,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",568,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",569,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",570,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",571,0)
 . . . quit
"RTN","SAMIUR",572,0)
 . . set datephrase=""
"RTN","SAMIUR",573,0)
 . . quit
"RTN","SAMIUR",574,0)
 . ;
"RTN","SAMIUR",575,0)
 . if type="missingct" do  ;
"RTN","SAMIUR",576,0)
 . . if ceform="" do  ; has incomplete form(s) 
"RTN","SAMIUR",577,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",578,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",579,0)
 . . . if ceform="" set cefud="baseline"
"RTN","SAMIUR",580,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",581,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",582,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",583,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",584,0)
 . . . quit
"RTN","SAMIUR",585,0)
 . . set datephrase=""
"RTN","SAMIUR",586,0)
 . . quit
"RTN","SAMIUR",587,0)
 . ;
"RTN","SAMIUR",588,0)
 . if type="outreach" do  ; no-op; hook for future development?
"RTN","SAMIUR",589,0)
 . . quit
"RTN","SAMIUR",590,0)
 . ;
"RTN","SAMIUR",591,0)
 . if type="enrollment" do  ;
"RTN","SAMIUR",592,0)
 . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",593,0)
 . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",594,0)
 . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",595,0)
 . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",596,0)
 . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",597,0)
 . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",598,0)
 . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",599,0)
 . . quit
"RTN","SAMIUR",600,0)
 . ;
"RTN","SAMIUR",601,0)
 . if type="inactive" do  ;
"RTN","SAMIUR",602,0)
 . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",603,0)
 . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",604,0)
 . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",605,0)
 . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",606,0)
 . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",607,0)
 . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",608,0)
 . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",609,0)
 . . quit
"RTN","SAMIUR",610,0)
 . ;
"RTN","SAMIUR",611,0)
 . set datephrase=" as of "_$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMIUR",612,0)
 . quit
"RTN","SAMIUR",613,0)
 ;
"RTN","SAMIUR",614,0)
 quit  ; end of SELECT
"RTN","SAMIUR",615,0)
 ;
"RTN","SAMIUR",616,0)
 ;
"RTN","SAMIUR",617,0)
 ;
"RTN","SAMIUR",618,0)
UNMAT(SAMIPATS,ztype,datephrase,filter) ; build unmatched persons list
"RTN","SAMIUR",619,0)
 ;
"RTN","SAMIUR",620,0)
 ;@called-by
"RTN","SAMIUR",621,0)
 ; SELECT
"RTN","SAMIUR",622,0)
 ;@calls
"RTN","SAMIUR",623,0)
 ; $$setroot^%wd
"RTN","SAMIUR",624,0)
 ;
"RTN","SAMIUR",625,0)
 set datephrase="Unmatched Persons"
"RTN","SAMIUR",626,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",627,0)
 new dfn set dfn=9000000
"RTN","SAMIUR",628,0)
 for  do  quit:'dfn  ;
"RTN","SAMIUR",629,0)
 . set dfn=$order(@lroot@("dfn",dfn))
"RTN","SAMIUR",630,0)
 . quit:'dfn
"RTN","SAMIUR",631,0)
 . ;
"RTN","SAMIUR",632,0)
 . new ien set ien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",633,0)
 . quit:ien=""
"RTN","SAMIUR",634,0)
 . quit:$get(@lroot@(ien,"remotedfn"))'=""  ;
"RTN","SAMIUR",635,0)
 . ;
"RTN","SAMIUR",636,0)
 . merge SAMIPATS(ien,dfn)=@lroot@(ien)
"RTN","SAMIUR",637,0)
 . ;
"RTN","SAMIUR",638,0)
 . ; new name set name=$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR",639,0)
 . new name set name=$get(SAMIPATS(ien,dfn,"sinamef"))
"RTN","SAMIUR",640,0)
 . set name=name_","_SAMIPATS(ien,dfn,"sinamel")
"RTN","SAMIUR",641,0)
 . new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR",642,0)
 . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""editperson"">"
"RTN","SAMIUR",643,0)
 . set nuhref=nuhref_"<input type=hidden name=""dfn"" value="_dfn_">"
"RTN","SAMIUR",644,0)
 . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",645,0)
 . set SAMIPATS(ien,dfn,"editref")=nuhref
"RTN","SAMIUR",646,0)
 . quit
"RTN","SAMIUR",647,0)
 ;
"RTN","SAMIUR",648,0)
 quit  ; end of UNMAT
"RTN","SAMIUR",649,0)
 ;
"RTN","SAMIUR",650,0)
 ;
"RTN","SAMIUR",651,0)
 ;
"RTN","SAMIUR",652,0)
WKLIST(SAMIPATS,ztype,datephrase,filter) ; build work list
"RTN","SAMIUR",653,0)
 ;
"RTN","SAMIUR",654,0)
 ;@called-by
"RTN","SAMIUR",655,0)
 ; SELECT
"RTN","SAMIUR",656,0)
 ;@calls
"RTN","SAMIUR",657,0)
 ; $$setroot^%wd
"RTN","SAMIUR",658,0)
 ;
"RTN","SAMIUR",659,0)
 ; add site
"RTN","SAMIUR",660,0)
 ; add compare to vapals-patients
"RTN","SAMIUR",661,0)
 ; add navigation to enrollment
"RTN","SAMIUR",662,0)
 ;
"RTN","SAMIUR",663,0)
 kill ^gpl("worklist")
"RTN","SAMIUR",664,0)
 merge ^gpl("worklist")=filter
"RTN","SAMIUR",665,0)
 new site
"RTN","SAMIUR",666,0)
 set site=$get(filter("siteid"))
"RTN","SAMIUR",667,0)
 quit:site=""
"RTN","SAMIUR",668,0)
 set datephrase="Work List"
"RTN","SAMIUR",669,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",670,0)
 new proot set proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",671,0)
 ;
"RTN","SAMIUR",672,0)
 new dfn set dfn=0
"RTN","SAMIUR",673,0)
 for  set dfn=$order(@lroot@("dfn",dfn)) quit:+dfn=0  do  ;
"RTN","SAMIUR",674,0)
 . quit:$order(@proot@("dfn",dfn,""))'=""
"RTN","SAMIUR",675,0)
 . new ien set ien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",676,0)
 . quit:ien=""
"RTN","SAMIUR",677,0)
 . ;
"RTN","SAMIUR",678,0)
 . ; write !,"dfn= ",dfn
"RTN","SAMIUR",679,0)
 . ; zwrite @lroot@(ien,*)
"RTN","SAMIUR",680,0)
 . ;
"RTN","SAMIUR",681,0)
 . quit:$get(@lroot@(ien,"siteid"))'=site
"RTN","SAMIUR",682,0)
 . ;
"RTN","SAMIUR",683,0)
 . merge ^gpl("worklist","lroot",ien)=@lroot@(ien)
"RTN","SAMIUR",684,0)
 . merge SAMIPATS(ien,dfn)=@lroot@(ien)
"RTN","SAMIUR",685,0)
 . new name set name=$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR",686,0)
 . ; new name set name=$get(SAMIPATS(ien,dfn,"sinamef"))
"RTN","SAMIUR",687,0)
 . ; set name=name_","_SAMIPATS(ien,dfn,"sinamel")
"RTN","SAMIUR",688,0)
 . new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR",689,0)
 . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""newcase"">"
"RTN","SAMIUR",690,0)
 . set nuhref=nuhref_"<input type=hidden name=""dfn"" value="_dfn_">"
"RTN","SAMIUR",691,0)
 . set nuhref=nuhref_"<input type=hidden name=""siteid"" value="_site_">"
"RTN","SAMIUR",692,0)
 . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",693,0)
 . set SAMIPATS(ien,dfn,"workref")=nuhref
"RTN","SAMIUR",694,0)
 . quit
"RTN","SAMIUR",695,0)
 ;
"RTN","SAMIUR",696,0)
 merge ^gpl("worklist","pats")=SAMIPATS
"RTN","SAMIUR",697,0)
 ;
"RTN","SAMIUR",698,0)
 quit  ; end of WKLIST
"RTN","SAMIUR",699,0)
 ;
"RTN","SAMIUR",700,0)
 ;
"RTN","SAMIUR",701,0)
 ;
"RTN","SAMIUR",702,0)
EOR ; end of SAMIUR
"RTN","SAMIUR2")
0^5^B1106323315
"RTN","SAMIUR2",1,0)
SAMIUR2 ;ven/gpl - sami user reports ;2021-05-21T20:47Z
"RTN","SAMIUR2",2,0)
 ;;18.0;SAMI;**5,11**;2020-01;Build 19
"RTN","SAMIUR2",3,0)
 ;;1.18.0.11+i11
"RTN","SAMIUR2",4,0)
 ;
"RTN","SAMIUR2",5,0)
 ; SAMIUR2 contains subroutines for creating & implementing the
"RTN","SAMIUR2",6,0)
 ; report-definition table.
"RTN","SAMIUR2",7,0)
 ;
"RTN","SAMIUR2",8,0)
 quit  ; no entry from top
"RTN","SAMIUR2",9,0)
 ;
"RTN","SAMIUR2",10,0)
 ;
"RTN","SAMIUR2",11,0)
 ;
"RTN","SAMIUR2",12,0)
 ;@section 0 primary development
"RTN","SAMIUR2",13,0)
 ;
"RTN","SAMIUR2",14,0)
 ;
"RTN","SAMIUR2",15,0)
 ;
"RTN","SAMIUR2",16,0)
 ;@routine-credits
"RTN","SAMIUR2",17,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMIUR2",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUR2",19,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMIUR2",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIUR2",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIUR2",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIUR2",23,0)
 ;
"RTN","SAMIUR2",24,0)
 ;@last-updated 2021-05-21T20:47Z
"RTN","SAMIUR2",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIUR2",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIUR2",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUR2",28,0)
 ;@version 1.18.0.11+i11
"RTN","SAMIUR2",29,0)
 ;@release-date 2020-01
"RTN","SAMIUR2",30,0)
 ;@patch-list **5,11**
"RTN","SAMIUR2",31,0)
 ;
"RTN","SAMIUR2",32,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMIUR2",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUR2",34,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMIUR2",35,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIUR2",36,0)
 ;@additional-dev Alexis R. Carlson (arc)
"RTN","SAMIUR2",37,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIUR2",38,0)
 ;@additional-dev Kenneth McGlothlen (mcglk)
"RTN","SAMIUR2",39,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIUR2",40,0)
 ;
"RTN","SAMIUR2",41,0)
 ;@module-credits
"RTN","SAMIUR2",42,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIUR2",43,0)
 ; (VA-PALS)
"RTN","SAMIUR2",44,0)
 ; http://va-pals.org/
"RTN","SAMIUR2",45,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIUR2",46,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIUR2",47,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIUR2",48,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIUR2",49,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIUR2",50,0)
 ; http://ielcap.com/
"RTN","SAMIUR2",51,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIUR2",52,0)
 ; http://paraxialtech.com/
"RTN","SAMIUR2",53,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIUR2",54,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIUR2",55,0)
 ;
"RTN","SAMIUR2",56,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUR2",57,0)
 ;
"RTN","SAMIUR2",58,0)
 ; 2019-02-10/14 ven/gpl 1.18.0 d543f7b,f9869df,5e67489
"RTN","SAMIUR2",59,0)
 ;  SAMIUR2: 1st version of revised user reports, progress, add rural/
"RTN","SAMIUR2",60,0)
 ; urban & compute.
"RTN","SAMIUR2",61,0)
 ;
"RTN","SAMIUR2",62,0)
 ; 2019-03-24/28 ven/gpl 1.18.0 1fd4a4c,0cebb36
"RTN","SAMIUR2",63,0)
 ;  SAMIUR2: revise incomplete form report, remove ethnicity from
"RTN","SAMIUR2",64,0)
 ; enrollment report (we can't get it).
"RTN","SAMIUR2",65,0)
 ;
"RTN","SAMIUR2",66,0)
 ; 2019-05-08 ven/lgc 1.18.0 2172e51
"RTN","SAMIUR2",67,0)
 ;  SAMIUR2: remove blank last line.
"RTN","SAMIUR2",68,0)
 ;
"RTN","SAMIUR2",69,0)
 ; 2019-06-21 par/dom 1.18.0 c6a4a57 VAP-352
"RTN","SAMIUR2",70,0)
 ;  SAMIUR2: proper spelling of "follow up."
"RTN","SAMIUR2",71,0)
 ;
"RTN","SAMIUR2",72,0)
 ; 2019-08-03/04 ven/gpl 1.18.0 ffc94f6,d03557d,cd865e2 VPA-438
"RTN","SAMIUR2",73,0)
 ;  SAMIUR2: fix smoking status on enrollment report, fix change log
"RTN","SAMIUR2",74,0)
 ; display, add pack years at intake to enrollment report, add
"RTN","SAMIUR2",75,0)
 ; requested changes to followup report.
"RTN","SAMIUR2",76,0)
 ;
"RTN","SAMIUR2",77,0)
 ; 2019-09-26 ven/gpl 1.18.0 92b1232 VAP-420
"RTN","SAMIUR2",78,0)
 ;  SAMIUR2: smoking history, new cummulative packyear processing.
"RTN","SAMIUR2",79,0)
 ;
"RTN","SAMIUR2",80,0)
 ; 2019-10-01 par/dom 1.18.0 4caf1a9 VAP-344
"RTN","SAMIUR2",81,0)
 ;  SAMIUR2: make capitalization consistent.
"RTN","SAMIUR2",82,0)
 ;
"RTN","SAMIUR2",83,0)
 ; 2020-01-01/05 ven/arc 1.18.0 399f854,62e3200
"RTN","SAMIUR2",84,0)
 ;  SAMIUR2: add unmatched patient processing.
"RTN","SAMIUR2",85,0)
 ;
"RTN","SAMIUR2",86,0)
 ; 2020-01-10 ven/gpl 1.18.0 1590577
"RTN","SAMIUR2",87,0)
 ;  SAMIUR2: fix return on RACE^SAMIUR2 for cache.
"RTN","SAMIUR2",88,0)
 ;
"RTN","SAMIUR2",89,0)
 ; 2020-05-13/14 ven/gpl 1.18.0.5+i5 61c7d20,b05df41
"RTN","SAMIUR2",90,0)
 ;  SAMIUR2: add worklist functionality, fix gender & dob detection on
"RTN","SAMIUR2",91,0)
 ; reports.
"RTN","SAMIUR2",92,0)
 ;
"RTN","SAMIUR2",93,0)
 ; 2021-04-13 ven/gpl 1.18.0.11+i11 a12765b,f09ffef,fb399ab
"RTN","SAMIUR2",94,0)
 ;  SAMIUR2: in RPTTBL,GENDER create inactive report, move last exam
"RTN","SAMIUR2",95,0)
 ; column on followup report, fix gender being blank in reports.
"RTN","SAMIUR2",96,0)
 ;
"RTN","SAMIUR2",97,0)
 ; 2021-05-20/21 ven/mcglk&toad 1.18.0.11+i11
"RTN","SAMIUR2",98,0)
 ;  SAMIUR2: passim hdr comments, chg log, annotate, refactor, bump
"RTN","SAMIUR2",99,0)
 ; version.
"RTN","SAMIUR2",100,0)
 ;
"RTN","SAMIUR2",101,0)
 ;@contents
"RTN","SAMIUR2",102,0)
 ; RPTTBL build report-definition table
"RTN","SAMIUR2",103,0)
 ;
"RTN","SAMIUR2",104,0)
 ; $$DFN2SID study id for patient DFN
"RTN","SAMIUR2",105,0)
 ; $$MKNAV html for navigation to form
"RTN","SAMIUR2",106,0)
 ;
"RTN","SAMIUR2",107,0)
 ; $$SHDET table contents for smoking history
"RTN","SAMIUR2",108,0)
 ; CUMPY forms array of cummulative pack year data
"RTN","SAMIUR2",109,0)
 ; $$FMDT convert date to fileman format
"RTN","SAMIUR2",110,0)
 ; $$PKYDT pack-years from start & end & cigs/day
"RTN","SAMIUR2",111,0)
 ; $$PKY pack-years from years & packs/day
"RTN","SAMIUR2",112,0)
 ;
"RTN","SAMIUR2",113,0)
 ; $$AGE age
"RTN","SAMIUR2",114,0)
 ; $$BLINEDT baseline date
"RTN","SAMIUR2",115,0)
 ; $$CONTACT patient street address
"RTN","SAMIUR2",116,0)
 ; $$CTPROT ct protocol
"RTN","SAMIUR2",117,0)
 ; $$DOB date of birth
"RTN","SAMIUR2",118,0)
 ; $$FUDATE followup date
"RTN","SAMIUR2",119,0)
 ; $$GENDER gender
"RTN","SAMIUR2",120,0)
 ; $$IFORM name(s) of incomplete forms
"RTN","SAMIUR2",121,0)
 ; $$LASTEXM patient last exam
"RTN","SAMIUR2",122,0)
 ; $$MANPAT unmatched patient cell
"RTN","SAMIUR2",123,0)
 ; $$MATCH match button cell
"RTN","SAMIUR2",124,0)
 ; $$NAME name w/hyperlink
"RTN","SAMIUR2",125,0)
 ; $$PACKYRS smoking status
"RTN","SAMIUR2",126,0)
 ; $$POSSIBLE possible match cell
"RTN","SAMIUR2",127,0)
 ; $$RECOM recommendation
"RTN","SAMIUR2",128,0)
 ; $$RURAL patient's rural/urban status
"RTN","SAMIUR2",129,0)
 ; $$SID study id
"RTN","SAMIUR2",130,0)
 ; $$SMHIS smoking history cell
"RTN","SAMIUR2",131,0)
 ; $$SMKSTAT smoking status
"RTN","SAMIUR2",132,0)
 ; $$SSN social security number
"RTN","SAMIUR2",133,0)
 ; $$STUDYDT latest study date
"RTN","SAMIUR2",134,0)
 ; $$STUDYTYP latest study type
"RTN","SAMIUR2",135,0)
 ; $$VALS form-values cell
"RTN","SAMIUR2",136,0)
 ; $$WHEN followup text
"RTN","SAMIUR2",137,0)
 ; $$WORKPAT worklist patient name cell
"RTN","SAMIUR2",138,0)
 ;
"RTN","SAMIUR2",139,0)
 ; EPAT patient name w/nav to enrollment
"RTN","SAMIUR2",140,0)
 ; ETHNCTY ethnicity
"RTN","SAMIUR2",141,0)
 ; RACE race
"RTN","SAMIUR2",142,0)
 ; STATUS patient status
"RTN","SAMIUR2",143,0)
 ; WSVALS display form values from graph
"RTN","SAMIUR2",144,0)
 ;
"RTN","SAMIUR2",145,0)
 ;
"RTN","SAMIUR2",146,0)
 ;
"RTN","SAMIUR2",147,0)
 ;@section 1 ppi RPTTBL^SAMIUR2
"RTN","SAMIUR2",148,0)
 ;
"RTN","SAMIUR2",149,0)
 ;
"RTN","SAMIUR2",150,0)
 ;
"RTN","SAMIUR2",151,0)
RPTTBL(RPT,TYPE) ; build report-definition table
"RTN","SAMIUR2",152,0)
 ;
"RTN","SAMIUR2",153,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIUR2",154,0)
 ;@called-by
"RTN","SAMIUR2",155,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",156,0)
 ; WSREPORT^SAMIUR1 (which then calls WSREPORT^SAMIUR)
"RTN","SAMIUR2",157,0)
 ;@calls none (defines calls for WSREPORT^SAMIUR to call)
"RTN","SAMIUR2",158,0)
 ;@input
"RTN","SAMIUR2",159,0)
 ; TYPE = report type to return
"RTN","SAMIUR2",160,0)
 ;@output
"RTN","SAMIUR2",161,0)
 ; .RPT report-definition table
"RTN","SAMIUR2",162,0)
 ;
"RTN","SAMIUR2",163,0)
 ; This routine could use a file or a graph in the next version
"RTN","SAMIUR2",164,0)
 ;
"RTN","SAMIUR2",165,0)
 if TYPE="followup" do  quit  ;
"RTN","SAMIUR2",166,0)
 . set RPT(1,"header")="F/U Date"
"RTN","SAMIUR2",167,0)
 . set RPT(1,"routine")="$$FUDATE^SAMIUR2"
"RTN","SAMIUR2",168,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",169,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",170,0)
 . set RPT(3,"header")="SSN"
"RTN","SAMIUR2",171,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",172,0)
 . set RPT(4,"header")="Baseline Date"
"RTN","SAMIUR2",173,0)
 . set RPT(4,"routine")="$$BLINEDT^SAMIUR2"
"RTN","SAMIUR2",174,0)
 . set RPT(6,"header")="Recommend"
"RTN","SAMIUR2",175,0)
 . set RPT(6,"routine")="$$RECOM^SAMIUR2"
"RTN","SAMIUR2",176,0)
 . set RPT(7,"header")="When"
"RTN","SAMIUR2",177,0)
 . set RPT(7,"routine")="$$WHEN^SAMIUR2"
"RTN","SAMIUR2",178,0)
 . set RPT(5,"header")="Last Exam"
"RTN","SAMIUR2",179,0)
 . set RPT(5,"routine")="$$LASTEXM^SAMIUR2"
"RTN","SAMIUR2",180,0)
 . set RPT(8,"header")="Contact Information"
"RTN","SAMIUR2",181,0)
 . set RPT(8,"routine")="$$CONTACT^SAMIUR2"
"RTN","SAMIUR2",182,0)
 . quit
"RTN","SAMIUR2",183,0)
 ;
"RTN","SAMIUR2",184,0)
 if TYPE="activity" do  quit  ;
"RTN","SAMIUR2",185,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",186,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",187,0)
 . set RPT(2,"header")="SSN"
"RTN","SAMIUR2",188,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",189,0)
 . set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",190,0)
 . set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",191,0)
 . set RPT(4,"header")="Type"
"RTN","SAMIUR2",192,0)
 . set RPT(4,"routine")="$$STUDYTYP^SAMIUR2"
"RTN","SAMIUR2",193,0)
 . set RPT(5,"header")="CT Protocol"
"RTN","SAMIUR2",194,0)
 . set RPT(5,"routine")="$$CTPROT^SAMIUR2"
"RTN","SAMIUR2",195,0)
 . set RPT(6,"header")="Follow-up"
"RTN","SAMIUR2",196,0)
 . set RPT(6,"routine")="$$RECOM^SAMIUR2"
"RTN","SAMIUR2",197,0)
 . set RPT(7,"header")="When"
"RTN","SAMIUR2",198,0)
 . set RPT(7,"routine")="$$WHEN^SAMIUR2"
"RTN","SAMIUR2",199,0)
 . set RPT(8,"header")="on Date"
"RTN","SAMIUR2",200,0)
 . set RPT(8,"routine")="$$FUDATE^SAMIUR2"
"RTN","SAMIUR2",201,0)
 . quit
"RTN","SAMIUR2",202,0)
 ;
"RTN","SAMIUR2",203,0)
 if TYPE="enrollment" do  quit  ;
"RTN","SAMIUR2",204,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",205,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",206,0)
 . set RPT(2,"header")="SSN"
"RTN","SAMIUR2",207,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",208,0)
 . set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",209,0)
 . set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",210,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",211,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",212,0)
 . ; set RPT(5,"header")="Race"
"RTN","SAMIUR2",213,0)
 . ; set RPT(5,"routine")="$$RACE^SAMIUR2"
"RTN","SAMIUR2",214,0)
 . set RPT(6,"header")="Age"
"RTN","SAMIUR2",215,0)
 . set RPT(6,"routine")="$$AGE^SAMIUR2"
"RTN","SAMIUR2",216,0)
 . set RPT(7,"header")="Urban/Rural"
"RTN","SAMIUR2",217,0)
 . set RPT(7,"routine")="$$RURAL^SAMIUR2"
"RTN","SAMIUR2",218,0)
 . set RPT(8,"header")="Smoking Status"
"RTN","SAMIUR2",219,0)
 . set RPT(8,"routine")="$$SMKSTAT^SAMIUR2"
"RTN","SAMIUR2",220,0)
 . set RPT(9,"header")="Pack Years at Intake"
"RTN","SAMIUR2",221,0)
 . set RPT(9,"routine")="$$PACKYRS^SAMIUR2"
"RTN","SAMIUR2",222,0)
 . quit
"RTN","SAMIUR2",223,0)
 ;
"RTN","SAMIUR2",224,0)
 if TYPE="inactive" do  quit  ;
"RTN","SAMIUR2",225,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",226,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",227,0)
 . set RPT(2,"header")="SSN"
"RTN","SAMIUR2",228,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",229,0)
 . set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",230,0)
 . set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",231,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",232,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",233,0)
 . ; set RPT(5,"header")="Race"
"RTN","SAMIUR2",234,0)
 . ; set RPT(5,"routine")="$$RACE^SAMIUR2"
"RTN","SAMIUR2",235,0)
 . set RPT(6,"header")="Age"
"RTN","SAMIUR2",236,0)
 . set RPT(6,"routine")="$$AGE^SAMIUR2"
"RTN","SAMIUR2",237,0)
 . set RPT(7,"header")="Urban/Rural"
"RTN","SAMIUR2",238,0)
 . set RPT(7,"routine")="$$RURAL^SAMIUR2"
"RTN","SAMIUR2",239,0)
 . set RPT(8,"header")="Smoking Status"
"RTN","SAMIUR2",240,0)
 . set RPT(8,"routine")="$$SMKSTAT^SAMIUR2"
"RTN","SAMIUR2",241,0)
 . set RPT(9,"header")="Pack Years at Intake"
"RTN","SAMIUR2",242,0)
 . set RPT(9,"routine")="$$PACKYRS^SAMIUR2"
"RTN","SAMIUR2",243,0)
 . quit
"RTN","SAMIUR2",244,0)
 ;
"RTN","SAMIUR2",245,0)
 if TYPE="incomplete" do  quit  ;
"RTN","SAMIUR2",246,0)
 . set RPT(1,"header")="Enrollment date"
"RTN","SAMIUR2",247,0)
 . set RPT(1,"routine")="$$BLINEDT^SAMIUR2"
"RTN","SAMIUR2",248,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",249,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",250,0)
 . set RPT(3,"header")="SSN"
"RTN","SAMIUR2",251,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",252,0)
 . set RPT(4,"header")="Incomplete form"
"RTN","SAMIUR2",253,0)
 . set RPT(4,"routine")="$$IFORM^SAMIUR2"
"RTN","SAMIUR2",254,0)
 . quit
"RTN","SAMIUR2",255,0)
 ;
"RTN","SAMIUR2",256,0)
 if TYPE="missingct" do  quit  ;
"RTN","SAMIUR2",257,0)
 . set RPT(1,"header")="Enrollment date"
"RTN","SAMIUR2",258,0)
 . set RPT(1,"routine")="$$BLINEDT^SAMIUR2"
"RTN","SAMIUR2",259,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",260,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",261,0)
 . set RPT(3,"header")="SSN"
"RTN","SAMIUR2",262,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",263,0)
 . quit
"RTN","SAMIUR2",264,0)
 ;
"RTN","SAMIUR2",265,0)
 if TYPE="cumpy" do  quit  ;
"RTN","SAMIUR2",266,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",267,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",268,0)
 . set RPT(2,"header")="Study ID"
"RTN","SAMIUR2",269,0)
 . set RPT(2,"routine")="$$SID^SAMIUR2"
"RTN","SAMIUR2",270,0)
 . set RPT(3,"header")="Form Values"
"RTN","SAMIUR2",271,0)
 . set RPT(3,"routine")="$$VALS^SAMIUR2"
"RTN","SAMIUR2",272,0)
 . set RPT(4,"header")="Smoking History"
"RTN","SAMIUR2",273,0)
 . set RPT(4,"routine")="$$SMHIS^SAMIUR2"
"RTN","SAMIUR2",274,0)
 . quit
"RTN","SAMIUR2",275,0)
 ;
"RTN","SAMIUR2",276,0)
 if TYPE="unmatched" do  ;
"RTN","SAMIUR2",277,0)
 . set RPT(1,"header")="Unmatched Entry"
"RTN","SAMIUR2",278,0)
 . set RPT(1,"routine")="$$MANPAT^SAMIUR2"
"RTN","SAMIUR2",279,0)
 . set RPT(2,"header")="Possible Match"
"RTN","SAMIUR2",280,0)
 . set RPT(2,"routine")="$$POSSIBLE^SAMIUR2"
"RTN","SAMIUR2",281,0)
 . set RPT(3,"header")="Match Control"
"RTN","SAMIUR2",282,0)
 . set RPT(3,"routine")="$$MATCH^SAMIUR2"
"RTN","SAMIUR2",283,0)
 . quit
"RTN","SAMIUR2",284,0)
 ;
"RTN","SAMIUR2",285,0)
 if TYPE="worklist" do  quit  ;
"RTN","SAMIUR2",286,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",287,0)
 . set RPT(1,"routine")="$$WORKPAT^SAMIUR2"
"RTN","SAMIUR2",288,0)
 . set RPT(2,"header")="SSN"
"RTN","SAMIUR2",289,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",290,0)
 . set RPT(3,"header")="Date of birth"
"RTN","SAMIUR2",291,0)
 . set RPT(3,"routine")="$$DOB^SAMIUR2"
"RTN","SAMIUR2",292,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",293,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",294,0)
 . quit
"RTN","SAMIUR2",295,0)
 ;
"RTN","SAMIUR2",296,0)
 quit  ; end of ppi RPTTBL^SAMIUR2
"RTN","SAMIUR2",297,0)
 ;
"RTN","SAMIUR2",298,0)
 ;
"RTN","SAMIUR2",299,0)
 ;
"RTN","SAMIUR2",300,0)
 ;@section 2 shared subroutines
"RTN","SAMIUR2",301,0)
 ;
"RTN","SAMIUR2",302,0)
 ;
"RTN","SAMIUR2",303,0)
 ;
"RTN","SAMIUR2",304,0)
DFN2SID(DFN) ;studyid for patient DFN
"RTN","SAMIUR2",305,0)
 ;
"RTN","SAMIUR2",306,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",307,0)
 ;@called-by
"RTN","SAMIUR2",308,0)
 ; $$SID^SAMIUR2
"RTN","SAMIUR2",309,0)
 ; $$IFORM^SAMIUR2
"RTN","SAMIUR2",310,0)
 ; $$VALS^SAMIUR2
"RTN","SAMIUR2",311,0)
 ; $$SMHIS^SAMIUR2
"RTN","SAMIUR2",312,0)
 ;@calls
"RTN","SAMIUR2",313,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",314,0)
 ;
"RTN","SAMIUR2",315,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",316,0)
 ;
"RTN","SAMIUR2",317,0)
 quit $get(@root@(DFN,"sisid")) ; end of $$DFN2SID
"RTN","SAMIUR2",318,0)
 ;
"RTN","SAMIUR2",319,0)
 ;
"RTN","SAMIUR2",320,0)
 ;
"RTN","SAMIUR2",321,0)
MKNAV(sid,zform,fname,form) ; html for navigation to form
"RTN","SAMIUR2",322,0)
 ;
"RTN","SAMIUR2",323,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",324,0)
 ;@called-by
"RTN","SAMIUR2",325,0)
 ; $$IFORM^SAMIUR2
"RTN","SAMIUR2",326,0)
 ;@calls none
"RTN","SAMIUR2",327,0)
 ;
"RTN","SAMIUR2",328,0)
 new rtn set rtn="<form method=""post"" action=""/vapals"">"
"RTN","SAMIUR2",329,0)
 set rtn=rtn_"<input name=""samiroute"" value=""form"" type=""hidden"">"
"RTN","SAMIUR2",330,0)
 set rtn=rtn_" <input name=""studyid"" value="""_sid_""" type=""hidden"">"
"RTN","SAMIUR2",331,0)
 set rtn=rtn_" <input name=""form"" value=""vapals:"_zform_""" type=""hidden"">"
"RTN","SAMIUR2",332,0)
 set rtn=rtn_" <input value="""_fname_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"_$char(13)
"RTN","SAMIUR2",333,0)
 ;
"RTN","SAMIUR2",334,0)
 quit rtn ; end of $$MKNAV
"RTN","SAMIUR2",335,0)
 ;
"RTN","SAMIUR2",336,0)
 ;
"RTN","SAMIUR2",337,0)
 ;
"RTN","SAMIUR2",338,0)
 ;@section 3 smoking history subroutines
"RTN","SAMIUR2",339,0)
 ;
"RTN","SAMIUR2",340,0)
 ;
"RTN","SAMIUR2",341,0)
 ;
"RTN","SAMIUR2",342,0)
SHDET(SID,KEY) ; table contents for smoking history
"RTN","SAMIUR2",343,0)
 ;
"RTN","SAMIUR2",344,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",345,0)
 ;@called-by
"RTN","SAMIUR2",346,0)
 ; LOAD^SAMIFLD
"RTN","SAMIUR2",347,0)
 ; $$SMHIS^SAMIUR2
"RTN","SAMIUR2",348,0)
 ;@calls
"RTN","SAMIUR2",349,0)
 ; CUMPY
"RTN","SAMIUR2",350,0)
 ;
"RTN","SAMIUR2",351,0)
 ; KEY is the form key of the caller for "current" marker insertion
"RTN","SAMIUR2",352,0)
 ;
"RTN","SAMIUR2",353,0)
 new pyary
"RTN","SAMIUR2",354,0)
 if $get(KEY)="" set KEY=""
"RTN","SAMIUR2",355,0)
 do CUMPY("pyary",SID,KEY)
"RTN","SAMIUR2",356,0)
 ;
"RTN","SAMIUR2",357,0)
 new current set current=$get(pyary("current"))
"RTN","SAMIUR2",358,0)
 new rptcnt set rptcnt=0
"RTN","SAMIUR2",359,0)
 new rptmax set rptmax=$order(pyary("rpt",""),-1)
"RTN","SAMIUR2",360,0)
 quit:+rptmax=0
"RTN","SAMIUR2",361,0)
 ;
"RTN","SAMIUR2",362,0)
 new return set return=""
"RTN","SAMIUR2",363,0)
 new zi set zi=""
"RTN","SAMIUR2",364,0)
 for zi=1:1:rptmax do  ;
"RTN","SAMIUR2",365,0)
 . set rptcnt=rptcnt+1
"RTN","SAMIUR2",366,0)
 . if rptcnt=current set return=return_"<tr data-current-form=""true"">"
"RTN","SAMIUR2",367,0)
 . else  set return=return_"<tr>"
"RTN","SAMIUR2",368,0)
 . set return=return_"<td>"_pyary("rpt",rptcnt,1)_"</td>"
"RTN","SAMIUR2",369,0)
 . set return=return_"<td class=""reported-date"">"_pyary("rpt",rptcnt,2)_"</td>"
"RTN","SAMIUR2",370,0)
 . set return=return_"<td class=""pack-years"">"_pyary("rpt",rptcnt,3)_"</td>"
"RTN","SAMIUR2",371,0)
 . set return=return_"<td class=""cumulative-pack-years"">"_pyary("rpt",rptcnt,4)_"</td>"
"RTN","SAMIUR2",372,0)
 . set return=return_"</tr>"
"RTN","SAMIUR2",373,0)
 . quit
"RTN","SAMIUR2",374,0)
 ;
"RTN","SAMIUR2",375,0)
 quit return ; end of ppi $$SHDET^SAMIUR2
"RTN","SAMIUR2",376,0)
 ;
"RTN","SAMIUR2",377,0)
 ;
"RTN","SAMIUR2",378,0)
 ;
"RTN","SAMIUR2",379,0)
CUMPY(PYARY,sid,KEY) ; forms array of cummulative pack year data
"RTN","SAMIUR2",380,0)
 ;
"RTN","SAMIUR2",381,0)
 ;;ppi;procedure;clean;silent;sac
"RTN","SAMIUR2",382,0)
 ;@called-by
"RTN","SAMIUR2",383,0)
 ; SSTATUS^SAMINOT2
"RTN","SAMIUR2",384,0)
 ; SSTATUS^SAMINOT3
"RTN","SAMIUR2",385,0)
 ; $$SHDET
"RTN","SAMIUR2",386,0)
 ;@calls
"RTN","SAMIUR2",387,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",388,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIUR2",389,0)
 ; $$GETDTKEY^SAMICAS2
"RTN","SAMIUR2",390,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMIUR2",391,0)
 ; $$FMDT
"RTN","SAMIUR2",392,0)
 ; $$PKYDT
"RTN","SAMIUR2",393,0)
 ;
"RTN","SAMIUR2",394,0)
 ; PYARY passed by name
"RTN","SAMIUR2",395,0)
 ; KEY is the current form key for matching to a row
"RTN","SAMIUR2",396,0)
 ;
"RTN","SAMIUR2",397,0)
 kill @PYARY
"RTN","SAMIUR2",398,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",399,0)
 ; new sid set sid=$get(@root@(DFN,"samistudyid"))
"RTN","SAMIUR2",400,0)
 ; quit:sid=""
"RTN","SAMIUR2",401,0)
 ;
"RTN","SAMIUR2",402,0)
 new items set items=""
"RTN","SAMIUR2",403,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR2",404,0)
 quit:'$data(items)
"RTN","SAMIUR2",405,0)
 merge @PYARY@("items")=items
"RTN","SAMIUR2",406,0)
 ;
"RTN","SAMIUR2",407,0)
 new siform set siform=$order(items("siform"))
"RTN","SAMIUR2",408,0)
 quit:siform=""
"RTN","SAMIUR2",409,0)
 if siform=$get(KEY) set @PYARY@("current")=1 ;this row is the current form
"RTN","SAMIUR2",410,0)
 ;
"RTN","SAMIUR2",411,0)
 set @PYARY@("rpt",1,1)="Intake" ; Form
"RTN","SAMIUR2",412,0)
 new kdate set kdate=$$GETDTKEY^SAMICAS2(siform)
"RTN","SAMIUR2",413,0)
 new keydate set keydate=$$KEY2DSPD^SAMICAS2(kdate)
"RTN","SAMIUR2",414,0)
 set @PYARY@("rpt",1,2)=keydate ; Reported Date
"RTN","SAMIUR2",415,0)
 ;
"RTN","SAMIUR2",416,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",417,0)
 new lastcum set lastcum=$get(@vals@("sippy"))
"RTN","SAMIUR2",418,0)
 set @PYARY@("rpt",1,3)=lastcum ; Pack Years
"RTN","SAMIUR2",419,0)
 set @PYARY@("rpt",1,4)=lastcum ; Cumulative
"RTN","SAMIUR2",420,0)
 ;
"RTN","SAMIUR2",421,0)
 new lastdt set lastdt=keydate
"RTN","SAMIUR2",422,0)
 new rptcnt set rptcnt=1
"RTN","SAMIUR2",423,0)
 new zi set zi=""
"RTN","SAMIUR2",424,0)
 for  do  quit:zi=""  ;
"RTN","SAMIUR2",425,0)
 . set zi=$order(items("type","vapals:fuform",zi))
"RTN","SAMIUR2",426,0)
 . quit:zi=""
"RTN","SAMIUR2",427,0)
 . ;
"RTN","SAMIUR2",428,0)
 . set rptcnt=rptcnt+1
"RTN","SAMIUR2",429,0)
 . set @PYARY@("rpt",rptcnt,1)="Follow-up"
"RTN","SAMIUR2",430,0)
 . new kdate set kdate=$$GETDTKEY^SAMICAS2(zi)
"RTN","SAMIUR2",431,0)
 . new keydate set keydate=$$KEY2DSPD^SAMICAS2(kdate)
"RTN","SAMIUR2",432,0)
 . set @PYARY@("rpt",rptcnt,2)=keydate ; Reported Date
"RTN","SAMIUR2",433,0)
 . ;
"RTN","SAMIUR2",434,0)
 . set vals=$name(@root@("graph",sid,zi))
"RTN","SAMIUR2",435,0)
 . new newpd set newpd=$g(@vals@("sippd"))
"RTN","SAMIUR2",436,0)
 . new usedate set usedate=keydate
"RTN","SAMIUR2",437,0)
 . new siq set siq=$get(@vals@("siq")) ; quit date on followup form
"RTN","SAMIUR2",438,0)
 . if siq'="" do  ; quit date provided
"RTN","SAMIUR2",439,0)
 . . quit:$$FMDT(siq)<$$FMDT(lastdt)  ; quit date out of range
"RTN","SAMIUR2",440,0)
 . . quit:$$FMDT(siq)>$$FMDT(keydate)  ; quit date out of range
"RTN","SAMIUR2",441,0)
 . . set usedate=siq ; use the quit date as end of range
"RTN","SAMIUR2",442,0)
 . . quit
"RTN","SAMIUR2",443,0)
 . new newpy set newpy=$$PKYDT(lastdt,usedate,newpd)
"RTN","SAMIUR2",444,0)
 . set @vals@("sippy")=newpy
"RTN","SAMIUR2",445,0)
 . ;
"RTN","SAMIUR2",446,0)
 . set ^gpl("current","KEY")=$get(KEY)
"RTN","SAMIUR2",447,0)
 . set ^gpl("current","zi")=zi
"RTN","SAMIUR2",448,0)
 . if zi=$get(KEY) do
"RTN","SAMIUR2",449,0)
 . . set @PYARY@("current")=rptcnt ;this row is the current form
"RTN","SAMIUR2",450,0)
 . . quit
"RTN","SAMIUR2",451,0)
 . ;
"RTN","SAMIUR2",452,0)
 . new newcum set newcum=""
"RTN","SAMIUR2",453,0)
 . if newpy'="" set newcum=lastcum+newpy
"RTN","SAMIUR2",454,0)
 . set @PYARY@("rpt",rptcnt,3)=newpy ; Pack Years
"RTN","SAMIUR2",455,0)
 . set @PYARY@("rpt",rptcnt,4)=newcum ; Cumulative
"RTN","SAMIUR2",456,0)
 . set lastdt=keydate
"RTN","SAMIUR2",457,0)
 . set lastcum=newcum
"RTN","SAMIUR2",458,0)
 . quit
"RTN","SAMIUR2",459,0)
 ;
"RTN","SAMIUR2",460,0)
 quit  ; end of ppi CUMPY^SAMIUR2
"RTN","SAMIUR2",461,0)
 ; 
"RTN","SAMIUR2",462,0)
 ;
"RTN","SAMIUR2",463,0)
 ;
"RTN","SAMIUR2",464,0)
FMDT(ZDT) ; convert date to fileman format
"RTN","SAMIUR2",465,0)
 ;
"RTN","SAMIUR2",466,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",467,0)
 ;@called-by
"RTN","SAMIUR2",468,0)
 ; MKPTLK^SAMIHOM4
"RTN","SAMIUR2",469,0)
 ; $$PKYDT
"RTN","SAMIUR2",470,0)
 ; CUMPY
"RTN","SAMIUR2",471,0)
 ;@calls
"RTN","SAMIUR2",472,0)
 ; ^%DT
"RTN","SAMIUR2",473,0)
 ;
"RTN","SAMIUR2",474,0)
 new Y
"RTN","SAMIUR2",475,0)
 new X set X=ZDT
"RTN","SAMIUR2",476,0)
 do ^%DT
"RTN","SAMIUR2",477,0)
 ;
"RTN","SAMIUR2",478,0)
 quit Y ; end of ppi $$FMDT^SAMIUR2
"RTN","SAMIUR2",479,0)
 ;
"RTN","SAMIUR2",480,0)
 ;
"RTN","SAMIUR2",481,0)
 ;
"RTN","SAMIUR2",482,0)
PKYDT(STDT,ENDT,PKS,CIGS) ; pack-years from start & end & cigs/day
"RTN","SAMIUR2",483,0)
 ;
"RTN","SAMIUR2",484,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",485,0)
 ;@called-by
"RTN","SAMIUR2",486,0)
 ; CUMPY
"RTN","SAMIUR2",487,0)
 ;@calls
"RTN","SAMIUR2",488,0)
 ; $$FMDT
"RTN","SAMIUR2",489,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIUR2",490,0)
 ; $$PKY
"RTN","SAMIUR2",491,0)
 ;
"RTN","SAMIUR2",492,0)
 ; if PKS is not provided, 20/CIGS will be used for packs per day
"RTN","SAMIUR2",493,0)
 ;
"RTN","SAMIUR2",494,0)
 new pkyr set pkyr=""
"RTN","SAMIUR2",495,0)
 if $get(PKS)="" do  ;
"RTN","SAMIUR2",496,0)
 . if $get(CIGS)="" set PKS=0 quit  ;
"RTN","SAMIUR2",497,0)
 . set PKS=20/CIGS
"RTN","SAMIUR2",498,0)
 . quit
"RTN","SAMIUR2",499,0)
 new zst set zst=$$FMDT(STDT)
"RTN","SAMIUR2",500,0)
 set:zst=-1 zst=STDT
"RTN","SAMIUR2",501,0)
 ;
"RTN","SAMIUR2",502,0)
 new zend set zend=$$FMDT(ENDT)
"RTN","SAMIUR2",503,0)
 set:zend=-1 zend=ENDT ; probably a fileman date already
"RTN","SAMIUR2",504,0)
 ;
"RTN","SAMIUR2",505,0)
 new zdif set zdif=$$FMDIFF^XLFDT(zend,zst)/365.24
"RTN","SAMIUR2",506,0)
 ;
"RTN","SAMIUR2",507,0)
 set pkyr=$$PKY(zdif,PKS)
"RTN","SAMIUR2",508,0)
 ;
"RTN","SAMIUR2",509,0)
 quit pkyr ; end of $$PKYDT
"RTN","SAMIUR2",510,0)
 ;
"RTN","SAMIUR2",511,0)
 ;
"RTN","SAMIUR2",512,0)
 ;
"RTN","SAMIUR2",513,0)
PKY(YRS,PKS) ; pack-years from years & packs/day
"RTN","SAMIUR2",514,0)
 ;
"RTN","SAMIUR2",515,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",516,0)
 ;@called-by
"RTN","SAMIUR2",517,0)
 ; $$PKYDT
"RTN","SAMIUR2",518,0)
 ;@calls none
"RTN","SAMIUR2",519,0)
 ;@input
"RTN","SAMIUR2",520,0)
 ; YRS = years
"RTN","SAMIUR2",521,0)
 ; PKS = packs/day
"RTN","SAMIUR2",522,0)
 ;
"RTN","SAMIUR2",523,0)
 new rtn set rtn=""
"RTN","SAMIUR2",524,0)
 set rtn=YRS*PKS
"RTN","SAMIUR2",525,0)
 if $length($piece(rtn,".",2))>2 do  ;
"RTN","SAMIUR2",526,0)
 . new zdec set zdec=$piece(rtn,".",2)
"RTN","SAMIUR2",527,0)
 . set rtn=$piece(rtn,".",1)_"."_$extract(zdec,1,2)
"RTN","SAMIUR2",528,0)
 . if $extract(zdec,3)>4 set rtn=rtn+.01
"RTN","SAMIUR2",529,0)
 . quit
"RTN","SAMIUR2",530,0)
 set:rtn'["." rtn=rtn_".0"
"RTN","SAMIUR2",531,0)
 ;
"RTN","SAMIUR2",532,0)
 quit rtn ; end of $$PKY
"RTN","SAMIUR2",533,0)
 ;
"RTN","SAMIUR2",534,0)
 ;
"RTN","SAMIUR2",535,0)
 ;
"RTN","SAMIUR2",536,0)
 ;@section 4 active column ppis
"RTN","SAMIUR2",537,0)
 ;
"RTN","SAMIUR2",538,0)
 ;
"RTN","SAMIUR2",539,0)
 ;
"RTN","SAMIUR2",540,0)
AGE(zdt,dfn,SAMIPATS) ; age
"RTN","SAMIUR2",541,0)
 ;
"RTN","SAMIUR2",542,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",543,0)
 ;@called-by
"RTN","SAMIUR2",544,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",545,0)
 ;@calls
"RTN","SAMIUR2",546,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",547,0)
 ; ^%DT
"RTN","SAMIUR2",548,0)
 ; $$NOW^XLFDT
"RTN","SAMIUR2",549,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIUR2",550,0)
 ;
"RTN","SAMIUR2",551,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",552,0)
 new dob set dob=$get(@root@(dfn,"sbdob")) ; dob in VAPALS format
"RTN","SAMIUR2",553,0)
 ;
"RTN","SAMIUR2",554,0)
 new Y
"RTN","SAMIUR2",555,0)
 new X set X=dob
"RTN","SAMIUR2",556,0)
 do ^%DT
"RTN","SAMIUR2",557,0)
 ;
"RTN","SAMIUR2",558,0)
 new age set age=$piece($$FMDIFF^XLFDT($$NOW^XLFDT,Y)/365,".")
"RTN","SAMIUR2",559,0)
 ;
"RTN","SAMIUR2",560,0)
 quit age ; end of ppi $$AGE^SAMIUR2
"RTN","SAMIUR2",561,0)
 ;
"RTN","SAMIUR2",562,0)
 ;
"RTN","SAMIUR2",563,0)
 ;
"RTN","SAMIUR2",564,0)
BLINEDT(zdt,dfn,SAMIPATS) ; baseline date
"RTN","SAMIUR2",565,0)
 ;
"RTN","SAMIUR2",566,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",567,0)
 ;@called-by
"RTN","SAMIUR2",568,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",569,0)
 ;@calls none
"RTN","SAMIUR2",570,0)
 ;
"RTN","SAMIUR2",571,0)
 new bldt set bldt=$get(SAMIPATS(zdt,dfn,"edate"))
"RTN","SAMIUR2",572,0)
 ;
"RTN","SAMIUR2",573,0)
 quit bldt ; end of ppi $$BLINEDT^SAMIUR2
"RTN","SAMIUR2",574,0)
 ;
"RTN","SAMIUR2",575,0)
 ;
"RTN","SAMIUR2",576,0)
 ;
"RTN","SAMIUR2",577,0)
CONTACT(zdt,dfn,SAMIPATS) ; patient street address
"RTN","SAMIUR2",578,0)
 ;
"RTN","SAMIUR2",579,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",580,0)
 ;@called-by
"RTN","SAMIUR2",581,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",582,0)
 ;@calls
"RTN","SAMIUR2",583,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",584,0)
 ;
"RTN","SAMIUR2",585,0)
 new contact set contact=""
"RTN","SAMIUR2",586,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",587,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",588,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",589,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",590,0)
 set contact=$get(@vals@("sinamef"))_" "_$get(@vals@("sinamel"))
"RTN","SAMIUR2",591,0)
 set contact=contact_"<br>"_$get(@vals@("sipsa"))
"RTN","SAMIUR2",592,0)
 if $get(@vals@("sipan"))'="" do
"RTN","SAMIUR2",593,0)
 . set contact=contact_" Apt "_$get(@vals@("sipan"))
"RTN","SAMIUR2",594,0)
 . quit
"RTN","SAMIUR2",595,0)
 if $get(@vals@("sipcn"))'="" do
"RTN","SAMIUR2",596,0)
 . set contact=contact_"<br>County "_@vals@("sipcn")
"RTN","SAMIUR2",597,0)
 . quit
"RTN","SAMIUR2",598,0)
 if $get(@vals@("sipc"))'="" do
"RTN","SAMIUR2",599,0)
 . set contact=contact_" <br>"_@vals@("sipc")_", "
"RTN","SAMIUR2",600,0)
 . quit
"RTN","SAMIUR2",601,0)
 set contact=contact_" "_$get(@vals@("sips"))_" "_$get(@vals@("sipz"))_"     "
"RTN","SAMIUR2",602,0)
 ;
"RTN","SAMIUR2",603,0)
 quit contact ; end of ppi $$CONTACT^SAMIUR2
"RTN","SAMIUR2",604,0)
 ;
"RTN","SAMIUR2",605,0)
 ;
"RTN","SAMIUR2",606,0)
 ;
"RTN","SAMIUR2",607,0)
CTPROT(zdt,dfn,SAMIPATS) ; ct protocol
"RTN","SAMIUR2",608,0)
 ;
"RTN","SAMIUR2",609,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",610,0)
 ;@called-by
"RTN","SAMIUR2",611,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",612,0)
 ;@calls
"RTN","SAMIUR2",613,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",614,0)
 ;
"RTN","SAMIUR2",615,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",616,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",617,0)
 quit:ceform="" ""
"RTN","SAMIUR2",618,0)
 ;
"RTN","SAMIUR2",619,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",620,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",621,0)
 new cectp set cectp=$get(@vals@("cectp"))
"RTN","SAMIUR2",622,0)
 new ctyp set ctyp=$select(cectp="l":"Low-Dose CT",cectp="d":"Standard CT",cectp="i":"Limited",1:"")
"RTN","SAMIUR2",623,0)
 ;
"RTN","SAMIUR2",624,0)
 quit ctyp ; end of ppi $$CTPROT^SAMIUR2
"RTN","SAMIUR2",625,0)
 ;
"RTN","SAMIUR2",626,0)
 ;
"RTN","SAMIUR2",627,0)
 ;
"RTN","SAMIUR2",628,0)
DOB(ien,dfn,SAMIPATS) ; date of birth
"RTN","SAMIUR2",629,0)
 ;
"RTN","SAMIUR2",630,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",631,0)
 ;@called-by
"RTN","SAMIUR2",632,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",633,0)
 ;@calls none
"RTN","SAMIUR2",634,0)
 ;
"RTN","SAMIUR2",635,0)
 new dob set dob=$get(SAMIPATS(ien,dfn,"dob"))
"RTN","SAMIUR2",636,0)
 if dob="" set dob=$get(SAMIPATS(ien,dfn,"sbdob"))
"RTN","SAMIUR2",637,0)
 ;
"RTN","SAMIUR2",638,0)
 quit dob ; end of ppi $$DOB^SAMIUR2
"RTN","SAMIUR2",639,0)
 ;
"RTN","SAMIUR2",640,0)
 ;
"RTN","SAMIUR2",641,0)
 ;
"RTN","SAMIUR2",642,0)
FUDATE(zdt,dfn,SAMIPATS) ; followup date
"RTN","SAMIUR2",643,0)
 ;
"RTN","SAMIUR2",644,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",645,0)
 ;@called-by
"RTN","SAMIUR2",646,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",647,0)
 ;@calls none
"RTN","SAMIUR2",648,0)
 ;
"RTN","SAMIUR2",649,0)
 new fud set fud="fudate"
"RTN","SAMIUR2",650,0)
 ;
"RTN","SAMIUR2",651,0)
 quit $get(SAMIPATS(zdt,dfn,"cefud")) ; end of ppi $$FUDATE^SAMIUR2
"RTN","SAMIUR2",652,0)
 ;
"RTN","SAMIUR2",653,0)
 ;
"RTN","SAMIUR2",654,0)
 ;
"RTN","SAMIUR2",655,0)
GENDER(zdt,dfn,SAMIPATS) ; gender
"RTN","SAMIUR2",656,0)
 ;
"RTN","SAMIUR2",657,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",658,0)
 ;@called-by
"RTN","SAMIUR2",659,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",660,0)
 ;@calls
"RTN","SAMIUR2",661,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",662,0)
 ;
"RTN","SAMIUR2",663,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",664,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",665,0)
 ;
"RTN","SAMIUR2",666,0)
 new gend set gend=$get(SAMIPATS(zdt,dfn,"gender"))
"RTN","SAMIUR2",667,0)
 if gend="" do
"RTN","SAMIUR2",668,0)
 . new pien set pien=$order(@root@("dfn",dfn,""))
"RTN","SAMIUR2",669,0)
 . if pien'="" do  ;
"RTN","SAMIUR2",670,0)
 . . set gend=$get(@root@(pien,"sex"))
"RTN","SAMIUR2",671,0)
 . . if gend="" set gend=$get(@root@(pien,"gender"))
"RTN","SAMIUR2",672,0)
 . . quit
"RTN","SAMIUR2",673,0)
 . if gend="" do  ;
"RTN","SAMIUR2",674,0)
 . . new lien set lien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR2",675,0)
 . . set gend=$get(@lroot@(lien,"gender"))
"RTN","SAMIUR2",676,0)
 . . quit
"RTN","SAMIUR2",677,0)
 if gend["^" set gend=$piece(gend,"^",1)
"RTN","SAMIUR2",678,0)
 ;
"RTN","SAMIUR2",679,0)
 quit gend ; end of ppi $$GENDER^SAMIUR2
"RTN","SAMIUR2",680,0)
 ;
"RTN","SAMIUR2",681,0)
 ;
"RTN","SAMIUR2",682,0)
 ;
"RTN","SAMIUR2",683,0)
IFORM(zdt,dfn,SAMIPATS) ; name(s) of incomplete forms
"RTN","SAMIUR2",684,0)
 ;
"RTN","SAMIUR2",685,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",686,0)
 ;@called-by
"RTN","SAMIUR2",687,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",688,0)
 ;@calls
"RTN","SAMIUR2",689,0)
 ; $$DFN2SID^SAMIUR2
"RTN","SAMIUR2",690,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMIUR2",691,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMIUR2",692,0)
 ; $$MKNAV
"RTN","SAMIUR2",693,0)
 ;
"RTN","SAMIUR2",694,0)
 new iform set iform=$get(SAMIPATS(zdt,dfn,"iform"))
"RTN","SAMIUR2",695,0)
 quit:iform="" ""  ;
"RTN","SAMIUR2",696,0)
 ;
"RTN","SAMIUR2",697,0)
 new zkey1,zn,typ
"RTN","SAMIUR2",698,0)
 new return set return="<table>"
"RTN","SAMIUR2",699,0)
 for zn=2:1  quit:$piece(iform," ",zn)=""  do  ;
"RTN","SAMIUR2",700,0)
 . set return=return_"<tr><td>"
"RTN","SAMIUR2",701,0)
 . set zkey1=$piece(iform," ",zn)
"RTN","SAMIUR2",702,0)
 . ;
"RTN","SAMIUR2",703,0)
 . new fname
"RTN","SAMIUR2",704,0)
 . if zkey1["ceform" set fname="CT Evaluation" set typ="ceform"
"RTN","SAMIUR2",705,0)
 . if zkey1["sbform" set fname="Background" set typ="sbform"
"RTN","SAMIUR2",706,0)
 . if zkey1["fuform" set fname="Follow-up" set typ="fuform"
"RTN","SAMIUR2",707,0)
 . if zkey1["bxform" set fname="Biopsy" set typ="bxform"
"RTN","SAMIUR2",708,0)
 . if zkey1["ptform" set fname="PET Evaluation" set typ="ptform"
"RTN","SAMIUR2",709,0)
 . if zkey1["itform" set fname="Intervention" set typ="itform"
"RTN","SAMIUR2",710,0)
 . if zkey1["siform" set fname="Intake Form" set typ="siform"
"RTN","SAMIUR2",711,0)
 . if $get(fname)="" set fname="unknown" set typ=""
"RTN","SAMIUR2",712,0)
 . ;
"RTN","SAMIUR2",713,0)
 . new sid set sid=$$DFN2SID^SAMIUR2(dfn)
"RTN","SAMIUR2",714,0)
 . new zdate set zdate=$$VAPALSDT^SAMICASE($$KEY2FM^SAMICASE(zkey1))
"RTN","SAMIUR2",715,0)
 . set return=return_$$MKNAV(sid,zkey1,fname_" - "_zdate,typ)
"RTN","SAMIUR2",716,0)
 . set return=return_"</td></tr>"
"RTN","SAMIUR2",717,0)
 . quit
"RTN","SAMIUR2",718,0)
 ;
"RTN","SAMIUR2",719,0)
 set return=return_"</table>"
"RTN","SAMIUR2",720,0)
 ;
"RTN","SAMIUR2",721,0)
 quit return ; end of ppi $$IFORM^SAMIUR2
"RTN","SAMIUR2",722,0)
 ;
"RTN","SAMIUR2",723,0)
 ;
"RTN","SAMIUR2",724,0)
 ;
"RTN","SAMIUR2",725,0)
LASTEXM(zdt,dfn,SAMIPATS) ; patient last exam
"RTN","SAMIUR2",726,0)
 ;
"RTN","SAMIUR2",727,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",728,0)
 ;@called-by
"RTN","SAMIUR2",729,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",730,0)
 ;@calls none
"RTN","SAMIUR2",731,0)
 ;
"RTN","SAMIUR2",732,0)
 new lexm set lexm=$get(SAMIPATS(zdt,dfn,"cedos"))
"RTN","SAMIUR2",733,0)
 ;
"RTN","SAMIUR2",734,0)
 quit lexm ; end of ppi $$LASTEXM^SAMIUR2
"RTN","SAMIUR2",735,0)
 ;
"RTN","SAMIUR2",736,0)
 ;
"RTN","SAMIUR2",737,0)
 ;
"RTN","SAMIUR2",738,0)
MANPAT(ien,dfn,SAMIPATS) ; unmatched patient cell
"RTN","SAMIUR2",739,0)
 ;
"RTN","SAMIUR2",740,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",741,0)
 ;@called-by
"RTN","SAMIUR2",742,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",743,0)
 ;@calls
"RTN","SAMIUR2",744,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",745,0)
 ;
"RTN","SAMIUR2",746,0)
 new zcell set zcell=""
"RTN","SAMIUR2",747,0)
 ; set zcell=zcell_$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR2",748,0)
 set zcell=zcell_$get(SAMIPATS(ien,dfn,"editref"))
"RTN","SAMIUR2",749,0)
 set zcell=zcell_"<br>Date of Birth: "_$get(SAMIPATS(ien,dfn,"dob"))
"RTN","SAMIUR2",750,0)
 set zcell=zcell_" Gender: "_$get(SAMIPATS(ien,dfn,"sex"))
"RTN","SAMIUR2",751,0)
 ;
"RTN","SAMIUR2",752,0)
 new ssn set ssn=$get(SAMIPATS(ien,dfn,"ssn"))
"RTN","SAMIUR2",753,0)
 if ssn="" do  ;
"RTN","SAMIUR2",754,0)
 . new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",755,0)
 . new tssn set tssn=$get(@lroot@(ien,"ssn"))
"RTN","SAMIUR2",756,0)
 . set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",757,0)
 . quit
"RTN","SAMIUR2",758,0)
 set zcell=zcell_"<br>SSN: "_ssn
"RTN","SAMIUR2",759,0)
 ;
"RTN","SAMIUR2",760,0)
 set zcell=zcell_"<br>dfn: "_dfn
"RTN","SAMIUR2",761,0)
 ;
"RTN","SAMIUR2",762,0)
 quit zcell ; end of ppi $$MANPAT^SAMIUR2
"RTN","SAMIUR2",763,0)
 ;
"RTN","SAMIUR2",764,0)
 ;
"RTN","SAMIUR2",765,0)
 ;
"RTN","SAMIUR2",766,0)
MATCH(ien,dfn,SAMIPATS) ; match button cell
"RTN","SAMIUR2",767,0)
 ;
"RTN","SAMIUR2",768,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",769,0)
 ;@called-by
"RTN","SAMIUR2",770,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",771,0)
 ;@calls none
"RTN","SAMIUR2",772,0)
 ;
"RTN","SAMIUR2",773,0)
 new matien set matien=$get(SAMIPATS(ien,dfn,"MATCHLOG"))
"RTN","SAMIUR2",774,0)
 quit:matien="" ""
"RTN","SAMIUR2",775,0)
 ;
"RTN","SAMIUR2",776,0)
 new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR2",777,0)
 set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""merge"">"
"RTN","SAMIUR2",778,0)
 set nuhref=nuhref_"<input type=hidden name=""toien"" value="_ien_">"
"RTN","SAMIUR2",779,0)
 set nuhref=nuhref_"<input value=""Merge"" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR2",780,0)
 ;
"RTN","SAMIUR2",781,0)
 quit nuhref ; end of ppi $$MATCH^SAMIUR2
"RTN","SAMIUR2",782,0)
 ;
"RTN","SAMIUR2",783,0)
 ;
"RTN","SAMIUR2",784,0)
 ;
"RTN","SAMIUR2",785,0)
NAME(zdt,dfn,SAMIPATS) ; name w/hyperlink
"RTN","SAMIUR2",786,0)
 ;
"RTN","SAMIUR2",787,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",788,0)
 ;@called-by
"RTN","SAMIUR2",789,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",790,0)
 ;@calls none
"RTN","SAMIUR2",791,0)
 ;
"RTN","SAMIUR2",792,0)
 new nam set nam="Name"
"RTN","SAMIUR2",793,0)
 ;
"RTN","SAMIUR2",794,0)
 quit $get(SAMIPATS(zdt,dfn,"nuhref")) ; end of ppi $$NAME^SAMIUR2
"RTN","SAMIUR2",795,0)
 ;
"RTN","SAMIUR2",796,0)
 ;
"RTN","SAMIUR2",797,0)
 ;
"RTN","SAMIUR2",798,0)
PACKYRS(zdt,dfn,SAMIPATS) ; smoking status
"RTN","SAMIUR2",799,0)
 ;
"RTN","SAMIUR2",800,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",801,0)
 ;@called-by
"RTN","SAMIUR2",802,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",803,0)
 ;@calls
"RTN","SAMIUR2",804,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",805,0)
 ;
"RTN","SAMIUR2",806,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",807,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",808,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",809,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",810,0)
 new pkyrs set pkyrs=$get(@vals@("sippy"))
"RTN","SAMIUR2",811,0)
 ;
"RTN","SAMIUR2",812,0)
 quit pkyrs ; end of ppi $$PACKYRS^SAMIUR2
"RTN","SAMIUR2",813,0)
 ;
"RTN","SAMIUR2",814,0)
 ;
"RTN","SAMIUR2",815,0)
 ;
"RTN","SAMIUR2",816,0)
POSSIBLE(ien,dfn,SAMIPATS) ; possible match cell
"RTN","SAMIUR2",817,0)
 ;
"RTN","SAMIUR2",818,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",819,0)
 ;@called-by
"RTN","SAMIUR2",820,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",821,0)
 ;@calls
"RTN","SAMIUR2",822,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",823,0)
 ;
"RTN","SAMIUR2",824,0)
 new zcell set zcell=""
"RTN","SAMIUR2",825,0)
 new matien set matien=$get(SAMIPATS(ien,dfn,"MATCHLOG"))
"RTN","SAMIUR2",826,0)
 quit:matien="" zcell
"RTN","SAMIUR2",827,0)
 ;
"RTN","SAMIUR2",828,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",829,0)
 quit:'$data(@lroot@(matien)) zcell
"RTN","SAMIUR2",830,0)
 ;
"RTN","SAMIUR2",831,0)
 set zcell=zcell_$get(@lroot@(matien,"saminame"))
"RTN","SAMIUR2",832,0)
 set zcell=zcell_"<br>Date of Birth: "_$get(@lroot@(matien,"sbdob"))
"RTN","SAMIUR2",833,0)
 set zcell=zcell_" Gender: "_$get(@lroot@(matien,"sex"))
"RTN","SAMIUR2",834,0)
 ;
"RTN","SAMIUR2",835,0)
 new tssn set tssn=$get(@lroot@(matien,"ssn"))
"RTN","SAMIUR2",836,0)
 new ssn set ssn=tssn
"RTN","SAMIUR2",837,0)
 if tssn'["-" set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",838,0)
 set zcell=zcell_"<br>SSN: "_ssn
"RTN","SAMIUR2",839,0)
 ;
"RTN","SAMIUR2",840,0)
 set zcell=zcell_"<br>dfn: "_$get(@lroot@(matien,"dfn"))
"RTN","SAMIUR2",841,0)
 ;
"RTN","SAMIUR2",842,0)
 quit zcell ; end of ppi $$POSSIBLE^SAMIUR2
"RTN","SAMIUR2",843,0)
 ;
"RTN","SAMIUR2",844,0)
 ;
"RTN","SAMIUR2",845,0)
 ;
"RTN","SAMIUR2",846,0)
RECOM(zdt,dfn,SAMIPATS) ; recommendation
"RTN","SAMIUR2",847,0)
 ;
"RTN","SAMIUR2",848,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",849,0)
 ;@called-by
"RTN","SAMIUR2",850,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",851,0)
 ;@calls
"RTN","SAMIUR2",852,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",853,0)
 ;
"RTN","SAMIUR2",854,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",855,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",856,0)
 quit:ceform="" ""
"RTN","SAMIUR2",857,0)
 ;
"RTN","SAMIUR2",858,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",859,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",860,0)
 new cefuw set cefuw=$get(@vals@("cefuw"))
"RTN","SAMIUR2",861,0)
 ;
"RTN","SAMIUR2",862,0)
 new recom set recom=""
"RTN","SAMIUR2",863,0)
 set recom=$select(cefuw="1y":"Annual Repeat",cefuw="nw":"Now",cefuw="1m":"1 month",cefuw="3m":"3 months",cefuw="6m":"6 months",cefuw="os":"Other",1:"")
"RTN","SAMIUR2",864,0)
 if $get(@vals@("cefuaf"))="y" set recom=recom_", Antibiotics"
"RTN","SAMIUR2",865,0)
 if $get(@vals@("cefucc"))="y" set recom=recom_", Contrast CT"
"RTN","SAMIUR2",866,0)
 if $get(@vals@("cefupe"))="y" set recom=recom_", PET"
"RTN","SAMIUR2",867,0)
 if $get(@vals@("cefufn"))="y" set recom=recom_", Percutaneous biopsy"
"RTN","SAMIUR2",868,0)
 if $get(@vals@("cefubr"))="y" set recom=recom_", Bronchoscopy"
"RTN","SAMIUR2",869,0)
 if $get(@vals@("cefupc"))="y" set recom=recom_", Pulmonary consultation"
"RTN","SAMIUR2",870,0)
 if $get(@vals@("cefutb"))="y" set recom=recom_", Refer to tumor board"
"RTN","SAMIUR2",871,0)
 if $get(@vals@("cefunf"))="y" set recom=recom_", No other further follow-up"
"RTN","SAMIUR2",872,0)
 if $extract(recom,1,2)=", " set recom=$extract(recom,3,$length(recom))
"RTN","SAMIUR2",873,0)
 ;
"RTN","SAMIUR2",874,0)
 quit recom ; end of ppi $$RECOM^SAMIUR2
"RTN","SAMIUR2",875,0)
 ;
"RTN","SAMIUR2",876,0)
 ;
"RTN","SAMIUR2",877,0)
 ;
"RTN","SAMIUR2",878,0)
RURAL(zdt,dfn,SAMIPATS) ; patient's rural/urban status
"RTN","SAMIUR2",879,0)
 ;
"RTN","SAMIUR2",880,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",881,0)
 ;@called-by
"RTN","SAMIUR2",882,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",883,0)
 ;@calls
"RTN","SAMIUR2",884,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",885,0)
 ;
"RTN","SAMIUR2",886,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",887,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",888,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",889,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",890,0)
 new sirs set sirs=$get(@vals@("sirs"))
"RTN","SAMIUR2",891,0)
 set sirs=$select(sirs="r":"rural",sirs="u":"urban",sirs="n":"unknown",1:"unknown")
"RTN","SAMIUR2",892,0)
 ;
"RTN","SAMIUR2",893,0)
 quit sirs ; end of ppi $$RURAL^SAMIUR2
"RTN","SAMIUR2",894,0)
 ;
"RTN","SAMIUR2",895,0)
 ;
"RTN","SAMIUR2",896,0)
 ;
"RTN","SAMIUR2",897,0)
SID(zdt,dfn,SAMIPATS) ; study ID
"RTN","SAMIUR2",898,0)
 ;
"RTN","SAMIUR2",899,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",900,0)
 ;@called-by
"RTN","SAMIUR2",901,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",902,0)
 ;@calls
"RTN","SAMIUR2",903,0)
 ; $$DFN2SID
"RTN","SAMIUR2",904,0)
 ;
"RTN","SAMIUR2",905,0)
 quit $$DFN2SID(dfn) ; end of ppi $$SID^SAMIUR2
"RTN","SAMIUR2",906,0)
 ;
"RTN","SAMIUR2",907,0)
 ;
"RTN","SAMIUR2",908,0)
 ;
"RTN","SAMIUR2",909,0)
SMHIS(zdt,dfn,SAMIPATS) ; smoking history cell
"RTN","SAMIUR2",910,0)
 ;
"RTN","SAMIUR2",911,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",912,0)
 ;@called-by
"RTN","SAMIUR2",913,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",914,0)
 ;@calls
"RTN","SAMIUR2",915,0)
 ; $$DFN2SID
"RTN","SAMIUR2",916,0)
 ; $$SHDET
"RTN","SAMIUR2",917,0)
 ;
"RTN","SAMIUR2",918,0)
 new zrtn set zrtn=""
"RTN","SAMIUR2",919,0)
 set zrtn=zrtn_"<div class=""row""><div class=""col-md-12""><table class=""table"" id=""pack-years-history"">"
"RTN","SAMIUR2",920,0)
 set zrtn=zrtn_"<thead><tr><th>Form </th><th> Reported Date </th>"
"RTN","SAMIUR2",921,0)
 set zrtn=zrtn_"<th>Pack Years</th><th>Cumulative</th></tr></thead><tbody>"
"RTN","SAMIUR2",922,0)
 set zrtn=zrtn_$$SHDET($$DFN2SID(dfn))
"RTN","SAMIUR2",923,0)
 set zrtn=zrtn_"</tbody></table></div></div>"
"RTN","SAMIUR2",924,0)
 ;
"RTN","SAMIUR2",925,0)
 quit zrtn ; end of ppi $$SMHIS^SAMIUR2
"RTN","SAMIUR2",926,0)
 ;
"RTN","SAMIUR2",927,0)
 ;
"RTN","SAMIUR2",928,0)
 ;
"RTN","SAMIUR2",929,0)
SMKSTAT(zdt,dfn,SAMIPATS) ; smoking status
"RTN","SAMIUR2",930,0)
 ;
"RTN","SAMIUR2",931,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",932,0)
 ;@called-by
"RTN","SAMIUR2",933,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",934,0)
 ;@calls
"RTN","SAMIUR2",935,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",936,0)
 ;
"RTN","SAMIUR2",937,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",938,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",939,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",940,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",941,0)
 ;
"RTN","SAMIUR2",942,0)
 new smk set smk="unknown"
"RTN","SAMIUR2",943,0)
 if $get(@vals@("siesm"))="n" set smk="Never smoked"
"RTN","SAMIUR2",944,0)
 if $get(@vals@("siesm"))="p" set smk="Past smoker"
"RTN","SAMIUR2",945,0)
 if $get(@vals@("siesm"))="c" set smk="Current smoker"
"RTN","SAMIUR2",946,0)
 ; if $get(@vals@("siesq"))=1 set smk="Cu"
"RTN","SAMIUR2",947,0)
 ;
"RTN","SAMIUR2",948,0)
 quit smk ; end of ppi $$SMKSTAT^SAMIUR2
"RTN","SAMIUR2",949,0)
 ;
"RTN","SAMIUR2",950,0)
 ;
"RTN","SAMIUR2",951,0)
 ;
"RTN","SAMIUR2",952,0)
SSN(zdt,dfn,SAMIPATS) ; social security number
"RTN","SAMIUR2",953,0)
 ;
"RTN","SAMIUR2",954,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",955,0)
 ;@called-by
"RTN","SAMIUR2",956,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",957,0)
 ;@calls none
"RTN","SAMIUR2",958,0)
 ;
"RTN","SAMIUR2",959,0)
 new tssn set tssn=$get(SAMIPATS(zdt,dfn,"ssn"))
"RTN","SAMIUR2",960,0)
 new ssn set ssn=tssn
"RTN","SAMIUR2",961,0)
 if ssn'["-" do
"RTN","SAMIUR2",962,0)
 . set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",963,0)
 . quit
"RTN","SAMIUR2",964,0)
 ;
"RTN","SAMIUR2",965,0)
 quit ssn ; end of ppi $$SSN^SAMIUR2
"RTN","SAMIUR2",966,0)
 ;
"RTN","SAMIUR2",967,0)
 ;
"RTN","SAMIUR2",968,0)
 ;
"RTN","SAMIUR2",969,0)
STUDYDT(zdt,dfn,SAMIPATS) ; latest study date
"RTN","SAMIUR2",970,0)
 ;
"RTN","SAMIUR2",971,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",972,0)
 ;@called-by
"RTN","SAMIUR2",973,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",974,0)
 ;@calls none
"RTN","SAMIUR2",975,0)
 ;
"RTN","SAMIUR2",976,0)
 new stdt set stdt=$get(SAMIPATS(zdt,dfn,"cedos"))
"RTN","SAMIUR2",977,0)
 ;
"RTN","SAMIUR2",978,0)
 quit stdt ; end of ppi $$STUDYDT^SAMIUR2
"RTN","SAMIUR2",979,0)
 ;
"RTN","SAMIUR2",980,0)
 ;
"RTN","SAMIUR2",981,0)
 ;
"RTN","SAMIUR2",982,0)
STUDYTYP(zdt,dfn,SAMIPATS) ; latest study type
"RTN","SAMIUR2",983,0)
 ;
"RTN","SAMIUR2",984,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",985,0)
 ;@called-by
"RTN","SAMIUR2",986,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",987,0)
 ;@calls
"RTN","SAMIUR2",988,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",989,0)
 ;
"RTN","SAMIUR2",990,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",991,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",992,0)
 quit:ceform="" ""
"RTN","SAMIUR2",993,0)
 ;
"RTN","SAMIUR2",994,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",995,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",996,0)
 new stypx set stypx=$get(@vals@("cetex"))
"RTN","SAMIUR2",997,0)
 new styp set styp=$select(stypx="a":"Annual",stypx="b":"Baseline",stypx="d":"Followup",1:"")
"RTN","SAMIUR2",998,0)
 ;
"RTN","SAMIUR2",999,0)
 quit styp ; end of ppi $$STUDYTYP^SAMIUR2
"RTN","SAMIUR2",1000,0)
 ;
"RTN","SAMIUR2",1001,0)
 ;
"RTN","SAMIUR2",1002,0)
 ;
"RTN","SAMIUR2",1003,0)
VALS(zdt,dfn,SAMIPATS) ; form-values cell
"RTN","SAMIUR2",1004,0)
 ;
"RTN","SAMIUR2",1005,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1006,0)
 ;@called-by
"RTN","SAMIUR2",1007,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1008,0)
 ;@calls
"RTN","SAMIUR2",1009,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1010,0)
 ;
"RTN","SAMIUR2",1011,0)
 new vrtn set vrtn=""
"RTN","SAMIUR2",1012,0)
 new vsid set vsid=$$DFN2SID(dfn)
"RTN","SAMIUR2",1013,0)
 new vgr set vgr="/vals?sid="_vsid_"&form="
"RTN","SAMIUR2",1014,0)
 quit:'$data(SAMIPATS)
"RTN","SAMIUR2",1015,0)
 ;
"RTN","SAMIUR2",1016,0)
 new vzi set vzi=""
"RTN","SAMIUR2",1017,0)
 for  do  quit:vzi="sort"  quit:vzi=""
"RTN","SAMIUR2",1018,0)
 . set vzi=$order(SAMIPATS(zdt,dfn,"items",vzi))
"RTN","SAMIUR2",1019,0)
 . quit:vzi="sort"
"RTN","SAMIUR2",1020,0)
 . quit:vzi=""
"RTN","SAMIUR2",1021,0)
 . set vrtn=vrtn_"<a href="""_vgr_vzi_""">"_vzi_"</a><br>"
"RTN","SAMIUR2",1022,0)
 . quit
"RTN","SAMIUR2",1023,0)
 ;
"RTN","SAMIUR2",1024,0)
 quit vrtn ; end of $$VALS^SAMIUR2
"RTN","SAMIUR2",1025,0)
 ;
"RTN","SAMIUR2",1026,0)
 ;
"RTN","SAMIUR2",1027,0)
 ;
"RTN","SAMIUR2",1028,0)
WHEN(zdt,dfn,SAMIPATS) ; followup text
"RTN","SAMIUR2",1029,0)
 ;
"RTN","SAMIUR2",1030,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1031,0)
 ;@called-by
"RTN","SAMIUR2",1032,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1033,0)
 ;@calls
"RTN","SAMIUR2",1034,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1035,0)
 ;
"RTN","SAMIUR2",1036,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1037,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1038,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1039,0)
 ;
"RTN","SAMIUR2",1040,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1041,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1042,0)
 new whnx set whnx=$get(@vals@("cefuw"))
"RTN","SAMIUR2",1043,0)
 quit:whnx="" ""
"RTN","SAMIUR2",1044,0)
 ;
"RTN","SAMIUR2",1045,0)
 new DICT
"RTN","SAMIUR2",1046,0)
 set DICT("cefuw","1m")="in one month"
"RTN","SAMIUR2",1047,0)
 set DICT("cefuw","1y")="in one year"
"RTN","SAMIUR2",1048,0)
 set DICT("cefuw","3m")="in three months"
"RTN","SAMIUR2",1049,0)
 set DICT("cefuw","6m")="in six months"
"RTN","SAMIUR2",1050,0)
 set DICT("cefuw","os")="other as specified"
"RTN","SAMIUR2",1051,0)
 set whn=$get(DICT("cefuw",whnx))
"RTN","SAMIUR2",1052,0)
 ;
"RTN","SAMIUR2",1053,0)
 quit whn ; end of ppi $$WHEN^SAMIUR2
"RTN","SAMIUR2",1054,0)
 ;
"RTN","SAMIUR2",1055,0)
 ;
"RTN","SAMIUR2",1056,0)
 ;
"RTN","SAMIUR2",1057,0)
WORKPAT(ien,dfn,SAMIPATS) ; worklist patient name cell
"RTN","SAMIUR2",1058,0)
 ;
"RTN","SAMIUR2",1059,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1060,0)
 ;@called-by
"RTN","SAMIUR2",1061,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1062,0)
 ;@calls none
"RTN","SAMIUR2",1063,0)
 ;
"RTN","SAMIUR2",1064,0)
 new zcell set zcell=""
"RTN","SAMIUR2",1065,0)
 set zcell=zcell_$get(SAMIPATS(ien,dfn,"workref"))
"RTN","SAMIUR2",1066,0)
 ;
"RTN","SAMIUR2",1067,0)
 quit zcell ; end of ppi $$WORKPAT^SAMIUR2
"RTN","SAMIUR2",1068,0)
 ;
"RTN","SAMIUR2",1069,0)
 ;
"RTN","SAMIUR2",1070,0)
 ;
"RTN","SAMIUR2",1071,0)
 ;@section 5 unused subroutines
"RTN","SAMIUR2",1072,0)
 ;
"RTN","SAMIUR2",1073,0)
 ;
"RTN","SAMIUR2",1074,0)
 ;
"RTN","SAMIUR2",1075,0)
EPAT(ien,dfn,SAMIPATS) ; patient name w/nav to enrollment
"RTN","SAMIUR2",1076,0)
 ;
"RTN","SAMIUR2",1077,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIUR2",1078,0)
 ;@called-by none
"RTN","SAMIUR2",1079,0)
 ;@calls none
"RTN","SAMIUR2",1080,0)
 ;
"RTN","SAMIUR2",1081,0)
 quit  ; end of $$EPAT
"RTN","SAMIUR2",1082,0)
 ;
"RTN","SAMIUR2",1083,0)
 ;
"RTN","SAMIUR2",1084,0)
 ;
"RTN","SAMIUR2",1085,0)
ETHNCTY(zdt,dfn,SAMIPATS) ; ethnicity
"RTN","SAMIUR2",1086,0)
 ;
"RTN","SAMIUR2",1087,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1088,0)
 ;@called-by none
"RTN","SAMIUR2",1089,0)
 ;@calls none
"RTN","SAMIUR2",1090,0)
 ;
"RTN","SAMIUR2",1091,0)
 quit "ethnicity" ; end of $$ETHNCTY
"RTN","SAMIUR2",1092,0)
 ;
"RTN","SAMIUR2",1093,0)
 ;
"RTN","SAMIUR2",1094,0)
 ;
"RTN","SAMIUR2",1095,0)
RACE(zdt,dfn,SAMIPATS) ; race
"RTN","SAMIUR2",1096,0)
 ;
"RTN","SAMIUR2",1097,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1098,0)
 ;@called-by none [call commented out in RPTTBL]
"RTN","SAMIUR2",1099,0)
 ;@calls
"RTN","SAMIUR2",1100,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1101,0)
 ;
"RTN","SAMIUR2",1102,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1103,0)
 new race set race=$get(@root@(dfn,"race"))
"RTN","SAMIUR2",1104,0)
 ;
"RTN","SAMIUR2",1105,0)
 quit race ; end of $$RACE
"RTN","SAMIUR2",1106,0)
 ;
"RTN","SAMIUR2",1107,0)
 ;
"RTN","SAMIUR2",1108,0)
 ;
"RTN","SAMIUR2",1109,0)
STATUS(zdt,dfn,SAMIPATS) ; patient status
"RTN","SAMIUR2",1110,0)
 ;
"RTN","SAMIUR2",1111,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1112,0)
 ;@called-by none
"RTN","SAMIUR2",1113,0)
 ;@calls
"RTN","SAMIUR2",1114,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1115,0)
 ;
"RTN","SAMIUR2",1116,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1117,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1118,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1119,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1120,0)
 new stat set stat=$get(@vals@("sistatus"))
"RTN","SAMIUR2",1121,0)
 ;
"RTN","SAMIUR2",1122,0)
 quit stat ; end of $$STATUS
"RTN","SAMIUR2",1123,0)
 ;
"RTN","SAMIUR2",1124,0)
 ;
"RTN","SAMIUR2",1125,0)
 ;
"RTN","SAMIUR2",1126,0)
WSVALS(RTN,FILTER) ; display form values from graph
"RTN","SAMIUR2",1127,0)
 ;
"RTN","SAMIUR2",1128,0)
 ;;web service;procedure;clean;silent;sac
"RTN","SAMIUR2",1129,0)
 ;@called-by none
"RTN","SAMIUR2",1130,0)
 ;@calls
"RTN","SAMIUR2",1131,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1132,0)
 ; wsGtree^SYNVPR
"RTN","SAMIUR2",1133,0)
 ;
"RTN","SAMIUR2",1134,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1135,0)
 new sid set sid=$get(FILTER("sid"))
"RTN","SAMIUR2",1136,0)
 if sid="" set sid=$get(FILTER("studyid"))
"RTN","SAMIUR2",1137,0)
 quit:sid=""
"RTN","SAMIUR2",1138,0)
 ;
"RTN","SAMIUR2",1139,0)
 new zform set zform=$get(FILTER("form"))
"RTN","SAMIUR2",1140,0)
 new groot
"RTN","SAMIUR2",1141,0)
 if zform="" set groot=$name(@root@("graph",sid))
"RTN","SAMIUR2",1142,0)
 else  set groot=$name(@root@("graph",sid,zform))
"RTN","SAMIUR2",1143,0)
 set FILTER("root")=$extract(groot,2,$length(groot))
"RTN","SAMIUR2",1144,0)
 ;
"RTN","SAMIUR2",1145,0)
 do wsGtree^SYNVPR(.RTN,.FILTER)
"RTN","SAMIUR2",1146,0)
 ;
"RTN","SAMIUR2",1147,0)
 quit  ; end of ws WSVALS^SAMIUR2
"RTN","SAMIUR2",1148,0)
 ;
"RTN","SAMIUR2",1149,0)
 ;
"RTN","SAMIUR2",1150,0)
 ;
"RTN","SAMIUR2",1151,0)
EOR ; end of routine SAMIUR2
"VER")
8.0^22.2
**END**
**END**
