KIDS Distribution saved on Mar 16, 2021@13:13:13
Added average diameter to nodule output CT report
**KIDS**:SAMI*18.0*10^

**INSTALL NAME**
SAMI*18.0*10
"BLD",11507,0)
SAMI*18.0*10^SAMI^0^3210316^y
"BLD",11507,1,0)
^^1^1^3210310^
"BLD",11507,1,1,0)
Corrections to the CT Eval report
"BLD",11507,4,0)
^9.64PA^^
"BLD",11507,6.3)
2
"BLD",11507,"KRN",0)
^9.67PA^1.5^25
"BLD",11507,"KRN",.4,0)
.4
"BLD",11507,"KRN",.401,0)
.401
"BLD",11507,"KRN",.402,0)
.402
"BLD",11507,"KRN",.403,0)
.403
"BLD",11507,"KRN",.5,0)
.5
"BLD",11507,"KRN",.84,0)
.84
"BLD",11507,"KRN",1.5,0)
1.5
"BLD",11507,"KRN",1.6,0)
1.6
"BLD",11507,"KRN",1.61,0)
1.61
"BLD",11507,"KRN",1.62,0)
1.62
"BLD",11507,"KRN",3.6,0)
3.6
"BLD",11507,"KRN",3.8,0)
3.8
"BLD",11507,"KRN",9.2,0)
9.2
"BLD",11507,"KRN",9.8,0)
9.8
"BLD",11507,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",11507,"KRN",9.8,"NM",1,0)
SAMICTT0^^0^B70558868
"BLD",11507,"KRN",9.8,"NM",2,0)
SAMICTT1^^0^B92534755
"BLD",11507,"KRN",9.8,"NM",3,0)
SAMICTT2^^0^B84904289
"BLD",11507,"KRN",9.8,"NM",4,0)
SAMICTT3^^0^B180003709
"BLD",11507,"KRN",9.8,"NM",5,0)
SAMICTT4^^0^B36692733
"BLD",11507,"KRN",9.8,"NM",6,0)
SAMICTT9^^0^B10329219
"BLD",11507,"KRN",9.8,"NM",7,0)
SAMICTTA^^0^B24215810
"BLD",11507,"KRN",9.8,"NM",8,0)
SAMIFLD^^0^B204052110
"BLD",11507,"KRN",9.8,"NM","B","SAMICTT0",1)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTT1",2)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTT2",3)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTT3",4)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTT4",5)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTT9",6)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTTA",7)

"BLD",11507,"KRN",9.8,"NM","B","SAMIFLD",8)

"BLD",11507,"KRN",19,0)
19
"BLD",11507,"KRN",19.1,0)
19.1
"BLD",11507,"KRN",101,0)
101
"BLD",11507,"KRN",409.61,0)
409.61
"BLD",11507,"KRN",771,0)
771
"BLD",11507,"KRN",779.2,0)
779.2
"BLD",11507,"KRN",870,0)
870
"BLD",11507,"KRN",8989.51,0)
8989.51
"BLD",11507,"KRN",8989.52,0)
8989.52
"BLD",11507,"KRN",8993,0)
8993
"BLD",11507,"KRN",8994,0)
8994
"BLD",11507,"KRN","B",.4,.4)

"BLD",11507,"KRN","B",.401,.401)

"BLD",11507,"KRN","B",.402,.402)

"BLD",11507,"KRN","B",.403,.403)

"BLD",11507,"KRN","B",.5,.5)

"BLD",11507,"KRN","B",.84,.84)

"BLD",11507,"KRN","B",1.5,1.5)

"BLD",11507,"KRN","B",1.6,1.6)

"BLD",11507,"KRN","B",1.61,1.61)

"BLD",11507,"KRN","B",1.62,1.62)

"BLD",11507,"KRN","B",3.6,3.6)

"BLD",11507,"KRN","B",3.8,3.8)

"BLD",11507,"KRN","B",9.2,9.2)

"BLD",11507,"KRN","B",9.8,9.8)

"BLD",11507,"KRN","B",19,19)

"BLD",11507,"KRN","B",19.1,19.1)

"BLD",11507,"KRN","B",101,101)

"BLD",11507,"KRN","B",409.61,409.61)

"BLD",11507,"KRN","B",771,771)

"BLD",11507,"KRN","B",779.2,779.2)

"BLD",11507,"KRN","B",870,870)

"BLD",11507,"KRN","B",8989.51,8989.51)

"BLD",11507,"KRN","B",8989.52,8989.52)

"BLD",11507,"KRN","B",8993,8993)

"BLD",11507,"KRN","B",8994,8994)

"MBREQ")
0
"PKG",230,-1)
1^1
"PKG",230,0)
SAMI^SAMI^SCREENING APPLICATIONS MANAGEMENT - IELCAP
"PKG",230,22,0)
^9.49I^1^1
"PKG",230,22,1,0)
18.0^3191203
"PKG",230,22,1,"PAH",1,0)
10^3210316
"PKG",230,22,1,"PAH",1,1,0)
^^1^1^3210316
"PKG",230,22,1,"PAH",1,1,1,0)
Corrections to the CT Eval report
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","SAMICTT0")
0^1^B70558868
"RTN","SAMICTT0",1,0)
SAMICTT0 ;ven/gpl - text based ctreport ; 2/14/19 10:29am
"RTN","SAMICTT0",2,0)
 ;;18.0;SAMI;;;Build 2
"RTN","SAMICTT0",3,0)
 ;
"RTN","SAMICTT0",4,0)
 ;
"RTN","SAMICTT0",5,0)
 quit  ; no entry from top
"RTN","SAMICTT0",6,0)
 ;
"RTN","SAMICTT0",7,0)
WSREPORT(return,filter) ; web service which returns an html cteval report
"RTN","SAMICTT0",8,0)
 ;
"RTN","SAMICTT0",9,0)
 s debug=0
"RTN","SAMICTT0",10,0)
 n outmode s outmode="go"
"RTN","SAMICTT0",11,0)
 n line s line=""
"RTN","SAMICTT0",12,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMICTT0",13,0)
 ;
"RTN","SAMICTT0",14,0)
 ;s rtn=$na(^TMP("SAMICTT",$J))
"RTN","SAMICTT0",15,0)
 s rtn="return"
"RTN","SAMICTT0",16,0)
 k @rtn
"RTN","SAMICTT0",17,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMICTT0",18,0)
 ;
"RTN","SAMICTT0",19,0)
 n cnt s cnt=0 ; line number
"RTN","SAMICTT0",20,0)
 ;
"RTN","SAMICTT0",21,0)
 ; set up dictionary and patient values
"RTN","SAMICTT0",22,0)
 ;
"RTN","SAMICTT0",23,0)
 n dict,vals
"RTN","SAMICTT0",24,0)
 ;d INIT^SAMICTD2("dict")
"RTN","SAMICTT0",25,0)
 s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT0",26,0)
 s dict=$na(@dict@("cteval-dict"))
"RTN","SAMICTT0",27,0)
 i $g(@dict@("pet"))="" d INIT2GPH^SAMICTD2 ; initialize the dictionary first time
"RTN","SAMICTT0",28,0)
 n si
"RTN","SAMICTT0",29,0)
 s si=$g(filter("studyid"))
"RTN","SAMICTT0",30,0)
 i si="" d  ;
"RTN","SAMICTT0",31,0)
 . s si="XXX00102"
"RTN","SAMICTT0",32,0)
 q:si=""
"RTN","SAMICTT0",33,0)
 n samikey
"RTN","SAMICTT0",34,0)
 s samikey=$g(filter("form"))
"RTN","SAMICTT0",35,0)
 i samikey="" d  ;
"RTN","SAMICTT0",36,0)
 . s samikey="ceform-2018-10-09"
"RTN","SAMICTT0",37,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICTT0",38,0)
 i $g(filter("studyid"))="" s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICTT0",39,0)
 s vals=$na(@root@("graph",si,samikey))
"RTN","SAMICTT0",40,0)
 ;W !,vals
"RTN","SAMICTT0",41,0)
 ;zwr @vals@(*)
"RTN","SAMICTT0",42,0)
 i '$d(@vals) d  q  ;
"RTN","SAMICTT0",43,0)
 . w !,"error, patient values not found"
"RTN","SAMICTT0",44,0)
 ;
"RTN","SAMICTT0",45,0)
 ; report parameters
"RTN","SAMICTT0",46,0)
 ;
"RTN","SAMICTT0",47,0)
 n nt,sectionheader,dummy,cac,tex,para,legout
"RTN","SAMICTT0",48,0)
 ;; n lang,lanread
"RTN","SAMICTT0",49,0)
 ;
"RTN","SAMICTT0",50,0)
 s nt=1
"RTN","SAMICTT0",51,0)
 s sectionheader=1
"RTN","SAMICTT0",52,0)
 ;;s dummy="******"
"RTN","SAMICTT0",53,0)
 s cac=""
"RTN","SAMICTT0",54,0)
 n cacrec s cacrec=""
"RTN","SAMICTT0",55,0)
 ;;s tex=0
"RTN","SAMICTT0",56,0)
 ;s para="<p>"
"RTN","SAMICTT0",57,0)
 ;s para=$char(13,10)
"RTN","SAMICTT0",58,0)
 s para=""
"RTN","SAMICTT0",59,0)
 ;;s legout=0
"RTN","SAMICTT0",60,0)
 n qheader s qheader=0
"RTN","SAMICTT0",61,0)
 ;
"RTN","SAMICTT0",62,0)
 n lang s lang=""
"RTN","SAMICTT0",63,0)
 n langread s langread=0
"RTN","SAMICTT0",64,0)
 ;
"RTN","SAMICTT0",65,0)
 n auth s auth("perm")="a"
"RTN","SAMICTT0",66,0)
 s auth("inst")=$g(filter("auth"))
"RTN","SAMICTT0",67,0)
 ;
"RTN","SAMICTT0",68,0)
 n newct s newct=0
"RTN","SAMICTT0",69,0)
 i $$XVAL("ceoppa",vals)'="" s newct=1
"RTN","SAMICTT0",70,0)
 ;
"RTN","SAMICTT0",71,0)
 n registryForm s registryForm=0
"RTN","SAMICTT0",72,0)
 i $$XVAL("ceaf",vals)'="" s registryForm=1
"RTN","SAMICTT0",73,0)
 ;
"RTN","SAMICTT0",74,0)
 ;d OUT("<HTML>")
"RTN","SAMICTT0",75,0)
 ;d OUT("<HEAD>")
"RTN","SAMICTT0",76,0)
 ;d OUT("<!-- Calling TR: CT Evaluation Report -->")
"RTN","SAMICTT0",77,0)
 ;d OUT("<TITLE>CT Evaluation Report</TITLE>")
"RTN","SAMICTT0",78,0)
 ;d OUT("<link rel='stylesheet' href='/css/report.css'>")
"RTN","SAMICTT0",79,0)
 ;d OUT("</HEAD>")
"RTN","SAMICTT0",80,0)
 ;d OUT("<BODY BGCOLOR=""#ffffff"" TEXT=""#000000"">")
"RTN","SAMICTT0",81,0)
 ;;d OUT("<TABLE border=""0"" cellspacing=""0"" cellpadding=""3"" WIDTH=""640""><TR><TD>")
"RTN","SAMICTT0",82,0)
 ;d OUT("<FONT SIZE=""+2""><CENTER>")
"RTN","SAMICTT0",83,0)
 ;d OUT("<!-- Calling TR: CT Evaluation Report -->")
"RTN","SAMICTT0",84,0)
 ;d OUT("<B>CT Evaluation Report</B>")
"RTN","SAMICTT0",85,0)
 d OUT("CT Evaluation Report")
"RTN","SAMICTT0",86,0)
 ;d OUT("</CENTER></FONT>")
"RTN","SAMICTT0",87,0)
 ;d OUT("</TD></TR><TR><TD>")
"RTN","SAMICTT0",88,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT0",89,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT0",90,0)
 ;
"RTN","SAMICTT0",91,0)
 ;d OUT("<!-- patient information -->")
"RTN","SAMICTT0",92,0)
 ;d OUT("<TR><TD><TABLE border=""0"" cellspacing=""0"" cellpadding=""3"" WIDTH=""640"">")
"RTN","SAMICTT0",93,0)
 ;
"RTN","SAMICTT0",94,0)
 ; generate header
"RTN","SAMICTT0",95,0)
 ;
"RTN","SAMICTT0",96,0)
 d  ;
"RTN","SAMICTT0",97,0)
 . n pname
"RTN","SAMICTT0",98,0)
 . ;s pname=$$XVAL("sinamel",vals)_", "_$$XVAL("sinamef",vals)
"RTN","SAMICTT0",99,0)
 . s pname=$$XVAL("saminame",vals)
"RTN","SAMICTT0",100,0)
 . d OUT("Participant Name: "_pname)
"RTN","SAMICTT0",101,0)
 ;d OUT("<TR><TD WIDTH=""180""><B>Participant Name:</B></TD><TD WIDTH=""365"">")
"RTN","SAMICTT0",102,0)
 ;d OUT($$XVAL("sinamel",vals)_", "_$$XVAL("sinamef",vals))
"RTN","SAMICTT0",103,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",104,0)
 ;
"RTN","SAMICTT0",105,0)
 d  ;
"RTN","SAMICTT0",106,0)
 . n sid s sid=$$XVAL("sisid",vals)
"RTN","SAMICTT0",107,0)
 . d OUT("Study ID: "_sid)
"RTN","SAMICTT0",108,0)
 ;d OUT("<TD WIDTH=""120""><B>Study ID:</B></TD><TD WIDTH=""75"">")
"RTN","SAMICTT0",109,0)
 ;d OUT($$XVAL("sisid",vals))
"RTN","SAMICTT0",110,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",111,0)
 ;
"RTN","SAMICTT0",112,0)
 d  ;
"RTN","SAMICTT0",113,0)
 . n etype s etype=$$XSUB("cetex",vals,dict)_" "_$$XSUB("cectp",vals,dict)
"RTN","SAMICTT0",114,0)
 . d OUT("Type of Examination: "_etype)
"RTN","SAMICTT0",115,0)
 ;d OUT("<TR><TD><B>Type of Examination:</B></TD><TD>")
"RTN","SAMICTT0",116,0)
 ;d OUT($$XSUB("cetex",vals,dict)_" "_$$XSUB("cectp",vals,dict))
"RTN","SAMICTT0",117,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",118,0)
 ;d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",119,0)
 ;
"RTN","SAMICTT0",120,0)
 d  ;
"RTN","SAMICTT0",121,0)
 . n edate s edate=$$XVAL("cedos",vals)
"RTN","SAMICTT0",122,0)
 . d OUT("Examination Date: "_edate)
"RTN","SAMICTT0",123,0)
 ;d OUT("<TR><TD><B>Examination Date:</B></TD><TD>")
"RTN","SAMICTT0",124,0)
 ;d OUT($$XVAL("cedos",vals))
"RTN","SAMICTT0",125,0)
 ;
"RTN","SAMICTT0",126,0)
 ;i $$XVAL("sidob",vals)'=-1 d  ;
"RTN","SAMICTT0",127,0)
 ;. d OUT("<TD><B>Date of Birth:</B></TD><TD>")
"RTN","SAMICTT0",128,0)
 ;. d OUT($$XVAL("sidob",vals))
"RTN","SAMICTT0",129,0)
 ;e  d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",130,0)
 ;
"RTN","SAMICTT0",131,0)
 d  ;
"RTN","SAMICTT0",132,0)
 . n dob s dob=$$XVAL("sidob",vals)
"RTN","SAMICTT0",133,0)
 . i dob>0 d OUT("Date of Birth: "_dob)
"RTN","SAMICTT0",134,0)
 . d OUT("")
"RTN","SAMICTT0",135,0)
 ;i $$XVAL("sidob",vals)>0 d  ;
"RTN","SAMICTT0",136,0)
 ;. d OUT("<TD><B>Date of Birth:</B></TD><TD>")
"RTN","SAMICTT0",137,0)
 ;. d OUT($$XVAL("sidob",vals))
"RTN","SAMICTT0",138,0)
 ;. d OUT("</TD></TR>")
"RTN","SAMICTT0",139,0)
 ;e  d  ;
"RTN","SAMICTT0",140,0)
 ;. d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",141,0)
 ;
"RTN","SAMICTT0",142,0)
 ;# End of Header
"RTN","SAMICTT0",143,0)
 ;
"RTN","SAMICTT0",144,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTT0",145,0)
 ;;d OUT("</TD></TR><TR><TD>")
"RTN","SAMICTT0",146,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT0",147,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT0",148,0)
 ;d OUT("<!-- report -->")
"RTN","SAMICTT0",149,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTT0",150,0)
 ;d OUT("<FONT SIZE=""+2""><B>")
"RTN","SAMICTT0",151,0)
 ;d OUT("Report:")
"RTN","SAMICTT0",152,0)
 ;d OUT("</B></FONT>")
"RTN","SAMICTT0",153,0)
 ;d OUT("</TD></TR><TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTT0",154,0)
 d OUT("Report:")
"RTN","SAMICTT0",155,0)
 ;
"RTN","SAMICTT0",156,0)
 s outmode="hold"
"RTN","SAMICTT0",157,0)
 s line=""
"RTN","SAMICTT0",158,0)
 i $$XVAL("ceclin",vals)'="" d  ;
"RTN","SAMICTT0",159,0)
 . d HOUT("Clinical Information: ")
"RTN","SAMICTT0",160,0)
 . d OUT($$XVAL("ceclin",vals))
"RTN","SAMICTT0",161,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT0",162,0)
 ;
"RTN","SAMICTT0",163,0)
 s outmode="hold"
"RTN","SAMICTT0",164,0)
 n nopri s nopri=1
"RTN","SAMICTT0",165,0)
 d HOUT("Comparison CT Scans: ")
"RTN","SAMICTT0",166,0)
 if $$XVAL("cedcs",vals)'="" d  ;
"RTN","SAMICTT0",167,0)
 . d OUT($$XSUB("cetex",vals,dict)_". ")
"RTN","SAMICTT0",168,0)
 . d OUT("Comparisons: "_$$XVAL("cedcs",vals))
"RTN","SAMICTT0",169,0)
 . s nopri=0
"RTN","SAMICTT0",170,0)
 if $$XVAL("cedps",vals)'="" d  ;
"RTN","SAMICTT0",171,0)
 . d OUT(" "_$$XVAL("cedps",vals))
"RTN","SAMICTT0",172,0)
 . s nopri=0
"RTN","SAMICTT0",173,0)
 d:nopri OUT("None")
"RTN","SAMICTT0",174,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT0",175,0)
 ;
"RTN","SAMICTT0",176,0)
 s outmode="hold"
"RTN","SAMICTT0",177,0)
 d HOUT(" Description: ")
"RTN","SAMICTT0",178,0)
 i $$XVAL("cectp",vals)="i" d  ;
"RTN","SAMICTT0",179,0)
 . d OUT("Limited Diagnostic CT examination was performed. ")
"RTN","SAMICTT0",180,0)
 e  d  ;
"RTN","SAMICTT0",181,0)
 . d OUT("CT examination of the entire thorax was performed at "_$$XSUB("cectp",vals,dict)_" settings. ")
"RTN","SAMICTT0",182,0)
 ;
"RTN","SAMICTT0",183,0)
 i $$XVAL("cectrst",vals)'="" d  ;
"RTN","SAMICTT0",184,0)
 . d OUT(" Images were obtained at "_$$XVAL("cectrst",vals)_" mm slice thickness. ")
"RTN","SAMICTT0",185,0)
 . d OUT(" Multiplanar reconstructions were performed. ")
"RTN","SAMICTT0",186,0)
 ;
"RTN","SAMICTT0",187,0)
 i newct d  ;
"RTN","SAMICTT0",188,0)
 . n nvadbo s nvadbo=1
"RTN","SAMICTT0",189,0)
 . n ii
"RTN","SAMICTT0",190,0)
 . f ii="ceoaa","ceaga","ceasa","ceala","ceapa","ceaaa","ceaka" d  ;
"RTN","SAMICTT0",191,0)
 . . i $$XVAL(ii,vals)="y" set nvadbo=0
"RTN","SAMICTT0",192,0)
 . ;
"RTN","SAMICTT0",193,0)
 . i nvadbo=1 d  ;
"RTN","SAMICTT0",194,0)
 . . d OUT("Upper abdominal images were not acquired on the current scan due to its limited nature. ")
"RTN","SAMICTT0",195,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT0",196,0)
 ;
"RTN","SAMICTT0",197,0)
 ; lung nodules
"RTN","SAMICTT0",198,0)
 ;
"RTN","SAMICTT0",199,0)
 ;d OUT("")
"RTN","SAMICTT0",200,0)
 d HOUT("Lung Nodules:")
"RTN","SAMICTT0",201,0)
 ;d OUT("")
"RTN","SAMICTT0",202,0)
 ;
"RTN","SAMICTT0",203,0)
 ; see if there are any nodules using the cectXch fields
"RTN","SAMICTT0",204,0)
 ;
"RTN","SAMICTT0",205,0)
 n ij,hasnodules s hasnodules=0
"RTN","SAMICTT0",206,0)
 f ij=1:1:10 i ($$XVAL("cect"_ij_"ch",vals)'="")&($$XVAL("cect"_ij_"ch",vals)'="-") s hasnodules=1
"RTN","SAMICTT0",207,0)
 ;
"RTN","SAMICTT0",208,0)
 i hasnodules=0 d  ;
"RTN","SAMICTT0",209,0)
 . d OUT(para)
"RTN","SAMICTT0",210,0)
 . d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",211,0)
 ;
"RTN","SAMICTT0",212,0)
 ;i $$XVAL("cennod",vals)="" d  ;
"RTN","SAMICTT0",213,0)
 ;. d OUT(para)
"RTN","SAMICTT0",214,0)
 ;. d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",215,0)
 ;e  i $$XVAL("ceanod",vals)="n" d  ;
"RTN","SAMICTT0",216,0)
 ;. d OUT(para)
"RTN","SAMICTT0",217,0)
 ;. d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",218,0)
 ;
"RTN","SAMICTT0",219,0)
 d NODULES^SAMICTT1(rtn,.vals,.dict)
"RTN","SAMICTT0",220,0)
 ;
"RTN","SAMICTT0",221,0)
 d OTHRLUNG^SAMICTT2(rtn,.vals,.dict)
"RTN","SAMICTT0",222,0)
 ;
"RTN","SAMICTT0",223,0)
 d EMPHYS^SAMICTT3(rtn,.vals,.dict)
"RTN","SAMICTT0",224,0)
 ;
"RTN","SAMICTT0",225,0)
 d BREAST^SAMICTT4(rtn,.vals,.dict)
"RTN","SAMICTT0",226,0)
 ;
"RTN","SAMICTT0",227,0)
 d IMPRSN^SAMICTT9(rtn,.vals,.dict)
"RTN","SAMICTT0",228,0)
 ;
"RTN","SAMICTT0",229,0)
 d RCMND^SAMICTTA(rtn,.vals,.dict)
"RTN","SAMICTT0",230,0)
 ;
"RTN","SAMICTT0",231,0)
 ; etc etc
"RTN","SAMICTT0",232,0)
 ;
"RTN","SAMICTT0",233,0)
 d  ;
"RTN","SAMICTT0",234,0)
 . d OUT("References:")
"RTN","SAMICTT0",235,0)
 . d OUT("Recommendations for nodules and other findings are detailed in the I-ELCAP Protocol. ")
"RTN","SAMICTT0",236,0)
 . d OUT("A summary and the full I-ELCAP protocol can be viewed at: http://ielcap.org/protocols")
"RTN","SAMICTT0",237,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTT0",238,0)
 ;d OUT("<p><br></p><p><b>References:</b><br></p>")
"RTN","SAMICTT0",239,0)
 ;d OUT("<p>Recommendations for nodules and other findings are detailed in the I-ELCAP Protocol.<BR>")
"RTN","SAMICTT0",240,0)
 ;d OUT("A summary and the full I-ELCAP protocol can be viewed at: <a href=""http://ielcap.org/protocols"">http://ielcap.org/protocols</a></p>")
"RTN","SAMICTT0",241,0)
 ;d OUT("</TD></TR></TABLE></TD></TR></TABLE>")
"RTN","SAMICTT0",242,0)
 ;s debug=1
"RTN","SAMICTT0",243,0)
 d:$g(debug)  ;
"RTN","SAMICTT0",244,0)
 . n zi s zi=""
"RTN","SAMICTT0",245,0)
 . f  s zi=$o(@vals@(zi)) q:zi=""  d  ;
"RTN","SAMICTT0",246,0)
 . . d OUT(zi_" "_$g(@vals@(zi)))
"RTN","SAMICTT0",247,0)
 ;d OUT("</BODY></HTML>")
"RTN","SAMICTT0",248,0)
 ;
"RTN","SAMICTT0",249,0)
 q
"RTN","SAMICTT0",250,0)
 ;
"RTN","SAMICTT0",251,0)
OUT(ln) ;
"RTN","SAMICTT0",252,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT0",253,0)
 s cnt=cnt+1
"RTN","SAMICTT0",254,0)
 n lnn
"RTN","SAMICTT0",255,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT0",256,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",257,0)
 i outmode="go" d  ;
"RTN","SAMICTT0",258,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT0",259,0)
 . s line=""
"RTN","SAMICTT0",260,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",261,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT0",262,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT0",263,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT0",264,0)
 . n zs s zs=$STACK
"RTN","SAMICTT0",265,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT0",266,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT0",267,0)
 q
"RTN","SAMICTT0",268,0)
 ;
"RTN","SAMICTT0",269,0)
OUTOLD(ln) ;
"RTN","SAMICTT0",270,0)
 s cnt=cnt+1
"RTN","SAMICTT0",271,0)
 n lnn
"RTN","SAMICTT0",272,0)
 ;s debug=1
"RTN","SAMICTT0",273,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",274,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT0",275,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT0",276,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT0",277,0)
 . n zs s zs=$STACK
"RTN","SAMICTT0",278,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT0",279,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT0",280,0)
 q
"RTN","SAMICTT0",281,0)
 ;
"RTN","SAMICTT0",282,0)
HOUT(ln) ;
"RTN","SAMICTT0",283,0)
 d OUT(ln)
"RTN","SAMICTT0",284,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT0",285,0)
 q
"RTN","SAMICTT0",286,0)
 ;
"RTN","SAMICTT0",287,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT0",288,0)
 ; vals is passed by name
"RTN","SAMICTT0",289,0)
 n zr
"RTN","SAMICTT0",290,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT0",291,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT0",292,0)
 q zr
"RTN","SAMICTT0",293,0)
 ;
"RTN","SAMICTT0",294,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT0",295,0)
 ; vals and dict are passed by name
"RTN","SAMICTT0",296,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT0",297,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT0",298,0)
 n zr,zv,zdx
"RTN","SAMICTT0",299,0)
 s zdx=$g(valdx)
"RTN","SAMICTT0",300,0)
 i zdx="" s zdx=var
"RTN","SAMICTT0",301,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT0",302,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT0",303,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT0",304,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT0",305,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT0",306,0)
 q zr
"RTN","SAMICTT0",307,0)
 ;
"RTN","SAMICTT0",308,0)
GETFILTR(filter,sid) ; fill in the filter for Ct Eval for sid
"RTN","SAMICTT0",309,0)
 s filter("studyid")=sid
"RTN","SAMICTT0",310,0)
 n items,zform
"RTN","SAMICTT0",311,0)
 d GETITEMS^SAMICASE("items",sid)
"RTN","SAMICTT0",312,0)
 s zform=$o(items("ceform"))
"RTN","SAMICTT0",313,0)
 s filter("form")=zform
"RTN","SAMICTT0",314,0)
 ;zwr filter
"RTN","SAMICTT0",315,0)
 q
"RTN","SAMICTT0",316,0)
T1(grtn,debug) ; 
"RTN","SAMICTT0",317,0)
 n filter
"RTN","SAMICTT0",318,0)
 ;n sid s sid="XXX00333"
"RTN","SAMICTT0",319,0)
 ;n sid s sid="XXX00484"
"RTN","SAMICTT0",320,0)
 n sid s sid="XXX9000001"
"RTN","SAMICTT0",321,0)
 d GETFILTR(.filter,sid)
"RTN","SAMICTT0",322,0)
 i $g(debug)=1 s filter("debug")=1
"RTN","SAMICTT0",323,0)
 d WSNOTE^SAMINOT3(.grtn,.filter)
"RTN","SAMICTT0",324,0)
 ;d WSREPORT^SAMICTT0(.grtn,.filter)
"RTN","SAMICTT0",325,0)
 q
"RTN","SAMICTT0",326,0)
 ;
"RTN","SAMICTT1")
0^2^B92534755
"RTN","SAMICTT1",1,0)
SAMICTT1 ;ven/gpl - ielcap: forms ; 12/28/18 10:54am
"RTN","SAMICTT1",2,0)
 ;;18.0;SAMI;;;Build 2
"RTN","SAMICTT1",3,0)
 ;
"RTN","SAMICTT1",4,0)
 ;
"RTN","SAMICTT1",5,0)
 quit  ; no entry from top
"RTN","SAMICTT1",6,0)
 ;
"RTN","SAMICTT1",7,0)
NODULES(rtn,vals,dict) ;
"RTN","SAMICTT1",8,0)
 ;
"RTN","SAMICTT1",9,0)
 ;
"RTN","SAMICTT1",10,0)
 ;# Report on Nodules
"RTN","SAMICTT1",11,0)
 n firstitem
"RTN","SAMICTT1",12,0)
 set firstitem=0
"RTN","SAMICTT1",13,0)
 n outmode s outmode="hold"
"RTN","SAMICTT1",14,0)
 n line s line=""
"RTN","SAMICTT1",15,0)
 n ii set ii=1
"RTN","SAMICTT1",16,0)
 ;# Information for each nodule
"RTN","SAMICTT1",17,0)
 f ii=1:1:10 d  ;
"RTN","SAMICTT1",18,0)
 . i $$XSUB("cectch",vals,dict,"cect"_ii_"ch")="px" q  ;
"RTN","SAMICTT1",19,0)
 . i $$XSUB("cectch",vals,dict,"cect"_ii_"ch")="" q  ;
"RTN","SAMICTT1",20,0)
 . i firstitem=0 d  ;
"RTN","SAMICTT1",21,0)
 . . ;d OUT("<!-- begin nodule info -->")
"RTN","SAMICTT1",22,0)
 . . ;d OUT("<UL TYPE=disc>")
"RTN","SAMICTT1",23,0)
 . . set firstitem=1
"RTN","SAMICTT1",24,0)
 . ;
"RTN","SAMICTT1",25,0)
 . ;d OUT("<LI>")
"RTN","SAMICTT1",26,0)
 . n specialcase s specialcase=0
"RTN","SAMICTT1",27,0)
 . n ij,ik
"RTN","SAMICTT1",28,0)
 . s ik=$$XVAL("cect"_ii_"ch",vals)
"RTN","SAMICTT1",29,0)
 . ;f ij="pw","px","pr","pv" i ij=ik s specialcase=1
"RTN","SAMICTT1",30,0)
 . i "pwpxprpv"[ik s specialcase=1
"RTN","SAMICTT1",31,0)
 . ;
"RTN","SAMICTT1",32,0)
 . ;# Example Sentence
"RTN","SAMICTT1",33,0)
 . ;# LUL Nodule 1 is non-calcified, non-solid, 6 mm x 6 mm (with 3 x 3) solid component), smooth edge, previously seen and unchanged. (Series 2, Image 65)
"RTN","SAMICTT1",34,0)
 . ;# [LOCATION] Nodule [N] is [CALCIFICATION], [SOLID], [L] mm x mm, [SMOOTH], [NEW].  (Series [Series], Image [ImageNum]).
"RTN","SAMICTT1",35,0)
 . ;
"RTN","SAMICTT1",36,0)
 . n spic s spic=""
"RTN","SAMICTT1",37,0)
 . i $$XVAL("cect"_ii_"sp",vals)="y" s spic="spiculated, "
"RTN","SAMICTT1",38,0)
 . ;
"RTN","SAMICTT1",39,0)
 . n calcification,calcstr,status
"RTN","SAMICTT1",40,0)
 . s status=$$XVAL("cect"_ii_"st",vals)
"RTN","SAMICTT1",41,0)
 . s @vals@("cect"_ii_"ca")=$s(status="bc":"y",status="pc":"q",1:"n")
"RTN","SAMICTT1",42,0)
 . s calcification=$$XSUB("cectca",vals,dict,"cect"_ii_"ca")
"RTN","SAMICTT1",43,0)
 . i calcification="" s calcstr="is "_spic_$$XSUB("cectnt",vals,dict,"cect"_ii_"nt")_", "
"RTN","SAMICTT1",44,0)
 . e  s calcstr="is "_calcification_", "_spic_$$XSUB("cectnt",vals,dict,"cect"_ii_"nt")_", "
"RTN","SAMICTT1",45,0)
 . ;
"RTN","SAMICTT1",46,0)
 . n vssl,vssw,vsl,vsw,avgs,avgss
"RTN","SAMICTT1",47,0)
 . s (vssl,vssw,vsl,vsw,avgs,avgss)=0
"RTN","SAMICTT1",48,0)
 . s vssl=$$XVAL("cect"_ii_"ssl",vals)
"RTN","SAMICTT1",49,0)
 . i vssl'=0 d  ;
"RTN","SAMICTT1",50,0)
 . . s vssw=$$XVAL("cect"_ii_"ssw",vals)
"RTN","SAMICTT1",51,0)
 . . s avgss=(vssl+vssw)/2
"RTN","SAMICTT1",52,0)
 . . s avgss=$j(avgss,1,1)
"RTN","SAMICTT1",53,0)
 . s vsl=$$XVAL("cect"_ii_"sl",vals)
"RTN","SAMICTT1",54,0)
 . s vsw=$$XVAL("cect"_ii_"sw",vals)
"RTN","SAMICTT1",55,0)
 . s avgs=(vsl+vsw)/2
"RTN","SAMICTT1",56,0)
 . s avgs=$j(avgs,1,1)
"RTN","SAMICTT1",57,0)
 . n scomp
"RTN","SAMICTT1",58,0)
 . s scomp=""
"RTN","SAMICTT1",59,0)
 . i $$XVAL("cect"_ii_"ssl",vals)'="" d  ;
"RTN","SAMICTT1",60,0)
 . . ;s scomp=" (solid component "_$$XVAL("cect"_ii_"ssl",vals)_" mm x "_$$XVAL("cect"_ii_"ssw",vals)_" mm average diameter "_avgss_" mm)"
"RTN","SAMICTT1",61,0)
 . . s scomp=", solid component "_$$XVAL("cect"_ii_"ssl",vals)_" mm x "_$$XVAL("cect"_ii_"ssw",vals)_" mm (average diameter of "_avgss_" mm)"
"RTN","SAMICTT1",62,0)
 . ;
"RTN","SAMICTT1",63,0)
 . s calcstr=calcstr_$$XVAL("cect"_ii_"sl",vals)_" mm x "_$$XVAL("cect"_ii_"sw",vals)_" mm (average diameter of "_avgs_" mm)"_scomp_", "
"RTN","SAMICTT1",64,0)
 . ;
"RTN","SAMICTT1",65,0)
 . n smooth
"RTN","SAMICTT1",66,0)
 . ;s smooth=$$XSUB("cectse",vals,dict,"cect"_ii_"se")
"RTN","SAMICTT1",67,0)
 . s smooth=$$XVAL("cect"_ii_"se",vals)
"RTN","SAMICTT1",68,0)
 . i smooth="y" s calcstr=calcstr_"smooth edges, "
"RTN","SAMICTT1",69,0)
 . ;e  s calcstr=calcstr_smooth_" edges, " ;nothing if not smooth
"RTN","SAMICTT1",70,0)
 . ;
"RTN","SAMICTT1",71,0)
 . ; adding distance from costal pleura
"RTN","SAMICTT1",72,0)
 . n pldstr
"RTN","SAMICTT1",73,0)
 . s pldstr="within "_$$XVAL("cect"_ii_"pld",vals)_" mm of the costal pleura"
"RTN","SAMICTT1",74,0)
 . ;
"RTN","SAMICTT1",75,0)
 . n skip s skip=0
"RTN","SAMICTT1",76,0)
 . ;# 3 cases: parenchymal, endobronchial, and both
"RTN","SAMICTT1",77,0)
 . ;
"RTN","SAMICTT1",78,0)
 . n en,loc,nloc,endo,ll
"RTN","SAMICTT1",79,0)
 . s loc=""
"RTN","SAMICTT1",80,0)
 . s nloc=""
"RTN","SAMICTT1",81,0)
 . s en=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",82,0)
 . s ll=$$XVAL("cect"_ii_"ll",vals)
"RTN","SAMICTT1",83,0)
 . i ($l(en)<2)!(en="no")!(en="") d  ;
"RTN","SAMICTT1",84,0)
 . . ;# 1) parenchymal only
"RTN","SAMICTT1",85,0)
 . . n X,Y s X=ll
"RTN","SAMICTT1",86,0)
 . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",87,0)
 . . s loc=Y
"RTN","SAMICTT1",88,0)
 . . s nloc=Y
"RTN","SAMICTT1",89,0)
 . . s endo="Nodule"
"RTN","SAMICTT1",90,0)
 . e  d  ;
"RTN","SAMICTT1",91,0)
 . . i ll="end" d  ;
"RTN","SAMICTT1",92,0)
 . . . ;# 2) Endobronchial only
"RTN","SAMICTT1",93,0)
 . . . i en="tr" d  ;
"RTN","SAMICTT1",94,0)
 . . . . s endo="Endotracheal Nodule"
"RTN","SAMICTT1",95,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",96,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",97,0)
 . . . . e  d  ;
"RTN","SAMICTT1",98,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cectch"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",99,0)
 . . . . . . d OUT(endo_" "_ii_" "_calcstr_" is seen. ")
"RTN","SAMICTT1",100,0)
 . . . . . e  d OUT(endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",101,0)
 . . . . s skip=1
"RTN","SAMICTT1",102,0)
 . . . i en="rm" d  ;
"RTN","SAMICTT1",103,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",104,0)
 . . . . s nloc=$$XSUB("cecten",vals,dict,"cect"_ii_"en")
"RTN","SAMICTT1",105,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",106,0)
 . . . . . ;d OUT("Previously seen "_nloc_" "_endo_" "_ii_" ")
"RTN","SAMICTT1",107,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" in the "_nloc_" "_calcstr_" ")
"RTN","SAMICTT1",108,0)
 . . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",109,0)
 . . . . e  d  ;
"RTN","SAMICTT1",110,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",111,0)
 . . . . . . ;d OUT(nloc_" "_endo_" "_ii_". ")
"RTN","SAMICTT1",112,0)
 . . . . . . d OUT(endo_" "_ii_" is seen in the "_nloc_" "_calcstr_". ")
"RTN","SAMICTT1",113,0)
 . . . . . ;e  d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",114,0)
 . . . . . e  d OUT(endo_" "_ii_" in the "_nloc_" "_calcstr_", "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",115,0)
 . . . . s skip=1
"RTN","SAMICTT1",116,0)
 . . . i en="bi" d  ;
"RTN","SAMICTT1",117,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",118,0)
 . . . . s loc=$$XSUB("cecten",vals,dict,"cect"_ii_"en")
"RTN","SAMICTT1",119,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",120,0)
 . . . . . ;d OUT("Previously seen "_endo_" "_ii_" in the "_loc)
"RTN","SAMICTT1",121,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" in the "_nloc_" "_calcstr_" ")
"RTN","SAMICTT1",122,0)
 . . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",123,0)
 . . . . e  d  ;
"RTN","SAMICTT1",124,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",125,0)
 . . . . . . ;d OUT(endo_" "_ii_" is seen in the "_loc_". ")
"RTN","SAMICTT1",126,0)
 . . . . . . d OUT(endo_" "_ii_" is seen in the "_loc_" "_calcstr_". ")
"RTN","SAMICTT1",127,0)
 . . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",128,0)
 . . . . s skip=1
"RTN","SAMICTT1",129,0)
 . . . i skip=0 d  ; "default"
"RTN","SAMICTT1",130,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",131,0)
 . . . . n X,Y
"RTN","SAMICTT1",132,0)
 . . . . s X=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",133,0)
 . . . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",134,0)
 . . . . s nloc=Y
"RTN","SAMICTT1",135,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",136,0)
 . . . . . d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_", likely endobronchial. ")
"RTN","SAMICTT1",137,0)
 . . . . e  d  ;
"RTN","SAMICTT1",138,0)
 . . . . . ;i ($$XVAL("cetex",vals)="b")&($$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n") d  ;
"RTN","SAMICTT1",139,0)
 . . . . . i (($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n")) d  ; gpl 1002
"RTN","SAMICTT1",140,0)
 . . . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" likely endobronchial. ")
"RTN","SAMICTT1",141,0)
 . . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_" likely endobronchial. ")
"RTN","SAMICTT1",142,0)
 . . . . s skip=1
"RTN","SAMICTT1",143,0)
 . . e  d  ;
"RTN","SAMICTT1",144,0)
 . . . s endo="Nodule"
"RTN","SAMICTT1",145,0)
 . . . s loc=$$XSUB("cectll",vals,dict,"cect"_ii_"ll")
"RTN","SAMICTT1",146,0)
 . . . n X,Y
"RTN","SAMICTT1",147,0)
 . . . s X=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",148,0)
 . . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",149,0)
 . . . s nloc=Y
"RTN","SAMICTT1",150,0)
 . . . i specialcase=1 d  ;
"RTN","SAMICTT1",151,0)
 . . . . d OUT(nloc_" "_endo_" "_ii_" previously seen with possible endobronchial component")
"RTN","SAMICTT1",152,0)
 . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",153,0)
 . . . e  d  ;
"RTN","SAMICTT1",154,0)
 . . . . ;i ($$XVAL("cetex",vals)="b")&($$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n") d  ;
"RTN","SAMICTT1",155,0)
 . . . . i (($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n")) d  ; gpl 1002
"RTN","SAMICTT1",156,0)
 . . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" with possible endobronchial component")
"RTN","SAMICTT1",157,0)
 . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" with possible endobronchial component "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",158,0)
 . . . s skip=1
"RTN","SAMICTT1",159,0)
 . i specialcase=1 d  ;
"RTN","SAMICTT1",160,0)
 . . i skip=0 d  ;
"RTN","SAMICTT1",161,0)
 . . . d OUT("Previously seen "_nloc_" "_endo_" "_ii_" ")
"RTN","SAMICTT1",162,0)
 . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",163,0)
 . e  d  ;
"RTN","SAMICTT1",164,0)
 . . i skip=0 d  ;
"RTN","SAMICTT1",165,0)
 . . . ;# pleural distance only goes here
"RTN","SAMICTT1",166,0)
 . . . i $$XVAL("cect"_ii_"pld",vals)'="" s calcstr=calcstr_" "_pldstr_","
"RTN","SAMICTT1",167,0)
 . . . ;# Special Handling for "newly seen" on baseline
"RTN","SAMICTT1",168,0)
 . . . ;i ($$XVAL("cetex",vals)="b")&($$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n") d  ;
"RTN","SAMICTT1",169,0)
 . . . i (($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n")) d  ; gpl 1002
"RTN","SAMICTT1",170,0)
 . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr)
"RTN","SAMICTT1",171,0)
 . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_" ")
"RTN","SAMICTT1",172,0)
 . . d OUT(" (Series "_$$XVAL("cect"_ii_"sn",vals)_",") ; added from 1114 gpl1
"RTN","SAMICTT1",173,0)
 . . ;i $$XVAL("cect"_ii_"inl",vals)=$$XVAL("cect"_ii_"inh",vals) d  ;
"RTN","SAMICTT1",174,0)
 . . ;. d OUT(" image "_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",175,0)
 . . ;e  d  ;
"RTN","SAMICTT1",176,0)
 . . ;. d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",177,0)
 . . i $$XVAL("cect"_ii_"inh",vals)="" d  ;
"RTN","SAMICTT1",178,0)
 . . . d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_"). ")
"RTN","SAMICTT1",179,0)
 . . e  d  ;
"RTN","SAMICTT1",180,0)
 . . . d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_"-"_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",181,0)
 . . i $$XVAL("cect"_ii_"co",vals)'="" d OUT($$XVAL("cect"_ii_"co",vals)_". ") ;1122 gpl1
"RTN","SAMICTT1",182,0)
 . . n ac
"RTN","SAMICTT1",183,0)
 . . s ac=$$XVAL("cect"_ii_"ac",vals)
"RTN","SAMICTT1",184,0)
 . . i ac'="" i (ac'="-") i (ac'="s") d  ;
"RTN","SAMICTT1",185,0)
 . . . d OUT($$XSUB("cectac",vals,dict,"cect"_ii_"ac")_" recommended. ")
"RTN","SAMICTT1",186,0)
 . ;
"RTN","SAMICTT1",187,0)
 . ; end of nodule processing
"RTN","SAMICTT1",188,0)
 . ;
"RTN","SAMICTT1",189,0)
 . s outmode="go"
"RTN","SAMICTT1",190,0)
 . d OUT("")
"RTN","SAMICTT1",191,0)
 . s outmode="hold"
"RTN","SAMICTT1",192,0)
 i firstitem'=0 d  ;
"RTN","SAMICTT1",193,0)
 . ;d OUT("</UL>")
"RTN","SAMICTT1",194,0)
 . ;d OUT("<!-- end nodule info -->")
"RTN","SAMICTT1",195,0)
 ;d OUT("</p>")
"RTN","SAMICTT1",196,0)
 ;
"RTN","SAMICTT1",197,0)
 q
"RTN","SAMICTT1",198,0)
 ;
"RTN","SAMICTT1",199,0)
OUT(ln) ;
"RTN","SAMICTT1",200,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT1",201,0)
 s cnt=cnt+1
"RTN","SAMICTT1",202,0)
 n lnn
"RTN","SAMICTT1",203,0)
 ;s debug=1
"RTN","SAMICTT1",204,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT1",205,0)
 i outmode="go" d  ;
"RTN","SAMICTT1",206,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT1",207,0)
 . s line=""
"RTN","SAMICTT1",208,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT1",209,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT1",210,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT1",211,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT1",212,0)
 . n zs s zs=$STACK
"RTN","SAMICTT1",213,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT1",214,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT1",215,0)
 q
"RTN","SAMICTT1",216,0)
 ;
"RTN","SAMICTT1",217,0)
HOUT(ln) ;
"RTN","SAMICTT1",218,0)
 d OUT(ln)
"RTN","SAMICTT1",219,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT1",220,0)
 q
"RTN","SAMICTT1",221,0)
 ;
"RTN","SAMICTT1",222,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT1",223,0)
 ; vals is passed by name
"RTN","SAMICTT1",224,0)
 n zr
"RTN","SAMICTT1",225,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT1",226,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT1",227,0)
 q zr
"RTN","SAMICTT1",228,0)
 ;
"RTN","SAMICTT1",229,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT1",230,0)
 ; vals and dict are passed by name
"RTN","SAMICTT1",231,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT1",232,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT1",233,0)
 n zr,zv,zdx
"RTN","SAMICTT1",234,0)
 s zdx=$g(valdx)
"RTN","SAMICTT1",235,0)
 i zdx="" s zdx=var
"RTN","SAMICTT1",236,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT1",237,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT1",238,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT1",239,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT1",240,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT1",241,0)
 q zr
"RTN","SAMICTT1",242,0)
 ;
"RTN","SAMICTT2")
0^3^B84904289
"RTN","SAMICTT2",1,0)
SAMICTT2 ;ven/gpl - ielcap: forms ; 4/22/19 9:04am
"RTN","SAMICTT2",2,0)
 ;;18.0;SAMI;;;Build 2
"RTN","SAMICTT2",3,0)
 ;
"RTN","SAMICTT2",4,0)
 ;
"RTN","SAMICTT2",5,0)
 quit  ; no entry from top
"RTN","SAMICTT2",6,0)
 ;
"RTN","SAMICTT2",7,0)
OTHRLUNG(rtn,vals,dict) ;
"RTN","SAMICTT2",8,0)
 ; repgen2,repgen3
"RTN","SAMICTT2",9,0)
 ;
"RTN","SAMICTT2",10,0)
 ; starts at "Other lung findings:"
"RTN","SAMICTT2",11,0)
 ;
"RTN","SAMICTT2",12,0)
 ;#hputs "Other lung findings:"
"RTN","SAMICTT2",13,0)
 s outmode="hold"
"RTN","SAMICTT2",14,0)
 n line s line=""
"RTN","SAMICTT2",15,0)
 ;
"RTN","SAMICTT2",16,0)
 n sp1 s sp1="  "
"RTN","SAMICTT2",17,0)
 n hfind,lfind,yespp,newct
"RTN","SAMICTT2",18,0)
 s (hfind,lfind,yespp)=0
"RTN","SAMICTT2",19,0)
 s newct=1
"RTN","SAMICTT2",20,0)
 ;
"RTN","SAMICTT2",21,0)
 ;# Add handling for new sections
"RTN","SAMICTT2",22,0)
 ;# ceopp is new, if it doensn't exist skip whole section
"RTN","SAMICTT2",23,0)
 ;# only then should old fields be included.
"RTN","SAMICTT2",24,0)
 ;
"RTN","SAMICTT2",25,0)
 i $g(newct)=1 d  ;
"RTN","SAMICTT2",26,0)
 . i "y"="y" d  ;
"RTN","SAMICTT2",27,0)
 . . s yespp=1
"RTN","SAMICTT2",28,0)
 . . i $$XVAL("cecbc",vals)="y" d  ;
"RTN","SAMICTT2",29,0)
 . . . d HLFIND ;
"RTN","SAMICTT2",30,0)
 . . . d OUT(sp1_"Cyst seen in the "_$$LOBESTR("cecbcl1^cecbcl2^cecbcl3^cecbcl4^cecbcl5",0)_". ") d OUT("")
"RTN","SAMICTT2",31,0)
 . . . ;d OUT($$LOBESTR("cecbcl1^cecbcl2^cecbcl3^cecbcl4^cecbcl5",0)_". ")
"RTN","SAMICTT2",32,0)
 . . . s yespp=1
"RTN","SAMICTT2",33,0)
 . . if $$XVAL("cecbb",vals)="y" d  ;
"RTN","SAMICTT2",34,0)
 . . . d HLFIND ; 
"RTN","SAMICTT2",35,0)
 . . . ;d OUT("<br>"_"Bleb or bullae seen in the ")
"RTN","SAMICTT2",36,0)
 . . . d OUT(sp1_"Bleb or bullae seen in the "_$$LOBESTR("cecbbl1^cecbbl2^cecbbl3^cecbbl4^cecbbl5",0)_". ") d OUT("")
"RTN","SAMICTT2",37,0)
 . . . set yespp=1
"RTN","SAMICTT2",38,0)
 . . if $$XVAL("cebrsb",vals)="y" d  ;
"RTN","SAMICTT2",39,0)
 . . . d HLFIND ; 
"RTN","SAMICTT2",40,0)
 . . . ;d OUT("<br>"_"Bronchiectasis in the ")
"RTN","SAMICTT2",41,0)
 . . . d OUT(sp1_"Bronchiectasis in the "_$$LOBESTR("cebrsbl1^cebrsbl2^cebrsbl3^cebrsbl4^cebrsbl5",0)_". ") d OUT("")
"RTN","SAMICTT2",42,0)
 . . . set yespp=1
"RTN","SAMICTT2",43,0)
 . . if $$XVAL("cebrs",vals)="y" d  ;
"RTN","SAMICTT2",44,0)
 . . . if $$XVAL("cebrsb",vals)'="y" d  ;
"RTN","SAMICTT2",45,0)
 . . . . if $$XVAL("cebrss",vals)'="y" d  ;
"RTN","SAMICTT2",46,0)
 . . . . . d HLFIND ;
"RTN","SAMICTT2",47,0)
 . . . . . ;d OUT("<br>"_"Small Airways Disease in the ")
"RTN","SAMICTT2",48,0)
 . . . . . d OUT(sp1_"Small Airways Disease in the "_$$LOBESTR("cebrsl1^cebrsl2^cebrsl3^cebrsl4^cebrsl5",0)_". ") d OUT("")
"RTN","SAMICTT2",49,0)
 . . . . . set yespp=1
"RTN","SAMICTT2",50,0)
 . . if $$XVAL("cebrss",vals)="y" d  ;
"RTN","SAMICTT2",51,0)
 . . . d HLFIND ;
"RTN","SAMICTT2",52,0)
 . . . ;d OUT("<br>"_"Small Airways Disease/Bronchiolectasis in the ")
"RTN","SAMICTT2",53,0)
 . . . d OUT(sp1_"Small Airways Disease/Bronchiolectasis in the "_$$LOBESTR("cebrssl1^cebrssl2^cebrssl3^cebrssl4^cebrssl5",0)_". ") d OUT("")
"RTN","SAMICTT2",54,0)
 . . . set yespp=1
"RTN","SAMICTT2",55,0)
 . . n numl,str
"RTN","SAMICTT2",56,0)
 . . s numl=0
"RTN","SAMICTT2",57,0)
 . . s str=""
"RTN","SAMICTT2",58,0)
 . . if $$XVAL("cebs",vals)="o" d  ;
"RTN","SAMICTT2",59,0)
 . . . set yespp=1
"RTN","SAMICTT2",60,0)
 . . . set numl=0
"RTN","SAMICTT2",61,0)
 . . . set str="Normal bronchial resection margin on"
"RTN","SAMICTT2",62,0)
 . . . if $$XVAL("cebsrt",vals)="r" d  ;
"RTN","SAMICTT2",63,0)
 . . . . s str=str_" right"
"RTN","SAMICTT2",64,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",65,0)
 . . . if $$XVAL("cebslt",vals)="l" d  ;
"RTN","SAMICTT2",66,0)
 . . . . if numl>0 d  ;
"RTN","SAMICTT2",67,0)
 . . . . . s str=str_" and"
"RTN","SAMICTT2",68,0)
 . . . . s str=str_" left"
"RTN","SAMICTT2",69,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",70,0)
 . . . s str=str_". "
"RTN","SAMICTT2",71,0)
 . . . if numl=0 d  ;
"RTN","SAMICTT2",72,0)
 . . . . set str="Normal bronchial resection margin noted. "
"RTN","SAMICTT2",73,0)
 . . . d HLFIND ;
"RTN","SAMICTT2",74,0)
 . . . d OUT(sp1_str)
"RTN","SAMICTT2",75,0)
 . . . ;d OUT("<br>")
"RTN","SAMICTT2",76,0)
 . . ;if $$XVAL("cebrsb",vals)="y" d  ;
"RTN","SAMICTT2",77,0)
 . . ;. d HLFIND
"RTN","SAMICTT2",78,0)
 . . ;. d OUT("<br>"_"Bronchiectasis in the ")
"RTN","SAMICTT2",79,0)
 . . ;. d OUT($$LOBESTR("cebrsbl1^cebrsbl2^cebrsbl3^cebrsbl4^cebrsbl5",0)_". ")
"RTN","SAMICTT2",80,0)
 . . ;. set yespp=1
"RTN","SAMICTT2",81,0)
 . . if $$XVAL("ceild",vals)="y" d  ;
"RTN","SAMICTT2",82,0)
 . . . d HLFIND
"RTN","SAMICTT2",83,0)
 . . . ;d OUT("<br>"_"Evidence of interstitial lung disease in the ")
"RTN","SAMICTT2",84,0)
 . . . d OUT(sp1_"Evidence of interstitial lung disease in the "_$$LOBESTR("ceildl1^ceildl2^ceildl3^ceildl4^ceildl5",0)_". ") d OUT("")
"RTN","SAMICTT2",85,0)
 . . . set yespp=1
"RTN","SAMICTT2",86,0)
 . . if $$XVAL("cerdc",vals)="y" d  ;
"RTN","SAMICTT2",87,0)
 . . . d HLFIND
"RTN","SAMICTT2",88,0)
 . . . ;d OUT("<br>"_"Regional or diffuse consolidation in the ")
"RTN","SAMICTT2",89,0)
 . . . d OUT(sp1_"Regional or diffuse consolidation in the "_$$LOBESTR("cerdcl1^cerdcl2^cerdcl3^cerdcl4^cerdcl5",0)_". ") d OUT("")
"RTN","SAMICTT2",90,0)
 . . . set yespp=1
"RTN","SAMICTT2",91,0)
 . . ;# scarring may be more complicated (apical, and bilateral)
"RTN","SAMICTT2",92,0)
 . . if $$XVAL("cescr",vals)="y" d  ;
"RTN","SAMICTT2",93,0)
 . . . d HLFIND
"RTN","SAMICTT2",94,0)
 . . . ;# If apical use "unilateral apical scarring", if bilateral use "bilateral apical scarring"
"RTN","SAMICTT2",95,0)
 . . . ;# Otherwise use our previouse construct
"RTN","SAMICTT2",96,0)
 . . . n done s done=0 ; flag to use for other scarring 
"RTN","SAMICTT2",97,0)
 . . . if $$XVAL("cescrl6",vals)="au" d  ;
"RTN","SAMICTT2",98,0)
 . . . . d OUT(sp1_"Unilateral apical scarring. ") d OUT("")
"RTN","SAMICTT2",99,0)
 . . . . s done=1
"RTN","SAMICTT2",100,0)
 . . . else  if $$XVAL("cescrl7",vals)="ab" d  ;
"RTN","SAMICTT2",101,0)
 . . . . d OUT(sp1_"Bilateral apical scarring. ") d OUT("")
"RTN","SAMICTT2",102,0)
 . . . . s done=1
"RTN","SAMICTT2",103,0)
 . . . if done=0  d  ;
"RTN","SAMICTT2",104,0)
 . . . . ;d OUT("<br>"_"Scarring in the ")
"RTN","SAMICTT2",105,0)
 . . . . d OUT(sp1_"Scarring in the "_$$LOBESTR("cescrl1^cescrl2^cescrl3^cescrl4^cescrl5",1)_". ") d OUT("")
"RTN","SAMICTT2",106,0)
 . . . . set yespp=1
"RTN","SAMICTT2",107,0)
 . . if $$XVAL("cebat",vals)="y" d  ;
"RTN","SAMICTT2",108,0)
 . . . d HLFIND
"RTN","SAMICTT2",109,0)
 . . . ;d OUT("<br>"_"Other atelectasis in the ")
"RTN","SAMICTT2",110,0)
 . . . d OUT(sp1_"Other atelectasis in the "_$$LOBESTR("cebatl1^cebatl2^cebatl3^cebatl4^cebatl5",0)_". ") d OUT("")
"RTN","SAMICTT2",111,0)
 . . . set yespp=1
"RTN","SAMICTT2",112,0)
 . . if $$XVAL("cerb",vals)="y" d  ;
"RTN","SAMICTT2",113,0)
 . . . d HLFIND
"RTN","SAMICTT2",114,0)
 . . . ;d OUT("<br>"_"Traction bronchiectasis in the ")
"RTN","SAMICTT2",115,0)
 . . . d OUT(sp1_"Traction bronchiectasis in the "_$$LOBESTR("cerbl1^cerbl2^cerbl3^cerbl4^cerbl5",0)_". ") d OUT("")
"RTN","SAMICTT2",116,0)
 . . . set yespp=1
"RTN","SAMICTT2",117,0)
 . . if $$XVAL("cepgo",vals)="y" d  ;
"RTN","SAMICTT2",118,0)
 . . . d HLFIND
"RTN","SAMICTT2",119,0)
 . . . ;d OUT("<br>"_"Peripheral Ground-glass Opacities in the ")
"RTN","SAMICTT2",120,0)
 . . . d OUT(sp1_"Peripheral Ground-glass Opacities in the "_$$LOBESTR("cepgol1^cepgol2^cepgol3^cepgol4^cepgol5",0)_". ") d OUT("")
"RTN","SAMICTT2",121,0)
 . . . set yespp=1
"RTN","SAMICTT2",122,0)
 . . if $$XVAL("ceret",vals)="y" d  ;
"RTN","SAMICTT2",123,0)
 . . . d HLFIND
"RTN","SAMICTT2",124,0)
 . . . ;d OUT("<br>"_"Reticulations in the ")
"RTN","SAMICTT2",125,0)
 . . . d OUT(sp1_"Reticulations in the "_$$LOBESTR("ceretl1^ceretl2^ceretl3^ceretl4^ceretl5",0)_". ") d OUT("")
"RTN","SAMICTT2",126,0)
 . . . set yespp=1
"RTN","SAMICTT2",127,0)
 . . if $$XVAL("cephc",vals)="y" d  ;
"RTN","SAMICTT2",128,0)
 . . . d HLFIND
"RTN","SAMICTT2",129,0)
 . . . ;d OUT("<br>"_"Honeycombing in the ")
"RTN","SAMICTT2",130,0)
 . . . d OUT(sp1_"Honeycombing in the "_$$LOBESTR("cephcl1^cephcl2^cephcl3^cephcl4^cephcl5",0)_". ") d OUT("")
"RTN","SAMICTT2",131,0)
 . . . set yespp=1
"RTN","SAMICTT2",132,0)
 . . if $$XVAL("cepp",vals)="y" d  ;
"RTN","SAMICTT2",133,0)
 . . . set yespp=1
"RTN","SAMICTT2",134,0)
 . . . set numl=0
"RTN","SAMICTT2",135,0)
 . . . set str="Pleural or fissural plaques in the "
"RTN","SAMICTT2",136,0)
 . . . if $$XVAL("cepprt",vals)="r" d  ;
"RTN","SAMICTT2",137,0)
 . . . . s str=str_"right"
"RTN","SAMICTT2",138,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",139,0)
 . . . if $$XVAL("cepplt",vals)="l" d  ;
"RTN","SAMICTT2",140,0)
 . . . . if numl>0 d  ;
"RTN","SAMICTT2",141,0)
 . . . . . s str=str_" and"
"RTN","SAMICTT2",142,0)
 . . . . s str=str_" left"
"RTN","SAMICTT2",143,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",144,0)
 . . . . if numl>1 s str=str_" lobes"
"RTN","SAMICTT2",145,0)
 . . . . else  s str=str_" lobe"
"RTN","SAMICTT2",146,0)
 . . . . if $$XVAL("ceppca",vals)="c" s str=str_" with calcifications"
"RTN","SAMICTT2",147,0)
 . . . . s str=str_". "_para
"RTN","SAMICTT2",148,0)
 . . . if numl=0 set str="Pleural or fissural plaques are noted. "
"RTN","SAMICTT2",149,0)
 . . . d HLFIND
"RTN","SAMICTT2",150,0)
 . . . d OUT(sp1_str)
"RTN","SAMICTT2",151,0)
 . . ;
"RTN","SAMICTT2",152,0)
 . . ;# Note: Not used for newer CT Evaluation Forms
"RTN","SAMICTT2",153,0)
 . . ;if { 0 == [ string compare y [xval cepc] ] } {
"RTN","SAMICTT2",154,0)
 . . ;  set yespp 1
"RTN","SAMICTT2",155,0)
 . . ;     hlfind
"RTN","SAMICTT2",156,0)
 . . ;     puts "[sidestr {Pleural calcifications} cepcrt cepclt]"
"RTN","SAMICTT2",157,0)
 . . ;
"RTN","SAMICTT2",158,0)
 . . if $$XVAL("cebs",vals)="y" d  ;
"RTN","SAMICTT2",159,0)
 . . . set yespp=1
"RTN","SAMICTT2",160,0)
 . . . set numl=0
"RTN","SAMICTT2",161,0)
 . . . set str="Abnormal bronchial resection margin on"
"RTN","SAMICTT2",162,0)
 . . . d  ;
"RTN","SAMICTT2",163,0)
 . . . . if $$XVAL("cebsrt",vals)="r" d  ;
"RTN","SAMICTT2",164,0)
 . . . . . s str=str_" right"
"RTN","SAMICTT2",165,0)
 . . . . . s numl=numl+1
"RTN","SAMICTT2",166,0)
 . . . . if $$XVAL("cebslt",vals)="l" d  ;
"RTN","SAMICTT2",167,0)
 . . . . . if numl>0 s str=str_" and"
"RTN","SAMICTT2",168,0)
 . . . . . s str=str_" left"
"RTN","SAMICTT2",169,0)
 . . . . . s numl=numl+1
"RTN","SAMICTT2",170,0)
 . . . . s str=str_". "
"RTN","SAMICTT2",171,0)
 . . . if numl=0 set str="<br>"_"Abnormal bronchial resection margin noted. "
"RTN","SAMICTT2",172,0)
 . . . d HLFIND
"RTN","SAMICTT2",173,0)
 . . . d OUT(sp1_str)
"RTN","SAMICTT2",174,0)
 . . . ;d OUT(para)
"RTN","SAMICTT2",175,0)
 . . ;
"RTN","SAMICTT2",176,0)
 . . if $L($$XVAL("ceoppa",vals))'=0 d  ;
"RTN","SAMICTT2",177,0)
 . . . ;# puts "Additional Comments on Parenchymal or Pleural Abnormalities:"
"RTN","SAMICTT2",178,0)
 . . . d HLFIND
"RTN","SAMICTT2",179,0)
 . . . d OUT(sp1_$$XVAL("ceoppa",vals)_". ") d OUT("")
"RTN","SAMICTT2",180,0)
 . . . ;d OUT(para)
"RTN","SAMICTT2",181,0)
 . . else  if yespp=1  ;d OUT(para)
"RTN","SAMICTT2",182,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT2",183,0)
 q
"RTN","SAMICTT2",184,0)
 ;
"RTN","SAMICTT2",185,0)
LOBESTR(lst,opt) ; extrinsic returns lobes
"RTN","SAMICTT2",186,0)
 ; lst is of the for a^b^c where a,b and c are variable names
"RTN","SAMICTT2",187,0)
 n rtstr,lln,tary
"RTN","SAMICTT2",188,0)
 s tary=""
"RTN","SAMICTT2",189,0)
 s rtstr=""
"RTN","SAMICTT2",190,0)
 s lln=$l(lst,"^")
"RTN","SAMICTT2",191,0)
 f lzi=1:1:lln d  ;
"RTN","SAMICTT2",192,0)
 . n tval
"RTN","SAMICTT2",193,0)
 . s tval=$$XVAL($p(lst,"^",lzi),vals)
"RTN","SAMICTT2",194,0)
 . n X,Y S X=tval X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT2",195,0)
 . s tval=Y
"RTN","SAMICTT2",196,0)
 . i tval'="" s tary($o(tary(""),-1)+1)=tval
"RTN","SAMICTT2",197,0)
 n tcnt s tcnt=$o(tary(""),-1)
"RTN","SAMICTT2",198,0)
 q:tcnt=0
"RTN","SAMICTT2",199,0)
 i tcnt=1 q tary(1)
"RTN","SAMICTT2",200,0)
 i tcnt=2 q tary(1)_" and "_tary(2)
"RTN","SAMICTT2",201,0)
 f lzi=1:1:tcnt s rtstr=rtstr_tary(lzi)_$s(lzi<tcnt:", ",1:"")
"RTN","SAMICTT2",202,0)
 q rtstr
"RTN","SAMICTT2",203,0)
 ;
"RTN","SAMICTT2",204,0)
HLFIND() ; references and sets lfind in calling routine
"RTN","SAMICTT2",205,0)
 i $g(lfind)=0 d  ;
"RTN","SAMICTT2",206,0)
 . d HOUT("Other lung findings:")
"RTN","SAMICTT2",207,0)
 . d OUT("")
"RTN","SAMICTT2",208,0)
 . s lfind=1
"RTN","SAMICTT2",209,0)
 q
"RTN","SAMICTT2",210,0)
 ;
"RTN","SAMICTT2",211,0)
OUT(ln) ;
"RTN","SAMICTT2",212,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT2",213,0)
 s cnt=cnt+1
"RTN","SAMICTT2",214,0)
 n lnn
"RTN","SAMICTT2",215,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT2",216,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT2",217,0)
 i outmode="go" d  ;
"RTN","SAMICTT2",218,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT2",219,0)
 . s line=""
"RTN","SAMICTT2",220,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT2",221,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT2",222,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT2",223,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT2",224,0)
 . n zs s zs=$STACK
"RTN","SAMICTT2",225,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT2",226,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT2",227,0)
 q
"RTN","SAMICTT2",228,0)
 ;
"RTN","SAMICTT2",229,0)
OUTold(ln) ;
"RTN","SAMICTT2",230,0)
 s cnt=cnt+1
"RTN","SAMICTT2",231,0)
 n lnn
"RTN","SAMICTT2",232,0)
 ;s debug=1
"RTN","SAMICTT2",233,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT2",234,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT2",235,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT2",236,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT2",237,0)
 . n zs s zs=$STACK
"RTN","SAMICTT2",238,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT2",239,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT2",240,0)
 q
"RTN","SAMICTT2",241,0)
 ;
"RTN","SAMICTT2",242,0)
HOUT(ln) ;
"RTN","SAMICTT2",243,0)
 d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT2",244,0)
 q
"RTN","SAMICTT2",245,0)
 ;
"RTN","SAMICTT2",246,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT2",247,0)
 ; vals is passed by name
"RTN","SAMICTT2",248,0)
 n zr
"RTN","SAMICTT2",249,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT2",250,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT2",251,0)
 q zr
"RTN","SAMICTT2",252,0)
 ;
"RTN","SAMICTT2",253,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT2",254,0)
 ; vals and dict are passed by name
"RTN","SAMICTT2",255,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT2",256,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT2",257,0)
 n zr,zv,zdx
"RTN","SAMICTT2",258,0)
 s zdx=$g(valdx)
"RTN","SAMICTT2",259,0)
 i zdx="" s zdx=var
"RTN","SAMICTT2",260,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT2",261,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT2",262,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT2",263,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT2",264,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT2",265,0)
 q zr
"RTN","SAMICTT2",266,0)
 ;
"RTN","SAMICTT3")
0^4^B180003709
"RTN","SAMICTT3",1,0)
SAMICTR3 ;ven/gpl - ielcap: forms ; 1/23/19 5:14pm
"RTN","SAMICTT3",2,0)
 ;;18.0;SAMI;;;Build 2
"RTN","SAMICTT3",3,0)
 ;
"RTN","SAMICTT3",4,0)
 ;@license: see routine SAMIUL
"RTN","SAMICTT3",5,0)
 ;
"RTN","SAMICTT3",6,0)
 quit  ; no entry from top
"RTN","SAMICTT3",7,0)
 ;
"RTN","SAMICTT3",8,0)
EMPHYS(rtn,vals,dict) ;
"RTN","SAMICTT3",9,0)
 ; repgen4,repgen5
"RTN","SAMICTT3",10,0)
 ;  
"RTN","SAMICTT3",11,0)
 ;# Emphysema
"RTN","SAMICTT3",12,0)
 ;
"RTN","SAMICTT3",13,0)
 n sp1 s sp1="  "
"RTN","SAMICTT3",14,0)
 s outmode="hold" s line=""
"RTN","SAMICTT3",15,0)
 ;if $$XVAL("ceemv",vals)'="e" d  ;
"RTN","SAMICTT3",16,0)
 if $$XVAL("ceem",vals)'="" d  ;
"RTN","SAMICTT3",17,0)
 . if $$XVAL("ceem",vals)="nv" q  ;
"RTN","SAMICTT3",18,0)
 . if $$XVAL("ceem",vals)="no" q  ;
"RTN","SAMICTT3",19,0)
 . ;d OUT("")
"RTN","SAMICTT3",20,0)
 . D HOUT("Emphysema: ")
"RTN","SAMICTT3",21,0)
 . ;d OUT("")
"RTN","SAMICTT3",22,0)
 . D OUT(sp1_$$XSUB("ceem",vals,dict))
"RTN","SAMICTT3",23,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",24,0)
 ;
"RTN","SAMICTT3",25,0)
 if $$XVAL("ceem",vals)="" d  ;
"RTN","SAMICTT3",26,0)
 . D HOUT("Emphysema: None")
"RTN","SAMICTT3",27,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",28,0)
 ;d OUT("")
"RTN","SAMICTT3",29,0)
 s outmode="hold"
"RTN","SAMICTT3",30,0)
 D HOUT("Pleura: ")
"RTN","SAMICTT3",31,0)
 ;d OUT("")
"RTN","SAMICTT3",32,0)
 ; hputs "Pleura:"
"RTN","SAMICTT3",33,0)
 N pe s pe=0
"RTN","SAMICTT3",34,0)
 ;
"RTN","SAMICTT3",35,0)
 ; # Pleural Effusion
"RTN","SAMICTT3",36,0)
 ; 
"RTN","SAMICTT3",37,0)
 i $$XVAL("cepev",vals)="y" d  ;
"RTN","SAMICTT3",38,0)
 . if $$XVAL("ceper",vals)="-" d  ;
"RTN","SAMICTT3",39,0)
 . . if $$XVAL("cepel",vals)="-" d  ;
"RTN","SAMICTT3",40,0)
 . . . s @vals@("cepev")="e"
"RTN","SAMICTT3",41,0)
 . ;
"RTN","SAMICTT3",42,0)
 . if $$XVAL("cepev",vals)'="e" d  ;
"RTN","SAMICTT3",43,0)
 . . if $$XVAL("ceper",vals)'="-" d  ;
"RTN","SAMICTT3",44,0)
 . . . if $$XVAL("cepel",vals)'="-" d  ;
"RTN","SAMICTT3",45,0)
 . . . . if $$XVAL("cepel",vals)=$$XVAL("ceper",vals) d  ;
"RTN","SAMICTT3",46,0)
 . . . . . d OUT(sp1_"Bilateral "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusions. ") d OUT("")
"RTN","SAMICTT3",47,0)
 . . . . else  d  ;
"RTN","SAMICTT3",48,0)
 . . . . . d OUT(sp1_"Bilateral pleural effusions ; "_$$XSUB("cepe",vals,dict,"cepel")_" on left, and "_$$XSUB("cepe",vals,dict,"ceper")_" on right. ")
"RTN","SAMICTT3",49,0)
 . . . . . s pe=1
"RTN","SAMICTT3",50,0)
 . . . else  d  ;
"RTN","SAMICTT3",51,0)
 . . . . d OUT(sp1_"On right "_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion and on left "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion. ") d OUT("")
"RTN","SAMICTT3",52,0)
 . . . . s pe=1
"RTN","SAMICTT3",53,0)
 . . else  d  ;
"RTN","SAMICTT3",54,0)
 . . . d OUT(sp1_"On right "_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion and on left "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion. ") d OUT("")
"RTN","SAMICTT3",55,0)
 . . . s pe=1
"RTN","SAMICTT3",56,0)
 . ;
"RTN","SAMICTT3",57,0)
 i $$XVAL("cepev",vals)'="y" d  ; 
"RTN","SAMICTT3",58,0)
 . d OUT(sp1_"No pleural effusions. ") d OUT("")
"RTN","SAMICTT3",59,0)
 ;  if { $pe == 0 } {
"RTN","SAMICTT3",60,0)
 ;    puts "[tr "No pleural effusions"].${para}"
"RTN","SAMICTT3",61,0)
 ;  }
"RTN","SAMICTT3",62,0)
 ;  
"RTN","SAMICTT3",63,0)
 n yespp s yespp=0
"RTN","SAMICTT3",64,0)
 ;
"RTN","SAMICTT3",65,0)
 if $$XVAL("cebatr",vals)="y" d  ;
"RTN","SAMICTT3",66,0)
 . ;d OUT("Rounded atelectasis in the ")
"RTN","SAMICTT3",67,0)
 . d OUT(sp1_"Rounded atelectasis in the "_$$LOBESTR^SAMICTR2("cebatrl1^cebatrl2^cebatrl3^cebatrl4^cebatrl5",0)_". ") ;d OUT("")
"RTN","SAMICTT3",68,0)
 . s yespp=1
"RTN","SAMICTT3",69,0)
 ;
"RTN","SAMICTT3",70,0)
 if $$XVAL("cept",vals)="y" d  ;
"RTN","SAMICTT3",71,0)
 . s yespp=1
"RTN","SAMICTT3",72,0)
 . s numl=0
"RTN","SAMICTT3",73,0)
 . set str=sp1_"Pleural thickening/plaques in the "
"RTN","SAMICTT3",74,0)
 . if $$XVAL("ceptrt",vals)="r" d  ;
"RTN","SAMICTT3",75,0)
 . . s str=str_"right"
"RTN","SAMICTT3",76,0)
 . . s numl=numl+1
"RTN","SAMICTT3",77,0)
 . if $$XVAL("ceptlt",vals)="l" d  ;
"RTN","SAMICTT3",78,0)
 . . i numl>0 d  ;
"RTN","SAMICTT3",79,0)
 . . . s str=str_" and"
"RTN","SAMICTT3",80,0)
 . . s str=str_" left"
"RTN","SAMICTT3",81,0)
 . . s numl=numl+1
"RTN","SAMICTT3",82,0)
 . ;if numl>1 d  ;
"RTN","SAMICTT3",83,0)
 . ;. s str=str_" lungs. "
"RTN","SAMICTT3",84,0)
 . ;else  d  ;
"RTN","SAMICTT3",85,0)
 . ;. s str=str_" lung. "
"RTN","SAMICTT3",86,0)
 . s str=str_". "
"RTN","SAMICTT3",87,0)
 . if numl=0 set str=sp1_"Pleural thickening/plaques. "
"RTN","SAMICTT3",88,0)
 . d OUT(str) ;d OUT("")
"RTN","SAMICTT3",89,0)
 ;
"RTN","SAMICTT3",90,0)
 if $$XVAL("cepu",vals)="y" d  ;
"RTN","SAMICTT3",91,0)
 . s yespp=1
"RTN","SAMICTT3",92,0)
 . if $l($$XVAL("cepus",vals))'=0 d  ;
"RTN","SAMICTT3",93,0)
 . . d OUT(sp1_"Pleural rumor: "_$$XVAL("cepus",vals)) 
"RTN","SAMICTT3",94,0)
 . e  d OUT(sp1_"Pleural tumor. ")
"RTN","SAMICTT3",95,0)
 . ;d OUT("")
"RTN","SAMICTT3",96,0)
 ;
"RTN","SAMICTT3",97,0)
 i yespp=0 d OUT("")
"RTN","SAMICTT3",98,0)
 ;
"RTN","SAMICTT3",99,0)
 d  ;
"RTN","SAMICTT3",100,0)
 . if $$XVAL("ceoppab",vals)'="" d OUT(sp1_$$XVAL("ceoppab",vals)_". ") ;d OUT("")
"RTN","SAMICTT3",101,0)
 . else  d
"RTN","SAMICTT3",102,0)
 . . if yespp=1 d OUT("")
"RTN","SAMICTT3",103,0)
 ;
"RTN","SAMICTT3",104,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT3",105,0)
 ;
"RTN","SAMICTT3",106,0)
 s outmode="hold"
"RTN","SAMICTT3",107,0)
 d OUT("Coronary Artery Calcifications: ")
"RTN","SAMICTT3",108,0)
 ;# Coronary Calcification
"RTN","SAMICTT3",109,0)
 n vcac,cac,cacrec
"RTN","SAMICTT3",110,0)
 s (cac,cacrec)=""
"RTN","SAMICTT3",111,0)
 ;
"RTN","SAMICTT3",112,0)
 if $$XVAL("cecccac",vals)'="" d  ;
"RTN","SAMICTT3",113,0)
 . s @vals@("ceccv")="e"
"RTN","SAMICTT3",114,0)
 ;
"RTN","SAMICTT3",115,0)
 d  if $$XVAL("ceccv",vals)'="n" d  ;
"RTN","SAMICTT3",116,0)
 . set vcac=$$XVAL("cecccac",vals)
"RTN","SAMICTT3",117,0)
 . if vcac'="" d  ;
"RTN","SAMICTT3",118,0)
 . . s cacrec=""
"RTN","SAMICTT3",119,0)
 . . s cac="The Visual Coronary Artery Calcium (CAC) Score is "_vcac_". "
"RTN","SAMICTT3",120,0)
 . . s cacval=vcac
"RTN","SAMICTT3",121,0)
 . . i cacval>3 s cacrec=$g(@dict@("CAC_recommendation"))
"RTN","SAMICTT3",122,0)
 ;
"RTN","SAMICTT3",123,0)
 ;
"RTN","SAMICTT3",124,0)
 ;n samicac s samicac=0
"RTN","SAMICTT3",125,0)
 ;i $$XVAL("cecclm",vals)'="no" s samicac=1
"RTN","SAMICTT3",126,0)
 ;i $$XVAL("ceccld",vals)'="no" s samicac=1
"RTN","SAMICTT3",127,0)
 ;;i $$XVAL("cecclf",vals)'="no" s samicac=1
"RTN","SAMICTT3",128,0)
 ;i $$XVAL("cecccf",vals)'="no" s samicac=1
"RTN","SAMICTT3",129,0)
 ;i $$XVAL("ceccrc",vals)'="no" s samicac=1
"RTN","SAMICTT3",130,0)
 ;
"RTN","SAMICTT3",131,0)
 ;;s outmode="hold" s line=""
"RTN","SAMICTT3",132,0)
 ;i samicac=1 d  ;
"RTN","SAMICTT3",133,0)
 i $g(@vals@("cecclm"))="-" s @vals@("cecclm")="no"
"RTN","SAMICTT3",134,0)
 i $g(@vals@("ceccld"))="-" s @vals@("ceccld")="no"
"RTN","SAMICTT3",135,0)
 i $g(@vals@("cecclf"))="-" s @vals@("cecccf")="no"
"RTN","SAMICTT3",136,0)
 i $g(@vals@("ceccrc"))="-" s @vals@("ceccrc")="no"
"RTN","SAMICTT3",137,0)
 i $g(@vals@("cecclm"))="" s @vals@("cecclm")="no"
"RTN","SAMICTT3",138,0)
 i $g(@vals@("ceccld"))="" s @vals@("ceccld")="no"
"RTN","SAMICTT3",139,0)
 i $g(@vals@("cecclf"))="" s @vals@("cecccf")="no"
"RTN","SAMICTT3",140,0)
 i $g(@vals@("ceccrc"))="" s @vals@("ceccrc")="no"
"RTN","SAMICTT3",141,0)
 ;
"RTN","SAMICTT3",142,0)
 d  ;
"RTN","SAMICTT3",143,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecclm")_" in left main, ")
"RTN","SAMICTT3",144,0)
 . d OUT($$XSUB("cecc",vals,dict,"ceccld")_" in left anterior descending, ")
"RTN","SAMICTT3",145,0)
 . ;d OUT($$XSUB("cecc",vals,dict,"cecclf")_" in circumflex, and ")
"RTN","SAMICTT3",146,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecccf")_" in circumflex, and ")
"RTN","SAMICTT3",147,0)
 . d OUT($$XSUB("cecc",vals,dict,"ceccrc")_" in right coronary. "_cac)
"RTN","SAMICTT3",148,0)
 . s outmode="go"
"RTN","SAMICTT3",149,0)
 . d OUT("")
"RTN","SAMICTT3",150,0)
 ; 
"RTN","SAMICTT3",151,0)
 s outmode="hold"
"RTN","SAMICTT3",152,0)
 if $$XVAL("cecca",vals)'="-" d  ;
"RTN","SAMICTT3",153,0)
 . d HOUT("Aortic Calcifications: ")
"RTN","SAMICTT3",154,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecca"))
"RTN","SAMICTT3",155,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",156,0)
 ;
"RTN","SAMICTT3",157,0)
 s outmode="hold"
"RTN","SAMICTT3",158,0)
 n ocf s ocf=0
"RTN","SAMICTT3",159,0)
 d HOUT("Other Cardiac Findings: ")
"RTN","SAMICTT3",160,0)
 ;d HOUT("Other Cardiac Findings: ")
"RTN","SAMICTT3",161,0)
 ;
"RTN","SAMICTT3",162,0)
 ;s outmode="hold"
"RTN","SAMICTT3",163,0)
 ;# Pericardial Effusion
"RTN","SAMICTT3",164,0)
 if $$XVAL("ceprevm",vals)'="-" d  ;
"RTN","SAMICTT3",165,0)
 . if $$XVAL("ceprevm",vals)'="no" d  ;
"RTN","SAMICTT3",166,0)
 . . if $$XVAL("ceprevm",vals)'="" d
"RTN","SAMICTT3",167,0)
 . . . d OUT("A "_$$XSUB("ceprevm",vals,dict,"ceprevm")_" pericardial effusion"_". ") d OUT("")
"RTN","SAMICTT3",168,0)
 . . . s pe=1 s ocf=1
"RTN","SAMICTT3",169,0)
 . . else  d OUT("No pericardial effusion. ") d OUT("")
"RTN","SAMICTT3",170,0)
 ;
"RTN","SAMICTT3",171,0)
 ;
"RTN","SAMICTT3",172,0)
 ;;# Pulmonary and Aortic Diameter
"RTN","SAMICTT3",173,0)
 i $$XVAL("cepaw",vals)'="" d  ;
"RTN","SAMICTT3",174,0)
 . d OUT("Widest main pulmonary artery diameter is "_$$XVAL("cepaw",vals)_" mm. ")
"RTN","SAMICTT3",175,0)
 . if $$XVAL("ceaow",vals)'="" d  ;
"RTN","SAMICTT3",176,0)
 . . d OUT("Widest ascending aortic diameter at the same level is "_$$XVAL("ceaow",vals)_" mm. ")
"RTN","SAMICTT3",177,0)
 . . if $$XVAL("cepar",vals)'="" d  ;
"RTN","SAMICTT3",178,0)
 . . . d OUT("The ratio is "_$$XVAL("cepar",vals)_". ")
"RTN","SAMICTT3",179,0)
 . d OUT("") s ocf=1
"RTN","SAMICTT3",180,0)
 ;
"RTN","SAMICTT3",181,0)
 ; #"Additional Comments on Cardiac Abnormalities:"
"RTN","SAMICTT3",182,0)
 if $$XVAL("cecommca",vals)'="" d  ;
"RTN","SAMICTT3",183,0)
 . d OUT($$XVAL("cecommca",vals)_". ")
"RTN","SAMICTT3",184,0)
 . s ocf=1
"RTN","SAMICTT3",185,0)
 i ocf=0 d OUT("None. ")
"RTN","SAMICTT3",186,0)
 s outmode="go"
"RTN","SAMICTT3",187,0)
 d OUT("")
"RTN","SAMICTT3",188,0)
 ;
"RTN","SAMICTT3",189,0)
 ;
"RTN","SAMICTT3",190,0)
 s outmode="hold"
"RTN","SAMICTT3",191,0)
 d HOUT("Mediastinum: ")
"RTN","SAMICTT3",192,0)
 n yesmm s yesmm=0
"RTN","SAMICTT3",193,0)
 n abn
"RTN","SAMICTT3",194,0)
 i ($$XVAL("ceoma",vals)="y")&($$XVAL("ceata",vals)="y") d  ;
"RTN","SAMICTT3",195,0)
 . s yeamm=1
"RTN","SAMICTT3",196,0)
 . s abn=$$CCMSTR("ceatc^ceaty^ceatm",vals)
"RTN","SAMICTT3",197,0)
 . ;d OUT("[abn="_abn_"]")
"RTN","SAMICTT3",198,0)
 . i abn="" d OUT(sp1_"Noted in the thyroid. ")
"RTN","SAMICTT3",199,0)
 . i abn'="" d OUT(sp1_abn_" thyroid. ")
"RTN","SAMICTT3",200,0)
 . i $$XVAL("ceato",vals)="o" d OUT(sp1_$$XVAL("ceatos",vals)_"<br>")
"RTN","SAMICTT3",201,0)
 i $$XVAL("ceaya",vals)="y" d  ;
"RTN","SAMICTT3",202,0)
 . s yesmm=1
"RTN","SAMICTT3",203,0)
 . s abn=$$CCMSTR("ceayc^ceayy^ceaym",vals)
"RTN","SAMICTT3",204,0)
 . i abn="" d OUT(sp1_"Noted in the thymus")
"RTN","SAMICTT3",205,0)
 . i abn'="" d OUT(sp1_abn_" thymus. ")
"RTN","SAMICTT3",206,0)
 . i $$XVAL("ceayo",vals)="o" d OUT(sp1_$$XVAL("ceayos",vals))
"RTN","SAMICTT3",207,0)
 ;
"RTN","SAMICTT3",208,0)
 ;   # Non-calcified lymph nodes
"RTN","SAMICTT3",209,0)
 n lnlist,lnlistt
"RTN","SAMICTT3",210,0)
 set lnlist(1)="cemlnl1"
"RTN","SAMICTT3",211,0)
 set lnlist(2)="cemlnl2r"
"RTN","SAMICTT3",212,0)
 set lnlist(3)="cemlnl2l"
"RTN","SAMICTT3",213,0)
 set lnlist(4)="cemlnl3"
"RTN","SAMICTT3",214,0)
 set lnlist(5)="cemlnl4r"
"RTN","SAMICTT3",215,0)
 set lnlist(6)="cemlnl4l"
"RTN","SAMICTT3",216,0)
 set lnlist(7)="cemlnl5"
"RTN","SAMICTT3",217,0)
 set lnlist(8)="cemlnl6"
"RTN","SAMICTT3",218,0)
 set lnlist(9)="cemlnl7"
"RTN","SAMICTT3",219,0)
 set lnlist(10)="cemlnl8"
"RTN","SAMICTT3",220,0)
 set lnlist(11)="cemlnl9"
"RTN","SAMICTT3",221,0)
 set lnlist(12)="cemlnl10r"
"RTN","SAMICTT3",222,0)
 set lnlist(13)="cemlnl10l"
"RTN","SAMICTT3",223,0)
 ;
"RTN","SAMICTT3",224,0)
 set lnlistt(1)="high mediastinal"
"RTN","SAMICTT3",225,0)
 set lnlistt(2)="right upper paratracheal"
"RTN","SAMICTT3",226,0)
 set lnlistt(3)="left upper paratracheal"
"RTN","SAMICTT3",227,0)
 set lnlistt(4)="prevascular/retrotracheal"
"RTN","SAMICTT3",228,0)
 set lnlistt(5)="right lower paratracheal"
"RTN","SAMICTT3",229,0)
 set lnlistt(6)="left lower paratracheal"
"RTN","SAMICTT3",230,0)
 set lnlistt(7)="sub-aortic (A-P window)"
"RTN","SAMICTT3",231,0)
 set lnlistt(8)="para-aortic"
"RTN","SAMICTT3",232,0)
 set lnlistt(9)="subcarinal"
"RTN","SAMICTT3",233,0)
 set lnlistt(10)="para-esophageal"
"RTN","SAMICTT3",234,0)
 set lnlistt(11)="pulmonary ligament"
"RTN","SAMICTT3",235,0)
 set lnlistt(12)="right hilar"
"RTN","SAMICTT3",236,0)
 set lnlistt(13)="left hilar"
"RTN","SAMICTT3",237,0)
 ;
"RTN","SAMICTT3",238,0)
 ;
"RTN","SAMICTT3",239,0)
 ;s outmode="hold"
"RTN","SAMICTT3",240,0)
 if $$XVAL("cemln",vals)="y" d  ;
"RTN","SAMICTT3",241,0)
 . s yesmm=1
"RTN","SAMICTT3",242,0)
 . n llist,item
"RTN","SAMICTT3",243,0)
 . s (llist,item)=""
"RTN","SAMICTT3",244,0)
 . f  s item=$o(lnlist(item)) q:item=""  d  ;
"RTN","SAMICTT3",245,0)
 . . i $$XVAL(lnlist(item),vals)'="" s llist($o(llist(""),-1)+1)=lnlist(item)
"RTN","SAMICTT3",246,0)
 . n lnum,slnum
"RTN","SAMICTT3",247,0)
 . s lnum=$o(llist(""),-1)
"RTN","SAMICTT3",248,0)
 . i lnum=0 d OUT("Enlarged or growing lymph nodes are noted. ")
"RTN","SAMICTT3",249,0)
 . i lnum>0 d  ;
"RTN","SAMICTT3",250,0)
 . . s slnum=lnum
"RTN","SAMICTT3",251,0)
 . . d OUT("Enlarged or growing lymph nodes in the ")
"RTN","SAMICTT3",252,0)
 . . s item=""
"RTN","SAMICTT3",253,0)
 . . f  s item=$o(llist(item)) q:item=""  d  ;
"RTN","SAMICTT3",254,0)
 . . . d OUT(lnlistt(item))
"RTN","SAMICTT3",255,0)
 . . . i lnum>2 d OUT(", ")
"RTN","SAMICTT3",256,0)
 . . . i lnum=2 d OUT(" and ")
"RTN","SAMICTT3",257,0)
 . . . s lnum=lnum-1
"RTN","SAMICTT3",258,0)
 . . i slnum>1 d OUT(" locations. ")
"RTN","SAMICTT3",259,0)
 . . i slnum=1 d OUT(" location. ")
"RTN","SAMICTT3",260,0)
 ;
"RTN","SAMICTT3",261,0)
 ;s outmode="go"
"RTN","SAMICTT3",262,0)
 ;d OUT("")
"RTN","SAMICTT3",263,0)
 ;
"RTN","SAMICTT3",264,0)
 if $$XVAL("cemlncab",vals)="y" d  ;
"RTN","SAMICTT3",265,0)
 . set yesmm=1
"RTN","SAMICTT3",266,0)
 . d OUT("Calcified lymph nodes present. ")
"RTN","SAMICTT3",267,0)
 ;
"RTN","SAMICTT3",268,0)
 if $$XVAL("ceagaln",vals)="y" d  ;
"RTN","SAMICTT3",269,0)
 . set yesmm=1
"RTN","SAMICTT3",270,0)
 . d OUT("Enlarged or growing axillary lymph nodes without central fat are seen. ")
"RTN","SAMICTT3",271,0)
 . d OUT($$XVAL("ceagalns",vals))
"RTN","SAMICTT3",272,0)
 ;
"RTN","SAMICTT3",273,0)
 if $$XVAL("cemva",vals)="y" d  ;
"RTN","SAMICTT3",274,0)
 . set yesmm=1
"RTN","SAMICTT3",275,0)
 . if $$XVAL("cemvaa",vals)="a" d  ;
"RTN","SAMICTT3",276,0)
 . . d OUT("Other vascular abnormalities are seen in the aorta. ")
"RTN","SAMICTT3",277,0)
 . if $$XVAL("cemvaa",vals)="w" d  ;
"RTN","SAMICTT3",278,0)
 . . d OUT("Other vascular abnormalities are seen in the pulmonary series. ")
"RTN","SAMICTT3",279,0)
 . d OUT($$XVAL("cemvaos",vals)_"<br>")
"RTN","SAMICTT3",280,0)
 ;
"RTN","SAMICTT3",281,0)
 ;s outmode="hold"
"RTN","SAMICTT3",282,0)
 ;   # Esophageal
"RTN","SAMICTT3",283,0)
 if $$XVAL("cemeln",vals)="y" d  ;
"RTN","SAMICTT3",284,0)
 . set yesmm=1
"RTN","SAMICTT3",285,0)
 . n elist s elist=""
"RTN","SAMICTT3",286,0)
 . set numl=0
"RTN","SAMICTT3",287,0)
 . if $$XVAL("cemelna",vals)="a" d  ;
"RTN","SAMICTT3",288,0)
 . . s elist($o(elist(""),-1)+1)="Air-fluid level"
"RTN","SAMICTT3",289,0)
 . . s numl=numl+1
"RTN","SAMICTT3",290,0)
 . if $$XVAL("cemelnw",vals)="w" d  ;
"RTN","SAMICTT3",291,0)
 . . s elist($o(elist(""),-1)+1)="Wall thickening"
"RTN","SAMICTT3",292,0)
 . . s numl=numl+1
"RTN","SAMICTT3",293,0)
 . if $$XVAL("cemelnm",vals)="m" d  ;
"RTN","SAMICTT3",294,0)
 . . s elist($o(elist(""),-1)+1)="A mass"
"RTN","SAMICTT3",295,0)
 . . s numl=numl+1
"RTN","SAMICTT3",296,0)
 . if numl=0 d OUT("Esophageal abnormality noted. ")
"RTN","SAMICTT3",297,0)
 . e  d  ;
"RTN","SAMICTT3",298,0)
 . . d OUT($g(elist(1)))
"RTN","SAMICTT3",299,0)
 . . if numl=1 d OUT(" is ")
"RTN","SAMICTT3",300,0)
 . . e  d  ;
"RTN","SAMICTT3",301,0)
 . . . if numl=2 d  ;
"RTN","SAMICTT3",302,0)
 . . . . d OUT(" and ")
"RTN","SAMICTT3",303,0)
 . . . e  d OUT(", ")
"RTN","SAMICTT3",304,0)
 . . . d OUT($$LOWC($g(elist(2))))
"RTN","SAMICTT3",305,0)
 . . . if numl=3 d  ;
"RTN","SAMICTT3",306,0)
 . . . . d OUT(", and "_$$LOWC($g(elist(3))))
"RTN","SAMICTT3",307,0)
 . . d OUT("seen in the esophagus. ")
"RTN","SAMICTT3",308,0)
 . d OUT($$XVAL("cemelnos",vals))
"RTN","SAMICTT3",309,0)
 ;s outmode="go"
"RTN","SAMICTT3",310,0)
 ;d OUT("")
"RTN","SAMICTT3",311,0)
 ;
"RTN","SAMICTT3",312,0)
 ;
"RTN","SAMICTT3",313,0)
 if $$XVAL("cehhn",vals)="y" d  ;
"RTN","SAMICTT3",314,0)
 . set yesmm=1
"RTN","SAMICTT3",315,0)
 . if $$XVAL("cehhnos",vals)'="" d OUT("Hiatal hernia: "_$$XVAL("cehhnos",vals))
"RTN","SAMICTT3",316,0)
 . if $$XVAL("cehhnos",vals)="" d OUT("Hiatal hernia. ")
"RTN","SAMICTT3",317,0)
 . d OUT("")
"RTN","SAMICTT3",318,0)
 ;
"RTN","SAMICTT3",319,0)
 if $$XVAL("ceomm",vals)="y" d  ;
"RTN","SAMICTT3",320,0)
 . set yesmm=1
"RTN","SAMICTT3",321,0)
 . n tval
"RTN","SAMICTT3",322,0)
 . set tval=$$XVAL("ceommos",vals)
"RTN","SAMICTT3",323,0)
 . set abn=$$CCMSTR("ceamc^ceamy^ceamm",vals)
"RTN","SAMICTT3",324,0)
 . if abn="" d OUT(sp1_"Abnormality noted in the mediastinum. ")
"RTN","SAMICTT3",325,0)
 . e  d OUT(sp1_abn_" mediastinum. ")
"RTN","SAMICTT3",326,0)
 . d OUT(tval)
"RTN","SAMICTT3",327,0)
 ;i yesmm=0 d OUT(sp1_"No abnormalities. ")
"RTN","SAMICTT3",328,0)
 i yesmm=0 d OUT(sp1_"Unremarkable. ")
"RTN","SAMICTT3",329,0)
 i $$XVAL("ceotabnm",vals)'="" d  ;
"RTN","SAMICTT3",330,0)
 . d OUT(sp1_$$XVAL("ceotabnm",vals)_". ")
"RTN","SAMICTT3",331,0)
 s outmode="go"
"RTN","SAMICTT3",332,0)
 d OUT("")
"RTN","SAMICTT3",333,0)
 ;
"RTN","SAMICTT3",334,0)
 ;
"RTN","SAMICTT3",335,0)
 q
"RTN","SAMICTT3",336,0)
 ;
"RTN","SAMICTT3",337,0)
 ;
"RTN","SAMICTT3",338,0)
CCMSTR(lst,vals) ; extrinsic that forms phrases
"RTN","SAMICTT3",339,0)
 n retstr s retstr=""
"RTN","SAMICTT3",340,0)
 n lblist s lblist=""
"RTN","SAMICTT3",341,0)
 n lb,ib s ib=""
"RTN","SAMICTT3",342,0)
 f lb=1:1:$l(lst,"^") d  ;
"RTN","SAMICTT3",343,0)
 . n lvar s lvar=$p(lst,"^",lb)
"RTN","SAMICTT3",344,0)
 . s ib=$$XVAL($p(lst,"^",lb),vals)
"RTN","SAMICTT3",345,0)
 . if ib'="" d  ;
"RTN","SAMICTT3",346,0)
 . . i ib="y" d  ; 
"RTN","SAMICTT3",347,0)
 . . . i $f("ceasc cealc ceapc ceapc ceaac ceakc",lvar)>0 s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",348,0)
 . . . ;i "ceasc cealc ceapc ceapc ceaac ceakc"[lb s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",349,0)
 . . . else  s lblist($o(lblist(""),-1)+1)="Cyst"
"RTN","SAMICTT3",350,0)
 . . i ib="c" s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",351,0)
 . . i ib="m" s lblist($o(lblist(""),-1)+1)="Mass"
"RTN","SAMICTT3",352,0)
 i $o(lblist(""),-1)=1 s retstr=retstr_lblist(1)_" is seen in the"
"RTN","SAMICTT3",353,0)
 e  i $o(lblist(""),-1)=2 s retstr=retstr_lblist(1)_" and "_$$LOWC(lblist(2))_" are seen in the"
"RTN","SAMICTT3",354,0)
 e  i $o(lblist(""),-1)=3 s retstr=retstr_"Calicification, cyst, and mass are seen in the"
"RTN","SAMICTT3",355,0)
 q retstr
"RTN","SAMICTT3",356,0)
 ;
"RTN","SAMICTT3",357,0)
LOWC(X) ;  CONVERT X TO LOWERCASE
"RTN","SAMICTT3",358,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","SAMICTT3",359,0)
 ;
"RTN","SAMICTT3",360,0)
OUT(ln) ;
"RTN","SAMICTT3",361,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT3",362,0)
 s cnt=cnt+1
"RTN","SAMICTT3",363,0)
 n lnn
"RTN","SAMICTT3",364,0)
 ;s debug=1
"RTN","SAMICTT3",365,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",366,0)
 i outmode="go" d  ;
"RTN","SAMICTT3",367,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT3",368,0)
 . s line=""
"RTN","SAMICTT3",369,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",370,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT3",371,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT3",372,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT3",373,0)
 . n zs s zs=$STACK
"RTN","SAMICTT3",374,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT3",375,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT3",376,0)
 q
"RTN","SAMICTT3",377,0)
 ;
"RTN","SAMICTT3",378,0)
OUTOLD(ln) ;
"RTN","SAMICTT3",379,0)
 s cnt=cnt+1
"RTN","SAMICTT3",380,0)
 n lnn
"RTN","SAMICTT3",381,0)
 ;s debug=1
"RTN","SAMICTT3",382,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",383,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT3",384,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT3",385,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT3",386,0)
 . n zs s zs=$STACK
"RTN","SAMICTT3",387,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT3",388,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT3",389,0)
 q
"RTN","SAMICTT3",390,0)
 ;
"RTN","SAMICTT3",391,0)
HOUT(ln) ;
"RTN","SAMICTT3",392,0)
 D OUT(ln)
"RTN","SAMICTT3",393,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT3",394,0)
 q
"RTN","SAMICTT3",395,0)
 ;
"RTN","SAMICTT3",396,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT3",397,0)
 ; vals is passed by name
"RTN","SAMICTT3",398,0)
 n zr
"RTN","SAMICTT3",399,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT3",400,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT3",401,0)
 q zr
"RTN","SAMICTT3",402,0)
 ;
"RTN","SAMICTT3",403,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT3",404,0)
 ; vals and dict are passed by name
"RTN","SAMICTT3",405,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT3",406,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT3",407,0)
 n zr,zv,zdx
"RTN","SAMICTT3",408,0)
 s zdx=$g(valdx)
"RTN","SAMICTT3",409,0)
 i zdx="" s zdx=var
"RTN","SAMICTT3",410,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT3",411,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT3",412,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT3",413,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT3",414,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT3",415,0)
 q zr
"RTN","SAMICTT3",416,0)
 ;
"RTN","SAMICTT4")
0^5^B36692733
"RTN","SAMICTT4",1,0)
SAMICTT4 ;ven/gpl - ielcap: forms ; 3/19/19 1:27pm
"RTN","SAMICTT4",2,0)
 ;;18.0;SAMI;;;Build 2
"RTN","SAMICTT4",3,0)
 ;
"RTN","SAMICTT4",4,0)
 ;
"RTN","SAMICTT4",5,0)
 quit  ; no entry from top
"RTN","SAMICTT4",6,0)
 ;
"RTN","SAMICTT4",7,0)
BREAST(rtn,vals,dict) ;
"RTN","SAMICTT4",8,0)
 ; repgen6
"RTN","SAMICTT4",9,0)
 n sp1 s sp1="  "
"RTN","SAMICTT4",10,0)
 n outmode s outmode="hold"
"RTN","SAMICTT4",11,0)
 n line s line=""
"RTN","SAMICTT4",12,0)
 n destr s destr="is seen"
"RTN","SAMICTT4",13,0)
 n sba set sba=0
"RTN","SAMICTT4",14,0)
 ;   # Breast Abnormalities
"RTN","SAMICTT4",15,0)
 n bd,brt,blt
"RTN","SAMICTT4",16,0)
 s (bd,brt,blt)=0
"RTN","SAMICTT4",17,0)
 if $$XVAL("ceobard",vals)'="-" s brt=$$XVAL("ceobard",vals)
"RTN","SAMICTT4",18,0)
 if $$XVAL("ceobald",vals)'="-" s brt=$$XVAL("ceobald",vals)
"RTN","SAMICTT4",19,0)
 if (blt'=0)!(brt'=0) d  ;
"RTN","SAMICTT4",20,0)
 . d OUT("Breast:")
"RTN","SAMICTT4",21,0)
 . s bd=1
"RTN","SAMICTT4",22,0)
 s outmode="hold"
"RTN","SAMICTT4",23,0)
 if $$XVAL("ceara",vals)="y" d  ; our substitute for ceoba, which is null
"RTN","SAMICTT4",24,0)
 . if bd=0 d OUT("Breast:")
"RTN","SAMICTT4",25,0)
 . if $$XVAL("ceara",vals)="y" d  ;
"RTN","SAMICTT4",26,0)
 . . set sba=1
"RTN","SAMICTT4",27,0)
 . . n br
"RTN","SAMICTT4",28,0)
 . . set br=$$CCMSTR^SAMICTR3("ceobarc^ceobary^ceobarm",vals)
"RTN","SAMICTT4",29,0)
 . . if br="" d OUT("Noted in right breast: ")
"RTN","SAMICTT4",30,0)
 . . if br'="" d OUT(br_" right breast. ")
"RTN","SAMICTT4",31,0)
 . . d OUT($$XVAL("ceobaros",vals))
"RTN","SAMICTT4",32,0)
 if $$XVAL("ceafa",vals)="y" d  ; our substitute for ceoba, which is null
"RTN","SAMICTT4",33,0)
 . if bd=0 d OUT("Breast:")
"RTN","SAMICTT4",34,0)
 . if $$XVAL("ceafa",vals)="y" d  ;
"RTN","SAMICTT4",35,0)
 . . set sba=1
"RTN","SAMICTT4",36,0)
 . . n br
"RTN","SAMICTT4",37,0)
 . . set br=$$CCMSTR^SAMICTR3("ceobafc^ceobafy^ceobafm",vals)
"RTN","SAMICTT4",38,0)
 . . if br="" d OUT("Noted in left breast: ")
"RTN","SAMICTT4",39,0)
 . . if br'="" d OUT(br_" left breast. ")
"RTN","SAMICTT4",40,0)
 . . d OUT($$XVAL("ceobafos",vals))
"RTN","SAMICTT4",41,0)
 if bd=1 d  ;
"RTN","SAMICTT4",42,0)
 . if blt=brt d OUT("Density: "_$$XSUB("ceobad",vals,dict,"ceobald"))
"RTN","SAMICTT4",43,0)
 . else  d OUT("Density: Left "_$$XSUB("ceobad",vals,dict,"ceobald")_", Right "_$$XSUB("ceobad",vals,dict,"ceobard")_". ")
"RTN","SAMICTT4",44,0)
 if $$XVAL("ceobrc",vals)'="" d OUT($$XVAL("ceobrc",vals))
"RTN","SAMICTT4",45,0)
 else  if sba=1 d OUT("")
"RTN","SAMICTT4",46,0)
 s outmode="go"
"RTN","SAMICTT4",47,0)
 d OUT("")
"RTN","SAMICTT4",48,0)
 ;
"RTN","SAMICTT4",49,0)
 ;
"RTN","SAMICTT4",50,0)
 s outmode="hold"
"RTN","SAMICTT4",51,0)
 d OUT("Abdomen: ")
"RTN","SAMICTT4",52,0)
 n yesaa s yesaa=0
"RTN","SAMICTT4",53,0)
 ;  # Special Handling for the gallbladder
"RTN","SAMICTT4",54,0)
 ;
"RTN","SAMICTT4",55,0)
 if $$XVAL("ceaga",vals)="y" d  ;
"RTN","SAMICTT4",56,0)
 . d OUT(sp1_"Limited view of the upper abdomen reveals the following: ")
"RTN","SAMICTT4",57,0)
 . set yesaa=1
"RTN","SAMICTT4",58,0)
 . if $$XVAL("ceagh",vals)="h" d  ;
"RTN","SAMICTT4",59,0)
 . . d OUT(sp1_"status post cholecystectomy. ")
"RTN","SAMICTT4",60,0)
 . if $$XVAL("ceags",vals)="s" d  ;
"RTN","SAMICTT4",61,0)
 . . d OUT(sp1_"Gallstones are noted. ")
"RTN","SAMICTT4",62,0)
 . if $$XVAL("ceagl",vals)="l" d  ;
"RTN","SAMICTT4",63,0)
 . . d OUT(sp1_"Sludge is seen in the gall bladder. ")
"RTN","SAMICTT4",64,0)
 . if $$XVAL("ceago",vals)="y" d  ;
"RTN","SAMICTT4",65,0)
 . . d OUT(sp1_"An abnormality was noted in the gall bladder: ")
"RTN","SAMICTT4",66,0)
 if $$XVAL("ceagos",vals)'="" d  ;
"RTN","SAMICTT4",67,0)
 . d OUT($$XVAL("ceagos",vals))
"RTN","SAMICTT4",68,0)
 ;
"RTN","SAMICTT4",69,0)
 n aalist
"RTN","SAMICTT4",70,0)
 s aalist(1,"spleen",0)=$$XVAL("ceasa",vals)
"RTN","SAMICTT4",71,0)
 s aalist(1,"spleen",1)="ceasc^ceasy^ceasm"
"RTN","SAMICTT4",72,0)
 s aalist(1,"spleen",2)=$$XVAL("ceasos",vals)
"RTN","SAMICTT4",73,0)
 s aalist(2,"liver",0)=$$XVAL("ceala",vals)
"RTN","SAMICTT4",74,0)
 s aalist(2,"liver",1)="cealc^cealy^cealm"
"RTN","SAMICTT4",75,0)
 s aalist(2,"liver",2)=$$XVAL("cealos",vals)
"RTN","SAMICTT4",76,0)
 s aalist(3,"pancreas",0)=$$XVAL("ceapa",vals)
"RTN","SAMICTT4",77,0)
 s aalist(3,"pancreas",1)="ceapc^ceapy^ceapm"
"RTN","SAMICTT4",78,0)
 s aalist(3,"pancreas",2)=$$XVAL("ceapos",vals)
"RTN","SAMICTT4",79,0)
 s aalist(4,"adrenals",0)=$$XVAL("ceaaa",vals)
"RTN","SAMICTT4",80,0)
 s aalist(4,"adrenals",1)="ceaac^ceaay^ceaam"
"RTN","SAMICTT4",81,0)
 s aalist(4,"adrenals",2)=$$XVAL("ceaaos",vals)
"RTN","SAMICTT4",82,0)
 s aalist(5,"kidneys",0)=$$XVAL("ceaka",vals)
"RTN","SAMICTT4",83,0)
 s aalist(5,"kidneys",1)="ceakc^ceaky^ceakm"
"RTN","SAMICTT4",84,0)
 s aalist(5,"kidneys",2)=$$XVAL("ceakos",vals)
"RTN","SAMICTT4",85,0)
 ;
"RTN","SAMICTT4",86,0)
 n zan,zaa s zaa=""
"RTN","SAMICTT4",87,0)
 f zan=1:1:5  d  ;
"RTN","SAMICTT4",88,0)
 . s zaa=$o(aalist(zan,""))
"RTN","SAMICTT4",89,0)
 . if aalist(zan,zaa,0)="y" d  ;
"RTN","SAMICTT4",90,0)
 . . n zout
"RTN","SAMICTT4",91,0)
 . . s zout=$$CCMSTR^SAMICTR3(aalist(zan,zaa,1),vals)
"RTN","SAMICTT4",92,0)
 . . set yesaa=1
"RTN","SAMICTT4",93,0)
 . . if zout="" d  ;
"RTN","SAMICTT4",94,0)
 . . . ;d OUT(aalist(zan,zaa,2))
"RTN","SAMICTT4",95,0)
 . . . if aalist(zan,zaa,2)'="" d OUT(aalist(zan,zaa,2))
"RTN","SAMICTT4",96,0)
 . . if zout'="" d  ;
"RTN","SAMICTT4",97,0)
 . . . d OUT(sp1_"A "_$$LOWC^SAMICTR3(zout)_" "_zaa_". "_aalist(zan,zaa,2))
"RTN","SAMICTT4",98,0)
 ;
"RTN","SAMICTT4",99,0)
 ;# Other Abdominal Abnormalities
"RTN","SAMICTT4",100,0)
 ;
"RTN","SAMICTT4",101,0)
 if $$XVAL("ceaoab",vals)'="" d  ;
"RTN","SAMICTT4",102,0)
 . d OUT($$XVAL("ceaoab",vals)_". ")
"RTN","SAMICTT4",103,0)
 if yesaa=0  d  ;
"RTN","SAMICTT4",104,0)
 . ;d OUT(sp1_"Limited view of the upper abdomen reveals no abnormalities. ")
"RTN","SAMICTT4",105,0)
 . d OUT(sp1_"Limited view of the upper abdomen reveals nothing remarkable. ")
"RTN","SAMICTT4",106,0)
 ;
"RTN","SAMICTT4",107,0)
 ;
"RTN","SAMICTT4",108,0)
 ;# Other Chest Abnormalities
"RTN","SAMICTT4",109,0)
 ;
"RTN","SAMICTT4",110,0)
 if $$XVAL("ceotab",vals)'="" d
"RTN","SAMICTT4",111,0)
 . d OUT("Other chest abnormalities:")
"RTN","SAMICTT4",112,0)
 . d OUT($$XVAL("ceotab",vals)_". ")
"RTN","SAMICTT4",113,0)
 ;
"RTN","SAMICTT4",114,0)
 s outmode="go"
"RTN","SAMICTT4",115,0)
 d OUT("")
"RTN","SAMICTT4",116,0)
 ;
"RTN","SAMICTT4",117,0)
 ;# Bone Abnormalities
"RTN","SAMICTT4",118,0)
 ;
"RTN","SAMICTT4",119,0)
 s outmode="hold"
"RTN","SAMICTT4",120,0)
 if $$XVAL("ceaoabb",vals)'="" d  ;
"RTN","SAMICTT4",121,0)
 . d OUT("Bone:")
"RTN","SAMICTT4",122,0)
 . d OUT($$XVAL("ceaoabb",vals)_para)
"RTN","SAMICTT4",123,0)
 d  ;
"RTN","SAMICTT4",124,0)
 . q  ; LungRADS moved to SAMICTRA
"RTN","SAMICTT4",125,0)
 . n lradModifiers
"RTN","SAMICTT4",126,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTT4",127,0)
 . ;
"RTN","SAMICTT4",128,0)
 . i ($$XVAL("celrad",vals)'="-")&($$XVAL("celrad",vals)'="") d  ;
"RTN","SAMICTT4",129,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTT4",130,0)
 . . d OUT("")
"RTN","SAMICTT4",131,0)
 s outmode="go"
"RTN","SAMICTT4",132,0)
 d OUT("")
"RTN","SAMICTT4",133,0)
 q
"RTN","SAMICTT4",134,0)
 ;
"RTN","SAMICTT4",135,0)
 ;
"RTN","SAMICTT4",136,0)
OUT(ln) ;
"RTN","SAMICTT4",137,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT4",138,0)
 s cnt=cnt+1
"RTN","SAMICTT4",139,0)
 n lnn
"RTN","SAMICTT4",140,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT4",141,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT4",142,0)
 i outmode="go" d  ;
"RTN","SAMICTT4",143,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT4",144,0)
 . s line=""
"RTN","SAMICTT4",145,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT4",146,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT4",147,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT4",148,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT4",149,0)
 . n zs s zs=$STACK
"RTN","SAMICTT4",150,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT4",151,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT4",152,0)
 q
"RTN","SAMICTT4",153,0)
 ;
"RTN","SAMICTT4",154,0)
OUTOLD(ln) ;
"RTN","SAMICTT4",155,0)
 s cnt=cnt+1
"RTN","SAMICTT4",156,0)
 n lnn
"RTN","SAMICTT4",157,0)
 ;s debug=1
"RTN","SAMICTT4",158,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT4",159,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT4",160,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT4",161,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT4",162,0)
 . n zs s zs=$STACK
"RTN","SAMICTT4",163,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT4",164,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT4",165,0)
 q
"RTN","SAMICTT4",166,0)
 ;
"RTN","SAMICTT4",167,0)
HOUT(ln) ;
"RTN","SAMICTT4",168,0)
 d OUT(ln)
"RTN","SAMICTT4",169,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT4",170,0)
 q
"RTN","SAMICTT4",171,0)
 ;
"RTN","SAMICTT4",172,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT4",173,0)
 ; vals is passed by name
"RTN","SAMICTT4",174,0)
 n zr
"RTN","SAMICTT4",175,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT4",176,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT4",177,0)
 q zr
"RTN","SAMICTT4",178,0)
 ;
"RTN","SAMICTT4",179,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT4",180,0)
 ; vals and dict are passed by name
"RTN","SAMICTT4",181,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT4",182,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT4",183,0)
 n zr,zv,zdx
"RTN","SAMICTT4",184,0)
 s zdx=$g(valdx)
"RTN","SAMICTT4",185,0)
 i zdx="" s zdx=var
"RTN","SAMICTT4",186,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT4",187,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT4",188,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT4",189,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT4",190,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT4",191,0)
 q zr
"RTN","SAMICTT4",192,0)
 ;
"RTN","SAMICTT4",193,0)
 ;
"RTN","SAMICTT9")
0^6^B10329219
"RTN","SAMICTT9",1,0)
SAMICTR9 ;ven/gpl - ielcap: forms ; 12/28/18 10:26am
"RTN","SAMICTT9",2,0)
 ;;18.0;SAMI;;;Build 2
"RTN","SAMICTT9",3,0)
 ;
"RTN","SAMICTT9",4,0)
 ;
"RTN","SAMICTT9",5,0)
 quit  ; no entry from top
"RTN","SAMICTT9",6,0)
 ;
"RTN","SAMICTT9",7,0)
IMPRSN(rtn,vals,dict) ;
"RTN","SAMICTT9",8,0)
 ; repgen13
"RTN","SAMICTT9",9,0)
 ;
"RTN","SAMICTT9",10,0)
 ;
"RTN","SAMICTT9",11,0)
 ; # Impression
"RTN","SAMICTT9",12,0)
 ;d OUT("</TD></TR></TABLE><TR><TD>")
"RTN","SAMICTT9",13,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT9",14,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT9",15,0)
 ;d OUT("<!-- impression -->")
"RTN","SAMICTT9",16,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTT9",17,0)
 ;d OUT("<FONT SIZE=""+2"">")
"RTN","SAMICTT9",18,0)
 ;d OUT("<B>IMPRESSION:</B>")
"RTN","SAMICTT9",19,0)
 ;d OUT("</FONT>")
"RTN","SAMICTT9",20,0)
 ;d OUT("</TD></TR><TR><TD><TABLE>")
"RTN","SAMICTT9",21,0)
 ;d OUT("<TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTT9",22,0)
 d OUT("")
"RTN","SAMICTT9",23,0)
 d OUT("IMPRESSION:")
"RTN","SAMICTT9",24,0)
 d OUT("")
"RTN","SAMICTT9",25,0)
 ;
"RTN","SAMICTT9",26,0)
 d OUT($$XSUB("ceimn",vals,dict)_para)
"RTN","SAMICTT9",27,0)
 ;
"RTN","SAMICTT9",28,0)
 ;# Report CAC Score and Extent of Emphysema
"RTN","SAMICTT9",29,0)
 s cacval=0
"RTN","SAMICTT9",30,0)
 d  ;if $$XVAL("ceccv",vals)'="e" d  ;
"RTN","SAMICTT9",31,0)
 . set vcac=$$XVAL("cecccac",vals)
"RTN","SAMICTT9",32,0)
 . if vcac'="" d  ;
"RTN","SAMICTT9",33,0)
 . . s cacrec=""
"RTN","SAMICTT9",34,0)
 . . s cac="The Visual Coronary Artery Calcium (CAC) Score is "_vcac_". "
"RTN","SAMICTT9",35,0)
 . . s cacval=vcac
"RTN","SAMICTT9",36,0)
 . . i cacval>3 s cacrec=$g(@dict@("CAC_recommendation"))_para
"RTN","SAMICTT9",37,0)
 ;
"RTN","SAMICTT9",38,0)
 i cacval>0 d  ;
"RTN","SAMICTT9",39,0)
 . d OUT("")
"RTN","SAMICTT9",40,0)
 . d OUT(cac_" "_cacrec_" ") d OUT("")
"RTN","SAMICTT9",41,0)
 . d  ;if $$XVAL("ceemv",vals)="e" d  ;
"RTN","SAMICTT9",42,0)
 . . if $$XVAL("ceem",vals)'="no" d  ;
"RTN","SAMICTT9",43,0)
 . . . if $$XVAL("ceem",vals)="nv" q  ;
"RTN","SAMICTT9",44,0)
 . . . d OUT("Emphysema:") d OUT("")
"RTN","SAMICTT9",45,0)
 . . . d OUT($$XSUB("ceem",vals,dict)_". ") d OUT("")
"RTN","SAMICTT9",46,0)
 ;
"RTN","SAMICTT9",47,0)
 i $$XVAL("ceclini",vals)="y" d  ;
"RTN","SAMICTT9",48,0)
 . d OUT($$XVAL("ceclin",vals)_". ") d OUT("")
"RTN","SAMICTT9",49,0)
 ;
"RTN","SAMICTT9",50,0)
 i $$XVAL("ceoppai",vals)="y" d  ;
"RTN","SAMICTT9",51,0)
 . d OUT($$XVAL("ceoppa",vals)_". ") d OUT("")
"RTN","SAMICTT9",52,0)
 ;
"RTN","SAMICTT9",53,0)
 i $$XVAL("ceoppabi",vals)="y" d  ;
"RTN","SAMICTT9",54,0)
 . d OUT($$XVAL("ceoppab",vals)_". ") d OUT("")
"RTN","SAMICTT9",55,0)
 ;
"RTN","SAMICTT9",56,0)
 i $$XVAL("cecommcai",vals)="y" d  ;
"RTN","SAMICTT9",57,0)
 . d OUT($$XVAL("cecommca",vals)_". ") d OUT("")
"RTN","SAMICTT9",58,0)
 ;
"RTN","SAMICTT9",59,0)
 i $$XVAL("ceotabnmi",vals)="y" d  ;
"RTN","SAMICTT9",60,0)
 . d OUT($$XVAL("ceotabnm",vals)_". ") d OUT("")
"RTN","SAMICTT9",61,0)
 ;
"RTN","SAMICTT9",62,0)
 i $$XVAL("ceobrci",vals)="y" d  ;
"RTN","SAMICTT9",63,0)
 . d OUT($$XVAL("ceobrc",vals)_". ") d OUT("")
"RTN","SAMICTT9",64,0)
 ;
"RTN","SAMICTT9",65,0)
 i $$XVAL("ceaoabbi",vals)="y" d  ;
"RTN","SAMICTT9",66,0)
 . d OUT($$XVAL("ceaoabb",vals)_". ") d OUT("")
"RTN","SAMICTT9",67,0)
 ;
"RTN","SAMICTT9",68,0)
 i $$XVAL("ceaoabi",vals)="y" d  ;
"RTN","SAMICTT9",69,0)
 . d OUT($$XVAL("ceaoab",vals)_". ") d OUT("")
"RTN","SAMICTT9",70,0)
 ;
"RTN","SAMICTT9",71,0)
 ;# Impression Remarks
"RTN","SAMICTT9",72,0)
 i $$XVAL("ceimre",vals)'="" d  ;
"RTN","SAMICTT9",73,0)
 . d OUT($$XVAL("ceimre",vals)_". ") d OUT("")
"RTN","SAMICTT9",74,0)
 q
"RTN","SAMICTT9",75,0)
 ;
"RTN","SAMICTT9",76,0)
 ;
"RTN","SAMICTT9",77,0)
OUT(ln) ;
"RTN","SAMICTT9",78,0)
 s cnt=cnt+1
"RTN","SAMICTT9",79,0)
 n lnn
"RTN","SAMICTT9",80,0)
 ;s debug=1
"RTN","SAMICTT9",81,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT9",82,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT9",83,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT9",84,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT9",85,0)
 . n zs s zs=$STACK
"RTN","SAMICTT9",86,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT9",87,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT9",88,0)
 q
"RTN","SAMICTT9",89,0)
 ;
"RTN","SAMICTT9",90,0)
HOUT(ln) ;
"RTN","SAMICTT9",91,0)
 d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT9",92,0)
 q
"RTN","SAMICTT9",93,0)
 ;
"RTN","SAMICTT9",94,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT9",95,0)
 ; vals is passed by name
"RTN","SAMICTT9",96,0)
 n zr
"RTN","SAMICTT9",97,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT9",98,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT9",99,0)
 q zr
"RTN","SAMICTT9",100,0)
 ;
"RTN","SAMICTT9",101,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT9",102,0)
 ; vals and dict are passed by name
"RTN","SAMICTT9",103,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT9",104,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT9",105,0)
 n zr,zv,zdx
"RTN","SAMICTT9",106,0)
 s zdx=$g(valdx)
"RTN","SAMICTT9",107,0)
 i zdx="" s zdx=var
"RTN","SAMICTT9",108,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT9",109,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT9",110,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT9",111,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT9",112,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT9",113,0)
 q zr
"RTN","SAMICTT9",114,0)
 ;
"RTN","SAMICTTA")
0^7^B24215810
"RTN","SAMICTTA",1,0)
SAMICTTA ;ven/gpl - ielcap: forms ; 12/28/18 9:43am
"RTN","SAMICTTA",2,0)
 ;;18.0;SAMI;;;Build 2
"RTN","SAMICTTA",3,0)
 ;
"RTN","SAMICTTA",4,0)
 ;
"RTN","SAMICTTA",5,0)
 quit  ; no entry from top
"RTN","SAMICTTA",6,0)
 ;
"RTN","SAMICTTA",7,0)
RCMND(rtn,vals,dict) ;
"RTN","SAMICTTA",8,0)
 ; repgen14
"RTN","SAMICTTA",9,0)
 ;
"RTN","SAMICTTA",10,0)
 ;
"RTN","SAMICTTA",11,0)
 ;# Recommendation
"RTN","SAMICTTA",12,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",13,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTTA",14,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",15,0)
 ;d OUT("<!-- Recommendation -->")
"RTN","SAMICTTA",16,0)
 ;
"RTN","SAMICTTA",17,0)
 i $$XVAL("cefu",vals)'="nf" d  ; 2445-2450 gpl1
"RTN","SAMICTTA",18,0)
 . ;d OUT("<TR><TD><FONT SIZE=""+2""><B>")
"RTN","SAMICTTA",19,0)
 . ;d OUT("<FONT SIZE=""+2""><B>")
"RTN","SAMICTTA",20,0)
 . d OUT("")
"RTN","SAMICTTA",21,0)
 . d OUT("Recommendations:")
"RTN","SAMICTTA",22,0)
 . d OUT("")
"RTN","SAMICTTA",23,0)
 . ;d OUT("</B></FONT>")
"RTN","SAMICTTA",24,0)
 . ;d OUT("</TD></TR><TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",25,0)
 ;
"RTN","SAMICTTA",26,0)
 n fuw
"RTN","SAMICTTA",27,0)
 s fuw=$$XSUB("cefuw",vals,dict)
"RTN","SAMICTTA",28,0)
 ;d OUT("fuw= "_fuw)
"RTN","SAMICTTA",29,0)
 ;d OUT("vals= "_vals)
"RTN","SAMICTTA",30,0)
 ;d OUT(" dict= "_dict)
"RTN","SAMICTTA",31,0)
 ;d OUT($o(@vals@("cefuw","")))
"RTN","SAMICTTA",32,0)
 ;zwr @vals@(*)
"RTN","SAMICTTA",33,0)
 ;zwr @dict@(*)
"RTN","SAMICTTA",34,0)
 ;i fuw="" d  ;
"RTN","SAMICTTA",35,0)
 ;. d OUT(para_"<B>"_$$XSUB("cefu",vals,dict)_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",36,0)
 ;e  d  ;
"RTN","SAMICTTA",37,0)
 ;. d OUT(para_"<B>"_$$XSUB("cefu",vals,dict)_" "_fuw_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",38,0)
 i fuw="" d  ;
"RTN","SAMICTTA",39,0)
 . ;d OUT(para_"<B>A followup CT scan is recommended on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",40,0)
 . d OUT("A followup CT scan is recommended on "_$$XVAL("cefud",vals)_". ") d OUT("")
"RTN","SAMICTTA",41,0)
 e  d  ;
"RTN","SAMICTTA",42,0)
 . ;d OUT(para_"<B>A followup CT scan is recommended "_fuw_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",43,0)
 . d OUT("A followup CT scan is recommended "_fuw_" on "_$$XVAL("cefud",vals)_". ") d OUT("")
"RTN","SAMICTTA",44,0)
 ;
"RTN","SAMICTTA",45,0)
 ; #Other followup
"RTN","SAMICTTA",46,0)
 n zfu,ofu,tofu,comma
"RTN","SAMICTTA",47,0)
 s comma=0,tofu=""
"RTN","SAMICTTA",48,0)
 s ofu=""
"RTN","SAMICTTA",49,0)
 f zfu="cefuaf","cefucc","cefupe","cefufn","cefubr","cefupc","cefutb" d  ;
"RTN","SAMICTTA",50,0)
 . i $$XVAL(zfu,vals)="y" s ofu=ofu_zfu
"RTN","SAMICTTA",51,0)
 i $$XVAL("cefuo",vals)'="" s ofu=ofu_"cefuo"
"RTN","SAMICTTA",52,0)
 i ofu'="" d  ;
"RTN","SAMICTTA",53,0)
 . s tofu="Other followup: "
"RTN","SAMICTTA",54,0)
 . i ofu["cefuaf" s tofu=tofu_"Antibiotics" s comma=1
"RTN","SAMICTTA",55,0)
 . i ofu["cefucc" s tofu=tofu_$s(comma:", ",1:"")_"Diagnostic CT" s comma=1
"RTN","SAMICTTA",56,0)
 . i ofu["cefupe" s tofu=tofu_$s(comma:", ",1:"")_"PET" s comma=1
"RTN","SAMICTTA",57,0)
 . i ofu["cefufn" s tofu=tofu_$s(comma:", ",1:"")_"Percutaneous biopsy" s comma=1
"RTN","SAMICTTA",58,0)
 . i ofu["cefubr" s tofu=tofu_$s(comma:", ",1:"")_"Bronchoscopy" s comma=1
"RTN","SAMICTTA",59,0)
 . i ofu["cefupc" s tofu=tofu_$s(comma:", ",1:"")_"Pulmonary consultation" s comma=1
"RTN","SAMICTTA",60,0)
 . i ofu["cefutb" s tofu=tofu_$s(comma:", ",1:"")_"Refer to tumor board" s comma=1
"RTN","SAMICTTA",61,0)
 . i ofu["cefuo" s tofu=tofu_$s(comma:", ",1:"")_$$XVAL("cefuoo",vals) s comma=1
"RTN","SAMICTTA",62,0)
 i ofu'="" d OUT(para_tofu_para) d OUT("")
"RTN","SAMICTTA",63,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",64,0)
 ; # LungRADS
"RTN","SAMICTTA",65,0)
 ;
"RTN","SAMICTTA",66,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTTA",67,0)
 ;n lrstyle
"RTN","SAMICTTA",68,0)
 ;i $$XVAL("celrc",vals)'="" s lrstyle=1 ; dom's style
"RTN","SAMICTTA",69,0)
 ;e  s lrstyle=0 ; artit's style
"RTN","SAMICTTA",70,0)
 ;s lrstyle=0
"RTN","SAMICTTA",71,0)
 ;
"RTN","SAMICTTA",72,0)
 d  ;
"RTN","SAMICTTA",73,0)
 . q  ; LUNGRADS moved to SAMICTR4
"RTN","SAMICTTA",74,0)
 . n lradModifiers
"RTN","SAMICTTA",75,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTTA",76,0)
 . ;
"RTN","SAMICTTA",77,0)
 . i ($$XVAL("celrad",vals)'="-")&($$XVAL("celrad",vals)'="") d  ;
"RTN","SAMICTTA",78,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTTA",79,0)
 . . d OUT(para)
"RTN","SAMICTTA",80,0)
 ;
"RTN","SAMICTTA",81,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",82,0)
 ;
"RTN","SAMICTTA",83,0)
 ;d OUT("<TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",84,0)
 ;
"RTN","SAMICTTA",85,0)
 ;# Check if Study is Completed
"RTN","SAMICTTA",86,0)
 ;# Find Current Study ID
"RTN","SAMICTTA",87,0)
 ;# locate most recent followup
"RTN","SAMICTTA",88,0)
 ;# get status (sies)
"RTN","SAMICTTA",89,0)
 ;# if sc=Study Complete and cefu=rs
"RTN","SAMICTTA",90,0)
 ;
"RTN","SAMICTTA",91,0)
 n patstatus
"RTN","SAMICTTA",92,0)
 s patstatus=$$XVAL("cedos",vals)
"RTN","SAMICTTA",93,0)
 ;i patstatus="sc" d OUT(para_$g(@dict@("study_complete")))
"RTN","SAMICTTA",94,0)
 i patstatus="sc" d OUT($g(@dict@("study_complete"))) d OUT("")
"RTN","SAMICTTA",95,0)
 ;
"RTN","SAMICTTA",96,0)
 ;# Radiologist
"RTN","SAMICTTA",97,0)
 i $$XVAL("cerad",vals)'="" d  ;
"RTN","SAMICTTA",98,0)
 . d OUT("Interpreted by: "_$$XVAL("cerad",vals)) d OUT("")
"RTN","SAMICTTA",99,0)
 ;
"RTN","SAMICTTA",100,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",101,0)
 ; # LungRADS
"RTN","SAMICTTA",102,0)
 ;
"RTN","SAMICTTA",103,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTTA",104,0)
 n lrstyle
"RTN","SAMICTTA",105,0)
 i $$XVAL("celrc",vals)'="" s lrstyle=1 ; dom's style
"RTN","SAMICTTA",106,0)
 e  s lrstyle=0 ; artit's style
"RTN","SAMICTTA",107,0)
 s lrstyle=0
"RTN","SAMICTTA",108,0)
 ;
"RTN","SAMICTTA",109,0)
 d  ;
"RTN","SAMICTTA",110,0)
 . ;q  ; LUNGRADS moved to SAMICTR4
"RTN","SAMICTTA",111,0)
 . n lradModifiers
"RTN","SAMICTTA",112,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTTA",113,0)
 . ;
"RTN","SAMICTTA",114,0)
 . i ($$XVAL("celrad",vals)'="-")&($$XVAL("celrad",vals)'="") d  ;
"RTN","SAMICTTA",115,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTTA",116,0)
 . . d OUT("")
"RTN","SAMICTTA",117,0)
 ;
"RTN","SAMICTTA",118,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",119,0)
 ;
"RTN","SAMICTTA",120,0)
 ;d OUT("<TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",121,0)
 q
"RTN","SAMICTTA",122,0)
 ;
"RTN","SAMICTTA",123,0)
 ;
"RTN","SAMICTTA",124,0)
OUT(ln) ;
"RTN","SAMICTTA",125,0)
 s cnt=cnt+1
"RTN","SAMICTTA",126,0)
 n lnn
"RTN","SAMICTTA",127,0)
 ;s debug=1
"RTN","SAMICTTA",128,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTTA",129,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTTA",130,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTTA",131,0)
 . i ln["<T" q  ; no markup
"RTN","SAMICTTA",132,0)
 . i ln["</" q  ; no markup
"RTN","SAMICTTA",133,0)
 . n zs s zs=$STACK
"RTN","SAMICTTA",134,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTTA",135,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTTA",136,0)
 q
"RTN","SAMICTTA",137,0)
 ;
"RTN","SAMICTTA",138,0)
HOUT(ln) ;
"RTN","SAMICTTA",139,0)
 d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTTA",140,0)
 q
"RTN","SAMICTTA",141,0)
 ;
"RTN","SAMICTTA",142,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTTA",143,0)
 ; vals is passed by name
"RTN","SAMICTTA",144,0)
 n zr
"RTN","SAMICTTA",145,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTTA",146,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTTA",147,0)
 q zr
"RTN","SAMICTTA",148,0)
 ;
"RTN","SAMICTTA",149,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTTA",150,0)
 ; vals and dict are passed by name
"RTN","SAMICTTA",151,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTTA",152,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTTA",153,0)
 n zr,zv,zdx
"RTN","SAMICTTA",154,0)
 s zdx=$g(valdx)
"RTN","SAMICTTA",155,0)
 i zdx="" s zdx=var
"RTN","SAMICTTA",156,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTTA",157,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTTA",158,0)
 i zv="" s zr="" q zr
"RTN","SAMICTTA",159,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTTA",160,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTTA",161,0)
 q zr
"RTN","SAMICTTA",162,0)
 ;
"RTN","SAMIFLD")
0^8^B204052110
"RTN","SAMIFLD",1,0)
SAMIFLD ;ven/gpl - elcap: form load & case review support ;Oct 22, 2019@15:36
"RTN","SAMIFLD",2,0)
 ;;18.0;SAMI;;;Build 2
"RTN","SAMIFLD",3,0)
 ;
"RTN","SAMIFLD",4,0)
 ; Routine SAMIFLD contains subroutines for processing the ELCAP forms,
"RTN","SAMIFLD",5,0)
 ; specifically loading JSON data into the graphstore for each line.
"RTN","SAMIFLD",6,0)
 ; Since three of those subroutines are also code for ppis called by
"RTN","SAMIFLD",7,0)
 ; WSCASE^SAMICASE, two additional subroutines are included that are not
"RTN","SAMIFLD",8,0)
 ; part of the LOAD opus but are called by WSCASE^SAMICASE.
"RTN","SAMIFLD",9,0)
 ; SAMIFLD contains no public entry points (see SAMIFORM).
"RTN","SAMIFLD",10,0)
 ;
"RTN","SAMIFLD",11,0)
 quit  ; no entry from top
"RTN","SAMIFLD",12,0)
 ;
"RTN","SAMIFLD",13,0)
 ;
"RTN","SAMIFLD",14,0)
 ;
"RTN","SAMIFLD",15,0)
 ;@section 0 primary development
"RTN","SAMIFLD",16,0)
 ;
"RTN","SAMIFLD",17,0)
 ;
"RTN","SAMIFLD",18,0)
 ;
"RTN","SAMIFLD",19,0)
 ;@routine-credits
"RTN","SAMIFLD",20,0)
 ;@primary-dev: George P. Lilly (gpl)
"RTN","SAMIFLD",21,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIFLD",22,0)
 ;@primary-dev-org: Vista Expertise Network (ven)
"RTN","SAMIFLD",23,0)
 ; http://vistaexpertise.net
"RTN","SAMIFLD",24,0)
 ;@copyright: 2017/2019, gpl, all rights reserved
"RTN","SAMIFLD",25,0)
 ;@license: Apache 2.0
"RTN","SAMIFLD",26,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMIFLD",27,0)
 ;
"RTN","SAMIFLD",28,0)
 ;@last-updated: 2019-08-01T15:42Z
"RTN","SAMIFLD",29,0)
 ;@application: Screening Applications Management (SAM)
"RTN","SAMIFLD",30,0)
 ;@module: Screening Applications Management - VAPALS-ELCAP (SAMI)
"RTN","SAMIFLD",31,0)
 ;@version: 18.0T04 (fourth development version)
"RTN","SAMIFLD",32,0)
 ;@release-date: not yet released
"RTN","SAMIFLD",33,0)
 ;@patch-list: none yet
"RTN","SAMIFLD",34,0)
 ;
"RTN","SAMIFLD",35,0)
 ;@additional-dev: Frederick D. S. Marshall (toad)
"RTN","SAMIFLD",36,0)
 ; toad@vistaexpertise.net
"RTN","SAMIFLD",37,0)
 ;@additional-dev: Larry G. Carlson (lgc)
"RTN","SAMIFLD",38,0)
 ; lgc@vistaexpertise.net
"RTN","SAMIFLD",39,0)
 ;@additional-dev: Alexis Carlson (arc)
"RTN","SAMIFLD",40,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMIFLD",41,0)
 ;
"RTN","SAMIFLD",42,0)
 ;@module-credits [see SAMIFUL]
"RTN","SAMIFLD",43,0)
 ;
"RTN","SAMIFLD",44,0)
 ;@contents
"RTN","SAMIFLD",45,0)
 ; LOAD: code for ppi LOAD^SAMIFORM
"RTN","SAMIFLD",46,0)
 ;  used for Dom's new style forms
"RTN","SAMIFLD",47,0)
 ;
"RTN","SAMIFLD",48,0)
 ; $$GETHDR = header string for patient sid
"RTN","SAMIFLD",49,0)
 ;
"RTN","SAMIFLD",50,0)
 ; GETLAST5 = code for ppi $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",51,0)
 ;  last5 for patient sid
"RTN","SAMIFLD",52,0)
 ; FIXSRC: code for ppi FIXSRC^SAMIFORM
"RTN","SAMIFLD",53,0)
 ;  fix html src lines to use resources in see/
"RTN","SAMIFLD",54,0)
 ; FIXHREF: code for ppi FIXHREF^SAMIFORM
"RTN","SAMIFLD",55,0)
 ;  fix html href lines to use resources in see/
"RTN","SAMIFLD",56,0)
 ;
"RTN","SAMIFLD",57,0)
 ; GETNAME = code for ppi $$GETNAME^SAMIFORM
"RTN","SAMIFLD",58,0)
 ;  name for patient sid
"RTN","SAMIFLD",59,0)
 ; GETSSN = code for ppi $$GETSSN^SAMIFORM
"RTN","SAMIFLD",60,0)
 ;  ssn for patient sid
"RTN","SAMIFLD",61,0)
 ;
"RTN","SAMIFLD",62,0)
 ;
"RTN","SAMIFLD",63,0)
 ;
"RTN","SAMIFLD",64,0)
 ;@section 1 code for ppi LOAD^SAMIFRM
"RTN","SAMIFLD",65,0)
 ;
"RTN","SAMIFLD",66,0)
 ;
"RTN","SAMIFLD",67,0)
 ;
"RTN","SAMIFLD",68,0)
 ;@ppi-code LOAD^SAMIFORM
"RTN","SAMIFLD",69,0)
LOAD ; process html line, e.g., load json data into graph
"RTN","SAMIFLD",70,0)
 ;
"RTN","SAMIFLD",71,0)
 ;@signature
"RTN","SAMIFLD",72,0)
 ; do LOAD^SAMIFORM(.SAMILINE,form,sid,.SAMIFILTER,.SAMILNUM,.SAMIHTML,.SAMIVALS)
"RTN","SAMIFLD",73,0)
 ;@branches-from
"RTN","SAMIFLD",74,0)
 ; LOAD^SAMIFORM
"RTN","SAMIFLD",75,0)
 ;@ppi-called-by
"RTN","SAMIFLD",76,0)
 ; wsGetForm^%wf
"RTN","SAMIFLD",77,0)
 ; WSNOTE^SAMINOTI
"RTN","SAMIFLD",78,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIFLD",79,0)
 ;@called-by: none
"RTN","SAMIFLD",80,0)
 ;@calls
"RTN","SAMIFLD",81,0)
 ; $$GETHDR
"RTN","SAMIFLD",82,0)
 ; $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",83,0)
 ; findReplace^%ts
"RTN","SAMIFLD",84,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",85,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIFLD",86,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIFLD",87,0)
 ;@thruput
"RTN","SAMIFLD",88,0)
 ;.SAMILINE = line of html
"RTN","SAMIFLD",89,0)
 ; SAMILINE("low") = lowercase line for easier checks
"RTN","SAMIFLD",90,0)
 ;.SAMIFILTER = work-parameters array
"RTN","SAMIFLD",91,0)
 ; SAMIFILTER("debug") = 1 to debug some fields, 2 to debug more fields
"RTN","SAMIFLD",92,0)
 ; SAMIFILTER("errormessagestyle") = 2 (default) = use current error msg style
"RTN","SAMIFLD",93,0)
 ; SAMIFILTER("form") = form id (e.g., "vapals:sbform")
"RTN","SAMIFLD",94,0)
 ; SAMIFILTER("key") = graph key for saved form (e.g., "ceform-2019-07-01")
"RTN","SAMIFLD",95,0)
 ; SAMIFILTER("studyid") = patient study id (e.g., "XXX00045")
"RTN","SAMIFLD",96,0)
 ; SAMIFILTER("fvalue") = deprecated
"RTN","SAMIFLD",97,0)
 ;.SAMILNUM = html line #, in case need to reset cursor to skip lines
"RTN","SAMIFLD",98,0)
 ;.SAMIHTML = complete html form, in case other lines need changing
"RTN","SAMIFLD",99,0)
 ;@input
"RTN","SAMIFLD",100,0)
 ; form = form id
"RTN","SAMIFLD",101,0)
 ; sid = patient study id
"RTN","SAMIFLD",102,0)
 ;.SAMIVALS = field values
"RTN","SAMIFLD",103,0)
 ; SAMIVALS("saminame")
"RTN","SAMIFLD",104,0)
 ; SAMIVALS("samistatus")
"RTN","SAMIFLD",105,0)
 ; SAMIVALS("samifirsttime")
"RTN","SAMIFLD",106,0)
 ;@tests
"RTN","SAMIFLD",107,0)
 ; UTSSUB2^SAMIUTF2: used for Dom's new style forms
"RTN","SAMIFLD",108,0)
 ;
"RTN","SAMIFLD",109,0)
 ; This line processor/data loader can modify any line in the html as needed.
"RTN","SAMIFLD",110,0)
 ;
"RTN","SAMIFLD",111,0)
 new touched set touched=0
"RTN","SAMIFLD",112,0)
 ;
"RTN","SAMIFLD",113,0)
 set SAMILINE=SAMILINE_$char(13,10) ; insert CRLF at end of every line
"RTN","SAMIFLD",114,0)
 ; for readability in browser
"RTN","SAMIFLD",115,0)
 ;
"RTN","SAMIFLD",116,0)
 new pssn set pssn=$$GETHDR(sid)
"RTN","SAMIFLD",117,0)
 i pssn=""  d  ; for participants without a sid - ie not registered
"RTN","SAMIFLD",118,0)
 . n dfn,lien
"RTN","SAMIFLD",119,0)
 . s dfn=$g(SAMIFILTER("dfn")) ; if no sid, maybe a dfn
"RTN","SAMIFLD",120,0)
 . q:dfn=""
"RTN","SAMIFLD",121,0)
 . n lroot s lroot=$$setroot^%wd("patient-lookup") ; 
"RTN","SAMIFLD",122,0)
 . s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIFLD",123,0)
 . q:lien=""
"RTN","SAMIFLD",124,0)
 . n ssn s ssn=$g(@lroot@(lien,"ssn"))
"RTN","SAMIFLD",125,0)
 . q:ssn=""
"RTN","SAMIFLD",126,0)
 . s pssn=$e(ssn,1,3)_"-"_$e(ssn,4,5)_"-"_$e(ssn,6,9)
"RTN","SAMIFLD",127,0)
 new last5 set last5=$$GETLAST5^SAMIFORM(sid)
"RTN","SAMIFLD",128,0)
 new useid set useid=pssn
"RTN","SAMIFLD",129,0)
 if useid="" set useid=last5
"RTN","SAMIFLD",130,0)
 ;
"RTN","SAMIFLD",131,0)
 if SAMILINE["@@FORMKEY@@" do  ; insert form id (graph key for new forms)
"RTN","SAMIFLD",132,0)
 . do findReplace^%ts(.SAMILINE,"@@FORMKEY@@",form) ; key -> form, test me
"RTN","SAMIFLD",133,0)
 . quit
"RTN","SAMIFLD",134,0)
 ;
"RTN","SAMIFLD",135,0)
 if SAMILINE["@@SID@@" do  ; insert patient study id
"RTN","SAMIFLD",136,0)
 . do findReplace^%ts(.SAMILINE,"@@SID@@",sid)
"RTN","SAMIFLD",137,0)
 . quit
"RTN","SAMIFLD",138,0)
 ;
"RTN","SAMIFLD",139,0)
 if SAMILINE["@@SITE@@" do  ; insert site id
"RTN","SAMIFLD",140,0)
 . n siteid s siteid=$g(SAMIVALS("siteid"))
"RTN","SAMIFLD",141,0)
 . i siteid="" s siteid=$g(SAMIFILTER("siteid"))
"RTN","SAMIFLD",142,0)
 . q:siteid=""
"RTN","SAMIFLD",143,0)
 . do findReplace^%ts(.SAMILINE,"@@SITE@@",siteid)
"RTN","SAMIFLD",144,0)
 . quit
"RTN","SAMIFLD",145,0)
 ;
"RTN","SAMIFLD",146,0)
 if SAMILINE["@@SITETITLE@@" do  ; insert site title
"RTN","SAMIFLD",147,0)
 . n sitetit s sitetit=$g(SAMIVALS("sitetitle"))
"RTN","SAMIFLD",148,0)
 . i sitetit="" s sitetit=$g(SAMIFILTER("sitetitle"))
"RTN","SAMIFLD",149,0)
 . q:sitetit=""
"RTN","SAMIFLD",150,0)
 . do findReplace^%ts(.SAMILINE,"@@SITETITLE@@",sitetit)
"RTN","SAMIFLD",151,0)
 . quit
"RTN","SAMIFLD",152,0)
 ;
"RTN","SAMIFLD",153,0)
 if SAMILINE["@@MANUALREGISTRATION@@" do  ; turn off manual registration
"RTN","SAMIFLD",154,0)
 . n setman,setparm
"RTN","SAMIFLD",155,0)
 . s setman="true"
"RTN","SAMIFLD",156,0)
 . s setparm=$$GET^XPAR("SYS","SAMI ALLOW MANUAL ENTRY",,"Q")
"RTN","SAMIFLD",157,0)
 . i setparm=0 s setman="false"
"RTN","SAMIFLD",158,0)
 . do findReplace^%ts(.SAMILINE,"@@MANUALREGISTRATION@@",setman)
"RTN","SAMIFLD",159,0)
 ; 
"RTN","SAMIFLD",160,0)
 if SAMILINE["@@DFN@@" do  ; insert patient study id
"RTN","SAMIFLD",161,0)
 . n dfn s dfn=$g(SAMIVALS("dfn"))
"RTN","SAMIFLD",162,0)
 . q:dfn=""
"RTN","SAMIFLD",163,0)
 . do findReplace^%ts(.SAMILINE,"@@DFN@@",dfn)
"RTN","SAMIFLD",164,0)
 . quit
"RTN","SAMIFLD",165,0)
 ;
"RTN","SAMIFLD",166,0)
 if SAMILINE["src=" do  ; repoint src directory references
"RTN","SAMIFLD",167,0)
 . do FIXSRC^SAMIFORM(.SAMILINE) ; insert see/ processor on src= references
"RTN","SAMIFLD",168,0)
 . quit
"RTN","SAMIFLD",169,0)
 ;
"RTN","SAMIFLD",170,0)
 if SAMILINE["href=" if 'touched do  ; repoint href directory references
"RTN","SAMIFLD",171,0)
 . do FIXHREF^SAMIFORM(.SAMILINE) ; insert see/ processor on href= references
"RTN","SAMIFLD",172,0)
 . quit
"RTN","SAMIFLD",173,0)
 ;
"RTN","SAMIFLD",174,0)
 if SAMILINE["Sample, Sammy G" do  ; insert actual patient name
"RTN","SAMIFLD",175,0)
 . ;do findReplace^%ts(.SAMILINE,"Sample, Sammy G",$get(SAMIVALS("saminame")))
"RTN","SAMIFLD",176,0)
 . do findReplace^%ts(.SAMILINE,"Sample, Sammy G",$$GETNAME^SAMIFORM(sid))
"RTN","SAMIFLD",177,0)
 . quit
"RTN","SAMIFLD",178,0)
 ;
"RTN","SAMIFLD",179,0)
 if SAMILINE["ST0001" do  ; insert patient ssn or last 5
"RTN","SAMIFLD",180,0)
 . do findReplace^%ts(.SAMILINE,"ST0001",useid)
"RTN","SAMIFLD",181,0)
 . quit
"RTN","SAMIFLD",182,0)
 ;
"RTN","SAMIFLD",183,0)
 if SAMILINE["1234567890" do  ; cut patient id placeholder
"RTN","SAMIFLD",184,0)
 . do findReplace^%ts(.SAMILINE,"1234567890","")
"RTN","SAMIFLD",185,0)
 . quit
"RTN","SAMIFLD",186,0)
 ;
"RTN","SAMIFLD",187,0)
 if SAMILINE["XX0002" do  ; insert patient study id
"RTN","SAMIFLD",188,0)
 . if SAMILINE["XXX" quit  ;
"RTN","SAMIFLD",189,0)
 . do findReplace^%ts(.SAMILINE,"XX0002",sid)
"RTN","SAMIFLD",190,0)
 . quit
"RTN","SAMIFLD",191,0)
 ;
"RTN","SAMIFLD",192,0)
 if SAMILINE["VEP0001" do  ; insert patient study id
"RTN","SAMIFLD",193,0)
 . do findReplaceAll^%ts(.SAMILINE,"VEP0001",sid)
"RTN","SAMIFLD",194,0)
 . quit
"RTN","SAMIFLD",195,0)
 ;
"RTN","SAMIFLD",196,0)
 if SAMILINE["@@FROZEN@@" do  ; insert whether form is frozen
"RTN","SAMIFLD",197,0)
 . if $get(SAMIVALS("samistatus"))="complete" do  ;
"RTN","SAMIFLD",198,0)
 . . do findReplace^%ts(.SAMILINE,"@@FROZEN@@","true")
"RTN","SAMIFLD",199,0)
 . . quit
"RTN","SAMIFLD",200,0)
 . else  do  ;
"RTN","SAMIFLD",201,0)
 . . do findReplace^%ts(.SAMILINE,"@@FROZEN@@","false")
"RTN","SAMIFLD",202,0)
 . . quit
"RTN","SAMIFLD",203,0)
 . quit
"RTN","SAMIFLD",204,0)
 ;
"RTN","SAMIFLD",205,0)
 if SAMILINE["@@NEWFORM@@" do  ; insert whether first edit of form
"RTN","SAMIFLD",206,0)
 . if $get(SAMIVALS("samifirsttime"))="true" do  ;
"RTN","SAMIFLD",207,0)
 . . do findReplace^%ts(.SAMILINE,"@@NEWFORM@@","true")
"RTN","SAMIFLD",208,0)
 . . quit
"RTN","SAMIFLD",209,0)
 . else  do  ;
"RTN","SAMIFLD",210,0)
 . . do findReplace^%ts(.SAMILINE,"@@NEWFORM@@","false")
"RTN","SAMIFLD",211,0)
 . . quit
"RTN","SAMIFLD",212,0)
 . quit
"RTN","SAMIFLD",213,0)
 ;
"RTN","SAMIFLD",214,0)
 if SAMILINE["@@CHART_ELIGIBILITY_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",215,0)
 . n zexist
"RTN","SAMIFLD",216,0)
 . s zexist=$$EXISTCE^SAMINOT1(sid,form)
"RTN","SAMIFLD",217,0)
 . do findReplace^%ts(.SAMILINE,"@@CHART_ELIGIBILITY_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",218,0)
 ;
"RTN","SAMIFLD",219,0)
 if SAMILINE["@@PRE_ENROLLMENT_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",220,0)
 . n zexist
"RTN","SAMIFLD",221,0)
 . s zexist=$$EXISTPRE^SAMINOT1(sid,form)
"RTN","SAMIFLD",222,0)
 . do findReplace^%ts(.SAMILINE,"@@PRE_ENROLLMENT_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",223,0)
 ;
"RTN","SAMIFLD",224,0)
 if SAMILINE["@@INTAKE_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",225,0)
 . n zexist
"RTN","SAMIFLD",226,0)
 . s zexist=$$EXISTINT^SAMINOT1(sid,form)
"RTN","SAMIFLD",227,0)
 . do findReplace^%ts(.SAMILINE,"@@INTAKE_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",228,0)
 ;
"RTN","SAMIFLD",229,0)
 if SAMILINE["changelog" d  ;
"RTN","SAMIFLD",230,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",231,0)
 . new clog set clog=$na(@root@("graph",sid,form,"changelog"))
"RTN","SAMIFLD",232,0)
 . if '$d(@clog) q  ;
"RTN","SAMIFLD",233,0)
 . do findReplace^%ts(.SAMILINE,"</pre>","")
"RTN","SAMIFLD",234,0)
 . new zi set zi=""
"RTN","SAMIFLD",235,0)
 . for  set zi=$order(@clog@(zi)) quit:zi=""  d  ;
"RTN","SAMIFLD",236,0)
 . . new zien set zien=SAMILNUM_"."_$$xpand(zi)
"RTN","SAMIFLD",237,0)
 . . set zhtml(zien)=@clog@(zi)
"RTN","SAMIFLD",238,0)
 . set zhtml(SAMILNUM_"."_$$xpand($order(@clog@(""),-1)+1))="</pre>"
"RTN","SAMIFLD",239,0)
 ;
"RTN","SAMIFLD",240,0)
 if SAMILINE["commlog" d  ;
"RTN","SAMIFLD",241,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",242,0)
 . new clog set clog=$na(@root@("graph",sid,form,"comlog"))
"RTN","SAMIFLD",243,0)
 . if '$d(@clog) q  ;
"RTN","SAMIFLD",244,0)
 . do findReplace^%ts(.SAMILINE,"</pre>","")
"RTN","SAMIFLD",245,0)
 . new zi set zi=""
"RTN","SAMIFLD",246,0)
 . for  set zi=$order(@clog@(zi)) quit:zi=""  d  ;
"RTN","SAMIFLD",247,0)
 . . new zien set zien=SAMILNUM_"."_$$xpand(zi)
"RTN","SAMIFLD",248,0)
 . . set zhtml(zien)=@clog@(zi)
"RTN","SAMIFLD",249,0)
 . set zhtml(SAMILNUM_"."_$$xpand($order(@clog@(""),-1)+1))="</pre>"
"RTN","SAMIFLD",250,0)
 ;
"RTN","SAMIFLD",251,0)
 ;if form["fuform" d  ;
"RTN","SAMIFLD",252,0)
 i SAMILINE["pack-years-history" d  ;
"RTN","SAMIFLD",253,0)
 . d  ;
"RTN","SAMIFLD",254,0)
 . . i SAMILINE'["id" q  ;
"RTN","SAMIFLD",255,0)
 . . n zzi s zzi=SAMILNUM
"RTN","SAMIFLD",256,0)
 . . f  s zzi=$o(SAMIHTML(zzi)) q:zzi>(SAMILNUM+20)  q:SAMIHTML(zzi)["tbody"  d
"RTN","SAMIFLD",257,0)
 . . . s SAMIHTML(zzi)=SAMIHTML(zzi)_$char(13,10)
"RTN","SAMIFLD",258,0)
 . . ;s SAMIHTML(zzi)="<tbody>"_$$SHDET^SAMIUR2(sid)
"RTN","SAMIFLD",259,0)
 . . s SAMILNUM=zzi+1
"RTN","SAMIFLD",260,0)
 . . s SAMILINE=$$SHDET^SAMIUR2(sid,form)_"</tbody>"
"RTN","SAMIFLD",261,0)
 ;
"RTN","SAMIFLD",262,0)
 i SAMILINE["@@ERROR_MESSAGE@@" d  ;
"RTN","SAMIFLD",263,0)
 . n errMsg s errMsg=$get(SAMIVALS("errorMessage"))
"RTN","SAMIFLD",264,0)
 . if errMsg="" q  ; no error message
"RTN","SAMIFLD",265,0)
 . do findReplace^%ts(.SAMILINE,"@@ERROR_MESSAGE@@",errMsg)
"RTN","SAMIFLD",266,0)
 ;
"RTN","SAMIFLD",267,0)
 i SAMILINE["@@ERROR_FIELDS@@" d  ;
"RTN","SAMIFLD",268,0)
 . n errFld s errFld=$get(SAMIVALS("errorField"))
"RTN","SAMIFLD",269,0)
 . if errFld="" q  ; no error field
"RTN","SAMIFLD",270,0)
 . do findReplace^%ts(.SAMILINE,"@@ERROR_FIELDS@@",errFld)
"RTN","SAMIFLD",271,0)
 ;
"RTN","SAMIFLD",272,0)
 i SAMILINE["@@INFO_MESSAGE@@" d  ;
"RTN","SAMIFLD",273,0)
 . n infoMsg s infoMsg=$get(SAMIVALS("infoMessage"))
"RTN","SAMIFLD",274,0)
 . if infoMsg="" q  ; no message
"RTN","SAMIFLD",275,0)
 . do findReplace^%ts(.SAMILINE,"@@INFO_MESSAGE@@",infoMsg)
"RTN","SAMIFLD",276,0)
 ;
"RTN","SAMIFLD",277,0)
 i SAMILINE["@@WARN_MESSAGE@@" d  ;
"RTN","SAMIFLD",278,0)
 . n warnMsg s warnMsg=$get(SAMIVALS("warnMessage"))
"RTN","SAMIFLD",279,0)
 . if warnMsg="" q  ; no message
"RTN","SAMIFLD",280,0)
 . do findReplace^%ts(.SAMILINE,"@@WARN_MESSAGE@@",warnMsg)
"RTN","SAMIFLD",281,0)
 ;
"RTN","SAMIFLD",282,0)
 quit  ; end of ppi LOAD^SAMIFORM
"RTN","SAMIFLD",283,0)
 ;
"RTN","SAMIFLD",284,0)
xpand(zi) ; extrinsic that expands a number to 8 digits with preceeding 0
"RTN","SAMIFLD",285,0)
 ; and add a 1 at the end so that 10,20 etc still collate
"RTN","SAMIFLD",286,0)
 n g1,g2,g3
"RTN","SAMIFLD",287,0)
 s g1=8-$l(zi)
"RTN","SAMIFLD",288,0)
 s $p(g2,"0",g1)=""
"RTN","SAMIFLD",289,0)
 s g3=g2_zi_"1"
"RTN","SAMIFLD",290,0)
 q g3
"RTN","SAMIFLD",291,0)
 ;
"RTN","SAMIFLD",292,0)
 ;
"RTN","SAMIFLD",293,0)
GETHDR(sid) ; header string for patient sid
"RTN","SAMIFLD",294,0)
 ;
"RTN","SAMIFLD",295,0)
 ;@signature
"RTN","SAMIFLD",296,0)
 ; $$GETHDR^SAMIFORM(sid)
"RTN","SAMIFLD",297,0)
 ;@called-by
"RTN","SAMIFLD",298,0)
 ; LOAD
"RTN","SAMIFLD",299,0)
 ;@calls
"RTN","SAMIFLD",300,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",301,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMIFLD",302,0)
 ; ^%DT
"RTN","SAMIFLD",303,0)
 ; $$NOW^XLFDT
"RTN","SAMIFLD",304,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIFLD",305,0)
 ;@input
"RTN","SAMIFLD",306,0)
 ; sid = patient study id
"RTN","SAMIFLD",307,0)
 ;@output = header string (patient id dob age gender)
"RTN","SAMIFLD",308,0)
 ;@tests
"RTN","SAMIFLD",309,0)
 ; UTGETHDR^SAMIUTF2: header string for patient sid
"RTN","SAMIFLD",310,0)
 ;
"RTN","SAMIFLD",311,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",312,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",313,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",314,0)
 new dfn set dfn=@root@(ien,"dfn")
"RTN","SAMIFLD",315,0)
 quit:ien=""
"RTN","SAMIFLD",316,0)
 ;
"RTN","SAMIFLD",317,0)
 ; do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",318,0)
 if $get(@root@(ien,"ssn"))="" do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",319,0)
 if $get(@root@(ien,"sbdob"))=-1 do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",320,0)
 ;
"RTN","SAMIFLD",321,0)
 if $get(@root@(ien,"ssn"))="" quit "" ; patient info not available
"RTN","SAMIFLD",322,0)
 new pssn set pssn=$get(@root@(ien,"sissn"))
"RTN","SAMIFLD",323,0)
 if pssn["sta" set pssn=""
"RTN","SAMIFLD",324,0)
 if pssn="" do  ;
"RTN","SAMIFLD",325,0)
 . new orgssn
"RTN","SAMIFLD",326,0)
 . set orgssn=$get(@root@(ien,"ssn"))
"RTN","SAMIFLD",327,0)
 . quit:orgssn=""
"RTN","SAMIFLD",328,0)
 . set pssn=$extract(orgssn,1,3)_"-"_$extract(orgssn,4,5)_"-"_$extract(orgssn,6,9)
"RTN","SAMIFLD",329,0)
 . set @root@(ien,"sissn")=pssn
"RTN","SAMIFLD",330,0)
 . quit
"RTN","SAMIFLD",331,0)
 ;
"RTN","SAMIFLD",332,0)
AGE new dob set dob=$get(@root@(ien,"sbdob")) ; dob in VAPALS format
"RTN","SAMIFLD",333,0)
 i dob["-" s dob=$e(dob,6,7)_"/"_$e(dob,9,10)_"/"_$e(dob,1,4)
"RTN","SAMIFLD",334,0)
 i dob'["/" s dob=$e(dob,5,6)_"/"_$e(dob,7,8)_"/"_$e(dob,1,4)
"RTN","SAMIFLD",335,0)
 new X set X=dob
"RTN","SAMIFLD",336,0)
 new Y
"RTN","SAMIFLD",337,0)
 do ^%DT
"RTN","SAMIFLD",338,0)
 ;
"RTN","SAMIFLD",339,0)
 ; change ven/lgc 20190628 - calculate age with MASH 
"RTN","SAMIFLD",340,0)
 ;
"RTN","SAMIFLD",341,0)
 ;new age set age=$piece($$FMDIFF^XLFDT($$NOW^XLFDT,Y)/365,".")
"RTN","SAMIFLD",342,0)
 new age s age=$$age^%th(Y)
"RTN","SAMIFLD",343,0)
 ;
"RTN","SAMIFLD",344,0)
 set @root@(ien,"age")=age
"RTN","SAMIFLD",345,0)
 ;
"RTN","SAMIFLD",346,0)
 new sex set sex=$get(@root@(ien,"sex"))
"RTN","SAMIFLD",347,0)
 ;
"RTN","SAMIFLD",348,0)
 new rtn set rtn=pssn_" DOB: "_dob_" AGE: "_age_" GENDER: "_sex
"RTN","SAMIFLD",349,0)
 ;
"RTN","SAMIFLD",350,0)
 quit rtn ; end of $$GETHDR
"RTN","SAMIFLD",351,0)
 ;
"RTN","SAMIFLD",352,0)
 ;
"RTN","SAMIFLD",353,0)
 ;
"RTN","SAMIFLD",354,0)
 ;@section 2 code for ppis $$GETLAST5^SAMIFORM,FIXSRC^SAMIFORM,FIXHREF^SAMIFORM
"RTN","SAMIFLD",355,0)
 ;
"RTN","SAMIFLD",356,0)
 ;
"RTN","SAMIFLD",357,0)
 ;
"RTN","SAMIFLD",358,0)
 ;@ppi-code $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",359,0)
GETLAST5 ; last5 for patient sid
"RTN","SAMIFLD",360,0)
 ;
"RTN","SAMIFLD",361,0)
 ;@signature
"RTN","SAMIFLD",362,0)
 ; $$GETHDR^SAMIFORM(sid)
"RTN","SAMIFLD",363,0)
 ;@branches-from
"RTN","SAMIFLD",364,0)
 ; GETLAST5^SAMIFORM
"RTN","SAMIFLD",365,0)
 ;@ppi-called-by
"RTN","SAMIFLD",366,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",367,0)
 ; LOAD
"RTN","SAMIFLD",368,0)
 ;@called-by: none
"RTN","SAMIFLD",369,0)
 ;@calls
"RTN","SAMIFLD",370,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",371,0)
 ;@input
"RTN","SAMIFLD",372,0)
 ; sid = patient study id
"RTN","SAMIFLD",373,0)
 ;@output = patient's BS5 (first initial of last name, last 4 of ssn)
"RTN","SAMIFLD",374,0)
 ;@tests
"RTN","SAMIFLD",375,0)
 ; UTGLST5^SAMIUTF2: last5 for patient sid
"RTN","SAMIFLD",376,0)
 ;
"RTN","SAMIFLD",377,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",378,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",379,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",380,0)
 quit:ien=""
"RTN","SAMIFLD",381,0)
 ;
"RTN","SAMIFLD",382,0)
 quit @root@(ien,"last5") ; end of ppi $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",383,0)
 ;
"RTN","SAMIFLD",384,0)
 ;
"RTN","SAMIFLD",385,0)
 ;
"RTN","SAMIFLD",386,0)
 ;@ppi-code FIXSRC^SAMIFORM
"RTN","SAMIFLD",387,0)
FIXSRC ; fix html src lines to use resources in see/
"RTN","SAMIFLD",388,0)
 ;
"RTN","SAMIFLD",389,0)
 ;@signature
"RTN","SAMIFLD",390,0)
 ; do FIXSRC^SAMIFORM(.SAMILINE)
"RTN","SAMIFLD",391,0)
 ;@branches-from
"RTN","SAMIFLD",392,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIFLD",393,0)
 ;@ppi-called-by
"RTN","SAMIFLD",394,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",395,0)
 ; LOAD
"RTN","SAMIFLD",396,0)
 ;@called-by: none
"RTN","SAMIFLD",397,0)
 ;@calls
"RTN","SAMIFLD",398,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",399,0)
 ;@thruput
"RTN","SAMIFLD",400,0)
 ;.SAMILINE = line of html to change
"RTN","SAMIFLD",401,0)
 ;@tests
"RTN","SAMIFLD",402,0)
 ; UTFSRC^SAMIUTF2: fix html src lines to use resources in see/
"RTN","SAMIFLD",403,0)
 ;
"RTN","SAMIFLD",404,0)
 if SAMILINE["src=" do  ;
"RTN","SAMIFLD",405,0)
 . if SAMILINE["src=""http" quit
"RTN","SAMIFLD",406,0)
 . if SAMILINE["src=""/" do  quit
"RTN","SAMIFLD",407,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=""/","src=""/see/sami/")
"RTN","SAMIFLD",408,0)
 . . quit
"RTN","SAMIFLD",409,0)
 . if SAMILINE["src=""" do  quit
"RTN","SAMIFLD",410,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=""","src=""/see/sami/")
"RTN","SAMIFLD",411,0)
 . . quit
"RTN","SAMIFLD",412,0)
 . if SAMILINE["src=" do
"RTN","SAMIFLD",413,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=","src=/see/sami/")
"RTN","SAMIFLD",414,0)
 . . quit
"RTN","SAMIFLD",415,0)
 . quit
"RTN","SAMIFLD",416,0)
 ;
"RTN","SAMIFLD",417,0)
 quit  ; end of ppi FIXSRC^SAMIFORM
"RTN","SAMIFLD",418,0)
 ;
"RTN","SAMIFLD",419,0)
 ;
"RTN","SAMIFLD",420,0)
 ;
"RTN","SAMIFLD",421,0)
 ;@ppi-code FIXHREF^SAMIFORM
"RTN","SAMIFLD",422,0)
FIXHREF ; fix html href lines to use resources in see/
"RTN","SAMIFLD",423,0)
 ;
"RTN","SAMIFLD",424,0)
 ;@signature
"RTN","SAMIFLD",425,0)
 ; do FIXHREF^SAMIFORM(.SAMILINE)
"RTN","SAMIFLD",426,0)
 ;@branches-from
"RTN","SAMIFLD",427,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIFLD",428,0)
 ;@ppi-called-by
"RTN","SAMIFLD",429,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",430,0)
 ; LOAD
"RTN","SAMIFLD",431,0)
 ;@called-by: none
"RTN","SAMIFLD",432,0)
 ;@calls
"RTN","SAMIFLD",433,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",434,0)
 ;@thruput
"RTN","SAMIFLD",435,0)
 ;.SAMILINE = line of html to change
"RTN","SAMIFLD",436,0)
 ;@tests
"RTN","SAMIFLD",437,0)
 ; UTFHREF^SAMIUTF2: fix html href lines to use resources in see/
"RTN","SAMIFLD",438,0)
 ;
"RTN","SAMIFLD",439,0)
 if SAMILINE["href=" do  ;
"RTN","SAMIFLD",440,0)
 . quit:SAMILINE["href=""#"
"RTN","SAMIFLD",441,0)
 . quit:SAMILINE["href='#"
"RTN","SAMIFLD",442,0)
 . quit:SAMILINE["href=""http"
"RTN","SAMIFLD",443,0)
 . quit:SAMILINE["/vapals"
"RTN","SAMIFLD",444,0)
 . if SAMILINE["href=""/" do  quit
"RTN","SAMIFLD",445,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=""/","href=""/","href=""/see/sami/")
"RTN","SAMIFLD",446,0)
 . . quit
"RTN","SAMIFLD",447,0)
 . if SAMILINE["href=""" do  quit
"RTN","SAMIFLD",448,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=""","href=""/see/sami/")
"RTN","SAMIFLD",449,0)
 . . quit
"RTN","SAMIFLD",450,0)
 . if SAMILINE["href=" do  quit
"RTN","SAMIFLD",451,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=","href=/see/sami/")
"RTN","SAMIFLD",452,0)
 . . quit
"RTN","SAMIFLD",453,0)
 . quit
"RTN","SAMIFLD",454,0)
 ;
"RTN","SAMIFLD",455,0)
 quit  ; end of ppi FIXHREF^SAMIFORM
"RTN","SAMIFLD",456,0)
 ;
"RTN","SAMIFLD",457,0)
 ;
"RTN","SAMIFLD",458,0)
 ;
"RTN","SAMIFLD",459,0)
 ;@section 3 code for ppis $$GETNAME^SAMIFORM,$$GETSSN^SAMIFORM
"RTN","SAMIFLD",460,0)
 ;
"RTN","SAMIFLD",461,0)
 ;
"RTN","SAMIFLD",462,0)
 ;
"RTN","SAMIFLD",463,0)
 ;@ppi-code $$GETNAME^SAMIFORM
"RTN","SAMIFLD",464,0)
GETNAME ; name for patient sid
"RTN","SAMIFLD",465,0)
 ;
"RTN","SAMIFLD",466,0)
 ;@signature
"RTN","SAMIFLD",467,0)
 ; $$GETNAME^SAMIFORM(sid)
"RTN","SAMIFLD",468,0)
 ;@branches-from
"RTN","SAMIFLD",469,0)
 ; GETNAME^SAMIFORM
"RTN","SAMIFLD",470,0)
 ;@ppi-called-by
"RTN","SAMIFLD",471,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",472,0)
 ;@called-by: none
"RTN","SAMIFLD",473,0)
 ;@calls
"RTN","SAMIFLD",474,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",475,0)
 ;@input
"RTN","SAMIFLD",476,0)
 ; sid = patient study id
"RTN","SAMIFLD",477,0)
 ;@output = patient's name
"RTN","SAMIFLD",478,0)
 ;@tests
"RTN","SAMIFLD",479,0)
 ; UTGTNM^SAMIUTF2: name for patient sid
"RTN","SAMIFLD",480,0)
 ;
"RTN","SAMIFLD",481,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",482,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",483,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",484,0)
 quit:ien=""
"RTN","SAMIFLD",485,0)
 ;
"RTN","SAMIFLD",486,0)
 quit @root@(ien,"saminame") ; end of ppi $$GETNAME^SAMIFORM
"RTN","SAMIFLD",487,0)
 ;
"RTN","SAMIFLD",488,0)
 ;
"RTN","SAMIFLD",489,0)
 ;
"RTN","SAMIFLD",490,0)
 ;@ppi-code $$GETSSN^SAMIFORM
"RTN","SAMIFLD",491,0)
GETSSN ; ssn for patient sid
"RTN","SAMIFLD",492,0)
 ;
"RTN","SAMIFLD",493,0)
 ;@signature
"RTN","SAMIFLD",494,0)
 ; $$GETSSN^SAMIFORM(sid)
"RTN","SAMIFLD",495,0)
 ;@branches-from
"RTN","SAMIFLD",496,0)
 ; GETSSN^SAMIFORM
"RTN","SAMIFLD",497,0)
 ;@ppi-called-by
"RTN","SAMIFLD",498,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",499,0)
 ;@called-by: none
"RTN","SAMIFLD",500,0)
 ;@calls
"RTN","SAMIFLD",501,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",502,0)
 ;@input
"RTN","SAMIFLD",503,0)
 ; sid = patient study id
"RTN","SAMIFLD",504,0)
 ;@output = patient's ssn
"RTN","SAMIFLD",505,0)
 ;@tests
"RTN","SAMIFLD",506,0)
 ; UTGSSN^SAMIUTF2: ssn for patient sid
"RTN","SAMIFLD",507,0)
 ;
"RTN","SAMIFLD",508,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",509,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",510,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",511,0)
 quit:ien=""
"RTN","SAMIFLD",512,0)
 ;
"RTN","SAMIFLD",513,0)
 new pssn set pssn=$get(@root@(ien,"sissn"))
"RTN","SAMIFLD",514,0)
 if pssn["sta" set pssn=""
"RTN","SAMIFLD",515,0)
 if pssn="" do  ;
"RTN","SAMIFLD",516,0)
 . new orgssn set orgssn=$get(@root@(ien,"ssn"))
"RTN","SAMIFLD",517,0)
 . quit:orgssn=""
"RTN","SAMIFLD",518,0)
 . set pssn=$extract(orgssn,1,3)_"-"_$extract(orgssn,4,5)_"-"_$extract(orgssn,6,9)
"RTN","SAMIFLD",519,0)
 . set @root@(ien,"sissn")=pssn
"RTN","SAMIFLD",520,0)
 . quit
"RTN","SAMIFLD",521,0)
 ;
"RTN","SAMIFLD",522,0)
 quit pssn ; end of $$GETSSN^SAMIFORM
"RTN","SAMIFLD",523,0)
 ;
"RTN","SAMIFLD",524,0)
GETPRFX ; Retrieve study ID prefix from parameter file
"RTN","SAMIFLD",525,0)
 ; This routine is depricated as of the multi-tenancy features
"RTN","SAMIFLD",526,0)
 ;
"RTN","SAMIFLD",527,0)
 ;@signature
"RTN","SAMIFLD",528,0)
 ; $$GETPRFX^SAMIFORM()
"RTN","SAMIFLD",529,0)
 ;@branches-from
"RTN","SAMIFLD",530,0)
 ; GETPRFX^SAMIFORM
"RTN","SAMIFLD",531,0)
 ;@ppi-called-by
"RTN","SAMIFLD",532,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",533,0)
 ;@calls
"RTN","SAMIFLD",534,0)
 ; $$GET^XPAR
"RTN","SAMIFLD",535,0)
 ;@output = patient's ssn
"RTN","SAMIFLD",536,0)
 ;@tests
"RTN","SAMIFLD",537,0)
 ; None yet
"RTN","SAMIFLD",538,0)
 ;
"RTN","SAMIFLD",539,0)
 new prefix
"RTN","SAMIFLD",540,0)
 ;set prefix=$$GET^XPAR("SYS","SAMI SID PREFIX",,"Q")
"RTN","SAMIFLD",541,0)
 s prefix=$g(ARG("siteid"))
"RTN","SAMIFLD",542,0)
 i prefix="" s prefix=$g(ARG("site"))
"RTN","SAMIFLD",543,0)
 if $get(prefix)="" set prefix="UNK"
"RTN","SAMIFLD",544,0)
 ;
"RTN","SAMIFLD",545,0)
 quit prefix ; End of $$GETPRFX^SAMIFORM
"RTN","SAMIFLD",546,0)
 ;
"RTN","SAMIFLD",547,0)
 ;
"RTN","SAMIFLD",548,0)
EOR ; end of routine SAMIFLD
"VER")
8.0^22.2
**END**
**END**
