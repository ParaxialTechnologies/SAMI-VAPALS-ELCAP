KIDS Distribution saved on Mar 23, 2021@13:07:15
Released SAMI*18.0*10 SEQ #10 (1.18.0.10-i10)
**KIDS**:SAMI*18.0*10^

**INSTALL NAME**
SAMI*18.0*10
"BLD",11507,0)
SAMI*18.0*10^SAMI^0^3210323^n
"BLD",11507,1,0)
^^1^1^3210310^
"BLD",11507,1,1,0)
Corrections to the CT Eval report
"BLD",11507,4,0)
^9.64PA^^
"BLD",11507,6)
^10
"BLD",11507,6.3)
3
"BLD",11507,"KRN",0)
^9.67PA^1.5^25
"BLD",11507,"KRN",.4,0)
.4
"BLD",11507,"KRN",.401,0)
.401
"BLD",11507,"KRN",.402,0)
.402
"BLD",11507,"KRN",.403,0)
.403
"BLD",11507,"KRN",.5,0)
.5
"BLD",11507,"KRN",.84,0)
.84
"BLD",11507,"KRN",1.5,0)
1.5
"BLD",11507,"KRN",1.6,0)
1.6
"BLD",11507,"KRN",1.61,0)
1.61
"BLD",11507,"KRN",1.62,0)
1.62
"BLD",11507,"KRN",3.6,0)
3.6
"BLD",11507,"KRN",3.8,0)
3.8
"BLD",11507,"KRN",9.2,0)
9.2
"BLD",11507,"KRN",9.8,0)
9.8
"BLD",11507,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",11507,"KRN",9.8,"NM",1,0)
SAMICTT0^^0^B95163696
"BLD",11507,"KRN",9.8,"NM",2,0)
SAMICTT1^^0^B117982335
"BLD",11507,"KRN",9.8,"NM",3,0)
SAMICTT2^^0^B115984956
"BLD",11507,"KRN",9.8,"NM",4,0)
SAMICTT3^^0^B222224982
"BLD",11507,"KRN",9.8,"NM",5,0)
SAMICTT4^^0^B54435090
"BLD",11507,"KRN",9.8,"NM",6,0)
SAMICTT9^^0^B17246420
"BLD",11507,"KRN",9.8,"NM",7,0)
SAMICTTA^^0^B34902655
"BLD",11507,"KRN",9.8,"NM",8,0)
SAMIFLD^^0^B215854610
"BLD",11507,"KRN",9.8,"NM",9,0)
SAMICTUL^^0^B93951
"BLD",11507,"KRN",9.8,"NM",10,0)
SAMIFUL^^0^B129116
"BLD",11507,"KRN",9.8,"NM",11,0)
SAMINOT1^^0^B436917317
"BLD",11507,"KRN",9.8,"NM",12,0)
SAMIUR^^0^B283175290
"BLD",11507,"KRN",9.8,"NM",13,0)
SAMINUL^^0^B99724
"BLD",11507,"KRN",9.8,"NM","B","SAMICTT0",1)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTT1",2)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTT2",3)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTT3",4)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTT4",5)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTT9",6)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTTA",7)

"BLD",11507,"KRN",9.8,"NM","B","SAMICTUL",9)

"BLD",11507,"KRN",9.8,"NM","B","SAMIFLD",8)

"BLD",11507,"KRN",9.8,"NM","B","SAMIFUL",10)

"BLD",11507,"KRN",9.8,"NM","B","SAMINOT1",11)

"BLD",11507,"KRN",9.8,"NM","B","SAMINUL",13)

"BLD",11507,"KRN",9.8,"NM","B","SAMIUR",12)

"BLD",11507,"KRN",19,0)
19
"BLD",11507,"KRN",19.1,0)
19.1
"BLD",11507,"KRN",101,0)
101
"BLD",11507,"KRN",409.61,0)
409.61
"BLD",11507,"KRN",771,0)
771
"BLD",11507,"KRN",779.2,0)
779.2
"BLD",11507,"KRN",870,0)
870
"BLD",11507,"KRN",8989.51,0)
8989.51
"BLD",11507,"KRN",8989.52,0)
8989.52
"BLD",11507,"KRN",8993,0)
8993
"BLD",11507,"KRN",8994,0)
8994
"BLD",11507,"KRN","B",.4,.4)

"BLD",11507,"KRN","B",.401,.401)

"BLD",11507,"KRN","B",.402,.402)

"BLD",11507,"KRN","B",.403,.403)

"BLD",11507,"KRN","B",.5,.5)

"BLD",11507,"KRN","B",.84,.84)

"BLD",11507,"KRN","B",1.5,1.5)

"BLD",11507,"KRN","B",1.6,1.6)

"BLD",11507,"KRN","B",1.61,1.61)

"BLD",11507,"KRN","B",1.62,1.62)

"BLD",11507,"KRN","B",3.6,3.6)

"BLD",11507,"KRN","B",3.8,3.8)

"BLD",11507,"KRN","B",9.2,9.2)

"BLD",11507,"KRN","B",9.8,9.8)

"BLD",11507,"KRN","B",19,19)

"BLD",11507,"KRN","B",19.1,19.1)

"BLD",11507,"KRN","B",101,101)

"BLD",11507,"KRN","B",409.61,409.61)

"BLD",11507,"KRN","B",771,771)

"BLD",11507,"KRN","B",779.2,779.2)

"BLD",11507,"KRN","B",870,870)

"BLD",11507,"KRN","B",8989.51,8989.51)

"BLD",11507,"KRN","B",8989.52,8989.52)

"BLD",11507,"KRN","B",8993,8993)

"BLD",11507,"KRN","B",8994,8994)

"BLD",11507,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11507,"QUES",0)
^9.62^^
"BLD",11507,"REQB",0)
^9.611^6^6
"BLD",11507,"REQB",1,0)
SAMI*18.0*2^1
"BLD",11507,"REQB",2,0)
SAMI*18.0*4^1
"BLD",11507,"REQB",3,0)
SAMI 18.0T05^1
"BLD",11507,"REQB",4,0)
SAMI*18.0*6^1
"BLD",11507,"REQB",5,0)
SAMI*18.0*8^1
"BLD",11507,"REQB",6,0)
SAMI*18.0*9^1
"BLD",11507,"REQB","B","SAMI 18.0T05",3)

"BLD",11507,"REQB","B","SAMI*18.0*2",1)

"BLD",11507,"REQB","B","SAMI*18.0*4",2)

"BLD",11507,"REQB","B","SAMI*18.0*6",4)

"BLD",11507,"REQB","B","SAMI*18.0*8",5)

"BLD",11507,"REQB","B","SAMI*18.0*9",6)

"MBREQ")
0
"PKG",230,-1)
1^1
"PKG",230,0)
SAMI^SAMI^SCREENING APPLICATIONS MANAGEMENT - IELCAP
"PKG",230,22,0)
^9.49I^1^1
"PKG",230,22,1,0)
18.0^3191203
"PKG",230,22,1,"PAH",1,0)
10^3210323^66
"PKG",230,22,1,"PAH",1,1,0)
^^1^1^3210323
"PKG",230,22,1,"PAH",1,1,1,0)
Corrections to the CT Eval report
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","SAMICTT0")
0^1^B95163696
"RTN","SAMICTT0",1,0)
SAMICTT0 ;ven/gpl - ctreport text main ;2021-03-22T15:32Z
"RTN","SAMICTT0",2,0)
 ;;18.0;SAMI;**4,10**;2020-01;Build 3
"RTN","SAMICTT0",3,0)
 ;;1.18.0.10-i10
"RTN","SAMICTT0",4,0)
 ;
"RTN","SAMICTT0",5,0)
 ; SAMICTT0 contains a web route & associated subroutines to produce
"RTN","SAMICTT0",6,0)
 ; the ELCAP CT Report in text format (route ctreport, format text).
"RTN","SAMICTT0",7,0)
 ; SAMICTT* routines serve web service interfaces WSVAPALS^SAMIHOM3
"RTN","SAMICTT0",8,0)
 ; (the main VAPALS-ELCAP post web service) & WSHOME^SAMIHOM3 (the
"RTN","SAMICTT0",9,0)
 ; VAPALS-ELCAP home-page service).
"RTN","SAMICTT0",10,0)
 ;
"RTN","SAMICTT0",11,0)
 quit  ; no entry from top
"RTN","SAMICTT0",12,0)
 ;
"RTN","SAMICTT0",13,0)
 ;
"RTN","SAMICTT0",14,0)
 ;
"RTN","SAMICTT0",15,0)
 ;@section 0 primary development
"RTN","SAMICTT0",16,0)
 ;
"RTN","SAMICTT0",17,0)
 ;
"RTN","SAMICTT0",18,0)
 ;
"RTN","SAMICTT0",19,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT0",20,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT0",21,0)
 ;@contents
"RTN","SAMICTT0",22,0)
 ; WSREPORT: web route: ctreport in text format
"RTN","SAMICTT0",23,0)
 ; OUT: output a line of ct report
"RTN","SAMICTT0",24,0)
 ; OUTOLD: old version of out
"RTN","SAMICTT0",25,0)
 ; HOUT: output a ct report header line
"RTN","SAMICTT0",26,0)
 ; $$XVAL = patient value for var
"RTN","SAMICTT0",27,0)
 ; $$XSUB = dictionary value defined by var
"RTN","SAMICTT0",28,0)
 ; GETFILTR: fill in the filter for Ct Eval for sid
"RTN","SAMICTT0",29,0)
 ; T1: test
"RTN","SAMICTT0",30,0)
 ;
"RTN","SAMICTT0",31,0)
 ;
"RTN","SAMICTT0",32,0)
 ;
"RTN","SAMICTT0",33,0)
 ;@section 1 wsi WSREPORT & related subroutines
"RTN","SAMICTT0",34,0)
 ;
"RTN","SAMICTT0",35,0)
 ;
"RTN","SAMICTT0",36,0)
 ;
"RTN","SAMICTT0",37,0)
 ;@wsr WSREPORT^SAMICTT0
"RTN","SAMICTT0",38,0)
WSREPORT(return,filter) ; web route: ctreport in text format
"RTN","SAMICTT0",39,0)
 ;
"RTN","SAMICTT0",40,0)
 ;@called-by
"RTN","SAMICTT0",41,0)
 ; WSNOTE^SAMINOT3
"RTN","SAMICTT0",42,0)
 ;  (called-by wsi WSVAPALS^SAMIHOM3)
"RTN","SAMICTT0",43,0)
 ;    (called by wsi WSHOME^SAMIHOM3)
"RTN","SAMICTT0",44,0)
 ;  (sibling to wri WSREPORT^SAMICTR0, keep in sync)
"RTN","SAMICTT0",45,0)
 ;@calls
"RTN","SAMICTT0",46,0)
 ; INIT2GPH^SAMICTD2
"RTN","SAMICTT0",47,0)
 ; $$setroot^%wd
"RTN","SAMICTT0",48,0)
 ; $$XVAL
"RTN","SAMICTT0",49,0)
 ; OUT
"RTN","SAMICTT0",50,0)
 ; $$XSUB
"RTN","SAMICTT0",51,0)
 ; HOUT
"RTN","SAMICTT0",52,0)
 ; NODULES^SAMICTT1
"RTN","SAMICTT0",53,0)
 ; OTHRLUNG^SAMICTT2
"RTN","SAMICTT0",54,0)
 ; EMPHYS^SAMICTT3
"RTN","SAMICTT0",55,0)
 ; BREAST^SAMICTT4
"RTN","SAMICTT0",56,0)
 ; IMPRSN^SAMICTT9
"RTN","SAMICTT0",57,0)
 ; RCMND^SAMICTTA
"RTN","SAMICTT0",58,0)
 ;
"RTN","SAMICTT0",59,0)
 s debug=0
"RTN","SAMICTT0",60,0)
 n outmode s outmode="go"
"RTN","SAMICTT0",61,0)
 n line s line=""
"RTN","SAMICTT0",62,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMICTT0",63,0)
 ;
"RTN","SAMICTT0",64,0)
 ;s rtn=$na(^TMP("SAMICTT",$J))
"RTN","SAMICTT0",65,0)
 s rtn="return"
"RTN","SAMICTT0",66,0)
 k @rtn
"RTN","SAMICTT0",67,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMICTT0",68,0)
 ;
"RTN","SAMICTT0",69,0)
 n cnt s cnt=0 ; line number
"RTN","SAMICTT0",70,0)
 ;
"RTN","SAMICTT0",71,0)
 ; set up dictionary and patient values
"RTN","SAMICTT0",72,0)
 ;
"RTN","SAMICTT0",73,0)
 n dict,vals
"RTN","SAMICTT0",74,0)
 ;d INIT^SAMICTD2("dict")
"RTN","SAMICTT0",75,0)
 s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT0",76,0)
 s dict=$na(@dict@("cteval-dict"))
"RTN","SAMICTT0",77,0)
 i $g(@dict@("pet"))="" d INIT2GPH^SAMICTD2 ; init dictionary 1st time
"RTN","SAMICTT0",78,0)
 n si
"RTN","SAMICTT0",79,0)
 s si=$g(filter("studyid"))
"RTN","SAMICTT0",80,0)
 i si="" d  ;
"RTN","SAMICTT0",81,0)
 . s si="XXX00102"
"RTN","SAMICTT0",82,0)
 q:si=""
"RTN","SAMICTT0",83,0)
 n samikey
"RTN","SAMICTT0",84,0)
 s samikey=$g(filter("form"))
"RTN","SAMICTT0",85,0)
 i samikey="" d  ;
"RTN","SAMICTT0",86,0)
 . s samikey="ceform-2018-10-09"
"RTN","SAMICTT0",87,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICTT0",88,0)
 i $g(filter("studyid"))="" s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICTT0",89,0)
 s vals=$na(@root@("graph",si,samikey))
"RTN","SAMICTT0",90,0)
 ;W !,vals
"RTN","SAMICTT0",91,0)
 ;zwr @vals@(*)
"RTN","SAMICTT0",92,0)
 i '$d(@vals) d  q  ;
"RTN","SAMICTT0",93,0)
 . w !,"error, patient values not found"
"RTN","SAMICTT0",94,0)
 ;
"RTN","SAMICTT0",95,0)
 ; report parameters
"RTN","SAMICTT0",96,0)
 ;
"RTN","SAMICTT0",97,0)
 n nt,sectionheader,dummy,cac,tex,para,legout
"RTN","SAMICTT0",98,0)
 ;; n lang,lanread
"RTN","SAMICTT0",99,0)
 ;
"RTN","SAMICTT0",100,0)
 s nt=1
"RTN","SAMICTT0",101,0)
 s sectionheader=1
"RTN","SAMICTT0",102,0)
 ;;s dummy="******"
"RTN","SAMICTT0",103,0)
 s cac=""
"RTN","SAMICTT0",104,0)
 n cacrec s cacrec=""
"RTN","SAMICTT0",105,0)
 ;;s tex=0
"RTN","SAMICTT0",106,0)
 ;s para="<p>"
"RTN","SAMICTT0",107,0)
 ;s para=$char(13,10)
"RTN","SAMICTT0",108,0)
 s para=""
"RTN","SAMICTT0",109,0)
 ;;s legout=0
"RTN","SAMICTT0",110,0)
 n qheader s qheader=0
"RTN","SAMICTT0",111,0)
 ;
"RTN","SAMICTT0",112,0)
 n lang s lang=""
"RTN","SAMICTT0",113,0)
 n langread s langread=0
"RTN","SAMICTT0",114,0)
 ;
"RTN","SAMICTT0",115,0)
 n auth s auth("perm")="a"
"RTN","SAMICTT0",116,0)
 s auth("inst")=$g(filter("auth"))
"RTN","SAMICTT0",117,0)
 ;
"RTN","SAMICTT0",118,0)
 n newct s newct=0
"RTN","SAMICTT0",119,0)
 i $$XVAL("ceoppa",vals)'="" s newct=1
"RTN","SAMICTT0",120,0)
 ;
"RTN","SAMICTT0",121,0)
 n registryForm s registryForm=0
"RTN","SAMICTT0",122,0)
 i $$XVAL("ceaf",vals)'="" s registryForm=1
"RTN","SAMICTT0",123,0)
 ;
"RTN","SAMICTT0",124,0)
 ;d OUT("<HTML>")
"RTN","SAMICTT0",125,0)
 ;d OUT("<HEAD>")
"RTN","SAMICTT0",126,0)
 ;d OUT("<!-- Calling TR: CT Evaluation Report -->")
"RTN","SAMICTT0",127,0)
 ;d OUT("<TITLE>CT Evaluation Report</TITLE>")
"RTN","SAMICTT0",128,0)
 ;d OUT("<link rel='stylesheet' href='/css/report.css'>")
"RTN","SAMICTT0",129,0)
 ;d OUT("</HEAD>")
"RTN","SAMICTT0",130,0)
 ;d OUT("<BODY BGCOLOR=""#ffffff"" TEXT=""#000000"">")
"RTN","SAMICTT0",131,0)
 ;;d OUT("<TABLE border=""0"" cellspacing=""0"" cellpadding=""3"" WIDTH=""640""><TR><TD>")
"RTN","SAMICTT0",132,0)
 ;d OUT("<FONT SIZE=""+2""><CENTER>")
"RTN","SAMICTT0",133,0)
 ;d OUT("<!-- Calling TR: CT Evaluation Report -->")
"RTN","SAMICTT0",134,0)
 ;d OUT("<B>CT Evaluation Report</B>")
"RTN","SAMICTT0",135,0)
 d OUT("CT Evaluation Report")
"RTN","SAMICTT0",136,0)
 ;d OUT("</CENTER></FONT>")
"RTN","SAMICTT0",137,0)
 ;d OUT("</TD></TR><TR><TD>")
"RTN","SAMICTT0",138,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT0",139,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT0",140,0)
 ;
"RTN","SAMICTT0",141,0)
 ;d OUT("<!-- patient information -->")
"RTN","SAMICTT0",142,0)
 ;d OUT("<TR><TD><TABLE border=""0"" cellspacing=""0"" cellpadding=""3"" WIDTH=""640"">")
"RTN","SAMICTT0",143,0)
 ;
"RTN","SAMICTT0",144,0)
 ; generate header
"RTN","SAMICTT0",145,0)
 ;
"RTN","SAMICTT0",146,0)
 d  ;
"RTN","SAMICTT0",147,0)
 . n pname
"RTN","SAMICTT0",148,0)
 . ;s pname=$$XVAL("sinamel",vals)_", "_$$XVAL("sinamef",vals)
"RTN","SAMICTT0",149,0)
 . s pname=$$XVAL("saminame",vals)
"RTN","SAMICTT0",150,0)
 . d OUT("Participant Name: "_pname)
"RTN","SAMICTT0",151,0)
 ;d OUT("<TR><TD WIDTH=""180""><B>Participant Name:</B></TD><TD WIDTH=""365"">")
"RTN","SAMICTT0",152,0)
 ;d OUT($$XVAL("sinamel",vals)_", "_$$XVAL("sinamef",vals))
"RTN","SAMICTT0",153,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",154,0)
 ;
"RTN","SAMICTT0",155,0)
 d  ;
"RTN","SAMICTT0",156,0)
 . n sid s sid=$$XVAL("sisid",vals)
"RTN","SAMICTT0",157,0)
 . d OUT("Study ID: "_sid)
"RTN","SAMICTT0",158,0)
 ;d OUT("<TD WIDTH=""120""><B>Study ID:</B></TD><TD WIDTH=""75"">")
"RTN","SAMICTT0",159,0)
 ;d OUT($$XVAL("sisid",vals))
"RTN","SAMICTT0",160,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",161,0)
 ;
"RTN","SAMICTT0",162,0)
 d  ;
"RTN","SAMICTT0",163,0)
 . n etype s etype=$$XSUB("cetex",vals,dict)_" "_$$XSUB("cectp",vals,dict)
"RTN","SAMICTT0",164,0)
 . d OUT("Type of Examination: "_etype)
"RTN","SAMICTT0",165,0)
 ;d OUT("<TR><TD><B>Type of Examination:</B></TD><TD>")
"RTN","SAMICTT0",166,0)
 ;d OUT($$XSUB("cetex",vals,dict)_" "_$$XSUB("cectp",vals,dict))
"RTN","SAMICTT0",167,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",168,0)
 ;d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",169,0)
 ;
"RTN","SAMICTT0",170,0)
 d  ;
"RTN","SAMICTT0",171,0)
 . n edate s edate=$$XVAL("cedos",vals)
"RTN","SAMICTT0",172,0)
 . d OUT("Examination Date: "_edate)
"RTN","SAMICTT0",173,0)
 ;d OUT("<TR><TD><B>Examination Date:</B></TD><TD>")
"RTN","SAMICTT0",174,0)
 ;d OUT($$XVAL("cedos",vals))
"RTN","SAMICTT0",175,0)
 ;
"RTN","SAMICTT0",176,0)
 ;i $$XVAL("sidob",vals)'=-1 d  ;
"RTN","SAMICTT0",177,0)
 ;. d OUT("<TD><B>Date of Birth:</B></TD><TD>")
"RTN","SAMICTT0",178,0)
 ;. d OUT($$XVAL("sidob",vals))
"RTN","SAMICTT0",179,0)
 ;e  d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",180,0)
 ;
"RTN","SAMICTT0",181,0)
 d  ;
"RTN","SAMICTT0",182,0)
 . n dob s dob=$$XVAL("sidob",vals)
"RTN","SAMICTT0",183,0)
 . i dob>0 d OUT("Date of Birth: "_dob)
"RTN","SAMICTT0",184,0)
 . d OUT("")
"RTN","SAMICTT0",185,0)
 ;i $$XVAL("sidob",vals)>0 d  ;
"RTN","SAMICTT0",186,0)
 ;. d OUT("<TD><B>Date of Birth:</B></TD><TD>")
"RTN","SAMICTT0",187,0)
 ;. d OUT($$XVAL("sidob",vals))
"RTN","SAMICTT0",188,0)
 ;. d OUT("</TD></TR>")
"RTN","SAMICTT0",189,0)
 ;e  d  ;
"RTN","SAMICTT0",190,0)
 ;. d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",191,0)
 ;
"RTN","SAMICTT0",192,0)
 ;# End of Header
"RTN","SAMICTT0",193,0)
 ;
"RTN","SAMICTT0",194,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTT0",195,0)
 ;;d OUT("</TD></TR><TR><TD>")
"RTN","SAMICTT0",196,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT0",197,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT0",198,0)
 ;d OUT("<!-- report -->")
"RTN","SAMICTT0",199,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTT0",200,0)
 ;d OUT("<FONT SIZE=""+2""><B>")
"RTN","SAMICTT0",201,0)
 ;d OUT("Report:")
"RTN","SAMICTT0",202,0)
 ;d OUT("</B></FONT>")
"RTN","SAMICTT0",203,0)
 ;d OUT("</TD></TR><TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTT0",204,0)
 d OUT("Report:")
"RTN","SAMICTT0",205,0)
 ;
"RTN","SAMICTT0",206,0)
 s outmode="hold"
"RTN","SAMICTT0",207,0)
 s line=""
"RTN","SAMICTT0",208,0)
 i $$XVAL("ceclin",vals)'="" d  ;
"RTN","SAMICTT0",209,0)
 . d HOUT("Clinical Information: ")
"RTN","SAMICTT0",210,0)
 . d OUT($$XVAL("ceclin",vals))
"RTN","SAMICTT0",211,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT0",212,0)
 ;
"RTN","SAMICTT0",213,0)
 s outmode="hold"
"RTN","SAMICTT0",214,0)
 n nopri s nopri=1
"RTN","SAMICTT0",215,0)
 d HOUT("Comparison CT Scans: ")
"RTN","SAMICTT0",216,0)
 if $$XVAL("cedcs",vals)'="" d  ;
"RTN","SAMICTT0",217,0)
 . d OUT($$XSUB("cetex",vals,dict)_". ")
"RTN","SAMICTT0",218,0)
 . d OUT("Comparisons: "_$$XVAL("cedcs",vals))
"RTN","SAMICTT0",219,0)
 . s nopri=0
"RTN","SAMICTT0",220,0)
 if $$XVAL("cedps",vals)'="" d  ;
"RTN","SAMICTT0",221,0)
 . d OUT(" "_$$XVAL("cedps",vals))
"RTN","SAMICTT0",222,0)
 . s nopri=0
"RTN","SAMICTT0",223,0)
 d:nopri OUT("None")
"RTN","SAMICTT0",224,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT0",225,0)
 ;
"RTN","SAMICTT0",226,0)
 s outmode="hold"
"RTN","SAMICTT0",227,0)
 d HOUT(" Description: ")
"RTN","SAMICTT0",228,0)
 i $$XVAL("cectp",vals)="i" d  ;
"RTN","SAMICTT0",229,0)
 . d OUT("Limited Diagnostic CT examination was performed. ")
"RTN","SAMICTT0",230,0)
 e  d  ;
"RTN","SAMICTT0",231,0)
 . d OUT("CT examination of the entire thorax was performed at "_$$XSUB("cectp",vals,dict)_" settings. ")
"RTN","SAMICTT0",232,0)
 ;
"RTN","SAMICTT0",233,0)
 i $$XVAL("cectrst",vals)'="" d  ;
"RTN","SAMICTT0",234,0)
 . d OUT(" Images were obtained at "_$$XVAL("cectrst",vals)_" mm slice thickness. ")
"RTN","SAMICTT0",235,0)
 . d OUT(" Multiplanar reconstructions were performed. ")
"RTN","SAMICTT0",236,0)
 ;
"RTN","SAMICTT0",237,0)
 i newct d  ;
"RTN","SAMICTT0",238,0)
 . n nvadbo s nvadbo=1
"RTN","SAMICTT0",239,0)
 . n ii
"RTN","SAMICTT0",240,0)
 . f ii="ceoaa","ceaga","ceasa","ceala","ceapa","ceaaa","ceaka" d  ;
"RTN","SAMICTT0",241,0)
 . . i $$XVAL(ii,vals)="y" set nvadbo=0
"RTN","SAMICTT0",242,0)
 . ;
"RTN","SAMICTT0",243,0)
 . i nvadbo=1 d  ;
"RTN","SAMICTT0",244,0)
 . . d OUT("Upper abdominal images were not acquired on the current scan due to its limited nature. ")
"RTN","SAMICTT0",245,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT0",246,0)
 ;
"RTN","SAMICTT0",247,0)
 ; lung nodules
"RTN","SAMICTT0",248,0)
 ;
"RTN","SAMICTT0",249,0)
 ;d OUT("")
"RTN","SAMICTT0",250,0)
 d HOUT("Lung Nodules:")
"RTN","SAMICTT0",251,0)
 ;d OUT("")
"RTN","SAMICTT0",252,0)
 ;
"RTN","SAMICTT0",253,0)
 ; see if there are any nodules using the cectXch fields
"RTN","SAMICTT0",254,0)
 ;
"RTN","SAMICTT0",255,0)
 n ij,hasnodules s hasnodules=0
"RTN","SAMICTT0",256,0)
 f ij=1:1:10 i ($$XVAL("cect"_ij_"ch",vals)'="")&($$XVAL("cect"_ij_"ch",vals)'="-") s hasnodules=1
"RTN","SAMICTT0",257,0)
 ;
"RTN","SAMICTT0",258,0)
 i hasnodules=0 d  ;
"RTN","SAMICTT0",259,0)
 . d OUT(para)
"RTN","SAMICTT0",260,0)
 . d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",261,0)
 ;
"RTN","SAMICTT0",262,0)
 ;i $$XVAL("cennod",vals)="" d  ;
"RTN","SAMICTT0",263,0)
 ;. d OUT(para)
"RTN","SAMICTT0",264,0)
 ;. d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",265,0)
 ;e  i $$XVAL("ceanod",vals)="n" d  ;
"RTN","SAMICTT0",266,0)
 ;. d OUT(para)
"RTN","SAMICTT0",267,0)
 ;. d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",268,0)
 ;
"RTN","SAMICTT0",269,0)
 d NODULES^SAMICTT1(rtn,.vals,.dict)
"RTN","SAMICTT0",270,0)
 ;
"RTN","SAMICTT0",271,0)
 d OTHRLUNG^SAMICTT2(rtn,.vals,.dict)
"RTN","SAMICTT0",272,0)
 ;
"RTN","SAMICTT0",273,0)
 d EMPHYS^SAMICTT3(rtn,.vals,.dict)
"RTN","SAMICTT0",274,0)
 ;
"RTN","SAMICTT0",275,0)
 d BREAST^SAMICTT4(rtn,.vals,.dict)
"RTN","SAMICTT0",276,0)
 ;
"RTN","SAMICTT0",277,0)
 d IMPRSN^SAMICTT9(rtn,.vals,.dict)
"RTN","SAMICTT0",278,0)
 ;
"RTN","SAMICTT0",279,0)
 d RCMND^SAMICTTA(rtn,.vals,.dict)
"RTN","SAMICTT0",280,0)
 ;
"RTN","SAMICTT0",281,0)
 ; etc etc
"RTN","SAMICTT0",282,0)
 ;
"RTN","SAMICTT0",283,0)
 d  ;
"RTN","SAMICTT0",284,0)
 . d OUT("References:")
"RTN","SAMICTT0",285,0)
 . d OUT("Recommendations for nodules and other findings are detailed in the I-ELCAP Protocol. ")
"RTN","SAMICTT0",286,0)
 . d OUT("A summary and the full I-ELCAP protocol can be viewed at: http://ielcap.org/protocols")
"RTN","SAMICTT0",287,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTT0",288,0)
 ;d OUT("<p><br></p><p><b>References:</b><br></p>")
"RTN","SAMICTT0",289,0)
 ;d OUT("<p>Recommendations for nodules and other findings are detailed in the I-ELCAP Protocol.<BR>")
"RTN","SAMICTT0",290,0)
 ;d OUT("A summary and the full I-ELCAP protocol can be viewed at: <a href=""http://ielcap.org/protocols"">http://ielcap.org/protocols</a></p>")
"RTN","SAMICTT0",291,0)
 ;d OUT("</TD></TR></TABLE></TD></TR></TABLE>")
"RTN","SAMICTT0",292,0)
 ;s debug=1
"RTN","SAMICTT0",293,0)
 d:$g(debug)  ;
"RTN","SAMICTT0",294,0)
 . n zi s zi=""
"RTN","SAMICTT0",295,0)
 . f  s zi=$o(@vals@(zi)) q:zi=""  d  ;
"RTN","SAMICTT0",296,0)
 . . d OUT(zi_" "_$g(@vals@(zi)))
"RTN","SAMICTT0",297,0)
 ;d OUT("</BODY></HTML>")
"RTN","SAMICTT0",298,0)
 ;
"RTN","SAMICTT0",299,0)
 quit  ; end of wsr WSREPORT^SAMICTT0
"RTN","SAMICTT0",300,0)
 ;
"RTN","SAMICTT0",301,0)
 ;
"RTN","SAMICTT0",302,0)
 ;
"RTN","SAMICTT0",303,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT0",304,0)
 ;
"RTN","SAMICTT0",305,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT0",306,0)
 s cnt=cnt+1
"RTN","SAMICTT0",307,0)
 n lnn
"RTN","SAMICTT0",308,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT0",309,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",310,0)
 i outmode="go" d  ;
"RTN","SAMICTT0",311,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT0",312,0)
 . s line=""
"RTN","SAMICTT0",313,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",314,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT0",315,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT0",316,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT0",317,0)
 . n zs s zs=$STACK
"RTN","SAMICTT0",318,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT0",319,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT0",320,0)
 ;
"RTN","SAMICTT0",321,0)
 quit  ; end of OUT
"RTN","SAMICTT0",322,0)
 ;
"RTN","SAMICTT0",323,0)
 ;
"RTN","SAMICTT0",324,0)
 ;
"RTN","SAMICTT0",325,0)
OUTOLD(ln) ; old version of out
"RTN","SAMICTT0",326,0)
 ;
"RTN","SAMICTT0",327,0)
 s cnt=cnt+1
"RTN","SAMICTT0",328,0)
 n lnn
"RTN","SAMICTT0",329,0)
 ;s debug=1
"RTN","SAMICTT0",330,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",331,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT0",332,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT0",333,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT0",334,0)
 . n zs s zs=$STACK
"RTN","SAMICTT0",335,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT0",336,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT0",337,0)
 ;
"RTN","SAMICTT0",338,0)
 quit  ; end of OUTOLD
"RTN","SAMICTT0",339,0)
 ;
"RTN","SAMICTT0",340,0)
 ;
"RTN","SAMICTT0",341,0)
 ;
"RTN","SAMICTT0",342,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTT0",343,0)
 ;
"RTN","SAMICTT0",344,0)
 d OUT(ln)
"RTN","SAMICTT0",345,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT0",346,0)
 ;
"RTN","SAMICTT0",347,0)
 quit  ; end of HOUT
"RTN","SAMICTT0",348,0)
 ;
"RTN","SAMICTT0",349,0)
 ;
"RTN","SAMICTT0",350,0)
 ;
"RTN","SAMICTT0",351,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT0",352,0)
 ;
"RTN","SAMICTT0",353,0)
 ;@input
"RTN","SAMICTT0",354,0)
 ; @vals is passed by name
"RTN","SAMICTT0",355,0)
 ;
"RTN","SAMICTT0",356,0)
 n zr
"RTN","SAMICTT0",357,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT0",358,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT0",359,0)
 ;
"RTN","SAMICTT0",360,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT0",361,0)
 ;
"RTN","SAMICTT0",362,0)
 ;
"RTN","SAMICTT0",363,0)
 ;
"RTN","SAMICTT0",364,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT0",365,0)
 ;
"RTN","SAMICTT0",366,0)
 ; vals and dict are passed by name
"RTN","SAMICTT0",367,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT0",368,0)
 ;
"RTN","SAMICTT0",369,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT0",370,0)
 n zr,zv,zdx
"RTN","SAMICTT0",371,0)
 s zdx=$g(valdx)
"RTN","SAMICTT0",372,0)
 i zdx="" s zdx=var
"RTN","SAMICTT0",373,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT0",374,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT0",375,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT0",376,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT0",377,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT0",378,0)
 ;
"RTN","SAMICTT0",379,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT0",380,0)
 ;
"RTN","SAMICTT0",381,0)
 ;
"RTN","SAMICTT0",382,0)
 ;
"RTN","SAMICTT0",383,0)
GETFILTR(filter,sid) ; fill in the filter for Ct Eval for sid
"RTN","SAMICTT0",384,0)
 ;
"RTN","SAMICTT0",385,0)
 s filter("studyid")=sid
"RTN","SAMICTT0",386,0)
 n items,zform
"RTN","SAMICTT0",387,0)
 d GETITEMS^SAMICASE("items",sid)
"RTN","SAMICTT0",388,0)
 s zform=$o(items("ceform"))
"RTN","SAMICTT0",389,0)
 s filter("form")=zform
"RTN","SAMICTT0",390,0)
 ;zwr filter
"RTN","SAMICTT0",391,0)
 ;
"RTN","SAMICTT0",392,0)
 quit  ; end of GETFILTR
"RTN","SAMICTT0",393,0)
 ;
"RTN","SAMICTT0",394,0)
 ;
"RTN","SAMICTT0",395,0)
 ;
"RTN","SAMICTT0",396,0)
T1(grtn,debug) ; test
"RTN","SAMICTT0",397,0)
 ;
"RTN","SAMICTT0",398,0)
 n filter
"RTN","SAMICTT0",399,0)
 ;n sid s sid="XXX00333"
"RTN","SAMICTT0",400,0)
 ;n sid s sid="XXX00484"
"RTN","SAMICTT0",401,0)
 n sid s sid="XXX9000001"
"RTN","SAMICTT0",402,0)
 d GETFILTR(.filter,sid)
"RTN","SAMICTT0",403,0)
 i $g(debug)=1 s filter("debug")=1
"RTN","SAMICTT0",404,0)
 d WSNOTE^SAMINOT3(.grtn,.filter)
"RTN","SAMICTT0",405,0)
 ;d WSREPORT^SAMICTT0(.grtn,.filter)
"RTN","SAMICTT0",406,0)
 ;
"RTN","SAMICTT0",407,0)
 quit  ; end of T1
"RTN","SAMICTT0",408,0)
 ;
"RTN","SAMICTT0",409,0)
 ;
"RTN","SAMICTT0",410,0)
 ;
"RTN","SAMICTT0",411,0)
EOR ; end of routine SAMICTT0
"RTN","SAMICTT1")
0^2^B117982335
"RTN","SAMICTT1",1,0)
SAMICTT1 ;ven/gpl - ctreport text nodules ;2021-03-22T15:20Z
"RTN","SAMICTT1",2,0)
 ;;18.0;SAMI;**4,10**;2020-01;Build 3
"RTN","SAMICTT1",3,0)
 ;;1.18.0.10-i10
"RTN","SAMICTT1",4,0)
 ;
"RTN","SAMICTT1",5,0)
 ; SAMICTT1 creates the Nodules section of the ELCAP CT Report in text
"RTN","SAMICTT1",6,0)
 ; format.
"RTN","SAMICTT1",7,0)
 ;
"RTN","SAMICTT1",8,0)
 quit  ; no entry from top
"RTN","SAMICTT1",9,0)
 ;
"RTN","SAMICTT1",10,0)
 ;
"RTN","SAMICTT1",11,0)
 ;
"RTN","SAMICTT1",12,0)
 ;@section 0 primary development
"RTN","SAMICTT1",13,0)
 ;
"RTN","SAMICTT1",14,0)
 ;
"RTN","SAMICTT1",15,0)
 ;
"RTN","SAMICTT1",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT1",17,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT1",18,0)
 ;@contents
"RTN","SAMICTT1",19,0)
 ; NODULES: nodules section of ctreport in text format
"RTN","SAMICTT1",20,0)
 ; OUT: output a line of ct report
"RTN","SAMICTT1",21,0)
 ; HOUT: output a ct report header line
"RTN","SAMICTT1",22,0)
 ; $$XVAL = patient value for var
"RTN","SAMICTT1",23,0)
 ; $$XSUB = dictionary value defined by var
"RTN","SAMICTT1",24,0)
 ;
"RTN","SAMICTT1",25,0)
 ;
"RTN","SAMICTT1",26,0)
 ;
"RTN","SAMICTT1",27,0)
 ;@section 1 NODULES & related subroutines
"RTN","SAMICTT1",28,0)
 ;
"RTN","SAMICTT1",29,0)
 ;
"RTN","SAMICTT1",30,0)
 ;
"RTN","SAMICTT1",31,0)
NODULES(rtn,vals,dict) ; nodules section of ctreport in text format
"RTN","SAMICTT1",32,0)
 ;
"RTN","SAMICTT1",33,0)
 ;@called-by
"RTN","SAMICTT1",34,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT1",35,0)
 ;@calls
"RTN","SAMICTT1",36,0)
 ; $$XVAL
"RTN","SAMICTT1",37,0)
 ; OUT
"RTN","SAMICTT1",38,0)
 ; $$XSUB
"RTN","SAMICTT1",39,0)
 ; HOUT
"RTN","SAMICTT1",40,0)
 ;@input
"RTN","SAMICTT1",41,0)
 ; rtn
"RTN","SAMICTT1",42,0)
 ; vals
"RTN","SAMICTT1",43,0)
 ; dict
"RTN","SAMICTT1",44,0)
 ;@output: nodules section added to cteval report
"RTN","SAMICTT1",45,0)
 ;
"RTN","SAMICTT1",46,0)
 ;# Report on Nodules
"RTN","SAMICTT1",47,0)
 n firstitem
"RTN","SAMICTT1",48,0)
 set firstitem=0
"RTN","SAMICTT1",49,0)
 n outmode s outmode="hold"
"RTN","SAMICTT1",50,0)
 n line s line=""
"RTN","SAMICTT1",51,0)
 n ii set ii=1
"RTN","SAMICTT1",52,0)
 ;# Information for each nodule
"RTN","SAMICTT1",53,0)
 f ii=1:1:10 d  ;
"RTN","SAMICTT1",54,0)
 . i $$XSUB("cectch",vals,dict,"cect"_ii_"ch")="px" q  ;
"RTN","SAMICTT1",55,0)
 . i $$XSUB("cectch",vals,dict,"cect"_ii_"ch")="" q  ;
"RTN","SAMICTT1",56,0)
 . i firstitem=0 d  ;
"RTN","SAMICTT1",57,0)
 . . ;d OUT("<!-- begin nodule info -->")
"RTN","SAMICTT1",58,0)
 . . ;d OUT("<UL TYPE=disc>")
"RTN","SAMICTT1",59,0)
 . . set firstitem=1
"RTN","SAMICTT1",60,0)
 . ;
"RTN","SAMICTT1",61,0)
 . ;d OUT("<LI>")
"RTN","SAMICTT1",62,0)
 . n specialcase s specialcase=0
"RTN","SAMICTT1",63,0)
 . n ij,ik
"RTN","SAMICTT1",64,0)
 . s ik=$$XVAL("cect"_ii_"ch",vals)
"RTN","SAMICTT1",65,0)
 . ;f ij="pw","px","pr","pv" i ij=ik s specialcase=1
"RTN","SAMICTT1",66,0)
 . i "pwpxprpv"[ik s specialcase=1
"RTN","SAMICTT1",67,0)
 . ;
"RTN","SAMICTT1",68,0)
 . ;# Example Sentence
"RTN","SAMICTT1",69,0)
 . ;# LUL Nodule 1 is non-calcified, non-solid, 6 mm x 6 mm (with 3 x 3) solid component), smooth edge, previously seen and unchanged. (Series 2, Image 65)
"RTN","SAMICTT1",70,0)
 . ;# [LOCATION] Nodule [N] is [CALCIFICATION], [SOLID], [L] mm x mm, [SMOOTH], [NEW].  (Series [Series], Image [ImageNum]).
"RTN","SAMICTT1",71,0)
 . ;
"RTN","SAMICTT1",72,0)
 . n spic s spic=""
"RTN","SAMICTT1",73,0)
 . i $$XVAL("cect"_ii_"sp",vals)="y" s spic="spiculated, "
"RTN","SAMICTT1",74,0)
 . ;
"RTN","SAMICTT1",75,0)
 . n calcification,calcstr,status
"RTN","SAMICTT1",76,0)
 . s status=$$XVAL("cect"_ii_"st",vals)
"RTN","SAMICTT1",77,0)
 . s @vals@("cect"_ii_"ca")=$s(status="bc":"y",status="pc":"q",1:"n")
"RTN","SAMICTT1",78,0)
 . s calcification=$$XSUB("cectca",vals,dict,"cect"_ii_"ca")
"RTN","SAMICTT1",79,0)
 . i calcification="" s calcstr="is "_spic_$$XSUB("cectnt",vals,dict,"cect"_ii_"nt")_", "
"RTN","SAMICTT1",80,0)
 . e  s calcstr="is "_calcification_", "_spic_$$XSUB("cectnt",vals,dict,"cect"_ii_"nt")_", "
"RTN","SAMICTT1",81,0)
 . ;
"RTN","SAMICTT1",82,0)
 . n vssl,vssw,vsl,vsw,avgs,avgss
"RTN","SAMICTT1",83,0)
 . s (vssl,vssw,vsl,vsw,avgs,avgss)=0
"RTN","SAMICTT1",84,0)
 . s vssl=$$XVAL("cect"_ii_"ssl",vals)
"RTN","SAMICTT1",85,0)
 . i vssl'=0 d  ;
"RTN","SAMICTT1",86,0)
 . . s vssw=$$XVAL("cect"_ii_"ssw",vals)
"RTN","SAMICTT1",87,0)
 . . s avgss=(vssl+vssw)/2
"RTN","SAMICTT1",88,0)
 . . s avgss=$j(avgss,1,1)
"RTN","SAMICTT1",89,0)
 . s vsl=$$XVAL("cect"_ii_"sl",vals)
"RTN","SAMICTT1",90,0)
 . s vsw=$$XVAL("cect"_ii_"sw",vals)
"RTN","SAMICTT1",91,0)
 . s avgs=(vsl+vsw)/2
"RTN","SAMICTT1",92,0)
 . s avgs=$j(avgs,1,1)
"RTN","SAMICTT1",93,0)
 . n scomp
"RTN","SAMICTT1",94,0)
 . s scomp=""
"RTN","SAMICTT1",95,0)
 . i $$XVAL("cect"_ii_"ssl",vals)'="" d  ;
"RTN","SAMICTT1",96,0)
 . . ;s scomp=" (solid component "_$$XVAL("cect"_ii_"ssl",vals)_" mm x "_$$XVAL("cect"_ii_"ssw",vals)_" mm average diameter "_avgss_" mm)"
"RTN","SAMICTT1",97,0)
 . . s scomp=", solid component "_$$XVAL("cect"_ii_"ssl",vals)_" mm x "_$$XVAL("cect"_ii_"ssw",vals)_" mm (average diameter of "_avgss_" mm)"
"RTN","SAMICTT1",98,0)
 . ;
"RTN","SAMICTT1",99,0)
 . s calcstr=calcstr_$$XVAL("cect"_ii_"sl",vals)_" mm x "_$$XVAL("cect"_ii_"sw",vals)_" mm (average diameter of "_avgs_" mm)"_scomp_", "
"RTN","SAMICTT1",100,0)
 . ;
"RTN","SAMICTT1",101,0)
 . n smooth
"RTN","SAMICTT1",102,0)
 . ;s smooth=$$XSUB("cectse",vals,dict,"cect"_ii_"se")
"RTN","SAMICTT1",103,0)
 . s smooth=$$XVAL("cect"_ii_"se",vals)
"RTN","SAMICTT1",104,0)
 . i smooth="y" s calcstr=calcstr_"smooth edges, "
"RTN","SAMICTT1",105,0)
 . ;e  s calcstr=calcstr_smooth_" edges, " ;nothing if not smooth
"RTN","SAMICTT1",106,0)
 . ;
"RTN","SAMICTT1",107,0)
 . ; adding distance from costal pleura
"RTN","SAMICTT1",108,0)
 . n pldstr
"RTN","SAMICTT1",109,0)
 . s pldstr="within "_$$XVAL("cect"_ii_"pld",vals)_" mm of the costal pleura"
"RTN","SAMICTT1",110,0)
 . ;
"RTN","SAMICTT1",111,0)
 . n skip s skip=0
"RTN","SAMICTT1",112,0)
 . ;# 3 cases: parenchymal, endobronchial, and both
"RTN","SAMICTT1",113,0)
 . ;
"RTN","SAMICTT1",114,0)
 . n en,loc,nloc,endo,ll
"RTN","SAMICTT1",115,0)
 . s loc=""
"RTN","SAMICTT1",116,0)
 . s nloc=""
"RTN","SAMICTT1",117,0)
 . s en=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",118,0)
 . s ll=$$XVAL("cect"_ii_"ll",vals)
"RTN","SAMICTT1",119,0)
 . i ($l(en)<2)!(en="no")!(en="") d  ;
"RTN","SAMICTT1",120,0)
 . . ;# 1) parenchymal only
"RTN","SAMICTT1",121,0)
 . . n X,Y s X=ll
"RTN","SAMICTT1",122,0)
 . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",123,0)
 . . s loc=Y
"RTN","SAMICTT1",124,0)
 . . s nloc=Y
"RTN","SAMICTT1",125,0)
 . . s endo="Nodule"
"RTN","SAMICTT1",126,0)
 . e  d  ;
"RTN","SAMICTT1",127,0)
 . . i ll="end" d  ;
"RTN","SAMICTT1",128,0)
 . . . ;# 2) Endobronchial only
"RTN","SAMICTT1",129,0)
 . . . i en="tr" d  ;
"RTN","SAMICTT1",130,0)
 . . . . s endo="Endotracheal Nodule"
"RTN","SAMICTT1",131,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",132,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",133,0)
 . . . . e  d  ;
"RTN","SAMICTT1",134,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cectch"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",135,0)
 . . . . . . d OUT(endo_" "_ii_" "_calcstr_" is seen. ")
"RTN","SAMICTT1",136,0)
 . . . . . e  d OUT(endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",137,0)
 . . . . s skip=1
"RTN","SAMICTT1",138,0)
 . . . i en="rm" d  ;
"RTN","SAMICTT1",139,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",140,0)
 . . . . s nloc=$$XSUB("cecten",vals,dict,"cect"_ii_"en")
"RTN","SAMICTT1",141,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",142,0)
 . . . . . ;d OUT("Previously seen "_nloc_" "_endo_" "_ii_" ")
"RTN","SAMICTT1",143,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" in the "_nloc_" "_calcstr_" ")
"RTN","SAMICTT1",144,0)
 . . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",145,0)
 . . . . e  d  ;
"RTN","SAMICTT1",146,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",147,0)
 . . . . . . ;d OUT(nloc_" "_endo_" "_ii_". ")
"RTN","SAMICTT1",148,0)
 . . . . . . d OUT(endo_" "_ii_" is seen in the "_nloc_" "_calcstr_". ")
"RTN","SAMICTT1",149,0)
 . . . . . ;e  d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",150,0)
 . . . . . e  d OUT(endo_" "_ii_" in the "_nloc_" "_calcstr_", "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",151,0)
 . . . . s skip=1
"RTN","SAMICTT1",152,0)
 . . . i en="bi" d  ;
"RTN","SAMICTT1",153,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",154,0)
 . . . . s loc=$$XSUB("cecten",vals,dict,"cect"_ii_"en")
"RTN","SAMICTT1",155,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",156,0)
 . . . . . ;d OUT("Previously seen "_endo_" "_ii_" in the "_loc)
"RTN","SAMICTT1",157,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" in the "_nloc_" "_calcstr_" ")
"RTN","SAMICTT1",158,0)
 . . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",159,0)
 . . . . e  d  ;
"RTN","SAMICTT1",160,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",161,0)
 . . . . . . ;d OUT(endo_" "_ii_" is seen in the "_loc_". ")
"RTN","SAMICTT1",162,0)
 . . . . . . d OUT(endo_" "_ii_" is seen in the "_loc_" "_calcstr_". ")
"RTN","SAMICTT1",163,0)
 . . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",164,0)
 . . . . s skip=1
"RTN","SAMICTT1",165,0)
 . . . i skip=0 d  ; "default"
"RTN","SAMICTT1",166,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",167,0)
 . . . . n X,Y
"RTN","SAMICTT1",168,0)
 . . . . s X=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",169,0)
 . . . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",170,0)
 . . . . s nloc=Y
"RTN","SAMICTT1",171,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",172,0)
 . . . . . d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_", likely endobronchial. ")
"RTN","SAMICTT1",173,0)
 . . . . e  d  ;
"RTN","SAMICTT1",174,0)
 . . . . . ;i ($$XVAL("cetex",vals)="b")&($$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n") d  ;
"RTN","SAMICTT1",175,0)
 . . . . . i (($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n")) d  ; gpl 1002
"RTN","SAMICTT1",176,0)
 . . . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" likely endobronchial. ")
"RTN","SAMICTT1",177,0)
 . . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_" likely endobronchial. ")
"RTN","SAMICTT1",178,0)
 . . . . s skip=1
"RTN","SAMICTT1",179,0)
 . . e  d  ;
"RTN","SAMICTT1",180,0)
 . . . s endo="Nodule"
"RTN","SAMICTT1",181,0)
 . . . s loc=$$XSUB("cectll",vals,dict,"cect"_ii_"ll")
"RTN","SAMICTT1",182,0)
 . . . n X,Y
"RTN","SAMICTT1",183,0)
 . . . s X=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",184,0)
 . . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",185,0)
 . . . s nloc=Y
"RTN","SAMICTT1",186,0)
 . . . i specialcase=1 d  ;
"RTN","SAMICTT1",187,0)
 . . . . d OUT(nloc_" "_endo_" "_ii_" previously seen with possible endobronchial component")
"RTN","SAMICTT1",188,0)
 . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",189,0)
 . . . e  d  ;
"RTN","SAMICTT1",190,0)
 . . . . ;i ($$XVAL("cetex",vals)="b")&($$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n") d  ;
"RTN","SAMICTT1",191,0)
 . . . . i (($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n")) d  ; gpl 1002
"RTN","SAMICTT1",192,0)
 . . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" with possible endobronchial component")
"RTN","SAMICTT1",193,0)
 . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" with possible endobronchial component "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",194,0)
 . . . s skip=1
"RTN","SAMICTT1",195,0)
 . i specialcase=1 d  ;
"RTN","SAMICTT1",196,0)
 . . i skip=0 d  ;
"RTN","SAMICTT1",197,0)
 . . . d OUT("Previously seen "_nloc_" "_endo_" "_ii_" ")
"RTN","SAMICTT1",198,0)
 . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",199,0)
 . e  d  ;
"RTN","SAMICTT1",200,0)
 . . i skip=0 d  ;
"RTN","SAMICTT1",201,0)
 . . . ;# pleural distance only goes here
"RTN","SAMICTT1",202,0)
 . . . i $$XVAL("cect"_ii_"pld",vals)'="" s calcstr=calcstr_" "_pldstr_","
"RTN","SAMICTT1",203,0)
 . . . ;# Special Handling for "newly seen" on baseline
"RTN","SAMICTT1",204,0)
 . . . ;i ($$XVAL("cetex",vals)="b")&($$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n") d  ;
"RTN","SAMICTT1",205,0)
 . . . i (($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n")) d  ; gpl 1002
"RTN","SAMICTT1",206,0)
 . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr)
"RTN","SAMICTT1",207,0)
 . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_" ")
"RTN","SAMICTT1",208,0)
 . . d OUT(" (Series "_$$XVAL("cect"_ii_"sn",vals)_",") ; added from 1114 gpl1
"RTN","SAMICTT1",209,0)
 . . ;i $$XVAL("cect"_ii_"inl",vals)=$$XVAL("cect"_ii_"inh",vals) d  ;
"RTN","SAMICTT1",210,0)
 . . ;. d OUT(" image "_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",211,0)
 . . ;e  d  ;
"RTN","SAMICTT1",212,0)
 . . ;. d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",213,0)
 . . i $$XVAL("cect"_ii_"inh",vals)="" d  ;
"RTN","SAMICTT1",214,0)
 . . . d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_"). ")
"RTN","SAMICTT1",215,0)
 . . e  d  ;
"RTN","SAMICTT1",216,0)
 . . . d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_"-"_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",217,0)
 . . i $$XVAL("cect"_ii_"co",vals)'="" d OUT($$XVAL("cect"_ii_"co",vals)_". ") ;1122 gpl1
"RTN","SAMICTT1",218,0)
 . . n ac
"RTN","SAMICTT1",219,0)
 . . s ac=$$XVAL("cect"_ii_"ac",vals)
"RTN","SAMICTT1",220,0)
 . . i ac'="" i (ac'="-") i (ac'="s") d  ;
"RTN","SAMICTT1",221,0)
 . . . d OUT($$XSUB("cectac",vals,dict,"cect"_ii_"ac")_" recommended. ")
"RTN","SAMICTT1",222,0)
 . ;
"RTN","SAMICTT1",223,0)
 . ; end of nodule processing
"RTN","SAMICTT1",224,0)
 . ;
"RTN","SAMICTT1",225,0)
 . s outmode="go"
"RTN","SAMICTT1",226,0)
 . d OUT("")
"RTN","SAMICTT1",227,0)
 . s outmode="hold"
"RTN","SAMICTT1",228,0)
 i firstitem'=0 d  ;
"RTN","SAMICTT1",229,0)
 . ;d OUT("</UL>")
"RTN","SAMICTT1",230,0)
 . ;d OUT("<!-- end nodule info -->")
"RTN","SAMICTT1",231,0)
 ;d OUT("</p>")
"RTN","SAMICTT1",232,0)
 ;
"RTN","SAMICTT1",233,0)
 quit  ; end of NODULES
"RTN","SAMICTT1",234,0)
 ;
"RTN","SAMICTT1",235,0)
 ;
"RTN","SAMICTT1",236,0)
 ;
"RTN","SAMICTT1",237,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT1",238,0)
 ;
"RTN","SAMICTT1",239,0)
 ;@called-by
"RTN","SAMICTT1",240,0)
 ; NODULES
"RTN","SAMICTT1",241,0)
 ;@calls none
"RTN","SAMICTT1",242,0)
 ;@input
"RTN","SAMICTT1",243,0)
 ; ln = output to add
"RTN","SAMICTT1",244,0)
 ;@output: line added to report
"RTN","SAMICTT1",245,0)
 ;
"RTN","SAMICTT1",246,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT1",247,0)
 s cnt=cnt+1
"RTN","SAMICTT1",248,0)
 n lnn
"RTN","SAMICTT1",249,0)
 ;s debug=1
"RTN","SAMICTT1",250,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT1",251,0)
 i outmode="go" d  ;
"RTN","SAMICTT1",252,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT1",253,0)
 . s line=""
"RTN","SAMICTT1",254,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT1",255,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT1",256,0)
 ;
"RTN","SAMICTT1",257,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT1",258,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT1",259,0)
 . n zs s zs=$STACK
"RTN","SAMICTT1",260,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT1",261,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT1",262,0)
 ;
"RTN","SAMICTT1",263,0)
 quit  ; end of OUT
"RTN","SAMICTT1",264,0)
 ;
"RTN","SAMICTT1",265,0)
 ;
"RTN","SAMICTT1",266,0)
 ;
"RTN","SAMICTT1",267,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTT1",268,0)
 ;
"RTN","SAMICTT1",269,0)
 ;@called-by
"RTN","SAMICTT1",270,0)
 ; NODULES
"RTN","SAMICTT1",271,0)
 ;@calls
"RTN","SAMICTT1",272,0)
 ; OUT
"RTN","SAMICTT1",273,0)
 ;@input
"RTN","SAMICTT1",274,0)
 ; ln = header output to add
"RTN","SAMICTT1",275,0)
 ;@output: header line added to report
"RTN","SAMICTT1",276,0)
 ;
"RTN","SAMICTT1",277,0)
 d OUT(ln)
"RTN","SAMICTT1",278,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT1",279,0)
 ;
"RTN","SAMICTT1",280,0)
 quit  ; end of HOUT
"RTN","SAMICTT1",281,0)
 ;
"RTN","SAMICTT1",282,0)
 ;
"RTN","SAMICTT1",283,0)
 ;
"RTN","SAMICTT1",284,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT1",285,0)
 ;
"RTN","SAMICTT1",286,0)
 ;@called-by
"RTN","SAMICTT1",287,0)
 ; NODULES
"RTN","SAMICTT1",288,0)
 ;@calls none
"RTN","SAMICTT1",289,0)
 ;@input
"RTN","SAMICTT1",290,0)
 ; val
"RTN","SAMICTT1",291,0)
 ; vals is passed by name
"RTN","SAMICTT1",292,0)
 ;@output = patient value for var
"RTN","SAMICTT1",293,0)
 ;
"RTN","SAMICTT1",294,0)
 n zr
"RTN","SAMICTT1",295,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT1",296,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT1",297,0)
 ;
"RTN","SAMICTT1",298,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT1",299,0)
 ;
"RTN","SAMICTT1",300,0)
 ;
"RTN","SAMICTT1",301,0)
 ;
"RTN","SAMICTT1",302,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT1",303,0)
 ;
"RTN","SAMICTT1",304,0)
 ;@called-by
"RTN","SAMICTT1",305,0)
 ; NODULES
"RTN","SAMICTT1",306,0)
 ;@calls none
"RTN","SAMICTT1",307,0)
 ;@input
"RTN","SAMICTT1",308,0)
 ; val
"RTN","SAMICTT1",309,0)
 ; vals and dict are passed by name
"RTN","SAMICTT1",310,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT1",311,0)
 ;@output = dictionary value for var
"RTN","SAMICTT1",312,0)
 ;
"RTN","SAMICTT1",313,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT1",314,0)
 n zr,zv,zdx
"RTN","SAMICTT1",315,0)
 s zdx=$g(valdx)
"RTN","SAMICTT1",316,0)
 i zdx="" s zdx=var
"RTN","SAMICTT1",317,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT1",318,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT1",319,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT1",320,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT1",321,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT1",322,0)
 ;
"RTN","SAMICTT1",323,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT1",324,0)
 ;
"RTN","SAMICTT1",325,0)
 ;
"RTN","SAMICTT1",326,0)
 ;
"RTN","SAMICTT1",327,0)
EOR ; end of routine SAMICTT1
"RTN","SAMICTT2")
0^3^B115984956
"RTN","SAMICTT2",1,0)
SAMICTT2 ;ven/gpl - ctreport text other lung ;2021-03-22T15:19Z
"RTN","SAMICTT2",2,0)
 ;;18.0;SAMI;**4,10**;2020-01;Build 3
"RTN","SAMICTT2",3,0)
 ;;1.18.0.10-i10
"RTN","SAMICTT2",4,0)
 ;
"RTN","SAMICTT2",5,0)
 ; SAMICTT2 creates the Other Lung Findings section of the ELCAP CT
"RTN","SAMICTT2",6,0)
 ; Report in text format.
"RTN","SAMICTT2",7,0)
 ;
"RTN","SAMICTT2",8,0)
 quit  ; no entry from top
"RTN","SAMICTT2",9,0)
 ;
"RTN","SAMICTT2",10,0)
 ;
"RTN","SAMICTT2",11,0)
 ;
"RTN","SAMICTT2",12,0)
 ;@section 0 primary development
"RTN","SAMICTT2",13,0)
 ;
"RTN","SAMICTT2",14,0)
 ;
"RTN","SAMICTT2",15,0)
 ;
"RTN","SAMICTT2",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT2",17,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT2",18,0)
 ;@contents
"RTN","SAMICTT2",19,0)
 ; OTHRLUNG: other lung findings section of ctreport in text format
"RTN","SAMICTT2",20,0)
 ; $$LOBESTR = extrinsic returns lobes
"RTN","SAMICTT2",21,0)
 ; HLFIND: references & sets lfind in calling routine
"RTN","SAMICTT2",22,0)
 ; OUT: output a line of ct report
"RTN","SAMICTT2",23,0)
 ; OUTold: old version of out
"RTN","SAMICTT2",24,0)
 ; HOUT: output a ct report header line
"RTN","SAMICTT2",25,0)
 ; $$XVAL = patient value for var
"RTN","SAMICTT2",26,0)
 ; $$XSUB = dictionary value defined by var
"RTN","SAMICTT2",27,0)
 ;
"RTN","SAMICTT2",28,0)
 ;
"RTN","SAMICTT2",29,0)
 ;
"RTN","SAMICTT2",30,0)
 ;@section 1 OTHRLUNG & related subroutines
"RTN","SAMICTT2",31,0)
 ;
"RTN","SAMICTT2",32,0)
 ;
"RTN","SAMICTT2",33,0)
 ;
"RTN","SAMICTT2",34,0)
OTHRLUNG(rtn,vals,dict) ; other lung findings sect of ct report text
"RTN","SAMICTT2",35,0)
 ;
"RTN","SAMICTT2",36,0)
 ; repgen2,repgen3
"RTN","SAMICTT2",37,0)
 ;
"RTN","SAMICTT2",38,0)
 ;@called-by
"RTN","SAMICTT2",39,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT2",40,0)
 ;@calls
"RTN","SAMICTT2",41,0)
 ; $$XVAL
"RTN","SAMICTT2",42,0)
 ; HLFIND
"RTN","SAMICTT2",43,0)
 ; OUT
"RTN","SAMICTT2",44,0)
 ; $$LOBESTR
"RTN","SAMICTT2",45,0)
 ;@input
"RTN","SAMICTT2",46,0)
 ; rtn
"RTN","SAMICTT2",47,0)
 ; vals
"RTN","SAMICTT2",48,0)
 ; dict
"RTN","SAMICTT2",49,0)
 ;@output: create other lung findings section of ct eval report
"RTN","SAMICTT2",50,0)
 ;
"RTN","SAMICTT2",51,0)
 ; starts at "Other lung findings:"
"RTN","SAMICTT2",52,0)
 ;
"RTN","SAMICTT2",53,0)
 ;#hputs "Other lung findings:"
"RTN","SAMICTT2",54,0)
 s outmode="hold"
"RTN","SAMICTT2",55,0)
 n line s line=""
"RTN","SAMICTT2",56,0)
 ;
"RTN","SAMICTT2",57,0)
 n sp1 s sp1="  "
"RTN","SAMICTT2",58,0)
 n hfind,lfind,yespp,newct
"RTN","SAMICTT2",59,0)
 s (hfind,lfind,yespp)=0
"RTN","SAMICTT2",60,0)
 s newct=1
"RTN","SAMICTT2",61,0)
 ;
"RTN","SAMICTT2",62,0)
 ;# Add handling for new sections
"RTN","SAMICTT2",63,0)
 ;# ceopp is new, if it doensn't exist skip whole section
"RTN","SAMICTT2",64,0)
 ;# only then should old fields be included.
"RTN","SAMICTT2",65,0)
 ;
"RTN","SAMICTT2",66,0)
 i $g(newct)=1 d  ;
"RTN","SAMICTT2",67,0)
 . i "y"="y" d  ;
"RTN","SAMICTT2",68,0)
 . . s yespp=1
"RTN","SAMICTT2",69,0)
 . . i $$XVAL("cecbc",vals)="y" d  ;
"RTN","SAMICTT2",70,0)
 . . . d HLFIND ;
"RTN","SAMICTT2",71,0)
 . . . d OUT(sp1_"Cyst seen in the "_$$LOBESTR("cecbcl1^cecbcl2^cecbcl3^cecbcl4^cecbcl5",0)_". ") d OUT("")
"RTN","SAMICTT2",72,0)
 . . . ;d OUT($$LOBESTR("cecbcl1^cecbcl2^cecbcl3^cecbcl4^cecbcl5",0)_". ")
"RTN","SAMICTT2",73,0)
 . . . s yespp=1
"RTN","SAMICTT2",74,0)
 . . if $$XVAL("cecbb",vals)="y" d  ;
"RTN","SAMICTT2",75,0)
 . . . d HLFIND ; 
"RTN","SAMICTT2",76,0)
 . . . ;d OUT("<br>"_"Bleb or bullae seen in the ")
"RTN","SAMICTT2",77,0)
 . . . d OUT(sp1_"Bleb or bullae seen in the "_$$LOBESTR("cecbbl1^cecbbl2^cecbbl3^cecbbl4^cecbbl5",0)_". ") d OUT("")
"RTN","SAMICTT2",78,0)
 . . . set yespp=1
"RTN","SAMICTT2",79,0)
 . . if $$XVAL("cebrsb",vals)="y" d  ;
"RTN","SAMICTT2",80,0)
 . . . d HLFIND ; 
"RTN","SAMICTT2",81,0)
 . . . ;d OUT("<br>"_"Bronchiectasis in the ")
"RTN","SAMICTT2",82,0)
 . . . d OUT(sp1_"Bronchiectasis in the "_$$LOBESTR("cebrsbl1^cebrsbl2^cebrsbl3^cebrsbl4^cebrsbl5",0)_". ") d OUT("")
"RTN","SAMICTT2",83,0)
 . . . set yespp=1
"RTN","SAMICTT2",84,0)
 . . if $$XVAL("cebrs",vals)="y" d  ;
"RTN","SAMICTT2",85,0)
 . . . if $$XVAL("cebrsb",vals)'="y" d  ;
"RTN","SAMICTT2",86,0)
 . . . . if $$XVAL("cebrss",vals)'="y" d  ;
"RTN","SAMICTT2",87,0)
 . . . . . d HLFIND ;
"RTN","SAMICTT2",88,0)
 . . . . . ;d OUT("<br>"_"Small Airways Disease in the ")
"RTN","SAMICTT2",89,0)
 . . . . . d OUT(sp1_"Small Airways Disease in the "_$$LOBESTR("cebrsl1^cebrsl2^cebrsl3^cebrsl4^cebrsl5",0)_". ") d OUT("")
"RTN","SAMICTT2",90,0)
 . . . . . set yespp=1
"RTN","SAMICTT2",91,0)
 . . if $$XVAL("cebrss",vals)="y" d  ;
"RTN","SAMICTT2",92,0)
 . . . d HLFIND ;
"RTN","SAMICTT2",93,0)
 . . . ;d OUT("<br>"_"Small Airways Disease/Bronchiolectasis in the ")
"RTN","SAMICTT2",94,0)
 . . . d OUT(sp1_"Small Airways Disease/Bronchiolectasis in the "_$$LOBESTR("cebrssl1^cebrssl2^cebrssl3^cebrssl4^cebrssl5",0)_". ") d OUT("")
"RTN","SAMICTT2",95,0)
 . . . set yespp=1
"RTN","SAMICTT2",96,0)
 . . n numl,str
"RTN","SAMICTT2",97,0)
 . . s numl=0
"RTN","SAMICTT2",98,0)
 . . s str=""
"RTN","SAMICTT2",99,0)
 . . if $$XVAL("cebs",vals)="o" d  ;
"RTN","SAMICTT2",100,0)
 . . . set yespp=1
"RTN","SAMICTT2",101,0)
 . . . set numl=0
"RTN","SAMICTT2",102,0)
 . . . set str="Normal bronchial resection margin on"
"RTN","SAMICTT2",103,0)
 . . . if $$XVAL("cebsrt",vals)="r" d  ;
"RTN","SAMICTT2",104,0)
 . . . . s str=str_" right"
"RTN","SAMICTT2",105,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",106,0)
 . . . if $$XVAL("cebslt",vals)="l" d  ;
"RTN","SAMICTT2",107,0)
 . . . . if numl>0 d  ;
"RTN","SAMICTT2",108,0)
 . . . . . s str=str_" and"
"RTN","SAMICTT2",109,0)
 . . . . s str=str_" left"
"RTN","SAMICTT2",110,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",111,0)
 . . . s str=str_". "
"RTN","SAMICTT2",112,0)
 . . . if numl=0 d  ;
"RTN","SAMICTT2",113,0)
 . . . . set str="Normal bronchial resection margin noted. "
"RTN","SAMICTT2",114,0)
 . . . d HLFIND ;
"RTN","SAMICTT2",115,0)
 . . . d OUT(sp1_str)
"RTN","SAMICTT2",116,0)
 . . . ;d OUT("<br>")
"RTN","SAMICTT2",117,0)
 . . ;if $$XVAL("cebrsb",vals)="y" d  ;
"RTN","SAMICTT2",118,0)
 . . ;. d HLFIND
"RTN","SAMICTT2",119,0)
 . . ;. d OUT("<br>"_"Bronchiectasis in the ")
"RTN","SAMICTT2",120,0)
 . . ;. d OUT($$LOBESTR("cebrsbl1^cebrsbl2^cebrsbl3^cebrsbl4^cebrsbl5",0)_". ")
"RTN","SAMICTT2",121,0)
 . . ;. set yespp=1
"RTN","SAMICTT2",122,0)
 . . if $$XVAL("ceild",vals)="y" d  ;
"RTN","SAMICTT2",123,0)
 . . . d HLFIND
"RTN","SAMICTT2",124,0)
 . . . ;d OUT("<br>"_"Evidence of interstitial lung disease in the ")
"RTN","SAMICTT2",125,0)
 . . . d OUT(sp1_"Evidence of interstitial lung disease in the "_$$LOBESTR("ceildl1^ceildl2^ceildl3^ceildl4^ceildl5",0)_". ") d OUT("")
"RTN","SAMICTT2",126,0)
 . . . set yespp=1
"RTN","SAMICTT2",127,0)
 . . if $$XVAL("cerdc",vals)="y" d  ;
"RTN","SAMICTT2",128,0)
 . . . d HLFIND
"RTN","SAMICTT2",129,0)
 . . . ;d OUT("<br>"_"Regional or diffuse consolidation in the ")
"RTN","SAMICTT2",130,0)
 . . . d OUT(sp1_"Regional or diffuse consolidation in the "_$$LOBESTR("cerdcl1^cerdcl2^cerdcl3^cerdcl4^cerdcl5",0)_". ") d OUT("")
"RTN","SAMICTT2",131,0)
 . . . set yespp=1
"RTN","SAMICTT2",132,0)
 . . ;# scarring may be more complicated (apical, and bilateral)
"RTN","SAMICTT2",133,0)
 . . if $$XVAL("cescr",vals)="y" d  ;
"RTN","SAMICTT2",134,0)
 . . . d HLFIND
"RTN","SAMICTT2",135,0)
 . . . ;# If apical use "unilateral apical scarring", if bilateral use "bilateral apical scarring"
"RTN","SAMICTT2",136,0)
 . . . ;# Otherwise use our previouse construct
"RTN","SAMICTT2",137,0)
 . . . n done s done=0 ; flag to use for other scarring 
"RTN","SAMICTT2",138,0)
 . . . if $$XVAL("cescrl6",vals)="au" d  ;
"RTN","SAMICTT2",139,0)
 . . . . d OUT(sp1_"Unilateral apical scarring. ") d OUT("")
"RTN","SAMICTT2",140,0)
 . . . . s done=1
"RTN","SAMICTT2",141,0)
 . . . else  if $$XVAL("cescrl7",vals)="ab" d  ;
"RTN","SAMICTT2",142,0)
 . . . . d OUT(sp1_"Bilateral apical scarring. ") d OUT("")
"RTN","SAMICTT2",143,0)
 . . . . s done=1
"RTN","SAMICTT2",144,0)
 . . . if done=0  d  ;
"RTN","SAMICTT2",145,0)
 . . . . ;d OUT("<br>"_"Scarring in the ")
"RTN","SAMICTT2",146,0)
 . . . . d OUT(sp1_"Scarring in the "_$$LOBESTR("cescrl1^cescrl2^cescrl3^cescrl4^cescrl5",1)_". ") d OUT("")
"RTN","SAMICTT2",147,0)
 . . . . set yespp=1
"RTN","SAMICTT2",148,0)
 . . if $$XVAL("cebat",vals)="y" d  ;
"RTN","SAMICTT2",149,0)
 . . . d HLFIND
"RTN","SAMICTT2",150,0)
 . . . ;d OUT("<br>"_"Other atelectasis in the ")
"RTN","SAMICTT2",151,0)
 . . . d OUT(sp1_"Other atelectasis in the "_$$LOBESTR("cebatl1^cebatl2^cebatl3^cebatl4^cebatl5",0)_". ") d OUT("")
"RTN","SAMICTT2",152,0)
 . . . set yespp=1
"RTN","SAMICTT2",153,0)
 . . if $$XVAL("cerb",vals)="y" d  ;
"RTN","SAMICTT2",154,0)
 . . . d HLFIND
"RTN","SAMICTT2",155,0)
 . . . ;d OUT("<br>"_"Traction bronchiectasis in the ")
"RTN","SAMICTT2",156,0)
 . . . d OUT(sp1_"Traction bronchiectasis in the "_$$LOBESTR("cerbl1^cerbl2^cerbl3^cerbl4^cerbl5",0)_". ") d OUT("")
"RTN","SAMICTT2",157,0)
 . . . set yespp=1
"RTN","SAMICTT2",158,0)
 . . if $$XVAL("cepgo",vals)="y" d  ;
"RTN","SAMICTT2",159,0)
 . . . d HLFIND
"RTN","SAMICTT2",160,0)
 . . . ;d OUT("<br>"_"Peripheral Ground-glass Opacities in the ")
"RTN","SAMICTT2",161,0)
 . . . d OUT(sp1_"Peripheral Ground-glass Opacities in the "_$$LOBESTR("cepgol1^cepgol2^cepgol3^cepgol4^cepgol5",0)_". ") d OUT("")
"RTN","SAMICTT2",162,0)
 . . . set yespp=1
"RTN","SAMICTT2",163,0)
 . . if $$XVAL("ceret",vals)="y" d  ;
"RTN","SAMICTT2",164,0)
 . . . d HLFIND
"RTN","SAMICTT2",165,0)
 . . . ;d OUT("<br>"_"Reticulations in the ")
"RTN","SAMICTT2",166,0)
 . . . d OUT(sp1_"Reticulations in the "_$$LOBESTR("ceretl1^ceretl2^ceretl3^ceretl4^ceretl5",0)_". ") d OUT("")
"RTN","SAMICTT2",167,0)
 . . . set yespp=1
"RTN","SAMICTT2",168,0)
 . . if $$XVAL("cephc",vals)="y" d  ;
"RTN","SAMICTT2",169,0)
 . . . d HLFIND
"RTN","SAMICTT2",170,0)
 . . . ;d OUT("<br>"_"Honeycombing in the ")
"RTN","SAMICTT2",171,0)
 . . . d OUT(sp1_"Honeycombing in the "_$$LOBESTR("cephcl1^cephcl2^cephcl3^cephcl4^cephcl5",0)_". ") d OUT("")
"RTN","SAMICTT2",172,0)
 . . . set yespp=1
"RTN","SAMICTT2",173,0)
 . . if $$XVAL("cepp",vals)="y" d  ;
"RTN","SAMICTT2",174,0)
 . . . set yespp=1
"RTN","SAMICTT2",175,0)
 . . . set numl=0
"RTN","SAMICTT2",176,0)
 . . . set str="Pleural or fissural plaques in the "
"RTN","SAMICTT2",177,0)
 . . . if $$XVAL("cepprt",vals)="r" d  ;
"RTN","SAMICTT2",178,0)
 . . . . s str=str_"right"
"RTN","SAMICTT2",179,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",180,0)
 . . . if $$XVAL("cepplt",vals)="l" d  ;
"RTN","SAMICTT2",181,0)
 . . . . if numl>0 d  ;
"RTN","SAMICTT2",182,0)
 . . . . . s str=str_" and"
"RTN","SAMICTT2",183,0)
 . . . . s str=str_" left"
"RTN","SAMICTT2",184,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",185,0)
 . . . . if numl>1 s str=str_" lobes"
"RTN","SAMICTT2",186,0)
 . . . . else  s str=str_" lobe"
"RTN","SAMICTT2",187,0)
 . . . . if $$XVAL("ceppca",vals)="c" s str=str_" with calcifications"
"RTN","SAMICTT2",188,0)
 . . . . s str=str_". "_para
"RTN","SAMICTT2",189,0)
 . . . if numl=0 set str="Pleural or fissural plaques are noted. "
"RTN","SAMICTT2",190,0)
 . . . d HLFIND
"RTN","SAMICTT2",191,0)
 . . . d OUT(sp1_str)
"RTN","SAMICTT2",192,0)
 . . ;
"RTN","SAMICTT2",193,0)
 . . ;# Note: Not used for newer CT Evaluation Forms
"RTN","SAMICTT2",194,0)
 . . ;if { 0 == [ string compare y [xval cepc] ] } {
"RTN","SAMICTT2",195,0)
 . . ;  set yespp 1
"RTN","SAMICTT2",196,0)
 . . ;     hlfind
"RTN","SAMICTT2",197,0)
 . . ;     puts "[sidestr {Pleural calcifications} cepcrt cepclt]"
"RTN","SAMICTT2",198,0)
 . . ;
"RTN","SAMICTT2",199,0)
 . . if $$XVAL("cebs",vals)="y" d  ;
"RTN","SAMICTT2",200,0)
 . . . set yespp=1
"RTN","SAMICTT2",201,0)
 . . . set numl=0
"RTN","SAMICTT2",202,0)
 . . . set str="Abnormal bronchial resection margin on"
"RTN","SAMICTT2",203,0)
 . . . d  ;
"RTN","SAMICTT2",204,0)
 . . . . if $$XVAL("cebsrt",vals)="r" d  ;
"RTN","SAMICTT2",205,0)
 . . . . . s str=str_" right"
"RTN","SAMICTT2",206,0)
 . . . . . s numl=numl+1
"RTN","SAMICTT2",207,0)
 . . . . if $$XVAL("cebslt",vals)="l" d  ;
"RTN","SAMICTT2",208,0)
 . . . . . if numl>0 s str=str_" and"
"RTN","SAMICTT2",209,0)
 . . . . . s str=str_" left"
"RTN","SAMICTT2",210,0)
 . . . . . s numl=numl+1
"RTN","SAMICTT2",211,0)
 . . . . s str=str_". "
"RTN","SAMICTT2",212,0)
 . . . if numl=0 set str="<br>"_"Abnormal bronchial resection margin noted. "
"RTN","SAMICTT2",213,0)
 . . . d HLFIND
"RTN","SAMICTT2",214,0)
 . . . d OUT(sp1_str)
"RTN","SAMICTT2",215,0)
 . . . ;d OUT(para)
"RTN","SAMICTT2",216,0)
 . . ;
"RTN","SAMICTT2",217,0)
 . . if $L($$XVAL("ceoppa",vals))'=0 d  ;
"RTN","SAMICTT2",218,0)
 . . . ;# puts "Additional Comments on Parenchymal or Pleural Abnormalities:"
"RTN","SAMICTT2",219,0)
 . . . d HLFIND
"RTN","SAMICTT2",220,0)
 . . . d OUT(sp1_$$XVAL("ceoppa",vals)_". ") d OUT("")
"RTN","SAMICTT2",221,0)
 . . . ;d OUT(para)
"RTN","SAMICTT2",222,0)
 . . else  if yespp=1  ;d OUT(para)
"RTN","SAMICTT2",223,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT2",224,0)
 ;
"RTN","SAMICTT2",225,0)
 quit  ; end of OTHRLUNG
"RTN","SAMICTT2",226,0)
 ;
"RTN","SAMICTT2",227,0)
 ;
"RTN","SAMICTT2",228,0)
 ;
"RTN","SAMICTT2",229,0)
LOBESTR(lst,opt) ; extrinsic returns lobes
"RTN","SAMICTT2",230,0)
 ;
"RTN","SAMICTT2",231,0)
 ;@called-by
"RTN","SAMICTT2",232,0)
 ; OTHRLUNG
"RTN","SAMICTT2",233,0)
 ;@calls
"RTN","SAMICTT2",234,0)
 ; $$XVAL
"RTN","SAMICTT2",235,0)
 ; @^%ZOSF("UPPERCASE")
"RTN","SAMICTT2",236,0)
 ;@input
"RTN","SAMICTT2",237,0)
 ; lst = a^b^c where a,b and c are variable names
"RTN","SAMICTT2",238,0)
 ; opt
"RTN","SAMICTT2",239,0)
 ;@output = lobes
"RTN","SAMICTT2",240,0)
 ;
"RTN","SAMICTT2",241,0)
 n rtstr,lln,tary
"RTN","SAMICTT2",242,0)
 s tary=""
"RTN","SAMICTT2",243,0)
 s rtstr=""
"RTN","SAMICTT2",244,0)
 s lln=$l(lst,"^")
"RTN","SAMICTT2",245,0)
 f lzi=1:1:lln d  ;
"RTN","SAMICTT2",246,0)
 . n tval
"RTN","SAMICTT2",247,0)
 . s tval=$$XVAL($p(lst,"^",lzi),vals)
"RTN","SAMICTT2",248,0)
 . n X,Y S X=tval X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT2",249,0)
 . s tval=Y
"RTN","SAMICTT2",250,0)
 . i tval'="" s tary($o(tary(""),-1)+1)=tval
"RTN","SAMICTT2",251,0)
 n tcnt s tcnt=$o(tary(""),-1)
"RTN","SAMICTT2",252,0)
 q:tcnt=0
"RTN","SAMICTT2",253,0)
 i tcnt=1 q tary(1)
"RTN","SAMICTT2",254,0)
 i tcnt=2 q tary(1)_" and "_tary(2)
"RTN","SAMICTT2",255,0)
 f lzi=1:1:tcnt s rtstr=rtstr_tary(lzi)_$s(lzi<tcnt:", ",1:"")
"RTN","SAMICTT2",256,0)
 ;
"RTN","SAMICTT2",257,0)
 quit rtstr ; end of $$LOBESTR
"RTN","SAMICTT2",258,0)
 ;
"RTN","SAMICTT2",259,0)
 ;
"RTN","SAMICTT2",260,0)
 ;
"RTN","SAMICTT2",261,0)
HLFIND() ; references & sets lfind in calling routine
"RTN","SAMICTT2",262,0)
 ;
"RTN","SAMICTT2",263,0)
 ;@called-by
"RTN","SAMICTT2",264,0)
 ; OTHRLUNG
"RTN","SAMICTT2",265,0)
 ;@calls
"RTN","SAMICTT2",266,0)
 ; HOUT
"RTN","SAMICTT2",267,0)
 ; OUT
"RTN","SAMICTT2",268,0)
 ;@thruput
"RTN","SAMICTT2",269,0)
 ; ]lfind
"RTN","SAMICTT2",270,0)
 ;@output: adds other lung findings header to report
"RTN","SAMICTT2",271,0)
 ;
"RTN","SAMICTT2",272,0)
 i $g(lfind)=0 d  ;
"RTN","SAMICTT2",273,0)
 . d HOUT("Other lung findings:")
"RTN","SAMICTT2",274,0)
 . d OUT("")
"RTN","SAMICTT2",275,0)
 . s lfind=1
"RTN","SAMICTT2",276,0)
 ;
"RTN","SAMICTT2",277,0)
 quit  ; end of HLFIND
"RTN","SAMICTT2",278,0)
 ;
"RTN","SAMICTT2",279,0)
 ;
"RTN","SAMICTT2",280,0)
 ;
"RTN","SAMICTT2",281,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT2",282,0)
 ;
"RTN","SAMICTT2",283,0)
 ;@called-by
"RTN","SAMICTT2",284,0)
 ; OTHRLUNG
"RTN","SAMICTT2",285,0)
 ; HLFIND
"RTN","SAMICTT2",286,0)
 ;@calls none
"RTN","SAMICTT2",287,0)
 ;@input
"RTN","SAMICTT2",288,0)
 ; ln = output to add
"RTN","SAMICTT2",289,0)
 ;@output: line added to report
"RTN","SAMICTT2",290,0)
 ;
"RTN","SAMICTT2",291,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT2",292,0)
 s cnt=cnt+1
"RTN","SAMICTT2",293,0)
 n lnn
"RTN","SAMICTT2",294,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT2",295,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT2",296,0)
 i outmode="go" d  ;
"RTN","SAMICTT2",297,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT2",298,0)
 . s line=""
"RTN","SAMICTT2",299,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT2",300,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT2",301,0)
 ;
"RTN","SAMICTT2",302,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT2",303,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT2",304,0)
 . n zs s zs=$STACK
"RTN","SAMICTT2",305,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT2",306,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT2",307,0)
 ;
"RTN","SAMICTT2",308,0)
 quit  ; end of OUT
"RTN","SAMICTT2",309,0)
 ;
"RTN","SAMICTT2",310,0)
 ;
"RTN","SAMICTT2",311,0)
 ;
"RTN","SAMICTT2",312,0)
OUTold(ln) ; old version of out
"RTN","SAMICTT2",313,0)
 ;
"RTN","SAMICTT2",314,0)
 ;@called-by none
"RTN","SAMICTT2",315,0)
 ;@calls none
"RTN","SAMICTT2",316,0)
 ;@input
"RTN","SAMICTT2",317,0)
 ; ln = output to add
"RTN","SAMICTT2",318,0)
 ;@output: line added to report
"RTN","SAMICTT2",319,0)
 ;
"RTN","SAMICTT2",320,0)
 s cnt=cnt+1
"RTN","SAMICTT2",321,0)
 n lnn
"RTN","SAMICTT2",322,0)
 ;s debug=1
"RTN","SAMICTT2",323,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT2",324,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT2",325,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT2",326,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT2",327,0)
 . n zs s zs=$STACK
"RTN","SAMICTT2",328,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT2",329,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT2",330,0)
 ;
"RTN","SAMICTT2",331,0)
 quit  ; end of OUTold
"RTN","SAMICTT2",332,0)
 ;
"RTN","SAMICTT2",333,0)
 ;
"RTN","SAMICTT2",334,0)
 ;
"RTN","SAMICTT2",335,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTT2",336,0)
 ;
"RTN","SAMICTT2",337,0)
 ;@called-by
"RTN","SAMICTT2",338,0)
 ; HLFIND
"RTN","SAMICTT2",339,0)
 ;@calls
"RTN","SAMICTT2",340,0)
 ; OUT
"RTN","SAMICTT2",341,0)
 ;@input
"RTN","SAMICTT2",342,0)
 ; ln = header output to add
"RTN","SAMICTT2",343,0)
 ;@output: header line added to report
"RTN","SAMICTT2",344,0)
 ;
"RTN","SAMICTT2",345,0)
 d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT2",346,0)
 ;
"RTN","SAMICTT2",347,0)
 quit  ; end of HOUT
"RTN","SAMICTT2",348,0)
 ;
"RTN","SAMICTT2",349,0)
 ;
"RTN","SAMICTT2",350,0)
 ;
"RTN","SAMICTT2",351,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT2",352,0)
 ;
"RTN","SAMICTT2",353,0)
 ;@called-by
"RTN","SAMICTT2",354,0)
 ; OTHRLUNG
"RTN","SAMICTT2",355,0)
 ; $$LOBESTR
"RTN","SAMICTT2",356,0)
 ;@calls none
"RTN","SAMICTT2",357,0)
 ;@input
"RTN","SAMICTT2",358,0)
 ; var
"RTN","SAMICTT2",359,0)
 ; vals is passed by name
"RTN","SAMICTT2",360,0)
 ;@output = patient value for var
"RTN","SAMICTT2",361,0)
 ;
"RTN","SAMICTT2",362,0)
 ;
"RTN","SAMICTT2",363,0)
 n zr
"RTN","SAMICTT2",364,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT2",365,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT2",366,0)
 ;
"RTN","SAMICTT2",367,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT2",368,0)
 ;
"RTN","SAMICTT2",369,0)
 ;
"RTN","SAMICTT2",370,0)
 ;
"RTN","SAMICTT2",371,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT2",372,0)
 ;
"RTN","SAMICTT2",373,0)
 ;@called-by none
"RTN","SAMICTT2",374,0)
 ;@calls none
"RTN","SAMICTT2",375,0)
 ;@input
"RTN","SAMICTT2",376,0)
 ; var
"RTN","SAMICTT2",377,0)
 ; vals and dict are passed by name
"RTN","SAMICTT2",378,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT2",379,0)
 ;@output = dictionary value for var
"RTN","SAMICTT2",380,0)
 ;
"RTN","SAMICTT2",381,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT2",382,0)
 n zr,zv,zdx
"RTN","SAMICTT2",383,0)
 s zdx=$g(valdx)
"RTN","SAMICTT2",384,0)
 i zdx="" s zdx=var
"RTN","SAMICTT2",385,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT2",386,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT2",387,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT2",388,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT2",389,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT2",390,0)
 ;
"RTN","SAMICTT2",391,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT2",392,0)
 ;
"RTN","SAMICTT2",393,0)
 ;
"RTN","SAMICTT2",394,0)
 ;
"RTN","SAMICTT2",395,0)
EOR ; end of routine SAMICTT2
"RTN","SAMICTT3")
0^4^B222224982
"RTN","SAMICTT3",1,0)
SAMICTT3 ;ven/gpl - ctreport text emphysema ;2021-03-23T19:41Z
"RTN","SAMICTT3",2,0)
 ;;18.0;SAMI;**4,10**;2020-01;Build 3
"RTN","SAMICTT3",3,0)
 ;;1.18.0.10-i10
"RTN","SAMICTT3",4,0)
 ;
"RTN","SAMICTT3",5,0)
 ; SAMICTT3 creates the Emphysema section of the ELCAP CT Report in
"RTN","SAMICTT3",6,0)
 ; text format.
"RTN","SAMICTT3",7,0)
 ;
"RTN","SAMICTT3",8,0)
 quit  ; no entry from top
"RTN","SAMICTT3",9,0)
 ;
"RTN","SAMICTT3",10,0)
 ;
"RTN","SAMICTT3",11,0)
 ;
"RTN","SAMICTT3",12,0)
 ;@section 0 primary development
"RTN","SAMICTT3",13,0)
 ;
"RTN","SAMICTT3",14,0)
 ;
"RTN","SAMICTT3",15,0)
 ;
"RTN","SAMICTT3",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT3",17,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT3",18,0)
 ;@contents
"RTN","SAMICTT3",19,0)
 ; EMPHYS: emphysema section of ctreport text format
"RTN","SAMICTT3",20,0)
 ; $$CCMSTR = form phrases
"RTN","SAMICTT3",21,0)
 ; $$LOWC = convert X to lowercase
"RTN","SAMICTT3",22,0)
 ; OUT: output a line of ct report
"RTN","SAMICTT3",23,0)
 ; OUTOLD: old version of out
"RTN","SAMICTT3",24,0)
 ; HOUT: output a ct report header line
"RTN","SAMICTT3",25,0)
 ; $$XVAL = patient value for var
"RTN","SAMICTT3",26,0)
 ; $$XSUB = dictionary value defined by var
"RTN","SAMICTT3",27,0)
 ;
"RTN","SAMICTT3",28,0)
 ;
"RTN","SAMICTT3",29,0)
 ;
"RTN","SAMICTT3",30,0)
 ;@section 1 EMPHYS & related subroutines
"RTN","SAMICTT3",31,0)
 ;
"RTN","SAMICTT3",32,0)
 ;
"RTN","SAMICTT3",33,0)
 ;
"RTN","SAMICTT3",34,0)
EMPHYS(rtn,vals,dict) ; emphysema section of ct report text format
"RTN","SAMICTT3",35,0)
 ;
"RTN","SAMICTT3",36,0)
 ; repgen4,repgen5
"RTN","SAMICTT3",37,0)
 ;
"RTN","SAMICTT3",38,0)
 ;@called-by
"RTN","SAMICTT3",39,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT3",40,0)
 ;@calls
"RTN","SAMICTT3",41,0)
 ; $$XVAL
"RTN","SAMICTT3",42,0)
 ; HOUT
"RTN","SAMICTT3",43,0)
 ; OUT
"RTN","SAMICTT3",44,0)
 ; $$XSUB
"RTN","SAMICTT3",45,0)
 ; $$LOBESTR^SAMICTR2
"RTN","SAMICTT3",46,0)
 ; $$CCMSTR
"RTN","SAMICTT3",47,0)
 ; $$LOWC
"RTN","SAMICTT3",48,0)
 ;@input
"RTN","SAMICTT3",49,0)
 ; rtn
"RTN","SAMICTT3",50,0)
 ; vals
"RTN","SAMICTT3",51,0)
 ; dict
"RTN","SAMICTT3",52,0)
 ;@output: create emphysema section of ct eval report
"RTN","SAMICTT3",53,0)
 ;  
"RTN","SAMICTT3",54,0)
 ;# Emphysema
"RTN","SAMICTT3",55,0)
 ;
"RTN","SAMICTT3",56,0)
 n sp1 s sp1="  "
"RTN","SAMICTT3",57,0)
 s outmode="hold" s line=""
"RTN","SAMICTT3",58,0)
 ;if $$XVAL("ceemv",vals)'="e" d  ;
"RTN","SAMICTT3",59,0)
 if $$XVAL("ceem",vals)'="" d  ;
"RTN","SAMICTT3",60,0)
 . if $$XVAL("ceem",vals)="nv" q  ;
"RTN","SAMICTT3",61,0)
 . if $$XVAL("ceem",vals)="no" q  ;
"RTN","SAMICTT3",62,0)
 . ;d OUT("")
"RTN","SAMICTT3",63,0)
 . D HOUT("Emphysema: ")
"RTN","SAMICTT3",64,0)
 . ;d OUT("")
"RTN","SAMICTT3",65,0)
 . D OUT(sp1_$$XSUB("ceem",vals,dict))
"RTN","SAMICTT3",66,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",67,0)
 ;
"RTN","SAMICTT3",68,0)
 if $$XVAL("ceem",vals)="" d  ;
"RTN","SAMICTT3",69,0)
 . D HOUT("Emphysema: None")
"RTN","SAMICTT3",70,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",71,0)
 ;d OUT("")
"RTN","SAMICTT3",72,0)
 s outmode="hold"
"RTN","SAMICTT3",73,0)
 D HOUT("Pleura: ")
"RTN","SAMICTT3",74,0)
 ;d OUT("")
"RTN","SAMICTT3",75,0)
 ; hputs "Pleura:"
"RTN","SAMICTT3",76,0)
 N pe s pe=0
"RTN","SAMICTT3",77,0)
 ;
"RTN","SAMICTT3",78,0)
 ; # Pleural Effusion
"RTN","SAMICTT3",79,0)
 ; 
"RTN","SAMICTT3",80,0)
 i $$XVAL("cepev",vals)="y" d  ;
"RTN","SAMICTT3",81,0)
 . if $$XVAL("ceper",vals)="-" d  ;
"RTN","SAMICTT3",82,0)
 . . if $$XVAL("cepel",vals)="-" d  ;
"RTN","SAMICTT3",83,0)
 . . . s @vals@("cepev")="e"
"RTN","SAMICTT3",84,0)
 . ;
"RTN","SAMICTT3",85,0)
 . if $$XVAL("cepev",vals)'="e" d  ;
"RTN","SAMICTT3",86,0)
 . . if $$XVAL("ceper",vals)'="-" d  ;
"RTN","SAMICTT3",87,0)
 . . . if $$XVAL("cepel",vals)'="-" d  ;
"RTN","SAMICTT3",88,0)
 . . . . if $$XVAL("cepel",vals)=$$XVAL("ceper",vals) d  ;
"RTN","SAMICTT3",89,0)
 . . . . . d OUT(sp1_"Bilateral "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusions. ") d OUT("")
"RTN","SAMICTT3",90,0)
 . . . . else  d  ;
"RTN","SAMICTT3",91,0)
 . . . . . d OUT(sp1_"Bilateral pleural effusions ; "_$$XSUB("cepe",vals,dict,"cepel")_" on left, and "_$$XSUB("cepe",vals,dict,"ceper")_" on right. ")
"RTN","SAMICTT3",92,0)
 . . . . . s pe=1
"RTN","SAMICTT3",93,0)
 . . . else  d  ;
"RTN","SAMICTT3",94,0)
 . . . . d OUT(sp1_"On right "_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion and on left "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion. ") d OUT("")
"RTN","SAMICTT3",95,0)
 . . . . s pe=1
"RTN","SAMICTT3",96,0)
 . . else  d  ;
"RTN","SAMICTT3",97,0)
 . . . d OUT(sp1_"On right "_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion and on left "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion. ") d OUT("")
"RTN","SAMICTT3",98,0)
 . . . s pe=1
"RTN","SAMICTT3",99,0)
 . ;
"RTN","SAMICTT3",100,0)
 i $$XVAL("cepev",vals)'="y" d  ; 
"RTN","SAMICTT3",101,0)
 . d OUT(sp1_"No pleural effusions. ") d OUT("")
"RTN","SAMICTT3",102,0)
 ;  if { $pe == 0 } {
"RTN","SAMICTT3",103,0)
 ;    puts "[tr "No pleural effusions"].${para}"
"RTN","SAMICTT3",104,0)
 ;  }
"RTN","SAMICTT3",105,0)
 ;  
"RTN","SAMICTT3",106,0)
 n yespp s yespp=0
"RTN","SAMICTT3",107,0)
 ;
"RTN","SAMICTT3",108,0)
 if $$XVAL("cebatr",vals)="y" d  ;
"RTN","SAMICTT3",109,0)
 . ;d OUT("Rounded atelectasis in the ")
"RTN","SAMICTT3",110,0)
 . d OUT(sp1_"Rounded atelectasis in the "_$$LOBESTR^SAMICTR2("cebatrl1^cebatrl2^cebatrl3^cebatrl4^cebatrl5",0)_". ") ;d OUT("")
"RTN","SAMICTT3",111,0)
 . s yespp=1
"RTN","SAMICTT3",112,0)
 ;
"RTN","SAMICTT3",113,0)
 if $$XVAL("cept",vals)="y" d  ;
"RTN","SAMICTT3",114,0)
 . s yespp=1
"RTN","SAMICTT3",115,0)
 . s numl=0
"RTN","SAMICTT3",116,0)
 . set str=sp1_"Pleural thickening/plaques in the "
"RTN","SAMICTT3",117,0)
 . if $$XVAL("ceptrt",vals)="r" d  ;
"RTN","SAMICTT3",118,0)
 . . s str=str_"right"
"RTN","SAMICTT3",119,0)
 . . s numl=numl+1
"RTN","SAMICTT3",120,0)
 . if $$XVAL("ceptlt",vals)="l" d  ;
"RTN","SAMICTT3",121,0)
 . . i numl>0 d  ;
"RTN","SAMICTT3",122,0)
 . . . s str=str_" and"
"RTN","SAMICTT3",123,0)
 . . s str=str_" left"
"RTN","SAMICTT3",124,0)
 . . s numl=numl+1
"RTN","SAMICTT3",125,0)
 . ;if numl>1 d  ;
"RTN","SAMICTT3",126,0)
 . ;. s str=str_" lungs. "
"RTN","SAMICTT3",127,0)
 . ;else  d  ;
"RTN","SAMICTT3",128,0)
 . ;. s str=str_" lung. "
"RTN","SAMICTT3",129,0)
 . s str=str_". "
"RTN","SAMICTT3",130,0)
 . if numl=0 set str=sp1_"Pleural thickening/plaques. "
"RTN","SAMICTT3",131,0)
 . d OUT(str) ;d OUT("")
"RTN","SAMICTT3",132,0)
 ;
"RTN","SAMICTT3",133,0)
 if $$XVAL("cepu",vals)="y" d  ;
"RTN","SAMICTT3",134,0)
 . s yespp=1
"RTN","SAMICTT3",135,0)
 . if $l($$XVAL("cepus",vals))'=0 d  ;
"RTN","SAMICTT3",136,0)
 . . d OUT(sp1_"Pleural rumor: "_$$XVAL("cepus",vals))
"RTN","SAMICTT3",137,0)
 . e  d OUT(sp1_"Pleural tumor. ")
"RTN","SAMICTT3",138,0)
 . ;d OUT("")
"RTN","SAMICTT3",139,0)
 ;
"RTN","SAMICTT3",140,0)
 i yespp=0 d OUT("")
"RTN","SAMICTT3",141,0)
 ;
"RTN","SAMICTT3",142,0)
 d  ;
"RTN","SAMICTT3",143,0)
 . if $$XVAL("ceoppab",vals)'="" d OUT(sp1_$$XVAL("ceoppab",vals)_". ") ;d OUT("")
"RTN","SAMICTT3",144,0)
 . else  d
"RTN","SAMICTT3",145,0)
 . . if yespp=1 d OUT("")
"RTN","SAMICTT3",146,0)
 ;
"RTN","SAMICTT3",147,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT3",148,0)
 ;
"RTN","SAMICTT3",149,0)
 s outmode="hold"
"RTN","SAMICTT3",150,0)
 d OUT("Coronary Artery Calcifications: ")
"RTN","SAMICTT3",151,0)
 ;# Coronary Calcification
"RTN","SAMICTT3",152,0)
 n vcac,cac,cacrec
"RTN","SAMICTT3",153,0)
 s (cac,cacrec)=""
"RTN","SAMICTT3",154,0)
 ;
"RTN","SAMICTT3",155,0)
 ; if $$XVAL("cecccac",vals)'="" d  ;
"RTN","SAMICTT3",156,0)
 ; . s @vals@("ceccv")="e"
"RTN","SAMICTT3",157,0)
 ;
"RTN","SAMICTT3",158,0)
 d  if $$XVAL("ceccv",vals)'="n" d  ;
"RTN","SAMICTT3",159,0)
 . set vcac=$$XVAL("cecccac",vals)
"RTN","SAMICTT3",160,0)
 . if vcac'="" d  ;
"RTN","SAMICTT3",161,0)
 . . s cacrec=""
"RTN","SAMICTT3",162,0)
 . . s cac="The Visual Coronary Artery Calcium (CAC) Score is "_vcac_". "
"RTN","SAMICTT3",163,0)
 . . s cacval=vcac
"RTN","SAMICTT3",164,0)
 . . i cacval>3 s cacrec=$g(@dict@("CAC_recommendation"))
"RTN","SAMICTT3",165,0)
 ;
"RTN","SAMICTT3",166,0)
 ;
"RTN","SAMICTT3",167,0)
 ;n samicac s samicac=0
"RTN","SAMICTT3",168,0)
 ;i $$XVAL("cecclm",vals)'="no" s samicac=1
"RTN","SAMICTT3",169,0)
 ;i $$XVAL("ceccld",vals)'="no" s samicac=1
"RTN","SAMICTT3",170,0)
 ;;i $$XVAL("cecclf",vals)'="no" s samicac=1
"RTN","SAMICTT3",171,0)
 ;i $$XVAL("cecccf",vals)'="no" s samicac=1
"RTN","SAMICTT3",172,0)
 ;i $$XVAL("ceccrc",vals)'="no" s samicac=1
"RTN","SAMICTT3",173,0)
 ;
"RTN","SAMICTT3",174,0)
 ;;s outmode="hold" s line=""
"RTN","SAMICTT3",175,0)
 ;i samicac=1 d  ;
"RTN","SAMICTT3",176,0)
 i $g(@vals@("cecclm"))="-" s @vals@("cecclm")="no"
"RTN","SAMICTT3",177,0)
 i $g(@vals@("ceccld"))="-" s @vals@("ceccld")="no"
"RTN","SAMICTT3",178,0)
 i $g(@vals@("cecclf"))="-" s @vals@("cecccf")="no"
"RTN","SAMICTT3",179,0)
 i $g(@vals@("ceccrc"))="-" s @vals@("ceccrc")="no"
"RTN","SAMICTT3",180,0)
 i $g(@vals@("cecclm"))="" s @vals@("cecclm")="no"
"RTN","SAMICTT3",181,0)
 i $g(@vals@("ceccld"))="" s @vals@("ceccld")="no"
"RTN","SAMICTT3",182,0)
 i $g(@vals@("cecclf"))="" s @vals@("cecccf")="no"
"RTN","SAMICTT3",183,0)
 i $g(@vals@("ceccrc"))="" s @vals@("ceccrc")="no"
"RTN","SAMICTT3",184,0)
 ;
"RTN","SAMICTT3",185,0)
 d  ;
"RTN","SAMICTT3",186,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecclm")_" in left main, ")
"RTN","SAMICTT3",187,0)
 . d OUT($$XSUB("cecc",vals,dict,"ceccld")_" in left anterior descending, ")
"RTN","SAMICTT3",188,0)
 . ;d OUT($$XSUB("cecc",vals,dict,"cecclf")_" in circumflex, and ")
"RTN","SAMICTT3",189,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecccf")_" in circumflex, and ")
"RTN","SAMICTT3",190,0)
 . d OUT($$XSUB("cecc",vals,dict,"ceccrc")_" in right coronary. "_cac)
"RTN","SAMICTT3",191,0)
 . s outmode="go"
"RTN","SAMICTT3",192,0)
 . d OUT("")
"RTN","SAMICTT3",193,0)
 ; 
"RTN","SAMICTT3",194,0)
 s outmode="hold"
"RTN","SAMICTT3",195,0)
 if $$XVAL("cecca",vals)'="-" d  ;
"RTN","SAMICTT3",196,0)
 . d HOUT("Aortic Calcifications: ")
"RTN","SAMICTT3",197,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecca"))
"RTN","SAMICTT3",198,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",199,0)
 ;
"RTN","SAMICTT3",200,0)
 s outmode="hold"
"RTN","SAMICTT3",201,0)
 n ocf s ocf=0
"RTN","SAMICTT3",202,0)
 d HOUT("Other Cardiac Findings: ")
"RTN","SAMICTT3",203,0)
 ;d HOUT("Other Cardiac Findings: ")
"RTN","SAMICTT3",204,0)
 ;
"RTN","SAMICTT3",205,0)
 ;s outmode="hold"
"RTN","SAMICTT3",206,0)
 ;# Pericardial Effusion
"RTN","SAMICTT3",207,0)
 if $$XVAL("ceprevm",vals)'="-" d  ;
"RTN","SAMICTT3",208,0)
 . if $$XVAL("ceprevm",vals)'="no" d  ;
"RTN","SAMICTT3",209,0)
 . . if $$XVAL("ceprevm",vals)'="" d
"RTN","SAMICTT3",210,0)
 . . . d OUT("A "_$$XSUB("ceprevm",vals,dict,"ceprevm")_" pericardial effusion"_". ") d OUT("")
"RTN","SAMICTT3",211,0)
 . . . s pe=1 s ocf=1
"RTN","SAMICTT3",212,0)
 . . else  d OUT("No pericardial effusion. ") d OUT("")
"RTN","SAMICTT3",213,0)
 ;
"RTN","SAMICTT3",214,0)
 ;
"RTN","SAMICTT3",215,0)
 ;;# Pulmonary and Aortic Diameter
"RTN","SAMICTT3",216,0)
 i $$XVAL("cepaw",vals)'="" d  ;
"RTN","SAMICTT3",217,0)
 . d OUT("Widest main pulmonary artery diameter is "_$$XVAL("cepaw",vals)_" mm. ")
"RTN","SAMICTT3",218,0)
 . if $$XVAL("ceaow",vals)'="" d  ;
"RTN","SAMICTT3",219,0)
 . . d OUT("Widest ascending aortic diameter at the same level is "_$$XVAL("ceaow",vals)_" mm. ")
"RTN","SAMICTT3",220,0)
 . . if $$XVAL("cepar",vals)'="" d  ;
"RTN","SAMICTT3",221,0)
 . . . d OUT("The ratio is "_$$XVAL("cepar",vals)_". ")
"RTN","SAMICTT3",222,0)
 . d OUT("") s ocf=1
"RTN","SAMICTT3",223,0)
 ;
"RTN","SAMICTT3",224,0)
 ; #"Additional Comments on Cardiac Abnormalities:"
"RTN","SAMICTT3",225,0)
 if $$XVAL("cecommca",vals)'="" d  ;
"RTN","SAMICTT3",226,0)
 . d OUT($$XVAL("cecommca",vals)_". ")
"RTN","SAMICTT3",227,0)
 . s ocf=1
"RTN","SAMICTT3",228,0)
 i ocf=0 d OUT("None. ")
"RTN","SAMICTT3",229,0)
 s outmode="go"
"RTN","SAMICTT3",230,0)
 d OUT("")
"RTN","SAMICTT3",231,0)
 ;
"RTN","SAMICTT3",232,0)
 ;
"RTN","SAMICTT3",233,0)
 s outmode="hold"
"RTN","SAMICTT3",234,0)
 d HOUT("Mediastinum: ")
"RTN","SAMICTT3",235,0)
 n yesmm s yesmm=0
"RTN","SAMICTT3",236,0)
 n abn
"RTN","SAMICTT3",237,0)
 i ($$XVAL("ceoma",vals)="y")&($$XVAL("ceata",vals)="y") d  ;
"RTN","SAMICTT3",238,0)
 . s yeamm=1
"RTN","SAMICTT3",239,0)
 . s abn=$$CCMSTR("ceatc^ceaty^ceatm",vals)
"RTN","SAMICTT3",240,0)
 . ;d OUT("[abn="_abn_"]")
"RTN","SAMICTT3",241,0)
 . i abn="" d OUT(sp1_"Noted in the thyroid. ")
"RTN","SAMICTT3",242,0)
 . i abn'="" d OUT(sp1_abn_" thyroid. ")
"RTN","SAMICTT3",243,0)
 . i $$XVAL("ceato",vals)="o" d OUT(sp1_$$XVAL("ceatos",vals)_"<br>")
"RTN","SAMICTT3",244,0)
 i $$XVAL("ceaya",vals)="y" d  ;
"RTN","SAMICTT3",245,0)
 . s yesmm=1
"RTN","SAMICTT3",246,0)
 . s abn=$$CCMSTR("ceayc^ceayy^ceaym",vals)
"RTN","SAMICTT3",247,0)
 . i abn="" d OUT(sp1_"Noted in the thymus")
"RTN","SAMICTT3",248,0)
 . i abn'="" d OUT(sp1_abn_" thymus. ")
"RTN","SAMICTT3",249,0)
 . i $$XVAL("ceayo",vals)="o" d OUT(sp1_$$XVAL("ceayos",vals))
"RTN","SAMICTT3",250,0)
 ;
"RTN","SAMICTT3",251,0)
 ;   # Non-calcified lymph nodes
"RTN","SAMICTT3",252,0)
 n lnlist,lnlistt
"RTN","SAMICTT3",253,0)
 set lnlist(1)="cemlnl1"
"RTN","SAMICTT3",254,0)
 set lnlist(2)="cemlnl2r"
"RTN","SAMICTT3",255,0)
 set lnlist(3)="cemlnl2l"
"RTN","SAMICTT3",256,0)
 set lnlist(4)="cemlnl3"
"RTN","SAMICTT3",257,0)
 set lnlist(5)="cemlnl4r"
"RTN","SAMICTT3",258,0)
 set lnlist(6)="cemlnl4l"
"RTN","SAMICTT3",259,0)
 set lnlist(7)="cemlnl5"
"RTN","SAMICTT3",260,0)
 set lnlist(8)="cemlnl6"
"RTN","SAMICTT3",261,0)
 set lnlist(9)="cemlnl7"
"RTN","SAMICTT3",262,0)
 set lnlist(10)="cemlnl8"
"RTN","SAMICTT3",263,0)
 set lnlist(11)="cemlnl9"
"RTN","SAMICTT3",264,0)
 set lnlist(12)="cemlnl10r"
"RTN","SAMICTT3",265,0)
 set lnlist(13)="cemlnl10l"
"RTN","SAMICTT3",266,0)
 ;
"RTN","SAMICTT3",267,0)
 set lnlistt(1)="high mediastinal"
"RTN","SAMICTT3",268,0)
 set lnlistt(2)="right upper paratracheal"
"RTN","SAMICTT3",269,0)
 set lnlistt(3)="left upper paratracheal"
"RTN","SAMICTT3",270,0)
 set lnlistt(4)="prevascular/retrotracheal"
"RTN","SAMICTT3",271,0)
 set lnlistt(5)="right lower paratracheal"
"RTN","SAMICTT3",272,0)
 set lnlistt(6)="left lower paratracheal"
"RTN","SAMICTT3",273,0)
 set lnlistt(7)="sub-aortic (A-P window)"
"RTN","SAMICTT3",274,0)
 set lnlistt(8)="para-aortic"
"RTN","SAMICTT3",275,0)
 set lnlistt(9)="subcarinal"
"RTN","SAMICTT3",276,0)
 set lnlistt(10)="para-esophageal"
"RTN","SAMICTT3",277,0)
 set lnlistt(11)="pulmonary ligament"
"RTN","SAMICTT3",278,0)
 set lnlistt(12)="right hilar"
"RTN","SAMICTT3",279,0)
 set lnlistt(13)="left hilar"
"RTN","SAMICTT3",280,0)
 ;
"RTN","SAMICTT3",281,0)
 ;
"RTN","SAMICTT3",282,0)
 ;s outmode="hold"
"RTN","SAMICTT3",283,0)
 if $$XVAL("cemln",vals)="y" d  ;
"RTN","SAMICTT3",284,0)
 . s yesmm=1
"RTN","SAMICTT3",285,0)
 . n llist,item
"RTN","SAMICTT3",286,0)
 . s (llist,item)=""
"RTN","SAMICTT3",287,0)
 . f  s item=$o(lnlist(item)) q:item=""  d  ;
"RTN","SAMICTT3",288,0)
 . . i $$XVAL(lnlist(item),vals)'="" s llist($o(llist(""),-1)+1)=lnlist(item)
"RTN","SAMICTT3",289,0)
 . n lnum,slnum
"RTN","SAMICTT3",290,0)
 . s lnum=$o(llist(""),-1)
"RTN","SAMICTT3",291,0)
 . i lnum=0 d OUT("Enlarged or growing lymph nodes are noted. ")
"RTN","SAMICTT3",292,0)
 . i lnum>0 d  ;
"RTN","SAMICTT3",293,0)
 . . s slnum=lnum
"RTN","SAMICTT3",294,0)
 . . d OUT("Enlarged or growing lymph nodes in the ")
"RTN","SAMICTT3",295,0)
 . . s item=""
"RTN","SAMICTT3",296,0)
 . . f  s item=$o(llist(item)) q:item=""  d  ;
"RTN","SAMICTT3",297,0)
 . . . d OUT(lnlistt(item))
"RTN","SAMICTT3",298,0)
 . . . i lnum>2 d OUT(", ")
"RTN","SAMICTT3",299,0)
 . . . i lnum=2 d OUT(" and ")
"RTN","SAMICTT3",300,0)
 . . . s lnum=lnum-1
"RTN","SAMICTT3",301,0)
 . . i slnum>1 d OUT(" locations. ")
"RTN","SAMICTT3",302,0)
 . . i slnum=1 d OUT(" location. ")
"RTN","SAMICTT3",303,0)
 ;
"RTN","SAMICTT3",304,0)
 ;s outmode="go"
"RTN","SAMICTT3",305,0)
 ;d OUT("")
"RTN","SAMICTT3",306,0)
 ;
"RTN","SAMICTT3",307,0)
 if $$XVAL("cemlncab",vals)="y" d  ;
"RTN","SAMICTT3",308,0)
 . set yesmm=1
"RTN","SAMICTT3",309,0)
 . d OUT("Calcified lymph nodes present. ")
"RTN","SAMICTT3",310,0)
 ;
"RTN","SAMICTT3",311,0)
 if $$XVAL("ceagaln",vals)="y" d  ;
"RTN","SAMICTT3",312,0)
 . set yesmm=1
"RTN","SAMICTT3",313,0)
 . d OUT("Enlarged or growing axillary lymph nodes without central fat are seen. ")
"RTN","SAMICTT3",314,0)
 . d OUT($$XVAL("ceagalns",vals))
"RTN","SAMICTT3",315,0)
 ;
"RTN","SAMICTT3",316,0)
 if $$XVAL("cemva",vals)="y" d  ;
"RTN","SAMICTT3",317,0)
 . set yesmm=1
"RTN","SAMICTT3",318,0)
 . if $$XVAL("cemvaa",vals)="a" d  ;
"RTN","SAMICTT3",319,0)
 . . d OUT("Other vascular abnormalities are seen in the aorta. ")
"RTN","SAMICTT3",320,0)
 . if $$XVAL("cemvaa",vals)="w" d  ;
"RTN","SAMICTT3",321,0)
 . . d OUT("Other vascular abnormalities are seen in the pulmonary series. ")
"RTN","SAMICTT3",322,0)
 . d OUT($$XVAL("cemvaos",vals)_"<br>")
"RTN","SAMICTT3",323,0)
 ;
"RTN","SAMICTT3",324,0)
 ;s outmode="hold"
"RTN","SAMICTT3",325,0)
 ;   # Esophageal
"RTN","SAMICTT3",326,0)
 if $$XVAL("cemeln",vals)="y" d  ;
"RTN","SAMICTT3",327,0)
 . set yesmm=1
"RTN","SAMICTT3",328,0)
 . n elist s elist=""
"RTN","SAMICTT3",329,0)
 . set numl=0
"RTN","SAMICTT3",330,0)
 . if $$XVAL("cemelna",vals)="a" d  ;
"RTN","SAMICTT3",331,0)
 . . s elist($o(elist(""),-1)+1)="Air-fluid level"
"RTN","SAMICTT3",332,0)
 . . s numl=numl+1
"RTN","SAMICTT3",333,0)
 . if $$XVAL("cemelnw",vals)="w" d  ;
"RTN","SAMICTT3",334,0)
 . . s elist($o(elist(""),-1)+1)="Wall thickening"
"RTN","SAMICTT3",335,0)
 . . s numl=numl+1
"RTN","SAMICTT3",336,0)
 . if $$XVAL("cemelnm",vals)="m" d  ;
"RTN","SAMICTT3",337,0)
 . . s elist($o(elist(""),-1)+1)="A mass"
"RTN","SAMICTT3",338,0)
 . . s numl=numl+1
"RTN","SAMICTT3",339,0)
 . if numl=0 d OUT("Esophageal abnormality noted. ")
"RTN","SAMICTT3",340,0)
 . e  d  ;
"RTN","SAMICTT3",341,0)
 . . d OUT($g(elist(1)))
"RTN","SAMICTT3",342,0)
 . . if numl=1 d OUT(" is ")
"RTN","SAMICTT3",343,0)
 . . e  d  ;
"RTN","SAMICTT3",344,0)
 . . . if numl=2 d  ;
"RTN","SAMICTT3",345,0)
 . . . . d OUT(" and ")
"RTN","SAMICTT3",346,0)
 . . . e  d OUT(", ")
"RTN","SAMICTT3",347,0)
 . . . d OUT($$LOWC($g(elist(2))))
"RTN","SAMICTT3",348,0)
 . . . if numl=3 d  ;
"RTN","SAMICTT3",349,0)
 . . . . d OUT(", and "_$$LOWC($g(elist(3))))
"RTN","SAMICTT3",350,0)
 . . d OUT("seen in the esophagus. ")
"RTN","SAMICTT3",351,0)
 . d OUT($$XVAL("cemelnos",vals))
"RTN","SAMICTT3",352,0)
 ;s outmode="go"
"RTN","SAMICTT3",353,0)
 ;d OUT("")
"RTN","SAMICTT3",354,0)
 ;
"RTN","SAMICTT3",355,0)
 ;
"RTN","SAMICTT3",356,0)
 if $$XVAL("cehhn",vals)="y" d  ;
"RTN","SAMICTT3",357,0)
 . set yesmm=1
"RTN","SAMICTT3",358,0)
 . if $$XVAL("cehhnos",vals)'="" d OUT("Hiatal hernia: "_$$XVAL("cehhnos",vals))
"RTN","SAMICTT3",359,0)
 . if $$XVAL("cehhnos",vals)="" d OUT("Hiatal hernia. ")
"RTN","SAMICTT3",360,0)
 . d OUT("")
"RTN","SAMICTT3",361,0)
 ;
"RTN","SAMICTT3",362,0)
 if $$XVAL("ceomm",vals)="y" d  ;
"RTN","SAMICTT3",363,0)
 . set yesmm=1
"RTN","SAMICTT3",364,0)
 . n tval
"RTN","SAMICTT3",365,0)
 . set tval=$$XVAL("ceommos",vals)
"RTN","SAMICTT3",366,0)
 . set abn=$$CCMSTR("ceamc^ceamy^ceamm",vals)
"RTN","SAMICTT3",367,0)
 . if abn="" d OUT(sp1_"Abnormality noted in the mediastinum. ")
"RTN","SAMICTT3",368,0)
 . e  d OUT(sp1_abn_" mediastinum. ")
"RTN","SAMICTT3",369,0)
 . d OUT(tval)
"RTN","SAMICTT3",370,0)
 ;i yesmm=0 d OUT(sp1_"No abnormalities. ")
"RTN","SAMICTT3",371,0)
 i yesmm=0 d OUT(sp1_"Unremarkable. ")
"RTN","SAMICTT3",372,0)
 i $$XVAL("ceotabnm",vals)'="" d  ;
"RTN","SAMICTT3",373,0)
 . d OUT(sp1_$$XVAL("ceotabnm",vals)_". ")
"RTN","SAMICTT3",374,0)
 s outmode="go"
"RTN","SAMICTT3",375,0)
 d OUT("")
"RTN","SAMICTT3",376,0)
 ;
"RTN","SAMICTT3",377,0)
 ;
"RTN","SAMICTT3",378,0)
 quit  ; end of EMPHYS
"RTN","SAMICTT3",379,0)
 ;
"RTN","SAMICTT3",380,0)
 ;
"RTN","SAMICTT3",381,0)
 ;
"RTN","SAMICTT3",382,0)
CCMSTR(lst,vals) ; extrinsic that forms phrases
"RTN","SAMICTT3",383,0)
 ;
"RTN","SAMICTT3",384,0)
 ;@called-by
"RTN","SAMICTT3",385,0)
 ; EMPHYS
"RTN","SAMICTT3",386,0)
 ;@calls
"RTN","SAMICTT3",387,0)
 ; $$XVAL
"RTN","SAMICTT3",388,0)
 ; $$LOWC
"RTN","SAMICTT3",389,0)
 ;@input
"RTN","SAMICTT3",390,0)
 ; lst
"RTN","SAMICTT3",391,0)
 ; vals
"RTN","SAMICTT3",392,0)
 ;@output = phrase for comments
"RTN","SAMICTT3",393,0)
 ;
"RTN","SAMICTT3",394,0)
 n retstr s retstr=""
"RTN","SAMICTT3",395,0)
 n lblist s lblist=""
"RTN","SAMICTT3",396,0)
 n lb,ib s ib=""
"RTN","SAMICTT3",397,0)
 f lb=1:1:$l(lst,"^") d  ;
"RTN","SAMICTT3",398,0)
 . n lvar s lvar=$p(lst,"^",lb)
"RTN","SAMICTT3",399,0)
 . s ib=$$XVAL($p(lst,"^",lb),vals)
"RTN","SAMICTT3",400,0)
 . if ib'="" d  ;
"RTN","SAMICTT3",401,0)
 . . i ib="y" d  ; 
"RTN","SAMICTT3",402,0)
 . . . i $f("ceasc cealc ceapc ceapc ceaac ceakc",lvar)>0 s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",403,0)
 . . . ;i "ceasc cealc ceapc ceapc ceaac ceakc"[lb s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",404,0)
 . . . else  s lblist($o(lblist(""),-1)+1)="Cyst"
"RTN","SAMICTT3",405,0)
 . . i ib="c" s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",406,0)
 . . i ib="m" s lblist($o(lblist(""),-1)+1)="Mass"
"RTN","SAMICTT3",407,0)
 i $o(lblist(""),-1)=1 s retstr=retstr_lblist(1)_" is seen in the"
"RTN","SAMICTT3",408,0)
 e  i $o(lblist(""),-1)=2 s retstr=retstr_lblist(1)_" and "_$$LOWC(lblist(2))_" are seen in the"
"RTN","SAMICTT3",409,0)
 e  i $o(lblist(""),-1)=3 s retstr=retstr_"Calicification, cyst, and mass are seen in the"
"RTN","SAMICTT3",410,0)
 ;
"RTN","SAMICTT3",411,0)
 quit retstr ; end of $$CCMSTR
"RTN","SAMICTT3",412,0)
 ;
"RTN","SAMICTT3",413,0)
 ;
"RTN","SAMICTT3",414,0)
 ;
"RTN","SAMICTT3",415,0)
LOWC(X) ; convert X to lowercase
"RTN","SAMICTT3",416,0)
 ;
"RTN","SAMICTT3",417,0)
 ;@called-by
"RTN","SAMICTT3",418,0)
 ; EMPHYS
"RTN","SAMICTT3",419,0)
 ; $$CCMSTR
"RTN","SAMICTT3",420,0)
 ;@calls none
"RTN","SAMICTT3",421,0)
 ;@input
"RTN","SAMICTT3",422,0)
 ; X
"RTN","SAMICTT3",423,0)
 ;@output = lowercase string
"RTN","SAMICTT3",424,0)
 ;
"RTN","SAMICTT3",425,0)
 quit $translate(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","SAMICTT3",426,0)
 ;
"RTN","SAMICTT3",427,0)
 ;
"RTN","SAMICTT3",428,0)
 ;
"RTN","SAMICTT3",429,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT3",430,0)
 ;
"RTN","SAMICTT3",431,0)
 ;@called-by
"RTN","SAMICTT3",432,0)
 ; EMPHYS
"RTN","SAMICTT3",433,0)
 ;@calls none
"RTN","SAMICTT3",434,0)
 ;@input
"RTN","SAMICTT3",435,0)
 ; ln = output to add
"RTN","SAMICTT3",436,0)
 ;@output: line added to report
"RTN","SAMICTT3",437,0)
 ;
"RTN","SAMICTT3",438,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT3",439,0)
 s cnt=cnt+1
"RTN","SAMICTT3",440,0)
 n lnn
"RTN","SAMICTT3",441,0)
 ;s debug=1
"RTN","SAMICTT3",442,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",443,0)
 i outmode="go" d  ;
"RTN","SAMICTT3",444,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT3",445,0)
 . s line=""
"RTN","SAMICTT3",446,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",447,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT3",448,0)
 ;
"RTN","SAMICTT3",449,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT3",450,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT3",451,0)
 . n zs s zs=$STACK
"RTN","SAMICTT3",452,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT3",453,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT3",454,0)
 ;
"RTN","SAMICTT3",455,0)
 quit  ; end of OUT
"RTN","SAMICTT3",456,0)
 ;
"RTN","SAMICTT3",457,0)
 ;
"RTN","SAMICTT3",458,0)
 ;
"RTN","SAMICTT3",459,0)
OUTOLD(ln) ; old version of out
"RTN","SAMICTT3",460,0)
 ;
"RTN","SAMICTT3",461,0)
 ;@called-by none
"RTN","SAMICTT3",462,0)
 ;@calls none
"RTN","SAMICTT3",463,0)
 ;@input
"RTN","SAMICTT3",464,0)
 ; ln = output to add
"RTN","SAMICTT3",465,0)
 ;@output: line added to report
"RTN","SAMICTT3",466,0)
 ;
"RTN","SAMICTT3",467,0)
 s cnt=cnt+1
"RTN","SAMICTT3",468,0)
 n lnn
"RTN","SAMICTT3",469,0)
 ;s debug=1
"RTN","SAMICTT3",470,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",471,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT3",472,0)
 ;
"RTN","SAMICTT3",473,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT3",474,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT3",475,0)
 . n zs s zs=$STACK
"RTN","SAMICTT3",476,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT3",477,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT3",478,0)
 ;
"RTN","SAMICTT3",479,0)
 quit  ; end of OUTOLD
"RTN","SAMICTT3",480,0)
 ;
"RTN","SAMICTT3",481,0)
 ;
"RTN","SAMICTT3",482,0)
 ;
"RTN","SAMICTT3",483,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTT3",484,0)
 ;
"RTN","SAMICTT3",485,0)
 ;@called-by
"RTN","SAMICTT3",486,0)
 ; EMPHYS
"RTN","SAMICTT3",487,0)
 ;@calls
"RTN","SAMICTT3",488,0)
 ; OUT
"RTN","SAMICTT3",489,0)
 ;@input
"RTN","SAMICTT3",490,0)
 ; ln = header output to add
"RTN","SAMICTT3",491,0)
 ;@output: header line added to report
"RTN","SAMICTT3",492,0)
 ;
"RTN","SAMICTT3",493,0)
 D OUT(ln)
"RTN","SAMICTT3",494,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT3",495,0)
 ;
"RTN","SAMICTT3",496,0)
 quit  ; end of HOUT
"RTN","SAMICTT3",497,0)
 ;
"RTN","SAMICTT3",498,0)
 ;
"RTN","SAMICTT3",499,0)
 ;
"RTN","SAMICTT3",500,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT3",501,0)
 ;
"RTN","SAMICTT3",502,0)
 ;@called-by
"RTN","SAMICTT3",503,0)
 ; EMPHYS
"RTN","SAMICTT3",504,0)
 ; $$CCMSTR
"RTN","SAMICTT3",505,0)
 ;@calls none
"RTN","SAMICTT3",506,0)
 ;@input
"RTN","SAMICTT3",507,0)
 ; var
"RTN","SAMICTT3",508,0)
 ; vals is passed by nam
"RTN","SAMICTT3",509,0)
 ;@output = patient value for var
"RTN","SAMICTT3",510,0)
 ;
"RTN","SAMICTT3",511,0)
 ;e
"RTN","SAMICTT3",512,0)
 n zr
"RTN","SAMICTT3",513,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT3",514,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT3",515,0)
 ;
"RTN","SAMICTT3",516,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT3",517,0)
 ;
"RTN","SAMICTT3",518,0)
 ;
"RTN","SAMICTT3",519,0)
 ;
"RTN","SAMICTT3",520,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT3",521,0)
 ;
"RTN","SAMICTT3",522,0)
 ;@called-by
"RTN","SAMICTT3",523,0)
 ; EMPHYS
"RTN","SAMICTT3",524,0)
 ;@calls none
"RTN","SAMICTT3",525,0)
 ;@input
"RTN","SAMICTT3",526,0)
 ; var
"RTN","SAMICTT3",527,0)
 ; vals and dict are passed by name
"RTN","SAMICTT3",528,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT3",529,0)
 ;@output = dictionary value for var
"RTN","SAMICTT3",530,0)
 ;
"RTN","SAMICTT3",531,0)
 ;
"RTN","SAMICTT3",532,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT3",533,0)
 n zr,zv,zdx
"RTN","SAMICTT3",534,0)
 s zdx=$g(valdx)
"RTN","SAMICTT3",535,0)
 i zdx="" s zdx=var
"RTN","SAMICTT3",536,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT3",537,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT3",538,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT3",539,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT3",540,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT3",541,0)
 ;
"RTN","SAMICTT3",542,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT3",543,0)
 ;
"RTN","SAMICTT3",544,0)
 ;
"RTN","SAMICTT3",545,0)
 ;
"RTN","SAMICTT3",546,0)
EOR ; end of routine SAMICTT3
"RTN","SAMICTT4")
0^5^B54435090
"RTN","SAMICTT4",1,0)
SAMICTT4 ;ven/gpl - ctreport text breast abnorm ;2021-03-22T15:18Z
"RTN","SAMICTT4",2,0)
 ;;18.0;SAMI;**4,10**;2020-01;Build 3
"RTN","SAMICTT4",3,0)
 ;;1.18.0.10-i10
"RTN","SAMICTT4",4,0)
 ;
"RTN","SAMICTT4",5,0)
 ; SAMICTT4 creates the Breast Abnormalities section of the ELCAP CT
"RTN","SAMICTT4",6,0)
 ; Report in text format.
"RTN","SAMICTT4",7,0)
 ;
"RTN","SAMICTT4",8,0)
 quit  ; no entry from top
"RTN","SAMICTT4",9,0)
 ;
"RTN","SAMICTT4",10,0)
 ;
"RTN","SAMICTT4",11,0)
 ;
"RTN","SAMICTT4",12,0)
 ;@section 0 primary development
"RTN","SAMICTT4",13,0)
 ;
"RTN","SAMICTT4",14,0)
 ;
"RTN","SAMICTT4",15,0)
 ;
"RTN","SAMICTT4",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT4",17,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT4",18,0)
 ;@contents
"RTN","SAMICTT4",19,0)
 ; BREAST: breast abnormalities section of ct report text
"RTN","SAMICTT4",20,0)
 ; OUT: output a line of ct report
"RTN","SAMICTT4",21,0)
 ; OUTOLD: old version of out
"RTN","SAMICTT4",22,0)
 ; HOUT: output a ct report header line
"RTN","SAMICTT4",23,0)
 ; $$XVAL = patient value for var
"RTN","SAMICTT4",24,0)
 ; $$XSUB = dictionary value defined by var
"RTN","SAMICTT4",25,0)
 ;
"RTN","SAMICTT4",26,0)
 ;
"RTN","SAMICTT4",27,0)
 ;
"RTN","SAMICTT4",28,0)
 ;@section 1 BREAST & related subroutines
"RTN","SAMICTT4",29,0)
 ;
"RTN","SAMICTT4",30,0)
 ;
"RTN","SAMICTT4",31,0)
 ;
"RTN","SAMICTT4",32,0)
BREAST(rtn,vals,dict) ; breast abnormalities section of ct report text
"RTN","SAMICTT4",33,0)
 ;
"RTN","SAMICTT4",34,0)
 ; repgen6
"RTN","SAMICTT4",35,0)
 ;
"RTN","SAMICTT4",36,0)
 ;@called-by
"RTN","SAMICTT4",37,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT4",38,0)
 ;@calls
"RTN","SAMICTT4",39,0)
 ; $$XVAL
"RTN","SAMICTT4",40,0)
 ; OUT
"RTN","SAMICTT4",41,0)
 ; $$CCMSTR^SAMICTR3
"RTN","SAMICTT4",42,0)
 ; $$XSUB
"RTN","SAMICTT4",43,0)
 ; $$LOWC^SAMICTR3
"RTN","SAMICTT4",44,0)
 ;@input
"RTN","SAMICTT4",45,0)
 ; rtn
"RTN","SAMICTT4",46,0)
 ; vals
"RTN","SAMICTT4",47,0)
 ; dict
"RTN","SAMICTT4",48,0)
 ;@output: create breast abnormalities section of ct report text
"RTN","SAMICTT4",49,0)
 ;
"RTN","SAMICTT4",50,0)
 n sp1 s sp1="  "
"RTN","SAMICTT4",51,0)
 n outmode s outmode="hold"
"RTN","SAMICTT4",52,0)
 n line s line=""
"RTN","SAMICTT4",53,0)
 n destr s destr="is seen"
"RTN","SAMICTT4",54,0)
 n sba set sba=0
"RTN","SAMICTT4",55,0)
 ;   # Breast Abnormalities
"RTN","SAMICTT4",56,0)
 n bd,brt,blt
"RTN","SAMICTT4",57,0)
 s (bd,brt,blt)=0
"RTN","SAMICTT4",58,0)
 if $$XVAL("ceobard",vals)'="-" s brt=$$XVAL("ceobard",vals)
"RTN","SAMICTT4",59,0)
 if $$XVAL("ceobald",vals)'="-" s brt=$$XVAL("ceobald",vals)
"RTN","SAMICTT4",60,0)
 if (blt'=0)!(brt'=0) d  ;
"RTN","SAMICTT4",61,0)
 . d OUT("Breast:")
"RTN","SAMICTT4",62,0)
 . s bd=1
"RTN","SAMICTT4",63,0)
 s outmode="hold"
"RTN","SAMICTT4",64,0)
 if $$XVAL("ceara",vals)="y" d  ; our substitute for ceoba, which is null
"RTN","SAMICTT4",65,0)
 . if bd=0 d OUT("Breast:")
"RTN","SAMICTT4",66,0)
 . if $$XVAL("ceara",vals)="y" d  ;
"RTN","SAMICTT4",67,0)
 . . set sba=1
"RTN","SAMICTT4",68,0)
 . . n br
"RTN","SAMICTT4",69,0)
 . . set br=$$CCMSTR^SAMICTR3("ceobarc^ceobary^ceobarm",vals)
"RTN","SAMICTT4",70,0)
 . . if br="" d OUT("Noted in right breast: ")
"RTN","SAMICTT4",71,0)
 . . if br'="" d OUT(br_" right breast. ")
"RTN","SAMICTT4",72,0)
 . . d OUT($$XVAL("ceobaros",vals))
"RTN","SAMICTT4",73,0)
 if $$XVAL("ceafa",vals)="y" d  ; our substitute for ceoba, which is null
"RTN","SAMICTT4",74,0)
 . if bd=0 d OUT("Breast:")
"RTN","SAMICTT4",75,0)
 . if $$XVAL("ceafa",vals)="y" d  ;
"RTN","SAMICTT4",76,0)
 . . set sba=1
"RTN","SAMICTT4",77,0)
 . . n br
"RTN","SAMICTT4",78,0)
 . . set br=$$CCMSTR^SAMICTR3("ceobafc^ceobafy^ceobafm",vals)
"RTN","SAMICTT4",79,0)
 . . if br="" d OUT("Noted in left breast: ")
"RTN","SAMICTT4",80,0)
 . . if br'="" d OUT(br_" left breast. ")
"RTN","SAMICTT4",81,0)
 . . d OUT($$XVAL("ceobafos",vals))
"RTN","SAMICTT4",82,0)
 if bd=1 d  ;
"RTN","SAMICTT4",83,0)
 . if blt=brt d OUT("Density: "_$$XSUB("ceobad",vals,dict,"ceobald"))
"RTN","SAMICTT4",84,0)
 . else  d OUT("Density: Left "_$$XSUB("ceobad",vals,dict,"ceobald")_", Right "_$$XSUB("ceobad",vals,dict,"ceobard")_". ")
"RTN","SAMICTT4",85,0)
 if $$XVAL("ceobrc",vals)'="" d OUT($$XVAL("ceobrc",vals))
"RTN","SAMICTT4",86,0)
 else  if sba=1 d OUT("")
"RTN","SAMICTT4",87,0)
 s outmode="go"
"RTN","SAMICTT4",88,0)
 d OUT("")
"RTN","SAMICTT4",89,0)
 ;
"RTN","SAMICTT4",90,0)
 ;
"RTN","SAMICTT4",91,0)
 s outmode="hold"
"RTN","SAMICTT4",92,0)
 d OUT("Abdomen: ")
"RTN","SAMICTT4",93,0)
 n yesaa s yesaa=0
"RTN","SAMICTT4",94,0)
 ;  # Special Handling for the gallbladder
"RTN","SAMICTT4",95,0)
 ;
"RTN","SAMICTT4",96,0)
 if $$XVAL("ceaga",vals)="y" d  ;
"RTN","SAMICTT4",97,0)
 . d OUT(sp1_"Limited view of the upper abdomen reveals the following: ")
"RTN","SAMICTT4",98,0)
 . set yesaa=1
"RTN","SAMICTT4",99,0)
 . if $$XVAL("ceagh",vals)="h" d  ;
"RTN","SAMICTT4",100,0)
 . . d OUT(sp1_"status post cholecystectomy. ")
"RTN","SAMICTT4",101,0)
 . if $$XVAL("ceags",vals)="s" d  ;
"RTN","SAMICTT4",102,0)
 . . d OUT(sp1_"Gallstones are noted. ")
"RTN","SAMICTT4",103,0)
 . if $$XVAL("ceagl",vals)="l" d  ;
"RTN","SAMICTT4",104,0)
 . . d OUT(sp1_"Sludge is seen in the gall bladder. ")
"RTN","SAMICTT4",105,0)
 . if $$XVAL("ceago",vals)="y" d  ;
"RTN","SAMICTT4",106,0)
 . . d OUT(sp1_"An abnormality was noted in the gall bladder: ")
"RTN","SAMICTT4",107,0)
 if $$XVAL("ceagos",vals)'="" d  ;
"RTN","SAMICTT4",108,0)
 . d OUT($$XVAL("ceagos",vals))
"RTN","SAMICTT4",109,0)
 ;
"RTN","SAMICTT4",110,0)
 n aalist
"RTN","SAMICTT4",111,0)
 s aalist(1,"spleen",0)=$$XVAL("ceasa",vals)
"RTN","SAMICTT4",112,0)
 s aalist(1,"spleen",1)="ceasc^ceasy^ceasm"
"RTN","SAMICTT4",113,0)
 s aalist(1,"spleen",2)=$$XVAL("ceasos",vals)
"RTN","SAMICTT4",114,0)
 s aalist(2,"liver",0)=$$XVAL("ceala",vals)
"RTN","SAMICTT4",115,0)
 s aalist(2,"liver",1)="cealc^cealy^cealm"
"RTN","SAMICTT4",116,0)
 s aalist(2,"liver",2)=$$XVAL("cealos",vals)
"RTN","SAMICTT4",117,0)
 s aalist(3,"pancreas",0)=$$XVAL("ceapa",vals)
"RTN","SAMICTT4",118,0)
 s aalist(3,"pancreas",1)="ceapc^ceapy^ceapm"
"RTN","SAMICTT4",119,0)
 s aalist(3,"pancreas",2)=$$XVAL("ceapos",vals)
"RTN","SAMICTT4",120,0)
 s aalist(4,"adrenals",0)=$$XVAL("ceaaa",vals)
"RTN","SAMICTT4",121,0)
 s aalist(4,"adrenals",1)="ceaac^ceaay^ceaam"
"RTN","SAMICTT4",122,0)
 s aalist(4,"adrenals",2)=$$XVAL("ceaaos",vals)
"RTN","SAMICTT4",123,0)
 s aalist(5,"kidneys",0)=$$XVAL("ceaka",vals)
"RTN","SAMICTT4",124,0)
 s aalist(5,"kidneys",1)="ceakc^ceaky^ceakm"
"RTN","SAMICTT4",125,0)
 s aalist(5,"kidneys",2)=$$XVAL("ceakos",vals)
"RTN","SAMICTT4",126,0)
 ;
"RTN","SAMICTT4",127,0)
 n zan,zaa s zaa=""
"RTN","SAMICTT4",128,0)
 f zan=1:1:5  d  ;
"RTN","SAMICTT4",129,0)
 . s zaa=$o(aalist(zan,""))
"RTN","SAMICTT4",130,0)
 . if aalist(zan,zaa,0)="y" d  ;
"RTN","SAMICTT4",131,0)
 . . n zout
"RTN","SAMICTT4",132,0)
 . . s zout=$$CCMSTR^SAMICTR3(aalist(zan,zaa,1),vals)
"RTN","SAMICTT4",133,0)
 . . set yesaa=1
"RTN","SAMICTT4",134,0)
 . . if zout="" d  ;
"RTN","SAMICTT4",135,0)
 . . . ;d OUT(aalist(zan,zaa,2))
"RTN","SAMICTT4",136,0)
 . . . if aalist(zan,zaa,2)'="" d OUT(aalist(zan,zaa,2))
"RTN","SAMICTT4",137,0)
 . . if zout'="" d  ;
"RTN","SAMICTT4",138,0)
 . . . d OUT(sp1_"A "_$$LOWC^SAMICTR3(zout)_" "_zaa_". "_aalist(zan,zaa,2))
"RTN","SAMICTT4",139,0)
 ;
"RTN","SAMICTT4",140,0)
 ;# Other Abdominal Abnormalities
"RTN","SAMICTT4",141,0)
 ;
"RTN","SAMICTT4",142,0)
 if $$XVAL("ceaoab",vals)'="" d  ;
"RTN","SAMICTT4",143,0)
 . d OUT($$XVAL("ceaoab",vals)_". ")
"RTN","SAMICTT4",144,0)
 if yesaa=0  d  ;
"RTN","SAMICTT4",145,0)
 . ;d OUT(sp1_"Limited view of the upper abdomen reveals no abnormalities. ")
"RTN","SAMICTT4",146,0)
 . d OUT(sp1_"Limited view of the upper abdomen reveals nothing remarkable. ")
"RTN","SAMICTT4",147,0)
 ;
"RTN","SAMICTT4",148,0)
 ;
"RTN","SAMICTT4",149,0)
 ;# Other Chest Abnormalities
"RTN","SAMICTT4",150,0)
 ;
"RTN","SAMICTT4",151,0)
 if $$XVAL("ceotab",vals)'="" d
"RTN","SAMICTT4",152,0)
 . d OUT("Other chest abnormalities:")
"RTN","SAMICTT4",153,0)
 . d OUT($$XVAL("ceotab",vals)_". ")
"RTN","SAMICTT4",154,0)
 ;
"RTN","SAMICTT4",155,0)
 s outmode="go"
"RTN","SAMICTT4",156,0)
 d OUT("")
"RTN","SAMICTT4",157,0)
 ;
"RTN","SAMICTT4",158,0)
 ;# Bone Abnormalities
"RTN","SAMICTT4",159,0)
 ;
"RTN","SAMICTT4",160,0)
 s outmode="hold"
"RTN","SAMICTT4",161,0)
 if $$XVAL("ceaoabb",vals)'="" d  ;
"RTN","SAMICTT4",162,0)
 . d OUT("Bone:")
"RTN","SAMICTT4",163,0)
 . d OUT($$XVAL("ceaoabb",vals)_para)
"RTN","SAMICTT4",164,0)
 d  ;
"RTN","SAMICTT4",165,0)
 . q  ; LungRADS moved to SAMICTRA
"RTN","SAMICTT4",166,0)
 . n lradModifiers
"RTN","SAMICTT4",167,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTT4",168,0)
 . ;
"RTN","SAMICTT4",169,0)
 . i ($$XVAL("celrad",vals)'="-")&($$XVAL("celrad",vals)'="") d  ;
"RTN","SAMICTT4",170,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTT4",171,0)
 . . d OUT("")
"RTN","SAMICTT4",172,0)
 s outmode="go"
"RTN","SAMICTT4",173,0)
 d OUT("")
"RTN","SAMICTT4",174,0)
 ;
"RTN","SAMICTT4",175,0)
 quit  ; end of BREAST
"RTN","SAMICTT4",176,0)
 ;
"RTN","SAMICTT4",177,0)
 ;
"RTN","SAMICTT4",178,0)
 ;
"RTN","SAMICTT4",179,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT4",180,0)
 ;
"RTN","SAMICTT4",181,0)
 ;@called-by
"RTN","SAMICTT4",182,0)
 ; BREAST
"RTN","SAMICTT4",183,0)
 ;@calls none
"RTN","SAMICTT4",184,0)
 ;@input
"RTN","SAMICTT4",185,0)
 ; ln = output to add
"RTN","SAMICTT4",186,0)
 ;@output: line added to report
"RTN","SAMICTT4",187,0)
 ;
"RTN","SAMICTT4",188,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT4",189,0)
 s cnt=cnt+1
"RTN","SAMICTT4",190,0)
 n lnn
"RTN","SAMICTT4",191,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT4",192,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT4",193,0)
 i outmode="go" d  ;
"RTN","SAMICTT4",194,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT4",195,0)
 . s line=""
"RTN","SAMICTT4",196,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT4",197,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT4",198,0)
 ;
"RTN","SAMICTT4",199,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT4",200,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT4",201,0)
 . n zs s zs=$STACK
"RTN","SAMICTT4",202,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT4",203,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT4",204,0)
 ;
"RTN","SAMICTT4",205,0)
 quit  ; end of OUT
"RTN","SAMICTT4",206,0)
 ;
"RTN","SAMICTT4",207,0)
 ;
"RTN","SAMICTT4",208,0)
 ;
"RTN","SAMICTT4",209,0)
OUTOLD(ln) ; old version of out
"RTN","SAMICTT4",210,0)
 ;
"RTN","SAMICTT4",211,0)
 ;@called-by none
"RTN","SAMICTT4",212,0)
 ;@calls none
"RTN","SAMICTT4",213,0)
 ;@input
"RTN","SAMICTT4",214,0)
 ; ln = output to add
"RTN","SAMICTT4",215,0)
 ;@output: line added to report
"RTN","SAMICTT4",216,0)
 ;
"RTN","SAMICTT4",217,0)
 s cnt=cnt+1
"RTN","SAMICTT4",218,0)
 n lnn
"RTN","SAMICTT4",219,0)
 ;s debug=1
"RTN","SAMICTT4",220,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT4",221,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT4",222,0)
 ;
"RTN","SAMICTT4",223,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT4",224,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT4",225,0)
 . n zs s zs=$STACK
"RTN","SAMICTT4",226,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT4",227,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT4",228,0)
 ;
"RTN","SAMICTT4",229,0)
 quit  ; end of OUTOLD
"RTN","SAMICTT4",230,0)
 ;
"RTN","SAMICTT4",231,0)
 ;
"RTN","SAMICTT4",232,0)
 ;
"RTN","SAMICTT4",233,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTT4",234,0)
 ;
"RTN","SAMICTT4",235,0)
 ;@called-by none
"RTN","SAMICTT4",236,0)
 ;@calls
"RTN","SAMICTT4",237,0)
 ; OUT
"RTN","SAMICTT4",238,0)
 ;@input
"RTN","SAMICTT4",239,0)
 ; ln = header output to add
"RTN","SAMICTT4",240,0)
 ;@output: header line added to report
"RTN","SAMICTT4",241,0)
 ;
"RTN","SAMICTT4",242,0)
 d OUT(ln)
"RTN","SAMICTT4",243,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT4",244,0)
 ;
"RTN","SAMICTT4",245,0)
 quit  ; end of HOUT
"RTN","SAMICTT4",246,0)
 ;
"RTN","SAMICTT4",247,0)
 ;
"RTN","SAMICTT4",248,0)
 ;
"RTN","SAMICTT4",249,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT4",250,0)
 ;
"RTN","SAMICTT4",251,0)
 ;@called-by
"RTN","SAMICTT4",252,0)
 ; BREAST
"RTN","SAMICTT4",253,0)
 ;@calls none
"RTN","SAMICTT4",254,0)
 ;@input
"RTN","SAMICTT4",255,0)
 ; vals is passed by name
"RTN","SAMICTT4",256,0)
 ;@output = patient value for var
"RTN","SAMICTT4",257,0)
 ;
"RTN","SAMICTT4",258,0)
 n zr
"RTN","SAMICTT4",259,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT4",260,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT4",261,0)
 ;
"RTN","SAMICTT4",262,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT4",263,0)
 ;
"RTN","SAMICTT4",264,0)
 ;
"RTN","SAMICTT4",265,0)
 ;
"RTN","SAMICTT4",266,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT4",267,0)
 ;
"RTN","SAMICTT4",268,0)
 ;@called-by
"RTN","SAMICTT4",269,0)
 ; BREAST
"RTN","SAMICTT4",270,0)
 ;@calls none
"RTN","SAMICTT4",271,0)
 ;@input
"RTN","SAMICTT4",272,0)
 ; vals and dict are passed by name
"RTN","SAMICTT4",273,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT4",274,0)
 ;@output = dictionary value for var
"RTN","SAMICTT4",275,0)
 ;
"RTN","SAMICTT4",276,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT4",277,0)
 n zr,zv,zdx
"RTN","SAMICTT4",278,0)
 s zdx=$g(valdx)
"RTN","SAMICTT4",279,0)
 i zdx="" s zdx=var
"RTN","SAMICTT4",280,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT4",281,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT4",282,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT4",283,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT4",284,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT4",285,0)
 ;
"RTN","SAMICTT4",286,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT4",287,0)
 ;
"RTN","SAMICTT4",288,0)
 ;
"RTN","SAMICTT4",289,0)
 ;
"RTN","SAMICTT4",290,0)
EOR ; end of routine SAMICTT4
"RTN","SAMICTT9")
0^6^B17246420
"RTN","SAMICTT9",1,0)
SAMICTT9 ;ven/gpl - ctreport text impressions ;2021-03-22T15:17Z
"RTN","SAMICTT9",2,0)
 ;;18.0;SAMI;**4,10**;2020-01;Build 3
"RTN","SAMICTT9",3,0)
 ;;1.18.0.10-i10
"RTN","SAMICTT9",4,0)
 ;
"RTN","SAMICTT9",5,0)
 ; SAMICTT9 creates the Impressions section of the ELCAP CT Report in
"RTN","SAMICTT9",6,0)
 ; text format.
"RTN","SAMICTT9",7,0)
 ;
"RTN","SAMICTT9",8,0)
 quit  ; no entry from top
"RTN","SAMICTT9",9,0)
 ;
"RTN","SAMICTT9",10,0)
 ;
"RTN","SAMICTT9",11,0)
 ;
"RTN","SAMICTT9",12,0)
 ;@section 0 primary development
"RTN","SAMICTT9",13,0)
 ;
"RTN","SAMICTT9",14,0)
 ;
"RTN","SAMICTT9",15,0)
 ;
"RTN","SAMICTT9",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT9",17,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT9",18,0)
 ;@contents
"RTN","SAMICTT9",19,0)
 ; IMPRSN: impressions section of ctreport text format
"RTN","SAMICTT9",20,0)
 ; OUT: output a line of ct report
"RTN","SAMICTT9",21,0)
 ; OUTOLD: old version of out
"RTN","SAMICTT9",22,0)
 ; HOUT: output a ct report header line
"RTN","SAMICTT9",23,0)
 ; $$XVAL = patient value for var
"RTN","SAMICTT9",24,0)
 ; $$XSUB = dictionary value defined by var
"RTN","SAMICTT9",25,0)
 ;
"RTN","SAMICTT9",26,0)
 ;
"RTN","SAMICTT9",27,0)
 ;
"RTN","SAMICTT9",28,0)
 ;@section 1 IMPRSN & related subroutines
"RTN","SAMICTT9",29,0)
 ;
"RTN","SAMICTT9",30,0)
 ;
"RTN","SAMICTT9",31,0)
 ;
"RTN","SAMICTT9",32,0)
IMPRSN(rtn,vals,dict) ; impressions section of ctreport text format
"RTN","SAMICTT9",33,0)
 ;
"RTN","SAMICTT9",34,0)
 ; repgen13
"RTN","SAMICTT9",35,0)
 ;
"RTN","SAMICTT9",36,0)
 ;@called-by
"RTN","SAMICTT9",37,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT9",38,0)
 ;@calls
"RTN","SAMICTT9",39,0)
 ; OUT
"RTN","SAMICTT9",40,0)
 ; $$XSUB
"RTN","SAMICTT9",41,0)
 ; $$XVAL
"RTN","SAMICTT9",42,0)
 ;@input
"RTN","SAMICTT9",43,0)
 ; rtn
"RTN","SAMICTT9",44,0)
 ; vals
"RTN","SAMICTT9",45,0)
 ; dict
"RTN","SAMICTT9",46,0)
 ;@output: create impressions section of ct report in text format
"RTN","SAMICTT9",47,0)
 ;
"RTN","SAMICTT9",48,0)
 ; # Impression
"RTN","SAMICTT9",49,0)
 ;d OUT("</TD></TR></TABLE><TR><TD>")
"RTN","SAMICTT9",50,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT9",51,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT9",52,0)
 ;d OUT("<!-- impression -->")
"RTN","SAMICTT9",53,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTT9",54,0)
 ;d OUT("<FONT SIZE=""+2"">")
"RTN","SAMICTT9",55,0)
 ;d OUT("<B>IMPRESSION:</B>")
"RTN","SAMICTT9",56,0)
 ;d OUT("</FONT>")
"RTN","SAMICTT9",57,0)
 ;d OUT("</TD></TR><TR><TD><TABLE>")
"RTN","SAMICTT9",58,0)
 ;d OUT("<TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTT9",59,0)
 d OUT("")
"RTN","SAMICTT9",60,0)
 d OUT("IMPRESSION:")
"RTN","SAMICTT9",61,0)
 d OUT("")
"RTN","SAMICTT9",62,0)
 ;
"RTN","SAMICTT9",63,0)
 d OUT($$XSUB("ceimn",vals,dict)_para)
"RTN","SAMICTT9",64,0)
 ;
"RTN","SAMICTT9",65,0)
 ;# Report CAC Score and Extent of Emphysema
"RTN","SAMICTT9",66,0)
 s cacval=0
"RTN","SAMICTT9",67,0)
 d  ;if $$XVAL("ceccv",vals)'="e" d  ;
"RTN","SAMICTT9",68,0)
 . set vcac=$$XVAL("cecccac",vals)
"RTN","SAMICTT9",69,0)
 . if vcac'="" d  ;
"RTN","SAMICTT9",70,0)
 . . s cacrec=""
"RTN","SAMICTT9",71,0)
 . . s cac="The Visual Coronary Artery Calcium (CAC) Score is "_vcac_". "
"RTN","SAMICTT9",72,0)
 . . s cacval=vcac
"RTN","SAMICTT9",73,0)
 . . i cacval>3 s cacrec=$g(@dict@("CAC_recommendation"))_para
"RTN","SAMICTT9",74,0)
 ;
"RTN","SAMICTT9",75,0)
 i cacval>0 d  ;
"RTN","SAMICTT9",76,0)
 . d OUT("")
"RTN","SAMICTT9",77,0)
 . d OUT(cac_" "_cacrec_" ") d OUT("")
"RTN","SAMICTT9",78,0)
 . d  ;if $$XVAL("ceemv",vals)="e" d  ;
"RTN","SAMICTT9",79,0)
 . . if $$XVAL("ceem",vals)'="no" d  ;
"RTN","SAMICTT9",80,0)
 . . . if $$XVAL("ceem",vals)="nv" q  ;
"RTN","SAMICTT9",81,0)
 . . . d OUT("Emphysema:") d OUT("")
"RTN","SAMICTT9",82,0)
 . . . d OUT($$XSUB("ceem",vals,dict)_". ") d OUT("")
"RTN","SAMICTT9",83,0)
 ;
"RTN","SAMICTT9",84,0)
 i $$XVAL("ceclini",vals)="y" d  ;
"RTN","SAMICTT9",85,0)
 . d OUT($$XVAL("ceclin",vals)_". ") d OUT("")
"RTN","SAMICTT9",86,0)
 ;
"RTN","SAMICTT9",87,0)
 i $$XVAL("ceoppai",vals)="y" d  ;
"RTN","SAMICTT9",88,0)
 . d OUT($$XVAL("ceoppa",vals)_". ") d OUT("")
"RTN","SAMICTT9",89,0)
 ;
"RTN","SAMICTT9",90,0)
 i $$XVAL("ceoppabi",vals)="y" d  ;
"RTN","SAMICTT9",91,0)
 . d OUT($$XVAL("ceoppab",vals)_". ") d OUT("")
"RTN","SAMICTT9",92,0)
 ;
"RTN","SAMICTT9",93,0)
 i $$XVAL("cecommcai",vals)="y" d  ;
"RTN","SAMICTT9",94,0)
 . d OUT($$XVAL("cecommca",vals)_". ") d OUT("")
"RTN","SAMICTT9",95,0)
 ;
"RTN","SAMICTT9",96,0)
 i $$XVAL("ceotabnmi",vals)="y" d  ;
"RTN","SAMICTT9",97,0)
 . d OUT($$XVAL("ceotabnm",vals)_". ") d OUT("")
"RTN","SAMICTT9",98,0)
 ;
"RTN","SAMICTT9",99,0)
 i $$XVAL("ceobrci",vals)="y" d  ;
"RTN","SAMICTT9",100,0)
 . d OUT($$XVAL("ceobrc",vals)_". ") d OUT("")
"RTN","SAMICTT9",101,0)
 ;
"RTN","SAMICTT9",102,0)
 i $$XVAL("ceaoabbi",vals)="y" d  ;
"RTN","SAMICTT9",103,0)
 . d OUT($$XVAL("ceaoabb",vals)_". ") d OUT("")
"RTN","SAMICTT9",104,0)
 ;
"RTN","SAMICTT9",105,0)
 i $$XVAL("ceaoabi",vals)="y" d  ;
"RTN","SAMICTT9",106,0)
 . d OUT($$XVAL("ceaoab",vals)_". ") d OUT("")
"RTN","SAMICTT9",107,0)
 ;
"RTN","SAMICTT9",108,0)
 ;# Impression Remarks
"RTN","SAMICTT9",109,0)
 i $$XVAL("ceimre",vals)'="" d  ;
"RTN","SAMICTT9",110,0)
 . d OUT($$XVAL("ceimre",vals)_". ") d OUT("")
"RTN","SAMICTT9",111,0)
 ;
"RTN","SAMICTT9",112,0)
 quit  ; end of IMPRSN
"RTN","SAMICTT9",113,0)
 ;
"RTN","SAMICTT9",114,0)
 ;
"RTN","SAMICTT9",115,0)
 ;
"RTN","SAMICTT9",116,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT9",117,0)
 ;
"RTN","SAMICTT9",118,0)
 ;@called-by
"RTN","SAMICTT9",119,0)
 ; IMPRSN
"RTN","SAMICTT9",120,0)
 ;@calls none
"RTN","SAMICTT9",121,0)
 ;@input
"RTN","SAMICTT9",122,0)
 ; ln = output to add
"RTN","SAMICTT9",123,0)
 ;@output: line added to ct report
"RTN","SAMICTT9",124,0)
 ;
"RTN","SAMICTT9",125,0)
 s cnt=cnt+1
"RTN","SAMICTT9",126,0)
 n lnn
"RTN","SAMICTT9",127,0)
 ;s debug=1
"RTN","SAMICTT9",128,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT9",129,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT9",130,0)
 ;
"RTN","SAMICTT9",131,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT9",132,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT9",133,0)
 . n zs s zs=$STACK
"RTN","SAMICTT9",134,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT9",135,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT9",136,0)
 ;
"RTN","SAMICTT9",137,0)
 quit  ; end of OUT
"RTN","SAMICTT9",138,0)
 ;
"RTN","SAMICTT9",139,0)
 ;
"RTN","SAMICTT9",140,0)
 ;
"RTN","SAMICTT9",141,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTT9",142,0)
 ;
"RTN","SAMICTT9",143,0)
 ;@called-by none
"RTN","SAMICTT9",144,0)
 ;@calls
"RTN","SAMICTT9",145,0)
 ; OUT
"RTN","SAMICTT9",146,0)
 ;@input
"RTN","SAMICTT9",147,0)
 ; ln = output to add
"RTN","SAMICTT9",148,0)
 ;@output: header line added to ct report
"RTN","SAMICTT9",149,0)
 ;
"RTN","SAMICTT9",150,0)
 d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT9",151,0)
 ;
"RTN","SAMICTT9",152,0)
 quit  ; end of HOUT
"RTN","SAMICTT9",153,0)
 ;
"RTN","SAMICTT9",154,0)
 ;
"RTN","SAMICTT9",155,0)
 ;
"RTN","SAMICTT9",156,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT9",157,0)
 ;
"RTN","SAMICTT9",158,0)
 ;@called-by
"RTN","SAMICTT9",159,0)
 ; IMPRSN
"RTN","SAMICTT9",160,0)
 ;@calls none
"RTN","SAMICTT9",161,0)
 ;@input
"RTN","SAMICTT9",162,0)
 ; var
"RTN","SAMICTT9",163,0)
 ; vals is passed by name
"RTN","SAMICTT9",164,0)
 ;@output = patient value for var
"RTN","SAMICTT9",165,0)
 ;
"RTN","SAMICTT9",166,0)
 n zr
"RTN","SAMICTT9",167,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT9",168,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT9",169,0)
 ;
"RTN","SAMICTT9",170,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT9",171,0)
 ;
"RTN","SAMICTT9",172,0)
 ;
"RTN","SAMICTT9",173,0)
 ;
"RTN","SAMICTT9",174,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT9",175,0)
 ;
"RTN","SAMICTT9",176,0)
 ;@called-by
"RTN","SAMICTT9",177,0)
 ; IMPRSN
"RTN","SAMICTT9",178,0)
 ;@calls none
"RTN","SAMICTT9",179,0)
 ;@input
"RTN","SAMICTT9",180,0)
 ; var
"RTN","SAMICTT9",181,0)
 ; vals & dict are passed by name
"RTN","SAMICTT9",182,0)
 ; valdx is used for nodules ala cect2co with nodule # included
"RTN","SAMICTT9",183,0)
 ;@output = dictionary value for var
"RTN","SAMICTT9",184,0)
 ;
"RTN","SAMICTT9",185,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT9",186,0)
 n zr,zv,zdx
"RTN","SAMICTT9",187,0)
 s zdx=$g(valdx)
"RTN","SAMICTT9",188,0)
 i zdx="" s zdx=var
"RTN","SAMICTT9",189,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT9",190,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT9",191,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT9",192,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT9",193,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT9",194,0)
 ;
"RTN","SAMICTT9",195,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT9",196,0)
 ;
"RTN","SAMICTT9",197,0)
 ;
"RTN","SAMICTT9",198,0)
 ;
"RTN","SAMICTT9",199,0)
EOR ; end of routine SAMICTT9
"RTN","SAMICTTA")
0^7^B34902655
"RTN","SAMICTTA",1,0)
SAMICTTA ;ven/gpl - ctreport text recommendations ;2021-03-22T15:51Z
"RTN","SAMICTTA",2,0)
 ;;18.0;SAMI;**4,10**;2020-01;Build 3
"RTN","SAMICTTA",3,0)
 ;;1.18.0.10-i10
"RTN","SAMICTTA",4,0)
 ;
"RTN","SAMICTTA",5,0)
 ; SAMICTTA creates the Recommendations section of the ELCAP CT Report
"RTN","SAMICTTA",6,0)
 ; in text format.
"RTN","SAMICTTA",7,0)
 ;
"RTN","SAMICTTA",8,0)
 quit  ; no entry from top
"RTN","SAMICTTA",9,0)
 ;
"RTN","SAMICTTA",10,0)
 ;
"RTN","SAMICTTA",11,0)
 ;
"RTN","SAMICTTA",12,0)
 ;@section 0 primary development
"RTN","SAMICTTA",13,0)
 ;
"RTN","SAMICTTA",14,0)
 ;
"RTN","SAMICTTA",15,0)
 ;
"RTN","SAMICTTA",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICTTA",17,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTTA",18,0)
 ;@contents
"RTN","SAMICTTA",19,0)
 ; RCMND: recommendations section of ctreport in text format
"RTN","SAMICTTA",20,0)
 ; OUT: output a line of ct report
"RTN","SAMICTTA",21,0)
 ; HOUT: output a ct report header line
"RTN","SAMICTTA",22,0)
 ; $$XVAL = patient value for var
"RTN","SAMICTTA",23,0)
 ; $$XSUB = dictionary value defined by var
"RTN","SAMICTTA",24,0)
 ;
"RTN","SAMICTTA",25,0)
 ;
"RTN","SAMICTTA",26,0)
 ;
"RTN","SAMICTTA",27,0)
 ;@section 1 RCMND & related subroutines
"RTN","SAMICTTA",28,0)
 ;
"RTN","SAMICTTA",29,0)
 ;
"RTN","SAMICTTA",30,0)
 ;
"RTN","SAMICTTA",31,0)
RCMND(rtn,vals,dict) ; recommendations section of ctreport text format
"RTN","SAMICTTA",32,0)
 ;
"RTN","SAMICTTA",33,0)
 ; repgen14
"RTN","SAMICTTA",34,0)
 ;
"RTN","SAMICTTA",35,0)
 ;@called-by
"RTN","SAMICTTA",36,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTTA",37,0)
 ;@calls
"RTN","SAMICTTA",38,0)
 ; $$XVAL
"RTN","SAMICTTA",39,0)
 ; OUT
"RTN","SAMICTTA",40,0)
 ; $$XSUB
"RTN","SAMICTTA",41,0)
 ;@input
"RTN","SAMICTTA",42,0)
 ; rtn
"RTN","SAMICTTA",43,0)
 ; vals
"RTN","SAMICTTA",44,0)
 ; dict
"RTN","SAMICTTA",45,0)
 ;@output: create impressions section of ct report in text format
"RTN","SAMICTTA",46,0)
 ;
"RTN","SAMICTTA",47,0)
 ;# Recommendation
"RTN","SAMICTTA",48,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",49,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTTA",50,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",51,0)
 ;d OUT("<!-- Recommendation -->")
"RTN","SAMICTTA",52,0)
 ;
"RTN","SAMICTTA",53,0)
 i $$XVAL("cefu",vals)'="nf" d  ; 2445-2450 gpl1
"RTN","SAMICTTA",54,0)
 . ;d OUT("<TR><TD><FONT SIZE=""+2""><B>")
"RTN","SAMICTTA",55,0)
 . ;d OUT("<FONT SIZE=""+2""><B>")
"RTN","SAMICTTA",56,0)
 . d OUT("")
"RTN","SAMICTTA",57,0)
 . d OUT("Recommendations:")
"RTN","SAMICTTA",58,0)
 . d OUT("")
"RTN","SAMICTTA",59,0)
 . ;d OUT("</B></FONT>")
"RTN","SAMICTTA",60,0)
 . ;d OUT("</TD></TR><TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",61,0)
 ;
"RTN","SAMICTTA",62,0)
 n fuw
"RTN","SAMICTTA",63,0)
 s fuw=$$XSUB("cefuw",vals,dict)
"RTN","SAMICTTA",64,0)
 ;d OUT("fuw= "_fuw)
"RTN","SAMICTTA",65,0)
 ;d OUT("vals= "_vals)
"RTN","SAMICTTA",66,0)
 ;d OUT(" dict= "_dict)
"RTN","SAMICTTA",67,0)
 ;d OUT($o(@vals@("cefuw","")))
"RTN","SAMICTTA",68,0)
 ;zwr @vals@(*)
"RTN","SAMICTTA",69,0)
 ;zwr @dict@(*)
"RTN","SAMICTTA",70,0)
 ;i fuw="" d  ;
"RTN","SAMICTTA",71,0)
 ;. d OUT(para_"<B>"_$$XSUB("cefu",vals,dict)_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",72,0)
 ;e  d  ;
"RTN","SAMICTTA",73,0)
 ;. d OUT(para_"<B>"_$$XSUB("cefu",vals,dict)_" "_fuw_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",74,0)
 i fuw="" d  ;
"RTN","SAMICTTA",75,0)
 . ;d OUT(para_"<B>A followup CT scan is recommended on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",76,0)
 . d OUT("A followup CT scan is recommended on "_$$XVAL("cefud",vals)_". ") d OUT("")
"RTN","SAMICTTA",77,0)
 e  d  ;
"RTN","SAMICTTA",78,0)
 . ;d OUT(para_"<B>A followup CT scan is recommended "_fuw_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",79,0)
 . d OUT("A followup CT scan is recommended "_fuw_" on "_$$XVAL("cefud",vals)_". ") d OUT("")
"RTN","SAMICTTA",80,0)
 ;
"RTN","SAMICTTA",81,0)
 ; #Other followup
"RTN","SAMICTTA",82,0)
 n zfu,ofu,tofu,comma
"RTN","SAMICTTA",83,0)
 s comma=0,tofu=""
"RTN","SAMICTTA",84,0)
 s ofu=""
"RTN","SAMICTTA",85,0)
 f zfu="cefuaf","cefucc","cefupe","cefufn","cefubr","cefupc","cefutb" d  ;
"RTN","SAMICTTA",86,0)
 . i $$XVAL(zfu,vals)="y" s ofu=ofu_zfu
"RTN","SAMICTTA",87,0)
 i $$XVAL("cefuo",vals)'="" s ofu=ofu_"cefuo"
"RTN","SAMICTTA",88,0)
 i ofu'="" d  ;
"RTN","SAMICTTA",89,0)
 . s tofu="Other followup: "
"RTN","SAMICTTA",90,0)
 . i ofu["cefuaf" s tofu=tofu_"Antibiotics" s comma=1
"RTN","SAMICTTA",91,0)
 . i ofu["cefucc" s tofu=tofu_$s(comma:", ",1:"")_"Diagnostic CT" s comma=1
"RTN","SAMICTTA",92,0)
 . i ofu["cefupe" s tofu=tofu_$s(comma:", ",1:"")_"PET" s comma=1
"RTN","SAMICTTA",93,0)
 . i ofu["cefufn" s tofu=tofu_$s(comma:", ",1:"")_"Percutaneous biopsy" s comma=1
"RTN","SAMICTTA",94,0)
 . i ofu["cefubr" s tofu=tofu_$s(comma:", ",1:"")_"Bronchoscopy" s comma=1
"RTN","SAMICTTA",95,0)
 . i ofu["cefupc" s tofu=tofu_$s(comma:", ",1:"")_"Pulmonary consultation" s comma=1
"RTN","SAMICTTA",96,0)
 . i ofu["cefutb" s tofu=tofu_$s(comma:", ",1:"")_"Refer to tumor board" s comma=1
"RTN","SAMICTTA",97,0)
 . i ofu["cefuo" s tofu=tofu_$s(comma:", ",1:"")_$$XVAL("cefuoo",vals) s comma=1
"RTN","SAMICTTA",98,0)
 i ofu'="" d OUT(para_tofu_para) d OUT("")
"RTN","SAMICTTA",99,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",100,0)
 ; # LungRADS
"RTN","SAMICTTA",101,0)
 ;
"RTN","SAMICTTA",102,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTTA",103,0)
 ;n lrstyle
"RTN","SAMICTTA",104,0)
 ;i $$XVAL("celrc",vals)'="" s lrstyle=1 ; dom's style
"RTN","SAMICTTA",105,0)
 ;e  s lrstyle=0 ; artit's style
"RTN","SAMICTTA",106,0)
 ;s lrstyle=0
"RTN","SAMICTTA",107,0)
 ;
"RTN","SAMICTTA",108,0)
 d  ;
"RTN","SAMICTTA",109,0)
 . q  ; LUNGRADS moved to SAMICTR4
"RTN","SAMICTTA",110,0)
 . n lradModifiers
"RTN","SAMICTTA",111,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTTA",112,0)
 . ;
"RTN","SAMICTTA",113,0)
 . i ($$XVAL("celrad",vals)'="-")&($$XVAL("celrad",vals)'="") d  ;
"RTN","SAMICTTA",114,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTTA",115,0)
 . . d OUT(para)
"RTN","SAMICTTA",116,0)
 ;
"RTN","SAMICTTA",117,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",118,0)
 ;
"RTN","SAMICTTA",119,0)
 ;d OUT("<TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",120,0)
 ;
"RTN","SAMICTTA",121,0)
 ;# Check if Study is Completed
"RTN","SAMICTTA",122,0)
 ;# Find Current Study ID
"RTN","SAMICTTA",123,0)
 ;# locate most recent followup
"RTN","SAMICTTA",124,0)
 ;# get status (sies)
"RTN","SAMICTTA",125,0)
 ;# if sc=Study Complete and cefu=rs
"RTN","SAMICTTA",126,0)
 ;
"RTN","SAMICTTA",127,0)
 n patstatus
"RTN","SAMICTTA",128,0)
 s patstatus=$$XVAL("cedos",vals)
"RTN","SAMICTTA",129,0)
 ;i patstatus="sc" d OUT(para_$g(@dict@("study_complete")))
"RTN","SAMICTTA",130,0)
 i patstatus="sc" d OUT($g(@dict@("study_complete"))) d OUT("")
"RTN","SAMICTTA",131,0)
 ;
"RTN","SAMICTTA",132,0)
 ;# Radiologist
"RTN","SAMICTTA",133,0)
 i $$XVAL("cerad",vals)'="" d  ;
"RTN","SAMICTTA",134,0)
 . d OUT("Interpreted by: "_$$XVAL("cerad",vals)) d OUT("")
"RTN","SAMICTTA",135,0)
 ;
"RTN","SAMICTTA",136,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",137,0)
 ; # LungRADS
"RTN","SAMICTTA",138,0)
 ;
"RTN","SAMICTTA",139,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTTA",140,0)
 n lrstyle
"RTN","SAMICTTA",141,0)
 i $$XVAL("celrc",vals)'="" s lrstyle=1 ; dom's style
"RTN","SAMICTTA",142,0)
 e  s lrstyle=0 ; artit's style
"RTN","SAMICTTA",143,0)
 s lrstyle=0
"RTN","SAMICTTA",144,0)
 ;
"RTN","SAMICTTA",145,0)
 d  ;
"RTN","SAMICTTA",146,0)
 . ;q  ; LUNGRADS moved to SAMICTR4
"RTN","SAMICTTA",147,0)
 . n lradModifiers
"RTN","SAMICTTA",148,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTTA",149,0)
 . ;
"RTN","SAMICTTA",150,0)
 . i ($$XVAL("celrad",vals)'="-")&($$XVAL("celrad",vals)'="") d  ;
"RTN","SAMICTTA",151,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTTA",152,0)
 . . d OUT("")
"RTN","SAMICTTA",153,0)
 ;
"RTN","SAMICTTA",154,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",155,0)
 ;
"RTN","SAMICTTA",156,0)
 ;d OUT("<TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",157,0)
 ;
"RTN","SAMICTTA",158,0)
 quit  ; end of RCMND
"RTN","SAMICTTA",159,0)
 ;
"RTN","SAMICTTA",160,0)
 ;
"RTN","SAMICTTA",161,0)
 ;
"RTN","SAMICTTA",162,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTTA",163,0)
 ;
"RTN","SAMICTTA",164,0)
 ;@called-by
"RTN","SAMICTTA",165,0)
 ; RCMND
"RTN","SAMICTTA",166,0)
 ;@calls none
"RTN","SAMICTTA",167,0)
 ;@input
"RTN","SAMICTTA",168,0)
 ; ln = output to add
"RTN","SAMICTTA",169,0)
 ;@output: line added to ct report
"RTN","SAMICTTA",170,0)
 ;
"RTN","SAMICTTA",171,0)
 s cnt=cnt+1
"RTN","SAMICTTA",172,0)
 n lnn
"RTN","SAMICTTA",173,0)
 ;s debug=1
"RTN","SAMICTTA",174,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTTA",175,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTTA",176,0)
 ;
"RTN","SAMICTTA",177,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTTA",178,0)
 . i ln["<T" q  ; no markup
"RTN","SAMICTTA",179,0)
 . i ln["</" q  ; no markup
"RTN","SAMICTTA",180,0)
 . n zs s zs=$STACK
"RTN","SAMICTTA",181,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTTA",182,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTTA",183,0)
 ;
"RTN","SAMICTTA",184,0)
 quit  ; end of OUT
"RTN","SAMICTTA",185,0)
 ;
"RTN","SAMICTTA",186,0)
 ;
"RTN","SAMICTTA",187,0)
 ;
"RTN","SAMICTTA",188,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTTA",189,0)
 ;
"RTN","SAMICTTA",190,0)
 ;@called-by none
"RTN","SAMICTTA",191,0)
 ;@calls
"RTN","SAMICTTA",192,0)
 ; OUT
"RTN","SAMICTTA",193,0)
 ;@input
"RTN","SAMICTTA",194,0)
 ; ln = header output to add
"RTN","SAMICTTA",195,0)
 ;@output: header line added to ct report
"RTN","SAMICTTA",196,0)
 ;
"RTN","SAMICTTA",197,0)
 d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTTA",198,0)
 ;
"RTN","SAMICTTA",199,0)
 quit  ; end of HOUT
"RTN","SAMICTTA",200,0)
 ;
"RTN","SAMICTTA",201,0)
 ;
"RTN","SAMICTTA",202,0)
 ;
"RTN","SAMICTTA",203,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTTA",204,0)
 ;
"RTN","SAMICTTA",205,0)
 ;@called-by
"RTN","SAMICTTA",206,0)
 ; RCMND
"RTN","SAMICTTA",207,0)
 ;@calls none
"RTN","SAMICTTA",208,0)
 ;@input
"RTN","SAMICTTA",209,0)
 ; var
"RTN","SAMICTTA",210,0)
 ; vals is passed by name
"RTN","SAMICTTA",211,0)
 ;@output = patient value for var
"RTN","SAMICTTA",212,0)
 ;
"RTN","SAMICTTA",213,0)
 n zr
"RTN","SAMICTTA",214,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTTA",215,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTTA",216,0)
 ;
"RTN","SAMICTTA",217,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTTA",218,0)
 ;
"RTN","SAMICTTA",219,0)
 ;
"RTN","SAMICTTA",220,0)
 ;
"RTN","SAMICTTA",221,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTTA",222,0)
 ;
"RTN","SAMICTTA",223,0)
 ;@called-by
"RTN","SAMICTTA",224,0)
 ; RCMND
"RTN","SAMICTTA",225,0)
 ;@calls none
"RTN","SAMICTTA",226,0)
 ;@input
"RTN","SAMICTTA",227,0)
 ; var
"RTN","SAMICTTA",228,0)
 ; vals and dict are passed by name
"RTN","SAMICTTA",229,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTTA",230,0)
 ;@output = dictionary value for var
"RTN","SAMICTTA",231,0)
 ;
"RTN","SAMICTTA",232,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTTA",233,0)
 n zr,zv,zdx
"RTN","SAMICTTA",234,0)
 s zdx=$g(valdx)
"RTN","SAMICTTA",235,0)
 i zdx="" s zdx=var
"RTN","SAMICTTA",236,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTTA",237,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTTA",238,0)
 i zv="" s zr="" q zr
"RTN","SAMICTTA",239,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTTA",240,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTTA",241,0)
 ;
"RTN","SAMICTTA",242,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTTA",243,0)
 ;
"RTN","SAMICTTA",244,0)
 ;
"RTN","SAMICTTA",245,0)
 ;
"RTN","SAMICTTA",246,0)
EOR ; end of routine SAMICTTA
"RTN","SAMICTUL")
0^9^B93951
"RTN","SAMICTUL",1,0)
SAMICTUL ;ven/gpl - ctreport log ;2021-03-23T17:10Z
"RTN","SAMICTUL",2,0)
 ;;18.0;SAMI;**10**;2020-01;Build 3
"RTN","SAMICTUL",3,0)
 ;;1.18.0.10-i10
"RTN","SAMICTUL",4,0)
 ;
"RTN","SAMICTUL",5,0)
 ; SAMICTUL contains routine & module info & the primary development
"RTN","SAMICTUL",6,0)
 ; log for VAPALS-ELCAP's CT Report ctreport web service route, which
"RTN","SAMICTUL",7,0)
 ; is implemented by the SAMICTR* (html) and SAMICTT* (text)
"RTN","SAMICTUL",8,0)
 ; routines.
"RTN","SAMICTUL",9,0)
 ; SAMICTUL contains no public interfaces or executable code.
"RTN","SAMICTUL",10,0)
 ;
"RTN","SAMICTUL",11,0)
 quit  ; no entry from top
"RTN","SAMICTUL",12,0)
 ;
"RTN","SAMICTUL",13,0)
 ;
"RTN","SAMICTUL",14,0)
 ;
"RTN","SAMICTUL",15,0)
 ;@section 0 primary development
"RTN","SAMICTUL",16,0)
 ;
"RTN","SAMICTUL",17,0)
 ;
"RTN","SAMICTUL",18,0)
 ;
"RTN","SAMICTUL",19,0)
 ;@routine-credits
"RTN","SAMICTUL",20,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMICTUL",21,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICTUL",22,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMICTUL",23,0)
 ; http://vistaexpertise.net
"RTN","SAMICTUL",24,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMICTUL",25,0)
 ;@license Apache 2.0
"RTN","SAMICTUL",26,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMICTUL",27,0)
 ;
"RTN","SAMICTUL",28,0)
 ;@last-updated 2021-03-23T17:10Z
"RTN","SAMICTUL",29,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMICTUL",30,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMICTUL",31,0)
 ;@version 1.18.0.10-i10
"RTN","SAMICTUL",32,0)
 ;@release-date 2020-01
"RTN","SAMICTUL",33,0)
 ;@patch-list **10**
"RTN","SAMICTUL",34,0)
 ;
"RTN","SAMICTUL",35,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMICTUL",36,0)
 ; toad@vistaexpertise.net
"RTN","SAMICTUL",37,0)
 ;@additional-dev Alexis Carlson (arc)
"RTN","SAMICTUL",38,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMICTUL",39,0)
 ;
"RTN","SAMICTUL",40,0)
 ;@module-credits
"RTN","SAMICTUL",41,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICTUL",42,0)
 ; (VA-PALS)
"RTN","SAMICTUL",43,0)
 ; http://va-pals.org/
"RTN","SAMICTUL",44,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICTUL",45,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICTUL",46,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICTUL",47,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICTUL",48,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMICTUL",49,0)
 ; http://ielcap.com/
"RTN","SAMICTUL",50,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICTUL",51,0)
 ; http://paraxialtech.com/
"RTN","SAMICTUL",52,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICTUL",53,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICTUL",54,0)
 ;
"RTN","SAMICTUL",55,0)
 ;@module-log
"RTN","SAMICTUL",56,0)
 ;
"RTN","SAMICTUL",57,0)
 ; 2020-02-01/03 ven/arc 1.18.0.4-i4 d47135a5,bc32c1cb,5b2e4525,
"RTN","SAMICTUL",58,0)
 ;  7bcd14a2,1c96fe0e,cb0075e8,5e553dd2,9cde6840,dcea0048e,98b7b273,
"RTN","SAMICTUL",59,0)
 ; a4f98f19
"RTN","SAMICTUL",60,0)
 ;  SAMICTT0,1,2,3,4,9,A: routines (starting as copies of SAMICTR*) to
"RTN","SAMICTUL",61,0)
 ; implement ctreport in text format, start convert nodules to text,
"RTN","SAMICTUL",62,0)
 ; add'l lung findings, fix parag spacing, add impressions sect,
"RTN","SAMICTUL",63,0)
 ; recommendations sect, add'l sects on other abnormalities, breast
"RTN","SAMICTUL",64,0)
 ; abnorm sect, other abnorm sect, tweak format, make it more compact.
"RTN","SAMICTUL",65,0)
 ;
"RTN","SAMICTUL",66,0)
 ; 2021-02-18 ven/gpl 1.18.0.10-i10 38fb2d70
"RTN","SAMICTUL",67,0)
 ;  SAMICTT0,1,2,3,4,9,A: ct report - insert space after every period.
"RTN","SAMICTUL",68,0)
 ;
"RTN","SAMICTUL",69,0)
 ; 2021-03-04/16 ven/gpl 1.18.0.10-i10 e09d5f16,3ea26de9,91793ba3
"RTN","SAMICTUL",70,0)
 ;  SAMICTT1,3,4: ct report: fix normal cardiac default output, CAC
"RTN","SAMICTUL",71,0)
 ; logic, other enhancements.
"RTN","SAMICTUL",72,0)
 ;
"RTN","SAMICTUL",73,0)
 ; 2021-03-23 ven/gpl 1.18.0.10-i10 a68f7f31
"RTN","SAMICTUL",74,0)
 ;  SAMICTT3: fix CAC problem.
"RTN","SAMICTUL",75,0)
 ;
"RTN","SAMICTUL",76,0)
 ; 2021-03-21/23 ven/toad 1.18.0.10-i10
"RTN","SAMICTUL",77,0)
 ;  SAMICTUL: create development log routine.
"RTN","SAMICTUL",78,0)
 ;  SAMICTT0,1,2,3,4,9,A: bump date & version, lt refactor.
"RTN","SAMICTUL",79,0)
 ;
"RTN","SAMICTUL",80,0)
 ;
"RTN","SAMICTUL",81,0)
 ;
"RTN","SAMICTUL",82,0)
 ;@contents
"RTN","SAMICTUL",83,0)
 ; SAMICTT0: ctreport text main
"RTN","SAMICTUL",84,0)
 ; SAMICTT1: ctreport text nodules
"RTN","SAMICTUL",85,0)
 ; SAMICTT2: ctreport text other lung
"RTN","SAMICTUL",86,0)
 ; SAMICTT3: ctreport text emphysema
"RTN","SAMICTUL",87,0)
 ; SAMICTT4: ctreport text breast abnorm
"RTN","SAMICTUL",88,0)
 ; SAMICTT9: ctreport text impressions
"RTN","SAMICTUL",89,0)
 ; SAMICTTA: ctreport text recommendations
"RTN","SAMICTUL",90,0)
 ; SAMICTUL: ctreport log
"RTN","SAMICTUL",91,0)
 ;
"RTN","SAMICTUL",92,0)
 ; SAMICTR*: ctreport html format
"RTN","SAMICTUL",93,0)
 ; SAMIUTR*: test the SAMICTR routines
"RTN","SAMICTUL",94,0)
 ;
"RTN","SAMICTUL",95,0)
 ;
"RTN","SAMICTUL",96,0)
 ;
"RTN","SAMICTUL",97,0)
EOR ; end of routine SAMICTUL
"RTN","SAMIFLD")
0^8^B215854610
"RTN","SAMIFLD",1,0)
SAMIFLD ;ven/gpl - elcap: form load & case review ;2021-03-21T23:51Z
"RTN","SAMIFLD",2,0)
 ;;18.0;SAMI;**10**;2020-01;Build 3
"RTN","SAMIFLD",3,0)
 ;;1.18.0.10-i10
"RTN","SAMIFLD",4,0)
 ;
"RTN","SAMIFLD",5,0)
 ; SAMIFLD contains subroutines for processing ELCAP forms, loading
"RTN","SAMIFLD",6,0)
 ; JSON data into the graphstore for each line. Since three of those
"RTN","SAMIFLD",7,0)
 ; subroutines are also code for ppis called by WSCASE^SAMICASE, two
"RTN","SAMIFLD",8,0)
 ; additional subroutines are included that are not part of the LOAD
"RTN","SAMIFLD",9,0)
 ; opus but are called by WSCASE^SAMICASE.
"RTN","SAMIFLD",10,0)
 ; SAMIFLD contains no public entry points (see SAMIFORM).
"RTN","SAMIFLD",11,0)
 ;
"RTN","SAMIFLD",12,0)
 quit  ; no entry from top
"RTN","SAMIFLD",13,0)
 ;
"RTN","SAMIFLD",14,0)
 ;
"RTN","SAMIFLD",15,0)
 ;
"RTN","SAMIFLD",16,0)
 ;@section 0 primary development
"RTN","SAMIFLD",17,0)
 ;
"RTN","SAMIFLD",18,0)
 ;
"RTN","SAMIFLD",19,0)
 ;
"RTN","SAMIFLD",20,0)
 ;@routine-credits
"RTN","SAMIFLD",21,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMIFLD",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIFLD",23,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMIFLD",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIFLD",25,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIFLD",26,0)
 ;@license Apache 2.0
"RTN","SAMIFLD",27,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMIFLD",28,0)
 ;
"RTN","SAMIFLD",29,0)
 ;@last-updated 2021-03-21T23:51Z
"RTN","SAMIFLD",30,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIFLD",31,0)
 ;@module Screening Applications Management - VAPALS-ELCAP (SAMI)
"RTN","SAMIFLD",32,0)
 ;@version 1.18.0.10-i10
"RTN","SAMIFLD",33,0)
 ;@release-date 2020-01
"RTN","SAMIFLD",34,0)
 ;@patch-list **10**
"RTN","SAMIFLD",35,0)
 ;@build 11
"RTN","SAMIFLD",36,0)
 ;
"RTN","SAMIFLD",37,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMIFLD",38,0)
 ; toad@vistaexpertise.net
"RTN","SAMIFLD",39,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMIFLD",40,0)
 ; lgc@vistaexpertise.net
"RTN","SAMIFLD",41,0)
 ;@additional-dev Alexis Carlson (arc)
"RTN","SAMIFLD",42,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMIFLD",43,0)
 ;@additional-dev Domenic DiNatale (dom)
"RTN","SAMIFLD",44,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMIFLD",45,0)
 ;
"RTN","SAMIFLD",46,0)
 ;@module-credits [see SAMIFUL]
"RTN","SAMIFLD",47,0)
 ;
"RTN","SAMIFLD",48,0)
 ;@contents
"RTN","SAMIFLD",49,0)
 ; LOAD: code for ppi LOAD^SAMIFORM
"RTN","SAMIFLD",50,0)
 ;  process html line, e.g., load json data into graph
"RTN","SAMIFLD",51,0)
 ;
"RTN","SAMIFLD",52,0)
 ; $$xpand = expand # to 8 digits
"RTN","SAMIFLD",53,0)
 ; $$GETHDR-AGE = header string for patient sid
"RTN","SAMIFLD",54,0)
 ;
"RTN","SAMIFLD",55,0)
 ; GETLAST5 = code for ppi $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",56,0)
 ;  last5 for patient sid
"RTN","SAMIFLD",57,0)
 ; FIXSRC: code for ppi FIXSRC^SAMIFORM
"RTN","SAMIFLD",58,0)
 ;  fix html src lines to use resources in see/
"RTN","SAMIFLD",59,0)
 ; FIXHREF: code for ppi FIXHREF^SAMIFORM
"RTN","SAMIFLD",60,0)
 ;  fix html href lines to use resources in see/
"RTN","SAMIFLD",61,0)
 ;
"RTN","SAMIFLD",62,0)
 ; GETNAME = code for ppi $$GETNAME^SAMIFORM
"RTN","SAMIFLD",63,0)
 ;  name for patient sid
"RTN","SAMIFLD",64,0)
 ; GETSSN = code for ppi $$GETSSN^SAMIFORM
"RTN","SAMIFLD",65,0)
 ;  ssn for patient sid
"RTN","SAMIFLD",66,0)
 ; GETPRFX = code for ppi $$GETPRFX^SAMIFORM [deprecated]
"RTN","SAMIFLD",67,0)
 ;  retrieve study id prefix from parameter file
"RTN","SAMIFLD",68,0)
 ;
"RTN","SAMIFLD",69,0)
 ;
"RTN","SAMIFLD",70,0)
 ;
"RTN","SAMIFLD",71,0)
 ;@section 1 code for ppi LOAD^SAMIFRM
"RTN","SAMIFLD",72,0)
 ;
"RTN","SAMIFLD",73,0)
 ;
"RTN","SAMIFLD",74,0)
 ;
"RTN","SAMIFLD",75,0)
 ;@ppi-code LOAD^SAMIFORM
"RTN","SAMIFLD",76,0)
LOAD ; process html line, e.g., load json data into graph
"RTN","SAMIFLD",77,0)
 ;
"RTN","SAMIFLD",78,0)
 ;@signature
"RTN","SAMIFLD",79,0)
 ; do LOAD^SAMIFORM(.SAMILINE,form,sid,.SAMIFILTER,.SAMILNUM,.SAMIHTML,.SAMIVALS)
"RTN","SAMIFLD",80,0)
 ;@branches-from
"RTN","SAMIFLD",81,0)
 ; LOAD^SAMIFORM
"RTN","SAMIFLD",82,0)
 ;@ppi-called-by
"RTN","SAMIFLD",83,0)
 ; wsGetForm^%wf
"RTN","SAMIFLD",84,0)
 ; WSNOTE^SAMINOTI
"RTN","SAMIFLD",85,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIFLD",86,0)
 ;@called-by: none
"RTN","SAMIFLD",87,0)
 ;@calls
"RTN","SAMIFLD",88,0)
 ; $$GETHDR
"RTN","SAMIFLD",89,0)
 ; $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",90,0)
 ; findReplace^%ts
"RTN","SAMIFLD",91,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",92,0)
 ; $$xpand
"RTN","SAMIFLD",93,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIFLD",94,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIFLD",95,0)
 ;@thruput
"RTN","SAMIFLD",96,0)
 ;.SAMILINE = line of html
"RTN","SAMIFLD",97,0)
 ; SAMILINE("low") = lowercase line for easier checks
"RTN","SAMIFLD",98,0)
 ;.SAMIFILTER = work-parameters array
"RTN","SAMIFLD",99,0)
 ; SAMIFILTER("debug") = 1 to debug some fields, 2 to debug more fields
"RTN","SAMIFLD",100,0)
 ; SAMIFILTER("errormessagestyle") = 2 (default) = use current error msg style
"RTN","SAMIFLD",101,0)
 ; SAMIFILTER("form") = form id (e.g., "vapals:sbform")
"RTN","SAMIFLD",102,0)
 ; SAMIFILTER("key") = graph key for saved form (e.g., "ceform-2019-07-01")
"RTN","SAMIFLD",103,0)
 ; SAMIFILTER("studyid") = patient study id (e.g., "XXX00045")
"RTN","SAMIFLD",104,0)
 ; SAMIFILTER("fvalue") = deprecated
"RTN","SAMIFLD",105,0)
 ;.SAMILNUM = html line #, in case need to reset cursor to skip lines
"RTN","SAMIFLD",106,0)
 ;.SAMIHTML = complete html form, in case other lines need changing
"RTN","SAMIFLD",107,0)
 ;@input
"RTN","SAMIFLD",108,0)
 ; form = form id
"RTN","SAMIFLD",109,0)
 ; sid = patient study id
"RTN","SAMIFLD",110,0)
 ;.SAMIVALS = field values
"RTN","SAMIFLD",111,0)
 ; SAMIVALS("saminame")
"RTN","SAMIFLD",112,0)
 ; SAMIVALS("samistatus")
"RTN","SAMIFLD",113,0)
 ; SAMIVALS("samifirsttime")
"RTN","SAMIFLD",114,0)
 ;@tests
"RTN","SAMIFLD",115,0)
 ; UTSSUB2^SAMIUTF2: used for Dom's new style forms
"RTN","SAMIFLD",116,0)
 ;
"RTN","SAMIFLD",117,0)
 ; This line processor/data loader can modify any line in the html as needed.
"RTN","SAMIFLD",118,0)
 ;
"RTN","SAMIFLD",119,0)
 new touched set touched=0
"RTN","SAMIFLD",120,0)
 ;
"RTN","SAMIFLD",121,0)
 set SAMILINE=SAMILINE_$char(13,10) ; insert CRLF at end of every line
"RTN","SAMIFLD",122,0)
 ; for readability in browser
"RTN","SAMIFLD",123,0)
 ;
"RTN","SAMIFLD",124,0)
 new pssn set pssn=$$GETHDR(sid)
"RTN","SAMIFLD",125,0)
 i pssn=""  d  ; for participants without a sid - ie not registered
"RTN","SAMIFLD",126,0)
 . n dfn,lien
"RTN","SAMIFLD",127,0)
 . s dfn=$g(SAMIFILTER("dfn")) ; if no sid, maybe a dfn
"RTN","SAMIFLD",128,0)
 . q:dfn=""
"RTN","SAMIFLD",129,0)
 . n lroot s lroot=$$setroot^%wd("patient-lookup") ; 
"RTN","SAMIFLD",130,0)
 . s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIFLD",131,0)
 . q:lien=""
"RTN","SAMIFLD",132,0)
 . n ssn s ssn=$g(@lroot@(lien,"ssn"))
"RTN","SAMIFLD",133,0)
 . q:ssn=""
"RTN","SAMIFLD",134,0)
 . s pssn=$e(ssn,1,3)_"-"_$e(ssn,4,5)_"-"_$e(ssn,6,9)
"RTN","SAMIFLD",135,0)
 new last5 set last5=$$GETLAST5^SAMIFORM(sid)
"RTN","SAMIFLD",136,0)
 new useid set useid=pssn
"RTN","SAMIFLD",137,0)
 if useid="" set useid=last5
"RTN","SAMIFLD",138,0)
 ;
"RTN","SAMIFLD",139,0)
 if SAMILINE["@@FORMKEY@@" do  ; insert form id (graph key for new forms)
"RTN","SAMIFLD",140,0)
 . do findReplace^%ts(.SAMILINE,"@@FORMKEY@@",form) ; key -> form, test me
"RTN","SAMIFLD",141,0)
 . quit
"RTN","SAMIFLD",142,0)
 ;
"RTN","SAMIFLD",143,0)
 if SAMILINE["@@SID@@" do  ; insert patient study id
"RTN","SAMIFLD",144,0)
 . do findReplace^%ts(.SAMILINE,"@@SID@@",sid)
"RTN","SAMIFLD",145,0)
 . quit
"RTN","SAMIFLD",146,0)
 ;
"RTN","SAMIFLD",147,0)
 if SAMILINE["@@SITE@@" do  ; insert site id
"RTN","SAMIFLD",148,0)
 . n siteid s siteid=$g(SAMIVALS("siteid"))
"RTN","SAMIFLD",149,0)
 . i siteid="" s siteid=$g(SAMIFILTER("siteid"))
"RTN","SAMIFLD",150,0)
 . q:siteid=""
"RTN","SAMIFLD",151,0)
 . do findReplace^%ts(.SAMILINE,"@@SITE@@",siteid)
"RTN","SAMIFLD",152,0)
 . quit
"RTN","SAMIFLD",153,0)
 ;
"RTN","SAMIFLD",154,0)
 if SAMILINE["@@SITETITLE@@" do  ; insert site title
"RTN","SAMIFLD",155,0)
 . n sitetit s sitetit=$g(SAMIVALS("sitetitle"))
"RTN","SAMIFLD",156,0)
 . i sitetit="" s sitetit=$g(SAMIFILTER("sitetitle"))
"RTN","SAMIFLD",157,0)
 . q:sitetit=""
"RTN","SAMIFLD",158,0)
 . do findReplace^%ts(.SAMILINE,"@@SITETITLE@@",sitetit)
"RTN","SAMIFLD",159,0)
 . quit
"RTN","SAMIFLD",160,0)
 ;
"RTN","SAMIFLD",161,0)
 if SAMILINE["@@MANUALREGISTRATION@@" do  ; turn off manual registration
"RTN","SAMIFLD",162,0)
 . n setman,setparm
"RTN","SAMIFLD",163,0)
 . s setman="true"
"RTN","SAMIFLD",164,0)
 . s setparm=$$GET^XPAR("SYS","SAMI ALLOW MANUAL ENTRY",,"Q")
"RTN","SAMIFLD",165,0)
 . i setparm=0 s setman="false"
"RTN","SAMIFLD",166,0)
 . do findReplace^%ts(.SAMILINE,"@@MANUALREGISTRATION@@",setman)
"RTN","SAMIFLD",167,0)
 ; 
"RTN","SAMIFLD",168,0)
 if SAMILINE["@@DFN@@" do  ; insert patient study id
"RTN","SAMIFLD",169,0)
 . n dfn s dfn=$g(SAMIVALS("dfn"))
"RTN","SAMIFLD",170,0)
 . q:dfn=""
"RTN","SAMIFLD",171,0)
 . do findReplace^%ts(.SAMILINE,"@@DFN@@",dfn)
"RTN","SAMIFLD",172,0)
 . quit
"RTN","SAMIFLD",173,0)
 ;
"RTN","SAMIFLD",174,0)
 if SAMILINE["src=" do  ; repoint src directory references
"RTN","SAMIFLD",175,0)
 . do FIXSRC^SAMIFORM(.SAMILINE) ; insert see/ processor on src= references
"RTN","SAMIFLD",176,0)
 . quit
"RTN","SAMIFLD",177,0)
 ;
"RTN","SAMIFLD",178,0)
 if SAMILINE["href=" if 'touched do  ; repoint href directory references
"RTN","SAMIFLD",179,0)
 . do FIXHREF^SAMIFORM(.SAMILINE) ; insert see/ processor on href= references
"RTN","SAMIFLD",180,0)
 . quit
"RTN","SAMIFLD",181,0)
 ;
"RTN","SAMIFLD",182,0)
 if SAMILINE["Sample, Sammy G" do  ; insert actual patient name
"RTN","SAMIFLD",183,0)
 . ;do findReplace^%ts(.SAMILINE,"Sample, Sammy G",$get(SAMIVALS("saminame")))
"RTN","SAMIFLD",184,0)
 . do findReplace^%ts(.SAMILINE,"Sample, Sammy G",$$GETNAME^SAMIFORM(sid))
"RTN","SAMIFLD",185,0)
 . quit
"RTN","SAMIFLD",186,0)
 ;
"RTN","SAMIFLD",187,0)
 if SAMILINE["ST0001" do  ; insert patient ssn or last 5
"RTN","SAMIFLD",188,0)
 . do findReplace^%ts(.SAMILINE,"ST0001",useid)
"RTN","SAMIFLD",189,0)
 . quit
"RTN","SAMIFLD",190,0)
 ;
"RTN","SAMIFLD",191,0)
 if SAMILINE["1234567890" do  ; cut patient id placeholder
"RTN","SAMIFLD",192,0)
 . do findReplace^%ts(.SAMILINE,"1234567890","")
"RTN","SAMIFLD",193,0)
 . quit
"RTN","SAMIFLD",194,0)
 ;
"RTN","SAMIFLD",195,0)
 if SAMILINE["XX0002" do  ; insert patient study id
"RTN","SAMIFLD",196,0)
 . if SAMILINE["XXX" quit  ;
"RTN","SAMIFLD",197,0)
 . do findReplace^%ts(.SAMILINE,"XX0002",sid)
"RTN","SAMIFLD",198,0)
 . quit
"RTN","SAMIFLD",199,0)
 ;
"RTN","SAMIFLD",200,0)
 if SAMILINE["VEP0001" do  ; insert patient study id
"RTN","SAMIFLD",201,0)
 . do findReplaceAll^%ts(.SAMILINE,"VEP0001",sid)
"RTN","SAMIFLD",202,0)
 . quit
"RTN","SAMIFLD",203,0)
 ;
"RTN","SAMIFLD",204,0)
 if SAMILINE["@@FROZEN@@" do  ; insert whether form is frozen
"RTN","SAMIFLD",205,0)
 . if $get(SAMIVALS("samistatus"))="complete" do  ;
"RTN","SAMIFLD",206,0)
 . . do findReplace^%ts(.SAMILINE,"@@FROZEN@@","true")
"RTN","SAMIFLD",207,0)
 . . quit
"RTN","SAMIFLD",208,0)
 . else  do  ;
"RTN","SAMIFLD",209,0)
 . . do findReplace^%ts(.SAMILINE,"@@FROZEN@@","false")
"RTN","SAMIFLD",210,0)
 . . quit
"RTN","SAMIFLD",211,0)
 . quit
"RTN","SAMIFLD",212,0)
 ;
"RTN","SAMIFLD",213,0)
 if SAMILINE["@@NEWFORM@@" do  ; insert whether first edit of form
"RTN","SAMIFLD",214,0)
 . if $get(SAMIVALS("samifirsttime"))="true" do  ;
"RTN","SAMIFLD",215,0)
 . . do findReplace^%ts(.SAMILINE,"@@NEWFORM@@","true")
"RTN","SAMIFLD",216,0)
 . . quit
"RTN","SAMIFLD",217,0)
 . else  do  ;
"RTN","SAMIFLD",218,0)
 . . do findReplace^%ts(.SAMILINE,"@@NEWFORM@@","false")
"RTN","SAMIFLD",219,0)
 . . quit
"RTN","SAMIFLD",220,0)
 . quit
"RTN","SAMIFLD",221,0)
 ;
"RTN","SAMIFLD",222,0)
 if SAMILINE["@@CHART_ELIGIBILITY_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",223,0)
 . n zexist
"RTN","SAMIFLD",224,0)
 . s zexist=$$EXISTCE^SAMINOT1(sid,form)
"RTN","SAMIFLD",225,0)
 . do findReplace^%ts(.SAMILINE,"@@CHART_ELIGIBILITY_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",226,0)
 ;
"RTN","SAMIFLD",227,0)
 if SAMILINE["@@PRE_ENROLLMENT_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",228,0)
 . n zexist
"RTN","SAMIFLD",229,0)
 . s zexist=$$EXISTPRE^SAMINOT1(sid,form)
"RTN","SAMIFLD",230,0)
 . do findReplace^%ts(.SAMILINE,"@@PRE_ENROLLMENT_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",231,0)
 ;
"RTN","SAMIFLD",232,0)
 if SAMILINE["@@INTAKE_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",233,0)
 . n zexist
"RTN","SAMIFLD",234,0)
 . s zexist=$$EXISTINT^SAMINOT1(sid,form)
"RTN","SAMIFLD",235,0)
 . do findReplace^%ts(.SAMILINE,"@@INTAKE_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",236,0)
 ;
"RTN","SAMIFLD",237,0)
 if SAMILINE["changelog" d  ;
"RTN","SAMIFLD",238,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",239,0)
 . new clog set clog=$na(@root@("graph",sid,form,"changelog"))
"RTN","SAMIFLD",240,0)
 . if '$d(@clog) q  ;
"RTN","SAMIFLD",241,0)
 . do findReplace^%ts(.SAMILINE,"</pre>","")
"RTN","SAMIFLD",242,0)
 . new zi set zi=""
"RTN","SAMIFLD",243,0)
 . for  set zi=$order(@clog@(zi)) quit:zi=""  d  ;
"RTN","SAMIFLD",244,0)
 . . new zien set zien=SAMILNUM_"."_$$xpand(zi)
"RTN","SAMIFLD",245,0)
 . . set zhtml(zien)=@clog@(zi)
"RTN","SAMIFLD",246,0)
 . set zhtml(SAMILNUM_"."_$$xpand($order(@clog@(""),-1)+1))="</pre>"
"RTN","SAMIFLD",247,0)
 ;
"RTN","SAMIFLD",248,0)
 if SAMILINE["commlog" d  ;
"RTN","SAMIFLD",249,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",250,0)
 . new clog set clog=$na(@root@("graph",sid,form,"comlog"))
"RTN","SAMIFLD",251,0)
 . if '$d(@clog) q  ;
"RTN","SAMIFLD",252,0)
 . do findReplace^%ts(.SAMILINE,"</pre>","")
"RTN","SAMIFLD",253,0)
 . new zi set zi=""
"RTN","SAMIFLD",254,0)
 . for  set zi=$order(@clog@(zi)) quit:zi=""  d  ;
"RTN","SAMIFLD",255,0)
 . . new zien set zien=SAMILNUM_"."_$$xpand(zi)
"RTN","SAMIFLD",256,0)
 . . set zhtml(zien)=@clog@(zi)
"RTN","SAMIFLD",257,0)
 . set zhtml(SAMILNUM_"."_$$xpand($order(@clog@(""),-1)+1))="</pre>"
"RTN","SAMIFLD",258,0)
 ;
"RTN","SAMIFLD",259,0)
 ;if form["fuform" d  ;
"RTN","SAMIFLD",260,0)
 i SAMILINE["pack-years-history" d  ;
"RTN","SAMIFLD",261,0)
 . d  ;
"RTN","SAMIFLD",262,0)
 . . i SAMILINE'["id" q  ;
"RTN","SAMIFLD",263,0)
 . . n zzi s zzi=SAMILNUM
"RTN","SAMIFLD",264,0)
 . . f  s zzi=$o(SAMIHTML(zzi)) q:zzi>(SAMILNUM+20)  q:SAMIHTML(zzi)["tbody"  d
"RTN","SAMIFLD",265,0)
 . . . s SAMIHTML(zzi)=SAMIHTML(zzi)_$char(13,10)
"RTN","SAMIFLD",266,0)
 . . ;s SAMIHTML(zzi)="<tbody>"_$$SHDET^SAMIUR2(sid)
"RTN","SAMIFLD",267,0)
 . . s SAMILNUM=zzi+1
"RTN","SAMIFLD",268,0)
 . . s SAMILINE=$$SHDET^SAMIUR2(sid,form)_"</tbody>"
"RTN","SAMIFLD",269,0)
 ;
"RTN","SAMIFLD",270,0)
 i SAMILINE["@@ERROR_MESSAGE@@" d  ;
"RTN","SAMIFLD",271,0)
 . n errMsg s errMsg=$get(SAMIVALS("errorMessage"))
"RTN","SAMIFLD",272,0)
 . if errMsg="" q  ; no error message
"RTN","SAMIFLD",273,0)
 . do findReplace^%ts(.SAMILINE,"@@ERROR_MESSAGE@@",errMsg)
"RTN","SAMIFLD",274,0)
 ;
"RTN","SAMIFLD",275,0)
 i SAMILINE["@@ERROR_FIELDS@@" d  ;
"RTN","SAMIFLD",276,0)
 . n errFld s errFld=$get(SAMIVALS("errorField"))
"RTN","SAMIFLD",277,0)
 . if errFld="" q  ; no error field
"RTN","SAMIFLD",278,0)
 . do findReplace^%ts(.SAMILINE,"@@ERROR_FIELDS@@",errFld)
"RTN","SAMIFLD",279,0)
 ;
"RTN","SAMIFLD",280,0)
 i SAMILINE["@@INFO_MESSAGE@@" d  ;
"RTN","SAMIFLD",281,0)
 . n infoMsg s infoMsg=$get(SAMIVALS("infoMessage"))
"RTN","SAMIFLD",282,0)
 . if infoMsg="" q  ; no message
"RTN","SAMIFLD",283,0)
 . do findReplace^%ts(.SAMILINE,"@@INFO_MESSAGE@@",infoMsg)
"RTN","SAMIFLD",284,0)
 ;
"RTN","SAMIFLD",285,0)
 i SAMILINE["@@WARN_MESSAGE@@" d  ;
"RTN","SAMIFLD",286,0)
 . n warnMsg s warnMsg=$get(SAMIVALS("warnMessage"))
"RTN","SAMIFLD",287,0)
 . if warnMsg="" q  ; no message
"RTN","SAMIFLD",288,0)
 . do findReplace^%ts(.SAMILINE,"@@WARN_MESSAGE@@",warnMsg)
"RTN","SAMIFLD",289,0)
 ;
"RTN","SAMIFLD",290,0)
 quit  ; end of ppi LOAD^SAMIFORM
"RTN","SAMIFLD",291,0)
 ;
"RTN","SAMIFLD",292,0)
 ;
"RTN","SAMIFLD",293,0)
 ;
"RTN","SAMIFLD",294,0)
xpand(zi) ; expand # to 8 digits
"RTN","SAMIFLD",295,0)
 ;
"RTN","SAMIFLD",296,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",297,0)
 ;
"RTN","SAMIFLD",298,0)
 ;ven/gpl;private;function;clean;silent;sac;0% tests
"RTN","SAMIFLD",299,0)
 ;@called-by
"RTN","SAMIFLD",300,0)
 ; LOAD
"RTN","SAMIFLD",301,0)
 ;@calls none
"RTN","SAMIFLD",302,0)
 ;@input
"RTN","SAMIFLD",303,0)
 ; zi = # to expand
"RTN","SAMIFLD",304,0)
 ;@output = # expanded to 8 digits by prefixing 0 & appending 1 so 10,
"RTN","SAMIFLD",305,0)
 ; 20, etc. collate properly
"RTN","SAMIFLD",306,0)
 ;
"RTN","SAMIFLD",307,0)
 ;@stanza 2 algorithm
"RTN","SAMIFLD",308,0)
 ;
"RTN","SAMIFLD",309,0)
 new g1 set g1=8-$length(zi)
"RTN","SAMIFLD",310,0)
 new g2 set $piece(g2,"0",g1)=""
"RTN","SAMIFLD",311,0)
 new g3 set g3=g2_zi_"1"
"RTN","SAMIFLD",312,0)
 ;
"RTN","SAMIFLD",313,0)
 ;@stanza 3 termination
"RTN","SAMIFLD",314,0)
 ;
"RTN","SAMIFLD",315,0)
 quit g3 ; end of $$xpand
"RTN","SAMIFLD",316,0)
 ;
"RTN","SAMIFLD",317,0)
 ;
"RTN","SAMIFLD",318,0)
 ;
"RTN","SAMIFLD",319,0)
GETHDR(sid) ; header string for patient sid
"RTN","SAMIFLD",320,0)
 ;
"RTN","SAMIFLD",321,0)
 ;@signature
"RTN","SAMIFLD",322,0)
 ; $$GETHDR^SAMIFORM(sid)
"RTN","SAMIFLD",323,0)
 ;@called-by
"RTN","SAMIFLD",324,0)
 ; LOAD
"RTN","SAMIFLD",325,0)
 ;@calls
"RTN","SAMIFLD",326,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",327,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMIFLD",328,0)
 ; ^%DT
"RTN","SAMIFLD",329,0)
 ; $$NOW^XLFDT
"RTN","SAMIFLD",330,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIFLD",331,0)
 ;@input
"RTN","SAMIFLD",332,0)
 ; sid = patient study id
"RTN","SAMIFLD",333,0)
 ;@output = header string (patient id dob age gender)
"RTN","SAMIFLD",334,0)
 ;@tests
"RTN","SAMIFLD",335,0)
 ; UTGETHDR^SAMIUTF2: header string for patient sid
"RTN","SAMIFLD",336,0)
 ;
"RTN","SAMIFLD",337,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",338,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",339,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",340,0)
 new dfn set dfn=@root@(ien,"dfn")
"RTN","SAMIFLD",341,0)
 quit:ien=""
"RTN","SAMIFLD",342,0)
 ;
"RTN","SAMIFLD",343,0)
 ; do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",344,0)
 if $get(@root@(ien,"ssn"))="" do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",345,0)
 if $get(@root@(ien,"sbdob"))=-1 do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",346,0)
 ;
"RTN","SAMIFLD",347,0)
 if $get(@root@(ien,"ssn"))="" quit "" ; patient info not available
"RTN","SAMIFLD",348,0)
 new pssn set pssn=$get(@root@(ien,"sissn"))
"RTN","SAMIFLD",349,0)
 if pssn["sta" set pssn=""
"RTN","SAMIFLD",350,0)
 if pssn="" do  ;
"RTN","SAMIFLD",351,0)
 . new orgssn
"RTN","SAMIFLD",352,0)
 . set orgssn=$get(@root@(ien,"ssn"))
"RTN","SAMIFLD",353,0)
 . quit:orgssn=""
"RTN","SAMIFLD",354,0)
 . set pssn=$extract(orgssn,1,3)_"-"_$extract(orgssn,4,5)_"-"_$extract(orgssn,6,9)
"RTN","SAMIFLD",355,0)
 . set @root@(ien,"sissn")=pssn
"RTN","SAMIFLD",356,0)
 . quit
"RTN","SAMIFLD",357,0)
 ;
"RTN","SAMIFLD",358,0)
AGE new dob set dob=$get(@root@(ien,"sbdob")) ; dob in VAPALS format
"RTN","SAMIFLD",359,0)
 i dob["-" s dob=$e(dob,6,7)_"/"_$e(dob,9,10)_"/"_$e(dob,1,4)
"RTN","SAMIFLD",360,0)
 i dob'["/" s dob=$e(dob,5,6)_"/"_$e(dob,7,8)_"/"_$e(dob,1,4)
"RTN","SAMIFLD",361,0)
 new X set X=dob
"RTN","SAMIFLD",362,0)
 new Y
"RTN","SAMIFLD",363,0)
 do ^%DT
"RTN","SAMIFLD",364,0)
 ;
"RTN","SAMIFLD",365,0)
 ; change ven/lgc 20190628 - calculate age with MASH 
"RTN","SAMIFLD",366,0)
 ;
"RTN","SAMIFLD",367,0)
 ;new age set age=$piece($$FMDIFF^XLFDT($$NOW^XLFDT,Y)/365,".")
"RTN","SAMIFLD",368,0)
 new age s age=$$age^%th(Y)
"RTN","SAMIFLD",369,0)
 ;
"RTN","SAMIFLD",370,0)
 set @root@(ien,"age")=age
"RTN","SAMIFLD",371,0)
 ;
"RTN","SAMIFLD",372,0)
 new sex set sex=$get(@root@(ien,"sex"))
"RTN","SAMIFLD",373,0)
 ;
"RTN","SAMIFLD",374,0)
 new rtn set rtn=pssn_" DOB: "_dob_" AGE: "_age_" GENDER: "_sex
"RTN","SAMIFLD",375,0)
 ;
"RTN","SAMIFLD",376,0)
 quit rtn ; end of $$GETHDR-AGE
"RTN","SAMIFLD",377,0)
 ;
"RTN","SAMIFLD",378,0)
 ;
"RTN","SAMIFLD",379,0)
 ;
"RTN","SAMIFLD",380,0)
 ;@section 2 code for ppis $$GETLAST5^SAMIFORM,FIXSRC^SAMIFORM,FIXHREF^SAMIFORM
"RTN","SAMIFLD",381,0)
 ;
"RTN","SAMIFLD",382,0)
 ;
"RTN","SAMIFLD",383,0)
 ;
"RTN","SAMIFLD",384,0)
 ;@ppi-code $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",385,0)
GETLAST5 ; last5 for patient sid
"RTN","SAMIFLD",386,0)
 ;
"RTN","SAMIFLD",387,0)
 ;@signature
"RTN","SAMIFLD",388,0)
 ; $$GETHDR^SAMIFORM(sid)
"RTN","SAMIFLD",389,0)
 ;@branches-from
"RTN","SAMIFLD",390,0)
 ; GETLAST5^SAMIFORM
"RTN","SAMIFLD",391,0)
 ;@ppi-called-by
"RTN","SAMIFLD",392,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",393,0)
 ; LOAD
"RTN","SAMIFLD",394,0)
 ;@called-by: none
"RTN","SAMIFLD",395,0)
 ;@calls
"RTN","SAMIFLD",396,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",397,0)
 ;@input
"RTN","SAMIFLD",398,0)
 ; sid = patient study id
"RTN","SAMIFLD",399,0)
 ;@output = patient's BS5 (first initial of last name, last 4 of ssn)
"RTN","SAMIFLD",400,0)
 ;@tests
"RTN","SAMIFLD",401,0)
 ; UTGLST5^SAMIUTF2: last5 for patient sid
"RTN","SAMIFLD",402,0)
 ;
"RTN","SAMIFLD",403,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",404,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",405,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",406,0)
 quit:ien=""
"RTN","SAMIFLD",407,0)
 ;
"RTN","SAMIFLD",408,0)
 quit @root@(ien,"last5") ; end of ppi $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",409,0)
 ;
"RTN","SAMIFLD",410,0)
 ;
"RTN","SAMIFLD",411,0)
 ;
"RTN","SAMIFLD",412,0)
 ;@ppi-code FIXSRC^SAMIFORM
"RTN","SAMIFLD",413,0)
FIXSRC ; fix html src lines to use resources in see/
"RTN","SAMIFLD",414,0)
 ;
"RTN","SAMIFLD",415,0)
 ;@signature
"RTN","SAMIFLD",416,0)
 ; do FIXSRC^SAMIFORM(.SAMILINE)
"RTN","SAMIFLD",417,0)
 ;@branches-from
"RTN","SAMIFLD",418,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIFLD",419,0)
 ;@ppi-called-by
"RTN","SAMIFLD",420,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",421,0)
 ; LOAD
"RTN","SAMIFLD",422,0)
 ;@called-by: none
"RTN","SAMIFLD",423,0)
 ;@calls
"RTN","SAMIFLD",424,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",425,0)
 ;@thruput
"RTN","SAMIFLD",426,0)
 ;.SAMILINE = line of html to change
"RTN","SAMIFLD",427,0)
 ;@tests
"RTN","SAMIFLD",428,0)
 ; UTFSRC^SAMIUTF2: fix html src lines to use resources in see/
"RTN","SAMIFLD",429,0)
 ;
"RTN","SAMIFLD",430,0)
 if SAMILINE["src=" do  ;
"RTN","SAMIFLD",431,0)
 . if SAMILINE["src=""http" quit
"RTN","SAMIFLD",432,0)
 . if SAMILINE["src=""/" do  quit
"RTN","SAMIFLD",433,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=""/","src=""/see/sami/")
"RTN","SAMIFLD",434,0)
 . . quit
"RTN","SAMIFLD",435,0)
 . if SAMILINE["src=""" do  quit
"RTN","SAMIFLD",436,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=""","src=""/see/sami/")
"RTN","SAMIFLD",437,0)
 . . quit
"RTN","SAMIFLD",438,0)
 . if SAMILINE["src=" do
"RTN","SAMIFLD",439,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=","src=/see/sami/")
"RTN","SAMIFLD",440,0)
 . . quit
"RTN","SAMIFLD",441,0)
 . quit
"RTN","SAMIFLD",442,0)
 ;
"RTN","SAMIFLD",443,0)
 quit  ; end of ppi FIXSRC^SAMIFORM
"RTN","SAMIFLD",444,0)
 ;
"RTN","SAMIFLD",445,0)
 ;
"RTN","SAMIFLD",446,0)
 ;
"RTN","SAMIFLD",447,0)
 ;@ppi-code FIXHREF^SAMIFORM
"RTN","SAMIFLD",448,0)
FIXHREF ; fix html href lines to use resources in see/
"RTN","SAMIFLD",449,0)
 ;
"RTN","SAMIFLD",450,0)
 ;@signature
"RTN","SAMIFLD",451,0)
 ; do FIXHREF^SAMIFORM(.SAMILINE)
"RTN","SAMIFLD",452,0)
 ;@branches-from
"RTN","SAMIFLD",453,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIFLD",454,0)
 ;@ppi-called-by
"RTN","SAMIFLD",455,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",456,0)
 ; LOAD
"RTN","SAMIFLD",457,0)
 ;@called-by: none
"RTN","SAMIFLD",458,0)
 ;@calls
"RTN","SAMIFLD",459,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",460,0)
 ;@thruput
"RTN","SAMIFLD",461,0)
 ;.SAMILINE = line of html to change
"RTN","SAMIFLD",462,0)
 ;@tests
"RTN","SAMIFLD",463,0)
 ; UTFHREF^SAMIUTF2: fix html href lines to use resources in see/
"RTN","SAMIFLD",464,0)
 ;
"RTN","SAMIFLD",465,0)
 if SAMILINE["href=" do  ;
"RTN","SAMIFLD",466,0)
 . quit:SAMILINE["href=""#"
"RTN","SAMIFLD",467,0)
 . quit:SAMILINE["href='#"
"RTN","SAMIFLD",468,0)
 . quit:SAMILINE["href=""http"
"RTN","SAMIFLD",469,0)
 . quit:SAMILINE["/vapals"
"RTN","SAMIFLD",470,0)
 . if SAMILINE["href=""/" do  quit
"RTN","SAMIFLD",471,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=""/","href=""/","href=""/see/sami/")
"RTN","SAMIFLD",472,0)
 . . quit
"RTN","SAMIFLD",473,0)
 . if SAMILINE["href=""" do  quit
"RTN","SAMIFLD",474,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=""","href=""/see/sami/")
"RTN","SAMIFLD",475,0)
 . . quit
"RTN","SAMIFLD",476,0)
 . if SAMILINE["href=" do  quit
"RTN","SAMIFLD",477,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=","href=/see/sami/")
"RTN","SAMIFLD",478,0)
 . . quit
"RTN","SAMIFLD",479,0)
 . quit
"RTN","SAMIFLD",480,0)
 ;
"RTN","SAMIFLD",481,0)
 quit  ; end of ppi FIXHREF^SAMIFORM
"RTN","SAMIFLD",482,0)
 ;
"RTN","SAMIFLD",483,0)
 ;
"RTN","SAMIFLD",484,0)
 ;
"RTN","SAMIFLD",485,0)
 ;@section 3 code for ppis $$GETNAME,$$GETSSN,$$GETPRFX^SAMIFORM
"RTN","SAMIFLD",486,0)
 ;
"RTN","SAMIFLD",487,0)
 ;
"RTN","SAMIFLD",488,0)
 ;
"RTN","SAMIFLD",489,0)
 ;@ppi-code $$GETNAME^SAMIFORM
"RTN","SAMIFLD",490,0)
GETNAME ; name for patient sid
"RTN","SAMIFLD",491,0)
 ;
"RTN","SAMIFLD",492,0)
 ;@signature
"RTN","SAMIFLD",493,0)
 ; $$GETNAME^SAMIFORM(sid)
"RTN","SAMIFLD",494,0)
 ;@branches-from
"RTN","SAMIFLD",495,0)
 ; GETNAME^SAMIFORM
"RTN","SAMIFLD",496,0)
 ;@ppi-called-by
"RTN","SAMIFLD",497,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",498,0)
 ;@called-by: none
"RTN","SAMIFLD",499,0)
 ;@calls
"RTN","SAMIFLD",500,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",501,0)
 ;@input
"RTN","SAMIFLD",502,0)
 ; sid = patient study id
"RTN","SAMIFLD",503,0)
 ;@output = patient's name
"RTN","SAMIFLD",504,0)
 ;@tests
"RTN","SAMIFLD",505,0)
 ; UTGTNM^SAMIUTF2: name for patient sid
"RTN","SAMIFLD",506,0)
 ;
"RTN","SAMIFLD",507,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",508,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",509,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",510,0)
 quit:ien=""
"RTN","SAMIFLD",511,0)
 ;
"RTN","SAMIFLD",512,0)
 quit @root@(ien,"saminame") ; end of ppi $$GETNAME^SAMIFORM
"RTN","SAMIFLD",513,0)
 ;
"RTN","SAMIFLD",514,0)
 ;
"RTN","SAMIFLD",515,0)
 ;
"RTN","SAMIFLD",516,0)
 ;@ppi-code $$GETSSN^SAMIFORM
"RTN","SAMIFLD",517,0)
GETSSN ; ssn for patient sid
"RTN","SAMIFLD",518,0)
 ;
"RTN","SAMIFLD",519,0)
 ;@signature
"RTN","SAMIFLD",520,0)
 ; $$GETSSN^SAMIFORM(sid)
"RTN","SAMIFLD",521,0)
 ;@branches-from
"RTN","SAMIFLD",522,0)
 ; GETSSN^SAMIFORM
"RTN","SAMIFLD",523,0)
 ;@ppi-called-by
"RTN","SAMIFLD",524,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",525,0)
 ;@called-by: none
"RTN","SAMIFLD",526,0)
 ;@calls
"RTN","SAMIFLD",527,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",528,0)
 ;@input
"RTN","SAMIFLD",529,0)
 ; sid = patient study id
"RTN","SAMIFLD",530,0)
 ;@output = patient's ssn
"RTN","SAMIFLD",531,0)
 ;@tests
"RTN","SAMIFLD",532,0)
 ; UTGSSN^SAMIUTF2: ssn for patient sid
"RTN","SAMIFLD",533,0)
 ;
"RTN","SAMIFLD",534,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",535,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",536,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",537,0)
 quit:ien=""
"RTN","SAMIFLD",538,0)
 ;
"RTN","SAMIFLD",539,0)
 new pssn set pssn=$get(@root@(ien,"sissn"))
"RTN","SAMIFLD",540,0)
 if pssn["sta" set pssn=""
"RTN","SAMIFLD",541,0)
 if pssn="" do  ;
"RTN","SAMIFLD",542,0)
 . new orgssn set orgssn=$get(@root@(ien,"ssn"))
"RTN","SAMIFLD",543,0)
 . quit:orgssn=""
"RTN","SAMIFLD",544,0)
 . set pssn=$extract(orgssn,1,3)_"-"_$extract(orgssn,4,5)_"-"_$extract(orgssn,6,9)
"RTN","SAMIFLD",545,0)
 . set @root@(ien,"sissn")=pssn
"RTN","SAMIFLD",546,0)
 . quit
"RTN","SAMIFLD",547,0)
 ;
"RTN","SAMIFLD",548,0)
 quit pssn ; end of ppi $$GETSSN^SAMIFORM
"RTN","SAMIFLD",549,0)
 ;
"RTN","SAMIFLD",550,0)
 ;
"RTN","SAMIFLD",551,0)
 ;
"RTN","SAMIFLD",552,0)
 ;@ppi-code $$GETPRFX^SAMIFORM [deprecated]
"RTN","SAMIFLD",553,0)
GETPRFX ; Retrieve study ID prefix from parameter file
"RTN","SAMIFLD",554,0)
 ; This subroutine is deprecated as of the multi-tenancy features.
"RTN","SAMIFLD",555,0)
 ;
"RTN","SAMIFLD",556,0)
 ;@signature
"RTN","SAMIFLD",557,0)
 ; $$GETPRFX^SAMIFORM()
"RTN","SAMIFLD",558,0)
 ;@branches-from
"RTN","SAMIFLD",559,0)
 ; GETPRFX^SAMIFORM
"RTN","SAMIFLD",560,0)
 ;@ppi-called-by
"RTN","SAMIFLD",561,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",562,0)
 ;@calls
"RTN","SAMIFLD",563,0)
 ; $$GET^XPAR
"RTN","SAMIFLD",564,0)
 ;@output = patient's ssn
"RTN","SAMIFLD",565,0)
 ;@tests
"RTN","SAMIFLD",566,0)
 ; None yet
"RTN","SAMIFLD",567,0)
 ;
"RTN","SAMIFLD",568,0)
 new prefix
"RTN","SAMIFLD",569,0)
 ;set prefix=$$GET^XPAR("SYS","SAMI SID PREFIX",,"Q")
"RTN","SAMIFLD",570,0)
 s prefix=$g(ARG("siteid"))
"RTN","SAMIFLD",571,0)
 i prefix="" s prefix=$g(ARG("site"))
"RTN","SAMIFLD",572,0)
 if $get(prefix)="" set prefix="UNK"
"RTN","SAMIFLD",573,0)
 ;
"RTN","SAMIFLD",574,0)
 quit prefix ; end of ppi $$GETPRFX^SAMIFORM
"RTN","SAMIFLD",575,0)
 ;
"RTN","SAMIFLD",576,0)
 ;
"RTN","SAMIFLD",577,0)
 ;
"RTN","SAMIFLD",578,0)
EOR ; end of routine SAMIFLD
"RTN","SAMIFUL")
0^10^B129116
"RTN","SAMIFUL",1,0)
SAMIFUL ;ven/gpl - vapals-elcap: form log ;2021-03-21T23:32Z
"RTN","SAMIFUL",2,0)
 ;;18.0;SAMI;**10**;2020-01;Build 3
"RTN","SAMIFUL",3,0)
 ;;1.18.0.10-i10
"RTN","SAMIFUL",4,0)
 ;
"RTN","SAMIFUL",5,0)
 ; SAMIFUL contains routine & module info & the primary development
"RTN","SAMIFUL",6,0)
 ; log for VAPALS-ELCAP's Form module, SAMIF.
"RTN","SAMIFUL",7,0)
 ; It contains no public interfaces or executable code.
"RTN","SAMIFUL",8,0)
 ;
"RTN","SAMIFUL",9,0)
 quit  ; no entry from top
"RTN","SAMIFUL",10,0)
 ;
"RTN","SAMIFUL",11,0)
 ;
"RTN","SAMIFUL",12,0)
 ;
"RTN","SAMIFUL",13,0)
 ;@section 0 primary development
"RTN","SAMIFUL",14,0)
 ;
"RTN","SAMIFUL",15,0)
 ;
"RTN","SAMIFUL",16,0)
 ;
"RTN","SAMIFUL",17,0)
 ;@routine-credits
"RTN","SAMIFUL",18,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMIFUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIFUL",20,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMIFUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMIFUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIFUL",23,0)
 ;@license Apache 2.0
"RTN","SAMIFUL",24,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMIFUL",25,0)
 ;
"RTN","SAMIFUL",26,0)
 ;@last-updated 2021-03-21T23:32Z
"RTN","SAMIFUL",27,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIFUL",28,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIFUL",29,0)
 ;@version 1.18.0.10-i10
"RTN","SAMIFUL",30,0)
 ;@release-date 2020-01
"RTN","SAMIFUL",31,0)
 ;@patch-list **10**
"RTN","SAMIFUL",32,0)
 ;
"RTN","SAMIFUL",33,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMIFUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMIFUL",35,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMIFUL",36,0)
 ; lgc@vistaexpertise.net
"RTN","SAMIFUL",37,0)
 ;@additional-dev Alexis Carlson (arc)
"RTN","SAMIFUL",38,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMIFUL",39,0)
 ;@additional-dev Domenic DiNatale (dom)
"RTN","SAMIFUL",40,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMIFUL",41,0)
 ;
"RTN","SAMIFUL",42,0)
 ;@module-credits
"RTN","SAMIFUL",43,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIFUL",44,0)
 ; (VA-PALS)
"RTN","SAMIFUL",45,0)
 ; http://va-pals.org/
"RTN","SAMIFUL",46,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIFUL",47,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIFUL",48,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIFUL",49,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIFUL",50,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIFUL",51,0)
 ; http://ielcap.com/
"RTN","SAMIFUL",52,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIFUL",53,0)
 ; http://paraxialtech.com/
"RTN","SAMIFUL",54,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIFUL",55,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIFUL",56,0)
 ;
"RTN","SAMIFUL",57,0)
 ;@module-log
"RTN","SAMIFUL",58,0)
 ; 2017-09-19 ven/gpl 1.18.0-t01 
"RTN","SAMIFUL",59,0)
 ;  SAMIFRM: initialize SAMI FORM file from elcap-patient graphs,
"RTN","SAMIFUL",60,0)
 ; using mash tools & graphs (%yottaq,^%wd).
"RTN","SAMIFUL",61,0)
 ;
"RTN","SAMIFUL",62,0)
 ; 2017-09-18 ven/gpl 1.18.0-t01
"RTN","SAMIFUL",63,0)
 ;  SAMIFRM: update.
"RTN","SAMIFUL",64,0)
 ;
"RTN","SAMIFUL",65,0)
 ; 2017-12-18 ven/gpl 1.18.0-t01
"RTN","SAMIFUL",66,0)
 ;  SAMIFRM: update.
"RTN","SAMIFUL",67,0)
 ;
"RTN","SAMIFUL",68,0)
 ; 2018-01-03 ven/gpl 1.18.0-t01
"RTN","SAMIFUL",69,0)
 ;  SAMIFRM: update.
"RTN","SAMIFUL",70,0)
 ;
"RTN","SAMIFUL",71,0)
 ; 2018-01-14 ven/gpl 1.18.0-t01
"RTN","SAMIFUL",72,0)
 ;  SAMIFRM: update.
"RTN","SAMIFUL",73,0)
 ;
"RTN","SAMIFUL",74,0)
 ; 2018-02-04 ven/gpl 1.18.0-t01
"RTN","SAMIFUL",75,0)
 ;  SAMIFRM: update.
"RTN","SAMIFUL",76,0)
 ;
"RTN","SAMIFUL",77,0)
 ; 2018-02-05/07 ven/toad 1.18.0-t04
"RTN","SAMIFUL",78,0)
 ;  SAMIFRM: update license & attribution & hdr comments, add white
"RTN","SAMIFUL",79,0)
 ; space & do-dot quits, spell out language elements; in SAMISUBS
"RTN","SAMIFUL",80,0)
 ; replaceAll^%wfhform > replaceAll^%wf; $$setroot^%yottaq > 
"RTN","SAMIFUL",81,0)
 ; $$setroot^%wdgraph; getVals^%yottaq > getVals^%wf.
"RTN","SAMIFUL",82,0)
 ;
"RTN","SAMIFUL",83,0)
 ; 2018-02-14 ven/toad 1.18.0-t04
"RTN","SAMIFUL",84,0)
 ;  SAMIFRM: replaceAll^%wf > findReplaceAll^%wf, ln > line, add
"RTN","SAMIFUL",85,0)
 ; @calls & @called-by tags, break up some long lines, scope variables
"RTN","SAMIFUL",86,0)
 ; in $$GETDIR & $$GETFN.
"RTN","SAMIFUL",87,0)
 ;
"RTN","SAMIFUL",88,0)
 ; 2018-03-01 ven/toad 1.18.0-t04
"RTN","SAMIFUL",89,0)
 ;  SAMIFRM: findReplaceAll^%wf > findReplace^%ts.
"RTN","SAMIFUL",90,0)
 ;
"RTN","SAMIFUL",91,0)
 ; 2018-03-07/08 ven/toad 1.18.0-t04
"RTN","SAMIFUL",92,0)
 ;  SAMIFRM: in SAMISUBS $$setroot^%wdgraph > $$setroot^%wf, fix bug
"RTN","SAMIFUL",93,0)
 ; when r/css w/see.
"RTN","SAMIFUL",94,0)
 ;
"RTN","SAMIFUL",95,0)
 ; 2018-03-18 ven/toad 1.18.0-t04
"RTN","SAMIFUL",96,0)
 ;  SAMIFRM2: restore calls to findReplaceAll^%ts.
"RTN","SAMIFUL",97,0)
 ;
"RTN","SAMIFUL",98,0)
 ; 2018-03-21/04-02 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",99,0)
 ;  SAMIFRM2: insert max date, chg case review navigation to post,
"RTN","SAMIFUL",100,0)
 ; date order for CT Eval in case review; support incomplete forms
"RTN","SAMIFUL",101,0)
 ; display & processing; fix to not inject html in javascript for case
"RTN","SAMIFUL",102,0)
 ; review navigation; fix followup submit.
"RTN","SAMIFUL",103,0)
 ;
"RTN","SAMIFUL",104,0)
 ; 2018-04-24 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",105,0)
 ;  SAMIFRM2: add Pet & Biopsy forms.
"RTN","SAMIFUL",106,0)
 ;
"RTN","SAMIFUL",107,0)
 ; 2018-05-18/21 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",108,0)
 ;  SAMIFRM2: convert to new graph, simplify forms processing.
"RTN","SAMIFUL",109,0)
 ;
"RTN","SAMIFUL",110,0)
 ; 2018-05-22 par/dom 1.18.0-t04
"RTN","SAMIFUL",111,0)
 ;  SAMIFRM2: VAP-95 - remove code that replaced hard-coded date
"RTN","SAMIFUL",112,0)
 ; w/"today" from backend, no longer needed.
"RTN","SAMIFUL",113,0)
 ;
"RTN","SAMIFUL",114,0)
 ; 2018-05-24 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",115,0)
 ;  SAMIFRM2: changes for submit processing on forms.
"RTN","SAMIFUL",116,0)
 ;
"RTN","SAMIFUL",117,0)
 ; 2018-05-25 par/dom 1.18.0-t04
"RTN","SAMIFUL",118,0)
 ;  SAMIFRM2: merge pull request 3 fr/OSEHRA/VAP-95-Remove-Today-Text-
"RTN","SAMIFUL",119,0)
 ; Replacement2. VAP-95 remove today text replacement.
"RTN","SAMIFUL",120,0)
 ;
"RTN","SAMIFUL",121,0)
 ; 2018-05-25 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",122,0)
 ;  SAMIFRM2: add STUDYID for txt replace; more changes for STUDYID
"RTN","SAMIFUL",123,0)
 ; substitution.
"RTN","SAMIFUL",124,0)
 ;
"RTN","SAMIFUL",125,0)
 ; 2018-07-11 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",126,0)
 ;  SAMIFRM2: add FROZEN variable based on samistatus=compete.
"RTN","SAMIFUL",127,0)
 ;
"RTN","SAMIFUL",128,0)
 ; 2018-08-19 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",129,0)
 ;  SAMIFRM2: use ssn instead of last5 where available; revise ssn
"RTN","SAMIFUL",130,0)
 ; formatting.
"RTN","SAMIFUL",131,0)
 ;
"RTN","SAMIFUL",132,0)
 ; 2018-09-30 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",133,0)
 ;  SAMIFRM2: header & prefill of intake.
"RTN","SAMIFUL",134,0)
 ;
"RTN","SAMIFUL",135,0)
 ; 2018-10-15 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",136,0)
 ;  SAMIFRM2: initial user reports: enrollment.
"RTN","SAMIFUL",137,0)
 ;
"RTN","SAMIFUL",138,0)
 ; 2018-10-31 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",139,0)
 ;  SAMIFRM2: new input form features, report menu fix.
"RTN","SAMIFUL",140,0)
 ;
"RTN","SAMIFUL",141,0)
 ; 2018-11-13 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",142,0)
 ;  SAMIFRM2: SAMIHOM2 > SAMIHOM3.
"RTN","SAMIFUL",143,0)
 ;
"RTN","SAMIFUL",144,0)
 ; 2018-11-14 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",145,0)
 ;  SAMIFRM2: fix graph store forms.
"RTN","SAMIFUL",146,0)
 ;
"RTN","SAMIFUL",147,0)
 ; 2018-11-29 ven/lgc 1.18.0-t04
"RTN","SAMIFUL",148,0)
 ;  SAMIFRM2: ongoing unit-test work.
"RTN","SAMIFUL",149,0)
 ;
"RTN","SAMIFUL",150,0)
 ; 2018-12-11/12 ven/toad 1.18.0-t04
"RTN","SAMIFUL",151,0)
 ;  SAMIFRM2: update chg log; in SAMISUB2 r/last findReplace^%ts w/a
"RTN","SAMIFUL",152,0)
 ; flag & r/w/findReplaceAll^%ts; passim spell out language elements,
"RTN","SAMIFUL",153,0)
 ; update tags called-by, calls, tests; namespace call-by-ref & call-
"RTN","SAMIFUL",154,0)
 ; by-name actuals.
"RTN","SAMIFUL",155,0)
 ;
"RTN","SAMIFUL",156,0)
 ; 2019-01-02/17 ven/toad 1.18.0-t04
"RTN","SAMIFUL",157,0)
 ;  SAMIFRM2: update chg log; in INIT1FRM id > form; doc signatures,
"RTN","SAMIFUL",158,0)
 ; web services, unit tests, dmis, ppis, input, output, thruput.
"RTN","SAMIFUL",159,0)
 ;  SAMIFUL: create from SAMIFRM2 as primary development log.
"RTN","SAMIFUL",160,0)
 ;  SAMIFLD: create from SAMIFRM2 w/SAMISUB2,GETHDR,GETLAST5,FIXSRC,
"RTN","SAMIFUL",161,0)
 ; FIXHREF,GETNAME,GETSSN; SAMISUB2 > LOAD, reroute calls, namespace
"RTN","SAMIFUL",162,0)
 ; filter > SAMIFILTER, %j > SAMILNUM, zhtml > SAMIHTML, vals >
"RTN","SAMIFUL",163,0)
 ; SAMIVALS (& add to params), key > form; convert to ppi-code (no
"RTN","SAMIFUL",164,0)
 ; params); minor edits.
"RTN","SAMIFUL",165,0)
 ;  SAMIFORM: create from SAMIFRM2 w/all ppi, dmi, & wsi entry points,
"RTN","SAMIFUL",166,0)
 ; no code, goto code in other routines.
"RTN","SAMIFUL",167,0)
 ;  SAMIFWS: create from SAMIFRM2 w/WSSBFORM,WSSIFORM,WSCEFORM;
"RTN","SAMIFUL",168,0)
 ; convert to ppi-code (no params); minor edits.
"RTN","SAMIFUL",169,0)
 ;  SAMIFDM: create from SAMIFRM2, INITFRMS > INIT, INIT1FRM > INIT1,
"RTN","SAMIFUL",170,0)
 ; REGFORMS > REGISTER, LOADDATA > IMPORT,PRSFLNM,GETDIR,GETFN;
"RTN","SAMIFUL",171,0)
 ; convert to ppi-code (no params); annotate & minor edits; move unit-
"RTN","SAMIFUL",172,0)
 ; test switch to cover more code.
"RTN","SAMIFUL",173,0)
 ;  related changes:
"RTN","SAMIFUL",174,0)
 ;  SAMICAS2,SAMICASE,SAMIFLD,SAMINOTI,SAMIUR,SAMIUR1,SAMIUTF,%tsfwr,
"RTN","SAMIFUL",175,0)
 ; %tsfwra,%wfhform: passim SAMIFRM2 > SAMIFORM.
"RTN","SAMIFUL",176,0)
 ;  SAMIUTST: SAMIFRM2 > SAMIFORM, add SAMIFLD,SAMIFDM,SAMIFWS.
"RTN","SAMIFUL",177,0)
 ;
"RTN","SAMIFUL",178,0)
 ; 2019-03-26 ven/lgc 1.18.0-t04
"RTN","SAMIFUL",179,0)
 ;  SAMIFLD: Add changlog code to end of LOAD^SAMIFLD code to account
"RTN","SAMIFUL",180,0)
 ; for new changelog functionality.
"RTN","SAMIFUL",181,0)
 ;
"RTN","SAMIFUL",182,0)
 ; 2019-03-27 ven/lgc 1.18.0-t04
"RTN","SAMIFUL",183,0)
 ;  SAMIFWS: Comment out lines 106, 164, 222 in SAMIFWS;
"RTN","SAMIFUL",184,0)
 ; GETITEMS^SAMICAS2 does not have formal list, may have been part of
"RTN","SAMIFUL",185,0)
 ; temporary debug code.
"RTN","SAMIFUL",186,0)
 ; 106;new items do GETITEMS^SAMICAS2("items",sid)
"RTN","SAMIFUL",187,0)
 ; 164;new items do GETITEMS^SAMICAS2("items",sid)
"RTN","SAMIFUL",188,0)
 ; 222;new items do GETITEMS^SAMICAS2("items",sid)
"RTN","SAMIFUL",189,0)
 ;
"RTN","SAMIFUL",190,0)
 ; 2019-03-28 ven/lgc 1.18.0-t04
"RTN","SAMIFUL",191,0)
 ; SAMIFDM: in IMPORT account for unit test where we do not wish to
"RTN","SAMIFUL",192,0)
 ; prompt user for directory; also modified directory for json files
"RTN","SAMIFUL",193,0)
 ; in repo.
"RTN","SAMIFUL",194,0)
 ;
"RTN","SAMIFUL",195,0)
 ; 2019-03-29 ven/lgc 1.18*0-t04
"RTN","SAMIFUL",196,0)
 ;  SAMIFLD: in LOAD include George's new variables for intake notes.
"RTN","SAMIFUL",197,0)
 ;
"RTN","SAMIFUL",198,0)
 ; 2019-04-16 ven/lgc 1.18.0-t04 e54b76d1
"RTN","SAMIFUL",199,0)
 ;  SAMIFDM,SAMIFLD,SAMIFORM,SAMIFWS: SAMIFRM2 > SAMIFORM.
"RTN","SAMIFUL",200,0)
 ;
"RTN","SAMIFUL",201,0)
 ; 2019-04-16 ven/lgc 1.18.0-t04 e54b76d1
"RTN","SAMIFUL",202,0)
 ;  SAMINOT1: SAMIFRM2 > SAMIFORM.
"RTN","SAMIFUL",203,0)
 ;
"RTN","SAMIFUL",204,0)
 ; 2019-04-18 ven/gpl 1.18.0-t04 2b6f0d63
"RTN","SAMIFUL",205,0)
 ;  SAMIFLD: fix missing patient name.
"RTN","SAMIFUL",206,0)
 ;
"RTN","SAMIFUL",207,0)
 ; 2019-04-22 ven/lgc 1.18.0-t04 e7afbfa1
"RTN","SAMIFUL",208,0)
 ;  SAMIFWS: removal of SAMIFRM2 reference.
"RTN","SAMIFUL",209,0)
 ;
"RTN","SAMIFUL",210,0)
 ; 2019-04-23 ven/lgc 1.18.0-t04 529e8f2f,89bffd3b
"RTN","SAMIFUL",211,0)
 ;  SAMIFDM: comment out zwrite commands.
"RTN","SAMIFUL",212,0)
 ;  SAMIFORM: SAMISUB2 > LOAD.
"RTN","SAMIFUL",213,0)
 ;
"RTN","SAMIFUL",214,0)
 ; 2019-05-08 ven/lgc 1.18.0-t04 33dfa8c2
"RTN","SAMIFUL",215,0)
 ;  SAMIFDM: replace zsystem command with MASH call.
"RTN","SAMIFUL",216,0)
 ;
"RTN","SAMIFUL",217,0)
 ; 2019-06-10/19 ven/arc 1.18.0-t04 5d7a987d,c69b6787
"RTN","SAMIFUL",218,0)
 ;  SAMIFDM: chg explicit paths, unify paths to unit test json data.
"RTN","SAMIFUL",219,0)
 ;
"RTN","SAMIFUL",220,0)
 ; 2019-06-28/07-08 ven/lgc 1.18.0-t04 703c3050
"RTN","SAMIFUL",221,0)
 ;  SAMIFLD: fix patient age calculations, calculate patient age
"RTN","SAMIFUL",222,0)
 ; w/MASH age^%th.
"RTN","SAMIFUL",223,0)
 ;
"RTN","SAMIFUL",224,0)
 ; 2019-08-01 ven/arc 1.18.0-t04 d710f27d
"RTN","SAMIFUL",225,0)
 ;  SAMIFLD,SAMIFORM: pull displayed facility code from vista
"RTN","SAMIFUL",226,0)
 ; parameter.
"RTN","SAMIFUL",227,0)
 ;
"RTN","SAMIFUL",228,0)
 ; 2019-08-03 ven/gpl 1.18.0-t04 bea65f7b,ffc94f65
"RTN","SAMIFUL",229,0)
 ;  SAMIFLD: fix bugs in Have You Ever Smoked processing in changelog
"RTN","SAMIFUL",230,0)
 ; & intake note, fix smoking status on enrollment report, fix change
"RTN","SAMIFUL",231,0)
 ; log display.
"RTN","SAMIFUL",232,0)
 ;
"RTN","SAMIFUL",233,0)
 ; 2019-08-05 ven/gpl 1.18.0-t04 4ee0d3e6
"RTN","SAMIFUL",234,0)
 ;  SAMIFLD: add GETPRFX to avoid colision with VAP-435.
"RTN","SAMIFUL",235,0)
 ;
"RTN","SAMIFUL",236,0)
 ; 2019-08-14 ven/gpl 1.18.0-t04 0aa37766,4e6f4fdf,08d45d99
"RTN","SAMIFUL",237,0)
 ;  SAMIFLD: resolve conflict over semicolon in comment, merge pull
"RTN","SAMIFUL",238,0)
 ; request #70 from OSEHRA/VAP-426-eversmoked, merge with 417.
"RTN","SAMIFUL",239,0)
 ;
"RTN","SAMIFUL",240,0)
 ; 2019-09-26 ven/gpl 1.18.0-t04 92b12324 VAP-420
"RTN","SAMIFUL",241,0)
 ;  SAMIFLD: add smoking history to intake/followup forms (#75).
"RTN","SAMIFUL",242,0)
 ;
"RTN","SAMIFUL",243,0)
 ; 2019-10-22 ven/lgc 1.18.0-t04 613e8ff4
"RTN","SAMIFUL",244,0)
 ;  SAMIFLD: update unit test routines for dfn 1.
"RTN","SAMIFUL",245,0)
 ;
"RTN","SAMIFUL",246,0)
 ; 2019-11-22 par/dom 1.18.0 b2cc389d VAP-458
"RTN","SAMIFUL",247,0)
 ;  SAMIFLD: add new manual registration page.
"RTN","SAMIFUL",248,0)
 ;
"RTN","SAMIFUL",249,0)
 ; 2020-01-21 ven/arc 1.18.0 a4c143be
"RTN","SAMIFUL",250,0)
 ;  SAMIFLD: patient matching additions.
"RTN","SAMIFUL",251,0)
 ;
"RTN","SAMIFUL",252,0)
 ; 2020-04-07/11 ven/gpl 1.18.0.5-i5 36607664,c8f4cf30,2f2c29c1
"RTN","SAMIFUL",253,0)
 ;  SAMIFLD,SAMIFORM,SAMIFWS: multi-tenancy.
"RTN","SAMIFUL",254,0)
 ;
"RTN","SAMIFUL",255,0)
 ; 2021-03-16 ven/gpl 1.18.0.10-i10 002071de
"RTN","SAMIFUL",256,0)
 ;  SAMIFLD: dob age calculation fix from hl7 dob format.
"RTN","SAMIFUL",257,0)
 ;
"RTN","SAMIFUL",258,0)
 ; 2021-03-21 ven/toad 1.18.0.10-i10
"RTN","SAMIFUL",259,0)
 ;  SAMIFLD: bump date & version, lt refactor.
"RTN","SAMIFUL",260,0)
 ;
"RTN","SAMIFUL",261,0)
 ;
"RTN","SAMIFUL",262,0)
 ;
"RTN","SAMIFUL",263,0)
 ;@contents
"RTN","SAMIFUL",264,0)
 ; SAMIFORM: form library
"RTN","SAMIFUL",265,0)
 ; SAMIFDM: form dmi code
"RTN","SAMIFUL",266,0)
 ; SAMIFLD: form load
"RTN","SAMIFUL",267,0)
 ; SAMIFWS: form web-service code
"RTN","SAMIFUL",268,0)
 ; SAMIFUL: form log
"RTN","SAMIFUL",269,0)
 ; SAMIUTF2: form unit tests
"RTN","SAMIFUL",270,0)
 ;
"RTN","SAMIFUL",271,0)
 ;
"RTN","SAMIFUL",272,0)
 ;
"RTN","SAMIFUL",273,0)
EOR ; end of routine SAMIFUL
"RTN","SAMINOT1")
0^11^B436917317
"RTN","SAMINOT1",1,0)
SAMINOT1 ;ven/gpl - text notes ;2021-03-23T18:53Z
"RTN","SAMINOT1",2,0)
 ;;18.0;SAMI;**2,6,8,10**;2020-01;Build 3
"RTN","SAMINOT1",3,0)
 ;;1.18.0.10-i10
"RTN","SAMINOT1",4,0)
 ;
"RTN","SAMINOT1",5,0)
 ; SAMINOT1 contains a web service & associated subroutines to produce
"RTN","SAMINOT1",6,0)
 ; VAPALS-ELCAP text notes.
"RTN","SAMINOT1",7,0)
 ;
"RTN","SAMINOT1",8,0)
 quit  ; no entry from top
"RTN","SAMINOT1",9,0)
 ;
"RTN","SAMINOT1",10,0)
 ;
"RTN","SAMINOT1",11,0)
 ;
"RTN","SAMINOT1",12,0)
 ;@section 0 primary development
"RTN","SAMINOT1",13,0)
 ;
"RTN","SAMINOT1",14,0)
 ;
"RTN","SAMINOT1",15,0)
 ;
"RTN","SAMINOT1",16,0)
 ;@routine-credits
"RTN","SAMINOT1",17,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMINOT1",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMINOT1",19,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMINOT1",20,0)
 ; http://vistaexpertise.net
"RTN","SAMINOT1",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMINOT1",22,0)
 ;@license see routine SAMIUL
"RTN","SAMINOT1",23,0)
 ;
"RTN","SAMINOT1",24,0)
 ;@last-updated 2021-03-23T18:53Z
"RTN","SAMINOT1",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMINOT1",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMINOT1",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMINOT1",28,0)
 ;@version 1.18.0.10-i10
"RTN","SAMINOT1",29,0)
 ;@release-date 2020-01
"RTN","SAMINOT1",30,0)
 ;@patch-list **2,6,8,10**
"RTN","SAMINOT1",31,0)
 ;
"RTN","SAMINOT1",32,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMINOT1",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMINOT1",34,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMINOT1",35,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMINOT1",36,0)
 ;@additional-dev Linda M. R. Yaw (lmry)
"RTN","SAMINOT1",37,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMINOT1",38,0)
 ;@additional-dev Alexis R. Carlson (arc)
"RTN","SAMINOT1",39,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMINOT1",40,0)
 ;@additional-dev Domenic DiNatale (dom)
"RTN","SAMINOT1",41,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMINOT1",42,0)
 ;
"RTN","SAMINOT1",43,0)
 ;@module-credits
"RTN","SAMINOT1",44,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMINOT1",45,0)
 ; (VA-PALS)
"RTN","SAMINOT1",46,0)
 ; http://va-pals.org/
"RTN","SAMINOT1",47,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMINOT1",48,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMINOT1",49,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMINOT1",50,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMINOT1",51,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMINOT1",52,0)
 ; http://ielcap.com/
"RTN","SAMINOT1",53,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMINOT1",54,0)
 ; http://paraxialtech.com/
"RTN","SAMINOT1",55,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMINOT1",56,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMINOT1",57,0)
 ;
"RTN","SAMINOT1",58,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMINOT1",59,0)
 ; see routine SAMINUL
"RTN","SAMINOT1",60,0)
 ;
"RTN","SAMINOT1",61,0)
 ;
"RTN","SAMINOT1",62,0)
 ;
"RTN","SAMINOT1",63,0)
 ;@section 1 wsi WSNOTE^SAMINOT1 & related subroutines
"RTN","SAMINOT1",64,0)
 ;
"RTN","SAMINOT1",65,0)
 ;
"RTN","SAMINOT1",66,0)
 ;
"RTN","SAMINOT1",67,0)
EXISTCE(SID,FORM) ; extrinsic returns "true" or "false"
"RTN","SAMINOT1",68,0)
 ;
"RTN","SAMINOT1",69,0)
 ; if a Chart Eligibility Note exists
"RTN","SAMINOT1",70,0)
 ;
"RTN","SAMINOT1",71,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",72,0)
 n gvals s gvals=$na(@root@("graph",SID,FORM))
"RTN","SAMINOT1",73,0)
 ;i $g(@root@("graph",SID,FORM,"sicechrt"))="y" q "true"
"RTN","SAMINOT1",74,0)
 i $g(@gvals@("chart-eligibility-complete"))="true" q "true"
"RTN","SAMINOT1",75,0)
 ;
"RTN","SAMINOT1",76,0)
 quit "false" ; end of $$EXISTCE
"RTN","SAMINOT1",77,0)
 ;
"RTN","SAMINOT1",78,0)
 ;
"RTN","SAMINOT1",79,0)
 ;
"RTN","SAMINOT1",80,0)
EXISTPRE(SID,FORM) ; extrinsic returns "true" or "false"
"RTN","SAMINOT1",81,0)
 ;
"RTN","SAMINOT1",82,0)
 ; if a Pre-enrollment Note exists
"RTN","SAMINOT1",83,0)
 ;
"RTN","SAMINOT1",84,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",85,0)
 n gvals s gvals=$na(@root@("graph",SID,FORM))
"RTN","SAMINOT1",86,0)
 ;i $g(@root@("graph",SID,FORM,"sipedisc"))="y" q "true"
"RTN","SAMINOT1",87,0)
 ;i $g(@gvals@("pre-note-complete"))="true" i $g(@gvals@("siperslt"))="y" q "true"
"RTN","SAMINOT1",88,0)
 i $g(@gvals@("pre-note-complete"))="true" q "true"
"RTN","SAMINOT1",89,0)
 ;
"RTN","SAMINOT1",90,0)
 quit "false" ; end of $$EXISTPRE
"RTN","SAMINOT1",91,0)
 ;
"RTN","SAMINOT1",92,0)
 ;
"RTN","SAMINOT1",93,0)
 ;
"RTN","SAMINOT1",94,0)
EXISTINT(SID,FORM) ; extrinsic returns "true" or "false"
"RTN","SAMINOT1",95,0)
 ;
"RTN","SAMINOT1",96,0)
 ; if an Intake Note exists
"RTN","SAMINOT1",97,0)
 ;
"RTN","SAMINOT1",98,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",99,0)
 i $g(@root@("graph",SID,FORM,"sistatus"))="y" q "true"
"RTN","SAMINOT1",100,0)
 ;
"RTN","SAMINOT1",101,0)
 quit "false" ; end of $$EXISTINT
"RTN","SAMINOT1",102,0)
 ;
"RTN","SAMINOT1",103,0)
 ;
"RTN","SAMINOT1",104,0)
 ;
"RTN","SAMINOT1",105,0)
WSNOTE(return,filter) ; web service which returns a text note
"RTN","SAMINOT1",106,0)
 ;
"RTN","SAMINOT1",107,0)
 n debug s debug=0
"RTN","SAMINOT1",108,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMINOT1",109,0)
 ;
"RTN","SAMINOT1",110,0)
 k return
"RTN","SAMINOT1",111,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMINOT1",112,0)
 ;
"RTN","SAMINOT1",113,0)
 n si
"RTN","SAMINOT1",114,0)
 s si=$g(filter("studyid"))
"RTN","SAMINOT1",115,0)
 i si="" d  ;
"RTN","SAMINOT1",116,0)
 . s si="XXX00333"
"RTN","SAMINOT1",117,0)
 q:si=""
"RTN","SAMINOT1",118,0)
 ;
"RTN","SAMINOT1",119,0)
 n samikey
"RTN","SAMINOT1",120,0)
 s samikey=$g(filter("form"))
"RTN","SAMINOT1",121,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",122,0)
 i samikey="" d  ;
"RTN","SAMINOT1",123,0)
 . s samikey=$o(@root@("graph",si,"siform"))
"RTN","SAMINOT1",124,0)
 . ;w !,samikey
"RTN","SAMINOT1",125,0)
 . ;b
"RTN","SAMINOT1",126,0)
 ;
"RTN","SAMINOT1",127,0)
 n vals
"RTN","SAMINOT1",128,0)
 m vals=@root@("graph",si,samikey)
"RTN","SAMINOT1",129,0)
 ;
"RTN","SAMINOT1",130,0)
 n note,nien,ntype
"RTN","SAMINOT1",131,0)
 s ntype=""
"RTN","SAMINOT1",132,0)
 s note=""
"RTN","SAMINOT1",133,0)
 s nien=$g(filter("nien"))
"RTN","SAMINOT1",134,0)
 i nien="" d
"RTN","SAMINOT1",135,0)
 . s:$g(vals("samistatus"))="complete" ntype="intake"
"RTN","SAMINOT1",136,0)
 . s:$g(vals("samistatus"))="chart-eligibility" ntype="eligibility"
"RTN","SAMINOT1",137,0)
 . s:$g(vals("samistatus"))="pre-enrollment-discussion" ntype="pre-note"
"RTN","SAMINOT1",138,0)
 . q:ntype=""
"RTN","SAMINOT1",139,0)
 . ;d nien=$$NTTYPE add code to pull the latest note by type
"RTN","SAMINOT1",140,0)
 q:nien=""
"RTN","SAMINOT1",141,0)
 n notebase
"RTN","SAMINOT1",142,0)
 s notebase=$$NTLOCN(si,samikey,nien) ; global location for the note
"RTN","SAMINOT1",143,0)
 s note=$na(@notebase@("text"))
"RTN","SAMINOT1",144,0)
 i '$d(@note) q
"RTN","SAMINOT1",145,0)
 ;
"RTN","SAMINOT1",146,0)
 new temp,tout
"RTN","SAMINOT1",147,0)
 do GETTMPL^SAMICASE("temp","vapals:note")
"RTN","SAMINOT1",148,0)
 quit:'$data(temp)
"RTN","SAMINOT1",149,0)
 ;
"RTN","SAMINOT1",150,0)
 n cnt s cnt=0
"RTN","SAMINOT1",151,0)
 n zi s zi=""
"RTN","SAMINOT1",152,0)
 ;
"RTN","SAMINOT1",153,0)
 f  s zi=$o(temp(zi)) q:zi=""  d  ;
"RTN","SAMINOT1",154,0)
 . ;
"RTN","SAMINOT1",155,0)
 . n line s line=temp(zi)
"RTN","SAMINOT1",156,0)
 . D LOAD^SAMIFORM(.line,samikey,si,.filter,.vals)
"RTN","SAMINOT1",157,0)
 . s temp(zi)=line
"RTN","SAMINOT1",158,0)
 . ;
"RTN","SAMINOT1",159,0)
 . s cnt=cnt+1
"RTN","SAMINOT1",160,0)
 . s tout(cnt)=temp(zi)
"RTN","SAMINOT1",161,0)
 . ;
"RTN","SAMINOT1",162,0)
 . i temp(zi)["report-text" d  ;
"RTN","SAMINOT1",163,0)
 . . i temp(zi)["#" q  ;
"RTN","SAMINOT1",164,0)
 . . n zj s zj=""
"RTN","SAMINOT1",165,0)
 . . f  s zj=$o(@note@(zj)) q:zj=""  d  ;
"RTN","SAMINOT1",166,0)
 . . . s cnt=cnt+1
"RTN","SAMINOT1",167,0)
 . . . ;s tout(cnt)=@note@(zj)_"<br>"
"RTN","SAMINOT1",168,0)
 . . . s tout(cnt)=@note@(zj)_$char(13,10)
"RTN","SAMINOT1",169,0)
 m return=tout
"RTN","SAMINOT1",170,0)
 ;
"RTN","SAMINOT1",171,0)
 quit  ; end of WSNOTE
"RTN","SAMINOT1",172,0)
 ;
"RTN","SAMINOT1",173,0)
 ;
"RTN","SAMINOT1",174,0)
 ;
"RTN","SAMINOT1",175,0)
NOTE(filter) ; extrnisic which creates a note
"RTN","SAMINOT1",176,0)
 ;
"RTN","SAMINOT1",177,0)
 ; returns 1 if successful, 0 if not
"RTN","SAMINOT1",178,0)
 ;
"RTN","SAMINOT1",179,0)
 ; set up patient values
"RTN","SAMINOT1",180,0)
 ;
"RTN","SAMINOT1",181,0)
 n vals
"RTN","SAMINOT1",182,0)
 ;
"RTN","SAMINOT1",183,0)
 n si
"RTN","SAMINOT1",184,0)
 s si=$g(filter("studyid"))
"RTN","SAMINOT1",185,0)
 i si="" d  ;
"RTN","SAMINOT1",186,0)
 . s si="XXX00333"
"RTN","SAMINOT1",187,0)
 q:si=""
"RTN","SAMINOT1",188,0)
 ;
"RTN","SAMINOT1",189,0)
 n samikey
"RTN","SAMINOT1",190,0)
 s samikey=$g(filter("form"))
"RTN","SAMINOT1",191,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",192,0)
 i samikey="" d  ;
"RTN","SAMINOT1",193,0)
 . s samikey=$o(@root@("graph",si,"siform"))
"RTN","SAMINOT1",194,0)
 . ;w !,samikey
"RTN","SAMINOT1",195,0)
 . ;b
"RTN","SAMINOT1",196,0)
 ;
"RTN","SAMINOT1",197,0)
 s vals=$na(@root@("graph",si,samikey))
"RTN","SAMINOT1",198,0)
 ;
"RTN","SAMINOT1",199,0)
 i '$d(@vals) d  q 0 ;
"RTN","SAMINOT1",200,0)
 . ;w !,"error, patient values not found"
"RTN","SAMINOT1",201,0)
 ;zwr @vals@(*)
"RTN","SAMINOT1",202,0)
 ;
"RTN","SAMINOT1",203,0)
 k ^SAMIUL("NOTE")
"RTN","SAMINOT1",204,0)
 m ^SAMIUL("NOTE","vals")=@vals
"RTN","SAMINOT1",205,0)
 m ^SAMIUL("NOTE","filter")=filter
"RTN","SAMINOT1",206,0)
 ;
"RTN","SAMINOT1",207,0)
 n didnote s didnote=0
"RTN","SAMINOT1",208,0)
 ;
"RTN","SAMINOT1",209,0)
 i $g(@vals@("samistatus"))="chart-eligibility" d  ;
"RTN","SAMINOT1",210,0)
 . q:$g(@vals@("chart-eligibility-complete"))="true"
"RTN","SAMINOT1",211,0)
 . d MKEL(si,samikey,vals,.filter) ;
"RTN","SAMINOT1",212,0)
 . s didnote=1
"RTN","SAMINOT1",213,0)
 ;
"RTN","SAMINOT1",214,0)
 i $g(@vals@("samistatus"))="pre-enrollment-discussion" d  ;
"RTN","SAMINOT1",215,0)
 . q:$g(@vals@("pre-note-complete"))="true"
"RTN","SAMINOT1",216,0)
 . d MKPRE(si,samikey,vals,.filter) ;
"RTN","SAMINOT1",217,0)
 . s didnote=1
"RTN","SAMINOT1",218,0)
 ;
"RTN","SAMINOT1",219,0)
 i $g(@vals@("samistatus"))="complete" d  ;
"RTN","SAMINOT1",220,0)
 . q:$$HASINNT(vals)
"RTN","SAMINOT1",221,0)
 . d MKIN(si,samikey,vals,.filter) ;
"RTN","SAMINOT1",222,0)
 . s didnote=1
"RTN","SAMINOT1",223,0)
 ;
"RTN","SAMINOT1",224,0)
 n nien s nien=0
"RTN","SAMINOT1",225,0)
 i didnote=1 s nien=$$NTIEN(si,samikey)
"RTN","SAMINOT1",226,0)
 ;
"RTN","SAMINOT1",227,0)
 quit nien ; end of $$NOTE
"RTN","SAMINOT1",228,0)
 ;
"RTN","SAMINOT1",229,0)
 ;
"RTN","SAMINOT1",230,0)
 ;
"RTN","SAMINOT1",231,0)
HASINNT(vals) ; extrinsic returns 1 if intake note is present
"RTN","SAMINOT1",232,0)
 ;
"RTN","SAMINOT1",233,0)
 ; else returns 0
"RTN","SAMINOT1",234,0)
 ;
"RTN","SAMINOT1",235,0)
 n zzi,zzrtn s (zzi,zzrtn)=0
"RTN","SAMINOT1",236,0)
 q:'$d(@vals)
"RTN","SAMINOT1",237,0)
 f  s zzi=$o(@vals@("notes",zzi)) q:+zzi=0  d  ;
"RTN","SAMINOT1",238,0)
 . i $g(@vals@("notes",zzi,"name"))["Intake" s zzrtn=1
"RTN","SAMINOT1",239,0)
 ;
"RTN","SAMINOT1",240,0)
 quit zzrtn ; end of $$HASINNT
"RTN","SAMINOT1",241,0)
 ;
"RTN","SAMINOT1",242,0)
 ;
"RTN","SAMINOT1",243,0)
 ;
"RTN","SAMINOT1",244,0)
MKEL(sid,form,vals,filter) ;
"RTN","SAMINOT1",245,0)
 ;
"RTN","SAMINOT1",246,0)
 n cnt s cnt=0
"RTN","SAMINOT1",247,0)
 ;n dest s dest=$na(@vals@("eligibility-note"))
"RTN","SAMINOT1",248,0)
 n dest s dest=$$MKNT(vals,"Eligibility Note","eligibility",.filter)
"RTN","SAMINOT1",249,0)
 k @dest
"RTN","SAMINOT1",250,0)
 d OUT("Lung Screening Program Chart Eligibility Note")
"RTN","SAMINOT1",251,0)
 d OUT("")
"RTN","SAMINOT1",252,0)
 d ELNOTE(vals,dest,cnt)
"RTN","SAMINOT1",253,0)
 ;
"RTN","SAMINOT1",254,0)
 quit  ; end of MKEL
"RTN","SAMINOT1",255,0)
 ;
"RTN","SAMINOT1",256,0)
 ;
"RTN","SAMINOT1",257,0)
 ;
"RTN","SAMINOT1",258,0)
MKPRE(sid,form,vals,filter) ;
"RTN","SAMINOT1",259,0)
 ;
"RTN","SAMINOT1",260,0)
 n cnt s cnt=0
"RTN","SAMINOT1",261,0)
 ;n dest s dest=$na(@vals@("pre-note"))
"RTN","SAMINOT1",262,0)
 n dest s dest=$$MKNT(vals,"Pre-enrollment Discussion Note","prenote",.filter)
"RTN","SAMINOT1",263,0)
 k @dest
"RTN","SAMINOT1",264,0)
 i $g(@vals@("chart-eligibility-complete"))'="true" d  ;
"RTN","SAMINOT1",265,0)
 . d OUT("Lung Screening Program Chart Eligibility and Pre-enrollment Discussion Note")
"RTN","SAMINOT1",266,0)
 . d OUT("")
"RTN","SAMINOT1",267,0)
 . d ELNOTE(vals,dest,cnt)
"RTN","SAMINOT1",268,0)
 i $g(@vals@("chart-eligibility-complete"))="true" d  ;
"RTN","SAMINOT1",269,0)
 . d OUT("Lung Screening Program Pre-enrollment Discussion Note")
"RTN","SAMINOT1",270,0)
 . d OUT("")
"RTN","SAMINOT1",271,0)
 d PRENOTE(vals,dest,cnt)
"RTN","SAMINOT1",272,0)
 ;
"RTN","SAMINOT1",273,0)
 quit  ; end of MKPRE
"RTN","SAMINOT1",274,0)
 ;
"RTN","SAMINOT1",275,0)
 ;
"RTN","SAMINOT1",276,0)
 ;
"RTN","SAMINOT1",277,0)
MKIN(sid,form,vals,filter) ;
"RTN","SAMINOT1",278,0)
 ;
"RTN","SAMINOT1",279,0)
 n cnt s cnt=0
"RTN","SAMINOT1",280,0)
 ;n dest s dest=$na(@vals@("intake-note"))
"RTN","SAMINOT1",281,0)
 n dest s dest=$$MKNT(vals,"Intake Note","intake",.filter)
"RTN","SAMINOT1",282,0)
 k @dest
"RTN","SAMINOT1",283,0)
 d OUT("Lung Screening Program Intake Note")
"RTN","SAMINOT1",284,0)
 d OUT("")
"RTN","SAMINOT1",285,0)
 i $g(@vals@("chart-eligibility-complete"))'="true" d  ;
"RTN","SAMINOT1",286,0)
 . d ELNOTE(vals,dest,cnt)
"RTN","SAMINOT1",287,0)
 i $g(@vals@("pre-note-complete"))'="true" d  ;
"RTN","SAMINOT1",288,0)
 . d PRENOTE(vals,dest,cnt)
"RTN","SAMINOT1",289,0)
 d INNOTE(vals,dest,cnt)
"RTN","SAMINOT1",290,0)
 ;
"RTN","SAMINOT1",291,0)
 quit  ; end of MKIN
"RTN","SAMINOT1",292,0)
 ;
"RTN","SAMINOT1",293,0)
 ;
"RTN","SAMINOT1",294,0)
 ;
"RTN","SAMINOT1",295,0)
MKNT(vals,title,ntype,filter) ; extrinsic makes a note date=now returns 
"RTN","SAMINOT1",296,0)
 ;
"RTN","SAMINOT1",297,0)
 ; global addr. filter must be passed by reference
"RTN","SAMINOT1",298,0)
 ;
"RTN","SAMINOT1",299,0)
 n ntdt s ntdt=$$NTDTTM($$NOW^XLFDT)
"RTN","SAMINOT1",300,0)
 n ntptr
"RTN","SAMINOT1",301,0)
 s ntptr=$$MKNTLOC(vals,title,ntdt,$g(ntype),.filter)
"RTN","SAMINOT1",302,0)
 ;
"RTN","SAMINOT1",303,0)
 quit ntptr ; end of $$MKNT
"RTN","SAMINOT1",304,0)
 ;
"RTN","SAMINOT1",305,0)
 ;
"RTN","SAMINOT1",306,0)
 ;
"RTN","SAMINOT1",307,0)
MKNTLOC(vals,title,ndate,ntype,filter) ; extrinsic returns the 
"RTN","SAMINOT1",308,0)
 ;
"RTN","SAMINOT1",309,0)
 ;location for the note
"RTN","SAMINOT1",310,0)
 ;
"RTN","SAMINOT1",311,0)
 n nien
"RTN","SAMINOT1",312,0)
 s nien=$o(@vals@("notes",""),-1)+1
"RTN","SAMINOT1",313,0)
 s filter("nien")=nien
"RTN","SAMINOT1",314,0)
 n nloc s nloc=$na(@vals@("notes",nien))
"RTN","SAMINOT1",315,0)
 s @nloc@("name")=title_" "_$g(ndate)
"RTN","SAMINOT1",316,0)
 s @nloc@("date")=$g(ndate)
"RTN","SAMINOT1",317,0)
 s @nloc@("type")=$g(ntype)
"RTN","SAMINOT1",318,0)
 ;
"RTN","SAMINOT1",319,0)
 quit $name(@nloc@("text")) ; end of $$MKNTLOC
"RTN","SAMINOT1",320,0)
 ;
"RTN","SAMINOT1",321,0)
 ;
"RTN","SAMINOT1",322,0)
 ;
"RTN","SAMINOT1",323,0)
NTDTTM(ZFMDT) ; extrinsic returns the date and time in Note format
"RTN","SAMINOT1",324,0)
 ;
"RTN","SAMINOT1",325,0)
 ; ZFMDT is the fileman date/time to translate
"RTN","SAMINOT1",326,0)
 ;
"RTN","SAMINOT1",327,0)
 quit $$FMTE^XLFDT(ZFMDT,"5") ; end of $$NTDTTM
"RTN","SAMINOT1",328,0)
 ;
"RTN","SAMINOT1",329,0)
 ;
"RTN","SAMINOT1",330,0)
 ;
"RTN","SAMINOT1",331,0)
NTLOCN(sid,form,nien) ; extrinsic returns the location of the Nth note
"RTN","SAMINOT1",332,0)
 ;
"RTN","SAMINOT1",333,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",334,0)
 ;
"RTN","SAMINOT1",335,0)
 quit $name(@root@("graph",sid,form,"notes",nien)) ; end of $$NTLOCN
"RTN","SAMINOT1",336,0)
 ;
"RTN","SAMINOT1",337,0)
 ;
"RTN","SAMINOT1",338,0)
 ;
"RTN","SAMINOT1",339,0)
NTLAST(sid,form,ntype) ; extrinsic returns the location of the latest note
"RTN","SAMINOT1",340,0)
 ;
"RTN","SAMINOT1",341,0)
 ; of the type ntype
"RTN","SAMINOT1",342,0)
 ;
"RTN","SAMINOT1",343,0)
 quit  ; end of NTLAST
"RTN","SAMINOT1",344,0)
 ;
"RTN","SAMINOT1",345,0)
 ;
"RTN","SAMINOT1",346,0)
 ;
"RTN","SAMINOT1",347,0)
NTIEN(sid,form) ; extrinsic which returns the latest note for this form
"RTN","SAMINOT1",348,0)
 ;
"RTN","SAMINOT1",349,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",350,0)
 n rtn s rtn=$o(@root@("graph",sid,form,"notes"," "),-1)
"RTN","SAMINOT1",351,0)
 ;
"RTN","SAMINOT1",352,0)
 quit rtn ; end of $$NTIEN
"RTN","SAMINOT1",353,0)
 ;
"RTN","SAMINOT1",354,0)
 ;
"RTN","SAMINOT1",355,0)
 ;
"RTN","SAMINOT1",356,0)
NTLIST(nlist,sid,form) ; returns the note list in nlist, passed by ref
"RTN","SAMINOT1",357,0)
 ;
"RTN","SAMINOT1",358,0)
 n zn,root,gn
"RTN","SAMINOT1",359,0)
 s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",360,0)
 s zn=0
"RTN","SAMINOT1",361,0)
 s gn=$na(@root@("graph",sid,form,"notes"))
"RTN","SAMINOT1",362,0)
 q:'$d(@gn)
"RTN","SAMINOT1",363,0)
 f  s zn=$o(@gn@(zn)) q:+zn=0  d  ;
"RTN","SAMINOT1",364,0)
 . s @nlist@(zn,"name")=@gn@(zn,"name")
"RTN","SAMINOT1",365,0)
 . s @nlist@(zn,"nien")=zn
"RTN","SAMINOT1",366,0)
 ;
"RTN","SAMINOT1",367,0)
 quit  ; end of NTLIST
"RTN","SAMINOT1",368,0)
 ;
"RTN","SAMINOT1",369,0)
 ;
"RTN","SAMINOT1",370,0)
 ;
"RTN","SAMINOT1",371,0)
TLST ;
"RTN","SAMINOT1",372,0)
 ;
"RTN","SAMINOT1",373,0)
 set SID="XXX00677"
"RTN","SAMINOT1",374,0)
 set FORM="siform-2019-04-23"
"RTN","SAMINOT1",375,0)
 do NTLIST("G",SID,FORM)
"RTN","SAMINOT1",376,0)
 ;ZWR G
"RTN","SAMINOT1",377,0)
 ;
"RTN","SAMINOT1",378,0)
 quit  ; end of TLST
"RTN","SAMINOT1",379,0)
 ;
"RTN","SAMINOT1",380,0)
 ;
"RTN","SAMINOT1",381,0)
 ;
"RTN","SAMINOT1",382,0)
ELNOTE(vals,dest,cnt) ; eligibility NOTE TEXT
"RTN","SAMINOT1",383,0)
 ;
"RTN","SAMINOT1",384,0)
 D OUT("")
"RTN","SAMINOT1",385,0)
 D OUT("Date of chart review: "_$$XVAL("sidc",vals))
"RTN","SAMINOT1",386,0)
 D GLOUT("The participant was identified as a potential lung screening candidate by: ")
"RTN","SAMINOT1",387,0)
 D GLOUT($$XVAL("siceiden",vals),4)
"RTN","SAMINOT1",388,0)
 if $$XVAL("siceiden",vals)="referral" d  ;
"RTN","SAMINOT1",389,0)
 . D OUT("Date of Referral: "_$$XVAL("sicerfdt",vals))
"RTN","SAMINOT1",390,0)
 . n spec s spec=""
"RTN","SAMINOT1",391,0)
 . s:$$XVAL("sicerfpc",vals)="y" spec=spec_" Primary Care"
"RTN","SAMINOT1",392,0)
 . s:$$XVAL("sicerfwh",vals)="y" spec=spec_" Women's Health"
"RTN","SAMINOT1",393,0)
 . s:$$XVAL("sicerfge",vals)="y" spec=spec_" Geriatrics"
"RTN","SAMINOT1",394,0)
 . s:$$XVAL("sicerfpu",vals)="y" spec=spec_" Pulmonology"
"RTN","SAMINOT1",395,0)
 . s:$$XVAL("sicerfon",vals)="y" spec=spec_" Oncology"
"RTN","SAMINOT1",396,0)
 . s:$$XVAL("sicerfsc",vals)="y" spec=spec_" Smoking Cessation"
"RTN","SAMINOT1",397,0)
 . s:$$XVAL("sicerfot",vals)="y" spec=spec_" "_$$XVAL("sicerfoo",vals)
"RTN","SAMINOT1",398,0)
 . D GLOUT("Specialty of referring provider: ")
"RTN","SAMINOT1",399,0)
 . D GLOUT(spec,4)
"RTN","SAMINOT1",400,0)
 n elig
"RTN","SAMINOT1",401,0)
 s elig=$$XVAL("sicechrt",vals)
"RTN","SAMINOT1",402,0)
 D OUT("The participant is eligible based on chart review: "_$s(elig="y":"Yes",1:"no"))
"RTN","SAMINOT1",403,0)
 D OUT("")
"RTN","SAMINOT1",404,0)
 s @vals@("chart-eligibility-complete")="true"
"RTN","SAMINOT1",405,0)
 ;
"RTN","SAMINOT1",406,0)
 quit  ; end of ELNOTE
"RTN","SAMINOT1",407,0)
 ;
"RTN","SAMINOT1",408,0)
 ;
"RTN","SAMINOT1",409,0)
 ;
"RTN","SAMINOT1",410,0)
PRENOTE(vals,dest,cnt) ;
"RTN","SAMINOT1",411,0)
 ;
"RTN","SAMINOT1",412,0)
 i $g(@vals@("sipedisc"))'="y" q  ; no prelim discussion
"RTN","SAMINOT1",413,0)
 D OUT("")
"RTN","SAMINOT1",414,0)
 ;d OUT("A pre-enrollment discussion was held.")
"RTN","SAMINOT1",415,0)
 ;[If Yes is selected then add the following 5 lines]
"RTN","SAMINOT1",416,0)
 D OUT("The program attempted to reach the Veteran to discuss lung screening.")
"RTN","SAMINOT1",417,0)
 D OUT("Date of pre-enrollment discussion: "_$$XVAL("sipedc",vals))
"RTN","SAMINOT1",418,0)
 n via s via=""
"RTN","SAMINOT1",419,0)
 s:$$XVAL("sipecnip",vals)="1" via=via_" In person"
"RTN","SAMINOT1",420,0)
 s:$$XVAL("sipecnte",vals)="1" via=via_" Telephone"
"RTN","SAMINOT1",421,0)
 s:$$XVAL("sipecnth",vals)="1" via=via_" TeleHealth"
"RTN","SAMINOT1",422,0)
 s:$$XVAL("sipecnml",vals)="1" via=via_" Mailed Letter"
"RTN","SAMINOT1",423,0)
 s:$$XVAL("sipecnpp",vals)="1" via=via_" Message in patient portal"
"RTN","SAMINOT1",424,0)
 s:$$XVAL("sipecnvd",vals)="1" via=via_" Video-on-Demand (VOD)"
"RTN","SAMINOT1",425,0)
 s:$$XVAL("sipecnot",vals)="1" via=via_" "_$$XVAL("sipecnoo",vals)
"RTN","SAMINOT1",426,0)
 ;D OUT("The lung screening program reached the potential candidate or was contacted via:"_via)
"RTN","SAMINOT1",427,0)
 D GLOUT("The lung screening program reached the potential candidate or was contacted via:")
"RTN","SAMINOT1",428,0)
 D GLOUT(via,4)
"RTN","SAMINOT1",429,0)
 ;D OUT("The pre-enrollment discussion with the participant resulted in: "_$$SUBRSLT($$XVAL("siperslt",vals)))
"RTN","SAMINOT1",430,0)
 D OUT("The pre-enrollment discussion with the participant resulted in: ")
"RTN","SAMINOT1",431,0)
 D GLOUT($$SUBRSLT($$XVAL("siperslt",vals)),4)
"RTN","SAMINOT1",432,0)
 D OUT("Comments: ")
"RTN","SAMINOT1",433,0)
 D GLOUT($$XVAL("sipecmnt",vals),4)
"RTN","SAMINOT1",434,0)
 ;
"RTN","SAMINOT1",435,0)
 s @vals@("pre-note-complete")="true"
"RTN","SAMINOT1",436,0)
 ;
"RTN","SAMINOT1",437,0)
 quit  ; end of PRENOTE
"RTN","SAMINOT1",438,0)
 ;
"RTN","SAMINOT1",439,0)
 ;
"RTN","SAMINOT1",440,0)
 ;
"RTN","SAMINOT1",441,0)
SUBRSLT(XVAL) ; translation of discussion result
"RTN","SAMINOT1",442,0)
 ;
"RTN","SAMINOT1",443,0)
 q:XVAL="y" "Participant is interested in discussing lung screening. The program will proceed with enrollment process."
"RTN","SAMINOT1",444,0)
 q:XVAL="u" "Participant is unsure of lung screening. Ok to contact in the future."
"RTN","SAMINOT1",445,0)
 q:XVAL="nn" "Participant is not interested in discussing lung screening at this time. Ok to contact in the future."
"RTN","SAMINOT1",446,0)
 q:XVAL="nf" "Participant is not interested in discussing lung screening in the future."
"RTN","SAMINOT1",447,0)
 q:XVAL="na" "Unable to reach participant at this time"
"RTN","SAMINOT1",448,0)
 ;
"RTN","SAMINOT1",449,0)
 quit "" ; end of $$SUBRSLT
"RTN","SAMINOT1",450,0)
 ;
"RTN","SAMINOT1",451,0)
 ;
"RTN","SAMINOT1",452,0)
 ;
"RTN","SAMINOT1",453,0)
INNOTE(vals,dest,cnt) ;
"RTN","SAMINOT1",454,0)
 ;
"RTN","SAMINOT1",455,0)
 ;Lung Screening Program Intake Note
"RTN","SAMINOT1",456,0)
 ;
"RTN","SAMINOT1",457,0)
 ;Date of intake discussion contact:       [Date]
"RTN","SAMINOT1",458,0)
 ;How did you learn about the Lung Screening Program?:  [Selection]
"RTN","SAMINOT1",459,0)
 ;Primary address verified:                 [Yes/No]
"RTN","SAMINOT1",460,0)
 ;Rural status:                                        [Urban/Rural/Unknown]
"RTN","SAMINOT1",461,0)
 ;Preferred address and contact number:
"RTN","SAMINOT1",462,0)
 ;     [Address 1]
"RTN","SAMINOT1",463,0)
 ;           [Address 2]
"RTN","SAMINOT1",464,0)
 ;              [Address]
"RTN","SAMINOT1",465,0)
 ;
"RTN","SAMINOT1",466,0)
 ;Ever smoked?:            [Ever Smoked Text]
"RTN","SAMINOT1",467,0)
 ;Smoking Status:          [Never Smoked/Past/Current/Willing to Quit]
"RTN","SAMINOT1",468,0)
 ;CIGs per day:               [Input Number]
"RTN","SAMINOT1",469,0)
 ;PPD:                              [Computed Number]
"RTN","SAMINOT1",470,0)
 ;# of years:                    [Input Number]
"RTN","SAMINOT1",471,0)
 ;Pack Years:                   [Computed Number]
"RTN","SAMINOT1",472,0)
 ;
"RTN","SAMINOT1",473,0)
 ;[If a Quit Date is entered add the following line]
"RTN","SAMINOT1",474,0)
 ;Quit smoking on:         [Date]
"RTN","SAMINOT1",475,0)
 ;
"RTN","SAMINOT1",476,0)
 ;[If Smoking Cessation education text is entered add the following line]
"RTN","SAMINOT1",477,0)
 ;Smoking cessation education provided: [Show Input Text]
"RTN","SAMINOT1",478,0)
 ;
"RTN","SAMINOT1",479,0)
 ;[If a Lung Cancer Dx date is entered show the following 1 to 2 lines]
"RTN","SAMINOT1",480,0)
 ;Prior lung cancer diagnosis date: [Date]
"RTN","SAMINOT1",481,0)
 ;[If a location not in the VA is specified show the next line]
"RTN","SAMINOT1",482,0)
 ;Location where prior lung cancer diagnosis was made: [Location Text]
"RTN","SAMINOT1",483,0)
 ;
"RTN","SAMINOT1",484,0)
 ;[If Any Prior CT Date is entered show the following 1 to 2 lines]
"RTN","SAMINOT1",485,0)
 ;Prior CT:                   [Date]
"RTN","SAMINOT1",486,0)
 ;[If a location not in the VA is specified show the next line]
"RTN","SAMINOT1",487,0)
 ;Location where prior lung cancer diagnosis was made: [Location Text]
"RTN","SAMINOT1",488,0)
 ;
"RTN","SAMINOT1",489,0)
 ;Shared Decision Making:
"RTN","SAMINOT1",490,0)
 ;
"RTN","SAMINOT1",491,0)
 d OUT(" ")
"RTN","SAMINOT1",492,0)
 d OUT("   "_"Date of intake discussion contact: "_$$XVAL("sidc",vals))
"RTN","SAMINOT1",493,0)
 n learn s learn=""
"RTN","SAMINOT1",494,0)
 s:$$XVAL("silnip",vals) learn=learn_" In person"
"RTN","SAMINOT1",495,0)
 s:$$XVAL("silnph",vals) learn=learn_" Telephone"
"RTN","SAMINOT1",496,0)
 s:$$XVAL("silnth",vals) learn=learn_" TeleHealth"
"RTN","SAMINOT1",497,0)
 s:$$XVAL("silnml",vals) learn=learn_" Mailed letter"
"RTN","SAMINOT1",498,0)
 s:$$XVAL("silnpp",vals) learn=learn_" Message in patient portal"
"RTN","SAMINOT1",499,0)
 s:$$XVAL("silnvd",vals) learn=learn_" Video-on-Demand (VOD)"
"RTN","SAMINOT1",500,0)
 s:$$XVAL("silnot",vals) learn=learn_" "_$$XVAL("silnoo",vals)
"RTN","SAMINOT1",501,0)
 ;d GLOUT("   "_"How did you learn about the Lung Screening Program?: "_learn,4)
"RTN","SAMINOT1",502,0)
 d GLOUT("How did you learn about the Lung Screening Program?: ",4)
"RTN","SAMINOT1",503,0)
 d GLOUT(learn,6)
"RTN","SAMINOT1",504,0)
 n verified s verified=""
"RTN","SAMINOT1",505,0)
 s:$$XVAL("sipav",vals)="y" verified="Yes"
"RTN","SAMINOT1",506,0)
 s:$$XVAL("sipav",vals)="n" verified="No"
"RTN","SAMINOT1",507,0)
 d OUT("   "_"Primary address verified: "_verified)
"RTN","SAMINOT1",508,0)
 n rural s rural=""
"RTN","SAMINOT1",509,0)
 s:$$XVAL("sirs",vals)="r" rural="rural"
"RTN","SAMINOT1",510,0)
 s:$$XVAL("sirs",vals)="u" rural="urban"
"RTN","SAMINOT1",511,0)
 d OUT("   "_""_"Rural status: "_rural)
"RTN","SAMINOT1",512,0)
 d OUT("   "_"Preferred address and contact number: ")
"RTN","SAMINOT1",513,0)
 n pa s pa=""
"RTN","SAMINOT1",514,0)
 i $$XVAL("sipsa",vals)'="" d  ;
"RTN","SAMINOT1",515,0)
 . d OUT("      "_$$XVAL("sipsa",vals))
"RTN","SAMINOT1",516,0)
 . n csz s csz=""
"RTN","SAMINOT1",517,0)
 . s:$$XVAL("sipc",vals)'="" csz=$$XVAL("sipc",vals)
"RTN","SAMINOT1",518,0)
 . s:$$XVAL("sips",vals)'="" csz=csz_", "_$$XVAL("sips",vals)
"RTN","SAMINOT1",519,0)
 . s:$$XVAL("sipz",vals)'="" csz=csz_" "_$$XVAL("sipz",vals)
"RTN","SAMINOT1",520,0)
 . d OUT("      "_csz)
"RTN","SAMINOT1",521,0)
 d:$$XVAL("sippn",vals)'="" OUT("      "_$$XVAL("sippn",vals))
"RTN","SAMINOT1",522,0)
 d OUT("   "_"Ever smoked?: ")
"RTN","SAMINOT1",523,0)
 d GLOUT($$XVAL("sies",vals),6)
"RTN","SAMINOT1",524,0)
 n sstatus s sstatus=""
"RTN","SAMINOT1",525,0)
 s:$$XVAL("siesm",vals)="n" sstatus=sstatus_" Never smoked"
"RTN","SAMINOT1",526,0)
 s:$$XVAL("siesm",vals)="p" sstatus=sstatus_" Past"
"RTN","SAMINOT1",527,0)
 s:$$XVAL("siesm",vals)="c" sstatus=sstatus_" Current"
"RTN","SAMINOT1",528,0)
 s:$$XVAL("siesq",vals)=1 sstatus=sstatus_" Willing to quit"
"RTN","SAMINOT1",529,0)
 d OUT("   Smoking Status: "_sstatus)
"RTN","SAMINOT1",530,0)
 d OUT("   "_"CIGs per day: ")
"RTN","SAMINOT1",531,0)
 d OUT("      "_$$XVAL("sicpd",vals))
"RTN","SAMINOT1",532,0)
 d OUT("   "_"PPD: ")
"RTN","SAMINOT1",533,0)
 d OUT("      "_$$XVAL("sippd",vals))
"RTN","SAMINOT1",534,0)
 d OUT("   "_"# of years: ")
"RTN","SAMINOT1",535,0)
 d OUT("      "_$$XVAL("sisny",vals))
"RTN","SAMINOT1",536,0)
 d OUT("   "_"PPY: ")
"RTN","SAMINOT1",537,0)
 d OUT("      "_$$XVAL("sippy",vals))
"RTN","SAMINOT1",538,0)
 d OUT("")
"RTN","SAMINOT1",539,0)
 i $$XVAL("siq",vals)'="" d  ;
"RTN","SAMINOT1",540,0)
 . d OUT("Quit smoking on: "_$$XVAL("siq",vals))
"RTN","SAMINOT1",541,0)
 . d OUT("")
"RTN","SAMINOT1",542,0)
 i $$XVAL("sicep",vals)'="" d  ;
"RTN","SAMINOT1",543,0)
 . d OUT("Smoking cessation education provided:")
"RTN","SAMINOT1",544,0)
 . d GLOUT("    "_$$XVAL("sicep",vals),4)
"RTN","SAMINOT1",545,0)
 i $$XVAL("sicadx",vals)'="" d
"RTN","SAMINOT1",546,0)
 . d OUT("Prior lung cancer diagnosis date: "_$$XVAL("sicadx",vals))
"RTN","SAMINOT1",547,0)
 . i $$XVAL("sicadxl",vals)'="" d  ;
"RTN","SAMINOT1",548,0)
 . . d OUT("Location where prior lung cancer diagnosis was made:")
"RTN","SAMINOT1",549,0)
 . . d GLOUT("    "_$$XVAL("sicadxl",vals),4)
"RTN","SAMINOT1",550,0)
 i $$XVAL("siptct",vals)'="" d
"RTN","SAMINOT1",551,0)
 . d OUT("Prior CT: "_$$XVAL("siptct",vals))
"RTN","SAMINOT1",552,0)
 . i $$XVAL("siptctl",vals)'="" d  ;
"RTN","SAMINOT1",553,0)
 . . d OUT("Location where prior CT was made:")
"RTN","SAMINOT1",554,0)
 . . d GLOUT("    "_$$XVAL("siptctl",vals),4)
"RTN","SAMINOT1",555,0)
 d OUT(" ")
"RTN","SAMINOT1",556,0)
 d OUT("Shared Decision Making: ")
"RTN","SAMINOT1",557,0)
 d OUT(" ")
"RTN","SAMINOT1",558,0)
 d SDM(dest)
"RTN","SAMINOT1",559,0)
 d OUT(" ")
"RTN","SAMINOT1",560,0)
 n ldct s ldct=""
"RTN","SAMINOT1",561,0)
 s:$$XVAL("sildct",vals)="n" ldct="No"
"RTN","SAMINOT1",562,0)
 s:$$XVAL("sildct",vals)="l" ldct="No"
"RTN","SAMINOT1",563,0)
 s:$$XVAL("sildct",vals)="y" ldct="Yes"
"RTN","SAMINOT1",564,0)
 d GLOUT("The veteran has decided to enroll in the Lung Screening Program: "_ldct)
"RTN","SAMINOT1",565,0)
 i $$XVAL("sildct",vals)="l" d  ;
"RTN","SAMINOT1",566,0)
 . d GLOUT("The veteran has indicated it is okay to contact in the future to discuss enrolling in the Lung Screening Program.",4)
"RTN","SAMINOT1",567,0)
 i ldct="Yes" d  ;
"RTN","SAMINOT1",568,0)
 . d OUT("LDCT ordered: "_ldct)
"RTN","SAMINOT1",569,0)
 . d OUT("    "_"Veteran enrolled in the LSS program. Results and coordination of care ")
"RTN","SAMINOT1",570,0)
 . d OUT("    "_"will be made by the LSS team.  ")
"RTN","SAMINOT1",571,0)
 . i $$XVAL("siclin",vals)'="" d  ;
"RTN","SAMINOT1",572,0)
 n tmpclin s tmpclin=$$XVAL("siclin",vals)
"RTN","SAMINOT1",573,0)
 i tmpclin'="" d  ;
"RTN","SAMINOT1",574,0)
 . d OUT("Clinical Indications for Initial Screening CT:")
"RTN","SAMINOT1",575,0)
 . d GLOUT("    "_tmpclin,4)
"RTN","SAMINOT1",576,0)
 ;
"RTN","SAMINOT1",577,0)
 ;The veteran has decided to enroll in the Lung Screening Program: [Yes/No]
"RTN","SAMINOT1",578,0)
 ;
"RTN","SAMINOT1",579,0)
 ;[If Not enroll at this time but okay to contact in the future, add the following line]
"RTN","SAMINOT1",580,0)
 ;The veteran has indicated it is okay to contact in the future to discuss enrolling in the Lung Screening Program.
"RTN","SAMINOT1",581,0)
 ;
"RTN","SAMINOT1",582,0)
 ;[If Yes is answered for enrollment add the following two lines]
"RTN","SAMINOT1",583,0)
 ;LDCT ordered:                Yes
"RTN","SAMINOT1",584,0)
 ;Veteran enrolled in the Lung Screening Program. Results and coordination of care will be made by the Lung Screening Program team.
"RTN","SAMINOT1",585,0)
 ;
"RTN","SAMINOT1",586,0)
 ;[If Clinical Indication text is provided add them to the note]
"RTN","SAMINOT1",587,0)
 ;Clinical Indications:          [Show Input Text]
"RTN","SAMINOT1",588,0)
 ;
"RTN","SAMINOT1",589,0)
 ;
"RTN","SAMINOT1",590,0)
 quit  ; end of INNOTE
"RTN","SAMINOT1",591,0)
 ;
"RTN","SAMINOT1",592,0)
 ;
"RTN","SAMINOT1",593,0)
 ;
"RTN","SAMINOT1",594,0)
SDM(ary) ; adds Shared Decision Making text to array ary, passed by name
"RTN","SAMINOT1",595,0)
 ;
"RTN","SAMINOT1",596,0)
 n ii s ii=$o(@ary@(" "),-1)
"RTN","SAMINOT1",597,0)
 s ii=ii+1
"RTN","SAMINOT1",598,0)
 s @ary@(ii)="Veteran of age and exposure to cigarette smoke as described above, and "
"RTN","SAMINOT1",599,0)
 s ii=ii+1
"RTN","SAMINOT1",600,0)
 s @ary@(ii)="without a current diagnosis or obvious symptoms suggestive of lung cancer, "
"RTN","SAMINOT1",601,0)
 s ii=ii+1
"RTN","SAMINOT1",602,0)
 s @ary@(ii)="has been educated today about the estimated risk for lung cancer, the "
"RTN","SAMINOT1",603,0)
 s ii=ii+1
"RTN","SAMINOT1",604,0)
 s @ary@(ii)="possibility of cure or life prolonging if an early lung cancer were to be "
"RTN","SAMINOT1",605,0)
 s ii=ii+1
"RTN","SAMINOT1",606,0)
 s @ary@(ii)="found during screening, the possibility of imaging abnormalities not being "
"RTN","SAMINOT1",607,0)
 s ii=ii+1
"RTN","SAMINOT1",608,0)
 s @ary@(ii)="lung cancer, the possibility of complications from additional diagnostic "
"RTN","SAMINOT1",609,0)
 s ii=ii+1
"RTN","SAMINOT1",610,0)
 s @ary@(ii)="procedures, and the approximate amount of radiation exposure associated "
"RTN","SAMINOT1",611,0)
 s ii=ii+1
"RTN","SAMINOT1",612,0)
 s @ary@(ii)="with each screening procedure. In addition, the Veteran has been educated "
"RTN","SAMINOT1",613,0)
 s ii=ii+1
"RTN","SAMINOT1",614,0)
 s @ary@(ii)="today about the importance of adhering to annual lung screening, the "
"RTN","SAMINOT1",615,0)
 s ii=ii+1
"RTN","SAMINOT1",616,0)
 s @ary@(ii)="possible impact of other medical conditions on the overall health status, "
"RTN","SAMINOT1",617,0)
 s ii=ii+1
"RTN","SAMINOT1",618,0)
 s @ary@(ii)="the importance of avoiding exposure to cigarette smoke, available tobacco "
"RTN","SAMINOT1",619,0)
 s ii=ii+1
"RTN","SAMINOT1",620,0)
 s @ary@(ii)="cessation programs and available lung screening services at this site. "
"RTN","SAMINOT1",621,0)
 s ii=ii+1
"RTN","SAMINOT1",622,0)
 s @ary@(ii)="Education material was provided to the veteran. "
"RTN","SAMINOT1",623,0)
 s ii=ii+1
"RTN","SAMINOT1",624,0)
 ;s @ary@(ii)="Based on this information, the Veteran has opted for "
"RTN","SAMINOT1",625,0)
 ;
"RTN","SAMINOT1",626,0)
 quit  ; end of SDM
"RTN","SAMINOT1",627,0)
 ;
"RTN","SAMINOT1",628,0)
 ;
"RTN","SAMINOT1",629,0)
 ;
"RTN","SAMINOT1",630,0)
GLOUT(ln,indent) ; glob out first wrap ln then put it in dest
"RTN","SAMINOT1",631,0)
 ;
"RTN","SAMINOT1",632,0)
 n arytmp
"RTN","SAMINOT1",633,0)
 s arytmp(1)=ln
"RTN","SAMINOT1",634,0)
 i $g(indent)="" s indent=1
"RTN","SAMINOT1",635,0)
 d wrap^%tt("arytmp",indent_":80")
"RTN","SAMINOT1",636,0)
 n ii s ii=""
"RTN","SAMINOT1",637,0)
 f  s ii=$o(arytmp(ii)) q:ii=""  d  ;
"RTN","SAMINOT1",638,0)
 . d OUT(arytmp(ii))
"RTN","SAMINOT1",639,0)
 ;
"RTN","SAMINOT1",640,0)
 quit  ; end of GLOUT
"RTN","SAMINOT1",641,0)
 ;
"RTN","SAMINOT1",642,0)
 ;
"RTN","SAMINOT1",643,0)
 ;
"RTN","SAMINOT1",644,0)
OUT(ln) ;
"RTN","SAMINOT1",645,0)
 ;
"RTN","SAMINOT1",646,0)
 s cnt=cnt+1
"RTN","SAMINOT1",647,0)
 n lnn
"RTN","SAMINOT1",648,0)
 ;s debug=1
"RTN","SAMINOT1",649,0)
 s lnn=$o(@dest@(" "),-1)+1
"RTN","SAMINOT1",650,0)
 s @dest@(lnn)=ln
"RTN","SAMINOT1",651,0)
 ;
"RTN","SAMINOT1",652,0)
 ;i $g(debug)=1 d  ;
"RTN","SAMINOT1",653,0)
 ;. i ln["<" q  ; no markup
"RTN","SAMINOT1",654,0)
 ;. n zs s zs=$STACK
"RTN","SAMINOT1",655,0)
 ;. n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMINOT1",656,0)
 ;. s @dest@(lnn)=zp_":"_ln
"RTN","SAMINOT1",657,0)
 ;
"RTN","SAMINOT1",658,0)
 quit  ; end of OUT
"RTN","SAMINOT1",659,0)
 ;
"RTN","SAMINOT1",660,0)
 ;
"RTN","SAMINOT1",661,0)
 ;
"RTN","SAMINOT1",662,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMINOT1",663,0)
 ;
"RTN","SAMINOT1",664,0)
 ; vals is passed by name
"RTN","SAMINOT1",665,0)
 ;
"RTN","SAMINOT1",666,0)
 n zr
"RTN","SAMINOT1",667,0)
 s zr=$g(@vals@(var))
"RTN","SAMINOT1",668,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMINOT1",669,0)
 ;
"RTN","SAMINOT1",670,0)
 quit zr ; end of $$XVAL
"RTN","SAMINOT1",671,0)
 ;
"RTN","SAMINOT1",672,0)
 ;
"RTN","SAMINOT1",673,0)
 ;
"RTN","SAMINOT1",674,0)
EOR ; end of routine SAMINOT1
"RTN","SAMINUL")
0^13^B99724
"RTN","SAMINUL",1,0)
SAMINUL ;ven/gpl - ielcap: note log ;2021-03-23T19:36Z
"RTN","SAMINUL",2,0)
 ;;18.0;SAMI;**9,10**;;Build 3
"RTN","SAMINUL",3,0)
 ;;1.18.0.10-i10
"RTN","SAMINUL",4,0)
 ;
"RTN","SAMINUL",5,0)
 ; SAMINOTE contains subroutines for producing the ELCAP Note Pages.
"RTN","SAMINUL",6,0)
 ; SAMINUL contains the development log for the SAMINOT* routines.
"RTN","SAMINUL",7,0)
 ; It contains no executable code.
"RTN","SAMINUL",8,0)
 ;
"RTN","SAMINUL",9,0)
 quit  ; no entry from top
"RTN","SAMINUL",10,0)
 ;
"RTN","SAMINUL",11,0)
 ;
"RTN","SAMINUL",12,0)
 ;
"RTN","SAMINUL",13,0)
 ;@section 0 primary development
"RTN","SAMINUL",14,0)
 ;
"RTN","SAMINUL",15,0)
 ;
"RTN","SAMINUL",16,0)
 ;
"RTN","SAMINUL",17,0)
 ;@routine-credits
"RTN","SAMINUL",18,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMINUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMINUL",20,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMINUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMINUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMINUL",23,0)
 ;@license see routine SAMIUL
"RTN","SAMINUL",24,0)
 ;
"RTN","SAMINUL",25,0)
 ;@last-updated 2021-03-23T19:36Z
"RTN","SAMINUL",26,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMINUL",27,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMINUL",28,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMINUL",29,0)
 ;@version 1.18.0.10-i10
"RTN","SAMINUL",30,0)
 ;@release-date 2020-01
"RTN","SAMINUL",31,0)
 ;@patch-list **9,10**
"RTN","SAMINUL",32,0)
 ;
"RTN","SAMINUL",33,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMINUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMINUL",35,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMINUL",36,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMINUL",37,0)
 ;@additional-dev Linda M. R. Yaw (lmry)
"RTN","SAMINUL",38,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMINUL",39,0)
 ;@additional-dev Alexis R. Carlson (arc)
"RTN","SAMINUL",40,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMINUL",41,0)
 ;@additional-dev Domenic DiNatale (dom)
"RTN","SAMINUL",42,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMINUL",43,0)
 ;
"RTN","SAMINUL",44,0)
 ;@module-credits
"RTN","SAMINUL",45,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMINUL",46,0)
 ; (VA-PALS)
"RTN","SAMINUL",47,0)
 ; http://va-pals.org/
"RTN","SAMINUL",48,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMINUL",49,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMINUL",50,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMINUL",51,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMINUL",52,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMINUL",53,0)
 ; http://ielcap.com/
"RTN","SAMINUL",54,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMINUL",55,0)
 ; http://paraxialtech.com/
"RTN","SAMINUL",56,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMINUL",57,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMINUL",58,0)
 ;
"RTN","SAMINUL",59,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMINUL",60,0)
 ;
"RTN","SAMINUL",61,0)
 ; 2019-04-04/18 ven/gpl 1.18.0-t04 c0bb7dbf,f7b48936,9d1f2cdc,
"RTN","SAMINUL",62,0)
 ;  ba5f366d,5b2e32dc,ce322911
"RTN","SAMINUL",63,0)
 ;  SAMINOT1: flags for intake form, fix crash on intake form, initial
"RTN","SAMINUL",64,0)
 ; version of new intake notes, revise text for pre-enrollment
"RTN","SAMINUL",65,0)
 ; discusstion note, complete new intake notes, add intake notes to
"RTN","SAMINUL",66,0)
 ; case review page.
"RTN","SAMINUL",67,0)
 ;
"RTN","SAMINUL",68,0)
 ; 2019-04-16/23 ven/lgc 1.18.0-t04 e54b76d1,21388d8a,f0505e51,
"RTN","SAMINUL",69,0)
 ;  89bffd3b
"RTN","SAMINUL",70,0)
 ;  SAMINOT1: SAMIFRM2 > SAMIFORM, remove spaces at end of lines,
"RTN","SAMINUL",71,0)
 ; control characters, SAMISUB2 > LOAD.
"RTN","SAMINUL",72,0)
 ;
"RTN","SAMINUL",73,0)
 ; 2019-04-23 ven/toad 1.18.0-t04 423a3946
"RTN","SAMINUL",74,0)
 ;  SAMINOT1: resolve gpl/lgc collision, restore SAMISUB2 > LOAD.
"RTN","SAMINUL",75,0)
 ;
"RTN","SAMINUL",76,0)
 ; 2019-04-30 ven/gpl 1.18.0-t04 cf73510c
"RTN","SAMINUL",77,0)
 ;  SAMINOT1: additions to intake note for prior scans & format.
"RTN","SAMINUL",78,0)
 ;
"RTN","SAMINUL",79,0)
 ; 2019-05-07 ven/lmry 1.18.0-t04 4a8ead45
"RTN","SAMINUL",80,0)
 ;  SAMINOT1: edit SAMINOT1 for XINDEX.
"RTN","SAMINUL",81,0)
 ;
"RTN","SAMINUL",82,0)
 ; 2019-05-07 ven/lgc 1.18.0-t04 f63ef57c
"RTN","SAMINUL",83,0)
 ;  SAMINOT1: cleanup for XINDEX.
"RTN","SAMINUL",84,0)
 ;
"RTN","SAMINUL",85,0)
 ; 2019-06-18 ven/arc 1.18.0-t04 91022482
"RTN","SAMINUL",86,0)
 ;  SAMINOT1: ^SAMIGPL > ^SAMIUL.
"RTN","SAMINUL",87,0)
 ;
"RTN","SAMINUL",88,0)
 ; 2019-07-01 ven/gpl 1.18.0-t04 72868e60
"RTN","SAMINUL",89,0)
 ;  SAMINOT1: update shared decision making text in intake note.
"RTN","SAMINUL",90,0)
 ;
"RTN","SAMINUL",91,0)
 ; 2019-08-03/14 ven/gpl 1.18.0-t04 bea65f7b,578f61d4
"RTN","SAMINUL",92,0)
 ;  SAMINOT1: fix bugs in Have you ever smoked processing in changelog
"RTN","SAMINUL",93,0)
 ; & intake note, restored ever smoked comment field to intake note.
"RTN","SAMINUL",94,0)
 ;
"RTN","SAMINUL",95,0)
 ; 2019-09-06 par/dom 1.18.0-t04 2ff47189 VAP-452
"RTN","SAMINUL",96,0)
 ;  SAMINOT1: patient > participant.
"RTN","SAMINUL",97,0)
 ;
"RTN","SAMINUL",98,0)
 ; 2019-09-26 ven/gpl 1.18.0-t04 92b12324 VAP-420
"RTN","SAMINUL",99,0)
 ;  SAMINOT1: smoking history.
"RTN","SAMINUL",100,0)
 ;
"RTN","SAMINUL",101,0)
 ; 2019-10-01 par/dom 1.18.0-t04 37c418a1,4caf1a98 VAP-457,344
"RTN","SAMINUL",102,0)
 ;  SAMINOT1: remove thorax, capitalization consistency.
"RTN","SAMINUL",103,0)
 ;
"RTN","SAMINUL",104,0)
 ; 2020-01-17/20 ven/lgc 1.18.0.1-i1 8557207f,d7d24834,0301ad95.
"RTN","SAMINUL",105,0)
 ;  659f2526,0ff2b83f,49615242,5bf7c398,dc5f618c
"RTN","SAMINUL",106,0)
 ;  SAMINOT2: followup note, fixed typos in VC note, followup LCS note
"RTN","SAMINUL",107,0)
 ; minus CT Eval pulls, LCS note with CT Eval extracts, fixed bug in
"RTN","SAMINUL",108,0)
 ; LSC CT eval extract, include entire impression section of CT Eval
"RTN","SAMINUL",109,0)
 ; report in LCS Note, improved import of impressions, limit to one
"RTN","SAMINUL",110,0)
 ; note per followup form.
"RTN","SAMINUL",111,0)
 ;
"RTN","SAMINUL",112,0)
 ; 2020-01-23 ven/arc 1.18.0.2-i2 9a24242a
"RTN","SAMINUL",113,0)
 ;  SAMINOT1: fix word wrap on intake note & typos in ct
"RTN","SAMINUL",114,0)
 ; eval report.
"RTN","SAMINUL",115,0)
 ;
"RTN","SAMINUL",116,0)
 ; 2020-08-12 ven/gpl 1.18.0.6-i6 781744c3
"RTN","SAMINUL",117,0)
 ;  SAMINOT1: chg to support hl7 transmission of notes.
"RTN","SAMINUL",118,0)
 ;
"RTN","SAMINUL",119,0)
 ; 2020-09-22 ven/gpl 1.18.0.6-i6 06459eda
"RTN","SAMINUL",120,0)
 ;  SAMINOT1: fix to match kids file.
"RTN","SAMINUL",121,0)
 ;
"RTN","SAMINUL",122,0)
 ; 2021-02-01/24 ven/gpl 1.18.0.8-i8 8e4ec441,cde71a55
"RTN","SAMINUL",123,0)
 ;  SAMINOT1: fix intake note format, fix error that sent note twice
"RTN","SAMINUL",124,0)
 ; to VistA.
"RTN","SAMINUL",125,0)
 ;
"RTN","SAMINUL",126,0)
 ; 2021-03-02 ven/gpl 1.18.0.9-i9 479dc041
"RTN","SAMINUL",127,0)
 ;  SAMINOT2: return error message if no ct eval form exists when
"RTN","SAMINUL",128,0)
 ; generating a fu note.
"RTN","SAMINUL",129,0)
 ;
"RTN","SAMINUL",130,0)
 ; 2021-03-15/16 ven/toad 1.18.0.9-i9 a46a2cc1
"RTN","SAMINUL",131,0)
 ;  SAMINUL: create routine.
"RTN","SAMINUL",132,0)
 ;  SAMINOT2: bump date & patch list, add contents, lt refactor.
"RTN","SAMINUL",133,0)
 ;
"RTN","SAMINUL",134,0)
 ; 2021-03-17 ven/toad 1.18.0.9-i9 62da30b4
"RTN","SAMINUL",135,0)
 ; SAMINOT2: remove blank from end of 1 line.
"RTN","SAMINUL",136,0)
 ;
"RTN","SAMINUL",137,0)
 ; 2021-03-22 ven/gpl 1.18.0.10-i10 6319a1eb
"RTN","SAMINUL",138,0)
 ;  SAMINOT1: fix logic bug in detecting pre-enrollment existing.
"RTN","SAMINUL",139,0)
 ;
"RTN","SAMINUL",140,0)
 ; 2021-03-23 ven/toad 1.18.0.10-i10
"RTN","SAMINUL",141,0)
 ;  SAMINOT1: bump date & patch list, lt refactor.
"RTN","SAMINUL",142,0)
 ;
"RTN","SAMINUL",143,0)
 ;
"RTN","SAMINUL",144,0)
 ;
"RTN","SAMINUL",145,0)
EOR ; end of routine SAMINUL
"RTN","SAMIUR")
0^12^B283175290
"RTN","SAMIUR",1,0)
SAMIUR ;ven/gpl - user reports ;2021-03-23T19:43Z
"RTN","SAMIUR",2,0)
 ;;18.0;SAMI;**5,10**;2020-01;Build 3
"RTN","SAMIUR",3,0)
 ;;1.18.0.10-i10
"RTN","SAMIUR",4,0)
 ;
"RTN","SAMIUR",5,0)
 ; SAMIUR contains a web service & associated subroutines to produce
"RTN","SAMIUR",6,0)
 ; the VAPALS-ELCAP user reports.
"RTN","SAMIUR",7,0)
 ;
"RTN","SAMIUR",8,0)
 quit  ; no entry from top
"RTN","SAMIUR",9,0)
 ;
"RTN","SAMIUR",10,0)
 ;
"RTN","SAMIUR",11,0)
 ;
"RTN","SAMIUR",12,0)
 ;@section 0 primary development
"RTN","SAMIUR",13,0)
 ;
"RTN","SAMIUR",14,0)
 ;
"RTN","SAMIUR",15,0)
 ;
"RTN","SAMIUR",16,0)
 ;@routine-credits
"RTN","SAMIUR",17,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMIUR",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUR",19,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMIUR",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIUR",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIUR",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIUR",23,0)
 ;
"RTN","SAMIUR",24,0)
 ;@last-updated 2021-03-23T19:43Z
"RTN","SAMIUR",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIUR",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIUR",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUR",28,0)
 ;@version 1.18.0.10-i10
"RTN","SAMIUR",29,0)
 ;@release-date 2020-01
"RTN","SAMIUR",30,0)
 ;@patch-list **5,10**
"RTN","SAMIUR",31,0)
 ;
"RTN","SAMIUR",32,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMIUR",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUR",34,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMIUR",35,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIUR",36,0)
 ;@additional-dev Alexis R. Carlson (arc)
"RTN","SAMIUR",37,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIUR",38,0)
 ;
"RTN","SAMIUR",39,0)
 ;@module-credits
"RTN","SAMIUR",40,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIUR",41,0)
 ; (VA-PALS)
"RTN","SAMIUR",42,0)
 ; http://va-pals.org/
"RTN","SAMIUR",43,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIUR",44,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIUR",45,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIUR",46,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIUR",47,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIUR",48,0)
 ; http://ielcap.com/
"RTN","SAMIUR",49,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIUR",50,0)
 ; http://paraxialtech.com/
"RTN","SAMIUR",51,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIUR",52,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIUR",53,0)
 ;
"RTN","SAMIUR",54,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUR",55,0)
 ;
"RTN","SAMIUR",56,0)
 ; 2020-02-10/12 ven/gpl 1.18.0-t04 d543f7bb,f9869dfb,0e4d8b9a
"RTN","SAMIUR",57,0)
 ;  SAMIUR: 1st version of revised user reports, progress on user
"RTN","SAMIUR",58,0)
 ; reports, fixed a bug in enrollment report.
"RTN","SAMIUR",59,0)
 ;
"RTN","SAMIUR",60,0)
 ; 2020-02-18 ven/lgc 1.18.0-t04 76874314
"RTN","SAMIUR",61,0)
 ;  SAMIUR: update recently edited routines.
"RTN","SAMIUR",62,0)
 ;
"RTN","SAMIUR",63,0)
 ; 2020-03-10/12 ven/gpl 1.18.0-t04 8de06b06,4ad52d64
"RTN","SAMIUR",64,0)
 ;  SAMIUR: user report date filtering, fix end date logic in UR.
"RTN","SAMIUR",65,0)
 ;
"RTN","SAMIUR",66,0)
 ; 2020-04-16/23 ven/lgc 1.18.0-t04 e54b76d1b,89bffd3b
"RTN","SAMIUR",67,0)
 ;  SAMIUR: SAMIFRM2 > SAMIFORM, SAMISUB2 > LOAD.
"RTN","SAMIUR",68,0)
 ;
"RTN","SAMIUR",69,0)
 ; 2020-08-04 ven/gpl 1.18.0-t04 cd865e2b VPA-438
"RTN","SAMIUR",70,0)
 ;  SAMIUR: requested changes to followup report.
"RTN","SAMIUR",71,0)
 ;
"RTN","SAMIUR",72,0)
 ; 2020-09-26 ven/gpl 1.18.0-t04 92b12324 VAP-420
"RTN","SAMIUR",73,0)
 ;  SAMIUR: add smoking history.
"RTN","SAMIUR",74,0)
 ;
"RTN","SAMIUR",75,0)
 ; 2020-01-01/05 ven/arc 1.18.0 399f8547,62e3200f
"RTN","SAMIUR",76,0)
 ;  SAMIUR: unmatched participant processing.
"RTN","SAMIUR",77,0)
 ;
"RTN","SAMIUR",78,0)
 ; 2020-04-29/05-13 ven/gpl 1.18.0.5-i5 e8b8ea2d,61c7d208
"RTN","SAMIUR",79,0)
 ;  SAMIUR: fixes for reports, worklist functionality.
"RTN","SAMIUR",80,0)
 ;
"RTN","SAMIUR",81,0)
 ; 2021-03-22/23 ven/gpl 1.18.0.10-i10 256efe63,ba81b86a2
"RTN","SAMIUR",82,0)
 ;  SAMIUR: sort all reports by name, added row totals to reports.
"RTN","SAMIUR",83,0)
 ;
"RTN","SAMIUR",84,0)
 ; 2021-03-23 ven/toad 1.18.0.10-i10
"RTN","SAMIUR",85,0)
 ; SAMIUR: add version info & dev log, lt refactor, fix XINDEX errors.
"RTN","SAMIUR",86,0)
 ;
"RTN","SAMIUR",87,0)
 ;
"RTN","SAMIUR",88,0)
 ;
"RTN","SAMIUR",89,0)
WSREPORT(SAMIRTN,filter) ; generate a report based on parameters in the filter
"RTN","SAMIUR",90,0)
 ;
"RTN","SAMIUR",91,0)
 ; here are the user reports that are defined:
"RTN","SAMIUR",92,0)
 ;  1. followup
"RTN","SAMIUR",93,0)
 ;  2. activity
"RTN","SAMIUR",94,0)
 ;  3. missingct
"RTN","SAMIUR",95,0)
 ;  4. incomplete
"RTN","SAMIUR",96,0)
 ;  5. outreach
"RTN","SAMIUR",97,0)
 ;  6. enrollment
"RTN","SAMIUR",98,0)
 ;  7. worklist
"RTN","SAMIUR",99,0)
 ; the report to generate is passed in parameter samireporttype
"RTN","SAMIUR",100,0)
 ;
"RTN","SAMIUR",101,0)
 n debug s debug=0
"RTN","SAMIUR",102,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMIUR",103,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMIUR",104,0)
 k SAMIRTN
"RTN","SAMIUR",105,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMIUR",106,0)
 ;
"RTN","SAMIUR",107,0)
 n type,temp
"RTN","SAMIUR",108,0)
 s type=$g(filter("samireporttype"))
"RTN","SAMIUR",109,0)
 i type="" d  q  ; report type missing
"RTN","SAMIUR",110,0)
 . d GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",111,0)
 ;
"RTN","SAMIUR",112,0)
 d getThis^%wd("temp","table.html") ; page template
"RTN","SAMIUR",113,0)
 q:'$d(temp)
"RTN","SAMIUR",114,0)
 ;
"RTN","SAMIUR",115,0)
 n SAMIPATS
"RTN","SAMIUR",116,0)
 ;s pats=""
"RTN","SAMIUR",117,0)
 n datephrase
"RTN","SAMIUR",118,0)
 d SELECT(.SAMIPATS,type,.datephrase,.filter) ; select patients for the report
"RTN","SAMIUR",119,0)
 ;q:'$d(SAMIPATS)
"RTN","SAMIUR",120,0)
 ;
"RTN","SAMIUR",121,0)
 n ln,cnt,ii
"RTN","SAMIUR",122,0)
 s (ii,ln,cnt)=0
"RTN","SAMIUR",123,0)
 f  s ii=$o(temp(ii)) q:+ii=0  q:$g(temp(ii))["<thead"  d  ;
"RTN","SAMIUR",124,0)
 . s cnt=cnt+1
"RTN","SAMIUR",125,0)
 . s ln=$g(temp(ii))
"RTN","SAMIUR",126,0)
 . n samikey,si
"RTN","SAMIUR",127,0)
 . s (samikey,si)=""
"RTN","SAMIUR",128,0)
 . d LOAD^SAMIFORM(.ln,samikey,si,.filter)
"RTN","SAMIUR",129,0)
 . ;i ln["PAGE NAME" d findReplace^%ts(.ln,"PAGE NAME",$$PNAME(type,datephrase))
"RTN","SAMIUR",130,0)
 . i ln["PAGE NAME" d findReplace^%ts(.ln,"PAGE NAME",$$PNAME(type,""))
"RTN","SAMIUR",131,0)
 . i ln["CRITERIA" d findReplace^%ts(.ln,"CRITERIA",datephrase)
"RTN","SAMIUR",132,0)
 . i ln["@@REPORTTYPE@@" d findReplace^%ts(.ln,"@@REPORTTYPE@@",type)
"RTN","SAMIUR",133,0)
 . ;
"RTN","SAMIUR",134,0)
 . i ln["name=""start-date""" d findReplace^%ts(.ln,"start-date""","start-date"" value="""_$g(filter("start-date"))_"""")
"RTN","SAMIUR",135,0)
 . i ln["name=""end-date""" d findReplace^%ts(.ln,"end-date""","end-date"" value="""_$g(filter("end-date"))_"""")
"RTN","SAMIUR",136,0)
 . s SAMIRTN(cnt)=ln
"RTN","SAMIUR",137,0)
 . ;
"RTN","SAMIUR",138,0)
 n RPT,ik
"RTN","SAMIUR",139,0)
 d RPTTBL^SAMIUR2(.RPT,type) ; get the report specs
"RTN","SAMIUR",140,0)
 i '$d(RPT) d  q  ; don't know about this report
"RTN","SAMIUR",141,0)
 . d GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",142,0)
 ;
"RTN","SAMIUR",143,0)
 ; output the header
"RTN","SAMIUR",144,0)
 ;
"RTN","SAMIUR",145,0)
 s cnt=cnt+1 s SAMIRTN(cnt)="<thead><tr>"
"RTN","SAMIUR",146,0)
 s ir=""
"RTN","SAMIUR",147,0)
 f  s ir=$o(RPT(ir)) q:ir=""  d  ;
"RTN","SAMIUR",148,0)
 . s cnt=cnt+1
"RTN","SAMIUR",149,0)
 . s SAMIRTN(cnt)="<th>"_$g(RPT(ir,"header"))_"</th>"
"RTN","SAMIUR",150,0)
 s cnt=cnt+1 s SAMIRTN(cnt)="</tr></thead>"
"RTN","SAMIUR",151,0)
 ;
"RTN","SAMIUR",152,0)
 s cnt=cnt+1 s SAMIRTN(cnt)="<tbody>"
"RTN","SAMIUR",153,0)
 ;
"RTN","SAMIUR",154,0)
 i type'="worklist" d  ; 
"RTN","SAMIUR",155,0)
 . d NUHREF(.SAMIPATS) ; create the nuhref link for all patients
"RTN","SAMIUR",156,0)
 ;
"RTN","SAMIUR",157,0)
 n SRT
"RTN","SAMIUR",158,0)
 i $g(filter("sort"))="" s filter("sort")="name"
"RTN","SAMIUR",159,0)
 d SORT(.SRT,.SAMIPATS,.filter)
"RTN","SAMIUR",160,0)
 ;zwr SRT
"RTN","SAMIUR",161,0)
 ;
"RTN","SAMIUR",162,0)
 ;s ij=0
"RTN","SAMIUR",163,0)
 ;f  s ij=$o(SAMIPATS(ij)) q:+ij=0  d  ;
"RTN","SAMIUR",164,0)
 ;. n ij2 s ij2=0
"RTN","SAMIUR",165,0)
 ;. f  s ij2=$o(SAMIPATS(ij,ij2)) q:+ij2=0  d  ;
"RTN","SAMIUR",166,0)
 ;. . n dfn s dfn=ij2
"RTN","SAMIUR",167,0)
 n iz,ij,ij2,dfn,rows
"RTN","SAMIUR",168,0)
 s rows=0
"RTN","SAMIUR",169,0)
 s (iz,ij,ij2,dfn)=""
"RTN","SAMIUR",170,0)
 f  s iz=$o(SRT(iz)) q:iz=""  d  ;
"RTN","SAMIUR",171,0)
 . s ij=$o(SRT(iz,""))
"RTN","SAMIUR",172,0)
 . s dfn=$o(SRT(iz,ij,""))
"RTN","SAMIUR",173,0)
 . d  ;
"RTN","SAMIUR",174,0)
 . . s cnt=cnt+1 s SAMIRTN(cnt)="<tr>"
"RTN","SAMIUR",175,0)
 . . s ir=""
"RTN","SAMIUR",176,0)
 . . f  s ir=$o(RPT(ir)) q:ir=""  d  ;
"RTN","SAMIUR",177,0)
 . . . s cnt=cnt+1
"RTN","SAMIUR",178,0)
 . . . n XR,XRV
"RTN","SAMIUR",179,0)
 . . . ;s XR=$g(RPT(ir,"routine"))_"("_ij_",.SAMIPATS)"
"RTN","SAMIUR",180,0)
 . . . s XR="S XRV="_$g(RPT(ir,"routine"))_"("_ij_","_dfn_",.SAMIPATS)"
"RTN","SAMIUR",181,0)
 . . . ;s XRV=@XR
"RTN","SAMIUR",182,0)
 . . . X XR
"RTN","SAMIUR",183,0)
 . . . s SAMIRTN(cnt)="<td>"_$g(XRV)_"</td>"
"RTN","SAMIUR",184,0)
 . . ;
"RTN","SAMIUR",185,0)
 . . s cnt=cnt+1
"RTN","SAMIUR",186,0)
 . . s SAMIRTN(cnt)="</tr>"
"RTN","SAMIUR",187,0)
 . . s rows=rows+1
"RTN","SAMIUR",188,0)
 s cnt=cnt+1
"RTN","SAMIUR",189,0)
 s SAMIRTN(cnt)="<tr><td>Total: "_rows_"</td></tr>"
"RTN","SAMIUR",190,0)
 ;
"RTN","SAMIUR",191,0)
 s cnt=cnt+1 s SAMIRTN(cnt)="</tbody>"
"RTN","SAMIUR",192,0)
 f  s ii=$o(temp(ii)) q:temp(ii)["</tbody>"  d  ;
"RTN","SAMIUR",193,0)
 . ; skip past template headers and blank body
"RTN","SAMIUR",194,0)
 f  s ii=$o(temp(ii)) q:+ii=0  d  ;
"RTN","SAMIUR",195,0)
 . s cnt=cnt+1
"RTN","SAMIUR",196,0)
 . s ln=$g(temp(ii))
"RTN","SAMIUR",197,0)
 . n samikey,si
"RTN","SAMIUR",198,0)
 . s (samikey,si)=""
"RTN","SAMIUR",199,0)
 . d LOAD^SAMIFORM(.ln,samikey,si,.filter)
"RTN","SAMIUR",200,0)
 . s SAMIRTN(cnt)=ln
"RTN","SAMIUR",201,0)
 ;
"RTN","SAMIUR",202,0)
 quit  ; end of WSREPORT
"RTN","SAMIUR",203,0)
 ;
"RTN","SAMIUR",204,0)
 ;
"RTN","SAMIUR",205,0)
 ;
"RTN","SAMIUR",206,0)
SORT(SRTN,SAMIPATS,FILTER) ;
"RTN","SAMIUR",207,0)
 n typ s typ=$g(FILTER("sort"))
"RTN","SAMIUR",208,0)
 i typ="" s typ="name"
"RTN","SAMIUR",209,0)
 n iz,dt,dfn,nm
"RTN","SAMIUR",210,0)
 s (dt,dfn,nm)=""
"RTN","SAMIUR",211,0)
 s iz=0
"RTN","SAMIUR",212,0)
 n indx
"RTN","SAMIUR",213,0)
 f  s dt=$o(SAMIPATS(dt)) q:+dt=0  d  ;
"RTN","SAMIUR",214,0)
 . f  s dfn=$o(SAMIPATS(dt,dfn)) q:+dfn=0  d  ;
"RTN","SAMIUR",215,0)
 . . i typ="name" d  ;
"RTN","SAMIUR",216,0)
 . . . s nm=$g(SAMIPATS(dt,dfn,"name"))
"RTN","SAMIUR",217,0)
 . . . i nm="" s nm=" "
"RTN","SAMIUR",218,0)
 . . . s indx(nm,dt,dfn)=""
"RTN","SAMIUR",219,0)
 n iiz s iiz=""
"RTN","SAMIUR",220,0)
 s (dt,dfn)=""
"RTN","SAMIUR",221,0)
 f  s iiz=$o(indx(iiz)) q:iiz=""  d  ;
"RTN","SAMIUR",222,0)
 . f  s dt=$o(indx(iiz,dt)) q:dt=""  d  ;
"RTN","SAMIUR",223,0)
 . . f  s dfn=$o(indx(iiz,dt,dfn)) q:dfn=""  d  ;
"RTN","SAMIUR",224,0)
 . . . s iz=iz+1
"RTN","SAMIUR",225,0)
 . . . s SRTN(iz,dt,dfn)=iiz
"RTN","SAMIUR",226,0)
 ;
"RTN","SAMIUR",227,0)
 quit  ; end of SORT
"RTN","SAMIUR",228,0)
 ;
"RTN","SAMIUR",229,0)
 ;
"RTN","SAMIUR",230,0)
 ;
"RTN","SAMIUR",231,0)
NUHREF(SAMIPATS) ; create the nuhref link to casereview for all patients
"RTN","SAMIUR",232,0)
 n ij
"RTN","SAMIUR",233,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",234,0)
 s ij=0
"RTN","SAMIUR",235,0)
 f  s ij=$o(SAMIPATS(ij)) q:+ij=0  d  ;
"RTN","SAMIUR",236,0)
 . n ij2 s ij2=0
"RTN","SAMIUR",237,0)
 . f  s ij2=$o(SAMIPATS(ij,ij2)) q:+ij2=0  d  ;
"RTN","SAMIUR",238,0)
 . . n dfn s dfn=ij2
"RTN","SAMIUR",239,0)
 . . s SAMIPATS(ij,dfn,"sid")=$g(@root@(dfn,"samistudyid"))
"RTN","SAMIUR",240,0)
 . . n sid s sid=SAMIPATS(ij,dfn,"sid")
"RTN","SAMIUR",241,0)
 . . s SAMIPATS(ij,dfn,"name")=$g(@root@(dfn,"saminame"))
"RTN","SAMIUR",242,0)
 . . n name s name=SAMIPATS(ij,dfn,"name")
"RTN","SAMIUR",243,0)
 . . s SAMIPATS(ij,dfn,"ssn")=$$GETSSN^SAMIFORM(sid)
"RTN","SAMIUR",244,0)
 . . new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR",245,0)
 . . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""casereview"">"
"RTN","SAMIUR",246,0)
 . . set nuhref=nuhref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMIUR",247,0)
 . . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",248,0)
 . . s SAMIPATS(ij,dfn,"nuhref")=nuhref
"RTN","SAMIUR",249,0)
 ;
"RTN","SAMIUR",250,0)
 quit  ; end of NUHREF
"RTN","SAMIUR",251,0)
 ;
"RTN","SAMIUR",252,0)
 ;
"RTN","SAMIUR",253,0)
 ;
"RTN","SAMIUR",254,0)
SELECT(SAMIPATS,ztype,datephrase,filter) ;selects patients for report
"RTN","SAMIUR",255,0)
 ;
"RTN","SAMIUR",256,0)
 ;m ^gpl("select")=filter
"RTN","SAMIUR",257,0)
 n type s type=ztype
"RTN","SAMIUR",258,0)
 i type="unmatched" d  q  ;
"RTN","SAMIUR",259,0)
 . d UNMAT(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",260,0)
 i type="worklist" d  q  ;
"RTN","SAMIUR",261,0)
 . d WKLIST(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",262,0)
 i $g(type)="" s type="enrollment"
"RTN","SAMIUR",263,0)
 i type="cumpy" s type="enrollment"
"RTN","SAMIUR",264,0)
 n site s site=$g(filter("siteid"))
"RTN","SAMIUR",265,0)
 n strdt,enddt,fmstrdt,fmenddt
"RTN","SAMIUR",266,0)
 s strdt=$g(filter("start-date"))
"RTN","SAMIUR",267,0)
 s fmstrdt=$$KEY2FM^SAMICASE(strdt)
"RTN","SAMIUR",268,0)
 i fmstrdt=-1 d  ;
"RTN","SAMIUR",269,0)
 . s fmstrdt=2000101
"RTN","SAMIUR",270,0)
 . i type="followup" s fmstrdt=$$NOW^XLFDT
"RTN","SAMIUR",271,0)
 . i type="activity" s fmstrdt=$$FMADD^XLFDT($$NOW^XLFDT,-31)
"RTN","SAMIUR",272,0)
 i strdt="" s filter("start-date")=$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",273,0)
 s enddt=$g(filter("end-date"))
"RTN","SAMIUR",274,0)
 s fmenddt=$$KEY2FM^SAMICASE(enddt)
"RTN","SAMIUR",275,0)
 i fmenddt=-1 d  ;
"RTN","SAMIUR",276,0)
 . s fmenddt=$$NOW^XLFDT
"RTN","SAMIUR",277,0)
 . i type="followup" s fmenddt=$$FMADD^XLFDT($$NOW^XLFDT,31)
"RTN","SAMIUR",278,0)
 i enddt="" s filter("end-date")=$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",279,0)
 s datephrase=""
"RTN","SAMIUR",280,0)
 n zi s zi=0
"RTN","SAMIUR",281,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",282,0)
 ;
"RTN","SAMIUR",283,0)
 f  s zi=$o(@root@(zi)) q:+zi=0  d  ;
"RTN","SAMIUR",284,0)
 . n sid s sid=$g(@root@(zi,"samistudyid"))
"RTN","SAMIUR",285,0)
 . q:sid=""
"RTN","SAMIUR",286,0)
 . q:$e(sid,1,3)'=site
"RTN","SAMIUR",287,0)
 . n items s items=""
"RTN","SAMIUR",288,0)
 . d GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR",289,0)
 . q:'$d(items)
"RTN","SAMIUR",290,0)
 . n efmdate,edate,siform,ceform,cefud,fmcefud,cedos,fmcedos
"RTN","SAMIUR",291,0)
 . s siform=$o(items("siform-"))
"RTN","SAMIUR",292,0)
 . i $g(@root@("graph",sid,siform,"sistatus"))="inactive" q  ;
"RTN","SAMIUR",293,0)
 . s ceform=$o(items("ceform-a"),-1)
"RTN","SAMIUR",294,0)
 . s (cefud,fmcefud,cedos,fmcedos)=""
"RTN","SAMIUR",295,0)
 . i ceform'="" d  ;
"RTN","SAMIUR",296,0)
 . . s cefud=$g(@root@("graph",sid,ceform,"cefud"))
"RTN","SAMIUR",297,0)
 . . i cefud'="" s fmcefud=$$KEY2FM^SAMICASE(cefud)
"RTN","SAMIUR",298,0)
 . . s cedos=$g(@root@("graph",sid,ceform,"cedos"))
"RTN","SAMIUR",299,0)
 . . i cedos'="" s fmcedos=$$KEY2FM^SAMICASE(cedos)
"RTN","SAMIUR",300,0)
 . s edate=$g(@root@("graph",sid,siform,"sidc"))
"RTN","SAMIUR",301,0)
 . i edate="" s edate=$g(@root@("graph",sid,siform,"samicreatedate"))
"RTN","SAMIUR",302,0)
 . s efmdate=$$KEY2FM^SAMICASE(edate)
"RTN","SAMIUR",303,0)
 . s edate=$$VAPALSDT^SAMICASE(efmdate)
"RTN","SAMIUR",304,0)
 . ;
"RTN","SAMIUR",305,0)
 . i type="followup" d  ;
"RTN","SAMIUR",306,0)
 . . ;n nplus30 s nplus30=$$FMADD^XLFDT($$NOW^XLFDT,31)
"RTN","SAMIUR",307,0)
 . . i +fmcefud<fmstrdt q  ; before start date
"RTN","SAMIUR",308,0)
 . . i (+fmcefud<(fmenddt+1)) d  ; before end date
"RTN","SAMIUR",309,0)
 . . . i ceform="" q  ; no ct eval so no followup date
"RTN","SAMIUR",310,0)
 . . . s SAMIPATS(fmcefud,zi,"edate")=edate
"RTN","SAMIUR",311,0)
 . . . s SAMIPATS(fmcefud,zi)=""
"RTN","SAMIUR",312,0)
 . . . i ceform="" s cefud="baseline"
"RTN","SAMIUR",313,0)
 . . . s SAMIPATS(fmcefud,zi,"cefud")=cefud
"RTN","SAMIUR",314,0)
 . . . s SAMIPATS(fmcefud,zi,"cedos")=cedos
"RTN","SAMIUR",315,0)
 . . . s SAMIPATS(fmcefud,zi,"ceform")=ceform
"RTN","SAMIUR",316,0)
 . . . s SAMIPATS(fmcefud,zi,"ceform-vals")=$na(@root@("graph",sid,ceform))
"RTN","SAMIUR",317,0)
 . . . s SAMIPATS(fmcefud,zi,"siform")=siform
"RTN","SAMIUR",318,0)
 . . . s SAMIPATS(fmcefud,zi,"siform-vals")=$na(@root@("graph",sid,siform))
"RTN","SAMIUR",319,0)
 . . . m SAMIPATS(fmcefud,zi,"items")=items
"RTN","SAMIUR",320,0)
 . . s datephrase=" before "_$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",321,0)
 . . q
"RTN","SAMIUR",322,0)
 . i type="activity" d  ;
"RTN","SAMIUR",323,0)
 . . ;n nminus30 s nminus30=$$FMADD^XLFDT($$NOW^XLFDT,-31)
"RTN","SAMIUR",324,0)
 . . n anyform s anyform=$o(items("sort",""),-1)
"RTN","SAMIUR",325,0)
 . . n fmanyform s fmanyform=$$KEY2FM^SAMICASE(anyform)
"RTN","SAMIUR",326,0)
 . . i +fmanyform<fmstrdt q  ; before the start date
"RTN","SAMIUR",327,0)
 . . ;i (+fmanyform<(fmenddt+1))!(+efmdate>fmenddt) d  ; need any new form
"RTN","SAMIUR",328,0)
 . . i (+fmanyform<(fmenddt+1))  d  ;
"RTN","SAMIUR",329,0)
 . . . s SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",330,0)
 . . . s SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",331,0)
 . . . i ceform="" s cefud="baseline"
"RTN","SAMIUR",332,0)
 . . . s SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",333,0)
 . . . s SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",334,0)
 . . . s SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",335,0)
 . . . s SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",336,0)
 . . . m SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",337,0)
 . . s datephrase=" after "_$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",338,0)
 . ;
"RTN","SAMIUR",339,0)
 . ; date filter for all the rest of the reports
"RTN","SAMIUR",340,0)
 . ;
"RTN","SAMIUR",341,0)
 . i efmdate<fmstrdt q  ; before the start date
"RTN","SAMIUR",342,0)
 . i efmdate>(fmenddt+1) q  ; after the end date
"RTN","SAMIUR",343,0)
 . ;
"RTN","SAMIUR",344,0)
 . i type="incomplete" d  ;
"RTN","SAMIUR",345,0)
 . . n complete s complete=1
"RTN","SAMIUR",346,0)
 . . n zj s zj=""
"RTN","SAMIUR",347,0)
 . . n gr s gr=$na(@root@("graph",sid))
"RTN","SAMIUR",348,0)
 . . f  s zj=$o(@gr@(zj)) q:zj=""  d  ;
"RTN","SAMIUR",349,0)
 . . . i $g(@gr@(zj,"samistatus"))="incomplete" d  ;
"RTN","SAMIUR",350,0)
 . . . . s complete=0
"RTN","SAMIUR",351,0)
 . . . . s SAMIPATS(efmdate,zi,"iform")=$g(SAMIPATS(efmdate,zi,"iform"))_" "_zj
"RTN","SAMIUR",352,0)
 . . i complete=0 d  ; has incomplete form(s) 
"RTN","SAMIUR",353,0)
 . . . s SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",354,0)
 . . . s SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",355,0)
 . . . i ceform="" s cefud="baseline"
"RTN","SAMIUR",356,0)
 . . . s SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",357,0)
 . . . s SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",358,0)
 . . . s SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",359,0)
 . . . m SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",360,0)
 . . s datephrase=""
"RTN","SAMIUR",361,0)
 . . q
"RTN","SAMIUR",362,0)
 . i type="missingct" d  ;
"RTN","SAMIUR",363,0)
 . . i ceform="" d  ; has incomplete form(s) 
"RTN","SAMIUR",364,0)
 . . . s SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",365,0)
 . . . s SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",366,0)
 . . . i ceform="" s cefud="baseline"
"RTN","SAMIUR",367,0)
 . . . s SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",368,0)
 . . . s SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",369,0)
 . . . s SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",370,0)
 . . . m SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",371,0)
 . . s datephrase=""
"RTN","SAMIUR",372,0)
 . . q
"RTN","SAMIUR",373,0)
 . i type="outreach" d  ;
"RTN","SAMIUR",374,0)
 . . q
"RTN","SAMIUR",375,0)
 . i type="enrollment" d  ;
"RTN","SAMIUR",376,0)
 . . s SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",377,0)
 . . s SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",378,0)
 . . s SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",379,0)
 . . s SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",380,0)
 . . s SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",381,0)
 . . s SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",382,0)
 . . m SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",383,0)
 . s datephrase=" as of "_$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMIUR",384,0)
 ;
"RTN","SAMIUR",385,0)
 quit  ; end of SELECT
"RTN","SAMIUR",386,0)
 ;
"RTN","SAMIUR",387,0)
 ;
"RTN","SAMIUR",388,0)
 ;
"RTN","SAMIUR",389,0)
UNMAT(SAMIPATS,ztype,datephrase,filter) ;
"RTN","SAMIUR",390,0)
 ;
"RTN","SAMIUR",391,0)
 s datephrase="Unmatched Persons"
"RTN","SAMIUR",392,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",393,0)
 n dfn s dfn=9000000
"RTN","SAMIUR",394,0)
 f  s dfn=$o(@lroot@("dfn",dfn)) q:+dfn=0  d  ;
"RTN","SAMIUR",395,0)
 . n ien s ien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",396,0)
 . q:ien=""
"RTN","SAMIUR",397,0)
 . i $g(@lroot@(ien,"remotedfn"))'="" q  ;
"RTN","SAMIUR",398,0)
 . m SAMIPATS(ien,dfn)=@lroot@(ien)
"RTN","SAMIUR",399,0)
 . ;new name set name=$g(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR",400,0)
 . new name set name=$g(SAMIPATS(ien,dfn,"sinamef"))
"RTN","SAMIUR",401,0)
 . set name=name_","_SAMIPATS(ien,dfn,"sinamel")
"RTN","SAMIUR",402,0)
 . new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR",403,0)
 . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""editperson"">"
"RTN","SAMIUR",404,0)
 . set nuhref=nuhref_"<input type=hidden name=""dfn"" value="_dfn_">"
"RTN","SAMIUR",405,0)
 . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",406,0)
 . s SAMIPATS(ien,dfn,"editref")=nuhref
"RTN","SAMIUR",407,0)
 ;
"RTN","SAMIUR",408,0)
 quit  ; end of UNMAT
"RTN","SAMIUR",409,0)
 ;
"RTN","SAMIUR",410,0)
 ;
"RTN","SAMIUR",411,0)
 ;
"RTN","SAMIUR",412,0)
WKLIST(SAMIPATS,ztype,datephrase,filter) ;
"RTN","SAMIUR",413,0)
 ;
"RTN","SAMIUR",414,0)
 ; add site
"RTN","SAMIUR",415,0)
 ; add compare to vapals-patients
"RTN","SAMIUR",416,0)
 ; add navigation to enrollment
"RTN","SAMIUR",417,0)
 ;
"RTN","SAMIUR",418,0)
 k ^gpl("worklist")
"RTN","SAMIUR",419,0)
 m ^gpl("worklist")=filter
"RTN","SAMIUR",420,0)
 n site
"RTN","SAMIUR",421,0)
 s site=$g(filter("siteid"))
"RTN","SAMIUR",422,0)
 q:site=""
"RTN","SAMIUR",423,0)
 s datephrase="Work List"
"RTN","SAMIUR",424,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",425,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",426,0)
 n dfn s dfn=0
"RTN","SAMIUR",427,0)
 f  s dfn=$o(@lroot@("dfn",dfn)) q:+dfn=0  d  ;
"RTN","SAMIUR",428,0)
 . q:$o(@proot@("dfn",dfn,""))'=""
"RTN","SAMIUR",429,0)
 . n ien s ien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",430,0)
 . q:ien=""
"RTN","SAMIUR",431,0)
 . q:$g(@lroot@(ien,"siteid"))'=site
"RTN","SAMIUR",432,0)
 . m ^gpl("worklist","lroot",ien)=@lroot@(ien)
"RTN","SAMIUR",433,0)
 . m SAMIPATS(ien,dfn)=@lroot@(ien)
"RTN","SAMIUR",434,0)
 . new name set name=$g(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR",435,0)
 . ;new name set name=$g(SAMIPATS(ien,dfn,"sinamef"))
"RTN","SAMIUR",436,0)
 . ;set name=name_","_SAMIPATS(ien,dfn,"sinamel")
"RTN","SAMIUR",437,0)
 . new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR",438,0)
 . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""newcase"">"
"RTN","SAMIUR",439,0)
 . set nuhref=nuhref_"<input type=hidden name=""dfn"" value="_dfn_">"
"RTN","SAMIUR",440,0)
 . set nuhref=nuhref_"<input type=hidden name=""siteid"" value="_site_">"
"RTN","SAMIUR",441,0)
 . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",442,0)
 . s SAMIPATS(ien,dfn,"workref")=nuhref
"RTN","SAMIUR",443,0)
 m ^gpl("worklist","pats")=SAMIPATS
"RTN","SAMIUR",444,0)
 ;
"RTN","SAMIUR",445,0)
 quit  ; end of WKLIST
"RTN","SAMIUR",446,0)
 ;
"RTN","SAMIUR",447,0)
 ;
"RTN","SAMIUR",448,0)
 ;
"RTN","SAMIUR",449,0)
PNAME(type,phrase) ; extrinsic returns the PAGE NAME for the report
"RTN","SAMIUR",450,0)
 ;
"RTN","SAMIUR",451,0)
 ;i type="followup" q "Followup next 30 days -"_$g(phrase)
"RTN","SAMIUR",452,0)
 i type="followup" q "Followup "_$g(phrase)
"RTN","SAMIUR",453,0)
 ;i type="activity" q "Activity last 30 days -"_$g(phrase)
"RTN","SAMIUR",454,0)
 i type="activity" q "Activity "_$g(phrase)
"RTN","SAMIUR",455,0)
 i type="missingct" q "Intake but no CT Evaluation"_$g(phrase)
"RTN","SAMIUR",456,0)
 i type="incomplete" q "Incomplete Forms"_$g(phrase)
"RTN","SAMIUR",457,0)
 i type="outreach" q "Outreach"_$g(phrase)
"RTN","SAMIUR",458,0)
 i type="enrollment" q "Enrollment"_$g(phrase)
"RTN","SAMIUR",459,0)
 ;
"RTN","SAMIUR",460,0)
 quit "" ; end of $$PNAME
"RTN","SAMIUR",461,0)
 ;
"RTN","SAMIUR",462,0)
 ;
"RTN","SAMIUR",463,0)
 ;
"RTN","SAMIUR",464,0)
EOR ; end of SAMIUR
"VER")
8.0^22.2
**END**
**END**
