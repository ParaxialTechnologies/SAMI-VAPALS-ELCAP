KIDS Distribution saved on Oct 25, 2021@12:29:26
Released SAMI*18.0*14 SEQ #14 (sami-18-14)
**KIDS**:SAMI*18.0*14^

**INSTALL NAME**
SAMI*18.0*14
"BLD",11514,0)
SAMI*18.0*14^^0^3211015^n
"BLD",11514,1,0)
^^1^1^3210910^^
"BLD",11514,1,1,0)
Released SAMI*18.0*14 SEQ #14 (sami-18-14)
"BLD",11514,4,0)
^9.64PA^^
"BLD",11514,6.3)
8
"BLD",11514,"INID")
^n
"BLD",11514,"INIT")
POS1814^SAMIPAT
"BLD",11514,"KRN",0)
^9.67PA^1.5^25
"BLD",11514,"KRN",.4,0)
.4
"BLD",11514,"KRN",.401,0)
.401
"BLD",11514,"KRN",.402,0)
.402
"BLD",11514,"KRN",.403,0)
.403
"BLD",11514,"KRN",.5,0)
.5
"BLD",11514,"KRN",.84,0)
.84
"BLD",11514,"KRN",1.5,0)
1.5
"BLD",11514,"KRN",1.6,0)
1.6
"BLD",11514,"KRN",1.61,0)
1.61
"BLD",11514,"KRN",1.62,0)
1.62
"BLD",11514,"KRN",3.6,0)
3.6
"BLD",11514,"KRN",3.8,0)
3.8
"BLD",11514,"KRN",9.2,0)
9.2
"BLD",11514,"KRN",9.8,0)
9.8
"BLD",11514,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",11514,"KRN",9.8,"NM",1,0)
SAMIUR^^0^B655626702
"BLD",11514,"KRN",9.8,"NM",2,0)
SAMIUR2^^0^B1360826675
"BLD",11514,"KRN",9.8,"NM",3,0)
SAMIURUL^^0^B104949
"BLD",11514,"KRN",9.8,"NM",4,0)
SAMIPAT^^0^B9183353
"BLD",11514,"KRN",9.8,"NM",5,0)
SAMICAS2^^0^B447463890
"BLD",11514,"KRN",9.8,"NM",6,0)
SAMICUL^^0^B135148
"BLD",11514,"KRN",9.8,"NM",7,0)
SAMISITE^^0^B95807248
"BLD",11514,"KRN",9.8,"NM","B","SAMICAS2",5)

"BLD",11514,"KRN",9.8,"NM","B","SAMICUL",6)

"BLD",11514,"KRN",9.8,"NM","B","SAMIPAT",4)

"BLD",11514,"KRN",9.8,"NM","B","SAMISITE",7)

"BLD",11514,"KRN",9.8,"NM","B","SAMIUR",1)

"BLD",11514,"KRN",9.8,"NM","B","SAMIUR2",2)

"BLD",11514,"KRN",9.8,"NM","B","SAMIURUL",3)

"BLD",11514,"KRN",19,0)
19
"BLD",11514,"KRN",19.1,0)
19.1
"BLD",11514,"KRN",101,0)
101
"BLD",11514,"KRN",409.61,0)
409.61
"BLD",11514,"KRN",771,0)
771
"BLD",11514,"KRN",779.2,0)
779.2
"BLD",11514,"KRN",870,0)
870
"BLD",11514,"KRN",8989.51,0)
8989.51
"BLD",11514,"KRN",8989.52,0)
8989.52
"BLD",11514,"KRN",8993,0)
8993
"BLD",11514,"KRN",8994,0)
8994
"BLD",11514,"KRN","B",.4,.4)

"BLD",11514,"KRN","B",.401,.401)

"BLD",11514,"KRN","B",.402,.402)

"BLD",11514,"KRN","B",.403,.403)

"BLD",11514,"KRN","B",.5,.5)

"BLD",11514,"KRN","B",.84,.84)

"BLD",11514,"KRN","B",1.5,1.5)

"BLD",11514,"KRN","B",1.6,1.6)

"BLD",11514,"KRN","B",1.61,1.61)

"BLD",11514,"KRN","B",1.62,1.62)

"BLD",11514,"KRN","B",3.6,3.6)

"BLD",11514,"KRN","B",3.8,3.8)

"BLD",11514,"KRN","B",9.2,9.2)

"BLD",11514,"KRN","B",9.8,9.8)

"BLD",11514,"KRN","B",19,19)

"BLD",11514,"KRN","B",19.1,19.1)

"BLD",11514,"KRN","B",101,101)

"BLD",11514,"KRN","B",409.61,409.61)

"BLD",11514,"KRN","B",771,771)

"BLD",11514,"KRN","B",779.2,779.2)

"BLD",11514,"KRN","B",870,870)

"BLD",11514,"KRN","B",8989.51,8989.51)

"BLD",11514,"KRN","B",8989.52,8989.52)

"BLD",11514,"KRN","B",8993,8993)

"BLD",11514,"KRN","B",8994,8994)

"BLD",11514,"QUES",0)
^9.62^^
"BLD",11514,"REQB",0)
^9.611^12^12
"BLD",11514,"REQB",1,0)
SAMI*18.0*1^0
"BLD",11514,"REQB",2,0)
SAMI*18.0*2^0
"BLD",11514,"REQB",3,0)
SAMI*18.0*3^0
"BLD",11514,"REQB",4,0)
SAMI*18.0*4^0
"BLD",11514,"REQB",5,0)
SAMI 18.0T05^0
"BLD",11514,"REQB",6,0)
SAMI*18.0*6^0
"BLD",11514,"REQB",7,0)
SAMI*18.0*8^0
"BLD",11514,"REQB",8,0)
SAMI*18.0*9^0
"BLD",11514,"REQB",9,0)
SAMI*18.0*10^0
"BLD",11514,"REQB",10,0)
SAMI*18.0*11^0
"BLD",11514,"REQB",11,0)
SAMI*18.0*12^0
"BLD",11514,"REQB",12,0)
SAMI*18.0*13^0
"BLD",11514,"REQB","B","SAMI 18.0T05",5)

"BLD",11514,"REQB","B","SAMI*18.0*1",1)

"BLD",11514,"REQB","B","SAMI*18.0*10",9)

"BLD",11514,"REQB","B","SAMI*18.0*11",10)

"BLD",11514,"REQB","B","SAMI*18.0*12",11)

"BLD",11514,"REQB","B","SAMI*18.0*13",12)

"BLD",11514,"REQB","B","SAMI*18.0*2",2)

"BLD",11514,"REQB","B","SAMI*18.0*3",3)

"BLD",11514,"REQB","B","SAMI*18.0*4",4)

"BLD",11514,"REQB","B","SAMI*18.0*6",6)

"BLD",11514,"REQB","B","SAMI*18.0*8",7)

"BLD",11514,"REQB","B","SAMI*18.0*9",8)

"INIT")
POS1814^SAMIPAT
"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","SAMICAS2")
0^5^B447463890
"RTN","SAMICAS2",1,0)
SAMICAS2 ;ven/gpl - case review cont ;2021-10-05t23:14z
"RTN","SAMICAS2",2,0)
 ;;18.0;SAMI;**1,5,9,12,14**;2020-01;Build 8
"RTN","SAMICAS2",3,0)
 ;;18.14
"RTN","SAMICAS2",4,0)
 ;
"RTN","SAMICAS2",5,0)
 ; SAMICAS2 contains ppis and other subroutines to support processing
"RTN","SAMICAS2",6,0)
 ; of the VAPALS case review page.
"RTN","SAMICAS2",7,0)
 ;
"RTN","SAMICAS2",8,0)
 quit  ; no entry from top
"RTN","SAMICAS2",9,0)
 ;
"RTN","SAMICAS2",10,0)
 ;
"RTN","SAMICAS2",11,0)
 ;
"RTN","SAMICAS2",12,0)
 ;@section 0 primary development
"RTN","SAMICAS2",13,0)
 ;
"RTN","SAMICAS2",14,0)
 ;
"RTN","SAMICAS2",15,0)
 ;
"RTN","SAMICAS2",16,0)
 ;@routine-credits
"RTN","SAMICAS2",17,0)
 ;@license see routine SAMIUL
"RTN","SAMICAS2",18,0)
 ;@documentation see SAMICUL
"RTN","SAMICAS2",19,0)
 ;@contents
"RTN","SAMICAS2",20,0)
 ; WSCASE wri-code WSCASE^SAMICASE, post vapals casereview:
"RTN","SAMICAS2",21,0)
 ;  generate case review page
"RTN","SAMICAS2",22,0)
 ; $$NOTEHREF ppi-code $$NOTEHREF^SAMICASE, 
"RTN","SAMICAS2",23,0)
 ;  html list of notes for form
"RTN","SAMICAS2",24,0)
 ; GETTMPL ppi-code GETTMPL^SAMICASE, get html template
"RTN","SAMICAS2",25,0)
 ; $$CNTITEMS = # forms patient has used before deleting patient
"RTN","SAMICAS2",26,0)
 ; GETITEMS ppi-code GETITEMS^SAMICASE
"RTN","SAMICAS2",27,0)
 ;  get items available for studyid
"RTN","SAMICAS2",28,0)
 ; $$GETDTKEY date part of form key
"RTN","SAMICAS2",29,0)
 ; $$KEY2DSPD date in elcap format from key date
"RTN","SAMICAS2",30,0)
 ; $$VAPALSDT ppi-code $$VAPALSDT^SAMICASE, vapals format for dates
"RTN","SAMICAS2",31,0)
 ;
"RTN","SAMICAS2",32,0)
 ; WSNUFORM wri-code WSNUFORM^SAMICASE, post vapals nuform:
"RTN","SAMICAS2",33,0)
 ;  new form for patient
"RTN","SAMICAS2",34,0)
 ; $$KEY2FM ppi-code $$KEY2FM^SAMICASE, convert key to fileman date
"RTN","SAMICAS2",35,0)
 ;
"RTN","SAMICAS2",36,0)
 ; $$GSAMISTA value of 'samistatus' from form
"RTN","SAMICAS2",37,0)
 ; SSAMISTA ppi-code SSAMISTA^SAMICASE, set samistatus to val in form
"RTN","SAMICAS2",38,0)
 ; DELFORM wri-code DELFORM^SAMICASE, post vapals deleteform:
"RTN","SAMICAS2",39,0)
 ;  delete incomplete form
"RTN","SAMICAS2",40,0)
 ; INITSTAT set all forms to 'incomplete'
"RTN","SAMICAS2",41,0)
 ;
"RTN","SAMICAS2",42,0)
 ;
"RTN","SAMICAS2",43,0)
 ;
"RTN","SAMICAS2",44,0)
 ;@section 1 wsCASE & related ppis
"RTN","SAMICAS2",45,0)
 ;
"RTN","SAMICAS2",46,0)
 ;
"RTN","SAMICAS2",47,0)
 ;
"RTN","SAMICAS2",48,0)
 ;@wri-code WSCASE^SAMICASE
"RTN","SAMICAS2",49,0)
WSCASE ; post vapals casereview: generate case review page
"RTN","SAMICAS2",50,0)
 ;
"RTN","SAMICAS2",51,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",52,0)
 ;
"RTN","SAMICAS2",53,0)
 ;ven/gpl;wri;procedure;silent;clean;sac;??% tests
"RTN","SAMICAS2",54,0)
 ;@signature
"RTN","SAMICAS2",55,0)
 ; do WSCASE^SAMICASE(rtn,filter)
"RTN","SAMICAS2",56,0)
 ;@branches-from
"RTN","SAMICAS2",57,0)
 ; WSCASE^SAMICASE
"RTN","SAMICAS2",58,0)
 ;@wri-called-by
"RTN","SAMICAS2",59,0)
 ; wsPostForm^%wfhform
"RTN","SAMICAS2",60,0)
 ; DELFORM^SAMICASE
"RTN","SAMICAS2",61,0)
 ; WSNFPOST^SAMICASE
"RTN","SAMICAS2",62,0)
 ; WSVAPALS^SAMIHOM3 [wsi for ws post vapals]
"RTN","SAMICAS2",63,0)
 ; WSLOOKUP^SAMISRC2
"RTN","SAMICAS2",64,0)
 ; wsPostForm^SAMIZ2
"RTN","SAMICAS2",65,0)
 ;@called-by none
"RTN","SAMICAS2",66,0)
 ;@calls
"RTN","SAMICAS2",67,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",68,0)
 ; GETTMPL^SAMICASE
"RTN","SAMICAS2",69,0)
 ; GETITEMS^SAMICASE
"RTN","SAMICAS2",70,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS2",71,0)
 ; findReplace^%ts
"RTN","SAMICAS2",72,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMICAS2",73,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMICAS2",74,0)
 ; $$GETDTKEY
"RTN","SAMICAS2",75,0)
 ; $$KEY2DSPD
"RTN","SAMICAS2",76,0)
 ; $$GETLAST5^SAMIFORM
"RTN","SAMICAS2",77,0)
 ; $$GETSSN^SAMIFORM
"RTN","SAMICAS2",78,0)
 ; $$GETNAME^SAMIFORM
"RTN","SAMICAS2",79,0)
 ; $$GSAMISTA
"RTN","SAMICAS2",80,0)
 ; D ADDCRLF^VPRJRUT
"RTN","SAMICAS2",81,0)
 ;@input
"RTN","SAMICAS2",82,0)
 ; .filter =
"RTN","SAMICAS2",83,0)
 ; .filter("studyid")=studyid of the patient
"RTN","SAMICAS2",84,0)
 ;@output
"RTN","SAMICAS2",85,0)
 ; .rtn
"RTN","SAMICAS2",86,0)
 ;@tests
"RTN","SAMICAS2",87,0)
 ; UTWSCAS^SAMIUTS2
"RTN","SAMICAS2",88,0)
 ;
"RTN","SAMICAS2",89,0)
 ;
"RTN","SAMICAS2",90,0)
 ;@stanza 2 initialize
"RTN","SAMICAS2",91,0)
 ;
"RTN","SAMICAS2",92,0)
 kill rtn
"RTN","SAMICAS2",93,0)
 ;
"RTN","SAMICAS2",94,0)
 new groot set groot=$$setroot^%wd("vapals-patients") ; root of patient graphs
"RTN","SAMICAS2",95,0)
 ;
"RTN","SAMICAS2",96,0)
 new temp ; html template
"RTN","SAMICAS2",97,0)
 do GETTMPL^SAMICASE("temp","vapals:casereview")
"RTN","SAMICAS2",98,0)
 quit:'$data(temp)
"RTN","SAMICAS2",99,0)
 ;
"RTN","SAMICAS2",100,0)
 new sid set sid=$get(filter("studyid"))
"RTN","SAMICAS2",101,0)
 if sid="" set sid=$get(filter("studyId"))
"RTN","SAMICAS2",102,0)
 if sid="" set sid=$get(filter("fvalue"))
"RTN","SAMICAS2",103,0)
 quit:sid=""
"RTN","SAMICAS2",104,0)
 ;
"RTN","SAMICAS2",105,0)
 new items
"RTN","SAMICAS2",106,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMICAS2",107,0)
 quit:'$data(items)
"RTN","SAMICAS2",108,0)
 ;
"RTN","SAMICAS2",109,0)
 new gien set gien=$$SID2NUM^SAMIHOM3(sid) ; graph ien
"RTN","SAMICAS2",110,0)
 new name set name=$get(@groot@(gien,"saminame"))
"RTN","SAMICAS2",111,0)
 quit:name=""
"RTN","SAMICAS2",112,0)
 new fname set fname=$piece(name,",",2)
"RTN","SAMICAS2",113,0)
 new lname set lname=$piece(name,",")
"RTN","SAMICAS2",114,0)
 ;
"RTN","SAMICAS2",115,0)
 ;
"RTN","SAMICAS2",116,0)
 ;@stanza 3 change resource paths to /see/
"RTN","SAMICAS2",117,0)
 ;
"RTN","SAMICAS2",118,0)
 new cnt set cnt=0
"RTN","SAMICAS2",119,0)
 new zi set zi=0
"RTN","SAMICAS2",120,0)
 ;for  set zi=$order(temp(zi)) quit:+zi=0  quit:temp(zi)["VEP0001"  do  ;
"RTN","SAMICAS2",121,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  quit:temp(zi)["tbody"  do  ;
"RTN","SAMICAS2",122,0)
 . new ln set ln=temp(zi)
"RTN","SAMICAS2",123,0)
 . new touched set touched=0
"RTN","SAMICAS2",124,0)
 . ;
"RTN","SAMICAS2",125,0)
 . if ln["@@SITE@@" do  ; insert site id
"RTN","SAMICAS2",126,0)
 . . n siteid s siteid=$g(filter("siteid"))
"RTN","SAMICAS2",127,0)
 . . i siteid="" s siteid=$g(filter("site"))
"RTN","SAMICAS2",128,0)
 . . q:siteid=""
"RTN","SAMICAS2",129,0)
 . . do findReplace^%ts(.ln,"@@SITE@@",siteid)
"RTN","SAMICAS2",130,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",131,0)
 . ;
"RTN","SAMICAS2",132,0)
 . if ln["@@SITETITLE@@" do  ; insert site title
"RTN","SAMICAS2",133,0)
 . . n sitetit s sitetit=$g(filter("sitetitle"))
"RTN","SAMICAS2",134,0)
 . . if sitetit="" d  ;
"RTN","SAMICAS2",135,0)
 . . . n tsite s tsite=$g(filter("site"))
"RTN","SAMICAS2",136,0)
 . . . q:tsite=""
"RTN","SAMICAS2",137,0)
 . . . s sitetit=$$SITENM2^SAMISITE(tsite)_" - "_tsite
"RTN","SAMICAS2",138,0)
 . . q:sitetit=""
"RTN","SAMICAS2",139,0)
 . . do findReplace^%ts(.ln,"@@SITETITLE@@",sitetit)
"RTN","SAMICAS2",140,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",141,0)
 . ;
"RTN","SAMICAS2",142,0)
 . if ln["id" if ln["studyIdMenu" do  ;
"RTN","SAMICAS2",143,0)
 . . set zi=zi+4
"RTN","SAMICAS2",144,0)
 . ;
"RTN","SAMICAS2",145,0)
 . if ln["home.html" do  ;
"RTN","SAMICAS2",146,0)
 . . do findReplace^%ts(.ln,"home.html","/vapals")
"RTN","SAMICAS2",147,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",148,0)
 . . set touched=1
"RTN","SAMICAS2",149,0)
 . ;
"RTN","SAMICAS2",150,0)
 . if ln["href" if 'touched do  ;
"RTN","SAMICAS2",151,0)
 . . do FIXHREF^SAMIFORM(.ln)
"RTN","SAMICAS2",152,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",153,0)
 . ;
"RTN","SAMICAS2",154,0)
 . if ln["src" do  ;
"RTN","SAMICAS2",155,0)
 . . do FIXSRC^SAMIFORM(.ln)
"RTN","SAMICAS2",156,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",157,0)
 . ;
"RTN","SAMICAS2",158,0)
 . if ln["@@ERROR_MESSAGE@@" do  ; insert error message
"RTN","SAMICAS2",159,0)
 . . n zerr s zerr=$g(filter("errorMessage"))
"RTN","SAMICAS2",160,0)
 . . i zerr="" q  ;
"RTN","SAMICAS2",161,0)
 . . do findReplace^%ts(.ln,"@@ERROR_MESSAGE@@",zerr)
"RTN","SAMICAS2",162,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",163,0)
 . ;
"RTN","SAMICAS2",164,0)
 . set cnt=cnt+1
"RTN","SAMICAS2",165,0)
 . set rtn(cnt)=temp(zi)
"RTN","SAMICAS2",166,0)
 . quit
"RTN","SAMICAS2",167,0)
 ;
"RTN","SAMICAS2",168,0)
 ; ready to insert rows for selection
"RTN","SAMICAS2",169,0)
 ;
"RTN","SAMICAS2",170,0)
 ;
"RTN","SAMICAS2",171,0)
 ;@stanza 4 intake form
"RTN","SAMICAS2",172,0)
 ;
"RTN","SAMICAS2",173,0)
 new sikey set sikey=$order(items("sifor"))
"RTN","SAMICAS2",174,0)
 if sikey="" set sikey="siform-2017-12-10"
"RTN","SAMICAS2",175,0)
 new sidate set sidate=$$GETDTKEY(sikey)
"RTN","SAMICAS2",176,0)
 set sikey="vapals:"_sikey
"RTN","SAMICAS2",177,0)
 new sidispdate set sidispdate=$$KEY2DSPD(sidate)
"RTN","SAMICAS2",178,0)
 ;new geturl set geturl="/form?form=vapals:siform&studyid="_sid_"&key="_sikey
"RTN","SAMICAS2",179,0)
 new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMICAS2",180,0)
 set nuhref=nuhref_"<td><input type=hidden name=""samiroute"" value=""nuform"">"
"RTN","SAMICAS2",181,0)
 set nuhref=nuhref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMICAS2",182,0)
 set nuhref=nuhref_"<input value=""New Form"" class=""btn label label-warning"" role=""link"" type=""submit""></form></td>"
"RTN","SAMICAS2",183,0)
 ; new intake notes table
"RTN","SAMICAS2",184,0)
 n notehref,form
"RTN","SAMICAS2",185,0)
 set form=$p(sikey,":",2)
"RTN","SAMICAS2",186,0)
 set notehref=$$NOTEHREF^SAMICASE(sid,form) ; table of notes
"RTN","SAMICAS2",187,0)
 set cnt=cnt+1
"RTN","SAMICAS2",188,0)
 ;new facilitycode set facilitycode=$$GETPRFX^SAMIFORM()
"RTN","SAMICAS2",189,0)
 n siteid s siteid=$g(filter("siteid"))
"RTN","SAMICAS2",190,0)
 i siteid="" s siteid=$g(filter("site"))
"RTN","SAMICAS2",191,0)
 new facilitycode set facilitycode=siteid
"RTN","SAMICAS2",192,0)
 new last5 set last5=$$GETLAST5^SAMIFORM(sid)
"RTN","SAMICAS2",193,0)
 new pssn set pssn=$$GETSSN^SAMIFORM(sid)
"RTN","SAMICAS2",194,0)
 new pname set pname=$$GETNAME^SAMIFORM(sid)
"RTN","SAMICAS2",195,0)
 new useid set useid=pssn
"RTN","SAMICAS2",196,0)
 if useid="" set useid=last5
"RTN","SAMICAS2",197,0)
 set rtn(cnt)="<tr><td> "_useid_" </td><td> "_pname_" </td><td> "_facilitycode_" </td><td>"_sidispdate_"</td><td>"_$char(13)
"RTN","SAMICAS2",198,0)
 set cnt=cnt+1
"RTN","SAMICAS2",199,0)
 set rtn(cnt)="<form method=""post"" action=""/vapals"">"
"RTN","SAMICAS2",200,0)
 set cnt=cnt+1
"RTN","SAMICAS2",201,0)
 set rtn(cnt)="<input name=""samiroute"" value=""form"" type=""hidden"">"
"RTN","SAMICAS2",202,0)
 set rtn(cnt)=rtn(cnt)_" <input name=""studyid"" value="""_sid_""" type=""hidden"">"
"RTN","SAMICAS2",203,0)
 set rtn(cnt)=rtn(cnt)_" <input name=""form"" value="""_sikey_""" type=""hidden"">"
"RTN","SAMICAS2",204,0)
 set rtn(cnt)=rtn(cnt)_" <input value=""Intake"" class=""btn btn-link"" role=""link"" type=""submit"">"
"RTN","SAMICAS2",205,0)
 ;
"RTN","SAMICAS2",206,0)
 new samistatus set samistatus=""
"RTN","SAMICAS2",207,0)
 if $$GSAMISTA(sid,sikey)="incomplete" set samistatus="(incomplete)"
"RTN","SAMICAS2",208,0)
 set cnt=cnt+1
"RTN","SAMICAS2",209,0)
 set rtn(cnt)="</form>"_samistatus_notehref_"</td>"_$char(13)
"RTN","SAMICAS2",210,0)
 set cnt=cnt+1
"RTN","SAMICAS2",211,0)
 set rtn(cnt)=nuhref_"</tr>"
"RTN","SAMICAS2",212,0)
 ;
"RTN","SAMICAS2",213,0)
 ;
"RTN","SAMICAS2",214,0)
 ;@stanza 6 rest of the forms
"RTN","SAMICAS2",215,0)
 ;
"RTN","SAMICAS2",216,0)
 new zj set zj="" ; each of the rest of the forms
"RTN","SAMICAS2",217,0)
 if $data(items("sort")) do  ; we have more forms
"RTN","SAMICAS2",218,0)
 . for  set zj=$order(items("sort",zj)) quit:zj=""  do  ;
"RTN","SAMICAS2",219,0)
 . . new cdate set cdate=zj
"RTN","SAMICAS2",220,0)
 . . new zk set zk=""
"RTN","SAMICAS2",221,0)
 . . for  set zk=$order(items("sort",cdate,zk)) q:zk=""  do  ;
"RTN","SAMICAS2",222,0)
 . . . new zform set zform=zk
"RTN","SAMICAS2",223,0)
 . . . new zkey set zkey=$order(items("sort",cdate,zform,""))
"RTN","SAMICAS2",224,0)
 . . . new zname set zname=$order(items("sort",cdate,zform,zkey,""))
"RTN","SAMICAS2",225,0)
 . . . new dispdate set dispdate=$$KEY2DSPD(cdate)
"RTN","SAMICAS2",226,0)
 . . . set zform="vapals:"_zkey ; all the new forms are vapals:key
"RTN","SAMICAS2",227,0)
 . . . ;new geturl set geturl="/form?form="_zform_"&studyid="_sid_"&key="_zkey
"RTN","SAMICAS2",228,0)
 . . . set cnt=cnt+1
"RTN","SAMICAS2",229,0)
 . . . ;set rtn(cnt)="<tr><td> "_sid_" </td><td> - </td><td> - </td><td> - </td><td>"_dispdate_"</td><td>"
"RTN","SAMICAS2",230,0)
 . . . set rtn(cnt)="<tr><td> "_useid_" </td><td> - </td><td> - </td><td>"_dispdate_"</td><td>"
"RTN","SAMICAS2",231,0)
 . . . set cnt=cnt+1
"RTN","SAMICAS2",232,0)
 . . . set rtn(cnt)="<form method=""post"" action=""/vapals"">"_$char(13)
"RTN","SAMICAS2",233,0)
 . . . set cnt=cnt+1
"RTN","SAMICAS2",234,0)
 . . . set rtn(cnt)="<input name=""samiroute"" value=""form"" type=""hidden"">"_$char(13)
"RTN","SAMICAS2",235,0)
 . . . set cnt=cnt+1
"RTN","SAMICAS2",236,0)
 . . . set rtn(cnt)=" <input name=""studyid"" value="""_sid_""" type=""hidden"">"_$char(13)
"RTN","SAMICAS2",237,0)
 . . . set cnt=cnt+1
"RTN","SAMICAS2",238,0)
 . . . set rtn(cnt)=" <input name=""form"" value="""_zform_""" type=""hidden"">"_$char(13)
"RTN","SAMICAS2",239,0)
 . . . set cnt=cnt+1
"RTN","SAMICAS2",240,0)
 . . . set rtn(cnt)=" <input value="""_zname_""" class=""btn btn-link"" role=""link"" type=""submit"">"_$char(13)
"RTN","SAMICAS2",241,0)
 . . . ;
"RTN","SAMICAS2",242,0)
 . . . new samistatus set samistatus=""
"RTN","SAMICAS2",243,0)
 . . . if $$GSAMISTA(sid,zform)="incomplete" set samistatus="(incomplete)"
"RTN","SAMICAS2",244,0)
 . . . set cnt=cnt+1
"RTN","SAMICAS2",245,0)
 . . . set rtn(cnt)="</form>"_samistatus_$$NOTEHREF^SAMICASE(sid,zkey)_"</td>"
"RTN","SAMICAS2",246,0)
 . . . set cnt=cnt+1
"RTN","SAMICAS2",247,0)
 . . . if zform["ceform" do  ;
"RTN","SAMICAS2",248,0)
 . . . . new rpthref set rpthref="<form method=POST action=""/vapals"">"
"RTN","SAMICAS2",249,0)
 . . . . set rpthref=rpthref_"<td><input type=hidden name=""samiroute"" value=""ctreport"">"
"RTN","SAMICAS2",250,0)
 . . . . set rpthref=rpthref_"<input type=hidden name=""form"" value="_$p(zform,":",2)_">"
"RTN","SAMICAS2",251,0)
 . . . . set rpthref=rpthref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMICAS2",252,0)
 . . . . set rpthref=rpthref_"<input value=""Report"" class=""btn label label-warning"" role=""link"" type=""submit""></form></td>"
"RTN","SAMICAS2",253,0)
 . . . . set rtn(cnt)=rpthref_"</tr>"
"RTN","SAMICAS2",254,0)
 . . . . ;set rtn(cnt)="</tr>" ; turn off report
"RTN","SAMICAS2",255,0)
 . . . else  set rtn(cnt)="<td></td></tr>"
"RTN","SAMICAS2",256,0)
 . . . quit
"RTN","SAMICAS2",257,0)
 . . quit
"RTN","SAMICAS2",258,0)
 . quit
"RTN","SAMICAS2",259,0)
 ;
"RTN","SAMICAS2",260,0)
 ;
"RTN","SAMICAS2",261,0)
 ;@stanza 7 skip ahead in template to tbody
"RTN","SAMICAS2",262,0)
 ;
"RTN","SAMICAS2",263,0)
 new loc set loc=zi+1
"RTN","SAMICAS2",264,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  quit:temp(zi)["/tbody"  do  ;
"RTN","SAMICAS2",265,0)
 . set x=$get(x)
"RTN","SAMICAS2",266,0)
 . quit
"RTN","SAMICAS2",267,0)
 set zi=zi-1
"RTN","SAMICAS2",268,0)
 ;
"RTN","SAMICAS2",269,0)
 ;
"RTN","SAMICAS2",270,0)
 ;@stanza 8 rest of lines
"RTN","SAMICAS2",271,0)
 ;
"RTN","SAMICAS2",272,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  do  ;
"RTN","SAMICAS2",273,0)
 . new line
"RTN","SAMICAS2",274,0)
 . set line=temp(zi)
"RTN","SAMICAS2",275,0)
 . ;
"RTN","SAMICAS2",276,0)
 . if line["@@SITE@@" do  ; insert site id
"RTN","SAMICAS2",277,0)
 . . n siteid s siteid=$g(filter("siteid"))
"RTN","SAMICAS2",278,0)
 . . i siteid="" s siteid=$g(filter("site"))
"RTN","SAMICAS2",279,0)
 . . q:siteid=""
"RTN","SAMICAS2",280,0)
 . . do findReplace^%ts(.line,"@@SITE@@",siteid)
"RTN","SAMICAS2",281,0)
 . ;
"RTN","SAMICAS2",282,0)
 . if line["@@SITETITLE@@" do  ; insert site title
"RTN","SAMICAS2",283,0)
 . . n sitetit s sitetit=$g(filter("sitetitle"))
"RTN","SAMICAS2",284,0)
 . . if sitetit="" d  ;
"RTN","SAMICAS2",285,0)
 . . . n tsite s tsite=$g(filter("site"))
"RTN","SAMICAS2",286,0)
 . . . q:tsite=""
"RTN","SAMICAS2",287,0)
 . . . s sitetit=$$SITENM2^SAMISITE(tsite)_" - "_tsite
"RTN","SAMICAS2",288,0)
 . . q:sitetit=""
"RTN","SAMICAS2",289,0)
 . . do findReplace^%ts(.line,"@@SITETITLE@@",sitetit)
"RTN","SAMICAS2",290,0)
 . ;
"RTN","SAMICAS2",291,0)
 . if line["XX0002" do  ;
"RTN","SAMICAS2",292,0)
 . . do findReplace^%ts(.line,"XX0002",sid)
"RTN","SAMICAS2",293,0)
 . ;
"RTN","SAMICAS2",294,0)
 . if line["@@ERROR_MESSAGE@@" do  ;
"RTN","SAMICAS2",295,0)
 . . n zerr
"RTN","SAMICAS2",296,0)
 . . k ^gpl("error")
"RTN","SAMICAS2",297,0)
 . . m ^gpl("error")=filter
"RTN","SAMICAS2",298,0)
 . . s zerr=$g(filter("errorMessage"))
"RTN","SAMICAS2",299,0)
 . . ;i err="" q  ;
"RTN","SAMICAS2",300,0)
 . . s ^gpl("error","zerr")=zerr
"RTN","SAMICAS2",301,0)
 . . do findReplace^%ts(.line,"@@ERROR_MESSAGE@@",zerr)
"RTN","SAMICAS2",302,0)
 . . s ^gpl("error","newline")=line
"RTN","SAMICAS2",303,0)
 . set cnt=cnt+1
"RTN","SAMICAS2",304,0)
 . set rtn(cnt)=line
"RTN","SAMICAS2",305,0)
 . quit
"RTN","SAMICAS2",306,0)
 ;
"RTN","SAMICAS2",307,0)
 do ADDCRLF^VPRJRUT(.rtn)
"RTN","SAMICAS2",308,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMICAS2",309,0)
 ;
"RTN","SAMICAS2",310,0)
 ;
"RTN","SAMICAS2",311,0)
 ;@stanza 9 termination
"RTN","SAMICAS2",312,0)
 ;
"RTN","SAMICAS2",313,0)
 quit  ; end of ppi WSCASE^SAMICAS2
"RTN","SAMICAS2",314,0)
 ;
"RTN","SAMICAS2",315,0)
 ;
"RTN","SAMICAS2",316,0)
 ;
"RTN","SAMICAS2",317,0)
 ;@ppi-code $$NOTEHREF^SAMICASE
"RTN","SAMICAS2",318,0)
NOTEHREF ; html list of notes for form
"RTN","SAMICAS2",319,0)
 ;
"RTN","SAMICAS2",320,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",321,0)
 ;
"RTN","SAMICAS2",322,0)
 ;ven/gpl;ppi;function;clean;silent;sac;??? tests
"RTN","SAMICAS2",323,0)
 ;@signature
"RTN","SAMICAS2",324,0)
 ; $$NOTEHREF^SAMICASE(sid,form)
"RTN","SAMICAS2",325,0)
 ;@branches-from
"RTN","SAMICAS2",326,0)
 ; NOTEHREF^SAMICASE
"RTN","SAMICAS2",327,0)
 ;@ppi-called-by
"RTN","SAMICAS2",328,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS2",329,0)
 ;@called-by none
"RTN","SAMICAS2",330,0)
 ;@calls
"RTN","SAMICAS2",331,0)
 ; NTLIST^SAMINOT1
"RTN","SAMICAS2",332,0)
 ;@input
"RTN","SAMICAS2",333,0)
 ; sid = study id
"RTN","SAMICAS2",334,0)
 ; form
"RTN","SAMICAS2",335,0)
 ;@output = html list of notes
"RTN","SAMICAS2",336,0)
 ;@examples [tbd]
"RTN","SAMICAS2",337,0)
 ;@tests [tbd]
"RTN","SAMICAS2",338,0)
 ;
"RTN","SAMICAS2",339,0)
 ;
"RTN","SAMICAS2",340,0)
 ;@stanza 2 get list of notes
"RTN","SAMICAS2",341,0)
 ;
"RTN","SAMICAS2",342,0)
 new notehref set notehref=""
"RTN","SAMICAS2",343,0)
 new ntlist
"RTN","SAMICAS2",344,0)
 if form["sifor" do NTLIST^SAMINOT1("ntlist",sid,form)
"RTN","SAMICAS2",345,0)
 if form["fufor" do NTLIST^SAMINOT2("ntlist",sid,form)
"RTN","SAMICAS2",346,0)
 if $order(ntlist(""))="" quit notehref
"RTN","SAMICAS2",347,0)
 ;
"RTN","SAMICAS2",348,0)
 set notehref="<table>"
"RTN","SAMICAS2",349,0)
 new zi set zi=0
"RTN","SAMICAS2",350,0)
 for  do  quit:'zi
"RTN","SAMICAS2",351,0)
 . set zi=$order(ntlist(zi))
"RTN","SAMICAS2",352,0)
 . quit:'zi
"RTN","SAMICAS2",353,0)
 . ;
"RTN","SAMICAS2",354,0)
 . set notehref=notehref_"<td><form method=POST action=""/vapals"">"
"RTN","SAMICAS2",355,0)
 . set notehref=notehref_"<input type=hidden name=""nien"" value="""_$get(ntlist(zi,"nien"))_""">"
"RTN","SAMICAS2",356,0)
 . set notehref=notehref_"<input type=hidden name=""samiroute"" value=""note"">"
"RTN","SAMICAS2",357,0)
 . set notehref=notehref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMICAS2",358,0)
 . set notehref=notehref_"<input type=hidden name=""form"" value="_form_">"
"RTN","SAMICAS2",359,0)
 . set notehref=notehref_"<input value="""_$get(ntlist(zi,"name"))_""" class=""btn btn-link"" role=""link"" type=""submit""></form></td></tr>"
"RTN","SAMICAS2",360,0)
 . quit
"RTN","SAMICAS2",361,0)
 set notehref=notehref_"</table>"
"RTN","SAMICAS2",362,0)
 ;
"RTN","SAMICAS2",363,0)
 ;
"RTN","SAMICAS2",364,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",365,0)
 ;
"RTN","SAMICAS2",366,0)
 quit notehref ; end of ppi $$NOTEHREF^SAMICASE
"RTN","SAMICAS2",367,0)
 ;
"RTN","SAMICAS2",368,0)
 ;
"RTN","SAMICAS2",369,0)
 ;
"RTN","SAMICAS2",370,0)
 ;@ppi-code GETTMPL^SAMICASE
"RTN","SAMICAS2",371,0)
GETTMPL ; get html template
"RTN","SAMICAS2",372,0)
 ;
"RTN","SAMICAS2",373,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",374,0)
 ;
"RTN","SAMICAS2",375,0)
 ;ven/gpl;ppi;procedure;clean;silent;sac;??% tests
"RTN","SAMICAS2",376,0)
 ;@signature
"RTN","SAMICAS2",377,0)
 ; do GETTMPL^SAMICASE(return,form)
"RTN","SAMICAS2",378,0)
 ;@branches-from
"RTN","SAMICAS2",379,0)
 ; GETTMPL^SAMICASE
"RTN","SAMICAS2",380,0)
 ;@ppi-called-by
"RTN","SAMICAS2",381,0)
 ; WSCASE^SAMICAS2
"RTN","SAMICAS2",382,0)
 ; GETHOME^SAMIHOM4
"RTN","SAMICAS2",383,0)
 ; WSNOTE^SAMINOT1
"RTN","SAMICAS2",384,0)
 ; WSNOTE^SAMINOT2
"RTN","SAMICAS2",385,0)
 ; WSNOTE^SAMINOT3
"RTN","SAMICAS2",386,0)
 ; WSNOTE^SAMINOTI
"RTN","SAMICAS2",387,0)
 ;@called-by none
"RTN","SAMICAS2",388,0)
 ;@calls
"RTN","SAMICAS2",389,0)
 ; $$getTemplate^%wf
"RTN","SAMICAS2",390,0)
 ; getThis^%wd
"RTN","SAMICAS2",391,0)
 ;@input
"RTN","SAMICAS2",392,0)
 ; return = name of array to return template
"RTN","SAMICAS2",393,0)
 ; form = name of form
"RTN","SAMICAS2",394,0)
 ;@output
"RTN","SAMICAS2",395,0)
 ; @return = template
"RTN","SAMICAS2",396,0)
 ;@examples [tbd]
"RTN","SAMICAS2",397,0)
 ;@tests
"RTN","SAMICAS2",398,0)
 ; UTGTMPL^SAMIUTS2
"RTN","SAMICAS2",399,0)
 ;
"RTN","SAMICAS2",400,0)
 ;
"RTN","SAMICAS2",401,0)
 ;@stanza 2 get html template
"RTN","SAMICAS2",402,0)
 ;
"RTN","SAMICAS2",403,0)
 quit:$get(form)=""
"RTN","SAMICAS2",404,0)
 ;
"RTN","SAMICAS2",405,0)
 new fn set fn=$$getTemplate^%wf(form)
"RTN","SAMICAS2",406,0)
 do getThis^%wd(return,fn)
"RTN","SAMICAS2",407,0)
 ;
"RTN","SAMICAS2",408,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMICAS2",409,0)
 ;
"RTN","SAMICAS2",410,0)
 ;
"RTN","SAMICAS2",411,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",412,0)
 ;
"RTN","SAMICAS2",413,0)
 quit  ; end of ppi GETTMPL^SAMICASE
"RTN","SAMICAS2",414,0)
 ;
"RTN","SAMICAS2",415,0)
 ;
"RTN","SAMICAS2",416,0)
 ;
"RTN","SAMICAS2",417,0)
CNTITEMS(sid) ; extrinsic returns how many forms the patient has
"RTN","SAMICAS2",418,0)
 ; used before deleting a patient
"RTN","SAMICAS2",419,0)
 ;
"RTN","SAMICAS2",420,0)
 ;@called by : none
"RTN","SAMICAS2",421,0)
 ;@calls :
"RTN","SAMICAS2",422,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",423,0)
 ;@input ;
"RTN","SAMICAS2",424,0)
 ; sid = patient's study ID (e.g. "XXX00001")
"RTN","SAMICAS2",425,0)
 ;@output ;
"RTN","SAMICAS2",426,0)
 ;@tests :
"RTN","SAMICAS2",427,0)
 ; SAMIUTS2
"RTN","SAMICAS2",428,0)
 new groot set groot=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",429,0)
 quit:'$data(@groot@("graph",sid)) 0  ; nothing there
"RTN","SAMICAS2",430,0)
 new cnt,zi
"RTN","SAMICAS2",431,0)
 set zi=""
"RTN","SAMICAS2",432,0)
 set cnt=0
"RTN","SAMICAS2",433,0)
 for  set zi=$o(@groot@("graph",sid,zi)) quit:zi=""  do  ;
"RTN","SAMICAS2",434,0)
 . set cnt=cnt+1
"RTN","SAMICAS2",435,0)
 ;
"RTN","SAMICAS2",436,0)
 quit cnt  ; end of CNTITEMS
"RTN","SAMICAS2",437,0)
 ;
"RTN","SAMICAS2",438,0)
 ;
"RTN","SAMICAS2",439,0)
 ;
"RTN","SAMICAS2",440,0)
 ;@ppi-code GETITEMS^SAMICASE
"RTN","SAMICAS2",441,0)
GETITEMS ; get items available for studyid
"RTN","SAMICAS2",442,0)
 ;
"RTN","SAMICAS2",443,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",444,0)
 ;
"RTN","SAMICAS2",445,0)
 ;ven/gpl;ppi;procedure;clean;silent;sac;??% tests
"RTN","SAMICAS2",446,0)
 ;@signature
"RTN","SAMICAS2",447,0)
 ; do GETITEMS^SAMICASE(ary,sid)
"RTN","SAMICAS2",448,0)
 ;@branches-from
"RTN","SAMICAS2",449,0)
 ; GETITEMS^SAMICASE
"RTN","SAMICAS2",450,0)
 ;@ppi-called-by
"RTN","SAMICAS2",451,0)
 ; WSCASE^SAMICAS2
"RTN","SAMICAS2",452,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS2",453,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS2",454,0)
 ; GETFILTR^SAMICTR0
"RTN","SAMICAS2",455,0)
 ; GETFILTR^SAMICTT0
"RTN","SAMICAS2",456,0)
 ; SELECT^SAMIUR
"RTN","SAMICAS2",457,0)
 ; SELECT^SAMIUR1
"RTN","SAMICAS2",458,0)
 ; CUMPY^SAMIUR2
"RTN","SAMICAS2",459,0)
 ;@called-by none
"RTN","SAMICAS2",460,0)
 ;@calls
"RTN","SAMICAS2",461,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",462,0)
 ;@input
"RTN","SAMICAS2",463,0)
 ; ary = name of return array
"RTN","SAMICAS2",464,0)
 ; sid = patient's study ID (e.g. "XXX00001")
"RTN","SAMICAS2",465,0)
 ;@output
"RTN","SAMICAS2",466,0)
 ; @ary = returned items available
"RTN","SAMICAS2",467,0)
 ;@examples [tbd]
"RTN","SAMICAS2",468,0)
 ;@tests
"RTN","SAMICAS2",469,0)
 ; UTCNTITM^SAMIUTS2
"RTN","SAMICAS2",470,0)
 ;
"RTN","SAMICAS2",471,0)
 ;
"RTN","SAMICAS2",472,0)
 ;@stanza 2 get items
"RTN","SAMICAS2",473,0)
 ;
"RTN","SAMICAS2",474,0)
 new groot set groot=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",475,0)
 quit:'$data(@groot@("graph",sid))  ; nothing there
"RTN","SAMICAS2",476,0)
 ;
"RTN","SAMICAS2",477,0)
 kill @ary
"RTN","SAMICAS2",478,0)
 new zi set zi=""
"RTN","SAMICAS2",479,0)
 for  set zi=$order(@groot@("graph",sid,zi)) quit:zi=""  do  ;
"RTN","SAMICAS2",480,0)
 . set @ary@(zi)=""
"RTN","SAMICAS2",481,0)
 . quit
"RTN","SAMICAS2",482,0)
 ;
"RTN","SAMICAS2",483,0)
 ;
"RTN","SAMICAS2",484,0)
 ;@stanza 3 get rest of forms (many-to-one, get dates)
"RTN","SAMICAS2",485,0)
 ;
"RTN","SAMICAS2",486,0)
 new tary
"RTN","SAMICAS2",487,0)
 for  set zi=$order(@ary@(zi)) quit:zi=""  do  ;
"RTN","SAMICAS2",488,0)
 . new zkey1,zform set zkey1=$piece(zi,"-",1)
"RTN","SAMICAS2",489,0)
 . ; if zkey1="sbform" quit  ;
"RTN","SAMICAS2",490,0)
 . if zkey1="siform" quit  ;
"RTN","SAMICAS2",491,0)
 . new fname
"RTN","SAMICAS2",492,0)
 . if zkey1="ceform" set fname="CT Evaluation"
"RTN","SAMICAS2",493,0)
 . set zform=zkey1
"RTN","SAMICAS2",494,0)
 . if zkey1="sbform" set zform="vapals:sbform"
"RTN","SAMICAS2",495,0)
 . if zkey1="sbform" set fname="Background"
"RTN","SAMICAS2",496,0)
 . if zkey1="ceform" set zform="vapals:ceform"
"RTN","SAMICAS2",497,0)
 . if zkey1="fuform" set zform="vapals:fuform"
"RTN","SAMICAS2",498,0)
 . if zkey1="fuform" set fname="Follow-up"
"RTN","SAMICAS2",499,0)
 . if zkey1="bxform" set fname="Biopsy"
"RTN","SAMICAS2",500,0)
 . if zkey1="bxform" set zform="vapals:bxform"
"RTN","SAMICAS2",501,0)
 . if zkey1="ptform" set zform="vapals:ptform"
"RTN","SAMICAS2",502,0)
 . if zkey1="ptform" set fname="PET Evaluation"
"RTN","SAMICAS2",503,0)
 . if zkey1="itform" set zform="vapals:itform"
"RTN","SAMICAS2",504,0)
 . if zkey1="itform" set fname="Intervention"
"RTN","SAMICAS2",505,0)
 . if $get(fname)="" set fname="unknown"
"RTN","SAMICAS2",506,0)
 . ;
"RTN","SAMICAS2",507,0)
 . new zdate set zdate=$extract(zi,$length(zkey1)+2,$length(zi))
"RTN","SAMICAS2",508,0)
 . set zdate=$$FMDT^SAMIUR2(zdate)
"RTN","SAMICAS2",509,0)
 . quit:$get(zdate)=""
"RTN","SAMICAS2",510,0)
 . quit:$get(zform)=""
"RTN","SAMICAS2",511,0)
 . quit:$get(zi)=""
"RTN","SAMICAS2",512,0)
 . quit:$get(fname)=""
"RTN","SAMICAS2",513,0)
 . ;
"RTN","SAMICAS2",514,0)
 . set tary("sort",zdate,zform,zi,fname)=""
"RTN","SAMICAS2",515,0)
 . set tary("type",zform,zi,fname)=""
"RTN","SAMICAS2",516,0)
 . quit
"RTN","SAMICAS2",517,0)
 merge @ary=tary
"RTN","SAMICAS2",518,0)
 ;
"RTN","SAMICAS2",519,0)
 ;
"RTN","SAMICAS2",520,0)
 ;@stanza 4 termination
"RTN","SAMICAS2",521,0)
 ;
"RTN","SAMICAS2",522,0)
 quit  ; end of ppi GETITEMS^SAMICASE
"RTN","SAMICAS2",523,0)
 ;
"RTN","SAMICAS2",524,0)
 ;
"RTN","SAMICAS2",525,0)
 ;
"RTN","SAMICAS2",526,0)
GETDTKEY(formid) ; date portion of form key
"RTN","SAMICAS2",527,0)
 ;
"RTN","SAMICAS2",528,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",529,0)
 ;
"RTN","SAMICAS2",530,0)
 ;ven/gpl;private;function;
"RTN","SAMICAS2",531,0)
 ;@called by
"RTN","SAMICAS2",532,0)
 ;  WSCASE^SAMICAS2
"RTN","SAMICAS2",533,0)
 ;@calls :
"RTN","SAMICAS2",534,0)
 ;@input
"RTN","SAMICAS2",535,0)
 ; formid form key
"RTN","SAMICAS2",536,0)
 ;@output
"RTN","SAMICAS2",537,0)
 ; date from form key
"RTN","SAMICAS2",538,0)
 ;@examples
"RTN","SAMICAS2",539,0)
 ; $$GETDTKEY("sbform-2018-02-26") = "2018-02-26"
"RTN","SAMICAS2",540,0)
 ;@tests :
"RTN","SAMICAS2",541,0)
 ; SAMIUTS2
"RTN","SAMICAS2",542,0)
 ;
"RTN","SAMICAS2",543,0)
 ;@stanza 2 calculate date from key
"RTN","SAMICAS2",544,0)
 ;
"RTN","SAMICAS2",545,0)
 new frm set frm=$piece(formid,"-")
"RTN","SAMICAS2",546,0)
 new date set date=$piece(formid,frm_"-",2)
"RTN","SAMICAS2",547,0)
 ;
"RTN","SAMICAS2",548,0)
 ;@stanza 3 return & termination
"RTN","SAMICAS2",549,0)
 ;
"RTN","SAMICAS2",550,0)
 quit date ; return date; end of $$GETDTKEY
"RTN","SAMICAS2",551,0)
 ;
"RTN","SAMICAS2",552,0)
 ;
"RTN","SAMICAS2",553,0)
 ;
"RTN","SAMICAS2",554,0)
KEY2DSPD(zkey) ; date in elcap format from key date
"RTN","SAMICAS2",555,0)
 ;
"RTN","SAMICAS2",556,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",557,0)
 ;
"RTN","SAMICAS2",558,0)
 ;ven/gpl;private;function;
"RTN","SAMICAS2",559,0)
 ;@called by
"RTN","SAMICAS2",560,0)
 ;  WSCASE^SAMICAS2
"RTN","SAMICAS2",561,0)
 ;@calls
"RTN","SAMICAS2",562,0)
 ; ^%DT
"RTN","SAMICAS2",563,0)
 ; $$FMTE^XLFDT
"RTN","SAMICAS2",564,0)
 ; $$VAPALSDT^SAMICAS2
"RTN","SAMICAS2",565,0)
 ;@input
"RTN","SAMICAS2",566,0)
 ; zkey = date in any format %DT can process
"RTN","SAMICAS2",567,0)
 ;@output
"RTN","SAMICAS2",568,0)
 ; date in elcap format
"RTN","SAMICAS2",569,0)
 ;@examples
"RTN","SAMICAS2",570,0)
 ; date 2018-02-26 => 26/Feb/2018
"RTN","SAMICAS2",571,0)
 ;@tests
"RTN","SAMICAS2",572,0)
 ; SAMIUTS2
"RTN","SAMICAS2",573,0)
 ;
"RTN","SAMICAS2",574,0)
 ;@stanza 2 convert date to elcap display format
"RTN","SAMICAS2",575,0)
 ;
"RTN","SAMICAS2",576,0)
 new X set X=zkey
"RTN","SAMICAS2",577,0)
 new Y
"RTN","SAMICAS2",578,0)
 do ^%DT
"RTN","SAMICAS2",579,0)
 ;new Z set Z=$$FMTE^XLFDT(Y,"9D")
"RTN","SAMICAS2",580,0)
 ;set Z=$translate(Z," ","/")
"RTN","SAMICAS2",581,0)
 new zdate
"RTN","SAMICAS2",582,0)
 set zdate=$$VAPALSDT^SAMICASE(Y)
"RTN","SAMICAS2",583,0)
 ;
"RTN","SAMICAS2",584,0)
 ;@stanza 3 return & termination
"RTN","SAMICAS2",585,0)
 ;
"RTN","SAMICAS2",586,0)
 quit zdate  ; return date; end of $$KEY2DSPD
"RTN","SAMICAS2",587,0)
 ;
"RTN","SAMICAS2",588,0)
 ;
"RTN","SAMICAS2",589,0)
 ;
"RTN","SAMICAS2",590,0)
 ;@ppi-code $$VAPALSDT^SAMICASE
"RTN","SAMICAS2",591,0)
VAPALSDT ; vapals format for dates
"RTN","SAMICAS2",592,0)
 ;
"RTN","SAMICAS2",593,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",594,0)
 ;
"RTN","SAMICAS2",595,0)
 ;ven/gpl;ppi;function;clean;silent;sac;100% tests
"RTN","SAMICAS2",596,0)
 ;@signature
"RTN","SAMICAS2",597,0)
 ; $$VAPALSDT^SAMICASE(fmdate)
"RTN","SAMICAS2",598,0)
 ;@branches-from
"RTN","SAMICAS2",599,0)
 ; VAPALSDT^SAMICASE
"RTN","SAMICAS2",600,0)
 ;@ppi-called-by
"RTN","SAMICAS2",601,0)
 ; KEY2DSPD^SAMICAS2
"RTN","SAMICAS2",602,0)
 ; LASTCMP^SAMICAS3
"RTN","SAMICAS2",603,0)
 ; KEY2DT^SAMICAS3
"RTN","SAMICAS2",604,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS2",605,0)
 ; MKFUFORM^SAMICAS3
"RTN","SAMICAS2",606,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS2",607,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS2",608,0)
 ; LOGIT^SAMICLOG
"RTN","SAMICAS2",609,0)
 ; MKSIFORM^SAMIHOM3
"RTN","SAMICAS2",610,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMICAS2",611,0)
 ; SELECT^SAMIUR
"RTN","SAMICAS2",612,0)
 ; SELECT^SAMIUR1
"RTN","SAMICAS2",613,0)
 ; IFORM^SAMIUR2
"RTN","SAMICAS2",614,0)
 ;@called-by none
"RTN","SAMICAS2",615,0)
 ;@calls
"RTN","SAMICAS2",616,0)
 ; $$FMTE^XLFDT
"RTN","SAMICAS2",617,0)
 ;@input
"RTN","SAMICAS2",618,0)
 ; fmdate = date in fileman format
"RTN","SAMICAS2",619,0)
 ;@output = vapals date format
"RTN","SAMICAS2",620,0)
 ;@tests
"RTN","SAMICAS2",621,0)
 ; UTVPLSD^SAMIUTS2
"RTN","SAMICAS2",622,0)
 ;
"RTN","SAMICAS2",623,0)
 ;
"RTN","SAMICAS2",624,0)
 ;@stanza 2 convert date
"RTN","SAMICAS2",625,0)
 ;
"RTN","SAMICAS2",626,0)
 ; new vdate set vdate=$$FMTE^XLFDT(fmdate,"9D")
"RTN","SAMICAS2",627,0)
 ; set vdate=$translate(vdate," ","/")
"RTN","SAMICAS2",628,0)
 ;
"RTN","SAMICAS2",629,0)
 ;new vdate set vdate=$$FMTE^XLFDT(fmdate,"5D")
"RTN","SAMICAS2",630,0)
 new vdate set vdate=$$FMTE^XLFDT(fmdate,"5DZ")
"RTN","SAMICAS2",631,0)
 ;
"RTN","SAMICAS2",632,0)
 ;
"RTN","SAMICAS2",633,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",634,0)
 ;
"RTN","SAMICAS2",635,0)
 quit vdate ; end of ppi $$VAPALSDT^SAMICASE
"RTN","SAMICAS2",636,0)
 ;
"RTN","SAMICAS2",637,0)
 ;
"RTN","SAMICAS2",638,0)
 ;
"RTN","SAMICAS2",639,0)
 ;@section 2 WSNUFORM & related ppis
"RTN","SAMICAS2",640,0)
 ;
"RTN","SAMICAS2",641,0)
 ;
"RTN","SAMICAS2",642,0)
 ;
"RTN","SAMICAS2",643,0)
 ;@wri-code WSNUFORM^SAMICASE
"RTN","SAMICAS2",644,0)
WSNUFORM ; post vapals nuform: new form for patient
"RTN","SAMICAS2",645,0)
 ;
"RTN","SAMICAS2",646,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",647,0)
 ;
"RTN","SAMICAS2",648,0)
 ;ven/gpl;wri;procedure;clean;silent;sac;?? tests
"RTN","SAMICAS2",649,0)
 ;@signature
"RTN","SAMICAS2",650,0)
 ; do WSNUFORM^SAMICASE(rtn,filter)
"RTN","SAMICAS2",651,0)
 ;@branches-from
"RTN","SAMICAS2",652,0)
 ; WSNUFORM^SAMICASE
"RTN","SAMICAS2",653,0)
 ;@wri-called-by
"RTN","SAMICAS2",654,0)
 ; WSVAPALS^SAMIHOM3 [wr nuform of ws post vapals]
"RTN","SAMICAS2",655,0)
 ;@called-by none
"RTN","SAMICAS2",656,0)
 ;@calls
"RTN","SAMICAS2",657,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS2",658,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",659,0)
 ; GETTMPL^SAMICAS2
"RTN","SAMICAS2",660,0)
 ; findReplace^%ts
"RTN","SAMICAS2",661,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMICAS2",662,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMICAS2",663,0)
 ; findReplace^%ts
"RTN","SAMICAS2",664,0)
 ;@input
"RTN","SAMICAS2",665,0)
 ; .filter =
"RTN","SAMICAS2",666,0)
 ; .filter("studyid")=studyid of the patient
"RTN","SAMICAS2",667,0)
 ;@output
"RTN","SAMICAS2",668,0)
 ; @rtn
"RTN","SAMICAS2",669,0)
 ;@tests
"RTN","SAMICAS2",670,0)
 ; UTWSNF^SAMIUTS2
"RTN","SAMICAS2",671,0)
 ;
"RTN","SAMICAS2",672,0)
 ;
"RTN","SAMICAS2",673,0)
 ;@stanza 2 get select-new-form form
"RTN","SAMICAS2",674,0)
 ;
"RTN","SAMICAS2",675,0)
 new sid set sid=$get(filter("studyid"))
"RTN","SAMICAS2",676,0)
 quit:sid=""
"RTN","SAMICAS2",677,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS2",678,0)
 quit:+sien=0
"RTN","SAMICAS2",679,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",680,0)
 new groot set groot=$name(@root@(sien))
"RTN","SAMICAS2",681,0)
 ;
"RTN","SAMICAS2",682,0)
 new saminame set saminame=$get(@groot@("saminame"))
"RTN","SAMICAS2",683,0)
 quit:saminame=""
"RTN","SAMICAS2",684,0)
 ;
"RTN","SAMICAS2",685,0)
 new temp,tout,form
"RTN","SAMICAS2",686,0)
 set return="temp",form="vapals:nuform"
"RTN","SAMICAS2",687,0)
 do GETTMPL
"RTN","SAMICAS2",688,0)
 quit:'$data(temp)
"RTN","SAMICAS2",689,0)
 ;
"RTN","SAMICAS2",690,0)
 new cnt set cnt=0
"RTN","SAMICAS2",691,0)
 new zi set zi=0
"RTN","SAMICAS2",692,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  do  ;
"RTN","SAMICAS2",693,0)
 . new ln set ln=temp(zi)
"RTN","SAMICAS2",694,0)
 . new touched set touched=0
"RTN","SAMICAS2",695,0)
 . ;
"RTN","SAMICAS2",696,0)
 . if ln["href" if 'touched do  ;
"RTN","SAMICAS2",697,0)
 . . do FIXHREF^SAMIFORM(.ln)
"RTN","SAMICAS2",698,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",699,0)
 . ;
"RTN","SAMICAS2",700,0)
 . if ln["src" d  ;
"RTN","SAMICAS2",701,0)
 . . do FIXSRC^SAMIFORM(.ln)
"RTN","SAMICAS2",702,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",703,0)
 . ;
"RTN","SAMICAS2",704,0)
 . if ln["@@SID@@" do  ;
"RTN","SAMICAS2",705,0)
 . . do findReplace^%ts(.ln,"@@SID@@",sid)
"RTN","SAMICAS2",706,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",707,0)
 . . quit
"RTN","SAMICAS2",708,0)
 . ;
"RTN","SAMICAS2",709,0)
 . if ln["@@SITE@@" do  ; insert site id
"RTN","SAMICAS2",710,0)
 . . n siteid s siteid=$g(filter("siteid"))
"RTN","SAMICAS2",711,0)
 . . i siteid="" s siteid=$g(filter("site"))
"RTN","SAMICAS2",712,0)
 . . q:siteid=""
"RTN","SAMICAS2",713,0)
 . . do findReplace^%ts(.ln,"@@SITE@@",siteid)
"RTN","SAMICAS2",714,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",715,0)
 . ;
"RTN","SAMICAS2",716,0)
 . if ln["@@SITETITLE@@" do  ; insert site title
"RTN","SAMICAS2",717,0)
 . . n sitetit s sitetit=$g(filter("sitetitle"))
"RTN","SAMICAS2",718,0)
 . . if sitetit="" d  ;
"RTN","SAMICAS2",719,0)
 . . . n tsite s tsite=$g(filter("site"))
"RTN","SAMICAS2",720,0)
 . . . q:tsite=""
"RTN","SAMICAS2",721,0)
 . . . s sitetit=$$SITENM2^SAMISITE(tsite)_" - "_tsite
"RTN","SAMICAS2",722,0)
 . . q:sitetit=""
"RTN","SAMICAS2",723,0)
 . . do findReplace^%ts(.ln,"@@SITETITLE@@",sitetit)
"RTN","SAMICAS2",724,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",725,0)
 . ;
"RTN","SAMICAS2",726,0)
 . set cnt=cnt+1
"RTN","SAMICAS2",727,0)
 . set rtn(cnt)=temp(zi)
"RTN","SAMICAS2",728,0)
 ;
"RTN","SAMICAS2",729,0)
 ;
"RTN","SAMICAS2",730,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",731,0)
 ;
"RTN","SAMICAS2",732,0)
 quit  ; end of wri WSNUFORM^SAMICASE
"RTN","SAMICAS2",733,0)
 ;
"RTN","SAMICAS2",734,0)
 ;
"RTN","SAMICAS2",735,0)
 ;
"RTN","SAMICAS2",736,0)
 ;@ppi-code $$KEY2FM^SAMICASE
"RTN","SAMICAS2",737,0)
KEY2FM ; convert key to fileman date
"RTN","SAMICAS2",738,0)
 ;
"RTN","SAMICAS2",739,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",740,0)
 ;
"RTN","SAMICAS2",741,0)
 ;ven/gpl;wri;procedure;silent;clean;sac;??% tests
"RTN","SAMICAS2",742,0)
 ;@signature
"RTN","SAMICAS2",743,0)
 ; $$KEY2FM^SAMICASE(key)
"RTN","SAMICAS2",744,0)
 ;@branches-from
"RTN","SAMICAS2",745,0)
 ; KEY2FM^SAMICASE
"RTN","SAMICAS2",746,0)
 ;@ppi-called-by
"RTN","SAMICAS2",747,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS2",748,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS2",749,0)
 ; $$KEY2DT^SAMICAS3
"RTN","SAMICAS2",750,0)
 ; SAVFILTR^SAMISAV
"RTN","SAMICAS2",751,0)
 ; SELECT^SAMIUR
"RTN","SAMICAS2",752,0)
 ; SELECT^SAMIUR1
"RTN","SAMICAS2",753,0)
 ; IFORM^SAMIUM2
"RTN","SAMICAS2",754,0)
 ;@called-by none
"RTN","SAMICAS2",755,0)
 ;@calls
"RTN","SAMICAS2",756,0)
 ; ^%DT
"RTN","SAMICAS2",757,0)
 ;@input
"RTN","SAMICAS2",758,0)
 ; key = vapals key (e.g.
"RTN","SAMICAS2",759,0)
 ;@output
"RTN","SAMICAS2",760,0)
 ;@examples
"RTN","SAMICAS2",761,0)
 ;  $$KEY2FM("sbform-2018-02-26") = 3180226
"RTN","SAMICAS2",762,0)
 ;@tests
"RTN","SAMICAS2",763,0)
 ; UTK2FM^SAMIUTS2
"RTN","SAMICAS2",764,0)
 ;
"RTN","SAMICAS2",765,0)
 ;
"RTN","SAMICAS2",766,0)
 ;@stanza 2 convert key to fm date
"RTN","SAMICAS2",767,0)
 ;
"RTN","SAMICAS2",768,0)
 new datepart set datepart=key
"RTN","SAMICAS2",769,0)
 ; allow key to be the whole key ie ceform-2018-10-3
"RTN","SAMICAS2",770,0)
 if $length(key,"-")=4 do
"RTN","SAMICAS2",771,0)
 . new frm set frm=$piece(key,"-")
"RTN","SAMICAS2",772,0)
 . set datepart=$piece(key,frm_"-",2)
"RTN","SAMICAS2",773,0)
 . quit
"RTN","SAMICAS2",774,0)
 new X set X=datepart
"RTN","SAMICAS2",775,0)
 new Y
"RTN","SAMICAS2",776,0)
 do ^%DT ; call fileman to convert date
"RTN","SAMICAS2",777,0)
 ;
"RTN","SAMICAS2",778,0)
 ;
"RTN","SAMICAS2",779,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",780,0)
 ;
"RTN","SAMICAS2",781,0)
 quit Y ; end of ppi $$KEY2FM^SAMICASE
"RTN","SAMICAS2",782,0)
 ;
"RTN","SAMICAS2",783,0)
 ;
"RTN","SAMICAS2",784,0)
 ;
"RTN","SAMICAS2",785,0)
 ;@section 3 casetbl
"RTN","SAMICAS2",786,0)
 ;
"RTN","SAMICAS2",787,0)
 ;
"RTN","SAMICAS2",788,0)
 ;
"RTN","SAMICAS2",789,0)
 ;@ppi $$GSAMISTA^SAMICAS2 = value of 'samistatus' from form
"RTN","SAMICAS2",790,0)
GSAMISTA(sid,form) ; extrinsic returns value of 'samistatus' from form
"RTN","SAMICAS2",791,0)
 ;
"RTN","SAMICAS2",792,0)
 ;@called by
"RTN","SAMICAS2",793,0)
 ; WSCASE^SAMICAS2
"RTN","SAMICAS2",794,0)
 ;@calls
"RTN","SAMICAS2",795,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",796,0)
 ;@input
"RTN","SAMICAS2",797,0)
 ; sid  = patient's studyid
"RTN","SAMICAS2",798,0)
 ; form = specific study form (e.g. "sbform-2018-02-26")
"RTN","SAMICAS2",799,0)
 ;@output
"RTN","SAMICAS2",800,0)
 ; status of the form
"RTN","SAMICAS2",801,0)
 ;@tests
"RTN","SAMICAS2",802,0)
 ; SAMIUTS2
"RTN","SAMICAS2",803,0)
 ;
"RTN","SAMICAS2",804,0)
 new stat,root,useform
"RTN","SAMICAS2",805,0)
 set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",806,0)
 set useform=form
"RTN","SAMICAS2",807,0)
 if form["vapals:" set useform=$p(form,"vapals:",2)
"RTN","SAMICAS2",808,0)
 set stat=$get(@root@("graph",sid,useform,"samistatus"))
"RTN","SAMICAS2",809,0)
 if stat="" set stat="incomplete"
"RTN","SAMICAS2",810,0)
 ;
"RTN","SAMICAS2",811,0)
 quit stat ; end of ppi $$GSAMISTA^SAMICAS2
"RTN","SAMICAS2",812,0)
 ;
"RTN","SAMICAS2",813,0)
 ;
"RTN","SAMICAS2",814,0)
 ;
"RTN","SAMICAS2",815,0)
 ;@ppi-code SSAMISTA^SAMICASE
"RTN","SAMICAS2",816,0)
SSAMISTA ; set samistatus to val in form
"RTN","SAMICAS2",817,0)
 ;
"RTN","SAMICAS2",818,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",819,0)
 ;
"RTN","SAMICAS2",820,0)
 ;ven/gpl;ppi;procedure;silent;clean;sac;??% tests
"RTN","SAMICAS2",821,0)
 ;@signature
"RTN","SAMICAS2",822,0)
 ; do SSAMISTA^SAMICASE(sid,form,val)
"RTN","SAMICAS2",823,0)
 ;@branches-from
"RTN","SAMICAS2",824,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS2",825,0)
 ;@ppi-called-by
"RTN","SAMICAS2",826,0)
 ; INITSTAT^SAMICAS2
"RTN","SAMICAS2",827,0)
 ; MKSBFORM^SAMICAS3
"RTN","SAMICAS2",828,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS2",829,0)
 ; MKFUFORM^SAMICAS3
"RTN","SAMICAS2",830,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS2",831,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS2",832,0)
 ; MKBXFORM^SAMICAS3
"RTN","SAMICAS2",833,0)
 ; MKSBFORM^SAMIHOM3
"RTN","SAMICAS2",834,0)
 ; MKSIFORM^SAMIHOM3
"RTN","SAMICAS2",835,0)
 ;@called-by none
"RTN","SAMICAS2",836,0)
 ;@calls
"RTN","SAMICAS2",837,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",838,0)
 ;@input
"RTN","SAMICAS2",839,0)
 ; sid   = patient's studyid
"RTN","SAMICAS2",840,0)
 ; form  = specific study form (e.g. "sbform-2018-02-26")
"RTN","SAMICAS2",841,0)
 ; value = status (complete, incomplete)
"RTN","SAMICAS2",842,0)
 ;@output
"RTN","SAMICAS2",843,0)
 ; sets 'samistatus' to val in form
"RTN","SAMICAS2",844,0)
 ;@examples [tbd]
"RTN","SAMICAS2",845,0)
 ;@tests
"RTN","SAMICAS2",846,0)
 ; UTSSAMIS^SAMIUTS2
"RTN","SAMICAS2",847,0)
 ;
"RTN","SAMICAS2",848,0)
 ;
"RTN","SAMICAS2",849,0)
 ;@stanza 2 set status
"RTN","SAMICAS2",850,0)
 ;
"RTN","SAMICAS2",851,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",852,0)
 new useform set useform=form
"RTN","SAMICAS2",853,0)
 if form["vapals:" set useform=$piece(form,"vapals:",2)
"RTN","SAMICAS2",854,0)
 if '$data(@root@("graph",sid,useform)) quit  ; no form
"RTN","SAMICAS2",855,0)
 set @root@("graph",sid,useform,"samistatus")=val
"RTN","SAMICAS2",856,0)
 ;
"RTN","SAMICAS2",857,0)
 ;
"RTN","SAMICAS2",858,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",859,0)
 ;
"RTN","SAMICAS2",860,0)
 quit  ; end of ppi SSAMISTA^SAMICASE
"RTN","SAMICAS2",861,0)
 ;
"RTN","SAMICAS2",862,0)
 ;
"RTN","SAMICAS2",863,0)
 ;
"RTN","SAMICAS2",864,0)
 ;@wri-code DELFORM^SAMICASE
"RTN","SAMICAS2",865,0)
DELFORM ; post vapals deleteform: delete incomplete form
"RTN","SAMICAS2",866,0)
 ;
"RTN","SAMICAS2",867,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",868,0)
 ;
"RTN","SAMICAS2",869,0)
 ;ven/gpl;wri;procedure;silent;clean;sac;??% tests
"RTN","SAMICAS2",870,0)
 ;@signature
"RTN","SAMICAS2",871,0)
 ; do DELFORM^SAMICASE(RESULT,ARGS)
"RTN","SAMICAS2",872,0)
 ;@branches-from
"RTN","SAMICAS2",873,0)
 ; DELFORM^SAMICASE
"RTN","SAMICAS2",874,0)
 ;@wri-called-by
"RTN","SAMICAS2",875,0)
 ; WSVAPALS^SAMIHOM3 [wr deleteform of ws post vapals]
"RTN","SAMICAS2",876,0)
 ;@called-by none
"RTN","SAMICAS2",877,0)
 ;@calls
"RTN","SAMICAS2",878,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",879,0)
 ; $$GSAMISTA
"RTN","SAMICAS2",880,0)
 ; WSCASE^SAMICASE
"RTN","SAMICAS2",881,0)
 ;@input
"RTN","SAMICAS2",882,0)
 ; .ARGS=
"RTN","SAMICAS2",883,0)
 ; .ARGS("studyid")
"RTN","SAMICAS2",884,0)
 ; .ARGS("form")
"RTN","SAMICAS2",885,0)
 ;@output
"RTN","SAMICAS2",886,0)
 ; @RESULT
"RTN","SAMICAS2",887,0)
 ;@tests
"RTN","SAMICAS2",888,0)
 ; UTDELFM^SAMIUTS2
"RTN","SAMICAS2",889,0)
 ;
"RTN","SAMICAS2",890,0)
 ; will not delete intake or background form
"RTN","SAMICAS2",891,0)
 ;
"RTN","SAMICAS2",892,0)
 ;
"RTN","SAMICAS2",893,0)
 ;@stanza 2 delete form
"RTN","SAMICAS2",894,0)
 ;
"RTN","SAMICAS2",895,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",896,0)
 new sid set sid=$get(ARGS("studyid"))
"RTN","SAMICAS2",897,0)
 quit:sid=""
"RTN","SAMICAS2",898,0)
 ;
"RTN","SAMICAS2",899,0)
 new form set form=$get(ARGS("form"))
"RTN","SAMICAS2",900,0)
 quit:form=""
"RTN","SAMICAS2",901,0)
 ;
"RTN","SAMICAS2",902,0)
 quit:form["siform"
"RTN","SAMICAS2",903,0)
 ;
"RTN","SAMICAS2",904,0)
 ; quit:'$data(@root@("graph",sid,form))  ; form does not exist
"RTN","SAMICAS2",905,0)
 if $$GSAMISTA(sid,form)="incomplete" do
"RTN","SAMICAS2",906,0)
 . kill @root@("graph",sid,form)
"RTN","SAMICAS2",907,0)
 . quit
"RTN","SAMICAS2",908,0)
 ;
"RTN","SAMICAS2",909,0)
 kill ARGS("samiroute")
"RTN","SAMICAS2",910,0)
 do WSCASE^SAMICASE(.RESULT,.ARGS) ; post vapals casereview:
"RTN","SAMICAS2",911,0)
 ; generate case review page
"RTN","SAMICAS2",912,0)
 ;
"RTN","SAMICAS2",913,0)
 ;
"RTN","SAMICAS2",914,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",915,0)
 ;
"RTN","SAMICAS2",916,0)
 quit  ; end of wri DELFORM^SAMICASE
"RTN","SAMICAS2",917,0)
 ;
"RTN","SAMICAS2",918,0)
 ;
"RTN","SAMICAS2",919,0)
 ;
"RTN","SAMICAS2",920,0)
INITSTAT ; set all forms to 'incomplete'
"RTN","SAMICAS2",921,0)
 ;
"RTN","SAMICAS2",922,0)
 ;@called by : none
"RTN","SAMICAS2",923,0)
 ;@calls
"RTN","SAMICAS2",924,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS2",925,0)
 ;@input : none
"RTN","SAMICAS2",926,0)
 ;@output
"RTN","SAMICAS2",927,0)
 ; set all forms to 'incomplete'
"RTN","SAMICAS2",928,0)
 ;@tests
"RTN","SAMICAS2",929,0)
 ;
"RTN","SAMICAS2",930,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",931,0)
 new zi,zj set (zi,zj)=""
"RTN","SAMICAS2",932,0)
 for  set zi=$order(@root@("graph",zi)) quit:zi=""  do  ;
"RTN","SAMICAS2",933,0)
 . for  set zj=$order(@root@("graph",zi,zj)) quit:zj=""  do  ;
"RTN","SAMICAS2",934,0)
 . . if zj["siform" do SSAMISTA^SAMICASE(zi,zj,"complete") quit  ;
"RTN","SAMICAS2",935,0)
 . . do SSAMISTA^SAMICASE(zi,zj,"incomplete")
"RTN","SAMICAS2",936,0)
 ;
"RTN","SAMICAS2",937,0)
 quit  ; end of INITSTAT
"RTN","SAMICAS2",938,0)
 ;
"RTN","SAMICAS2",939,0)
 ;
"RTN","SAMICAS2",940,0)
 ;
"RTN","SAMICAS2",941,0)
EOR ; end of routine SAMICAS2
"RTN","SAMICUL")
0^6^B135148
"RTN","SAMICUL",1,0)
SAMICUL ;ven/gpl - case review log ;2021-10-05t23:23z
"RTN","SAMICUL",2,0)
 ;;18.0;SAMI;**9,11,12,14**;2020-01;Build 8
"RTN","SAMICUL",3,0)
 ;;18.14
"RTN","SAMICUL",4,0)
 ;
"RTN","SAMICUL",5,0)
 ; SAMICUL contains the development log for the VAPALS-IELCAP Case
"RTN","SAMICUL",6,0)
 ; Review Page (SAMICA* routines).
"RTN","SAMICUL",7,0)
 ; It contains no executable code.
"RTN","SAMICUL",8,0)
 ;
"RTN","SAMICUL",9,0)
 quit  ; no entry from top
"RTN","SAMICUL",10,0)
 ;
"RTN","SAMICUL",11,0)
 ;
"RTN","SAMICUL",12,0)
 ;
"RTN","SAMICUL",13,0)
 ;@section 0 primary development
"RTN","SAMICUL",14,0)
 ;
"RTN","SAMICUL",15,0)
 ;
"RTN","SAMICUL",16,0)
 ;
"RTN","SAMICUL",17,0)
 ;@routine-credits
"RTN","SAMICUL",18,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMICUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICUL",20,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMICUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMICUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMICUL",23,0)
 ;@license see routine SAMIUL
"RTN","SAMICUL",24,0)
 ;
"RTN","SAMICUL",25,0)
 ;@last-update 2021-08-10t18:36z
"RTN","SAMICUL",26,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMICUL",27,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMICUL",28,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMICUL",29,0)
 ;@version 18.12
"RTN","SAMICUL",30,0)
 ;@release-date 2020-01
"RTN","SAMICUL",31,0)
 ;@patch-list **9,11,12**
"RTN","SAMICUL",32,0)
 ;
"RTN","SAMICUL",33,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMICUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMICUL",35,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMICUL",36,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMICUL",37,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMICUL",38,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMICUL",39,0)
 ;@dev-add Domenick DiNatale (ddn)
"RTN","SAMICUL",40,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMICUL",41,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMICUL",42,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICUL",43,0)
 ;
"RTN","SAMICUL",44,0)
 ;@module-credits
"RTN","SAMICUL",45,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICUL",46,0)
 ; (VA-PALS)
"RTN","SAMICUL",47,0)
 ; http://va-pals.org/
"RTN","SAMICUL",48,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICUL",49,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICUL",50,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICUL",51,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICUL",52,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMICUL",53,0)
 ; http://ielcap.com/
"RTN","SAMICUL",54,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICUL",55,0)
 ; http://paraxialtech.com/
"RTN","SAMICUL",56,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICUL",57,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICUL",58,0)
 ;
"RTN","SAMICUL",59,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICUL",60,0)
 ;
"RTN","SAMICUL",61,0)
 ; 2018-01-14 ven/gpl 18.0-t4
"RTN","SAMICUL",62,0)
 ;  SAMICASE split from routine SAMIFRM, incl wsCASE,GETTMPL,GETITEMS,
"RTN","SAMICUL",63,0)
 ; casetbl.
"RTN","SAMICUL",64,0)
 ;
"RTN","SAMICUL",65,0)
 ; 2018-02-05/08 ven/toad 18.0-t4
"RTN","SAMICUL",66,0)
 ;  SAMICASE update style, license, & attribution, spell out language
"RTN","SAMICUL",67,0)
 ; elements, add white space & do-dot quits, r/replaceAll^%wfhfrom w/
"RTN","SAMICUL",68,0)
 ; replaceAll^%wf, r/$$getTemplate^%wfhform w/$$getTemplate^%wf.
"RTN","SAMICUL",69,0)
 ;
"RTN","SAMICUL",70,0)
 ; 2018-02-14 ven/toad 18.0-t4
"RTN","SAMICUL",71,0)
 ;  SAMICASE r/replaceAll^%wf w/findReplaceAll^%wf, r/ln w/line, add
"RTN","SAMICUL",72,0)
 ; @calls & @called-by tags, break up some long lines.
"RTN","SAMICUL",73,0)
 ;
"RTN","SAMICUL",74,0)
 ; 2018-02-27 ven/gpl 18.0-t4
"RTN","SAMICUL",75,0)
 ;  SAMICASE new subroutines $$KEY2DSPD, $$GETDTKEY; in wsCASE get
"RTN","SAMICUL",76,0)
 ; 1st & last names from graph, fix paths, key forms in graph w/date.
"RTN","SAMICUL",77,0)
 ;
"RTN","SAMICUL",78,0)
 ; 2018-03-01 ven/toad 18.0-t4
"RTN","SAMICUL",79,0)
 ;  SAMICASE refactor & reorganize new code, add header comments, r/
"RTN","SAMICUL",80,0)
 ; findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",81,0)
 ;
"RTN","SAMICUL",82,0)
 ; 2018-03-06 ven/gpl 18.0-t4
"RTN","SAMICUL",83,0)
 ;  SAMICASE add New Form button, list rest of forms for patient, add
"RTN","SAMICUL",84,0)
 ; web services wsNuForm & wsNuFormPost & method MKCEFORM, extend
"RTN","SAMICUL",85,0)
 ; GETITEMS to get rest of forms.
"RTN","SAMICUL",86,0)
 ;
"RTN","SAMICUL",87,0)
 ; 2018-03-07/08 ven/toad 18.0-t4
"RTN","SAMICUL",88,0)
 ;  SAMICASE merge George changes w/ rest, add white space, spell out
"RTN","SAMICUL",89,0)
 ; M elements, add hdr comments to new subroutines, r/findReplace^%wf
"RTN","SAMICUL",90,0)
 ; & replaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",91,0)
 ;
"RTN","SAMICUL",92,0)
 ; 2018-03-11 ven/gpl 18.0-t4 9bd663ee
"RTN","SAMICUL",93,0)
 ;  SAMICAS2 vapals forms working.
"RTN","SAMICUL",94,0)
 ;
"RTN","SAMICUL",95,0)
 ; 2018-03-12 ven/gpl 18.0-t4 8c36c6a7
"RTN","SAMICUL",96,0)
 ;  SAMICAS2 new form works now & charts on home page.
"RTN","SAMICUL",97,0)
 ;
"RTN","SAMICUL",98,0)
 ; 2018-03-14 ven/gpl 18.0-t4 9653650a
"RTN","SAMICUL",99,0)
 ;  SAMICAS2 revised casereview page link, fixed external url
"RTN","SAMICUL",100,0)
 ; preservation.
"RTN","SAMICUL",101,0)
 ;
"RTN","SAMICUL",102,0)
 ; 2018-03-21 ven/gpl 18.0-t4 48868561
"RTN","SAMICUL",103,0)
 ;  SAMICAS2 max date insertion, case review navigation changed to
"RTN","SAMICUL",104,0)
 ; post, date order for CT Eval in case review.
"RTN","SAMICUL",105,0)
 ;
"RTN","SAMICUL",106,0)
 ; 2018-03-26 ven/gpl 18.0-t4 5fa4ee96
"RTN","SAMICUL",107,0)
 ;  SAMICAS2 changes to support incomplete forms display &
"RTN","SAMICUL",108,0)
 ; processing.
"RTN","SAMICUL",109,0)
 ;
"RTN","SAMICUL",110,0)
 ; 2018-03-27 ven/gpl 18.0-t4 cace9756
"RTN","SAMICUL",111,0)
 ;  SAMICAS2 siforms are always complete.
"RTN","SAMICUL",112,0)
 ;
"RTN","SAMICUL",113,0)
 ; 2018-04-02 ven/gpl 18.0-t4 00da9146
"RTN","SAMICUL",114,0)
 ;  SAMICAS2 added followup form.
"RTN","SAMICUL",115,0)
 ;
"RTN","SAMICUL",116,0)
 ; 2018-04-24 ven/gpl 18.0-t4 22e39d87
"RTN","SAMICUL",117,0)
 ;  SAMICAS2 added pet & biopsy forms.
"RTN","SAMICUL",118,0)
 ;
"RTN","SAMICUL",119,0)
 ; 2018-05-01 ven/gpl 18.0-t4 f1751c43
"RTN","SAMICUL",120,0)
 ;  SAMICAS2 fix problem with new forms: followup & pet.
"RTN","SAMICUL",121,0)
 ;
"RTN","SAMICUL",122,0)
 ; 2018-05-18 ven/lgc 18.0-t4 9eba8f8c
"RTN","SAMICUL",123,0)
 ;  SAMICAS2 conversion to new graph and simplified forms processing.
"RTN","SAMICUL",124,0)
 ;
"RTN","SAMICUL",125,0)
 ; 2018-05-21 ven/lgc 18.0-t4 0d7ed2f7
"RTN","SAMICUL",126,0)
 ;  SAMICAS2 changes for new navigation html.
"RTN","SAMICUL",127,0)
 ;
"RTN","SAMICUL",128,0)
 ; 2018-06-14 ven/lgc 18.0-t4 d71f4fe4
"RTN","SAMICUL",129,0)
 ;  SAMICAS2 changes to make the background form optional.
"RTN","SAMICUL",130,0)
 ;
"RTN","SAMICUL",131,0)
 ; 2018-06-20 ven/lgc 18.0-t4 bf03b07f
"RTN","SAMICUL",132,0)
 ;  SAMICAS2 corrections for new forms processing navigation.
"RTN","SAMICUL",133,0)
 ;
"RTN","SAMICUL",134,0)
 ; 2018-07-01 ven/lgc 18.0-t4 2e1541dc,8b0a4329
"RTN","SAMICUL",135,0)
 ;  SAMICAS2 add intervention forms to case review page, 1st version
"RTN","SAMICUL",136,0)
 ; of ct eval report.
"RTN","SAMICUL",137,0)
 ;
"RTN","SAMICUL",138,0)
 ; 2018-07-04 ven/lgc 18.0-t4 b28c1658
"RTN","SAMICUL",139,0)
 ;  SAMICAS2 fix a typo.
"RTN","SAMICUL",140,0)
 ;
"RTN","SAMICUL",141,0)
 ; 2018-07-10 ven/lgc 18.0-t4 2e9662b4
"RTN","SAMICUL",142,0)
 ;  SAMICAS2 repair SAMIHOM3 & redact report link.
"RTN","SAMICUL",143,0)
 ;
"RTN","SAMICUL",144,0)
 ; 2018-08-19 ven/lgc 18.0-t4 2ce0cab4
"RTN","SAMICUL",145,0)
 ;  SAMICAS2 use ssn instead of last5 where available.
"RTN","SAMICUL",146,0)
 ;
"RTN","SAMICUL",147,0)
 ; 2018-08-20 ven/lgc 18.0-t4 955fd484
"RTN","SAMICUL",148,0)
 ;  SAMICAS2 fix case review page cr lf issue.
"RTN","SAMICUL",149,0)
 ;
"RTN","SAMICUL",150,0)
 ; 2018-08-22 ven/gpl 18.0-t4 d67a2fe5
"RTN","SAMICUL",151,0)
 ;  SAMICAS2 turn off ctreport.
"RTN","SAMICUL",152,0)
 ;
"RTN","SAMICUL",153,0)
 ; 2018-08-30 ven/lgc 18.0-t4 125f1c8b
"RTN","SAMICUL",154,0)
 ;  SAMICAS2 add type index to getItems to help find last previous
"RTN","SAMICUL",155,0)
 ; form of a type.
"RTN","SAMICUL",156,0)
 ;
"RTN","SAMICUL",157,0)
 ; 2018-09-04 ven/lgc 18.0-t4 3e6e326f
"RTN","SAMICUL",158,0)
 ;  SAMICAS2 hide report link.
"RTN","SAMICUL",159,0)
 ;
"RTN","SAMICUL",160,0)
 ; 2018-10-14 ven/lgc 18.0-t4 f6e1229f
"RTN","SAMICUL",161,0)
 ;  SAMICAS2 turn on copy forward for cteval new forms.
"RTN","SAMICUL",162,0)
 ;
"RTN","SAMICUL",163,0)
 ; 2018-10-26 ven/lgc 18.0-t4 f19bf1ae
"RTN","SAMICUL",164,0)
 ;  SAMICAS2 ability to add multiple forms on same day.
"RTN","SAMICUL",165,0)
 ;
"RTN","SAMICUL",166,0)
 ; 2018-11-07 ven/gpl 18.0-t4 c76b2eac
"RTN","SAMICUL",167,0)
 ;  SAMICAS2 defend against unit test patient 1.
"RTN","SAMICUL",168,0)
 ;
"RTN","SAMICUL",169,0)
 ; 2018-11-13 ven/toad 18.0-t4
"RTN","SAMICUL",170,0)
 ;  SAMICAS2 SAMIHOM2 > SAMIHOM3.
"RTN","SAMICUL",171,0)
 ;
"RTN","SAMICUL",172,0)
 ; 2018-11-14 ven/lgc 18.0-t4 6e9799ba
"RTN","SAMICUL",173,0)
 ;  SAMICUL fix graphstore forms.
"RTN","SAMICUL",174,0)
 ;
"RTN","SAMICUL",175,0)
 ; 2018-11-28 ven/lgc 18.0-t4 a9539464
"RTN","SAMICUL",176,0)
 ;  SAMICAS2 work on sac compliance.
"RTN","SAMICUL",177,0)
 ;
"RTN","SAMICUL",178,0)
 ; 2018-12-11 ven/lgc 18.0-t4 3ceb74b5
"RTN","SAMICUL",179,0)
 ;  SAMICAS2 update for sac compliance.
"RTN","SAMICUL",180,0)
 ;
"RTN","SAMICUL",181,0)
 ; 2018-12-19/20 ven/lgc 18.0-t4 7a5d3400,a14554c1
"RTN","SAMICUL",182,0)
 ;  SAMICAS2 more sac compliance, r/^gpl w/^SAMIGPL.
"RTN","SAMICUL",183,0)
 ;
"RTN","SAMICUL",184,0)
 ; 2018-12-26 ven/lgc 18.0-t4 8dd6f34d,51eb1635
"RTN","SAMICUL",185,0)
 ;  SAMICAS2 update for sac compliance, fix accidental reversions.
"RTN","SAMICUL",186,0)
 ;
"RTN","SAMICUL",187,0)
 ; 2019-01-10 ven/lgc 18.0-t4 2daba010
"RTN","SAMICUL",188,0)
 ;  SAMICAS2 update for SAC compliance.
"RTN","SAMICUL",189,0)
 ;
"RTN","SAMICUL",190,0)
 ; 2019-01-22 ven/lgc 18.0-t4 53681219,5ddb29c5
"RTN","SAMICUL",191,0)
 ;  SAMICAS2 add license info to each SAMI routine; edit for lower
"RTN","SAMICUL",192,0)
 ; case initials.
"RTN","SAMICUL",193,0)
 ;
"RTN","SAMICUL",194,0)
 ; 2019-02-18 ven/lgc 18.0-t4 76874314
"RTN","SAMICUL",195,0)
 ;  SAMICAS2,SAMICAS3 update recently edited routines.
"RTN","SAMICUL",196,0)
 ;
"RTN","SAMICUL",197,0)
 ; 2019-03-13 ven/lmry 18.0-t4 ef66ef16
"RTN","SAMICUL",198,0)
 ;  SAMICAS2 spell out some elements missed earlier.
"RTN","SAMICUL",199,0)
 ;
"RTN","SAMICUL",200,0)
 ; 2019-03-14 ven/lmry 18.0-t4 038507e2
"RTN","SAMICUL",201,0)
 ;  SAMICAS3 spell out some missed M elements, fix copy/paste errors
"RTN","SAMICUL",202,0)
 ; in comments for MKFUFORM, MKBXFORM, & MKPTFORM.
"RTN","SAMICUL",203,0)
 ;
"RTN","SAMICUL",204,0)
 ; 2019-04-16 ven/lgc 18.0-t4 e54b76d1
"RTN","SAMICUL",205,0)
 ;  SAMICAS2 update for SAMIFORM project.
"RTN","SAMICUL",206,0)
 ;
"RTN","SAMICUL",207,0)
 ; 2019-04-23 ven/gpl 18.0-t4 ce322911
"RTN","SAMICUL",208,0)
 ;  SAMICAS2 add intake notes to case review page.
"RTN","SAMICUL",209,0)
 ;
"RTN","SAMICUL",210,0)
 ; 2019-06-18 ven/lgc 18.0-t4 91022482
"RTN","SAMICUL",211,0)
 ;  SAMICAS3 switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMICUL",212,0)
 ;
"RTN","SAMICUL",213,0)
 ; 2019-07-01 ven/gpl 18.0-t4 cc87cc44
"RTN","SAMICUL",214,0)
 ;  SAMICAS3 prevent >1 bkgd form/patient.
"RTN","SAMICUL",215,0)
 ;
"RTN","SAMICUL",216,0)
 ; 2019-07-07 ven/gpl 18.0-t4 776f7451
"RTN","SAMICUL",217,0)
 ;  SAMICAS3 resolving can't create bkgd form, branch messed up.
"RTN","SAMICUL",218,0)
 ;
"RTN","SAMICUL",219,0)
 ; 2019-08-01 ven/lgc 18.0-t4 d710f27d
"RTN","SAMICUL",220,0)
 ;  SAMICAS2 pull displayed facility code from Vista parameter.
"RTN","SAMICUL",221,0)
 ;
"RTN","SAMICUL",222,0)
 ; 2019-09-26 ven/gpl 18.0-t4 92b12324 vap-420
"RTN","SAMICUL",223,0)
 ;  SAMICAS3 prefill form date & date of baseline ct on new followup
"RTN","SAMICUL",224,0)
 ; form.
"RTN","SAMICUL",225,0)
 ;
"RTN","SAMICUL",226,0)
 ; 2019-10-01 par/ddn 18.0-t4 4caf1a98 vap-344
"RTN","SAMICUL",227,0)
 ;  SAMICAS2 use proper capitalization of the word "veteran".
"RTN","SAMICUL",228,0)
 ;
"RTN","SAMICUL",229,0)
 ; 2020-01-11 ven/lgc 18.1 5651698a
"RTN","SAMICUL",230,0)
 ;  SAMICAS2,SAMICAS3 fix duplicate form overwriting.
"RTN","SAMICUL",231,0)
 ;
"RTN","SAMICUL",232,0)
 ; 2020-01-17 ven/lgc 18.1 8557207f
"RTN","SAMICUL",233,0)
 ;  SAMICAS2 followup note.
"RTN","SAMICUL",234,0)
 ;
"RTN","SAMICUL",235,0)
 ; 2020-01-25 ven/lgc 18.3 6a07a860,6a947567
"RTN","SAMICUL",236,0)
 ;  SAMICAS3 nodule copy & fix to ru, fix subtle bug in nodule copy.
"RTN","SAMICUL",237,0)
 ;
"RTN","SAMICUL",238,0)
 ; 2020-04-11 ven/gpl 18.5 666f5b91,2f2c29c1
"RTN","SAMICUL",239,0)
 ;  SAMICAS2 multi-tenancy.
"RTN","SAMICUL",240,0)
 ;
"RTN","SAMICUL",241,0)
 ; 2020-05-12 ven/gpl 18.5 ad11e0ea
"RTN","SAMICUL",242,0)
 ;  SAMICAS2 fix SITE on case review page.
"RTN","SAMICUL",243,0)
 ;
"RTN","SAMICUL",244,0)
 ; 2020-11-12 ven/gpl 18.9 cec1ccd6
"RTN","SAMICUL",245,0)
 ;  SAMICAS2,SAMICAS3 ceform date refill upgrade.
"RTN","SAMICUL",246,0)
 ;
"RTN","SAMICUL",247,0)
 ; 2020-11-13 ven/gpl 18.9 dce3c568
"RTN","SAMICUL",248,0)
 ;  SAMICAS3 prefill ceform prior scans text field.
"RTN","SAMICUL",249,0)
 ;
"RTN","SAMICUL",250,0)
 ; 2021-02-18 ven/gpl 18.9 af2a0b8a
"RTN","SAMICUL",251,0)
 ;  SAMICAS3 copy last previous CT nodules instead of last nodules in
"RTN","SAMICUL",252,0)
 ; any form.
"RTN","SAMICUL",253,0)
 ;
"RTN","SAMICUL",254,0)
 ; 2021-02-21 ven/gpl 18.9 3fd704fb
"RTN","SAMICUL",255,0)
 ;  SAMICAS3 fix bug in prefill logic.
"RTN","SAMICUL",256,0)
 ;
"RTN","SAMICUL",257,0)
 ; 2021-03-02 ven/gpl 18.9 479dc041
"RTN","SAMICUL",258,0)
 ;  SAMICAS2 return error msg if no CT Eval form exists when
"RTN","SAMICUL",259,0)
 ; generating a FU note.
"RTN","SAMICUL",260,0)
 ;
"RTN","SAMICUL",261,0)
 ; 2021-03-10 ven/toad 18.9 a46a2cc1
"RTN","SAMICUL",262,0)
 ;  SAMICUL update log, convert to new vistaver schema.
"RTN","SAMICUL",263,0)
 ;  SAMICAS2,SAMICAS3 bump date & patch list, update contents, lt
"RTN","SAMICUL",264,0)
 ; refactor.
"RTN","SAMICUL",265,0)
 ;
"RTN","SAMICUL",266,0)
 ; 2021-03-17 ven/toad 18.9 62da30b
"RTN","SAMICUL",267,0)
 ;  SAMICAS2 fix xindex errors: in WSCASE add missing space between
"RTN","SAMICUL",268,0)
 ; do & comment to prevent syntax error reported as block mismatch.
"RTN","SAMICUL",269,0)
 ;  SAMICAS3 remove extra spaces at ends of 3 lines.
"RTN","SAMICUL",270,0)
 ;
"RTN","SAMICUL",271,0)
 ; 2021-04-16 ven/gpl 18.11 ac82eec
"RTN","SAMICUL",272,0)
 ;  SAMICAS3 include baseline scan in prior scans field on prefill.
"RTN","SAMICUL",273,0)
 ;
"RTN","SAMICUL",274,0)
 ; 2021-05-14/19 ven/gpl 18.11 0cbee7b,a21b056,139c6a5,0a0cccc
"RTN","SAMICUL",275,0)
 ;  SAMICAS3 improved CT eval prefill of past scan dates, urgent
"RTN","SAMICUL",276,0)
 ; fixes to CT Report & intervention & pet form prefill.
"RTN","SAMICUL",277,0)
 ;
"RTN","SAMICUL",278,0)
 ; 2021-05-20/21 ven/mcglk&toad 18.11 43a4557,424ea11,129e96b
"RTN","SAMICUL",279,0)
 ;  SAMICAS3 bump version & dates.
"RTN","SAMICUL",280,0)
 ;
"RTN","SAMICUL",281,0)
 ; 2021-05-24 ven/gpl 18.11 4aba1a9
"RTN","SAMICUL",282,0)
 ;  SAMICAS3 in MKCEFORM,MKPTFORM,MKBXFORM pass key to
"RTN","SAMICUL",283,0)
 ; CTCOPY^SAMICTC1 to modulate node-copy operation; critical fix to
"RTN","SAMICUL",284,0)
 ; copy forward for is it new field for new ct eval forms.
"RTN","SAMICUL",285,0)
 ;
"RTN","SAMICUL",286,0)
 ; 2021-05-25 ven/toad 18.11 801d7c74
"RTN","SAMICUL",287,0)
 ;  SAMICAS3 bump date; passim lt refactor.
"RTN","SAMICUL",288,0)
 ;
"RTN","SAMICUL",289,0)
 ; 2021-05-26/27 ven/gpl 18.11 6edc0610,73728821
"RTN","SAMICUL",290,0)
 ;  SAMICAS3 in MKITFORM add new nodule-copy block to copy forward
"RTN","SAMICUL",291,0)
 ; for intervention form; in LASTCMP,PRIORCMP init tdt to today to
"RTN","SAMICUL",292,0)
 ; start before today, to fix last comp & prior scan field prefill in
"RTN","SAMICUL",293,0)
 ; ct eval form.
"RTN","SAMICUL",294,0)
 ;
"RTN","SAMICUL",295,0)
 ; 2021-06-01 ven/toad 18.11 7dd9410c
"RTN","SAMICUL",296,0)
 ;  SAMICAS3 fold in gpl chgs fr 2021-05-26/27, annotate, adjust news
"RTN","SAMICUL",297,0)
 ; in nodule copy blocks, bump date.
"RTN","SAMICUL",298,0)
 ;
"RTN","SAMICUL",299,0)
 ; 2021-06-29 ven/gpl 18.12 50d3998b,a5bbd37a
"RTN","SAMICUL",300,0)
 ;  SAMICAS3 in LASTCMP fix bug that excluded ct forms from today in
"RTN","SAMICUL",301,0)
 ; date list, init tdt to today+1 to start today; text-box formatting
"RTN","SAMICUL",302,0)
 ; for intake & followup notes, new text-processing utils; in MKFUFORM
"RTN","SAMICUL",303,0)
 ; set basedt to $$BASELNDT or $$LASTCMP or now.
"RTN","SAMICUL",304,0)
 ;
"RTN","SAMICUL",305,0)
 ; 2021-06-30/07-06 ven/mcglk&toad&gpl 18.12 cbf7e46b,d8296fda,
"RTN","SAMICUL",306,0)
 ; b248664b
"RTN","SAMICUL",307,0)
 ;  SAMICASE,2,3 bump version & dates.
"RTN","SAMICUL",308,0)
 ;  SAMICAS3 in MKFUFORM,LASTCMP update calls & called-by.
"RTN","SAMICUL",309,0)
 ;  SAMICASE,2,3 finish converting to ppi format, annotate; fix typos.
"RTN","SAMICUL",310,0)
 ;
"RTN","SAMICUL",311,0)
 ; 2021-08-01 ven/gpl 18.12 5bd7c627,50620b8b
"RTN","SAMICUL",312,0)
 ;  SAMICAS2 set intake form to incomplete on creation: in GSAMISTA
"RTN","SAMICUL",313,0)
 ; add final line to conditionally set stat="incomplete".
"RTN","SAMICUL",314,0)
 ;  SAMICAS3 exclude current date from last compare field when prev ct
"RTN","SAMICUL",315,0)
 ; report exists: in LASTCMP start w/before today; in PRIORCMP add
"RTN","SAMICUL",316,0)
 ; line to handle retstr="".
"RTN","SAMICUL",317,0)
 ;
"RTN","SAMICUL",318,0)
 ; 2021-10-04/05 ven gpl 18.14 ec3b6e5d
"RTN","SAMICUL",319,0)
 ;  SAMICAS2 updated date format, bumped date and version.
"RTN","SAMICUL",320,0)
 ;
"RTN","SAMICUL",321,0)
 ;@contents
"RTN","SAMICUL",322,0)
 ; SAMICASE case review
"RTN","SAMICUL",323,0)
 ; SAMICAS2 case review continued
"RTN","SAMICUL",324,0)
 ; SAMICAS3 case review continued
"RTN","SAMICUL",325,0)
 ; SAMICUL case review log
"RTN","SAMICUL",326,0)
 ;
"RTN","SAMICUL",327,0)
 ;
"RTN","SAMICUL",328,0)
 ;
"RTN","SAMICUL",329,0)
EOR ; end of routine SAMICUL
"RTN","SAMIPAT")
0^4^B9183353
"RTN","SAMIPAT",1,0)
SAMIPAT ;ven/toad - init subroutines ;2021-09-10t01:30z
"RTN","SAMIPAT",2,0)
 ;;18.0;SAMI;**12,14**;2020-01;Build 8
"RTN","SAMIPAT",3,0)
 ;;18.14
"RTN","SAMIPAT",4,0)
 ;
"RTN","SAMIPAT",5,0)
 ; Routine SAMIPAT contains VAPALS-ELCAP initialization subroutines
"RTN","SAMIPAT",6,0)
 ; to use as KIDS pre- & post-installs & environment checks.
"RTN","SAMIPAT",7,0)
 ;
"RTN","SAMIPAT",8,0)
 quit  ; no entry from top
"RTN","SAMIPAT",9,0)
 ;
"RTN","SAMIPAT",10,0)
 ;
"RTN","SAMIPAT",11,0)
 ;
"RTN","SAMIPAT",12,0)
 ;@section 0 primary development
"RTN","SAMIPAT",13,0)
 ;
"RTN","SAMIPAT",14,0)
 ;
"RTN","SAMIPAT",15,0)
 ;
"RTN","SAMIPAT",16,0)
 ;@routine-credits
"RTN","SAMIPAT",17,0)
 ;@dev-main Frederick D. S. Marshall (toad)
"RTN","SAMIPAT",18,0)
 ; toad@vistaexpertise.net
"RTN","SAMIPAT",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIPAT",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIPAT",21,0)
 ;@copyright 2021, toad, all rights reserved
"RTN","SAMIPAT",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIPAT",23,0)
 ;
"RTN","SAMIPAT",24,0)
 ;@last-update 2021-09-10t01:39z
"RTN","SAMIPAT",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIPAT",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIPAT",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIPAT",28,0)
 ;@version 18.14
"RTN","SAMIPAT",29,0)
 ;@release-date 2020-01
"RTN","SAMIPAT",30,0)
 ;@patch-list **12,14**
"RTN","SAMIPAT",31,0)
 ;
"RTN","SAMIPAT",32,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIPAT",33,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIPAT",34,0)
 ;@dev-add George P. Lilly (gpl)
"RTN","SAMIPAT",35,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIPAT",36,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIPAT",37,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIPAT",38,0)
 ;
"RTN","SAMIPAT",39,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIPAT",40,0)
 ; 2021-07-01 ven/mcglk&toad 18.12-t2 cbf7e46b
"RTN","SAMIPAT",41,0)
 ;  SAMIPAT new routine, new POS1812 post-install for patch 12.
"RTN","SAMIPAT",42,0)
 ;
"RTN","SAMIPAT",43,0)
 ; 2021-07-22/23 ven/toad 18.12  
"RTN","SAMIPAT",44,0)
 ;  SAMIPAT add PRE1812 pre-install.
"RTN","SAMIPAT",45,0)
 ;
"RTN","SAMIPAT",46,0)
 ; 2021-08-11 ven/mcglk&toad 18.12  b16cd38f
"RTN","SAMIPAT",47,0)
 ;  SAMIPAT rip out PRE1812.
"RTN","SAMIPAT",48,0)
 ;
"RTN","SAMIPAT",49,0)
 ; 2021-09-08 ven/lmry 18.14  2af1f2e7
"RTN","SAMIPAT",50,0)
 ;  SAMIPAT add post-install for patch SAMI*1.18*14
"RTN","SAMIPAT",51,0)
 ;
"RTN","SAMIPAT",52,0)
 ;@contents
"RTN","SAMIPAT",53,0)
 ; POS1812 kids post-install for sami 18.12
"RTN","SAMIPAT",54,0)
 ; POS1814 kids post-install for sami 18.14
"RTN","SAMIPAT",55,0)
 ;
"RTN","SAMIPAT",56,0)
 ;@section 1 subroutines for SAMI 18.12
"RTN","SAMIPAT",57,0)
 ;
"RTN","SAMIPAT",58,0)
 ;
"RTN","SAMIPAT",59,0)
 ;
"RTN","SAMIPAT",60,0)
 ;@kids-post POST1812^SAMIPAT
"RTN","SAMIPAT",61,0)
POS1812 ; kids post-install for sami 18.12
"RTN","SAMIPAT",62,0)
 ;
"RTN","SAMIPAT",63,0)
 do ADDSVC^SAMIPARM ; install get params web service
"RTN","SAMIPAT",64,0)
 ;
"RTN","SAMIPAT",65,0)
 ; in honor of Tchaikovsky's overture: boom
"RTN","SAMIPAT",66,0)
 ;
"RTN","SAMIPAT",67,0)
 quit  ; end of kids-post POS1812^SAMIPAT
"RTN","SAMIPAT",68,0)
 ;
"RTN","SAMIPAT",69,0)
 ;
"RTN","SAMIPAT",70,0)
 ;
"RTN","SAMIPAT",71,0)
 ;@section 2 subroutines for SAMI 18.14
"RTN","SAMIPAT",72,0)
 ;
"RTN","SAMIPAT",73,0)
 ;
"RTN","SAMIPAT",74,0)
 ;
"RTN","SAMIPAT",75,0)
 ;@kids-post POST1814^SAMIPAT
"RTN","SAMIPAT",76,0)
POS1814 ; kids post-install for sami 18.14
"RTN","SAMIPAT",77,0)
 ;
"RTN","SAMIPAT",78,0)
 set SAMIDIR="/home/osehra/lib/silver/a-sami-vapals-elcap--vo-osehra-github/docs/form-fields/"
"RTN","SAMIPAT",79,0)
 do PRSTSV^SAMIFF(SAMIDIR,"background.tsv","form fields - background")
"RTN","SAMIPAT",80,0)
 do PRSTSV^SAMIFF(SAMIDIR,"biopsy.tsv","form fields - biopsy")
"RTN","SAMIPAT",81,0)
 do PRSTSV^SAMIFF(SAMIDIR,"ct-evaluation.tsv","form fields - ct evaluation")
"RTN","SAMIPAT",82,0)
 do PRSTSV^SAMIFF(SAMIDIR,"follow-up.tsv","form fields - follow up")
"RTN","SAMIPAT",83,0)
 do PRSTSV^SAMIFF(SAMIDIR,"intake.tsv","form fields - intake")
"RTN","SAMIPAT",84,0)
 do PRSTSV^SAMIFF(SAMIDIR,"intervention.tsv","form fields - intervention")
"RTN","SAMIPAT",85,0)
 do PRSTSV^SAMIFF(SAMIDIR,"pet-evaluation.tsv","form fields - pet evaluation")
"RTN","SAMIPAT",86,0)
 do PRSTSV^SAMIFF(SAMIDIR,"register.tsv","form fields - register")
"RTN","SAMIPAT",87,0)
 ; do DODD^SAMIADMN ; to import tsv files to generate DD graphs
"RTN","SAMIPAT",88,0)
 do CLRWEB^SAMIADMN ; Clear the M Web Server files cache
"RTN","SAMIPAT",89,0)
 do INIT2GPH^SAMICTD2 ; initialize CTEVAL dictionary into graph cteval-dict
"RTN","SAMIPAT",90,0)
 ;
"RTN","SAMIPAT",91,0)
 quit  ; end of kids-post POS1814^SAMIPAT
"RTN","SAMIPAT",92,0)
 ;
"RTN","SAMIPAT",93,0)
 ;
"RTN","SAMIPAT",94,0)
 ;
"RTN","SAMIPAT",95,0)
 ;@section 3 subroutines for future versions...
"RTN","SAMIPAT",96,0)
 ;
"RTN","SAMIPAT",97,0)
 ;
"RTN","SAMIPAT",98,0)
 ;
"RTN","SAMIPAT",99,0)
EOR ; end of routine SAMIPAT
"RTN","SAMISITE")
0^7^B95807248
"RTN","SAMISITE",1,0)
SAMISITE ;ven/gpl&arc - signon & site access ;2021-10-05t22:54z
"RTN","SAMISITE",2,0)
 ;;18.0;SAMI;**5,12,14**;2020-01;Build 8
"RTN","SAMISITE",3,0)
 ;;18.14
"RTN","SAMISITE",4,0)
 ;
"RTN","SAMISITE",5,0)
 ; Routine SAMISITE contains subroutines for implementing the VAPALS-
"RTN","SAMISITE",6,0)
 ; ELCAP 
"RTN","SAMISITE",7,0)
 ;
"RTN","SAMISITE",8,0)
 quit  ; no entry from top
"RTN","SAMISITE",9,0)
 ;
"RTN","SAMISITE",10,0)
 ;
"RTN","SAMISITE",11,0)
 ;
"RTN","SAMISITE",12,0)
 ;@section 0 primary development
"RTN","SAMISITE",13,0)
 ;
"RTN","SAMISITE",14,0)
 ;
"RTN","SAMISITE",15,0)
 ;
"RTN","SAMISITE",16,0)
 ;@routine-credits
"RTN","SAMISITE",17,0)
 ;@dev-main: George P. Lilly (gpl)
"RTN","SAMISITE",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMISITE",19,0)
 ;@dev-org-main: Vista Expertise Network (ven)
"RTN","SAMISITE",20,0)
 ; http://vistaexpertise.net
"RTN","SAMISITE",21,0)
 ;@copyright: 2017/2021, gpl, all rights reserved
"RTN","SAMISITE",22,0)
 ;@license see routine SAMIUL
"RTN","SAMISITE",23,0)
 ;
"RTN","SAMISITE",24,0)
 ;@last-update 2021-10-05t22:54z
"RTN","SAMISITE",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMISITE",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMISITE",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMISITE",28,0)
 ;@version 18.14
"RTN","SAMISITE",29,0)
 ;@release-date 2020-01
"RTN","SAMISITE",30,0)
 ;@patch-list **5,12,14**
"RTN","SAMISITE",31,0)
 ;
"RTN","SAMISITE",32,0)
 ;@dev-add: Alexis Carlson (arc)
"RTN","SAMISITE",33,0)
 ; alexis@vistaexpertise.net
"RTN","SAMISITE",34,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMISITE",35,0)
 ; toad@vistaexpertise.net
"RTN","SAMISITE",36,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMISITE",37,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMISITE",38,0)
 ;
"RTN","SAMISITE",39,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMISITE",40,0)
 ; 2020-04-02/05-26 ven/gpl 1.18.0.5+i5 d36b7cad,36607664,521e0bdc,
"RTN","SAMISITE",41,0)
 ; d018f52e,156be19e,476b2ff4,0a1538ef
"RTN","SAMISITE",42,0)
 ;  SAMISITE add multitenancy, fix bug in logout, fix sitetitle on 1st
"RTN","SAMISITE",43,0)
 ; time in, add superuser site selection feature, fix bug in cache.
"RTN","SAMISITE",44,0)
 ;
"RTN","SAMISITE",45,0)
 ; 2021-06-05 ven/gpl 18.12-t2 223b5900
"RTN","SAMISITE",46,0)
 ;  SAMISITE upgrade parameter with system overrides, add
"RTN","SAMISITE",47,0)
 ; systemDemoOnly & systemDemoUseDUZ parameters.
"RTN","SAMISITE",48,0)
 ;
"RTN","SAMISITE",49,0)
 ; 2021-07-01/07 ven/mcglk&toad&gpl 18.12-t2 cbf7e46b,bfeea24b,
"RTN","SAMISITE",50,0)
 ; 1dd91fea
"RTN","SAMISITE",51,0)
 ;  SAMISITE bump version & dates, add hdr comments & dev log; in
"RTN","SAMISITE",52,0)
 ; FINDSITE add missing 0 to quit.
"RTN","SAMISITE",53,0)
 ;
"RTN","SAMISITE",54,0)
 ; 2021-09-17 ven/gpl 18.14  1d01f4bd
"RTN","SAMISITE",55,0)
 ;  SAMISITE accept username and password as alternates to access and 
"RTN","SAMISITE",56,0)
 ; verify for login
"RTN","SAMISITE",57,0)
 ;
"RTN","SAMISITE",58,0)
 ; 2021-10-06 ven/lmry 18.14
"RTN","SAMISITE",59,0)
 ;  SAMISITE bump version & dates
"RTN","SAMISITE",60,0)
 ;
"RTN","SAMISITE",61,0)
 ;@to-do
"RTN","SAMISITE",62,0)
 ; Add label comments
"RTN","SAMISITE",63,0)
 ;
"RTN","SAMISITE",64,0)
 ;@contents
"RTN","SAMISITE",65,0)
 ; $$FINDSITE current site for user
"RTN","SAMISITE",66,0)
 ; $$USER ien of user accessing system
"RTN","SAMISITE",67,0)
 ; $$SITE ien of institution file entry for user's site
"RTN","SAMISITE",68,0)
 ; $$SITEID symbol for site
"RTN","SAMISITE",69,0)
 ; $$SITEACTV is site active?
"RTN","SAMISITE",70,0)
 ; $$SITENM site name from ien
"RTN","SAMISITE",71,0)
 ; $$SITENM2 site name from symbol
"RTN","SAMISITE",72,0)
 ; LOGIN login processing
"RTN","SAMISITE",73,0)
 ; $$SIGNON signon with access & verify code
"RTN","SAMISITE",74,0)
 ; SUPER site selection page for super users
"RTN","SAMISITE",75,0)
 ; UPGRADE init: convert to multi-tenancy
"RTN","SAMISITE",76,0)
 ;
"RTN","SAMISITE",77,0)
 ;
"RTN","SAMISITE",78,0)
 ;
"RTN","SAMISITE",79,0)
 ;@section 1 subroutines
"RTN","SAMISITE",80,0)
 ;
"RTN","SAMISITE",81,0)
 ;
"RTN","SAMISITE",82,0)
 ;
"RTN","SAMISITE",83,0)
FINDSITE(SAMIRETURN,ARGS) ; extrinsic which returns the site
"RTN","SAMISITE",84,0)
 ; to be used by this user: ARGS("siteid")=siteid and
"RTN","SAMISITE",85,0)
 ; ARGS("sitetitle")=sitename - siteid
"RTN","SAMISITE",86,0)
 ; 1 for success 
"RTN","SAMISITE",87,0)
 ; 0 for fail - exit; page to be displayed is in SAMIRETURN
"RTN","SAMISITE",88,0)
 ;
"RTN","SAMISITE",89,0)
 ;d ^ZTER
"RTN","SAMISITE",90,0)
 n user
"RTN","SAMISITE",91,0)
 s user=$$USER()
"RTN","SAMISITE",92,0)
 i user=-1 d  q 0
"RTN","SAMISITE",93,0)
 . n vals
"RTN","SAMISITE",94,0)
 . s vals("siteid")=""
"RTN","SAMISITE",95,0)
 . s vals("sitetitle")="Unknown Site"
"RTN","SAMISITE",96,0)
 . s vals("errorMessage")=""
"RTN","SAMISITE",97,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:login",.vals)
"RTN","SAMISITE",98,0)
 . ;s ARGS("errorMessage")="Error, user not found"
"RTN","SAMISITE",99,0)
 . ;d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",100,0)
 ;
"RTN","SAMISITE",101,0)
 ;d  q 0
"RTN","SAMISITE",102,0)
 ;. s ARGS("errorMessage")="User is found: "_user
"RTN","SAMISITE",103,0)
 ;. d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",104,0)
 ;
"RTN","SAMISITE",105,0)
 n site,siteid,siteactv,sitenm
"RTN","SAMISITE",106,0)
 ;
"RTN","SAMISITE",107,0)
 i $o(^SAMI(311.13,"B",user,""))'="" d  q 0 ; superuser
"RTN","SAMISITE",108,0)
 . d SUPER("SAMIRETURN",.ARGS)
"RTN","SAMISITE",109,0)
 . s HTTPRSP("mime")="text/html"
"RTN","SAMISITE",110,0)
 ;
"RTN","SAMISITE",111,0)
 s site=$$SITE(user)
"RTN","SAMISITE",112,0)
 i site<1 s site=-1
"RTN","SAMISITE",113,0)
 i site=-1 d  q 0
"RTN","SAMISITE",114,0)
 . s ARGS("errorMessage")="Site not found for user "_user
"RTN","SAMISITE",115,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",116,0)
 ;
"RTN","SAMISITE",117,0)
 s siteid=$$SITEID(site)
"RTN","SAMISITE",118,0)
 i siteid=-1 d  q 0
"RTN","SAMISITE",119,0)
 . s ARGS("errorMessage")="Site ID not found for site "_site
"RTN","SAMISITE",120,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",121,0)
 ;
"RTN","SAMISITE",122,0)
 s siteactv=$$SITEACTV(site)
"RTN","SAMISITE",123,0)
 i siteactv<1 d  q 0
"RTN","SAMISITE",124,0)
 . s ARGS("errorMessage")="Site not active: "_siteid
"RTN","SAMISITE",125,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",126,0)
 ;
"RTN","SAMISITE",127,0)
 s sitenm=$$SITENM(site)
"RTN","SAMISITE",128,0)
 i sitenm=-1 d  q 0
"RTN","SAMISITE",129,0)
 . s ARGS("errorMessage")="Site name not found: "_siteid
"RTN","SAMISITE",130,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",131,0)
 ;
"RTN","SAMISITE",132,0)
 s ARGS("siteid")=siteid
"RTN","SAMISITE",133,0)
 s ARGS("sitetitle")=$$SITENM(site)_" - "_siteid
"RTN","SAMISITE",134,0)
 q 1
"RTN","SAMISITE",135,0)
 ;
"RTN","SAMISITE",136,0)
 ;
"RTN","SAMISITE",137,0)
 ;
"RTN","SAMISITE",138,0)
USER() ; extrinsic returns the DUZ of the user accessing the system
"RTN","SAMISITE",139,0)
 ; -1 means user not known
"RTN","SAMISITE",140,0)
 n rtn s rtn=-1
"RTN","SAMISITE",141,0)
 s rtn=+$G(DUZ)
"RTN","SAMISITE",142,0)
 i rtn=0 s rtn=-1
"RTN","SAMISITE",143,0)
 q rtn
"RTN","SAMISITE",144,0)
 ;
"RTN","SAMISITE",145,0)
 ;
"RTN","SAMISITE",146,0)
 ;
"RTN","SAMISITE",147,0)
SITE(USER) ; extrinsic returns the pointer to the Institution file
"RTN","SAMISITE",148,0)
 ; which is the site of the user
"RTN","SAMISITE",149,0)
 ; -1 means site not found
"RTN","SAMISITE",150,0)
 ; zero means site not active
"RTN","SAMISITE",151,0)
 n rtn
"RTN","SAMISITE",152,0)
 s rtn=$o(^VA(200,USER,2,0))
"RTN","SAMISITE",153,0)
 i +rtn="" s rtn=-1
"RTN","SAMISITE",154,0)
 q rtn
"RTN","SAMISITE",155,0)
 ;
"RTN","SAMISITE",156,0)
 ;
"RTN","SAMISITE",157,0)
 ;
"RTN","SAMISITE",158,0)
SITEID(SITE) ; extrinsic returns the Site Symbol for SITE
"RTN","SAMISITE",159,0)
 ; this is found in the SAMI SITE file
"RTN","SAMISITE",160,0)
 ; null means SITEID not found
"RTN","SAMISITE",161,0)
 n rtn s rtn=-1
"RTN","SAMISITE",162,0)
 n ien s ien=$o(^SAMI(311.12,"B",SITE,""))
"RTN","SAMISITE",163,0)
 q:ien="" -1
"RTN","SAMISITE",164,0)
 s rtn=$$GET1^DIQ(311.12,ien_",",.02)
"RTN","SAMISITE",165,0)
 q rtn
"RTN","SAMISITE",166,0)
 ;
"RTN","SAMISITE",167,0)
 ;
"RTN","SAMISITE",168,0)
 ; 
"RTN","SAMISITE",169,0)
SITEACTV(SITE) ; Extrinsic which returns 1 if the site is active
"RTN","SAMISITE",170,0)
 ; otherwise 0
"RTN","SAMISITE",171,0)
 n rtn s rtn=-1
"RTN","SAMISITE",172,0)
 n ien s ien=$o(^SAMI(311.12,"B",SITE,""))
"RTN","SAMISITE",173,0)
 q:ien="" -1
"RTN","SAMISITE",174,0)
 s rtn=$$GET1^DIQ(311.12,ien_",",.03,"I")
"RTN","SAMISITE",175,0)
 q rtn
"RTN","SAMISITE",176,0)
 ;
"RTN","SAMISITE",177,0)
 ;
"RTN","SAMISITE",178,0)
 ;
"RTN","SAMISITE",179,0)
SITENM(SITE) ; Extrinsic which returns the Site name
"RTN","SAMISITE",180,0)
 ;
"RTN","SAMISITE",181,0)
 n rtn s rtn=-1
"RTN","SAMISITE",182,0)
 s rtn=$$GET1^DIQ(4,SITE_",",.01)
"RTN","SAMISITE",183,0)
 i rtn="" s rtn=-1
"RTN","SAMISITE",184,0)
 q rtn
"RTN","SAMISITE",185,0)
 ;
"RTN","SAMISITE",186,0)
 ;
"RTN","SAMISITE",187,0)
 ;
"RTN","SAMISITE",188,0)
SITENM2(SITEID) ; Extrinsic which returns the Site name from the Site Symbol
"RTN","SAMISITE",189,0)
 ;
"RTN","SAMISITE",190,0)
 q:SITEID="" -1
"RTN","SAMISITE",191,0)
 n siteien
"RTN","SAMISITE",192,0)
 s siteien=$o(^SAMI(311.12,"SYM",SITEID,""))
"RTN","SAMISITE",193,0)
 n site
"RTN","SAMISITE",194,0)
 q $$GET1^DIQ(311.12,siteien_",",.01,"E")
"RTN","SAMISITE",195,0)
 ;
"RTN","SAMISITE",196,0)
 ;
"RTN","SAMISITE",197,0)
 ;
"RTN","SAMISITE",198,0)
LOGIN(RTN,VALS) ; login processing
"RTN","SAMISITE",199,0)
 ;
"RTN","SAMISITE",200,0)
 n access,verify
"RTN","SAMISITE",201,0)
 s access=$g(VALS("access"))
"RTN","SAMISITE",202,0)
 if access="" s access=$g(VALS("username"))
"RTN","SAMISITE",203,0)
 s verify=$g(VALS("verify"))
"RTN","SAMISITE",204,0)
 if verify="" s verify=$g(VALS("password"))
"RTN","SAMISITE",205,0)
 ;i verify="@demo123" s verify="@demo321"
"RTN","SAMISITE",206,0)
 ;i verify="@demo123" s verify="$#happy10"
"RTN","SAMISITE",207,0)
 ;i access="ZZZUSER1" s access="SUPER6"
"RTN","SAMISITE",208,0)
 ;i access="" d  ;
"RTN","SAMISITE",209,0)
 ;. s access="PHXNAV1"
"RTN","SAMISITE",210,0)
 ;. s verify="$#happy6"
"RTN","SAMISITE",211,0)
 I $$GET1PARM^SAMIPARM("systemDemoOnly")="true" D  Q  ;
"RTN","SAMISITE",212,0)
 . S DUZ=$$GET1PARM^SAMIPARM("systemDemoUseDUZ")
"RTN","SAMISITE",213,0)
 . I +DUZ=0 D  ;
"RTN","SAMISITE",214,0)
 . . S DUZ=$O(^SAMI(311.13,"B",""))
"RTN","SAMISITE",215,0)
 . s VALS("samiroute")=""
"RTN","SAMISITE",216,0)
 . s VALS("siteid")=""
"RTN","SAMISITE",217,0)
 . d WSHOME^SAMIHOM3(.RTN,.VALS)
"RTN","SAMISITE",218,0)
 n ACVC s ACVC=access_";"_verify
"RTN","SAMISITE",219,0)
 i $$SIGNON(ACVC) D  Q  ;
"RTN","SAMISITE",220,0)
 . s VALS("samiroute")=""
"RTN","SAMISITE",221,0)
 . s VALS("siteid")=""
"RTN","SAMISITE",222,0)
 . d WSHOME^SAMIHOM3(.RTN,.VALS)
"RTN","SAMISITE",223,0)
 else  D  Q  ;
"RTN","SAMISITE",224,0)
 . s VALS("errorMessage")="Invalid login"
"RTN","SAMISITE",225,0)
 . d RTNERR^SAMIHOM4(.RTN,"vapals:login",.VALS)
"RTN","SAMISITE",226,0)
 q
"RTN","SAMISITE",227,0)
 ;
"RTN","SAMISITE",228,0)
 ;
"RTN","SAMISITE",229,0)
 ;
"RTN","SAMISITE",230,0)
SIGNON(ACVC) ; extrinsic returns 1 if signon is successful, else 0
"RTN","SAMISITE",231,0)
 ; Sign-on
"RTN","SAMISITE",232,0)
 N IO S IO=$P
"RTN","SAMISITE",233,0)
 D SETUP^XUSRB() ; Only partition set-up; No single sign-on or CAPRI
"RTN","SAMISITE",234,0)
 N RTN D VALIDAV^XUSRB(.RTN,$$ENCRYP^XUSRB1(ACVC)) ; sign-on call
"RTN","SAMISITE",235,0)
 I RTN(0)>0,'RTN(2) Q 1 ; Sign on successful!
"RTN","SAMISITE",236,0)
 I RTN(0)=0,RTN(2) Q 0  ; Verify Code must be changed NOW!
"RTN","SAMISITE",237,0)
 I $L(RTN(3)) Q 0  ; Error Message
"RTN","SAMISITE",238,0)
 ;
"RTN","SAMISITE",239,0)
 q
"RTN","SAMISITE",240,0)
 ;
"RTN","SAMISITE",241,0)
 ;
"RTN","SAMISITE",242,0)
 ;
"RTN","SAMISITE",243,0)
SUPER(RTN,FILTER) ; returns site selection page for super users
"RTN","SAMISITE",244,0)
 ;
"RTN","SAMISITE",245,0)
 n temp
"RTN","SAMISITE",246,0)
 d getThis^%wd("temp","blank_no_nav.html")
"RTN","SAMISITE",247,0)
 q:'$d(temp)
"RTN","SAMISITE",248,0)
 n cnt s cnt=0
"RTN","SAMISITE",249,0)
 n zj s zj=0
"RTN","SAMISITE",250,0)
 f  s zj=$o(temp(zj)) q:temp(zj)["Insert"  q:+zj=0  d  ;
"RTN","SAMISITE",251,0)
 . n ln s ln=temp(zj)
"RTN","SAMISITE",252,0)
 . i ln["PAGE NAME" s ln="Site Selection"
"RTN","SAMISITE",253,0)
 . d LOAD^SAMIFORM(.ln,"","")
"RTN","SAMISITE",254,0)
 . s cnt=cnt+1
"RTN","SAMISITE",255,0)
 . s @RTN@(cnt)=ln
"RTN","SAMISITE",256,0)
 s cnt=cnt+1
"RTN","SAMISITE",257,0)
 s @RTN@(cnt)="<ul>"
"RTN","SAMISITE",258,0)
 n gn s gn=$na(^SAMI(311.12,"B"))
"RTN","SAMISITE",259,0)
 n zi s zi=0
"RTN","SAMISITE",260,0)
 f  s zi=$o(@gn@(zi)) q:+zi=0  d  ;
"RTN","SAMISITE",261,0)
 . n zien s zien=$o(@gn@(zi,""))
"RTN","SAMISITE",262,0)
 . n active
"RTN","SAMISITE",263,0)
 . s active=$$GET1^DIQ(311.12,zien_",",.03,"I")
"RTN","SAMISITE",264,0)
 . q:active=0
"RTN","SAMISITE",265,0)
 . n name
"RTN","SAMISITE",266,0)
 . s name=$$SITENM(zi)_" - "_$$SITEID(zi)
"RTN","SAMISITE",267,0)
 . n link
"RTN","SAMISITE",268,0)
 . s link="<li>"
"RTN","SAMISITE",269,0)
 . s link=link_"<a class=""navigation"" data-method=""post"""
"RTN","SAMISITE",270,0)
 . s link=link_" data-samiroute=""home"" data-siteid="""_$$SITEID(zi)_""""
"RTN","SAMISITE",271,0)
 . ;s link=link_" data-site="""_$$SITEID(zi)_""""
"RTN","SAMISITE",272,0)
 . ;s link=link_" href=""#!"">"_$$SITENM(zi)_" - "_$$SITEID(zi)
"RTN","SAMISITE",273,0)
 . s link=link_" href=""/vapals"">"_name
"RTN","SAMISITE",274,0)
 . s link=link_"</a></li>"
"RTN","SAMISITE",275,0)
 . ;n link
"RTN","SAMISITE",276,0)
 . ;s link="<form method=POST action=""/vapals"">"
"RTN","SAMISITE",277,0)
 . ;s link=link_"<input type=hidden name=""samiroute"" value=""home"">"
"RTN","SAMISITE",278,0)
 . ;s link=link_"<input type=hidden name=""siteid"" value="""_$$SITEID(zi)_""">"
"RTN","SAMISITE",279,0)
 . ;s link=link_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMISITE",280,0)
 . s cnt=cnt+1
"RTN","SAMISITE",281,0)
 . s @RTN@(cnt)=link
"RTN","SAMISITE",282,0)
 s cnt=cnt+1
"RTN","SAMISITE",283,0)
 s @RTN@(cnt)="</ul>"
"RTN","SAMISITE",284,0)
 n zk s zk=zj+1
"RTN","SAMISITE",285,0)
 f  s zk=$o(temp(zk)) q:+zk=0  d  ;
"RTN","SAMISITE",286,0)
 . s cnt=cnt+1
"RTN","SAMISITE",287,0)
 . s @RTN@(cnt)=temp(zk)
"RTN","SAMISITE",288,0)
 q
"RTN","SAMISITE",289,0)
 ;
"RTN","SAMISITE",290,0)
 ;
"RTN","SAMISITE",291,0)
 ;
"RTN","SAMISITE",292,0)
UPGRADE() ; convert VAPALS system to Multi-tenancy by adding siteid
"RTN","SAMISITE",293,0)
 ; to all existing patients - runs one time as the Post Install 
"RTN","SAMISITE",294,0)
 ; to the installation
"RTN","SAMISITE",295,0)
 ;
"RTN","SAMISITE",296,0)
 n lroot,proot,lien,pien
"RTN","SAMISITE",297,0)
 s (lien,pien)=0
"RTN","SAMISITE",298,0)
 s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMISITE",299,0)
 s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMISITE",300,0)
 n site
"RTN","SAMISITE",301,0)
 s site=$$GET^XPAR("SYS","SAMI SID PREFIX",,"Q")
"RTN","SAMISITE",302,0)
 i site="" d  q  ;
"RTN","SAMISITE",303,0)
 . D MES^XPDUTL("No default site returned by SAMI SID PREFIX parameter, exiting")
"RTN","SAMISITE",304,0)
 n cnt s cnt=0
"RTN","SAMISITE",305,0)
 f  s lien=$o(@lroot@(lien)) q:+lien=0  d  ;
"RTN","SAMISITE",306,0)
 . q:$g(@lroot@(lien,"siteid"))'=""
"RTN","SAMISITE",307,0)
 . n nomatch s nomatch=0
"RTN","SAMISITE",308,0)
 . n dfn s dfn=$g(@lroot@(lien,"dfn"))
"RTN","SAMISITE",309,0)
 . i dfn="" d  q  ;
"RTN","SAMISITE",310,0)
 . . D MES^XPDUTL("Error, no dfn found for lien "_lien)
"RTN","SAMISITE",311,0)
 . s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMISITE",312,0)
 . ; make sure the first 3 chars of the studyid matches the site
"RTN","SAMISITE",313,0)
 . i pien'="" d  q:nomatch
"RTN","SAMISITE",314,0)
 . . n psite,psid
"RTN","SAMISITE",315,0)
 . . s psid=$g(@proot@(pien,"sisid"))
"RTN","SAMISITE",316,0)
 . . i psid="" s nomatch=1 q  ;
"RTN","SAMISITE",317,0)
 . . i $e(psid,1,3)'=site s nomatch=1 d  q  ;
"RTN","SAMISITE",318,0)
 . . . d MES^XPDUTL("skipping record - studyid "_psid_" does not match site "_site)
"RTN","SAMISITE",319,0)
 . ;w !,"lien "_lien_" being set to "_site
"RTN","SAMISITE",320,0)
 . s cnt=cnt+1
"RTN","SAMISITE",321,0)
 . s @lroot@(lien,"siteid")=site
"RTN","SAMISITE",322,0)
 i cnt>0 d  ;
"RTN","SAMISITE",323,0)
 . d MES^XPDUTL("Multi-tenancy upgrade successful")
"RTN","SAMISITE",324,0)
 . d MES^XPDUTL(cnt_" patient records set to site "_site)
"RTN","SAMISITE",325,0)
 q
"RTN","SAMISITE",326,0)
 ;
"RTN","SAMISITE",327,0)
 ;
"RTN","SAMISITE",328,0)
 ;
"RTN","SAMISITE",329,0)
EOR ; end of routine SAMISITE
"RTN","SAMIUR")
0^1^B655626702
"RTN","SAMIUR",1,0)
SAMIUR ;ven/gpl - user reports ;2021-10-15t00:54z
"RTN","SAMIUR",2,0)
 ;;18.0;SAMI;**5,10,11,12,14**;2020-01;Build 8
"RTN","SAMIUR",3,0)
 ;;18.14
"RTN","SAMIUR",4,0)
 ;
"RTN","SAMIUR",5,0)
 ; SAMIUR contains a web service & associated subroutines to produce
"RTN","SAMIUR",6,0)
 ; VAPALS-ELCAP user reports.
"RTN","SAMIUR",7,0)
 ;
"RTN","SAMIUR",8,0)
 quit  ; no entry from top
"RTN","SAMIUR",9,0)
 ;
"RTN","SAMIUR",10,0)
 ;
"RTN","SAMIUR",11,0)
 ;
"RTN","SAMIUR",12,0)
 ;@section 0 primary development
"RTN","SAMIUR",13,0)
 ;
"RTN","SAMIUR",14,0)
 ;
"RTN","SAMIUR",15,0)
 ;
"RTN","SAMIUR",16,0)
 ;@routine-credits
"RTN","SAMIUR",17,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIUR",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUR",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIUR",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIUR",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIUR",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIUR",23,0)
 ;
"RTN","SAMIUR",24,0)
 ;@last-update 2021-10-15t00:54z
"RTN","SAMIUR",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIUR",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIUR",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUR",28,0)
 ;@version 18.14
"RTN","SAMIUR",29,0)
 ;@release-date 2020-01
"RTN","SAMIUR",30,0)
 ;@patch-list **5,10,11,12,14**
"RTN","SAMIUR",31,0)
 ;
"RTN","SAMIUR",32,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIUR",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUR",34,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIUR",35,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIUR",36,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIUR",37,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIUR",38,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIUR",39,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIUR",40,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIUR",41,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIUR",42,0)
 ;
"RTN","SAMIUR",43,0)
 ;@module-credits see SAMIHUL
"RTN","SAMIUR",44,0)
 ;
"RTN","SAMIUR",45,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUR",46,0)
 ; see SAMIURUL
"RTN","SAMIUR",47,0)
 ;
"RTN","SAMIUR",48,0)
 ;@contents
"RTN","SAMIUR",49,0)
 ; WSREPORT generate report based on params in filter
"RTN","SAMIUR",50,0)
 ; SORT sort patients by name
"RTN","SAMIUR",51,0)
 ; NUHREF create nuhref link to casereview for all patients
"RTN","SAMIUR",52,0)
 ; PNAME page name for report
"RTN","SAMIUR",53,0)
 ;
"RTN","SAMIUR",54,0)
 ; SELECT select patients for report
"RTN","SAMIUR",55,0)
 ; UNMAT build unmatched persons list
"RTN","SAMIUR",56,0)
 ; WKLIST build work list
"RTN","SAMIUR",57,0)
 ;
"RTN","SAMIUR",58,0)
 ;
"RTN","SAMIUR",59,0)
 ;
"RTN","SAMIUR",60,0)
 ;@section 1 wsreport subroutines
"RTN","SAMIUR",61,0)
 ;
"RTN","SAMIUR",62,0)
 ;
"RTN","SAMIUR",63,0)
 ;
"RTN","SAMIUR",64,0)
WSREPORT(SAMIRTN,filter) ; generate report based on params in filter
"RTN","SAMIUR",65,0)
 ;
"RTN","SAMIUR",66,0)
 ;@called-by
"RTN","SAMIUR",67,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIUR",68,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIUR",69,0)
 ;@calls
"RTN","SAMIUR",70,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIUR",71,0)
 ; getThis^%wd
"RTN","SAMIUR",72,0)
 ; SELECT
"RTN","SAMIUR",73,0)
 ; LOAD^SAMIFORM
"RTN","SAMIUR",74,0)
 ; $$PNAME
"RTN","SAMIUR",75,0)
 ; findReplace^%ts
"RTN","SAMIUR",76,0)
 ; RPTTBL^SAMIUR2
"RTN","SAMIUR",77,0)
 ; NUHREF
"RTN","SAMIUR",78,0)
 ; SORT
"RTN","SAMIUR",79,0)
 ; @RPT(ir,"routine"): [from report def table from RPTTBL^SAMIUR2]
"RTN","SAMIUR",80,0)
 ;  format = $$<tag>^SAMIUR2, where tag =
"RTN","SAMIUR",81,0)
 ;  AGE       BLINEDT   CONTACT   CTPROT   DOB      FUDATE    GENDER
"RTN","SAMIUR",82,0)
 ;  IFORM     LASTEXM   MANPAT    MATCH    NAME     PACKYRS   POSSIBLE
"RTN","SAMIUR",83,0)
 ;  RECOM     RURAL     SID       SMHIS    SMKSTAT  SSN       STUDYDT
"RTN","SAMIUR",84,0)
 ;  STUDYTYP  VALS      WHEN      WORKPAT
"RTN","SAMIUR",85,0)
 ;
"RTN","SAMIUR",86,0)
 ; here are the user reports that are defined:
"RTN","SAMIUR",87,0)
 ;  1. followup
"RTN","SAMIUR",88,0)
 ;  2. activity
"RTN","SAMIUR",89,0)
 ;  3. missingct
"RTN","SAMIUR",90,0)
 ;  4. incomplete
"RTN","SAMIUR",91,0)
 ;  5. outreach
"RTN","SAMIUR",92,0)
 ;  6. enrollment
"RTN","SAMIUR",93,0)
 ;  7. worklist
"RTN","SAMIUR",94,0)
 ; the report to generate is passed in parameter samireporttype
"RTN","SAMIUR",95,0)
 ;
"RTN","SAMIUR",96,0)
 new debug set debug=0
"RTN","SAMIUR",97,0)
 if $get(filter("debug"))=1 set debug=1
"RTN","SAMIUR",98,0)
 if $get(filter("debug"))=1 set debug=1
"RTN","SAMIUR",99,0)
 kill SAMIRTN
"RTN","SAMIUR",100,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMIUR",101,0)
 ;
"RTN","SAMIUR",102,0)
 new type,temp,site
"RTN","SAMIUR",103,0)
 s site=$g(filter("siteid"))
"RTN","SAMIUR",104,0)
 i site="" s site=$g(filter("site"))
"RTN","SAMIUR",105,0)
 i site="" d  q  ; report site missing
"RTN","SAMIUR",106,0)
 . d GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",107,0)
 ;
"RTN","SAMIUR",108,0)
 set type=$get(filter("samireporttype"))
"RTN","SAMIUR",109,0)
 if type="" do  quit  ; report type missing
"RTN","SAMIUR",110,0)
 . do GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",111,0)
 . quit
"RTN","SAMIUR",112,0)
 ;
"RTN","SAMIUR",113,0)
 if type="unmatched" i $$GET1PARM^SAMIPARM("matchingReportEnabled",site)'="true" do  quit  ;
"RTN","SAMIUR",114,0)
 . d GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",115,0)
 ;
"RTN","SAMIUR",116,0)
 do getThis^%wd("temp","table.html") ; page template
"RTN","SAMIUR",117,0)
 quit:'$data(temp)
"RTN","SAMIUR",118,0)
 ;
"RTN","SAMIUR",119,0)
 new SAMIPATS
"RTN","SAMIUR",120,0)
 ; set pats=""
"RTN","SAMIUR",121,0)
 new datephrase
"RTN","SAMIUR",122,0)
 do SELECT(.SAMIPATS,type,.datephrase,.filter) ; select pats for report
"RTN","SAMIUR",123,0)
 ; quit:'$data(SAMIPATS)
"RTN","SAMIUR",124,0)
 ;
"RTN","SAMIUR",125,0)
 new ln,cnt,ii
"RTN","SAMIUR",126,0)
 set (ii,ln,cnt)=0
"RTN","SAMIUR",127,0)
 for  do  quit:'ii  quit:$get(temp(ii))["<thead"
"RTN","SAMIUR",128,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",129,0)
 . quit:'ii
"RTN","SAMIUR",130,0)
 . quit:$get(temp(ii))["<thead"
"RTN","SAMIUR",131,0)
 . ;
"RTN","SAMIUR",132,0)
 . set cnt=cnt+1
"RTN","SAMIUR",133,0)
 . set ln=$get(temp(ii))
"RTN","SAMIUR",134,0)
 . new samikey,si
"RTN","SAMIUR",135,0)
 . set (samikey,si)=""
"RTN","SAMIUR",136,0)
 . do LOAD^SAMIFORM(.ln,samikey,si,.filter)
"RTN","SAMIUR",137,0)
 . ; if ln["PAGE NAME" do
"RTN","SAMIUR",138,0)
 . ; . do findReplace^%ts(.ln,"PAGE NAME",$$PNAME(type,datephrase))
"RTN","SAMIUR",139,0)
 . ; . quit
"RTN","SAMIUR",140,0)
 . if ln["PAGE NAME" do
"RTN","SAMIUR",141,0)
 . . do findReplace^%ts(.ln,"PAGE NAME",$$PNAME(type,""))
"RTN","SAMIUR",142,0)
 . . quit
"RTN","SAMIUR",143,0)
 . if ln["CRITERIA" do
"RTN","SAMIUR",144,0)
 . . do findReplace^%ts(.ln,"CRITERIA",datephrase)
"RTN","SAMIUR",145,0)
 . . quit
"RTN","SAMIUR",146,0)
 . if ln["@@REPORTTYPE@@" do
"RTN","SAMIUR",147,0)
 . . do findReplace^%ts(.ln,"@@REPORTTYPE@@",type)
"RTN","SAMIUR",148,0)
 . . quit
"RTN","SAMIUR",149,0)
 . ;
"RTN","SAMIUR",150,0)
 . if ln["name=""start-date""" do
"RTN","SAMIUR",151,0)
 . . do findReplace^%ts(.ln,"start-date""","start-date"" value="""_$g(filter("start-date"))_"""")
"RTN","SAMIUR",152,0)
 . . quit
"RTN","SAMIUR",153,0)
 . if ln["name=""end-date""" do
"RTN","SAMIUR",154,0)
 . . do findReplace^%ts(.ln,"end-date""","end-date"" value="""_$g(filter("end-date"))_"""")
"RTN","SAMIUR",155,0)
 . . quit
"RTN","SAMIUR",156,0)
 . ;
"RTN","SAMIUR",157,0)
 . set SAMIRTN(cnt)=ln
"RTN","SAMIUR",158,0)
 . quit
"RTN","SAMIUR",159,0)
 ;
"RTN","SAMIUR",160,0)
 new RPT,ik
"RTN","SAMIUR",161,0)
 do RPTTBL^SAMIUR2(.RPT,type,site) ; load report definition table
"RTN","SAMIUR",162,0)
 if '$data(RPT) do  quit  ; don't know about this report
"RTN","SAMIUR",163,0)
 . do GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",164,0)
 . quit
"RTN","SAMIUR",165,0)
 ;
"RTN","SAMIUR",166,0)
 ; output header
"RTN","SAMIUR",167,0)
 ;
"RTN","SAMIUR",168,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="<thead><tr>"
"RTN","SAMIUR",169,0)
 set cnt=cnt+1
"RTN","SAMIUR",170,0)
 new totcnt set totcnt=cnt
"RTN","SAMIUR",171,0)
 ;
"RTN","SAMIUR",172,0)
 set ir=""
"RTN","SAMIUR",173,0)
 for  do  quit:ir=""  ;
"RTN","SAMIUR",174,0)
 . set ir=$order(RPT(ir))
"RTN","SAMIUR",175,0)
 . quit:ir=""
"RTN","SAMIUR",176,0)
 . set cnt=cnt+1
"RTN","SAMIUR",177,0)
 . set SAMIRTN(cnt)="<th>"_$get(RPT(ir,"header"))_"</th>"
"RTN","SAMIUR",178,0)
 . quit
"RTN","SAMIUR",179,0)
 ;
"RTN","SAMIUR",180,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="</tr></thead>"
"RTN","SAMIUR",181,0)
 ;
"RTN","SAMIUR",182,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="<tbody>"
"RTN","SAMIUR",183,0)
 ;
"RTN","SAMIUR",184,0)
 if type'="worklist" do  ;
"RTN","SAMIUR",185,0)
 . do NUHREF(.SAMIPATS) ; create the nuhref link for all patients
"RTN","SAMIUR",186,0)
 . quit
"RTN","SAMIUR",187,0)
 ;
"RTN","SAMIUR",188,0)
 new SRT set SRT=""
"RTN","SAMIUR",189,0)
 if $get(filter("sort"))="" d  ; what kind of sort
"RTN","SAMIUR",190,0)
 . set filter("sort")="name"
"RTN","SAMIUR",191,0)
 . i type="missingct" s filter("sort")="cdate" ;sort by latest contact
"RTN","SAMIUR",192,0)
 do SORT(.SRT,.SAMIPATS,.filter)
"RTN","SAMIUR",193,0)
 ; zwrite SRT
"RTN","SAMIUR",194,0)
 ;
"RTN","SAMIUR",195,0)
 ; set ij=0
"RTN","SAMIUR",196,0)
 ; for  do  quit:'ij  ;
"RTN","SAMIUR",197,0)
 ; . set ij=$order(SAMIPATS(ij))
"RTN","SAMIUR",198,0)
 ; . quit:'ij  
"RTN","SAMIUR",199,0)
 ; . new ij2 set ij2=0
"RTN","SAMIUR",200,0)
 ; . for  do  quit:'ij2  ;
"RTN","SAMIUR",201,0)
 ; . . set ij2=$order(SAMIPATS(ij,ij2))
"RTN","SAMIUR",202,0)
 ; . . quit:'ij2  
"RTN","SAMIUR",203,0)
 ; . . new dfn set dfn=ij2
"RTN","SAMIUR",204,0)
 ; . . quit
"RTN","SAMIUR",205,0)
 ; . quit
"RTN","SAMIUR",206,0)
 ;
"RTN","SAMIUR",207,0)
 new iz,ij,ij2,dfn,rows
"RTN","SAMIUR",208,0)
 set rows=0
"RTN","SAMIUR",209,0)
 set (iz,ij,ij2,dfn)=""
"RTN","SAMIUR",210,0)
 for  do  quit:iz=""  ;
"RTN","SAMIUR",211,0)
 . set iz=$order(SRT(iz))
"RTN","SAMIUR",212,0)
 . quit:iz=""
"RTN","SAMIUR",213,0)
 . set ij=$order(SRT(iz,""))
"RTN","SAMIUR",214,0)
 . set dfn=$order(SRT(iz,ij,""))
"RTN","SAMIUR",215,0)
 . do  ;
"RTN","SAMIUR",216,0)
 . . set cnt=cnt+1 set SAMIRTN(cnt)="<tr>"
"RTN","SAMIUR",217,0)
 . . set ir=""
"RTN","SAMIUR",218,0)
 . . for  do  quit:ir=""  ;
"RTN","SAMIUR",219,0)
 . . . set ir=$order(RPT(ir))
"RTN","SAMIUR",220,0)
 . . . quit:ir=""
"RTN","SAMIUR",221,0)
 . . . set cnt=cnt+1
"RTN","SAMIUR",222,0)
 . . . new XR,XRV
"RTN","SAMIUR",223,0)
 . . . ; set XR=$get(RPT(ir,"routine"))_"("_ij_",.SAMIPATS)"
"RTN","SAMIUR",224,0)
 . . . set XR="set XRV="_$get(RPT(ir,"routine"))_"("_ij_","_dfn_",.SAMIPATS)"
"RTN","SAMIUR",225,0)
 . . . ; set XRV=@XR
"RTN","SAMIUR",226,0)
 . . . xecute XR ; call report-field handlers in ^SAMIUR2
"RTN","SAMIUR",227,0)
 . . . if $extract(XRV,1,3)["<td" set SAMIRTN(cnt)=XRV
"RTN","SAMIUR",228,0)
 . . . else  set SAMIRTN(cnt)="<td>"_$get(XRV)_"</td>"
"RTN","SAMIUR",229,0)
 . . . quit
"RTN","SAMIUR",230,0)
 . . ;
"RTN","SAMIUR",231,0)
 . . set cnt=cnt+1
"RTN","SAMIUR",232,0)
 . . set SAMIRTN(cnt)="</tr>"_$CHAR(10,13)
"RTN","SAMIUR",233,0)
 . . set rows=rows+1
"RTN","SAMIUR",234,0)
 . . quit
"RTN","SAMIUR",235,0)
 . quit
"RTN","SAMIUR",236,0)
 ;
"RTN","SAMIUR",237,0)
 set cnt=cnt+1
"RTN","SAMIUR",238,0)
 ;set SAMIRTN(cnt)="<tr><td>Total: "_rows_"</td></tr>"
"RTN","SAMIUR",239,0)
 ;set SAMIRTN(totcnt)="<td>Total: "_rows_"</td></tr><tr>"
"RTN","SAMIUR",240,0)
 ;
"RTN","SAMIUR",241,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="</tbody>"
"RTN","SAMIUR",242,0)
 for  do  quit:temp(ii)["</tbody>"  ;
"RTN","SAMIUR",243,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",244,0)
 . quit:temp(ii)["</tbody>"
"RTN","SAMIUR",245,0)
 . ; skip past template headers & blank body
"RTN","SAMIUR",246,0)
 . quit
"RTN","SAMIUR",247,0)
 ;
"RTN","SAMIUR",248,0)
 for  do  quit:'ii  ;
"RTN","SAMIUR",249,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",250,0)
 . quit:'ii
"RTN","SAMIUR",251,0)
 . set cnt=cnt+1
"RTN","SAMIUR",252,0)
 . set ln=$get(temp(ii))
"RTN","SAMIUR",253,0)
 . new samikey,si
"RTN","SAMIUR",254,0)
 . set (samikey,si)=""
"RTN","SAMIUR",255,0)
 . do LOAD^SAMIFORM(.ln,samikey,si,.filter)
"RTN","SAMIUR",256,0)
 . set SAMIRTN(cnt)=ln
"RTN","SAMIUR",257,0)
 . quit
"RTN","SAMIUR",258,0)
 ;
"RTN","SAMIUR",259,0)
 quit  ; end of WSREPORT
"RTN","SAMIUR",260,0)
 ;
"RTN","SAMIUR",261,0)
 ;
"RTN","SAMIUR",262,0)
SORT(SRTN,SAMIPATS,FILTER) ; sort patients by name
"RTN","SAMIUR",263,0)
 ;
"RTN","SAMIUR",264,0)
 ;@called-by
"RTN","SAMIUR",265,0)
 ; WSREPORT
"RTN","SAMIUR",266,0)
 ;@calls
"RTN","SAMIUR",267,0)
 ; $$UPCASE^XLFMSMT
"RTN","SAMIUR",268,0)
 ;
"RTN","SAMIUR",269,0)
 new typ set typ=$get(FILTER("sort"))
"RTN","SAMIUR",270,0)
 ;
"RTN","SAMIUR",271,0)
 if typ="" set typ="name"
"RTN","SAMIUR",272,0)
 new iz,dt,dfn,nm,cdate
"RTN","SAMIUR",273,0)
 set (dt,dfn,nm)="" ; note: should dfn be initialized inside loop?
"RTN","SAMIUR",274,0)
 set iz=0
"RTN","SAMIUR",275,0)
 ;
"RTN","SAMIUR",276,0)
 new indx
"RTN","SAMIUR",277,0)
 for  do  quit:'dt  ;
"RTN","SAMIUR",278,0)
 . set dt=$order(SAMIPATS(dt))
"RTN","SAMIUR",279,0)
 . quit:'dt
"RTN","SAMIUR",280,0)
 . ; note: dfn not re-initialized to "" here; should it be?
"RTN","SAMIUR",281,0)
 . for  do  quit:'dfn  ;
"RTN","SAMIUR",282,0)
 . . set dfn=$order(SAMIPATS(dt,dfn))
"RTN","SAMIUR",283,0)
 . . quit:'dfn
"RTN","SAMIUR",284,0)
 . . if typ="name" do  ;
"RTN","SAMIUR",285,0)
 . . . set nm=$get(SAMIPATS(dt,dfn,"name"))
"RTN","SAMIUR",286,0)
 . . . set nm=$$UPCASE^XLFMSMT(nm)
"RTN","SAMIUR",287,0)
 . . . if nm="" set nm=" "
"RTN","SAMIUR",288,0)
 . . . set indx(nm,dt,dfn)=""
"RTN","SAMIUR",289,0)
 . . . quit
"RTN","SAMIUR",290,0)
 . . if typ="cdate" do  ;
"RTN","SAMIUR",291,0)
 . . . set cdate=$$LDOC^SAMIUR2(dt,dfn,.SAMIPATS)
"RTN","SAMIUR",292,0)
 . . . set cdate=$$FMDT^SAMIUR2(cdate)
"RTN","SAMIUR",293,0)
 . . . set indx(cdate,dt,dfn)=""
"RTN","SAMIUR",294,0)
 . . quit
"RTN","SAMIUR",295,0)
 . quit
"RTN","SAMIUR",296,0)
 ;
"RTN","SAMIUR",297,0)
 new iiz set iiz=""
"RTN","SAMIUR",298,0)
 set (dt,dfn)="" ; note: here, too, should inits be inside loops?
"RTN","SAMIUR",299,0)
 for  do  quit:iiz=""  ;
"RTN","SAMIUR",300,0)
 . set iiz=$order(indx(iiz))
"RTN","SAMIUR",301,0)
 . quit:iiz=""
"RTN","SAMIUR",302,0)
 . for  do  quit:dt=""  ;
"RTN","SAMIUR",303,0)
 . . set dt=$order(indx(iiz,dt))
"RTN","SAMIUR",304,0)
 . . quit:dt=""
"RTN","SAMIUR",305,0)
 . . for  do  quit:dfn=""  ;
"RTN","SAMIUR",306,0)
 . . . set dfn=$order(indx(iiz,dt,dfn))
"RTN","SAMIUR",307,0)
 . . . quit:dfn=""
"RTN","SAMIUR",308,0)
 . . . set iz=iz+1
"RTN","SAMIUR",309,0)
 . . . set SRTN(iz,dt,dfn)=iiz
"RTN","SAMIUR",310,0)
 . . . quit
"RTN","SAMIUR",311,0)
 . . quit
"RTN","SAMIUR",312,0)
 . quit
"RTN","SAMIUR",313,0)
 ;
"RTN","SAMIUR",314,0)
 quit  ; end of SORT
"RTN","SAMIUR",315,0)
 ;
"RTN","SAMIUR",316,0)
 ;
"RTN","SAMIUR",317,0)
 ;
"RTN","SAMIUR",318,0)
NUHREF(SAMIPATS) ; create nuhref link to casereview for all patients
"RTN","SAMIUR",319,0)
 ;
"RTN","SAMIUR",320,0)
 ;@called-by
"RTN","SAMIUR",321,0)
 ; WSREPORT
"RTN","SAMIUR",322,0)
 ;@calls
"RTN","SAMIUR",323,0)
 ; $$setroot^%wd
"RTN","SAMIUR",324,0)
 ; $$GETSSN^SAMIFORM
"RTN","SAMIUR",325,0)
 ;
"RTN","SAMIUR",326,0)
 new ij
"RTN","SAMIUR",327,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",328,0)
 set ij=0
"RTN","SAMIUR",329,0)
 for  do  quit:'ij  ;
"RTN","SAMIUR",330,0)
 . set ij=$order(SAMIPATS(ij))
"RTN","SAMIUR",331,0)
 . quit:'ij
"RTN","SAMIUR",332,0)
 . new ij2 set ij2=0
"RTN","SAMIUR",333,0)
 . for  do  quit:'ij2  ;
"RTN","SAMIUR",334,0)
 . . set ij2=$order(SAMIPATS(ij,ij2))
"RTN","SAMIUR",335,0)
 . . quit:'ij2
"RTN","SAMIUR",336,0)
 . . ;
"RTN","SAMIUR",337,0)
 . . new dfn set dfn=ij2
"RTN","SAMIUR",338,0)
 . . set SAMIPATS(ij,dfn,"sid")=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR",339,0)
 . . set SAMIPATS(ij,dfn,"name")=$get(@root@(dfn,"saminame"))
"RTN","SAMIUR",340,0)
 . . ;
"RTN","SAMIUR",341,0)
 . . new sid set sid=SAMIPATS(ij,dfn,"sid")
"RTN","SAMIUR",342,0)
 . . set SAMIPATS(ij,dfn,"ssn")=$$GETSSN^SAMIFORM(sid)
"RTN","SAMIUR",343,0)
 . . new name set name=SAMIPATS(ij,dfn,"name")
"RTN","SAMIUR",344,0)
 . . ;
"RTN","SAMIUR",345,0)
 . . new nuhref
"RTN","SAMIUR",346,0)
 . . set nuhref="<td data-order="""_name_""" data-search="""_name_""">"
"RTN","SAMIUR",347,0)
 . . set nuhref=nuhref_"<form method=POST action=""/vapals"">"
"RTN","SAMIUR",348,0)
 . . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""casereview"">"
"RTN","SAMIUR",349,0)
 . . set nuhref=nuhref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMIUR",350,0)
 . . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",351,0)
 . . set nuhref=nuhref_"</td>"
"RTN","SAMIUR",352,0)
 . . set SAMIPATS(ij,dfn,"nuhref")=nuhref
"RTN","SAMIUR",353,0)
 . . quit
"RTN","SAMIUR",354,0)
 . quit
"RTN","SAMIUR",355,0)
 ;
"RTN","SAMIUR",356,0)
 quit  ; end of NUHREF
"RTN","SAMIUR",357,0)
 ;
"RTN","SAMIUR",358,0)
 ;
"RTN","SAMIUR",359,0)
 ;
"RTN","SAMIUR",360,0)
PNAME(type,phrase) ; page name for report
"RTN","SAMIUR",361,0)
 ;
"RTN","SAMIUR",362,0)
 ;@called-by
"RTN","SAMIUR",363,0)
 ; WSREPORT
"RTN","SAMIUR",364,0)
 ;@calls none
"RTN","SAMIUR",365,0)
 ;
"RTN","SAMIUR",366,0)
 ; extrinsic returns the PAGE NAME for the report
"RTN","SAMIUR",367,0)
 ;
"RTN","SAMIUR",368,0)
 ; if type="followup" quit "Participant Followup next 30 days -"_$get(phrase)
"RTN","SAMIUR",369,0)
 if type="followup" quit "Participant Followup "_$get(phrase)
"RTN","SAMIUR",370,0)
 ; if type="activity" quit "Activity last 30 days -"_$get(phrase)
"RTN","SAMIUR",371,0)
 if type="activity" quit "Activity "_$get(phrase)
"RTN","SAMIUR",372,0)
 if type="missingct" quit "Intake but no CT Evaluation"_$get(phrase)
"RTN","SAMIUR",373,0)
 if type="incomplete" quit "Incomplete Forms"_$get(phrase)
"RTN","SAMIUR",374,0)
 if type="outreach" quit "Outreach"_$get(phrase)
"RTN","SAMIUR",375,0)
 if type="enrollment" quit "Enrollment"_$get(phrase)
"RTN","SAMIUR",376,0)
 if type="inactive" quit "Inactive"_$get(phrase)
"RTN","SAMIUR",377,0)
 ;
"RTN","SAMIUR",378,0)
 quit "" ; end of $$PNAME
"RTN","SAMIUR",379,0)
 ;
"RTN","SAMIUR",380,0)
 ;
"RTN","SAMIUR",381,0)
 ;
"RTN","SAMIUR",382,0)
 ;@section 2 select subroutines
"RTN","SAMIUR",383,0)
 ;
"RTN","SAMIUR",384,0)
 ;
"RTN","SAMIUR",385,0)
 ;
"RTN","SAMIUR",386,0)
SELECT(SAMIPATS,ztype,datephrase,filter) ; select patients for report
"RTN","SAMIUR",387,0)
 ;
"RTN","SAMIUR",388,0)
 ;@called-by
"RTN","SAMIUR",389,0)
 ; WSREPORT
"RTN","SAMIUR",390,0)
 ;@calls
"RTN","SAMIUR",391,0)
 ; UNMAT
"RTN","SAMIUR",392,0)
 ; WKLIST
"RTN","SAMIUR",393,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMIUR",394,0)
 ; $$NOW^XLFDT
"RTN","SAMIUR",395,0)
 ; $$FMADD^XLFDT
"RTN","SAMIUR",396,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMIUR",397,0)
 ; $$setroot^%wd
"RTN","SAMIUR",398,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIUR",399,0)
 ;
"RTN","SAMIUR",400,0)
 ; merge ^gpl("select")=filter
"RTN","SAMIUR",401,0)
 new type set type=ztype
"RTN","SAMIUR",402,0)
 if type="unmatched" do  quit  ;
"RTN","SAMIUR",403,0)
 . do UNMAT(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",404,0)
 . quit
"RTN","SAMIUR",405,0)
 if type="worklist" do  quit  ;
"RTN","SAMIUR",406,0)
 . do WKLIST(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",407,0)
 . quit
"RTN","SAMIUR",408,0)
 if $get(type)="" set type="enrollment"
"RTN","SAMIUR",409,0)
 if type="cumpy" set type="enrollment"
"RTN","SAMIUR",410,0)
 new site set site=$get(filter("siteid"))
"RTN","SAMIUR",411,0)
 ;
"RTN","SAMIUR",412,0)
 new strdt,enddt,fmstrdt,fmenddt
"RTN","SAMIUR",413,0)
 set strdt=$get(filter("start-date"))
"RTN","SAMIUR",414,0)
 ;set fmstrdt=$$KEY2FM^SAMICASE(strdt)
"RTN","SAMIUR",415,0)
 set fmstrdt=$$FMDT^SAMIUR2(strdt)
"RTN","SAMIUR",416,0)
 if fmstrdt=-1 do  ;
"RTN","SAMIUR",417,0)
 . set fmstrdt=2000101
"RTN","SAMIUR",418,0)
 . if type="followup" set fmstrdt=$$NOW^XLFDT
"RTN","SAMIUR",419,0)
 . if type="activity" set fmstrdt=$$FMADD^XLFDT($$NOW^XLFDT,-31)
"RTN","SAMIUR",420,0)
 . quit
"RTN","SAMIUR",421,0)
 if strdt="" set filter("start-date")=$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",422,0)
 ;
"RTN","SAMIUR",423,0)
 set enddt=$get(filter("end-date"))
"RTN","SAMIUR",424,0)
 ;set fmenddt=$$KEY2FM^SAMICASE(enddt)
"RTN","SAMIUR",425,0)
 set fmenddt=$$FMDT^SAMIUR2(enddt)
"RTN","SAMIUR",426,0)
 if fmenddt=-1 do  ;
"RTN","SAMIUR",427,0)
 . set fmenddt=$$NOW^XLFDT
"RTN","SAMIUR",428,0)
 . if type="followup" set fmenddt=$$FMADD^XLFDT($$NOW^XLFDT,31)
"RTN","SAMIUR",429,0)
 . quit
"RTN","SAMIUR",430,0)
 if enddt="" set filter("end-date")=$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",431,0)
 ;
"RTN","SAMIUR",432,0)
 set datephrase=""
"RTN","SAMIUR",433,0)
 new zi set zi=0
"RTN","SAMIUR",434,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",435,0)
 ;
"RTN","SAMIUR",436,0)
 for  do  quit:'zi  ;
"RTN","SAMIUR",437,0)
 . set zi=$order(@root@(zi))
"RTN","SAMIUR",438,0)
 . quit:'zi
"RTN","SAMIUR",439,0)
 . ;
"RTN","SAMIUR",440,0)
 . new sid set sid=$get(@root@(zi,"samistudyid"))
"RTN","SAMIUR",441,0)
 . quit:sid=""
"RTN","SAMIUR",442,0)
 . quit:$extract(sid,1,3)'=site
"RTN","SAMIUR",443,0)
 . ;
"RTN","SAMIUR",444,0)
 . new items set items=""
"RTN","SAMIUR",445,0)
 . do GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR",446,0)
 . quit:'$data(items)
"RTN","SAMIUR",447,0)
 . ;
"RTN","SAMIUR",448,0)
 . new efmdate,edate,siform,ceform,cefud,fmcefud,cedos,fmcedos
"RTN","SAMIUR",449,0)
 . set siform=$order(items("siform-"))
"RTN","SAMIUR",450,0)
 . new status set status=$get(@root@("graph",sid,siform,"sistatus"))
"RTN","SAMIUR",451,0)
 . if type="inactive",status="active" quit  ; for inactive report
"RTN","SAMIUR",452,0)
 . ;if type'="inactive",status'="active" quit  ; for other reports
"RTN","SAMIUR",453,0)
 . if type'="inactive",type'="activity",type'="enrollment",status'="active" quit  ;other rpts
"RTN","SAMIUR",454,0)
 . new eligible set eligible=$get(@root@("graph",sid,siform,"sicechrt"))
"RTN","SAMIUR",455,0)
 . if type="enrollment",eligible'="y" quit  ; must be eligible
"RTN","SAMIUR",456,0)
 . new enrolled set enrolled=$g(@root@("graph",sid,siform,"sildct"))
"RTN","SAMIUR",457,0)
 . if type="enrollment",enrolled'="y" quit  ; must be enrolled
"RTN","SAMIUR",458,0)
 . ;
"RTN","SAMIUR",459,0)
 . set (ceform,cefud,fmcefud,cedos,fmcedos)=""
"RTN","SAMIUR",460,0)
 . new lastce,sifm,cefm,baseline
"RTN","SAMIUR",461,0)
 . set (lastce,sifm,cefm,baseline)=""
"RTN","SAMIUR",462,0)
 . set sifm=$$FMDT^SAMIUR2($p(siform,"siform-",2))
"RTN","SAMIUR",463,0)
 . ;f  set ceform=$order(items(ceform),-1) q:ceform=""  q:cefud'=""  d  ;
"RTN","SAMIUR",464,0)
 . ;f  set ceform=$order(items(ceform),-1) q:ceform=""  d  ;
"RTN","SAMIUR",465,0)
 . ;. q:ceform'["form"
"RTN","SAMIUR",466,0)
 . ;. if ceform["ceform" if lastce="" set lastce=ceform
"RTN","SAMIUR",467,0)
 . ;. set cefud=$get(@root@("graph",sid,ceform,"cefud"))
"RTN","SAMIUR",468,0)
 . ;. if cefud'="" set fmcefud=$$FMDT^SAMIUR2(cefud)
"RTN","SAMIUR",469,0)
 . ;. set cedos=$get(@root@("graph",sid,ceform,"cedos"))
"RTN","SAMIUR",470,0)
 . ;. if cedos'="" set fmcedos=$$FMDT^SAMIUR2(cedos)
"RTN","SAMIUR",471,0)
 . ;. quit
"RTN","SAMIUR",472,0)
 . ;if $$FMDT^SAMIUR2($p(lastce,"ceform-",2))<sifm set lastce=""
"RTN","SAMIUR",473,0)
 . ;
"RTN","SAMIUR",474,0)
 . set baseline=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMIUR",475,0)
 . set edate=$get(@root@("graph",sid,siform,"sidc"))
"RTN","SAMIUR",476,0)
 . if edate="" set edate=$get(@root@("graph",sid,siform,"samicreatedate"))
"RTN","SAMIUR",477,0)
 . set efmdate=$$FMDT^SAMIUR2(edate)
"RTN","SAMIUR",478,0)
 . set edate=$$VAPALSDT^SAMICASE(efmdate)
"RTN","SAMIUR",479,0)
 . ;
"RTN","SAMIUR",480,0)
 . new latef,latefdt set (latef,latefdt)="" ; latest form for activity report
"RTN","SAMIUR",481,0)
 . new aform,aformdt set (aform,aformdt)=""
"RTN","SAMIUR",482,0)
 . new anyform set anyform=""
"RTN","SAMIUR",483,0)
 . new proot set proot=$na(@root@("graph",sid))
"RTN","SAMIUR",484,0)
 . ;for  set anyform=$order(items("sort",anyform),-1) q:aform'=""  q:anyform=""  d  ;
"RTN","SAMIUR",485,0)
 . for  set anyform=$order(items("sort",anyform),-1) q:anyform=""  d  ;
"RTN","SAMIUR",486,0)
 . . new tempf set tempf=""
"RTN","SAMIUR",487,0)
 . . ;f  set tempf=$order(items("sort",anyform,tempf)) q:tempf=""  q:aform'=""  d  ;
"RTN","SAMIUR",488,0)
 . . f  set tempf=$order(items("sort",anyform,tempf)) q:tempf=""  d  ;
"RTN","SAMIUR",489,0)
 . . . if latef="" d  ; record the latest form for activity report
"RTN","SAMIUR",490,0)
 . . . . set latefdt=anyform ; date of latest form
"RTN","SAMIUR",491,0)
 . . . . new latekey set latekey=$order(items("sort",anyform,tempf,""))
"RTN","SAMIUR",492,0)
 . . . . set latef=$order(items("sort",anyform,tempf,latekey,""))
"RTN","SAMIUR",493,0)
 . . . if lastce="" d  ; if looking for latest ct eval
"RTN","SAMIUR",494,0)
 . . . . if tempf'["ceform" q  ; this is not a ceform
"RTN","SAMIUR",495,0)
 . . . . set lastce=$order(items("sort",anyform,tempf,""))
"RTN","SAMIUR",496,0)
 . . . . if anyform<sifm set lastce="" ; doesn't count - before enrollment
"RTN","SAMIUR",497,0)
 . . . ;if tempf["bxform" q  ; don't want any biopsy forms
"RTN","SAMIUR",498,0)
 . . . new tempk set tempk=$order(items("sort",anyform,tempf,""))
"RTN","SAMIUR",499,0)
 . . . ;if $g(@proot@(tempk,"cefud"))="" q  ; no followup date
"RTN","SAMIUR",500,0)
 . . . new tempt set tempt=$order(items("sort",anyform,tempf,tempk,""))
"RTN","SAMIUR",501,0)
 . . . if cefud="" d  ;
"RTN","SAMIUR",502,0)
 . . . . if $g(@proot@(tempk,"cefud"))="" q  ; no followup date
"RTN","SAMIUR",503,0)
 . . . . set cefud=$g(@proot@(tempk,"cefud"))
"RTN","SAMIUR",504,0)
 . . . . set fmcefud=$$FMDT^SAMIUR2(cefud)
"RTN","SAMIUR",505,0)
 . . . . set ceform=tempk
"RTN","SAMIUR",506,0)
 . . . if aform="" d  ;
"RTN","SAMIUR",507,0)
 . . . . set aform=tempt
"RTN","SAMIUR",508,0)
 . . . . set aformdt=anyform
"RTN","SAMIUR",509,0)
 . ;
"RTN","SAMIUR",510,0)
 . if type="followup" do  ;
"RTN","SAMIUR",511,0)
 . . ; new nplus30 set nplus30=$$FMADD^XLFDT($$NOW^XLFDT,31)
"RTN","SAMIUR",512,0)
 . . if +fmcefud<fmstrdt quit  ; before start date
"RTN","SAMIUR",513,0)
 . . if +fmcefud<(fmenddt+1) do  ; before end date
"RTN","SAMIUR",514,0)
 . . . quit:cefud=""  ; no followup date
"RTN","SAMIUR",515,0)
 . . . set SAMIPATS(fmcefud,zi,"aform")=aform
"RTN","SAMIUR",516,0)
 . . . ;set SAMIPATS(fmcefud,zi,"aform")=latef
"RTN","SAMIUR",517,0)
 . . . set SAMIPATS(fmcefud,zi,"aformdt")=aformdt
"RTN","SAMIUR",518,0)
 . . . ;set SAMIPATS(fmcefud,zi,"aformdt")=latefdt
"RTN","SAMIUR",519,0)
 . . . set SAMIPATS(fmcefud,zi,"edate")=edate
"RTN","SAMIUR",520,0)
 . . . set SAMIPATS(fmcefud,zi,"baseline")=baseline
"RTN","SAMIUR",521,0)
 . . . set SAMIPATS(fmcefud,zi)=""
"RTN","SAMIUR",522,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",523,0)
 . . . set SAMIPATS(fmcefud,zi,"cefud")=cefud
"RTN","SAMIUR",524,0)
 . . . set SAMIPATS(fmcefud,zi,"cedos")=cedos
"RTN","SAMIUR",525,0)
 . . . set SAMIPATS(fmcefud,zi,"ceform")=ceform
"RTN","SAMIUR",526,0)
 . . . set SAMIPATS(fmcefud,zi,"ceform-vals")=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR",527,0)
 . . . set SAMIPATS(fmcefud,zi,"siform")=siform
"RTN","SAMIUR",528,0)
 . . . set SAMIPATS(fmcefud,zi,"siform-vals")=$name(@root@("graph",sid,siform))
"RTN","SAMIUR",529,0)
 . . . merge SAMIPATS(fmcefud,zi,"items")=items
"RTN","SAMIUR",530,0)
 . . . quit
"RTN","SAMIUR",531,0)
 . . set datephrase=" before "_$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",532,0)
 . . quit
"RTN","SAMIUR",533,0)
 . ;
"RTN","SAMIUR",534,0)
 . if type="activity" do  ;
"RTN","SAMIUR",535,0)
 . . new fmanyform set fmanyform=$$FMDT^SAMIUR2(latefdt)
"RTN","SAMIUR",536,0)
 . . if fmanyform<fmstrdt quit  ; before the start date
"RTN","SAMIUR",537,0)
 . . ; if fmanyform<(fmenddt+1)!(efmdate>fmenddt) do  ; need any new form
"RTN","SAMIUR",538,0)
 . . if fmanyform<(fmenddt+1)  do  ;
"RTN","SAMIUR",539,0)
 . . . set SAMIPATS(efmdate,zi,"aform")=latef
"RTN","SAMIUR",540,0)
 . . . set SAMIPATS(efmdate,zi,"aformdt")=$$VAPALSDT^SAMICASE(fmanyform)
"RTN","SAMIUR",541,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",542,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",543,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",544,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",545,0)
 . . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",546,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",547,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",548,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",549,0)
 . . . quit
"RTN","SAMIUR",550,0)
 . . set datephrase=" after "_$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",551,0)
 . . quit
"RTN","SAMIUR",552,0)
 . ;
"RTN","SAMIUR",553,0)
 . ; date filter for all the rest of the reports
"RTN","SAMIUR",554,0)
 . ;
"RTN","SAMIUR",555,0)
 . quit:efmdate<fmstrdt  ; before the start date
"RTN","SAMIUR",556,0)
 . quit:efmdate>(fmenddt+1)  ; after the end date
"RTN","SAMIUR",557,0)
 . ;
"RTN","SAMIUR",558,0)
 . if type="incomplete" do  ;
"RTN","SAMIUR",559,0)
 . . new complete set complete=1
"RTN","SAMIUR",560,0)
 . . new zj set zj=""
"RTN","SAMIUR",561,0)
 . . new gr set gr=$name(@root@("graph",sid))
"RTN","SAMIUR",562,0)
 . . for  do  quit:zj=""  ;
"RTN","SAMIUR",563,0)
 . . . set zj=$order(@gr@(zj))
"RTN","SAMIUR",564,0)
 . . . quit:zj=""
"RTN","SAMIUR",565,0)
 . . . ;
"RTN","SAMIUR",566,0)
 . . . new stat
"RTN","SAMIUR",567,0)
 . . . set stat=$get(@gr@(zj,"samistatus"))
"RTN","SAMIUR",568,0)
 . . . if stat="" set stat="incomplete"
"RTN","SAMIUR",569,0)
 . . . if stat="incomplete" do  ;
"RTN","SAMIUR",570,0)
 . . . . set complete=0
"RTN","SAMIUR",571,0)
 . . . . set SAMIPATS(efmdate,zi,"iform")=$get(SAMIPATS(efmdate,zi,"iform"))_" "_zj
"RTN","SAMIUR",572,0)
 . . . . quit
"RTN","SAMIUR",573,0)
 . . . quit
"RTN","SAMIUR",574,0)
 . . ;
"RTN","SAMIUR",575,0)
 . . if complete=0 do  ; has incomplete form(s) 
"RTN","SAMIUR",576,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",577,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",578,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",579,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",580,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",581,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",582,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",583,0)
 . . . quit
"RTN","SAMIUR",584,0)
 . . set datephrase=""
"RTN","SAMIUR",585,0)
 . . quit
"RTN","SAMIUR",586,0)
 . ;
"RTN","SAMIUR",587,0)
 . if type="missingct" do  ;
"RTN","SAMIUR",588,0)
 . . if lastce="" do  ; has no ct since enrollment 
"RTN","SAMIUR",589,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",590,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",591,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",592,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",593,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",594,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",595,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",596,0)
 . . . quit
"RTN","SAMIUR",597,0)
 . . set datephrase=""
"RTN","SAMIUR",598,0)
 . . quit
"RTN","SAMIUR",599,0)
 . ;
"RTN","SAMIUR",600,0)
 . if type="outreach" do  ; no-op; hook for future development?
"RTN","SAMIUR",601,0)
 . . quit
"RTN","SAMIUR",602,0)
 . ;
"RTN","SAMIUR",603,0)
 . if type="enrollment" do  ;
"RTN","SAMIUR",604,0)
 . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",605,0)
 . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",606,0)
 . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",607,0)
 . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",608,0)
 . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",609,0)
 . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",610,0)
 . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",611,0)
 . . quit
"RTN","SAMIUR",612,0)
 . ;
"RTN","SAMIUR",613,0)
 . if type="inactive" do  ;
"RTN","SAMIUR",614,0)
 . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",615,0)
 . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",616,0)
 . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",617,0)
 . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",618,0)
 . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",619,0)
 . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",620,0)
 . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",621,0)
 . . quit
"RTN","SAMIUR",622,0)
 . ;
"RTN","SAMIUR",623,0)
 . set datephrase=" as of "_$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMIUR",624,0)
 . quit
"RTN","SAMIUR",625,0)
 ;
"RTN","SAMIUR",626,0)
 quit  ; end of SELECT
"RTN","SAMIUR",627,0)
 ;
"RTN","SAMIUR",628,0)
 ;
"RTN","SAMIUR",629,0)
 ;
"RTN","SAMIUR",630,0)
UNMAT(SAMIPATS,ztype,datephrase,filter) ; build unmatched persons list
"RTN","SAMIUR",631,0)
 ;
"RTN","SAMIUR",632,0)
 ;@called-by
"RTN","SAMIUR",633,0)
 ; SELECT
"RTN","SAMIUR",634,0)
 ;@calls
"RTN","SAMIUR",635,0)
 ; $$setroot^%wd
"RTN","SAMIUR",636,0)
 ;
"RTN","SAMIUR",637,0)
 set datephrase="Unmatched Persons"
"RTN","SAMIUR",638,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",639,0)
 new dfn set dfn=9000000
"RTN","SAMIUR",640,0)
 for  do  quit:'dfn  ;
"RTN","SAMIUR",641,0)
 . set dfn=$order(@lroot@("dfn",dfn))
"RTN","SAMIUR",642,0)
 . quit:'dfn
"RTN","SAMIUR",643,0)
 . ;
"RTN","SAMIUR",644,0)
 . new ien set ien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",645,0)
 . quit:ien=""
"RTN","SAMIUR",646,0)
 . n ordern
"RTN","SAMIUR",647,0)
 . s ordern=$g(@lroot@(ien,"ORMORCordernumber"))
"RTN","SAMIUR",648,0)
 . i ordern="" s ordern=$g(@lroot@(ien,"ORM",1,"ordernumber"))
"RTN","SAMIUR",649,0)
 . i ordern'="" q  ;
"RTN","SAMIUR",650,0)
 . i $g(@lroot@(ien,"siteid"))'[site q  ;
"RTN","SAMIUR",651,0)
 . ;quit:$get(@lroot@(ien,"remotedfn"))'=""  ;
"RTN","SAMIUR",652,0)
 . ;
"RTN","SAMIUR",653,0)
 . merge SAMIPATS(ien,dfn)=@lroot@(ien)
"RTN","SAMIUR",654,0)
 . ;
"RTN","SAMIUR",655,0)
 . new name set name=$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR",656,0)
 . ; new name set name=$get(SAMIPATS(ien,dfn,"sinamef"))
"RTN","SAMIUR",657,0)
 . ; set name=name_","_SAMIPATS(ien,dfn,"sinamel")
"RTN","SAMIUR",658,0)
 . new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR",659,0)
 . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""editperson"">"
"RTN","SAMIUR",660,0)
 . set nuhref=nuhref_"<input type=hidden name=""dfn"" value="_dfn_">"
"RTN","SAMIUR",661,0)
 . set nuhref=nuhref_"<input type=hidden name=""siteid"" value="_site_">"
"RTN","SAMIUR",662,0)
 . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",663,0)
 . set SAMIPATS(ien,dfn,"editref")=nuhref
"RTN","SAMIUR",664,0)
 . quit
"RTN","SAMIUR",665,0)
 ;
"RTN","SAMIUR",666,0)
 quit  ; end of UNMAT
"RTN","SAMIUR",667,0)
 ;
"RTN","SAMIUR",668,0)
 ;
"RTN","SAMIUR",669,0)
 ;
"RTN","SAMIUR",670,0)
WKLIST(SAMIPATS,ztype,datephrase,filter) ; build work list
"RTN","SAMIUR",671,0)
 ;
"RTN","SAMIUR",672,0)
 ;@called-by
"RTN","SAMIUR",673,0)
 ; SELECT
"RTN","SAMIUR",674,0)
 ;@calls
"RTN","SAMIUR",675,0)
 ; $$setroot^%wd
"RTN","SAMIUR",676,0)
 ;
"RTN","SAMIUR",677,0)
 ; add site
"RTN","SAMIUR",678,0)
 ; add compare to vapals-patients
"RTN","SAMIUR",679,0)
 ; add navigation to enrollment
"RTN","SAMIUR",680,0)
 ;
"RTN","SAMIUR",681,0)
 kill ^gpl("worklist")
"RTN","SAMIUR",682,0)
 merge ^gpl("worklist")=filter
"RTN","SAMIUR",683,0)
 new site
"RTN","SAMIUR",684,0)
 set site=$get(filter("siteid"))
"RTN","SAMIUR",685,0)
 quit:site=""
"RTN","SAMIUR",686,0)
 set datephrase="Work List"
"RTN","SAMIUR",687,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",688,0)
 new proot set proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",689,0)
 ;
"RTN","SAMIUR",690,0)
 new dfn set dfn=0
"RTN","SAMIUR",691,0)
 for  set dfn=$order(@lroot@("dfn",dfn)) quit:+dfn=0  do  ;
"RTN","SAMIUR",692,0)
 . quit:$order(@proot@("dfn",dfn,""))'=""
"RTN","SAMIUR",693,0)
 . new ien set ien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",694,0)
 . quit:ien=""
"RTN","SAMIUR",695,0)
 . ;
"RTN","SAMIUR",696,0)
 . ; write !,"dfn= ",dfn
"RTN","SAMIUR",697,0)
 . ; zwrite @lroot@(ien,*)
"RTN","SAMIUR",698,0)
 . ;
"RTN","SAMIUR",699,0)
 . quit:$get(@lroot@(ien,"siteid"))'=site
"RTN","SAMIUR",700,0)
 . ;
"RTN","SAMIUR",701,0)
 . merge ^gpl("worklist","lroot",ien)=@lroot@(ien)
"RTN","SAMIUR",702,0)
 . merge SAMIPATS(ien,dfn)=@lroot@(ien)
"RTN","SAMIUR",703,0)
 . new name set name=$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR",704,0)
 . ; new name set name=$get(SAMIPATS(ien,dfn,"sinamef"))
"RTN","SAMIUR",705,0)
 . ; set name=name_","_SAMIPATS(ien,dfn,"sinamel")
"RTN","SAMIUR",706,0)
 . new nuhref
"RTN","SAMIUR",707,0)
 . set nuhref="<td data-search="""_name_""" data-order="""_name_""">"
"RTN","SAMIUR",708,0)
 . set nuhref=nuhref_"<form method=POST action=""/vapals"">"
"RTN","SAMIUR",709,0)
 . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""newcase"">"
"RTN","SAMIUR",710,0)
 . set nuhref=nuhref_"<input type=hidden name=""dfn"" value="_dfn_">"
"RTN","SAMIUR",711,0)
 . set nuhref=nuhref_"<input type=hidden name=""siteid"" value="_site_">"
"RTN","SAMIUR",712,0)
 . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",713,0)
 . set nuhref=nuhref_"</td>"
"RTN","SAMIUR",714,0)
 . set SAMIPATS(ien,dfn,"workref")=nuhref
"RTN","SAMIUR",715,0)
 . quit
"RTN","SAMIUR",716,0)
 ;
"RTN","SAMIUR",717,0)
 merge ^gpl("worklist","pats")=SAMIPATS
"RTN","SAMIUR",718,0)
 ;
"RTN","SAMIUR",719,0)
 quit  ; end of WKLIST
"RTN","SAMIUR",720,0)
 ;
"RTN","SAMIUR",721,0)
 ;
"RTN","SAMIUR",722,0)
 ;
"RTN","SAMIUR",723,0)
EOR ; end of SAMIUR
"RTN","SAMIUR2")
0^2^B1360826675
"RTN","SAMIUR2",1,0)
SAMIUR2 ;ven/gpl - user reports cont ;2021-10-05t23:28z
"RTN","SAMIUR2",2,0)
 ;;18.0;SAMI;**5,11,12,14**;2020-01;Build 8
"RTN","SAMIUR2",3,0)
 ;;18.14
"RTN","SAMIUR2",4,0)
 ;
"RTN","SAMIUR2",5,0)
 ; SAMIUR2 contains subroutines for creating & implementing the
"RTN","SAMIUR2",6,0)
 ; report-definition table.
"RTN","SAMIUR2",7,0)
 ;
"RTN","SAMIUR2",8,0)
 quit  ; no entry from top
"RTN","SAMIUR2",9,0)
 ;
"RTN","SAMIUR2",10,0)
 ;
"RTN","SAMIUR2",11,0)
 ;
"RTN","SAMIUR2",12,0)
 ;@section 0 primary development
"RTN","SAMIUR2",13,0)
 ;
"RTN","SAMIUR2",14,0)
 ;
"RTN","SAMIUR2",15,0)
 ;
"RTN","SAMIUR2",16,0)
 ;@routine-credits
"RTN","SAMIUR2",17,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIUR2",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUR2",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIUR2",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIUR2",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIUR2",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIUR2",23,0)
 ;
"RTN","SAMIUR2",24,0)
 ;@last-update 2021-10-05t23:28z
"RTN","SAMIUR2",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIUR2",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIUR2",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUR2",28,0)
 ;@version 18.14
"RTN","SAMIUR2",29,0)
 ;@release-date 2020-01
"RTN","SAMIUR2",30,0)
 ;@patch-list **5,11,12,14**
"RTN","SAMIUR2",31,0)
 ;
"RTN","SAMIUR2",32,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIUR2",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUR2",34,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIUR2",35,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIUR2",36,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIUR2",37,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIUR2",38,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIUR2",39,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIUR2",40,0)
 ;
"RTN","SAMIUR2",41,0)
 ;@module-credits see SAMIHUL
"RTN","SAMIUR2",42,0)
 ;
"RTN","SAMIUR2",43,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUR2",44,0)
 ; see SAMIURUL
"RTN","SAMIUR2",45,0)
 ;
"RTN","SAMIUR2",46,0)
 ;@contents
"RTN","SAMIUR2",47,0)
 ; RPTTBL build report-definition table
"RTN","SAMIUR2",48,0)
 ;
"RTN","SAMIUR2",49,0)
 ; $$DFN2SID study id for patient DFN
"RTN","SAMIUR2",50,0)
 ; $$MKNAV html for navigation to form
"RTN","SAMIUR2",51,0)
 ;
"RTN","SAMIUR2",52,0)
 ; $$SHDET table contents for smoking history
"RTN","SAMIUR2",53,0)
 ; CUMPY forms array of cummulative pack year data
"RTN","SAMIUR2",54,0)
 ; $$TDDT embed date in table cell
"RTN","SAMIUR2",55,0)
 ; $$FMDT convert date to fileman format
"RTN","SAMIUR2",56,0)
 ; $$PKYDT pack-years from start & end & cigs/day
"RTN","SAMIUR2",57,0)
 ; $$PKY pack-years from years & packs/day
"RTN","SAMIUR2",58,0)
 ;
"RTN","SAMIUR2",59,0)
 ; $$AGE age
"RTN","SAMIUR2",60,0)
 ; $$BLINEDT baseline date
"RTN","SAMIUR2",61,0)
 ; $$CONTACT patient street address
"RTN","SAMIUR2",62,0)
 ; $$CTPROT ct protocol
"RTN","SAMIUR2",63,0)
 ; $$DOB date of birth
"RTN","SAMIUR2",64,0)
 ; $$FUDATE followup date
"RTN","SAMIUR2",65,0)
 ; $$GENDER gender
"RTN","SAMIUR2",66,0)
 ; $$IFORM name(s) of incomplete forms
"RTN","SAMIUR2",67,0)
 ; $$LASTEXM patient last exam
"RTN","SAMIUR2",68,0)
 ; $$MANPAT unmatched patient cell
"RTN","SAMIUR2",69,0)
 ; $$MATCH match button cell
"RTN","SAMIUR2",70,0)
 ; $$NAME name w/hyperlink
"RTN","SAMIUR2",71,0)
 ; $$PACKYRS smoking status
"RTN","SAMIUR2",72,0)
 ; $$POSSIBLE possible match cell
"RTN","SAMIUR2",73,0)
 ; $$RECOM recommendation
"RTN","SAMIUR2",74,0)
 ; $$RURAL patient's rural/urban status
"RTN","SAMIUR2",75,0)
 ; $$SID study id
"RTN","SAMIUR2",76,0)
 ; $$SMHIS smoking history cell
"RTN","SAMIUR2",77,0)
 ; $$SMKSTAT smoking status
"RTN","SAMIUR2",78,0)
 ; $$SSN social security number
"RTN","SAMIUR2",79,0)
 ; $$STUDYDT latest study date
"RTN","SAMIUR2",80,0)
 ; $$STUDYTYP latest study type
"RTN","SAMIUR2",81,0)
 ; $$VALS form-values cell
"RTN","SAMIUR2",82,0)
 ; $$WHEN followup text
"RTN","SAMIUR2",83,0)
 ; $$WORKPAT worklist patient name cell
"RTN","SAMIUR2",84,0)
 ;
"RTN","SAMIUR2",85,0)
 ; EPAT patient name w/nav to enrollment
"RTN","SAMIUR2",86,0)
 ; ETHNCTY ethnicity
"RTN","SAMIUR2",87,0)
 ; RACE race
"RTN","SAMIUR2",88,0)
 ; STATUS patient status
"RTN","SAMIUR2",89,0)
 ; WSVALS display form values from graph
"RTN","SAMIUR2",90,0)
 ;
"RTN","SAMIUR2",91,0)
 ;
"RTN","SAMIUR2",92,0)
 ;
"RTN","SAMIUR2",93,0)
 ;@section 1 ppi RPTTBL^SAMIUR2
"RTN","SAMIUR2",94,0)
 ;
"RTN","SAMIUR2",95,0)
 ;
"RTN","SAMIUR2",96,0)
 ;
"RTN","SAMIUR2",97,0)
RPTTBL(RPT,TYPE,SITE) ; RPT is passed by reference and returns the 
"RTN","SAMIUR2",98,0)
 ; report definition table. TYPE is the report type to be returned
"RTN","SAMIUR2",99,0)
 ; This routine could use a file or a graph in the next version
"RTN","SAMIUR2",100,0)
 ;
"RTN","SAMIUR2",101,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIUR2",102,0)
 ;@called-by
"RTN","SAMIUR2",103,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",104,0)
 ; WSREPORT^SAMIUR1 (which then calls WSREPORT^SAMIUR)
"RTN","SAMIUR2",105,0)
 ;@calls none (defines calls for WSREPORT^SAMIUR to call)
"RTN","SAMIUR2",106,0)
 ;@input
"RTN","SAMIUR2",107,0)
 ; TYPE = report type to return
"RTN","SAMIUR2",108,0)
 ;@output
"RTN","SAMIUR2",109,0)
 ; .RPT report-definition table
"RTN","SAMIUR2",110,0)
 ;
"RTN","SAMIUR2",111,0)
 ; This routine could use a file or a graph in the next version
"RTN","SAMIUR2",112,0)
 ;
"RTN","SAMIUR2",113,0)
 if TYPE="followup" do  quit  ;
"RTN","SAMIUR2",114,0)
 . set RPT(1,"header")="F/U Date"
"RTN","SAMIUR2",115,0)
 . set RPT(1,"routine")="$$FUDATE^SAMIUR2"
"RTN","SAMIUR2",116,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",117,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",118,0)
 . ;set RPT(3,"header")="SSN"
"RTN","SAMIUR2",119,0)
 . set RPT(3,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",120,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",121,0)
 . set RPT(4,"header")="Baseline Date"
"RTN","SAMIUR2",122,0)
 . set RPT(4,"routine")="$$BLINEDT^SAMIUR2"
"RTN","SAMIUR2",123,0)
 . set RPT(5,"header")="Last Form"
"RTN","SAMIUR2",124,0)
 . set RPT(5,"routine")="$$AFORM^SAMIUR2"
"RTN","SAMIUR2",125,0)
 . set RPT(6,"header")="Form Date"
"RTN","SAMIUR2",126,0)
 . set RPT(6,"routine")="$$AFORMDT^SAMIUR2"
"RTN","SAMIUR2",127,0)
 . set RPT(7,"header")="Recommend"
"RTN","SAMIUR2",128,0)
 . set RPT(7,"routine")="$$RECOM^SAMIUR2"
"RTN","SAMIUR2",129,0)
 . set RPT(8,"header")="Contact Information"
"RTN","SAMIUR2",130,0)
 . set RPT(8,"routine")="$$CONTACT^SAMIUR2"
"RTN","SAMIUR2",131,0)
 . quit
"RTN","SAMIUR2",132,0)
 ;
"RTN","SAMIUR2",133,0)
 if TYPE="activity" do  quit  ;
"RTN","SAMIUR2",134,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",135,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",136,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",137,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",138,0)
 . set RPT(2.2,"header")="Active/Inactive"
"RTN","SAMIUR2",139,0)
 . set RPT(2.2,"routine")="$$ACTIVE^SAMIUR2"
"RTN","SAMIUR2",140,0)
 . set RPT(2.5,"header")="Form"
"RTN","SAMIUR2",141,0)
 . set RPT(2.5,"routine")="$$AFORM^SAMIUR2"
"RTN","SAMIUR2",142,0)
 . set RPT(3,"header")="Form Date"
"RTN","SAMIUR2",143,0)
 . ;set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",144,0)
 . set RPT(3,"routine")="$$AFORMDT^SAMIUR2"
"RTN","SAMIUR2",145,0)
 . ;set RPT(4,"header")="Type"
"RTN","SAMIUR2",146,0)
 . ;set RPT(4,"routine")="$$STUDYTYP^SAMIUR2"
"RTN","SAMIUR2",147,0)
 . ;set RPT(5,"header")="CT Protocol"
"RTN","SAMIUR2",148,0)
 . ;set RPT(5,"routine")="$$CTPROT^SAMIUR2"
"RTN","SAMIUR2",149,0)
 . set RPT(6,"header")="Follow-up"
"RTN","SAMIUR2",150,0)
 . set RPT(6,"routine")="$$RECOM^SAMIUR2"
"RTN","SAMIUR2",151,0)
 . ;set RPT(7,"header")="When"
"RTN","SAMIUR2",152,0)
 . ;set RPT(7,"routine")="$$WHEN^SAMIUR2"
"RTN","SAMIUR2",153,0)
 . set RPT(8,"header")="on Date"
"RTN","SAMIUR2",154,0)
 . set RPT(8,"routine")="$$FUDATE^SAMIUR2"
"RTN","SAMIUR2",155,0)
 . quit
"RTN","SAMIUR2",156,0)
 ;
"RTN","SAMIUR2",157,0)
 if TYPE="enrollment" do  quit  ;
"RTN","SAMIUR2",158,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",159,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",160,0)
 . set RPT(1.5,"header")="Active/Inactive"
"RTN","SAMIUR2",161,0)
 . set RPT(1.5,"routine")="$$ACTIVE^SAMIUR2"
"RTN","SAMIUR2",162,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",163,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",164,0)
 . set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",165,0)
 . set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",166,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",167,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",168,0)
 . ; set RPT(5,"header")="Race"
"RTN","SAMIUR2",169,0)
 . ; set RPT(5,"routine")="$$RACE^SAMIUR2"
"RTN","SAMIUR2",170,0)
 . set RPT(6,"header")="Age"
"RTN","SAMIUR2",171,0)
 . set RPT(6,"routine")="$$AGE^SAMIUR2"
"RTN","SAMIUR2",172,0)
 . set RPT(7,"header")="Urban/Rural"
"RTN","SAMIUR2",173,0)
 . set RPT(7,"routine")="$$RURAL^SAMIUR2"
"RTN","SAMIUR2",174,0)
 . set RPT(8,"header")="Smoking Status"
"RTN","SAMIUR2",175,0)
 . set RPT(8,"routine")="$$SMKSTAT^SAMIUR2"
"RTN","SAMIUR2",176,0)
 . set RPT(9,"header")="Pack Years at Intake"
"RTN","SAMIUR2",177,0)
 . set RPT(9,"routine")="$$PACKYRS^SAMIUR2"
"RTN","SAMIUR2",178,0)
 . quit
"RTN","SAMIUR2",179,0)
 ;
"RTN","SAMIUR2",180,0)
 if TYPE="inactive" do  quit  ;
"RTN","SAMIUR2",181,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",182,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",183,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",184,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",185,0)
 . set RPT(3,"header")="Enrollment date"
"RTN","SAMIUR2",186,0)
 . set RPT(3,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",187,0)
 . ;set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",188,0)
 . ;set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",189,0)
 . ;set RPT(4,"header")="Gender"
"RTN","SAMIUR2",190,0)
 . ;set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",191,0)
 . ; set RPT(5,"header")="Race"
"RTN","SAMIUR2",192,0)
 . ; set RPT(5,"routine")="$$RACE^SAMIUR2"
"RTN","SAMIUR2",193,0)
 . ;set RPT(6,"header")="Age"
"RTN","SAMIUR2",194,0)
 . ;set RPT(6,"routine")="$$AGE^SAMIUR2"
"RTN","SAMIUR2",195,0)
 . set RPT(4,"header")="Date of Death"
"RTN","SAMIUR2",196,0)
 . set RPT(4,"routine")="$$INACTDT^SAMIUR2"
"RTN","SAMIUR2",197,0)
 . set RPT(5,"header")="Inactive Reason"
"RTN","SAMIUR2",198,0)
 . set RPT(5,"routine")="$$INACTRE^SAMIUR2"
"RTN","SAMIUR2",199,0)
 . set RPT(6,"header")="Inactive Comment"
"RTN","SAMIUR2",200,0)
 . set RPT(6,"routine")="$$INACTCM^SAMIUR2"
"RTN","SAMIUR2",201,0)
 . ;set RPT(7,"header")="Urban/Rural"
"RTN","SAMIUR2",202,0)
 . ;set RPT(7,"routine")="$$RURAL^SAMIUR2"
"RTN","SAMIUR2",203,0)
 . ;set RPT(8,"header")="Smoking Status"
"RTN","SAMIUR2",204,0)
 . ;set RPT(8,"routine")="$$SMKSTAT^SAMIUR2"
"RTN","SAMIUR2",205,0)
 . ;set RPT(9,"header")="Pack Years at Intake"
"RTN","SAMIUR2",206,0)
 . ;set RPT(9,"routine")="$$PACKYRS^SAMIUR2"
"RTN","SAMIUR2",207,0)
 . quit
"RTN","SAMIUR2",208,0)
 ;
"RTN","SAMIUR2",209,0)
 if TYPE="incomplete" do  quit  ;
"RTN","SAMIUR2",210,0)
 . set RPT(1,"header")="Enrollment date"
"RTN","SAMIUR2",211,0)
 . set RPT(1,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",212,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",213,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",214,0)
 . set RPT(3,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",215,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",216,0)
 . set RPT(4,"header")="Incomplete form"
"RTN","SAMIUR2",217,0)
 . set RPT(4,"routine")="$$IFORM^SAMIUR2"
"RTN","SAMIUR2",218,0)
 . quit
"RTN","SAMIUR2",219,0)
 ;
"RTN","SAMIUR2",220,0)
 if TYPE="missingct" do  quit  ;
"RTN","SAMIUR2",221,0)
 . set RPT(1,"header")="Last contact date"
"RTN","SAMIUR2",222,0)
 . set RPT(1,"routine")="$$LDOC^SAMIUR2"
"RTN","SAMIUR2",223,0)
 . set RPT(2,"header")="Last contact entry"
"RTN","SAMIUR2",224,0)
 . set RPT(2,"routine")="$$LENTRY^SAMIUR2"
"RTN","SAMIUR2",225,0)
 . set RPT(3,"header")="Name"
"RTN","SAMIUR2",226,0)
 . set RPT(3,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",227,0)
 . set RPT(4,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",228,0)
 . set RPT(4,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",229,0)
 . set RPT(5,"header")="Enrollment date"
"RTN","SAMIUR2",230,0)
 . set RPT(5,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",231,0)
 . quit
"RTN","SAMIUR2",232,0)
 ;
"RTN","SAMIUR2",233,0)
 if TYPE="cumpy" do  quit  ;
"RTN","SAMIUR2",234,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",235,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",236,0)
 . set RPT(2,"header")="Study ID"
"RTN","SAMIUR2",237,0)
 . set RPT(2,"routine")="$$SID^SAMIUR2"
"RTN","SAMIUR2",238,0)
 . set RPT(3,"header")="Form Values"
"RTN","SAMIUR2",239,0)
 . set RPT(3,"routine")="$$VALS^SAMIUR2"
"RTN","SAMIUR2",240,0)
 . set RPT(4,"header")="Smoking History"
"RTN","SAMIUR2",241,0)
 . set RPT(4,"routine")="$$SMHIS^SAMIUR2"
"RTN","SAMIUR2",242,0)
 . quit
"RTN","SAMIUR2",243,0)
 ;
"RTN","SAMIUR2",244,0)
 if TYPE="unmatched" do  ;
"RTN","SAMIUR2",245,0)
 . set RPT(1,"header")="Unmatched Manual Entry"
"RTN","SAMIUR2",246,0)
 . set RPT(1,"routine")="$$MANPAT^SAMIUR2"
"RTN","SAMIUR2",247,0)
 . set RPT(2,"header")="Possible HL7 Match"
"RTN","SAMIUR2",248,0)
 . set RPT(2,"routine")="$$POSSIBLE^SAMIUR2"
"RTN","SAMIUR2",249,0)
 . set RPT(3,"header")="Match Control"
"RTN","SAMIUR2",250,0)
 . set RPT(3,"routine")="$$MATCH^SAMIUR2"
"RTN","SAMIUR2",251,0)
 . quit
"RTN","SAMIUR2",252,0)
 ;
"RTN","SAMIUR2",253,0)
 if TYPE="worklist" do  quit  ;
"RTN","SAMIUR2",254,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",255,0)
 . set RPT(1,"routine")="$$WORKPAT^SAMIUR2"
"RTN","SAMIUR2",256,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",257,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",258,0)
 . set RPT(3,"header")="Date of birth"
"RTN","SAMIUR2",259,0)
 . set RPT(3,"routine")="$$DOB^SAMIUR2"
"RTN","SAMIUR2",260,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",261,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",262,0)
 . quit
"RTN","SAMIUR2",263,0)
 ;
"RTN","SAMIUR2",264,0)
 quit  ; end of ppi RPTTBL^SAMIUR2
"RTN","SAMIUR2",265,0)
 ;
"RTN","SAMIUR2",266,0)
 ;
"RTN","SAMIUR2",267,0)
 ;
"RTN","SAMIUR2",268,0)
 ;@section 2 shared subroutines
"RTN","SAMIUR2",269,0)
 ;
"RTN","SAMIUR2",270,0)
 ;
"RTN","SAMIUR2",271,0)
 ;
"RTN","SAMIUR2",272,0)
DFN2SID(DFN) ;studyid for patient DFN
"RTN","SAMIUR2",273,0)
 ;
"RTN","SAMIUR2",274,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",275,0)
 ;@called-by
"RTN","SAMIUR2",276,0)
 ; $$SID^SAMIUR2
"RTN","SAMIUR2",277,0)
 ; $$IFORM^SAMIUR2
"RTN","SAMIUR2",278,0)
 ; $$VALS^SAMIUR2
"RTN","SAMIUR2",279,0)
 ; $$SMHIS^SAMIUR2
"RTN","SAMIUR2",280,0)
 ;@calls
"RTN","SAMIUR2",281,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",282,0)
 ;
"RTN","SAMIUR2",283,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",284,0)
 ;
"RTN","SAMIUR2",285,0)
 quit $get(@root@(DFN,"sisid")) ; end of $$DFN2SID
"RTN","SAMIUR2",286,0)
 ;
"RTN","SAMIUR2",287,0)
 ;
"RTN","SAMIUR2",288,0)
 ;
"RTN","SAMIUR2",289,0)
MKNAV(sid,zform,fname,form) ; html for navigation to form
"RTN","SAMIUR2",290,0)
 ;
"RTN","SAMIUR2",291,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",292,0)
 ;@called-by
"RTN","SAMIUR2",293,0)
 ; $$IFORM^SAMIUR2
"RTN","SAMIUR2",294,0)
 ;@calls none
"RTN","SAMIUR2",295,0)
 ;
"RTN","SAMIUR2",296,0)
 new rtn set rtn="<form method=""post"" action=""/vapals"">"
"RTN","SAMIUR2",297,0)
 set rtn=rtn_"<input name=""samiroute"" value=""form"" type=""hidden"">"
"RTN","SAMIUR2",298,0)
 set rtn=rtn_" <input name=""studyid"" value="""_sid_""" type=""hidden"">"
"RTN","SAMIUR2",299,0)
 set rtn=rtn_" <input name=""form"" value=""vapals:"_zform_""" type=""hidden"">"
"RTN","SAMIUR2",300,0)
 set rtn=rtn_" <input value="""_fname_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"_$char(13)
"RTN","SAMIUR2",301,0)
 ;
"RTN","SAMIUR2",302,0)
 quit rtn ; end of $$MKNAV
"RTN","SAMIUR2",303,0)
 ;
"RTN","SAMIUR2",304,0)
 ;
"RTN","SAMIUR2",305,0)
 ;
"RTN","SAMIUR2",306,0)
 ;@section 3 smoking history subroutines
"RTN","SAMIUR2",307,0)
 ;
"RTN","SAMIUR2",308,0)
 ;
"RTN","SAMIUR2",309,0)
 ;
"RTN","SAMIUR2",310,0)
SHDET(SID,KEY) ; table contents for smoking history
"RTN","SAMIUR2",311,0)
 ;
"RTN","SAMIUR2",312,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",313,0)
 ;@called-by
"RTN","SAMIUR2",314,0)
 ; LOAD^SAMIFLD
"RTN","SAMIUR2",315,0)
 ; $$SMHIS^SAMIUR2
"RTN","SAMIUR2",316,0)
 ;@calls
"RTN","SAMIUR2",317,0)
 ; CUMPY
"RTN","SAMIUR2",318,0)
 ;
"RTN","SAMIUR2",319,0)
 ; KEY is the form key of the caller for "current" marker insertion
"RTN","SAMIUR2",320,0)
 ;
"RTN","SAMIUR2",321,0)
 new pyary
"RTN","SAMIUR2",322,0)
 if $get(KEY)="" set KEY=""
"RTN","SAMIUR2",323,0)
 do CUMPY("pyary",SID,KEY)
"RTN","SAMIUR2",324,0)
 ;
"RTN","SAMIUR2",325,0)
 new current set current=$get(pyary("current"))
"RTN","SAMIUR2",326,0)
 new rptcnt set rptcnt=0
"RTN","SAMIUR2",327,0)
 new rptmax set rptmax=$order(pyary("rpt",""),-1)
"RTN","SAMIUR2",328,0)
 quit:+rptmax=0
"RTN","SAMIUR2",329,0)
 ;
"RTN","SAMIUR2",330,0)
 new return set return=""
"RTN","SAMIUR2",331,0)
 new zi set zi=""
"RTN","SAMIUR2",332,0)
 for zi=1:1:rptmax do  ;
"RTN","SAMIUR2",333,0)
 . set rptcnt=rptcnt+1
"RTN","SAMIUR2",334,0)
 . if rptcnt=current set return=return_"<tr data-current-form=""true"">"
"RTN","SAMIUR2",335,0)
 . else  set return=return_"<tr>"
"RTN","SAMIUR2",336,0)
 . set return=return_"<td>"_pyary("rpt",rptcnt,1)_"</td>"
"RTN","SAMIUR2",337,0)
 . set return=return_"<td class=""reported-date"">"_pyary("rpt",rptcnt,2)_"</td>"
"RTN","SAMIUR2",338,0)
 . set return=return_"<td class=""pack-years"">"_pyary("rpt",rptcnt,3)_"</td>"
"RTN","SAMIUR2",339,0)
 . set return=return_"<td class=""cumulative-pack-years"">"_pyary("rpt",rptcnt,4)_"</td>"
"RTN","SAMIUR2",340,0)
 . set return=return_"</tr>"
"RTN","SAMIUR2",341,0)
 . quit
"RTN","SAMIUR2",342,0)
 ;
"RTN","SAMIUR2",343,0)
 quit return ; end of ppi $$SHDET^SAMIUR2
"RTN","SAMIUR2",344,0)
 ;
"RTN","SAMIUR2",345,0)
 ;
"RTN","SAMIUR2",346,0)
 ;
"RTN","SAMIUR2",347,0)
CUMPY(PYARY,sid,KEY) ; forms array of cummulative pack year data
"RTN","SAMIUR2",348,0)
 ;
"RTN","SAMIUR2",349,0)
 ;;ppi;procedure;clean;silent;sac
"RTN","SAMIUR2",350,0)
 ;@called-by
"RTN","SAMIUR2",351,0)
 ; SSTATUS^SAMINOT2
"RTN","SAMIUR2",352,0)
 ; SSTATUS^SAMINOT3
"RTN","SAMIUR2",353,0)
 ; $$SHDET
"RTN","SAMIUR2",354,0)
 ;@calls
"RTN","SAMIUR2",355,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",356,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIUR2",357,0)
 ; $$GETDTKEY^SAMICAS2
"RTN","SAMIUR2",358,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMIUR2",359,0)
 ; $$FMDT
"RTN","SAMIUR2",360,0)
 ; $$PKYDT
"RTN","SAMIUR2",361,0)
 ;
"RTN","SAMIUR2",362,0)
 ; PYARY passed by name
"RTN","SAMIUR2",363,0)
 ; KEY is the current form key for matching to a row
"RTN","SAMIUR2",364,0)
 ;
"RTN","SAMIUR2",365,0)
 kill @PYARY
"RTN","SAMIUR2",366,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",367,0)
 ; new sid set sid=$get(@root@(DFN,"samistudyid"))
"RTN","SAMIUR2",368,0)
 ; quit:sid=""
"RTN","SAMIUR2",369,0)
 ;
"RTN","SAMIUR2",370,0)
 new items set items=""
"RTN","SAMIUR2",371,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR2",372,0)
 quit:'$data(items)
"RTN","SAMIUR2",373,0)
 merge @PYARY@("items")=items
"RTN","SAMIUR2",374,0)
 ;
"RTN","SAMIUR2",375,0)
 new siform set siform=$order(items("siform"))
"RTN","SAMIUR2",376,0)
 quit:siform=""
"RTN","SAMIUR2",377,0)
 if siform=$get(KEY) set @PYARY@("current")=1 ;this row is the current form
"RTN","SAMIUR2",378,0)
 ;
"RTN","SAMIUR2",379,0)
 set @PYARY@("rpt",1,1)="Intake" ; Form
"RTN","SAMIUR2",380,0)
 new kdate set kdate=$$GETDTKEY^SAMICAS2(siform)
"RTN","SAMIUR2",381,0)
 new keydate set keydate=$$KEY2DSPD^SAMICAS2(kdate)
"RTN","SAMIUR2",382,0)
 set @PYARY@("rpt",1,2)=keydate ; Reported Date
"RTN","SAMIUR2",383,0)
 ;
"RTN","SAMIUR2",384,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",385,0)
 new lastcum set lastcum=$get(@vals@("sippy"))
"RTN","SAMIUR2",386,0)
 set @PYARY@("rpt",1,3)=lastcum ; Pack Years
"RTN","SAMIUR2",387,0)
 set @PYARY@("rpt",1,4)=lastcum ; Cumulative
"RTN","SAMIUR2",388,0)
 ;
"RTN","SAMIUR2",389,0)
 new lastdt set lastdt=keydate
"RTN","SAMIUR2",390,0)
 new rptcnt set rptcnt=1
"RTN","SAMIUR2",391,0)
 new zi set zi=""
"RTN","SAMIUR2",392,0)
 for  do  quit:zi=""  ;
"RTN","SAMIUR2",393,0)
 . set zi=$order(items("type","vapals:fuform",zi))
"RTN","SAMIUR2",394,0)
 . quit:zi=""
"RTN","SAMIUR2",395,0)
 . ;
"RTN","SAMIUR2",396,0)
 . set rptcnt=rptcnt+1
"RTN","SAMIUR2",397,0)
 . set @PYARY@("rpt",rptcnt,1)="Follow-up"
"RTN","SAMIUR2",398,0)
 . new kdate set kdate=$$GETDTKEY^SAMICAS2(zi)
"RTN","SAMIUR2",399,0)
 . new keydate set keydate=$$KEY2DSPD^SAMICAS2(kdate)
"RTN","SAMIUR2",400,0)
 . set @PYARY@("rpt",rptcnt,2)=keydate ; Reported Date
"RTN","SAMIUR2",401,0)
 . ;
"RTN","SAMIUR2",402,0)
 . set vals=$name(@root@("graph",sid,zi))
"RTN","SAMIUR2",403,0)
 . new newpd set newpd=$g(@vals@("sippd"))
"RTN","SAMIUR2",404,0)
 . new usedate set usedate=keydate
"RTN","SAMIUR2",405,0)
 . new siq set siq=$get(@vals@("siq")) ; quit date on followup form
"RTN","SAMIUR2",406,0)
 . if siq'="" do  ; quit date provided
"RTN","SAMIUR2",407,0)
 . . quit:$$FMDT(siq)<$$FMDT(lastdt)  ; quit date out of range
"RTN","SAMIUR2",408,0)
 . . quit:$$FMDT(siq)>$$FMDT(keydate)  ; quit date out of range
"RTN","SAMIUR2",409,0)
 . . set usedate=siq ; use the quit date as end of range
"RTN","SAMIUR2",410,0)
 . . quit
"RTN","SAMIUR2",411,0)
 . new newpy set newpy=$$PKYDT(lastdt,usedate,newpd)
"RTN","SAMIUR2",412,0)
 . set @vals@("sippy")=newpy
"RTN","SAMIUR2",413,0)
 . ;
"RTN","SAMIUR2",414,0)
 . set ^gpl("current","KEY")=$get(KEY)
"RTN","SAMIUR2",415,0)
 . set ^gpl("current","zi")=zi
"RTN","SAMIUR2",416,0)
 . if zi=$get(KEY) do
"RTN","SAMIUR2",417,0)
 . . set @PYARY@("current")=rptcnt ;this row is the current form
"RTN","SAMIUR2",418,0)
 . . quit
"RTN","SAMIUR2",419,0)
 . ;
"RTN","SAMIUR2",420,0)
 . new newcum set newcum=""
"RTN","SAMIUR2",421,0)
 . if newpy'="" set newcum=lastcum+newpy
"RTN","SAMIUR2",422,0)
 . set @PYARY@("rpt",rptcnt,3)=newpy ; Pack Years
"RTN","SAMIUR2",423,0)
 . set @PYARY@("rpt",rptcnt,4)=newcum ; Cumulative
"RTN","SAMIUR2",424,0)
 . set lastdt=keydate
"RTN","SAMIUR2",425,0)
 . set lastcum=newcum
"RTN","SAMIUR2",426,0)
 . quit
"RTN","SAMIUR2",427,0)
 ;
"RTN","SAMIUR2",428,0)
 quit  ; end of ppi CUMPY^SAMIUR2
"RTN","SAMIUR2",429,0)
 ;
"RTN","SAMIUR2",430,0)
 ;
"RTN","SAMIUR2",431,0)
 ;
"RTN","SAMIUR2",432,0)
TDDT(ZDT) ; embed date in table cell
"RTN","SAMIUR2",433,0)
 ;
"RTN","SAMIUR2",434,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",435,0)
 ;@called-by
"RTN","SAMIUR2",436,0)
 ; BLINEDT
"RTN","SAMIUR2",437,0)
 ; DOB
"RTN","SAMIUR2",438,0)
 ; FUDATE
"RTN","SAMIUR2",439,0)
 ; LASTEXM
"RTN","SAMIUR2",440,0)
 ; INACTDT
"RTN","SAMIUR2",441,0)
 ; LDOC
"RTN","SAMIUR2",442,0)
 ; STUDYDT
"RTN","SAMIUR2",443,0)
 ;@calls
"RTN","SAMIUR2",444,0)
 ; ^%DT
"RTN","SAMIUR2",445,0)
 ;
"RTN","SAMIUR2",446,0)
 new X,Y,Z
"RTN","SAMIUR2",447,0)
 set X=ZDT
"RTN","SAMIUR2",448,0)
 do ^%DT
"RTN","SAMIUR2",449,0)
 if Y=-1 set Y=""
"RTN","SAMIUR2",450,0)
 set Z=$$VAPALSDT^SAMICASE(Y)
"RTN","SAMIUR2",451,0)
 new cell
"RTN","SAMIUR2",452,0)
 set cell="<td data-order="""_Y_""" data-search="""_Z_""">"_Z_"</td>"
"RTN","SAMIUR2",453,0)
 ;
"RTN","SAMIUR2",454,0)
 quit cell ; end of $$TDDT
"RTN","SAMIUR2",455,0)
 ; 
"RTN","SAMIUR2",456,0)
 ;
"RTN","SAMIUR2",457,0)
 ;
"RTN","SAMIUR2",458,0)
FMDT(ZDT) ; convert date to fileman format
"RTN","SAMIUR2",459,0)
 ;
"RTN","SAMIUR2",460,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",461,0)
 ;@called-by
"RTN","SAMIUR2",462,0)
 ; MKPTLK^SAMIHOM4
"RTN","SAMIUR2",463,0)
 ; $$PKYDT
"RTN","SAMIUR2",464,0)
 ; CUMPY
"RTN","SAMIUR2",465,0)
 ;@calls
"RTN","SAMIUR2",466,0)
 ; ^%DT
"RTN","SAMIUR2",467,0)
 ;
"RTN","SAMIUR2",468,0)
 new Y
"RTN","SAMIUR2",469,0)
 new X set X=ZDT
"RTN","SAMIUR2",470,0)
 do ^%DT
"RTN","SAMIUR2",471,0)
 ;
"RTN","SAMIUR2",472,0)
 quit Y ; end of ppi $$FMDT^SAMIUR2
"RTN","SAMIUR2",473,0)
 ;
"RTN","SAMIUR2",474,0)
 ;
"RTN","SAMIUR2",475,0)
 ;
"RTN","SAMIUR2",476,0)
PKYDT(STDT,ENDT,PKS,CIGS) ; pack-years from start & end & cigs/day
"RTN","SAMIUR2",477,0)
 ;
"RTN","SAMIUR2",478,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",479,0)
 ;@called-by
"RTN","SAMIUR2",480,0)
 ; CUMPY
"RTN","SAMIUR2",481,0)
 ;@calls
"RTN","SAMIUR2",482,0)
 ; $$FMDT
"RTN","SAMIUR2",483,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIUR2",484,0)
 ; $$PKY
"RTN","SAMIUR2",485,0)
 ;
"RTN","SAMIUR2",486,0)
 ; if PKS is not provided, 20/CIGS will be used for packs per day
"RTN","SAMIUR2",487,0)
 ;
"RTN","SAMIUR2",488,0)
 new pkyr set pkyr=""
"RTN","SAMIUR2",489,0)
 if $get(PKS)="" do  ;
"RTN","SAMIUR2",490,0)
 . if $get(CIGS)="" set PKS=0 quit  ;
"RTN","SAMIUR2",491,0)
 . set PKS=20/CIGS
"RTN","SAMIUR2",492,0)
 . quit
"RTN","SAMIUR2",493,0)
 new zst set zst=$$FMDT(STDT)
"RTN","SAMIUR2",494,0)
 set:zst=-1 zst=STDT
"RTN","SAMIUR2",495,0)
 ;
"RTN","SAMIUR2",496,0)
 new zend set zend=$$FMDT(ENDT)
"RTN","SAMIUR2",497,0)
 set:zend=-1 zend=ENDT ; probably a fileman date already
"RTN","SAMIUR2",498,0)
 ;
"RTN","SAMIUR2",499,0)
 new zdif set zdif=$$FMDIFF^XLFDT(zend,zst)/365.24
"RTN","SAMIUR2",500,0)
 ;
"RTN","SAMIUR2",501,0)
 set pkyr=$$PKY(zdif,PKS)
"RTN","SAMIUR2",502,0)
 ;
"RTN","SAMIUR2",503,0)
 quit pkyr ; end of $$PKYDT
"RTN","SAMIUR2",504,0)
 ;
"RTN","SAMIUR2",505,0)
 ;
"RTN","SAMIUR2",506,0)
 ;
"RTN","SAMIUR2",507,0)
PKY(YRS,PKS) ; pack-years from years & packs/day
"RTN","SAMIUR2",508,0)
 ;
"RTN","SAMIUR2",509,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",510,0)
 ;@called-by
"RTN","SAMIUR2",511,0)
 ; $$PKYDT
"RTN","SAMIUR2",512,0)
 ;@calls none
"RTN","SAMIUR2",513,0)
 ;@input
"RTN","SAMIUR2",514,0)
 ; YRS = years
"RTN","SAMIUR2",515,0)
 ; PKS = packs/day
"RTN","SAMIUR2",516,0)
 ;
"RTN","SAMIUR2",517,0)
 new rtn set rtn=""
"RTN","SAMIUR2",518,0)
 set rtn=YRS*PKS
"RTN","SAMIUR2",519,0)
 if $length($piece(rtn,".",2))>2 do  ;
"RTN","SAMIUR2",520,0)
 . new zdec set zdec=$piece(rtn,".",2)
"RTN","SAMIUR2",521,0)
 . set rtn=$piece(rtn,".",1)_"."_$extract(zdec,1,2)
"RTN","SAMIUR2",522,0)
 . if $extract(zdec,3)>4 set rtn=rtn+.01
"RTN","SAMIUR2",523,0)
 . quit
"RTN","SAMIUR2",524,0)
 set:rtn'["." rtn=rtn_".0"
"RTN","SAMIUR2",525,0)
 ;
"RTN","SAMIUR2",526,0)
 quit rtn ; end of $$PKY
"RTN","SAMIUR2",527,0)
 ;
"RTN","SAMIUR2",528,0)
 ;
"RTN","SAMIUR2",529,0)
 ;
"RTN","SAMIUR2",530,0)
 ;@section 4 active column ppis
"RTN","SAMIUR2",531,0)
 ;
"RTN","SAMIUR2",532,0)
 ;
"RTN","SAMIUR2",533,0)
 ;
"RTN","SAMIUR2",534,0)
ACTIVE(zdt,dfn,SAMIPATS) ; Active/Inactive column
"RTN","SAMIUR2",535,0)
 ;
"RTN","SAMIUR2",536,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",537,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",538,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",539,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",540,0)
 new active set active="inactive"
"RTN","SAMIUR2",541,0)
 if $get(@vals@("sistatus"))="active" set active="active"
"RTN","SAMIUR2",542,0)
 ;
"RTN","SAMIUR2",543,0)
 quit active
"RTN","SAMIUR2",544,0)
 ; 
"RTN","SAMIUR2",545,0)
AFORM(zdt,dfn,SAMIPATS) ; Name of most recent form
"RTN","SAMIUR2",546,0)
 Q $GET(SAMIPATS(zdt,dfn,"aform"))
"RTN","SAMIUR2",547,0)
 ;
"RTN","SAMIUR2",548,0)
AFORMDT(zdt,dfn,SAMIPATS) ; Date of most recent form
"RTN","SAMIUR2",549,0)
 N ZD S ZD=$GET(SAMIPATS(zdt,dfn,"aformdt"))
"RTN","SAMIUR2",550,0)
 Q $$VAPALSDT^SAMICASE(ZD)
"RTN","SAMIUR2",551,0)
 ;
"RTN","SAMIUR2",552,0)
AGE(zdt,dfn,SAMIPATS) ; age
"RTN","SAMIUR2",553,0)
 ;
"RTN","SAMIUR2",554,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",555,0)
 ;@called-by
"RTN","SAMIUR2",556,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",557,0)
 ;@calls
"RTN","SAMIUR2",558,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",559,0)
 ; ^%DT
"RTN","SAMIUR2",560,0)
 ; $$NOW^XLFDT
"RTN","SAMIUR2",561,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIUR2",562,0)
 ;
"RTN","SAMIUR2",563,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",564,0)
 new dob set dob=$get(@root@(dfn,"sbdob")) ; dob in VAPALS format
"RTN","SAMIUR2",565,0)
 ;
"RTN","SAMIUR2",566,0)
 new Y
"RTN","SAMIUR2",567,0)
 new X set X=dob
"RTN","SAMIUR2",568,0)
 do ^%DT
"RTN","SAMIUR2",569,0)
 ;
"RTN","SAMIUR2",570,0)
 new age set age=$piece($$FMDIFF^XLFDT($$NOW^XLFDT,Y)/365,".")
"RTN","SAMIUR2",571,0)
 ;
"RTN","SAMIUR2",572,0)
 quit age ; end of ppi $$AGE^SAMIUR2
"RTN","SAMIUR2",573,0)
 ;
"RTN","SAMIUR2",574,0)
 ;
"RTN","SAMIUR2",575,0)
 ;
"RTN","SAMIUR2",576,0)
ENROLLDT(zdt,dfn,SAMIPATS) ; enrollment date
"RTN","SAMIUR2",577,0)
 ;
"RTN","SAMIUR2",578,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",579,0)
 ;@called-by
"RTN","SAMIUR2",580,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",581,0)
 ;@calls
"RTN","SAMIUR2",582,0)
 ; $$TDDT
"RTN","SAMIUR2",583,0)
 ;
"RTN","SAMIUR2",584,0)
 new enroldt set enroldt=$get(SAMIPATS(zdt,dfn,"edate"))
"RTN","SAMIUR2",585,0)
 ;
"RTN","SAMIUR2",586,0)
 quit $$TDDT(enroldt) ; end of ppi $$ENROLLDT^SAMIUR2
"RTN","SAMIUR2",587,0)
 ;
"RTN","SAMIUR2",588,0)
 ;
"RTN","SAMIUR2",589,0)
BLINEDT(zdt,dfn,SAMIPATS) ; baseline date
"RTN","SAMIUR2",590,0)
 ;
"RTN","SAMIUR2",591,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",592,0)
 ;@called-by
"RTN","SAMIUR2",593,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",594,0)
 ;@calls
"RTN","SAMIUR2",595,0)
 ; $$TDDT
"RTN","SAMIUR2",596,0)
 ;
"RTN","SAMIUR2",597,0)
 new bldt set bldt=$get(SAMIPATS(zdt,dfn,"baseline"))
"RTN","SAMIUR2",598,0)
 ;
"RTN","SAMIUR2",599,0)
 quit $$TDDT(bldt) ; end of ppi $$BLINEDT^SAMIUR2
"RTN","SAMIUR2",600,0)
 ;
"RTN","SAMIUR2",601,0)
 ;
"RTN","SAMIUR2",602,0)
CONTACT(zdt,dfn,SAMIPATS) ; patient street address
"RTN","SAMIUR2",603,0)
 ;
"RTN","SAMIUR2",604,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",605,0)
 ;@called-by
"RTN","SAMIUR2",606,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",607,0)
 ;@calls
"RTN","SAMIUR2",608,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",609,0)
 ;
"RTN","SAMIUR2",610,0)
 new contact set contact=""
"RTN","SAMIUR2",611,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",612,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",613,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",614,0)
 q:siform=""
"RTN","SAMIUR2",615,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",616,0)
 set contact=$get(@vals@("sinamef"))_" "_$get(@vals@("sinamel"))
"RTN","SAMIUR2",617,0)
 set contact=contact_"<br>"_$get(@vals@("sipsa"))
"RTN","SAMIUR2",618,0)
 if $get(@vals@("sipan"))'="" do
"RTN","SAMIUR2",619,0)
 . set contact=contact_" Apt "_$get(@vals@("sipan"))
"RTN","SAMIUR2",620,0)
 . quit
"RTN","SAMIUR2",621,0)
 if $get(@vals@("sipcn"))'="" do
"RTN","SAMIUR2",622,0)
 . set contact=contact_"<br>County "_@vals@("sipcn")
"RTN","SAMIUR2",623,0)
 . quit
"RTN","SAMIUR2",624,0)
 if $get(@vals@("sipc"))'="" do
"RTN","SAMIUR2",625,0)
 . set contact=contact_" <br>"_@vals@("sipc")_", "
"RTN","SAMIUR2",626,0)
 . quit
"RTN","SAMIUR2",627,0)
 set contact=contact_" "_$get(@vals@("sips"))_" "_$get(@vals@("sipz"))_"     "
"RTN","SAMIUR2",628,0)
 ;
"RTN","SAMIUR2",629,0)
 new phone set phone=$get(@vals@("sippn"))
"RTN","SAMIUR2",630,0)
 if phone'="" set contact=contact_" <br>Phone: "_phone
"RTN","SAMIUR2",631,0)
 ;
"RTN","SAMIUR2",632,0)
 quit contact ; end of ppi $$CONTACT^SAMIUR2
"RTN","SAMIUR2",633,0)
 ;
"RTN","SAMIUR2",634,0)
 ;
"RTN","SAMIUR2",635,0)
 ;
"RTN","SAMIUR2",636,0)
CTPROT(zdt,dfn,SAMIPATS) ; ct protocol
"RTN","SAMIUR2",637,0)
 ;
"RTN","SAMIUR2",638,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",639,0)
 ;@called-by
"RTN","SAMIUR2",640,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",641,0)
 ;@calls
"RTN","SAMIUR2",642,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",643,0)
 ;
"RTN","SAMIUR2",644,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",645,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",646,0)
 quit:ceform="" ""
"RTN","SAMIUR2",647,0)
 ;
"RTN","SAMIUR2",648,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",649,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",650,0)
 new cectp set cectp=$get(@vals@("cectp"))
"RTN","SAMIUR2",651,0)
 new ctyp set ctyp=$select(cectp="l":"Low-Dose CT",cectp="d":"Standard CT",cectp="i":"Limited",1:"")
"RTN","SAMIUR2",652,0)
 ;
"RTN","SAMIUR2",653,0)
 quit ctyp ; end of ppi $$CTPROT^SAMIUR2
"RTN","SAMIUR2",654,0)
 ;
"RTN","SAMIUR2",655,0)
 ;
"RTN","SAMIUR2",656,0)
 ;
"RTN","SAMIUR2",657,0)
DOB(ien,dfn,SAMIPATS) ; date of birth
"RTN","SAMIUR2",658,0)
 ;
"RTN","SAMIUR2",659,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",660,0)
 ;@called-by
"RTN","SAMIUR2",661,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",662,0)
 ;@calls
"RTN","SAMIUR2",663,0)
 ; $$TDDT
"RTN","SAMIUR2",664,0)
 ;
"RTN","SAMIUR2",665,0)
 new dob set dob=$get(SAMIPATS(ien,dfn,"dob"))
"RTN","SAMIUR2",666,0)
 if dob="" set dob=$get(SAMIPATS(ien,dfn,"sbdob"))
"RTN","SAMIUR2",667,0)
 ;
"RTN","SAMIUR2",668,0)
 quit $$TDDT(dob) ; end of ppi $$DOB^SAMIUR2
"RTN","SAMIUR2",669,0)
 ;
"RTN","SAMIUR2",670,0)
 ;
"RTN","SAMIUR2",671,0)
 ;
"RTN","SAMIUR2",672,0)
FUDATE(zdt,dfn,SAMIPATS) ; followup date
"RTN","SAMIUR2",673,0)
 ;
"RTN","SAMIUR2",674,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",675,0)
 ;@called-by
"RTN","SAMIUR2",676,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",677,0)
 ;@calls
"RTN","SAMIUR2",678,0)
 ; $TDDT
"RTN","SAMIUR2",679,0)
 ;
"RTN","SAMIUR2",680,0)
 new fud set fud="fudate"
"RTN","SAMIUR2",681,0)
 new date set date=$get(SAMIPATS(zdt,dfn,"cefud"))
"RTN","SAMIUR2",682,0)
 ;
"RTN","SAMIUR2",683,0)
 quit $$TDDT(date) ; end of ppi $$FUDATE^SAMIUR2
"RTN","SAMIUR2",684,0)
 ;
"RTN","SAMIUR2",685,0)
 ;
"RTN","SAMIUR2",686,0)
 ;
"RTN","SAMIUR2",687,0)
GENDER(zdt,dfn,SAMIPATS) ; gender
"RTN","SAMIUR2",688,0)
 ;
"RTN","SAMIUR2",689,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",690,0)
 ;@called-by
"RTN","SAMIUR2",691,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",692,0)
 ;@calls
"RTN","SAMIUR2",693,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",694,0)
 ;
"RTN","SAMIUR2",695,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",696,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",697,0)
 ;
"RTN","SAMIUR2",698,0)
 new gend set gend=$get(SAMIPATS(zdt,dfn,"gender"))
"RTN","SAMIUR2",699,0)
 if gend="" do
"RTN","SAMIUR2",700,0)
 . new pien set pien=$order(@root@("dfn",dfn,""))
"RTN","SAMIUR2",701,0)
 . if pien'="" do  ;
"RTN","SAMIUR2",702,0)
 . . set gend=$get(@root@(pien,"sex"))
"RTN","SAMIUR2",703,0)
 . . if gend="" set gend=$get(@root@(pien,"gender"))
"RTN","SAMIUR2",704,0)
 . . quit
"RTN","SAMIUR2",705,0)
 . if gend="" do  ;
"RTN","SAMIUR2",706,0)
 . . new lien set lien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR2",707,0)
 . . set gend=$get(@lroot@(lien,"gender"))
"RTN","SAMIUR2",708,0)
 . . quit
"RTN","SAMIUR2",709,0)
 if gend["^" set gend=$piece(gend,"^",1)
"RTN","SAMIUR2",710,0)
 ;
"RTN","SAMIUR2",711,0)
 quit gend ; end of ppi $$GENDER^SAMIUR2
"RTN","SAMIUR2",712,0)
 ;
"RTN","SAMIUR2",713,0)
 ;
"RTN","SAMIUR2",714,0)
 ;
"RTN","SAMIUR2",715,0)
IFORM(zdt,dfn,SAMIPATS) ; name(s) of incomplete forms
"RTN","SAMIUR2",716,0)
 ;
"RTN","SAMIUR2",717,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",718,0)
 ;@called-by
"RTN","SAMIUR2",719,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",720,0)
 ;@calls
"RTN","SAMIUR2",721,0)
 ; $$DFN2SID^SAMIUR2
"RTN","SAMIUR2",722,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMIUR2",723,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMIUR2",724,0)
 ; $$MKNAV
"RTN","SAMIUR2",725,0)
 ;
"RTN","SAMIUR2",726,0)
 new iform set iform=$get(SAMIPATS(zdt,dfn,"iform"))
"RTN","SAMIUR2",727,0)
 quit:iform="" ""  ;
"RTN","SAMIUR2",728,0)
 ;
"RTN","SAMIUR2",729,0)
 new zkey1,zn,typ
"RTN","SAMIUR2",730,0)
 new return set return="<table>"
"RTN","SAMIUR2",731,0)
 for zn=2:1  quit:$piece(iform," ",zn)=""  do  ;
"RTN","SAMIUR2",732,0)
 . set return=return_"<tr><td>"
"RTN","SAMIUR2",733,0)
 . set zkey1=$piece(iform," ",zn)
"RTN","SAMIUR2",734,0)
 . ;
"RTN","SAMIUR2",735,0)
 . new fname
"RTN","SAMIUR2",736,0)
 . if zkey1["ceform" set fname="CT Evaluation" set typ="ceform"
"RTN","SAMIUR2",737,0)
 . if zkey1["sbform" set fname="Background" set typ="sbform"
"RTN","SAMIUR2",738,0)
 . if zkey1["fuform" set fname="Participant Follow-up" set typ="fuform"
"RTN","SAMIUR2",739,0)
 . if zkey1["bxform" set fname="Biopsy" set typ="bxform"
"RTN","SAMIUR2",740,0)
 . if zkey1["ptform" set fname="PET Evaluation" set typ="ptform"
"RTN","SAMIUR2",741,0)
 . if zkey1["itform" set fname="Intervention" set typ="itform"
"RTN","SAMIUR2",742,0)
 . if zkey1["siform" set fname="Intake Form" set typ="siform"
"RTN","SAMIUR2",743,0)
 . if $get(fname)="" set fname="unknown" set typ=""
"RTN","SAMIUR2",744,0)
 . ;
"RTN","SAMIUR2",745,0)
 . new sid set sid=$$DFN2SID^SAMIUR2(dfn)
"RTN","SAMIUR2",746,0)
 . new zdate set zdate=$$VAPALSDT^SAMICASE($$KEY2FM^SAMICASE(zkey1))
"RTN","SAMIUR2",747,0)
 . set return=return_$$MKNAV(sid,zkey1,fname_" - "_zdate,typ)
"RTN","SAMIUR2",748,0)
 . set return=return_"</td></tr>"
"RTN","SAMIUR2",749,0)
 . quit
"RTN","SAMIUR2",750,0)
 ;
"RTN","SAMIUR2",751,0)
 set return=return_"</table>"
"RTN","SAMIUR2",752,0)
 ;
"RTN","SAMIUR2",753,0)
 quit return ; end of ppi $$IFORM^SAMIUR2
"RTN","SAMIUR2",754,0)
 ;
"RTN","SAMIUR2",755,0)
 ;
"RTN","SAMIUR2",756,0)
 ;
"RTN","SAMIUR2",757,0)
LASTEXM(zdt,dfn,SAMIPATS) ; patient last exam
"RTN","SAMIUR2",758,0)
 ;
"RTN","SAMIUR2",759,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",760,0)
 ;@called-by
"RTN","SAMIUR2",761,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",762,0)
 ;@calls
"RTN","SAMIUR2",763,0)
 ; $$TDDT
"RTN","SAMIUR2",764,0)
 ;
"RTN","SAMIUR2",765,0)
 new lexm set lexm=$get(SAMIPATS(zdt,dfn,"cedos"))
"RTN","SAMIUR2",766,0)
 ;
"RTN","SAMIUR2",767,0)
 quit $$TDDT(lexm) ; end of ppi $$LASTEXM^SAMIUR2
"RTN","SAMIUR2",768,0)
 ;
"RTN","SAMIUR2",769,0)
 ;
"RTN","SAMIUR2",770,0)
 ;
"RTN","SAMIUR2",771,0)
INACTDT(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",772,0)
 ;
"RTN","SAMIUR2",773,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",774,0)
 ;@called-by
"RTN","SAMIUR2",775,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",776,0)
 ;@calls
"RTN","SAMIUR2",777,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",778,0)
 ; $$TDDT
"RTN","SAMIUR2",779,0)
 ;
"RTN","SAMIUR2",780,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",781,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",782,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",783,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",784,0)
 ;
"RTN","SAMIUR2",785,0)
 quit $$TDDT($get(@vals@("sidod")))
"RTN","SAMIUR2",786,0)
 ;
"RTN","SAMIUR2",787,0)
 ;
"RTN","SAMIUR2",788,0)
 ;
"RTN","SAMIUR2",789,0)
INACTRE(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",790,0)
 ;
"RTN","SAMIUR2",791,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",792,0)
 ;@called-by
"RTN","SAMIUR2",793,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",794,0)
 ;@calls
"RTN","SAMIUR2",795,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",796,0)
 ;
"RTN","SAMIUR2",797,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",798,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",799,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",800,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",801,0)
 ;
"RTN","SAMIUR2",802,0)
 quit $get(@vals@("sistachg"))
"RTN","SAMIUR2",803,0)
 ;
"RTN","SAMIUR2",804,0)
 ;
"RTN","SAMIUR2",805,0)
 ;
"RTN","SAMIUR2",806,0)
INACTCM(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",807,0)
 ;
"RTN","SAMIUR2",808,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",809,0)
 ;@called-by
"RTN","SAMIUR2",810,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",811,0)
 ;@calls
"RTN","SAMIUR2",812,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",813,0)
 ;
"RTN","SAMIUR2",814,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",815,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",816,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",817,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",818,0)
 ;
"RTN","SAMIUR2",819,0)
 quit $get(@vals@("sistreas"))
"RTN","SAMIUR2",820,0)
 ;
"RTN","SAMIUR2",821,0)
 ;
"RTN","SAMIUR2",822,0)
 ;
"RTN","SAMIUR2",823,0)
LDE(zdt,dfn,SAMIPATS) ; last date and entry in com log
"RTN","SAMIUR2",824,0)
 ;
"RTN","SAMIUR2",825,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",826,0)
 ;@called-by
"RTN","SAMIUR2",827,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",828,0)
 ;@calls
"RTN","SAMIUR2",829,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",830,0)
 ;
"RTN","SAMIUR2",831,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",832,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",833,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",834,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",835,0)
 ;
"RTN","SAMIUR2",836,0)
 n comien,comdt,comntry
"RTN","SAMIUR2",837,0)
 s (comdt,comntry)=""
"RTN","SAMIUR2",838,0)
 s comien=$o(@vals@("comlog"," "),-1)
"RTN","SAMIUR2",839,0)
 i comien="" d  q comdt
"RTN","SAMIUR2",840,0)
 . s comdt=$g(@vals@("sidc"))
"RTN","SAMIUR2",841,0)
 s comntry=$g(@vals@("comlog",comien))
"RTN","SAMIUR2",842,0)
 s comdt=$p($p(comntry,"[",2),"@",1)
"RTN","SAMIUR2",843,0)
 ;
"RTN","SAMIUR2",844,0)
 quit comdt_"^"_comntry
"RTN","SAMIUR2",845,0)
 ;
"RTN","SAMIUR2",846,0)
 ;
"RTN","SAMIUR2",847,0)
 ;
"RTN","SAMIUR2",848,0)
LDOC(zdt,dfn,SAMIPATS) ; last date of contact
"RTN","SAMIUR2",849,0)
 ;
"RTN","SAMIUR2",850,0)
 quit $$TDDT($piece($$LDE(zdt,dfn,.SAMIPATS),"^",1))
"RTN","SAMIUR2",851,0)
 ;
"RTN","SAMIUR2",852,0)
 ;
"RTN","SAMIUR2",853,0)
 ;
"RTN","SAMIUR2",854,0)
LENTRY(zdt,dfn,SAMIPATS) ; last contact entry
"RTN","SAMIUR2",855,0)
 ;
"RTN","SAMIUR2",856,0)
 quit $piece($$LDE(zdt,dfn,.SAMIPATS),"^",2)
"RTN","SAMIUR2",857,0)
 ;
"RTN","SAMIUR2",858,0)
 ;
"RTN","SAMIUR2",859,0)
 ;
"RTN","SAMIUR2",860,0)
MANPAT(ien,dfn,SAMIPATS) ; unmatched patient cell
"RTN","SAMIUR2",861,0)
 ;
"RTN","SAMIUR2",862,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",863,0)
 ;@called-by
"RTN","SAMIUR2",864,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",865,0)
 ;@calls
"RTN","SAMIUR2",866,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",867,0)
 ;
"RTN","SAMIUR2",868,0)
 new zcell set zcell=""
"RTN","SAMIUR2",869,0)
 ; set zcell=zcell_$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR2",870,0)
 set zcell=zcell_$get(SAMIPATS(ien,dfn,"editref"))
"RTN","SAMIUR2",871,0)
 set zcell=zcell_"<br>Date of Birth: "_$get(SAMIPATS(ien,dfn,"dob"))
"RTN","SAMIUR2",872,0)
 set zcell=zcell_" Gender: "_$get(SAMIPATS(ien,dfn,"sex"))
"RTN","SAMIUR2",873,0)
 ;
"RTN","SAMIUR2",874,0)
 new ssn set ssn=$get(SAMIPATS(ien,dfn,"ssn"))
"RTN","SAMIUR2",875,0)
 if ssn="" do  ;
"RTN","SAMIUR2",876,0)
 . new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",877,0)
 . new tssn set tssn=$get(@lroot@(ien,"ssn"))
"RTN","SAMIUR2",878,0)
 . set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",879,0)
 . quit
"RTN","SAMIUR2",880,0)
 set zcell=zcell_"<br>SSN: "_ssn
"RTN","SAMIUR2",881,0)
 ;
"RTN","SAMIUR2",882,0)
 set zcell=zcell_"<br>dfn: "_dfn
"RTN","SAMIUR2",883,0)
 ;
"RTN","SAMIUR2",884,0)
 quit zcell ; end of ppi $$MANPAT^SAMIUR2
"RTN","SAMIUR2",885,0)
 ;
"RTN","SAMIUR2",886,0)
 ;
"RTN","SAMIUR2",887,0)
 ;
"RTN","SAMIUR2",888,0)
MATCH(ien,dfn,SAMIPATS) ; match button cell
"RTN","SAMIUR2",889,0)
 ;
"RTN","SAMIUR2",890,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",891,0)
 ;@called-by
"RTN","SAMIUR2",892,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",893,0)
 ;@calls none
"RTN","SAMIUR2",894,0)
 ;
"RTN","SAMIUR2",895,0)
 new matien set matien=$get(SAMIPATS(ien,dfn,"MATCHLOG"))
"RTN","SAMIUR2",896,0)
 quit:matien="" ""
"RTN","SAMIUR2",897,0)
 ;
"RTN","SAMIUR2",898,0)
 new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR2",899,0)
 set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""merge"">"
"RTN","SAMIUR2",900,0)
 set nuhref=nuhref_"<input type=hidden name=""toien"" value="_ien_">"
"RTN","SAMIUR2",901,0)
 set nuhref=nuhref_"<input value=""Merge"" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR2",902,0)
 ;
"RTN","SAMIUR2",903,0)
 quit nuhref ; end of ppi $$MATCH^SAMIUR2
"RTN","SAMIUR2",904,0)
 ;
"RTN","SAMIUR2",905,0)
 ;
"RTN","SAMIUR2",906,0)
 ;
"RTN","SAMIUR2",907,0)
NAME(zdt,dfn,SAMIPATS) ; name w/hyperlink
"RTN","SAMIUR2",908,0)
 ;
"RTN","SAMIUR2",909,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",910,0)
 ;@called-by
"RTN","SAMIUR2",911,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",912,0)
 ;@calls none
"RTN","SAMIUR2",913,0)
 ;
"RTN","SAMIUR2",914,0)
 new nam set nam="Name"
"RTN","SAMIUR2",915,0)
 ;
"RTN","SAMIUR2",916,0)
 quit $get(SAMIPATS(zdt,dfn,"nuhref")) ; end of ppi $$NAME^SAMIUR2
"RTN","SAMIUR2",917,0)
 ;
"RTN","SAMIUR2",918,0)
 ;
"RTN","SAMIUR2",919,0)
 ;
"RTN","SAMIUR2",920,0)
PACKYRS(zdt,dfn,SAMIPATS) ; smoking status
"RTN","SAMIUR2",921,0)
 ;
"RTN","SAMIUR2",922,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",923,0)
 ;@called-by
"RTN","SAMIUR2",924,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",925,0)
 ;@calls
"RTN","SAMIUR2",926,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",927,0)
 ;
"RTN","SAMIUR2",928,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",929,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",930,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",931,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",932,0)
 new pkyrs set pkyrs=$get(@vals@("sippy"))
"RTN","SAMIUR2",933,0)
 ;
"RTN","SAMIUR2",934,0)
 quit pkyrs ; end of ppi $$PACKYRS^SAMIUR2
"RTN","SAMIUR2",935,0)
 ;
"RTN","SAMIUR2",936,0)
 ;
"RTN","SAMIUR2",937,0)
 ;
"RTN","SAMIUR2",938,0)
POSSIBLE(ien,dfn,SAMIPATS) ; possible match cell
"RTN","SAMIUR2",939,0)
 ;
"RTN","SAMIUR2",940,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",941,0)
 ;@called-by
"RTN","SAMIUR2",942,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",943,0)
 ;@calls
"RTN","SAMIUR2",944,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",945,0)
 ;
"RTN","SAMIUR2",946,0)
 new zcell set zcell=""
"RTN","SAMIUR2",947,0)
 new matien set matien=$get(SAMIPATS(ien,dfn,"MATCHLOG"))
"RTN","SAMIUR2",948,0)
 quit:matien="" zcell
"RTN","SAMIUR2",949,0)
 ;
"RTN","SAMIUR2",950,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",951,0)
 quit:'$data(@lroot@(matien)) zcell
"RTN","SAMIUR2",952,0)
 ;
"RTN","SAMIUR2",953,0)
 set zcell=zcell_$get(@lroot@(matien,"saminame"))
"RTN","SAMIUR2",954,0)
 set zcell=zcell_"<br>Date of Birth: "_$get(@lroot@(matien,"sbdob"))
"RTN","SAMIUR2",955,0)
 set zcell=zcell_" Gender: "_$get(@lroot@(matien,"sex"))
"RTN","SAMIUR2",956,0)
 ;
"RTN","SAMIUR2",957,0)
 new tssn set tssn=$get(@lroot@(matien,"ssn"))
"RTN","SAMIUR2",958,0)
 new ssn set ssn=tssn
"RTN","SAMIUR2",959,0)
 if tssn'["-" set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",960,0)
 set zcell=zcell_"<br>SSN: "_ssn
"RTN","SAMIUR2",961,0)
 ;
"RTN","SAMIUR2",962,0)
 set zcell=zcell_"<br>dfn: "_$get(@lroot@(matien,"dfn"))
"RTN","SAMIUR2",963,0)
 ;
"RTN","SAMIUR2",964,0)
 quit zcell ; end of ppi $$POSSIBLE^SAMIUR2
"RTN","SAMIUR2",965,0)
 ;
"RTN","SAMIUR2",966,0)
 ;
"RTN","SAMIUR2",967,0)
 ;
"RTN","SAMIUR2",968,0)
RECOM(zdt,dfn,SAMIPATS) ; recommendation
"RTN","SAMIUR2",969,0)
 ;
"RTN","SAMIUR2",970,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",971,0)
 ;@called-by
"RTN","SAMIUR2",972,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",973,0)
 ;@calls
"RTN","SAMIUR2",974,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",975,0)
 ;
"RTN","SAMIUR2",976,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",977,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",978,0)
 quit:ceform="" ""
"RTN","SAMIUR2",979,0)
 ;
"RTN","SAMIUR2",980,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",981,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",982,0)
 new cefuw set cefuw=$get(@vals@("cefuw"))
"RTN","SAMIUR2",983,0)
 ;
"RTN","SAMIUR2",984,0)
 new recom set recom=""
"RTN","SAMIUR2",985,0)
 set recom=$select(cefuw="1y":"Annual Repeat",cefuw="nw":"Now",cefuw="1m":"1 month",cefuw="3m":"3 months",cefuw="6m":"6 months",cefuw="os":"Other",1:"")
"RTN","SAMIUR2",986,0)
 if $get(@vals@("cefuaf"))="y" set recom=recom_", Antibiotics"
"RTN","SAMIUR2",987,0)
 if $get(@vals@("cefucc"))="y" set recom=recom_", Contrast CT"
"RTN","SAMIUR2",988,0)
 if $get(@vals@("cefupe"))="y" set recom=recom_", PET"
"RTN","SAMIUR2",989,0)
 if $get(@vals@("cefufn"))="y" set recom=recom_", Percutaneous biopsy"
"RTN","SAMIUR2",990,0)
 if $get(@vals@("cefubr"))="y" set recom=recom_", Bronchoscopy"
"RTN","SAMIUR2",991,0)
 if $get(@vals@("cefupc"))="y" set recom=recom_", Pulmonary consultation"
"RTN","SAMIUR2",992,0)
 if $get(@vals@("cefutb"))="y" set recom=recom_", Refer to tumor board"
"RTN","SAMIUR2",993,0)
 if $get(@vals@("cefunf"))="y" set recom=recom_", No other further follow-up"
"RTN","SAMIUR2",994,0)
 if $extract(recom,1,2)=", " set recom=$extract(recom,3,$length(recom))
"RTN","SAMIUR2",995,0)
 ;
"RTN","SAMIUR2",996,0)
 quit recom ; end of ppi $$RECOM^SAMIUR2
"RTN","SAMIUR2",997,0)
 ;
"RTN","SAMIUR2",998,0)
 ;
"RTN","SAMIUR2",999,0)
 ;
"RTN","SAMIUR2",1000,0)
RURAL(zdt,dfn,SAMIPATS) ; patient's rural/urban status
"RTN","SAMIUR2",1001,0)
 ;
"RTN","SAMIUR2",1002,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1003,0)
 ;@called-by
"RTN","SAMIUR2",1004,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1005,0)
 ;@calls
"RTN","SAMIUR2",1006,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1007,0)
 ;
"RTN","SAMIUR2",1008,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1009,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1010,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1011,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1012,0)
 new sirs set sirs=$get(@vals@("sirs"))
"RTN","SAMIUR2",1013,0)
 set sirs=$select(sirs="r":"rural",sirs="u":"urban",sirs="n":"unknown",1:"unknown")
"RTN","SAMIUR2",1014,0)
 ;
"RTN","SAMIUR2",1015,0)
 quit sirs ; end of ppi $$RURAL^SAMIUR2
"RTN","SAMIUR2",1016,0)
 ;
"RTN","SAMIUR2",1017,0)
 ;
"RTN","SAMIUR2",1018,0)
 ;
"RTN","SAMIUR2",1019,0)
SID(zdt,dfn,SAMIPATS) ; study ID
"RTN","SAMIUR2",1020,0)
 ;
"RTN","SAMIUR2",1021,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1022,0)
 ;@called-by
"RTN","SAMIUR2",1023,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1024,0)
 ;@calls
"RTN","SAMIUR2",1025,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1026,0)
 ;
"RTN","SAMIUR2",1027,0)
 quit $$DFN2SID(dfn) ; end of ppi $$SID^SAMIUR2
"RTN","SAMIUR2",1028,0)
 ;
"RTN","SAMIUR2",1029,0)
 ;
"RTN","SAMIUR2",1030,0)
 ;
"RTN","SAMIUR2",1031,0)
SMHIS(zdt,dfn,SAMIPATS) ; smoking history cell
"RTN","SAMIUR2",1032,0)
 ;
"RTN","SAMIUR2",1033,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1034,0)
 ;@called-by
"RTN","SAMIUR2",1035,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1036,0)
 ;@calls
"RTN","SAMIUR2",1037,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1038,0)
 ; $$SHDET
"RTN","SAMIUR2",1039,0)
 ;
"RTN","SAMIUR2",1040,0)
 new zrtn set zrtn=""
"RTN","SAMIUR2",1041,0)
 set zrtn=zrtn_"<div class=""row""><div class=""col-md-12""><table class=""table"" id=""pack-years-history"">"
"RTN","SAMIUR2",1042,0)
 set zrtn=zrtn_"<thead><tr><th>Form </th><th> Reported Date </th>"
"RTN","SAMIUR2",1043,0)
 set zrtn=zrtn_"<th>Pack Years</th><th>Cumulative</th></tr></thead><tbody>"
"RTN","SAMIUR2",1044,0)
 set zrtn=zrtn_$$SHDET($$DFN2SID(dfn))
"RTN","SAMIUR2",1045,0)
 set zrtn=zrtn_"</tbody></table></div></div>"
"RTN","SAMIUR2",1046,0)
 ;
"RTN","SAMIUR2",1047,0)
 quit zrtn ; end of ppi $$SMHIS^SAMIUR2
"RTN","SAMIUR2",1048,0)
 ;
"RTN","SAMIUR2",1049,0)
 ;
"RTN","SAMIUR2",1050,0)
 ;
"RTN","SAMIUR2",1051,0)
SMKSTAT(zdt,dfn,SAMIPATS) ; smoking status
"RTN","SAMIUR2",1052,0)
 ;
"RTN","SAMIUR2",1053,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1054,0)
 ;@called-by
"RTN","SAMIUR2",1055,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1056,0)
 ;@calls
"RTN","SAMIUR2",1057,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1058,0)
 ;
"RTN","SAMIUR2",1059,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1060,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1061,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1062,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1063,0)
 ;
"RTN","SAMIUR2",1064,0)
 new smk set smk="unknown"
"RTN","SAMIUR2",1065,0)
 if $get(@vals@("siesm"))="n" set smk="Never smoked"
"RTN","SAMIUR2",1066,0)
 if $get(@vals@("siesm"))="p" set smk="Past smoker"
"RTN","SAMIUR2",1067,0)
 if $get(@vals@("siesm"))="c" set smk="Current smoker"
"RTN","SAMIUR2",1068,0)
 ; if $get(@vals@("siesq"))=1 set smk="Cu"
"RTN","SAMIUR2",1069,0)
 ;
"RTN","SAMIUR2",1070,0)
 quit smk ; end of ppi $$SMKSTAT^SAMIUR2
"RTN","SAMIUR2",1071,0)
 ;
"RTN","SAMIUR2",1072,0)
 ;
"RTN","SAMIUR2",1073,0)
 ;
"RTN","SAMIUR2",1074,0)
SSN(zdt,dfn,SAMIPATS) ; social security number
"RTN","SAMIUR2",1075,0)
 ;
"RTN","SAMIUR2",1076,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1077,0)
 ;@called-by
"RTN","SAMIUR2",1078,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1079,0)
 ;@calls none
"RTN","SAMIUR2",1080,0)
 ;
"RTN","SAMIUR2",1081,0)
 new tssn set tssn=$get(SAMIPATS(zdt,dfn,"ssn"))
"RTN","SAMIUR2",1082,0)
 new ssn set ssn=tssn
"RTN","SAMIUR2",1083,0)
 if ssn'["-" do
"RTN","SAMIUR2",1084,0)
 . set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",1085,0)
 . quit
"RTN","SAMIUR2",1086,0)
 ;
"RTN","SAMIUR2",1087,0)
 quit ssn ; end of ppi $$SSN^SAMIUR2
"RTN","SAMIUR2",1088,0)
 ;
"RTN","SAMIUR2",1089,0)
 ;
"RTN","SAMIUR2",1090,0)
 ;
"RTN","SAMIUR2",1091,0)
SSNLABEL(SITE) ; extrinsic returns label for SSN (ie PID)
"RTN","SAMIUR2",1092,0)
 new RTN
"RTN","SAMIUR2",1093,0)
 set RTN=$$GET1PARM^SAMIPARM("socialSecurityNumber",SITE)
"RTN","SAMIUR2",1094,0)
 if RTN="" set RTN="SSN"
"RTN","SAMIUR2",1095,0)
 quit RTN
"RTN","SAMIUR2",1096,0)
 ;
"RTN","SAMIUR2",1097,0)
 ;
"RTN","SAMIUR2",1098,0)
 ;
"RTN","SAMIUR2",1099,0)
STUDYDT(zdt,dfn,SAMIPATS) ; latest study date
"RTN","SAMIUR2",1100,0)
 ;
"RTN","SAMIUR2",1101,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1102,0)
 ;@called-by
"RTN","SAMIUR2",1103,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1104,0)
 ;@calls
"RTN","SAMIUR2",1105,0)
 ; $$TDDT
"RTN","SAMIUR2",1106,0)
 ;
"RTN","SAMIUR2",1107,0)
 new stdt set stdt=$get(SAMIPATS(zdt,dfn,"cedos"))
"RTN","SAMIUR2",1108,0)
 ;
"RTN","SAMIUR2",1109,0)
 quit $$TDDT(stdt) ; end of ppi $$STUDYDT^SAMIUR2
"RTN","SAMIUR2",1110,0)
 ;
"RTN","SAMIUR2",1111,0)
 ;
"RTN","SAMIUR2",1112,0)
 ;
"RTN","SAMIUR2",1113,0)
STUDYTYP(zdt,dfn,SAMIPATS) ; latest study type
"RTN","SAMIUR2",1114,0)
 ;
"RTN","SAMIUR2",1115,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1116,0)
 ;@called-by
"RTN","SAMIUR2",1117,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1118,0)
 ;@calls
"RTN","SAMIUR2",1119,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1120,0)
 ;
"RTN","SAMIUR2",1121,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1122,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1123,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1124,0)
 ;
"RTN","SAMIUR2",1125,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1126,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1127,0)
 new stypx set stypx=$get(@vals@("cetex"))
"RTN","SAMIUR2",1128,0)
 new styp set styp=$select(stypx="a":"Annual",stypx="b":"Baseline",stypx="d":"Followup",1:"")
"RTN","SAMIUR2",1129,0)
 ;
"RTN","SAMIUR2",1130,0)
 quit styp ; end of ppi $$STUDYTYP^SAMIUR2
"RTN","SAMIUR2",1131,0)
 ;
"RTN","SAMIUR2",1132,0)
 ;
"RTN","SAMIUR2",1133,0)
 ;
"RTN","SAMIUR2",1134,0)
VALS(zdt,dfn,SAMIPATS) ; form-values cell
"RTN","SAMIUR2",1135,0)
 ;
"RTN","SAMIUR2",1136,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1137,0)
 ;@called-by
"RTN","SAMIUR2",1138,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1139,0)
 ;@calls
"RTN","SAMIUR2",1140,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1141,0)
 ;
"RTN","SAMIUR2",1142,0)
 new vrtn set vrtn=""
"RTN","SAMIUR2",1143,0)
 new vsid set vsid=$$DFN2SID(dfn)
"RTN","SAMIUR2",1144,0)
 new vgr set vgr="/vals?sid="_vsid_"&form="
"RTN","SAMIUR2",1145,0)
 quit:'$data(SAMIPATS)
"RTN","SAMIUR2",1146,0)
 ;
"RTN","SAMIUR2",1147,0)
 new vzi set vzi=""
"RTN","SAMIUR2",1148,0)
 for  do  quit:vzi="sort"  quit:vzi=""
"RTN","SAMIUR2",1149,0)
 . set vzi=$order(SAMIPATS(zdt,dfn,"items",vzi))
"RTN","SAMIUR2",1150,0)
 . quit:vzi="sort"
"RTN","SAMIUR2",1151,0)
 . quit:vzi=""
"RTN","SAMIUR2",1152,0)
 . set vrtn=vrtn_"<a href="""_vgr_vzi_""">"_vzi_"</a><br>"
"RTN","SAMIUR2",1153,0)
 . quit
"RTN","SAMIUR2",1154,0)
 ;
"RTN","SAMIUR2",1155,0)
 quit vrtn ; end of $$VALS^SAMIUR2
"RTN","SAMIUR2",1156,0)
 ;
"RTN","SAMIUR2",1157,0)
 ;
"RTN","SAMIUR2",1158,0)
 ;
"RTN","SAMIUR2",1159,0)
WHEN(zdt,dfn,SAMIPATS) ; followup text
"RTN","SAMIUR2",1160,0)
 ;
"RTN","SAMIUR2",1161,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1162,0)
 ;@called-by
"RTN","SAMIUR2",1163,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1164,0)
 ;@calls
"RTN","SAMIUR2",1165,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1166,0)
 ;
"RTN","SAMIUR2",1167,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1168,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1169,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1170,0)
 ;
"RTN","SAMIUR2",1171,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1172,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1173,0)
 new whnx set whnx=$get(@vals@("cefuw"))
"RTN","SAMIUR2",1174,0)
 quit:whnx="" ""
"RTN","SAMIUR2",1175,0)
 ;
"RTN","SAMIUR2",1176,0)
 new DICT
"RTN","SAMIUR2",1177,0)
 set DICT("cefuw","1m")="in one month"
"RTN","SAMIUR2",1178,0)
 set DICT("cefuw","1y")="in one year"
"RTN","SAMIUR2",1179,0)
 set DICT("cefuw","3m")="in three months"
"RTN","SAMIUR2",1180,0)
 set DICT("cefuw","6m")="in six months"
"RTN","SAMIUR2",1181,0)
 set DICT("cefuw","os")="other as specified"
"RTN","SAMIUR2",1182,0)
 set whn=$get(DICT("cefuw",whnx))
"RTN","SAMIUR2",1183,0)
 ;
"RTN","SAMIUR2",1184,0)
 quit whn ; end of ppi $$WHEN^SAMIUR2
"RTN","SAMIUR2",1185,0)
 ;
"RTN","SAMIUR2",1186,0)
 ;
"RTN","SAMIUR2",1187,0)
 ;
"RTN","SAMIUR2",1188,0)
WORKPAT(ien,dfn,SAMIPATS) ; worklist patient name cell
"RTN","SAMIUR2",1189,0)
 ;
"RTN","SAMIUR2",1190,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1191,0)
 ;@called-by
"RTN","SAMIUR2",1192,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1193,0)
 ;@calls none
"RTN","SAMIUR2",1194,0)
 ;
"RTN","SAMIUR2",1195,0)
 new zcell set zcell=""
"RTN","SAMIUR2",1196,0)
 set zcell=zcell_$get(SAMIPATS(ien,dfn,"workref"))
"RTN","SAMIUR2",1197,0)
 ;
"RTN","SAMIUR2",1198,0)
 quit zcell ; end of ppi $$WORKPAT^SAMIUR2
"RTN","SAMIUR2",1199,0)
 ;
"RTN","SAMIUR2",1200,0)
 ;
"RTN","SAMIUR2",1201,0)
 ;
"RTN","SAMIUR2",1202,0)
 ;@section 5 unused subroutines
"RTN","SAMIUR2",1203,0)
 ;
"RTN","SAMIUR2",1204,0)
 ;
"RTN","SAMIUR2",1205,0)
 ;
"RTN","SAMIUR2",1206,0)
EPAT(ien,dfn,SAMIPATS) ; patient name w/nav to enrollment
"RTN","SAMIUR2",1207,0)
 ;
"RTN","SAMIUR2",1208,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIUR2",1209,0)
 ;@called-by none
"RTN","SAMIUR2",1210,0)
 ;@calls none
"RTN","SAMIUR2",1211,0)
 ;
"RTN","SAMIUR2",1212,0)
 quit  ; end of $$EPAT
"RTN","SAMIUR2",1213,0)
 ;
"RTN","SAMIUR2",1214,0)
 ;
"RTN","SAMIUR2",1215,0)
 ;
"RTN","SAMIUR2",1216,0)
ETHNCTY(zdt,dfn,SAMIPATS) ; ethnicity
"RTN","SAMIUR2",1217,0)
 ;
"RTN","SAMIUR2",1218,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1219,0)
 ;@called-by none
"RTN","SAMIUR2",1220,0)
 ;@calls none
"RTN","SAMIUR2",1221,0)
 ;
"RTN","SAMIUR2",1222,0)
 quit "ethnicity" ; end of $$ETHNCTY
"RTN","SAMIUR2",1223,0)
 ;
"RTN","SAMIUR2",1224,0)
 ;
"RTN","SAMIUR2",1225,0)
 ;
"RTN","SAMIUR2",1226,0)
RACE(zdt,dfn,SAMIPATS) ; race
"RTN","SAMIUR2",1227,0)
 ;
"RTN","SAMIUR2",1228,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1229,0)
 ;@called-by none [call commented out in RPTTBL]
"RTN","SAMIUR2",1230,0)
 ;@calls
"RTN","SAMIUR2",1231,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1232,0)
 ;
"RTN","SAMIUR2",1233,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1234,0)
 new race set race=$get(@root@(dfn,"race"))
"RTN","SAMIUR2",1235,0)
 ;
"RTN","SAMIUR2",1236,0)
 quit race ; end of $$RACE
"RTN","SAMIUR2",1237,0)
 ;
"RTN","SAMIUR2",1238,0)
 ;
"RTN","SAMIUR2",1239,0)
 ;
"RTN","SAMIUR2",1240,0)
STATUS(zdt,dfn,SAMIPATS) ; patient status
"RTN","SAMIUR2",1241,0)
 ;
"RTN","SAMIUR2",1242,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1243,0)
 ;@called-by none
"RTN","SAMIUR2",1244,0)
 ;@calls
"RTN","SAMIUR2",1245,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1246,0)
 ;
"RTN","SAMIUR2",1247,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1248,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1249,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1250,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1251,0)
 new stat set stat=$get(@vals@("sistatus"))
"RTN","SAMIUR2",1252,0)
 ;
"RTN","SAMIUR2",1253,0)
 quit stat ; end of $$STATUS
"RTN","SAMIUR2",1254,0)
 ;
"RTN","SAMIUR2",1255,0)
 ;
"RTN","SAMIUR2",1256,0)
 ;
"RTN","SAMIUR2",1257,0)
WSVALS(RTN,FILTER) ; display form values from graph
"RTN","SAMIUR2",1258,0)
 ;
"RTN","SAMIUR2",1259,0)
 ;;web service;procedure;clean;silent;sac
"RTN","SAMIUR2",1260,0)
 ;@called-by none
"RTN","SAMIUR2",1261,0)
 ;@calls
"RTN","SAMIUR2",1262,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1263,0)
 ; wsGtree^SYNVPR
"RTN","SAMIUR2",1264,0)
 ;
"RTN","SAMIUR2",1265,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1266,0)
 new sid set sid=$get(FILTER("sid"))
"RTN","SAMIUR2",1267,0)
 if sid="" set sid=$get(FILTER("studyid"))
"RTN","SAMIUR2",1268,0)
 quit:sid=""
"RTN","SAMIUR2",1269,0)
 ;
"RTN","SAMIUR2",1270,0)
 new zform set zform=$get(FILTER("form"))
"RTN","SAMIUR2",1271,0)
 new groot
"RTN","SAMIUR2",1272,0)
 if zform="" set groot=$name(@root@("graph",sid))
"RTN","SAMIUR2",1273,0)
 else  set groot=$name(@root@("graph",sid,zform))
"RTN","SAMIUR2",1274,0)
 set FILTER("root")=$extract(groot,2,$length(groot))
"RTN","SAMIUR2",1275,0)
 ;
"RTN","SAMIUR2",1276,0)
 do wsGtree^SYNVPR(.RTN,.FILTER)
"RTN","SAMIUR2",1277,0)
 ;
"RTN","SAMIUR2",1278,0)
 quit  ; end of ws WSVALS^SAMIUR2
"RTN","SAMIUR2",1279,0)
 ;
"RTN","SAMIUR2",1280,0)
 ;
"RTN","SAMIUR2",1281,0)
 ;
"RTN","SAMIUR2",1282,0)
EOR ; end of routine SAMIUR2
"RTN","SAMIURUL")
0^3^B104949
"RTN","SAMIURUL",1,0)
SAMIURUL ;ven/gpl - user reports log ;2021-10-15T01:01Z
"RTN","SAMIURUL",2,0)
 ;;18.0;SAMI;**12,14**;2020-01;Build 8
"RTN","SAMIURUL",3,0)
 ;;18.14
"RTN","SAMIURUL",4,0)
 ;
"RTN","SAMIURUL",5,0)
 ; SAMIURUL contains the development log & module documentation for
"RTN","SAMIURUL",6,0)
 ; the VAPALS-ELCAP user-reports routines SAMIUR & SAMIUR2.
"RTN","SAMIURUL",7,0)
 ;
"RTN","SAMIURUL",8,0)
 quit  ; no entry from top
"RTN","SAMIURUL",9,0)
 ;
"RTN","SAMIURUL",10,0)
 ;
"RTN","SAMIURUL",11,0)
 ;
"RTN","SAMIURUL",12,0)
 ;@section 0 primary development
"RTN","SAMIURUL",13,0)
 ;
"RTN","SAMIURUL",14,0)
 ;
"RTN","SAMIURUL",15,0)
 ;
"RTN","SAMIURUL",16,0)
 ;@routine-credits
"RTN","SAMIURUL",17,0)
 ;@dev-main Frederick D. S. Marshall (toad)
"RTN","SAMIURUL",18,0)
 ; toad@vistaexpertise.net
"RTN","SAMIURUL",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIURUL",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIURUL",21,0)
 ;@copyright 2021, mcglk & toad, all rights reserved
"RTN","SAMIURUL",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIURUL",23,0)
 ;
"RTN","SAMIURUL",24,0)
 ;@last-update 2021-10-15T01:01Z
"RTN","SAMIURUL",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIURUL",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIURUL",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIURUL",28,0)
 ;@version 18.14
"RTN","SAMIURUL",29,0)
 ;@release-date 2020-01
"RTN","SAMIURUL",30,0)
 ;@patch-list **12,14**
"RTN","SAMIURUL",31,0)
 ;
"RTN","SAMIURUL",32,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIURUL",33,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIURUL",34,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIURUL",35,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIURUL",36,0)
 ;
"RTN","SAMIURUL",37,0)
 ;@module-credits
"RTN","SAMIURUL",38,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIURUL",39,0)
 ; (VA-PALS)
"RTN","SAMIURUL",40,0)
 ; http://va-pals.org/
"RTN","SAMIURUL",41,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIURUL",42,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIURUL",43,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIURUL",44,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIURUL",45,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIURUL",46,0)
 ; http://ielcap.com/
"RTN","SAMIURUL",47,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIURUL",48,0)
 ; http://paraxialtech.com/
"RTN","SAMIURUL",49,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIURUL",50,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIURUL",51,0)
 ;
"RTN","SAMIURUL",52,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIURUL",53,0)
 ;
"RTN","SAMIURUL",54,0)
 ; 2020-02-10/12 ven/gpl 18.0-t4 d543f7bb,f9869dfb,0e4d8b9a,5e67489f
"RTN","SAMIURUL",55,0)
 ;  SAMIUR,SAMIUR2 1st version of revised user reports, progress on
"RTN","SAMIURUL",56,0)
 ; user reports, fixed a bug in enrollment report, add rural/urban &
"RTN","SAMIURUL",57,0)
 ; compute.
"RTN","SAMIURUL",58,0)
 ;
"RTN","SAMIURUL",59,0)
 ; 2020-02-18 ven/lgc 18.0-t4 76874314
"RTN","SAMIURUL",60,0)
 ;  SAMIUR update recently edited routines.
"RTN","SAMIURUL",61,0)
 ;
"RTN","SAMIURUL",62,0)
 ; 2020-03-10/12 ven/gpl 18.0-t4 8de06b06,4ad52d64
"RTN","SAMIURUL",63,0)
 ;  SAMIUR user report date filtering, fix end date logic in UR.
"RTN","SAMIURUL",64,0)
 ;
"RTN","SAMIURUL",65,0)
 ; 2019-03-24/28 ven/gpl 18.0-t4 1fd4a4c8,0cebb36b
"RTN","SAMIURUL",66,0)
 ;  SAMIUR2 revise incomplete form report, remove ethnicity from
"RTN","SAMIURUL",67,0)
 ; enrollment report (we can't get it).
"RTN","SAMIURUL",68,0)
 ;
"RTN","SAMIURUL",69,0)
 ; 2020-04-16/23 ven/lgc 18.0-t4 e54b76d1b,89bffd3b
"RTN","SAMIURUL",70,0)
 ;  SAMIUR SAMIFRM2 > SAMIFORM, SAMISUB2 > LOAD.
"RTN","SAMIURUL",71,0)
 ;
"RTN","SAMIURUL",72,0)
 ; 2019-05-08 ven/lgc 18.0 2172e512
"RTN","SAMIURUL",73,0)
 ;  SAMIUR2 remove blank last line.
"RTN","SAMIURUL",74,0)
 ;
"RTN","SAMIURUL",75,0)
 ; 2019-06-21 par/dom 18.0 c6a4a57f VAP-352
"RTN","SAMIURUL",76,0)
 ;  SAMIUR2 proper spelling of "follow up."
"RTN","SAMIURUL",77,0)
 ;
"RTN","SAMIURUL",78,0)
 ; 2019-08-03/04 ven/gpl 18.0 ffc94f65,d03557d4,cd865e2b VPA-438
"RTN","SAMIURUL",79,0)
 ;  SAMIUR requested changes to followup report.
"RTN","SAMIURUL",80,0)
 ;  SAMIUR2 fix smoking status on enrollment report, fix change log
"RTN","SAMIURUL",81,0)
 ; display, add pack years at intake to enrollment report, add
"RTN","SAMIURUL",82,0)
 ; requested changes to followup report.
"RTN","SAMIURUL",83,0)
 ;
"RTN","SAMIURUL",84,0)
 ; 2019-09-26 ven/gpl 18.0 92b12324 VAP-420
"RTN","SAMIURUL",85,0)
 ;  SAMIUR add smoking history.
"RTN","SAMIURUL",86,0)
 ;  SAMIUR2 smoking history, new cummulative packyear processing.
"RTN","SAMIURUL",87,0)
 ;
"RTN","SAMIURUL",88,0)
 ; 2019-10-01 par/dom 18.0 4caf1a98 VAP-344
"RTN","SAMIURUL",89,0)
 ;  SAMIUR2 make capitalization consistent.
"RTN","SAMIURUL",90,0)
 ;
"RTN","SAMIURUL",91,0)
 ; 2020-01-01/05 ven/arc 18.0 399f8547,62e3200f
"RTN","SAMIURUL",92,0)
 ;  SAMIUR unmatched participant processing.
"RTN","SAMIURUL",93,0)
 ;  SAMIUR2 add unmatched patient processing.
"RTN","SAMIURUL",94,0)
 ;
"RTN","SAMIURUL",95,0)
 ; 2020-01-10 ven/gpl 18.0 1590577c
"RTN","SAMIURUL",96,0)
 ;  SAMIUR2 fix return on RACE^SAMIUR2 for cache.
"RTN","SAMIURUL",97,0)
 ;
"RTN","SAMIURUL",98,0)
 ; 2020-04-29/05-13 ven/gpl 18.5 e8b8ea2d,61c7d208
"RTN","SAMIURUL",99,0)
 ;  SAMIUR fixes for reports, worklist functionality.
"RTN","SAMIURUL",100,0)
 ;
"RTN","SAMIURUL",101,0)
 ; 2020-05-13/14 ven/gpl 18.5 61c7d208,b05df417
"RTN","SAMIURUL",102,0)
 ;  SAMIUR2 add worklist functionality, fix gender & dob detection on
"RTN","SAMIURUL",103,0)
 ; reports.
"RTN","SAMIURUL",104,0)
 ;
"RTN","SAMIURUL",105,0)
 ; 2021-03-22/23 ven/gpl 18.10 256efe63,ba81b86a
"RTN","SAMIURUL",106,0)
 ;  SAMIUR sort all reports by name, added row totals to reports.
"RTN","SAMIURUL",107,0)
 ;
"RTN","SAMIURUL",108,0)
 ; 2021-03-23 ven/toad 18.10 96f461d0,af86e0eb
"RTN","SAMIURUL",109,0)
 ;  SAMIUR add version info & dev log, lt refactor, fix XINDEX
"RTN","SAMIURUL",110,0)
 ; errors.
"RTN","SAMIURUL",111,0)
 ;
"RTN","SAMIURUL",112,0)
 ; 2021-03-29 ven/gpl 18.11 e809f2a2
"RTN","SAMIURUL",113,0)
 ;  SAMIUR prevent crash when reports have no matches: in WSREPORT
"RTN","SAMIURUL",114,0)
 ; set SRT="" and uncomment zwrite SRT; in WKLIST add 2 commented-out
"RTN","SAMIURUL",115,0)
 ; debugging lines.
"RTN","SAMIURUL",116,0)
 ;
"RTN","SAMIURUL",117,0)
 ; 2021-03-30 ven/toad 18.11 7b14bb29
"RTN","SAMIURUL",118,0)
 ;  SAMIUR bump version, date, log; in WSREPORT comment zwrite SRT.
"RTN","SAMIURUL",119,0)
 ;
"RTN","SAMIURUL",120,0)
 ; 2021-03-31 ven/gpl 18.11 66d89cde
"RTN","SAMIURUL",121,0)
 ;  SAMIUR sort on all uppercase names for reports
"RTN","SAMIURUL",122,0)
 ;
"RTN","SAMIURUL",123,0)
 ; 2021-04-13 ven/gpl 18.11 a12765bf,f09ffef9,fb399aba
"RTN","SAMIURUL",124,0)
 ;  SAMIUR inactive report created.
"RTN","SAMIURUL",125,0)
 ;  SAMIUR2 in RPTTBL,GENDER create inactive report, move last exam
"RTN","SAMIURUL",126,0)
 ; column on followup report, fix gender being blank in reports.
"RTN","SAMIURUL",127,0)
 ;
"RTN","SAMIURUL",128,0)
 ; 2021-05-20/25 ven/mcglk&toad 18.11 43a4557c,70fc6ba3,129e96b1,
"RTN","SAMIURUL",129,0)
 ; cee2bf17
"RTN","SAMIURUL",130,0)
 ;  SAMIUR annotate, lt refactor, bump version.
"RTN","SAMIURUL",131,0)
 ;  SAMIUR2 passim hdr comments, chg log, annotate, refactor, bump
"RTN","SAMIURUL",132,0)
 ; version.
"RTN","SAMIURUL",133,0)
 ;
"RTN","SAMIURUL",134,0)
 ; 2021-05-29 ven/gpl 18.12-t2 e6fd5730,a3d6f9a0
"RTN","SAMIURUL",135,0)
 ;  SAMIUR,SAMIUR2 ssn params & matching report, update unmatched
"RTN","SAMIURUL",136,0)
 ; report headings.
"RTN","SAMIURUL",137,0)
 ;
"RTN","SAMIURUL",138,0)
 ; 2021-06-15 ven/gpl 18.12-t2 7e481426
"RTN","SAMIURUL",139,0)
 ;  SAMIUR add site to editperson navigation.
"RTN","SAMIURUL",140,0)
 ;
"RTN","SAMIURUL",141,0)
 ; 2021-06-28 ven/gpl 18.12-t2 df0aaea1,1137e2bb
"RTN","SAMIURUL",142,0)
 ;  SAMIUR change definition of inactive to not marked active, change
"RTN","SAMIURUL",143,0)
 ; definition of active to marked active.
"RTN","SAMIURUL",144,0)
 ;
"RTN","SAMIURUL",145,0)
 ; 2021-07-06 ven/mcglk&toad&gpl 18.12-t2 cbf7e46b,2d642aa4,
"RTN","SAMIURUL",146,0)
 ; b248664b
"RTN","SAMIURUL",147,0)
 ;  SAMIURUL new routine for dev log.
"RTN","SAMIURUL",148,0)
 ;  SAMIUR,SAMIUR2,SAMIURUL move dev log & module docs to SAMIURUL,
"RTN","SAMIURUL",149,0)
 ; bump version & dates.
"RTN","SAMIURUL",150,0)
 ;  SAMIUR in SELECT r/inactive w/status, test for active instead of
"RTN","SAMIURUL",151,0)
 ; inactive.
"RTN","SAMIURUL",152,0)
 ;
"RTN","SAMIURUL",153,0)
 ; 2021-07-12 ven/gpl 18.12-t3 60f4bb05,27c40485,d35bcb46
"RTN","SAMIURUL",154,0)
 ;  SAMIUR in WSREPORT,SORT add contact date & entry to missingct
"RTN","SAMIURUL",155,0)
 ; report.
"RTN","SAMIURUL",156,0)
 ;  SAMIUR2 add contact date & entry to missingct report; add
"RTN","SAMIURUL",157,0)
 ; inactive date reason & comment to inactive report; chg inactive
"RTN","SAMIURUL",158,0)
 ; date to date of death.
"RTN","SAMIURUL",159,0)
 ;
"RTN","SAMIURUL",160,0)
 ; 2021-08-01 ven/gpl 18.12 5bd7c627
"RTN","SAMIURUL",161,0)
 ;  SAMIUR set intake form to incomplete on creation: in SELECT if
"RTN","SAMIURUL",162,0)
 ; type="incomplete" ensure default status is incomplete.
"RTN","SAMIURUL",163,0)
 ;
"RTN","SAMIURUL",164,0)
 ; 2021-08-11 ven/gpl 18.12 4d4f0fc3
"RTN","SAMIURUL",165,0)
 ;  SAMIUR,SAMIUR2 add sorting to tables used for reports
"RTN","SAMIURUL",166,0)
 ;  SAMIUR in WSREPORT,NUHREF,WKLIST.
"RTN","SAMIURUL",167,0)
 ;  SAMIUR2 in TDDT,BLINEDT,DOB,FUDATE,LASTEXM,INACTDT,LDOC,STUDYDT
"RTN","SAMIURUL",168,0)
 ;
"RTN","SAMIURUL",169,0)
 ; 2021-08-26 ven/gpl 18.14 de044cf9
"RTN","SAMIURUL",170,0)
 ; SAMIUR, SAMIUR2 make changes to user reports as requested.
"RTN","SAMIURUL",171,0)
 ; Reports changed were Enrollment, Activity, and Follow-up.
"RTN","SAMIURUL",172,0)
 ;
"RTN","SAMIURUL",173,0)
 ; 2021-08-28 ven/gpl 18.14  cd69ff8b, fbd9196d
"RTN","SAMIURUL",174,0)
 ; SAMIUR, SAMIUR2 fix bugs causing Activity report to work incorrectly.
"RTN","SAMIURUL",175,0)
 ; Also fixed problem with Work List.
"RTN","SAMIURUL",176,0)
 ;
"RTN","SAMIURUL",177,0)
 ; 2021-09-09 ven/gpl 18.14  afa4bfc2, 7f668e64, 8d45ebac
"RTN","SAMIURUL",178,0)
 ; SAMIUR fix bugs in reports showing inactive patients on wrong reports,
"RTN","SAMIURUL",179,0)
 ; "baseline" showing up in F/U date on Follow-up report, wrong patients
"RTN","SAMIURUL",180,0)
 ; on Intake but Missing CT Eval report.
"RTN","SAMIURUL",181,0)
 ;
"RTN","SAMIURUL",182,0)
 ; 2021-10-05 ven/gpl 18.14   3251c582, c4343d69, 368fa7f7, c4343d69
"RTN","SAMIURUL",183,0)
 ;  b3cd039b, 237109df, 368fa7f7
"RTN","SAMIURUL",184,0)
 ; SAMIIUR, SAMIUR2 fix some small bugs, make date formats consistent, bump 
"RTN","SAMIURUL",185,0)
 ; versions and dates.
"RTN","SAMIURUL",186,0)
 ;
"RTN","SAMIURUL",187,0)
 ; 2021-10-14 ven/gpl 18.14  6a973630
"RTN","SAMIURUL",188,0)
 ; SAMIUR fix bug where patients with CT Evals would appear on the Intake
"RTN","SAMIURUL",189,0)
 ; but no CT report
"RTN","SAMIURUL",190,0)
 ;
"RTN","SAMIURUL",191,0)
 ; 2021-10-15 ven/lmry 
"RTN","SAMIURUL",192,0)
 ; SAMIUR, SAMIURUL update history, bump dates
"RTN","SAMIURUL",193,0)
 ;
"RTN","SAMIURUL",194,0)
 ;
"RTN","SAMIURUL",195,0)
 ;@contents
"RTN","SAMIURUL",196,0)
 ; SAMIUR user reports
"RTN","SAMIURUL",197,0)
 ; SAMIUR2 user reports cont
"RTN","SAMIURUL",198,0)
 ; SAMIURUL user reports log
"RTN","SAMIURUL",199,0)
 ;
"RTN","SAMIURUL",200,0)
 ; SAMIUR1 [to be added]
"RTN","SAMIURUL",201,0)
 ;
"RTN","SAMIURUL",202,0)
 ;
"RTN","SAMIURUL",203,0)
 ;
"RTN","SAMIURUL",204,0)
EOR ; end of SAMIURUL
"VER")
8.0^22.2
**END**
**END**
