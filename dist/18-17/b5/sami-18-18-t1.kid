KIDS Distribution saved on Aug 13, 2024@18:54:52
Test Release SAMI*18.0*18 SEQ#18 (sami-18-18-t1)
**KIDS**:SAMI*18.0*18^

**INSTALL NAME**
SAMI*18.0*18
"BLD",11519,0)
SAMI*18.0*18^SAMI^0^3240813^n
"BLD",11519,4,0)
^9.64PA^^
"BLD",11519,6.3)
1
"BLD",11519,"INID")
n^y^n
"BLD",11519,"INIT")
POS1818^SAMIPAT
"BLD",11519,"KRN",0)
^9.67PA^1.5^25
"BLD",11519,"KRN",.4,0)
.4
"BLD",11519,"KRN",.401,0)
.401
"BLD",11519,"KRN",.402,0)
.402
"BLD",11519,"KRN",.403,0)
.403
"BLD",11519,"KRN",.5,0)
.5
"BLD",11519,"KRN",.84,0)
.84
"BLD",11519,"KRN",1.5,0)
1.5
"BLD",11519,"KRN",1.6,0)
1.6
"BLD",11519,"KRN",1.61,0)
1.61
"BLD",11519,"KRN",1.62,0)
1.62
"BLD",11519,"KRN",3.6,0)
3.6
"BLD",11519,"KRN",3.8,0)
3.8
"BLD",11519,"KRN",9.2,0)
9.2
"BLD",11519,"KRN",9.8,0)
9.8
"BLD",11519,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",11519,"KRN",9.8,"NM",1,0)
SAMICAS3^^0^B503791124
"BLD",11519,"KRN",9.8,"NM",2,0)
SAMICUL^^0^B136079
"BLD",11519,"KRN",9.8,"NM",3,0)
SAMIDCM1^^0^B109906029
"BLD",11519,"KRN",9.8,"NM",4,0)
SAMIFLD^^0^B242399154
"BLD",11519,"KRN",9.8,"NM",5,0)
SAMIFUL^^0^B129116
"BLD",11519,"KRN",9.8,"NM",6,0)
SAMIHOM4^^0^B991706712
"BLD",11519,"KRN",9.8,"NM",7,0)
SAMIHUL^^0^B120634
"BLD",11519,"KRN",9.8,"NM",8,0)
SAMIPAT^^0^B10800523
"BLD",11519,"KRN",9.8,"NM","B","SAMICAS3",1)

"BLD",11519,"KRN",9.8,"NM","B","SAMICUL",2)

"BLD",11519,"KRN",9.8,"NM","B","SAMIDCM1",3)

"BLD",11519,"KRN",9.8,"NM","B","SAMIFLD",4)

"BLD",11519,"KRN",9.8,"NM","B","SAMIFUL",5)

"BLD",11519,"KRN",9.8,"NM","B","SAMIHOM4",6)

"BLD",11519,"KRN",9.8,"NM","B","SAMIHUL",7)

"BLD",11519,"KRN",9.8,"NM","B","SAMIPAT",8)

"BLD",11519,"KRN",19,0)
19
"BLD",11519,"KRN",19.1,0)
19.1
"BLD",11519,"KRN",101,0)
101
"BLD",11519,"KRN",409.61,0)
409.61
"BLD",11519,"KRN",771,0)
771
"BLD",11519,"KRN",779.2,0)
779.2
"BLD",11519,"KRN",870,0)
870
"BLD",11519,"KRN",8989.51,0)
8989.51
"BLD",11519,"KRN",8989.52,0)
8989.52
"BLD",11519,"KRN",8993,0)
8993
"BLD",11519,"KRN",8994,0)
8994
"BLD",11519,"KRN","B",.4,.4)

"BLD",11519,"KRN","B",.401,.401)

"BLD",11519,"KRN","B",.402,.402)

"BLD",11519,"KRN","B",.403,.403)

"BLD",11519,"KRN","B",.5,.5)

"BLD",11519,"KRN","B",.84,.84)

"BLD",11519,"KRN","B",1.5,1.5)

"BLD",11519,"KRN","B",1.6,1.6)

"BLD",11519,"KRN","B",1.61,1.61)

"BLD",11519,"KRN","B",1.62,1.62)

"BLD",11519,"KRN","B",3.6,3.6)

"BLD",11519,"KRN","B",3.8,3.8)

"BLD",11519,"KRN","B",9.2,9.2)

"BLD",11519,"KRN","B",9.8,9.8)

"BLD",11519,"KRN","B",19,19)

"BLD",11519,"KRN","B",19.1,19.1)

"BLD",11519,"KRN","B",101,101)

"BLD",11519,"KRN","B",409.61,409.61)

"BLD",11519,"KRN","B",771,771)

"BLD",11519,"KRN","B",779.2,779.2)

"BLD",11519,"KRN","B",870,870)

"BLD",11519,"KRN","B",8989.51,8989.51)

"BLD",11519,"KRN","B",8989.52,8989.52)

"BLD",11519,"KRN","B",8993,8993)

"BLD",11519,"KRN","B",8994,8994)

"BLD",11519,"QUES",0)
^9.62^^
"BLD",11519,"REQB",0)
^9.611^1^1
"BLD",11519,"REQB",1,0)
SAMI*18.0*17^0
"BLD",11519,"REQB","B","SAMI*18.0*17",1)

"INIT")
POS1818^SAMIPAT
"MBREQ")
0
"PKG",230,-1)
1^1
"PKG",230,0)
SAMI^SAMI^SCREENING APPLICATIONS MANAGEMENT - IELCAP
"PKG",230,22,0)
^9.49I^1^1
"PKG",230,22,1,0)
18.0^3191203
"PKG",230,22,1,"PAH",1,0)
18^3240813
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","SAMICAS3")
0^1^B503791124
"RTN","SAMICAS3",1,0)
SAMICAS3 ;ven/gpl - case review cont ;2021-10-26t19:39z
"RTN","SAMICAS3",2,0)
 ;;18.0;SAMI;**3,9,11,12,15**;2020-01;Build 1
"RTN","SAMICAS3",3,0)
 ;;18-15
"RTN","SAMICAS3",4,0)
 ;
"RTN","SAMICAS3",5,0)
 ; SAMICAS3 contains ppis and other subroutines to support processing
"RTN","SAMICAS3",6,0)
 ; of the VAPALS-IELCAP case review page.
"RTN","SAMICAS3",7,0)
 ;
"RTN","SAMICAS3",8,0)
 quit  ; no entry from top
"RTN","SAMICAS3",9,0)
 ;
"RTN","SAMICAS3",10,0)
 ;
"RTN","SAMICAS3",11,0)
 ;
"RTN","SAMICAS3",12,0)
 ;@section 0 primary development: see routine %wful
"RTN","SAMICAS3",13,0)
 ;
"RTN","SAMICAS3",14,0)
 ;
"RTN","SAMICAS3",15,0)
 ;
"RTN","SAMICAS3",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICAS3",17,0)
 ;@documentation see SAMICUL
"RTN","SAMICAS3",18,0)
 ;@contents
"RTN","SAMICAS3",19,0)
 ; WSNFPOST wri-code WSNFPOST^SAMICAS3, post vapals addform: new form
"RTN","SAMICAS3",20,0)
 ; MKSBFORM create background form
"RTN","SAMICAS3",21,0)
 ;
"RTN","SAMICAS3",22,0)
 ; $$PREVNOD key of latest form including nodule grid
"RTN","SAMICAS3",23,0)
 ; $$LASTCMP date & key of last comparison scan
"RTN","SAMICAS3",24,0)
 ; $$PRIORCMP dates of all scans before last comparison scan
"RTN","SAMICAS3",25,0)
 ; $$KEY2DT date to put in prior scans field
"RTN","SAMICAS3",26,0)
 ; SORTFRMS sorts all forms for patient sid by date
"RTN","SAMICAS3",27,0)
 ;
"RTN","SAMICAS3",28,0)
 ; MKCEFORM create ct evaluation form
"RTN","SAMICAS3",29,0)
 ; MKFUFORM create follow-up form
"RTN","SAMICAS3",30,0)
 ; $$BASELNDT last previous baseline ct date
"RTN","SAMICAS3",31,0)
 ; MKPTFORM create pet evaluation form
"RTN","SAMICAS3",32,0)
 ; MKITFORM create intervention form
"RTN","SAMICAS3",33,0)
 ; MKBXFORM create biopsy form
"RTN","SAMICAS3",34,0)
 ; CASETBL generates case review table
"RTN","SAMICAS3",35,0)
 ;
"RTN","SAMICAS3",36,0)
 ;
"RTN","SAMICAS3",37,0)
 ;
"RTN","SAMICAS3",38,0)
 ;@section 1 WSNFPOST & related subroutines
"RTN","SAMICAS3",39,0)
 ;
"RTN","SAMICAS3",40,0)
 ;
"RTN","SAMICAS3",41,0)
 ;
"RTN","SAMICAS3",42,0)
 ;@wri-code WSNFPOST^SAMICAS3
"RTN","SAMICAS3",43,0)
WSNFPOST ; post vapals addform: new form
"RTN","SAMICAS3",44,0)
 ;
"RTN","SAMICAS3",45,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",46,0)
 ;
"RTN","SAMICAS3",47,0)
 ;ven/gpl;wri;procedure;clean;silent;sac;??% tests
"RTN","SAMICAS3",48,0)
 ;@signature
"RTN","SAMICAS3",49,0)
 ; do WSNFPOST^SAMICASE(ARGS,BODY,RESULT)
"RTN","SAMICAS3",50,0)
 ;@branches-from
"RTN","SAMICAS3",51,0)
 ; WSNFPOST^SAMICASE
"RTN","SAMICAS3",52,0)
 ;@ppi-called-by
"RTN","SAMICAS3",53,0)
 ; WSVAPALS^SAMIHOME [wr addform of ws post vapals]
"RTN","SAMICAS3",54,0)
 ;@called-by none
"RTN","SAMICAS3",55,0)
 ;@calls
"RTN","SAMICAS3",56,0)
 ; parseBody^%wf
"RTN","SAMICAS3",57,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMICAS3",58,0)
 ; $$KEYDATE^SAMIHOM3
"RTN","SAMICAS3",59,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",60,0)
 ; $$KEY2FM^SAMICAS2
"RTN","SAMICAS3",61,0)
 ; $$FMADD^XLFDT
"RTN","SAMICAS3",62,0)
 ; WSCASE^SAMICASE
"RTN","SAMICAS3",63,0)
 ; MKSBFORM^SAMICAS3
"RTN","SAMICAS3",64,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS3",65,0)
 ; MKFUFORM^SAMICAS3
"RTN","SAMICAS3",66,0)
 ; MKBXFORM^SAMICAS3
"RTN","SAMICAS3",67,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS3",68,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS3",69,0)
 ; wsGetForm^%wf
"RTN","SAMICAS3",70,0)
 ;@input
"RTN","SAMICAS3",71,0)
 ; .ARGS
"RTN","SAMICAS3",72,0)
 ; .ARGS("form")
"RTN","SAMICAS3",73,0)
 ; .ARGS("studyid")
"RTN","SAMICAS3",74,0)
 ; .ARGS("sid")
"RTN","SAMICAS3",75,0)
 ; .BODY
"RTN","SAMICAS3",76,0)
 ; .BODY(1) (e.g. "samiroute=casereview&dfn="_dfn_"&studyid="_studyid)
"RTN","SAMICAS3",77,0)
 ;@output
"RTN","SAMICAS3",78,0)
 ; @RESULT
"RTN","SAMICAS3",79,0)
 ;@tests
"RTN","SAMICAS3",80,0)
 ; UTNFPST^SAMIUTS2
"RTN","SAMICAS3",81,0)
 ;
"RTN","SAMICAS3",82,0)
 ;
"RTN","SAMICAS3",83,0)
 ;@stanza 2 get new form
"RTN","SAMICAS3",84,0)
 ;
"RTN","SAMICAS3",85,0)
 new vars,bdy
"RTN","SAMICAS3",86,0)
 set bdy=$get(BODY(1))
"RTN","SAMICAS3",87,0)
 do parseBody^%wf("vars",.bdy)
"RTN","SAMICAS3",88,0)
 merge vars=ARGS
"RTN","SAMICAS3",89,0)
 merge ^SAMIUL("nuform","vars")=vars
"RTN","SAMICAS3",90,0)
 ;
"RTN","SAMICAS3",91,0)
 new sid set sid=$get(vars("studyid"))
"RTN","SAMICAS3",92,0)
 if sid="" set sid=$get(ARGS("sid"))
"RTN","SAMICAS3",93,0)
 if sid="" do  quit  ;
"RTN","SAMICAS3",94,0)
 . do GETHOME^SAMIHOM3(.RESULT,.ARGS) ; on error return to home page
"RTN","SAMICAS3",95,0)
 . quit
"RTN","SAMICAS3",96,0)
 ;
"RTN","SAMICAS3",97,0)
 set nuform=$get(vars("form"))
"RTN","SAMICAS3",98,0)
 if nuform="" set nuform="ceform"
"RTN","SAMICAS3",99,0)
 ;
"RTN","SAMICAS3",100,0)
 new datekey set datekey=$$KEYDATE^SAMIHOM3($$NOW^XLFDT)
"RTN","SAMICAS3",101,0)
 ;
"RTN","SAMICAS3",102,0)
 ; check to see if form already exists
"RTN","SAMICAS3",103,0)
 ;
"RTN","SAMICAS3",104,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",105,0)
 new collide set collide=0 ; duplicate form for today - backdate forms scenario
"RTN","SAMICAS3",106,0)
 if $data(@root@("graph",sid,nuform_"-"_datekey)) do  ; already exists
"RTN","SAMICAS3",107,0)
 . set collide=1
"RTN","SAMICAS3",108,0)
 . if nuform="siform" quit
"RTN","SAMICAS3",109,0)
 . if nuform="sbform" quit  ; do not create multiple background forms
"RTN","SAMICAS3",110,0)
 . new lastone
"RTN","SAMICAS3",111,0)
 . set lastone=$order(@root@("graph",sid,nuform_"-a  "),-1)
"RTN","SAMICAS3",112,0)
 . quit:lastone=""
"RTN","SAMICAS3",113,0)
 . set newfm=$$KEY2FM^SAMICASE(lastone)
"RTN","SAMICAS3",114,0)
 . set datekey=$$KEYDATE^SAMIHOM3($$FMADD^XLFDT(newfm,1)) ; add one day to the last form
"RTN","SAMICAS3",115,0)
 . quit
"RTN","SAMICAS3",116,0)
 ;
"RTN","SAMICAS3",117,0)
 ; code to not allow two same forms for a patient a day
"RTN","SAMICAS3",118,0)
 ;
"RTN","SAMICAS3",119,0)
 if collide=1 do  quit  ;
"RTN","SAMICAS3",120,0)
 . set ARGS("errorMessage")="Form already exists for today"
"RTN","SAMICAS3",121,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",122,0)
 . do WSCASE^SAMICASE(.RESULT,.ARGS)
"RTN","SAMICAS3",123,0)
 . quit
"RTN","SAMICAS3",124,0)
 ;
"RTN","SAMICAS3",125,0)
 if nuform="sbform" do  ;
"RTN","SAMICAS3",126,0)
 . new oldkey set oldkey=$order(@root@("graph",sid,"sbform"))
"RTN","SAMICAS3",127,0)
 . if $extract(oldkey,1,6)="sbform" do  quit  ;
"RTN","SAMICAS3",128,0)
 . . set ARGS("key")=oldkey
"RTN","SAMICAS3",129,0)
 . . set ARGS("studyid")=sid
"RTN","SAMICAS3",130,0)
 . . set ARGS("form")="vapals:sbform"
"RTN","SAMICAS3",131,0)
 . . quit
"RTN","SAMICAS3",132,0)
 . new key set key="sbform-"_datekey
"RTN","SAMICAS3",133,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",134,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",135,0)
 . set ARGS("form")="vapals:sbform"
"RTN","SAMICAS3",136,0)
 . do MKSBFORM(sid,key)
"RTN","SAMICAS3",137,0)
 . quit
"RTN","SAMICAS3",138,0)
 ;
"RTN","SAMICAS3",139,0)
 if nuform="ceform" do  ;
"RTN","SAMICAS3",140,0)
 . new key set key="ceform-"_datekey
"RTN","SAMICAS3",141,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",142,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",143,0)
 . set ARGS("form")="vapals:ceform"
"RTN","SAMICAS3",144,0)
 . do MKCEFORM(sid,key)
"RTN","SAMICAS3",145,0)
 . quit
"RTN","SAMICAS3",146,0)
 ;
"RTN","SAMICAS3",147,0)
 if nuform="fuform" do  ;
"RTN","SAMICAS3",148,0)
 . new key set key="fuform-"_datekey
"RTN","SAMICAS3",149,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",150,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",151,0)
 . set ARGS("form")="vapals:fuform"
"RTN","SAMICAS3",152,0)
 . do MKFUFORM(sid,key)
"RTN","SAMICAS3",153,0)
 . quit
"RTN","SAMICAS3",154,0)
 ;
"RTN","SAMICAS3",155,0)
 if nuform="bxform" do  ;
"RTN","SAMICAS3",156,0)
 . new key set key="bxform-"_datekey
"RTN","SAMICAS3",157,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",158,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",159,0)
 . set ARGS("form")="vapals:bxform"
"RTN","SAMICAS3",160,0)
 . do MKBXFORM(sid,key)
"RTN","SAMICAS3",161,0)
 . quit
"RTN","SAMICAS3",162,0)
 ;
"RTN","SAMICAS3",163,0)
 if nuform="ptform" do  ;
"RTN","SAMICAS3",164,0)
 . new key set key="ptform-"_datekey
"RTN","SAMICAS3",165,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",166,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",167,0)
 . set ARGS("form")="vapals:ptform"
"RTN","SAMICAS3",168,0)
 . do MKPTFORM(sid,key)
"RTN","SAMICAS3",169,0)
 . quit
"RTN","SAMICAS3",170,0)
 ;
"RTN","SAMICAS3",171,0)
 if nuform="itform" do  ;
"RTN","SAMICAS3",172,0)
 . new key set key="itform-"_datekey
"RTN","SAMICAS3",173,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",174,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",175,0)
 . set ARGS("form")="vapals:itform"
"RTN","SAMICAS3",176,0)
 . do MKITFORM(sid,key)
"RTN","SAMICAS3",177,0)
 . quit
"RTN","SAMICAS3",178,0)
 ;
"RTN","SAMICAS3",179,0)
 do wsGetForm^%wf(.RESULT,.ARGS)
"RTN","SAMICAS3",180,0)
 ;
"RTN","SAMICAS3",181,0)
 ;
"RTN","SAMICAS3",182,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",183,0)
 ;
"RTN","SAMICAS3",184,0)
 quit  ; end of wri WSNFPOST^SAMICASE
"RTN","SAMICAS3",185,0)
 ;
"RTN","SAMICAS3",186,0)
 ;
"RTN","SAMICAS3",187,0)
 ;
"RTN","SAMICAS3",188,0)
MKSBFORM(sid,key) ; create background form
"RTN","SAMICAS3",189,0)
 ;
"RTN","SAMICAS3",190,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",191,0)
 ;
"RTN","SAMICAS3",192,0)
 ;ven/gpl;private;procedure;
"RTN","SAMICAS3",193,0)
 ;@called-by
"RTN","SAMICAS3",194,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",195,0)
 ;@calls
"RTN","SAMICAS3",196,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",197,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",198,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",199,0)
 ;@input
"RTN","SAMICAS3",200,0)
 ; sid = study id
"RTN","SAMICAS3",201,0)
 ; key = form key, e.g. sbform-2021-05-25
"RTN","SAMICAS3",202,0)
 ;@output
"RTN","SAMICAS3",203,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",204,0)
 ;@examples [tbd]
"RTN","SAMICAS3",205,0)
 ;@tests [tbd]
"RTN","SAMICAS3",206,0)
 ;
"RTN","SAMICAS3",207,0)
 ;@stanza 2 create background form
"RTN","SAMICAS3",208,0)
 ;
"RTN","SAMICAS3",209,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",210,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",211,0)
 quit:+sien=0
"RTN","SAMICAS3",212,0)
 ;
"RTN","SAMICAS3",213,0)
 new cdate set cdate=$piece(key,"sbform-",2)
"RTN","SAMICAS3",214,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",215,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",216,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",217,0)
 ;
"RTN","SAMICAS3",218,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",219,0)
 ;
"RTN","SAMICAS3",220,0)
 quit  ; end of MKSBFORM
"RTN","SAMICAS3",221,0)
 ;
"RTN","SAMICAS3",222,0)
 ;
"RTN","SAMICAS3",223,0)
 ;
"RTN","SAMICAS3",224,0)
PREVNOD(sid) ; key of latest form including nodule grid
"RTN","SAMICAS3",225,0)
 ;
"RTN","SAMICAS3",226,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",227,0)
 ;
"RTN","SAMICAS3",228,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",229,0)
 ;@called-by none [commented out in MKCEFORM,MKPTFORM,MKBXFORM]
"RTN","SAMICAS3",230,0)
 ;@calls
"RTN","SAMICAS3",231,0)
 ; SORTFRMS
"RTN","SAMICAS3",232,0)
 ;@input
"RTN","SAMICAS3",233,0)
 ; sid = study id
"RTN","SAMICAS3",234,0)
 ;@output = key of latest form incl nodule grid
"RTN","SAMICAS3",235,0)
 ;@examples [tbd]
"RTN","SAMICAS3",236,0)
 ;@tests [tbd]
"RTN","SAMICAS3",237,0)
 ;
"RTN","SAMICAS3",238,0)
 ; used for nodule copy
"RTN","SAMICAS3",239,0)
 ;
"RTN","SAMICAS3",240,0)
 ;
"RTN","SAMICAS3",241,0)
 ;@stanza 2 calculate key of latest form incl nodule grid
"RTN","SAMICAS3",242,0)
 ;
"RTN","SAMICAS3",243,0)
 new retkey set retkey=""
"RTN","SAMICAS3",244,0)
 new fary
"RTN","SAMICAS3",245,0)
 do SORTFRMS(.fary,sid)
"RTN","SAMICAS3",246,0)
 ;
"RTN","SAMICAS3",247,0)
 new tdt set tdt=""
"RTN","SAMICAS3",248,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",249,0)
 . new tmpkey set tmpkey=""
"RTN","SAMICAS3",250,0)
 . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",251,0)
 . . if tmpkey["ceform" set retkey=tmpkey
"RTN","SAMICAS3",252,0)
 . . if tmpkey["ptform" set retkey=tmpkey
"RTN","SAMICAS3",253,0)
 . . if tmpkey["bxform" set retkey=tmpkey
"RTN","SAMICAS3",254,0)
 . . quit
"RTN","SAMICAS3",255,0)
 . quit
"RTN","SAMICAS3",256,0)
 ;
"RTN","SAMICAS3",257,0)
 ;
"RTN","SAMICAS3",258,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",259,0)
 ;
"RTN","SAMICAS3",260,0)
 quit retkey ; end of $$PREVNOD
"RTN","SAMICAS3",261,0)
 ;
"RTN","SAMICAS3",262,0)
 ;
"RTN","SAMICAS3",263,0)
 ;
"RTN","SAMICAS3",264,0)
LASTCMP(sid,retkey) ; date & key of last comparison scan
"RTN","SAMICAS3",265,0)
 ;
"RTN","SAMICAS3",266,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",267,0)
 ;
"RTN","SAMICAS3",268,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",269,0)
 ;@called-by
"RTN","SAMICAS3",270,0)
 ; MKBXFORM
"RTN","SAMICAS3",271,0)
 ; MKCEFORM
"RTN","SAMICAS3",272,0)
 ; MKFUFORM
"RTN","SAMICAS3",273,0)
 ; MKITFORM
"RTN","SAMICAS3",274,0)
 ; MKPTFORM
"RTN","SAMICAS3",275,0)
 ;@calls
"RTN","SAMICAS3",276,0)
 ; SORTFRMS
"RTN","SAMICAS3",277,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS3",278,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMICAS3",279,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",280,0)
 ;@input
"RTN","SAMICAS3",281,0)
 ; sid = study id
"RTN","SAMICAS3",282,0)
 ;@output = date of last comparison scan
"RTN","SAMICAS3",283,0)
 ; .retkey = key of last comparison scan
"RTN","SAMICAS3",284,0)
 ;@examples [tbd]
"RTN","SAMICAS3",285,0)
 ;@tests [tbd]
"RTN","SAMICAS3",286,0)
 ;
"RTN","SAMICAS3",287,0)
 ;
"RTN","SAMICAS3",288,0)
 ;@stanza 2 calculate date & key of last comparison scan
"RTN","SAMICAS3",289,0)
 ;
"RTN","SAMICAS3",290,0)
 set retkey=""
"RTN","SAMICAS3",291,0)
 new fary
"RTN","SAMICAS3",292,0)
 do SORTFRMS(.fary,sid)
"RTN","SAMICAS3",293,0)
 ;
"RTN","SAMICAS3",294,0)
 ;new tdt set tdt=$piece($$NOW^XLFDT,".",1)+1 ; start with today
"RTN","SAMICAS3",295,0)
 new tdt set tdt=$piece($$NOW^XLFDT,".",1) ; start with before today
"RTN","SAMICAS3",296,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",297,0)
 . new tmpkey set tmpkey=""
"RTN","SAMICAS3",298,0)
 . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",299,0)
 . . if tmpkey["ceform" set retkey=tmpkey
"RTN","SAMICAS3",300,0)
 . . quit
"RTN","SAMICAS3",301,0)
 . quit
"RTN","SAMICAS3",302,0)
 ;
"RTN","SAMICAS3",303,0)
 new retdt set retdt=-1
"RTN","SAMICAS3",304,0)
 if retkey'="" do  ;
"RTN","SAMICAS3",305,0)
 . new fmdt set fmdt=$$KEY2FM^SAMICASE(retkey)
"RTN","SAMICAS3",306,0)
 . set retdt=$$VAPALSDT^SAMICASE(fmdt)
"RTN","SAMICAS3",307,0)
 . quit
"RTN","SAMICAS3",308,0)
 ;
"RTN","SAMICAS3",309,0)
 ;
"RTN","SAMICAS3",310,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",311,0)
 ;
"RTN","SAMICAS3",312,0)
 quit retdt ; end of $$LASTCMP
"RTN","SAMICAS3",313,0)
 ;
"RTN","SAMICAS3",314,0)
 ;
"RTN","SAMICAS3",315,0)
 ;
"RTN","SAMICAS3",316,0)
PRIORCMP(sid) ; dates of all scans before last comparison scan
"RTN","SAMICAS3",317,0)
 ;
"RTN","SAMICAS3",318,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",319,0)
 ;
"RTN","SAMICAS3",320,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",321,0)
 ;@called-by
"RTN","SAMICAS3",322,0)
 ; MKCEFORM
"RTN","SAMICAS3",323,0)
 ; MKPTFORM
"RTN","SAMICAS3",324,0)
 ; MKITFORM
"RTN","SAMICAS3",325,0)
 ;@calls
"RTN","SAMICAS3",326,0)
 ; SORTFRMS
"RTN","SAMICAS3",327,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS3",328,0)
 ; $$KEY2DT
"RTN","SAMICAS3",329,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",330,0)
 ;@input
"RTN","SAMICAS3",331,0)
 ; sid = study id
"RTN","SAMICAS3",332,0)
 ;@output = dates of all scans before last comparison scan
"RTN","SAMICAS3",333,0)
 ;@examples [tbd]
"RTN","SAMICAS3",334,0)
 ;@tests [tbd]
"RTN","SAMICAS3",335,0)
 ;
"RTN","SAMICAS3",336,0)
 ;
"RTN","SAMICAS3",337,0)
 ;@stanza 2 calculate dates of all scans before last comparison scan
"RTN","SAMICAS3",338,0)
 ;
"RTN","SAMICAS3",339,0)
 new retstr set retstr=""
"RTN","SAMICAS3",340,0)
 new lastcmp set lastcmp=""
"RTN","SAMICAS3",341,0)
 new fary
"RTN","SAMICAS3",342,0)
 do SORTFRMS(.fary,sid)
"RTN","SAMICAS3",343,0)
 ;
"RTN","SAMICAS3",344,0)
 ;new tdt set tdt=$piece($$NOW^XLFDT,".",1)+1 ; start with today
"RTN","SAMICAS3",345,0)
 new tdt set tdt=$piece($$NOW^XLFDT,".",1) ; start with before today
"RTN","SAMICAS3",346,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  do  ; 
"RTN","SAMICAS3",347,0)
 . ;
"RTN","SAMICAS3",348,0)
 . if lastcmp="" do  ; first find the last comparison scan
"RTN","SAMICAS3",349,0)
 . . new tmpkey set tmpkey=""
"RTN","SAMICAS3",350,0)
 . . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:lastcmp'=""  do  ; 
"RTN","SAMICAS3",351,0)
 . . . if tmpkey["ceform" set lastcmp=tmpkey
"RTN","SAMICAS3",352,0)
 . . . quit
"RTN","SAMICAS3",353,0)
 . . quit
"RTN","SAMICAS3",354,0)
 . ;
"RTN","SAMICAS3",355,0)
 . do  ;
"RTN","SAMICAS3",356,0)
 . . ; next add all previous scans to retstr
"RTN","SAMICAS3",357,0)
 . . new tmpkey2 set tmpkey2=""
"RTN","SAMICAS3",358,0)
 . . for  set tmpkey2=$order(fary(tdt,tmpkey2)) quit:tmpkey2=""  do  ; 
"RTN","SAMICAS3",359,0)
 . . . if tmpkey2["ceform" do  ; convert to external date
"RTN","SAMICAS3",360,0)
 . . . . set retstr=$$KEY2DT(tmpkey2)_retstr
"RTN","SAMICAS3",361,0)
 . . . . quit
"RTN","SAMICAS3",362,0)
 . . . quit
"RTN","SAMICAS3",363,0)
 . . quit
"RTN","SAMICAS3",364,0)
 . quit
"RTN","SAMICAS3",365,0)
 ;
"RTN","SAMICAS3",366,0)
 if $extract(retstr,$length(retstr))="," do
"RTN","SAMICAS3",367,0)
 . set retstr=$extract(retstr,1,$length(retstr)-1)
"RTN","SAMICAS3",368,0)
 . quit
"RTN","SAMICAS3",369,0)
 ;
"RTN","SAMICAS3",370,0)
 ;if retstr="" set retstr=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",371,0)
 ;
"RTN","SAMICAS3",372,0)
 ;
"RTN","SAMICAS3",373,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",374,0)
 ;
"RTN","SAMICAS3",375,0)
 quit retstr ; end of $$PRIORCMP
"RTN","SAMICAS3",376,0)
 ;
"RTN","SAMICAS3",377,0)
 ;
"RTN","SAMICAS3",378,0)
 ;
"RTN","SAMICAS3",379,0)
KEY2DT(key) ; date to put in prior scans field
"RTN","SAMICAS3",380,0)
 ;
"RTN","SAMICAS3",381,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",382,0)
 ;
"RTN","SAMICAS3",383,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",384,0)
 ;@called-by
"RTN","SAMICAS3",385,0)
 ; $$PRIORCMP
"RTN","SAMICAS3",386,0)
 ;@calls
"RTN","SAMICAS3",387,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMICAS3",388,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",389,0)
 ;@input
"RTN","SAMICAS3",390,0)
 ; key = form key, e.g. ctform-2021-05-25
"RTN","SAMICAS3",391,0)
 ;@output = date to put in prior scans field
"RTN","SAMICAS3",392,0)
 ;@examples [tbd]
"RTN","SAMICAS3",393,0)
 ;@tests [tbd]
"RTN","SAMICAS3",394,0)
 ;
"RTN","SAMICAS3",395,0)
 ;
"RTN","SAMICAS3",396,0)
 ;@stanza 2 calculate prior scans date
"RTN","SAMICAS3",397,0)
 ;
"RTN","SAMICAS3",398,0)
 new retstr2 set retstr2=""
"RTN","SAMICAS3",399,0)
 new fmdt set fmdt=$$KEY2FM^SAMICASE(tmpkey2)
"RTN","SAMICAS3",400,0)
 set retstr2=$$VAPALSDT^SAMICASE(fmdt)_","_retstr2
"RTN","SAMICAS3",401,0)
 ;
"RTN","SAMICAS3",402,0)
 ;
"RTN","SAMICAS3",403,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",404,0)
 ;
"RTN","SAMICAS3",405,0)
 quit retstr2 ; end of $$KEY2DT
"RTN","SAMICAS3",406,0)
 ;
"RTN","SAMICAS3",407,0)
 ;
"RTN","SAMICAS3",408,0)
 ;
"RTN","SAMICAS3",409,0)
SORTFRMS(ARY,sid) ; sorts all forms for patient sid by date
"RTN","SAMICAS3",410,0)
 ;
"RTN","SAMICAS3",411,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",412,0)
 ;
"RTN","SAMICAS3",413,0)
 ;ven/gpl;private;procedure;clean;silent;sac;
"RTN","SAMICAS3",414,0)
 ;@called-by
"RTN","SAMICAS3",415,0)
 ; $$PREVNOD
"RTN","SAMICAS3",416,0)
 ; $$LASTCMP
"RTN","SAMICAS3",417,0)
 ; $$PRIORCMP
"RTN","SAMICAS3",418,0)
 ;@calls
"RTN","SAMICAS3",419,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",420,0)
 ; ^%DT
"RTN","SAMICAS3",421,0)
 ; ^%ZTER
"RTN","SAMICAS3",422,0)
 ;@input
"RTN","SAMICAS3",423,0)
 ; sid = study id
"RTN","SAMICAS3",424,0)
 ;@output
"RTN","SAMICAS3",425,0)
 ; .ARY: sorted array of all forms for patient by date
"RTN","SAMICAS3",426,0)
 ;  ARY(fmdate,key)=""
"RTN","SAMICAS3",427,0)
 ;@examples [tbd]
"RTN","SAMICAS3",428,0)
 ;@tests [tbd]
"RTN","SAMICAS3",429,0)
 ;
"RTN","SAMICAS3",430,0)
 ;
"RTN","SAMICAS3",431,0)
 ;@stanza 2 sort patient's forms by date
"RTN","SAMICAS3",432,0)
 ;
"RTN","SAMICAS3",433,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",434,0)
 quit:'$data(@root@("graph",sid))
"RTN","SAMICAS3",435,0)
 new froot set froot=$name(@root@("graph",sid))
"RTN","SAMICAS3",436,0)
 ;
"RTN","SAMICAS3",437,0)
 new zi set zi=""
"RTN","SAMICAS3",438,0)
 for  set zi=$order(@froot@(zi)) quit:zi=""  do  ;
"RTN","SAMICAS3",439,0)
 . new ftype set ftype=$piece(zi,"-",1)
"RTN","SAMICAS3",440,0)
 . new fdate set fdate=$piece(zi,ftype_"-",2)
"RTN","SAMICAS3",441,0)
 . new X,Y
"RTN","SAMICAS3",442,0)
 . set X=fdate
"RTN","SAMICAS3",443,0)
 . do ^%DT
"RTN","SAMICAS3",444,0)
 . if Y=-1 do ^%ZTER quit  ;
"RTN","SAMICAS3",445,0)
 . set ARY(Y,zi)=""
"RTN","SAMICAS3",446,0)
 . quit
"RTN","SAMICAS3",447,0)
 ;
"RTN","SAMICAS3",448,0)
 ;
"RTN","SAMICAS3",449,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",450,0)
 ;
"RTN","SAMICAS3",451,0)
 quit  ; end of SORTFRMS
"RTN","SAMICAS3",452,0)
 ;
"RTN","SAMICAS3",453,0)
 ;
"RTN","SAMICAS3",454,0)
 ;
"RTN","SAMICAS3",455,0)
MKCEFORM(sid,key) ; create ct evaluation form
"RTN","SAMICAS3",456,0)
 ;
"RTN","SAMICAS3",457,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",458,0)
 ;
"RTN","SAMICAS3",459,0)
 ;ven/gpl;private;procedure;clean;silent;sac;
"RTN","SAMICAS3",460,0)
 ;@called-by
"RTN","SAMICAS3",461,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",462,0)
 ;@calls
"RTN","SAMICAS3",463,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",464,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",465,0)
 ; $$LASTCMP
"RTN","SAMICAS3",466,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",467,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",468,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS3",469,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",470,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",471,0)
 ; $$PRIORCMP^SAMICAS3
"RTN","SAMICAS3",472,0)
 ;@input
"RTN","SAMICAS3",473,0)
 ; sid = study id
"RTN","SAMICAS3",474,0)
 ; key = form key, e.g. ceform-2021-05-25
"RTN","SAMICAS3",475,0)
 ;@output
"RTN","SAMICAS3",476,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",477,0)
 ;@examples [tbd]
"RTN","SAMICAS3",478,0)
 ;@tests [tbd]
"RTN","SAMICAS3",479,0)
 ;
"RTN","SAMICAS3",480,0)
 ;
"RTN","SAMICAS3",481,0)
 ;@stanza 2 create ct eval form
"RTN","SAMICAS3",482,0)
 ;
"RTN","SAMICAS3",483,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",484,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",485,0)
 quit:+sien=0
"RTN","SAMICAS3",486,0)
 new cdate set cdate=$piece(key,"ceform-",2)
"RTN","SAMICAS3",487,0)
 ;
"RTN","SAMICAS3",488,0)
 ; nodule copy
"RTN","SAMICAS3",489,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",490,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",491,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",492,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",493,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",494,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",495,0)
 . quit
"RTN","SAMICAS3",496,0)
 ; end nodule copy
"RTN","SAMICAS3",497,0)
 ;
"RTN","SAMICAS3",498,0)
 ; new items,prevct
"RTN","SAMICAS3",499,0)
 ; do GETITEMS^SAMICASE("items",sid)
"RTN","SAMICAS3",500,0)
 ; set prevct=""
"RTN","SAMICAS3",501,0)
 ; if $data(items("type","vapals:ceform")) do  ; previous cteval exists
"RTN","SAMICAS3",502,0)
 ; . set prevct=$order(items("type","vapals:ceform",""),-1) ; latest ceform
"RTN","SAMICAS3",503,0)
 ; . quit
"RTN","SAMICAS3",504,0)
 ; if prevct'="" do  ;
"RTN","SAMICAS3",505,0)
 ; . new target,source
"RTN","SAMICAS3",506,0)
 ; . set source=$name(@root@("graph",sid,prevct))
"RTN","SAMICAS3",507,0)
 ; . set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",508,0)
 ; . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",509,0)
 ; . quit
"RTN","SAMICAS3",510,0)
 ;
"RTN","SAMICAS3",511,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",512,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",513,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",514,0)
 ;
"RTN","SAMICAS3",515,0)
 ; set baseline CT date and last comparison scan date
"RTN","SAMICAS3",516,0)
 do  ;
"RTN","SAMICAS3",517,0)
 . new basedt
"RTN","SAMICAS3",518,0)
 . set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",519,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",520,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",521,0)
 . if lastdt=-1 set lastdt=""
"RTN","SAMICAS3",522,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS3(sid)
"RTN","SAMICAS3",523,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",524,0)
 . if priordt="" set priordt=lastdt
"RTN","SAMICAS3",525,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",526,0)
 . set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",527,0)
 . set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",528,0)
 . ;
"RTN","SAMICAS3",529,0)
 . ; set clinical information line for billing
"RTN","SAMICAS3",530,0)
 . set @root@("graph",sid,key,"ceclin")=$$CLINSUM^SAMICAS4(sid)
"RTN","SAMICAS3",531,0)
 . quit
"RTN","SAMICAS3",532,0)
 ;
"RTN","SAMICAS3",533,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",534,0)
 ;
"RTN","SAMICAS3",535,0)
 quit  ; end of MKCEFORM
"RTN","SAMICAS3",536,0)
 ;
"RTN","SAMICAS3",537,0)
 ;
"RTN","SAMICAS3",538,0)
 ;
"RTN","SAMICAS3",539,0)
MKFUFORM(sid,key) ; create Follow-up form
"RTN","SAMICAS3",540,0)
 ;
"RTN","SAMICAS3",541,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",542,0)
 ;
"RTN","SAMICAS3",543,0)
 ;ven/gpl;private;procedure;clean;silent;sac;
"RTN","SAMICAS3",544,0)
 ;@called-by
"RTN","SAMICAS3",545,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",546,0)
 ;@calls
"RTN","SAMICAS3",547,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",548,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",549,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMICAS3",550,0)
 ; $$BASELNDT
"RTN","SAMICAS3",551,0)
 ; $$LASTCMP
"RTN","SAMICAS3",552,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS3",553,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",554,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",555,0)
 ;@input
"RTN","SAMICAS3",556,0)
 ; sid = study id
"RTN","SAMICAS3",557,0)
 ; key = form key, e.g. fuform-2021-05-25
"RTN","SAMICAS3",558,0)
 ;@output
"RTN","SAMICAS3",559,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",560,0)
 ;@examples [tbd]
"RTN","SAMICAS3",561,0)
 ;@tests [tbd]
"RTN","SAMICAS3",562,0)
 ;
"RTN","SAMICAS3",563,0)
 ;
"RTN","SAMICAS3",564,0)
 ;@stanza 2 create Follow-up form
"RTN","SAMICAS3",565,0)
 ;
"RTN","SAMICAS3",566,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",567,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",568,0)
 quit:+sien=0
"RTN","SAMICAS3",569,0)
 ;
"RTN","SAMICAS3",570,0)
 new cdate set cdate=$piece(key,"fuform-",2)
"RTN","SAMICAS3",571,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",572,0)
 ;
"RTN","SAMICAS3",573,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",574,0)
 set @root@("graph",sid,key,"sidof")=$$KEY2DSPD^SAMICAS2(cdate)
"RTN","SAMICAS3",575,0)
 new basedt
"RTN","SAMICAS3",576,0)
 set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",577,0)
 if basedt=-1 set basedt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",578,0)
 if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",579,0)
 set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",580,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",581,0)
 ;
"RTN","SAMICAS3",582,0)
 ;
"RTN","SAMICAS3",583,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",584,0)
 ;
"RTN","SAMICAS3",585,0)
 quit  ; end of MKFUFORM
"RTN","SAMICAS3",586,0)
 ;
"RTN","SAMICAS3",587,0)
 ;
"RTN","SAMICAS3",588,0)
 ;
"RTN","SAMICAS3",589,0)
BASELNDT(sid) ; last previous baseline ct date
"RTN","SAMICAS3",590,0)
 ;
"RTN","SAMICAS3",591,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",592,0)
 ;
"RTN","SAMICAS3",593,0)
 ;ven/gpl;private;function;clean;silent;sac
"RTN","SAMICAS3",594,0)
 ;@called-by
"RTN","SAMICAS3",595,0)
 ; MKCEFORM
"RTN","SAMICAS3",596,0)
 ; MKFUFORM
"RTN","SAMICAS3",597,0)
 ; MKPTFORM
"RTN","SAMICAS3",598,0)
 ; MKITFORM
"RTN","SAMICAS3",599,0)
 ;@calls
"RTN","SAMICAS3",600,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",601,0)
 ; GETITEMS^SAMICASE
"RTN","SAMICAS3",602,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMICAS3",603,0)
 ;@input
"RTN","SAMICAS3",604,0)
 ; sid = study id
"RTN","SAMICAS3",605,0)
 ;@output = last previous baseline ct date
"RTN","SAMICAS3",606,0)
 ;@examples [tbd]
"RTN","SAMICAS3",607,0)
 ;@tests [tbd]
"RTN","SAMICAS3",608,0)
 ;
"RTN","SAMICAS3",609,0)
 ;
"RTN","SAMICAS3",610,0)
 ;@stanza 2 calculate last previous baseline ct date
"RTN","SAMICAS3",611,0)
 ;
"RTN","SAMICAS3",612,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",613,0)
 new groot set groot=$name(@root@("graph",sid))
"RTN","SAMICAS3",614,0)
 new items set items=""
"RTN","SAMICAS3",615,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMICAS3",616,0)
 quit:'$data(items) ""
"RTN","SAMICAS3",617,0)
 ;
"RTN","SAMICAS3",618,0)
 new bdate set bdate=""
"RTN","SAMICAS3",619,0)
 new bkey set bkey=""
"RTN","SAMICAS3",620,0)
 new done set done=0
"RTN","SAMICAS3",621,0)
 for  set bkey=$order(items("type","vapals:ceform",bkey)) quit:bkey=""  do  ;
"RTN","SAMICAS3",622,0)
 . ; write !,bkey," ",$get(@groot@(bkey,"cetex"))
"RTN","SAMICAS3",623,0)
 . if $get(@groot@(bkey,"cetex"))="b" do  ;
"RTN","SAMICAS3",624,0)
 . . set done=1
"RTN","SAMICAS3",625,0)
 . . set bdate=$piece(bkey,"ceform-",2)
"RTN","SAMICAS3",626,0)
 . . quit
"RTN","SAMICAS3",627,0)
 . quit
"RTN","SAMICAS3",628,0)
 set bdate=$$KEY2DSPD^SAMICAS2(bdate)
"RTN","SAMICAS3",629,0)
 ;
"RTN","SAMICAS3",630,0)
 ;
"RTN","SAMICAS3",631,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",632,0)
 ;
"RTN","SAMICAS3",633,0)
 quit bdate ; end of $$BASELNDT
"RTN","SAMICAS3",634,0)
 ;
"RTN","SAMICAS3",635,0)
 ;
"RTN","SAMICAS3",636,0)
 ;
"RTN","SAMICAS3",637,0)
MKPTFORM(sid,key) ; create pet evaluation form
"RTN","SAMICAS3",638,0)
 ;
"RTN","SAMICAS3",639,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",640,0)
 ;
"RTN","SAMICAS3",641,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",642,0)
 ;@called-by
"RTN","SAMICAS3",643,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",644,0)
 ;@calls
"RTN","SAMICAS3",645,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",646,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",647,0)
 ; $$LASTCMP
"RTN","SAMICAS3",648,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",649,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",650,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS3",651,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",652,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",653,0)
 ; $$PRIORCMP^SAMICAS3
"RTN","SAMICAS3",654,0)
 ;@input
"RTN","SAMICAS3",655,0)
 ; sid = study id
"RTN","SAMICAS3",656,0)
 ; key = form key, e.g. ptform-2021-05-25
"RTN","SAMICAS3",657,0)
 ;@output
"RTN","SAMICAS3",658,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",659,0)
 ;@examples [tbd]
"RTN","SAMICAS3",660,0)
 ;@tests [tbd]
"RTN","SAMICAS3",661,0)
 ;
"RTN","SAMICAS3",662,0)
 ;
"RTN","SAMICAS3",663,0)
 ;@stanza 2 create pet eval form
"RTN","SAMICAS3",664,0)
 ;
"RTN","SAMICAS3",665,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",666,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",667,0)
 quit:+sien=0
"RTN","SAMICAS3",668,0)
 ;
"RTN","SAMICAS3",669,0)
 ; nodule copy
"RTN","SAMICAS3",670,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",671,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",672,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",673,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",674,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",675,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",676,0)
 . quit
"RTN","SAMICAS3",677,0)
 ; end nodule copy
"RTN","SAMICAS3",678,0)
 ;
"RTN","SAMICAS3",679,0)
 new cdate set cdate=$piece(key,"ptform-",2)
"RTN","SAMICAS3",680,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",681,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",682,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",683,0)
 ;
"RTN","SAMICAS3",684,0)
 do  ;
"RTN","SAMICAS3",685,0)
 . new basedt
"RTN","SAMICAS3",686,0)
 . set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",687,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",688,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",689,0)
 . if lastdt=-1 set lastdt=basedt
"RTN","SAMICAS3",690,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS3(sid)
"RTN","SAMICAS3",691,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",692,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",693,0)
 . ; set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",694,0)
 . set @root@("graph",sid,key,"cedos")=lastdt ; it's different than on the ce
"RTN","SAMICAS3",695,0)
 . ; set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",696,0)
 . quit
"RTN","SAMICAS3",697,0)
 ;
"RTN","SAMICAS3",698,0)
 ;
"RTN","SAMICAS3",699,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",700,0)
 ;
"RTN","SAMICAS3",701,0)
 quit  ; end of MKPTFORM
"RTN","SAMICAS3",702,0)
 ;
"RTN","SAMICAS3",703,0)
 ;
"RTN","SAMICAS3",704,0)
 ;
"RTN","SAMICAS3",705,0)
MKITFORM(sid,key) ; create intervention form
"RTN","SAMICAS3",706,0)
 ;
"RTN","SAMICAS3",707,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",708,0)
 ;
"RTN","SAMICAS3",709,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",710,0)
 ;@called-by
"RTN","SAMICAS3",711,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",712,0)
 ;@calls
"RTN","SAMICAS3",713,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",714,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",715,0)
 ; $$PREVNODE [commented out]
"RTN","SAMICAS3",716,0)
 ; $$LASTCMP
"RTN","SAMICAS3",717,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",718,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",719,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS3",720,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",721,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",722,0)
 ; $$PRIORCMP^SAMICAS3
"RTN","SAMICAS3",723,0)
 ;@input
"RTN","SAMICAS3",724,0)
 ; sid = study id
"RTN","SAMICAS3",725,0)
 ; key = form key, e.g. itform-2021-05-25
"RTN","SAMICAS3",726,0)
 ;@output
"RTN","SAMICAS3",727,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",728,0)
 ;@examples [tbd]
"RTN","SAMICAS3",729,0)
 ;@tests [tbd]
"RTN","SAMICAS3",730,0)
 ;
"RTN","SAMICAS3",731,0)
 ;
"RTN","SAMICAS3",732,0)
 ;@stanza 2 create intervention form
"RTN","SAMICAS3",733,0)
 ;
"RTN","SAMICAS3",734,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",735,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",736,0)
 quit:+sien=0
"RTN","SAMICAS3",737,0)
 ;
"RTN","SAMICAS3",738,0)
 new cdate set cdate=$piece(key,"itform-",2)
"RTN","SAMICAS3",739,0)
 ;
"RTN","SAMICAS3",740,0)
 ; nodule copy
"RTN","SAMICAS3",741,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",742,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",743,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",744,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",745,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",746,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",747,0)
 . quit
"RTN","SAMICAS3",748,0)
 ; end nodule copy
"RTN","SAMICAS3",749,0)
 ;
"RTN","SAMICAS3",750,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",751,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",752,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",753,0)
 ;
"RTN","SAMICAS3",754,0)
 do  ;
"RTN","SAMICAS3",755,0)
 . new basedt
"RTN","SAMICAS3",756,0)
 . set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",757,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",758,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",759,0)
 . if lastdt=-1 set lastdt=basedt
"RTN","SAMICAS3",760,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS3(sid)
"RTN","SAMICAS3",761,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",762,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",763,0)
 . ; set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",764,0)
 . set @root@("graph",sid,key,"cedos")=lastdt ; it's different than on the ce
"RTN","SAMICAS3",765,0)
 . ; set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",766,0)
 . quit
"RTN","SAMICAS3",767,0)
 ;
"RTN","SAMICAS3",768,0)
 ;
"RTN","SAMICAS3",769,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",770,0)
 ;
"RTN","SAMICAS3",771,0)
 quit  ; end of MKITFORM
"RTN","SAMICAS3",772,0)
 ;
"RTN","SAMICAS3",773,0)
 ;
"RTN","SAMICAS3",774,0)
 ;
"RTN","SAMICAS3",775,0)
MKBXFORM(sid,key) ; create biopsy form
"RTN","SAMICAS3",776,0)
 ;
"RTN","SAMICAS3",777,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",778,0)
 ;
"RTN","SAMICAS3",779,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",780,0)
 ;@called-by
"RTN","SAMICAS3",781,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",782,0)
 ;@calls
"RTN","SAMICAS3",783,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",784,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",785,0)
 ; $$LASTCMP
"RTN","SAMICAS3",786,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",787,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",788,0)
 ;@input
"RTN","SAMICAS3",789,0)
 ; sid = study id
"RTN","SAMICAS3",790,0)
 ; key = form key, e.g. bxform-2021-05-25
"RTN","SAMICAS3",791,0)
 ;@output
"RTN","SAMICAS3",792,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",793,0)
 ;@examples [tbd]
"RTN","SAMICAS3",794,0)
 ;@tests [tbd]
"RTN","SAMICAS3",795,0)
 ;
"RTN","SAMICAS3",796,0)
 ;
"RTN","SAMICAS3",797,0)
 ;@stanza 2 create background form
"RTN","SAMICAS3",798,0)
 ;
"RTN","SAMICAS3",799,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",800,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",801,0)
 quit:+sien=0
"RTN","SAMICAS3",802,0)
 new cdate set cdate=$piece(key,"bxform-",2)
"RTN","SAMICAS3",803,0)
 ;
"RTN","SAMICAS3",804,0)
 ; nodule copy
"RTN","SAMICAS3",805,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",806,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",807,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",808,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",809,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",810,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",811,0)
 . quit
"RTN","SAMICAS3",812,0)
 ; end nodule copy
"RTN","SAMICAS3",813,0)
 ;
"RTN","SAMICAS3",814,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",815,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",816,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",817,0)
 ;
"RTN","SAMICAS3",818,0)
 ;
"RTN","SAMICAS3",819,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",820,0)
 ;
"RTN","SAMICAS3",821,0)
 quit  ; end of MKBXFORM
"RTN","SAMICAS3",822,0)
 ;
"RTN","SAMICAS3",823,0)
 ;
"RTN","SAMICAS3",824,0)
 ;
"RTN","SAMICAS3",825,0)
CASETBL(ary) ; generates case review table
"RTN","SAMICAS3",826,0)
 ;
"RTN","SAMICAS3",827,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",828,0)
 ;
"RTN","SAMICAS3",829,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",830,0)
 ;@called by none
"RTN","SAMICAS3",831,0)
 ;@calls
"RTN","SAMICAS3",832,0)
 ;@input
"RTN","SAMICAS3",833,0)
 ; ary = name of array (passed by name, will be cleared)
"RTN","SAMICAS3",834,0)
 ;@output
"RTN","SAMICAS3",835,0)
 ; @ary
"RTN","SAMICAS3",836,0)
 ;@tests
"RTN","SAMICAS3",837,0)
 ; SAMIUTS2
"RTN","SAMICAS3",838,0)
 ;
"RTN","SAMICAS3",839,0)
 ;
"RTN","SAMICAS3",840,0)
 ;@stanza 2 build table
"RTN","SAMICAS3",841,0)
 ;
"RTN","SAMICAS3",842,0)
 kill @ary
"RTN","SAMICAS3",843,0)
 ;
"RTN","SAMICAS3",844,0)
 set @ary@("siform","form")="siform"
"RTN","SAMICAS3",845,0)
 set @ary@("siform","js")="subPr"
"RTN","SAMICAS3",846,0)
 set @ary@("siform","name")="Intake"
"RTN","SAMICAS3",847,0)
 set @ary@("siform","image")="preview.gif"
"RTN","SAMICAS3",848,0)
 ;
"RTN","SAMICAS3",849,0)
 set @ary@("nuform","form")="nuform"
"RTN","SAMICAS3",850,0)
 set @ary@("nuform","js")="subFr"
"RTN","SAMICAS3",851,0)
 set @ary@("nuform","name")="New Form"
"RTN","SAMICAS3",852,0)
 set @ary@("nuform","image")="nform.gif"
"RTN","SAMICAS3",853,0)
 ;
"RTN","SAMICAS3",854,0)
 set @ary@("sched","form")="sched"
"RTN","SAMICAS3",855,0)
 set @ary@("sched","js")="subSc"
"RTN","SAMICAS3",856,0)
 set @ary@("sched","name")="Schedule"
"RTN","SAMICAS3",857,0)
 set @ary@("sched","image")="schedule.gif"
"RTN","SAMICAS3",858,0)
 ;
"RTN","SAMICAS3",859,0)
 set @ary@("sbform","form")="sbform"
"RTN","SAMICAS3",860,0)
 set @ary@("sbform","js")="subPr"
"RTN","SAMICAS3",861,0)
 set @ary@("sbform","name")="Background"
"RTN","SAMICAS3",862,0)
 set @ary@("sbform","image")="preview.gif"
"RTN","SAMICAS3",863,0)
 ;
"RTN","SAMICAS3",864,0)
 set @ary@("ceform","form")="ceform"
"RTN","SAMICAS3",865,0)
 set @ary@("ceform","js")="subPr"
"RTN","SAMICAS3",866,0)
 set @ary@("ceform","name")="CT Evaluation"
"RTN","SAMICAS3",867,0)
 set @ary@("ceform","image")="preview.gif"
"RTN","SAMICAS3",868,0)
 ;
"RTN","SAMICAS3",869,0)
 set @ary@("report","form")="report"
"RTN","SAMICAS3",870,0)
 set @ary@("report","js")="subRp"
"RTN","SAMICAS3",871,0)
 set @ary@("report","name")="Report"
"RTN","SAMICAS3",872,0)
 set @ary@("report","image")="report.gif"
"RTN","SAMICAS3",873,0)
 ;
"RTN","SAMICAS3",874,0)
 set @ary@("ptform","form")="ptform"
"RTN","SAMICAS3",875,0)
 set @ary@("ptform","js")="subPr"
"RTN","SAMICAS3",876,0)
 set @ary@("ptform","name")="PET Evaluation"
"RTN","SAMICAS3",877,0)
 set @ary@("ptform","image")="preview.gif"
"RTN","SAMICAS3",878,0)
 ;
"RTN","SAMICAS3",879,0)
 set @ary@("bxform","form")="bxform"
"RTN","SAMICAS3",880,0)
 set @ary@("bxform","js")="subPr"
"RTN","SAMICAS3",881,0)
 set @ary@("bxform","name")="Biopsy"
"RTN","SAMICAS3",882,0)
 set @ary@("bxform","image")="preview.gif"
"RTN","SAMICAS3",883,0)
 ;
"RTN","SAMICAS3",884,0)
 set @ary@("rbform","form")="rbform"
"RTN","SAMICAS3",885,0)
 set @ary@("rbform","js")="subPr"
"RTN","SAMICAS3",886,0)
 set @ary@("rbform","name")="Intervention"
"RTN","SAMICAS3",887,0)
 set @ary@("rbform","image")="preview.gif"
"RTN","SAMICAS3",888,0)
 ;
"RTN","SAMICAS3",889,0)
 set @ary@("ceform","form")="ceform"
"RTN","SAMICAS3",890,0)
 set @ary@("ceform","js")="subPr"
"RTN","SAMICAS3",891,0)
 set @ary@("ceform","name")="CT Evaluation"
"RTN","SAMICAS3",892,0)
 set @ary@("ceform","image")="preview.gif"
"RTN","SAMICAS3",893,0)
 ;
"RTN","SAMICAS3",894,0)
 ;
"RTN","SAMICAS3",895,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",896,0)
 ;
"RTN","SAMICAS3",897,0)
 quit  ; end of CASETBL
"RTN","SAMICAS3",898,0)
 ;
"RTN","SAMICAS3",899,0)
 ;
"RTN","SAMICAS3",900,0)
 ;
"RTN","SAMICAS3",901,0)
EOR ; end of routine SAMICAS3
"RTN","SAMICUL")
0^2^B136079
"RTN","SAMICUL",1,0)
SAMICUL ;ven/gpl - case review log ;2021-10-29t02:24z
"RTN","SAMICUL",2,0)
 ;;18.0;SAMI;**9,11,12,14,15**;2020-01;Build 1
"RTN","SAMICUL",3,0)
 ;;18.15
"RTN","SAMICUL",4,0)
 ;
"RTN","SAMICUL",5,0)
 ; SAMICUL contains the development log for the VAPALS-IELCAP Case
"RTN","SAMICUL",6,0)
 ; Review Page (SAMICA* routines).
"RTN","SAMICUL",7,0)
 ; It contains no executable code.
"RTN","SAMICUL",8,0)
 ;
"RTN","SAMICUL",9,0)
 quit  ; no entry from top
"RTN","SAMICUL",10,0)
 ;
"RTN","SAMICUL",11,0)
 ;
"RTN","SAMICUL",12,0)
 ;
"RTN","SAMICUL",13,0)
 ;@section 0 primary development
"RTN","SAMICUL",14,0)
 ;
"RTN","SAMICUL",15,0)
 ;
"RTN","SAMICUL",16,0)
 ;
"RTN","SAMICUL",17,0)
 ;@routine-credits
"RTN","SAMICUL",18,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMICUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICUL",20,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMICUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMICUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMICUL",23,0)
 ;@license see routine SAMIUL
"RTN","SAMICUL",24,0)
 ;
"RTN","SAMICUL",25,0)
 ;@last-update 2021-10-29t02:24z
"RTN","SAMICUL",26,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMICUL",27,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMICUL",28,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMICUL",29,0)
 ;@version 18.15
"RTN","SAMICUL",30,0)
 ;@release-date 2020-01
"RTN","SAMICUL",31,0)
 ;@patch-list **9,11,12,14,15**
"RTN","SAMICUL",32,0)
 ;
"RTN","SAMICUL",33,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMICUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMICUL",35,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMICUL",36,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMICUL",37,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMICUL",38,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMICUL",39,0)
 ;@dev-add Domenick DiNatale (ddn)
"RTN","SAMICUL",40,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMICUL",41,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMICUL",42,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICUL",43,0)
 ;
"RTN","SAMICUL",44,0)
 ;@module-credits
"RTN","SAMICUL",45,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICUL",46,0)
 ; (VA-PALS)
"RTN","SAMICUL",47,0)
 ; http://va-pals.org/
"RTN","SAMICUL",48,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICUL",49,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICUL",50,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICUL",51,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICUL",52,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMICUL",53,0)
 ; http://ielcap.com/
"RTN","SAMICUL",54,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICUL",55,0)
 ; http://paraxialtech.com/
"RTN","SAMICUL",56,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICUL",57,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICUL",58,0)
 ;
"RTN","SAMICUL",59,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICUL",60,0)
 ;
"RTN","SAMICUL",61,0)
 ; 2018-01-14 ven/gpl 18.0-t4
"RTN","SAMICUL",62,0)
 ;  SAMICASE split from routine SAMIFRM, incl wsCASE,GETTMPL,GETITEMS,
"RTN","SAMICUL",63,0)
 ; casetbl.
"RTN","SAMICUL",64,0)
 ;
"RTN","SAMICUL",65,0)
 ; 2018-02-05/08 ven/toad 18.0-t4
"RTN","SAMICUL",66,0)
 ;  SAMICASE update style, license, & attribution, spell out language
"RTN","SAMICUL",67,0)
 ; elements, add white space & do-dot quits, r/replaceAll^%wfhfrom w/
"RTN","SAMICUL",68,0)
 ; replaceAll^%wf, r/$$getTemplate^%wfhform w/$$getTemplate^%wf.
"RTN","SAMICUL",69,0)
 ;
"RTN","SAMICUL",70,0)
 ; 2018-02-14 ven/toad 18.0-t4
"RTN","SAMICUL",71,0)
 ;  SAMICASE r/replaceAll^%wf w/findReplaceAll^%wf, r/ln w/line, add
"RTN","SAMICUL",72,0)
 ; @calls & @called-by tags, break up some long lines.
"RTN","SAMICUL",73,0)
 ;
"RTN","SAMICUL",74,0)
 ; 2018-02-27 ven/gpl 18.0-t4
"RTN","SAMICUL",75,0)
 ;  SAMICASE new subroutines $$KEY2DSPD, $$GETDTKEY; in wsCASE get
"RTN","SAMICUL",76,0)
 ; 1st & last names from graph, fix paths, key forms in graph w/date.
"RTN","SAMICUL",77,0)
 ;
"RTN","SAMICUL",78,0)
 ; 2018-03-01 ven/toad 18.0-t4
"RTN","SAMICUL",79,0)
 ;  SAMICASE refactor & reorganize new code, add header comments, r/
"RTN","SAMICUL",80,0)
 ; findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",81,0)
 ;
"RTN","SAMICUL",82,0)
 ; 2018-03-06 ven/gpl 18.0-t4
"RTN","SAMICUL",83,0)
 ;  SAMICASE add New Form button, list rest of forms for patient, add
"RTN","SAMICUL",84,0)
 ; web services wsNuForm & wsNuFormPost & method MKCEFORM, extend
"RTN","SAMICUL",85,0)
 ; GETITEMS to get rest of forms.
"RTN","SAMICUL",86,0)
 ;
"RTN","SAMICUL",87,0)
 ; 2018-03-07/08 ven/toad 18.0-t4
"RTN","SAMICUL",88,0)
 ;  SAMICASE merge George changes w/ rest, add white space, spell out
"RTN","SAMICUL",89,0)
 ; M elements, add hdr comments to new subroutines, r/findReplace^%wf
"RTN","SAMICUL",90,0)
 ; & replaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",91,0)
 ;
"RTN","SAMICUL",92,0)
 ; 2018-03-11 ven/gpl 18.0-t4 9bd663ee
"RTN","SAMICUL",93,0)
 ;  SAMICAS2 vapals forms working.
"RTN","SAMICUL",94,0)
 ;
"RTN","SAMICUL",95,0)
 ; 2018-03-12 ven/gpl 18.0-t4 8c36c6a7
"RTN","SAMICUL",96,0)
 ;  SAMICAS2 new form works now & charts on home page.
"RTN","SAMICUL",97,0)
 ;
"RTN","SAMICUL",98,0)
 ; 2018-03-14 ven/gpl 18.0-t4 9653650a
"RTN","SAMICUL",99,0)
 ;  SAMICAS2 revised casereview page link, fixed external url
"RTN","SAMICUL",100,0)
 ; preservation.
"RTN","SAMICUL",101,0)
 ;
"RTN","SAMICUL",102,0)
 ; 2018-03-21 ven/gpl 18.0-t4 48868561
"RTN","SAMICUL",103,0)
 ;  SAMICAS2 max date insertion, case review navigation changed to
"RTN","SAMICUL",104,0)
 ; post, date order for CT Eval in case review.
"RTN","SAMICUL",105,0)
 ;
"RTN","SAMICUL",106,0)
 ; 2018-03-26 ven/gpl 18.0-t4 5fa4ee96
"RTN","SAMICUL",107,0)
 ;  SAMICAS2 changes to support incomplete forms display &
"RTN","SAMICUL",108,0)
 ; processing.
"RTN","SAMICUL",109,0)
 ;
"RTN","SAMICUL",110,0)
 ; 2018-03-27 ven/gpl 18.0-t4 cace9756
"RTN","SAMICUL",111,0)
 ;  SAMICAS2 siforms are always complete.
"RTN","SAMICUL",112,0)
 ;
"RTN","SAMICUL",113,0)
 ; 2018-04-02 ven/gpl 18.0-t4 00da9146
"RTN","SAMICUL",114,0)
 ;  SAMICAS2 added followup form.
"RTN","SAMICUL",115,0)
 ;
"RTN","SAMICUL",116,0)
 ; 2018-04-24 ven/gpl 18.0-t4 22e39d87
"RTN","SAMICUL",117,0)
 ;  SAMICAS2 added pet & biopsy forms.
"RTN","SAMICUL",118,0)
 ;
"RTN","SAMICUL",119,0)
 ; 2018-05-01 ven/gpl 18.0-t4 f1751c43
"RTN","SAMICUL",120,0)
 ;  SAMICAS2 fix problem with new forms: followup & pet.
"RTN","SAMICUL",121,0)
 ;
"RTN","SAMICUL",122,0)
 ; 2018-05-18 ven/lgc 18.0-t4 9eba8f8c
"RTN","SAMICUL",123,0)
 ;  SAMICAS2 conversion to new graph and simplified forms processing.
"RTN","SAMICUL",124,0)
 ;
"RTN","SAMICUL",125,0)
 ; 2018-05-21 ven/lgc 18.0-t4 0d7ed2f7
"RTN","SAMICUL",126,0)
 ;  SAMICAS2 changes for new navigation html.
"RTN","SAMICUL",127,0)
 ;
"RTN","SAMICUL",128,0)
 ; 2018-06-14 ven/lgc 18.0-t4 d71f4fe4
"RTN","SAMICUL",129,0)
 ;  SAMICAS2 changes to make the background form optional.
"RTN","SAMICUL",130,0)
 ;
"RTN","SAMICUL",131,0)
 ; 2018-06-20 ven/lgc 18.0-t4 bf03b07f
"RTN","SAMICUL",132,0)
 ;  SAMICAS2 corrections for new forms processing navigation.
"RTN","SAMICUL",133,0)
 ;
"RTN","SAMICUL",134,0)
 ; 2018-07-01 ven/lgc 18.0-t4 2e1541dc,8b0a4329
"RTN","SAMICUL",135,0)
 ;  SAMICAS2 add intervention forms to case review page, 1st version
"RTN","SAMICUL",136,0)
 ; of ct eval report.
"RTN","SAMICUL",137,0)
 ;
"RTN","SAMICUL",138,0)
 ; 2018-07-04 ven/lgc 18.0-t4 b28c1658
"RTN","SAMICUL",139,0)
 ;  SAMICAS2 fix a typo.
"RTN","SAMICUL",140,0)
 ;
"RTN","SAMICUL",141,0)
 ; 2018-07-10 ven/lgc 18.0-t4 2e9662b4
"RTN","SAMICUL",142,0)
 ;  SAMICAS2 repair SAMIHOM3 & redact report link.
"RTN","SAMICUL",143,0)
 ;
"RTN","SAMICUL",144,0)
 ; 2018-08-19 ven/lgc 18.0-t4 2ce0cab4
"RTN","SAMICUL",145,0)
 ;  SAMICAS2 use ssn instead of last5 where available.
"RTN","SAMICUL",146,0)
 ;
"RTN","SAMICUL",147,0)
 ; 2018-08-20 ven/lgc 18.0-t4 955fd484
"RTN","SAMICUL",148,0)
 ;  SAMICAS2 fix case review page cr lf issue.
"RTN","SAMICUL",149,0)
 ;
"RTN","SAMICUL",150,0)
 ; 2018-08-22 ven/gpl 18.0-t4 d67a2fe5
"RTN","SAMICUL",151,0)
 ;  SAMICAS2 turn off ctreport.
"RTN","SAMICUL",152,0)
 ;
"RTN","SAMICUL",153,0)
 ; 2018-08-30 ven/lgc 18.0-t4 125f1c8b
"RTN","SAMICUL",154,0)
 ;  SAMICAS2 add type index to getItems to help find last previous
"RTN","SAMICUL",155,0)
 ; form of a type.
"RTN","SAMICUL",156,0)
 ;
"RTN","SAMICUL",157,0)
 ; 2018-09-04 ven/lgc 18.0-t4 3e6e326f
"RTN","SAMICUL",158,0)
 ;  SAMICAS2 hide report link.
"RTN","SAMICUL",159,0)
 ;
"RTN","SAMICUL",160,0)
 ; 2018-10-14 ven/lgc 18.0-t4 f6e1229f
"RTN","SAMICUL",161,0)
 ;  SAMICAS2 turn on copy forward for cteval new forms.
"RTN","SAMICUL",162,0)
 ;
"RTN","SAMICUL",163,0)
 ; 2018-10-26 ven/lgc 18.0-t4 f19bf1ae
"RTN","SAMICUL",164,0)
 ;  SAMICAS2 ability to add multiple forms on same day.
"RTN","SAMICUL",165,0)
 ;
"RTN","SAMICUL",166,0)
 ; 2018-11-07 ven/gpl 18.0-t4 c76b2eac
"RTN","SAMICUL",167,0)
 ;  SAMICAS2 defend against unit test patient 1.
"RTN","SAMICUL",168,0)
 ;
"RTN","SAMICUL",169,0)
 ; 2018-11-13 ven/toad 18.0-t4
"RTN","SAMICUL",170,0)
 ;  SAMICAS2 SAMIHOM2 > SAMIHOM3.
"RTN","SAMICUL",171,0)
 ;
"RTN","SAMICUL",172,0)
 ; 2018-11-14 ven/lgc 18.0-t4 6e9799ba
"RTN","SAMICUL",173,0)
 ;  SAMICUL fix graphstore forms.
"RTN","SAMICUL",174,0)
 ;
"RTN","SAMICUL",175,0)
 ; 2018-11-28 ven/lgc 18.0-t4 a9539464
"RTN","SAMICUL",176,0)
 ;  SAMICAS2 work on sac compliance.
"RTN","SAMICUL",177,0)
 ;
"RTN","SAMICUL",178,0)
 ; 2018-12-11 ven/lgc 18.0-t4 3ceb74b5
"RTN","SAMICUL",179,0)
 ;  SAMICAS2 update for sac compliance.
"RTN","SAMICUL",180,0)
 ;
"RTN","SAMICUL",181,0)
 ; 2018-12-19/20 ven/lgc 18.0-t4 7a5d3400,a14554c1
"RTN","SAMICUL",182,0)
 ;  SAMICAS2 more sac compliance, r/^gpl w/^SAMIGPL.
"RTN","SAMICUL",183,0)
 ;
"RTN","SAMICUL",184,0)
 ; 2018-12-26 ven/lgc 18.0-t4 8dd6f34d,51eb1635
"RTN","SAMICUL",185,0)
 ;  SAMICAS2 update for sac compliance, fix accidental reversions.
"RTN","SAMICUL",186,0)
 ;
"RTN","SAMICUL",187,0)
 ; 2019-01-10 ven/lgc 18.0-t4 2daba010
"RTN","SAMICUL",188,0)
 ;  SAMICAS2 update for SAC compliance.
"RTN","SAMICUL",189,0)
 ;
"RTN","SAMICUL",190,0)
 ; 2019-01-22 ven/lgc 18.0-t4 53681219,5ddb29c5
"RTN","SAMICUL",191,0)
 ;  SAMICAS2 add license info to each SAMI routine; edit for lower
"RTN","SAMICUL",192,0)
 ; case initials.
"RTN","SAMICUL",193,0)
 ;
"RTN","SAMICUL",194,0)
 ; 2019-02-18 ven/lgc 18.0-t4 76874314
"RTN","SAMICUL",195,0)
 ;  SAMICAS2,SAMICAS3 update recently edited routines.
"RTN","SAMICUL",196,0)
 ;
"RTN","SAMICUL",197,0)
 ; 2019-03-13 ven/lmry 18.0-t4 ef66ef16
"RTN","SAMICUL",198,0)
 ;  SAMICAS2 spell out some elements missed earlier.
"RTN","SAMICUL",199,0)
 ;
"RTN","SAMICUL",200,0)
 ; 2019-03-14 ven/lmry 18.0-t4 038507e2
"RTN","SAMICUL",201,0)
 ;  SAMICAS3 spell out some missed M elements, fix copy/paste errors
"RTN","SAMICUL",202,0)
 ; in comments for MKFUFORM, MKBXFORM, & MKPTFORM.
"RTN","SAMICUL",203,0)
 ;
"RTN","SAMICUL",204,0)
 ; 2019-04-16 ven/lgc 18.0-t4 e54b76d1
"RTN","SAMICUL",205,0)
 ;  SAMICAS2 update for SAMIFORM project.
"RTN","SAMICUL",206,0)
 ;
"RTN","SAMICUL",207,0)
 ; 2019-04-23 ven/gpl 18.0-t4 ce322911
"RTN","SAMICUL",208,0)
 ;  SAMICAS2 add intake notes to case review page.
"RTN","SAMICUL",209,0)
 ;
"RTN","SAMICUL",210,0)
 ; 2019-06-18 ven/lgc 18.0-t4 91022482
"RTN","SAMICUL",211,0)
 ;  SAMICAS3 switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMICUL",212,0)
 ;
"RTN","SAMICUL",213,0)
 ; 2019-07-01 ven/gpl 18.0-t4 cc87cc44
"RTN","SAMICUL",214,0)
 ;  SAMICAS3 prevent >1 bkgd form/patient.
"RTN","SAMICUL",215,0)
 ;
"RTN","SAMICUL",216,0)
 ; 2019-07-07 ven/gpl 18.0-t4 776f7451
"RTN","SAMICUL",217,0)
 ;  SAMICAS3 resolving can't create bkgd form, branch messed up.
"RTN","SAMICUL",218,0)
 ;
"RTN","SAMICUL",219,0)
 ; 2019-08-01 ven/lgc 18.0-t4 d710f27d
"RTN","SAMICUL",220,0)
 ;  SAMICAS2 pull displayed facility code from Vista parameter.
"RTN","SAMICUL",221,0)
 ;
"RTN","SAMICUL",222,0)
 ; 2019-09-26 ven/gpl 18.0-t4 92b12324 vap-420
"RTN","SAMICUL",223,0)
 ;  SAMICAS3 prefill form date & date of baseline ct on new followup
"RTN","SAMICUL",224,0)
 ; form.
"RTN","SAMICUL",225,0)
 ;
"RTN","SAMICUL",226,0)
 ; 2019-10-01 par/ddn 18.0-t4 4caf1a98 vap-344
"RTN","SAMICUL",227,0)
 ;  SAMICAS2 use proper capitalization of the word "veteran".
"RTN","SAMICUL",228,0)
 ;
"RTN","SAMICUL",229,0)
 ; 2020-01-11 ven/lgc 18.1 5651698a
"RTN","SAMICUL",230,0)
 ;  SAMICAS2,SAMICAS3 fix duplicate form overwriting.
"RTN","SAMICUL",231,0)
 ;
"RTN","SAMICUL",232,0)
 ; 2020-01-17 ven/lgc 18.1 8557207f
"RTN","SAMICUL",233,0)
 ;  SAMICAS2 followup note.
"RTN","SAMICUL",234,0)
 ;
"RTN","SAMICUL",235,0)
 ; 2020-01-25 ven/lgc 18.3 6a07a860,6a947567
"RTN","SAMICUL",236,0)
 ;  SAMICAS3 nodule copy & fix to ru, fix subtle bug in nodule copy.
"RTN","SAMICUL",237,0)
 ;
"RTN","SAMICUL",238,0)
 ; 2020-04-11 ven/gpl 18.5 666f5b91,2f2c29c1
"RTN","SAMICUL",239,0)
 ;  SAMICAS2 multi-tenancy.
"RTN","SAMICUL",240,0)
 ;
"RTN","SAMICUL",241,0)
 ; 2020-05-12 ven/gpl 18.5 ad11e0ea
"RTN","SAMICUL",242,0)
 ;  SAMICAS2 fix SITE on case review page.
"RTN","SAMICUL",243,0)
 ;
"RTN","SAMICUL",244,0)
 ; 2020-11-12 ven/gpl 18.9 cec1ccd6
"RTN","SAMICUL",245,0)
 ;  SAMICAS2,SAMICAS3 ceform date refill upgrade.
"RTN","SAMICUL",246,0)
 ;
"RTN","SAMICUL",247,0)
 ; 2020-11-13 ven/gpl 18.9 dce3c568
"RTN","SAMICUL",248,0)
 ;  SAMICAS3 prefill ceform prior scans text field.
"RTN","SAMICUL",249,0)
 ;
"RTN","SAMICUL",250,0)
 ; 2021-02-18 ven/gpl 18.9 af2a0b8a
"RTN","SAMICUL",251,0)
 ;  SAMICAS3 copy last previous CT nodules instead of last nodules in
"RTN","SAMICUL",252,0)
 ; any form.
"RTN","SAMICUL",253,0)
 ;
"RTN","SAMICUL",254,0)
 ; 2021-02-21 ven/gpl 18.9 3fd704fb
"RTN","SAMICUL",255,0)
 ;  SAMICAS3 fix bug in prefill logic.
"RTN","SAMICUL",256,0)
 ;
"RTN","SAMICUL",257,0)
 ; 2021-03-02 ven/gpl 18.9 479dc041
"RTN","SAMICUL",258,0)
 ;  SAMICAS2 return error msg if no CT Eval form exists when
"RTN","SAMICUL",259,0)
 ; generating a FU note.
"RTN","SAMICUL",260,0)
 ;
"RTN","SAMICUL",261,0)
 ; 2021-03-10 ven/toad 18.9 a46a2cc1
"RTN","SAMICUL",262,0)
 ;  SAMICUL update log, convert to new vistaver schema.
"RTN","SAMICUL",263,0)
 ;  SAMICAS2,SAMICAS3 bump date & patch list, update contents, lt
"RTN","SAMICUL",264,0)
 ; refactor.
"RTN","SAMICUL",265,0)
 ;
"RTN","SAMICUL",266,0)
 ; 2021-03-17 ven/toad 18.9 62da30b
"RTN","SAMICUL",267,0)
 ;  SAMICAS2 fix xindex errors: in WSCASE add missing space between
"RTN","SAMICUL",268,0)
 ; do & comment to prevent syntax error reported as block mismatch.
"RTN","SAMICUL",269,0)
 ;  SAMICAS3 remove extra spaces at ends of 3 lines.
"RTN","SAMICUL",270,0)
 ;
"RTN","SAMICUL",271,0)
 ; 2021-04-16 ven/gpl 18.11 ac82eec
"RTN","SAMICUL",272,0)
 ;  SAMICAS3 include baseline scan in prior scans field on prefill.
"RTN","SAMICUL",273,0)
 ;
"RTN","SAMICUL",274,0)
 ; 2021-05-14/19 ven/gpl 18.11 0cbee7b,a21b056,139c6a5,0a0cccc
"RTN","SAMICUL",275,0)
 ;  SAMICAS3 improved CT eval prefill of past scan dates, urgent
"RTN","SAMICUL",276,0)
 ; fixes to CT Report & intervention & pet form prefill.
"RTN","SAMICUL",277,0)
 ;
"RTN","SAMICUL",278,0)
 ; 2021-05-20/21 ven/mcglk&toad 18.11 43a4557,424ea11,129e96b
"RTN","SAMICUL",279,0)
 ;  SAMICAS3 bump version & dates.
"RTN","SAMICUL",280,0)
 ;
"RTN","SAMICUL",281,0)
 ; 2021-05-24 ven/gpl 18.11 4aba1a9
"RTN","SAMICUL",282,0)
 ;  SAMICAS3 in MKCEFORM,MKPTFORM,MKBXFORM pass key to
"RTN","SAMICUL",283,0)
 ; CTCOPY^SAMICTC1 to modulate node-copy operation; critical fix to
"RTN","SAMICUL",284,0)
 ; copy forward for is it new field for new ct eval forms.
"RTN","SAMICUL",285,0)
 ;
"RTN","SAMICUL",286,0)
 ; 2021-05-25 ven/toad 18.11 801d7c74
"RTN","SAMICUL",287,0)
 ;  SAMICAS3 bump date; passim lt refactor.
"RTN","SAMICUL",288,0)
 ;
"RTN","SAMICUL",289,0)
 ; 2021-05-26/27 ven/gpl 18.11 6edc0610,73728821
"RTN","SAMICUL",290,0)
 ;  SAMICAS3 in MKITFORM add new nodule-copy block to copy forward
"RTN","SAMICUL",291,0)
 ; for intervention form; in LASTCMP,PRIORCMP init tdt to today to
"RTN","SAMICUL",292,0)
 ; start before today, to fix last comp & prior scan field prefill in
"RTN","SAMICUL",293,0)
 ; ct eval form.
"RTN","SAMICUL",294,0)
 ;
"RTN","SAMICUL",295,0)
 ; 2021-06-01 ven/toad 18.11 7dd9410c
"RTN","SAMICUL",296,0)
 ;  SAMICAS3 fold in gpl chgs fr 2021-05-26/27, annotate, adjust news
"RTN","SAMICUL",297,0)
 ; in nodule copy blocks, bump date.
"RTN","SAMICUL",298,0)
 ;
"RTN","SAMICUL",299,0)
 ; 2021-06-29 ven/gpl 18.12 50d3998b,a5bbd37a
"RTN","SAMICUL",300,0)
 ;  SAMICAS3 in LASTCMP fix bug that excluded ct forms from today in
"RTN","SAMICUL",301,0)
 ; date list, init tdt to today+1 to start today; text-box formatting
"RTN","SAMICUL",302,0)
 ; for intake & followup notes, new text-processing utils; in MKFUFORM
"RTN","SAMICUL",303,0)
 ; set basedt to $$BASELNDT or $$LASTCMP or now.
"RTN","SAMICUL",304,0)
 ;
"RTN","SAMICUL",305,0)
 ; 2021-06-30/07-06 ven/mcglk&toad&gpl 18.12 cbf7e46b,d8296fda,
"RTN","SAMICUL",306,0)
 ; b248664b
"RTN","SAMICUL",307,0)
 ;  SAMICASE,2,3 bump version & dates.
"RTN","SAMICUL",308,0)
 ;  SAMICAS3 in MKFUFORM,LASTCMP update calls & called-by.
"RTN","SAMICUL",309,0)
 ;  SAMICASE,2,3 finish converting to ppi format, annotate; fix typos.
"RTN","SAMICUL",310,0)
 ;
"RTN","SAMICUL",311,0)
 ; 2021-08-01 ven/gpl 18.12 5bd7c627,50620b8b
"RTN","SAMICUL",312,0)
 ;  SAMICAS2 set intake form to incomplete on creation: in GSAMISTA
"RTN","SAMICUL",313,0)
 ; add final line to conditionally set stat="incomplete".
"RTN","SAMICUL",314,0)
 ;  SAMICAS3 exclude current date from last compare field when prev ct
"RTN","SAMICUL",315,0)
 ; report exists: in LASTCMP start w/before today; in PRIORCMP add
"RTN","SAMICUL",316,0)
 ; line to handle retstr="".
"RTN","SAMICUL",317,0)
 ;
"RTN","SAMICUL",318,0)
 ; 2021-10-04/05 ven/gpl&lmry 18.14 ec3b6e5d,d4d1b115
"RTN","SAMICUL",319,0)
 ;  SAMICAS2 updated date format, bumped date and version.
"RTN","SAMICUL",320,0)
 ;
"RTN","SAMICUL",321,0)
 ; 2021-10-26 ven/gpl 18.15 23e68f40
"RTN","SAMICUL",322,0)
 ;  SAMICAS3 initialize last comparitive and prior scan fields to blank if
"RTN","SAMICUL",323,0)
 ;  there were none
"RTN","SAMICUL",324,0)
 ;
"RTN","SAMICUL",325,0)
 ;@contents
"RTN","SAMICUL",326,0)
 ; SAMICASE case review
"RTN","SAMICUL",327,0)
 ; SAMICAS2 case review continued
"RTN","SAMICUL",328,0)
 ; SAMICAS3 case review continued
"RTN","SAMICUL",329,0)
 ; SAMICUL case review log
"RTN","SAMICUL",330,0)
 ;
"RTN","SAMICUL",331,0)
 ;
"RTN","SAMICUL",332,0)
 ;
"RTN","SAMICUL",333,0)
EOR ; end of routine SAMICUL
"RTN","SAMIDCM1")
0^3^B109906029
"RTN","SAMIDCM1",1,0)
SAMIDCM1 ;ven/gpl - VAPALS PATIENT IMPORT FROM SIEMANS AI ; 2022-01-18t00:42z
"RTN","SAMIDCM1",2,0)
 ;;18.0;SAMI;**16**;2020-01;Build 1
"RTN","SAMIDCM1",3,0)
 ;18-16
"RTN","SAMIDCM1",4,0)
 ;
"RTN","SAMIDCM1",5,0)
 ;@license: see routine SAMIUL
"RTN","SAMIDCM1",6,0)
 ;
"RTN","SAMIDCM1",7,0)
 ;@section 0 primary development
"RTN","SAMIDCM1",8,0)
 ;
"RTN","SAMIDCM1",9,0)
 ;
"RTN","SAMIDCM1",10,0)
 ;
"RTN","SAMIDCM1",11,0)
 ;@routine-credits
"RTN","SAMIDCM1",12,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIDCM1",13,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIDCM1",14,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIDCM1",15,0)
 ; http://vistaexpertise.net
"RTN","SAMIDCM1",16,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIDCM1",17,0)
 ;@license see routine SAMIUL
"RTN","SAMIDCM1",18,0)
 ;
"RTN","SAMIDCM1",19,0)
 ;@last-update 2022-01-18t00:42z
"RTN","SAMIDCM1",20,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIDCM1",21,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIDCM1",22,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIDCM1",23,0)
 ;@version 18-16
"RTN","SAMIDCM1",24,0)
 ;@release-date 2020-01
"RTN","SAMIDCM1",25,0)
 ;@patch-list **16**
"RTN","SAMIDCM1",26,0)
 ;
"RTN","SAMIDCM1",27,0)
 ;
"RTN","SAMIDCM1",28,0)
 ;@module-credits
"RTN","SAMIDCM1",29,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIDCM1",30,0)
 ; (VA-PALS)
"RTN","SAMIDCM1",31,0)
 ; http://va-pals.org/
"RTN","SAMIDCM1",32,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIDCM1",33,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIDCM1",34,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIDCM1",35,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIDCM1",36,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIDCM1",37,0)
 ; http://ielcap.com/
"RTN","SAMIDCM1",38,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIDCM1",39,0)
 ; http://paraxialtech.com/
"RTN","SAMIDCM1",40,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIDCM1",41,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIDCM1",42,0)
 ;
"RTN","SAMIDCM1",43,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIDCM1",44,0)
 ;
"RTN","SAMIDCM1",45,0)
 ;
"RTN","SAMIDCM1",46,0)
 ;
"RTN","SAMIDCM1",47,0)
 ;
"RTN","SAMIDCM1",48,0)
 Q
"RTN","SAMIDCM1",49,0)
 ;
"RTN","SAMIDCM1",50,0)
WSDCMIN(ARGS,BODY,RESULT,ien)    ; recieve from addpatient
"RTN","SAMIDCM1",51,0)
 ;
"RTN","SAMIDCM1",52,0)
 s U="^"
"RTN","SAMIDCM1",53,0)
 ;S DUZ=1
"RTN","SAMIDCM1",54,0)
 ;S DUZ("AG")="V"
"RTN","SAMIDCM1",55,0)
 ;S DUZ(2)=500
"RTN","SAMIDCM1",56,0)
 ;N USER S USER=$$DUZ^SYNDHP69
"RTN","SAMIDCM1",57,0)
 ;
"RTN","SAMIDCM1",58,0)
 new json,root,gr,id,return
"RTN","SAMIDCM1",59,0)
 set root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",60,0)
 if $get(ien)="" do
"RTN","SAMIDCM1",61,0)
 . set ien=$order(@root@(" "),-1)+1
"RTN","SAMIDCM1",62,0)
 . set gr=$name(@root@(ien,"json"))
"RTN","SAMIDCM1",63,0)
 . do decode^%webjson("BODY",gr)
"RTN","SAMIDCM1",64,0)
 . kill BODY  ; 
"RTN","SAMIDCM1",65,0)
 ;
"RTN","SAMIDCM1",66,0)
 ;do indexFhir(ien)
"RTN","SAMIDCM1",67,0)
 ;
"RTN","SAMIDCM1",68,0)
 set site=$get(ARGS("siteid"))
"RTN","SAMIDCM1",69,0)
 if site="" set site="XXX" ; default to test site
"RTN","SAMIDCM1",70,0)
 if site'="" set @root@("SITE",site,ien)="" ;
"RTN","SAMIDCM1",71,0)
 ;
"RTN","SAMIDCM1",72,0)
 ; patient name
"RTN","SAMIDCM1",73,0)
 ;
"RTN","SAMIDCM1",74,0)
 ;
"RTN","SAMIDCM1",75,0)
 n gp s gp=$na(@root@(ien,"json","patient_study_details"))
"RTN","SAMIDCM1",76,0)
 i '$d(@gp) d  ;
"RTN","SAMIDCM1",77,0)
 . s gp=$na(@root@(ien,"patient_details"))
"RTN","SAMIDCM1",78,0)
 . q:$d(@gp)
"RTN","SAMIDCM1",79,0)
 . s gp=$na(@root@(ien,"json"))
"RTN","SAMIDCM1",80,0)
 . q:$d(@gp@("PatientName"))
"RTN","SAMIDCM1",81,0)
 . s return("error")="Missing patient study details"
"RTN","SAMIDCM1",82,0)
 ;
"RTN","SAMIDCM1",83,0)
 ;patient_study_details 
"RTN","SAMIDCM1",84,0)
 ;--Frame of Reference UID 1.3.6.1.4.1.14519.5.2.1.6279.6001.178796764874541005921876698858
"RTN","SAMIDCM1",85,0)
 ;--Manufacturer Siemens Healthineers
"RTN","SAMIDCM1",86,0)
 ;--Manufacturer's Model Name AIRC Research
"RTN","SAMIDCM1",87,0)
 ;--Patient ID LIDC-IDRI-0492
"RTN","SAMIDCM1",88,0)
 ;--Patient's Birth Date 
"RTN","SAMIDCM1",89,0)
 ;--\s 
"RTN","SAMIDCM1",90,0)
 ;--Patient's Name 
"RTN","SAMIDCM1",91,0)
 ;--\s 
"RTN","SAMIDCM1",92,0)
 ;--Patient's Sex F
"RTN","SAMIDCM1",93,0)
 ;--SOP Class UID 1.2.840.10008.5.1.4.1.1.88.34
"RTN","SAMIDCM1",94,0)
 ;--Series Description AIRC Research Structured Report
"RTN","SAMIDCM1",95,0)
 ;--Slice Thickness 1
"RTN","SAMIDCM1",96,0)
 ;--\n 1.0
"RTN","SAMIDCM1",97,0)
 ;--Study Date 20000101
"RTN","SAMIDCM1",98,0)
 ;--\s 
"RTN","SAMIDCM1",99,0)
 ;--Tracking Identifier L2
"RTN","SAMIDCM1",100,0)
 ;--Tracking Unique Identifier
"RTN","SAMIDCM1",101,0)
 ;
"RTN","SAMIDCM1",102,0)
 d  ; Extract Identifying information
"RTN","SAMIDCM1",103,0)
 . n vars
"RTN","SAMIDCM1",104,0)
 . n name s name=$g(@gp@("Patient's Name"))
"RTN","SAMIDCM1",105,0)
 . i name="" s name=$g(@gp@("PatientName"))
"RTN","SAMIDCM1",106,0)
 . i name="" s vars("name")=name
"RTN","SAMIDCM1",107,0)
 . e  s vars("name")=$$normaliz(name)
"RTN","SAMIDCM1",108,0)
 . n dob s dob=$g(@gp@("Patient's Birth Date"))
"RTN","SAMIDCM1",109,0)
 . i dob="" s dob=20000302
"RTN","SAMIDCM1",110,0)
 . s vars("dob")=dob
"RTN","SAMIDCM1",111,0)
 . n gender s gender=$g(@gp@("Patient's Sex"))
"RTN","SAMIDCM1",112,0)
 . i gender="" s gender="M"
"RTN","SAMIDCM1",113,0)
 . s vars("gender")=gender
"RTN","SAMIDCM1",114,0)
 . n patid s patid=$g(@gp@("Patient ID"))
"RTN","SAMIDCM1",115,0)
 . s vars("patid")=patid
"RTN","SAMIDCM1",116,0)
 . n studyDate s studyDate=$g(@gp@("Study Date"))
"RTN","SAMIDCM1",117,0)
 . i studyDate'="" s vars("studyDate")=studyDate
"RTN","SAMIDCM1",118,0)
 . n trackingIdentifier
"RTN","SAMIDCM1",119,0)
 . s trackingIdentifier=$g(@gp@("Tracking Identifier"))
"RTN","SAMIDCM1",120,0)
 . s vars("trackingIdentifier")=trackingIdentifier
"RTN","SAMIDCM1",121,0)
 . s vars("site")=site
"RTN","SAMIDCM1",122,0)
 . s vars("ssn")=999999999
"RTN","SAMIDCM1",123,0)
 . s vars("sistatus")="active"
"RTN","SAMIDCM1",124,0)
 . ;
"RTN","SAMIDCM1",125,0)
 . i '$$MATCH^SAMIDCM1(.vars) d CREATE^SAMIZPH1(.vars)
"RTN","SAMIDCM1",126,0)
 . m @root@(ien)=vars
"RTN","SAMIDCM1",127,0)
 . s name=$g(vars("name"))
"RTN","SAMIDCM1",128,0)
 . i name'="" s @root@("name",name,ien)=""
"RTN","SAMIDCM1",129,0)
 . n studyid s studyid=$g(vars("studyid"))
"RTN","SAMIDCM1",130,0)
 . i studyid'="" s @root@("studyid",studyid,ien)=""
"RTN","SAMIDCM1",131,0)
 . n dfn s dfn=$g(vars("dfn"))
"RTN","SAMIDCM1",132,0)
 . i dfn'="" s @root@("dfn",dfn,ien)=""
"RTN","SAMIDCM1",133,0)
 . i patid'="" s @root@("patid",patid,ien)=""
"RTN","SAMIDCM1",134,0)
 ;
"RTN","SAMIDCM1",135,0)
 ;
"RTN","SAMIDCM1",136,0)
 set return("status")="ok"
"RTN","SAMIDCM1",137,0)
 set return("siteid")=site
"RTN","SAMIDCM1",138,0)
 set return("ien")=ien
"RTN","SAMIDCM1",139,0)
 ;
"RTN","SAMIDCM1",140,0)
 if $get(ARGS("returngraph"))=1 do  ;
"RTN","SAMIDCM1",141,0)
 . merge return("graph")=@root@(ien)
"RTN","SAMIDCM1",142,0)
 ;
"RTN","SAMIDCM1",143,0)
 n jary
"RTN","SAMIDCM1",144,0)
 m jary("result")=return
"RTN","SAMIDCM1",145,0)
 d encode^%webjson("jary","RESULT")
"RTN","SAMIDCM1",146,0)
 s HTTPRSP("mime")="application/json"
"RTN","SAMIDCM1",147,0)
 ;
"RTN","SAMIDCM1",148,0)
 q
"RTN","SAMIDCM1",149,0)
 ;
"RTN","SAMIDCM1",150,0)
MATCH(vars) ; extrinsic which tries to match the message with an
"RTN","SAMIDCM1",151,0)
 ; existing record
"RTN","SAMIDCM1",152,0)
 ;
"RTN","SAMIDCM1",153,0)
 n lroot,proot,droot
"RTN","SAMIDCM1",154,0)
 s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",155,0)
 s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIDCM1",156,0)
 s droot=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",157,0)
 n found s found=0
"RTN","SAMIDCM1",158,0)
 n name s name=$$normaliz($g(vars("name")))
"RTN","SAMIDCM1",159,0)
 n patid s patid=$g(vars("patid"))
"RTN","SAMIDCM1",160,0)
 n dien,lien,pien
"RTN","SAMIDCM1",161,0)
 ; first look at the dcm-intake for name matches
"RTN","SAMIDCM1",162,0)
 s dien=$o(@droot@("name",name,""))
"RTN","SAMIDCM1",163,0)
 i dien'="" d  ; the name has been found locally
"RTN","SAMIDCM1",164,0)
 . s found=1
"RTN","SAMIDCM1",165,0)
 . n dfn,studyid
"RTN","SAMIDCM1",166,0)
 . s dfn=$g(@droot@(dien,"dfn"))
"RTN","SAMIDCM1",167,0)
 . i dfn'="" s vars("dfn")=dfn
"RTN","SAMIDCM1",168,0)
 . i dfn="" s found=0 q  ;
"RTN","SAMIDCM1",169,0)
 . s studyid=$g(@droot@(dien,"studyid"))
"RTN","SAMIDCM1",170,0)
 . i studyid="" s found=0 q  ;
"RTN","SAMIDCM1",171,0)
 . i studyid'="" s vars("studyid")=studyid
"RTN","SAMIDCM1",172,0)
 if found=1 q found
"RTN","SAMIDCM1",173,0)
 i dien="" d  ; not here, check patient-lookup
"RTN","SAMIDCM1",174,0)
 . s lien=$o(@lroot@("name",name,""))
"RTN","SAMIDCM1",175,0)
 . i lien="" s found=0 q  ;
"RTN","SAMIDCM1",176,0)
 . i lien'="" s found=1
"RTN","SAMIDCM1",177,0)
 . n dfn,studyid
"RTN","SAMIDCM1",178,0)
 . s dfn=$g(@lroot@(lien,"dfn"))
"RTN","SAMIDCM1",179,0)
 . s vars("dfn")=dfn
"RTN","SAMIDCM1",180,0)
 . i dfn="" s found=0 q  ;
"RTN","SAMIDCM1",181,0)
 . s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIDCM1",182,0)
 . d ENROLL^SAMIZPH1(.vars)
"RTN","SAMIDCM1",183,0)
 . s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIDCM1",184,0)
 . i pien="" s found=0 q  ;
"RTN","SAMIDCM1",185,0)
 . s studyid=$g(@proot@(pien,"studyid"))
"RTN","SAMIDCM1",186,0)
 . s vars("studyid")=studyid
"RTN","SAMIDCM1",187,0)
 . i studyid="" s found=0 q  ;
"RTN","SAMIDCM1",188,0)
 ;
"RTN","SAMIDCM1",189,0)
 Q found
"RTN","SAMIDCM1",190,0)
 ;
"RTN","SAMIDCM1",191,0)
normaliz(name) ; extrinsic which tries to normalize the name
"RTN","SAMIDCM1",192,0)
 ;
"RTN","SAMIDCM1",193,0)
 n znam s znam=name
"RTN","SAMIDCM1",194,0)
 i name["^" d  q znam  ;; if name has Dicom separator
"RTN","SAMIDCM1",195,0)
 . s znam=$tr(znam,"^",",")
"RTN","SAMIDCM1",196,0)
 i name'["," d  ; if no comma, then try a space
"RTN","SAMIDCM1",197,0)
 . i $l(name," ")>0 d  ;
"RTN","SAMIDCM1",198,0)
 . . n fnam,lnam
"RTN","SAMIDCM1",199,0)
 . . s fnam=$p(name," ",1)
"RTN","SAMIDCM1",200,0)
 . . s lnam=$p(name," ",$l(name," "))
"RTN","SAMIDCM1",201,0)
 . . s fnam=$p(name,lnam,1)
"RTN","SAMIDCM1",202,0)
 . . s znam=lnam_","_fnam
"RTN","SAMIDCM1",203,0)
 q znam
"RTN","SAMIDCM1",204,0)
 ;
"RTN","SAMIDCM1",205,0)
nxtdfn() ; next available dfn
"RTN","SAMIDCM1",206,0)
 ;
"RTN","SAMIDCM1",207,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",208,0)
 q $o(@root@("dfn"," "),-1)+1
"RTN","SAMIDCM1",209,0)
 ;
"RTN","SAMIDCM1",210,0)
getsid(name) ; return studyid
"RTN","SAMIDCM1",211,0)
 ;
"RTN","SAMIDCM1",212,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",213,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIDCM1",214,0)
 n lien s lien=$o(@root@("name",name,""))
"RTN","SAMIDCM1",215,0)
 n dfn s dfn=$g(@root@(lien,"dfn"))
"RTN","SAMIDCM1",216,0)
 n pien s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIDCM1",217,0)
 q:pien="" ""
"RTN","SAMIDCM1",218,0)
 q $g(@proot@(pien,"sisid"))
"RTN","SAMIDCM1",219,0)
 ;
"RTN","SAMIDCM1",220,0)
T1() ; TEST CREATE A JOHN DOE PATIENT
"RTN","SAMIDCM1",221,0)
 ;
"RTN","SAMIDCM1",222,0)
 D  ;
"RTN","SAMIDCM1",223,0)
 . n vars
"RTN","SAMIDCM1",224,0)
 . s vars("dob")=20000302
"RTN","SAMIDCM1",225,0)
 . s vars("gender")="M"
"RTN","SAMIDCM1",226,0)
 . n nxtdfn s nxtdfn=$$nxtdfn^SAMIDCM1()
"RTN","SAMIDCM1",227,0)
 . s vars("saminame")="DOE"_nxtdfn_",JOHN"
"RTN","SAMIDCM1",228,0)
 . s vars("name")=vars("saminame")
"RTN","SAMIDCM1",229,0)
 . s vars("site")="XXX"
"RTN","SAMIDCM1",230,0)
 . s vars("ssn")=999999999
"RTN","SAMIDCM1",231,0)
 . s vars("sistatus")="active"
"RTN","SAMIDCM1",232,0)
 . d CREATE^SAMIZPH1(.vars)
"RTN","SAMIDCM1",233,0)
 . ZWR vars
"RTN","SAMIDCM1",234,0)
 Q
"RTN","SAMIDCM1",235,0)
 ;
"RTN","SAMIDCM1",236,0)
IDXDCM(dien,ARY) ; index a dcm entry after patient record creation
"RTN","SAMIDCM1",237,0)
 ;
"RTN","SAMIDCM1",238,0)
 n droot s droot=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",239,0)
 i $d(ARY) m @droot@(dien)=ARY
"RTN","SAMIDCM1",240,0)
 d  ;
"RTN","SAMIDCM1",241,0)
 . n x
"RTN","SAMIDCM1",242,0)
 . s x=$g(@droot@(dien,"dfn"))
"RTN","SAMIDCM1",243,0)
 . if x'="" s @droot@("dfn",x,dien)=""
"RTN","SAMIDCM1",244,0)
 . s x=$g(@droot@(dien,"saminame"))
"RTN","SAMIDCM1",245,0)
 . i x="" s x=$g(@droot@(dien,"name"))
"RTN","SAMIDCM1",246,0)
 . i x'="" s @droot@("name",x,dien)=""
"RTN","SAMIDCM1",247,0)
 . s x=$g(@droot@(dien,"studyid"))
"RTN","SAMIDCM1",248,0)
 . i x="" s x=$g(@droot@(dien,"sid"))
"RTN","SAMIDCM1",249,0)
 . i x'="" s @droot@("sid",x,dien)=""
"RTN","SAMIDCM1",250,0)
 ;
"RTN","SAMIDCM1",251,0)
WSDCMQ(return,filter) ; web service which returns dcm json
"RTN","SAMIDCM1",252,0)
 n root s root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",253,0)
 n sid s sid=$g(filter("studyid"))
"RTN","SAMIDCM1",254,0)
 i sid="" s sid=$g(filter("sid"))
"RTN","SAMIDCM1",255,0)
 i sid="" q ""
"RTN","SAMIDCM1",256,0)
 n ien s ien=$o(@root@("studyid",sid,""))
"RTN","SAMIDCM1",257,0)
 i ien="" q ""
"RTN","SAMIDCM1",258,0)
 ;n ien s ien=$o(@root@(" "),-1)
"RTN","SAMIDCM1",259,0)
 ;
"RTN","SAMIDCM1",260,0)
 n jary,json
"RTN","SAMIDCM1",261,0)
 n cnt s cnt=0
"RTN","SAMIDCM1",262,0)
 s ien=""
"RTN","SAMIDCM1",263,0)
 f  s ien=$o(@root@("studyid",sid,ien)) q:ien=""  d  ;
"RTN","SAMIDCM1",264,0)
 . s cnt=cnt+1
"RTN","SAMIDCM1",265,0)
 . m jary("result",cnt)=@root@(ien,"json")
"RTN","SAMIDCM1",266,0)
 d encode^%webjson("jary","return")
"RTN","SAMIDCM1",267,0)
 q
"RTN","SAMIDCM1",268,0)
 ;
"RTN","SAMIDCM1",269,0)
WSDCMKIL(return,filter) ; kill all but the first entry in dcm-intake
"RTN","SAMIDCM1",270,0)
 ;
"RTN","SAMIDCM1",271,0)
 n lroot,proot,droot
"RTN","SAMIDCM1",272,0)
 n lien,pien,dien s (lien,pien,dien)=""
"RTN","SAMIDCM1",273,0)
 s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",274,0)
 s proot=$$setroot^%wd("vapals-patient")
"RTN","SAMIDCM1",275,0)
 s droot=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",276,0)
 n nam s nam="DOE"
"RTN","SAMIDCM1",277,0)
 f i="DOE","PATIENT" d  ;
"RTN","SAMIDCM1",278,0)
 . s nam=i
"RTN","SAMIDCM1",279,0)
 . f  s nam=$o(@lroot@("name",nam)) q:nam=""  q:nam'[i  d  ;
"RTN","SAMIDCM1",280,0)
 . . f  s lien=$o(@lroot@("name",nam,lien)) q:lien=""  d  ;
"RTN","SAMIDCM1",281,0)
 . . . ;w !,nam," ",lien
"RTN","SAMIDCM1",282,0)
 . . . d UNINDXPT^SAMIHOM4(lien)
"RTN","SAMIDCM1",283,0)
 . . . n newnam
"RTN","SAMIDCM1",284,0)
 . . . s newnam="ZZZ"_$e(nam,4,$l(nam))
"RTN","SAMIDCM1",285,0)
 . . . s @lroot@(lien,"saminame")=newnam
"RTN","SAMIDCM1",286,0)
 . . . s @lroot@(lien,"name")=newnam
"RTN","SAMIDCM1",287,0)
 . . . s @lroot@(lien,"fname")=$p(newnam,",",2)
"RTN","SAMIDCM1",288,0)
 . . . s @lroot@(lien,"lname")=$p(newnam,",",1)
"RTN","SAMIDCM1",289,0)
 . . . d INDXPTLK^SAMIHOM4(lien)
"RTN","SAMIDCM1",290,0)
 n atmp s atmp=@droot@(0)
"RTN","SAMIDCM1",291,0)
 k @droot
"RTN","SAMIDCM1",292,0)
 s @droot@(0)=atmp
"RTN","SAMIDCM1",293,0)
 ;i $d(^webbak(587)) d  ;
"RTN","SAMIDCM1",294,0)
 ;. m @droot=^webbak(587) ; restore default
"RTN","SAMIDCM1",295,0)
 i $d(^webbak(667)) d  ;
"RTN","SAMIDCM1",296,0)
 . m @droot=^webbak(667) ; restore default
"RTN","SAMIDCM1",297,0)
 . n sid,sidien
"RTN","SAMIDCM1",298,0)
 . ;f dfn="9000227"  d  ;
"RTN","SAMIDCM1",299,0)
 . f dfn="9000057","9000058" d  ;
"RTN","SAMIDCM1",300,0)
 . . s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIDCM1",301,0)
 . . q:lien=""
"RTN","SAMIDCM1",302,0)
 . . d UNINDXPT^SAMIHOM4(lien)
"RTN","SAMIDCM1",303,0)
 . . n newname
"RTN","SAMIDCM1",304,0)
 . . s newname="DOE"_dfn_",JOHN"
"RTN","SAMIDCM1",305,0)
 . . s @lroot@(lien,"name")=newname
"RTN","SAMIDCM1",306,0)
 . . s @lroot@(lien,"saminame")=newname
"RTN","SAMIDCM1",307,0)
 . . s @lroot@(lien,"fname")=$p(newname,",",2)
"RTN","SAMIDCM1",308,0)
 . . s @lroot@(lien,"lname")=$p(newname,",",1)
"RTN","SAMIDCM1",309,0)
 . . d INDXPTLK^SAMIHOM4(lien)
"RTN","SAMIDCM1",310,0)
 q
"RTN","SAMIDCM1",311,0)
 ;
"RTN","SAMIDCM1",312,0)
 ;n root s root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",313,0)
 ;n sid s sid=$g(@root@(1,"sid"))
"RTN","SAMIDCM1",314,0)
 ;i sid="" s sid="XXX0023"
"RTN","SAMIDCM1",315,0)
 ;n atmp m atmp=@root@(1)
"RTN","SAMIDCM1",316,0)
 ;d purgegraph^%wd("dcm-intake")
"RTN","SAMIDCM1",317,0)
 ;s root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",318,0)
 ;m @root@(1)=atmp
"RTN","SAMIDCM1",319,0)
 ;s @root@("sid",sid,1)=""
"RTN","SAMIDCM1",320,0)
 q
"RTN","SAMIDCM1",321,0)
 ;
"RTN","SAMIDCM1",322,0)
MKSVC() ; create the web services
"RTN","SAMIDCM1",323,0)
 ;
"RTN","SAMIDCM1",324,0)
 d deleteService^%webutils("POST","dcmimgin")
"RTN","SAMIDCM1",325,0)
 d addService^%webutils("POST","dcmimgin","WSDCMIN^SAMIDCM1")
"RTN","SAMIDCM1",326,0)
 ;
"RTN","SAMIDCM1",327,0)
 d deleteService^%webutils("POST","dcmin")
"RTN","SAMIDCM1",328,0)
 d addService^%webutils("POST","dcmin","WSDCMIN^SAMIDCM1")
"RTN","SAMIDCM1",329,0)
 ;
"RTN","SAMIDCM1",330,0)
 d deleteService^%webutils("GET","dcmquery")
"RTN","SAMIDCM1",331,0)
 d addService^%webutils("GET","dcmquery","WSDCMQ^SAMIDCM1")
"RTN","SAMIDCM1",332,0)
 ;
"RTN","SAMIDCM1",333,0)
 d deleteService^%webutils("GET","dcmreset")
"RTN","SAMIDCM1",334,0)
 d addService^%webutils("GET","dcmreset","WSDCMKIL^SAMIDCM1")
"RTN","SAMIDCM1",335,0)
 ;
"RTN","SAMIDCM1",336,0)
 Q
"RTN","SAMIDCM1",337,0)
 ;
"RTN","SAMIFLD")
0^4^B242399154
"RTN","SAMIFLD",1,0)
SAMIFLD ;ven/gpl - elcap: form load & case review ;2021-03-21T23:51Z
"RTN","SAMIFLD",2,0)
 ;;18.0;SAMI;**10**;2020-01;Build 1
"RTN","SAMIFLD",3,0)
 ;;1.18.0.10-i10
"RTN","SAMIFLD",4,0)
 ;
"RTN","SAMIFLD",5,0)
 ; SAMIFLD contains subroutines for processing ELCAP forms, loading
"RTN","SAMIFLD",6,0)
 ; JSON data into the graphstore for each line. Since three of those
"RTN","SAMIFLD",7,0)
 ; subroutines are also code for ppis called by WSCASE^SAMICASE, two
"RTN","SAMIFLD",8,0)
 ; additional subroutines are included that are not part of the LOAD
"RTN","SAMIFLD",9,0)
 ; opus but are called by WSCASE^SAMICASE.
"RTN","SAMIFLD",10,0)
 ; SAMIFLD contains no public entry points (see SAMIFORM).
"RTN","SAMIFLD",11,0)
 ;
"RTN","SAMIFLD",12,0)
 quit  ; no entry from top
"RTN","SAMIFLD",13,0)
 ;
"RTN","SAMIFLD",14,0)
 ;
"RTN","SAMIFLD",15,0)
 ;
"RTN","SAMIFLD",16,0)
 ;@section 0 primary development
"RTN","SAMIFLD",17,0)
 ;
"RTN","SAMIFLD",18,0)
 ;
"RTN","SAMIFLD",19,0)
 ;
"RTN","SAMIFLD",20,0)
 ;@routine-credits
"RTN","SAMIFLD",21,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMIFLD",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIFLD",23,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMIFLD",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIFLD",25,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIFLD",26,0)
 ;@license Apache 2.0
"RTN","SAMIFLD",27,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMIFLD",28,0)
 ;
"RTN","SAMIFLD",29,0)
 ;@last-updated 2021-03-21T23:51Z
"RTN","SAMIFLD",30,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIFLD",31,0)
 ;@module Screening Applications Management - VAPALS-ELCAP (SAMI)
"RTN","SAMIFLD",32,0)
 ;@version 1.18.0.10-i10
"RTN","SAMIFLD",33,0)
 ;@release-date 2020-01
"RTN","SAMIFLD",34,0)
 ;@patch-list **10**
"RTN","SAMIFLD",35,0)
 ;@build 11
"RTN","SAMIFLD",36,0)
 ;
"RTN","SAMIFLD",37,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMIFLD",38,0)
 ; toad@vistaexpertise.net
"RTN","SAMIFLD",39,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMIFLD",40,0)
 ; lgc@vistaexpertise.net
"RTN","SAMIFLD",41,0)
 ;@additional-dev Alexis Carlson (arc)
"RTN","SAMIFLD",42,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMIFLD",43,0)
 ;@additional-dev Domenic DiNatale (dom)
"RTN","SAMIFLD",44,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMIFLD",45,0)
 ;
"RTN","SAMIFLD",46,0)
 ;@module-credits [see SAMIFUL]
"RTN","SAMIFLD",47,0)
 ;
"RTN","SAMIFLD",48,0)
 ;@contents
"RTN","SAMIFLD",49,0)
 ; LOAD: code for ppi LOAD^SAMIFORM
"RTN","SAMIFLD",50,0)
 ;  process html line, e.g., load json data into graph
"RTN","SAMIFLD",51,0)
 ;
"RTN","SAMIFLD",52,0)
 ; $$xpand = expand # to 8 digits
"RTN","SAMIFLD",53,0)
 ; $$GETHDR-AGE = header string for patient sid
"RTN","SAMIFLD",54,0)
 ;
"RTN","SAMIFLD",55,0)
 ; GETLAST5 = code for ppi $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",56,0)
 ;  last5 for patient sid
"RTN","SAMIFLD",57,0)
 ; FIXSRC: code for ppi FIXSRC^SAMIFORM
"RTN","SAMIFLD",58,0)
 ;  fix html src lines to use resources in see/
"RTN","SAMIFLD",59,0)
 ; FIXHREF: code for ppi FIXHREF^SAMIFORM
"RTN","SAMIFLD",60,0)
 ;  fix html href lines to use resources in see/
"RTN","SAMIFLD",61,0)
 ;
"RTN","SAMIFLD",62,0)
 ; GETNAME = code for ppi $$GETNAME^SAMIFORM
"RTN","SAMIFLD",63,0)
 ;  name for patient sid
"RTN","SAMIFLD",64,0)
 ; GETSSN = code for ppi $$GETSSN^SAMIFORM
"RTN","SAMIFLD",65,0)
 ;  ssn for patient sid
"RTN","SAMIFLD",66,0)
 ; GETPRFX = code for ppi $$GETPRFX^SAMIFORM [deprecated]
"RTN","SAMIFLD",67,0)
 ;  retrieve study id prefix from parameter file
"RTN","SAMIFLD",68,0)
 ;
"RTN","SAMIFLD",69,0)
 ;
"RTN","SAMIFLD",70,0)
 ;
"RTN","SAMIFLD",71,0)
 ;@section 1 code for ppi LOAD^SAMIFRM
"RTN","SAMIFLD",72,0)
 ;
"RTN","SAMIFLD",73,0)
 ;
"RTN","SAMIFLD",74,0)
 ;
"RTN","SAMIFLD",75,0)
 ;@ppi-code LOAD^SAMIFORM
"RTN","SAMIFLD",76,0)
LOAD ; process html line, e.g., load json data into graph
"RTN","SAMIFLD",77,0)
 ;
"RTN","SAMIFLD",78,0)
 ;@signature
"RTN","SAMIFLD",79,0)
 ; do LOAD^SAMIFORM(.SAMILINE,form,sid,.SAMIFILTER,.SAMILNUM,.SAMIHTML,.SAMIVALS)
"RTN","SAMIFLD",80,0)
 ;@branches-from
"RTN","SAMIFLD",81,0)
 ; LOAD^SAMIFORM
"RTN","SAMIFLD",82,0)
 ;@ppi-called-by
"RTN","SAMIFLD",83,0)
 ; wsGetForm^%wf
"RTN","SAMIFLD",84,0)
 ; WSNOTE^SAMINOTI
"RTN","SAMIFLD",85,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIFLD",86,0)
 ;@called-by: none
"RTN","SAMIFLD",87,0)
 ;@calls
"RTN","SAMIFLD",88,0)
 ; $$GETHDR
"RTN","SAMIFLD",89,0)
 ; $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",90,0)
 ; findReplace^%ts
"RTN","SAMIFLD",91,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",92,0)
 ; $$xpand
"RTN","SAMIFLD",93,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIFLD",94,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIFLD",95,0)
 ;@thruput
"RTN","SAMIFLD",96,0)
 ;.SAMILINE = line of html
"RTN","SAMIFLD",97,0)
 ; SAMILINE("low") = lowercase line for easier checks
"RTN","SAMIFLD",98,0)
 ;.SAMIFILTER = work-parameters array
"RTN","SAMIFLD",99,0)
 ; SAMIFILTER("debug") = 1 to debug some fields, 2 to debug more fields
"RTN","SAMIFLD",100,0)
 ; SAMIFILTER("errormessagestyle") = 2 (default) = use current error msg style
"RTN","SAMIFLD",101,0)
 ; SAMIFILTER("form") = form id (e.g., "vapals:sbform")
"RTN","SAMIFLD",102,0)
 ; SAMIFILTER("key") = graph key for saved form (e.g., "ceform-2019-07-01")
"RTN","SAMIFLD",103,0)
 ; SAMIFILTER("studyid") = patient study id (e.g., "XXX00045")
"RTN","SAMIFLD",104,0)
 ; SAMIFILTER("fvalue") = deprecated
"RTN","SAMIFLD",105,0)
 ;.SAMILNUM = html line #, in case need to reset cursor to skip lines
"RTN","SAMIFLD",106,0)
 ;.SAMIHTML = complete html form, in case other lines need changing
"RTN","SAMIFLD",107,0)
 ;@input
"RTN","SAMIFLD",108,0)
 ; form = form id
"RTN","SAMIFLD",109,0)
 ; sid = patient study id
"RTN","SAMIFLD",110,0)
 ;.SAMIVALS = field values
"RTN","SAMIFLD",111,0)
 ; SAMIVALS("saminame")
"RTN","SAMIFLD",112,0)
 ; SAMIVALS("samistatus")
"RTN","SAMIFLD",113,0)
 ; SAMIVALS("samifirsttime")
"RTN","SAMIFLD",114,0)
 ;@tests
"RTN","SAMIFLD",115,0)
 ; UTSSUB2^SAMIUTF2: used for Dom's new style forms
"RTN","SAMIFLD",116,0)
 ;
"RTN","SAMIFLD",117,0)
 ; This line processor/data loader can modify any line in the html as needed.
"RTN","SAMIFLD",118,0)
 ;
"RTN","SAMIFLD",119,0)
 new touched set touched=0
"RTN","SAMIFLD",120,0)
 ;
"RTN","SAMIFLD",121,0)
 set SAMILINE=SAMILINE_$char(13,10) ; insert CRLF at end of every line
"RTN","SAMIFLD",122,0)
 ; for readability in browser
"RTN","SAMIFLD",123,0)
 ;
"RTN","SAMIFLD",124,0)
 new pssn set pssn=$$GETHDR(sid)
"RTN","SAMIFLD",125,0)
 i pssn=""  d  ; for participants without a sid - ie not registered
"RTN","SAMIFLD",126,0)
 . n dfn,lien
"RTN","SAMIFLD",127,0)
 . s dfn=$g(SAMIFILTER("dfn")) ; if no sid, maybe a dfn
"RTN","SAMIFLD",128,0)
 . q:dfn=""
"RTN","SAMIFLD",129,0)
 . n lroot s lroot=$$setroot^%wd("patient-lookup") ; 
"RTN","SAMIFLD",130,0)
 . s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIFLD",131,0)
 . q:lien=""
"RTN","SAMIFLD",132,0)
 . n ssn s ssn=$g(@lroot@(lien,"ssn"))
"RTN","SAMIFLD",133,0)
 . q:ssn=""
"RTN","SAMIFLD",134,0)
 . s pssn=$e(ssn,1,3)_"-"_$e(ssn,4,5)_"-"_$e(ssn,6,9)
"RTN","SAMIFLD",135,0)
 new last5 set last5=$$GETLAST5^SAMIFORM(sid)
"RTN","SAMIFLD",136,0)
 new useid set useid=pssn
"RTN","SAMIFLD",137,0)
 if useid="" set useid=last5
"RTN","SAMIFLD",138,0)
 ;
"RTN","SAMIFLD",139,0)
 if SAMILINE["@@FORMKEY@@" do  ; insert form id (graph key for new forms)
"RTN","SAMIFLD",140,0)
 . do findReplace^%ts(.SAMILINE,"@@FORMKEY@@",form) ; key -> form, test me
"RTN","SAMIFLD",141,0)
 . quit
"RTN","SAMIFLD",142,0)
 ;
"RTN","SAMIFLD",143,0)
 if SAMILINE["@@SID@@" do  ; insert patient study id
"RTN","SAMIFLD",144,0)
 . do findReplace^%ts(.SAMILINE,"@@SID@@",sid)
"RTN","SAMIFLD",145,0)
 . quit
"RTN","SAMIFLD",146,0)
 ;
"RTN","SAMIFLD",147,0)
 if SAMILINE["@@SITE@@" do  ; insert site id
"RTN","SAMIFLD",148,0)
 . n siteid s siteid=$g(SAMIVALS("siteid"))
"RTN","SAMIFLD",149,0)
 . i siteid="" s siteid=$g(SAMIFILTER("siteid"))
"RTN","SAMIFLD",150,0)
 . q:siteid=""
"RTN","SAMIFLD",151,0)
 . do findReplace^%ts(.SAMILINE,"@@SITE@@",siteid)
"RTN","SAMIFLD",152,0)
 . quit
"RTN","SAMIFLD",153,0)
 ;
"RTN","SAMIFLD",154,0)
 if SAMILINE["@@SITETITLE@@" do  ; insert site title
"RTN","SAMIFLD",155,0)
 . n sitetit s sitetit=$g(SAMIVALS("sitetitle"))
"RTN","SAMIFLD",156,0)
 . i sitetit="" s sitetit=$g(SAMIFILTER("sitetitle"))
"RTN","SAMIFLD",157,0)
 . q:sitetit=""
"RTN","SAMIFLD",158,0)
 . do findReplace^%ts(.SAMILINE,"@@SITETITLE@@",sitetit)
"RTN","SAMIFLD",159,0)
 . quit
"RTN","SAMIFLD",160,0)
 ;
"RTN","SAMIFLD",161,0)
 if SAMILINE["@@MANUALREGISTRATION@@" do  ; turn off manual registration
"RTN","SAMIFLD",162,0)
 . n setman,setparm
"RTN","SAMIFLD",163,0)
 . s setman="true"
"RTN","SAMIFLD",164,0)
 . s setparm=$$GET^XPAR("SYS","SAMI ALLOW MANUAL ENTRY",,"Q")
"RTN","SAMIFLD",165,0)
 . i setparm=0 s setman="false"
"RTN","SAMIFLD",166,0)
 . do findReplace^%ts(.SAMILINE,"@@MANUALREGISTRATION@@",setman)
"RTN","SAMIFLD",167,0)
 ; 
"RTN","SAMIFLD",168,0)
 if SAMILINE["@@DFN@@" do  ; insert patient study id
"RTN","SAMIFLD",169,0)
 . n dfn s dfn=$g(SAMIVALS("dfn"))
"RTN","SAMIFLD",170,0)
 . q:dfn=""
"RTN","SAMIFLD",171,0)
 . do findReplace^%ts(.SAMILINE,"@@DFN@@",dfn)
"RTN","SAMIFLD",172,0)
 . quit
"RTN","SAMIFLD",173,0)
 ;
"RTN","SAMIFLD",174,0)
 if SAMILINE["src=" do  ; repoint src directory references
"RTN","SAMIFLD",175,0)
 . do FIXSRC^SAMIFORM(.SAMILINE) ; insert see/ processor on src= references
"RTN","SAMIFLD",176,0)
 . quit
"RTN","SAMIFLD",177,0)
 ;
"RTN","SAMIFLD",178,0)
 if SAMILINE["href=" if 'touched do  ; repoint href directory references
"RTN","SAMIFLD",179,0)
 . do FIXHREF^SAMIFORM(.SAMILINE) ; insert see/ processor on href= references
"RTN","SAMIFLD",180,0)
 . quit
"RTN","SAMIFLD",181,0)
 ;
"RTN","SAMIFLD",182,0)
 if SAMILINE["Sample, Sammy G" do  ; insert actual patient name
"RTN","SAMIFLD",183,0)
 . ;do findReplace^%ts(.SAMILINE,"Sample, Sammy G",$get(SAMIVALS("saminame")))
"RTN","SAMIFLD",184,0)
 . do findReplace^%ts(.SAMILINE,"Sample, Sammy G",$$GETNAME^SAMIFORM(sid))
"RTN","SAMIFLD",185,0)
 . quit
"RTN","SAMIFLD",186,0)
 ;
"RTN","SAMIFLD",187,0)
 if SAMILINE["ST0001" do  ; insert patient ssn or last 5
"RTN","SAMIFLD",188,0)
 . do findReplace^%ts(.SAMILINE,"ST0001",useid)
"RTN","SAMIFLD",189,0)
 . quit
"RTN","SAMIFLD",190,0)
 ;
"RTN","SAMIFLD",191,0)
 if SAMILINE["1234567890" do  ; cut patient id placeholder
"RTN","SAMIFLD",192,0)
 . do findReplace^%ts(.SAMILINE,"1234567890","")
"RTN","SAMIFLD",193,0)
 . quit
"RTN","SAMIFLD",194,0)
 ;
"RTN","SAMIFLD",195,0)
 if SAMILINE["XX0002" do  ; insert patient study id
"RTN","SAMIFLD",196,0)
 . if SAMILINE["XXX" quit  ;
"RTN","SAMIFLD",197,0)
 . do findReplace^%ts(.SAMILINE,"XX0002",sid)
"RTN","SAMIFLD",198,0)
 . quit
"RTN","SAMIFLD",199,0)
 ;
"RTN","SAMIFLD",200,0)
 if SAMILINE["VEP0001" do  ; insert patient study id
"RTN","SAMIFLD",201,0)
 . do findReplaceAll^%ts(.SAMILINE,"VEP0001",sid)
"RTN","SAMIFLD",202,0)
 . quit
"RTN","SAMIFLD",203,0)
 ;
"RTN","SAMIFLD",204,0)
 if SAMILINE["@@FROZEN@@" do  ; insert whether form is frozen
"RTN","SAMIFLD",205,0)
 . if $get(SAMIVALS("samistatus"))="complete" do  ;
"RTN","SAMIFLD",206,0)
 . . do findReplace^%ts(.SAMILINE,"@@FROZEN@@","true")
"RTN","SAMIFLD",207,0)
 . . quit
"RTN","SAMIFLD",208,0)
 . else  do  ;
"RTN","SAMIFLD",209,0)
 . . do findReplace^%ts(.SAMILINE,"@@FROZEN@@","false")
"RTN","SAMIFLD",210,0)
 . . quit
"RTN","SAMIFLD",211,0)
 . quit
"RTN","SAMIFLD",212,0)
 ;
"RTN","SAMIFLD",213,0)
 if SAMILINE["@@NEWFORM@@" do  ; insert whether first edit of form
"RTN","SAMIFLD",214,0)
 . if $get(SAMIVALS("samifirsttime"))="true" do  ;
"RTN","SAMIFLD",215,0)
 . . do findReplace^%ts(.SAMILINE,"@@NEWFORM@@","true")
"RTN","SAMIFLD",216,0)
 . . quit
"RTN","SAMIFLD",217,0)
 . else  do  ;
"RTN","SAMIFLD",218,0)
 . . do findReplace^%ts(.SAMILINE,"@@NEWFORM@@","false")
"RTN","SAMIFLD",219,0)
 . . quit
"RTN","SAMIFLD",220,0)
 . quit
"RTN","SAMIFLD",221,0)
 ;
"RTN","SAMIFLD",222,0)
 if SAMILINE["@@CHART_ELIGIBILITY_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",223,0)
 . n zexist
"RTN","SAMIFLD",224,0)
 . s zexist=$$EXISTCE^SAMINOT1(sid,form)
"RTN","SAMIFLD",225,0)
 . do findReplace^%ts(.SAMILINE,"@@CHART_ELIGIBILITY_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",226,0)
 ;
"RTN","SAMIFLD",227,0)
 if SAMILINE["@@PRE_ENROLLMENT_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",228,0)
 . n zexist
"RTN","SAMIFLD",229,0)
 . s zexist=$$EXISTPRE^SAMINOT1(sid,form)
"RTN","SAMIFLD",230,0)
 . do findReplace^%ts(.SAMILINE,"@@PRE_ENROLLMENT_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",231,0)
 ;
"RTN","SAMIFLD",232,0)
 if SAMILINE["@@INTAKE_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",233,0)
 . n zexist
"RTN","SAMIFLD",234,0)
 . s zexist=$$EXISTINT^SAMINOT1(sid,form)
"RTN","SAMIFLD",235,0)
 . do findReplace^%ts(.SAMILINE,"@@INTAKE_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",236,0)
 ;
"RTN","SAMIFLD",237,0)
 if SAMILINE["changelog" d  ;
"RTN","SAMIFLD",238,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",239,0)
 . new clog set clog=$na(@root@("graph",sid,form,"changelog"))
"RTN","SAMIFLD",240,0)
 . if '$d(@clog) q  ;
"RTN","SAMIFLD",241,0)
 . do findReplace^%ts(.SAMILINE,"</pre>","")
"RTN","SAMIFLD",242,0)
 . new zi set zi=""
"RTN","SAMIFLD",243,0)
 . for  set zi=$order(@clog@(zi)) quit:zi=""  d  ;
"RTN","SAMIFLD",244,0)
 . . new zien set zien=SAMILNUM_"."_$$xpand(zi)
"RTN","SAMIFLD",245,0)
 . . set zhtml(zien)=@clog@(zi)
"RTN","SAMIFLD",246,0)
 . set zhtml(SAMILNUM_"."_$$xpand($order(@clog@(""),-1)+1))="</pre>"
"RTN","SAMIFLD",247,0)
 ;
"RTN","SAMIFLD",248,0)
 if SAMILINE["commlog" d  ;
"RTN","SAMIFLD",249,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",250,0)
 . new clog set clog=$na(@root@("graph",sid,form,"comlog"))
"RTN","SAMIFLD",251,0)
 . if '$d(@clog) q  ;
"RTN","SAMIFLD",252,0)
 . do findReplace^%ts(.SAMILINE,"</pre>","")
"RTN","SAMIFLD",253,0)
 . new zi set zi=""
"RTN","SAMIFLD",254,0)
 . for  set zi=$order(@clog@(zi)) quit:zi=""  d  ;
"RTN","SAMIFLD",255,0)
 . . new zien set zien=SAMILNUM_"."_$$xpand(zi)
"RTN","SAMIFLD",256,0)
 . . set zhtml(zien)=@clog@(zi)
"RTN","SAMIFLD",257,0)
 . set zhtml(SAMILNUM_"."_$$xpand($order(@clog@(""),-1)+1))="</pre>"
"RTN","SAMIFLD",258,0)
 ;
"RTN","SAMIFLD",259,0)
 ;if form["fuform" d  ;
"RTN","SAMIFLD",260,0)
 i SAMILINE["pack-years-history" d  ;
"RTN","SAMIFLD",261,0)
 . d  ;
"RTN","SAMIFLD",262,0)
 . . i SAMILINE'["id" q  ;
"RTN","SAMIFLD",263,0)
 . . n zzi s zzi=SAMILNUM
"RTN","SAMIFLD",264,0)
 . . f  s zzi=$o(SAMIHTML(zzi)) q:zzi>(SAMILNUM+20)  q:SAMIHTML(zzi)["tbody"  d
"RTN","SAMIFLD",265,0)
 . . . s SAMIHTML(zzi)=SAMIHTML(zzi)_$char(13,10)
"RTN","SAMIFLD",266,0)
 . . ;s SAMIHTML(zzi)="<tbody>"_$$SHDET^SAMIUR2(sid)
"RTN","SAMIFLD",267,0)
 . . s SAMILNUM=zzi+1
"RTN","SAMIFLD",268,0)
 . . s SAMILINE=$$SHDET^SAMIUR2(sid,form)_"</tbody>"
"RTN","SAMIFLD",269,0)
 ;
"RTN","SAMIFLD",270,0)
 i SAMILINE["@@ERROR_MESSAGE@@" d  ;
"RTN","SAMIFLD",271,0)
 . n errMsg s errMsg=$get(SAMIVALS("errorMessage"))
"RTN","SAMIFLD",272,0)
 . if errMsg="" q  ; no error message
"RTN","SAMIFLD",273,0)
 . do findReplace^%ts(.SAMILINE,"@@ERROR_MESSAGE@@",errMsg)
"RTN","SAMIFLD",274,0)
 ;
"RTN","SAMIFLD",275,0)
 i SAMILINE["@@ERROR_FIELDS@@" d  ;
"RTN","SAMIFLD",276,0)
 . n errFld s errFld=$get(SAMIVALS("errorField"))
"RTN","SAMIFLD",277,0)
 . if errFld="" q  ; no error field
"RTN","SAMIFLD",278,0)
 . do findReplace^%ts(.SAMILINE,"@@ERROR_FIELDS@@",errFld)
"RTN","SAMIFLD",279,0)
 ;
"RTN","SAMIFLD",280,0)
 i SAMILINE["@@INFO_MESSAGE@@" d  ;
"RTN","SAMIFLD",281,0)
 . n infoMsg s infoMsg=$get(SAMIVALS("infoMessage"))
"RTN","SAMIFLD",282,0)
 . if infoMsg="" q  ; no message
"RTN","SAMIFLD",283,0)
 . do findReplace^%ts(.SAMILINE,"@@INFO_MESSAGE@@",infoMsg)
"RTN","SAMIFLD",284,0)
 ;
"RTN","SAMIFLD",285,0)
 i SAMILINE["@@WARN_MESSAGE@@" d  ;
"RTN","SAMIFLD",286,0)
 . n warnMsg s warnMsg=$get(SAMIVALS("warnMessage"))
"RTN","SAMIFLD",287,0)
 . if warnMsg="" q  ; no message
"RTN","SAMIFLD",288,0)
 . do findReplace^%ts(.SAMILINE,"@@WARN_MESSAGE@@",warnMsg)
"RTN","SAMIFLD",289,0)
 ;
"RTN","SAMIFLD",290,0)
 quit  ; end of ppi LOAD^SAMIFORM
"RTN","SAMIFLD",291,0)
 ;
"RTN","SAMIFLD",292,0)
 ;
"RTN","SAMIFLD",293,0)
 ;
"RTN","SAMIFLD",294,0)
xpand(zi) ; expand # to 8 digits
"RTN","SAMIFLD",295,0)
 ;
"RTN","SAMIFLD",296,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",297,0)
 ;
"RTN","SAMIFLD",298,0)
 ;ven/gpl;private;function;clean;silent;sac;0% tests
"RTN","SAMIFLD",299,0)
 ;@called-by
"RTN","SAMIFLD",300,0)
 ; LOAD
"RTN","SAMIFLD",301,0)
 ;@calls none
"RTN","SAMIFLD",302,0)
 ;@input
"RTN","SAMIFLD",303,0)
 ; zi = # to expand
"RTN","SAMIFLD",304,0)
 ;@output = # expanded to 8 digits by prefixing 0 & appending 1 so 10,
"RTN","SAMIFLD",305,0)
 ; 20, etc. collate properly
"RTN","SAMIFLD",306,0)
 ;
"RTN","SAMIFLD",307,0)
 ;@stanza 2 algorithm
"RTN","SAMIFLD",308,0)
 ;
"RTN","SAMIFLD",309,0)
 new g1 set g1=8-$length(zi)
"RTN","SAMIFLD",310,0)
 new g2 set $piece(g2,"0",g1)=""
"RTN","SAMIFLD",311,0)
 new g3 set g3=g2_zi_"1"
"RTN","SAMIFLD",312,0)
 ;
"RTN","SAMIFLD",313,0)
 ;@stanza 3 termination
"RTN","SAMIFLD",314,0)
 ;
"RTN","SAMIFLD",315,0)
 quit g3 ; end of $$xpand
"RTN","SAMIFLD",316,0)
 ;
"RTN","SAMIFLD",317,0)
 ;
"RTN","SAMIFLD",318,0)
 ;
"RTN","SAMIFLD",319,0)
GETHDR(sid) ; header string for patient sid
"RTN","SAMIFLD",320,0)
 ;
"RTN","SAMIFLD",321,0)
 ;@signature
"RTN","SAMIFLD",322,0)
 ; $$GETHDR^SAMIFORM(sid)
"RTN","SAMIFLD",323,0)
 ;@called-by
"RTN","SAMIFLD",324,0)
 ; LOAD
"RTN","SAMIFLD",325,0)
 ;@calls
"RTN","SAMIFLD",326,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",327,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMIFLD",328,0)
 ; ^%DT
"RTN","SAMIFLD",329,0)
 ; $$NOW^XLFDT
"RTN","SAMIFLD",330,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIFLD",331,0)
 ;@input
"RTN","SAMIFLD",332,0)
 ; sid = patient study id
"RTN","SAMIFLD",333,0)
 ;@output = header string (patient id dob age gender)
"RTN","SAMIFLD",334,0)
 ;@tests
"RTN","SAMIFLD",335,0)
 ; UTGETHDR^SAMIUTF2: header string for patient sid
"RTN","SAMIFLD",336,0)
 ;
"RTN","SAMIFLD",337,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",338,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",339,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",340,0)
 new dfn set dfn=@root@(ien,"dfn")
"RTN","SAMIFLD",341,0)
 quit:ien=""
"RTN","SAMIFLD",342,0)
 ;
"RTN","SAMIFLD",343,0)
 ; do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",344,0)
 if $get(@root@(ien,"ssn"))="" do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",345,0)
 if $get(@root@(ien,"sbdob"))=-1 do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",346,0)
 ;
"RTN","SAMIFLD",347,0)
 n pssn s pssn="" ; will be ssn with dashes
"RTN","SAMIFLD",348,0)
 ; if $get(@root@(ien,"ssn"))="" quit "" ; patient info not available
"RTN","SAMIFLD",349,0)
 if $get(@root@(ien,"ssn"))'="" do  ;
"RTN","SAMIFLD",350,0)
 . set pssn=$get(@root@(ien,"sissn"))
"RTN","SAMIFLD",351,0)
 . if pssn["sta" set pssn=""
"RTN","SAMIFLD",352,0)
 . if pssn="" do  ;
"RTN","SAMIFLD",353,0)
 . . new orgssn
"RTN","SAMIFLD",354,0)
 . . set orgssn=$get(@root@(ien,"ssn"))
"RTN","SAMIFLD",355,0)
 . . quit:orgssn=""
"RTN","SAMIFLD",356,0)
 . . set pssn=$extract(orgssn,1,3)_"-"_$extract(orgssn,4,5)_"-"_$extract(orgssn,6,9)
"RTN","SAMIFLD",357,0)
 . . set @root@(ien,"sissn")=pssn
"RTN","SAMIFLD",358,0)
 . . quit
"RTN","SAMIFLD",359,0)
 ;
"RTN","SAMIFLD",360,0)
AGE new dob set dob=$get(@root@(ien,"sbdob")) ; dob in VAPALS format
"RTN","SAMIFLD",361,0)
 i dob["-" s dob=$e(dob,6,7)_"/"_$e(dob,9,10)_"/"_$e(dob,1,4)
"RTN","SAMIFLD",362,0)
 i dob'["/" s dob=$e(dob,5,6)_"/"_$e(dob,7,8)_"/"_$e(dob,1,4)
"RTN","SAMIFLD",363,0)
 new X set X=dob
"RTN","SAMIFLD",364,0)
 new Y
"RTN","SAMIFLD",365,0)
 do ^%DT
"RTN","SAMIFLD",366,0)
 ;
"RTN","SAMIFLD",367,0)
 ; change ven/lgc 20190628 - calculate age with MASH 
"RTN","SAMIFLD",368,0)
 ;
"RTN","SAMIFLD",369,0)
 ;new age set age=$piece($$FMDIFF^XLFDT($$NOW^XLFDT,Y)/365,".")
"RTN","SAMIFLD",370,0)
 new age s age=$$age^%th(Y)
"RTN","SAMIFLD",371,0)
 ;
"RTN","SAMIFLD",372,0)
 set @root@(ien,"age")=age
"RTN","SAMIFLD",373,0)
 ;
"RTN","SAMIFLD",374,0)
 new sex set sex=$get(@root@(ien,"sex"))
"RTN","SAMIFLD",375,0)
 ;
"RTN","SAMIFLD",376,0)
 new simrn,sipid
"RTN","SAMIFLD",377,0)
 set simrn=$$GETMRN(sid,.sipid)
"RTN","SAMIFLD",378,0)
 ;set sipid=$g(@root@(ien,"sipid"))
"RTN","SAMIFLD",379,0)
 ;
"RTN","SAMIFLD",380,0)
 new rtn set rtn=""
"RTN","SAMIFLD",381,0)
 if simrn'="" do  ;
"RTN","SAMIFLD",382,0)
 . set rtn=sipid_" "_simrn_" DOB: "_dob_" GENDER: "_sex
"RTN","SAMIFLD",383,0)
 else  do  ;
"RTN","SAMIFLD",384,0)
 . set rtn=pssn_" DOB: "_dob_" AGE: "_age_" GENDER: "_sex
"RTN","SAMIFLD",385,0)
 ;
"RTN","SAMIFLD",386,0)
 quit rtn ; end of $$GETHDR-AGE
"RTN","SAMIFLD",387,0)
 ;
"RTN","SAMIFLD",388,0)
GETMRN(sid,pid) ; get the MRN, which supercedes the ssn as the patient identifier
"RTN","SAMIFLD",389,0)
 ;
"RTN","SAMIFLD",390,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",391,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",392,0)
 new simrn,sipid
"RTN","SAMIFLD",393,0)
 ;set simrn=$get(@root@(ien,"simrn"))
"RTN","SAMIFLD",394,0)
 ;set sipid=$get(@root@(ien,"sipid"))
"RTN","SAMIFLD",395,0)
 set (simrn,sipid)=""
"RTN","SAMIFLD",396,0)
 if simrn="" d  ;
"RTN","SAMIFLD",397,0)
 . new siform
"RTN","SAMIFLD",398,0)
 . set siform=$order(@root@("graph",sid,"siform"))
"RTN","SAMIFLD",399,0)
 . quit:siform=""
"RTN","SAMIFLD",400,0)
 . set simrn=$get(@root@("graph",sid,siform,"simrn"))
"RTN","SAMIFLD",401,0)
 if sipid="" d  ;
"RTN","SAMIFLD",402,0)
 . new siform
"RTN","SAMIFLD",403,0)
 . set siform=$order(@root@("graph",sid,"siform"))
"RTN","SAMIFLD",404,0)
 . quit:siform=""
"RTN","SAMIFLD",405,0)
 . set sipid=$get(@root@("graph",sid,siform,"sipid"))
"RTN","SAMIFLD",406,0)
 . set pid=sipid
"RTN","SAMIFLD",407,0)
 quit simrn
"RTN","SAMIFLD",408,0)
 ;
"RTN","SAMIFLD",409,0)
 ;
"RTN","SAMIFLD",410,0)
 ;@section 2 code for ppis $$GETLAST5^SAMIFORM,FIXSRC^SAMIFORM,FIXHREF^SAMIFORM
"RTN","SAMIFLD",411,0)
 ;
"RTN","SAMIFLD",412,0)
 ;
"RTN","SAMIFLD",413,0)
 ;
"RTN","SAMIFLD",414,0)
 ;@ppi-code $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",415,0)
GETLAST5 ; last5 for patient sid
"RTN","SAMIFLD",416,0)
 ;
"RTN","SAMIFLD",417,0)
 ;@signature
"RTN","SAMIFLD",418,0)
 ; $$GETHDR^SAMIFORM(sid)
"RTN","SAMIFLD",419,0)
 ;@branches-from
"RTN","SAMIFLD",420,0)
 ; GETLAST5^SAMIFORM
"RTN","SAMIFLD",421,0)
 ;@ppi-called-by
"RTN","SAMIFLD",422,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",423,0)
 ; LOAD
"RTN","SAMIFLD",424,0)
 ;@called-by: none
"RTN","SAMIFLD",425,0)
 ;@calls
"RTN","SAMIFLD",426,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",427,0)
 ;@input
"RTN","SAMIFLD",428,0)
 ; sid = patient study id
"RTN","SAMIFLD",429,0)
 ;@output = patient's BS5 (first initial of last name, last 4 of ssn)
"RTN","SAMIFLD",430,0)
 ;@tests
"RTN","SAMIFLD",431,0)
 ; UTGLST5^SAMIUTF2: last5 for patient sid
"RTN","SAMIFLD",432,0)
 ;
"RTN","SAMIFLD",433,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",434,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",435,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",436,0)
 quit:ien=""
"RTN","SAMIFLD",437,0)
 ;
"RTN","SAMIFLD",438,0)
 quit $get(@root@(ien,"last5")) ; end of ppi $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",439,0)
 ;
"RTN","SAMIFLD",440,0)
 ;
"RTN","SAMIFLD",441,0)
 ;
"RTN","SAMIFLD",442,0)
 ;@ppi-code FIXSRC^SAMIFORM
"RTN","SAMIFLD",443,0)
FIXSRC ; fix html src lines to use resources in see/
"RTN","SAMIFLD",444,0)
 ;
"RTN","SAMIFLD",445,0)
 ;@signature
"RTN","SAMIFLD",446,0)
 ; do FIXSRC^SAMIFORM(.SAMILINE)
"RTN","SAMIFLD",447,0)
 ;@branches-from
"RTN","SAMIFLD",448,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIFLD",449,0)
 ;@ppi-called-by
"RTN","SAMIFLD",450,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",451,0)
 ; LOAD
"RTN","SAMIFLD",452,0)
 ;@called-by: none
"RTN","SAMIFLD",453,0)
 ;@calls
"RTN","SAMIFLD",454,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",455,0)
 ;@thruput
"RTN","SAMIFLD",456,0)
 ;.SAMILINE = line of html to change
"RTN","SAMIFLD",457,0)
 ;@tests
"RTN","SAMIFLD",458,0)
 ; UTFSRC^SAMIUTF2: fix html src lines to use resources in see/
"RTN","SAMIFLD",459,0)
 ;
"RTN","SAMIFLD",460,0)
 if SAMILINE["src=" do  ;
"RTN","SAMIFLD",461,0)
 . if SAMILINE["src=""http" quit
"RTN","SAMIFLD",462,0)
 . if SAMILINE["src=""/" do  quit
"RTN","SAMIFLD",463,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=""/","src=""/see/sami/")
"RTN","SAMIFLD",464,0)
 . . quit
"RTN","SAMIFLD",465,0)
 . if SAMILINE["src=""" do  quit
"RTN","SAMIFLD",466,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=""","src=""/see/sami/")
"RTN","SAMIFLD",467,0)
 . . quit
"RTN","SAMIFLD",468,0)
 . if SAMILINE["src=" do
"RTN","SAMIFLD",469,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=","src=/see/sami/")
"RTN","SAMIFLD",470,0)
 . . quit
"RTN","SAMIFLD",471,0)
 . quit
"RTN","SAMIFLD",472,0)
 ;
"RTN","SAMIFLD",473,0)
 quit  ; end of ppi FIXSRC^SAMIFORM
"RTN","SAMIFLD",474,0)
 ;
"RTN","SAMIFLD",475,0)
 ;
"RTN","SAMIFLD",476,0)
 ;
"RTN","SAMIFLD",477,0)
 ;@ppi-code FIXHREF^SAMIFORM
"RTN","SAMIFLD",478,0)
FIXHREF ; fix html href lines to use resources in see/
"RTN","SAMIFLD",479,0)
 ;
"RTN","SAMIFLD",480,0)
 ;@signature
"RTN","SAMIFLD",481,0)
 ; do FIXHREF^SAMIFORM(.SAMILINE)
"RTN","SAMIFLD",482,0)
 ;@branches-from
"RTN","SAMIFLD",483,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIFLD",484,0)
 ;@ppi-called-by
"RTN","SAMIFLD",485,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",486,0)
 ; LOAD
"RTN","SAMIFLD",487,0)
 ;@called-by: none
"RTN","SAMIFLD",488,0)
 ;@calls
"RTN","SAMIFLD",489,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",490,0)
 ;@thruput
"RTN","SAMIFLD",491,0)
 ;.SAMILINE = line of html to change
"RTN","SAMIFLD",492,0)
 ;@tests
"RTN","SAMIFLD",493,0)
 ; UTFHREF^SAMIUTF2: fix html href lines to use resources in see/
"RTN","SAMIFLD",494,0)
 ;
"RTN","SAMIFLD",495,0)
 if SAMILINE["href=" do  ;
"RTN","SAMIFLD",496,0)
 . quit:SAMILINE["href=""#"
"RTN","SAMIFLD",497,0)
 . quit:SAMILINE["href='#"
"RTN","SAMIFLD",498,0)
 . quit:SAMILINE["href=""http"
"RTN","SAMIFLD",499,0)
 . quit:SAMILINE["/vapals"
"RTN","SAMIFLD",500,0)
 . if SAMILINE["href=""/" do  quit
"RTN","SAMIFLD",501,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=""/","href=""/","href=""/see/sami/")
"RTN","SAMIFLD",502,0)
 . . quit
"RTN","SAMIFLD",503,0)
 . if SAMILINE["href=""" do  quit
"RTN","SAMIFLD",504,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=""","href=""/see/sami/")
"RTN","SAMIFLD",505,0)
 . . quit
"RTN","SAMIFLD",506,0)
 . if SAMILINE["href=" do  quit
"RTN","SAMIFLD",507,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=","href=/see/sami/")
"RTN","SAMIFLD",508,0)
 . . quit
"RTN","SAMIFLD",509,0)
 . quit
"RTN","SAMIFLD",510,0)
 ;
"RTN","SAMIFLD",511,0)
 quit  ; end of ppi FIXHREF^SAMIFORM
"RTN","SAMIFLD",512,0)
 ;
"RTN","SAMIFLD",513,0)
 ;
"RTN","SAMIFLD",514,0)
 ;
"RTN","SAMIFLD",515,0)
 ;@section 3 code for ppis $$GETNAME,$$GETSSN,$$GETPRFX^SAMIFORM
"RTN","SAMIFLD",516,0)
 ;
"RTN","SAMIFLD",517,0)
 ;
"RTN","SAMIFLD",518,0)
 ;
"RTN","SAMIFLD",519,0)
 ;@ppi-code $$GETNAME^SAMIFORM
"RTN","SAMIFLD",520,0)
GETNAME ; name for patient sid
"RTN","SAMIFLD",521,0)
 ;
"RTN","SAMIFLD",522,0)
 ;@signature
"RTN","SAMIFLD",523,0)
 ; $$GETNAME^SAMIFORM(sid)
"RTN","SAMIFLD",524,0)
 ;@branches-from
"RTN","SAMIFLD",525,0)
 ; GETNAME^SAMIFORM
"RTN","SAMIFLD",526,0)
 ;@ppi-called-by
"RTN","SAMIFLD",527,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",528,0)
 ;@called-by: none
"RTN","SAMIFLD",529,0)
 ;@calls
"RTN","SAMIFLD",530,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",531,0)
 ;@input
"RTN","SAMIFLD",532,0)
 ; sid = patient study id
"RTN","SAMIFLD",533,0)
 ;@output = patient's name
"RTN","SAMIFLD",534,0)
 ;@tests
"RTN","SAMIFLD",535,0)
 ; UTGTNM^SAMIUTF2: name for patient sid
"RTN","SAMIFLD",536,0)
 ;
"RTN","SAMIFLD",537,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",538,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",539,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",540,0)
 quit:ien=""
"RTN","SAMIFLD",541,0)
 ;
"RTN","SAMIFLD",542,0)
 quit @root@(ien,"saminame") ; end of ppi $$GETNAME^SAMIFORM
"RTN","SAMIFLD",543,0)
 ;
"RTN","SAMIFLD",544,0)
 ;
"RTN","SAMIFLD",545,0)
 ;
"RTN","SAMIFLD",546,0)
 ;@ppi-code $$GETSSN^SAMIFORM
"RTN","SAMIFLD",547,0)
GETSSN ; ssn for patient sid
"RTN","SAMIFLD",548,0)
 ;
"RTN","SAMIFLD",549,0)
 ;@signature
"RTN","SAMIFLD",550,0)
 ; $$GETSSN^SAMIFORM(sid)
"RTN","SAMIFLD",551,0)
 ;@branches-from
"RTN","SAMIFLD",552,0)
 ; GETSSN^SAMIFORM
"RTN","SAMIFLD",553,0)
 ;@ppi-called-by
"RTN","SAMIFLD",554,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",555,0)
 ;@called-by: none
"RTN","SAMIFLD",556,0)
 ;@calls
"RTN","SAMIFLD",557,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",558,0)
 ;@input
"RTN","SAMIFLD",559,0)
 ; sid = patient study id
"RTN","SAMIFLD",560,0)
 ;@output = patient's ssn
"RTN","SAMIFLD",561,0)
 ;@tests
"RTN","SAMIFLD",562,0)
 ; UTGSSN^SAMIUTF2: ssn for patient sid
"RTN","SAMIFLD",563,0)
 ;
"RTN","SAMIFLD",564,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",565,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",566,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",567,0)
 quit:ien=""
"RTN","SAMIFLD",568,0)
 ;
"RTN","SAMIFLD",569,0)
 new pssn set pssn=$get(@root@(ien,"sissn"))
"RTN","SAMIFLD",570,0)
 if pssn["sta" set pssn=""
"RTN","SAMIFLD",571,0)
 if pssn="" do  ;
"RTN","SAMIFLD",572,0)
 . new orgssn set orgssn=$get(@root@(ien,"ssn"))
"RTN","SAMIFLD",573,0)
 . quit:orgssn=""
"RTN","SAMIFLD",574,0)
 . set pssn=$extract(orgssn,1,3)_"-"_$extract(orgssn,4,5)_"-"_$extract(orgssn,6,9)
"RTN","SAMIFLD",575,0)
 . set @root@(ien,"sissn")=pssn
"RTN","SAMIFLD",576,0)
 . quit
"RTN","SAMIFLD",577,0)
 ;
"RTN","SAMIFLD",578,0)
 quit pssn ; end of ppi $$GETSSN^SAMIFORM
"RTN","SAMIFLD",579,0)
 ;
"RTN","SAMIFLD",580,0)
 ;
"RTN","SAMIFLD",581,0)
 ;
"RTN","SAMIFLD",582,0)
 ;@ppi-code $$GETPRFX^SAMIFORM [deprecated]
"RTN","SAMIFLD",583,0)
GETPRFX ; Retrieve study ID prefix from parameter file
"RTN","SAMIFLD",584,0)
 ; This subroutine is deprecated as of the multi-tenancy features.
"RTN","SAMIFLD",585,0)
 ;
"RTN","SAMIFLD",586,0)
 ;@signature
"RTN","SAMIFLD",587,0)
 ; $$GETPRFX^SAMIFORM()
"RTN","SAMIFLD",588,0)
 ;@branches-from
"RTN","SAMIFLD",589,0)
 ; GETPRFX^SAMIFORM
"RTN","SAMIFLD",590,0)
 ;@ppi-called-by
"RTN","SAMIFLD",591,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",592,0)
 ;@calls
"RTN","SAMIFLD",593,0)
 ; $$GET^XPAR
"RTN","SAMIFLD",594,0)
 ;@output = patient's ssn
"RTN","SAMIFLD",595,0)
 ;@tests
"RTN","SAMIFLD",596,0)
 ; None yet
"RTN","SAMIFLD",597,0)
 ;
"RTN","SAMIFLD",598,0)
 new prefix
"RTN","SAMIFLD",599,0)
 ;set prefix=$$GET^XPAR("SYS","SAMI SID PREFIX",,"Q")
"RTN","SAMIFLD",600,0)
 s prefix=$g(ARG("siteid"))
"RTN","SAMIFLD",601,0)
 i prefix="" s prefix=$g(ARG("site"))
"RTN","SAMIFLD",602,0)
 if $get(prefix)="" set prefix="UNK"
"RTN","SAMIFLD",603,0)
 ;
"RTN","SAMIFLD",604,0)
 quit prefix ; end of ppi $$GETPRFX^SAMIFORM
"RTN","SAMIFLD",605,0)
 ;
"RTN","SAMIFLD",606,0)
 ;
"RTN","SAMIFLD",607,0)
 ;
"RTN","SAMIFLD",608,0)
EOR ; end of routine SAMIFLD
"RTN","SAMIFUL")
0^5^B129116
"RTN","SAMIFUL",1,0)
SAMIFUL ;ven/gpl - vapals-elcap: form log ;2021-03-21T23:32Z
"RTN","SAMIFUL",2,0)
 ;;18.0;SAMI;**10**;2020-01;Build 1
"RTN","SAMIFUL",3,0)
 ;;1.18.0.10-i10
"RTN","SAMIFUL",4,0)
 ;
"RTN","SAMIFUL",5,0)
 ; SAMIFUL contains routine & module info & the primary development
"RTN","SAMIFUL",6,0)
 ; log for VAPALS-ELCAP's Form module, SAMIF.
"RTN","SAMIFUL",7,0)
 ; It contains no public interfaces or executable code.
"RTN","SAMIFUL",8,0)
 ;
"RTN","SAMIFUL",9,0)
 quit  ; no entry from top
"RTN","SAMIFUL",10,0)
 ;
"RTN","SAMIFUL",11,0)
 ;
"RTN","SAMIFUL",12,0)
 ;
"RTN","SAMIFUL",13,0)
 ;@section 0 primary development
"RTN","SAMIFUL",14,0)
 ;
"RTN","SAMIFUL",15,0)
 ;
"RTN","SAMIFUL",16,0)
 ;
"RTN","SAMIFUL",17,0)
 ;@routine-credits
"RTN","SAMIFUL",18,0)
 ;@primary-dev George P. Lilly (gpl)
"RTN","SAMIFUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIFUL",20,0)
 ;@primary-dev-org Vista Expertise Network (ven)
"RTN","SAMIFUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMIFUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIFUL",23,0)
 ;@license Apache 2.0
"RTN","SAMIFUL",24,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMIFUL",25,0)
 ;
"RTN","SAMIFUL",26,0)
 ;@last-updated 2021-03-21T23:32Z
"RTN","SAMIFUL",27,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIFUL",28,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIFUL",29,0)
 ;@version 1.18.0.10-i10
"RTN","SAMIFUL",30,0)
 ;@release-date 2020-01
"RTN","SAMIFUL",31,0)
 ;@patch-list **10**
"RTN","SAMIFUL",32,0)
 ;
"RTN","SAMIFUL",33,0)
 ;@additional-dev Frederick D. S. Marshall (toad)
"RTN","SAMIFUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMIFUL",35,0)
 ;@additional-dev Larry G. Carlson (lgc)
"RTN","SAMIFUL",36,0)
 ; lgc@vistaexpertise.net
"RTN","SAMIFUL",37,0)
 ;@additional-dev Alexis Carlson (arc)
"RTN","SAMIFUL",38,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMIFUL",39,0)
 ;@additional-dev Domenic DiNatale (dom)
"RTN","SAMIFUL",40,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMIFUL",41,0)
 ;
"RTN","SAMIFUL",42,0)
 ;@module-credits
"RTN","SAMIFUL",43,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIFUL",44,0)
 ; (VA-PALS)
"RTN","SAMIFUL",45,0)
 ; http://va-pals.org/
"RTN","SAMIFUL",46,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIFUL",47,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIFUL",48,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIFUL",49,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIFUL",50,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIFUL",51,0)
 ; http://ielcap.com/
"RTN","SAMIFUL",52,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIFUL",53,0)
 ; http://paraxialtech.com/
"RTN","SAMIFUL",54,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIFUL",55,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIFUL",56,0)
 ;
"RTN","SAMIFUL",57,0)
 ;@module-log
"RTN","SAMIFUL",58,0)
 ; 2017-09-19 ven/gpl 1.18.0-t01 
"RTN","SAMIFUL",59,0)
 ;  SAMIFRM: initialize SAMI FORM file from elcap-patient graphs,
"RTN","SAMIFUL",60,0)
 ; using mash tools & graphs (%yottaq,^%wd).
"RTN","SAMIFUL",61,0)
 ;
"RTN","SAMIFUL",62,0)
 ; 2017-09-18 ven/gpl 1.18.0-t01
"RTN","SAMIFUL",63,0)
 ;  SAMIFRM: update.
"RTN","SAMIFUL",64,0)
 ;
"RTN","SAMIFUL",65,0)
 ; 2017-12-18 ven/gpl 1.18.0-t01
"RTN","SAMIFUL",66,0)
 ;  SAMIFRM: update.
"RTN","SAMIFUL",67,0)
 ;
"RTN","SAMIFUL",68,0)
 ; 2018-01-03 ven/gpl 1.18.0-t01
"RTN","SAMIFUL",69,0)
 ;  SAMIFRM: update.
"RTN","SAMIFUL",70,0)
 ;
"RTN","SAMIFUL",71,0)
 ; 2018-01-14 ven/gpl 1.18.0-t01
"RTN","SAMIFUL",72,0)
 ;  SAMIFRM: update.
"RTN","SAMIFUL",73,0)
 ;
"RTN","SAMIFUL",74,0)
 ; 2018-02-04 ven/gpl 1.18.0-t01
"RTN","SAMIFUL",75,0)
 ;  SAMIFRM: update.
"RTN","SAMIFUL",76,0)
 ;
"RTN","SAMIFUL",77,0)
 ; 2018-02-05/07 ven/toad 1.18.0-t04
"RTN","SAMIFUL",78,0)
 ;  SAMIFRM: update license & attribution & hdr comments, add white
"RTN","SAMIFUL",79,0)
 ; space & do-dot quits, spell out language elements; in SAMISUBS
"RTN","SAMIFUL",80,0)
 ; replaceAll^%wfhform > replaceAll^%wf; $$setroot^%yottaq > 
"RTN","SAMIFUL",81,0)
 ; $$setroot^%wdgraph; getVals^%yottaq > getVals^%wf.
"RTN","SAMIFUL",82,0)
 ;
"RTN","SAMIFUL",83,0)
 ; 2018-02-14 ven/toad 1.18.0-t04
"RTN","SAMIFUL",84,0)
 ;  SAMIFRM: replaceAll^%wf > findReplaceAll^%wf, ln > line, add
"RTN","SAMIFUL",85,0)
 ; @calls & @called-by tags, break up some long lines, scope variables
"RTN","SAMIFUL",86,0)
 ; in $$GETDIR & $$GETFN.
"RTN","SAMIFUL",87,0)
 ;
"RTN","SAMIFUL",88,0)
 ; 2018-03-01 ven/toad 1.18.0-t04
"RTN","SAMIFUL",89,0)
 ;  SAMIFRM: findReplaceAll^%wf > findReplace^%ts.
"RTN","SAMIFUL",90,0)
 ;
"RTN","SAMIFUL",91,0)
 ; 2018-03-07/08 ven/toad 1.18.0-t04
"RTN","SAMIFUL",92,0)
 ;  SAMIFRM: in SAMISUBS $$setroot^%wdgraph > $$setroot^%wf, fix bug
"RTN","SAMIFUL",93,0)
 ; when r/css w/see.
"RTN","SAMIFUL",94,0)
 ;
"RTN","SAMIFUL",95,0)
 ; 2018-03-18 ven/toad 1.18.0-t04
"RTN","SAMIFUL",96,0)
 ;  SAMIFRM2: restore calls to findReplaceAll^%ts.
"RTN","SAMIFUL",97,0)
 ;
"RTN","SAMIFUL",98,0)
 ; 2018-03-21/04-02 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",99,0)
 ;  SAMIFRM2: insert max date, chg case review navigation to post,
"RTN","SAMIFUL",100,0)
 ; date order for CT Eval in case review; support incomplete forms
"RTN","SAMIFUL",101,0)
 ; display & processing; fix to not inject html in javascript for case
"RTN","SAMIFUL",102,0)
 ; review navigation; fix followup submit.
"RTN","SAMIFUL",103,0)
 ;
"RTN","SAMIFUL",104,0)
 ; 2018-04-24 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",105,0)
 ;  SAMIFRM2: add Pet & Biopsy forms.
"RTN","SAMIFUL",106,0)
 ;
"RTN","SAMIFUL",107,0)
 ; 2018-05-18/21 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",108,0)
 ;  SAMIFRM2: convert to new graph, simplify forms processing.
"RTN","SAMIFUL",109,0)
 ;
"RTN","SAMIFUL",110,0)
 ; 2018-05-22 par/dom 1.18.0-t04
"RTN","SAMIFUL",111,0)
 ;  SAMIFRM2: VAP-95 - remove code that replaced hard-coded date
"RTN","SAMIFUL",112,0)
 ; w/"today" from backend, no longer needed.
"RTN","SAMIFUL",113,0)
 ;
"RTN","SAMIFUL",114,0)
 ; 2018-05-24 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",115,0)
 ;  SAMIFRM2: changes for submit processing on forms.
"RTN","SAMIFUL",116,0)
 ;
"RTN","SAMIFUL",117,0)
 ; 2018-05-25 par/dom 1.18.0-t04
"RTN","SAMIFUL",118,0)
 ;  SAMIFRM2: merge pull request 3 fr/OSEHRA/VAP-95-Remove-Today-Text-
"RTN","SAMIFUL",119,0)
 ; Replacement2. VAP-95 remove today text replacement.
"RTN","SAMIFUL",120,0)
 ;
"RTN","SAMIFUL",121,0)
 ; 2018-05-25 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",122,0)
 ;  SAMIFRM2: add STUDYID for txt replace; more changes for STUDYID
"RTN","SAMIFUL",123,0)
 ; substitution.
"RTN","SAMIFUL",124,0)
 ;
"RTN","SAMIFUL",125,0)
 ; 2018-07-11 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",126,0)
 ;  SAMIFRM2: add FROZEN variable based on samistatus=compete.
"RTN","SAMIFUL",127,0)
 ;
"RTN","SAMIFUL",128,0)
 ; 2018-08-19 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",129,0)
 ;  SAMIFRM2: use ssn instead of last5 where available; revise ssn
"RTN","SAMIFUL",130,0)
 ; formatting.
"RTN","SAMIFUL",131,0)
 ;
"RTN","SAMIFUL",132,0)
 ; 2018-09-30 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",133,0)
 ;  SAMIFRM2: header & prefill of intake.
"RTN","SAMIFUL",134,0)
 ;
"RTN","SAMIFUL",135,0)
 ; 2018-10-15 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",136,0)
 ;  SAMIFRM2: initial user reports: enrollment.
"RTN","SAMIFUL",137,0)
 ;
"RTN","SAMIFUL",138,0)
 ; 2018-10-31 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",139,0)
 ;  SAMIFRM2: new input form features, report menu fix.
"RTN","SAMIFUL",140,0)
 ;
"RTN","SAMIFUL",141,0)
 ; 2018-11-13 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",142,0)
 ;  SAMIFRM2: SAMIHOM2 > SAMIHOM3.
"RTN","SAMIFUL",143,0)
 ;
"RTN","SAMIFUL",144,0)
 ; 2018-11-14 ven/gpl 1.18.0-t04
"RTN","SAMIFUL",145,0)
 ;  SAMIFRM2: fix graph store forms.
"RTN","SAMIFUL",146,0)
 ;
"RTN","SAMIFUL",147,0)
 ; 2018-11-29 ven/lgc 1.18.0-t04
"RTN","SAMIFUL",148,0)
 ;  SAMIFRM2: ongoing unit-test work.
"RTN","SAMIFUL",149,0)
 ;
"RTN","SAMIFUL",150,0)
 ; 2018-12-11/12 ven/toad 1.18.0-t04
"RTN","SAMIFUL",151,0)
 ;  SAMIFRM2: update chg log; in SAMISUB2 r/last findReplace^%ts w/a
"RTN","SAMIFUL",152,0)
 ; flag & r/w/findReplaceAll^%ts; passim spell out language elements,
"RTN","SAMIFUL",153,0)
 ; update tags called-by, calls, tests; namespace call-by-ref & call-
"RTN","SAMIFUL",154,0)
 ; by-name actuals.
"RTN","SAMIFUL",155,0)
 ;
"RTN","SAMIFUL",156,0)
 ; 2019-01-02/17 ven/toad 1.18.0-t04
"RTN","SAMIFUL",157,0)
 ;  SAMIFRM2: update chg log; in INIT1FRM id > form; doc signatures,
"RTN","SAMIFUL",158,0)
 ; web services, unit tests, dmis, ppis, input, output, thruput.
"RTN","SAMIFUL",159,0)
 ;  SAMIFUL: create from SAMIFRM2 as primary development log.
"RTN","SAMIFUL",160,0)
 ;  SAMIFLD: create from SAMIFRM2 w/SAMISUB2,GETHDR,GETLAST5,FIXSRC,
"RTN","SAMIFUL",161,0)
 ; FIXHREF,GETNAME,GETSSN; SAMISUB2 > LOAD, reroute calls, namespace
"RTN","SAMIFUL",162,0)
 ; filter > SAMIFILTER, %j > SAMILNUM, zhtml > SAMIHTML, vals >
"RTN","SAMIFUL",163,0)
 ; SAMIVALS (& add to params), key > form; convert to ppi-code (no
"RTN","SAMIFUL",164,0)
 ; params); minor edits.
"RTN","SAMIFUL",165,0)
 ;  SAMIFORM: create from SAMIFRM2 w/all ppi, dmi, & wsi entry points,
"RTN","SAMIFUL",166,0)
 ; no code, goto code in other routines.
"RTN","SAMIFUL",167,0)
 ;  SAMIFWS: create from SAMIFRM2 w/WSSBFORM,WSSIFORM,WSCEFORM;
"RTN","SAMIFUL",168,0)
 ; convert to ppi-code (no params); minor edits.
"RTN","SAMIFUL",169,0)
 ;  SAMIFDM: create from SAMIFRM2, INITFRMS > INIT, INIT1FRM > INIT1,
"RTN","SAMIFUL",170,0)
 ; REGFORMS > REGISTER, LOADDATA > IMPORT,PRSFLNM,GETDIR,GETFN;
"RTN","SAMIFUL",171,0)
 ; convert to ppi-code (no params); annotate & minor edits; move unit-
"RTN","SAMIFUL",172,0)
 ; test switch to cover more code.
"RTN","SAMIFUL",173,0)
 ;  related changes:
"RTN","SAMIFUL",174,0)
 ;  SAMICAS2,SAMICASE,SAMIFLD,SAMINOTI,SAMIUR,SAMIUR1,SAMIUTF,%tsfwr,
"RTN","SAMIFUL",175,0)
 ; %tsfwra,%wfhform: passim SAMIFRM2 > SAMIFORM.
"RTN","SAMIFUL",176,0)
 ;  SAMIUTST: SAMIFRM2 > SAMIFORM, add SAMIFLD,SAMIFDM,SAMIFWS.
"RTN","SAMIFUL",177,0)
 ;
"RTN","SAMIFUL",178,0)
 ; 2019-03-26 ven/lgc 1.18.0-t04
"RTN","SAMIFUL",179,0)
 ;  SAMIFLD: Add changlog code to end of LOAD^SAMIFLD code to account
"RTN","SAMIFUL",180,0)
 ; for new changelog functionality.
"RTN","SAMIFUL",181,0)
 ;
"RTN","SAMIFUL",182,0)
 ; 2019-03-27 ven/lgc 1.18.0-t04
"RTN","SAMIFUL",183,0)
 ;  SAMIFWS: Comment out lines 106, 164, 222 in SAMIFWS;
"RTN","SAMIFUL",184,0)
 ; GETITEMS^SAMICAS2 does not have formal list, may have been part of
"RTN","SAMIFUL",185,0)
 ; temporary debug code.
"RTN","SAMIFUL",186,0)
 ; 106;new items do GETITEMS^SAMICAS2("items",sid)
"RTN","SAMIFUL",187,0)
 ; 164;new items do GETITEMS^SAMICAS2("items",sid)
"RTN","SAMIFUL",188,0)
 ; 222;new items do GETITEMS^SAMICAS2("items",sid)
"RTN","SAMIFUL",189,0)
 ;
"RTN","SAMIFUL",190,0)
 ; 2019-03-28 ven/lgc 1.18.0-t04
"RTN","SAMIFUL",191,0)
 ; SAMIFDM: in IMPORT account for unit test where we do not wish to
"RTN","SAMIFUL",192,0)
 ; prompt user for directory; also modified directory for json files
"RTN","SAMIFUL",193,0)
 ; in repo.
"RTN","SAMIFUL",194,0)
 ;
"RTN","SAMIFUL",195,0)
 ; 2019-03-29 ven/lgc 1.18*0-t04
"RTN","SAMIFUL",196,0)
 ;  SAMIFLD: in LOAD include George's new variables for intake notes.
"RTN","SAMIFUL",197,0)
 ;
"RTN","SAMIFUL",198,0)
 ; 2019-04-16 ven/lgc 1.18.0-t04 e54b76d1
"RTN","SAMIFUL",199,0)
 ;  SAMIFDM,SAMIFLD,SAMIFORM,SAMIFWS: SAMIFRM2 > SAMIFORM.
"RTN","SAMIFUL",200,0)
 ;
"RTN","SAMIFUL",201,0)
 ; 2019-04-16 ven/lgc 1.18.0-t04 e54b76d1
"RTN","SAMIFUL",202,0)
 ;  SAMINOT1: SAMIFRM2 > SAMIFORM.
"RTN","SAMIFUL",203,0)
 ;
"RTN","SAMIFUL",204,0)
 ; 2019-04-18 ven/gpl 1.18.0-t04 2b6f0d63
"RTN","SAMIFUL",205,0)
 ;  SAMIFLD: fix missing patient name.
"RTN","SAMIFUL",206,0)
 ;
"RTN","SAMIFUL",207,0)
 ; 2019-04-22 ven/lgc 1.18.0-t04 e7afbfa1
"RTN","SAMIFUL",208,0)
 ;  SAMIFWS: removal of SAMIFRM2 reference.
"RTN","SAMIFUL",209,0)
 ;
"RTN","SAMIFUL",210,0)
 ; 2019-04-23 ven/lgc 1.18.0-t04 529e8f2f,89bffd3b
"RTN","SAMIFUL",211,0)
 ;  SAMIFDM: comment out zwrite commands.
"RTN","SAMIFUL",212,0)
 ;  SAMIFORM: SAMISUB2 > LOAD.
"RTN","SAMIFUL",213,0)
 ;
"RTN","SAMIFUL",214,0)
 ; 2019-05-08 ven/lgc 1.18.0-t04 33dfa8c2
"RTN","SAMIFUL",215,0)
 ;  SAMIFDM: replace zsystem command with MASH call.
"RTN","SAMIFUL",216,0)
 ;
"RTN","SAMIFUL",217,0)
 ; 2019-06-10/19 ven/arc 1.18.0-t04 5d7a987d,c69b6787
"RTN","SAMIFUL",218,0)
 ;  SAMIFDM: chg explicit paths, unify paths to unit test json data.
"RTN","SAMIFUL",219,0)
 ;
"RTN","SAMIFUL",220,0)
 ; 2019-06-28/07-08 ven/lgc 1.18.0-t04 703c3050
"RTN","SAMIFUL",221,0)
 ;  SAMIFLD: fix patient age calculations, calculate patient age
"RTN","SAMIFUL",222,0)
 ; w/MASH age^%th.
"RTN","SAMIFUL",223,0)
 ;
"RTN","SAMIFUL",224,0)
 ; 2019-08-01 ven/arc 1.18.0-t04 d710f27d
"RTN","SAMIFUL",225,0)
 ;  SAMIFLD,SAMIFORM: pull displayed facility code from vista
"RTN","SAMIFUL",226,0)
 ; parameter.
"RTN","SAMIFUL",227,0)
 ;
"RTN","SAMIFUL",228,0)
 ; 2019-08-03 ven/gpl 1.18.0-t04 bea65f7b,ffc94f65
"RTN","SAMIFUL",229,0)
 ;  SAMIFLD: fix bugs in Have You Ever Smoked processing in changelog
"RTN","SAMIFUL",230,0)
 ; & intake note, fix smoking status on enrollment report, fix change
"RTN","SAMIFUL",231,0)
 ; log display.
"RTN","SAMIFUL",232,0)
 ;
"RTN","SAMIFUL",233,0)
 ; 2019-08-05 ven/gpl 1.18.0-t04 4ee0d3e6
"RTN","SAMIFUL",234,0)
 ;  SAMIFLD: add GETPRFX to avoid colision with VAP-435.
"RTN","SAMIFUL",235,0)
 ;
"RTN","SAMIFUL",236,0)
 ; 2019-08-14 ven/gpl 1.18.0-t04 0aa37766,4e6f4fdf,08d45d99
"RTN","SAMIFUL",237,0)
 ;  SAMIFLD: resolve conflict over semicolon in comment, merge pull
"RTN","SAMIFUL",238,0)
 ; request #70 from OSEHRA/VAP-426-eversmoked, merge with 417.
"RTN","SAMIFUL",239,0)
 ;
"RTN","SAMIFUL",240,0)
 ; 2019-09-26 ven/gpl 1.18.0-t04 92b12324 VAP-420
"RTN","SAMIFUL",241,0)
 ;  SAMIFLD: add smoking history to intake/followup forms (#75).
"RTN","SAMIFUL",242,0)
 ;
"RTN","SAMIFUL",243,0)
 ; 2019-10-22 ven/lgc 1.18.0-t04 613e8ff4
"RTN","SAMIFUL",244,0)
 ;  SAMIFLD: update unit test routines for dfn 1.
"RTN","SAMIFUL",245,0)
 ;
"RTN","SAMIFUL",246,0)
 ; 2019-11-22 par/dom 1.18.0 b2cc389d VAP-458
"RTN","SAMIFUL",247,0)
 ;  SAMIFLD: add new manual registration page.
"RTN","SAMIFUL",248,0)
 ;
"RTN","SAMIFUL",249,0)
 ; 2020-01-21 ven/arc 1.18.0 a4c143be
"RTN","SAMIFUL",250,0)
 ;  SAMIFLD: patient matching additions.
"RTN","SAMIFUL",251,0)
 ;
"RTN","SAMIFUL",252,0)
 ; 2020-04-07/11 ven/gpl 1.18.0.5-i5 36607664,c8f4cf30,2f2c29c1
"RTN","SAMIFUL",253,0)
 ;  SAMIFLD,SAMIFORM,SAMIFWS: multi-tenancy.
"RTN","SAMIFUL",254,0)
 ;
"RTN","SAMIFUL",255,0)
 ; 2021-03-16 ven/gpl 1.18.0.10-i10 002071de
"RTN","SAMIFUL",256,0)
 ;  SAMIFLD: dob age calculation fix from hl7 dob format.
"RTN","SAMIFUL",257,0)
 ;
"RTN","SAMIFUL",258,0)
 ; 2021-03-21 ven/toad 1.18.0.10-i10
"RTN","SAMIFUL",259,0)
 ;  SAMIFLD: bump date & version, lt refactor.
"RTN","SAMIFUL",260,0)
 ;
"RTN","SAMIFUL",261,0)
 ;
"RTN","SAMIFUL",262,0)
 ;
"RTN","SAMIFUL",263,0)
 ;@contents
"RTN","SAMIFUL",264,0)
 ; SAMIFORM: form library
"RTN","SAMIFUL",265,0)
 ; SAMIFDM: form dmi code
"RTN","SAMIFUL",266,0)
 ; SAMIFLD: form load
"RTN","SAMIFUL",267,0)
 ; SAMIFWS: form web-service code
"RTN","SAMIFUL",268,0)
 ; SAMIFUL: form log
"RTN","SAMIFUL",269,0)
 ; SAMIUTF2: form unit tests
"RTN","SAMIFUL",270,0)
 ;
"RTN","SAMIFUL",271,0)
 ;
"RTN","SAMIFUL",272,0)
 ;
"RTN","SAMIFUL",273,0)
EOR ; end of routine SAMIFUL
"RTN","SAMIHOM4")
0^6^B991706712
"RTN","SAMIHOM4",1,0)
SAMIHOM4 ;ven/gpl,arc - homepage web services ;;2022-04-27t22:44z
"RTN","SAMIHOM4",2,0)
 ;;18.0;SAMI;**1,4,5,6,9,12,15,16,17**;2020-01;Build 1
"RTN","SAMIHOM4",3,0)
 ;18-17
"RTN","SAMIHOM4",4,0)
 ;
"RTN","SAMIHOM4",5,0)
 ; SAMIHOM4 contains web services & other subroutines for producing
"RTN","SAMIHOM4",6,0)
 ; the ELCAP Home Page.
"RTN","SAMIHOM4",7,0)
 ;
"RTN","SAMIHOM4",8,0)
 quit  ; no entry from top
"RTN","SAMIHOM4",9,0)
 ;
"RTN","SAMIHOM4",10,0)
 ;
"RTN","SAMIHOM4",11,0)
 ;
"RTN","SAMIHOM4",12,0)
 ;@section 0 primary development
"RTN","SAMIHOM4",13,0)
 ;
"RTN","SAMIHOM4",14,0)
 ;
"RTN","SAMIHOM4",15,0)
 ;
"RTN","SAMIHOM4",16,0)
 ;@license see routine SAMIUL
"RTN","SAMIHOM4",17,0)
 ;@documentation see SAMIHUL
"RTN","SAMIHOM4",18,0)
 ;@contents
"RTN","SAMIHOM4",19,0)
 ;
"RTN","SAMIHOM4",20,0)
 ;  web service get vapals & related subroutines
"RTN","SAMIHOM4",21,0)
 ;
"RTN","SAMIHOM4",22,0)
 ; WSHOME code for wsi WSHOME^SAMIHOM3
"RTN","SAMIHOM4",23,0)
 ;    get vapals (vapals-elcap homepage)
"RTN","SAMIHOM4",24,0)
 ; DEVHOME code for wpi DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",25,0)
 ;    development home page
"RTN","SAMIHOM4",26,0)
 ; GETHOME code for wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",27,0)
 ;    get homepage (not subsequent visit)
"RTN","SAMIHOM4",28,0)
 ;
"RTN","SAMIHOM4",29,0)
 ;  web service post vapals & related subroutines
"RTN","SAMIHOM4",30,0)
 ;
"RTN","SAMIHOM4",31,0)
 ; WSVAPALS code for wsi WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",32,0)
 ;    post vapals (main gateway)
"RTN","SAMIHOM4",33,0)
 ;
"RTN","SAMIHOM4",34,0)
 ;  other
"RTN","SAMIHOM4",35,0)
 ;
"RTN","SAMIHOM4",36,0)
 ; REG manual registration
"RTN","SAMIHOM4",37,0)
 ; MKPTLK creates patient-lookup record
"RTN","SAMIHOM4",38,0)
 ; UPDTFRMS update demographics in all forms for patient
"RTN","SAMIHOM4",39,0)
 ; MERGE merge participant records
"RTN","SAMIHOM4",40,0)
 ; ADDUNMAT adds unmatched report web service to system
"RTN","SAMIHOM4",41,0)
 ; DELUNMAT deletes unmatched web service
"RTN","SAMIHOM4",42,0)
 ; WSUNMAT navigates to unmatched report
"RTN","SAMIHOM4",43,0)
 ; $$DUPSSN true if duplicate ssn
"RTN","SAMIHOM4",44,0)
 ; $$DUPICN true if duplicate icn
"RTN","SAMIHOM4",45,0)
 ; $$BADICN true if ICN checkdigits are wrong
"RTN","SAMIHOM4",46,0)
 ; SAVE save patient-lookup record after edit
"RTN","SAMIHOM4",47,0)
 ; $$REMATCH possible match ien
"RTN","SAMIHOM4",48,0)
 ; SETINFO set information message text
"RTN","SAMIHOM4",49,0)
 ; SETWARN set warning message text
"RTN","SAMIHOM4",50,0)
 ; RTNERR redisplay page w/error message
"RTN","SAMIHOM4",51,0)
 ; RTNPAGE display page
"RTN","SAMIHOM4",52,0)
 ; REINDXPL reindex patient lookup
"RTN","SAMIHOM4",53,0)
 ; INDXPTLK generate index entries in patient-lookup graph
"RTN","SAMIHOM4",54,0)
 ; UNINDXPT remove index entries from patient-lookup graph
"RTN","SAMIHOM4",55,0)
 ; $$UCASE uppercase
"RTN","SAMIHOM4",56,0)
 ; WSNEWCAS code for wr newcase (creates new case)
"RTN","SAMIHOM4",57,0)
 ;
"RTN","SAMIHOM4",58,0)
 ;@to-do
"RTN","SAMIHOM4",59,0)
 ; Add label comments
"RTN","SAMIHOM4",60,0)
 ;
"RTN","SAMIHOM4",61,0)
 ;
"RTN","SAMIHOM4",62,0)
 ;
"RTN","SAMIHOM4",63,0)
 ;@section 1 web service get vapals & related subroutines
"RTN","SAMIHOM4",64,0)
 ;
"RTN","SAMIHOM4",65,0)
 ;
"RTN","SAMIHOM4",66,0)
 ;
"RTN","SAMIHOM4",67,0)
 ;@wsi-code WSHOME^SAMIHOM3
"RTN","SAMIHOM4",68,0)
WSHOME ; get vapals (vapals-elcap homepage)
"RTN","SAMIHOM4",69,0)
 ;
"RTN","SAMIHOM4",70,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",71,0)
 ;
"RTN","SAMIHOM4",72,0)
 ;ven/gpl;wsi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",73,0)
 ;@signature
"RTN","SAMIHOM4",74,0)
 ; do WSHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",75,0)
 ;@branches-from
"RTN","SAMIHOM4",76,0)
 ; WSHOME^SAMIHOM3
"RTN","SAMIHOM4",77,0)
 ;@wsi-called-by
"RTN","SAMIHOM4",78,0)
 ; web service get vapals
"RTN","SAMIHOM4",79,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",80,0)
 ; LOGIN^SAMISITE
"RTN","SAMIHOM4",81,0)
 ;@called-by none
"RTN","SAMIHOM4",82,0)
 ;@calls
"RTN","SAMIHOM4",83,0)
 ; DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",84,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",85,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",86,0)
 ;@input
"RTN","SAMIHOM4",87,0)
 ; SAMIFILTER (no parameters required)
"RTN","SAMIHOM4",88,0)
 ;@output
"RTN","SAMIHOM4",89,0)
 ; .SAMIRTN
"RTN","SAMIHOM4",90,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",91,0)
 ;@tests
"RTN","SAMIHOM4",92,0)
 ; UTWSHM^SAMIUTH3
"RTN","SAMIHOM4",93,0)
 ; UTWSHM1^SAMIUTH3
"RTN","SAMIHOM4",94,0)
 ; UTWSHM2^SAMIUTH3
"RTN","SAMIHOM4",95,0)
 ;
"RTN","SAMIHOM4",96,0)
 ;
"RTN","SAMIHOM4",97,0)
 ;@stanza 2 route to appropriate homepage or bypass to other webpage
"RTN","SAMIHOM4",98,0)
 ;
"RTN","SAMIHOM4",99,0)
 ; present development homepage for testing
"RTN","SAMIHOM4",100,0)
 if $get(SAMIFILTER("test"))=1 do  quit
"RTN","SAMIHOM4",101,0)
 . do DEVHOME^SAMIHOM3(.SAMIRTN,.SAMIFILTER)
"RTN","SAMIHOM4",102,0)
 . quit
"RTN","SAMIHOM4",103,0)
 ;
"RTN","SAMIHOM4",104,0)
 ; bypass for get access to pages
"RTN","SAMIHOM4",105,0)
 if $g(SAMIFILTER("samiroute"))'="" do  quit
"RTN","SAMIHOM4",106,0)
 . new SAMIBODY set SAMIBODY(1)=""
"RTN","SAMIHOM4",107,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIBODY,.SAMIRTN)
"RTN","SAMIHOM4",108,0)
 . quit
"RTN","SAMIHOM4",109,0)
 ;
"RTN","SAMIHOM4",110,0)
 ; V4W/DLW - bypass for get access from CPRS
"RTN","SAMIHOM4",111,0)
 if $get(SAMIFILTER("dfn"))'="" do  quit
"RTN","SAMIHOM4",112,0)
 . new dfn set dfn=$get(SAMIFILTER("dfn"))
"RTN","SAMIHOM4",113,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",114,0)
 . new studyid set studyid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIHOM4",115,0)
 . new SAMIBODY
"RTN","SAMIHOM4",116,0)
 . if studyid'="" do
"RTN","SAMIHOM4",117,0)
 . . set SAMIBODY(1)="samiroute=casereview&dfn="_dfn_"&studyid="_studyid
"RTN","SAMIHOM4",118,0)
 . . quit
"RTN","SAMIHOM4",119,0)
 . else  do
"RTN","SAMIHOM4",120,0)
 . . set SAMIBODY(1)="samiroute=lookup&dfn="_dfn_"&studyid="_studyid
"RTN","SAMIHOM4",121,0)
 . . quit
"RTN","SAMIHOM4",122,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIBODY,.SAMIRTN)
"RTN","SAMIHOM4",123,0)
 . quit
"RTN","SAMIHOM4",124,0)
 ;
"RTN","SAMIHOM4",125,0)
 ; default to VAPALS homepage
"RTN","SAMIHOM4",126,0)
 do GETHOME^SAMIHOM3(.SAMIRTN,.SAMIFILTER)
"RTN","SAMIHOM4",127,0)
 ;
"RTN","SAMIHOM4",128,0)
 ;
"RTN","SAMIHOM4",129,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",130,0)
 ;
"RTN","SAMIHOM4",131,0)
 quit  ; end of wsi WSHOME^SAMIHOM3
"RTN","SAMIHOM4",132,0)
 ;
"RTN","SAMIHOM4",133,0)
 ;
"RTN","SAMIHOM4",134,0)
 ;
"RTN","SAMIHOM4",135,0)
 ;@wpi-code DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",136,0)
DEVHOME ; development home page
"RTN","SAMIHOM4",137,0)
 ;
"RTN","SAMIHOM4",138,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",139,0)
 ;
"RTN","SAMIHOM4",140,0)
 ;ven/gpl;wpi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",141,0)
 ;@signature
"RTN","SAMIHOM4",142,0)
 ; do DEVHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",143,0)
 ;@branches-from
"RTN","SAMIHOM4",144,0)
 ; DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",145,0)
 ;@wpi-called-by
"RTN","SAMIHOM4",146,0)
 ; wsi WSHOME^SAMIHOM3 [web service get vapals]
"RTN","SAMIHOM4",147,0)
 ;@called-by none
"RTN","SAMIHOM4",148,0)
 ;@calls
"RTN","SAMIHOM4",149,0)
 ; htmltb2^%yottaweb
"RTN","SAMIHOM4",150,0)
 ; PATLIST^SAMIHOM3
"RTN","SAMIHOM4",151,0)
 ; genhtml^%yottautl
"RTN","SAMIHOM4",152,0)
 ; addary^%yottautl
"RTN","SAMIHOM4",153,0)
 ;@input
"RTN","SAMIHOM4",154,0)
 ; SAMIFILTER =
"RTN","SAMIHOM4",155,0)
 ;@output
"RTN","SAMIHOM4",156,0)
 ;.SAMIRTN =
"RTN","SAMIHOM4",157,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",158,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",159,0)
 ;
"RTN","SAMIHOM4",160,0)
 ;
"RTN","SAMIHOM4",161,0)
 ;@stanza 2 present development homepage
"RTN","SAMIHOM4",162,0)
 ;
"RTN","SAMIHOM4",163,0)
 new gtop,gbot
"RTN","SAMIHOM4",164,0)
 do htmltb2^%yottaweb(.gtop,.gbot,"SAMI Test Patients")
"RTN","SAMIHOM4",165,0)
 ;
"RTN","SAMIHOM4",166,0)
 new html,ary,hpat
"RTN","SAMIHOM4",167,0)
 do PATLIST^SAMIHOM3("hpat")
"RTN","SAMIHOM4",168,0)
 quit:'$data(hpat)
"RTN","SAMIHOM4",169,0)
 ;
"RTN","SAMIHOM4",170,0)
 set ary("title")="SAMI Test Patients on this system"
"RTN","SAMIHOM4",171,0)
 set ary("header",1)="StudyId"
"RTN","SAMIHOM4",172,0)
 set ary("header",2)="Name"
"RTN","SAMIHOM4",173,0)
 ;
"RTN","SAMIHOM4",174,0)
 new cnt set cnt=0
"RTN","SAMIHOM4",175,0)
 new zi set zi=""
"RTN","SAMIHOM4",176,0)
 for  do  quit:zi=""
"RTN","SAMIHOM4",177,0)
 . set zi=$order(hpat(zi))
"RTN","SAMIHOM4",178,0)
 . quit:zi=""
"RTN","SAMIHOM4",179,0)
 . ;
"RTN","SAMIHOM4",180,0)
 . set cnt=cnt+1
"RTN","SAMIHOM4",181,0)
 . new url set url="<a href=""/cform.cgi?studyId="_zi_""">"_zi_"</a>"
"RTN","SAMIHOM4",182,0)
 . set ary(cnt,1)=url
"RTN","SAMIHOM4",183,0)
 . set ary(cnt,2)=""
"RTN","SAMIHOM4",184,0)
 . quit
"RTN","SAMIHOM4",185,0)
 ;
"RTN","SAMIHOM4",186,0)
 do genhtml^%yottautl("html","ary")
"RTN","SAMIHOM4",187,0)
 ;
"RTN","SAMIHOM4",188,0)
 do addary^%yottautl("SAMIRTN","gtop")
"RTN","SAMIHOM4",189,0)
 do addary^%yottautl("SAMIRTN","html")
"RTN","SAMIHOM4",190,0)
 set SAMIRTN($order(SAMIRTN(""),-1)+1)=gbot
"RTN","SAMIHOM4",191,0)
 kill SAMIRTN(0)
"RTN","SAMIHOM4",192,0)
 ;
"RTN","SAMIHOM4",193,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMIHOM4",194,0)
 ;
"RTN","SAMIHOM4",195,0)
 ;
"RTN","SAMIHOM4",196,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",197,0)
 ;
"RTN","SAMIHOM4",198,0)
 quit  ; end of wpi DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",199,0)
 ;
"RTN","SAMIHOM4",200,0)
 ;
"RTN","SAMIHOM4",201,0)
 ;
"RTN","SAMIHOM4",202,0)
 ;@wpi-code GETHOME^SAMIHOM3
"RTN","SAMIHOM4",203,0)
GETHOME ; get homepage (not subsequent visit)
"RTN","SAMIHOM4",204,0)
 ;
"RTN","SAMIHOM4",205,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",206,0)
 ;
"RTN","SAMIHOM4",207,0)
 ;ven/gpl;wpi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",208,0)
 ;@signature
"RTN","SAMIHOM4",209,0)
 ; do GETHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",210,0)
 ;@branches-from
"RTN","SAMIHOM4",211,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",212,0)
 ;@wpi-called-by
"RTN","SAMIHOM4",213,0)
 ; WSHOME
"RTN","SAMIHOM4",214,0)
 ; WSVAPALS
"RTN","SAMIHOM4",215,0)
 ; SAVE
"RTN","SAMIHOM4",216,0)
 ;  WSNEWCAS [commented out]
"RTN","SAMIHOM4",217,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMIHOM4",218,0)
 ; WSLOOKUP^SAMISRC2
"RTN","SAMIHOM4",219,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIHOM4",220,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIHOM4",221,0)
 ;@called-by none
"RTN","SAMIHOM4",222,0)
 ;@calls
"RTN","SAMIHOM4",223,0)
 ; $$FINDSITE^SAMISITE
"RTN","SAMIHOM4",224,0)
 ; GETTMPL^SAMICASE
"RTN","SAMIHOM4",225,0)
 ; MERGEHTM^%wf
"RTN","SAMIHOM4",226,0)
 ; ADDCRLF^VPRJRUT
"RTN","SAMIHOM4",227,0)
 ;@input
"RTN","SAMIHOM4",228,0)
 ; SAMIFILTER
"RTN","SAMIHOM4",229,0)
 ;@output
"RTN","SAMIHOM4",230,0)
 ; .SAMIRTN
"RTN","SAMIHOM4",231,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",232,0)
 ;@tests
"RTN","SAMIHOM4",233,0)
 ; UTGETHM^SAMIUTH3
"RTN","SAMIHOM4",234,0)
 ; UTSCAN4^SAMIUTH3
"RTN","SAMIHOM4",235,0)
 ;
"RTN","SAMIHOM4",236,0)
 ;
"RTN","SAMIHOM4",237,0)
 ;@stanza 2 get template for homepage
"RTN","SAMIHOM4",238,0)
 ;
"RTN","SAMIHOM4",239,0)
 ; Processing for multi-tenancy
"RTN","SAMIHOM4",240,0)
 ;
"RTN","SAMIHOM4",241,0)
 i $g(HTTPREQ("method"))="GET" d  ;
"RTN","SAMIHOM4",242,0)
 . s SAMIFILTER("siteid")=""
"RTN","SAMIHOM4",243,0)
 ;
"RTN","SAMIHOM4",244,0)
 if $get(SAMIFILTER("siteid"))="" if '$$FINDSITE^SAMISITE(.SAMIRTN,.SAMIFILTER) quit 0
"RTN","SAMIHOM4",245,0)
 new SAMISITE,SAMITITL
"RTN","SAMIHOM4",246,0)
 set SAMISITE=$get(SAMIFILTER("siteid"))
"RTN","SAMIHOM4",247,0)
 set SAMITITL=$get(SAMIFILTER("sitetitle"))
"RTN","SAMIHOM4",248,0)
 ;
"RTN","SAMIHOM4",249,0)
 new VASITE set VASITE=$$GET1PARM^SAMIPARM("veteransAffairsSite",SAMISITE)
"RTN","SAMIHOM4",250,0)
 set SAMIFILTER("veteransAffairsSite")=VASITE
"RTN","SAMIHOM4",251,0)
 ;
"RTN","SAMIHOM4",252,0)
 new temp,tout,form
"RTN","SAMIHOM4",253,0)
 set form="vapals:home"
"RTN","SAMIHOM4",254,0)
 do GETTMPL^SAMICASE("temp",form)
"RTN","SAMIHOM4",255,0)
 quit:'$data(temp)
"RTN","SAMIHOM4",256,0)
 ;
"RTN","SAMIHOM4",257,0)
 ;
"RTN","SAMIHOM4",258,0)
 ;@stanza 3 process homepage template
"RTN","SAMIHOM4",259,0)
 ;
"RTN","SAMIHOM4",260,0)
 new err
"RTN","SAMIHOM4",261,0)
 do MERGEHTM^%wf(.temp,.SAMIFILTER,.err)
"RTN","SAMIHOM4",262,0)
 ;
"RTN","SAMIHOM4",263,0)
 do ADDCRLF^VPRJRUT(.temp)
"RTN","SAMIHOM4",264,0)
 merge SAMIRTN=temp
"RTN","SAMIHOM4",265,0)
 ;
"RTN","SAMIHOM4",266,0)
 ;
"RTN","SAMIHOM4",267,0)
 ;@stanza 4 termination
"RTN","SAMIHOM4",268,0)
 ;
"RTN","SAMIHOM4",269,0)
 quit  ; end of wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",270,0)
 ;
"RTN","SAMIHOM4",271,0)
 ;
"RTN","SAMIHOM4",272,0)
 ;
"RTN","SAMIHOM4",273,0)
 ; below is redacted from GETHOME^SAMIHOM3
"RTN","SAMIHOM4",274,0)
 ;
"RTN","SAMIHOM4",275,0)
 ;@old-calls
"RTN","SAMIHOM4",276,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIHOM4",277,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIHOM4",278,0)
 ; $$GET^XPAR
"RTN","SAMIHOM4",279,0)
 ; findReplace^%ts
"RTN","SAMIHOM4",280,0)
 ; ADDCRLF^VPRJRUT
"RTN","SAMIHOM4",281,0)
 ;
"RTN","SAMIHOM4",282,0)
 new cnt set cnt=0
"RTN","SAMIHOM4",283,0)
 new zi set zi=0
"RTN","SAMIHOM4",284,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  do  ;
"RTN","SAMIHOM4",285,0)
 . ;
"RTN","SAMIHOM4",286,0)
 . n ln s ln=temp(zi)
"RTN","SAMIHOM4",287,0)
 . n touched s touched=0
"RTN","SAMIHOM4",288,0)
 . ;
"RTN","SAMIHOM4",289,0)
 . i ln["href" i 'touched d  ;
"RTN","SAMIHOM4",290,0)
 . . d FIXHREF^SAMIFORM(.ln)
"RTN","SAMIHOM4",291,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",292,0)
 . ;
"RTN","SAMIHOM4",293,0)
 . i ln["src" d  ;
"RTN","SAMIHOM4",294,0)
 . . d FIXSRC^SAMIFORM(.ln)
"RTN","SAMIHOM4",295,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",296,0)
 . ;
"RTN","SAMIHOM4",297,0)
 . i ln["id" i ln["studyIdMenu" d  ;
"RTN","SAMIHOM4",298,0)
 . . s zi=zi+4
"RTN","SAMIHOM4",299,0)
 . ;
"RTN","SAMIHOM4",300,0)
 . if ln["@@MANUALREGISTRATION@@" do  ; turn off manual registration
"RTN","SAMIHOM4",301,0)
 . . n setman,setparm
"RTN","SAMIHOM4",302,0)
 . . s setman="true"
"RTN","SAMIHOM4",303,0)
 . . s setparm=$$GET^XPAR("SYS","SAMI ALLOW MANUAL ENTRY",,"Q")
"RTN","SAMIHOM4",304,0)
 . . i setparm=0 s setman="false"
"RTN","SAMIHOM4",305,0)
 . . do findReplace^%ts(.ln,"@@MANUALREGISTRATION@@",setman)
"RTN","SAMIHOM4",306,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",307,0)
 . . quit 
"RTN","SAMIHOM4",308,0)
 . set cnt=cnt+1
"RTN","SAMIHOM4",309,0)
 . set tout(cnt)=temp(zi)
"RTN","SAMIHOM4",310,0)
 . quit
"RTN","SAMIHOM4",311,0)
 ;
"RTN","SAMIHOM4",312,0)
 ;
"RTN","SAMIHOM4",313,0)
 ;@old-stanza 4 add cr/lf & save to return array
"RTN","SAMIHOM4",314,0)
 ;
"RTN","SAMIHOM4",315,0)
 do ADDCRLF^VPRJRUT(.tout)
"RTN","SAMIHOM4",316,0)
 merge SAMIRTN=tout
"RTN","SAMIHOM4",317,0)
 ;
"RTN","SAMIHOM4",318,0)
 ;
"RTN","SAMIHOM4",319,0)
 ;@old-stanza 5 termination
"RTN","SAMIHOM4",320,0)
 ;
"RTN","SAMIHOM4",321,0)
 quit  ; old end of wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",322,0)
 ;
"RTN","SAMIHOM4",323,0)
 ;
"RTN","SAMIHOM4",324,0)
 ;
"RTN","SAMIHOM4",325,0)
 ;@section 2 web service post vapals & related subroutines
"RTN","SAMIHOM4",326,0)
 ;
"RTN","SAMIHOM4",327,0)
 ;
"RTN","SAMIHOM4",328,0)
 ;
"RTN","SAMIHOM4",329,0)
 ;@wsi-code WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",330,0)
WSVAPALS ; post vapals (main gateway)
"RTN","SAMIHOM4",331,0)
 ;
"RTN","SAMIHOM4",332,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",333,0)
 ;
"RTN","SAMIHOM4",334,0)
 ;ven/gpl;wsi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",335,0)
 ;@signature
"RTN","SAMIHOM4",336,0)
 ; do WSVAPALS^SAMIHOM3(SAMIARG,SAMIBODY,SAMIRESULT)
"RTN","SAMIHOM4",337,0)
 ;@branches-from
"RTN","SAMIHOM4",338,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",339,0)
 ;@wsi-called-by
"RTN","SAMIHOM4",340,0)
 ;@called-by
"RTN","SAMIHOM4",341,0)
 ;@calls
"RTN","SAMIHOM4",342,0)
 ;@input [tbd]
"RTN","SAMIHOM4",343,0)
 ;@output [tbd]
"RTN","SAMIHOM4",344,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",345,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",346,0)
 ;
"RTN","SAMIHOM4",347,0)
 ; all calls come through this gateway
"RTN","SAMIHOM4",348,0)
 ;
"RTN","SAMIHOM4",349,0)
 k ^SAMIUL("vapals")
"RTN","SAMIHOM4",350,0)
 m ^SAMIUL("vapals")=SAMIARG
"RTN","SAMIHOM4",351,0)
 m ^SAMIUL("vapals","BODY")=SAMIBODY
"RTN","SAMIHOM4",352,0)
 ;
"RTN","SAMIHOM4",353,0)
 new vars,SAMIBDY
"RTN","SAMIHOM4",354,0)
 set SAMIBDY=$get(SAMIBODY(1))
"RTN","SAMIHOM4",355,0)
 do parseBody^%wf("vars",.SAMIBDY)
"RTN","SAMIHOM4",356,0)
 m vars=SAMIARG
"RTN","SAMIHOM4",357,0)
 i $g(vars("siteid"))'="" d  ;
"RTN","SAMIHOM4",358,0)
 . i $g(vars("site"))'=$g(vars("siteid")) s vars("site")=$g(vars("siteid"))
"RTN","SAMIHOM4",359,0)
 i $g(vars("site"))="SYS" s vars("site")=""
"RTN","SAMIHOM4",360,0)
 i $g(HTTPREQ("method"))="GET" d  ;
"RTN","SAMIHOM4",361,0)
 . s vars("site")=""
"RTN","SAMIHOM4",362,0)
 m SAMIARG=vars
"RTN","SAMIHOM4",363,0)
 m SAMIARG=SAMIBODY
"RTN","SAMIHOM4",364,0)
 ;D ^ZTER
"RTN","SAMIHOM4",365,0)
 ;
"RTN","SAMIHOM4",366,0)
 ; Processing for multi-tenancy
"RTN","SAMIHOM4",367,0)
 ;
"RTN","SAMIHOM4",368,0)
 if '$d(vars("siteid")) d  ;
"RTN","SAMIHOM4",369,0)
 . if $g(vars("studyid"))="" q
"RTN","SAMIHOM4",370,0)
 . n sym s sym=$e(vars("studyid"),1,3) ; first 3 chars in studyid
"RTN","SAMIHOM4",371,0)
 . i $$SITENM2^SAMISITE(sym)=-1 q
"RTN","SAMIHOM4",372,0)
 . s vars("siteid")=sym
"RTN","SAMIHOM4",373,0)
 . s vars("site")=sym
"RTN","SAMIHOM4",374,0)
 ;
"RTN","SAMIHOM4",375,0)
 if $G(vars("site"))'="" d  ;
"RTN","SAMIHOM4",376,0)
 . n siteid s siteid=vars("site")
"RTN","SAMIHOM4",377,0)
 . s SAMIARG("siteid")=siteid
"RTN","SAMIHOM4",378,0)
 . s SAMIARG("sitetitle")=$$SITENM2^SAMISITE(siteid)_" - "_siteid
"RTN","SAMIHOM4",379,0)
 k ^gpl("siteselect")
"RTN","SAMIHOM4",380,0)
 m ^gpl("siteselect")=SAMIARG
"RTN","SAMIHOM4",381,0)
 m ^gpl("siteselect","vars")=vars
"RTN","SAMIHOM4",382,0)
 if $G(SAMIARG("siteid"))="" if '$$FINDSITE^SAMISITE(.SAMIRESULT,.SAMIARG) Q 0
"RTN","SAMIHOM4",383,0)
 new SAMISITE,SAMITITL
"RTN","SAMIHOM4",384,0)
 s SAMISITE=$G(SAMIARG("siteid"))
"RTN","SAMIHOM4",385,0)
 i $G(SAMIARG("sitetitle"))="" d  ;
"RTN","SAMIHOM4",386,0)
 . s SAMIARG("sitetitle")=$$SITENM2^SAMISITE(SAMISITE)_" - "_SAMISITE
"RTN","SAMIHOM4",387,0)
 s SAMITITL=$G(SAMIARG("sitetitle"))
"RTN","SAMIHOM4",388,0)
 m vars=SAMIARG
"RTN","SAMIHOM4",389,0)
 ;
"RTN","SAMIHOM4",390,0)
 k ^SAMIUL("vapals","vars")
"RTN","SAMIHOM4",391,0)
 merge ^SAMIUL("vapals","vars")=vars
"RTN","SAMIHOM4",392,0)
 merge ^SAMIUL("vapals","vars")=SAMIBODY
"RTN","SAMIHOM4",393,0)
 ;
"RTN","SAMIHOM4",394,0)
 n route s route=$g(vars("samiroute"))
"RTN","SAMIHOM4",395,0)
 ;i route=""  d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",396,0)
 i route="" d  q 0
"RTN","SAMIHOM4",397,0)
 . n vals
"RTN","SAMIHOM4",398,0)
 . s vals("siteid")=""
"RTN","SAMIHOM4",399,0)
 . s vals("sitetitle")="Unknown Site"
"RTN","SAMIHOM4",400,0)
 . s vals("errorMessage")=""
"RTN","SAMIHOM4",401,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:login",.vals)
"RTN","SAMIHOM4",402,0)
 ;
"RTN","SAMIHOM4",403,0)
 i route="lookup" d  q 0
"RTN","SAMIHOM4",404,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",405,0)
 . d WSLOOKUP^SAMISRC2(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",406,0)
 ;
"RTN","SAMIHOM4",407,0)
 i route="login" d  q 0
"RTN","SAMIHOM4",408,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",409,0)
 . d LOGIN^SAMISITE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",410,0)
 ;
"RTN","SAMIHOM4",411,0)
 i route="home" d  q 0
"RTN","SAMIHOM4",412,0)
 . k ^gpl("home")
"RTN","SAMIHOM4",413,0)
 . m ^gpl("home")=SAMIARG
"RTN","SAMIHOM4",414,0)
 . s SAMIARG("samiroute")=""
"RTN","SAMIHOM4",415,0)
 . d WSHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",416,0)
 ;
"RTN","SAMIHOM4",417,0)
 i route="logout" d  q 0
"RTN","SAMIHOM4",418,0)
 . ;s SAMIARG("samiroute")="home"
"RTN","SAMIHOM4",419,0)
 . ;do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIARG,.SAMIRESULT)
"RTN","SAMIHOM4",420,0)
 . ;Q
"RTN","SAMIHOM4",421,0)
 . q:$$REDIRECT^SAMISITE(.SAMIRESULT,.SAMIARG)  ; redirect to logout screen
"RTN","SAMIHOM4",422,0)
 . s SAMIARG("sitetitle")="Unknown Site"
"RTN","SAMIHOM4",423,0)
 . s SAMIARG("siteid")=""
"RTN","SAMIHOM4",424,0)
 . s SAMIARG("errorMessage")=""
"RTN","SAMIHOM4",425,0)
 . s SAMIARG("samiroute")="home"
"RTN","SAMIHOM4",426,0)
 . d WSHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",427,0)
 . ;d RTNERR^SAMIHOM4(.SAMIRESULT,"vapals:login",.SAMIARG)
"RTN","SAMIHOM4",428,0)
 ;
"RTN","SAMIHOM4",429,0)
 i route="newcase" d  q 0
"RTN","SAMIHOM4",430,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",431,0)
 . d WSNEWCAS^SAMIHOM3(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",432,0)
 ;
"RTN","SAMIHOM4",433,0)
 i route="casereview" d  q 0
"RTN","SAMIHOM4",434,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",435,0)
 . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",436,0)
 ;
"RTN","SAMIHOM4",437,0)
 i route="nuform" d  q 0
"RTN","SAMIHOM4",438,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",439,0)
 . d WSNUFORM^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",440,0)
 ;
"RTN","SAMIHOM4",441,0)
 i route="addform" d  q 0
"RTN","SAMIHOM4",442,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",443,0)
 . d WSNFPOST^SAMICASE(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",444,0)
 ;
"RTN","SAMIHOM4",445,0)
 i route="form" d  q 0
"RTN","SAMIHOM4",446,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",447,0)
 . d wsGetForm^%wf(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",448,0)
 ;
"RTN","SAMIHOM4",449,0)
 i route="postform" d  q 0
"RTN","SAMIHOM4",450,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",451,0)
 . d wsPostForm^%wf(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",452,0)
 . i $g(SAMIARG("form"))["siform" d  ;
"RTN","SAMIHOM4",453,0)
 . . n notr s notr=0 ; note return 0 if failure, 1 or greater if success
"RTN","SAMIHOM4",454,0)
 . . ; returns the ien of the note that was created and should be sent
"RTN","SAMIHOM4",455,0)
 . . s notr=$$NOTE^SAMINOT1(.SAMIARG)
"RTN","SAMIHOM4",456,0)
 . . if +notr>0 d  ;
"RTN","SAMIHOM4",457,0)
 . . . n SAMIFILTER
"RTN","SAMIHOM4",458,0)
 . . . s SAMIFILTER("sid")=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",459,0)
 . . . s SAMIFILTER("key")=$g(SAMIARG("form")) ;
"RTN","SAMIHOM4",460,0)
 . . . n tiuien
"RTN","SAMIHOM4",461,0)
 . . . s tiuien=+notr
"RTN","SAMIHOM4",462,0)
 . . . s SAMIFILTER("notenmbr")=tiuien
"RTN","SAMIHOM4",463,0)
 . . . n sendrslt
"RTN","SAMIHOM4",464,0)
 . . . ;s sendrslt="1^MSG9239010"
"RTN","SAMIHOM4",465,0)
 . . . s SAMIFILTER("sendprotocol")=SAMISITE_" ENROLL ORU EVN"
"RTN","SAMIHOM4",466,0)
 . . . s sendrslt=$$EN^SAMIORU(.SAMIFILTER) ; send the note to VistA
"RTN","SAMIHOM4",467,0)
 . . . i +sendrslt>0 d  ; success
"RTN","SAMIHOM4",468,0)
 . . . . n rtnid s rtnid=$p(sendrslt,"^",2) ; return id from HL7
"RTN","SAMIHOM4",469,0)
 . . . . ; post the id to the graph here
"RTN","SAMIHOM4",470,0)
 . . . . n sid s sid=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",471,0)
 . . . . n form s form=$G(SAMIARG("form"))
"RTN","SAMIHOM4",472,0)
 . . . . n nien s nien=$$NTIEN^SAMINOT1(sid,form) ; latest note ien
"RTN","SAMIHOM4",473,0)
 . . . . n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",474,0)
 . . . . s @root@("graph",sid,form,"notes",nien,"hl7id")=rtnid
"RTN","SAMIHOM4",475,0)
 . . . . s SAMIARG("errorMessage")="Note successfully sent to VistA ID: "_rtnid
"RTN","SAMIHOM4",476,0)
 . . . else  d  ;
"RTN","SAMIHOM4",477,0)
 . . . . n rtnmsg s rtnmsg=$p(sendrslt,"^",2)
"RTN","SAMIHOM4",478,0)
 . . . . s SAMIARG("errorMessage")=rtnmsg
"RTN","SAMIHOM4",479,0)
 . . . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",480,0)
 . i $g(SAMIARG("form"))["fuform" d  ;
"RTN","SAMIHOM4",481,0)
 . . n notr s notr=0 ; note return 0 if failure, 1 or greater if success
"RTN","SAMIHOM4",482,0)
 . . ; returns the ien of the note that was created and should be sent
"RTN","SAMIHOM4",483,0)
 . . s notr=$$NOTE^SAMINOT2(.SAMIARG)
"RTN","SAMIHOM4",484,0)
 . . if +notr>0 d  ;
"RTN","SAMIHOM4",485,0)
 . . . n SAMIFILTER
"RTN","SAMIHOM4",486,0)
 . . . s SAMIFILTER("sid")=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",487,0)
 . . . s SAMIFILTER("key")=$g(SAMIARG("form")) ;
"RTN","SAMIHOM4",488,0)
 . . . n tiuien
"RTN","SAMIHOM4",489,0)
 . . . s tiuien=+notr
"RTN","SAMIHOM4",490,0)
 . . . s SAMIFILTER("notenmbr")=tiuien
"RTN","SAMIHOM4",491,0)
 . . . n sendrslt
"RTN","SAMIHOM4",492,0)
 . . . ;s sendrslt="0^Missing ORM Message"
"RTN","SAMIHOM4",493,0)
 . . . s SAMIFILTER("sendprotocol")=SAMISITE_" ENROLL ORU EVN"
"RTN","SAMIHOM4",494,0)
 . . . s sendrslt=$$EN^SAMIORU(.SAMIFILTER) ; send the note to VistA
"RTN","SAMIHOM4",495,0)
 . . . i +sendrslt>0 d  ; success
"RTN","SAMIHOM4",496,0)
 . . . . n rtnid s rtnid=$p(sendrslt,"^",2) ; return id from HL7
"RTN","SAMIHOM4",497,0)
 . . . . ; post the id to the graph here
"RTN","SAMIHOM4",498,0)
 . . . . n sid s sid=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",499,0)
 . . . . n form s form=$G(SAMIARG("form"))
"RTN","SAMIHOM4",500,0)
 . . . . n nien s nien=$$NTIEN^SAMINOT1(sid,form) ; latest note ien
"RTN","SAMIHOM4",501,0)
 . . . . n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",502,0)
 . . . . s @root@("graph",sid,form,"notes",nien,"hl7id")=rtnid
"RTN","SAMIHOM4",503,0)
 . . . . s SAMIARG("errorMessage")="Note successfully sent to VistA ID: "_rtnid
"RTN","SAMIHOM4",504,0)
 . . . else  d  ;
"RTN","SAMIHOM4",505,0)
 . . . . n rtnmsg s rtnmsg=$p(sendrslt,"^",2)
"RTN","SAMIHOM4",506,0)
 . . . . i $g(SAMIARG("errorMessage"))="" d  ;
"RTN","SAMIHOM4",507,0)
 . . . . . s SAMIARG("errorMessage")=rtnmsg
"RTN","SAMIHOM4",508,0)
 . . . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",509,0)
 . . e  d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",510,0)
 . e  d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",511,0)
 ;
"RTN","SAMIHOM4",512,0)
 i route="deleteform" d  q 0
"RTN","SAMIHOM4",513,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",514,0)
 . d DELFORM^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",515,0)
 ;
"RTN","SAMIHOM4",516,0)
 i route="ctreport" d  q 0
"RTN","SAMIHOM4",517,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",518,0)
 . n format s format="html"
"RTN","SAMIHOM4",519,0)
 . s format="text"
"RTN","SAMIHOM4",520,0)
 . i format="text" d WSNOTE^SAMINOT3(.SAMIRESULT,.SAMIARG) q  ;
"RTN","SAMIHOM4",521,0)
 . i format="html" d WSREPORT^SAMICTR0(.SAMIRESULT,.SAMIARG) q  ;
"RTN","SAMIHOM4",522,0)
 . ;d wsReport^SAMICTRT(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",523,0)
 ;
"RTN","SAMIHOM4",524,0)
 i route="note" d  q 0
"RTN","SAMIHOM4",525,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",526,0)
 . d WSNOTE^SAMINOT1(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",527,0)
 ;
"RTN","SAMIHOM4",528,0)
 i route="report" d  q 0
"RTN","SAMIHOM4",529,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",530,0)
 . d WSREPORT^SAMIUR(.SAMIRESULT,.vars)
"RTN","SAMIHOM4",531,0)
 ;
"RTN","SAMIHOM4",532,0)
 i route="about" d  q 0
"RTN","SAMIHOM4",533,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",534,0)
 . n form
"RTN","SAMIHOM4",535,0)
 . s form="vapals:about"
"RTN","SAMIHOM4",536,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",537,0)
 ;
"RTN","SAMIHOM4",538,0)
 i route="addperson" d  q 0
"RTN","SAMIHOM4",539,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",540,0)
 . n form
"RTN","SAMIHOM4",541,0)
 . s form="vapals:addperson"
"RTN","SAMIHOM4",542,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",543,0)
 ;
"RTN","SAMIHOM4",544,0)
 i route="editperson" d  q 0
"RTN","SAMIHOM4",545,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",546,0)
 . n dfn s dfn=$g(vars("dfn")) ; must have a dfn
"RTN","SAMIHOM4",547,0)
 . i dfn="" d  q  ;
"RTN","SAMIHOM4",548,0)
 . . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",549,0)
 . n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",550,0)
 . n sien s sien=$o(@root@("dfn",dfn,""))
"RTN","SAMIHOM4",551,0)
 . i sien="" d  q  ;
"RTN","SAMIHOM4",552,0)
 . . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",553,0)
 . s vars("name")=$g(@root@(sien,"saminame"))
"RTN","SAMIHOM4",554,0)
 . s tdob=$g(@root@(sien,"dob"))
"RTN","SAMIHOM4",555,0)
 . s vars("dob")=$p(tdob,"-",2)_"/"_$p(tdob,"-",3)_"/"_$p(tdob,"-",1)
"RTN","SAMIHOM4",556,0)
 . s vars("sbdob")=$g(@root@(sien,"dob"))
"RTN","SAMIHOM4",557,0)
 . s vars("gender")=$g(@root@(sien,"sex"))
"RTN","SAMIHOM4",558,0)
 . ; s vars("icn")=$g(@root@(sien,"icn"))
"RTN","SAMIHOM4",559,0)
 . n tssn s tssn=$g(@root@(sien,"ssn"))
"RTN","SAMIHOM4",560,0)
 . s vars("ssn")=$e(tssn,1,3)_"-"_$e(tssn,4,5)_"-"_$e(tssn,6,9)
"RTN","SAMIHOM4",561,0)
 . s vars("last5")=$g(@root@(sien,"last5"))
"RTN","SAMIHOM4",562,0)
 . s vars("dfn")=$g(@root@(sien,"dfn"))
"RTN","SAMIHOM4",563,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",564,0)
 . n form,err,zhtml
"RTN","SAMIHOM4",565,0)
 . s form="vapals:editparticipant"
"RTN","SAMIHOM4",566,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",567,0)
 ;
"RTN","SAMIHOM4",568,0)
 i route="register" d  q 0
"RTN","SAMIHOM4",569,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",570,0)
 . d REG^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",571,0)
 ; 
"RTN","SAMIHOM4",572,0)
 i route="editsave" d  q 0
"RTN","SAMIHOM4",573,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",574,0)
 . d SAVE^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",575,0)
 ;
"RTN","SAMIHOM4",576,0)
 i route="merge" d  q 0
"RTN","SAMIHOM4",577,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",578,0)
 . d MERGE^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",579,0)
 ;
"RTN","SAMIHOM4",580,0)
 quit 0  ; end of wsi WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",581,0)
 ;
"RTN","SAMIHOM4",582,0)
 ;
"RTN","SAMIHOM4",583,0)
 ;
"RTN","SAMIHOM4",584,0)
 ;@section 3 other
"RTN","SAMIHOM4",585,0)
 ;
"RTN","SAMIHOM4",586,0)
 ;
"RTN","SAMIHOM4",587,0)
 ;
"RTN","SAMIHOM4",588,0)
REG(SAMIRTN,SAMIARG) ; manual registration
"RTN","SAMIHOM4",589,0)
 ;
"RTN","SAMIHOM4",590,0)
 n name s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",591,0)
 ;
"RTN","SAMIHOM4",592,0)
 m ^gpl("reg")=SAMIARG
"RTN","SAMIHOM4",593,0)
 n ssn s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",594,0)
 i ssn'="" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",595,0)
 s SAMIARG("errorMessage")=""
"RTN","SAMIHOM4",596,0)
 s SAMIARG("errorField")=""
"RTN","SAMIHOM4",597,0)
 ; test for duplicate ssn
"RTN","SAMIHOM4",598,0)
 ;
"RTN","SAMIHOM4",599,0)
 ;i $$DUPSSN(ssn) d  ;
"RTN","SAMIHOM4",600,0)
 ;. ;s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate SSN."
"RTN","SAMIHOM4",601,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate SSN error. A person with that SSN is already entered in the system."
"RTN","SAMIHOM4",602,0)
 ;. s SAMIARG("errorField")="ssn"
"RTN","SAMIHOM4",603,0)
 ;
"RTN","SAMIHOM4",604,0)
 ; test for duplicate icn
"RTN","SAMIHOM4",605,0)
 ;
"RTN","SAMIHOM4",606,0)
 ;n icn s icn=$g(SAMIARG("icn"))
"RTN","SAMIHOM4",607,0)
 ;i icn'="" i $$DUPICN(icn) d  ;
"RTN","SAMIHOM4",608,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate ICN error. A person with that ICN is already entered in the system."
"RTN","SAMIHOM4",609,0)
 ;. s SAMIARG("errorField")="icn"
"RTN","SAMIHOM4",610,0)
 ;;
"RTN","SAMIHOM4",611,0)
 ;; test for wellformed ICN
"RTN","SAMIHOM4",612,0)
 ;;
"RTN","SAMIHOM4",613,0)
 ;i icn'="" i $$BADICN(icn) d  ;
"RTN","SAMIHOM4",614,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Invalid ICN error. The check digits in the ICN do not match"
"RTN","SAMIHOM4",615,0)
 ;. s SAMIARG("errorField")="icn"
"RTN","SAMIHOM4",616,0)
 ;;
"RTN","SAMIHOM4",617,0)
 ; if there is an error, send back to edit with error message
"RTN","SAMIHOM4",618,0)
 i $g(SAMIARG("errorMessage"))'="" d  q  ;
"RTN","SAMIHOM4",619,0)
 . n form
"RTN","SAMIHOM4",620,0)
 . s form="vapals:addperson"
"RTN","SAMIHOM4",621,0)
 . d RTNERR(.SAMIRESULT,form,.SAMIARG)
"RTN","SAMIHOM4",622,0)
 ;
"RTN","SAMIHOM4",623,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",624,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",625,0)
 n ptlkien s ptlkien=""
"RTN","SAMIHOM4",626,0)
 n dfn s dfn=""
"RTN","SAMIHOM4",627,0)
 n sien s sien=""
"RTN","SAMIHOM4",628,0)
 i ptlkien="" s ptlkien=$o(@root@("AAAAAA"),-1)+1
"RTN","SAMIHOM4",629,0)
 n zm
"RTN","SAMIHOM4",630,0)
 k SAMIARG("MATCHLOG")
"RTN","SAMIHOM4",631,0)
 s zm=$$REMATCH(sien,.SAMIARG)
"RTN","SAMIHOM4",632,0)
 i zm>0 d  ;
"RTN","SAMIHOM4",633,0)
 . s SAMIARG("MATCHLOG")=zm
"RTN","SAMIHOM4",634,0)
 d MKPTLK(ptlkien,.SAMIARG) ; make the patient-lookup record
"RTN","SAMIHOM4",635,0)
 ;
"RTN","SAMIHOM4",636,0)
 s dfn=$o(@root@("dfn"," "),-1)+1
"RTN","SAMIHOM4",637,0)
 n pdfn
"RTN","SAMIHOM4",638,0)
 s pdfn=$o(@proot@("dfn"," "),-1)+1
"RTN","SAMIHOM4",639,0)
 i pdfn>dfn s dfn=pdfn ; need a dfn that has not been used
"RTN","SAMIHOM4",640,0)
 i dfn<9000001 s dfn=9000001
"RTN","SAMIHOM4",641,0)
 s @root@(ptlkien,"dfn")=dfn
"RTN","SAMIHOM4",642,0)
 s SAMIARG("dfn")=dfn ; pass the new dfn back to the caller
"RTN","SAMIHOM4",643,0)
 ; note: this is the only way to link to the new record via dfn
"RTN","SAMIHOM4",644,0)
 ; since nothing else is unique
"RTN","SAMIHOM4",645,0)
 d INDXPTLK(ptlkien)
"RTN","SAMIHOM4",646,0)
 s SAMIFILTER("samiroute")="addperson"
"RTN","SAMIHOM4",647,0)
 s SAMIFILTER("siteid")=$G(SAMIARG("siteid"))
"RTN","SAMIHOM4",648,0)
 s SAMIFILTER("sitetitle")=$G(SAMIARG("sitetitle"))
"RTN","SAMIHOM4",649,0)
 D  ; slight of hand for handing back SAMIARGS while also returning a form
"RTN","SAMIHOM4",650,0)
 . n SAMIARG ; return to a blank manual registration form
"RTN","SAMIHOM4",651,0)
 . s SAMIARG("siteid")=$G(SAMIFILTER("siteid"))
"RTN","SAMIHOM4",652,0)
 . s SAMIARG("sitetitle")=$G(SAMIFILTER("sitetitle"))
"RTN","SAMIHOM4",653,0)
 . d SETINFO(.SAMIFILTER,name_" was successfully entered")
"RTN","SAMIHOM4",654,0)
 . ;d SETWARN(.SAMIFILTER,"We might want to give you a warning")
"RTN","SAMIHOM4",655,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIARG,.SAMIRESULT)
"RTN","SAMIHOM4",656,0)
 ;
"RTN","SAMIHOM4",657,0)
 quit  ; end of REG
"RTN","SAMIHOM4",658,0)
 ;
"RTN","SAMIHOM4",659,0)
 ;
"RTN","SAMIHOM4",660,0)
 ;
"RTN","SAMIHOM4",661,0)
MKPTLK(ptlkien,SAMIARG) ; creates patient-lookup record
"RTN","SAMIHOM4",662,0)
 ;
"RTN","SAMIHOM4",663,0)
 n ssn s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",664,0)
 i ssn'="" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",665,0)
 n name s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",666,0)
 n sinamef,sinamel
"RTN","SAMIHOM4",667,0)
 s sinamel=$p(name,","),sinamel=$$TRIM^XLFSTR(sinamel,"LR")
"RTN","SAMIHOM4",668,0)
 s sinamef=$p(name,",",2),sinamef=$$TRIM^XLFSTR(sinamef,"LR")
"RTN","SAMIHOM4",669,0)
 s name=sinamel_","_sinamef
"RTN","SAMIHOM4",670,0)
 n siteid s siteid=$g(SAMIARG("siteid"))
"RTN","SAMIHOM4",671,0)
 i siteid="" s siteid=$g(SAMIARG("site"))
"RTN","SAMIHOM4",672,0)
 ;
"RTN","SAMIHOM4",673,0)
 s @root@(ptlkien,"siteid")=siteid
"RTN","SAMIHOM4",674,0)
 s @root@(ptlkien,"saminame")=name
"RTN","SAMIHOM4",675,0)
 s @root@(ptlkien,"sinamef")=sinamef
"RTN","SAMIHOM4",676,0)
 s @root@(ptlkien,"sinamel")=sinamel
"RTN","SAMIHOM4",677,0)
 n dob s dob=$g(SAMIARG("dob"))
"RTN","SAMIHOM4",678,0)
 i dob="" s dob=$g(SAMIARG("sidob"))
"RTN","SAMIHOM4",679,0)
 n fmdob s fmdob=$$FMDT^SAMIUR2(dob)
"RTN","SAMIHOM4",680,0)
 n ptlkdob s ptlkdob=$$FMTE^XLFDT(fmdob,7)
"RTN","SAMIHOM4",681,0)
 s ptlkdob=$TR(ptlkdob,"/","-")
"RTN","SAMIHOM4",682,0)
 s @root@(ptlkien,"dob")=ptlkdob
"RTN","SAMIHOM4",683,0)
 s @root@(ptlkien,"sbdob")=ptlkdob
"RTN","SAMIHOM4",684,0)
 n gender s gender=$g(SAMIARG("gender"))
"RTN","SAMIHOM4",685,0)
 i gender="" s gender=$g(SAMIARG("sex"))
"RTN","SAMIHOM4",686,0)
 s @root@(ptlkien,"gender")=$s(gender="M":"M^MALE",1:"F^FEMALE")
"RTN","SAMIHOM4",687,0)
 s @root@(ptlkien,"sex")=$g(SAMIARG("gender"))
"RTN","SAMIHOM4",688,0)
 ; s @root@(ptlkien,"icn")=SAMIARG("icn")
"RTN","SAMIHOM4",689,0)
 s @root@(ptlkien,"ssn")=ssn
"RTN","SAMIHOM4",690,0)
 s @root@(ptlkien,"simrn")=$g(SAMIARG("simrn"))
"RTN","SAMIHOM4",691,0)
 n last5 s last5=""
"RTN","SAMIHOM4",692,0)
 i ssn'="" s last5=$$UCASE($e(name,1))_$e(ssn,6,9)
"RTN","SAMIHOM4",693,0)
 s @root@(ptlkien,"last5")=last5
"RTN","SAMIHOM4",694,0)
 n mymatch s mymatch=$g(SAMIARG("MATCHLOG"))
"RTN","SAMIHOM4",695,0)
 i mymatch'="" s @root@(ptlkien,"MATCHLOG")=mymatch
"RTN","SAMIHOM4",696,0)
 ;
"RTN","SAMIHOM4",697,0)
 quit  ; end of MKPTLK
"RTN","SAMIHOM4",698,0)
 ;
"RTN","SAMIHOM4",699,0)
 ;
"RTN","SAMIHOM4",700,0)
 ;
"RTN","SAMIHOM4",701,0)
UPDTFRMS(dfn) ; update demographics in all forms for patient
"RTN","SAMIHOM4",702,0)
 ;
"RTN","SAMIHOM4",703,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",704,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",705,0)
 n lien s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIHOM4",706,0)
 q:lien=""
"RTN","SAMIHOM4",707,0)
 n pien s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIHOM4",708,0)
 q:pien=""
"RTN","SAMIHOM4",709,0)
 ; this patient has forms
"RTN","SAMIHOM4",710,0)
 m @proot@(pien)=@lroot@(lien) ; refresh the demos in the patient record
"RTN","SAMIHOM4",711,0)
 n ssn s ssn=$g(@proot@(pien,"ssn"))
"RTN","SAMIHOM4",712,0)
 s @proot@(pien,"sissn")=$e(ssn,1,3)_"-"_$e(ssn,4,5)_"-"_$e(ssn,6,9)
"RTN","SAMIHOM4",713,0)
 n sid s sid=$g(@proot@("sisid")) ; studyid 
"RTN","SAMIHOM4",714,0)
 q:sid=""  ; no studyid
"RTN","SAMIHOM4",715,0)
 n zi s zi=""
"RTN","SAMIHOM4",716,0)
 f  s zi=$o(@proot@("graph",sid,zi)) q:zi=""  d  ; for each form
"RTN","SAMIHOM4",717,0)
 . m @proot@("graph",sid,zi)=@proot@(pien) ; stamp each form with new demos
"RTN","SAMIHOM4",718,0)
 ;
"RTN","SAMIHOM4",719,0)
 quit  ; end of UPDTFRMS
"RTN","SAMIHOM4",720,0)
 ;
"RTN","SAMIHOM4",721,0)
 ;
"RTN","SAMIHOM4",722,0)
 ;
"RTN","SAMIHOM4",723,0)
MERGE(SAMIRESULT,SAMIARGS) ; merge participant records
"RTN","SAMIHOM4",724,0)
 ;
"RTN","SAMIHOM4",725,0)
 ; called from pressing the merge button on the unmatched report
"RTN","SAMIHOM4",726,0)
 ;
"RTN","SAMIHOM4",727,0)
 n toien s toien=$g(SAMIARGS("toien"))
"RTN","SAMIHOM4",728,0)
 i toien="" d  q  ;
"RTN","SAMIHOM4",729,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",730,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",731,0)
 n fromien s fromien=$g(@lroot@(toien,"MATCHLOG"))
"RTN","SAMIHOM4",732,0)
 i fromien="" d  q  ;
"RTN","SAMIHOM4",733,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",734,0)
 ;
"RTN","SAMIHOM4",735,0)
 ; test for remotedfn in from record - not valid if absent
"RTN","SAMIHOM4",736,0)
 ;
"RTN","SAMIHOM4",737,0)
 i $g(@lroot@(fromien,"remotedfn"))="" d  q  ;
"RTN","SAMIHOM4",738,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",739,0)
 ;
"RTN","SAMIHOM4",740,0)
 ; remove index entries for from and to records
"RTN","SAMIHOM4",741,0)
 ;
"RTN","SAMIHOM4",742,0)
 d UNINDXPT(fromien) ; delete index entries
"RTN","SAMIHOM4",743,0)
 d UNINDXPT(toien)
"RTN","SAMIHOM4",744,0)
 ;
"RTN","SAMIHOM4",745,0)
 ; create changelog entry in to record - contains from record
"RTN","SAMIHOM4",746,0)
 ;
"RTN","SAMIHOM4",747,0)
 m @lroot@(toien,"changelog",$$FMTE^XLFDT($$NOW^XLFDT,5))=@lroot@(fromien)
"RTN","SAMIHOM4",748,0)
 ;
"RTN","SAMIHOM4",749,0)
 ; change the dfn in the from record to the to record dfn for merging
"RTN","SAMIHOM4",750,0)
 ;
"RTN","SAMIHOM4",751,0)
 s @lroot@(fromien,"dfn")=@lroot@(toien,"dfn")
"RTN","SAMIHOM4",752,0)
 n dfn s dfn=@lroot@(toien,"dfn") ; for use in updating forms
"RTN","SAMIHOM4",753,0)
 ;
"RTN","SAMIHOM4",754,0)
 ; merge the from record to the to record
"RTN","SAMIHOM4",755,0)
 ;
"RTN","SAMIHOM4",756,0)
 m @lroot@(toien)=@lroot@(fromien)
"RTN","SAMIHOM4",757,0)
 ;
"RTN","SAMIHOM4",758,0)
 ; delete the from record
"RTN","SAMIHOM4",759,0)
 ;
"RTN","SAMIHOM4",760,0)
 k @lroot@(fromien)
"RTN","SAMIHOM4",761,0)
 ;
"RTN","SAMIHOM4",762,0)
 ; reindex the to record
"RTN","SAMIHOM4",763,0)
 ;
"RTN","SAMIHOM4",764,0)
 d INDXPTLK(toien)
"RTN","SAMIHOM4",765,0)
 ;
"RTN","SAMIHOM4",766,0)
 ; propagate the updated from record to every form
"RTN","SAMIHOM4",767,0)
 ;
"RTN","SAMIHOM4",768,0)
 d UPDTFRMS(dfn) ; updates the patient in the vapals-patient graph
"RTN","SAMIHOM4",769,0)
 ;
"RTN","SAMIHOM4",770,0)
 ; leave and return to the unmatched report
"RTN","SAMIHOM4",771,0)
 ;   note that the form and to records will no longer be in the report
"RTN","SAMIHOM4",772,0)
 ;
"RTN","SAMIHOM4",773,0)
 d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",774,0)
 ;
"RTN","SAMIHOM4",775,0)
 quit  ; end of MERGE
"RTN","SAMIHOM4",776,0)
 ;
"RTN","SAMIHOM4",777,0)
 ;
"RTN","SAMIHOM4",778,0)
 ;
"RTN","SAMIHOM4",779,0)
ADDUNMAT ; adds unmatched report web service to system
"RTN","SAMIHOM4",780,0)
 ;
"RTN","SAMIHOM4",781,0)
 d addService^%webutils("GET","unmatched","WSUNMAT^SAMIHOM4")
"RTN","SAMIHOM4",782,0)
 ;
"RTN","SAMIHOM4",783,0)
 quit  ; end of ADDUNMAT
"RTN","SAMIHOM4",784,0)
 ;
"RTN","SAMIHOM4",785,0)
 ;
"RTN","SAMIHOM4",786,0)
 ;
"RTN","SAMIHOM4",787,0)
DELUNMAT ; deletes unmatched web service
"RTN","SAMIHOM4",788,0)
 ;
"RTN","SAMIHOM4",789,0)
 d deleteService^%webutils("GET","unmatched")
"RTN","SAMIHOM4",790,0)
 ;
"RTN","SAMIHOM4",791,0)
 quit  ; end of DELUNMAT
"RTN","SAMIHOM4",792,0)
 ;
"RTN","SAMIHOM4",793,0)
 ;
"RTN","SAMIHOM4",794,0)
 ;
"RTN","SAMIHOM4",795,0)
WSUNMAT(SAMIRESULT,SAMIARGS) ; navigates to unmatched report
"RTN","SAMIHOM4",796,0)
 ; 
"RTN","SAMIHOM4",797,0)
 n filter,bdy
"RTN","SAMIHOM4",798,0)
 s bdy=""
"RTN","SAMIHOM4",799,0)
 ;s filter("siteid")="PHX"
"RTN","SAMIHOM4",800,0)
 s filter("samiroute")="report"
"RTN","SAMIHOM4",801,0)
 s filter("samireporttype")="unmatched"
"RTN","SAMIHOM4",802,0)
 d WSVAPALS^SAMIHOM3(.filter,.bdy,.SAMIRESULT) ; back to the unmatched report
"RTN","SAMIHOM4",803,0)
 ;
"RTN","SAMIHOM4",804,0)
 quit  ; end of WSUNMAT
"RTN","SAMIHOM4",805,0)
 ;
"RTN","SAMIHOM4",806,0)
 ;
"RTN","SAMIHOM4",807,0)
 ;
"RTN","SAMIHOM4",808,0)
DUPSSN(ssn) ; extrinsic returns true if duplicate ssn
"RTN","SAMIHOM4",809,0)
 ;
"RTN","SAMIHOM4",810,0)
 n proot s proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",811,0)
 i $d(@proot@("ssn",ssn)) q 1
"RTN","SAMIHOM4",812,0)
 ;
"RTN","SAMIHOM4",813,0)
 quit 0 ; end of $$DUPSSN
"RTN","SAMIHOM4",814,0)
 ;
"RTN","SAMIHOM4",815,0)
 ;
"RTN","SAMIHOM4",816,0)
 ;
"RTN","SAMIHOM4",817,0)
DUPICN(icn) ; extrinsic returns true if duplicate icn
"RTN","SAMIHOM4",818,0)
 ;
"RTN","SAMIHOM4",819,0)
 n proot s proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",820,0)
 n tmpicn s tmpicn=$p(icn,"V",1)
"RTN","SAMIHOM4",821,0)
 i $d(@proot@("icn",icn)) q 1
"RTN","SAMIHOM4",822,0)
 i $d(@proot@("icn",tmpicn)) q 1
"RTN","SAMIHOM4",823,0)
 ;
"RTN","SAMIHOM4",824,0)
 quit 0 ; end of $$DUPICN
"RTN","SAMIHOM4",825,0)
 ;
"RTN","SAMIHOM4",826,0)
 ;
"RTN","SAMIHOM4",827,0)
 ;
"RTN","SAMIHOM4",828,0)
BADICN(icn) ; extrinsic returns true if ICN checkdigits are wrong
"RTN","SAMIHOM4",829,0)
 ;
"RTN","SAMIHOM4",830,0)
 n zchk s zchk=$p(icn,"V",2)
"RTN","SAMIHOM4",831,0)
 n zicn s zicn=$p(icn,"V",1)
"RTN","SAMIHOM4",832,0)
 q:zchk="" 1
"RTN","SAMIHOM4",833,0)
 i zchk'=$$CHECKDG^MPIFSPC(zicn) q 1
"RTN","SAMIHOM4",834,0)
 ;
"RTN","SAMIHOM4",835,0)
 quit 0
"RTN","SAMIHOM4",836,0)
 ;
"RTN","SAMIHOM4",837,0)
 ;
"RTN","SAMIHOM4",838,0)
 ;
"RTN","SAMIHOM4",839,0)
SAVE(SAMIRESULT,SAMIARG) ; save patient-lookup record after edit
"RTN","SAMIHOM4",840,0)
 ;
"RTN","SAMIHOM4",841,0)
 n dfn s dfn=$g(vars("dfn")) ; must have a dfn
"RTN","SAMIHOM4",842,0)
 i dfn="" d  q  ;
"RTN","SAMIHOM4",843,0)
 . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home 
"RTN","SAMIHOM4",844,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",845,0)
 n sien s sien=$o(@root@("dfn",dfn,""))
"RTN","SAMIHOM4",846,0)
 i sien="" d  q  ;
"RTN","SAMIHOM4",847,0)
 . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home 
"RTN","SAMIHOM4",848,0)
 d UNINDXPT(sien) ; remove old index entries
"RTN","SAMIHOM4",849,0)
 n zm
"RTN","SAMIHOM4",850,0)
 k SAMIARG("MATCHLOG")
"RTN","SAMIHOM4",851,0)
 s zm=$$REMATCH(sien,.SAMIARG)
"RTN","SAMIHOM4",852,0)
 i zm>0 d  ;
"RTN","SAMIHOM4",853,0)
 . s SAMIARG("MATCHLOG")=zm
"RTN","SAMIHOM4",854,0)
 d MKPTLK(sien,.SAMIARG) ; add the updated fields
"RTN","SAMIHOM4",855,0)
 d INDXPTLK(sien) ; create new index entries
"RTN","SAMIHOM4",856,0)
 d UPDTFRMS(dfn) ; update demographic info in all forms
"RTN","SAMIHOM4",857,0)
 n filter,bdy
"RTN","SAMIHOM4",858,0)
 s bdy=""
"RTN","SAMIHOM4",859,0)
 m filter=SAMIARG
"RTN","SAMIHOM4",860,0)
 s filter("samiroute")="report"
"RTN","SAMIHOM4",861,0)
 s filter("samireporttype")="unmatched"
"RTN","SAMIHOM4",862,0)
 d WSVAPALS^SAMIHOM3(.filter,.bdy,.SAMIRESULT) ; back to the unmatched report
"RTN","SAMIHOM4",863,0)
 ;
"RTN","SAMIHOM4",864,0)
 quit  ; end of SAVE
"RTN","SAMIHOM4",865,0)
 ;
"RTN","SAMIHOM4",866,0)
 ;
"RTN","SAMIHOM4",867,0)
 ;
"RTN","SAMIHOM4",868,0)
REMATCH(sien,SAMIARG) ; extrinsic returns possible match ien
"RTN","SAMIHOM4",869,0)
 ;
"RTN","SAMIHOM4",870,0)
 ; else zero
"RTN","SAMIHOM4",871,0)
 ;
"RTN","SAMIHOM4",872,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",873,0)
 n ssn,name,icn,x,y
"RTN","SAMIHOM4",874,0)
 s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",875,0)
 i ssn["-" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",876,0)
 s name=$g(SAMIARG("saminame"))
"RTN","SAMIHOM4",877,0)
 i name="" s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",878,0)
 s name=$$UCASE(name)
"RTN","SAMIHOM4",879,0)
 ; s icn=$g(SAMIARG("icn"))
"RTN","SAMIHOM4",880,0)
 s x=0
"RTN","SAMIHOM4",881,0)
 i ssn'="" s x=$o(@lroot@("ssn",ssn,""))
"RTN","SAMIHOM4",882,0)
 i x=sien s x=$o(@lroot@("ssn",ssn,x))
"RTN","SAMIHOM4",883,0)
 i +x'=0 d  ;
"RTN","SAMIHOM4",884,0)
 . s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",885,0)
 . ;i y>9000000 s x=0
"RTN","SAMIHOM4",886,0)
 i x>0 q x
"RTN","SAMIHOM4",887,0)
 i name'="" s x=$o(@lroot@("name",name,""))
"RTN","SAMIHOM4",888,0)
 i x=sien s x=$o(@lroot@("name",name,x))
"RTN","SAMIHOM4",889,0)
 i +x'=0 d  ;
"RTN","SAMIHOM4",890,0)
 . s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",891,0)
 . ;i y>9000000 s x=0
"RTN","SAMIHOM4",892,0)
 i x>0 q x
"RTN","SAMIHOM4",893,0)
 ;i icn'="" s x=$o(@lroot@("icn",icn,""))
"RTN","SAMIHOM4",894,0)
 ;i x=sien s x=$o(@lroot@("icn",icn,x))
"RTN","SAMIHOM4",895,0)
 ;i +x'=0 d  ;
"RTN","SAMIHOM4",896,0)
 ;. s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",897,0)
 ;. i y>9000000 s x=0
"RTN","SAMIHOM4",898,0)
 ;i x>0 q x
"RTN","SAMIHOM4",899,0)
 ;
"RTN","SAMIHOM4",900,0)
 quit 0 ; end of $$REMATCH
"RTN","SAMIHOM4",901,0)
 ;
"RTN","SAMIHOM4",902,0)
 ;
"RTN","SAMIHOM4",903,0)
 ;
"RTN","SAMIHOM4",904,0)
SETINFO(vars,msg) ; set information message text
"RTN","SAMIHOM4",905,0)
 ;
"RTN","SAMIHOM4",906,0)
 ; vars are the screen variables passed by reference
"RTN","SAMIHOM4",907,0)
 ;
"RTN","SAMIHOM4",908,0)
 s vars("infoMessage")=msg
"RTN","SAMIHOM4",909,0)
 ;
"RTN","SAMIHOM4",910,0)
 quit  ; end of SETINFO
"RTN","SAMIHOM4",911,0)
 ;
"RTN","SAMIHOM4",912,0)
 ;
"RTN","SAMIHOM4",913,0)
 ;
"RTN","SAMIHOM4",914,0)
SETWARN(vars,msg) ; set warning message text
"RTN","SAMIHOM4",915,0)
 ;
"RTN","SAMIHOM4",916,0)
 ; vars are the screen variables passed by reference
"RTN","SAMIHOM4",917,0)
 ;
"RTN","SAMIHOM4",918,0)
 s vars("warnMessage")=msg
"RTN","SAMIHOM4",919,0)
 ;
"RTN","SAMIHOM4",920,0)
 quit  ; end of SETWARN
"RTN","SAMIHOM4",921,0)
 ;
"RTN","SAMIHOM4",922,0)
 ;
"RTN","SAMIHOM4",923,0)
 ; 
"RTN","SAMIHOM4",924,0)
RTNERR(rtn,form,vals,msg,fld) ; redisplay page w/error message
"RTN","SAMIHOM4",925,0)
 ;
"RTN","SAMIHOM4",926,0)
 ; rtn is the return array
"RTN","SAMIHOM4",927,0)
 ; form is the form the page requires
"RTN","SAMIHOM4",928,0)
 ; vals are the values for the page. passed by reference
"RTN","SAMIHOM4",929,0)
 ; msg is the error message to be displayed
"RTN","SAMIHOM4",930,0)
 ; fld is the name of the field where the cursor should be put
"RTN","SAMIHOM4",931,0)
 ;
"RTN","SAMIHOM4",932,0)
 n zhtml ; work area for the tempate
"RTN","SAMIHOM4",933,0)
 d SAMIHTM^%wf(.zhtml,form,.err)
"RTN","SAMIHOM4",934,0)
 d MERGEHTM^%wf(.zhtml,.vals,.err)
"RTN","SAMIHOM4",935,0)
 m rtn=zhtml
"RTN","SAMIHOM4",936,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMIHOM4",937,0)
 ;
"RTN","SAMIHOM4",938,0)
 quit  ; end of RTNERR
"RTN","SAMIHOM4",939,0)
 ;
"RTN","SAMIHOM4",940,0)
 ;
"RTN","SAMIHOM4",941,0)
 ;
"RTN","SAMIHOM4",942,0)
RTNPAGE(rtn,form,vals) ; display page
"RTN","SAMIHOM4",943,0)
 ;
"RTN","SAMIHOM4",944,0)
 ; rtn is the return array
"RTN","SAMIHOM4",945,0)
 ; form is the form the page requires
"RTN","SAMIHOM4",946,0)
 ; vals are the values for the page. passed by reference
"RTN","SAMIHOM4",947,0)
 ;
"RTN","SAMIHOM4",948,0)
 n err
"RTN","SAMIHOM4",949,0)
 n zhtml ; work area for the tempate
"RTN","SAMIHOM4",950,0)
 d SAMIHTM^%wf(.zhtml,form,.err)
"RTN","SAMIHOM4",951,0)
 d MERGEHTM^%wf(.zhtml,.vals,.err)
"RTN","SAMIHOM4",952,0)
 m SAMIRESULT=zhtml
"RTN","SAMIHOM4",953,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMIHOM4",954,0)
 ;
"RTN","SAMIHOM4",955,0)
 quit  ; end of RTNPAGE
"RTN","SAMIHOM4",956,0)
 ;
"RTN","SAMIHOM4",957,0)
 ;
"RTN","SAMIHOM4",958,0)
 ;
"RTN","SAMIHOM4",959,0)
REINDXPL ; reindex patient lookup
"RTN","SAMIHOM4",960,0)
 ;
"RTN","SAMIHOM4",961,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",962,0)
 n zi s zi=0
"RTN","SAMIHOM4",963,0)
 k @root@("dfn")
"RTN","SAMIHOM4",964,0)
 k @root@("ssn")
"RTN","SAMIHOM4",965,0)
 k @root@("name")
"RTN","SAMIHOM4",966,0)
 k @root@("last5")
"RTN","SAMIHOM4",967,0)
 k @root@("sinamef")
"RTN","SAMIHOM4",968,0)
 k @root@("sinamel")
"RTN","SAMIHOM4",969,0)
 ; k @root@("icn")
"RTN","SAMIHOM4",970,0)
 f  s zi=$o(@root@(zi)) q:+zi=0  d  ;
"RTN","SAMIHOM4",971,0)
 . d INDXPTLK(zi)
"RTN","SAMIHOM4",972,0)
 ;
"RTN","SAMIHOM4",973,0)
 quit  ; end of REINDXPL
"RTN","SAMIHOM4",974,0)
 ;
"RTN","SAMIHOM4",975,0)
 ;
"RTN","SAMIHOM4",976,0)
 ;
"RTN","SAMIHOM4",977,0)
INDXPTLK(ien) ; generate index entries in patient-lookup graph
"RTN","SAMIHOM4",978,0)
 ;
"RTN","SAMIHOM4",979,0)
 ; for entry ien
"RTN","SAMIHOM4",980,0)
 ;
"RTN","SAMIHOM4",981,0)
 n proot set proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",982,0)
 n name s name=$g(@proot@(ien,"saminame"))
"RTN","SAMIHOM4",983,0)
 s @proot@("name",name,ien)=""
"RTN","SAMIHOM4",984,0)
 n ucname s ucname=$$UCASE(name)
"RTN","SAMIHOM4",985,0)
 s @proot@("name",ucname,ien)=""
"RTN","SAMIHOM4",986,0)
 n x
"RTN","SAMIHOM4",987,0)
 s x=$g(@proot@(ien,"dfn")) ;w !,x
"RTN","SAMIHOM4",988,0)
 i x="" d  ;
"RTN","SAMIHOM4",989,0)
 . s x=$o(@proot@("dfn","   "),-1)+1
"RTN","SAMIHOM4",990,0)
 . s @proot@(ien,"dfn")=x
"RTN","SAMIHOM4",991,0)
 s:x'="" @proot@("dfn",x,ien)=""
"RTN","SAMIHOM4",992,0)
 s x=$g(@proot@(ien,"last5")) ;w !,x
"RTN","SAMIHOM4",993,0)
 s:x'="" @proot@("last5",x,ien)=""
"RTN","SAMIHOM4",994,0)
 ;
"RTN","SAMIHOM4",995,0)
 ; s x=$g(@proot@(ien,"icn")) ;w !,x
"RTN","SAMIHOM4",996,0)
 ; i x'["V" d  ;
"RTN","SAMIHOM4",997,0)
 ; . i x="" q
"RTN","SAMIHOM4",998,0)
 ; . n chk s chk=$$CHECKDG^MPIFSPC(x)
"RTN","SAMIHOM4",999,0)
 ; . s @proot@(ien,"icn")=x_"V"_chk
"RTN","SAMIHOM4",1000,0)
 ; . s x=x_"V"_chk
"RTN","SAMIHOM4",1001,0)
 ; s:x'="" @proot@("icn",x,ien)=""
"RTN","SAMIHOM4",1002,0)
 ;
"RTN","SAMIHOM4",1003,0)
 s x=$g(@proot@(ien,"ssn")) ;w !,x
"RTN","SAMIHOM4",1004,0)
 s:x'="" @proot@("ssn",x,ien)=""
"RTN","SAMIHOM4",1005,0)
 s x=$g(@proot@(ien,"sinamef")) ;w !,x
"RTN","SAMIHOM4",1006,0)
 s:x'="" @proot@("sinamef",x,ien)=""
"RTN","SAMIHOM4",1007,0)
 s x=$g(@proot@(ien,"sinamel")) ;w !,x
"RTN","SAMIHOM4",1008,0)
 s:x'="" @proot@("sinamel",x,ien)=""
"RTN","SAMIHOM4",1009,0)
 set @proot@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHOM4",1010,0)
 ;
"RTN","SAMIHOM4",1011,0)
 quit  ; end of INDXPTLK
"RTN","SAMIHOM4",1012,0)
 ;
"RTN","SAMIHOM4",1013,0)
 ;
"RTN","SAMIHOM4",1014,0)
 ;
"RTN","SAMIHOM4",1015,0)
UNINDXPT(ien) ; remove index entries from patient-lookup graph
"RTN","SAMIHOM4",1016,0)
 ;
"RTN","SAMIHOM4",1017,0)
 ; for entry ien
"RTN","SAMIHOM4",1018,0)
 ;
"RTN","SAMIHOM4",1019,0)
 n proot set proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1020,0)
 n name s name=$g(@proot@(ien,"saminame"))
"RTN","SAMIHOM4",1021,0)
 k @proot@("name",name,ien)
"RTN","SAMIHOM4",1022,0)
 n ucname s ucname=$$UCASE(name)
"RTN","SAMIHOM4",1023,0)
 k @proot@("name",ucname,ien)
"RTN","SAMIHOM4",1024,0)
 n x
"RTN","SAMIHOM4",1025,0)
 s x=$g(@proot@(ien,"dfn")) ;w !,x
"RTN","SAMIHOM4",1026,0)
 k:x'="" @proot@("dfn",x,ien)
"RTN","SAMIHOM4",1027,0)
 s x=$g(@proot@(ien,"last5")) ;w !,x
"RTN","SAMIHOM4",1028,0)
 k:x'="" @proot@("last5",x,ien)
"RTN","SAMIHOM4",1029,0)
 ;
"RTN","SAMIHOM4",1030,0)
 ; s x=$g(@proot@(ien,"icn")) ;w !,x
"RTN","SAMIHOM4",1031,0)
 ; i x'["V" d  ;
"RTN","SAMIHOM4",1032,0)
 ; . i x="" q
"RTN","SAMIHOM4",1033,0)
 ; . n chk s chk=$$CHECKDG^MPIFSPC(x)
"RTN","SAMIHOM4",1034,0)
 ; . s @proot@(ien,"icn")=x_"V"_chk
"RTN","SAMIHOM4",1035,0)
 ; . s x=x_"V"_chk
"RTN","SAMIHOM4",1036,0)
 ; k:x'="" @proot@("icn",x,ien)
"RTN","SAMIHOM4",1037,0)
 ;
"RTN","SAMIHOM4",1038,0)
 s x=$g(@proot@(ien,"ssn")) ;w !,x
"RTN","SAMIHOM4",1039,0)
 k:x'="" @proot@("ssn",x,ien)
"RTN","SAMIHOM4",1040,0)
 s x=$g(@proot@(ien,"sinamef")) ;w !,x
"RTN","SAMIHOM4",1041,0)
 k:x'="" @proot@("sinamef",x,ien)
"RTN","SAMIHOM4",1042,0)
 s x=$g(@proot@(ien,"sinamel")) w !,x
"RTN","SAMIHOM4",1043,0)
 k:x'="" @proot@("sinamel",x,ien)
"RTN","SAMIHOM4",1044,0)
 set @proot@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHOM4",1045,0)
 ;
"RTN","SAMIHOM4",1046,0)
 quit  ; end of UNINDXPT
"RTN","SAMIHOM4",1047,0)
 ;
"RTN","SAMIHOM4",1048,0)
 ;
"RTN","SAMIHOM4",1049,0)
 ;
"RTN","SAMIHOM4",1050,0)
UCASE(STR) ; extrinsic returns uppercase of STR
"RTN","SAMIHOM4",1051,0)
 ;
"RTN","SAMIHOM4",1052,0)
 N X,Y
"RTN","SAMIHOM4",1053,0)
 S X=STR
"RTN","SAMIHOM4",1054,0)
 X ^%ZOSF("UPPERCASE")
"RTN","SAMIHOM4",1055,0)
 ;
"RTN","SAMIHOM4",1056,0)
 quit Y ; end of $$UCASE
"RTN","SAMIHOM4",1057,0)
 ;
"RTN","SAMIHOM4",1058,0)
 ;
"RTN","SAMIHOM4",1059,0)
 ;
"RTN","SAMIHOM4",1060,0)
 ;@wri-code WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",1061,0)
WSNEWCAS ; web route newcase (creates new case)
"RTN","SAMIHOM4",1062,0)
 ;
"RTN","SAMIHOM4",1063,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1064,0)
 ;
"RTN","SAMIHOM4",1065,0)
 ;ven/gpl;wri;procedure;
"RTN","SAMIHOM4",1066,0)
 ;@signature
"RTN","SAMIHOM4",1067,0)
 ; do WSNEWCAS^SAMIHOM3(SAMIARGS,SAMIBODY,SAMIRESULT)
"RTN","SAMIHOM4",1068,0)
 ;@branches-from
"RTN","SAMIHOM4",1069,0)
 ; wri WSNEWCAS^SAMIHOM3 [wr newcase]
"RTN","SAMIHOM4",1070,0)
 ;@wri-called-by
"RTN","SAMIHOM4",1071,0)
 ; wsi WSVAPALS^SAMIHOM3 [ws post vapals]
"RTN","SAMIHOM4",1072,0)
 ;@called-by none
"RTN","SAMIHOM4",1073,0)
 ;@calls
"RTN","SAMIHOM4",1074,0)
 ; parseBody^%wf
"RTN","SAMIHOM4",1075,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1076,0)
 ;  $$VALDTNM [commented out]
"RTN","SAMIHOM4",1077,0)
 ;  GETHOME [commented out]
"RTN","SAMIHOM4",1078,0)
 ;  $$NEXTNUM [commented out]
"RTN","SAMIHOM4",1079,0)
 ; $$GENSTDID^SAMIHOM3
"RTN","SAMIHOM4",1080,0)
 ; $$NOW^XLFDT
"RTN","SAMIHOM4",1081,0)
 ; $$KEYDATE^SAMIHOM3
"RTN","SAMIHOM4",1082,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMIHOM4",1083,0)
 ;  makeSbform [commented out]
"RTN","SAMIHOM4",1084,0)
 ; $$MKSIFORM^SAMIHOM3
"RTN","SAMIHOM4",1085,0)
 ; wsGetForm^%wf
"RTN","SAMIHOM4",1086,0)
 ;  WSCASE^SAMICASE [commented out]
"RTN","SAMIHOM4",1087,0)
 ;@input
"RTN","SAMIHOM4",1088,0)
 ;.ARGS =
"RTN","SAMIHOM4",1089,0)
 ; BODY =
"RTN","SAMIHOM4",1090,0)
 ;.RESULT =
"RTN","SAMIHOM4",1091,0)
 ;@output: ?
"RTN","SAMIHOM4",1092,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1093,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1094,0)
 ;
"RTN","SAMIHOM4",1095,0)
 ;
"RTN","SAMIHOM4",1096,0)
 ;@stanza 2 create new case
"RTN","SAMIHOM4",1097,0)
 ;
"RTN","SAMIHOM4",1098,0)
 merge ^SAMIUL("newCase","ARGS")=SAMIARGS
"RTN","SAMIHOM4",1099,0)
 merge ^SAMIUL("newCase","BODY")=SAMIBODY
"RTN","SAMIHOM4",1100,0)
 ;
"RTN","SAMIHOM4",1101,0)
 new vars,bdy
"RTN","SAMIHOM4",1102,0)
 set SAMIBDY=$get(SAMIBODY(1))
"RTN","SAMIHOM4",1103,0)
 if SAMIBDY="" M vars=SAMIARGS
"RTN","SAMIHOM4",1104,0)
 else  do parseBody^%wf("vars",.SAMIBDY)
"RTN","SAMIHOM4",1105,0)
 merge ^SAMIUL("newCase","vars")=vars
"RTN","SAMIHOM4",1106,0)
 ;
"RTN","SAMIHOM4",1107,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",1108,0)
 ;
"RTN","SAMIHOM4",1109,0)
 new saminame set saminame=$get(vars("name"))
"RTN","SAMIHOM4",1110,0)
 if saminame="" s saminame=$get(vars("saminame"))
"RTN","SAMIHOM4",1111,0)
 ;if $$VALDTNM(saminame,.ARGS)=-1 do  quit  ;
"RTN","SAMIHOM4",1112,0)
 ;. new r1
"RTN","SAMIHOM4",1113,0)
 ;. do GETHOME(.r1,.ARGS) ; home page to redisplay
"RTN","SAMIHOM4",1114,0)
 ;. merge RESULT=r1
"RTN","SAMIHOM4",1115,0)
 ;. quit
"RTN","SAMIHOM4",1116,0)
 ;
"RTN","SAMIHOM4",1117,0)
 new dfn s dfn=$get(vars("dfn"))
"RTN","SAMIHOM4",1118,0)
 ;if dfn="" do  quit  ;
"RTN","SAMIHOM4",1119,0)
 ;. new r1
"RTN","SAMIHOM4",1120,0)
 ;. do GETHOME(.r1,.ARGS) ; home page to redisplay
"RTN","SAMIHOM4",1121,0)
 ;. merge RESULT=r1
"RTN","SAMIHOM4",1122,0)
 ;. quit
"RTN","SAMIHOM4",1123,0)
 ;
"RTN","SAMIHOM4",1124,0)
 ; new gien set gien=$$NEXTNUM
"RTN","SAMIHOM4",1125,0)
 new gien set gien=dfn
"RTN","SAMIHOM4",1126,0)
 ;
"RTN","SAMIHOM4",1127,0)
 merge ^SAMIUL("newCase","G1")=root
"RTN","SAMIHOM4",1128,0)
 ; create dfn index
"RTN","SAMIHOM4",1129,0)
 set @root@("dfn",dfn,gien)=""
"RTN","SAMIHOM4",1130,0)
 ;
"RTN","SAMIHOM4",1131,0)
 set @root@(gien,"saminum")=gien
"RTN","SAMIHOM4",1132,0)
 set @root@(gien,"saminame")=saminame
"RTN","SAMIHOM4",1133,0)
 ;
"RTN","SAMIHOM4",1134,0)
 new studyid set studyid=$$GENSTDID^SAMIHOM3(gien,.SAMIARGS)
"RTN","SAMIHOM4",1135,0)
 set @root@(gien,"samistudyid")=studyid
"RTN","SAMIHOM4",1136,0)
 set @root@("sid",studyid,gien)=""
"RTN","SAMIHOM4",1137,0)
 ;
"RTN","SAMIHOM4",1138,0)
 new datekey set datekey=$$KEYDATE^SAMIHOM3($$NOW^XLFDT)
"RTN","SAMIHOM4",1139,0)
 set @root@(gien,"samicreatedate")=datekey
"RTN","SAMIHOM4",1140,0)
 ;
"RTN","SAMIHOM4",1141,0)
 merge ^SAMIUL("newCase",gien)=@root@(gien)
"RTN","SAMIHOM4",1142,0)
 ;
"RTN","SAMIHOM4",1143,0)
 ;
"RTN","SAMIHOM4",1144,0)
 do PREFILL^SAMIHOM3(dfn) ; prefills from the "patient-lookup" graph
"RTN","SAMIHOM4",1145,0)
 ;
"RTN","SAMIHOM4",1146,0)
 new siformkey
"RTN","SAMIHOM4",1147,0)
 ; do makeSbform(gien) ; create background form for new patient
"RTN","SAMIHOM4",1148,0)
 set siformkey=$$MKSIFORM^SAMIHOM3(gien) ; create intake for new patient
"RTN","SAMIHOM4",1149,0)
 ;
"RTN","SAMIHOM4",1150,0)
 set SAMIARGS("studyid")=studyid
"RTN","SAMIHOM4",1151,0)
 set SAMIARGS("form")="vapals:"_siformkey
"RTN","SAMIHOM4",1152,0)
 do wsGetForm^%wf(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",1153,0)
 ; do WSCASE^SAMICASE(.SAMIRESULT,.SAMIARGS) ; navigate to case review page
"RTN","SAMIHOM4",1154,0)
 ;
"RTN","SAMIHOM4",1155,0)
 ;
"RTN","SAMIHOM4",1156,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",1157,0)
 ;
"RTN","SAMIHOM4",1158,0)
 quit  ; end of wri WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",1159,0)
 ;
"RTN","SAMIHOM4",1160,0)
 ;
"RTN","SAMIHOM4",1161,0)
 ;
"RTN","SAMIHOM4",1162,0)
EOR ; end of routine SAMIHOM4
"RTN","SAMIHUL")
0^7^B120634
"RTN","SAMIHUL",1,0)
SAMIHUL ;ven/gpl - ielcap: home page log ;2022-04-27t22:07z
"RTN","SAMIHUL",2,0)
 ;;18.0;SAMI;**9,12,15,16,17**;2020-01;Build 1
"RTN","SAMIHUL",3,0)
 ;18-17
"RTN","SAMIHUL",4,0)
 ;
"RTN","SAMIHUL",5,0)
 ; SAMIHOM3 contains subroutines for producing the ELCAP Home Page.
"RTN","SAMIHUL",6,0)
 ; SAMIHUL contains the development log for the SAMIHOM* routines.
"RTN","SAMIHUL",7,0)
 ; It contains no executable code.
"RTN","SAMIHUL",8,0)
 ;
"RTN","SAMIHUL",9,0)
 quit  ; no entry from top
"RTN","SAMIHUL",10,0)
 ;
"RTN","SAMIHUL",11,0)
 ;
"RTN","SAMIHUL",12,0)
 ;
"RTN","SAMIHUL",13,0)
 ;@section 0 primary development
"RTN","SAMIHUL",14,0)
 ;
"RTN","SAMIHUL",15,0)
 ;
"RTN","SAMIHUL",16,0)
 ;
"RTN","SAMIHUL",17,0)
 ;@routine-credits
"RTN","SAMIHUL",18,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIHUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIHUL",20,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIHUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMIHUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIHUL",23,0)
 ;@license see routine SAMIUL
"RTN","SAMIHUL",24,0)
 ;
"RTN","SAMIHUL",25,0)
 ;@last-update 2022-04-27t22:07z
"RTN","SAMIHUL",26,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIHUL",27,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIHUL",28,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIHUL",29,0)
 ;@version 18-15
"RTN","SAMIHUL",30,0)
 ;@release-date 2020-01
"RTN","SAMIHUL",31,0)
 ;@patch-list **9,12,15,16**
"RTN","SAMIHUL",32,0)
 ;
"RTN","SAMIHUL",33,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIHUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMIHUL",35,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIHUL",36,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIHUL",37,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIHUL",38,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIHUL",39,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIHUL",40,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIHUL",41,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIHUL",42,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIHUL",43,0)
 ;@dev-add Domenick DiNatale (ddn)
"RTN","SAMIHUL",44,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMIHUL",45,0)
 ;
"RTN","SAMIHUL",46,0)
 ;@module-credits
"RTN","SAMIHUL",47,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIHUL",48,0)
 ; (VA-PALS)
"RTN","SAMIHUL",49,0)
 ; http://va-pals.org/
"RTN","SAMIHUL",50,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIHUL",51,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIHUL",52,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIHUL",53,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIHUL",54,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIHUL",55,0)
 ; http://ielcap.com/
"RTN","SAMIHUL",56,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIHUL",57,0)
 ; http://paraxialtech.com/
"RTN","SAMIHUL",58,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIHUL",59,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIHUL",60,0)
 ;
"RTN","SAMIHUL",61,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIHUL",62,0)
 ;
"RTN","SAMIHUL",63,0)
 ; 2018-01-13 ven/gpl 18.0-t4
"RTN","SAMIHUL",64,0)
 ;  SAMIHOM3 create routine from SAMIFRM to implement ELCAP Home Page.
"RTN","SAMIHUL",65,0)
 ;
"RTN","SAMIHUL",66,0)
 ; 2018-02-05 ven/toad 18.0-t4
"RTN","SAMIHUL",67,0)
 ;  SAMIHOM3 update license & attribution & hdr comments, add white
"RTN","SAMIHUL",68,0)
 ; space & do-dot quits, spell out language elements.
"RTN","SAMIHUL",69,0)
 ;
"RTN","SAMIHUL",70,0)
 ; 2018-02-27 ven/gpl 18.0-t4
"RTN","SAMIHUL",71,0)
 ;  SAMIHOM3 new subroutines PREFIX,GETHOME,SCANFOR,WSNEWCAS,PREFILL,
"RTN","SAMIHUL",72,0)
 ; MKSBFORM,MKSIFORM,VALDTNM,SID2NUM,KEYDATE,GENSTDID,NEXTNUM to
"RTN","SAMIHUL",73,0)
 ; support creation of new cases.
"RTN","SAMIHUL",74,0)
 ;
"RTN","SAMIHUL",75,0)
 ; 2018-03-01 ven/toad 18.0-t4
"RTN","SAMIHUL",76,0)
 ;  SAMIHOM3 refactor & reorganize new code, add hdr comments,
"RTN","SAMIHUL",77,0)
 ; r/findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMIHUL",78,0)
 ;
"RTN","SAMIHUL",79,0)
 ; 2018-03-06 ven/gpl 18.0-t4
"RTN","SAMIHUL",80,0)
 ;  SAMIHOM3 ?
"RTN","SAMIHUL",81,0)
 ;
"RTN","SAMIHUL",82,0)
 ; 2018-03-07 ven/toad 18.0-t4
"RTN","SAMIHUL",83,0)
 ;  SAMIHOM3 in $$SID2NUM add WSNUFORM^SAMICASE to called-by; in
"RTN","SAMIHUL",84,0)
 ; keyDate,GETHOME update called-by.
"RTN","SAMIHUL",85,0)
 ;
"RTN","SAMIHUL",86,0)
 ; 2018-05-18/25 ven/lgc&arc 18.0-t4 76020fd,81b1048,65afd99
"RTN","SAMIHUL",87,0)
 ;  SAMIHOM3 new SAMIHOM3 for new patient search page, chg submit
"RTN","SAMIHUL",88,0)
 ; processing on forms, fix bug in postform.
"RTN","SAMIHUL",89,0)
 ;
"RTN","SAMIHUL",90,0)
 ; 2018-06-14/07-10 ven/lgc&arc 18.0-t4 d71f4fe,8b0a432,ce345db,
"RTN","SAMIHUL",91,0)
 ; 402b6a8,14f991d,2e9662b
"RTN","SAMIHUL",92,0)
 ;  SAMIHOM3 make background form optional; 1st version of CT Eval
"RTN","SAMIHUL",93,0)
 ; Report; reorg ctreport routines & 1st crack at impressions &
"RTN","SAMIHUL",94,0)
 ; recommendations; note produced for intake form on submit; add
"RTN","SAMIHUL",95,0)
 ; support for routing by patient in CPRS Tools Menu, modify
"RTN","SAMIHUL",96,0)
 ; wsHOME^SAMIHOM3 to properly route VA-PALS web app when launced via
"RTN","SAMIHUL",97,0)
 ; CPRS Tools Menu; repair SAMIHOM3 & redact report link.
"RTN","SAMIHUL",98,0)
 ;
"RTN","SAMIHUL",99,0)
 ; 2018-08-22 ven/gpl 18.0-t4 6e696a9
"RTN","SAMIHUL",100,0)
 ;  SAMIHOM3 add PTINFO call to vista to pull ssn.
"RTN","SAMIHUL",101,0)
 ;
"RTN","SAMIHUL",102,0)
 ; 2018-09-30/11-01 ven/lgc&arc 18.0-t4 d93c640,482f522,a8e4226,
"RTN","SAMIHUL",103,0)
 ; ee5e8a1
"RTN","SAMIHUL",104,0)
 ;  SAMIHOM3 hdr & prefill of intake; new input form features, report
"RTN","SAMIHUL",105,0)
 ; menu fix; set urban/rural status at siform setup; handle zip code
"RTN","SAMIHUL",106,0)
 ; unknown.
"RTN","SAMIHUL",107,0)
 ;
"RTN","SAMIHUL",108,0)
 ; 2018-11-09/2019-01-22 ven/lgc&arc&lmry 18.0-t4 bac4f73,5400035,
"RTN","SAMIHUL",109,0)
 ; dd341e0,a953946,e2a44e6,2356c2b,3ceb74b,3088307,4271b46,7a5d340,
"RTN","SAMIHUL",110,0)
 ; dfbb0bc,fd1bcee,8dd6f34,51eb163,dbdb5a4,0880027,ccba017,5368121
"RTN","SAMIHUL",111,0)
 ;  SAMIHOM3 unit tests, annotation, sac compliance, XINDEX bugs, fix
"RTN","SAMIHUL",112,0)
 ; accidental reversions, add license info.
"RTN","SAMIHUL",113,0)
 ;
"RTN","SAMIHUL",114,0)
 ; 2018-12-18/20 ven/arc 18.0-t4 3088307f,4271b46b,dfbb0bca,
"RTN","SAMIHUL",115,0)
 ;  b8ff6da9,fd1bceee
"RTN","SAMIHUL",116,0)
 ;  SAMIHOM4 va sac compliance & variable namespacing.
"RTN","SAMIHUL",117,0)
 ;
"RTN","SAMIHUL",118,0)
 ; 2019-01-01/02-18 ven/lgc 18.0-t4 0880027c,18aa0fec,fcd635c1,
"RTN","SAMIHUL",119,0)
 ;  53681219,76874314
"RTN","SAMIHUL",120,0)
 ;  SAMIHOM3 update w/ recent changes.
"RTN","SAMIHUL",121,0)
 ;  SAMIHOM4 updates for va sac & code coverage, add license info.
"RTN","SAMIHUL",122,0)
 ;
"RTN","SAMIHUL",123,0)
 ; 2019-04-15 ven/gpl 18.0-t4 b403bf01
"RTN","SAMIHUL",124,0)
 ;  SAMIHOM4 support for new intake notes.
"RTN","SAMIHUL",125,0)
 ;
"RTN","SAMIHUL",126,0)
 ; 2019-04-16 ven/lgc 18.0-t4 e54b76d1
"RTN","SAMIHUL",127,0)
 ;  SAMIHOM4 update for SAMIFORM project.
"RTN","SAMIHUL",128,0)
 ;
"RTN","SAMIHUL",129,0)
 ; 2019-04-17 ven/gpl 18.0-t4 7d1f86db
"RTN","SAMIHUL",130,0)
 ;  SAMIHOM3 prefill date on intake prelim discussion section.
"RTN","SAMIHUL",131,0)
 ;
"RTN","SAMIHUL",132,0)
 ; 2019-06-18 ven/arc 18.0-t4 91022482
"RTN","SAMIHUL",133,0)
 ;  SAMIHOM4 switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMIHUL",134,0)
 ;
"RTN","SAMIHUL",135,0)
 ; 2019-08-05 ven/gpl 18.0-t4 9c0c2ed3
"RTN","SAMIHUL",136,0)
 ;  SAMIHOM3 add GETPRFX to get right prefix at registration.
"RTN","SAMIHUL",137,0)
 ;
"RTN","SAMIHUL",138,0)
 ; 2019-08-07 ven/lgc&arc 18.0-t4 603194b9,37967fc5
"RTN","SAMIHUL",139,0)
 ;  SAMIHOM3 consolidate calls to retrieve facility prefix.
"RTN","SAMIHUL",140,0)
 ;
"RTN","SAMIHUL",141,0)
 ; 2019-11-22 par/ddn 18.0-t4 b2cc389d vap-458
"RTN","SAMIHUL",142,0)
 ;  SAMIHOM4 manual registration.
"RTN","SAMIHUL",143,0)
 ;
"RTN","SAMIHUL",144,0)
 ; 2020-01-01/05 ven/lgc 18.0-t4 c169f4b1,5928064a,62e3200f
"RTN","SAMIHUL",145,0)
 ;  SAMIHOM4 support for unmatched patient processing, more changes
"RTN","SAMIHUL",146,0)
 ; for participant matching, unmatched participant processing ready
"RTN","SAMIHUL",147,0)
 ; for testing.
"RTN","SAMIHUL",148,0)
 ;
"RTN","SAMIHUL",149,0)
 ; 2020-01-08/10 ven/gpl 18.0 a002f850,47dfe3cd
"RTN","SAMIHUL",150,0)
 ;  SAMIHOM4 bug fix for unmatched processing, turn off & on manual
"RTN","SAMIHUL",151,0)
 ; registration link on home page.
"RTN","SAMIHUL",152,0)
 ;
"RTN","SAMIHUL",153,0)
 ; 2020-01-10 ven/gpl 18.0 4c8e6ebc,76b465cb
"RTN","SAMIHUL",154,0)
 ;  SAMIHOM4 3 quits with returns for cache.
"RTN","SAMIHUL",155,0)
 ;
"RTN","SAMIHUL",156,0)
 ; 2020-01-16 ven/lgc 18.0 0a2af965
"RTN","SAMIHUL",157,0)
 ;  SAMIHOM4 bulk commit due to switch to cache.
"RTN","SAMIHUL",158,0)
 ;
"RTN","SAMIHUL",159,0)
 ; 2020-01-17/20 ven/lgc 18.1 8557207f,dc5f618c
"RTN","SAMIHUL",160,0)
 ;  SAMIHOM4 followup note, limit to one note per followup form.
"RTN","SAMIHUL",161,0)
 ;
"RTN","SAMIHUL",162,0)
 ; 2020-02-01/02 ven/lgc 18.4 3065146d,36ae0ed1
"RTN","SAMIHUL",163,0)
 ;  SAMIHOM4 set options for text based ctreport, switch default
"RTN","SAMIHUL",164,0)
 ; ctreport to text.
"RTN","SAMIHUL",165,0)
 ;
"RTN","SAMIHUL",166,0)
 ; 2020-04-02/11 ven/gpl 18.5 d36b7cad,36607664,befde317,56bfaed6,
"RTN","SAMIHUL",167,0)
 ; 666f5b91,2f2c29c1
"RTN","SAMIHUL",168,0)
 ;  SAMIHOM3 multitenancy; in GENSTDID add ARG param, determin prefix
"RTN","SAMIHUL",169,0)
 ; from site or siteid (ARG) instead of calling $$GETPRFX^SAMIFORM.
"RTN","SAMIHUL",170,0)
 ;  SAMIHOM4 multitenancy + fix bug in WSVAPALS.
"RTN","SAMIHUL",171,0)
 ;
"RTN","SAMIHUL",172,0)
 ; 2020-04-18/05-07 ven/gpl 18.5 29d7dba7,d55de214,521e0bdc,d018f52e,
"RTN","SAMIHUL",173,0)
 ; 476b2ff4,61c7d208
"RTN","SAMIHUL",174,0)
 ;  SAMIHOM4 fix bug & weird error in manual registration, fix bug in
"RTN","SAMIHUL",175,0)
 ; logout, logout working, superuser site selection, worklist
"RTN","SAMIHUL",176,0)
 ; functionality.
"RTN","SAMIHUL",177,0)
 ;
"RTN","SAMIHUL",178,0)
 ; 2020-08-06 ven/gpl 18.6 781744c3
"RTN","SAMIHUL",179,0)
 ;  SAMIHOM4 changes to support hl7 transmission of notes.
"RTN","SAMIHUL",180,0)
 ;
"RTN","SAMIHUL",181,0)
 ; 2020-09-22 ven/gpl 18.9 06459eda
"RTN","SAMIHUL",182,0)
 ;  SAMIHOM4 correct to match kids file.
"RTN","SAMIHUL",183,0)
 ;
"RTN","SAMIHUL",184,0)
 ; 2021-03-02 ven/gpl 18.9 479dc041
"RTN","SAMIHUL",185,0)
 ;  SAMIHOM4 return error message if no ct eval form exists when
"RTN","SAMIHUL",186,0)
 ; generating a fu note.
"RTN","SAMIHUL",187,0)
 ;
"RTN","SAMIHUL",188,0)
 ; 2021-03-11 ven/toad 18.9 a46a2cc1
"RTN","SAMIHUL",189,0)
 ;  SAMIHUL create routine.
"RTN","SAMIHUL",190,0)
 ;  SAMIHOM4 bump date & patch list, add contents, lt refactor.
"RTN","SAMIHUL",191,0)
 ;
"RTN","SAMIHUL",192,0)
 ; 2021-03-17 ven/toad 18.9
"RTN","SAMIHUL",193,0)
 ;  SAMIHOM4 remove blank from end of 1 line.
"RTN","SAMIHUL",194,0)
 ;
"RTN","SAMIHUL",195,0)
 ; 2021-05-29 ven/gpl 18.12-t2 59ea0811
"RTN","SAMIHUL",196,0)
 ;  SAMIHOM3 in SID2NUM look up by pien instead of relying on sid
"RTN","SAMIHUL",197,0)
 ; containing pien.
"RTN","SAMIHUL",198,0)
 ;
"RTN","SAMIHUL",199,0)
 ; 2021-06-15 ven/gpl 18.12-t2 e247ea59
"RTN","SAMIHUL",200,0)
 ;  SAMIHOM4 eliminate icn.
"RTN","SAMIHUL",201,0)
 ;
"RTN","SAMIHUL",202,0)
 ; 2021-06-15/16 ven/mcglk&toad 18.12-t2 cbf7e46b,fa794d60
"RTN","SAMIHUL",203,0)
 ;  SAMIHOM3 move log to SAMIHUL, bump dates & versions, annotate,
"RTN","SAMIHUL",204,0)
 ; reorg, lt refactor.
"RTN","SAMIHUL",205,0)
 ;  SAMIHOM4 bump dates & versions; begin annotate, reorg, lt refactor
"RTN","SAMIHUL",206,0)
 ; but interrupted by addition of critical fix to patch & bronchitis,
"RTN","SAMIHUL",207,0)
 ; so leave refactor unfinished (but stable as far as it went).
"RTN","SAMIHUL",208,0)
 ;  SAMIUTH3 bump dates & versions, lt refactor, add COVER, in UTSCAN4
"RTN","SAMIHUL",209,0)
 ; fix $random bug, but after discovering the SAMI test suite is so
"RTN","SAMIHUL",210,0)
 ; far out of date that it fails catastrophically with thousands of
"RTN","SAMIHUL",211,0)
 ; errors, back out changes and leave as it was.
"RTN","SAMIHUL",212,0)
 ;
"RTN","SAMIHUL",213,0)
 ; 2021-08-01 ven/gpl 18.12 5bd7c627
"RTN","SAMIHUL",214,0)
 ;  SAMIHOM3 set intake form to incomplete on creation: in MKSIFORM
"RTN","SAMIHUL",215,0)
 ; r/complete w/incomplete.
"RTN","SAMIHUL",216,0)
 ;
"RTN","SAMIHUL",217,0)
 ; 2021-09-20/23 ven/gpl 18-x-16 db1b173a,465b009d
"RTN","SAMIHUL",218,0)
 ;  SAMIHOM4 (with new routine SAMIZPH1) developed to import data from 
"RTN","SAMIHUL",219,0)
 ;  Philadelphia VA's previous LCS database in Red Cap, bump dates & versions.
"RTN","SAMIHUL",220,0)
 ;
"RTN","SAMIHUL",221,0)
 ; 2021-9-24 ven/lmry 18-16 465b009d
"RTN","SAMIHUL",222,0)
 ;  SAMIHOM4 bumped versions and dates
"RTN","SAMIHUL",223,0)
 ;
"RTN","SAMIHUL",224,0)
 ; 2021-10-19 ven/gpl 18-15 138d45e5
"RTN","SAMIHUL",225,0)
 ;  SAMIHOM4 parameterize veteran vs participant or candidate for notes
"RTN","SAMIHUL",226,0)
 ;
"RTN","SAMIHUL",227,0)
 ; 2021-10-29 ven/lmry 18-15  4267917c
"RTN","SAMIHUL",228,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",229,0)
 ;
"RTN","SAMIHUL",230,0)
 ; 2021-11-01 ven/gpl 18-15  e4722e8f0
"RTN","SAMIHUL",231,0)
 ;  SAMIHOM4 prevent using SYS as a site
"RTN","SAMIHUL",232,0)
 ;
"RTN","SAMIHUL",233,0)
 ; 2021-11-09 ven/gpl 18-15 34367ef0
"RTN","SAMIHUL",234,0)
 ;  SAMIHOM4 change GETHOME to cut off GET requests
"RTN","SAMIHUL",235,0)
 ;
"RTN","SAMIHUL",236,0)
 ; 2021-11-10 ven/gpl 18-15 ed2a3480
"RTN","SAMIHUL",237,0)
 ;  SAMIHOM4 support for samiroute=about points to vapals:about
"RTN","SAMIHUL",238,0)
 ;
"RTN","SAMIHUL",239,0)
 ; 2021-11-18 ven/lmry 18-15 596ea463
"RTN","SAMIHUL",240,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",241,0)
 ;
"RTN","SAMIHUL",242,0)
 ; 2021-11-22 ven/gpl 18-16  d26d00a7
"RTN","SAMIHUL",243,0)
 ;  SAMIHOM4 patch 16 DCM functionality
"RTN","SAMIHUL",244,0)
 ;
"RTN","SAMIHUL",245,0)
 ; 2022-01-02 ven/gpl 18-16 45fa4633
"RTN","SAMIHUL",246,0)
 ;  SAMIHOM4 Nashville sample data processing
"RTN","SAMIHUL",247,0)
 ;
"RTN","SAMIHUL",248,0)
 ; 2022-01-12 ven/gpl 18-15  ea379b6b
"RTN","SAMIHUL",249,0)
 ;  SAMIHOM4 change calls to SAMIORU to use a parameterized site
"RTN","SAMIHUL",250,0)
 ;
"RTN","SAMIHUL",251,0)
 ; 2022-01-12 ven/lmry 18-15  bcef2106
"RTN","SAMIHUL",252,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",253,0)
 ;
"RTN","SAMIHUL",254,0)
 ; 2022-01-17 ven/lmry 18-16  e69ca23e
"RTN","SAMIHUL",255,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",256,0)
 ;
"RTN","SAMIHUL",257,0)
 ; 2022-04-04 ven/gpl 18-17   ec245b1e
"RTN","SAMIHUL",258,0)
 ;  SAMIHOM4 change logout to accomodate single signon
"RTN","SAMIHUL",259,0)
 ;
"RTN","SAMIHUL",260,0)
 ; 2022-04-04 ven/lmry 18-17  258bc926
"RTN","SAMIHUL",261,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",262,0)
 ;
"RTN","SAMIHUL",263,0)
 ; 2022-04-26 ven/gpl  18-17  89497ba8
"RTN","SAMIHUL",264,0)
 ;  SAMIHOM4 setup for logout redirect
"RTN","SAMIHUL",265,0)
 ;
"RTN","SAMIHUL",266,0)
 ; 2022-04-27 ven/lmry 18-17
"RTN","SAMIHUL",267,0)
 ;  SAMIHOM4 and SAMIHUL bumped dates, inserted space for XINDEX
"RTN","SAMIHUL",268,0)
 ;  
"RTN","SAMIHUL",269,0)
 ;
"RTN","SAMIHUL",270,0)
 ;@contents
"RTN","SAMIHUL",271,0)
 ; SAMIHOM3 homepage interface library
"RTN","SAMIHUL",272,0)
 ; SAMIHOM4 homepage subroutines
"RTN","SAMIHUL",273,0)
 ; SAMIHUL homepage development log
"RTN","SAMIHUL",274,0)
 ; SAMIUTH3 tests for SAMIHOM3
"RTN","SAMIHUL",275,0)
 ; SAMIUTH4 tests for SAMIHOM4
"RTN","SAMIHUL",276,0)
 ;
"RTN","SAMIHUL",277,0)
 ;
"RTN","SAMIHUL",278,0)
 ;
"RTN","SAMIHUL",279,0)
EOR ; end of routine SAMIHUL
"RTN","SAMIPAT")
0^8^B10800523
"RTN","SAMIPAT",1,0)
SAMIPAT ;ven/toad - init subroutines ;2022-12-28t06:00z
"RTN","SAMIPAT",2,0)
 ;;18.0;SAMI;**12,14,15,17**;2020-01;Build 1
"RTN","SAMIPAT",3,0)
 ;;18-17
"RTN","SAMIPAT",4,0)
 ;
"RTN","SAMIPAT",5,0)
 ; Routine SAMIPAT contains VAPALS-ELCAP initialization subroutines
"RTN","SAMIPAT",6,0)
 ; to use as KIDS pre- & post-installs & environment checks.
"RTN","SAMIPAT",7,0)
 ;
"RTN","SAMIPAT",8,0)
 quit  ; no entry from top
"RTN","SAMIPAT",9,0)
 ;
"RTN","SAMIPAT",10,0)
 ;
"RTN","SAMIPAT",11,0)
 ;
"RTN","SAMIPAT",12,0)
 ;@section 0 primary development
"RTN","SAMIPAT",13,0)
 ;
"RTN","SAMIPAT",14,0)
 ;
"RTN","SAMIPAT",15,0)
 ;
"RTN","SAMIPAT",16,0)
 ;@routine-credits
"RTN","SAMIPAT",17,0)
 ;@dev-main Frederick D. S. Marshall (toad)
"RTN","SAMIPAT",18,0)
 ; toad@vistaexpertise.net
"RTN","SAMIPAT",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIPAT",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIPAT",21,0)
 ;@copyright 2021, toad, all rights reserved
"RTN","SAMIPAT",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIPAT",23,0)
 ;
"RTN","SAMIPAT",24,0)
 ;@last-update 2022-12-28t06:00z
"RTN","SAMIPAT",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIPAT",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIPAT",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIPAT",28,0)
 ;@version 18.17
"RTN","SAMIPAT",29,0)
 ;@release-date 2020-01
"RTN","SAMIPAT",30,0)
 ;@patch-list **12,14,15,17**
"RTN","SAMIPAT",31,0)
 ;
"RTN","SAMIPAT",32,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIPAT",33,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIPAT",34,0)
 ;@dev-add George P. Lilly (gpl)
"RTN","SAMIPAT",35,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIPAT",36,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIPAT",37,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIPAT",38,0)
 ;
"RTN","SAMIPAT",39,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIPAT",40,0)
 ; 2021-07-01 ven/mcglk&toad 18.12-t2 cbf7e46b
"RTN","SAMIPAT",41,0)
 ;  SAMIPAT new routine, new POS1812 post-install for patch 12.
"RTN","SAMIPAT",42,0)
 ;
"RTN","SAMIPAT",43,0)
 ; 2021-07-22/23 ven/toad 18.12  
"RTN","SAMIPAT",44,0)
 ;  SAMIPAT add PRE1812 pre-install.
"RTN","SAMIPAT",45,0)
 ;
"RTN","SAMIPAT",46,0)
 ; 2021-08-11 ven/mcglk&toad 18.12  b16cd38f
"RTN","SAMIPAT",47,0)
 ;  SAMIPAT rip out PRE1812.
"RTN","SAMIPAT",48,0)
 ;
"RTN","SAMIPAT",49,0)
 ; 2021-09-08 ven/lmry 18.14  2af1f2e7
"RTN","SAMIPAT",50,0)
 ;  SAMIPAT add post-install for patch SAMI*1.18*14
"RTN","SAMIPAT",51,0)
 ;
"RTN","SAMIPAT",52,0)
 ; 2021-10-28 ven/lmry 18-15  0b585061
"RTN","SAMIPAT",53,0)
 ;  SAMIPAT create a STANDARD subroutine with post-install commands that are
"RTN","SAMIPAT",54,0)
 ;  used for almost all patches. Change POS1814 to use that routine and add
"RTN","SAMIPAT",55,0)
 ;  POS1815.
"RTN","SAMIPAT",56,0)
 ;
"RTN","SAMIPAT",57,0)
 ; 2021-10-29 ven/lmry 18-15  6e9594e8
"RTN","SAMIPAT",58,0)
 ;  SAMIPAT remove a space before STANDARD
"RTN","SAMIPAT",59,0)
 ;
"RTN","SAMIPAT",60,0)
 ; 2021-11-14 ven/lmry 18-15  3a30fe59
"RTN","SAMIPAT",61,0)
 ;  SAMIPAT  Add commands for 18-15-t2.
"RTN","SAMIPAT",62,0)
 ;
"RTN","SAMIPAT",63,0)
 ; 2021-11-18 ven/lmry  18-15  4d71eef7
"RTN","SAMIPAT",64,0)
 ;  SAMIPAT  Fix for XINDEX
"RTN","SAMIPAT",65,0)
 ;
"RTN","SAMIPAT",66,0)
 ; 2021-12-07 ven/lmry 18-15   75a19c5c
"RTN","SAMIPAT",67,0)
 ;  SAMIPAT  Update for final 18-15 patch
"RTN","SAMIPAT",68,0)
 ;
"RTN","SAMIPAT",69,0)
 ; 2022-04-04 ven/lmry 18-17   258bc926
"RTN","SAMIPAT",70,0)
 ;  SAMIPAT  Update for 18-17-t1 patch
"RTN","SAMIPAT",71,0)
 ;
"RTN","SAMIPAT",72,0)
 ; 2022-04-27 ven/lmry 18-17
"RTN","SAMIPAT",73,0)
 ;  SAMIPAT  Update for 18-17-t2 patch
"RTN","SAMIPAT",74,0)
 ;
"RTN","SAMIPAT",75,0)
 ; 2022-12-13 ven/lmry 18-17
"RTN","SAMIPAT",76,0)
 ;  SAMIPAT: Update for 18-17-t3 patch
"RTN","SAMIPAT",77,0)
 ;
"RTN","SAMIPAT",78,0)
 ; 2022-12-28 ven/lmry 18-17
"RTN","SAMIPAT",79,0)
 ;  SAMIPAT: Update for 18-17-t4 patch
"RTN","SAMIPAT",80,0)
 ;
"RTN","SAMIPAT",81,0)
 ;
"RTN","SAMIPAT",82,0)
 ;@contents
"RTN","SAMIPAT",83,0)
 ; STANDARD usual post-install commands
"RTN","SAMIPAT",84,0)
 ; POS1812 kids post-install for sami 18.12
"RTN","SAMIPAT",85,0)
 ; POS1814 kids post-install for sami 18.14
"RTN","SAMIPAT",86,0)
 ; POS1815 kids post-install for sami 18.15
"RTN","SAMIPAT",87,0)
 ; POS1817 kids post-install for sami 18.17
"RTN","SAMIPAT",88,0)
 ;
"RTN","SAMIPAT",89,0)
 ;
"RTN","SAMIPAT",90,0)
 ;
"RTN","SAMIPAT",91,0)
 ;@section 1 subroutine for most patches
"RTN","SAMIPAT",92,0)
 ;
"RTN","SAMIPAT",93,0)
STANDARD ; usual post-install commands
"RTN","SAMIPAT",94,0)
 set SAMIDIR="/home/osehra/lib/silver/a-sami-vapals-elcap--vo-osehra-github/docs/form-fields/"
"RTN","SAMIPAT",95,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"background.tsv","form fields - background")
"RTN","SAMIPAT",96,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"biopsy.tsv","form fields - biopsy")
"RTN","SAMIPAT",97,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"ct-evaluation.tsv","form fields - ct evaluation")
"RTN","SAMIPAT",98,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"follow-up.tsv","form fields - follow up")
"RTN","SAMIPAT",99,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"intake.tsv","form fields - intake")
"RTN","SAMIPAT",100,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"intervention.tsv","form fields - intervention")
"RTN","SAMIPAT",101,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"pet-evaluation.tsv","form fields - pet evaluation")
"RTN","SAMIPAT",102,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"register.tsv","form fields - register")
"RTN","SAMIPAT",103,0)
 do DODD^SAMIADMN(SAMIDIR) ; to import tsv files to generate DD graphs
"RTN","SAMIPAT",104,0)
 do CLRWEB^SAMIADMN ; Clear the M Web Server files cache
"RTN","SAMIPAT",105,0)
 do INIT2GPH^SAMICTD2 ; initialize CTEVAL dictionary into graph cteval-dict
"RTN","SAMIPAT",106,0)
 ;
"RTN","SAMIPAT",107,0)
 ;
"RTN","SAMIPAT",108,0)
 ;
"RTN","SAMIPAT",109,0)
 ;@section 2 subroutines for SAMI 18.12
"RTN","SAMIPAT",110,0)
 ;
"RTN","SAMIPAT",111,0)
 ;@kids-post POST1812^SAMIPAT
"RTN","SAMIPAT",112,0)
POS1812 ; kids post-install for sami 18.12
"RTN","SAMIPAT",113,0)
 ;
"RTN","SAMIPAT",114,0)
 do ADDSVC^SAMIPARM ; install get params web service
"RTN","SAMIPAT",115,0)
 ;
"RTN","SAMIPAT",116,0)
 ; in honor of Tchaikovsky's overture: boom
"RTN","SAMIPAT",117,0)
 ;
"RTN","SAMIPAT",118,0)
 quit  ; end of kids-post POS1812^SAMIPAT
"RTN","SAMIPAT",119,0)
 ;
"RTN","SAMIPAT",120,0)
 ;
"RTN","SAMIPAT",121,0)
 ;
"RTN","SAMIPAT",122,0)
 ;@section 3 subroutines for SAMI 18.14
"RTN","SAMIPAT",123,0)
 ;
"RTN","SAMIPAT",124,0)
 ;@kids-post POST1814^SAMIPAT
"RTN","SAMIPAT",125,0)
POS1814 ; kids post-install for sami 18.14
"RTN","SAMIPAT",126,0)
 ;
"RTN","SAMIPAT",127,0)
 do STANDARD
"RTN","SAMIPAT",128,0)
 ;
"RTN","SAMIPAT",129,0)
 quit  ; end of kids-post POS1814^SAMIPAT
"RTN","SAMIPAT",130,0)
 ;
"RTN","SAMIPAT",131,0)
 ;
"RTN","SAMIPAT",132,0)
 ;
"RTN","SAMIPAT",133,0)
 ;@section 4 subroutines for SAMI 18.15
"RTN","SAMIPAT",134,0)
 ;
"RTN","SAMIPAT",135,0)
 ;@kids-post POST1815^SAMIPAT
"RTN","SAMIPAT",136,0)
POS1815 ; kids post-install for sami 18.15
"RTN","SAMIPAT",137,0)
 ;
"RTN","SAMIPAT",138,0)
 do STANDARD
"RTN","SAMIPAT",139,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-15")
"RTN","SAMIPAT",140,0)
 do deleteService^%webutils("GET","vapals")
"RTN","SAMIPAT",141,0)
 do addService^%webutils("GET","vapals","GETHOME^SAMIHOM3")
"RTN","SAMIPAT",142,0)
 do SETMAP^SAMIPARM("vapals:about","about.html")
"RTN","SAMIPAT",143,0)
 ;
"RTN","SAMIPAT",144,0)
 quit  ; end of kids-post POS1815^SAMIPAT
"RTN","SAMIPAT",145,0)
 ;
"RTN","SAMIPAT",146,0)
 ;
"RTN","SAMIPAT",147,0)
 ;@section 5 subroutines for SAMI 18.17
"RTN","SAMIPAT",148,0)
 ;
"RTN","SAMIPAT",149,0)
 ;@kids-post POST1817^SAMIPAT
"RTN","SAMIPAT",150,0)
POS1817 ; kids post-install for sami 18.17
"RTN","SAMIPAT",151,0)
 ;
"RTN","SAMIPAT",152,0)
 do STANDARD
"RTN","SAMIPAT",153,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-17-t4")
"RTN","SAMIPAT",154,0)
 ;
"RTN","SAMIPAT",155,0)
 quit  ; end of kids-post POS1817^SAMIPAT
"RTN","SAMIPAT",156,0)
 ;
"RTN","SAMIPAT",157,0)
 ;
"RTN","SAMIPAT",158,0)
 ;@section X subroutines for future versions...
"RTN","SAMIPAT",159,0)
 ;
"RTN","SAMIPAT",160,0)
 ;
"RTN","SAMIPAT",161,0)
 ;
"RTN","SAMIPAT",162,0)
EOR ; end of routine SAMIPAT
"VER")
8.0^22.2
**END**
**END**
