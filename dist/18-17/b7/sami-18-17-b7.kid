KIDS Distribution saved on Aug 29, 2024@21:11:33
Released SAMI*18.0*17 seq #17
**KIDS**:SAMI*18.0*17^

**INSTALL NAME**
SAMI*18.0*17
"BLD",11518,0)
SAMI*18.0*17^SAMI^0^3240829^n
"BLD",11518,4,0)
^9.64PA^^
"BLD",11518,6.3)
8
"BLD",11518,"ABPKG")
n
"BLD",11518,"INID")
^n
"BLD",11518,"INIT")
POS1817^SAMIPAT
"BLD",11518,"KRN",0)
^9.67PA^1.5^25
"BLD",11518,"KRN",.4,0)
.4
"BLD",11518,"KRN",.401,0)
.401
"BLD",11518,"KRN",.402,0)
.402
"BLD",11518,"KRN",.403,0)
.403
"BLD",11518,"KRN",.5,0)
.5
"BLD",11518,"KRN",.84,0)
.84
"BLD",11518,"KRN",1.5,0)
1.5
"BLD",11518,"KRN",1.6,0)
1.6
"BLD",11518,"KRN",1.61,0)
1.61
"BLD",11518,"KRN",1.62,0)
1.62
"BLD",11518,"KRN",3.6,0)
3.6
"BLD",11518,"KRN",3.8,0)
3.8
"BLD",11518,"KRN",9.2,0)
9.2
"BLD",11518,"KRN",9.8,0)
9.8
"BLD",11518,"KRN",9.8,"NM",0)
^9.68A^16^14
"BLD",11518,"KRN",9.8,"NM",3,0)
SAMIPAT^^0^B17344032
"BLD",11518,"KRN",9.8,"NM",4,0)
SAMIUR^^0^B1025197513
"BLD",11518,"KRN",9.8,"NM",5,0)
SAMIUR2^^0^B1536139436
"BLD",11518,"KRN",9.8,"NM",6,0)
SAMIURUL^^0^B116379
"BLD",11518,"KRN",9.8,"NM",7,0)
SAMICAS3^^0^B334055891
"BLD",11518,"KRN",9.8,"NM",8,0)
SAMICAS4^^0^B106029587
"BLD",11518,"KRN",9.8,"NM",9,0)
SAMICSV^^0^B104029869
"BLD",11518,"KRN",9.8,"NM",10,0)
SAMICUL^^0^B145904
"BLD",11518,"KRN",9.8,"NM",11,0)
SAMIDCM1^^0^B200371935
"BLD",11518,"KRN",9.8,"NM",12,0)
SAMIFLD^^0^B288543997
"BLD",11518,"KRN",9.8,"NM",13,0)
SAMIFUL^^0^B129814
"BLD",11518,"KRN",9.8,"NM",14,0)
SAMIHOM4^^0^B1262443514
"BLD",11518,"KRN",9.8,"NM",15,0)
SAMIHUL^^0^B131888
"BLD",11518,"KRN",9.8,"NM",16,0)
SAMISITE^^0^B212460993
"BLD",11518,"KRN",9.8,"NM","B","SAMICAS3",7)

"BLD",11518,"KRN",9.8,"NM","B","SAMICAS4",8)

"BLD",11518,"KRN",9.8,"NM","B","SAMICSV",9)

"BLD",11518,"KRN",9.8,"NM","B","SAMICUL",10)

"BLD",11518,"KRN",9.8,"NM","B","SAMIDCM1",11)

"BLD",11518,"KRN",9.8,"NM","B","SAMIFLD",12)

"BLD",11518,"KRN",9.8,"NM","B","SAMIFUL",13)

"BLD",11518,"KRN",9.8,"NM","B","SAMIHOM4",14)

"BLD",11518,"KRN",9.8,"NM","B","SAMIHUL",15)

"BLD",11518,"KRN",9.8,"NM","B","SAMIPAT",3)

"BLD",11518,"KRN",9.8,"NM","B","SAMISITE",16)

"BLD",11518,"KRN",9.8,"NM","B","SAMIUR",4)

"BLD",11518,"KRN",9.8,"NM","B","SAMIUR2",5)

"BLD",11518,"KRN",9.8,"NM","B","SAMIURUL",6)

"BLD",11518,"KRN",19,0)
19
"BLD",11518,"KRN",19.1,0)
19.1
"BLD",11518,"KRN",101,0)
101
"BLD",11518,"KRN",409.61,0)
409.61
"BLD",11518,"KRN",771,0)
771
"BLD",11518,"KRN",779.2,0)
779.2
"BLD",11518,"KRN",870,0)
870
"BLD",11518,"KRN",8989.51,0)
8989.51
"BLD",11518,"KRN",8989.52,0)
8989.52
"BLD",11518,"KRN",8993,0)
8993
"BLD",11518,"KRN",8994,0)
8994
"BLD",11518,"KRN","B",.4,.4)

"BLD",11518,"KRN","B",.401,.401)

"BLD",11518,"KRN","B",.402,.402)

"BLD",11518,"KRN","B",.403,.403)

"BLD",11518,"KRN","B",.5,.5)

"BLD",11518,"KRN","B",.84,.84)

"BLD",11518,"KRN","B",1.5,1.5)

"BLD",11518,"KRN","B",1.6,1.6)

"BLD",11518,"KRN","B",1.61,1.61)

"BLD",11518,"KRN","B",1.62,1.62)

"BLD",11518,"KRN","B",3.6,3.6)

"BLD",11518,"KRN","B",3.8,3.8)

"BLD",11518,"KRN","B",9.2,9.2)

"BLD",11518,"KRN","B",9.8,9.8)

"BLD",11518,"KRN","B",19,19)

"BLD",11518,"KRN","B",19.1,19.1)

"BLD",11518,"KRN","B",101,101)

"BLD",11518,"KRN","B",409.61,409.61)

"BLD",11518,"KRN","B",771,771)

"BLD",11518,"KRN","B",779.2,779.2)

"BLD",11518,"KRN","B",870,870)

"BLD",11518,"KRN","B",8989.51,8989.51)

"BLD",11518,"KRN","B",8989.52,8989.52)

"BLD",11518,"KRN","B",8993,8993)

"BLD",11518,"KRN","B",8994,8994)

"BLD",11518,"QUES",0)
^9.62^^
"BLD",11518,"REQB",0)
^9.611^^0
"INIT")
POS1817^SAMIPAT
"MBREQ")
0
"PKG",230,-1)
1^1
"PKG",230,0)
SAMI^SAMI^SCREENING APPLICATIONS MANAGEMENT - IELCAP
"PKG",230,22,0)
^9.49I^1^1
"PKG",230,22,1,0)
18.0^3191203
"PKG",230,22,1,"PAH",1,0)
17^3240829
"PKG",230,22,1,"PAH",1,1,0)
^^1^1^3230103
"PKG",230,22,1,"PAH",1,1,1,0)
SAMI*18.0*17 T1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","SAMICAS3")
0^7^B334055891
"RTN","SAMICAS3",1,0)
SAMICAS3 ;ven/gpl - case review cont; 2024-08-22t21:02z
"RTN","SAMICAS3",2,0)
 ;;18.0;SAMI;**3,9,11,12,15,17**;2020-01-17;Build 8
"RTN","SAMICAS3",3,0)
 ;mdc-e1;SAMICAS3-20240822-E02krUP;SAMI-18-17-b6
"RTN","SAMICAS3",4,0)
 ;mdc-v7;B334055891;SAMI*18.0*17 SEQ #17
"RTN","SAMICAS3",5,0)
 ;
"RTN","SAMICAS3",6,0)
 ; SAMICAS3 contains ppses and other subroutines to support processing
"RTN","SAMICAS3",7,0)
 ; of the ScreeningPlus case review page.
"RTN","SAMICAS3",8,0)
 ;
"RTN","SAMICAS3",9,0)
 quit  ; no entry from top
"RTN","SAMICAS3",10,0)
 ;
"RTN","SAMICAS3",11,0)
 ;
"RTN","SAMICAS3",12,0)
 ;
"RTN","SAMICAS3",13,0)
 ;@section 0 primary development: see routine %wful
"RTN","SAMICAS3",14,0)
 ;
"RTN","SAMICAS3",15,0)
 ;
"RTN","SAMICAS3",16,0)
 ;
"RTN","SAMICAS3",17,0)
 ;@license see routine SAMIUL
"RTN","SAMICAS3",18,0)
 ;@documentation see SAMICUL
"RTN","SAMICAS3",19,0)
 ;
"RTN","SAMICAS3",20,0)
 ;@contents
"RTN","SAMICAS3",21,0)
 ;
"RTN","SAMICAS3",22,0)
 ;  1. New Form web-route service:
"RTN","SAMICAS3",23,0)
 ; WSNFPOST wrs-code WSNFPOST^SAMICAS3,
"RTN","SAMICAS3",24,0)
 ;  post screeningplus addform: new form
"RTN","SAMICAS3",25,0)
 ;
"RTN","SAMICAS3",26,0)
 ;  2. main form-creation procedures:
"RTN","SAMICAS3",27,0)
 ; MKSBFORM create background form
"RTN","SAMICAS3",28,0)
 ; MKBXFORM create biopsy form
"RTN","SAMICAS3",29,0)
 ; MKCEFORM create ct evaluation form
"RTN","SAMICAS3",30,0)
 ; MKFUFORM create follow-up form
"RTN","SAMICAS3",31,0)
 ; MKITFORM create intervention form
"RTN","SAMICAS3",32,0)
 ; MKPTFORM create pet evaluation form
"RTN","SAMICAS3",33,0)
 ;
"RTN","SAMICAS3",34,0)
 ;  3. supplementary subroutine:
"RTN","SAMICAS3",35,0)
 ; $$LASTCMP date & key of last comparison scan
"RTN","SAMICAS3",36,0)
 ;
"RTN","SAMICAS3",37,0)
 ;  4. unused supplementary subroutine:
"RTN","SAMICAS3",38,0)
 ; CASETBL generates case review table
"RTN","SAMICAS3",39,0)
 ;
"RTN","SAMICAS3",40,0)
 ;
"RTN","SAMICAS3",41,0)
 ;
"RTN","SAMICAS3",42,0)
 ;
"RTN","SAMICAS3",43,0)
 ;@section 1 New Form web-route service WSNFPOST^SAMICAS3
"RTN","SAMICAS3",44,0)
 ;
"RTN","SAMICAS3",45,0)
 ;
"RTN","SAMICAS3",46,0)
 ;
"RTN","SAMICAS3",47,0)
 ;
"RTN","SAMICAS3",48,0)
 ;@wrs-code WSNFPOST^SAMICAS3
"RTN","SAMICAS3",49,0)
 ;
"RTN","SAMICAS3",50,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",51,0)
 ;
"RTN","SAMICAS3",52,0)
 ;ven/gpl;wrs;procedure;clean;silent;sac;??% tests;port?
"RTN","SAMICAS3",53,0)
 ;@signature
"RTN","SAMICAS3",54,0)
 ; do WSNFPOST^SAMICASE(ARGS,BODY,RESULT)
"RTN","SAMICAS3",55,0)
 ;@branches-from
"RTN","SAMICAS3",56,0)
 ; WSNFPOST^SAMICASE
"RTN","SAMICAS3",57,0)
 ;@pps-called-by
"RTN","SAMICAS3",58,0)
 ; WSVAPALS^SAMIHOME [wr addform of ws post vapals]
"RTN","SAMICAS3",59,0)
 ;@called-by none
"RTN","SAMICAS3",60,0)
 ;@calls
"RTN","SAMICAS3",61,0)
 ; parseBody^%wf
"RTN","SAMICAS3",62,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMICAS3",63,0)
 ; $$KEYDATE^SAMIHOM3
"RTN","SAMICAS3",64,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",65,0)
 ; $$KEY2FM^SAMICAS2
"RTN","SAMICAS3",66,0)
 ; $$FMADD^XLFDT
"RTN","SAMICAS3",67,0)
 ; WSCASE^SAMICASE
"RTN","SAMICAS3",68,0)
 ; MKSBFORM^SAMICAS3
"RTN","SAMICAS3",69,0)
 ; MKBXFORM^SAMICAS3
"RTN","SAMICAS3",70,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS3",71,0)
 ; MKFUFORM^SAMICAS3
"RTN","SAMICAS3",72,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS3",73,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS3",74,0)
 ; wsGetForm^%wf
"RTN","SAMICAS3",75,0)
 ;@input
"RTN","SAMICAS3",76,0)
 ; .ARGS
"RTN","SAMICAS3",77,0)
 ; .ARGS("form")
"RTN","SAMICAS3",78,0)
 ; .ARGS("studyid")
"RTN","SAMICAS3",79,0)
 ; .ARGS("sid")
"RTN","SAMICAS3",80,0)
 ; .BODY
"RTN","SAMICAS3",81,0)
 ; .BODY(1) (e.g. "samiroute=casereview&dfn="_dfn_"&studyid="_studyid)
"RTN","SAMICAS3",82,0)
 ;@output
"RTN","SAMICAS3",83,0)
 ; @RESULT
"RTN","SAMICAS3",84,0)
 ;@tests
"RTN","SAMICAS3",85,0)
 ; UTNFPST^SAMIUTS2
"RTN","SAMICAS3",86,0)
 ;
"RTN","SAMICAS3",87,0)
 ;
"RTN","SAMICAS3",88,0)
WSNFPOST ; post screeningplus addform: new form
"RTN","SAMICAS3",89,0)
 ;
"RTN","SAMICAS3",90,0)
 ;@stanza 2 get new form
"RTN","SAMICAS3",91,0)
 ;
"RTN","SAMICAS3",92,0)
 new vars,bdy
"RTN","SAMICAS3",93,0)
 set bdy=$get(BODY(1))
"RTN","SAMICAS3",94,0)
 do parseBody^%wf("vars",.bdy)
"RTN","SAMICAS3",95,0)
 merge vars=ARGS
"RTN","SAMICAS3",96,0)
 merge ^SAMIUL("nuform","vars")=vars
"RTN","SAMICAS3",97,0)
 ;
"RTN","SAMICAS3",98,0)
 new sid set sid=$get(vars("studyid"))
"RTN","SAMICAS3",99,0)
 if sid="" set sid=$get(ARGS("sid"))
"RTN","SAMICAS3",100,0)
 if sid="" do  quit  ;
"RTN","SAMICAS3",101,0)
 . do GETHOME^SAMIHOM3(.RESULT,.ARGS) ; on error return to home page
"RTN","SAMICAS3",102,0)
 . quit
"RTN","SAMICAS3",103,0)
 ;
"RTN","SAMICAS3",104,0)
 set nuform=$get(vars("form"))
"RTN","SAMICAS3",105,0)
 if nuform="" set nuform="ceform"
"RTN","SAMICAS3",106,0)
 ;
"RTN","SAMICAS3",107,0)
 new datekey set datekey=$$KEYDATE^SAMIHOM3($$NOW^XLFDT)
"RTN","SAMICAS3",108,0)
 ;
"RTN","SAMICAS3",109,0)
 ; check to see if form already exists
"RTN","SAMICAS3",110,0)
 ;
"RTN","SAMICAS3",111,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",112,0)
 new collide set collide=0 ; duplicate form for today - backdate forms scenario
"RTN","SAMICAS3",113,0)
 if $data(@root@("graph",sid,nuform_"-"_datekey)) do  ; already exists
"RTN","SAMICAS3",114,0)
 . set collide=1
"RTN","SAMICAS3",115,0)
 . if nuform="siform" quit
"RTN","SAMICAS3",116,0)
 . if nuform="sbform" quit  ; do not create multiple background forms
"RTN","SAMICAS3",117,0)
 . new lastone
"RTN","SAMICAS3",118,0)
 . set lastone=$order(@root@("graph",sid,nuform_"-a  "),-1)
"RTN","SAMICAS3",119,0)
 . quit:lastone=""
"RTN","SAMICAS3",120,0)
 . set newfm=$$KEY2FM^SAMICASE(lastone)
"RTN","SAMICAS3",121,0)
 . set datekey=$$KEYDATE^SAMIHOM3($$FMADD^XLFDT(newfm,1)) ; add one day to the last form
"RTN","SAMICAS3",122,0)
 . quit
"RTN","SAMICAS3",123,0)
 ;
"RTN","SAMICAS3",124,0)
 ; code to not allow two same forms for a patient a day
"RTN","SAMICAS3",125,0)
 ;
"RTN","SAMICAS3",126,0)
 if collide=1 do  quit  ;
"RTN","SAMICAS3",127,0)
 . set ARGS("errorMessage")="Form already exists for today"
"RTN","SAMICAS3",128,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",129,0)
 . do WSCASE^SAMICASE(.RESULT,.ARGS)
"RTN","SAMICAS3",130,0)
 . quit
"RTN","SAMICAS3",131,0)
 ;
"RTN","SAMICAS3",132,0)
 if nuform="sbform" do  ; make background form
"RTN","SAMICAS3",133,0)
 . new oldkey set oldkey=$order(@root@("graph",sid,"sbform"))
"RTN","SAMICAS3",134,0)
 . if $extract(oldkey,1,6)="sbform" do  quit  ;
"RTN","SAMICAS3",135,0)
 . . set ARGS("key")=oldkey
"RTN","SAMICAS3",136,0)
 . . set ARGS("studyid")=sid
"RTN","SAMICAS3",137,0)
 . . set ARGS("form")="vapals:sbform"
"RTN","SAMICAS3",138,0)
 . . quit
"RTN","SAMICAS3",139,0)
 . new key set key="sbform-"_datekey
"RTN","SAMICAS3",140,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",141,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",142,0)
 . set ARGS("form")="vapals:sbform"
"RTN","SAMICAS3",143,0)
 . do MKSBFORM^SAMICAS3(sid,key)
"RTN","SAMICAS3",144,0)
 . quit
"RTN","SAMICAS3",145,0)
 ;
"RTN","SAMICAS3",146,0)
 if nuform="bxform" do  ; make biopsy form
"RTN","SAMICAS3",147,0)
 . new key set key="bxform-"_datekey
"RTN","SAMICAS3",148,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",149,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",150,0)
 . set ARGS("form")="vapals:bxform"
"RTN","SAMICAS3",151,0)
 . do MKBXFORM^SAMICAS3(sid,key)
"RTN","SAMICAS3",152,0)
 . quit
"RTN","SAMICAS3",153,0)
 ;
"RTN","SAMICAS3",154,0)
 if nuform="ceform" do  ; make ct eval form
"RTN","SAMICAS3",155,0)
 . new key set key="ceform-"_datekey
"RTN","SAMICAS3",156,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",157,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",158,0)
 . set ARGS("form")="vapals:ceform"
"RTN","SAMICAS3",159,0)
 . do MKCEFORM^SAMICAS3(sid,key)
"RTN","SAMICAS3",160,0)
 . quit
"RTN","SAMICAS3",161,0)
 ;
"RTN","SAMICAS3",162,0)
 if nuform="fuform" do  ; make followup form
"RTN","SAMICAS3",163,0)
 . new key set key="fuform-"_datekey
"RTN","SAMICAS3",164,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",165,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",166,0)
 . set ARGS("form")="vapals:fuform"
"RTN","SAMICAS3",167,0)
 . do MKFUFORM^SAMICAS3(sid,key)
"RTN","SAMICAS3",168,0)
 . quit
"RTN","SAMICAS3",169,0)
 ;
"RTN","SAMICAS3",170,0)
 if nuform="itform" do  ; make intervention form
"RTN","SAMICAS3",171,0)
 . new key set key="itform-"_datekey
"RTN","SAMICAS3",172,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",173,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",174,0)
 . set ARGS("form")="vapals:itform"
"RTN","SAMICAS3",175,0)
 . do MKITFORM^SAMICAS3(sid,key)
"RTN","SAMICAS3",176,0)
 . quit
"RTN","SAMICAS3",177,0)
 ;
"RTN","SAMICAS3",178,0)
 if nuform="ptform" do  ; make pet eval form
"RTN","SAMICAS3",179,0)
 . new key set key="ptform-"_datekey
"RTN","SAMICAS3",180,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",181,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",182,0)
 . set ARGS("form")="vapals:ptform"
"RTN","SAMICAS3",183,0)
 . do MKPTFORM^SAMICAS3(sid,key)
"RTN","SAMICAS3",184,0)
 . quit
"RTN","SAMICAS3",185,0)
 ;
"RTN","SAMICAS3",186,0)
 do wsGetForm^%wf(.RESULT,.ARGS)
"RTN","SAMICAS3",187,0)
 ;
"RTN","SAMICAS3",188,0)
 ;
"RTN","SAMICAS3",189,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",190,0)
 ;
"RTN","SAMICAS3",191,0)
 quit  ; end of wrs WSNFPOST^SAMICASE
"RTN","SAMICAS3",192,0)
 ;
"RTN","SAMICAS3",193,0)
 ;
"RTN","SAMICAS3",194,0)
 ;
"RTN","SAMICAS3",195,0)
 ;
"RTN","SAMICAS3",196,0)
 ;@section 2 main form-creation procedures
"RTN","SAMICAS3",197,0)
 ;
"RTN","SAMICAS3",198,0)
 ;
"RTN","SAMICAS3",199,0)
 ;
"RTN","SAMICAS3",200,0)
 ;
"RTN","SAMICAS3",201,0)
 ;@proc-code MKSBFORM background
"RTN","SAMICAS3",202,0)
 ;
"RTN","SAMICAS3",203,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",204,0)
 ;
"RTN","SAMICAS3",205,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMICAS3",206,0)
 ;@called-by
"RTN","SAMICAS3",207,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",208,0)
 ;@calls
"RTN","SAMICAS3",209,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",210,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",211,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",212,0)
 ;@input
"RTN","SAMICAS3",213,0)
 ; sid = study id
"RTN","SAMICAS3",214,0)
 ; key = form key, e.g. sbform-2021-05-25
"RTN","SAMICAS3",215,0)
 ;@output
"RTN","SAMICAS3",216,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",217,0)
 ;@examples [tbd]
"RTN","SAMICAS3",218,0)
 ;@tests
"RTN","SAMICAS3",219,0)
 ; UTMKSBF^SAMIUTS2
"RTN","SAMICAS3",220,0)
 ;
"RTN","SAMICAS3",221,0)
 ;
"RTN","SAMICAS3",222,0)
MKSBFORM(sid,key) ; create background form
"RTN","SAMICAS3",223,0)
 ;
"RTN","SAMICAS3",224,0)
 ;@stanza 2 make it
"RTN","SAMICAS3",225,0)
 ;
"RTN","SAMICAS3",226,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",227,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",228,0)
 quit:+sien=0
"RTN","SAMICAS3",229,0)
 ;
"RTN","SAMICAS3",230,0)
 new cdate set cdate=$piece(key,"sbform-",2)
"RTN","SAMICAS3",231,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",232,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",233,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",234,0)
 ;
"RTN","SAMICAS3",235,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",236,0)
 ;
"RTN","SAMICAS3",237,0)
 quit  ; end of MKSBFORM
"RTN","SAMICAS3",238,0)
 ;
"RTN","SAMICAS3",239,0)
 ;
"RTN","SAMICAS3",240,0)
 ;
"RTN","SAMICAS3",241,0)
 ;
"RTN","SAMICAS3",242,0)
 ;@proc-code MKBXFORM biopsy
"RTN","SAMICAS3",243,0)
 ;
"RTN","SAMICAS3",244,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",245,0)
 ;
"RTN","SAMICAS3",246,0)
 ;ven/gpl;private;procedure;clean;silent;sac;??% tests;port?
"RTN","SAMICAS3",247,0)
 ;@called-by
"RTN","SAMICAS3",248,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",249,0)
 ;@calls
"RTN","SAMICAS3",250,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",251,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",252,0)
 ; $$PREVNOD^SAMICAS4 [commented out]
"RTN","SAMICAS3",253,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",254,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",255,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",256,0)
 ;@input
"RTN","SAMICAS3",257,0)
 ; sid = study id
"RTN","SAMICAS3",258,0)
 ; key = form key, e.g. bxform-2021-05-25
"RTN","SAMICAS3",259,0)
 ;@output
"RTN","SAMICAS3",260,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",261,0)
 ;@examples [tbd]
"RTN","SAMICAS3",262,0)
 ;@tests
"RTN","SAMICAS3",263,0)
 ; UTMKBXF^SAMIUTS2
"RTN","SAMICAS3",264,0)
 ;
"RTN","SAMICAS3",265,0)
 ;
"RTN","SAMICAS3",266,0)
MKBXFORM(sid,key) ; create biopsy form
"RTN","SAMICAS3",267,0)
 ;
"RTN","SAMICAS3",268,0)
 ;@stanza 2 make it
"RTN","SAMICAS3",269,0)
 ;
"RTN","SAMICAS3",270,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",271,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",272,0)
 quit:+sien=0
"RTN","SAMICAS3",273,0)
 new cdate set cdate=$piece(key,"bxform-",2)
"RTN","SAMICAS3",274,0)
 ;
"RTN","SAMICAS3",275,0)
 ; nodule copy
"RTN","SAMICAS3",276,0)
 ; new srckey set srckey=$$PREVNOD^SAMICAS4(sid)
"RTN","SAMICAS3",277,0)
 new srckey,srcdate set srcdate=$$LASTCMP^SAMICAS3(sid,.srckey)
"RTN","SAMICAS3",278,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",279,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",280,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",281,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",282,0)
 . quit
"RTN","SAMICAS3",283,0)
 ; end nodule copy
"RTN","SAMICAS3",284,0)
 ;
"RTN","SAMICAS3",285,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",286,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",287,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",288,0)
 ;
"RTN","SAMICAS3",289,0)
 ;
"RTN","SAMICAS3",290,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",291,0)
 ;
"RTN","SAMICAS3",292,0)
 quit  ; end of MKBXFORM
"RTN","SAMICAS3",293,0)
 ;
"RTN","SAMICAS3",294,0)
 ;
"RTN","SAMICAS3",295,0)
 ;
"RTN","SAMICAS3",296,0)
 ;
"RTN","SAMICAS3",297,0)
 ;@proc-code MKCEFORM ct evaluation
"RTN","SAMICAS3",298,0)
 ;
"RTN","SAMICAS3",299,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",300,0)
 ;
"RTN","SAMICAS3",301,0)
 ;ven/gpl;private;procedure;clean;silent;sac;??% tests;port?
"RTN","SAMICAS3",302,0)
 ;@called-by
"RTN","SAMICAS3",303,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",304,0)
 ;@calls
"RTN","SAMICAS3",305,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",306,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",307,0)
 ; $$PREVNOD^SAMICAS4 [commented out]
"RTN","SAMICAS3",308,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",309,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",310,0)
 ; GETITEMS^SAMICASE [commented out]
"RTN","SAMICAS3",311,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",312,0)
 ; $$BASELNDT^SAMICAS4
"RTN","SAMICAS3",313,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",314,0)
 ; $$PRIORCMP^SAMICAS4
"RTN","SAMICAS3",315,0)
 ; $$CLINSUM^SAMICAS4
"RTN","SAMICAS3",316,0)
 ;@input
"RTN","SAMICAS3",317,0)
 ; sid = study id
"RTN","SAMICAS3",318,0)
 ; key = form key, e.g. ceform-2021-05-25
"RTN","SAMICAS3",319,0)
 ;@output
"RTN","SAMICAS3",320,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",321,0)
 ;@examples [tbd]
"RTN","SAMICAS3",322,0)
 ;@tests
"RTN","SAMICAS3",323,0)
 ; UTMKCEF^SAMIUTS2
"RTN","SAMICAS3",324,0)
 ;
"RTN","SAMICAS3",325,0)
 ;
"RTN","SAMICAS3",326,0)
MKCEFORM(sid,key) ; create ct evaluation form
"RTN","SAMICAS3",327,0)
 ;
"RTN","SAMICAS3",328,0)
 ;@stanza 2 make it
"RTN","SAMICAS3",329,0)
 ;
"RTN","SAMICAS3",330,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",331,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",332,0)
 quit:+sien=0
"RTN","SAMICAS3",333,0)
 new cdate set cdate=$piece(key,"ceform-",2)
"RTN","SAMICAS3",334,0)
 ;
"RTN","SAMICAS3",335,0)
 ; nodule copy
"RTN","SAMICAS3",336,0)
 ; new srckey set srckey=$$PREVNOD^SAMICAS4(sid)
"RTN","SAMICAS3",337,0)
 new srckey,srcdate set srcdate=$$LASTCMP^SAMICAS3(sid,.srckey)
"RTN","SAMICAS3",338,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",339,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",340,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",341,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",342,0)
 . quit
"RTN","SAMICAS3",343,0)
 ; end nodule copy
"RTN","SAMICAS3",344,0)
 ;
"RTN","SAMICAS3",345,0)
 ; new items,prevct
"RTN","SAMICAS3",346,0)
 ; do GETITEMS^SAMICASE("items",sid)
"RTN","SAMICAS3",347,0)
 ; set prevct=""
"RTN","SAMICAS3",348,0)
 ; if $data(items("type","vapals:ceform")) do  ; previous cteval exists
"RTN","SAMICAS3",349,0)
 ; . set prevct=$order(items("type","vapals:ceform",""),-1) ; latest ceform
"RTN","SAMICAS3",350,0)
 ; . quit
"RTN","SAMICAS3",351,0)
 ; if prevct'="" do  ;
"RTN","SAMICAS3",352,0)
 ; . new target,source
"RTN","SAMICAS3",353,0)
 ; . set source=$name(@root@("graph",sid,prevct))
"RTN","SAMICAS3",354,0)
 ; . set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",355,0)
 ; . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",356,0)
 ; . quit
"RTN","SAMICAS3",357,0)
 ;
"RTN","SAMICAS3",358,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",359,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",360,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",361,0)
 ;
"RTN","SAMICAS3",362,0)
 ; set baseline CT date and last comparison scan date
"RTN","SAMICAS3",363,0)
 do  ;
"RTN","SAMICAS3",364,0)
 . new basedt
"RTN","SAMICAS3",365,0)
 . set basedt=$$BASELNDT^SAMICAS4(sid)
"RTN","SAMICAS3",366,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",367,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",368,0)
 . if lastdt=-1 set lastdt=""
"RTN","SAMICAS3",369,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS4(sid)
"RTN","SAMICAS3",370,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",371,0)
 . if priordt="" set priordt=lastdt
"RTN","SAMICAS3",372,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",373,0)
 . set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",374,0)
 . set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",375,0)
 . ;
"RTN","SAMICAS3",376,0)
 . ; set clinical information line for billing
"RTN","SAMICAS3",377,0)
 . set @root@("graph",sid,key,"ceclin")=$$CLINSUM^SAMICAS4(sid)
"RTN","SAMICAS3",378,0)
 . quit
"RTN","SAMICAS3",379,0)
 ;
"RTN","SAMICAS3",380,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",381,0)
 ;
"RTN","SAMICAS3",382,0)
 quit  ; end of MKCEFORM
"RTN","SAMICAS3",383,0)
 ;
"RTN","SAMICAS3",384,0)
 ;
"RTN","SAMICAS3",385,0)
 ;
"RTN","SAMICAS3",386,0)
 ;
"RTN","SAMICAS3",387,0)
 ;@proc-code MKFUFORM followup
"RTN","SAMICAS3",388,0)
 ;
"RTN","SAMICAS3",389,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",390,0)
 ;
"RTN","SAMICAS3",391,0)
 ;ven/gpl;private;procedure;clean;silent;sac;??% tests;port?
"RTN","SAMICAS3",392,0)
 ;@called-by
"RTN","SAMICAS3",393,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",394,0)
 ;@calls
"RTN","SAMICAS3",395,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",396,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",397,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMICAS3",398,0)
 ; $$BASELNDT^SAMICAS4
"RTN","SAMICAS3",399,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",400,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS3",401,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",402,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",403,0)
 ;@input
"RTN","SAMICAS3",404,0)
 ; sid = study id
"RTN","SAMICAS3",405,0)
 ; key = form key, e.g. fuform-2021-05-25
"RTN","SAMICAS3",406,0)
 ;@output
"RTN","SAMICAS3",407,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",408,0)
 ;@examples [tbd]
"RTN","SAMICAS3",409,0)
 ;@tests
"RTN","SAMICAS3",410,0)
 ; UTMKFUF^SAMIUTS2
"RTN","SAMICAS3",411,0)
 ;
"RTN","SAMICAS3",412,0)
 ;
"RTN","SAMICAS3",413,0)
MKFUFORM(sid,key) ; create followup form
"RTN","SAMICAS3",414,0)
 ;
"RTN","SAMICAS3",415,0)
 ;@stanza 2 make it
"RTN","SAMICAS3",416,0)
 ;
"RTN","SAMICAS3",417,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",418,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",419,0)
 quit:+sien=0
"RTN","SAMICAS3",420,0)
 ;
"RTN","SAMICAS3",421,0)
 new cdate set cdate=$piece(key,"fuform-",2)
"RTN","SAMICAS3",422,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",423,0)
 ;
"RTN","SAMICAS3",424,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",425,0)
 set @root@("graph",sid,key,"sidof")=$$KEY2DSPD^SAMICAS2(cdate)
"RTN","SAMICAS3",426,0)
 new basedt
"RTN","SAMICAS3",427,0)
 set basedt=$$BASELNDT^SAMICAS4(sid)
"RTN","SAMICAS3",428,0)
 if basedt=-1 set basedt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",429,0)
 if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",430,0)
 set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",431,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",432,0)
 ;
"RTN","SAMICAS3",433,0)
 ;
"RTN","SAMICAS3",434,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",435,0)
 ;
"RTN","SAMICAS3",436,0)
 quit  ; end of MKFUFORM
"RTN","SAMICAS3",437,0)
 ;
"RTN","SAMICAS3",438,0)
 ;
"RTN","SAMICAS3",439,0)
 ;
"RTN","SAMICAS3",440,0)
 ;
"RTN","SAMICAS3",441,0)
 ;@proc-code MKITFORM intervention
"RTN","SAMICAS3",442,0)
 ;
"RTN","SAMICAS3",443,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",444,0)
 ;
"RTN","SAMICAS3",445,0)
 ;ven/gpl;private;procedure;clean;silent;sac;??% tests;port?
"RTN","SAMICAS3",446,0)
 ;@called-by
"RTN","SAMICAS3",447,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",448,0)
 ;@calls
"RTN","SAMICAS3",449,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",450,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",451,0)
 ; $$PREVNODE^SAMICAS4 [commented out]
"RTN","SAMICAS3",452,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",453,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",454,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",455,0)
 ; $$BASELNDT^SAMICAS4
"RTN","SAMICAS3",456,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",457,0)
 ; $$PRIORCMP^SAMICAS4
"RTN","SAMICAS3",458,0)
 ;@input
"RTN","SAMICAS3",459,0)
 ; sid = study id
"RTN","SAMICAS3",460,0)
 ; key = form key, e.g. itform-2021-05-25
"RTN","SAMICAS3",461,0)
 ;@output
"RTN","SAMICAS3",462,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",463,0)
 ;@examples [tbd]
"RTN","SAMICAS3",464,0)
 ;@tests
"RTN","SAMICAS3",465,0)
 ; UTMKITF^SAMIUTS2
"RTN","SAMICAS3",466,0)
 ;
"RTN","SAMICAS3",467,0)
 ;
"RTN","SAMICAS3",468,0)
MKITFORM(sid,key) ; create intervention form
"RTN","SAMICAS3",469,0)
 ;
"RTN","SAMICAS3",470,0)
 ;@stanza 2 make it
"RTN","SAMICAS3",471,0)
 ;
"RTN","SAMICAS3",472,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",473,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",474,0)
 quit:+sien=0
"RTN","SAMICAS3",475,0)
 ;
"RTN","SAMICAS3",476,0)
 new cdate set cdate=$piece(key,"itform-",2)
"RTN","SAMICAS3",477,0)
 ;
"RTN","SAMICAS3",478,0)
 ; nodule copy
"RTN","SAMICAS3",479,0)
 ; new srckey set srckey=$$PREVNOD^SAMICAS4(sid)
"RTN","SAMICAS3",480,0)
 new srckey,srcdate set srcdate=$$LASTCMP^SAMICAS3(sid,.srckey)
"RTN","SAMICAS3",481,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",482,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",483,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",484,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",485,0)
 . quit
"RTN","SAMICAS3",486,0)
 ; end nodule copy
"RTN","SAMICAS3",487,0)
 ;
"RTN","SAMICAS3",488,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",489,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",490,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",491,0)
 ;
"RTN","SAMICAS3",492,0)
 do  ;
"RTN","SAMICAS3",493,0)
 . new basedt
"RTN","SAMICAS3",494,0)
 . set basedt=$$BASELNDT^SAMICAS4(sid)
"RTN","SAMICAS3",495,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",496,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",497,0)
 . if lastdt=-1 set lastdt=basedt
"RTN","SAMICAS3",498,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS4(sid)
"RTN","SAMICAS3",499,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",500,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",501,0)
 . ; set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",502,0)
 . set @root@("graph",sid,key,"cedos")=lastdt ; it's different than on the ce
"RTN","SAMICAS3",503,0)
 . ; set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",504,0)
 . quit
"RTN","SAMICAS3",505,0)
 ;
"RTN","SAMICAS3",506,0)
 ;
"RTN","SAMICAS3",507,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",508,0)
 ;
"RTN","SAMICAS3",509,0)
 quit  ; end of MKITFORM
"RTN","SAMICAS3",510,0)
 ;
"RTN","SAMICAS3",511,0)
 ;
"RTN","SAMICAS3",512,0)
 ;
"RTN","SAMICAS3",513,0)
 ;
"RTN","SAMICAS3",514,0)
 ;@proc-code MKPTFORM pet evaluation
"RTN","SAMICAS3",515,0)
 ;
"RTN","SAMICAS3",516,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",517,0)
 ;
"RTN","SAMICAS3",518,0)
 ;ven/gpl;private;procedure;clean;silent;sac;??% tests;port?
"RTN","SAMICAS3",519,0)
 ;@called-by
"RTN","SAMICAS3",520,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",521,0)
 ;@calls
"RTN","SAMICAS3",522,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",523,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",524,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",525,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",526,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",527,0)
 ; $$BASELNDT^SAMICAS4
"RTN","SAMICAS3",528,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",529,0)
 ; $$PRIORCMP^SAMICAS4
"RTN","SAMICAS3",530,0)
 ;@input
"RTN","SAMICAS3",531,0)
 ; sid = study id
"RTN","SAMICAS3",532,0)
 ; key = form key, e.g. ptform-2021-05-25
"RTN","SAMICAS3",533,0)
 ;@output
"RTN","SAMICAS3",534,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",535,0)
 ;@examples [tbd]
"RTN","SAMICAS3",536,0)
 ;@tests
"RTN","SAMICAS3",537,0)
 ; UTMKPTF^SAMIUTS2
"RTN","SAMICAS3",538,0)
 ;
"RTN","SAMICAS3",539,0)
 ;
"RTN","SAMICAS3",540,0)
MKPTFORM(sid,key) ; create pet evaluation form
"RTN","SAMICAS3",541,0)
 ;
"RTN","SAMICAS3",542,0)
 ;@stanza 2 make it
"RTN","SAMICAS3",543,0)
 ;
"RTN","SAMICAS3",544,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",545,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",546,0)
 quit:+sien=0
"RTN","SAMICAS3",547,0)
 ;
"RTN","SAMICAS3",548,0)
 ; nodule copy
"RTN","SAMICAS3",549,0)
 ; new srckey set srckey=$$PREVNOD^SAMICAS4(sid)
"RTN","SAMICAS3",550,0)
 new srckey,srcdate set srcdate=$$LASTCMP^SAMICAS3(sid,.srckey)
"RTN","SAMICAS3",551,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",552,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",553,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",554,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",555,0)
 . quit
"RTN","SAMICAS3",556,0)
 ; end nodule copy
"RTN","SAMICAS3",557,0)
 ;
"RTN","SAMICAS3",558,0)
 new cdate set cdate=$piece(key,"ptform-",2)
"RTN","SAMICAS3",559,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",560,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",561,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",562,0)
 ;
"RTN","SAMICAS3",563,0)
 do  ;
"RTN","SAMICAS3",564,0)
 . new basedt
"RTN","SAMICAS3",565,0)
 . set basedt=$$BASELNDT^SAMICAS4(sid)
"RTN","SAMICAS3",566,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",567,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",568,0)
 . if lastdt=-1 set lastdt=basedt
"RTN","SAMICAS3",569,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS4(sid)
"RTN","SAMICAS3",570,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",571,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",572,0)
 . ; set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",573,0)
 . set @root@("graph",sid,key,"cedos")=lastdt ; it's different than on the ce
"RTN","SAMICAS3",574,0)
 . ; set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",575,0)
 . quit
"RTN","SAMICAS3",576,0)
 ;
"RTN","SAMICAS3",577,0)
 ;
"RTN","SAMICAS3",578,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",579,0)
 ;
"RTN","SAMICAS3",580,0)
 quit  ; end of MKPTFORM
"RTN","SAMICAS3",581,0)
 ;
"RTN","SAMICAS3",582,0)
 ;
"RTN","SAMICAS3",583,0)
 ;
"RTN","SAMICAS3",584,0)
 ;
"RTN","SAMICAS3",585,0)
 ;@section 3 supplementary subroutine
"RTN","SAMICAS3",586,0)
 ;
"RTN","SAMICAS3",587,0)
 ;
"RTN","SAMICAS3",588,0)
 ;
"RTN","SAMICAS3",589,0)
 ;
"RTN","SAMICAS3",590,0)
 ;@func-code $$LASTCMP
"RTN","SAMICAS3",591,0)
 ;
"RTN","SAMICAS3",592,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",593,0)
 ;
"RTN","SAMICAS3",594,0)
 ;ven/gpl;private;function;clean;silent;sac;??% tests;port?
"RTN","SAMICAS3",595,0)
 ;@called-by
"RTN","SAMICAS3",596,0)
 ; MKBXFORM^SAMICAS3
"RTN","SAMICAS3",597,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS3",598,0)
 ; MKFUFORM^SAMICAS3
"RTN","SAMICAS3",599,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS3",600,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS3",601,0)
 ; NOTE^SAMINOT2
"RTN","SAMICAS3",602,0)
 ;@calls
"RTN","SAMICAS3",603,0)
 ; SORTFRMS^SAMICAS4
"RTN","SAMICAS3",604,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS3",605,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMICAS3",606,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",607,0)
 ;@input
"RTN","SAMICAS3",608,0)
 ; sid = study id
"RTN","SAMICAS3",609,0)
 ;@output = date of last comparison scan
"RTN","SAMICAS3",610,0)
 ; .retkey = key of last comparison scan
"RTN","SAMICAS3",611,0)
 ;@examples [tbd]
"RTN","SAMICAS3",612,0)
 ;@tests [tbd]
"RTN","SAMICAS3",613,0)
 ;
"RTN","SAMICAS3",614,0)
 ;
"RTN","SAMICAS3",615,0)
LASTCMP(sid,retkey) ; date & key of last comparison scan
"RTN","SAMICAS3",616,0)
 ;
"RTN","SAMICAS3",617,0)
 ;@stanza 2 calculate date & key of last comparison scan
"RTN","SAMICAS3",618,0)
 ;
"RTN","SAMICAS3",619,0)
 set retkey=""
"RTN","SAMICAS3",620,0)
 new fary
"RTN","SAMICAS3",621,0)
 do SORTFRMS^SAMICAS4(.fary,sid)
"RTN","SAMICAS3",622,0)
 ;
"RTN","SAMICAS3",623,0)
 ;new tdt set tdt=$piece($$NOW^XLFDT,".",1)+1 ; start with today
"RTN","SAMICAS3",624,0)
 new tdt set tdt=$piece($$NOW^XLFDT,".",1) ; start with before today
"RTN","SAMICAS3",625,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",626,0)
 . new tmpkey set tmpkey=""
"RTN","SAMICAS3",627,0)
 . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",628,0)
 . . if tmpkey["ceform" set retkey=tmpkey
"RTN","SAMICAS3",629,0)
 . . quit
"RTN","SAMICAS3",630,0)
 . quit
"RTN","SAMICAS3",631,0)
 ;
"RTN","SAMICAS3",632,0)
 new retdt set retdt=-1
"RTN","SAMICAS3",633,0)
 if retkey'="" do  ;
"RTN","SAMICAS3",634,0)
 . new fmdt set fmdt=$$KEY2FM^SAMICASE(retkey)
"RTN","SAMICAS3",635,0)
 . set retdt=$$VAPALSDT^SAMICASE(fmdt)
"RTN","SAMICAS3",636,0)
 . quit
"RTN","SAMICAS3",637,0)
 ;
"RTN","SAMICAS3",638,0)
 ;
"RTN","SAMICAS3",639,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",640,0)
 ;
"RTN","SAMICAS3",641,0)
 quit retdt ; end of $$LASTCMP
"RTN","SAMICAS3",642,0)
 ;
"RTN","SAMICAS3",643,0)
 ;
"RTN","SAMICAS3",644,0)
 ;
"RTN","SAMICAS3",645,0)
 ;
"RTN","SAMICAS3",646,0)
 ;@section 4 unused supplementary subroutine
"RTN","SAMICAS3",647,0)
 ;
"RTN","SAMICAS3",648,0)
 ;
"RTN","SAMICAS3",649,0)
 ;
"RTN","SAMICAS3",650,0)
 ;
"RTN","SAMICAS3",651,0)
 ;@proc-code CASETBL
"RTN","SAMICAS3",652,0)
 ;
"RTN","SAMICAS3",653,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",654,0)
 ;
"RTN","SAMICAS3",655,0)
 ;ven/gpl;private;procedure;clean;silent;sac;??% tests;port
"RTN","SAMICAS3",656,0)
 ;@called by none
"RTN","SAMICAS3",657,0)
 ;@calls none
"RTN","SAMICAS3",658,0)
 ;@input
"RTN","SAMICAS3",659,0)
 ; ary = name of array (passed by name, will be cleared)
"RTN","SAMICAS3",660,0)
 ;@output
"RTN","SAMICAS3",661,0)
 ; @ary: see code below
"RTN","SAMICAS3",662,0)
 ;@tests
"RTN","SAMICAS3",663,0)
 ; UTCSRT^SAMIUTS2
"RTN","SAMICAS3",664,0)
 ;  note: CASETBL can't be moved to routine SAMICAS4 until
"RTN","SAMICAS3",665,0)
 ;  UTCSRT^SAMIUTS2 can be changed at the same time to call it there,
"RTN","SAMICAS3",666,0)
 ;  or call it as a service in SAMICASE.
"RTN","SAMICAS3",667,0)
 ;
"RTN","SAMICAS3",668,0)
 ;
"RTN","SAMICAS3",669,0)
CASETBL(ary) ; generates case review table
"RTN","SAMICAS3",670,0)
 ;
"RTN","SAMICAS3",671,0)
 ;@stanza 2 build table
"RTN","SAMICAS3",672,0)
 ;
"RTN","SAMICAS3",673,0)
 kill @ary
"RTN","SAMICAS3",674,0)
 ;
"RTN","SAMICAS3",675,0)
 set @ary@("siform","form")="siform"
"RTN","SAMICAS3",676,0)
 set @ary@("siform","js")="subPr"
"RTN","SAMICAS3",677,0)
 set @ary@("siform","name")="Intake"
"RTN","SAMICAS3",678,0)
 set @ary@("siform","image")="preview.gif"
"RTN","SAMICAS3",679,0)
 ;
"RTN","SAMICAS3",680,0)
 set @ary@("nuform","form")="nuform"
"RTN","SAMICAS3",681,0)
 set @ary@("nuform","js")="subFr"
"RTN","SAMICAS3",682,0)
 set @ary@("nuform","name")="New Form"
"RTN","SAMICAS3",683,0)
 set @ary@("nuform","image")="nform.gif"
"RTN","SAMICAS3",684,0)
 ;
"RTN","SAMICAS3",685,0)
 set @ary@("sched","form")="sched"
"RTN","SAMICAS3",686,0)
 set @ary@("sched","js")="subSc"
"RTN","SAMICAS3",687,0)
 set @ary@("sched","name")="Schedule"
"RTN","SAMICAS3",688,0)
 set @ary@("sched","image")="schedule.gif"
"RTN","SAMICAS3",689,0)
 ;
"RTN","SAMICAS3",690,0)
 set @ary@("sbform","form")="sbform"
"RTN","SAMICAS3",691,0)
 set @ary@("sbform","js")="subPr"
"RTN","SAMICAS3",692,0)
 set @ary@("sbform","name")="Background"
"RTN","SAMICAS3",693,0)
 set @ary@("sbform","image")="preview.gif"
"RTN","SAMICAS3",694,0)
 ;
"RTN","SAMICAS3",695,0)
 set @ary@("ceform","form")="ceform"
"RTN","SAMICAS3",696,0)
 set @ary@("ceform","js")="subPr"
"RTN","SAMICAS3",697,0)
 set @ary@("ceform","name")="CT Evaluation"
"RTN","SAMICAS3",698,0)
 set @ary@("ceform","image")="preview.gif"
"RTN","SAMICAS3",699,0)
 ;
"RTN","SAMICAS3",700,0)
 set @ary@("report","form")="report"
"RTN","SAMICAS3",701,0)
 set @ary@("report","js")="subRp"
"RTN","SAMICAS3",702,0)
 set @ary@("report","name")="Report"
"RTN","SAMICAS3",703,0)
 set @ary@("report","image")="report.gif"
"RTN","SAMICAS3",704,0)
 ;
"RTN","SAMICAS3",705,0)
 set @ary@("ptform","form")="ptform"
"RTN","SAMICAS3",706,0)
 set @ary@("ptform","js")="subPr"
"RTN","SAMICAS3",707,0)
 set @ary@("ptform","name")="PET Evaluation"
"RTN","SAMICAS3",708,0)
 set @ary@("ptform","image")="preview.gif"
"RTN","SAMICAS3",709,0)
 ;
"RTN","SAMICAS3",710,0)
 set @ary@("bxform","form")="bxform"
"RTN","SAMICAS3",711,0)
 set @ary@("bxform","js")="subPr"
"RTN","SAMICAS3",712,0)
 set @ary@("bxform","name")="Biopsy"
"RTN","SAMICAS3",713,0)
 set @ary@("bxform","image")="preview.gif"
"RTN","SAMICAS3",714,0)
 ;
"RTN","SAMICAS3",715,0)
 set @ary@("rbform","form")="rbform"
"RTN","SAMICAS3",716,0)
 set @ary@("rbform","js")="subPr"
"RTN","SAMICAS3",717,0)
 set @ary@("rbform","name")="Intervention"
"RTN","SAMICAS3",718,0)
 set @ary@("rbform","image")="preview.gif"
"RTN","SAMICAS3",719,0)
 ;
"RTN","SAMICAS3",720,0)
 set @ary@("ceform","form")="ceform"
"RTN","SAMICAS3",721,0)
 set @ary@("ceform","js")="subPr"
"RTN","SAMICAS3",722,0)
 set @ary@("ceform","name")="CT Evaluation"
"RTN","SAMICAS3",723,0)
 set @ary@("ceform","image")="preview.gif"
"RTN","SAMICAS3",724,0)
 ;
"RTN","SAMICAS3",725,0)
 ;
"RTN","SAMICAS3",726,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",727,0)
 ;
"RTN","SAMICAS3",728,0)
 quit  ; end of CASETBL
"RTN","SAMICAS3",729,0)
 ;
"RTN","SAMICAS3",730,0)
 ;
"RTN","SAMICAS3",731,0)
 ;
"RTN","SAMICAS3",732,0)
EOR ; end of routine SAMICAS3
"RTN","SAMICAS4")
0^8^B106029587
"RTN","SAMICAS4",1,0)
SAMICAS4 ;ven/gpl - case review sub library; 2024-08-22t21:03z
"RTN","SAMICAS4",2,0)
 ;;18.0;SAMI;**17**;2020-01-17;Build 8
"RTN","SAMICAS4",3,0)
 ;mdc-e1;SAMICAS4-20240822-E01RgJpy;SAMI-18-17-b6
"RTN","SAMICAS4",4,0)
 ;mdc-v7;B106029587;SAMI*18.0*17 SEQ #17
"RTN","SAMICAS4",5,0)
 ;
"RTN","SAMICAS4",6,0)
 ; SAMICAS4 contains subroutines to support processing of the
"RTN","SAMICAS4",7,0)
 ; ScreeningPlus case review page.
"RTN","SAMICAS4",8,0)
 ;
"RTN","SAMICAS4",9,0)
 quit  ; no entry from top
"RTN","SAMICAS4",10,0)
 ;
"RTN","SAMICAS4",11,0)
 ;
"RTN","SAMICAS4",12,0)
 ;
"RTN","SAMICAS4",13,0)
 ;@license see routine SAMIUL
"RTN","SAMICAS4",14,0)
 ;@documentation see SAMICUL
"RTN","SAMICAS4",15,0)
 ;
"RTN","SAMICAS4",16,0)
 ;@contents
"RTN","SAMICAS4",17,0)
 ;
"RTN","SAMICAS4",18,0)
 ;  1. clinical summary subroutines:
"RTN","SAMICAS4",19,0)
 ; $$CLINSUM one-line clinical summary
"RTN","SAMICAS4",20,0)
 ; $$AGE patient age
"RTN","SAMICAS4",21,0)
 ; $$YRSAGO how many years ago was a date
"RTN","SAMICAS4",22,0)
 ;
"RTN","SAMICAS4",23,0)
 ;  2. other supplementary subroutines:
"RTN","SAMICAS4",24,0)
 ; $$BASELNDT last previous baseline ct date
"RTN","SAMICAS4",25,0)
 ; $$KEY2DT date to put in prior scans field
"RTN","SAMICAS4",26,0)
 ; $$PRIORCMP dates of all scans before last comparison scan
"RTN","SAMICAS4",27,0)
 ; SORTFRMS sorts all forms for patient sid by date
"RTN","SAMICAS4",28,0)
 ;
"RTN","SAMICAS4",29,0)
 ;  3. unused supplementary subroutine:
"RTN","SAMICAS4",30,0)
 ; $$PREVNOD key of latest form including nodule grid
"RTN","SAMICAS4",31,0)
 ;
"RTN","SAMICAS4",32,0)
 ;
"RTN","SAMICAS4",33,0)
 ;
"RTN","SAMICAS4",34,0)
 ;
"RTN","SAMICAS4",35,0)
 ;@section 1 clinical summary subroutines
"RTN","SAMICAS4",36,0)
 ;
"RTN","SAMICAS4",37,0)
 ;
"RTN","SAMICAS4",38,0)
 ;
"RTN","SAMICAS4",39,0)
 ;
"RTN","SAMICAS4",40,0)
 ;@func-code $$CLINSUM^SAMICAS4
"RTN","SAMICAS4",41,0)
 ;
"RTN","SAMICAS4",42,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS4",43,0)
 ;
"RTN","SAMICAS4",44,0)
 ;ven/gpl;private;function;clean;silent;sac?;??% tests;port?
"RTN","SAMICAS4",45,0)
 ;@called-by
"RTN","SAMICAS4",46,0)
 ; MKCEFORM^SAMICAS4
"RTN","SAMICAS4",47,0)
 ;@calls
"RTN","SAMICAS4",48,0)
 ; $$setroot^%wd
"RTN","SAMICAS4",49,0)
 ; $$AGE^SAMICAS4
"RTN","SAMICAS4",50,0)
 ; $$YRSAGO^SAMICAS4
"RTN","SAMICAS4",51,0)
 ;@input
"RTN","SAMICAS4",52,0)
 ; sid
"RTN","SAMICAS4",53,0)
 ;@output = clinical summary
"RTN","SAMICAS4",54,0)
 ;@tests [tbd]
"RTN","SAMICAS4",55,0)
 ;
"RTN","SAMICAS4",56,0)
 ; The clinical information will include the information as follows:
"RTN","SAMICAS4",57,0)
 ;
"RTN","SAMICAS4",58,0)
 ; Age xx; [Asymptomatic for lung cancer]; Current Smoker; xx Pack Years
"RTN","SAMICAS4",59,0)
 ;
"RTN","SAMICAS4",60,0)
 ; Age xx; [Asymptomatic for lung cancer]; Former Smoker; xx Pack Years; Quit xx years ago
"RTN","SAMICAS4",61,0)
 ;
"RTN","SAMICAS4",62,0)
 ; If there is no background form - we should include a place-holder
"RTN","SAMICAS4",63,0)
 ; so the radiologist will know the information needs to be added. If
"RTN","SAMICAS4",64,0)
 ; a followup form exists, the latest one is used instead of the
"RTN","SAMICAS4",65,0)
 ; background.
"RTN","SAMICAS4",66,0)
 ;
"RTN","SAMICAS4",67,0)
 ;
"RTN","SAMICAS4",68,0)
CLINSUM(sid) ; extrinsic returns a one-line clinical summary
"RTN","SAMICAS4",69,0)
 ;
"RTN","SAMICAS4",70,0)
 ;@stanza 2 init main vars
"RTN","SAMICAS4",71,0)
 ;
"RTN","SAMICAS4",72,0)
 ; one-line clinical summary, set default in case we fail
"RTN","SAMICAS4",73,0)
 new clinstr set clinstr="[CHECK BACKGROUND - AGE/SMOKING HISTORY]"
"RTN","SAMICAS4",74,0)
 ;
"RTN","SAMICAS4",75,0)
 n smoker s smoker=""
"RTN","SAMICAS4",76,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS4",77,0)
 n ien s ien=$o(@root@("sid",sid,""))
"RTN","SAMICAS4",78,0)
 q:ien="" clinstr
"RTN","SAMICAS4",79,0)
 n dob s dob=@root@(ien,"dob")
"RTN","SAMICAS4",80,0)
 n age s age=$$AGE^SAMICAS4(dob)
"RTN","SAMICAS4",81,0)
 n fufail s fufail=1 ; default no followup forms found
"RTN","SAMICAS4",82,0)
 n gn s gn=$na(@root@("graph",sid))
"RTN","SAMICAS4",83,0)
 ;
"RTN","SAMICAS4",84,0)
 ;
"RTN","SAMICAS4",85,0)
 ;@stanza 3 look for followup forms
"RTN","SAMICAS4",86,0)
 ;
"RTN","SAMICAS4",87,0)
 ; this is where we will look for followup forms
"RTN","SAMICAS4",88,0)
 ;
"RTN","SAMICAS4",89,0)
 ;
"RTN","SAMICAS4",90,0)
 ;@stanza 4 if no followup forms were found, use background form
"RTN","SAMICAS4",91,0)
 ;
"RTN","SAMICAS4",92,0)
 if fufail do
"RTN","SAMICAS4",93,0)
 . n sbform s sbform=$o(@gn@("sbform")) ; key to form
"RTN","SAMICAS4",94,0)
 . n sbvars s sbvars=$na(@gn@(sbform))
"RTN","SAMICAS4",95,0)
 . ;
"RTN","SAMICAS4",96,0)
 . i @sbvars@("sbsru")="n" d  ; never smoker
"RTN","SAMICAS4",97,0)
 . . s smoker="n"
"RTN","SAMICAS4",98,0)
 . . s clinstr=""
"RTN","SAMICAS4",99,0)
 . . s $p(clinstr,";",3)=" Never Smoker"
"RTN","SAMICAS4",100,0)
 . . q
"RTN","SAMICAS4",101,0)
 . ;
"RTN","SAMICAS4",102,0)
 . i @sbvars@("sbsru")="y" d  ; smoker
"RTN","SAMICAS4",103,0)
 . . i @sbvars@("sbshsa")="y" s smoker="c" ; current smoker
"RTN","SAMICAS4",104,0)
 . . i @sbvars@("sbshsa")="n" s smoker="f" ; former smoker
"RTN","SAMICAS4",105,0)
 . . i smoker="c" d  ; current smoker
"RTN","SAMICAS4",106,0)
 . . . s clinstr=""
"RTN","SAMICAS4",107,0)
 . . . s $p(clinstr,";",3)=" Current Smoker"
"RTN","SAMICAS4",108,0)
 . . . q
"RTN","SAMICAS4",109,0)
 . . ;
"RTN","SAMICAS4",110,0)
 . . i smoker="f" d  ; current smoker
"RTN","SAMICAS4",111,0)
 . . . s clinstr=""
"RTN","SAMICAS4",112,0)
 . . . s $p(clinstr,";",3)=" Former Smoker"
"RTN","SAMICAS4",113,0)
 . . . n sbsdlcd,sbsdlcm,sbsdlcy
"RTN","SAMICAS4",114,0)
 . . . s sbsdlcd=$g(@sbvars@("sbsdlcd"))
"RTN","SAMICAS4",115,0)
 . . . s sbsdlcm=$g(@sbvars@("sbsdlcm"))
"RTN","SAMICAS4",116,0)
 . . . s sbsdlcy=$g(@sbvars@("sbsdlcy"))
"RTN","SAMICAS4",117,0)
 . . . n sbopqy s sbopqy=$$YRSAGO^SAMICAS4(sbsdlcm,sbsdlcd,sbsdlcy)
"RTN","SAMICAS4",118,0)
 . . . s:sbopqy $p(clinstr,";",5)=" Quit "_sbopqy_" years ago"
"RTN","SAMICAS4",119,0)
 . . . q
"RTN","SAMICAS4",120,0)
 . . ;
"RTN","SAMICAS4",121,0)
 . . i clinstr[";" d  ; pack years
"RTN","SAMICAS4",122,0)
 . . . n pkyrs s pkyrs=$g(@sbvars@("sbntpy"))
"RTN","SAMICAS4",123,0)
 . . . i +pkyrs>0 s $p(clinstr,";",4)=" "_pkyrs_" Pack Years"
"RTN","SAMICAS4",124,0)
 . . . q
"RTN","SAMICAS4",125,0)
 . . q
"RTN","SAMICAS4",126,0)
 . ;
"RTN","SAMICAS4",127,0)
 . i clinstr[";" d  ; asymptomatic
"RTN","SAMICAS4",128,0)
 . . n aflc s aflc=" Asymptomatic for lung cancer"
"RTN","SAMICAS4",129,0)
 . . i $g(@sbvars@("sblcs"))="n" s $p(clinstr,";",2)=aflc
"RTN","SAMICAS4",130,0)
 . . q
"RTN","SAMICAS4",131,0)
 . ;
"RTN","SAMICAS4",132,0)
 . ; carry over Clinical information text from background form
"RTN","SAMICAS4",133,0)
 . n savtxt s savtxt=$g(@sbvars@("sbopci"))
"RTN","SAMICAS4",134,0)
 . i savtxt'="" s clinstr=clinstr_$CHAR(13)_savtxt
"RTN","SAMICAS4",135,0)
 . q
"RTN","SAMICAS4",136,0)
 ;
"RTN","SAMICAS4",137,0)
 ;
"RTN","SAMICAS4",138,0)
 ;@stanza 5 append age to clinical info
"RTN","SAMICAS4",139,0)
 ;
"RTN","SAMICAS4",140,0)
 set $piece(clinstr,";",1)="Age: "_age
"RTN","SAMICAS4",141,0)
 ;
"RTN","SAMICAS4",142,0)
 ;
"RTN","SAMICAS4",143,0)
 ;@stanza 6 termination
"RTN","SAMICAS4",144,0)
 ;
"RTN","SAMICAS4",145,0)
 quit clinstr ; end of $$CLINSUM^SAMICAS4
"RTN","SAMICAS4",146,0)
 ;
"RTN","SAMICAS4",147,0)
 ;
"RTN","SAMICAS4",148,0)
 ;
"RTN","SAMICAS4",149,0)
 ;
"RTN","SAMICAS4",150,0)
 ;@func-code $$AGE^SAMICAS4
"RTN","SAMICAS4",151,0)
 ;
"RTN","SAMICAS4",152,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS4",153,0)
 ;
"RTN","SAMICAS4",154,0)
 ;ven/gpl;private;function;clean;silent;sac?;??% tests;port?
"RTN","SAMICAS4",155,0)
 ;@called-by
"RTN","SAMICAS4",156,0)
 ; $$CLINSUM^SAMICAS4
"RTN","SAMICAS4",157,0)
 ;@calls
"RTN","SAMICAS4",158,0)
 ; ^%DT
"RTN","SAMICAS4",159,0)
 ; $$age^%th
"RTN","SAMICAS4",160,0)
 ;@input
"RTN","SAMICAS4",161,0)
 ; dob = date of birth
"RTN","SAMICAS4",162,0)
 ;@output = patient age
"RTN","SAMICAS4",163,0)
 ;@tests [tbd]
"RTN","SAMICAS4",164,0)
 ;
"RTN","SAMICAS4",165,0)
 ;
"RTN","SAMICAS4",166,0)
AGE(dob) ; patient age
"RTN","SAMICAS4",167,0)
 ;
"RTN","SAMICAS4",168,0)
 ;@stanza 2 compute it
"RTN","SAMICAS4",169,0)
 ;
"RTN","SAMICAS4",170,0)
 ; extrinsic derives age from dob
"RTN","SAMICAS4",171,0)
 ;
"RTN","SAMICAS4",172,0)
 i dob["-" s dob=$e(dob,6,7)_"/"_$e(dob,9,10)_"/"_$e(dob,1,4)
"RTN","SAMICAS4",173,0)
 i dob'["/" s dob=$e(dob,5,6)_"/"_$e(dob,7,8)_"/"_$e(dob,1,4)
"RTN","SAMICAS4",174,0)
 new X set X=dob
"RTN","SAMICAS4",175,0)
 new Y
"RTN","SAMICAS4",176,0)
 do ^%DT
"RTN","SAMICAS4",177,0)
 ;
"RTN","SAMICAS4",178,0)
 new age s age=$$age^%th(Y)
"RTN","SAMICAS4",179,0)
 ;
"RTN","SAMICAS4",180,0)
 ;
"RTN","SAMICAS4",181,0)
 ;@stanza 3 termination
"RTN","SAMICAS4",182,0)
 ;
"RTN","SAMICAS4",183,0)
 quit age ; end of $$AGE^SAMICAS4
"RTN","SAMICAS4",184,0)
 ;
"RTN","SAMICAS4",185,0)
 ;
"RTN","SAMICAS4",186,0)
 ;
"RTN","SAMICAS4",187,0)
 ;
"RTN","SAMICAS4",188,0)
 ;@func-code $$YRSAGO^SAMICAS4
"RTN","SAMICAS4",189,0)
 ;
"RTN","SAMICAS4",190,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS4",191,0)
 ;
"RTN","SAMICAS4",192,0)
 ;ven/gpl;private;function;clean;silent;sac?;??% tests;port?
"RTN","SAMICAS4",193,0)
 ;@called-by
"RTN","SAMICAS4",194,0)
 ; $$CLINSUM^SAMICAS4
"RTN","SAMICAS4",195,0)
 ;@calls
"RTN","SAMICAS4",196,0)
 ; ^%DT
"RTN","SAMICAS4",197,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMICAS4",198,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS4",199,0)
 ;@input
"RTN","SAMICAS4",200,0)
 ; dob = date of birth
"RTN","SAMICAS4",201,0)
 ;@output = patient age
"RTN","SAMICAS4",202,0)
 ;@tests [tbd]
"RTN","SAMICAS4",203,0)
 ;
"RTN","SAMICAS4",204,0)
 ;
"RTN","SAMICAS4",205,0)
YRSAGO(mo,da,yr) ; how many years ago was a date
"RTN","SAMICAS4",206,0)
 ;
"RTN","SAMICAS4",207,0)
 ; extrinsic which returns how many years ago was a date
"RTN","SAMICAS4",208,0)
 ;
"RTN","SAMICAS4",209,0)
 ;@stanza 2 compute it
"RTN","SAMICAS4",210,0)
 ;
"RTN","SAMICAS4",211,0)
 n umo,uda
"RTN","SAMICAS4",212,0)
 s:'mo mo=1
"RTN","SAMICAS4",213,0)
 s:'da da=1
"RTN","SAMICAS4",214,0)
 n dtdt s dtdt=mo_"/"_da_"/"_yr
"RTN","SAMICAS4",215,0)
 n X s X=dtdt
"RTN","SAMICAS4",216,0)
 n Y
"RTN","SAMICAS4",217,0)
 d ^%DT
"RTN","SAMICAS4",218,0)
 ;w !,Y
"RTN","SAMICAS4",219,0)
 n diff s diff=$piece($$FMDIFF^XLFDT($$NOW^XLFDT,Y,1)/365,".")
"RTN","SAMICAS4",220,0)
 ;
"RTN","SAMICAS4",221,0)
 ;
"RTN","SAMICAS4",222,0)
 ;@stanza 3 termination
"RTN","SAMICAS4",223,0)
 ;
"RTN","SAMICAS4",224,0)
 quit diff ; end of $$YRSAGO^SAMICAS4
"RTN","SAMICAS4",225,0)
 ;
"RTN","SAMICAS4",226,0)
 ;
"RTN","SAMICAS4",227,0)
 ;
"RTN","SAMICAS4",228,0)
 ;
"RTN","SAMICAS4",229,0)
 ;@section 2 other supplementary subroutines
"RTN","SAMICAS4",230,0)
 ;
"RTN","SAMICAS4",231,0)
 ;
"RTN","SAMICAS4",232,0)
 ;
"RTN","SAMICAS4",233,0)
 ;
"RTN","SAMICAS4",234,0)
 ;@func-code $$BASELNDT^SAMICAS4
"RTN","SAMICAS4",235,0)
 ;
"RTN","SAMICAS4",236,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS4",237,0)
 ;
"RTN","SAMICAS4",238,0)
 ;ven/gpl;private;function;clean;silent;sac;??% tests;port?
"RTN","SAMICAS4",239,0)
 ;@called-by
"RTN","SAMICAS4",240,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS4",241,0)
 ; MKFUFORM^SAMICAS3
"RTN","SAMICAS4",242,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS4",243,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS4",244,0)
 ; SELECT^SAMIUR
"RTN","SAMICAS4",245,0)
 ;@calls
"RTN","SAMICAS4",246,0)
 ; $$setroot^%wd
"RTN","SAMICAS4",247,0)
 ; GETITEMS^SAMICASE
"RTN","SAMICAS4",248,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMICAS4",249,0)
 ;@input
"RTN","SAMICAS4",250,0)
 ; sid = study id
"RTN","SAMICAS4",251,0)
 ;@output = last previous baseline ct date
"RTN","SAMICAS4",252,0)
 ;@examples [tbd]
"RTN","SAMICAS4",253,0)
 ;@tests [tbd]
"RTN","SAMICAS4",254,0)
 ;
"RTN","SAMICAS4",255,0)
 ;
"RTN","SAMICAS4",256,0)
BASELNDT(sid) ; last previous baseline ct date
"RTN","SAMICAS4",257,0)
 ;
"RTN","SAMICAS4",258,0)
 ;@stanza 2 calculate last previous baseline ct date
"RTN","SAMICAS4",259,0)
 ;
"RTN","SAMICAS4",260,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS4",261,0)
 new groot set groot=$name(@root@("graph",sid))
"RTN","SAMICAS4",262,0)
 new items set items=""
"RTN","SAMICAS4",263,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMICAS4",264,0)
 quit:'$data(items) ""
"RTN","SAMICAS4",265,0)
 ;
"RTN","SAMICAS4",266,0)
 new bdate set bdate=""
"RTN","SAMICAS4",267,0)
 new bkey set bkey=""
"RTN","SAMICAS4",268,0)
 new done set done=0
"RTN","SAMICAS4",269,0)
 for  set bkey=$order(items("type","vapals:ceform",bkey)) quit:bkey=""  do  ;
"RTN","SAMICAS4",270,0)
 . ; write !,bkey," ",$get(@groot@(bkey,"cetex"))
"RTN","SAMICAS4",271,0)
 . if $get(@groot@(bkey,"cetex"))="b" do  ;
"RTN","SAMICAS4",272,0)
 . . set done=1
"RTN","SAMICAS4",273,0)
 . . set bdate=$piece(bkey,"ceform-",2)
"RTN","SAMICAS4",274,0)
 . . quit
"RTN","SAMICAS4",275,0)
 . quit
"RTN","SAMICAS4",276,0)
 set bdate=$$KEY2DSPD^SAMICAS2(bdate)
"RTN","SAMICAS4",277,0)
 ;
"RTN","SAMICAS4",278,0)
 ;
"RTN","SAMICAS4",279,0)
 ;@stanza 3 termination
"RTN","SAMICAS4",280,0)
 ;
"RTN","SAMICAS4",281,0)
 quit bdate ; end of $$BASELNDT^SAMICAS4
"RTN","SAMICAS4",282,0)
 ;
"RTN","SAMICAS4",283,0)
 ;
"RTN","SAMICAS4",284,0)
 ;
"RTN","SAMICAS4",285,0)
 ;
"RTN","SAMICAS4",286,0)
 ;@func-code $$KEY2DT^SAMICAS4
"RTN","SAMICAS4",287,0)
 ;
"RTN","SAMICAS4",288,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS4",289,0)
 ;
"RTN","SAMICAS4",290,0)
 ;ven/gpl;private;function;clean;silent;sac;??% tests;port?
"RTN","SAMICAS4",291,0)
 ;@called-by
"RTN","SAMICAS4",292,0)
 ; $$PRIORCMP^SAMICAS3
"RTN","SAMICAS4",293,0)
 ;@calls
"RTN","SAMICAS4",294,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMICAS4",295,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS4",296,0)
 ;@input
"RTN","SAMICAS4",297,0)
 ; key = form key, e.g. ctform-2021-05-25
"RTN","SAMICAS4",298,0)
 ;@output = date to put in prior scans field
"RTN","SAMICAS4",299,0)
 ;@examples [tbd]
"RTN","SAMICAS4",300,0)
 ;@tests [tbd]
"RTN","SAMICAS4",301,0)
 ;
"RTN","SAMICAS4",302,0)
 ;
"RTN","SAMICAS4",303,0)
KEY2DT(key) ; date to put in prior scans field
"RTN","SAMICAS4",304,0)
 ;
"RTN","SAMICAS4",305,0)
 ;@stanza 2 calculate prior scans date
"RTN","SAMICAS4",306,0)
 ;
"RTN","SAMICAS4",307,0)
 new retstr2 set retstr2=""
"RTN","SAMICAS4",308,0)
 new fmdt set fmdt=$$KEY2FM^SAMICASE(tmpkey2)
"RTN","SAMICAS4",309,0)
 set retstr2=$$VAPALSDT^SAMICASE(fmdt)_","_retstr2
"RTN","SAMICAS4",310,0)
 ;
"RTN","SAMICAS4",311,0)
 ;
"RTN","SAMICAS4",312,0)
 ;@stanza 3 termination
"RTN","SAMICAS4",313,0)
 ;
"RTN","SAMICAS4",314,0)
 quit retstr2 ; end of $$KEY2DT^SAMICAS4
"RTN","SAMICAS4",315,0)
 ;
"RTN","SAMICAS4",316,0)
 ;
"RTN","SAMICAS4",317,0)
 ;
"RTN","SAMICAS4",318,0)
 ;
"RTN","SAMICAS4",319,0)
 ;@func-code $$PRIORCMP^SAMICAS4
"RTN","SAMICAS4",320,0)
 ;
"RTN","SAMICAS4",321,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS4",322,0)
 ;
"RTN","SAMICAS4",323,0)
 ;ven/gpl;private;function;clean;silent;sac;??% tests;port?
"RTN","SAMICAS4",324,0)
 ;@called-by
"RTN","SAMICAS4",325,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS4",326,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS4",327,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS4",328,0)
 ;@calls
"RTN","SAMICAS4",329,0)
 ; SORTFRMS^SAMICAS4
"RTN","SAMICAS4",330,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS4",331,0)
 ; $$KEY2DT^SAMICAS4
"RTN","SAMICAS4",332,0)
 ; $$VAPALSDT^SAMICASE [commented out]
"RTN","SAMICAS4",333,0)
 ;@input
"RTN","SAMICAS4",334,0)
 ; sid = study id
"RTN","SAMICAS4",335,0)
 ;@output = dates of all scans before last comparison scan
"RTN","SAMICAS4",336,0)
 ;@examples [tbd]
"RTN","SAMICAS4",337,0)
 ;@tests [tbd]
"RTN","SAMICAS4",338,0)
 ;
"RTN","SAMICAS4",339,0)
 ;
"RTN","SAMICAS4",340,0)
PRIORCMP(sid) ; dates of all scans before last comparison scan
"RTN","SAMICAS4",341,0)
 ;
"RTN","SAMICAS4",342,0)
 ;@stanza 2 calculate dates of all scans before last comparison scan
"RTN","SAMICAS4",343,0)
 ;
"RTN","SAMICAS4",344,0)
 new retstr set retstr=""
"RTN","SAMICAS4",345,0)
 new lastcmp set lastcmp=""
"RTN","SAMICAS4",346,0)
 new fary
"RTN","SAMICAS4",347,0)
 do SORTFRMS^SAMICAS4(.fary,sid)
"RTN","SAMICAS4",348,0)
 ;
"RTN","SAMICAS4",349,0)
 ;new tdt set tdt=$piece($$NOW^XLFDT,".",1)+1 ; start with today
"RTN","SAMICAS4",350,0)
 new tdt set tdt=$piece($$NOW^XLFDT,".",1) ; start with before today
"RTN","SAMICAS4",351,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  do  ; 
"RTN","SAMICAS4",352,0)
 . ;
"RTN","SAMICAS4",353,0)
 . if lastcmp="" do  ; first find the last comparison scan
"RTN","SAMICAS4",354,0)
 . . new tmpkey set tmpkey=""
"RTN","SAMICAS4",355,0)
 . . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:lastcmp'=""  do  ; 
"RTN","SAMICAS4",356,0)
 . . . if tmpkey["ceform" set lastcmp=tmpkey
"RTN","SAMICAS4",357,0)
 . . . quit
"RTN","SAMICAS4",358,0)
 . . quit
"RTN","SAMICAS4",359,0)
 . ;
"RTN","SAMICAS4",360,0)
 . do  ;
"RTN","SAMICAS4",361,0)
 . . ; next add all previous scans to retstr
"RTN","SAMICAS4",362,0)
 . . new tmpkey2 set tmpkey2=""
"RTN","SAMICAS4",363,0)
 . . for  set tmpkey2=$order(fary(tdt,tmpkey2)) quit:tmpkey2=""  do  ; 
"RTN","SAMICAS4",364,0)
 . . . if tmpkey2["ceform" do  ; convert to external date
"RTN","SAMICAS4",365,0)
 . . . . set retstr=$$KEY2DT^SAMICAS4(tmpkey2)_retstr
"RTN","SAMICAS4",366,0)
 . . . . quit
"RTN","SAMICAS4",367,0)
 . . . quit
"RTN","SAMICAS4",368,0)
 . . quit
"RTN","SAMICAS4",369,0)
 . quit
"RTN","SAMICAS4",370,0)
 ;
"RTN","SAMICAS4",371,0)
 if $extract(retstr,$length(retstr))="," do
"RTN","SAMICAS4",372,0)
 . set retstr=$extract(retstr,1,$length(retstr)-1)
"RTN","SAMICAS4",373,0)
 . quit
"RTN","SAMICAS4",374,0)
 ;
"RTN","SAMICAS4",375,0)
 ;if retstr="" set retstr=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS4",376,0)
 ;
"RTN","SAMICAS4",377,0)
 ;
"RTN","SAMICAS4",378,0)
 ;@stanza 3 termination
"RTN","SAMICAS4",379,0)
 ;
"RTN","SAMICAS4",380,0)
 quit retstr ; end of $$PRIORCMP^SAMICAS4
"RTN","SAMICAS4",381,0)
 ;
"RTN","SAMICAS4",382,0)
 ;
"RTN","SAMICAS4",383,0)
 ;
"RTN","SAMICAS4",384,0)
 ;
"RTN","SAMICAS4",385,0)
 ;@proc-code SORTFRMS^SAMICAS4
"RTN","SAMICAS4",386,0)
 ;
"RTN","SAMICAS4",387,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS4",388,0)
 ;
"RTN","SAMICAS4",389,0)
 ;ven/gpl;private;procedure;clean;silent;sac;??% tests;port?
"RTN","SAMICAS4",390,0)
 ;@called-by
"RTN","SAMICAS4",391,0)
 ; $$PREVNOD^SAMICAS4
"RTN","SAMICAS4",392,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS4",393,0)
 ; $$PRIORCMP^SAMICAS4
"RTN","SAMICAS4",394,0)
 ;@calls
"RTN","SAMICAS4",395,0)
 ; $$setroot^%wd
"RTN","SAMICAS4",396,0)
 ; ^%DT
"RTN","SAMICAS4",397,0)
 ; ^%ZTER
"RTN","SAMICAS4",398,0)
 ;@input
"RTN","SAMICAS4",399,0)
 ; sid = study id
"RTN","SAMICAS4",400,0)
 ;@output
"RTN","SAMICAS4",401,0)
 ; .ARY: sorted array of all forms for patient by date
"RTN","SAMICAS4",402,0)
 ;  ARY(fmdate,key)=""
"RTN","SAMICAS4",403,0)
 ;@examples [tbd]
"RTN","SAMICAS4",404,0)
 ;@tests [tbd]
"RTN","SAMICAS4",405,0)
 ;
"RTN","SAMICAS4",406,0)
 ;
"RTN","SAMICAS4",407,0)
SORTFRMS(ARY,sid) ; sorts all forms for patient sid by date
"RTN","SAMICAS4",408,0)
 ;
"RTN","SAMICAS4",409,0)
 ;@stanza 2 sort patient's forms by date
"RTN","SAMICAS4",410,0)
 ;
"RTN","SAMICAS4",411,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS4",412,0)
 quit:'$data(@root@("graph",sid))
"RTN","SAMICAS4",413,0)
 new froot set froot=$name(@root@("graph",sid))
"RTN","SAMICAS4",414,0)
 ;
"RTN","SAMICAS4",415,0)
 new zi set zi=""
"RTN","SAMICAS4",416,0)
 for  set zi=$order(@froot@(zi)) quit:zi=""  do  ;
"RTN","SAMICAS4",417,0)
 . new ftype set ftype=$piece(zi,"-",1)
"RTN","SAMICAS4",418,0)
 . new fdate set fdate=$piece(zi,ftype_"-",2)
"RTN","SAMICAS4",419,0)
 . new X,Y
"RTN","SAMICAS4",420,0)
 . set X=fdate
"RTN","SAMICAS4",421,0)
 . do ^%DT
"RTN","SAMICAS4",422,0)
 . if Y=-1 do ^%ZTER quit  ;
"RTN","SAMICAS4",423,0)
 . set ARY(Y,zi)=""
"RTN","SAMICAS4",424,0)
 . quit
"RTN","SAMICAS4",425,0)
 ;
"RTN","SAMICAS4",426,0)
 ;
"RTN","SAMICAS4",427,0)
 ;@stanza 3 termination
"RTN","SAMICAS4",428,0)
 ;
"RTN","SAMICAS4",429,0)
 quit  ; end of SORTFRMS^SAMICAS4
"RTN","SAMICAS4",430,0)
 ;
"RTN","SAMICAS4",431,0)
 ;
"RTN","SAMICAS4",432,0)
 ;
"RTN","SAMICAS4",433,0)
 ;
"RTN","SAMICAS4",434,0)
 ;@section 3 unused supplementary subroutine
"RTN","SAMICAS4",435,0)
 ;
"RTN","SAMICAS4",436,0)
 ;
"RTN","SAMICAS4",437,0)
 ;
"RTN","SAMICAS4",438,0)
 ;
"RTN","SAMICAS4",439,0)
 ;@func-code $$PREVNOD^SAMICAS4
"RTN","SAMICAS4",440,0)
 ;
"RTN","SAMICAS4",441,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS4",442,0)
 ;
"RTN","SAMICAS4",443,0)
 ;ven/gpl;private;function;clean;silent;sac;??% tests;port?
"RTN","SAMICAS4",444,0)
 ;@called-by none [commented out in MKCEFORM,MKPTFORM,MKBXFORM]
"RTN","SAMICAS4",445,0)
 ;@calls
"RTN","SAMICAS4",446,0)
 ; SORTFRMS^SAMICAS4
"RTN","SAMICAS4",447,0)
 ;@input
"RTN","SAMICAS4",448,0)
 ; sid = study id
"RTN","SAMICAS4",449,0)
 ;@output = key of latest form incl nodule grid
"RTN","SAMICAS4",450,0)
 ;@examples [tbd]
"RTN","SAMICAS4",451,0)
 ;@tests [tbd]
"RTN","SAMICAS4",452,0)
 ;
"RTN","SAMICAS4",453,0)
 ; used for nodule copy
"RTN","SAMICAS4",454,0)
 ;
"RTN","SAMICAS4",455,0)
 ;
"RTN","SAMICAS4",456,0)
PREVNOD(sid) ; key of latest form including nodule grid
"RTN","SAMICAS4",457,0)
 ;
"RTN","SAMICAS4",458,0)
 ;@stanza 2 calculate key of latest form incl nodule grid
"RTN","SAMICAS4",459,0)
 ;
"RTN","SAMICAS4",460,0)
 new retkey set retkey=""
"RTN","SAMICAS4",461,0)
 new fary
"RTN","SAMICAS4",462,0)
 do SORTFRMS^SAMICAS4(.fary,sid)
"RTN","SAMICAS4",463,0)
 ;
"RTN","SAMICAS4",464,0)
 new tdt set tdt=""
"RTN","SAMICAS4",465,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS4",466,0)
 . new tmpkey set tmpkey=""
"RTN","SAMICAS4",467,0)
 . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS4",468,0)
 . . if tmpkey["ceform" set retkey=tmpkey
"RTN","SAMICAS4",469,0)
 . . if tmpkey["ptform" set retkey=tmpkey
"RTN","SAMICAS4",470,0)
 . . if tmpkey["bxform" set retkey=tmpkey
"RTN","SAMICAS4",471,0)
 . . quit
"RTN","SAMICAS4",472,0)
 . quit
"RTN","SAMICAS4",473,0)
 ;
"RTN","SAMICAS4",474,0)
 ;
"RTN","SAMICAS4",475,0)
 ;@stanza 3 termination
"RTN","SAMICAS4",476,0)
 ;
"RTN","SAMICAS4",477,0)
 quit retkey ; end of $$PREVNOD^SAMICAS4
"RTN","SAMICAS4",478,0)
 ;
"RTN","SAMICAS4",479,0)
 ;
"RTN","SAMICAS4",480,0)
 ;
"RTN","SAMICAS4",481,0)
 ;
"RTN","SAMICAS4",482,0)
EOR ; end of routine SAMICAS4
"RTN","SAMICSV")
0^9^B104029869
"RTN","SAMICSV",1,0)
SAMICSV ;ven/gpl - export csv; 2024-08-22t21:04z
"RTN","SAMICSV",2,0)
 ;;18.0;SAMI;**7,11,17**;2020-01-17;Build 8
"RTN","SAMICSV",3,0)
 ;mdc-e1;SAMICSV-20240822-E0Is5cO;SAMI-18-17-b6
"RTN","SAMICSV",4,0)
 ;mdc-v7;B104029869;SAMI*18.0*17 SEQ #17
"RTN","SAMICSV",5,0)
 ;
"RTN","SAMICSV",6,0)
 ; SAMICSV contains a direct-mode service to produce the ScreeningPlus
"RTN","SAMICSV",7,0)
 ; CSV export.
"RTN","SAMICSV",8,0)
 ;
"RTN","SAMICSV",9,0)
 ; allow entry from top, fallthrough to EN
"RTN","SAMICSV",10,0)
 ;
"RTN","SAMICSV",11,0)
 ;
"RTN","SAMICSV",12,0)
 ;
"RTN","SAMICSV",13,0)
 ;@section 0 primary development
"RTN","SAMICSV",14,0)
 ;
"RTN","SAMICSV",15,0)
 ;
"RTN","SAMICSV",16,0)
 ;
"RTN","SAMICSV",17,0)
 ;@routine-credits
"RTN","SAMICSV",18,0)
 ;
"RTN","SAMICSV",19,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMICSV",20,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICSV",21,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMICSV",22,0)
 ; http://vistaexpertise.net
"RTN","SAMICSV",23,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMICSV",24,0)
 ;@license see routine SAMIUL
"RTN","SAMICSV",25,0)
 ;
"RTN","SAMICSV",26,0)
 ;@update 2024-08-22t21:04z
"RTN","SAMICSV",27,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMICSV",28,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMICSV",29,0)
 ;@module Import/Export - various prefixes
"RTN","SAMICSV",30,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMICSV",31,0)
 ;@release 18-17
"RTN","SAMICSV",32,0)
 ;@edition-date 2020-01-17
"RTN","SAMICSV",33,0)
 ;@patches **7,11**
"RTN","SAMICSV",34,0)
 ;
"RTN","SAMICSV",35,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMICSV",36,0)
 ; toad@vistaexpertise.net
"RTN","SAMICSV",37,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMICSV",38,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICSV",39,0)
 ;
"RTN","SAMICSV",40,0)
 ;@module-credits
"RTN","SAMICSV",41,0)
 ;
"RTN","SAMICSV",42,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICSV",43,0)
 ; (VA-PALS)
"RTN","SAMICSV",44,0)
 ; http://va-pals.org/
"RTN","SAMICSV",45,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICSV",46,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICSV",47,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICSV",48,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICSV",49,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMICSV",50,0)
 ; http://ielcap.com/
"RTN","SAMICSV",51,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICSV",52,0)
 ; http://paraxialtech.com/
"RTN","SAMICSV",53,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICSV",54,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICSV",55,0)
 ;
"RTN","SAMICSV",56,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMICSV",57,0)
 ; https://www.ielcap-airs.org
"RTN","SAMICSV",58,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMICSV",59,0)
 ;@partner-org par
"RTN","SAMICSV",60,0)
 ;
"RTN","SAMICSV",61,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICSV",62,0)
 ;
"RTN","SAMICSV",63,0)
 ; 2020-08-20/09-24 ven/gpl 18-7 9486abb2,5ae08772,ba0bcb82,1a2a1bf6,
"RTN","SAMICSV",64,0)
 ; 16511893
"RTN","SAMICSV",65,0)
 ;  SAMICSV new routine, test build for extracting form data to csv
"RTN","SAMICSV",66,0)
 ; files, upgrade change site to handle patients without forms, audit
"RTN","SAMICSV",67,0)
 ; report, select from 7 forms for extract, fix dictionary spelling
"RTN","SAMICSV",68,0)
 ; for followup form, fix bug of line feeds in csv output interrupting
"RTN","SAMICSV",69,0)
 ; excel load.
"RTN","SAMICSV",70,0)
 ;
"RTN","SAMICSV",71,0)
 ; 2021-03-25 ven/gpl 18-11 e28a34d3
"RTN","SAMICSV",72,0)
 ;  SAMICSV remove line feeds from variables.
"RTN","SAMICSV",73,0)
 ;
"RTN","SAMICSV",74,0)
 ; 2021-03-30 ven/toad 18-11 7b14bb2
"RTN","SAMICSV",75,0)
 ;  SAMICSV bump version, date, patch list, create hdr comments, lt
"RTN","SAMICSV",76,0)
 ; refactor.
"RTN","SAMICSV",77,0)
 ;
"RTN","SAMICSV",78,0)
 ; 2021-04-15 ven/gpl 18-11 f9795a5,5aa13f1
"RTN","SAMICSV",79,0)
 ;  SAMICSV fix double quotes in csv output, correct csv format no
"RTN","SAMICSV",80,0)
 ; quotes for null cells.
"RTN","SAMICSV",81,0)
 ;
"RTN","SAMICSV",82,0)
 ; 2021-05-21 ven/mcglk&toad 18-11
"RTN","SAMICSV",83,0)
 ;  SAMICSV bump version, date.
"RTN","SAMICSV",84,0)
 ;
"RTN","SAMICSV",85,0)
 ; 2022-12-11 ven/gpl 18-17-b3
"RTN","SAMICSV",86,0)
 ;  SAMICSV include last5 and saminame in every csv file on every row.
"RTN","SAMICSV",87,0)
 ;
"RTN","SAMICSV",88,0)
 ; 2022-12-13 ven/lmry 18-17-b3
"RTN","SAMICSV",89,0)
 ;  SAMICSV update log, bump date.
"RTN","SAMICSV",90,0)
 ;
"RTN","SAMICSV",91,0)
 ; 2024-08-17 ven/lmry 18-17-b6
"RTN","SAMICSV",92,0)
 ;  SAMICSV bump version, date.
"RTN","SAMICSV",93,0)
 ;
"RTN","SAMICSV",94,0)
 ; 2024-08-21/22 ven/toad 18-17-b6
"RTN","SAMICSV",95,0)
 ;  SAMICSV annotate, update history, update version-control lines,
"RTN","SAMICSV",96,0)
 ; hdr comments.
"RTN","SAMICSV",97,0)
 ;
"RTN","SAMICSV",98,0)
 ;@contents
"RTN","SAMICSV",99,0)
 ;
"RTN","SAMICSV",100,0)
 ; EN entry point to generate csv files from forms for a site
"RTN","SAMICSV",101,0)
 ; $$SAYFORM prompts for form
"RTN","SAMICSV",102,0)
 ; ONEFORM process one form for a site
"RTN","SAMICSV",103,0)
 ; $$FNAME filename for site/form
"RTN","SAMICSV",104,0)
 ; DDICT data dictionary for form
"RTN","SAMICSV",105,0)
 ;
"RTN","SAMICSV",106,0)
 ;
"RTN","SAMICSV",107,0)
 ;
"RTN","SAMICSV",108,0)
 ;
"RTN","SAMICSV",109,0)
 ;@dms-code EN^SAMICSV
"RTN","SAMICSV",110,0)
 ;
"RTN","SAMICSV",111,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICSV",112,0)
 ;
"RTN","SAMICSV",113,0)
 ;ven/gpl;dms;procedure;clean?;dialog;sac;??% tests;port?
"RTN","SAMICSV",114,0)
 ;@signature
"RTN","SAMICSV",115,0)
 ; do ^SAMICSV
"RTN","SAMICSV",116,0)
 ;@falls-thru-from
"RTN","SAMICSV",117,0)
 ; ^SAMICSV
"RTN","SAMICSV",118,0)
 ;@called-by none
"RTN","SAMICSV",119,0)
 ;@calls
"RTN","SAMICSV",120,0)
 ; ^DIC
"RTN","SAMICSV",121,0)
 ; $$SITEID^SAMISITE
"RTN","SAMICSV",122,0)
 ; $$SAYFORM
"RTN","SAMICSV",123,0)
 ; GETDIR^SAMIFDM
"RTN","SAMICSV",124,0)
 ; ONEFORM
"RTN","SAMICSV",125,0)
 ;@input [tbd]
"RTN","SAMICSV",126,0)
 ;@output [tbd]
"RTN","SAMICSV",127,0)
 ;@tests [tbd]
"RTN","SAMICSV",128,0)
 ;
"RTN","SAMICSV",129,0)
 ;
"RTN","SAMICSV",130,0)
EN ; entry point to generate csv files from forms for a site
"RTN","SAMICSV",131,0)
 ;
"RTN","SAMICSV",132,0)
 ;@stanza 2 select site
"RTN","SAMICSV",133,0)
 ;
"RTN","SAMICSV",134,0)
 ; first pick a site
"RTN","SAMICSV",135,0)
 N X,Y,DIC,SITEIEN,SITEID
"RTN","SAMICSV",136,0)
 S DIC=311.12
"RTN","SAMICSV",137,0)
 S DIC(0)="AEMQ"
"RTN","SAMICSV",138,0)
 D ^DIC
"RTN","SAMICSV",139,0)
 I Y<1 Q  ; EXIT
"RTN","SAMICSV",140,0)
 S SITENUM=$P(Y,"^",2)
"RTN","SAMICSV",141,0)
 ;
"RTN","SAMICSV",142,0)
 S SITEID=$$SITEID^SAMISITE(SITENUM)
"RTN","SAMICSV",143,0)
 Q:SITEID=""
"RTN","SAMICSV",144,0)
 ;
"RTN","SAMICSV",145,0)
 ;
"RTN","SAMICSV",146,0)
 ;@stanza 3 select form
"RTN","SAMICSV",147,0)
 ;
"RTN","SAMICSV",148,0)
 N SAMIFORM S SAMIFORM=$$SAYFORM()
"RTN","SAMICSV",149,0)
 Q:SAMIFORM=-1
"RTN","SAMICSV",150,0)
 ;
"RTN","SAMICSV",151,0)
 ;
"RTN","SAMICSV",152,0)
 ;@stanza 4 select directory
"RTN","SAMICSV",153,0)
 ;
"RTN","SAMICSV",154,0)
 ; prompt for the directory
"RTN","SAMICSV",155,0)
 N SAMIDIR
"RTN","SAMICSV",156,0)
 D GETDIR^SAMIFDM(.SAMIDIR)
"RTN","SAMICSV",157,0)
 Q:SAMIDIR=""
"RTN","SAMICSV",158,0)
 ;
"RTN","SAMICSV",159,0)
 d ONEFORM(SITEID,SAMIFORM,SAMIDIR) ; process one form for a site
"RTN","SAMICSV",160,0)
 ;
"RTN","SAMICSV",161,0)
 ;
"RTN","SAMICSV",162,0)
 ;@stanza 5 termination
"RTN","SAMICSV",163,0)
 ;
"RTN","SAMICSV",164,0)
 quit  ; end of EN
"RTN","SAMICSV",165,0)
 ;
"RTN","SAMICSV",166,0)
 ;
"RTN","SAMICSV",167,0)
 ;
"RTN","SAMICSV",168,0)
 ;
"RTN","SAMICSV",169,0)
 ;@func-code $$SAYFORM^SAMICSV
"RTN","SAMICSV",170,0)
 ;
"RTN","SAMICSV",171,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICSV",172,0)
 ;
"RTN","SAMICSV",173,0)
 ;ven/gpl;private;pseudo-function;clean?;prompt;sac;??% tests;port?
"RTN","SAMICSV",174,0)
 ;@called-by
"RTN","SAMICSV",175,0)
 ; ^SAMICSV
"RTN","SAMICSV",176,0)
 ;@calls
"RTN","SAMICSV",177,0)
 ; ^DIR
"RTN","SAMICSV",178,0)
 ;@input [tbd]
"RTN","SAMICSV",179,0)
 ;@output = form
"RTN","SAMICSV",180,0)
 ;@tests [tbd]
"RTN","SAMICSV",181,0)
 ;
"RTN","SAMICSV",182,0)
 ;
"RTN","SAMICSV",183,0)
SAYFORM() ; prompts for the form
"RTN","SAMICSV",184,0)
 ;
"RTN","SAMICSV",185,0)
 ;@stanza 2 define set of codes
"RTN","SAMICSV",186,0)
 ;
"RTN","SAMICSV",187,0)
 N ZF
"RTN","SAMICSV",188,0)
 S ZF(1)="siform"
"RTN","SAMICSV",189,0)
 S ZF(2)="sbform"
"RTN","SAMICSV",190,0)
 S ZF(3)="ceform"
"RTN","SAMICSV",191,0)
 S ZF(4)="fuform"
"RTN","SAMICSV",192,0)
 S ZF(5)="bxform"
"RTN","SAMICSV",193,0)
 S ZF(6)="itform"
"RTN","SAMICSV",194,0)
 S ZF(7)="ptform"
"RTN","SAMICSV",195,0)
 N DIR S DIR(0)="SO^"
"RTN","SAMICSV",196,0)
 N ZI
"RTN","SAMICSV",197,0)
 F ZI=1:1:7 S DIR(0)=DIR(0)_ZI_":"_ZF(ZI)_";"
"RTN","SAMICSV",198,0)
 ;
"RTN","SAMICSV",199,0)
 ;
"RTN","SAMICSV",200,0)
 ;@stanza 3 set up prompt
"RTN","SAMICSV",201,0)
 ;
"RTN","SAMICSV",202,0)
 S DIR("L")="Select form to extract:"
"RTN","SAMICSV",203,0)
 S DIR("L",1)="1 Intake form (siform)"
"RTN","SAMICSV",204,0)
 S DIR("L",2)="2 Background form (sbform)"
"RTN","SAMICSV",205,0)
 S DIR("L",3)="3 CT Evaluation form (ceform)"
"RTN","SAMICSV",206,0)
 S DIR("L",4)="4 Followup form (fuform)"
"RTN","SAMICSV",207,0)
 S DIR("L",5)="5 Biopsy form (bxform)"
"RTN","SAMICSV",208,0)
 S DIR("L",6)="6 Intervention form (itform)"
"RTN","SAMICSV",209,0)
 S DIR("L",7)="7 Pet Evaluation form (ptform)"
"RTN","SAMICSV",210,0)
 ;
"RTN","SAMICSV",211,0)
 ;
"RTN","SAMICSV",212,0)
 ;@stanza 4 prompt user to select a form
"RTN","SAMICSV",213,0)
 ;
"RTN","SAMICSV",214,0)
 D ^DIR
"RTN","SAMICSV",215,0)
 Q:X="" -1
"RTN","SAMICSV",216,0)
 ;
"RTN","SAMICSV",217,0)
 ;
"RTN","SAMICSV",218,0)
 ;@stanza 5 termination
"RTN","SAMICSV",219,0)
 ;
"RTN","SAMICSV",220,0)
 quit ZF(X) ; end of $$SAYFORM
"RTN","SAMICSV",221,0)
 ;
"RTN","SAMICSV",222,0)
 ;
"RTN","SAMICSV",223,0)
 ;
"RTN","SAMICSV",224,0)
 ;
"RTN","SAMICSV",225,0)
 ;@proc-code ONEFORM^SAMICSV
"RTN","SAMICSV",226,0)
 ;
"RTN","SAMICSV",227,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICSV",228,0)
 ;
"RTN","SAMICSV",229,0)
 ;ven/gpl;private;procedure;clean;silent;sac;??% tests;port?
"RTN","SAMICSV",230,0)
 ;@called-by none
"RTN","SAMICSV",231,0)
 ;@calls
"RTN","SAMICSV",232,0)
 ; $$setroot^%wd
"RTN","SAMICSV",233,0)
 ; DDICT
"RTN","SAMICSV",234,0)
 ; $$FNAME
"RTN","SAMICSV",235,0)
 ; GTF^%ZISH
"RTN","SAMICSV",236,0)
 ;@input
"RTN","SAMICSV",237,0)
 ; SITEID =
"RTN","SAMICSV",238,0)
 ; SAMIFORM =
"RTN","SAMICSV",239,0)
 ; SAMIDIR =
"RTN","SAMICSV",240,0)
 ;@output [tbd]
"RTN","SAMICSV",241,0)
 ;@tests [tbd]
"RTN","SAMICSV",242,0)
 ;
"RTN","SAMICSV",243,0)
 ;
"RTN","SAMICSV",244,0)
ONEFORM(SITEID,SAMIFORM,SAMIDIR) ; process one form for a site
"RTN","SAMICSV",245,0)
 ;
"RTN","SAMICSV",246,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICSV",247,0)
 n groot s groot=$na(@root@("graph"))
"RTN","SAMICSV",248,0)
 n SAMII S SAMII=SITEID
"RTN","SAMICSV",249,0)
 n cnt s cnt=0
"RTN","SAMICSV",250,0)
 n forms s forms=0
"RTN","SAMICSV",251,0)
 ;
"RTN","SAMICSV",252,0)
 n SAMIOUT S SAMIOUT=$NA(^TMP("SAMICSV",$J))
"RTN","SAMICSV",253,0)
 k @SAMIOUT
"RTN","SAMICSV",254,0)
 ;
"RTN","SAMICSV",255,0)
 n DICT
"RTN","SAMICSV",256,0)
 d DDICT("DICT",SAMIFORM) ; get the data dictionary for this form
"RTN","SAMICSV",257,0)
 q:'$d(DICT)
"RTN","SAMICSV",258,0)
 ;
"RTN","SAMICSV",259,0)
 N SAMIN S SAMIN=1
"RTN","SAMICSV",260,0)
 N SAMIJJ s SAMIJJ=0
"RTN","SAMICSV",261,0)
 N OFFSET S OFFSET=1
"RTN","SAMICSV",262,0)
 d  ; start with last5 and name for all forms
"RTN","SAMICSV",263,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="last5"
"RTN","SAMICSV",264,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",265,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="saminame"
"RTN","SAMICSV",266,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",267,0)
 ;
"RTN","SAMICSV",268,0)
 I SAMIFORM="siform" d  ;
"RTN","SAMICSV",269,0)
 . ;S OFFSET=OFFSET+1
"RTN","SAMICSV",270,0)
 . ;s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="saminame"
"RTN","SAMICSV",271,0)
 . ;S OFFSET=OFFSET+1
"RTN","SAMICSV",272,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="ssn"
"RTN","SAMICSV",273,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",274,0)
 . ;s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="last5"
"RTN","SAMICSV",275,0)
 . ;S OFFSET=OFFSET+1
"RTN","SAMICSV",276,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="sex"
"RTN","SAMICSV",277,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",278,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="sbdob"
"RTN","SAMICSV",279,0)
 . S OFFSET=OFFSET+1
"RTN","SAMICSV",280,0)
 . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)="samiru"
"RTN","SAMICSV",281,0)
 f  s SAMIJJ=$o(DICT(SAMIJJ)) q:+SAMIJJ=0  d  ;
"RTN","SAMICSV",282,0)
 . s $p(@SAMIOUT@(SAMIN),"|",SAMIJJ+OFFSET)=DICT(SAMIJJ) ; csv header
"RTN","SAMICSV",283,0)
 s @SAMIOUT@(SAMIN)="siteid|samistudyid|form|"_@SAMIOUT@(SAMIN)
"RTN","SAMICSV",284,0)
 ;S @SAMIOUT@(SAMIN)=@SAMIOUT@(SAMIN)_$C(13,10) ; carriage return line feed
"RTN","SAMICSV",285,0)
 ; 
"RTN","SAMICSV",286,0)
 f  s SAMII=$o(@groot@(SAMII)) q:SAMII=""  q:$e(SAMII,1,3)'[SITEID  d  ;
"RTN","SAMICSV",287,0)
 . s cnt=cnt+1
"RTN","SAMICSV",288,0)
 . w !,SAMII
"RTN","SAMICSV",289,0)
 . N SAMIJ S SAMIJ=SAMIFORM
"RTN","SAMICSV",290,0)
 . n done s done=0
"RTN","SAMICSV",291,0)
 . f  s SAMIJ=$O(@groot@(SAMII,SAMIJ)) q:SAMIJ=""  q:done  d  ;
"RTN","SAMICSV",292,0)
 . . i $e(SAMIJ,1,$l(SAMIFORM))'=SAMIFORM s done=1 q  ;
"RTN","SAMICSV",293,0)
 . . s forms=forms+1
"RTN","SAMICSV",294,0)
 . . n jj s jj=0
"RTN","SAMICSV",295,0)
 . . s SAMIN=SAMIN+1
"RTN","SAMICSV",296,0)
 . . S OFFSET=1
"RTN","SAMICSV",297,0)
 . . n kk s kk=$o(@root@("sid",SAMII,""))
"RTN","SAMICSV",298,0)
 . . q:kk=""
"RTN","SAMICSV",299,0)
 . . ;S OFFSET=OFFSET+1
"RTN","SAMICSV",300,0)
 . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"last5"))
"RTN","SAMICSV",301,0)
 . . S OFFSET=OFFSET+1
"RTN","SAMICSV",302,0)
 . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"saminame"))
"RTN","SAMICSV",303,0)
 . . S OFFSET=OFFSET+1
"RTN","SAMICSV",304,0)
 . . ;
"RTN","SAMICSV",305,0)
 . . I SAMIFORM="siform" d  ;
"RTN","SAMICSV",306,0)
 . . . ;n kk s kk=$o(@root@("sid",SAMII,""))
"RTN","SAMICSV",307,0)
 . . . ;q:kk=""
"RTN","SAMICSV",308,0)
 . . . ;S OFFSET=OFFSET+1
"RTN","SAMICSV",309,0)
 . . . ;s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"saminame"))
"RTN","SAMICSV",310,0)
 . . . ;S OFFSET=OFFSET+1
"RTN","SAMICSV",311,0)
 . . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"ssn"))
"RTN","SAMICSV",312,0)
 . . . S OFFSET=OFFSET+1
"RTN","SAMICSV",313,0)
 . . . ;s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"last5"))
"RTN","SAMICSV",314,0)
 . . . ;S OFFSET=OFFSET+1
"RTN","SAMICSV",315,0)
 . . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"sex"))
"RTN","SAMICSV",316,0)
 . . . S OFFSET=OFFSET+1
"RTN","SAMICSV",317,0)
 . . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"sbdob"))
"RTN","SAMICSV",318,0)
 . . . S OFFSET=OFFSET+1
"RTN","SAMICSV",319,0)
 . . . s $p(@SAMIOUT@(SAMIN),"|",OFFSET)=$g(@root@(kk,"samiru"))
"RTN","SAMICSV",320,0)
 . . f  s jj=$o(DICT(jj)) q:+jj=0  d  ;
"RTN","SAMICSV",321,0)
 . . . ;s $P(@SAMIOUT@(SAMIN),"|",OFFSET+jj)=""""_$g(@groot@(SAMII,SAMIJ,DICT(jj)))_""""
"RTN","SAMICSV",322,0)
 . . . n val
"RTN","SAMICSV",323,0)
 . . . ;s val=$g(@groot@(SAMII,SAMIJ,DICT(jj)))_""""
"RTN","SAMICSV",324,0)
 . . . s val=$g(@groot@(SAMII,SAMIJ,DICT(jj)))
"RTN","SAMICSV",325,0)
 . . . i val'="" d  ;
"RTN","SAMICSV",326,0)
 . . . . s val=$tr(val,$char(11))
"RTN","SAMICSV",327,0)
 . . . . s val=$tr(val,$char(13))
"RTN","SAMICSV",328,0)
 . . . . d findReplaceAll^%ts(.val,"""","""""")
"RTN","SAMICSV",329,0)
 . . . . s val=""""_val_""""
"RTN","SAMICSV",330,0)
 . . . s $P(@SAMIOUT@(SAMIN),"|",OFFSET+jj)=val
"RTN","SAMICSV",331,0)
 . . S @SAMIOUT@(SAMIN)=SITEID_"|"_SAMII_"|"_SAMIJ_"|"_@SAMIOUT@(SAMIN)
"RTN","SAMICSV",332,0)
 . . ;s @SAMIOUT@(SAMIN)=@SAMIOUT@(SAMIN)_$C(13,10)
"RTN","SAMICSV",333,0)
 . ;b
"RTN","SAMICSV",334,0)
 ;ZWR @SAMIOUT@(*)
"RTN","SAMICSV",335,0)
 w !,cnt_" patients, "_forms_" forms"
"RTN","SAMICSV",336,0)
 n filename s filename=$$FNAME(SITEID,SAMIFORM)
"RTN","SAMICSV",337,0)
 d GTF^%ZISH($na(@SAMIOUT@(1)),3,SAMIDIR,filename)
"RTN","SAMICSV",338,0)
 w !,"file "_filename_" written to directory "_SAMIDIR
"RTN","SAMICSV",339,0)
 ;
"RTN","SAMICSV",340,0)
 quit  ; end of ONEFORM
"RTN","SAMICSV",341,0)
 ;
"RTN","SAMICSV",342,0)
 ;
"RTN","SAMICSV",343,0)
 ;
"RTN","SAMICSV",344,0)
 ;
"RTN","SAMICSV",345,0)
 ;@func-code $$FNAME^SAMICSV
"RTN","SAMICSV",346,0)
 ;
"RTN","SAMICSV",347,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICSV",348,0)
 ;
"RTN","SAMICSV",349,0)
 ;ven/gpl;private;function;clean;silent;sac;??% tests;port
"RTN","SAMICSV",350,0)
 ;@called-by
"RTN","SAMICSV",351,0)
 ; ONEFORM^SAMICSV
"RTN","SAMICSV",352,0)
 ;@calls
"RTN","SAMICSV",353,0)
 ; $$HTFM^XLFDT
"RTN","SAMICSV",354,0)
 ; $$FMTHL7^XLFDT
"RTN","SAMICSV",355,0)
 ;@input
"RTN","SAMICSV",356,0)
 ; SITE =
"RTN","SAMICSV",357,0)
 ; FORM =
"RTN","SAMICSV",358,0)
 ;@output = file name for site/form
"RTN","SAMICSV",359,0)
 ;@tests [tbd]
"RTN","SAMICSV",360,0)
 ;
"RTN","SAMICSV",361,0)
 ;
"RTN","SAMICSV",362,0)
FNAME(SITE,FORM) ; extrinsic returns the filename for the site/form
"RTN","SAMICSV",363,0)
 ;
"RTN","SAMICSV",364,0)
 quit SITE_"-"_FORM_"-"_$$FMTHL7^XLFDT($$HTFM^XLFDT($H))_".csv" ; end of $$FNAME
"RTN","SAMICSV",365,0)
 ;
"RTN","SAMICSV",366,0)
 ;
"RTN","SAMICSV",367,0)
 ;
"RTN","SAMICSV",368,0)
 ;
"RTN","SAMICSV",369,0)
 ;@proc-code DDICT^SAMICSV
"RTN","SAMICSV",370,0)
 ;
"RTN","SAMICSV",371,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICSV",372,0)
 ;
"RTN","SAMICSV",373,0)
 ;ven/gpl;private;procedure;clean;silent;sac;??% tests;port?
"RTN","SAMICSV",374,0)
 ;@called-by
"RTN","SAMICSV",375,0)
 ; ONEFORM^SAMICSV
"RTN","SAMICSV",376,0)
 ;@calls
"RTN","SAMICSV",377,0)
 ; $$setroot^%wd
"RTN","SAMICSV",378,0)
 ;@input
"RTN","SAMICSV",379,0)
 ; RTN = output array name, closed reference
"RTN","SAMICSV",380,0)
 ; FORM = form whose DD should be returned in @RTN
"RTN","SAMICSV",381,0)
 ;@output
"RTN","SAMICSV",382,0)
 ; @RTN: DD for FORM
"RTN","SAMICSV",383,0)
 ;@tests [tbd]
"RTN","SAMICSV",384,0)
 ;
"RTN","SAMICSV",385,0)
 ;
"RTN","SAMICSV",386,0)
DDICT(RTN,FORM) ; data dictionary for FORM
"RTN","SAMICSV",387,0)
 ;
"RTN","SAMICSV",388,0)
 ;@stanza 2 identify form
"RTN","SAMICSV",389,0)
 ;
"RTN","SAMICSV",390,0)
 K @RTN
"RTN","SAMICSV",391,0)
 ;
"RTN","SAMICSV",392,0)
 N USEGR S USEGR=""
"RTN","SAMICSV",393,0)
 I FORM="siform" S USEGR="form fields - intake"
"RTN","SAMICSV",394,0)
 I FORM="sbform" S USEGR="form fields - background"
"RTN","SAMICSV",395,0)
 I FORM="ceform" S USEGR="form fields - ct evaluation"
"RTN","SAMICSV",396,0)
 I FORM="fuform" S USEGR="form fields - follow up"
"RTN","SAMICSV",397,0)
 I FORM="bxform" S USEGR="form fields - biopsy"
"RTN","SAMICSV",398,0)
 I FORM="itform" S USEGR="form fields - intervention"
"RTN","SAMICSV",399,0)
 I FORM="ptform" S USEGR="form fields - pet evaluation"
"RTN","SAMICSV",400,0)
 Q:USEGR=""
"RTN","SAMICSV",401,0)
 ;
"RTN","SAMICSV",402,0)
 ;
"RTN","SAMICSV",403,0)
 ;@stanza 3 get DD
"RTN","SAMICSV",404,0)
 ;
"RTN","SAMICSV",405,0)
 N root s root=$$setroot^%wd(USEGR)
"RTN","SAMICSV",406,0)
 Q:$g(root)=""
"RTN","SAMICSV",407,0)
 ;
"RTN","SAMICSV",408,0)
 N II S II=0
"RTN","SAMICSV",409,0)
 f  s II=$o(@root@("field",II)) q:+II=0  d  ;
"RTN","SAMICSV",410,0)
 . s @RTN@(II)=$g(@root@("field",II,"input",1,"name"))
"RTN","SAMICSV",411,0)
 . q
"RTN","SAMICSV",412,0)
 ;
"RTN","SAMICSV",413,0)
 ;
"RTN","SAMICSV",414,0)
 ;@stanza 4 termination
"RTN","SAMICSV",415,0)
 ;
"RTN","SAMICSV",416,0)
 quit  ; end of DDICT
"RTN","SAMICSV",417,0)
 ;
"RTN","SAMICSV",418,0)
 ;
"RTN","SAMICSV",419,0)
 ;
"RTN","SAMICSV",420,0)
 ;
"RTN","SAMICSV",421,0)
 ;^%wd(17.040801,"B","form fields - background",437)=""
"RTN","SAMICSV",422,0)
 ;^%wd(17.040801,"B","form fields - biopsy",438)=""
"RTN","SAMICSV",423,0)
 ;^%wd(17.040801,"B","form fields - ct evaluation",439)=""
"RTN","SAMICSV",424,0)
 ;^%wd(17.040801,"B","form fields - follow up",440)=""
"RTN","SAMICSV",425,0)
 ;^%wd(17.040801,"B","form fields - follow-up",359)=""
"RTN","SAMICSV",426,0)
 ;^%wd(17.040801,"B","form fields - intake",491)=""
"RTN","SAMICSV",427,0)
 ;^%wd(17.040801,"B","form fields - intervention",442)=""
"RTN","SAMICSV",428,0)
 ;^%wd(17.040801,"B","form fields - pet evaluation",443)=""
"RTN","SAMICSV",429,0)
 ;
"RTN","SAMICSV",430,0)
 ;
"RTN","SAMICSV",431,0)
 ;
"RTN","SAMICSV",432,0)
EOR ; end of routine SAMICSV
"RTN","SAMICUL")
0^10^B145904
"RTN","SAMICUL",1,0)
SAMICUL ;ven/gpl - case review log; 2024-08-22t21:07z
"RTN","SAMICUL",2,0)
 ;;18.0;SAMI;**9,11,12,14,15,17**;2020-01-17;Build 8
"RTN","SAMICUL",3,0)
 ;mdc-e1;SAMICUL-20240822-E032a5Qq;SAMI-18-17-b6
"RTN","SAMICUL",4,0)
 ;mdc-v7;B145904;SAMI*18.0*17 SEQ #17
"RTN","SAMICUL",5,0)
 ;
"RTN","SAMICUL",6,0)
 ; SAMICUL contains the development log for the ScreeningPlus Case
"RTN","SAMICUL",7,0)
 ; Review Page (SAMICA* routines). It contains no executable code.
"RTN","SAMICUL",8,0)
 ;
"RTN","SAMICUL",9,0)
 quit  ; no entry from top
"RTN","SAMICUL",10,0)
 ;
"RTN","SAMICUL",11,0)
 ;
"RTN","SAMICUL",12,0)
 ;
"RTN","SAMICUL",13,0)
 ;
"RTN","SAMICUL",14,0)
 ;@section 0 primary development
"RTN","SAMICUL",15,0)
 ;
"RTN","SAMICUL",16,0)
 ;
"RTN","SAMICUL",17,0)
 ;
"RTN","SAMICUL",18,0)
 ;
"RTN","SAMICUL",19,0)
 ;@routine-credits
"RTN","SAMICUL",20,0)
 ;
"RTN","SAMICUL",21,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMICUL",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICUL",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMICUL",24,0)
 ; http://vistaexpertise.net
"RTN","SAMICUL",25,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMICUL",26,0)
 ;@license see routine SAMIUL
"RTN","SAMICUL",27,0)
 ;
"RTN","SAMICUL",28,0)
 ;@update 2024-08-22t21:07z
"RTN","SAMICUL",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMICUL",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMICUL",31,0)
 ;@module case review - SAMICA
"RTN","SAMICUL",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMICUL",33,0)
 ;@release SAMI-18-17
"RTN","SAMICUL",34,0)
 ;@edition-date 2022-08
"RTN","SAMICUL",35,0)
 ;@patches **9,11,12,14,15,17**
"RTN","SAMICUL",36,0)
 ;
"RTN","SAMICUL",37,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMICUL",38,0)
 ; toad@vistaexpertise.net
"RTN","SAMICUL",39,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMICUL",40,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMICUL",41,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMICUL",42,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMICUL",43,0)
 ;@dev-add Domenick DiNatale (ddn)
"RTN","SAMICUL",44,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMICUL",45,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMICUL",46,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICUL",47,0)
 ;
"RTN","SAMICUL",48,0)
 ;@module-credits
"RTN","SAMICUL",49,0)
 ;
"RTN","SAMICUL",50,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICUL",51,0)
 ; (VA-PALS)
"RTN","SAMICUL",52,0)
 ; http://va-pals.org/
"RTN","SAMICUL",53,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICUL",54,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICUL",55,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICUL",56,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICUL",57,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMICUL",58,0)
 ; http://ielcap.com/
"RTN","SAMICUL",59,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICUL",60,0)
 ; http://paraxialtech.com/
"RTN","SAMICUL",61,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICUL",62,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICUL",63,0)
 ;
"RTN","SAMICUL",64,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMICUL",65,0)
 ; https://www.ielcap-airs.org
"RTN","SAMICUL",66,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMICUL",67,0)
 ;@partner-org par
"RTN","SAMICUL",68,0)
 ;
"RTN","SAMICUL",69,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICUL",70,0)
 ;
"RTN","SAMICUL",71,0)
 ; 2018-01-14 ven/gpl 18-t4
"RTN","SAMICUL",72,0)
 ;  SAMICASE split from routine SAMIFRM, incl wsCASE,GETTMPL,GETITEMS,
"RTN","SAMICUL",73,0)
 ; casetbl.
"RTN","SAMICUL",74,0)
 ;
"RTN","SAMICUL",75,0)
 ; 2018-02-05/08 ven/toad 18-t4
"RTN","SAMICUL",76,0)
 ;  SAMICASE update style, license, & attribution, spell out language
"RTN","SAMICUL",77,0)
 ; elements, add white space & do-dot quits, r/replaceAll^%wfhfrom w/
"RTN","SAMICUL",78,0)
 ; replaceAll^%wf, r/$$getTemplate^%wfhform w/$$getTemplate^%wf.
"RTN","SAMICUL",79,0)
 ;
"RTN","SAMICUL",80,0)
 ; 2018-02-14 ven/toad 18-t4
"RTN","SAMICUL",81,0)
 ;  SAMICASE r/replaceAll^%wf w/findReplaceAll^%wf, r/ln w/line, add
"RTN","SAMICUL",82,0)
 ; @calls & @called-by tags, break up some long lines.
"RTN","SAMICUL",83,0)
 ;
"RTN","SAMICUL",84,0)
 ; 2018-02-27 ven/gpl 18-t4
"RTN","SAMICUL",85,0)
 ;  SAMICASE new subroutines $$KEY2DSPD, $$GETDTKEY; in wsCASE get
"RTN","SAMICUL",86,0)
 ; 1st & last names from graph, fix paths, key forms in graph w/date.
"RTN","SAMICUL",87,0)
 ;
"RTN","SAMICUL",88,0)
 ; 2018-03-01 ven/toad 18-t4
"RTN","SAMICUL",89,0)
 ;  SAMICASE refactor & reorganize new code, add header comments, r/
"RTN","SAMICUL",90,0)
 ; findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",91,0)
 ;
"RTN","SAMICUL",92,0)
 ; 2018-03-06 ven/gpl 18-t4
"RTN","SAMICUL",93,0)
 ;  SAMICASE add New Form button, list rest of forms for patient, add
"RTN","SAMICUL",94,0)
 ; web services wsNuForm & wsNuFormPost & method MKCEFORM, extend
"RTN","SAMICUL",95,0)
 ; GETITEMS to get rest of forms.
"RTN","SAMICUL",96,0)
 ;
"RTN","SAMICUL",97,0)
 ; 2018-03-07/08 ven/toad 18-t4
"RTN","SAMICUL",98,0)
 ;  SAMICASE merge George changes w/ rest, add white space, spell out
"RTN","SAMICUL",99,0)
 ; M elements, add hdr comments to new subroutines, r/findReplace^%wf
"RTN","SAMICUL",100,0)
 ; & replaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",101,0)
 ;
"RTN","SAMICUL",102,0)
 ; 2018-03-11 ven/gpl 18-t4 9bd663ee
"RTN","SAMICUL",103,0)
 ;  SAMICAS2 vapals forms working.
"RTN","SAMICUL",104,0)
 ;
"RTN","SAMICUL",105,0)
 ; 2018-03-12 ven/gpl 18-t4 8c36c6a7
"RTN","SAMICUL",106,0)
 ;  SAMICAS2 new form works now & charts on home page.
"RTN","SAMICUL",107,0)
 ;
"RTN","SAMICUL",108,0)
 ; 2018-03-14 ven/gpl 18-t4 9653650a
"RTN","SAMICUL",109,0)
 ;  SAMICAS2 revised casereview page link, fixed external url
"RTN","SAMICUL",110,0)
 ; preservation.
"RTN","SAMICUL",111,0)
 ;
"RTN","SAMICUL",112,0)
 ; 2018-03-21 ven/gpl 18-t4 48868561
"RTN","SAMICUL",113,0)
 ;  SAMICAS2 max date insertion, case review navigation changed to
"RTN","SAMICUL",114,0)
 ; post, date order for CT Eval in case review.
"RTN","SAMICUL",115,0)
 ;
"RTN","SAMICUL",116,0)
 ; 2018-03-26 ven/gpl 18-t4 5fa4ee96
"RTN","SAMICUL",117,0)
 ;  SAMICAS2 changes to support incomplete forms display &
"RTN","SAMICUL",118,0)
 ; processing.
"RTN","SAMICUL",119,0)
 ;
"RTN","SAMICUL",120,0)
 ; 2018-03-27 ven/gpl 18-t4 cace9756
"RTN","SAMICUL",121,0)
 ;  SAMICAS2 siforms are always complete.
"RTN","SAMICUL",122,0)
 ;
"RTN","SAMICUL",123,0)
 ; 2018-04-02 ven/gpl 18-t4 00da9146
"RTN","SAMICUL",124,0)
 ;  SAMICAS2 added followup form.
"RTN","SAMICUL",125,0)
 ;
"RTN","SAMICUL",126,0)
 ; 2018-04-24 ven/gpl 18-t4 22e39d87
"RTN","SAMICUL",127,0)
 ;  SAMICAS2 added pet & biopsy forms.
"RTN","SAMICUL",128,0)
 ;
"RTN","SAMICUL",129,0)
 ; 2018-05-01 ven/gpl 18-t4 f1751c43
"RTN","SAMICUL",130,0)
 ;  SAMICAS2 fix problem with new forms: followup & pet.
"RTN","SAMICUL",131,0)
 ;
"RTN","SAMICUL",132,0)
 ; 2018-05-18 ven/lgc 18-t4 9eba8f8c
"RTN","SAMICUL",133,0)
 ;  SAMICAS2 conversion to new graph and simplified forms processing.
"RTN","SAMICUL",134,0)
 ;
"RTN","SAMICUL",135,0)
 ; 2018-05-21 ven/lgc 18-t4 0d7ed2f7
"RTN","SAMICUL",136,0)
 ;  SAMICAS2 changes for new navigation html.
"RTN","SAMICUL",137,0)
 ;
"RTN","SAMICUL",138,0)
 ; 2018-06-14 ven/lgc 18-t4 d71f4fe4
"RTN","SAMICUL",139,0)
 ;  SAMICAS2 changes to make the background form optional.
"RTN","SAMICUL",140,0)
 ;
"RTN","SAMICUL",141,0)
 ; 2018-06-20 ven/lgc 18-t4 bf03b07f
"RTN","SAMICUL",142,0)
 ;  SAMICAS2 corrections for new forms processing navigation.
"RTN","SAMICUL",143,0)
 ;
"RTN","SAMICUL",144,0)
 ; 2018-07-01 ven/lgc 18-t4 2e1541dc,8b0a4329
"RTN","SAMICUL",145,0)
 ;  SAMICAS2 add intervention forms to case review page, 1st version
"RTN","SAMICUL",146,0)
 ; of ct eval report.
"RTN","SAMICUL",147,0)
 ;
"RTN","SAMICUL",148,0)
 ; 2018-07-04 ven/lgc 18-t4 b28c1658
"RTN","SAMICUL",149,0)
 ;  SAMICAS2 fix a typo.
"RTN","SAMICUL",150,0)
 ;
"RTN","SAMICUL",151,0)
 ; 2018-07-10 ven/lgc 18-t4 2e9662b4
"RTN","SAMICUL",152,0)
 ;  SAMICAS2 repair SAMIHOM3 & redact report link.
"RTN","SAMICUL",153,0)
 ;
"RTN","SAMICUL",154,0)
 ; 2018-08-19 ven/lgc 18-t4 2ce0cab4
"RTN","SAMICUL",155,0)
 ;  SAMICAS2 use ssn instead of last5 where available.
"RTN","SAMICUL",156,0)
 ;
"RTN","SAMICUL",157,0)
 ; 2018-08-20 ven/lgc 18-t4 955fd484
"RTN","SAMICUL",158,0)
 ;  SAMICAS2 fix case review page cr lf issue.
"RTN","SAMICUL",159,0)
 ;
"RTN","SAMICUL",160,0)
 ; 2018-08-22 ven/gpl 18-t4 d67a2fe5
"RTN","SAMICUL",161,0)
 ;  SAMICAS2 turn off ctreport.
"RTN","SAMICUL",162,0)
 ;
"RTN","SAMICUL",163,0)
 ; 2018-08-30 ven/lgc 18-t4 125f1c8b
"RTN","SAMICUL",164,0)
 ;  SAMICAS2 add type index to getItems to help find last previous
"RTN","SAMICUL",165,0)
 ; form of a type.
"RTN","SAMICUL",166,0)
 ;
"RTN","SAMICUL",167,0)
 ; 2018-09-04 ven/lgc 18-t4 3e6e326f
"RTN","SAMICUL",168,0)
 ;  SAMICAS2 hide report link.
"RTN","SAMICUL",169,0)
 ;
"RTN","SAMICUL",170,0)
 ; 2018-10-14 ven/lgc 18-t4 f6e1229f
"RTN","SAMICUL",171,0)
 ;  SAMICAS2 turn on copy forward for cteval new forms.
"RTN","SAMICUL",172,0)
 ;
"RTN","SAMICUL",173,0)
 ; 2018-10-26 ven/lgc 18-t4 f19bf1ae
"RTN","SAMICUL",174,0)
 ;  SAMICAS2 ability to add multiple forms on same day.
"RTN","SAMICUL",175,0)
 ;
"RTN","SAMICUL",176,0)
 ; 2018-11-07 ven/gpl 18-t4 c76b2eac
"RTN","SAMICUL",177,0)
 ;  SAMICAS2 defend against unit test patient 1.
"RTN","SAMICUL",178,0)
 ;
"RTN","SAMICUL",179,0)
 ; 2018-11-13 ven/toad 18-t4
"RTN","SAMICUL",180,0)
 ;  SAMICAS2 SAMIHOM2 > SAMIHOM3.
"RTN","SAMICUL",181,0)
 ;
"RTN","SAMICUL",182,0)
 ; 2018-11-14 ven/lgc 18-t4 6e9799ba
"RTN","SAMICUL",183,0)
 ;  SAMICUL fix graphstore forms.
"RTN","SAMICUL",184,0)
 ;
"RTN","SAMICUL",185,0)
 ; 2018-11-28 ven/lgc 18-t4 a9539464
"RTN","SAMICUL",186,0)
 ;  SAMICAS2 work on sac compliance.
"RTN","SAMICUL",187,0)
 ;
"RTN","SAMICUL",188,0)
 ; 2018-12-11 ven/lgc 18-t4 3ceb74b5
"RTN","SAMICUL",189,0)
 ;  SAMICAS2 update for sac compliance.
"RTN","SAMICUL",190,0)
 ;
"RTN","SAMICUL",191,0)
 ; 2018-12-19/20 ven/lgc 18-t4 7a5d3400,a14554c1
"RTN","SAMICUL",192,0)
 ;  SAMICAS2 more sac compliance, r/^gpl w/^SAMIGPL.
"RTN","SAMICUL",193,0)
 ;
"RTN","SAMICUL",194,0)
 ; 2018-12-26 ven/lgc 18-t4 8dd6f34d,51eb1635
"RTN","SAMICUL",195,0)
 ;  SAMICAS2 update for sac compliance, fix accidental reversions.
"RTN","SAMICUL",196,0)
 ;
"RTN","SAMICUL",197,0)
 ; 2019-01-10 ven/lgc 18-t4 2daba010
"RTN","SAMICUL",198,0)
 ;  SAMICAS2 update for SAC compliance.
"RTN","SAMICUL",199,0)
 ;
"RTN","SAMICUL",200,0)
 ; 2019-01-22 ven/lgc 18-t4 53681219,5ddb29c5
"RTN","SAMICUL",201,0)
 ;  SAMICAS2 add license info to each SAMI routine; edit for lower
"RTN","SAMICUL",202,0)
 ; case initials.
"RTN","SAMICUL",203,0)
 ;
"RTN","SAMICUL",204,0)
 ; 2019-02-18 ven/lgc 18-t4 76874314
"RTN","SAMICUL",205,0)
 ;  SAMICAS2,SAMICAS3 update recently edited routines.
"RTN","SAMICUL",206,0)
 ;
"RTN","SAMICUL",207,0)
 ; 2019-03-13 ven/lmry 18-t4 ef66ef16
"RTN","SAMICUL",208,0)
 ;  SAMICAS2 spell out some elements missed earlier.
"RTN","SAMICUL",209,0)
 ;
"RTN","SAMICUL",210,0)
 ; 2019-03-14 ven/lmry 18-t4 038507e2
"RTN","SAMICUL",211,0)
 ;  SAMICAS3 spell out some missed M elements, fix copy/paste errors
"RTN","SAMICUL",212,0)
 ; in comments for MKFUFORM, MKBXFORM, & MKPTFORM.
"RTN","SAMICUL",213,0)
 ;
"RTN","SAMICUL",214,0)
 ; 2019-04-16 ven/lgc 18-t4 e54b76d1
"RTN","SAMICUL",215,0)
 ;  SAMICAS2 update for SAMIFORM project.
"RTN","SAMICUL",216,0)
 ;
"RTN","SAMICUL",217,0)
 ; 2019-04-23 ven/gpl 18-t4 ce322911
"RTN","SAMICUL",218,0)
 ;  SAMICAS2 add intake notes to case review page.
"RTN","SAMICUL",219,0)
 ;
"RTN","SAMICUL",220,0)
 ; 2019-06-18 ven/lgc 18-t4 91022482
"RTN","SAMICUL",221,0)
 ;  SAMICAS3 switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMICUL",222,0)
 ;
"RTN","SAMICUL",223,0)
 ; 2019-07-01 ven/gpl 18-t4 cc87cc44
"RTN","SAMICUL",224,0)
 ;  SAMICAS3 prevent >1 bkgd form/patient.
"RTN","SAMICUL",225,0)
 ;
"RTN","SAMICUL",226,0)
 ; 2019-07-07 ven/gpl 18-t4 776f7451
"RTN","SAMICUL",227,0)
 ;  SAMICAS3 resolving can't create bkgd form, branch messed up.
"RTN","SAMICUL",228,0)
 ;
"RTN","SAMICUL",229,0)
 ; 2019-08-01 ven/lgc 18-t4 d710f27d
"RTN","SAMICUL",230,0)
 ;  SAMICAS2 pull displayed facility code from Vista parameter.
"RTN","SAMICUL",231,0)
 ;
"RTN","SAMICUL",232,0)
 ; 2019-09-26 ven/gpl 18-t4 92b12324 vap-420
"RTN","SAMICUL",233,0)
 ;  SAMICAS3 prefill form date & date of baseline ct on new followup
"RTN","SAMICUL",234,0)
 ; form.
"RTN","SAMICUL",235,0)
 ;
"RTN","SAMICUL",236,0)
 ; 2019-10-01 par/ddn 18-t4 4caf1a98 vap-344
"RTN","SAMICUL",237,0)
 ;  SAMICAS2 use proper capitalization of the word "veteran".
"RTN","SAMICUL",238,0)
 ;
"RTN","SAMICUL",239,0)
 ; 2020-01-11 ven/lgc 18-1 5651698a
"RTN","SAMICUL",240,0)
 ;  SAMICAS2,SAMICAS3 fix duplicate form overwriting.
"RTN","SAMICUL",241,0)
 ;
"RTN","SAMICUL",242,0)
 ; 2020-01-17 ven/lgc 18-1 8557207f
"RTN","SAMICUL",243,0)
 ;  SAMICAS2 followup note.
"RTN","SAMICUL",244,0)
 ;
"RTN","SAMICUL",245,0)
 ; 2020-01-25 ven/lgc 18-3 6a07a860,6a947567
"RTN","SAMICUL",246,0)
 ;  SAMICAS3 nodule copy & fix to ru, fix subtle bug in nodule copy.
"RTN","SAMICUL",247,0)
 ;
"RTN","SAMICUL",248,0)
 ; 2020-04-11 ven/gpl 18-5 666f5b91,2f2c29c1
"RTN","SAMICUL",249,0)
 ;  SAMICAS2 multi-tenancy.
"RTN","SAMICUL",250,0)
 ;
"RTN","SAMICUL",251,0)
 ; 2020-05-12 ven/gpl 18-5 ad11e0ea
"RTN","SAMICUL",252,0)
 ;  SAMICAS2 fix SITE on case review page.
"RTN","SAMICUL",253,0)
 ;
"RTN","SAMICUL",254,0)
 ; 2020-11-12 ven/gpl 18-9 cec1ccd6
"RTN","SAMICUL",255,0)
 ;  SAMICAS2,SAMICAS3 ceform date refill upgrade.
"RTN","SAMICUL",256,0)
 ;
"RTN","SAMICUL",257,0)
 ; 2020-11-13 ven/gpl 18-9 dce3c568
"RTN","SAMICUL",258,0)
 ;  SAMICAS3 prefill ceform prior scans text field.
"RTN","SAMICUL",259,0)
 ;
"RTN","SAMICUL",260,0)
 ; 2021-02-18 ven/gpl 18-9 af2a0b8a
"RTN","SAMICUL",261,0)
 ;  SAMICAS3 copy last previous CT nodules instead of last nodules in
"RTN","SAMICUL",262,0)
 ; any form.
"RTN","SAMICUL",263,0)
 ;
"RTN","SAMICUL",264,0)
 ; 2021-02-21 ven/gpl 18-9 3fd704fb
"RTN","SAMICUL",265,0)
 ;  SAMICAS3 fix bug in prefill logic.
"RTN","SAMICUL",266,0)
 ;
"RTN","SAMICUL",267,0)
 ; 2021-03-02 ven/gpl 18-9 479dc041
"RTN","SAMICUL",268,0)
 ;  SAMICAS2 return error msg if no CT Eval form exists when
"RTN","SAMICUL",269,0)
 ; generating a FU note.
"RTN","SAMICUL",270,0)
 ;
"RTN","SAMICUL",271,0)
 ; 2021-03-10 ven/toad 18-9 a46a2cc1
"RTN","SAMICUL",272,0)
 ;  SAMICUL update log, convert to new vistaver schema.
"RTN","SAMICUL",273,0)
 ;  SAMICAS2,SAMICAS3 bump date & patch list, update contents, lt
"RTN","SAMICUL",274,0)
 ; refactor.
"RTN","SAMICUL",275,0)
 ;
"RTN","SAMICUL",276,0)
 ; 2021-03-17 ven/toad 18-9 62da30b
"RTN","SAMICUL",277,0)
 ;  SAMICAS2 fix xindex errors: in WSCASE add missing space between
"RTN","SAMICUL",278,0)
 ; do & comment to prevent syntax error reported as block mismatch.
"RTN","SAMICUL",279,0)
 ;  SAMICAS3 remove extra spaces at ends of 3 lines.
"RTN","SAMICUL",280,0)
 ;
"RTN","SAMICUL",281,0)
 ; 2021-04-16 ven/gpl 18-11 ac82eec
"RTN","SAMICUL",282,0)
 ;  SAMICAS3 include baseline scan in prior scans field on prefill.
"RTN","SAMICUL",283,0)
 ;
"RTN","SAMICUL",284,0)
 ; 2021-05-14/19 ven/gpl 18-11 0cbee7b,a21b056,139c6a5,0a0cccc
"RTN","SAMICUL",285,0)
 ;  SAMICAS3 improved CT eval prefill of past scan dates, urgent
"RTN","SAMICUL",286,0)
 ; fixes to CT Report & intervention & pet form prefill.
"RTN","SAMICUL",287,0)
 ;
"RTN","SAMICUL",288,0)
 ; 2021-05-20/21 ven/mcglk&toad 18-11 43a4557,424ea11,129e96b
"RTN","SAMICUL",289,0)
 ;  SAMICAS3 bump version & dates.
"RTN","SAMICUL",290,0)
 ;
"RTN","SAMICUL",291,0)
 ; 2021-05-24 ven/gpl 18-11 4aba1a9
"RTN","SAMICUL",292,0)
 ;  SAMICAS3 in MKCEFORM,MKPTFORM,MKBXFORM pass key to
"RTN","SAMICUL",293,0)
 ; CTCOPY^SAMICTC1 to modulate node-copy operation; critical fix to
"RTN","SAMICUL",294,0)
 ; copy forward for is it new field for new ct eval forms.
"RTN","SAMICUL",295,0)
 ;
"RTN","SAMICUL",296,0)
 ; 2021-05-25 ven/toad 18-11 801d7c74
"RTN","SAMICUL",297,0)
 ;  SAMICAS3 bump date; passim lt refactor.
"RTN","SAMICUL",298,0)
 ;
"RTN","SAMICUL",299,0)
 ; 2021-05-26/27 ven/gpl 18-11 6edc0610,73728821
"RTN","SAMICUL",300,0)
 ;  SAMICAS3 in MKITFORM add new nodule-copy block to copy forward
"RTN","SAMICUL",301,0)
 ; for intervention form; in LASTCMP,PRIORCMP init tdt to today to
"RTN","SAMICUL",302,0)
 ; start before today, to fix last comp & prior scan field prefill in
"RTN","SAMICUL",303,0)
 ; ct eval form.
"RTN","SAMICUL",304,0)
 ;
"RTN","SAMICUL",305,0)
 ; 2021-06-01 ven/toad 18-11 7dd9410c
"RTN","SAMICUL",306,0)
 ;  SAMICAS3 fold in gpl chgs fr 2021-05-26/27, annotate, adjust news
"RTN","SAMICUL",307,0)
 ; in nodule copy blocks, bump date.
"RTN","SAMICUL",308,0)
 ;
"RTN","SAMICUL",309,0)
 ; 2021-06-29 ven/gpl 18-12 50d3998b,a5bbd37a
"RTN","SAMICUL",310,0)
 ;  SAMICAS3 in LASTCMP fix bug that excluded ct forms from today in
"RTN","SAMICUL",311,0)
 ; date list, init tdt to today+1 to start today; text-box formatting
"RTN","SAMICUL",312,0)
 ; for intake & followup notes, new text-processing utils; in MKFUFORM
"RTN","SAMICUL",313,0)
 ; set basedt to $$BASELNDT or $$LASTCMP or now.
"RTN","SAMICUL",314,0)
 ;
"RTN","SAMICUL",315,0)
 ; 2021-06-30/07-06 ven/mcglk&toad&gpl 18-12 cbf7e46b,d8296fda,
"RTN","SAMICUL",316,0)
 ; b248664b
"RTN","SAMICUL",317,0)
 ;  SAMICASE,2,3 bump version & dates.
"RTN","SAMICUL",318,0)
 ;  SAMICAS3 in MKFUFORM,LASTCMP update calls & called-by.
"RTN","SAMICUL",319,0)
 ;  SAMICASE,2,3 finish converting to ppi format, annotate; fix typos.
"RTN","SAMICUL",320,0)
 ;
"RTN","SAMICUL",321,0)
 ; 2021-08-01 ven/gpl 18-12 5bd7c627,50620b8b
"RTN","SAMICUL",322,0)
 ;  SAMICAS2 set intake form to incomplete on creation: in GSAMISTA
"RTN","SAMICUL",323,0)
 ; add final line to conditionally set stat="incomplete".
"RTN","SAMICUL",324,0)
 ;  SAMICAS3 exclude current date from last compare field when prev ct
"RTN","SAMICUL",325,0)
 ; report exists: in LASTCMP start w/before today; in PRIORCMP add
"RTN","SAMICUL",326,0)
 ; line to handle retstr="".
"RTN","SAMICUL",327,0)
 ;
"RTN","SAMICUL",328,0)
 ; 2021-10-04/05 ven/gpl&lmry 18-14 ec3b6e5d,d4d1b115
"RTN","SAMICUL",329,0)
 ;  SAMICAS2 updated date format, bumped date and version.
"RTN","SAMICUL",330,0)
 ;
"RTN","SAMICUL",331,0)
 ; 2021-10-26 ven/gpl 18-15 23e68f40
"RTN","SAMICUL",332,0)
 ;  SAMICAS3 init last comparitive & prior scan fields to blank if
"RTN","SAMICUL",333,0)
 ; there were none.
"RTN","SAMICUL",334,0)
 ;
"RTN","SAMICUL",335,0)
 ; 2024-07-24 ven/gpl 18-17-b5 fefbf29
"RTN","SAMICUL",336,0)
 ;  SAMICAS3 changes for Mt. Sinai MRN & STUDYID.
"RTN","SAMICUL",337,0)
 ;
"RTN","SAMICUL",338,0)
 ; 2024-07-25 ven/gpl 18-17-b5 21f8aa1
"RTN","SAMICUL",339,0)
 ;  SAMICAS4 new routine to generate Mt. Sinai clinical info line to
"RTN","SAMICUL",340,0)
 ; carry over to CTEVAL from Background form.
"RTN","SAMICUL",341,0)
 ;
"RTN","SAMICUL",342,0)
 ; 2024-07-25 ven/gpl 18-17-b5 2e91afbf
"RTN","SAMICUL",343,0)
 ;  SAMICAS4 progress on clinical info for cteval form.
"RTN","SAMICUL",344,0)
 ;
"RTN","SAMICUL",345,0)
 ; 2024-07-28 ven/gpl 18-17-b5 386103d
"RTN","SAMICUL",346,0)
 ;  SAMICAS4 background form clinic info text extract for cteval form
"RTN","SAMICUL",347,0)
 ; complete.
"RTN","SAMICUL",348,0)
 ;
"RTN","SAMICUL",349,0)
 ; 2024-08-03 ven/gpl 18-17-b5 2524afd
"RTN","SAMICUL",350,0)
 ;  SAMICAS4 add # years since quitting to clinical info string.
"RTN","SAMICUL",351,0)
 ;
"RTN","SAMICUL",352,0)
 ; 2024-08-05 ven/gpl 18-17-b5 b92768b
"RTN","SAMICUL",353,0)
 ;  SAMICAS4 add space after ';' in clinical info text of CT form.
"RTN","SAMICUL",354,0)
 ;
"RTN","SAMICUL",355,0)
 ; 2024-08-06 ven/gpl 18-17-b5 8e2a78f
"RTN","SAMICUL",356,0)
 ;  SAMICAS4 preserve clinical info from background form to CTEVAL.
"RTN","SAMICUL",357,0)
 ;
"RTN","SAMICUL",358,0)
 ; 2024-08-12 ven/lmry 18-17-b5
"RTN","SAMICUL",359,0)
 ;  SAMICUL update history
"RTN","SAMICUL",360,0)
 ;  SAMICAS3,4,UL bump dates & versions.
"RTN","SAMICUL",361,0)
 ;
"RTN","SAMICUL",362,0)
 ; 2024-18-17 ven/lmry 18-17-b6
"RTN","SAMICUL",363,0)
 ;  SAMICUL update history
"RTN","SAMICUL",364,0)
 ;  SAMICAS3,4,UL bump dates & versions, 18-18-t1 > 18-17-b6.
"RTN","SAMICUL",365,0)
 ;
"RTN","SAMICUL",366,0)
 ; 2024-08-21/22 ven/toad 18-17-b6
"RTN","SAMICUL",367,0)
 ;  SAMICAS3,4 reorganize subroutines, annotate, move the following
"RTN","SAMICUL",368,0)
 ; SAMICAS3 subroutines to SAMICAS4 to meet VA SAC routine-size limit:
"RTN","SAMICUL",369,0)
 ; BASELNDT,KEY2DT,PRIORCMP,SORTFRMS.
"RTN","SAMICUL",370,0)
 ;  SAMICUL update history.
"RTN","SAMICUL",371,0)
 ;  SAMICAS3,4,UL update version-control lines, hdr comments.
"RTN","SAMICUL",372,0)
 ;
"RTN","SAMICUL",373,0)
 ;@to-do
"RTN","SAMICUL",374,0)
 ; finish converting SAMICAS* subroutines to service architecture
"RTN","SAMICUL",375,0)
 ;  convert calls to use SAMICASE
"RTN","SAMICUL",376,0)
 ;  update unit tests to match
"RTN","SAMICUL",377,0)
 ;
"RTN","SAMICUL",378,0)
 ;@contents
"RTN","SAMICUL",379,0)
 ;
"RTN","SAMICUL",380,0)
 ; SAMICASE case review
"RTN","SAMICUL",381,0)
 ; SAMICAS2 case review continued
"RTN","SAMICUL",382,0)
 ; SAMICAS3 case review continued
"RTN","SAMICUL",383,0)
 ; SAMICAS4 case review subroutine library
"RTN","SAMICUL",384,0)
 ; SAMICUL case review log
"RTN","SAMICUL",385,0)
 ; SAMIUTS2 case review tests
"RTN","SAMICUL",386,0)
 ;
"RTN","SAMICUL",387,0)
 ;
"RTN","SAMICUL",388,0)
 ;
"RTN","SAMICUL",389,0)
EOR ; end of routine SAMICUL
"RTN","SAMIDCM1")
0^11^B200371935
"RTN","SAMIDCM1",1,0)
SAMIDCM1 ;ven/gpl - import patient from siemens ai; 2024-08-22t21:08z
"RTN","SAMIDCM1",2,0)
 ;;18.0;SAMI;**16,17**;2020-01-17;Build 8
"RTN","SAMIDCM1",3,0)
 ;mdc-e1;SAMIDCM1-20240822-E03FkMtt;SAMI-18-17-b6
"RTN","SAMIDCM1",4,0)
 ;mdc-v7;B200371935;SAMI*18.0*17 SEQ #17
"RTN","SAMIDCM1",5,0)
 ;
"RTN","SAMIDCM1",6,0)
 ; SAMIDCMa contains services to support importing a patient into
"RTN","SAMIDCM1",7,0)
 ; ScreeningPlus from the Siemens AI.
"RTN","SAMIDCM1",8,0)
 ;
"RTN","SAMIDCM1",9,0)
 quit  ; no entry from top
"RTN","SAMIDCM1",10,0)
 ;
"RTN","SAMIDCM1",11,0)
 ;@license: see routine SAMIUL
"RTN","SAMIDCM1",12,0)
 ;
"RTN","SAMIDCM1",13,0)
 ;
"RTN","SAMIDCM1",14,0)
 ;
"RTN","SAMIDCM1",15,0)
 ;
"RTN","SAMIDCM1",16,0)
 ;@section 0 primary development
"RTN","SAMIDCM1",17,0)
 ;
"RTN","SAMIDCM1",18,0)
 ;
"RTN","SAMIDCM1",19,0)
 ;
"RTN","SAMIDCM1",20,0)
 ;
"RTN","SAMIDCM1",21,0)
 ;@routine-credits
"RTN","SAMIDCM1",22,0)
 ;
"RTN","SAMIDCM1",23,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIDCM1",24,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIDCM1",25,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIDCM1",26,0)
 ; http://vistaexpertise.net
"RTN","SAMIDCM1",27,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIDCM1",28,0)
 ;@license see routine SAMIUL
"RTN","SAMIDCM1",29,0)
 ;
"RTN","SAMIDCM1",30,0)
 ;@update 2024-08-22t21:08z
"RTN","SAMIDCM1",31,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIDCM1",32,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIDCM1",33,0)
 ;@module Import/Export - variable prefixes
"RTN","SAMIDCM1",34,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIDCM1",35,0)
 ;@release 18-17
"RTN","SAMIDCM1",36,0)
 ;@edition-date 2020-01-17
"RTN","SAMIDCM1",37,0)
 ;@patches **16,17**
"RTN","SAMIDCM1",38,0)
 ;
"RTN","SAMIDCM1",39,0)
 ;@module-credits
"RTN","SAMIDCM1",40,0)
 ;
"RTN","SAMIDCM1",41,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIDCM1",42,0)
 ; (VA-PALS)
"RTN","SAMIDCM1",43,0)
 ; http://va-pals.org/
"RTN","SAMIDCM1",44,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIDCM1",45,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIDCM1",46,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIDCM1",47,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIDCM1",48,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIDCM1",49,0)
 ; http://ielcap.com/
"RTN","SAMIDCM1",50,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIDCM1",51,0)
 ; http://paraxialtech.com/
"RTN","SAMIDCM1",52,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIDCM1",53,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIDCM1",54,0)
 ;
"RTN","SAMIDCM1",55,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIDCM1",56,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIDCM1",57,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIDCM1",58,0)
 ;@partner-org par
"RTN","SAMIDCM1",59,0)
 ;
"RTN","SAMIDCM1",60,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIDCM1",61,0)
 ;
"RTN","SAMIDCM1",62,0)
 ; 2024-08-07 ven/gpl 18-17-b5 b0b3044
"RTN","SAMIDCM1",63,0)
 ;  SAMIDCM1 added web service for sending image transactions.
"RTN","SAMIDCM1",64,0)
 ;
"RTN","SAMIDCM1",65,0)
 ; 2024-08-10 ven/gpl 18-17-b5 dd7c219
"RTN","SAMIDCM1",66,0)
 ;  SAMIDCM1 changes to accept the image json format.
"RTN","SAMIDCM1",67,0)
 ;
"RTN","SAMIDCM1",68,0)
 ; 2024-08-12 ven/lmry 18-17-b5
"RTN","SAMIDCM1",69,0)
 ;  SAMIDCM1 start module-log, bump version & dates.
"RTN","SAMIDCM1",70,0)
 ;
"RTN","SAMIDCM1",71,0)
 ; 2024-08-17 ven/lmry 18-17-b6
"RTN","SAMIDCM1",72,0)
 ;  SAMIDCM1 correct version, bump date.
"RTN","SAMIDCM1",73,0)
 ;
"RTN","SAMIDCM1",74,0)
 ; 2024-08-21/22 ven/toad 18-17-b6
"RTN","SAMIDCM1",75,0)
 ;  SAMIDCM1 update version-control lines, dates, history, annotate;
"RTN","SAMIDCM1",76,0)
 ; getsid>GETSID, normaliz>NORMALIZ.
"RTN","SAMIDCM1",77,0)
 ;
"RTN","SAMIDCM1",78,0)
 ;@to-do enter complete module log
"RTN","SAMIDCM1",79,0)
 ;
"RTN","SAMIDCM1",80,0)
 ;@contents
"RTN","SAMIDCM1",81,0)
 ;
"RTN","SAMIDCM1",82,0)
 ;  1. web services & direct-mode service:
"RTN","SAMIDCM1",83,0)
 ; WSDCMIN web services post dcmin & dcmimgin, receive from addpatient
"RTN","SAMIDCM1",84,0)
 ; WSDCMQ web service get dcmquery, return dcm json
"RTN","SAMIDCM1",85,0)
 ; WSDCMKIL web service get dcmreset, kill all but 1st entry in dcm-intake
"RTN","SAMIDCM1",86,0)
 ; T1 TEST CREATE A JOHN DOE PATIENT
"RTN","SAMIDCM1",87,0)
 ;
"RTN","SAMIDCM1",88,0)
 ;  2. supplementary subroutines:
"RTN","SAMIDCM1",89,0)
 ; $$MATCH match message with an existing record
"RTN","SAMIDCM1",90,0)
 ; $$NORMALIZ normalize the name
"RTN","SAMIDCM1",91,0)
 ; $$nxtdfn next available dfn
"RTN","SAMIDCM1",92,0)
 ;
"RTN","SAMIDCM1",93,0)
 ;  3. unused supplementary subroutines:
"RTN","SAMIDCM1",94,0)
 ; $$GETSID studyid
"RTN","SAMIDCM1",95,0)
 ; IDXDCM index a dcm entry after patient record creation
"RTN","SAMIDCM1",96,0)
 ;
"RTN","SAMIDCM1",97,0)
 ;  4. init subroutine to create web services:
"RTN","SAMIDCM1",98,0)
 ; MKSVC create the web services
"RTN","SAMIDCM1",99,0)
 ;
"RTN","SAMIDCM1",100,0)
 ;
"RTN","SAMIDCM1",101,0)
 ;
"RTN","SAMIDCM1",102,0)
 ;
"RTN","SAMIDCM1",103,0)
 ;@ws WSDCMIN^SAMIDCM1 web services post dcmin & dcmimgin
"RTN","SAMIDCM1",104,0)
 ;
"RTN","SAMIDCM1",105,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",106,0)
 ;
"RTN","SAMIDCM1",107,0)
 ;ven/gpl;ws;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",108,0)
 ;@called-by
"RTN","SAMIDCM1",109,0)
 ; web service post dcmin
"RTN","SAMIDCM1",110,0)
 ; web service post dcmimgin
"RTN","SAMIDCM1",111,0)
 ;@calls
"RTN","SAMIDCM1",112,0)
 ; $$DUZ^SYNDHP69 [commented out]
"RTN","SAMIDCM1",113,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",114,0)
 ; decode^%webjson
"RTN","SAMIDCM1",115,0)
 ; indexFhir [commented out]
"RTN","SAMIDCM1",116,0)
 ; $$NORMALIZ
"RTN","SAMIDCM1",117,0)
 ; $$MATCH^SAMIDCM1
"RTN","SAMIDCM1",118,0)
 ; CREATE^SAMIZPH1
"RTN","SAMIDCM1",119,0)
 ; encode^%webjson
"RTN","SAMIDCM1",120,0)
 ;@input
"RTN","SAMIDCM1",121,0)
 ; ARGS =
"RTN","SAMIDCM1",122,0)
 ; BODY =
"RTN","SAMIDCM1",123,0)
 ; RESULT =
"RTN","SAMIDCM1",124,0)
 ; ien =
"RTN","SAMIDCM1",125,0)
 ;@output [tbd]
"RTN","SAMIDCM1",126,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",127,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",128,0)
 ;
"RTN","SAMIDCM1",129,0)
 ;
"RTN","SAMIDCM1",130,0)
WSDCMIN(ARGS,BODY,RESULT,ien) ; receive from addpatient
"RTN","SAMIDCM1",131,0)
 ;
"RTN","SAMIDCM1",132,0)
 s U="^"
"RTN","SAMIDCM1",133,0)
 ;S DUZ=1
"RTN","SAMIDCM1",134,0)
 ;S DUZ("AG")="V"
"RTN","SAMIDCM1",135,0)
 ;S DUZ(2)=500
"RTN","SAMIDCM1",136,0)
 ;N USER S USER=$$DUZ^SYNDHP69
"RTN","SAMIDCM1",137,0)
 ;
"RTN","SAMIDCM1",138,0)
 new json,root,gr,id,return
"RTN","SAMIDCM1",139,0)
 set root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",140,0)
 if $get(ien)="" do
"RTN","SAMIDCM1",141,0)
 . set ien=$order(@root@(" "),-1)+1
"RTN","SAMIDCM1",142,0)
 . set gr=$name(@root@(ien,"json"))
"RTN","SAMIDCM1",143,0)
 . do decode^%webjson("BODY",gr)
"RTN","SAMIDCM1",144,0)
 . kill BODY ;
"RTN","SAMIDCM1",145,0)
 . q
"RTN","SAMIDCM1",146,0)
 ;
"RTN","SAMIDCM1",147,0)
 ;do indexFhir(ien)
"RTN","SAMIDCM1",148,0)
 ;
"RTN","SAMIDCM1",149,0)
 set site=$get(ARGS("siteid"))
"RTN","SAMIDCM1",150,0)
 if site="" set site="XXX" ; default to test site
"RTN","SAMIDCM1",151,0)
 if site'="" set @root@("SITE",site,ien)="" ;
"RTN","SAMIDCM1",152,0)
 ;
"RTN","SAMIDCM1",153,0)
 ; patient name
"RTN","SAMIDCM1",154,0)
 ;
"RTN","SAMIDCM1",155,0)
 ;
"RTN","SAMIDCM1",156,0)
 n gp s gp=$na(@root@(ien,"json","patient_study_details"))
"RTN","SAMIDCM1",157,0)
 i '$d(@gp) d  ;
"RTN","SAMIDCM1",158,0)
 . s gp=$na(@root@(ien,"patient_details"))
"RTN","SAMIDCM1",159,0)
 . q:$d(@gp)
"RTN","SAMIDCM1",160,0)
 . s gp=$na(@root@(ien,"json"))
"RTN","SAMIDCM1",161,0)
 . q:$d(@gp@("PatientName"))
"RTN","SAMIDCM1",162,0)
 . s return("error")="Missing patient study details"
"RTN","SAMIDCM1",163,0)
 . q
"RTN","SAMIDCM1",164,0)
 ;
"RTN","SAMIDCM1",165,0)
 ;patient_study_details 
"RTN","SAMIDCM1",166,0)
 ;--Frame of Reference UID 1.3.6.1.4.1.14519.5.2.1.6279.6001.178796764874541005921876698858
"RTN","SAMIDCM1",167,0)
 ;--Manufacturer Siemens Healthineers
"RTN","SAMIDCM1",168,0)
 ;--Manufacturer's Model Name AIRC Research
"RTN","SAMIDCM1",169,0)
 ;--Patient ID LIDC-IDRI-0492
"RTN","SAMIDCM1",170,0)
 ;--Patient's Birth Date 
"RTN","SAMIDCM1",171,0)
 ;--\s 
"RTN","SAMIDCM1",172,0)
 ;--Patient's Name 
"RTN","SAMIDCM1",173,0)
 ;--\s 
"RTN","SAMIDCM1",174,0)
 ;--Patient's Sex F
"RTN","SAMIDCM1",175,0)
 ;--SOP Class UID 1.2.840.10008.5.1.4.1.1.88.34
"RTN","SAMIDCM1",176,0)
 ;--Series Description AIRC Research Structured Report
"RTN","SAMIDCM1",177,0)
 ;--Slice Thickness 1
"RTN","SAMIDCM1",178,0)
 ;--\n 1.0
"RTN","SAMIDCM1",179,0)
 ;--Study Date 20000101
"RTN","SAMIDCM1",180,0)
 ;--\s 
"RTN","SAMIDCM1",181,0)
 ;--Tracking Identifier L2
"RTN","SAMIDCM1",182,0)
 ;--Tracking Unique Identifier
"RTN","SAMIDCM1",183,0)
 ;
"RTN","SAMIDCM1",184,0)
 d  ; Extract Identifying information
"RTN","SAMIDCM1",185,0)
 . n vars
"RTN","SAMIDCM1",186,0)
 . n name s name=$g(@gp@("Patient's Name"))
"RTN","SAMIDCM1",187,0)
 . i name="" s name=$g(@gp@("PatientName"))
"RTN","SAMIDCM1",188,0)
 . i name="" s vars("name")=name
"RTN","SAMIDCM1",189,0)
 . e  s vars("name")=$$NORMALIZ(name)
"RTN","SAMIDCM1",190,0)
 . n dob s dob=$g(@gp@("Patient's Birth Date"))
"RTN","SAMIDCM1",191,0)
 . i dob="" s dob=20000302
"RTN","SAMIDCM1",192,0)
 . s vars("dob")=dob
"RTN","SAMIDCM1",193,0)
 . n gender s gender=$g(@gp@("Patient's Sex"))
"RTN","SAMIDCM1",194,0)
 . i gender="" s gender="M"
"RTN","SAMIDCM1",195,0)
 . s vars("gender")=gender
"RTN","SAMIDCM1",196,0)
 . n patid s patid=$g(@gp@("Patient ID"))
"RTN","SAMIDCM1",197,0)
 . s vars("patid")=patid
"RTN","SAMIDCM1",198,0)
 . n studyDate s studyDate=$g(@gp@("Study Date"))
"RTN","SAMIDCM1",199,0)
 . i studyDate'="" s vars("studyDate")=studyDate
"RTN","SAMIDCM1",200,0)
 . n trackID s trackID=$g(@gp@("Tracking Identifier"))
"RTN","SAMIDCM1",201,0)
 . s vars("trackingIdentifier")=trackID
"RTN","SAMIDCM1",202,0)
 . s vars("site")=site
"RTN","SAMIDCM1",203,0)
 . s vars("ssn")=999999999
"RTN","SAMIDCM1",204,0)
 . s vars("sistatus")="active"
"RTN","SAMIDCM1",205,0)
 . ;
"RTN","SAMIDCM1",206,0)
 . i '$$MATCH^SAMIDCM1(.vars) d CREATE^SAMIZPH1(.vars)
"RTN","SAMIDCM1",207,0)
 . m @root@(ien)=vars
"RTN","SAMIDCM1",208,0)
 . s name=$g(vars("name"))
"RTN","SAMIDCM1",209,0)
 . i name'="" s @root@("name",name,ien)=""
"RTN","SAMIDCM1",210,0)
 . n studyid s studyid=$g(vars("studyid"))
"RTN","SAMIDCM1",211,0)
 . i studyid'="" s @root@("studyid",studyid,ien)=""
"RTN","SAMIDCM1",212,0)
 . n dfn s dfn=$g(vars("dfn"))
"RTN","SAMIDCM1",213,0)
 . i dfn'="" s @root@("dfn",dfn,ien)=""
"RTN","SAMIDCM1",214,0)
 . i patid'="" s @root@("patid",patid,ien)=""
"RTN","SAMIDCM1",215,0)
 . q
"RTN","SAMIDCM1",216,0)
 ;
"RTN","SAMIDCM1",217,0)
 ;
"RTN","SAMIDCM1",218,0)
 set return("status")="ok"
"RTN","SAMIDCM1",219,0)
 set return("siteid")=site
"RTN","SAMIDCM1",220,0)
 set return("ien")=ien
"RTN","SAMIDCM1",221,0)
 ;
"RTN","SAMIDCM1",222,0)
 if $get(ARGS("returngraph"))=1 do  ;
"RTN","SAMIDCM1",223,0)
 . merge return("graph")=@root@(ien)
"RTN","SAMIDCM1",224,0)
 . q
"RTN","SAMIDCM1",225,0)
 ;
"RTN","SAMIDCM1",226,0)
 n jary
"RTN","SAMIDCM1",227,0)
 m jary("result")=return
"RTN","SAMIDCM1",228,0)
 d encode^%webjson("jary","RESULT")
"RTN","SAMIDCM1",229,0)
 s HTTPRSP("mime")="application/json"
"RTN","SAMIDCM1",230,0)
 ;
"RTN","SAMIDCM1",231,0)
 quit  ; end of ws WSDCMIN^SAMIDCM1
"RTN","SAMIDCM1",232,0)
 ;
"RTN","SAMIDCM1",233,0)
 ;
"RTN","SAMIDCM1",234,0)
 ;
"RTN","SAMIDCM1",235,0)
 ;
"RTN","SAMIDCM1",236,0)
 ;@ws-code WSDCMQ^SAMIDCM1 web service get dcmquery
"RTN","SAMIDCM1",237,0)
 ;
"RTN","SAMIDCM1",238,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",239,0)
 ;
"RTN","SAMIDCM1",240,0)
 ;ven/gpl;ws;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",241,0)
 ;@called-by
"RTN","SAMIDCM1",242,0)
 ; web service get dcmquery
"RTN","SAMIDCM1",243,0)
 ;@calls
"RTN","SAMIDCM1",244,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",245,0)
 ; encode^%webjson
"RTN","SAMIDCM1",246,0)
 ;@input
"RTN","SAMIDCM1",247,0)
 ; return =
"RTN","SAMIDCM1",248,0)
 ; filter =
"RTN","SAMIDCM1",249,0)
 ;@output [tbd]
"RTN","SAMIDCM1",250,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",251,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",252,0)
 ;
"RTN","SAMIDCM1",253,0)
 ;
"RTN","SAMIDCM1",254,0)
WSDCMQ(return,filter) ; return dcm json
"RTN","SAMIDCM1",255,0)
 ;
"RTN","SAMIDCM1",256,0)
 n root s root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",257,0)
 n sid s sid=$g(filter("studyid"))
"RTN","SAMIDCM1",258,0)
 i sid="" s sid=$g(filter("sid"))
"RTN","SAMIDCM1",259,0)
 i sid="" q ""
"RTN","SAMIDCM1",260,0)
 n ien s ien=$o(@root@("studyid",sid,""))
"RTN","SAMIDCM1",261,0)
 i ien="" q ""
"RTN","SAMIDCM1",262,0)
 ;n ien s ien=$o(@root@(" "),-1)
"RTN","SAMIDCM1",263,0)
 ;
"RTN","SAMIDCM1",264,0)
 n jary,json
"RTN","SAMIDCM1",265,0)
 n cnt s cnt=0
"RTN","SAMIDCM1",266,0)
 s ien=""
"RTN","SAMIDCM1",267,0)
 f  s ien=$o(@root@("studyid",sid,ien)) q:ien=""  d  ;
"RTN","SAMIDCM1",268,0)
 . s cnt=cnt+1
"RTN","SAMIDCM1",269,0)
 . m jary("result",cnt)=@root@(ien,"json")
"RTN","SAMIDCM1",270,0)
 . q
"RTN","SAMIDCM1",271,0)
 d encode^%webjson("jary","return")
"RTN","SAMIDCM1",272,0)
 ;
"RTN","SAMIDCM1",273,0)
 quit  ; end of ws WSDCMQ^SAMIDCM1
"RTN","SAMIDCM1",274,0)
 ;
"RTN","SAMIDCM1",275,0)
 ;
"RTN","SAMIDCM1",276,0)
 ;
"RTN","SAMIDCM1",277,0)
 ;
"RTN","SAMIDCM1",278,0)
 ;@ws-code WSDCMKIL^SAMIDCM1 web service get dcmreset
"RTN","SAMIDCM1",279,0)
 ;
"RTN","SAMIDCM1",280,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",281,0)
 ;
"RTN","SAMIDCM1",282,0)
 ;ven/gpl;ws;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",283,0)
 ;@called-by
"RTN","SAMIDCM1",284,0)
 ; web service get dcmreset
"RTN","SAMIDCM1",285,0)
 ;@calls
"RTN","SAMIDCM1",286,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",287,0)
 ; UNINDXPT^SAMIHOM4
"RTN","SAMIDCM1",288,0)
 ; INDXPTLK^SAMIHOM4
"RTN","SAMIDCM1",289,0)
 ;@input
"RTN","SAMIDCM1",290,0)
 ; return =
"RTN","SAMIDCM1",291,0)
 ; filter =
"RTN","SAMIDCM1",292,0)
 ;@output [tbd]
"RTN","SAMIDCM1",293,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",294,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",295,0)
 ;
"RTN","SAMIDCM1",296,0)
 ;
"RTN","SAMIDCM1",297,0)
WSDCMKIL(return,filter) ; kill all but the 1st entry in dcm-intake
"RTN","SAMIDCM1",298,0)
 ;
"RTN","SAMIDCM1",299,0)
 n lroot,proot,droot
"RTN","SAMIDCM1",300,0)
 n lien,pien,dien s (lien,pien,dien)=""
"RTN","SAMIDCM1",301,0)
 s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",302,0)
 s proot=$$setroot^%wd("vapals-patient")
"RTN","SAMIDCM1",303,0)
 s droot=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",304,0)
 ;
"RTN","SAMIDCM1",305,0)
 n nam s nam="DOE"
"RTN","SAMIDCM1",306,0)
 f i="DOE","PATIENT" d  ;
"RTN","SAMIDCM1",307,0)
 . s nam=i
"RTN","SAMIDCM1",308,0)
 . f  s nam=$o(@lroot@("name",nam)) q:nam=""  q:nam'[i  d  ;
"RTN","SAMIDCM1",309,0)
 . . f  s lien=$o(@lroot@("name",nam,lien)) q:lien=""  d  ;
"RTN","SAMIDCM1",310,0)
 . . . ;w !,nam," ",lien
"RTN","SAMIDCM1",311,0)
 . . . d UNINDXPT^SAMIHOM4(lien)
"RTN","SAMIDCM1",312,0)
 . . . n newnam
"RTN","SAMIDCM1",313,0)
 . . . s newnam="ZZZ"_$e(nam,4,$l(nam))
"RTN","SAMIDCM1",314,0)
 . . . s @lroot@(lien,"saminame")=newnam
"RTN","SAMIDCM1",315,0)
 . . . s @lroot@(lien,"name")=newnam
"RTN","SAMIDCM1",316,0)
 . . . s @lroot@(lien,"fname")=$p(newnam,",",2)
"RTN","SAMIDCM1",317,0)
 . . . s @lroot@(lien,"lname")=$p(newnam,",",1)
"RTN","SAMIDCM1",318,0)
 . . . d INDXPTLK^SAMIHOM4(lien)
"RTN","SAMIDCM1",319,0)
 . . . q
"RTN","SAMIDCM1",320,0)
 . . q
"RTN","SAMIDCM1",321,0)
 . q
"RTN","SAMIDCM1",322,0)
 ;
"RTN","SAMIDCM1",323,0)
 n atmp s atmp=@droot@(0)
"RTN","SAMIDCM1",324,0)
 k @droot
"RTN","SAMIDCM1",325,0)
 s @droot@(0)=atmp
"RTN","SAMIDCM1",326,0)
 ;i $d(^webbak(587)) d  ;
"RTN","SAMIDCM1",327,0)
 ;. m @droot=^webbak(587) ; restore default
"RTN","SAMIDCM1",328,0)
 i $d(^webbak(667)) d  ;
"RTN","SAMIDCM1",329,0)
 . m @droot=^webbak(667) ; restore default
"RTN","SAMIDCM1",330,0)
 . n sid,sidien
"RTN","SAMIDCM1",331,0)
 . ;f dfn="9000227"  d  ;
"RTN","SAMIDCM1",332,0)
 . f dfn="9000057","9000058" d  ;
"RTN","SAMIDCM1",333,0)
 . . s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIDCM1",334,0)
 . . q:lien=""
"RTN","SAMIDCM1",335,0)
 . . d UNINDXPT^SAMIHOM4(lien)
"RTN","SAMIDCM1",336,0)
 . . n newname
"RTN","SAMIDCM1",337,0)
 . . s newname="DOE"_dfn_",JOHN"
"RTN","SAMIDCM1",338,0)
 . . s @lroot@(lien,"name")=newname
"RTN","SAMIDCM1",339,0)
 . . s @lroot@(lien,"saminame")=newname
"RTN","SAMIDCM1",340,0)
 . . s @lroot@(lien,"fname")=$p(newname,",",2)
"RTN","SAMIDCM1",341,0)
 . . s @lroot@(lien,"lname")=$p(newname,",",1)
"RTN","SAMIDCM1",342,0)
 . . d INDXPTLK^SAMIHOM4(lien)
"RTN","SAMIDCM1",343,0)
 . . q
"RTN","SAMIDCM1",344,0)
 . q
"RTN","SAMIDCM1",345,0)
 ;
"RTN","SAMIDCM1",346,0)
 quit  ; end of ws WSDCMKIL^SAMIDCM1
"RTN","SAMIDCM1",347,0)
 ;
"RTN","SAMIDCM1",348,0)
 ;
"RTN","SAMIDCM1",349,0)
 ;
"RTN","SAMIDCM1",350,0)
 ;
"RTN","SAMIDCM1",351,0)
 ;n root s root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",352,0)
 ;n sid s sid=$g(@root@(1,"sid"))
"RTN","SAMIDCM1",353,0)
 ;i sid="" s sid="XXX0023"
"RTN","SAMIDCM1",354,0)
 ;n atmp m atmp=@root@(1)
"RTN","SAMIDCM1",355,0)
 ;d purgegraph^%wd("dcm-intake")
"RTN","SAMIDCM1",356,0)
 ;s root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",357,0)
 ;m @root@(1)=atmp
"RTN","SAMIDCM1",358,0)
 ;s @root@("sid",sid,1)=""
"RTN","SAMIDCM1",359,0)
 q
"RTN","SAMIDCM1",360,0)
 ;
"RTN","SAMIDCM1",361,0)
 ;
"RTN","SAMIDCM1",362,0)
 ;
"RTN","SAMIDCM1",363,0)
 ;
"RTN","SAMIDCM1",364,0)
 ;@dms T1^SAMIDCM1
"RTN","SAMIDCM1",365,0)
 ;
"RTN","SAMIDCM1",366,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",367,0)
 ;
"RTN","SAMIDCM1",368,0)
 ;ven/gpl;dms;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",369,0)
 ;@called-by [tbd]
"RTN","SAMIDCM1",370,0)
 ;@calls
"RTN","SAMIDCM1",371,0)
 ; $$nxtdfn^SAMIDCM1
"RTN","SAMIDCM1",372,0)
 ; CREATE^SAMIZPH1
"RTN","SAMIDCM1",373,0)
 ;@input [tbd]
"RTN","SAMIDCM1",374,0)
 ;@output [tbd]
"RTN","SAMIDCM1",375,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",376,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",377,0)
 ;
"RTN","SAMIDCM1",378,0)
 ;
"RTN","SAMIDCM1",379,0)
T1() ; TEST CREATE A JOHN DOE PATIENT
"RTN","SAMIDCM1",380,0)
 ;
"RTN","SAMIDCM1",381,0)
 D  ;
"RTN","SAMIDCM1",382,0)
 . n vars
"RTN","SAMIDCM1",383,0)
 . s vars("dob")=20000302
"RTN","SAMIDCM1",384,0)
 . s vars("gender")="M"
"RTN","SAMIDCM1",385,0)
 . n nxtdfn s nxtdfn=$$nxtdfn^SAMIDCM1()
"RTN","SAMIDCM1",386,0)
 . s vars("saminame")="DOE"_nxtdfn_",JOHN"
"RTN","SAMIDCM1",387,0)
 . s vars("name")=vars("saminame")
"RTN","SAMIDCM1",388,0)
 . s vars("site")="XXX"
"RTN","SAMIDCM1",389,0)
 . s vars("ssn")=999999999
"RTN","SAMIDCM1",390,0)
 . s vars("sistatus")="active"
"RTN","SAMIDCM1",391,0)
 . d CREATE^SAMIZPH1(.vars)
"RTN","SAMIDCM1",392,0)
 . x "ZWR vars"
"RTN","SAMIDCM1",393,0)
 . q
"RTN","SAMIDCM1",394,0)
 ;
"RTN","SAMIDCM1",395,0)
 quit  ; end of T1
"RTN","SAMIDCM1",396,0)
 ;
"RTN","SAMIDCM1",397,0)
 ;
"RTN","SAMIDCM1",398,0)
 ;
"RTN","SAMIDCM1",399,0)
 ;
"RTN","SAMIDCM1",400,0)
 ;@section 2 supplementary subroutines
"RTN","SAMIDCM1",401,0)
 ;
"RTN","SAMIDCM1",402,0)
 ;
"RTN","SAMIDCM1",403,0)
 ;
"RTN","SAMIDCM1",404,0)
 ;
"RTN","SAMIDCM1",405,0)
 ;@func $$MATCH^SAMIDCM1
"RTN","SAMIDCM1",406,0)
 ;
"RTN","SAMIDCM1",407,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",408,0)
 ;
"RTN","SAMIDCM1",409,0)
 ;ven/gpl;private;function;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",410,0)
 ;@called-by
"RTN","SAMIDCM1",411,0)
 ; WSDCMIN^SAMIDCM1
"RTN","SAMIDCM1",412,0)
 ;@calls
"RTN","SAMIDCM1",413,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",414,0)
 ; $$NORMALIZ
"RTN","SAMIDCM1",415,0)
 ; ENROLL^SAMIZPH1
"RTN","SAMIDCM1",416,0)
 ;@input
"RTN","SAMIDCM1",417,0)
 ; vars =
"RTN","SAMIDCM1",418,0)
 ;@output = normalized name
"RTN","SAMIDCM1",419,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",420,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",421,0)
 ;
"RTN","SAMIDCM1",422,0)
 ;
"RTN","SAMIDCM1",423,0)
MATCH(vars) ; extrinsic which tries to match the message with an
"RTN","SAMIDCM1",424,0)
 ; existing record
"RTN","SAMIDCM1",425,0)
 ;
"RTN","SAMIDCM1",426,0)
 n lroot,proot,droot
"RTN","SAMIDCM1",427,0)
 s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",428,0)
 s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIDCM1",429,0)
 s droot=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",430,0)
 n found s found=0
"RTN","SAMIDCM1",431,0)
 n name s name=$$NORMALIZ($g(vars("name")))
"RTN","SAMIDCM1",432,0)
 n patid s patid=$g(vars("patid"))
"RTN","SAMIDCM1",433,0)
 n dien,lien,pien
"RTN","SAMIDCM1",434,0)
 ;
"RTN","SAMIDCM1",435,0)
 ; first look at the dcm-intake for name matches
"RTN","SAMIDCM1",436,0)
 s dien=$o(@droot@("name",name,""))
"RTN","SAMIDCM1",437,0)
 i dien'="" d  ; the name has been found locally
"RTN","SAMIDCM1",438,0)
 . s found=1
"RTN","SAMIDCM1",439,0)
 . n dfn,studyid
"RTN","SAMIDCM1",440,0)
 . s dfn=$g(@droot@(dien,"dfn"))
"RTN","SAMIDCM1",441,0)
 . i dfn'="" s vars("dfn")=dfn
"RTN","SAMIDCM1",442,0)
 . i dfn="" s found=0 q  ;
"RTN","SAMIDCM1",443,0)
 . s studyid=$g(@droot@(dien,"studyid"))
"RTN","SAMIDCM1",444,0)
 . i studyid="" s found=0 q  ;
"RTN","SAMIDCM1",445,0)
 . i studyid'="" s vars("studyid")=studyid
"RTN","SAMIDCM1",446,0)
 . q
"RTN","SAMIDCM1",447,0)
 ;
"RTN","SAMIDCM1",448,0)
 if found=1 q found
"RTN","SAMIDCM1",449,0)
 ;
"RTN","SAMIDCM1",450,0)
 i dien="" d  ; not here, check patient-lookup
"RTN","SAMIDCM1",451,0)
 . s lien=$o(@lroot@("name",name,""))
"RTN","SAMIDCM1",452,0)
 . i lien="" s found=0 q  ;
"RTN","SAMIDCM1",453,0)
 . i lien'="" s found=1
"RTN","SAMIDCM1",454,0)
 . n dfn,studyid
"RTN","SAMIDCM1",455,0)
 . s dfn=$g(@lroot@(lien,"dfn"))
"RTN","SAMIDCM1",456,0)
 . s vars("dfn")=dfn
"RTN","SAMIDCM1",457,0)
 . i dfn="" s found=0 q  ;
"RTN","SAMIDCM1",458,0)
 . s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIDCM1",459,0)
 . d ENROLL^SAMIZPH1(.vars)
"RTN","SAMIDCM1",460,0)
 . s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIDCM1",461,0)
 . i pien="" s found=0 q  ;
"RTN","SAMIDCM1",462,0)
 . s studyid=$g(@proot@(pien,"studyid"))
"RTN","SAMIDCM1",463,0)
 . s vars("studyid")=studyid
"RTN","SAMIDCM1",464,0)
 . i studyid="" s found=0 q  ;
"RTN","SAMIDCM1",465,0)
 . q
"RTN","SAMIDCM1",466,0)
 ;
"RTN","SAMIDCM1",467,0)
 quit found ; end of $$MATCH^SAMIDCM1
"RTN","SAMIDCM1",468,0)
 ;
"RTN","SAMIDCM1",469,0)
 ;
"RTN","SAMIDCM1",470,0)
 ;
"RTN","SAMIDCM1",471,0)
 ;
"RTN","SAMIDCM1",472,0)
 ;@func $$NORMALIZ^SAMIDCM1
"RTN","SAMIDCM1",473,0)
 ;
"RTN","SAMIDCM1",474,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",475,0)
 ;
"RTN","SAMIDCM1",476,0)
 ;ven/gpl;private;function;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",477,0)
 ;@called-by
"RTN","SAMIDCM1",478,0)
 ; WSDCMIN^SAMIDCM1
"RTN","SAMIDCM1",479,0)
 ; $$MATCH^SAMIDCM1
"RTN","SAMIDCM1",480,0)
 ;@calls none
"RTN","SAMIDCM1",481,0)
 ;@input
"RTN","SAMIDCM1",482,0)
 ; name =
"RTN","SAMIDCM1",483,0)
 ;@output = normalized name
"RTN","SAMIDCM1",484,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",485,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",486,0)
 ;
"RTN","SAMIDCM1",487,0)
 ;
"RTN","SAMIDCM1",488,0)
NORMALIZ(name) ; extrinsic which tries to normalize the name
"RTN","SAMIDCM1",489,0)
 ;
"RTN","SAMIDCM1",490,0)
 n znam s znam=name
"RTN","SAMIDCM1",491,0)
 i name["^" d  q znam  ;; if name has Dicom separator
"RTN","SAMIDCM1",492,0)
 . s znam=$tr(znam,"^",",")
"RTN","SAMIDCM1",493,0)
 . q
"RTN","SAMIDCM1",494,0)
 ;
"RTN","SAMIDCM1",495,0)
 i name'["," d  ; if no comma, then try a space
"RTN","SAMIDCM1",496,0)
 . i $l(name," ")>0 d  ;
"RTN","SAMIDCM1",497,0)
 . . n fnam,lnam
"RTN","SAMIDCM1",498,0)
 . . s fnam=$p(name," ",1)
"RTN","SAMIDCM1",499,0)
 . . s lnam=$p(name," ",$l(name," "))
"RTN","SAMIDCM1",500,0)
 . . s fnam=$p(name,lnam,1)
"RTN","SAMIDCM1",501,0)
 . . s znam=lnam_","_fnam
"RTN","SAMIDCM1",502,0)
 . . q
"RTN","SAMIDCM1",503,0)
 . q
"RTN","SAMIDCM1",504,0)
 ;
"RTN","SAMIDCM1",505,0)
 quit znam ; end of $$NORMALIZ^SAMIDCM1
"RTN","SAMIDCM1",506,0)
 ;
"RTN","SAMIDCM1",507,0)
 ;
"RTN","SAMIDCM1",508,0)
 ;
"RTN","SAMIDCM1",509,0)
 ;
"RTN","SAMIDCM1",510,0)
 ;@var $$nxtdfn^SAMIDCM1
"RTN","SAMIDCM1",511,0)
 ;
"RTN","SAMIDCM1",512,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",513,0)
 ;
"RTN","SAMIDCM1",514,0)
 ;ven/gpl;private;variable;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",515,0)
 ;@called-by
"RTN","SAMIDCM1",516,0)
 ; T1^SAMIDCM1
"RTN","SAMIDCM1",517,0)
 ; REGISTER^SAMILD2
"RTN","SAMIDCM1",518,0)
 ; REGISTER^SAMILOAD
"RTN","SAMIDCM1",519,0)
 ; REGISTER^SAMIZPH1
"RTN","SAMIDCM1",520,0)
 ;@calls
"RTN","SAMIDCM1",521,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",522,0)
 ;@input [tbd]
"RTN","SAMIDCM1",523,0)
 ;@output = available dfn
"RTN","SAMIDCM1",524,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",525,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",526,0)
 ;
"RTN","SAMIDCM1",527,0)
 ;
"RTN","SAMIDCM1",528,0)
nxtdfn() ; next available dfn
"RTN","SAMIDCM1",529,0)
 ;
"RTN","SAMIDCM1",530,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",531,0)
 ;
"RTN","SAMIDCM1",532,0)
 q $o(@root@("dfn"," "),-1)+1 ; end of $$nxtdfn^SAMIDCM1
"RTN","SAMIDCM1",533,0)
 ;
"RTN","SAMIDCM1",534,0)
 ;
"RTN","SAMIDCM1",535,0)
 ;
"RTN","SAMIDCM1",536,0)
 ;
"RTN","SAMIDCM1",537,0)
 ;@section 3 unused supplementary subroutines
"RTN","SAMIDCM1",538,0)
 ;
"RTN","SAMIDCM1",539,0)
 ;
"RTN","SAMIDCM1",540,0)
 ;
"RTN","SAMIDCM1",541,0)
 ;
"RTN","SAMIDCM1",542,0)
 ;@func $$GETSID^SAMIDCM1
"RTN","SAMIDCM1",543,0)
 ;
"RTN","SAMIDCM1",544,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",545,0)
 ;
"RTN","SAMIDCM1",546,0)
 ;ven/gpl;private;function;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",547,0)
 ;@called-by [tbd]
"RTN","SAMIDCM1",548,0)
 ;@calls
"RTN","SAMIDCM1",549,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",550,0)
 ;@input
"RTN","SAMIDCM1",551,0)
 ; name =
"RTN","SAMIDCM1",552,0)
 ;@output = study id
"RTN","SAMIDCM1",553,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",554,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",555,0)
 ;
"RTN","SAMIDCM1",556,0)
 ;
"RTN","SAMIDCM1",557,0)
GETSID(name) ; return studyid
"RTN","SAMIDCM1",558,0)
 ;
"RTN","SAMIDCM1",559,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",560,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIDCM1",561,0)
 n lien s lien=$o(@root@("name",name,""))
"RTN","SAMIDCM1",562,0)
 n dfn s dfn=$g(@root@(lien,"dfn"))
"RTN","SAMIDCM1",563,0)
 n pien s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIDCM1",564,0)
 q:pien="" ""
"RTN","SAMIDCM1",565,0)
 ;
"RTN","SAMIDCM1",566,0)
 quit $g(@proot@(pien,"sisid")) ; end of $$GETSID^SAMIDCM1
"RTN","SAMIDCM1",567,0)
 ;
"RTN","SAMIDCM1",568,0)
 ;
"RTN","SAMIDCM1",569,0)
 ;
"RTN","SAMIDCM1",570,0)
 ;
"RTN","SAMIDCM1",571,0)
 ;@proc IDXDCM^SAMIDCM1
"RTN","SAMIDCM1",572,0)
 ;
"RTN","SAMIDCM1",573,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",574,0)
 ;
"RTN","SAMIDCM1",575,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",576,0)
 ;@called-by [tbd]
"RTN","SAMIDCM1",577,0)
 ;@calls
"RTN","SAMIDCM1",578,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",579,0)
 ;@input
"RTN","SAMIDCM1",580,0)
 ; dien =
"RTN","SAMIDCM1",581,0)
 ; ARY =
"RTN","SAMIDCM1",582,0)
 ;@output [tbd]
"RTN","SAMIDCM1",583,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",584,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",585,0)
 ;
"RTN","SAMIDCM1",586,0)
 ;
"RTN","SAMIDCM1",587,0)
IDXDCM(dien,ARY) ; index a dcm entry after patient record creation
"RTN","SAMIDCM1",588,0)
 ;
"RTN","SAMIDCM1",589,0)
 n droot s droot=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",590,0)
 i $d(ARY) m @droot@(dien)=ARY
"RTN","SAMIDCM1",591,0)
 d  ;
"RTN","SAMIDCM1",592,0)
 . n x
"RTN","SAMIDCM1",593,0)
 . s x=$g(@droot@(dien,"dfn"))
"RTN","SAMIDCM1",594,0)
 . if x'="" s @droot@("dfn",x,dien)=""
"RTN","SAMIDCM1",595,0)
 . s x=$g(@droot@(dien,"saminame"))
"RTN","SAMIDCM1",596,0)
 . i x="" s x=$g(@droot@(dien,"name"))
"RTN","SAMIDCM1",597,0)
 . i x'="" s @droot@("name",x,dien)=""
"RTN","SAMIDCM1",598,0)
 . s x=$g(@droot@(dien,"studyid"))
"RTN","SAMIDCM1",599,0)
 . i x="" s x=$g(@droot@(dien,"sid"))
"RTN","SAMIDCM1",600,0)
 . i x'="" s @droot@("sid",x,dien)=""
"RTN","SAMIDCM1",601,0)
 . q
"RTN","SAMIDCM1",602,0)
 ;
"RTN","SAMIDCM1",603,0)
 quit  ; end of IDXDCM
"RTN","SAMIDCM1",604,0)
 ;
"RTN","SAMIDCM1",605,0)
 ;
"RTN","SAMIDCM1",606,0)
 ;
"RTN","SAMIDCM1",607,0)
 ;
"RTN","SAMIDCM1",608,0)
 ;@section 4 init subroutine to create web services
"RTN","SAMIDCM1",609,0)
 ;
"RTN","SAMIDCM1",610,0)
 ;
"RTN","SAMIDCM1",611,0)
 ;
"RTN","SAMIDCM1",612,0)
 ;
"RTN","SAMIDCM1",613,0)
MKSVC() ; create the web services
"RTN","SAMIDCM1",614,0)
 ;
"RTN","SAMIDCM1",615,0)
 d deleteService^%webutils("POST","dcmimgin")
"RTN","SAMIDCM1",616,0)
 d addService^%webutils("POST","dcmimgin","WSDCMIN^SAMIDCM1")
"RTN","SAMIDCM1",617,0)
 ;
"RTN","SAMIDCM1",618,0)
 d deleteService^%webutils("POST","dcmin")
"RTN","SAMIDCM1",619,0)
 d addService^%webutils("POST","dcmin","WSDCMIN^SAMIDCM1")
"RTN","SAMIDCM1",620,0)
 ;
"RTN","SAMIDCM1",621,0)
 d deleteService^%webutils("GET","dcmquery")
"RTN","SAMIDCM1",622,0)
 d addService^%webutils("GET","dcmquery","WSDCMQ^SAMIDCM1")
"RTN","SAMIDCM1",623,0)
 ;
"RTN","SAMIDCM1",624,0)
 d deleteService^%webutils("GET","dcmreset")
"RTN","SAMIDCM1",625,0)
 d addService^%webutils("GET","dcmreset","WSDCMKIL^SAMIDCM1")
"RTN","SAMIDCM1",626,0)
 ;
"RTN","SAMIDCM1",627,0)
 quit  ; end of MKSVC^SAMIDCM1
"RTN","SAMIDCM1",628,0)
 ;
"RTN","SAMIDCM1",629,0)
 ;
"RTN","SAMIDCM1",630,0)
 ;
"RTN","SAMIDCM1",631,0)
EOR ; end of routine SAMIDCM1
"RTN","SAMIFLD")
0^12^B288543997
"RTN","SAMIFLD",1,0)
SAMIFLD ;ven/gpl - form load & case review; 2024-08-22t21:09z
"RTN","SAMIFLD",2,0)
 ;;18.0;SAMI;**10,17**;2020-01-17;Build 8
"RTN","SAMIFLD",3,0)
 ;mdc-e1;SAMIFLD-20240822-E01FO7Mr;SAMI-18-17-b6
"RTN","SAMIFLD",4,0)
 ;mdc-v7;B288543997;SAMI*18.0*17 SEQ #17
"RTN","SAMIFLD",5,0)
 ;
"RTN","SAMIFLD",6,0)
 ; SAMIFLD contains subroutines for processing ScreeningPlus forms,
"RTN","SAMIFLD",7,0)
 ; loading JSON data into the graphstore for each line. Since three of
"RTN","SAMIFLD",8,0)
 ; those subroutines are also code for ppses called by
"RTN","SAMIFLD",9,0)
 ; WSCASE^SAMICASE, two additional subroutines are included that are
"RTN","SAMIFLD",10,0)
 ; not part of the LOAD opus but are called by WSCASE^SAMICASE.
"RTN","SAMIFLD",11,0)
 ; SAMIFLD contains no public entry points (see SAMIFORM).
"RTN","SAMIFLD",12,0)
 ;
"RTN","SAMIFLD",13,0)
 quit  ; no entry from top
"RTN","SAMIFLD",14,0)
 ;
"RTN","SAMIFLD",15,0)
 ;
"RTN","SAMIFLD",16,0)
 ;
"RTN","SAMIFLD",17,0)
 ;
"RTN","SAMIFLD",18,0)
 ;@section 0 primary development
"RTN","SAMIFLD",19,0)
 ;
"RTN","SAMIFLD",20,0)
 ;
"RTN","SAMIFLD",21,0)
 ;
"RTN","SAMIFLD",22,0)
 ;
"RTN","SAMIFLD",23,0)
 ;@routine-credits
"RTN","SAMIFLD",24,0)
 ;
"RTN","SAMIFLD",25,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIFLD",26,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIFLD",27,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIFLD",28,0)
 ; http://vistaexpertise.net
"RTN","SAMIFLD",29,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIFLD",30,0)
 ;@license Apache 2.0
"RTN","SAMIFLD",31,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMIFLD",32,0)
 ;
"RTN","SAMIFLD",33,0)
 ;@update 2024-08-22t21:09z
"RTN","SAMIFLD",34,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIFLD",35,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIFLD",36,0)
 ;@module Forms - SAMIF
"RTN","SAMIFLD",37,0)
 ;@release 18-17
"RTN","SAMIFLD",38,0)
 ;@edition-date 2020-01-21
"RTN","SAMIFLD",39,0)
 ;@patches **10,17**
"RTN","SAMIFLD",40,0)
 ;
"RTN","SAMIFLD",41,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIFLD",42,0)
 ; toad@vistaexpertise.net
"RTN","SAMIFLD",43,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIFLD",44,0)
 ; lgc@vistaexpertise.net
"RTN","SAMIFLD",45,0)
 ;@dev-add Alexis Carlson (arc)
"RTN","SAMIFLD",46,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMIFLD",47,0)
 ;@dev-add Domenic DiNatale (dom)
"RTN","SAMIFLD",48,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMIFLD",49,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIFLD",50,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIFLD",51,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIFLD",52,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIFLD",53,0)
 ;
"RTN","SAMIFLD",54,0)
 ;@module-credits see SAMIFUL
"RTN","SAMIFLD",55,0)
 ;
"RTN","SAMIFLD",56,0)
 ;@contents
"RTN","SAMIFLD",57,0)
 ;
"RTN","SAMIFLD",58,0)
 ;  1. code for ppses LOAD^SAMIFRM & $$GETHDR^SAMIFLD
"RTN","SAMIFLD",59,0)
 ; LOAD code for pps LOAD^SAMIFORM
"RTN","SAMIFLD",60,0)
 ;  process html line, e.g., load json data into graph
"RTN","SAMIFLD",61,0)
 ; $$XPAND expand # to 8 digits
"RTN","SAMIFLD",62,0)
 ; $$GETHDR pps GETHDR^SAMIFLD
"RTN","SAMIFLD",63,0)
 ;  header string for patient sid
"RTN","SAMIFLD",64,0)
 ; $$GETMRN get MRN, which supercedes ssn as patient id
"RTN","SAMIFLD",65,0)
 ;
"RTN","SAMIFLD",66,0)
 ;  2. code for ppses $$GETLAST5^SAMIFORM, FIXSRC^SAMIFORM, and
"RTN","SAMIFLD",67,0)
 ;     FIXHREF^SAMIFORM
"RTN","SAMIFLD",68,0)
 ; GETLAST5 code for pps $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",69,0)
 ;  last5 for patient sid
"RTN","SAMIFLD",70,0)
 ; FIXSRC code for pps FIXSRC^SAMIFORM
"RTN","SAMIFLD",71,0)
 ;  fix html src lines to use resources in see/
"RTN","SAMIFLD",72,0)
 ; FIXHREF code for pps FIXHREF^SAMIFORM
"RTN","SAMIFLD",73,0)
 ;  fix html href lines to use resources in see/
"RTN","SAMIFLD",74,0)
 ;
"RTN","SAMIFLD",75,0)
 ;  3 code for ppses $$GETNAME^SAMIFORM, $$GETSSN^SAMIFORM, and
"RTN","SAMIFLD",76,0)
 ;    $$GETPRFX^SAMIFORM
"RTN","SAMIFLD",77,0)
 ; GETNAME code for pps $$GETNAME^SAMIFORM
"RTN","SAMIFLD",78,0)
 ;  name for patient sid
"RTN","SAMIFLD",79,0)
 ; GETSSN code for pps $$GETSSN^SAMIFORM
"RTN","SAMIFLD",80,0)
 ;  ssn for patient sid
"RTN","SAMIFLD",81,0)
 ; GETPRFX code for pps $$GETPRFX^SAMIFORM [deprecated]
"RTN","SAMIFLD",82,0)
 ;  retrieve study id prefix from parameter file
"RTN","SAMIFLD",83,0)
 ;
"RTN","SAMIFLD",84,0)
 ;
"RTN","SAMIFLD",85,0)
 ;
"RTN","SAMIFLD",86,0)
 ;
"RTN","SAMIFLD",87,0)
 ;@section 1 code for ppses LOAD^SAMIFRM & $$GETHDR^SAMIFLD
"RTN","SAMIFLD",88,0)
 ;
"RTN","SAMIFLD",89,0)
 ;
"RTN","SAMIFLD",90,0)
 ;
"RTN","SAMIFLD",91,0)
 ;
"RTN","SAMIFLD",92,0)
 ;@pps-code LOAD^SAMIFORM
"RTN","SAMIFLD",93,0)
 ;
"RTN","SAMIFLD",94,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",95,0)
 ;
"RTN","SAMIFLD",96,0)
 ;ven/gpl;pps;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIFLD",97,0)
 ;@signature
"RTN","SAMIFLD",98,0)
 ; do LOAD^SAMIFORM(.SAMILINE,form,sid,.SAMIFILTER,.SAMILNUM,.SAMIHTML,.SAMIVALS)
"RTN","SAMIFLD",99,0)
 ;@branches-from
"RTN","SAMIFLD",100,0)
 ; LOAD^SAMIFORM
"RTN","SAMIFLD",101,0)
 ;@pps-called-by
"RTN","SAMIFLD",102,0)
 ; wsGetForm^%wf
"RTN","SAMIFLD",103,0)
 ; WSNOTE^SAMINOT1
"RTN","SAMIFLD",104,0)
 ; WSNOTE^SAMINOT2
"RTN","SAMIFLD",105,0)
 ; WSNOTE^SAMINOT3
"RTN","SAMIFLD",106,0)
 ; WSNOTE^SAMINOTI
"RTN","SAMIFLD",107,0)
 ; SUPER^SAMISITE
"RTN","SAMIFLD",108,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIFLD",109,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIFLD",110,0)
 ;@called-by none
"RTN","SAMIFLD",111,0)
 ;@calls
"RTN","SAMIFLD",112,0)
 ; $$GETHDR^SAMIFLD
"RTN","SAMIFLD",113,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",114,0)
 ; $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",115,0)
 ; findReplace^%ts
"RTN","SAMIFLD",116,0)
 ; $$GET^XPAR
"RTN","SAMIFLD",117,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIFLD",118,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIFLD",119,0)
 ; $$GETNAME^SAMIFORM
"RTN","SAMIFLD",120,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",121,0)
 ; $$EXISTCE^SAMINOT1
"RTN","SAMIFLD",122,0)
 ; $$EXISTPRE^SAMINOT1
"RTN","SAMIFLD",123,0)
 ; $$EXISTINT^SAMINOT1
"RTN","SAMIFLD",124,0)
 ; $$XPAND
"RTN","SAMIFLD",125,0)
 ; $$SHDET^SAMIUR2
"RTN","SAMIFLD",126,0)
 ;@thruput
"RTN","SAMIFLD",127,0)
 ;.SAMILINE = line of html
"RTN","SAMIFLD",128,0)
 ; SAMILINE("low") = lowercase line for easier checks
"RTN","SAMIFLD",129,0)
 ;.SAMIFILTER = work-parameters array
"RTN","SAMIFLD",130,0)
 ; SAMIFILTER("debug") = 1 to debug some fields, 2 to debug more fields
"RTN","SAMIFLD",131,0)
 ; SAMIFILTER("errormessagestyle") = 2 (default) = use current error msg style
"RTN","SAMIFLD",132,0)
 ; SAMIFILTER("form") = form id (e.g., "vapals:sbform")
"RTN","SAMIFLD",133,0)
 ; SAMIFILTER("key") = graph key for saved form (e.g., "ceform-2019-07-01")
"RTN","SAMIFLD",134,0)
 ; SAMIFILTER("studyid") = patient study id (e.g., "XXX00045")
"RTN","SAMIFLD",135,0)
 ; SAMIFILTER("fvalue") = deprecated
"RTN","SAMIFLD",136,0)
 ;.SAMILNUM = html line #, in case need to reset cursor to skip lines
"RTN","SAMIFLD",137,0)
 ;.SAMIHTML = complete html form, in case other lines need changing
"RTN","SAMIFLD",138,0)
 ;@input
"RTN","SAMIFLD",139,0)
 ; form = form id
"RTN","SAMIFLD",140,0)
 ; sid = patient study id
"RTN","SAMIFLD",141,0)
 ;.SAMIVALS = field values
"RTN","SAMIFLD",142,0)
 ; SAMIVALS("saminame")
"RTN","SAMIFLD",143,0)
 ; SAMIVALS("samistatus")
"RTN","SAMIFLD",144,0)
 ; SAMIVALS("samifirsttime")
"RTN","SAMIFLD",145,0)
 ;@tests
"RTN","SAMIFLD",146,0)
 ; UTLOAD^SAMIUTF used for Dom's new style forms
"RTN","SAMIFLD",147,0)
 ;
"RTN","SAMIFLD",148,0)
 ; This line processor/data loader can modify any line in the html as needed.
"RTN","SAMIFLD",149,0)
 ;
"RTN","SAMIFLD",150,0)
 ;
"RTN","SAMIFLD",151,0)
LOAD ; process html line, e.g., load json data into graph
"RTN","SAMIFLD",152,0)
 ;
"RTN","SAMIFLD",153,0)
 new touched set touched=0
"RTN","SAMIFLD",154,0)
 ;
"RTN","SAMIFLD",155,0)
 set SAMILINE=SAMILINE_$char(13,10) ; insert CRLF at end of every line
"RTN","SAMIFLD",156,0)
 ; for readability in browser
"RTN","SAMIFLD",157,0)
 ;
"RTN","SAMIFLD",158,0)
 new pssn set pssn=$$GETHDR(sid)
"RTN","SAMIFLD",159,0)
 i pssn=""  d  ; for participants without a sid - ie not registered
"RTN","SAMIFLD",160,0)
 . n dfn,lien
"RTN","SAMIFLD",161,0)
 . s dfn=$g(SAMIFILTER("dfn")) ; if no sid, maybe a dfn
"RTN","SAMIFLD",162,0)
 . q:dfn=""
"RTN","SAMIFLD",163,0)
 . n lroot s lroot=$$setroot^%wd("patient-lookup") ; 
"RTN","SAMIFLD",164,0)
 . s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIFLD",165,0)
 . q:lien=""
"RTN","SAMIFLD",166,0)
 . n ssn s ssn=$g(@lroot@(lien,"ssn"))
"RTN","SAMIFLD",167,0)
 . q:ssn=""
"RTN","SAMIFLD",168,0)
 . s pssn=$e(ssn,1,3)_"-"_$e(ssn,4,5)_"-"_$e(ssn,6,9)
"RTN","SAMIFLD",169,0)
 new last5 set last5=$$GETLAST5^SAMIFORM(sid)
"RTN","SAMIFLD",170,0)
 new useid set useid=pssn
"RTN","SAMIFLD",171,0)
 if useid="" set useid=last5
"RTN","SAMIFLD",172,0)
 ;
"RTN","SAMIFLD",173,0)
 if SAMILINE["@@FORMKEY@@" do  ; insert form id (graph key for new forms)
"RTN","SAMIFLD",174,0)
 . do findReplace^%ts(.SAMILINE,"@@FORMKEY@@",form) ; key -> form, test me
"RTN","SAMIFLD",175,0)
 . quit
"RTN","SAMIFLD",176,0)
 ;
"RTN","SAMIFLD",177,0)
 if SAMILINE["@@SID@@" do  ; insert patient study id
"RTN","SAMIFLD",178,0)
 . do findReplace^%ts(.SAMILINE,"@@SID@@",sid)
"RTN","SAMIFLD",179,0)
 . quit
"RTN","SAMIFLD",180,0)
 ;
"RTN","SAMIFLD",181,0)
 if SAMILINE["@@SITE@@" do  ; insert site id
"RTN","SAMIFLD",182,0)
 . n siteid s siteid=$g(SAMIVALS("siteid"))
"RTN","SAMIFLD",183,0)
 . i siteid="" s siteid=$g(SAMIFILTER("siteid"))
"RTN","SAMIFLD",184,0)
 . q:siteid=""
"RTN","SAMIFLD",185,0)
 . do findReplace^%ts(.SAMILINE,"@@SITE@@",siteid)
"RTN","SAMIFLD",186,0)
 . quit
"RTN","SAMIFLD",187,0)
 ;
"RTN","SAMIFLD",188,0)
 if SAMILINE["@@SITETITLE@@" do  ; insert site title
"RTN","SAMIFLD",189,0)
 . n sitetit s sitetit=$g(SAMIVALS("sitetitle"))
"RTN","SAMIFLD",190,0)
 . i sitetit="" s sitetit=$g(SAMIFILTER("sitetitle"))
"RTN","SAMIFLD",191,0)
 . q:sitetit=""
"RTN","SAMIFLD",192,0)
 . do findReplace^%ts(.SAMILINE,"@@SITETITLE@@",sitetit)
"RTN","SAMIFLD",193,0)
 . quit
"RTN","SAMIFLD",194,0)
 ;
"RTN","SAMIFLD",195,0)
 if SAMILINE["@@MANUALREGISTRATION@@" do  ; turn off manual registration
"RTN","SAMIFLD",196,0)
 . n setman,setparm
"RTN","SAMIFLD",197,0)
 . s setman="true"
"RTN","SAMIFLD",198,0)
 . s setparm=$$GET^XPAR("SYS","SAMI ALLOW MANUAL ENTRY",,"Q")
"RTN","SAMIFLD",199,0)
 . i setparm=0 s setman="false"
"RTN","SAMIFLD",200,0)
 . do findReplace^%ts(.SAMILINE,"@@MANUALREGISTRATION@@",setman)
"RTN","SAMIFLD",201,0)
 ; 
"RTN","SAMIFLD",202,0)
 if SAMILINE["@@DFN@@" do  ; insert patient study id
"RTN","SAMIFLD",203,0)
 . n dfn s dfn=$g(SAMIVALS("dfn"))
"RTN","SAMIFLD",204,0)
 . q:dfn=""
"RTN","SAMIFLD",205,0)
 . do findReplace^%ts(.SAMILINE,"@@DFN@@",dfn)
"RTN","SAMIFLD",206,0)
 . quit
"RTN","SAMIFLD",207,0)
 ;
"RTN","SAMIFLD",208,0)
 if SAMILINE["src=" do  ; repoint src directory references
"RTN","SAMIFLD",209,0)
 . do FIXSRC^SAMIFORM(.SAMILINE) ; insert see/ processor on src= references
"RTN","SAMIFLD",210,0)
 . quit
"RTN","SAMIFLD",211,0)
 ;
"RTN","SAMIFLD",212,0)
 if SAMILINE["href=" if 'touched do  ; repoint href directory references
"RTN","SAMIFLD",213,0)
 . do FIXHREF^SAMIFORM(.SAMILINE) ; insert see/ processor on href= references
"RTN","SAMIFLD",214,0)
 . quit
"RTN","SAMIFLD",215,0)
 ;
"RTN","SAMIFLD",216,0)
 if SAMILINE["Sample, Sammy G" do  ; insert actual patient name
"RTN","SAMIFLD",217,0)
 . ;do findReplace^%ts(.SAMILINE,"Sample, Sammy G",$get(SAMIVALS("saminame")))
"RTN","SAMIFLD",218,0)
 . do findReplace^%ts(.SAMILINE,"Sample, Sammy G",$$GETNAME^SAMIFORM(sid))
"RTN","SAMIFLD",219,0)
 . quit
"RTN","SAMIFLD",220,0)
 ;
"RTN","SAMIFLD",221,0)
 if SAMILINE["ST0001" do  ; insert patient ssn or last 5
"RTN","SAMIFLD",222,0)
 . do findReplace^%ts(.SAMILINE,"ST0001",useid)
"RTN","SAMIFLD",223,0)
 . quit
"RTN","SAMIFLD",224,0)
 ;
"RTN","SAMIFLD",225,0)
 if SAMILINE["1234567890" do  ; cut patient id placeholder
"RTN","SAMIFLD",226,0)
 . do findReplace^%ts(.SAMILINE,"1234567890","")
"RTN","SAMIFLD",227,0)
 . quit
"RTN","SAMIFLD",228,0)
 ;
"RTN","SAMIFLD",229,0)
 if SAMILINE["XX0002" do  ; insert patient study id
"RTN","SAMIFLD",230,0)
 . if SAMILINE["XXX" quit  ;
"RTN","SAMIFLD",231,0)
 . do findReplace^%ts(.SAMILINE,"XX0002",sid)
"RTN","SAMIFLD",232,0)
 . quit
"RTN","SAMIFLD",233,0)
 ;
"RTN","SAMIFLD",234,0)
 if SAMILINE["VEP0001" do  ; insert patient study id
"RTN","SAMIFLD",235,0)
 . do findReplaceAll^%ts(.SAMILINE,"VEP0001",sid)
"RTN","SAMIFLD",236,0)
 . quit
"RTN","SAMIFLD",237,0)
 ;
"RTN","SAMIFLD",238,0)
 if SAMILINE["@@FROZEN@@" do  ; insert whether form is frozen
"RTN","SAMIFLD",239,0)
 . if $get(SAMIVALS("samistatus"))="complete" do  ;
"RTN","SAMIFLD",240,0)
 . . do findReplace^%ts(.SAMILINE,"@@FROZEN@@","true")
"RTN","SAMIFLD",241,0)
 . . quit
"RTN","SAMIFLD",242,0)
 . else  do  ;
"RTN","SAMIFLD",243,0)
 . . do findReplace^%ts(.SAMILINE,"@@FROZEN@@","false")
"RTN","SAMIFLD",244,0)
 . . quit
"RTN","SAMIFLD",245,0)
 . quit
"RTN","SAMIFLD",246,0)
 ;
"RTN","SAMIFLD",247,0)
 if SAMILINE["@@NEWFORM@@" do  ; insert whether first edit of form
"RTN","SAMIFLD",248,0)
 . if $get(SAMIVALS("samifirsttime"))="true" do  ;
"RTN","SAMIFLD",249,0)
 . . do findReplace^%ts(.SAMILINE,"@@NEWFORM@@","true")
"RTN","SAMIFLD",250,0)
 . . quit
"RTN","SAMIFLD",251,0)
 . else  do  ;
"RTN","SAMIFLD",252,0)
 . . do findReplace^%ts(.SAMILINE,"@@NEWFORM@@","false")
"RTN","SAMIFLD",253,0)
 . . quit
"RTN","SAMIFLD",254,0)
 . quit
"RTN","SAMIFLD",255,0)
 ;
"RTN","SAMIFLD",256,0)
 if SAMILINE["@@CHART_ELIGIBILITY_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",257,0)
 . n zexist
"RTN","SAMIFLD",258,0)
 . s zexist=$$EXISTCE^SAMINOT1(sid,form)
"RTN","SAMIFLD",259,0)
 . do findReplace^%ts(.SAMILINE,"@@CHART_ELIGIBILITY_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",260,0)
 ;
"RTN","SAMIFLD",261,0)
 if SAMILINE["@@PRE_ENROLLMENT_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",262,0)
 . n zexist
"RTN","SAMIFLD",263,0)
 . s zexist=$$EXISTPRE^SAMINOT1(sid,form)
"RTN","SAMIFLD",264,0)
 . do findReplace^%ts(.SAMILINE,"@@PRE_ENROLLMENT_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",265,0)
 ;
"RTN","SAMIFLD",266,0)
 if SAMILINE["@@INTAKE_NOTE_EXISTS@@" d  ;
"RTN","SAMIFLD",267,0)
 . n zexist
"RTN","SAMIFLD",268,0)
 . s zexist=$$EXISTINT^SAMINOT1(sid,form)
"RTN","SAMIFLD",269,0)
 . do findReplace^%ts(.SAMILINE,"@@INTAKE_NOTE_EXISTS@@",zexist)
"RTN","SAMIFLD",270,0)
 ;
"RTN","SAMIFLD",271,0)
 if SAMILINE["changelog" d  ;
"RTN","SAMIFLD",272,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",273,0)
 . new clog set clog=$na(@root@("graph",sid,form,"changelog"))
"RTN","SAMIFLD",274,0)
 . if '$d(@clog) q  ;
"RTN","SAMIFLD",275,0)
 . do findReplace^%ts(.SAMILINE,"</pre>","")
"RTN","SAMIFLD",276,0)
 . new zi set zi=""
"RTN","SAMIFLD",277,0)
 . for  set zi=$order(@clog@(zi)) quit:zi=""  d  ;
"RTN","SAMIFLD",278,0)
 . . new zien set zien=SAMILNUM_"."_$$XPAND(zi)
"RTN","SAMIFLD",279,0)
 . . set zhtml(zien)=@clog@(zi)
"RTN","SAMIFLD",280,0)
 . set zhtml(SAMILNUM_"."_$$XPAND($order(@clog@(""),-1)+1))="</pre>"
"RTN","SAMIFLD",281,0)
 ;
"RTN","SAMIFLD",282,0)
 if SAMILINE["commlog" d  ;
"RTN","SAMIFLD",283,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",284,0)
 . new clog set clog=$na(@root@("graph",sid,form,"comlog"))
"RTN","SAMIFLD",285,0)
 . if '$d(@clog) q  ;
"RTN","SAMIFLD",286,0)
 . do findReplace^%ts(.SAMILINE,"</pre>","")
"RTN","SAMIFLD",287,0)
 . new zi set zi=""
"RTN","SAMIFLD",288,0)
 . for  set zi=$order(@clog@(zi)) quit:zi=""  d  ;
"RTN","SAMIFLD",289,0)
 . . new zien set zien=SAMILNUM_"."_$$XPAND(zi)
"RTN","SAMIFLD",290,0)
 . . set zhtml(zien)=@clog@(zi)
"RTN","SAMIFLD",291,0)
 . set zhtml(SAMILNUM_"."_$$XPAND($order(@clog@(""),-1)+1))="</pre>"
"RTN","SAMIFLD",292,0)
 ;
"RTN","SAMIFLD",293,0)
 ;if form["fuform" d  ;
"RTN","SAMIFLD",294,0)
 i SAMILINE["pack-years-history" d  ;
"RTN","SAMIFLD",295,0)
 . d  ;
"RTN","SAMIFLD",296,0)
 . . i SAMILINE'["id" q  ;
"RTN","SAMIFLD",297,0)
 . . n zzi s zzi=SAMILNUM
"RTN","SAMIFLD",298,0)
 . . f  s zzi=$o(SAMIHTML(zzi)) q:zzi>(SAMILNUM+20)  q:SAMIHTML(zzi)["tbody"  d
"RTN","SAMIFLD",299,0)
 . . . s SAMIHTML(zzi)=SAMIHTML(zzi)_$char(13,10)
"RTN","SAMIFLD",300,0)
 . . ;s SAMIHTML(zzi)="<tbody>"_$$SHDET^SAMIUR2(sid)
"RTN","SAMIFLD",301,0)
 . . s SAMILNUM=zzi+1
"RTN","SAMIFLD",302,0)
 . . s SAMILINE=$$SHDET^SAMIUR2(sid,form)_"</tbody>"
"RTN","SAMIFLD",303,0)
 ;
"RTN","SAMIFLD",304,0)
 i SAMILINE["@@ERROR_MESSAGE@@" d  ;
"RTN","SAMIFLD",305,0)
 . n errMsg s errMsg=$get(SAMIVALS("errorMessage"))
"RTN","SAMIFLD",306,0)
 . if errMsg="" q  ; no error message
"RTN","SAMIFLD",307,0)
 . do findReplace^%ts(.SAMILINE,"@@ERROR_MESSAGE@@",errMsg)
"RTN","SAMIFLD",308,0)
 ;
"RTN","SAMIFLD",309,0)
 i SAMILINE["@@ERROR_FIELDS@@" d  ;
"RTN","SAMIFLD",310,0)
 . n errFld s errFld=$get(SAMIVALS("errorField"))
"RTN","SAMIFLD",311,0)
 . if errFld="" q  ; no error field
"RTN","SAMIFLD",312,0)
 . do findReplace^%ts(.SAMILINE,"@@ERROR_FIELDS@@",errFld)
"RTN","SAMIFLD",313,0)
 ;
"RTN","SAMIFLD",314,0)
 i SAMILINE["@@INFO_MESSAGE@@" d  ;
"RTN","SAMIFLD",315,0)
 . n infoMsg s infoMsg=$get(SAMIVALS("infoMessage"))
"RTN","SAMIFLD",316,0)
 . if infoMsg="" q  ; no message
"RTN","SAMIFLD",317,0)
 . do findReplace^%ts(.SAMILINE,"@@INFO_MESSAGE@@",infoMsg)
"RTN","SAMIFLD",318,0)
 ;
"RTN","SAMIFLD",319,0)
 i SAMILINE["@@WARN_MESSAGE@@" d  ;
"RTN","SAMIFLD",320,0)
 . n warnMsg s warnMsg=$get(SAMIVALS("warnMessage"))
"RTN","SAMIFLD",321,0)
 . if warnMsg="" q  ; no message
"RTN","SAMIFLD",322,0)
 . do findReplace^%ts(.SAMILINE,"@@WARN_MESSAGE@@",warnMsg)
"RTN","SAMIFLD",323,0)
 ;
"RTN","SAMIFLD",324,0)
 quit  ; end of pps LOAD^SAMIFORM
"RTN","SAMIFLD",325,0)
 ;
"RTN","SAMIFLD",326,0)
 ;
"RTN","SAMIFLD",327,0)
 ;
"RTN","SAMIFLD",328,0)
 ;
"RTN","SAMIFLD",329,0)
 ;@func $$XPAND
"RTN","SAMIFLD",330,0)
 ;
"RTN","SAMIFLD",331,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",332,0)
 ;
"RTN","SAMIFLD",333,0)
 ;ven/gpl;private;function;clean;silent;sac;tests?;port
"RTN","SAMIFLD",334,0)
 ;@called-by
"RTN","SAMIFLD",335,0)
 ; LOAD
"RTN","SAMIFLD",336,0)
 ;@calls none
"RTN","SAMIFLD",337,0)
 ;@input
"RTN","SAMIFLD",338,0)
 ; zi = # to pad
"RTN","SAMIFLD",339,0)
 ;@output = # expanded to 8 digits by prefixing 0 & appending 1 so 10,
"RTN","SAMIFLD",340,0)
 ; 20, etc. collate properly
"RTN","SAMIFLD",341,0)
 ;@tests [tbd]
"RTN","SAMIFLD",342,0)
 ;
"RTN","SAMIFLD",343,0)
 ;
"RTN","SAMIFLD",344,0)
XPAND(zi) ; expand # to 8 digits
"RTN","SAMIFLD",345,0)
 ;
"RTN","SAMIFLD",346,0)
 ;@stanza 2 algorithm
"RTN","SAMIFLD",347,0)
 ;
"RTN","SAMIFLD",348,0)
 new g1 set g1=8-$length(zi)
"RTN","SAMIFLD",349,0)
 new g2 set $piece(g2,"0",g1)=""
"RTN","SAMIFLD",350,0)
 new g3 set g3=g2_zi_"1"
"RTN","SAMIFLD",351,0)
 ;
"RTN","SAMIFLD",352,0)
 ;@stanza 3 termination
"RTN","SAMIFLD",353,0)
 ;
"RTN","SAMIFLD",354,0)
 quit g3 ; end of $$XPAND
"RTN","SAMIFLD",355,0)
 ;
"RTN","SAMIFLD",356,0)
 ;
"RTN","SAMIFLD",357,0)
 ;
"RTN","SAMIFLD",358,0)
 ;
"RTN","SAMIFLD",359,0)
 ;@pps $$GETHDR^SAMIFLD
"RTN","SAMIFLD",360,0)
 ;
"RTN","SAMIFLD",361,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",362,0)
 ;
"RTN","SAMIFLD",363,0)
 ;ven/gpl;pps;function;clean;silent;sac;tests?;port
"RTN","SAMIFLD",364,0)
 ;@signature
"RTN","SAMIFLD",365,0)
 ; $$GETHDR^SAMIFLD(sid)
"RTN","SAMIFLD",366,0)
 ;@called-by
"RTN","SAMIFLD",367,0)
 ; LOAD^SAMIFLD
"RTN","SAMIFLD",368,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIFLD",369,0)
 ;@calls
"RTN","SAMIFLD",370,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",371,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMIFLD",372,0)
 ; ^%DT
"RTN","SAMIFLD",373,0)
 ; $$NOW^XLFDT
"RTN","SAMIFLD",374,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIFLD",375,0)
 ;@input
"RTN","SAMIFLD",376,0)
 ; sid = patient study id
"RTN","SAMIFLD",377,0)
 ;@output = header string (patient id dob age gender)
"RTN","SAMIFLD",378,0)
 ;@tests
"RTN","SAMIFLD",379,0)
 ; UTGETHDR^SAMIUTF hdr string for patient sid
"RTN","SAMIFLD",380,0)
 ;@to-do
"RTN","SAMIFLD",381,0)
 ;  convert to pps GETHDR^SAMIFORM
"RTN","SAMIFLD",382,0)
 ;
"RTN","SAMIFLD",383,0)
 ;
"RTN","SAMIFLD",384,0)
GETHDR(sid) ; header string for patient sid
"RTN","SAMIFLD",385,0)
 ;
"RTN","SAMIFLD",386,0)
 ;@stanza 2 find patient
"RTN","SAMIFLD",387,0)
 ;
"RTN","SAMIFLD",388,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",389,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",390,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",391,0)
 new dfn set dfn=@root@(ien,"dfn")
"RTN","SAMIFLD",392,0)
 quit:ien=""
"RTN","SAMIFLD",393,0)
 ;
"RTN","SAMIFLD",394,0)
 ;
"RTN","SAMIFLD",395,0)
 ;@stanza 3 prefill with vista data
"RTN","SAMIFLD",396,0)
 ;
"RTN","SAMIFLD",397,0)
 ; do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",398,0)
 if $get(@root@(ien,"ssn"))="" do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",399,0)
 if $get(@root@(ien,"sbdob"))=-1 do PREFILL^SAMIHOM3(dfn) ; update from Vista
"RTN","SAMIFLD",400,0)
 ;
"RTN","SAMIFLD",401,0)
 ;
"RTN","SAMIFLD",402,0)
 ;@stanza 4 ssn
"RTN","SAMIFLD",403,0)
 ;
"RTN","SAMIFLD",404,0)
 n pssn s pssn="" ; will be ssn with dashes
"RTN","SAMIFLD",405,0)
 ; if $get(@root@(ien,"ssn"))="" quit "" ; patient info not available
"RTN","SAMIFLD",406,0)
 if $get(@root@(ien,"ssn"))'="" do  ;
"RTN","SAMIFLD",407,0)
 . set pssn=$get(@root@(ien,"sissn"))
"RTN","SAMIFLD",408,0)
 . if pssn["sta" set pssn=""
"RTN","SAMIFLD",409,0)
 . if pssn="" do  ;
"RTN","SAMIFLD",410,0)
 . . new orgssn
"RTN","SAMIFLD",411,0)
 . . set orgssn=$get(@root@(ien,"ssn"))
"RTN","SAMIFLD",412,0)
 . . quit:orgssn=""
"RTN","SAMIFLD",413,0)
 . . set pssn=$extract(orgssn,1,3)_"-"_$extract(orgssn,4,5)_"-"_$extract(orgssn,6,9)
"RTN","SAMIFLD",414,0)
 . . set @root@(ien,"sissn")=pssn
"RTN","SAMIFLD",415,0)
 . . quit
"RTN","SAMIFLD",416,0)
 . . q
"RTN","SAMIFLD",417,0)
 . q
"RTN","SAMIFLD",418,0)
 ;
"RTN","SAMIFLD",419,0)
 ;
"RTN","SAMIFLD",420,0)
 ;@stanza 5 age
"RTN","SAMIFLD",421,0)
 ;
"RTN","SAMIFLD",422,0)
 new dob set dob=$get(@root@(ien,"sbdob")) ; dob in VAPALS format
"RTN","SAMIFLD",423,0)
 i dob["-" s dob=$e(dob,6,7)_"/"_$e(dob,9,10)_"/"_$e(dob,1,4)
"RTN","SAMIFLD",424,0)
 i dob'["/" s dob=$e(dob,5,6)_"/"_$e(dob,7,8)_"/"_$e(dob,1,4)
"RTN","SAMIFLD",425,0)
 new X set X=dob
"RTN","SAMIFLD",426,0)
 new Y
"RTN","SAMIFLD",427,0)
 do ^%DT
"RTN","SAMIFLD",428,0)
 ;
"RTN","SAMIFLD",429,0)
 ; change ven/lgc 20190628 - calculate age with Mash
"RTN","SAMIFLD",430,0)
 ;new age set age=$piece($$FMDIFF^XLFDT($$NOW^XLFDT,Y)/365,".")
"RTN","SAMIFLD",431,0)
 new age s age=$$age^%th(Y)
"RTN","SAMIFLD",432,0)
 ; look for similar constructs throughout SMAI to convert to Mash
"RTN","SAMIFLD",433,0)
 ;
"RTN","SAMIFLD",434,0)
 set @root@(ien,"age")=age
"RTN","SAMIFLD",435,0)
 ;
"RTN","SAMIFLD",436,0)
 ;
"RTN","SAMIFLD",437,0)
 ;@stanza 6 sex, mrn, pid, assemble header
"RTN","SAMIFLD",438,0)
 ;
"RTN","SAMIFLD",439,0)
 new sex set sex=$get(@root@(ien,"sex"))
"RTN","SAMIFLD",440,0)
 ;
"RTN","SAMIFLD",441,0)
 new simrn,sipid
"RTN","SAMIFLD",442,0)
 set simrn=$$GETMRN(sid,.sipid)
"RTN","SAMIFLD",443,0)
 ;set sipid=$g(@root@(ien,"sipid"))
"RTN","SAMIFLD",444,0)
 ;
"RTN","SAMIFLD",445,0)
 new rtn set rtn=""
"RTN","SAMIFLD",446,0)
 if simrn'="" do  ;
"RTN","SAMIFLD",447,0)
 . set rtn=sipid_" "_simrn_" DOB: "_dob_" GENDER: "_sex
"RTN","SAMIFLD",448,0)
 else  do  ;
"RTN","SAMIFLD",449,0)
 . set rtn=pssn_" DOB: "_dob_" AGE: "_age_" GENDER: "_sex
"RTN","SAMIFLD",450,0)
 ;
"RTN","SAMIFLD",451,0)
 ;
"RTN","SAMIFLD",452,0)
 ;@stanza 7 termination
"RTN","SAMIFLD",453,0)
 ;
"RTN","SAMIFLD",454,0)
 quit rtn ; end of pps $$GETHDR^SAMIFLD
"RTN","SAMIFLD",455,0)
 ;
"RTN","SAMIFLD",456,0)
 ;
"RTN","SAMIFLD",457,0)
 ;
"RTN","SAMIFLD",458,0)
 ;
"RTN","SAMIFLD",459,0)
 ;@func $$GETMRN
"RTN","SAMIFLD",460,0)
 ;
"RTN","SAMIFLD",461,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",462,0)
 ;
"RTN","SAMIFLD",463,0)
 ;ven/gpl;private;function;clean;silent;sac;tests?;port
"RTN","SAMIFLD",464,0)
 ;@called-by
"RTN","SAMIFLD",465,0)
 ; $$GETHDR^SAMIFLD
"RTN","SAMIFLD",466,0)
 ;@calls
"RTN","SAMIFLD",467,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",468,0)
 ;@input
"RTN","SAMIFLD",469,0)
 ; sid = patient study id
"RTN","SAMIFLD",470,0)
 ;@output = medical record #
"RTN","SAMIFLD",471,0)
 ;.pid = patient id
"RTN","SAMIFLD",472,0)
 ;@tests
"RTN","SAMIFLD",473,0)
 ; UTGETHDR^SAMIUTF hdr string for patient sid
"RTN","SAMIFLD",474,0)
 ;@to-do
"RTN","SAMIFLD",475,0)
 ;  convert to pps GETHDR^SAMIFORM
"RTN","SAMIFLD",476,0)
 ;
"RTN","SAMIFLD",477,0)
 ;
"RTN","SAMIFLD",478,0)
GETMRN(sid,pid) ; get MRN, which supercedes ssn as patient id
"RTN","SAMIFLD",479,0)
 ;
"RTN","SAMIFLD",480,0)
 ;@stanza 2 calculate mrn & pid
"RTN","SAMIFLD",481,0)
 ;
"RTN","SAMIFLD",482,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",483,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",484,0)
 new simrn,sipid
"RTN","SAMIFLD",485,0)
 ;set simrn=$get(@root@(ien,"simrn"))
"RTN","SAMIFLD",486,0)
 ;set sipid=$get(@root@(ien,"sipid"))
"RTN","SAMIFLD",487,0)
 set (simrn,sipid)=""
"RTN","SAMIFLD",488,0)
 ;
"RTN","SAMIFLD",489,0)
 if simrn="" d  ;
"RTN","SAMIFLD",490,0)
 . new siform
"RTN","SAMIFLD",491,0)
 . set siform=$order(@root@("graph",sid,"siform"))
"RTN","SAMIFLD",492,0)
 . quit:siform=""
"RTN","SAMIFLD",493,0)
 . set simrn=$get(@root@("graph",sid,siform,"simrn"))
"RTN","SAMIFLD",494,0)
 . q
"RTN","SAMIFLD",495,0)
 ;
"RTN","SAMIFLD",496,0)
 if sipid="" d  ;
"RTN","SAMIFLD",497,0)
 . new siform
"RTN","SAMIFLD",498,0)
 . set siform=$order(@root@("graph",sid,"siform"))
"RTN","SAMIFLD",499,0)
 . quit:siform=""
"RTN","SAMIFLD",500,0)
 . set sipid=$get(@root@("graph",sid,siform,"sipid"))
"RTN","SAMIFLD",501,0)
 . set pid=sipid
"RTN","SAMIFLD",502,0)
 . q
"RTN","SAMIFLD",503,0)
 ;
"RTN","SAMIFLD",504,0)
 ;
"RTN","SAMIFLD",505,0)
 ;@stanza 3 termination
"RTN","SAMIFLD",506,0)
 ;
"RTN","SAMIFLD",507,0)
 quit simrn ; end of $$GETMRN
"RTN","SAMIFLD",508,0)
 ;
"RTN","SAMIFLD",509,0)
 ;
"RTN","SAMIFLD",510,0)
 ;
"RTN","SAMIFLD",511,0)
 ;
"RTN","SAMIFLD",512,0)
 ;@section 2 code for ppses $$GETLAST5^SAMIFORM, FIXSRC^SAMIFORM, and
"RTN","SAMIFLD",513,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIFLD",514,0)
 ;
"RTN","SAMIFLD",515,0)
 ;
"RTN","SAMIFLD",516,0)
 ;
"RTN","SAMIFLD",517,0)
 ;
"RTN","SAMIFLD",518,0)
 ;@pps-code $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",519,0)
 ;
"RTN","SAMIFLD",520,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",521,0)
 ;
"RTN","SAMIFLD",522,0)
 ;ven/gpl;pps;function;clean?;silent;sac?;tests?;port?
"RTN","SAMIFLD",523,0)
 ;@signature
"RTN","SAMIFLD",524,0)
 ; $$GETLAST5^SAMIFORM(sid)
"RTN","SAMIFLD",525,0)
 ;@branches-from
"RTN","SAMIFLD",526,0)
 ; GETLAST5^SAMIFORM
"RTN","SAMIFLD",527,0)
 ;@pps-called-by
"RTN","SAMIFLD",528,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",529,0)
 ; LOAD
"RTN","SAMIFLD",530,0)
 ;@called-by none
"RTN","SAMIFLD",531,0)
 ;@calls
"RTN","SAMIFLD",532,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",533,0)
 ;@input
"RTN","SAMIFLD",534,0)
 ; sid = patient study id
"RTN","SAMIFLD",535,0)
 ;@output = patient's BS5 (first initial of last name, last 4 of ssn)
"RTN","SAMIFLD",536,0)
 ;@tests
"RTN","SAMIFLD",537,0)
 ; UTGLST5^SAMIUTF2 last5 for patient sid
"RTN","SAMIFLD",538,0)
 ;
"RTN","SAMIFLD",539,0)
 ;
"RTN","SAMIFLD",540,0)
GETLAST5 ; last5 for patient sid
"RTN","SAMIFLD",541,0)
 ;
"RTN","SAMIFLD",542,0)
 ;@stanza 2 calculate it
"RTN","SAMIFLD",543,0)
 ;
"RTN","SAMIFLD",544,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",545,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",546,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",547,0)
 quit:ien=""
"RTN","SAMIFLD",548,0)
 ;
"RTN","SAMIFLD",549,0)
 ;
"RTN","SAMIFLD",550,0)
 ;@stanza 3 termination
"RTN","SAMIFLD",551,0)
 ;
"RTN","SAMIFLD",552,0)
 quit $get(@root@(ien,"last5")) ; end of pps $$GETLAST5^SAMIFORM
"RTN","SAMIFLD",553,0)
 ;
"RTN","SAMIFLD",554,0)
 ;
"RTN","SAMIFLD",555,0)
 ;
"RTN","SAMIFLD",556,0)
 ;
"RTN","SAMIFLD",557,0)
 ;@pps-code FIXSRC^SAMIFORM
"RTN","SAMIFLD",558,0)
 ;
"RTN","SAMIFLD",559,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",560,0)
 ;
"RTN","SAMIFLD",561,0)
 ;ven/gpl;pps;procedure;clean?;silent?;sac?;tests?;port?
"RTN","SAMIFLD",562,0)
 ;@signature
"RTN","SAMIFLD",563,0)
 ; do FIXSRC^SAMIFORM(.SAMILINE)
"RTN","SAMIFLD",564,0)
 ;@branches-from
"RTN","SAMIFLD",565,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIFLD",566,0)
 ;@pps-called-by
"RTN","SAMIFLD",567,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",568,0)
 ; GETHOME^SAMIHOM3 [redacted]
"RTN","SAMIFLD",569,0)
 ; LOAD
"RTN","SAMIFLD",570,0)
 ;@called-by none
"RTN","SAMIFLD",571,0)
 ;@calls
"RTN","SAMIFLD",572,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",573,0)
 ;@thruput
"RTN","SAMIFLD",574,0)
 ;.SAMILINE = line of html to change
"RTN","SAMIFLD",575,0)
 ;@tests
"RTN","SAMIFLD",576,0)
 ; UTFSRC^SAMIUTF2 fix html src lines to use resources in see/
"RTN","SAMIFLD",577,0)
 ;
"RTN","SAMIFLD",578,0)
 ;
"RTN","SAMIFLD",579,0)
FIXSRC ; fix html src lines to use resources in see/
"RTN","SAMIFLD",580,0)
 ;
"RTN","SAMIFLD",581,0)
 if SAMILINE["src=" do  ;
"RTN","SAMIFLD",582,0)
 . if SAMILINE["src=""http" quit
"RTN","SAMIFLD",583,0)
 . if SAMILINE["src=""/" do  quit
"RTN","SAMIFLD",584,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=""/","src=""/see/sami/")
"RTN","SAMIFLD",585,0)
 . . quit
"RTN","SAMIFLD",586,0)
 . if SAMILINE["src=""" do  quit
"RTN","SAMIFLD",587,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=""","src=""/see/sami/")
"RTN","SAMIFLD",588,0)
 . . quit
"RTN","SAMIFLD",589,0)
 . if SAMILINE["src=" do
"RTN","SAMIFLD",590,0)
 . . do findReplaceAll^%ts(.SAMILINE,"src=","src=/see/sami/")
"RTN","SAMIFLD",591,0)
 . . quit
"RTN","SAMIFLD",592,0)
 . quit
"RTN","SAMIFLD",593,0)
 ;
"RTN","SAMIFLD",594,0)
 quit  ; end of pps FIXSRC^SAMIFORM
"RTN","SAMIFLD",595,0)
 ;
"RTN","SAMIFLD",596,0)
 ;
"RTN","SAMIFLD",597,0)
 ;
"RTN","SAMIFLD",598,0)
 ;
"RTN","SAMIFLD",599,0)
 ;@pps-code FIXHREF^SAMIFORM
"RTN","SAMIFLD",600,0)
 ;
"RTN","SAMIFLD",601,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",602,0)
 ;
"RTN","SAMIFLD",603,0)
 ;ven/gpl;pps;procedure;clean?;silent?;sac?;tests?;port?
"RTN","SAMIFLD",604,0)
 ;@signature
"RTN","SAMIFLD",605,0)
 ; do FIXHREF^SAMIFORM(.SAMILINE)
"RTN","SAMIFLD",606,0)
 ;@branches-from
"RTN","SAMIFLD",607,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIFLD",608,0)
 ;@pps-called-by
"RTN","SAMIFLD",609,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",610,0)
 ; GETHOME^SAMIHOM3 [redacted]
"RTN","SAMIFLD",611,0)
 ; LOAD
"RTN","SAMIFLD",612,0)
 ;@called-by none
"RTN","SAMIFLD",613,0)
 ;@calls
"RTN","SAMIFLD",614,0)
 ; findReplaceAll^%ts
"RTN","SAMIFLD",615,0)
 ;@thruput
"RTN","SAMIFLD",616,0)
 ;.SAMILINE = line of html to change
"RTN","SAMIFLD",617,0)
 ;@tests
"RTN","SAMIFLD",618,0)
 ; UTFHREF^SAMIUTF2 fix html href lines to use resources in see/
"RTN","SAMIFLD",619,0)
 ;
"RTN","SAMIFLD",620,0)
 ;
"RTN","SAMIFLD",621,0)
FIXHREF ; fix html href lines to use resources in see/
"RTN","SAMIFLD",622,0)
 ;
"RTN","SAMIFLD",623,0)
 if SAMILINE["href=" do  ;
"RTN","SAMIFLD",624,0)
 . quit:SAMILINE["href=""#"
"RTN","SAMIFLD",625,0)
 . quit:SAMILINE["href='#"
"RTN","SAMIFLD",626,0)
 . quit:SAMILINE["href=""http"
"RTN","SAMIFLD",627,0)
 . quit:SAMILINE["/vapals"
"RTN","SAMIFLD",628,0)
 . if SAMILINE["href=""/" do  quit
"RTN","SAMIFLD",629,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=""/","href=""/","href=""/see/sami/")
"RTN","SAMIFLD",630,0)
 . . quit
"RTN","SAMIFLD",631,0)
 . if SAMILINE["href=""" do  quit
"RTN","SAMIFLD",632,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=""","href=""/see/sami/")
"RTN","SAMIFLD",633,0)
 . . quit
"RTN","SAMIFLD",634,0)
 . if SAMILINE["href=" do  quit
"RTN","SAMIFLD",635,0)
 . . do findReplaceAll^%ts(.SAMILINE,"href=","href=/see/sami/")
"RTN","SAMIFLD",636,0)
 . . quit
"RTN","SAMIFLD",637,0)
 . quit
"RTN","SAMIFLD",638,0)
 ;
"RTN","SAMIFLD",639,0)
 quit  ; end of pps FIXHREF^SAMIFORM
"RTN","SAMIFLD",640,0)
 ;
"RTN","SAMIFLD",641,0)
 ;
"RTN","SAMIFLD",642,0)
 ;
"RTN","SAMIFLD",643,0)
 ;
"RTN","SAMIFLD",644,0)
 ;@section 3 code for ppses $$GETNAME^SAMIFORM, $$GETSSN^SAMIFORM, and
"RTN","SAMIFLD",645,0)
 ; $$GETPRFX^SAMIFORM
"RTN","SAMIFLD",646,0)
 ;
"RTN","SAMIFLD",647,0)
 ;
"RTN","SAMIFLD",648,0)
 ;
"RTN","SAMIFLD",649,0)
 ;
"RTN","SAMIFLD",650,0)
 ;@pps-code $$GETNAME^SAMIFORM
"RTN","SAMIFLD",651,0)
 ;
"RTN","SAMIFLD",652,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",653,0)
 ;
"RTN","SAMIFLD",654,0)
 ;ven/gpl;pps;function;clean?;silent?;sac?;tests?;port?
"RTN","SAMIFLD",655,0)
 ;@signature
"RTN","SAMIFLD",656,0)
 ; $$GETNAME^SAMIFORM(sid)
"RTN","SAMIFLD",657,0)
 ;@branches-from
"RTN","SAMIFLD",658,0)
 ; GETNAME^SAMIFORM
"RTN","SAMIFLD",659,0)
 ;@pps-called-by
"RTN","SAMIFLD",660,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",661,0)
 ;@called-by none
"RTN","SAMIFLD",662,0)
 ;@calls
"RTN","SAMIFLD",663,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",664,0)
 ;@input
"RTN","SAMIFLD",665,0)
 ; sid = patient study id
"RTN","SAMIFLD",666,0)
 ;@output = patient's name
"RTN","SAMIFLD",667,0)
 ;@tests
"RTN","SAMIFLD",668,0)
 ; UTGTNM^SAMIUTF2 name for patient sid
"RTN","SAMIFLD",669,0)
 ;
"RTN","SAMIFLD",670,0)
GETNAME ; name for patient sid
"RTN","SAMIFLD",671,0)
 ;
"RTN","SAMIFLD",672,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",673,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",674,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",675,0)
 quit:ien=""
"RTN","SAMIFLD",676,0)
 ;
"RTN","SAMIFLD",677,0)
 quit @root@(ien,"saminame") ; end of pps $$GETNAME^SAMIFORM
"RTN","SAMIFLD",678,0)
 ;
"RTN","SAMIFLD",679,0)
 ;
"RTN","SAMIFLD",680,0)
 ;
"RTN","SAMIFLD",681,0)
 ;
"RTN","SAMIFLD",682,0)
 ;@pps-code $$GETSSN^SAMIFORM
"RTN","SAMIFLD",683,0)
 ;
"RTN","SAMIFLD",684,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",685,0)
 ;
"RTN","SAMIFLD",686,0)
 ;ven/gpl;pps;function;clean?;silent?;sac?;tests?;port?
"RTN","SAMIFLD",687,0)
 ;@signature
"RTN","SAMIFLD",688,0)
 ; $$GETSSN^SAMIFORM(sid)
"RTN","SAMIFLD",689,0)
 ;@branches-from
"RTN","SAMIFLD",690,0)
 ; GETSSN^SAMIFORM
"RTN","SAMIFLD",691,0)
 ;@pps-called-by
"RTN","SAMIFLD",692,0)
 ; WSCASE^SAMICAS2
"RTN","SAMIFLD",693,0)
 ; NUHREF^SAMIUR
"RTN","SAMIFLD",694,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIFLD",695,0)
 ;@called-by none
"RTN","SAMIFLD",696,0)
 ;@calls
"RTN","SAMIFLD",697,0)
 ; $$setroot^%wd
"RTN","SAMIFLD",698,0)
 ;@input
"RTN","SAMIFLD",699,0)
 ; sid = patient study id
"RTN","SAMIFLD",700,0)
 ;@output = patient's ssn
"RTN","SAMIFLD",701,0)
 ;@tests
"RTN","SAMIFLD",702,0)
 ; UTGSSN^SAMIUTF2 ssn for patient sid
"RTN","SAMIFLD",703,0)
 ;
"RTN","SAMIFLD",704,0)
 ;
"RTN","SAMIFLD",705,0)
GETSSN ; ssn for patient sid
"RTN","SAMIFLD",706,0)
 ;
"RTN","SAMIFLD",707,0)
 quit:$get(sid)="" ""
"RTN","SAMIFLD",708,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIFLD",709,0)
 new ien set ien=$order(@root@("sid",sid,""))
"RTN","SAMIFLD",710,0)
 quit:ien=""
"RTN","SAMIFLD",711,0)
 ;
"RTN","SAMIFLD",712,0)
 new pssn set pssn=$get(@root@(ien,"sissn"))
"RTN","SAMIFLD",713,0)
 if pssn["sta" set pssn=""
"RTN","SAMIFLD",714,0)
 if pssn="" do  ;
"RTN","SAMIFLD",715,0)
 . new orgssn set orgssn=$get(@root@(ien,"ssn"))
"RTN","SAMIFLD",716,0)
 . quit:orgssn=""
"RTN","SAMIFLD",717,0)
 . set pssn=$extract(orgssn,1,3)_"-"_$extract(orgssn,4,5)_"-"_$extract(orgssn,6,9)
"RTN","SAMIFLD",718,0)
 . set @root@(ien,"sissn")=pssn
"RTN","SAMIFLD",719,0)
 . quit
"RTN","SAMIFLD",720,0)
 ;
"RTN","SAMIFLD",721,0)
 quit pssn ; end of pps $$GETSSN^SAMIFORM
"RTN","SAMIFLD",722,0)
 ;
"RTN","SAMIFLD",723,0)
 ;
"RTN","SAMIFLD",724,0)
 ;
"RTN","SAMIFLD",725,0)
 ;
"RTN","SAMIFLD",726,0)
 ;@pps-code $$GETPRFX^SAMIFORM [deprecated]
"RTN","SAMIFLD",727,0)
 ;
"RTN","SAMIFLD",728,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIFLD",729,0)
 ;
"RTN","SAMIFLD",730,0)
 ;ven/gpl;pps;function;clean;silent;sac;tests?;port
"RTN","SAMIFLD",731,0)
 ;@signature
"RTN","SAMIFLD",732,0)
 ; $$GETPRFX^SAMIFORM()
"RTN","SAMIFLD",733,0)
 ;@branches-from
"RTN","SAMIFLD",734,0)
 ; GETPRFX^SAMIFORM
"RTN","SAMIFLD",735,0)
 ;@pps-called-by
"RTN","SAMIFLD",736,0)
 ; WSCASE^SAMICAS2 [commented out]
"RTN","SAMIFLD",737,0)
 ; $$GENSTDID^SAMIHOM3 [commented out]
"RTN","SAMIFLD",738,0)
 ;@calls
"RTN","SAMIFLD",739,0)
 ; $$GET^XPAR [commented out]
"RTN","SAMIFLD",740,0)
 ;@output = patient's ssn
"RTN","SAMIFLD",741,0)
 ;@tests
"RTN","SAMIFLD",742,0)
 ; None yet
"RTN","SAMIFLD",743,0)
 ;
"RTN","SAMIFLD",744,0)
 ;
"RTN","SAMIFLD",745,0)
GETPRFX ; retrieve study ID prefix from parameter file
"RTN","SAMIFLD",746,0)
 ;
"RTN","SAMIFLD",747,0)
 ; This subroutine is deprecated as of the multi-tenancy features.
"RTN","SAMIFLD",748,0)
 ;
"RTN","SAMIFLD",749,0)
 new prefix
"RTN","SAMIFLD",750,0)
 ;set prefix=$$GET^XPAR("SYS","SAMI SID PREFIX",,"Q")
"RTN","SAMIFLD",751,0)
 s prefix=$g(ARG("siteid"))
"RTN","SAMIFLD",752,0)
 i prefix="" s prefix=$g(ARG("site"))
"RTN","SAMIFLD",753,0)
 if $get(prefix)="" set prefix="UNK"
"RTN","SAMIFLD",754,0)
 ;
"RTN","SAMIFLD",755,0)
 quit prefix ; end of pps $$GETPRFX^SAMIFORM
"RTN","SAMIFLD",756,0)
 ;
"RTN","SAMIFLD",757,0)
 ;
"RTN","SAMIFLD",758,0)
 ;
"RTN","SAMIFLD",759,0)
EOR ; end of routine SAMIFLD
"RTN","SAMIFUL")
0^13^B129814
"RTN","SAMIFUL",1,0)
SAMIFUL ;ven/gpl - form log; 2024-08-22t21:10z
"RTN","SAMIFUL",2,0)
 ;;18.0;SAMI;**10,17**;2020-01-17;Build 8
"RTN","SAMIFUL",3,0)
 ;mdc-e1;SAMIFUL-20240822-E03dV8nE;SAMI-18-17-b6
"RTN","SAMIFUL",4,0)
 ;mdc-v7;B129814;SAMI*18.0*17 SEQ #17
"RTN","SAMIFUL",5,0)
 ;
"RTN","SAMIFUL",6,0)
 ; SAMIFUL contains routine & module info & the primary development
"RTN","SAMIFUL",7,0)
 ; log for ScreeningPlus's Form modules, SAMIF*. It contains no public
"RTN","SAMIFUL",8,0)
 ; interfaces or executable code.
"RTN","SAMIFUL",9,0)
 ;
"RTN","SAMIFUL",10,0)
 quit  ; no entry from top
"RTN","SAMIFUL",11,0)
 ;
"RTN","SAMIFUL",12,0)
 ;
"RTN","SAMIFUL",13,0)
 ;
"RTN","SAMIFUL",14,0)
 ;
"RTN","SAMIFUL",15,0)
 ;@section 0 primary development
"RTN","SAMIFUL",16,0)
 ;
"RTN","SAMIFUL",17,0)
 ;
"RTN","SAMIFUL",18,0)
 ;
"RTN","SAMIFUL",19,0)
 ;
"RTN","SAMIFUL",20,0)
 ;@routine-credits
"RTN","SAMIFUL",21,0)
 ;
"RTN","SAMIFUL",22,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIFUL",23,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIFUL",24,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIFUL",25,0)
 ; http://vistaexpertise.net
"RTN","SAMIFUL",26,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIFUL",27,0)
 ;@license Apache 2.0
"RTN","SAMIFUL",28,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMIFUL",29,0)
 ;
"RTN","SAMIFUL",30,0)
 ;@update 2024-08-22t21:10z
"RTN","SAMIFUL",31,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIFUL",32,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIFUL",33,0)
 ;@module Forms - SAMIF
"RTN","SAMIFUL",34,0)
 ;@release 18-17
"RTN","SAMIFUL",35,0)
 ;@edition-date 2020-01-17
"RTN","SAMIFUL",36,0)
 ;@patches **10,17**
"RTN","SAMIFUL",37,0)
 ;
"RTN","SAMIFUL",38,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIFUL",39,0)
 ; toad@vistaexpertise.net
"RTN","SAMIFUL",40,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIFUL",41,0)
 ; lgc@vistaexpertise.net
"RTN","SAMIFUL",42,0)
 ;@dev-add Alexis Carlson (arc)
"RTN","SAMIFUL",43,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMIFUL",44,0)
 ;@dev-add Domenic DiNatale (dom)
"RTN","SAMIFUL",45,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMIFUL",46,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIFUL",47,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIFUL",48,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIFUL",49,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIFUL",50,0)
 ;
"RTN","SAMIFUL",51,0)
 ;@module-credits
"RTN","SAMIFUL",52,0)
 ;
"RTN","SAMIFUL",53,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIFUL",54,0)
 ; (VA-PALS)
"RTN","SAMIFUL",55,0)
 ; http://va-pals.org/
"RTN","SAMIFUL",56,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIFUL",57,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIFUL",58,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIFUL",59,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIFUL",60,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIFUL",61,0)
 ; http://ielcap.com/
"RTN","SAMIFUL",62,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIFUL",63,0)
 ; http://paraxialtech.com/
"RTN","SAMIFUL",64,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIFUL",65,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIFUL",66,0)
 ;
"RTN","SAMIFUL",67,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIFUL",68,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIFUL",69,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIFUL",70,0)
 ;@partner-org par
"RTN","SAMIFUL",71,0)
 ;
"RTN","SAMIFUL",72,0)
 ;@module-log
"RTN","SAMIFUL",73,0)
 ;
"RTN","SAMIFUL",74,0)
 ; 2017-09-19 ven/gpl 18-t1 
"RTN","SAMIFUL",75,0)
 ;  SAMIFRM initialize SAMI FORM file from elcap-patient graphs,
"RTN","SAMIFUL",76,0)
 ; using mash tools & graphs (%yottaq,^%wd).
"RTN","SAMIFUL",77,0)
 ;
"RTN","SAMIFUL",78,0)
 ; 2017-09-18 ven/gpl 18-t1
"RTN","SAMIFUL",79,0)
 ;  SAMIFRM update.
"RTN","SAMIFUL",80,0)
 ;
"RTN","SAMIFUL",81,0)
 ; 2017-12-18 ven/gpl 18-t1
"RTN","SAMIFUL",82,0)
 ;  SAMIFRM update.
"RTN","SAMIFUL",83,0)
 ;
"RTN","SAMIFUL",84,0)
 ; 2018-01-03 ven/gpl 18-t1
"RTN","SAMIFUL",85,0)
 ;  SAMIFRM update.
"RTN","SAMIFUL",86,0)
 ;
"RTN","SAMIFUL",87,0)
 ; 2018-01-14 ven/gpl 18-t1
"RTN","SAMIFUL",88,0)
 ;  SAMIFRM update.
"RTN","SAMIFUL",89,0)
 ;
"RTN","SAMIFUL",90,0)
 ; 2018-02-04 ven/gpl 18-t1
"RTN","SAMIFUL",91,0)
 ;  SAMIFRM update.
"RTN","SAMIFUL",92,0)
 ;
"RTN","SAMIFUL",93,0)
 ; 2018-02-05/07 ven/toad 18-t4
"RTN","SAMIFUL",94,0)
 ;  SAMIFRM update license & attribution & hdr comments, add white
"RTN","SAMIFUL",95,0)
 ; space & do-dot quits, spell out language elements; in SAMISUBS
"RTN","SAMIFUL",96,0)
 ; replaceAll^%wfhform > replaceAll^%wf; $$setroot^%yottaq > 
"RTN","SAMIFUL",97,0)
 ; $$setroot^%wdgraph; getVals^%yottaq > getVals^%wf.
"RTN","SAMIFUL",98,0)
 ;
"RTN","SAMIFUL",99,0)
 ; 2018-02-14 ven/toad 18-t4
"RTN","SAMIFUL",100,0)
 ;  SAMIFRM replaceAll^%wf > findReplaceAll^%wf, ln > line, add
"RTN","SAMIFUL",101,0)
 ; @calls & @called-by tags, break up some long lines, scope variables
"RTN","SAMIFUL",102,0)
 ; in $$GETDIR & $$GETFN.
"RTN","SAMIFUL",103,0)
 ;
"RTN","SAMIFUL",104,0)
 ; 2018-03-01 ven/toad 18-t4
"RTN","SAMIFUL",105,0)
 ;  SAMIFRM findReplaceAll^%wf > findReplace^%ts.
"RTN","SAMIFUL",106,0)
 ;
"RTN","SAMIFUL",107,0)
 ; 2018-03-07/08 ven/toad 18-t4
"RTN","SAMIFUL",108,0)
 ;  SAMIFRM in SAMISUBS $$setroot^%wdgraph > $$setroot^%wf, fix bug
"RTN","SAMIFUL",109,0)
 ; when r/css w/see.
"RTN","SAMIFUL",110,0)
 ;
"RTN","SAMIFUL",111,0)
 ; 2018-03-18 ven/toad 18-t4
"RTN","SAMIFUL",112,0)
 ;  SAMIFRM2 restore calls to findReplaceAll^%ts.
"RTN","SAMIFUL",113,0)
 ;
"RTN","SAMIFUL",114,0)
 ; 2018-03-21/04-02 ven/gpl 18-t4
"RTN","SAMIFUL",115,0)
 ;  SAMIFRM2 insert max date, chg case review navigation to post,
"RTN","SAMIFUL",116,0)
 ; date order for CT Eval in case review; support incomplete forms
"RTN","SAMIFUL",117,0)
 ; display & processing; fix to not inject html in javascript for case
"RTN","SAMIFUL",118,0)
 ; review navigation; fix followup submit.
"RTN","SAMIFUL",119,0)
 ;
"RTN","SAMIFUL",120,0)
 ; 2018-04-24 ven/gpl 18-t4
"RTN","SAMIFUL",121,0)
 ;  SAMIFRM2 add Pet & Biopsy forms.
"RTN","SAMIFUL",122,0)
 ;
"RTN","SAMIFUL",123,0)
 ; 2018-05-18/21 ven/gpl 18-t4
"RTN","SAMIFUL",124,0)
 ;  SAMIFRM2 convert to new graph, simplify forms processing.
"RTN","SAMIFUL",125,0)
 ;
"RTN","SAMIFUL",126,0)
 ; 2018-05-22 par/dom 18-t4
"RTN","SAMIFUL",127,0)
 ;  SAMIFRM2 VAP-95 - remove code that replaced hard-coded date
"RTN","SAMIFUL",128,0)
 ; w/"today" from backend, no longer needed.
"RTN","SAMIFUL",129,0)
 ;
"RTN","SAMIFUL",130,0)
 ; 2018-05-24 ven/gpl 18-t4
"RTN","SAMIFUL",131,0)
 ;  SAMIFRM2 changes for submit processing on forms.
"RTN","SAMIFUL",132,0)
 ;
"RTN","SAMIFUL",133,0)
 ; 2018-05-25 par/dom 18-t4
"RTN","SAMIFUL",134,0)
 ;  SAMIFRM2 merge pull request 3 fr/OSEHRA/VAP-95-Remove-Today-Text-
"RTN","SAMIFUL",135,0)
 ; Replacement2. VAP-95 remove today text replacement.
"RTN","SAMIFUL",136,0)
 ;
"RTN","SAMIFUL",137,0)
 ; 2018-05-25 ven/gpl 18-t4
"RTN","SAMIFUL",138,0)
 ;  SAMIFRM2 add STUDYID for txt replace; more changes for STUDYID
"RTN","SAMIFUL",139,0)
 ; substitution.
"RTN","SAMIFUL",140,0)
 ;
"RTN","SAMIFUL",141,0)
 ; 2018-07-11 ven/gpl 18-t4
"RTN","SAMIFUL",142,0)
 ;  SAMIFRM2 add FROZEN variable based on samistatus=compete.
"RTN","SAMIFUL",143,0)
 ;
"RTN","SAMIFUL",144,0)
 ; 2018-08-19 ven/gpl 18-t4
"RTN","SAMIFUL",145,0)
 ;  SAMIFRM2 use ssn instead of last5 where available; revise ssn
"RTN","SAMIFUL",146,0)
 ; formatting.
"RTN","SAMIFUL",147,0)
 ;
"RTN","SAMIFUL",148,0)
 ; 2018-09-30 ven/gpl 18-t4
"RTN","SAMIFUL",149,0)
 ;  SAMIFRM2 header & prefill of intake.
"RTN","SAMIFUL",150,0)
 ;
"RTN","SAMIFUL",151,0)
 ; 2018-10-15 ven/gpl 18-t4
"RTN","SAMIFUL",152,0)
 ;  SAMIFRM2 initial user reports: enrollment.
"RTN","SAMIFUL",153,0)
 ;
"RTN","SAMIFUL",154,0)
 ; 2018-10-31 ven/gpl 18-t4
"RTN","SAMIFUL",155,0)
 ;  SAMIFRM2 new input form features, report menu fix.
"RTN","SAMIFUL",156,0)
 ;
"RTN","SAMIFUL",157,0)
 ; 2018-11-13 ven/gpl 18-t4
"RTN","SAMIFUL",158,0)
 ;  SAMIFRM2 SAMIHOM2 > SAMIHOM3.
"RTN","SAMIFUL",159,0)
 ;
"RTN","SAMIFUL",160,0)
 ; 2018-11-14 ven/gpl 18-t4
"RTN","SAMIFUL",161,0)
 ;  SAMIFRM2 fix graph store forms.
"RTN","SAMIFUL",162,0)
 ;
"RTN","SAMIFUL",163,0)
 ; 2018-11-29 ven/lgc 18-t4
"RTN","SAMIFUL",164,0)
 ;  SAMIFRM2 ongoing unit-test work.
"RTN","SAMIFUL",165,0)
 ;
"RTN","SAMIFUL",166,0)
 ; 2018-12-11/12 ven/toad 18-t4
"RTN","SAMIFUL",167,0)
 ;  SAMIFRM2 update chg log; in SAMISUB2 r/last findReplace^%ts w/a
"RTN","SAMIFUL",168,0)
 ; flag & r/w/findReplaceAll^%ts; passim spell out language elements,
"RTN","SAMIFUL",169,0)
 ; update tags called-by, calls, tests; namespace call-by-ref & call-
"RTN","SAMIFUL",170,0)
 ; by-name actuals.
"RTN","SAMIFUL",171,0)
 ;
"RTN","SAMIFUL",172,0)
 ; 2019-01-02/17 ven/toad 18-t4
"RTN","SAMIFUL",173,0)
 ;  SAMIFRM2 update chg log; in INIT1FRM id > form; doc signatures,
"RTN","SAMIFUL",174,0)
 ; web services, unit tests, dmis, ppis, input, output, thruput.
"RTN","SAMIFUL",175,0)
 ;  SAMIFUL create from SAMIFRM2 as primary development log.
"RTN","SAMIFUL",176,0)
 ;  SAMIFLD create from SAMIFRM2 w/SAMISUB2,GETHDR,GETLAST5,FIXSRC,
"RTN","SAMIFUL",177,0)
 ; FIXHREF,GETNAME,GETSSN; SAMISUB2 > LOAD, reroute calls, namespace
"RTN","SAMIFUL",178,0)
 ; filter > SAMIFILTER, %j > SAMILNUM, zhtml > SAMIHTML, vals >
"RTN","SAMIFUL",179,0)
 ; SAMIVALS (& add to params), key > form; convert to ppi-code (no
"RTN","SAMIFUL",180,0)
 ; params); minor edits.
"RTN","SAMIFUL",181,0)
 ;  SAMIFORM create from SAMIFRM2 w/all ppi, dmi, & wsi entry points,
"RTN","SAMIFUL",182,0)
 ; no code, goto code in other routines.
"RTN","SAMIFUL",183,0)
 ;  SAMIFWS create from SAMIFRM2 w/WSSBFORM,WSSIFORM,WSCEFORM;
"RTN","SAMIFUL",184,0)
 ; convert to ppi-code (no params); minor edits.
"RTN","SAMIFUL",185,0)
 ;  SAMIFDM create from SAMIFRM2, INITFRMS > INIT, INIT1FRM > INIT1,
"RTN","SAMIFUL",186,0)
 ; REGFORMS > REGISTER, LOADDATA > IMPORT,PRSFLNM,GETDIR,GETFN;
"RTN","SAMIFUL",187,0)
 ; convert to ppi-code (no params); annotate & minor edits; move unit-
"RTN","SAMIFUL",188,0)
 ; test switch to cover more code.
"RTN","SAMIFUL",189,0)
 ;  related changes:
"RTN","SAMIFUL",190,0)
 ;  SAMICAS2,SAMICASE,SAMIFLD,SAMINOTI,SAMIUR,SAMIUR1,SAMIUTF,%tsfwr,
"RTN","SAMIFUL",191,0)
 ; %tsfwra,%wfhform passim SAMIFRM2 > SAMIFORM.
"RTN","SAMIFUL",192,0)
 ;  SAMIUTST SAMIFRM2 > SAMIFORM, add SAMIFLD,SAMIFDM,SAMIFWS.
"RTN","SAMIFUL",193,0)
 ;
"RTN","SAMIFUL",194,0)
 ; 2019-03-26 ven/lgc 18-t4
"RTN","SAMIFUL",195,0)
 ;  SAMIFLD add changlog code to end of LOAD^SAMIFLD code to account
"RTN","SAMIFUL",196,0)
 ; for new changelog functionality.
"RTN","SAMIFUL",197,0)
 ;
"RTN","SAMIFUL",198,0)
 ; 2019-03-27 ven/lgc 18-t4
"RTN","SAMIFUL",199,0)
 ;  SAMIFWS comment out lines 106, 164, 222 in SAMIFWS;
"RTN","SAMIFUL",200,0)
 ; GETITEMS^SAMICAS2 does not have formal list, may have been part of
"RTN","SAMIFUL",201,0)
 ; temporary debug code.
"RTN","SAMIFUL",202,0)
 ; 106;new items do GETITEMS^SAMICAS2("items",sid)
"RTN","SAMIFUL",203,0)
 ; 164;new items do GETITEMS^SAMICAS2("items",sid)
"RTN","SAMIFUL",204,0)
 ; 222;new items do GETITEMS^SAMICAS2("items",sid)
"RTN","SAMIFUL",205,0)
 ;
"RTN","SAMIFUL",206,0)
 ; 2019-03-28 ven/lgc 18-t4
"RTN","SAMIFUL",207,0)
 ; SAMIFDM in IMPORT account for unit test where we do not wish to
"RTN","SAMIFUL",208,0)
 ; prompt user for directory; also modified directory for json files
"RTN","SAMIFUL",209,0)
 ; in repo.
"RTN","SAMIFUL",210,0)
 ;
"RTN","SAMIFUL",211,0)
 ; 2019-03-29 ven/lgc 18-t4
"RTN","SAMIFUL",212,0)
 ;  SAMIFLD in LOAD include George's new variables for intake notes.
"RTN","SAMIFUL",213,0)
 ;
"RTN","SAMIFUL",214,0)
 ; 2019-04-16 ven/lgc 18-t4 e54b76d1
"RTN","SAMIFUL",215,0)
 ;  SAMIFDM,SAMIFLD,SAMIFORM,SAMIFWS SAMIFRM2 > SAMIFORM.
"RTN","SAMIFUL",216,0)
 ;
"RTN","SAMIFUL",217,0)
 ; 2019-04-16 ven/lgc 18-t4 e54b76d1
"RTN","SAMIFUL",218,0)
 ;  SAMINOT1 SAMIFRM2 > SAMIFORM.
"RTN","SAMIFUL",219,0)
 ;
"RTN","SAMIFUL",220,0)
 ; 2019-04-18 ven/gpl 18-t4 2b6f0d63
"RTN","SAMIFUL",221,0)
 ;  SAMIFLD fix missing patient name.
"RTN","SAMIFUL",222,0)
 ;
"RTN","SAMIFUL",223,0)
 ; 2019-04-22 ven/lgc 18-t4 e7afbfa1
"RTN","SAMIFUL",224,0)
 ;  SAMIFWS removal of SAMIFRM2 reference.
"RTN","SAMIFUL",225,0)
 ;
"RTN","SAMIFUL",226,0)
 ; 2019-04-23 ven/lgc 18-t4 529e8f2f,89bffd3b
"RTN","SAMIFUL",227,0)
 ;  SAMIFDM comment out zwrite commands.
"RTN","SAMIFUL",228,0)
 ;  SAMIFORM SAMISUB2 > LOAD.
"RTN","SAMIFUL",229,0)
 ;
"RTN","SAMIFUL",230,0)
 ; 2019-05-08 ven/lgc 18-t4 33dfa8c2
"RTN","SAMIFUL",231,0)
 ;  SAMIFDM replace zsystem command with MASH call.
"RTN","SAMIFUL",232,0)
 ;
"RTN","SAMIFUL",233,0)
 ; 2019-06-10/19 ven/arc 18-t4 5d7a987d,c69b6787
"RTN","SAMIFUL",234,0)
 ;  SAMIFDM chg explicit paths, unify paths to unit test json data.
"RTN","SAMIFUL",235,0)
 ;
"RTN","SAMIFUL",236,0)
 ; 2019-06-28/07-08 ven/lgc 18-t4 703c3050
"RTN","SAMIFUL",237,0)
 ;  SAMIFLD fix patient age calculations, calculate patient age
"RTN","SAMIFUL",238,0)
 ; w/MASH age^%th.
"RTN","SAMIFUL",239,0)
 ;
"RTN","SAMIFUL",240,0)
 ; 2019-08-01 ven/arc 18-t4 d710f27d
"RTN","SAMIFUL",241,0)
 ;  SAMIFLD,SAMIFORM pull displayed facility code from vista
"RTN","SAMIFUL",242,0)
 ; parameter.
"RTN","SAMIFUL",243,0)
 ;
"RTN","SAMIFUL",244,0)
 ; 2019-08-03 ven/gpl 18-t4 bea65f7b,ffc94f65
"RTN","SAMIFUL",245,0)
 ;  SAMIFLD fix bugs in Have You Ever Smoked processing in changelog
"RTN","SAMIFUL",246,0)
 ; & intake note, fix smoking status on enrollment report, fix change
"RTN","SAMIFUL",247,0)
 ; log display.
"RTN","SAMIFUL",248,0)
 ;
"RTN","SAMIFUL",249,0)
 ; 2019-08-05 ven/gpl 18-t4 4ee0d3e6
"RTN","SAMIFUL",250,0)
 ;  SAMIFLD add GETPRFX to avoid colision with VAP-435.
"RTN","SAMIFUL",251,0)
 ;
"RTN","SAMIFUL",252,0)
 ; 2019-08-14 ven/gpl 18-t4 0aa37766,4e6f4fdf,08d45d99
"RTN","SAMIFUL",253,0)
 ;  SAMIFLD resolve conflict over semicolon in comment, merge pull
"RTN","SAMIFUL",254,0)
 ; request #70 from OSEHRA/VAP-426-eversmoked, merge with 417.
"RTN","SAMIFUL",255,0)
 ;
"RTN","SAMIFUL",256,0)
 ; 2019-09-26 ven/gpl 18-t4 92b12324 VAP-420
"RTN","SAMIFUL",257,0)
 ;  SAMIFLD add smoking history to intake/followup forms (#75).
"RTN","SAMIFUL",258,0)
 ;
"RTN","SAMIFUL",259,0)
 ; 2019-10-22 ven/lgc 18-t4 613e8ff4
"RTN","SAMIFUL",260,0)
 ;  SAMIFLD update unit test routines for dfn 1.
"RTN","SAMIFUL",261,0)
 ;
"RTN","SAMIFUL",262,0)
 ; 2019-11-22 par/dom 18 b2cc389d VAP-458
"RTN","SAMIFUL",263,0)
 ;  SAMIFLD add new manual registration page.
"RTN","SAMIFUL",264,0)
 ;
"RTN","SAMIFUL",265,0)
 ; 2020-01-21 ven/arc 18 a4c143be
"RTN","SAMIFUL",266,0)
 ;  SAMIFLD patient matching additions.
"RTN","SAMIFUL",267,0)
 ;
"RTN","SAMIFUL",268,0)
 ; 2020-04-07/11 ven/gpl 18-5 36607664,c8f4cf30,2f2c29c1
"RTN","SAMIFUL",269,0)
 ;  SAMIFLD,SAMIFORM,SAMIFWS multi-tenancy.
"RTN","SAMIFUL",270,0)
 ;
"RTN","SAMIFUL",271,0)
 ; 2021-03-16 ven/gpl 18-10 002071de
"RTN","SAMIFUL",272,0)
 ;  SAMIFLD dob age calculation fix from hl7 dob format.
"RTN","SAMIFUL",273,0)
 ;
"RTN","SAMIFUL",274,0)
 ; 2021-03-21 ven/toad 18-10
"RTN","SAMIFUL",275,0)
 ;  SAMIFLD bump date & version, lt refactor.
"RTN","SAMIFUL",276,0)
 ;
"RTN","SAMIFUL",277,0)
 ; 2024-07-22 ven/gpl 18-17-b5 233ae5d
"RTN","SAMIFUL",278,0)
 ;  SAMIFLD use MRN if available as patient ID in hdr.
"RTN","SAMIFUL",279,0)
 ;
"RTN","SAMIFUL",280,0)
 ; 2024-07-24 ven/gpl 18-17-b5 fefbf29
"RTN","SAMIFUL",281,0)
 ; SAMIFLD changes for Mt. Sinai MRN & STUDYID.
"RTN","SAMIFUL",282,0)
 ;
"RTN","SAMIFUL",283,0)
 ; 2024-08-12 ven/lmry 18-17-b5
"RTN","SAMIFUL",284,0)
 ;  SAMIFLD bump versions & dates.
"RTN","SAMIFUL",285,0)
 ;  SAMIFUL add history, bump versions & dates.
"RTN","SAMIFUL",286,0)
 ;
"RTN","SAMIFUL",287,0)
 ; 2024-08-17 ven/lmry 18-17-b6
"RTN","SAMIFUL",288,0)
 ;  SAMIFLD regress version, bump dates.
"RTN","SAMIFUL",289,0)
 ;  SAMIFUL add history, bump versions & dates.
"RTN","SAMIFUL",290,0)
 ;
"RTN","SAMIFUL",291,0)
 ; 2024-08-21/22 ven/toad 18-17-b6
"RTN","SAMIFUL",292,0)
 ;  SAMIFUL,SAMIFLD update version-control lines, dates.
"RTN","SAMIFUL",293,0)
 ;  SAMIFUL update history.
"RTN","SAMIFUL",294,0)
 ;  SAMIFLD annotate, xpand > XPAND.
"RTN","SAMIFUL",295,0)
 ;
"RTN","SAMIFUL",296,0)
 ;
"RTN","SAMIFUL",297,0)
 ;
"RTN","SAMIFUL",298,0)
 ;@contents
"RTN","SAMIFUL",299,0)
 ;
"RTN","SAMIFUL",300,0)
 ; SAMIFORM form library
"RTN","SAMIFUL",301,0)
 ; SAMIFDM form dmi code
"RTN","SAMIFUL",302,0)
 ; SAMIFLD form load
"RTN","SAMIFUL",303,0)
 ; SAMIFWS form web-service code
"RTN","SAMIFUL",304,0)
 ; SAMIFUL form log
"RTN","SAMIFUL",305,0)
 ; SAMIUTF2 form tests
"RTN","SAMIFUL",306,0)
 ;
"RTN","SAMIFUL",307,0)
 ;
"RTN","SAMIFUL",308,0)
 ;
"RTN","SAMIFUL",309,0)
EOR ; end of routine SAMIFUL
"RTN","SAMIHOM4")
0^14^B1262443514
"RTN","SAMIHOM4",1,0)
SAMIHOM4 ;ven/gpl - homepage web services; 2024-08-22t21:11z
"RTN","SAMIHOM4",2,0)
 ;;18.0;SAMI;**1,4,5,6,9,12,15,16,17**;2020-01-17;Build 8
"RTN","SAMIHOM4",3,0)
 ;mdc-e1;SAMIHOM4-20240822-E036GX2U;SAMI-18-17-b6
"RTN","SAMIHOM4",4,0)
 ;mdc-v7;B1262443514;SAMI*18.0*17 SEQ #17
"RTN","SAMIHOM4",5,0)
 ;
"RTN","SAMIHOM4",6,0)
 ; SAMIHOM4 contains web services & other subroutines for producing
"RTN","SAMIHOM4",7,0)
 ; the ELCAP Home Page.
"RTN","SAMIHOM4",8,0)
 ;
"RTN","SAMIHOM4",9,0)
 quit  ; no entry from top
"RTN","SAMIHOM4",10,0)
 ;
"RTN","SAMIHOM4",11,0)
 ;
"RTN","SAMIHOM4",12,0)
 ;
"RTN","SAMIHOM4",13,0)
 ;
"RTN","SAMIHOM4",14,0)
 ;@section 0 primary development
"RTN","SAMIHOM4",15,0)
 ;
"RTN","SAMIHOM4",16,0)
 ;
"RTN","SAMIHOM4",17,0)
 ;
"RTN","SAMIHOM4",18,0)
 ;
"RTN","SAMIHOM4",19,0)
 ;@license see routine SAMIUL
"RTN","SAMIHOM4",20,0)
 ;@documentation see SAMIHUL
"RTN","SAMIHOM4",21,0)
 ;
"RTN","SAMIHOM4",22,0)
 ;@contents
"RTN","SAMIHOM4",23,0)
 ;
"RTN","SAMIHOM4",24,0)
 ;  1. web service get vapals & related subroutines:
"RTN","SAMIHOM4",25,0)
 ; WSHOME code for wsi WSHOME^SAMIHOM3
"RTN","SAMIHOM4",26,0)
 ;    get vapals (vapals-elcap homepage)
"RTN","SAMIHOM4",27,0)
 ; DEVHOME code for wps DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",28,0)
 ;    development home page
"RTN","SAMIHOM4",29,0)
 ; GETHOME code for wps GETHOME^SAMIHOM3
"RTN","SAMIHOM4",30,0)
 ;    get homepage (not subsequent visit)
"RTN","SAMIHOM4",31,0)
 ;
"RTN","SAMIHOM4",32,0)
 ;  2. web service post vapals & related subroutines:
"RTN","SAMIHOM4",33,0)
 ; WSVAPALS code for ws WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",34,0)
 ;    post vapals (main gateway)
"RTN","SAMIHOM4",35,0)
 ;
"RTN","SAMIHOM4",36,0)
 ;  3. other subroutines:
"RTN","SAMIHOM4",37,0)
 ; REG manual registration
"RTN","SAMIHOM4",38,0)
 ; MKPTLK creates patient-lookup record
"RTN","SAMIHOM4",39,0)
 ; UPDTFRMS update demographics in all forms for patient
"RTN","SAMIHOM4",40,0)
 ; MERGE merge participant records
"RTN","SAMIHOM4",41,0)
 ; ADDUNMAT adds unmatched report web service to system
"RTN","SAMIHOM4",42,0)
 ; DELUNMAT deletes unmatched web service
"RTN","SAMIHOM4",43,0)
 ; WSUNMAT navigates to unmatched report
"RTN","SAMIHOM4",44,0)
 ; $$DUPSSN true if duplicate ssn
"RTN","SAMIHOM4",45,0)
 ; $$DUPICN true if duplicate icn
"RTN","SAMIHOM4",46,0)
 ; $$BADICN true if ICN checkdigits are wrong
"RTN","SAMIHOM4",47,0)
 ; SAVE save patient-lookup record after edit
"RTN","SAMIHOM4",48,0)
 ; $$REMATCH possible match ien
"RTN","SAMIHOM4",49,0)
 ; SETINFO set information message text
"RTN","SAMIHOM4",50,0)
 ; SETWARN set warning message text
"RTN","SAMIHOM4",51,0)
 ; RTNERR redisplay page w/error message
"RTN","SAMIHOM4",52,0)
 ; RTNPAGE display page
"RTN","SAMIHOM4",53,0)
 ; REINDXPL reindex patient lookup
"RTN","SAMIHOM4",54,0)
 ; INDXPTLK generate index entries in patient-lookup graph
"RTN","SAMIHOM4",55,0)
 ; UNINDXPT remove index entries from patient-lookup graph
"RTN","SAMIHOM4",56,0)
 ; $$UCASE uppercase
"RTN","SAMIHOM4",57,0)
 ; WSNEWCAS code for wr newcase (creates new case)
"RTN","SAMIHOM4",58,0)
 ;
"RTN","SAMIHOM4",59,0)
 ;@to-do
"RTN","SAMIHOM4",60,0)
 ; Add label comments
"RTN","SAMIHOM4",61,0)
 ;
"RTN","SAMIHOM4",62,0)
 ;
"RTN","SAMIHOM4",63,0)
 ;
"RTN","SAMIHOM4",64,0)
 ;
"RTN","SAMIHOM4",65,0)
 ;@section 1 web service get vapals & related subroutines
"RTN","SAMIHOM4",66,0)
 ;
"RTN","SAMIHOM4",67,0)
 ;
"RTN","SAMIHOM4",68,0)
 ;
"RTN","SAMIHOM4",69,0)
 ;
"RTN","SAMIHOM4",70,0)
 ;@ws-code WSHOME^SAMIHOM3
"RTN","SAMIHOM4",71,0)
 ;
"RTN","SAMIHOM4",72,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",73,0)
 ;
"RTN","SAMIHOM4",74,0)
 ;ven/gpl;ws;procedure;clean;silent;sac;tests;port?
"RTN","SAMIHOM4",75,0)
 ;@signature
"RTN","SAMIHOM4",76,0)
 ; do WSHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",77,0)
 ;@branches-from
"RTN","SAMIHOM4",78,0)
 ; WSHOME^SAMIHOM3
"RTN","SAMIHOM4",79,0)
 ;@ws-called-by
"RTN","SAMIHOM4",80,0)
 ; web service get vapals
"RTN","SAMIHOM4",81,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",82,0)
 ; LOGIN^SAMISITE
"RTN","SAMIHOM4",83,0)
 ;@called-by none
"RTN","SAMIHOM4",84,0)
 ;@calls
"RTN","SAMIHOM4",85,0)
 ; DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",86,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",87,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",88,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",89,0)
 ;@input
"RTN","SAMIHOM4",90,0)
 ; SAMIFILTER (no parameters required)
"RTN","SAMIHOM4",91,0)
 ;@output
"RTN","SAMIHOM4",92,0)
 ; .SAMIRTN
"RTN","SAMIHOM4",93,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",94,0)
 ;@tests
"RTN","SAMIHOM4",95,0)
 ; UTWSHM^SAMIUTH3
"RTN","SAMIHOM4",96,0)
 ; UTWSHM1^SAMIUTH3
"RTN","SAMIHOM4",97,0)
 ; UTWSHM2^SAMIUTH3
"RTN","SAMIHOM4",98,0)
 ;
"RTN","SAMIHOM4",99,0)
 ;
"RTN","SAMIHOM4",100,0)
WSHOME ; get vapals (vapals-elcap homepage)
"RTN","SAMIHOM4",101,0)
 ;
"RTN","SAMIHOM4",102,0)
 ;@stanza 2 route to appropriate homepage or bypass to other webpage
"RTN","SAMIHOM4",103,0)
 ;
"RTN","SAMIHOM4",104,0)
 ; present development homepage for testing
"RTN","SAMIHOM4",105,0)
 if $get(SAMIFILTER("test"))=1 do  quit
"RTN","SAMIHOM4",106,0)
 . do DEVHOME^SAMIHOM3(.SAMIRTN,.SAMIFILTER)
"RTN","SAMIHOM4",107,0)
 . quit
"RTN","SAMIHOM4",108,0)
 ;
"RTN","SAMIHOM4",109,0)
 ; bypass for get access to pages
"RTN","SAMIHOM4",110,0)
 if $g(SAMIFILTER("samiroute"))'="" do  quit
"RTN","SAMIHOM4",111,0)
 . new SAMIBODY set SAMIBODY(1)=""
"RTN","SAMIHOM4",112,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIBODY,.SAMIRTN)
"RTN","SAMIHOM4",113,0)
 . quit
"RTN","SAMIHOM4",114,0)
 ;
"RTN","SAMIHOM4",115,0)
 ; V4W/DLW - bypass for get access from CPRS
"RTN","SAMIHOM4",116,0)
 if $get(SAMIFILTER("dfn"))'="" do  quit
"RTN","SAMIHOM4",117,0)
 . new dfn set dfn=$get(SAMIFILTER("dfn"))
"RTN","SAMIHOM4",118,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",119,0)
 . new studyid set studyid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIHOM4",120,0)
 . new SAMIBODY
"RTN","SAMIHOM4",121,0)
 . if studyid'="" do
"RTN","SAMIHOM4",122,0)
 . . set SAMIBODY(1)="samiroute=casereview&dfn="_dfn_"&studyid="_studyid
"RTN","SAMIHOM4",123,0)
 . . quit
"RTN","SAMIHOM4",124,0)
 . else  do
"RTN","SAMIHOM4",125,0)
 . . set SAMIBODY(1)="samiroute=lookup&dfn="_dfn_"&studyid="_studyid
"RTN","SAMIHOM4",126,0)
 . . quit
"RTN","SAMIHOM4",127,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIBODY,.SAMIRTN)
"RTN","SAMIHOM4",128,0)
 . quit
"RTN","SAMIHOM4",129,0)
 ;
"RTN","SAMIHOM4",130,0)
 ; default to VAPALS homepage
"RTN","SAMIHOM4",131,0)
 do GETHOME^SAMIHOM3(.SAMIRTN,.SAMIFILTER)
"RTN","SAMIHOM4",132,0)
 ;
"RTN","SAMIHOM4",133,0)
 ;
"RTN","SAMIHOM4",134,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",135,0)
 ;
"RTN","SAMIHOM4",136,0)
 quit  ; end of ws WSHOME^SAMIHOM4
"RTN","SAMIHOM4",137,0)
 ;
"RTN","SAMIHOM4",138,0)
 ;
"RTN","SAMIHOM4",139,0)
 ;
"RTN","SAMIHOM4",140,0)
 ;
"RTN","SAMIHOM4",141,0)
 ;@wps-code DEVHOME^SAMIHOM4
"RTN","SAMIHOM4",142,0)
 ;
"RTN","SAMIHOM4",143,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",144,0)
 ;
"RTN","SAMIHOM4",145,0)
 ;ven/gpl;wps;procedure;clean;silent;sac?;tests;port?
"RTN","SAMIHOM4",146,0)
 ;@signature
"RTN","SAMIHOM4",147,0)
 ; do DEVHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",148,0)
 ;@branches-from
"RTN","SAMIHOM4",149,0)
 ; DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",150,0)
 ;@wps-called-by
"RTN","SAMIHOM4",151,0)
 ; wsi WSHOME^SAMIHOM3 [web service get vapals]
"RTN","SAMIHOM4",152,0)
 ;@called-by none
"RTN","SAMIHOM4",153,0)
 ;@calls
"RTN","SAMIHOM4",154,0)
 ; htmltb2^%yottaweb
"RTN","SAMIHOM4",155,0)
 ; PATLIST^SAMIHOM3
"RTN","SAMIHOM4",156,0)
 ; genhtml^%yottautl
"RTN","SAMIHOM4",157,0)
 ; addary^%yottautl
"RTN","SAMIHOM4",158,0)
 ;@input
"RTN","SAMIHOM4",159,0)
 ; SAMIFILTER =
"RTN","SAMIHOM4",160,0)
 ;@output
"RTN","SAMIHOM4",161,0)
 ;.SAMIRTN =
"RTN","SAMIHOM4",162,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",163,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",164,0)
 ;
"RTN","SAMIHOM4",165,0)
 ;
"RTN","SAMIHOM4",166,0)
DEVHOME ; development home page
"RTN","SAMIHOM4",167,0)
 ;
"RTN","SAMIHOM4",168,0)
 ;@stanza 2 present development homepage
"RTN","SAMIHOM4",169,0)
 ;
"RTN","SAMIHOM4",170,0)
 new gtop,gbot
"RTN","SAMIHOM4",171,0)
 do htmltb2^%yottaweb(.gtop,.gbot,"SAMI Test Patients")
"RTN","SAMIHOM4",172,0)
 ;
"RTN","SAMIHOM4",173,0)
 new html,ary,hpat
"RTN","SAMIHOM4",174,0)
 do PATLIST^SAMIHOM3("hpat")
"RTN","SAMIHOM4",175,0)
 quit:'$data(hpat)
"RTN","SAMIHOM4",176,0)
 ;
"RTN","SAMIHOM4",177,0)
 set ary("title")="SAMI Test Patients on this system"
"RTN","SAMIHOM4",178,0)
 set ary("header",1)="StudyId"
"RTN","SAMIHOM4",179,0)
 set ary("header",2)="Name"
"RTN","SAMIHOM4",180,0)
 ;
"RTN","SAMIHOM4",181,0)
 new cnt set cnt=0
"RTN","SAMIHOM4",182,0)
 new zi set zi=""
"RTN","SAMIHOM4",183,0)
 for  do  quit:zi=""
"RTN","SAMIHOM4",184,0)
 . set zi=$order(hpat(zi))
"RTN","SAMIHOM4",185,0)
 . quit:zi=""
"RTN","SAMIHOM4",186,0)
 . ;
"RTN","SAMIHOM4",187,0)
 . set cnt=cnt+1
"RTN","SAMIHOM4",188,0)
 . new url set url="<a href=""/cform.cgi?studyId="_zi_""">"_zi_"</a>"
"RTN","SAMIHOM4",189,0)
 . set ary(cnt,1)=url
"RTN","SAMIHOM4",190,0)
 . set ary(cnt,2)=""
"RTN","SAMIHOM4",191,0)
 . quit
"RTN","SAMIHOM4",192,0)
 ;
"RTN","SAMIHOM4",193,0)
 do genhtml^%yottautl("html","ary")
"RTN","SAMIHOM4",194,0)
 ;
"RTN","SAMIHOM4",195,0)
 do addary^%yottautl("SAMIRTN","gtop")
"RTN","SAMIHOM4",196,0)
 do addary^%yottautl("SAMIRTN","html")
"RTN","SAMIHOM4",197,0)
 set SAMIRTN($order(SAMIRTN(""),-1)+1)=gbot
"RTN","SAMIHOM4",198,0)
 kill SAMIRTN(0)
"RTN","SAMIHOM4",199,0)
 ;
"RTN","SAMIHOM4",200,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMIHOM4",201,0)
 ;
"RTN","SAMIHOM4",202,0)
 ;
"RTN","SAMIHOM4",203,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",204,0)
 ;
"RTN","SAMIHOM4",205,0)
 quit  ; end of wps DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",206,0)
 ;
"RTN","SAMIHOM4",207,0)
 ;
"RTN","SAMIHOM4",208,0)
 ;
"RTN","SAMIHOM4",209,0)
 ;
"RTN","SAMIHOM4",210,0)
 ;@wps-code GETHOME^SAMIHOM3
"RTN","SAMIHOM4",211,0)
 ;
"RTN","SAMIHOM4",212,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",213,0)
 ;
"RTN","SAMIHOM4",214,0)
 ;ven/gpl;wps;procedure;clean;silent;sac?;tests;port?
"RTN","SAMIHOM4",215,0)
 ;@signature
"RTN","SAMIHOM4",216,0)
 ; do GETHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",217,0)
 ;@branches-from
"RTN","SAMIHOM4",218,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",219,0)
 ;@wps-called-by
"RTN","SAMIHOM4",220,0)
 ; WSHOME
"RTN","SAMIHOM4",221,0)
 ; WSVAPALS
"RTN","SAMIHOM4",222,0)
 ; SAVE
"RTN","SAMIHOM4",223,0)
 ;  WSNEWCAS [commented out]
"RTN","SAMIHOM4",224,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMIHOM4",225,0)
 ; WSLOOKUP^SAMISRC2
"RTN","SAMIHOM4",226,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIHOM4",227,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIHOM4",228,0)
 ;@called-by none
"RTN","SAMIHOM4",229,0)
 ;@calls
"RTN","SAMIHOM4",230,0)
 ; $$FINDSITE^SAMISITE
"RTN","SAMIHOM4",231,0)
 ; $$GET1PARM^SAMIPARM
"RTN","SAMIHOM4",232,0)
 ; GETTMPL^SAMICASE
"RTN","SAMIHOM4",233,0)
 ; MERGEHTM^%wf
"RTN","SAMIHOM4",234,0)
 ; ADDCRLF^VPRJRUT
"RTN","SAMIHOM4",235,0)
 ;@input
"RTN","SAMIHOM4",236,0)
 ; SAMIFILTER
"RTN","SAMIHOM4",237,0)
 ;@output
"RTN","SAMIHOM4",238,0)
 ; .SAMIRTN
"RTN","SAMIHOM4",239,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",240,0)
 ;@tests
"RTN","SAMIHOM4",241,0)
 ; UTGETHM^SAMIUTH3
"RTN","SAMIHOM4",242,0)
 ; UTSCAN4^SAMIUTH3
"RTN","SAMIHOM4",243,0)
 ;
"RTN","SAMIHOM4",244,0)
 ;
"RTN","SAMIHOM4",245,0)
GETHOME ; get homepage (not subsequent visit)
"RTN","SAMIHOM4",246,0)
 ;
"RTN","SAMIHOM4",247,0)
 ;@stanza 2 get template for homepage
"RTN","SAMIHOM4",248,0)
 ;
"RTN","SAMIHOM4",249,0)
 ; Processing for multi-tenancy
"RTN","SAMIHOM4",250,0)
 ;
"RTN","SAMIHOM4",251,0)
 i $g(HTTPREQ("method"))="GET" d  ;
"RTN","SAMIHOM4",252,0)
 . s SAMIFILTER("siteid")=""
"RTN","SAMIHOM4",253,0)
 ;
"RTN","SAMIHOM4",254,0)
 if $get(SAMIFILTER("siteid"))="" if '$$FINDSITE^SAMISITE(.SAMIRTN,.SAMIFILTER) quit 0
"RTN","SAMIHOM4",255,0)
 new SAMISITE,SAMITITL
"RTN","SAMIHOM4",256,0)
 set SAMISITE=$get(SAMIFILTER("siteid"))
"RTN","SAMIHOM4",257,0)
 set SAMITITL=$get(SAMIFILTER("sitetitle"))
"RTN","SAMIHOM4",258,0)
 ;
"RTN","SAMIHOM4",259,0)
 new VASITE set VASITE=$$GET1PARM^SAMIPARM("veteransAffairsSite",SAMISITE)
"RTN","SAMIHOM4",260,0)
 set SAMIFILTER("veteransAffairsSite")=VASITE
"RTN","SAMIHOM4",261,0)
 ;
"RTN","SAMIHOM4",262,0)
 new temp,tout,form
"RTN","SAMIHOM4",263,0)
 set form="vapals:home"
"RTN","SAMIHOM4",264,0)
 do GETTMPL^SAMICASE("temp",form)
"RTN","SAMIHOM4",265,0)
 quit:'$data(temp)
"RTN","SAMIHOM4",266,0)
 ;
"RTN","SAMIHOM4",267,0)
 ;
"RTN","SAMIHOM4",268,0)
 ;@stanza 3 process homepage template
"RTN","SAMIHOM4",269,0)
 ;
"RTN","SAMIHOM4",270,0)
 new err
"RTN","SAMIHOM4",271,0)
 do MERGEHTM^%wf(.temp,.SAMIFILTER,.err)
"RTN","SAMIHOM4",272,0)
 ;
"RTN","SAMIHOM4",273,0)
 do ADDCRLF^VPRJRUT(.temp)
"RTN","SAMIHOM4",274,0)
 merge SAMIRTN=temp
"RTN","SAMIHOM4",275,0)
 ;
"RTN","SAMIHOM4",276,0)
 ;
"RTN","SAMIHOM4",277,0)
 ;@stanza 4 termination
"RTN","SAMIHOM4",278,0)
 ;
"RTN","SAMIHOM4",279,0)
 quit  ; end of wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",280,0)
 ;
"RTN","SAMIHOM4",281,0)
 ;
"RTN","SAMIHOM4",282,0)
 ;
"RTN","SAMIHOM4",283,0)
 ; below is redacted from GETHOME^SAMIHOM3
"RTN","SAMIHOM4",284,0)
 ;
"RTN","SAMIHOM4",285,0)
 ;@old-calls
"RTN","SAMIHOM4",286,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIHOM4",287,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIHOM4",288,0)
 ; $$GET^XPAR
"RTN","SAMIHOM4",289,0)
 ; findReplace^%ts
"RTN","SAMIHOM4",290,0)
 ; ADDCRLF^VPRJRUT
"RTN","SAMIHOM4",291,0)
 ;
"RTN","SAMIHOM4",292,0)
 new cnt set cnt=0
"RTN","SAMIHOM4",293,0)
 new zi set zi=0
"RTN","SAMIHOM4",294,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  do  ;
"RTN","SAMIHOM4",295,0)
 . ;
"RTN","SAMIHOM4",296,0)
 . n ln s ln=temp(zi)
"RTN","SAMIHOM4",297,0)
 . n touched s touched=0
"RTN","SAMIHOM4",298,0)
 . ;
"RTN","SAMIHOM4",299,0)
 . i ln["href" i 'touched d  ;
"RTN","SAMIHOM4",300,0)
 . . d FIXHREF^SAMIFORM(.ln)
"RTN","SAMIHOM4",301,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",302,0)
 . ;
"RTN","SAMIHOM4",303,0)
 . i ln["src" d  ;
"RTN","SAMIHOM4",304,0)
 . . d FIXSRC^SAMIFORM(.ln)
"RTN","SAMIHOM4",305,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",306,0)
 . ;
"RTN","SAMIHOM4",307,0)
 . i ln["id" i ln["studyIdMenu" d  ;
"RTN","SAMIHOM4",308,0)
 . . s zi=zi+4
"RTN","SAMIHOM4",309,0)
 . ;
"RTN","SAMIHOM4",310,0)
 . if ln["@@MANUALREGISTRATION@@" do  ; turn off manual registration
"RTN","SAMIHOM4",311,0)
 . . n setman,setparm
"RTN","SAMIHOM4",312,0)
 . . s setman="true"
"RTN","SAMIHOM4",313,0)
 . . s setparm=$$GET^XPAR("SYS","SAMI ALLOW MANUAL ENTRY",,"Q")
"RTN","SAMIHOM4",314,0)
 . . i setparm=0 s setman="false"
"RTN","SAMIHOM4",315,0)
 . . do findReplace^%ts(.ln,"@@MANUALREGISTRATION@@",setman)
"RTN","SAMIHOM4",316,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",317,0)
 . . quit 
"RTN","SAMIHOM4",318,0)
 . set cnt=cnt+1
"RTN","SAMIHOM4",319,0)
 . set tout(cnt)=temp(zi)
"RTN","SAMIHOM4",320,0)
 . quit
"RTN","SAMIHOM4",321,0)
 ;
"RTN","SAMIHOM4",322,0)
 ;
"RTN","SAMIHOM4",323,0)
 ;@old-stanza 4 add cr/lf & save to return array
"RTN","SAMIHOM4",324,0)
 ;
"RTN","SAMIHOM4",325,0)
 do ADDCRLF^VPRJRUT(.tout)
"RTN","SAMIHOM4",326,0)
 merge SAMIRTN=tout
"RTN","SAMIHOM4",327,0)
 ;
"RTN","SAMIHOM4",328,0)
 ;
"RTN","SAMIHOM4",329,0)
 ;@old-stanza 5 termination
"RTN","SAMIHOM4",330,0)
 ;
"RTN","SAMIHOM4",331,0)
 quit  ; old end of wps GETHOME^SAMIHOM3
"RTN","SAMIHOM4",332,0)
 ;
"RTN","SAMIHOM4",333,0)
 ;
"RTN","SAMIHOM4",334,0)
 ;
"RTN","SAMIHOM4",335,0)
 ;
"RTN","SAMIHOM4",336,0)
 ;@section 2 web service post vapals & related subroutines
"RTN","SAMIHOM4",337,0)
 ;
"RTN","SAMIHOM4",338,0)
 ;
"RTN","SAMIHOM4",339,0)
 ;
"RTN","SAMIHOM4",340,0)
 ;
"RTN","SAMIHOM4",341,0)
 ;@ws-code WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",342,0)
 ;
"RTN","SAMIHOM4",343,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",344,0)
 ;
"RTN","SAMIHOM4",345,0)
 ;ven/gpl;ws;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",346,0)
 ;@signature
"RTN","SAMIHOM4",347,0)
 ; do WSVAPALS^SAMIHOM3(SAMIARG,SAMIBODY,SAMIRESULT)
"RTN","SAMIHOM4",348,0)
 ;@branches-from
"RTN","SAMIHOM4",349,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",350,0)
 ;@ws-called-by [tbd]
"RTN","SAMIHOM4",351,0)
 ;@called-by [tbd]
"RTN","SAMIHOM4",352,0)
 ;@calls
"RTN","SAMIHOM4",353,0)
 ; parseBody^%wf
"RTN","SAMIHOM4",354,0)
 ; ^ZTER [commented out]
"RTN","SAMIHOM4",355,0)
 ; $$SITENM2^SAMISITE
"RTN","SAMIHOM4",356,0)
 ; $$FINDSITE^SAMISITE
"RTN","SAMIHOM4",357,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",358,0)
 ; RTNERR^SAMIHOM4
"RTN","SAMIHOM4",359,0)
 ; WSLOOKUP^SAMISRC2
"RTN","SAMIHOM4",360,0)
 ; LOGIN^SAMISITE
"RTN","SAMIHOM4",361,0)
 ; WSHOME^SAMIHOM3
"RTN","SAMIHOM4",362,0)
 ; WSVAPALS^SAMIHOM3 [commented out]
"RTN","SAMIHOM4",363,0)
 ; $$REDIRECT^SAMISITE
"RTN","SAMIHOM4",364,0)
 ; WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",365,0)
 ; WSCASE^SAMICASE
"RTN","SAMIHOM4",366,0)
 ; WSNUFORM^SAMICASE
"RTN","SAMIHOM4",367,0)
 ; WSNFPOST^SAMICASE
"RTN","SAMIHOM4",368,0)
 ; wsGetForm^%wf
"RTN","SAMIHOM4",369,0)
 ; wsPostForm^%wf
"RTN","SAMIHOM4",370,0)
 ; $$NOTE^SAMINOT1
"RTN","SAMIHOM4",371,0)
 ; $$EN^SAMIORU
"RTN","SAMIHOM4",372,0)
 ; $$NTIEN^SAMINOT1
"RTN","SAMIHOM4",373,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",374,0)
 ; $$NOTE^SAMINOT2
"RTN","SAMIHOM4",375,0)
 ; DELFORM^SAMICASE
"RTN","SAMIHOM4",376,0)
 ; WSNOTE^SAMINOT3
"RTN","SAMIHOM4",377,0)
 ; WSREPORT^SAMICTR0
"RTN","SAMIHOM4",378,0)
 ; wsReport^SAMICTRT [commented out]
"RTN","SAMIHOM4",379,0)
 ; WSNOTE^SAMINOT1
"RTN","SAMIHOM4",380,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIHOM4",381,0)
 ; RTNPAGE^SAMIHOM4
"RTN","SAMIHOM4",382,0)
 ; REG^SAMIHOM4
"RTN","SAMIHOM4",383,0)
 ; SAVE^SAMIHOM4
"RTN","SAMIHOM4",384,0)
 ; MERGE^SAMIHOM4
"RTN","SAMIHOM4",385,0)
 ;@input [tbd]
"RTN","SAMIHOM4",386,0)
 ;@output [tbd]
"RTN","SAMIHOM4",387,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",388,0)
 ;@tests
"RTN","SAMIHOM4",389,0)
 ; UTPOSTF^SAMIUTH3 [not working?]
"RTN","SAMIHOM4",390,0)
 ; UTWSVP1^SAMIUTH4
"RTN","SAMIHOM4",391,0)
 ; UTWSVP2^SAMIUTH4
"RTN","SAMIHOM4",392,0)
 ; UTWSVP3^SAMIUTH4
"RTN","SAMIHOM4",393,0)
 ; UTWSVP4^SAMIUTH4
"RTN","SAMIHOM4",394,0)
 ; UTWSVP5^SAMIUTH4
"RTN","SAMIHOM4",395,0)
 ;
"RTN","SAMIHOM4",396,0)
 ; all calls come through this gateway
"RTN","SAMIHOM4",397,0)
 ;
"RTN","SAMIHOM4",398,0)
 ;
"RTN","SAMIHOM4",399,0)
WSVAPALS ; post vapals (main gateway)
"RTN","SAMIHOM4",400,0)
 ;
"RTN","SAMIHOM4",401,0)
 k ^SAMIUL("vapals")
"RTN","SAMIHOM4",402,0)
 m ^SAMIUL("vapals")=SAMIARG
"RTN","SAMIHOM4",403,0)
 m ^SAMIUL("vapals","BODY")=SAMIBODY
"RTN","SAMIHOM4",404,0)
 ;
"RTN","SAMIHOM4",405,0)
 new vars,SAMIBDY
"RTN","SAMIHOM4",406,0)
 set SAMIBDY=$get(SAMIBODY(1))
"RTN","SAMIHOM4",407,0)
 do parseBody^%wf("vars",.SAMIBDY)
"RTN","SAMIHOM4",408,0)
 m vars=SAMIARG
"RTN","SAMIHOM4",409,0)
 i $g(vars("siteid"))'="" d  ;
"RTN","SAMIHOM4",410,0)
 . i $g(vars("site"))'=$g(vars("siteid")) s vars("site")=$g(vars("siteid"))
"RTN","SAMIHOM4",411,0)
 . q
"RTN","SAMIHOM4",412,0)
 i $g(vars("site"))="SYS" s vars("site")=""
"RTN","SAMIHOM4",413,0)
 i $g(HTTPREQ("method"))="GET" d  ;
"RTN","SAMIHOM4",414,0)
 . s vars("site")=""
"RTN","SAMIHOM4",415,0)
 . q
"RTN","SAMIHOM4",416,0)
 m SAMIARG=vars
"RTN","SAMIHOM4",417,0)
 m SAMIARG=SAMIBODY
"RTN","SAMIHOM4",418,0)
 ;D ^ZTER
"RTN","SAMIHOM4",419,0)
 ;
"RTN","SAMIHOM4",420,0)
 ; Processing for multi-tenancy
"RTN","SAMIHOM4",421,0)
 ;
"RTN","SAMIHOM4",422,0)
 if '$d(vars("siteid")) d  ;
"RTN","SAMIHOM4",423,0)
 . if $g(vars("studyid"))="" q
"RTN","SAMIHOM4",424,0)
 . n sym s sym=$e(vars("studyid"),1,3) ; first 3 chars in studyid
"RTN","SAMIHOM4",425,0)
 . i $$SITENM2^SAMISITE(sym)=-1 q
"RTN","SAMIHOM4",426,0)
 . s vars("siteid")=sym
"RTN","SAMIHOM4",427,0)
 . s vars("site")=sym
"RTN","SAMIHOM4",428,0)
 . q
"RTN","SAMIHOM4",429,0)
 ;
"RTN","SAMIHOM4",430,0)
 if $G(vars("site"))'="" d  ;
"RTN","SAMIHOM4",431,0)
 . n siteid s siteid=vars("site")
"RTN","SAMIHOM4",432,0)
 . s SAMIARG("siteid")=siteid
"RTN","SAMIHOM4",433,0)
 . s SAMIARG("sitetitle")=$$SITENM2^SAMISITE(siteid)_" - "_siteid
"RTN","SAMIHOM4",434,0)
 . q
"RTN","SAMIHOM4",435,0)
 ; k ^gpl("siteselect")
"RTN","SAMIHOM4",436,0)
 ; m ^gpl("siteselect")=SAMIARG
"RTN","SAMIHOM4",437,0)
 ; m ^gpl("siteselect","vars")=vars
"RTN","SAMIHOM4",438,0)
 if $G(SAMIARG("siteid"))="" if '$$FINDSITE^SAMISITE(.SAMIRESULT,.SAMIARG) Q 0
"RTN","SAMIHOM4",439,0)
 new SAMISITE,SAMITITL
"RTN","SAMIHOM4",440,0)
 s SAMISITE=$G(SAMIARG("siteid"))
"RTN","SAMIHOM4",441,0)
 i $G(SAMIARG("sitetitle"))="" d  ;
"RTN","SAMIHOM4",442,0)
 . s SAMIARG("sitetitle")=$$SITENM2^SAMISITE(SAMISITE)_" - "_SAMISITE
"RTN","SAMIHOM4",443,0)
 . q
"RTN","SAMIHOM4",444,0)
 s SAMITITL=$G(SAMIARG("sitetitle"))
"RTN","SAMIHOM4",445,0)
 m vars=SAMIARG
"RTN","SAMIHOM4",446,0)
 ;
"RTN","SAMIHOM4",447,0)
 k ^SAMIUL("vapals","vars")
"RTN","SAMIHOM4",448,0)
 merge ^SAMIUL("vapals","vars")=vars
"RTN","SAMIHOM4",449,0)
 merge ^SAMIUL("vapals","vars")=SAMIBODY
"RTN","SAMIHOM4",450,0)
 ;
"RTN","SAMIHOM4",451,0)
 n route s route=$g(vars("samiroute"))
"RTN","SAMIHOM4",452,0)
 ;i route=""  d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",453,0)
 i route="" d  q 0
"RTN","SAMIHOM4",454,0)
 . n vals
"RTN","SAMIHOM4",455,0)
 . s vals("siteid")=""
"RTN","SAMIHOM4",456,0)
 . s vals("sitetitle")="Unknown Site"
"RTN","SAMIHOM4",457,0)
 . s vals("errorMessage")=""
"RTN","SAMIHOM4",458,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:login",.vals)
"RTN","SAMIHOM4",459,0)
 . q
"RTN","SAMIHOM4",460,0)
 ;
"RTN","SAMIHOM4",461,0)
 i route="lookup" d  q 0
"RTN","SAMIHOM4",462,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",463,0)
 . d WSLOOKUP^SAMISRC2(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",464,0)
 . q
"RTN","SAMIHOM4",465,0)
 ;
"RTN","SAMIHOM4",466,0)
 i route="login" d  q 0
"RTN","SAMIHOM4",467,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",468,0)
 . d LOGIN^SAMISITE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",469,0)
 . q
"RTN","SAMIHOM4",470,0)
 ;
"RTN","SAMIHOM4",471,0)
 i route="home" d  q 0
"RTN","SAMIHOM4",472,0)
 . ; k ^gpl("home")
"RTN","SAMIHOM4",473,0)
 . ; m ^gpl("home")=SAMIARG
"RTN","SAMIHOM4",474,0)
 . s SAMIARG("samiroute")=""
"RTN","SAMIHOM4",475,0)
 . d WSHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",476,0)
 . q
"RTN","SAMIHOM4",477,0)
 ;
"RTN","SAMIHOM4",478,0)
 i route="logout" d  q 0
"RTN","SAMIHOM4",479,0)
 . ;s SAMIARG("samiroute")="home"
"RTN","SAMIHOM4",480,0)
 . ;do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIARG,.SAMIRESULT)
"RTN","SAMIHOM4",481,0)
 . ;Q
"RTN","SAMIHOM4",482,0)
 . q:$$REDIRECT^SAMISITE(.SAMIRESULT,.SAMIARG)  ; redirect to logout screen
"RTN","SAMIHOM4",483,0)
 . s SAMIARG("sitetitle")="Unknown Site"
"RTN","SAMIHOM4",484,0)
 . s SAMIARG("siteid")=""
"RTN","SAMIHOM4",485,0)
 . s SAMIARG("errorMessage")=""
"RTN","SAMIHOM4",486,0)
 . s SAMIARG("samiroute")="home"
"RTN","SAMIHOM4",487,0)
 . d WSHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",488,0)
 . ;d RTNERR^SAMIHOM4(.SAMIRESULT,"vapals:login",.SAMIARG)
"RTN","SAMIHOM4",489,0)
 . q
"RTN","SAMIHOM4",490,0)
 ;
"RTN","SAMIHOM4",491,0)
 i route="newcase" d  q 0
"RTN","SAMIHOM4",492,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",493,0)
 . d WSNEWCAS^SAMIHOM3(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",494,0)
 . q
"RTN","SAMIHOM4",495,0)
 ;
"RTN","SAMIHOM4",496,0)
 i route="casereview" d  q 0
"RTN","SAMIHOM4",497,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",498,0)
 . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",499,0)
 . q
"RTN","SAMIHOM4",500,0)
 ;
"RTN","SAMIHOM4",501,0)
 i route="nuform" d  q 0
"RTN","SAMIHOM4",502,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",503,0)
 . d WSNUFORM^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",504,0)
 . q
"RTN","SAMIHOM4",505,0)
 ;
"RTN","SAMIHOM4",506,0)
 i route="addform" d  q 0
"RTN","SAMIHOM4",507,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",508,0)
 . d WSNFPOST^SAMICASE(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",509,0)
 . q
"RTN","SAMIHOM4",510,0)
 ;
"RTN","SAMIHOM4",511,0)
 i route="form" d  q 0
"RTN","SAMIHOM4",512,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",513,0)
 . d wsGetForm^%wf(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",514,0)
 . q
"RTN","SAMIHOM4",515,0)
 ;
"RTN","SAMIHOM4",516,0)
 i route="postform" d  q 0
"RTN","SAMIHOM4",517,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",518,0)
 . d wsPostForm^%wf(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",519,0)
 . ;
"RTN","SAMIHOM4",520,0)
 . i $g(SAMIARG("form"))["siform" d  ;
"RTN","SAMIHOM4",521,0)
 . . n notr s notr=0 ; note return 0 if failure, 1 or greater if success
"RTN","SAMIHOM4",522,0)
 . . ; returns the ien of the note that was created and should be sent
"RTN","SAMIHOM4",523,0)
 . . s notr=$$NOTE^SAMINOT1(.SAMIARG)
"RTN","SAMIHOM4",524,0)
 . . if +notr>0 d  ;
"RTN","SAMIHOM4",525,0)
 . . . n SAMIFILTER
"RTN","SAMIHOM4",526,0)
 . . . s SAMIFILTER("sid")=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",527,0)
 . . . s SAMIFILTER("key")=$g(SAMIARG("form")) ;
"RTN","SAMIHOM4",528,0)
 . . . n tiuien
"RTN","SAMIHOM4",529,0)
 . . . s tiuien=+notr
"RTN","SAMIHOM4",530,0)
 . . . s SAMIFILTER("notenmbr")=tiuien
"RTN","SAMIHOM4",531,0)
 . . . n sendrslt
"RTN","SAMIHOM4",532,0)
 . . . ;s sendrslt="1^MSG9239010"
"RTN","SAMIHOM4",533,0)
 . . . s SAMIFILTER("sendprotocol")=SAMISITE_" ENROLL ORU EVN"
"RTN","SAMIHOM4",534,0)
 . . . s sendrslt=$$EN^SAMIORU(.SAMIFILTER) ; send the note to VistA
"RTN","SAMIHOM4",535,0)
 . . . i +sendrslt>0 d  ; success
"RTN","SAMIHOM4",536,0)
 . . . . n rtnid s rtnid=$p(sendrslt,"^",2) ; return id from HL7
"RTN","SAMIHOM4",537,0)
 . . . . ; post the id to the graph here
"RTN","SAMIHOM4",538,0)
 . . . . n sid s sid=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",539,0)
 . . . . n form s form=$G(SAMIARG("form"))
"RTN","SAMIHOM4",540,0)
 . . . . n nien s nien=$$NTIEN^SAMINOT1(sid,form) ; latest note ien
"RTN","SAMIHOM4",541,0)
 . . . . n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",542,0)
 . . . . s @root@("graph",sid,form,"notes",nien,"hl7id")=rtnid
"RTN","SAMIHOM4",543,0)
 . . . . s SAMIARG("errorMessage")="Note successfully sent to VistA ID: "_rtnid
"RTN","SAMIHOM4",544,0)
 . . . . q
"RTN","SAMIHOM4",545,0)
 . . . else  d  ;
"RTN","SAMIHOM4",546,0)
 . . . . n rtnmsg s rtnmsg=$p(sendrslt,"^",2)
"RTN","SAMIHOM4",547,0)
 . . . . s SAMIARG("errorMessage")=rtnmsg
"RTN","SAMIHOM4",548,0)
 . . . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",549,0)
 . . . q
"RTN","SAMIHOM4",550,0)
 . . q
"RTN","SAMIHOM4",551,0)
 . ;
"RTN","SAMIHOM4",552,0)
 . i $g(SAMIARG("form"))["fuform" d  ;
"RTN","SAMIHOM4",553,0)
 . . n notr s notr=0 ; note return 0 if failure, 1 or greater if success
"RTN","SAMIHOM4",554,0)
 . . ; returns the ien of the note that was created and should be sent
"RTN","SAMIHOM4",555,0)
 . . s notr=$$NOTE^SAMINOT2(.SAMIARG)
"RTN","SAMIHOM4",556,0)
 . . if +notr>0 d  ;
"RTN","SAMIHOM4",557,0)
 . . . n SAMIFILTER
"RTN","SAMIHOM4",558,0)
 . . . s SAMIFILTER("sid")=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",559,0)
 . . . s SAMIFILTER("key")=$g(SAMIARG("form")) ;
"RTN","SAMIHOM4",560,0)
 . . . n tiuien
"RTN","SAMIHOM4",561,0)
 . . . s tiuien=+notr
"RTN","SAMIHOM4",562,0)
 . . . s SAMIFILTER("notenmbr")=tiuien
"RTN","SAMIHOM4",563,0)
 . . . n sendrslt
"RTN","SAMIHOM4",564,0)
 . . . ;s sendrslt="0^Missing ORM Message"
"RTN","SAMIHOM4",565,0)
 . . . s SAMIFILTER("sendprotocol")=SAMISITE_" ENROLL ORU EVN"
"RTN","SAMIHOM4",566,0)
 . . . s sendrslt=$$EN^SAMIORU(.SAMIFILTER) ; send the note to VistA
"RTN","SAMIHOM4",567,0)
 . . . i +sendrslt>0 d  ; success
"RTN","SAMIHOM4",568,0)
 . . . . n rtnid s rtnid=$p(sendrslt,"^",2) ; return id from HL7
"RTN","SAMIHOM4",569,0)
 . . . . ; post the id to the graph here
"RTN","SAMIHOM4",570,0)
 . . . . n sid s sid=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",571,0)
 . . . . n form s form=$G(SAMIARG("form"))
"RTN","SAMIHOM4",572,0)
 . . . . n nien s nien=$$NTIEN^SAMINOT1(sid,form) ; latest note ien
"RTN","SAMIHOM4",573,0)
 . . . . n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",574,0)
 . . . . s @root@("graph",sid,form,"notes",nien,"hl7id")=rtnid
"RTN","SAMIHOM4",575,0)
 . . . . s SAMIARG("errorMessage")="Note successfully sent to VistA ID: "_rtnid
"RTN","SAMIHOM4",576,0)
 . . . . q
"RTN","SAMIHOM4",577,0)
 . . . else  d  ;
"RTN","SAMIHOM4",578,0)
 . . . . n rtnmsg s rtnmsg=$p(sendrslt,"^",2)
"RTN","SAMIHOM4",579,0)
 . . . . i $g(SAMIARG("errorMessage"))="" d  ;
"RTN","SAMIHOM4",580,0)
 . . . . . s SAMIARG("errorMessage")=rtnmsg
"RTN","SAMIHOM4",581,0)
 . . . . . q
"RTN","SAMIHOM4",582,0)
 . . . . q
"RTN","SAMIHOM4",583,0)
 . . . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",584,0)
 . . . q
"RTN","SAMIHOM4",585,0)
 . . e  d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",586,0)
 . . q
"RTN","SAMIHOM4",587,0)
 . e  d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",588,0)
 . q
"RTN","SAMIHOM4",589,0)
 ;
"RTN","SAMIHOM4",590,0)
 i route="deleteform" d  q 0
"RTN","SAMIHOM4",591,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",592,0)
 . d DELFORM^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",593,0)
 . q
"RTN","SAMIHOM4",594,0)
 ;
"RTN","SAMIHOM4",595,0)
 i route="ctreport" d  q 0
"RTN","SAMIHOM4",596,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",597,0)
 . n format s format="html"
"RTN","SAMIHOM4",598,0)
 . s format="text"
"RTN","SAMIHOM4",599,0)
 . i format="text" d WSNOTE^SAMINOT3(.SAMIRESULT,.SAMIARG) q  ;
"RTN","SAMIHOM4",600,0)
 . i format="html" d WSREPORT^SAMICTR0(.SAMIRESULT,.SAMIARG) q  ;
"RTN","SAMIHOM4",601,0)
 . ;d wsReport^SAMICTRT(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",602,0)
 . q
"RTN","SAMIHOM4",603,0)
 ;
"RTN","SAMIHOM4",604,0)
 i route="note" d  q 0
"RTN","SAMIHOM4",605,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",606,0)
 . d WSNOTE^SAMINOT1(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",607,0)
 . q
"RTN","SAMIHOM4",608,0)
 ;
"RTN","SAMIHOM4",609,0)
 i route="report" d  q 0
"RTN","SAMIHOM4",610,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",611,0)
 . d WSREPORT^SAMIUR(.SAMIRESULT,.vars)
"RTN","SAMIHOM4",612,0)
 . q
"RTN","SAMIHOM4",613,0)
 ;
"RTN","SAMIHOM4",614,0)
 i route="about" d  q 0
"RTN","SAMIHOM4",615,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",616,0)
 . n form
"RTN","SAMIHOM4",617,0)
 . s form="vapals:about"
"RTN","SAMIHOM4",618,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",619,0)
 . q
"RTN","SAMIHOM4",620,0)
 ;
"RTN","SAMIHOM4",621,0)
 i route="addperson" d  q 0
"RTN","SAMIHOM4",622,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",623,0)
 . n form
"RTN","SAMIHOM4",624,0)
 . s form="vapals:addperson"
"RTN","SAMIHOM4",625,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",626,0)
 . q
"RTN","SAMIHOM4",627,0)
 ;
"RTN","SAMIHOM4",628,0)
 i route="editperson" d  q 0
"RTN","SAMIHOM4",629,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",630,0)
 . n dfn s dfn=$g(vars("dfn")) ; must have a dfn
"RTN","SAMIHOM4",631,0)
 . i dfn="" d  q  ;
"RTN","SAMIHOM4",632,0)
 . . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",633,0)
 . . q
"RTN","SAMIHOM4",634,0)
 . n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",635,0)
 . n sien s sien=$o(@root@("dfn",dfn,""))
"RTN","SAMIHOM4",636,0)
 . i sien="" d  q  ;
"RTN","SAMIHOM4",637,0)
 . . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",638,0)
 . . q
"RTN","SAMIHOM4",639,0)
 . s vars("name")=$g(@root@(sien,"saminame"))
"RTN","SAMIHOM4",640,0)
 . s tdob=$g(@root@(sien,"dob"))
"RTN","SAMIHOM4",641,0)
 . s vars("dob")=$p(tdob,"-",2)_"/"_$p(tdob,"-",3)_"/"_$p(tdob,"-",1)
"RTN","SAMIHOM4",642,0)
 . s vars("sbdob")=$g(@root@(sien,"dob"))
"RTN","SAMIHOM4",643,0)
 . s vars("gender")=$g(@root@(sien,"sex"))
"RTN","SAMIHOM4",644,0)
 . ; s vars("icn")=$g(@root@(sien,"icn"))
"RTN","SAMIHOM4",645,0)
 . n tssn s tssn=$g(@root@(sien,"ssn"))
"RTN","SAMIHOM4",646,0)
 . s vars("ssn")=$e(tssn,1,3)_"-"_$e(tssn,4,5)_"-"_$e(tssn,6,9)
"RTN","SAMIHOM4",647,0)
 . s vars("last5")=$g(@root@(sien,"last5"))
"RTN","SAMIHOM4",648,0)
 . s vars("dfn")=$g(@root@(sien,"dfn"))
"RTN","SAMIHOM4",649,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",650,0)
 . n form,err,zhtml
"RTN","SAMIHOM4",651,0)
 . s form="vapals:editparticipant"
"RTN","SAMIHOM4",652,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",653,0)
 . q
"RTN","SAMIHOM4",654,0)
 ;
"RTN","SAMIHOM4",655,0)
 i route="register" d  q 0
"RTN","SAMIHOM4",656,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",657,0)
 . d REG^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",658,0)
 . q
"RTN","SAMIHOM4",659,0)
 ; 
"RTN","SAMIHOM4",660,0)
 i route="editsave" d  q 0
"RTN","SAMIHOM4",661,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",662,0)
 . d SAVE^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",663,0)
 . q
"RTN","SAMIHOM4",664,0)
 ;
"RTN","SAMIHOM4",665,0)
 i route="merge" d  q 0
"RTN","SAMIHOM4",666,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",667,0)
 . d MERGE^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",668,0)
 . q
"RTN","SAMIHOM4",669,0)
 ;
"RTN","SAMIHOM4",670,0)
 quit 0  ; end of ws WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",671,0)
 ;
"RTN","SAMIHOM4",672,0)
 ;
"RTN","SAMIHOM4",673,0)
 ;
"RTN","SAMIHOM4",674,0)
 ;
"RTN","SAMIHOM4",675,0)
 ;@section 3 other subroutines
"RTN","SAMIHOM4",676,0)
 ;
"RTN","SAMIHOM4",677,0)
 ;
"RTN","SAMIHOM4",678,0)
 ;
"RTN","SAMIHOM4",679,0)
 ;
"RTN","SAMIHOM4",680,0)
 ;@pps REG^SAMIHOM4
"RTN","SAMIHOM4",681,0)
 ;
"RTN","SAMIHOM4",682,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",683,0)
 ;
"RTN","SAMIHOM4",684,0)
 ;ven/gpl;pps;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",685,0)
 ;@called-by
"RTN","SAMIHOM4",686,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",687,0)
 ; REGISTER^SAMILD2
"RTN","SAMIHOM4",688,0)
 ; REGISTER^SAMILOAD
"RTN","SAMIHOM4",689,0)
 ; REGISTER^SAMIZPH1
"RTN","SAMIHOM4",690,0)
 ;@calls
"RTN","SAMIHOM4",691,0)
 ; $$DUPSSN [commented out]
"RTN","SAMIHOM4",692,0)
 ; $$BADICN [commented out]
"RTN","SAMIHOM4",693,0)
 ; RTNERR
"RTN","SAMIHOM4",694,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",695,0)
 ; $$REMATCH
"RTN","SAMIHOM4",696,0)
 ; MKPTLK
"RTN","SAMIHOM4",697,0)
 ; INDXPTLK
"RTN","SAMIHOM4",698,0)
 ; SETINFO
"RTN","SAMIHOM4",699,0)
 ; SETWARN [commented out]
"RTN","SAMIHOM4",700,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",701,0)
 ;@input
"RTN","SAMIHOM4",702,0)
 ; SAMIARG =
"RTN","SAMIHOM4",703,0)
 ;@output
"RTN","SAMIHOM4",704,0)
 ;.SAMIRTN =
"RTN","SAMIHOM4",705,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",706,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",707,0)
 ;
"RTN","SAMIHOM4",708,0)
 ;
"RTN","SAMIHOM4",709,0)
REG(SAMIRTN,SAMIARG) ; manual registration
"RTN","SAMIHOM4",710,0)
 ;
"RTN","SAMIHOM4",711,0)
 n name s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",712,0)
 ;
"RTN","SAMIHOM4",713,0)
 ; m ^gpl("reg")=SAMIARG
"RTN","SAMIHOM4",714,0)
 n ssn s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",715,0)
 i ssn'="" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",716,0)
 s SAMIARG("errorMessage")=""
"RTN","SAMIHOM4",717,0)
 s SAMIARG("errorField")=""
"RTN","SAMIHOM4",718,0)
 ; test for duplicate ssn
"RTN","SAMIHOM4",719,0)
 ;
"RTN","SAMIHOM4",720,0)
 ;i $$DUPSSN(ssn) d  ;
"RTN","SAMIHOM4",721,0)
 ;. ;s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate SSN."
"RTN","SAMIHOM4",722,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate SSN error. A person with that SSN is already entered in the system."
"RTN","SAMIHOM4",723,0)
 ;. s SAMIARG("errorField")="ssn"
"RTN","SAMIHOM4",724,0)
 ;
"RTN","SAMIHOM4",725,0)
 ; test for duplicate icn
"RTN","SAMIHOM4",726,0)
 ;
"RTN","SAMIHOM4",727,0)
 ;n icn s icn=$g(SAMIARG("icn"))
"RTN","SAMIHOM4",728,0)
 ;i icn'="" i $$DUPICN(icn) d  ;
"RTN","SAMIHOM4",729,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate ICN error. A person with that ICN is already entered in the system."
"RTN","SAMIHOM4",730,0)
 ;. s SAMIARG("errorField")="icn"
"RTN","SAMIHOM4",731,0)
 ;;
"RTN","SAMIHOM4",732,0)
 ;; test for wellformed ICN
"RTN","SAMIHOM4",733,0)
 ;;
"RTN","SAMIHOM4",734,0)
 ;i icn'="" i $$BADICN(icn) d  ;
"RTN","SAMIHOM4",735,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Invalid ICN error. The check digits in the ICN do not match"
"RTN","SAMIHOM4",736,0)
 ;. s SAMIARG("errorField")="icn"
"RTN","SAMIHOM4",737,0)
 ;;
"RTN","SAMIHOM4",738,0)
 ; if there is an error, send back to edit with error message
"RTN","SAMIHOM4",739,0)
 i $g(SAMIARG("errorMessage"))'="" d  q  ;
"RTN","SAMIHOM4",740,0)
 . n form
"RTN","SAMIHOM4",741,0)
 . s form="vapals:addperson"
"RTN","SAMIHOM4",742,0)
 . d RTNERR(.SAMIRESULT,form,.SAMIARG)
"RTN","SAMIHOM4",743,0)
 . q
"RTN","SAMIHOM4",744,0)
 ;
"RTN","SAMIHOM4",745,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",746,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",747,0)
 n ptlkien s ptlkien=""
"RTN","SAMIHOM4",748,0)
 n dfn s dfn=""
"RTN","SAMIHOM4",749,0)
 n sien s sien=""
"RTN","SAMIHOM4",750,0)
 i ptlkien="" s ptlkien=$o(@root@("AAAAAA"),-1)+1
"RTN","SAMIHOM4",751,0)
 n zm
"RTN","SAMIHOM4",752,0)
 k SAMIARG("MATCHLOG")
"RTN","SAMIHOM4",753,0)
 s zm=$$REMATCH(sien,.SAMIARG)
"RTN","SAMIHOM4",754,0)
 i zm>0 d  ;
"RTN","SAMIHOM4",755,0)
 . s SAMIARG("MATCHLOG")=zm
"RTN","SAMIHOM4",756,0)
 . q
"RTN","SAMIHOM4",757,0)
 d MKPTLK(ptlkien,.SAMIARG) ; make the patient-lookup record
"RTN","SAMIHOM4",758,0)
 ;
"RTN","SAMIHOM4",759,0)
 s dfn=$o(@root@("dfn"," "),-1)+1
"RTN","SAMIHOM4",760,0)
 n pdfn
"RTN","SAMIHOM4",761,0)
 s pdfn=$o(@proot@("dfn"," "),-1)+1
"RTN","SAMIHOM4",762,0)
 i pdfn>dfn s dfn=pdfn ; need a dfn that has not been used
"RTN","SAMIHOM4",763,0)
 i dfn<9000001 s dfn=9000001
"RTN","SAMIHOM4",764,0)
 s @root@(ptlkien,"dfn")=dfn
"RTN","SAMIHOM4",765,0)
 s SAMIARG("dfn")=dfn ; pass the new dfn back to the caller
"RTN","SAMIHOM4",766,0)
 ; note: this is the only way to link to the new record via dfn
"RTN","SAMIHOM4",767,0)
 ; since nothing else is unique
"RTN","SAMIHOM4",768,0)
 d INDXPTLK(ptlkien)
"RTN","SAMIHOM4",769,0)
 s SAMIFILTER("samiroute")="addperson"
"RTN","SAMIHOM4",770,0)
 s SAMIFILTER("siteid")=$G(SAMIARG("siteid"))
"RTN","SAMIHOM4",771,0)
 s SAMIFILTER("sitetitle")=$G(SAMIARG("sitetitle"))
"RTN","SAMIHOM4",772,0)
 D  ; slight of hand for handing back SAMIARGS while also returning a form
"RTN","SAMIHOM4",773,0)
 . n SAMIARG ; return to a blank manual registration form
"RTN","SAMIHOM4",774,0)
 . s SAMIARG("siteid")=$G(SAMIFILTER("siteid"))
"RTN","SAMIHOM4",775,0)
 . s SAMIARG("sitetitle")=$G(SAMIFILTER("sitetitle"))
"RTN","SAMIHOM4",776,0)
 . d SETINFO(.SAMIFILTER,name_" was successfully entered")
"RTN","SAMIHOM4",777,0)
 . ;d SETWARN(.SAMIFILTER,"We might want to give you a warning")
"RTN","SAMIHOM4",778,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIARG,.SAMIRESULT)
"RTN","SAMIHOM4",779,0)
 . q
"RTN","SAMIHOM4",780,0)
 ;
"RTN","SAMIHOM4",781,0)
 quit  ; end of pps REG^SAMIHOM4
"RTN","SAMIHOM4",782,0)
 ;
"RTN","SAMIHOM4",783,0)
 ;
"RTN","SAMIHOM4",784,0)
 ;
"RTN","SAMIHOM4",785,0)
 ;
"RTN","SAMIHOM4",786,0)
 ;@proc MKPTLK
"RTN","SAMIHOM4",787,0)
 ;
"RTN","SAMIHOM4",788,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",789,0)
 ;
"RTN","SAMIHOM4",790,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",791,0)
 ;@called-by
"RTN","SAMIHOM4",792,0)
 ; REG
"RTN","SAMIHOM4",793,0)
 ;@calls
"RTN","SAMIHOM4",794,0)
 ; $$TRIM^XLFSTR
"RTN","SAMIHOM4",795,0)
 ; $$FMDT^SAMIUR2
"RTN","SAMIHOM4",796,0)
 ; $$FMTE^XLFDT
"RTN","SAMIHOM4",797,0)
 ; $$UCASE
"RTN","SAMIHOM4",798,0)
 ;@input
"RTN","SAMIHOM4",799,0)
 ; ptlkien =
"RTN","SAMIHOM4",800,0)
 ; SAMIARG =
"RTN","SAMIHOM4",801,0)
 ;@output [tbd]
"RTN","SAMIHOM4",802,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",803,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",804,0)
 ;
"RTN","SAMIHOM4",805,0)
 ;
"RTN","SAMIHOM4",806,0)
MKPTLK(ptlkien,SAMIARG) ; creates patient-lookup record
"RTN","SAMIHOM4",807,0)
 ;
"RTN","SAMIHOM4",808,0)
 n ssn s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",809,0)
 i ssn'="" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",810,0)
 n name s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",811,0)
 n sinamef,sinamel
"RTN","SAMIHOM4",812,0)
 s sinamel=$p(name,","),sinamel=$$TRIM^XLFSTR(sinamel,"LR")
"RTN","SAMIHOM4",813,0)
 s sinamef=$p(name,",",2),sinamef=$$TRIM^XLFSTR(sinamef,"LR")
"RTN","SAMIHOM4",814,0)
 s name=sinamel_","_sinamef
"RTN","SAMIHOM4",815,0)
 n siteid s siteid=$g(SAMIARG("siteid"))
"RTN","SAMIHOM4",816,0)
 i siteid="" s siteid=$g(SAMIARG("site"))
"RTN","SAMIHOM4",817,0)
 ;
"RTN","SAMIHOM4",818,0)
 s @root@(ptlkien,"siteid")=siteid
"RTN","SAMIHOM4",819,0)
 s @root@(ptlkien,"saminame")=name
"RTN","SAMIHOM4",820,0)
 s @root@(ptlkien,"sinamef")=sinamef
"RTN","SAMIHOM4",821,0)
 s @root@(ptlkien,"sinamel")=sinamel
"RTN","SAMIHOM4",822,0)
 n dob s dob=$g(SAMIARG("dob"))
"RTN","SAMIHOM4",823,0)
 i dob="" s dob=$g(SAMIARG("sidob"))
"RTN","SAMIHOM4",824,0)
 n fmdob s fmdob=$$FMDT^SAMIUR2(dob)
"RTN","SAMIHOM4",825,0)
 n ptlkdob s ptlkdob=$$FMTE^XLFDT(fmdob,7)
"RTN","SAMIHOM4",826,0)
 s ptlkdob=$TR(ptlkdob,"/","-")
"RTN","SAMIHOM4",827,0)
 s @root@(ptlkien,"dob")=ptlkdob
"RTN","SAMIHOM4",828,0)
 s @root@(ptlkien,"sbdob")=ptlkdob
"RTN","SAMIHOM4",829,0)
 n gender s gender=$g(SAMIARG("gender"))
"RTN","SAMIHOM4",830,0)
 i gender="" s gender=$g(SAMIARG("sex"))
"RTN","SAMIHOM4",831,0)
 s @root@(ptlkien,"gender")=$s(gender="M":"M^MALE",1:"F^FEMALE")
"RTN","SAMIHOM4",832,0)
 s @root@(ptlkien,"sex")=$g(SAMIARG("gender"))
"RTN","SAMIHOM4",833,0)
 ; s @root@(ptlkien,"icn")=SAMIARG("icn")
"RTN","SAMIHOM4",834,0)
 s @root@(ptlkien,"ssn")=ssn
"RTN","SAMIHOM4",835,0)
 s @root@(ptlkien,"simrn")=$g(SAMIARG("simrn"))
"RTN","SAMIHOM4",836,0)
 n last5 s last5=""
"RTN","SAMIHOM4",837,0)
 i ssn'="" s last5=$$UCASE($e(name,1))_$e(ssn,6,9)
"RTN","SAMIHOM4",838,0)
 s @root@(ptlkien,"last5")=last5
"RTN","SAMIHOM4",839,0)
 n mymatch s mymatch=$g(SAMIARG("MATCHLOG"))
"RTN","SAMIHOM4",840,0)
 i mymatch'="" s @root@(ptlkien,"MATCHLOG")=mymatch
"RTN","SAMIHOM4",841,0)
 ;
"RTN","SAMIHOM4",842,0)
 quit  ; end of MKPTLK
"RTN","SAMIHOM4",843,0)
 ;
"RTN","SAMIHOM4",844,0)
 ;
"RTN","SAMIHOM4",845,0)
 ;
"RTN","SAMIHOM4",846,0)
 ;
"RTN","SAMIHOM4",847,0)
 ;@proc UPDTFRMS
"RTN","SAMIHOM4",848,0)
 ;
"RTN","SAMIHOM4",849,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",850,0)
 ;
"RTN","SAMIHOM4",851,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",852,0)
 ;@called-by
"RTN","SAMIHOM4",853,0)
 ; MERGE
"RTN","SAMIHOM4",854,0)
 ; SAVE
"RTN","SAMIHOM4",855,0)
 ;@calls
"RTN","SAMIHOM4",856,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",857,0)
 ;@input
"RTN","SAMIHOM4",858,0)
 ; dfn =
"RTN","SAMIHOM4",859,0)
 ;@output [tbd]
"RTN","SAMIHOM4",860,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",861,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",862,0)
 ;
"RTN","SAMIHOM4",863,0)
 ;
"RTN","SAMIHOM4",864,0)
UPDTFRMS(dfn) ; update demographics in all forms for patient
"RTN","SAMIHOM4",865,0)
 ;
"RTN","SAMIHOM4",866,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",867,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",868,0)
 n lien s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIHOM4",869,0)
 q:lien=""
"RTN","SAMIHOM4",870,0)
 n pien s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIHOM4",871,0)
 q:pien=""
"RTN","SAMIHOM4",872,0)
 ; this patient has forms
"RTN","SAMIHOM4",873,0)
 m @proot@(pien)=@lroot@(lien) ; refresh the demos in the patient record
"RTN","SAMIHOM4",874,0)
 n ssn s ssn=$g(@proot@(pien,"ssn"))
"RTN","SAMIHOM4",875,0)
 s @proot@(pien,"sissn")=$e(ssn,1,3)_"-"_$e(ssn,4,5)_"-"_$e(ssn,6,9)
"RTN","SAMIHOM4",876,0)
 n sid s sid=$g(@proot@("sisid")) ; studyid 
"RTN","SAMIHOM4",877,0)
 q:sid=""  ; no studyid
"RTN","SAMIHOM4",878,0)
 n zi s zi=""
"RTN","SAMIHOM4",879,0)
 f  s zi=$o(@proot@("graph",sid,zi)) q:zi=""  d  ; for each form
"RTN","SAMIHOM4",880,0)
 . m @proot@("graph",sid,zi)=@proot@(pien) ; stamp each form with new demos
"RTN","SAMIHOM4",881,0)
 ;
"RTN","SAMIHOM4",882,0)
 quit  ; end of UPDTFRMS
"RTN","SAMIHOM4",883,0)
 ;
"RTN","SAMIHOM4",884,0)
 ;
"RTN","SAMIHOM4",885,0)
 ;
"RTN","SAMIHOM4",886,0)
 ;
"RTN","SAMIHOM4",887,0)
 ;@proc MERGE
"RTN","SAMIHOM4",888,0)
 ;
"RTN","SAMIHOM4",889,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",890,0)
 ;
"RTN","SAMIHOM4",891,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",892,0)
 ;@called-by
"RTN","SAMIHOM4",893,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",894,0)
 ;@calls
"RTN","SAMIHOM4",895,0)
 ; WSUNMAT
"RTN","SAMIHOM4",896,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",897,0)
 ; UNINDXPT
"RTN","SAMIHOM4",898,0)
 ; $$NOW^XLFDT
"RTN","SAMIHOM4",899,0)
 ; $$FMTE^XLFDT
"RTN","SAMIHOM4",900,0)
 ; INDXPTLK
"RTN","SAMIHOM4",901,0)
 ; UPDTFRMS
"RTN","SAMIHOM4",902,0)
 ;@input
"RTN","SAMIHOM4",903,0)
 ; SAMIRESULT =
"RTN","SAMIHOM4",904,0)
 ; SAMIARGS =
"RTN","SAMIHOM4",905,0)
 ;@output [tbd]
"RTN","SAMIHOM4",906,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",907,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",908,0)
 ;
"RTN","SAMIHOM4",909,0)
 ;
"RTN","SAMIHOM4",910,0)
MERGE(SAMIRESULT,SAMIARGS) ; merge participant records
"RTN","SAMIHOM4",911,0)
 ;
"RTN","SAMIHOM4",912,0)
 ; called from pressing the merge button on the unmatched report
"RTN","SAMIHOM4",913,0)
 ;
"RTN","SAMIHOM4",914,0)
 n toien s toien=$g(SAMIARGS("toien"))
"RTN","SAMIHOM4",915,0)
 i toien="" d  q  ;
"RTN","SAMIHOM4",916,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",917,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",918,0)
 n fromien s fromien=$g(@lroot@(toien,"MATCHLOG"))
"RTN","SAMIHOM4",919,0)
 i fromien="" d  q  ;
"RTN","SAMIHOM4",920,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",921,0)
 ;
"RTN","SAMIHOM4",922,0)
 ; test for remotedfn in from record - not valid if absent
"RTN","SAMIHOM4",923,0)
 ;
"RTN","SAMIHOM4",924,0)
 i $g(@lroot@(fromien,"remotedfn"))="" d  q  ;
"RTN","SAMIHOM4",925,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",926,0)
 ;
"RTN","SAMIHOM4",927,0)
 ; remove index entries for from and to records
"RTN","SAMIHOM4",928,0)
 ;
"RTN","SAMIHOM4",929,0)
 d UNINDXPT(fromien) ; delete index entries
"RTN","SAMIHOM4",930,0)
 d UNINDXPT(toien)
"RTN","SAMIHOM4",931,0)
 ;
"RTN","SAMIHOM4",932,0)
 ; create changelog entry in to record - contains from record
"RTN","SAMIHOM4",933,0)
 ;
"RTN","SAMIHOM4",934,0)
 m @lroot@(toien,"changelog",$$FMTE^XLFDT($$NOW^XLFDT,5))=@lroot@(fromien)
"RTN","SAMIHOM4",935,0)
 ;
"RTN","SAMIHOM4",936,0)
 ; change the dfn in the from record to the to record dfn for merging
"RTN","SAMIHOM4",937,0)
 ;
"RTN","SAMIHOM4",938,0)
 s @lroot@(fromien,"dfn")=@lroot@(toien,"dfn")
"RTN","SAMIHOM4",939,0)
 n dfn s dfn=@lroot@(toien,"dfn") ; for use in updating forms
"RTN","SAMIHOM4",940,0)
 ;
"RTN","SAMIHOM4",941,0)
 ; merge the from record to the to record
"RTN","SAMIHOM4",942,0)
 ;
"RTN","SAMIHOM4",943,0)
 m @lroot@(toien)=@lroot@(fromien)
"RTN","SAMIHOM4",944,0)
 ;
"RTN","SAMIHOM4",945,0)
 ; delete the from record
"RTN","SAMIHOM4",946,0)
 ;
"RTN","SAMIHOM4",947,0)
 k @lroot@(fromien)
"RTN","SAMIHOM4",948,0)
 ;
"RTN","SAMIHOM4",949,0)
 ; reindex the to record
"RTN","SAMIHOM4",950,0)
 ;
"RTN","SAMIHOM4",951,0)
 d INDXPTLK(toien)
"RTN","SAMIHOM4",952,0)
 ;
"RTN","SAMIHOM4",953,0)
 ; propagate the updated from record to every form
"RTN","SAMIHOM4",954,0)
 ;
"RTN","SAMIHOM4",955,0)
 d UPDTFRMS(dfn) ; updates the patient in the vapals-patient graph
"RTN","SAMIHOM4",956,0)
 ;
"RTN","SAMIHOM4",957,0)
 ; leave and return to the unmatched report
"RTN","SAMIHOM4",958,0)
 ;   note that the form and to records will no longer be in the report
"RTN","SAMIHOM4",959,0)
 ;
"RTN","SAMIHOM4",960,0)
 d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",961,0)
 ;
"RTN","SAMIHOM4",962,0)
 quit  ; end of MERGE
"RTN","SAMIHOM4",963,0)
 ;
"RTN","SAMIHOM4",964,0)
 ;
"RTN","SAMIHOM4",965,0)
 ;
"RTN","SAMIHOM4",966,0)
 ;
"RTN","SAMIHOM4",967,0)
 ;@proc ADDUNMAT
"RTN","SAMIHOM4",968,0)
 ;
"RTN","SAMIHOM4",969,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",970,0)
 ;
"RTN","SAMIHOM4",971,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",972,0)
 ;@called-by none
"RTN","SAMIHOM4",973,0)
 ;@calls
"RTN","SAMIHOM4",974,0)
 ; addService^%webutils
"RTN","SAMIHOM4",975,0)
 ;@input none
"RTN","SAMIHOM4",976,0)
 ;@output [tbd]
"RTN","SAMIHOM4",977,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",978,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",979,0)
 ;
"RTN","SAMIHOM4",980,0)
 ;
"RTN","SAMIHOM4",981,0)
ADDUNMAT ; adds unmatched report web service to system
"RTN","SAMIHOM4",982,0)
 ;
"RTN","SAMIHOM4",983,0)
 d addService^%webutils("GET","unmatched","WSUNMAT^SAMIHOM4")
"RTN","SAMIHOM4",984,0)
 ;
"RTN","SAMIHOM4",985,0)
 quit  ; end of ADDUNMAT
"RTN","SAMIHOM4",986,0)
 ;
"RTN","SAMIHOM4",987,0)
 ;
"RTN","SAMIHOM4",988,0)
 ;
"RTN","SAMIHOM4",989,0)
 ;
"RTN","SAMIHOM4",990,0)
 ;@proc DELUNMAT
"RTN","SAMIHOM4",991,0)
 ;
"RTN","SAMIHOM4",992,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",993,0)
 ;
"RTN","SAMIHOM4",994,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",995,0)
 ;@called-by none
"RTN","SAMIHOM4",996,0)
 ;@calls
"RTN","SAMIHOM4",997,0)
 ; deleteService^%webutils
"RTN","SAMIHOM4",998,0)
 ;@input none
"RTN","SAMIHOM4",999,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1000,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1001,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1002,0)
 ;
"RTN","SAMIHOM4",1003,0)
 ;
"RTN","SAMIHOM4",1004,0)
DELUNMAT ; deletes unmatched web service
"RTN","SAMIHOM4",1005,0)
 ;
"RTN","SAMIHOM4",1006,0)
 d deleteService^%webutils("GET","unmatched")
"RTN","SAMIHOM4",1007,0)
 ;
"RTN","SAMIHOM4",1008,0)
 quit  ; end of DELUNMAT
"RTN","SAMIHOM4",1009,0)
 ;
"RTN","SAMIHOM4",1010,0)
 ;
"RTN","SAMIHOM4",1011,0)
 ;
"RTN","SAMIHOM4",1012,0)
 ;
"RTN","SAMIHOM4",1013,0)
 ;@ws-code get-unmatched WSUNMAT^SAMIHOM4
"RTN","SAMIHOM4",1014,0)
 ;
"RTN","SAMIHOM4",1015,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1016,0)
 ;
"RTN","SAMIHOM4",1017,0)
 ;ven/gpl;ws;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1018,0)
 ;@called-by
"RTN","SAMIHOM4",1019,0)
 ; web service get unmatched
"RTN","SAMIHOM4",1020,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",1021,0)
 ; LOGIN^SAMISITE
"RTN","SAMIHOM4",1022,0)
 ; MERGE
"RTN","SAMIHOM4",1023,0)
 ;@calls
"RTN","SAMIHOM4",1024,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",1025,0)
 ;@input
"RTN","SAMIHOM4",1026,0)
 ; SAMIARGS =
"RTN","SAMIHOM4",1027,0)
 ;@output
"RTN","SAMIHOM4",1028,0)
 ;.SAMIRESULT =
"RTN","SAMIHOM4",1029,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1030,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1031,0)
 ;
"RTN","SAMIHOM4",1032,0)
 ;
"RTN","SAMIHOM4",1033,0)
WSUNMAT(SAMIRESULT,SAMIARGS) ; navigates to unmatched report
"RTN","SAMIHOM4",1034,0)
 ; 
"RTN","SAMIHOM4",1035,0)
 n filter,bdy
"RTN","SAMIHOM4",1036,0)
 s bdy=""
"RTN","SAMIHOM4",1037,0)
 ;s filter("siteid")="PHX"
"RTN","SAMIHOM4",1038,0)
 s filter("samiroute")="report"
"RTN","SAMIHOM4",1039,0)
 s filter("samireporttype")="unmatched"
"RTN","SAMIHOM4",1040,0)
 d WSVAPALS^SAMIHOM3(.filter,.bdy,.SAMIRESULT) ; back to the unmatched report
"RTN","SAMIHOM4",1041,0)
 ;
"RTN","SAMIHOM4",1042,0)
 quit  ; end of ws-code get-unmatched WSUNMAT^SAMIHOM4
"RTN","SAMIHOM4",1043,0)
 ;
"RTN","SAMIHOM4",1044,0)
 ;
"RTN","SAMIHOM4",1045,0)
 ;
"RTN","SAMIHOM4",1046,0)
 ;
"RTN","SAMIHOM4",1047,0)
 ;@func $$DUPSSN
"RTN","SAMIHOM4",1048,0)
 ;
"RTN","SAMIHOM4",1049,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1050,0)
 ;
"RTN","SAMIHOM4",1051,0)
 ;ven/gpl;private;function;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1052,0)
 ;@called-by none
"RTN","SAMIHOM4",1053,0)
 ; REG [commented out]
"RTN","SAMIHOM4",1054,0)
 ;@calls
"RTN","SAMIHOM4",1055,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1056,0)
 ;@input
"RTN","SAMIHOM4",1057,0)
 ; ssn =
"RTN","SAMIHOM4",1058,0)
 ;@output = 1 if ssn is duplicate; else 0
"RTN","SAMIHOM4",1059,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1060,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1061,0)
 ;
"RTN","SAMIHOM4",1062,0)
 ;
"RTN","SAMIHOM4",1063,0)
DUPSSN(ssn) ; is ssn duplicate?
"RTN","SAMIHOM4",1064,0)
 ;
"RTN","SAMIHOM4",1065,0)
 n proot s proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1066,0)
 i $d(@proot@("ssn",ssn)) q 1
"RTN","SAMIHOM4",1067,0)
 ;
"RTN","SAMIHOM4",1068,0)
 quit 0 ; end of $$DUPSSN
"RTN","SAMIHOM4",1069,0)
 ;
"RTN","SAMIHOM4",1070,0)
 ;
"RTN","SAMIHOM4",1071,0)
 ;
"RTN","SAMIHOM4",1072,0)
 ;
"RTN","SAMIHOM4",1073,0)
 ;@func $$DUPICN
"RTN","SAMIHOM4",1074,0)
 ;
"RTN","SAMIHOM4",1075,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1076,0)
 ;
"RTN","SAMIHOM4",1077,0)
 ;ven/gpl;private;function;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1078,0)
 ;@called-by none
"RTN","SAMIHOM4",1079,0)
 ; REG [commented out]
"RTN","SAMIHOM4",1080,0)
 ;@calls
"RTN","SAMIHOM4",1081,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1082,0)
 ;@input
"RTN","SAMIHOM4",1083,0)
 ; icn =
"RTN","SAMIHOM4",1084,0)
 ;@output = 1 if icn is duplicate; else 0
"RTN","SAMIHOM4",1085,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1086,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1087,0)
 ;
"RTN","SAMIHOM4",1088,0)
 ;
"RTN","SAMIHOM4",1089,0)
DUPICN(icn) ; is icn duplicate?
"RTN","SAMIHOM4",1090,0)
 ;
"RTN","SAMIHOM4",1091,0)
 n proot s proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1092,0)
 n tmpicn s tmpicn=$p(icn,"V",1)
"RTN","SAMIHOM4",1093,0)
 i $d(@proot@("icn",icn)) q 1
"RTN","SAMIHOM4",1094,0)
 i $d(@proot@("icn",tmpicn)) q 1
"RTN","SAMIHOM4",1095,0)
 ;
"RTN","SAMIHOM4",1096,0)
 quit 0 ; end of $$DUPICN
"RTN","SAMIHOM4",1097,0)
 ;
"RTN","SAMIHOM4",1098,0)
 ;
"RTN","SAMIHOM4",1099,0)
 ;
"RTN","SAMIHOM4",1100,0)
 ;
"RTN","SAMIHOM4",1101,0)
 ;@func $$BADICN
"RTN","SAMIHOM4",1102,0)
 ;
"RTN","SAMIHOM4",1103,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1104,0)
 ;
"RTN","SAMIHOM4",1105,0)
 ;ven/gpl;private;function;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1106,0)
 ;@called-by none
"RTN","SAMIHOM4",1107,0)
 ; REG [commented out]
"RTN","SAMIHOM4",1108,0)
 ;@calls
"RTN","SAMIHOM4",1109,0)
 ; $$CHECKDG^MPIFSPC
"RTN","SAMIHOM4",1110,0)
 ;@input
"RTN","SAMIHOM4",1111,0)
 ; icn =
"RTN","SAMIHOM4",1112,0)
 ;@output = 1 if icn checkdigits are wrong; else 0
"RTN","SAMIHOM4",1113,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1114,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1115,0)
 ;
"RTN","SAMIHOM4",1116,0)
 ;
"RTN","SAMIHOM4",1117,0)
BADICN(icn) ; are ICN checkdigits wrong?
"RTN","SAMIHOM4",1118,0)
 ;
"RTN","SAMIHOM4",1119,0)
 n zchk s zchk=$p(icn,"V",2)
"RTN","SAMIHOM4",1120,0)
 n zicn s zicn=$p(icn,"V",1)
"RTN","SAMIHOM4",1121,0)
 q:zchk="" 1
"RTN","SAMIHOM4",1122,0)
 i zchk'=$$CHECKDG^MPIFSPC(zicn) q 1
"RTN","SAMIHOM4",1123,0)
 ;
"RTN","SAMIHOM4",1124,0)
 quit 0 ; end of $$BADICN
"RTN","SAMIHOM4",1125,0)
 ;
"RTN","SAMIHOM4",1126,0)
 ;
"RTN","SAMIHOM4",1127,0)
 ;
"RTN","SAMIHOM4",1128,0)
 ;
"RTN","SAMIHOM4",1129,0)
 ;@proc SAVE
"RTN","SAMIHOM4",1130,0)
 ;
"RTN","SAMIHOM4",1131,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1132,0)
 ;
"RTN","SAMIHOM4",1133,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1134,0)
 ;@called-by
"RTN","SAMIHOM4",1135,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",1136,0)
 ;@calls
"RTN","SAMIHOM4",1137,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",1138,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1139,0)
 ; UNINDXPT
"RTN","SAMIHOM4",1140,0)
 ; $$REMATCH
"RTN","SAMIHOM4",1141,0)
 ; MKPTLK
"RTN","SAMIHOM4",1142,0)
 ; INDXPTLK
"RTN","SAMIHOM4",1143,0)
 ; UPDTFRMS
"RTN","SAMIHOM4",1144,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",1145,0)
 ;@input
"RTN","SAMIHOM4",1146,0)
 ; SAMIARG =
"RTN","SAMIHOM4",1147,0)
 ;@output
"RTN","SAMIHOM4",1148,0)
 ;.SAMIRESULT =
"RTN","SAMIHOM4",1149,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1150,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1151,0)
 ;
"RTN","SAMIHOM4",1152,0)
 ;
"RTN","SAMIHOM4",1153,0)
SAVE(SAMIRESULT,SAMIARG) ; save patient-lookup record after edit
"RTN","SAMIHOM4",1154,0)
 ;
"RTN","SAMIHOM4",1155,0)
 n dfn s dfn=$g(vars("dfn")) ; must have a dfn
"RTN","SAMIHOM4",1156,0)
 i dfn="" d  q  ;
"RTN","SAMIHOM4",1157,0)
 . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home 
"RTN","SAMIHOM4",1158,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1159,0)
 n sien s sien=$o(@root@("dfn",dfn,""))
"RTN","SAMIHOM4",1160,0)
 i sien="" d  q  ;
"RTN","SAMIHOM4",1161,0)
 . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home 
"RTN","SAMIHOM4",1162,0)
 d UNINDXPT(sien) ; remove old index entries
"RTN","SAMIHOM4",1163,0)
 n zm
"RTN","SAMIHOM4",1164,0)
 k SAMIARG("MATCHLOG")
"RTN","SAMIHOM4",1165,0)
 s zm=$$REMATCH(sien,.SAMIARG)
"RTN","SAMIHOM4",1166,0)
 i zm>0 d  ;
"RTN","SAMIHOM4",1167,0)
 . s SAMIARG("MATCHLOG")=zm
"RTN","SAMIHOM4",1168,0)
 d MKPTLK(sien,.SAMIARG) ; add the updated fields
"RTN","SAMIHOM4",1169,0)
 d INDXPTLK(sien) ; create new index entries
"RTN","SAMIHOM4",1170,0)
 d UPDTFRMS(dfn) ; update demographic info in all forms
"RTN","SAMIHOM4",1171,0)
 n filter,bdy
"RTN","SAMIHOM4",1172,0)
 s bdy=""
"RTN","SAMIHOM4",1173,0)
 m filter=SAMIARG
"RTN","SAMIHOM4",1174,0)
 s filter("samiroute")="report"
"RTN","SAMIHOM4",1175,0)
 s filter("samireporttype")="unmatched"
"RTN","SAMIHOM4",1176,0)
 d WSVAPALS^SAMIHOM3(.filter,.bdy,.SAMIRESULT) ; back to the unmatched report
"RTN","SAMIHOM4",1177,0)
 ;
"RTN","SAMIHOM4",1178,0)
 quit  ; end of SAVE
"RTN","SAMIHOM4",1179,0)
 ;
"RTN","SAMIHOM4",1180,0)
 ;
"RTN","SAMIHOM4",1181,0)
 ;
"RTN","SAMIHOM4",1182,0)
 ;
"RTN","SAMIHOM4",1183,0)
 ;@func $$REMATCH
"RTN","SAMIHOM4",1184,0)
 ;
"RTN","SAMIHOM4",1185,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1186,0)
 ;
"RTN","SAMIHOM4",1187,0)
 ;ven/gpl;private;function;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1188,0)
 ;@called-by
"RTN","SAMIHOM4",1189,0)
 ; REG
"RTN","SAMIHOM4",1190,0)
 ; SAVE
"RTN","SAMIHOM4",1191,0)
 ;@calls
"RTN","SAMIHOM4",1192,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1193,0)
 ; $$UCASE
"RTN","SAMIHOM4",1194,0)
 ;@input
"RTN","SAMIHOM4",1195,0)
 ; SAMIARG =
"RTN","SAMIHOM4",1196,0)
 ;@output
"RTN","SAMIHOM4",1197,0)
 ;.sien =
"RTN","SAMIHOM4",1198,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1199,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1200,0)
 ;
"RTN","SAMIHOM4",1201,0)
 ;
"RTN","SAMIHOM4",1202,0)
REMATCH(sien,SAMIARG) ; extrinsic returns possible match ien
"RTN","SAMIHOM4",1203,0)
 ;
"RTN","SAMIHOM4",1204,0)
 ; else zero
"RTN","SAMIHOM4",1205,0)
 ;
"RTN","SAMIHOM4",1206,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1207,0)
 n ssn,name,icn,x,y
"RTN","SAMIHOM4",1208,0)
 s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",1209,0)
 i ssn["-" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",1210,0)
 s name=$g(SAMIARG("saminame"))
"RTN","SAMIHOM4",1211,0)
 i name="" s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",1212,0)
 s name=$$UCASE(name)
"RTN","SAMIHOM4",1213,0)
 ; s icn=$g(SAMIARG("icn"))
"RTN","SAMIHOM4",1214,0)
 s x=0
"RTN","SAMIHOM4",1215,0)
 i ssn'="" s x=$o(@lroot@("ssn",ssn,""))
"RTN","SAMIHOM4",1216,0)
 i x=sien s x=$o(@lroot@("ssn",ssn,x))
"RTN","SAMIHOM4",1217,0)
 i +x'=0 d  ;
"RTN","SAMIHOM4",1218,0)
 . s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",1219,0)
 . ;i y>9000000 s x=0
"RTN","SAMIHOM4",1220,0)
 i x>0 q x
"RTN","SAMIHOM4",1221,0)
 i name'="" s x=$o(@lroot@("name",name,""))
"RTN","SAMIHOM4",1222,0)
 i x=sien s x=$o(@lroot@("name",name,x))
"RTN","SAMIHOM4",1223,0)
 i +x'=0 d  ;
"RTN","SAMIHOM4",1224,0)
 . s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",1225,0)
 . ;i y>9000000 s x=0
"RTN","SAMIHOM4",1226,0)
 i x>0 q x
"RTN","SAMIHOM4",1227,0)
 ;i icn'="" s x=$o(@lroot@("icn",icn,""))
"RTN","SAMIHOM4",1228,0)
 ;i x=sien s x=$o(@lroot@("icn",icn,x))
"RTN","SAMIHOM4",1229,0)
 ;i +x'=0 d  ;
"RTN","SAMIHOM4",1230,0)
 ;. s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",1231,0)
 ;. i y>9000000 s x=0
"RTN","SAMIHOM4",1232,0)
 ;i x>0 q x
"RTN","SAMIHOM4",1233,0)
 ;
"RTN","SAMIHOM4",1234,0)
 quit 0 ; end of $$REMATCH
"RTN","SAMIHOM4",1235,0)
 ;
"RTN","SAMIHOM4",1236,0)
 ;
"RTN","SAMIHOM4",1237,0)
 ;
"RTN","SAMIHOM4",1238,0)
 ;
"RTN","SAMIHOM4",1239,0)
 ;@proc SETINFO
"RTN","SAMIHOM4",1240,0)
 ;
"RTN","SAMIHOM4",1241,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1242,0)
 ;
"RTN","SAMIHOM4",1243,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1244,0)
 ;@called-by
"RTN","SAMIHOM4",1245,0)
 ; REG
"RTN","SAMIHOM4",1246,0)
 ;@calls none
"RTN","SAMIHOM4",1247,0)
 ;@input
"RTN","SAMIHOM4",1248,0)
 ; msg = info msg
"RTN","SAMIHOM4",1249,0)
 ;@output
"RTN","SAMIHOM4",1250,0)
 ;.vars("infoMessage") = info msg
"RTN","SAMIHOM4",1251,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1252,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1253,0)
 ;
"RTN","SAMIHOM4",1254,0)
 ;
"RTN","SAMIHOM4",1255,0)
SETINFO(vars,msg) ; set information message text
"RTN","SAMIHOM4",1256,0)
 ;
"RTN","SAMIHOM4",1257,0)
 ; vars are the screen variables passed by reference
"RTN","SAMIHOM4",1258,0)
 ;
"RTN","SAMIHOM4",1259,0)
 s vars("infoMessage")=msg
"RTN","SAMIHOM4",1260,0)
 ;
"RTN","SAMIHOM4",1261,0)
 quit  ; end of SETINFO
"RTN","SAMIHOM4",1262,0)
 ;
"RTN","SAMIHOM4",1263,0)
 ;
"RTN","SAMIHOM4",1264,0)
 ;
"RTN","SAMIHOM4",1265,0)
 ;
"RTN","SAMIHOM4",1266,0)
 ;@proc SETWARN
"RTN","SAMIHOM4",1267,0)
 ;
"RTN","SAMIHOM4",1268,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1269,0)
 ;
"RTN","SAMIHOM4",1270,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1271,0)
 ;@called-by none
"RTN","SAMIHOM4",1272,0)
 ; REG [commented out]
"RTN","SAMIHOM4",1273,0)
 ;@calls none
"RTN","SAMIHOM4",1274,0)
 ;@input
"RTN","SAMIHOM4",1275,0)
 ; msg = warning msg
"RTN","SAMIHOM4",1276,0)
 ;@output
"RTN","SAMIHOM4",1277,0)
 ;.vars("warnMessage") = warning msg
"RTN","SAMIHOM4",1278,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1279,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1280,0)
 ;
"RTN","SAMIHOM4",1281,0)
 ;
"RTN","SAMIHOM4",1282,0)
SETWARN(vars,msg) ; set warning message text
"RTN","SAMIHOM4",1283,0)
 ;
"RTN","SAMIHOM4",1284,0)
 ; vars are the screen variables passed by reference
"RTN","SAMIHOM4",1285,0)
 ;
"RTN","SAMIHOM4",1286,0)
 s vars("warnMessage")=msg
"RTN","SAMIHOM4",1287,0)
 ;
"RTN","SAMIHOM4",1288,0)
 quit  ; end of SETWARN
"RTN","SAMIHOM4",1289,0)
 ;
"RTN","SAMIHOM4",1290,0)
 ;
"RTN","SAMIHOM4",1291,0)
 ;
"RTN","SAMIHOM4",1292,0)
 ;
"RTN","SAMIHOM4",1293,0)
 ;@proc RTNERR
"RTN","SAMIHOM4",1294,0)
 ;
"RTN","SAMIHOM4",1295,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1296,0)
 ;
"RTN","SAMIHOM4",1297,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1298,0)
 ;@called-by
"RTN","SAMIHOM4",1299,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",1300,0)
 ; REG
"RTN","SAMIHOM4",1301,0)
 ;@calls
"RTN","SAMIHOM4",1302,0)
 ; SAMIHTM^%wf
"RTN","SAMIHOM4",1303,0)
 ; MERGEHTM^%wf
"RTN","SAMIHOM4",1304,0)
 ;@input
"RTN","SAMIHOM4",1305,0)
 ; form = form the page requires
"RTN","SAMIHOM4",1306,0)
 ;.vals = values for the page. passed by reference
"RTN","SAMIHOM4",1307,0)
 ; msg = error message to be displayed
"RTN","SAMIHOM4",1308,0)
 ; fld = name of the field where the cursor should be put
"RTN","SAMIHOM4",1309,0)
 ;@output
"RTN","SAMIHOM4",1310,0)
 ;.rtn = return array
"RTN","SAMIHOM4",1311,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1312,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1313,0)
 ;
"RTN","SAMIHOM4",1314,0)
 ;
"RTN","SAMIHOM4",1315,0)
RTNERR(rtn,form,vals,msg,fld) ; redisplay page w/error message
"RTN","SAMIHOM4",1316,0)
 ;
"RTN","SAMIHOM4",1317,0)
 n zhtml ; work area for the tempate
"RTN","SAMIHOM4",1318,0)
 d SAMIHTM^%wf(.zhtml,form,.err)
"RTN","SAMIHOM4",1319,0)
 d MERGEHTM^%wf(.zhtml,.vals,.err)
"RTN","SAMIHOM4",1320,0)
 m rtn=zhtml
"RTN","SAMIHOM4",1321,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMIHOM4",1322,0)
 ;
"RTN","SAMIHOM4",1323,0)
 quit  ; end of RTNERR
"RTN","SAMIHOM4",1324,0)
 ;
"RTN","SAMIHOM4",1325,0)
 ;
"RTN","SAMIHOM4",1326,0)
 ;
"RTN","SAMIHOM4",1327,0)
 ;
"RTN","SAMIHOM4",1328,0)
 ;@proc RTNPAGE
"RTN","SAMIHOM4",1329,0)
 ;
"RTN","SAMIHOM4",1330,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1331,0)
 ;
"RTN","SAMIHOM4",1332,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1333,0)
 ;@called-by
"RTN","SAMIHOM4",1334,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",1335,0)
 ;@calls
"RTN","SAMIHOM4",1336,0)
 ; SAMIHTM^%wf
"RTN","SAMIHOM4",1337,0)
 ; MERGEHTM^%wf
"RTN","SAMIHOM4",1338,0)
 ;@input
"RTN","SAMIHOM4",1339,0)
 ; form = form the page requires
"RTN","SAMIHOM4",1340,0)
 ;.vals = values for the page. passed by reference
"RTN","SAMIHOM4",1341,0)
 ;@output
"RTN","SAMIHOM4",1342,0)
 ;.rtn = return array
"RTN","SAMIHOM4",1343,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1344,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1345,0)
 ;
"RTN","SAMIHOM4",1346,0)
 ;
"RTN","SAMIHOM4",1347,0)
RTNPAGE(rtn,form,vals) ; display page
"RTN","SAMIHOM4",1348,0)
 ;
"RTN","SAMIHOM4",1349,0)
 ; rtn is the return array
"RTN","SAMIHOM4",1350,0)
 ; form is the form the page requires
"RTN","SAMIHOM4",1351,0)
 ; vals are the values for the page. passed by reference
"RTN","SAMIHOM4",1352,0)
 ;
"RTN","SAMIHOM4",1353,0)
 n err
"RTN","SAMIHOM4",1354,0)
 n zhtml ; work area for the tempate
"RTN","SAMIHOM4",1355,0)
 d SAMIHTM^%wf(.zhtml,form,.err)
"RTN","SAMIHOM4",1356,0)
 d MERGEHTM^%wf(.zhtml,.vals,.err)
"RTN","SAMIHOM4",1357,0)
 m SAMIRESULT=zhtml
"RTN","SAMIHOM4",1358,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMIHOM4",1359,0)
 ;
"RTN","SAMIHOM4",1360,0)
 quit  ; end of RTNPAGE
"RTN","SAMIHOM4",1361,0)
 ;
"RTN","SAMIHOM4",1362,0)
 ;
"RTN","SAMIHOM4",1363,0)
 ;
"RTN","SAMIHOM4",1364,0)
 ;
"RTN","SAMIHOM4",1365,0)
 ;@proc REINDXPL
"RTN","SAMIHOM4",1366,0)
 ;
"RTN","SAMIHOM4",1367,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1368,0)
 ;
"RTN","SAMIHOM4",1369,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1370,0)
 ;@called-by none
"RTN","SAMIHOM4",1371,0)
 ;@calls
"RTN","SAMIHOM4",1372,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1373,0)
 ; INDXPTLK
"RTN","SAMIHOM4",1374,0)
 ;@input [tbd]
"RTN","SAMIHOM4",1375,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1376,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1377,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1378,0)
 ;
"RTN","SAMIHOM4",1379,0)
 ;
"RTN","SAMIHOM4",1380,0)
REINDXPL ; reindex patient lookup
"RTN","SAMIHOM4",1381,0)
 ;
"RTN","SAMIHOM4",1382,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1383,0)
 n zi s zi=0
"RTN","SAMIHOM4",1384,0)
 k @root@("dfn")
"RTN","SAMIHOM4",1385,0)
 k @root@("ssn")
"RTN","SAMIHOM4",1386,0)
 k @root@("name")
"RTN","SAMIHOM4",1387,0)
 k @root@("last5")
"RTN","SAMIHOM4",1388,0)
 k @root@("sinamef")
"RTN","SAMIHOM4",1389,0)
 k @root@("sinamel")
"RTN","SAMIHOM4",1390,0)
 ; k @root@("icn")
"RTN","SAMIHOM4",1391,0)
 f  s zi=$o(@root@(zi)) q:+zi=0  d  ;
"RTN","SAMIHOM4",1392,0)
 . d INDXPTLK(zi)
"RTN","SAMIHOM4",1393,0)
 ;
"RTN","SAMIHOM4",1394,0)
 quit  ; end of REINDXPL
"RTN","SAMIHOM4",1395,0)
 ;
"RTN","SAMIHOM4",1396,0)
 ;
"RTN","SAMIHOM4",1397,0)
 ;
"RTN","SAMIHOM4",1398,0)
 ;
"RTN","SAMIHOM4",1399,0)
 ;@pps INDXPTLK
"RTN","SAMIHOM4",1400,0)
 ;
"RTN","SAMIHOM4",1401,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1402,0)
 ;
"RTN","SAMIHOM4",1403,0)
 ;ven/gpl;pps;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1404,0)
 ;@called-by
"RTN","SAMIHOM4",1405,0)
 ; WSDCMKIL^SAMIDCM1
"RTN","SAMIHOM4",1406,0)
 ; wsPostSAMI^SAMIJS2
"RTN","SAMIHOM4",1407,0)
 ; REG
"RTN","SAMIHOM4",1408,0)
 ; MERGE
"RTN","SAMIHOM4",1409,0)
 ; SAVE
"RTN","SAMIHOM4",1410,0)
 ; REINDXPL
"RTN","SAMIHOM4",1411,0)
 ;@calls
"RTN","SAMIHOM4",1412,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1413,0)
 ; $$UCASE
"RTN","SAMIHOM4",1414,0)
 ; $$CHECKDG^MPIFSPC [commented out]
"RTN","SAMIHOM4",1415,0)
 ; $$HTE^XLFDT
"RTN","SAMIHOM4",1416,0)
 ;@input
"RTN","SAMIHOM4",1417,0)
 ; ien = entry ien
"RTN","SAMIHOM4",1418,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1419,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1420,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1421,0)
 ;
"RTN","SAMIHOM4",1422,0)
 ;
"RTN","SAMIHOM4",1423,0)
INDXPTLK(ien) ; generate index entries in patient-lookup graph
"RTN","SAMIHOM4",1424,0)
 ;
"RTN","SAMIHOM4",1425,0)
 ; for entry ien
"RTN","SAMIHOM4",1426,0)
 ;
"RTN","SAMIHOM4",1427,0)
 n proot set proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1428,0)
 n name s name=$g(@proot@(ien,"saminame"))
"RTN","SAMIHOM4",1429,0)
 s @proot@("name",name,ien)=""
"RTN","SAMIHOM4",1430,0)
 n ucname s ucname=$$UCASE(name)
"RTN","SAMIHOM4",1431,0)
 s @proot@("name",ucname,ien)=""
"RTN","SAMIHOM4",1432,0)
 n x
"RTN","SAMIHOM4",1433,0)
 s x=$g(@proot@(ien,"dfn")) ;w !,x
"RTN","SAMIHOM4",1434,0)
 i x="" d  ;
"RTN","SAMIHOM4",1435,0)
 . s x=$o(@proot@("dfn","   "),-1)+1
"RTN","SAMIHOM4",1436,0)
 . s @proot@(ien,"dfn")=x
"RTN","SAMIHOM4",1437,0)
 s:x'="" @proot@("dfn",x,ien)=""
"RTN","SAMIHOM4",1438,0)
 s x=$g(@proot@(ien,"last5")) ;w !,x
"RTN","SAMIHOM4",1439,0)
 s:x'="" @proot@("last5",x,ien)=""
"RTN","SAMIHOM4",1440,0)
 ;
"RTN","SAMIHOM4",1441,0)
 ; s x=$g(@proot@(ien,"icn")) ;w !,x
"RTN","SAMIHOM4",1442,0)
 ; i x'["V" d  ;
"RTN","SAMIHOM4",1443,0)
 ; . i x="" q
"RTN","SAMIHOM4",1444,0)
 ; . n chk s chk=$$CHECKDG^MPIFSPC(x)
"RTN","SAMIHOM4",1445,0)
 ; . s @proot@(ien,"icn")=x_"V"_chk
"RTN","SAMIHOM4",1446,0)
 ; . s x=x_"V"_chk
"RTN","SAMIHOM4",1447,0)
 ; s:x'="" @proot@("icn",x,ien)=""
"RTN","SAMIHOM4",1448,0)
 ;
"RTN","SAMIHOM4",1449,0)
 s x=$g(@proot@(ien,"ssn")) ;w !,x
"RTN","SAMIHOM4",1450,0)
 s:x'="" @proot@("ssn",x,ien)=""
"RTN","SAMIHOM4",1451,0)
 s x=$g(@proot@(ien,"sinamef")) ;w !,x
"RTN","SAMIHOM4",1452,0)
 s:x'="" @proot@("sinamef",x,ien)=""
"RTN","SAMIHOM4",1453,0)
 s x=$g(@proot@(ien,"sinamel")) ;w !,x
"RTN","SAMIHOM4",1454,0)
 s:x'="" @proot@("sinamel",x,ien)=""
"RTN","SAMIHOM4",1455,0)
 set @proot@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHOM4",1456,0)
 ;
"RTN","SAMIHOM4",1457,0)
 quit  ; end of pps INDXPTLK
"RTN","SAMIHOM4",1458,0)
 ;
"RTN","SAMIHOM4",1459,0)
 ;
"RTN","SAMIHOM4",1460,0)
 ;
"RTN","SAMIHOM4",1461,0)
 ;
"RTN","SAMIHOM4",1462,0)
 ;@pps UNINDXPT
"RTN","SAMIHOM4",1463,0)
 ;
"RTN","SAMIHOM4",1464,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1465,0)
 ;
"RTN","SAMIHOM4",1466,0)
 ;ven/gpl;pps;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1467,0)
 ;@called-by
"RTN","SAMIHOM4",1468,0)
 ; WSDCMKIL^SAMIDCM1
"RTN","SAMIHOM4",1469,0)
 ;@calls
"RTN","SAMIHOM4",1470,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1471,0)
 ; $$UCASE
"RTN","SAMIHOM4",1472,0)
 ; $$CHECKDG^MPIFSPC [commented out]
"RTN","SAMIHOM4",1473,0)
 ; $$HTE^XLFDT
"RTN","SAMIHOM4",1474,0)
 ;@input
"RTN","SAMIHOM4",1475,0)
 ; ien = entry ien
"RTN","SAMIHOM4",1476,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1477,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1478,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1479,0)
 ;
"RTN","SAMIHOM4",1480,0)
 ;
"RTN","SAMIHOM4",1481,0)
UNINDXPT(ien) ; remove index entries from patient-lookup graph
"RTN","SAMIHOM4",1482,0)
 ;
"RTN","SAMIHOM4",1483,0)
 ; for entry ien
"RTN","SAMIHOM4",1484,0)
 ;
"RTN","SAMIHOM4",1485,0)
 n proot set proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1486,0)
 n name s name=$g(@proot@(ien,"saminame"))
"RTN","SAMIHOM4",1487,0)
 k @proot@("name",name,ien)
"RTN","SAMIHOM4",1488,0)
 n ucname s ucname=$$UCASE(name)
"RTN","SAMIHOM4",1489,0)
 k @proot@("name",ucname,ien)
"RTN","SAMIHOM4",1490,0)
 n x
"RTN","SAMIHOM4",1491,0)
 s x=$g(@proot@(ien,"dfn")) ;w !,x
"RTN","SAMIHOM4",1492,0)
 k:x'="" @proot@("dfn",x,ien)
"RTN","SAMIHOM4",1493,0)
 s x=$g(@proot@(ien,"last5")) ;w !,x
"RTN","SAMIHOM4",1494,0)
 k:x'="" @proot@("last5",x,ien)
"RTN","SAMIHOM4",1495,0)
 ;
"RTN","SAMIHOM4",1496,0)
 ; s x=$g(@proot@(ien,"icn")) ;w !,x
"RTN","SAMIHOM4",1497,0)
 ; i x'["V" d  ;
"RTN","SAMIHOM4",1498,0)
 ; . i x="" q
"RTN","SAMIHOM4",1499,0)
 ; . n chk s chk=$$CHECKDG^MPIFSPC(x)
"RTN","SAMIHOM4",1500,0)
 ; . s @proot@(ien,"icn")=x_"V"_chk
"RTN","SAMIHOM4",1501,0)
 ; . s x=x_"V"_chk
"RTN","SAMIHOM4",1502,0)
 ; k:x'="" @proot@("icn",x,ien)
"RTN","SAMIHOM4",1503,0)
 ;
"RTN","SAMIHOM4",1504,0)
 s x=$g(@proot@(ien,"ssn")) ;w !,x
"RTN","SAMIHOM4",1505,0)
 k:x'="" @proot@("ssn",x,ien)
"RTN","SAMIHOM4",1506,0)
 s x=$g(@proot@(ien,"sinamef")) ;w !,x
"RTN","SAMIHOM4",1507,0)
 k:x'="" @proot@("sinamef",x,ien)
"RTN","SAMIHOM4",1508,0)
 s x=$g(@proot@(ien,"sinamel")) w !,x
"RTN","SAMIHOM4",1509,0)
 k:x'="" @proot@("sinamel",x,ien)
"RTN","SAMIHOM4",1510,0)
 set @proot@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHOM4",1511,0)
 ;
"RTN","SAMIHOM4",1512,0)
 quit  ; end of UNINDXPT
"RTN","SAMIHOM4",1513,0)
 ;
"RTN","SAMIHOM4",1514,0)
 ;
"RTN","SAMIHOM4",1515,0)
 ;
"RTN","SAMIHOM4",1516,0)
 ;
"RTN","SAMIHOM4",1517,0)
 ;@func $$UCASE
"RTN","SAMIHOM4",1518,0)
 ;
"RTN","SAMIHOM4",1519,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1520,0)
 ;
"RTN","SAMIHOM4",1521,0)
 ;ven/gpl;private;function;clean;silent;sac;tests?;port?
"RTN","SAMIHOM4",1522,0)
 ;@called-by
"RTN","SAMIHOM4",1523,0)
 ; MKPTLK
"RTN","SAMIHOM4",1524,0)
 ; REMATCH
"RTN","SAMIHOM4",1525,0)
 ; INDXPTLK
"RTN","SAMIHOM4",1526,0)
 ; UNINDXPT
"RTN","SAMIHOM4",1527,0)
 ;@calls
"RTN","SAMIHOM4",1528,0)
 ; @^%ZOSF("UPPERCASE")
"RTN","SAMIHOM4",1529,0)
 ;@input
"RTN","SAMIHOM4",1530,0)
 ; STR = string to convert to uppercase
"RTN","SAMIHOM4",1531,0)
 ;@output = uppercase string
"RTN","SAMIHOM4",1532,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1533,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1534,0)
 ;
"RTN","SAMIHOM4",1535,0)
 ;
"RTN","SAMIHOM4",1536,0)
UCASE(STR) ; uppercase string
"RTN","SAMIHOM4",1537,0)
 ;
"RTN","SAMIHOM4",1538,0)
 N X,Y
"RTN","SAMIHOM4",1539,0)
 S X=STR
"RTN","SAMIHOM4",1540,0)
 X ^%ZOSF("UPPERCASE")
"RTN","SAMIHOM4",1541,0)
 ;
"RTN","SAMIHOM4",1542,0)
 quit Y ; end of $$UCASE
"RTN","SAMIHOM4",1543,0)
 ;
"RTN","SAMIHOM4",1544,0)
 ;
"RTN","SAMIHOM4",1545,0)
 ;
"RTN","SAMIHOM4",1546,0)
 ;
"RTN","SAMIHOM4",1547,0)
 ;@wrs-code WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",1548,0)
 ;
"RTN","SAMIHOM4",1549,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1550,0)
 ;
"RTN","SAMIHOM4",1551,0)
 ;ven/gpl;wrs;procedure;clean?;silent?;sac?;tests?;port?
"RTN","SAMIHOM4",1552,0)
 ;@signature
"RTN","SAMIHOM4",1553,0)
 ; do WSNEWCAS^SAMIHOM3(SAMIARGS,SAMIBODY,SAMIRESULT)
"RTN","SAMIHOM4",1554,0)
 ;@branches-from
"RTN","SAMIHOM4",1555,0)
 ; wrs WSNEWCAS^SAMIHOM3 [wr newcase]
"RTN","SAMIHOM4",1556,0)
 ;@wrs-called-by
"RTN","SAMIHOM4",1557,0)
 ; ws WSVAPALS^SAMIHOM3 [ws post vapals]
"RTN","SAMIHOM4",1558,0)
 ;@called-by
"RTN","SAMIHOM4",1559,0)
 ; GETHOME [commented out]
"RTN","SAMIHOM4",1560,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",1561,0)
 ; ENROLL^SAMILD2
"RTN","SAMIHOM4",1562,0)
 ; ENROLL^SAMILOAD
"RTN","SAMIHOM4",1563,0)
 ; ENROLL^SAMIZPH1
"RTN","SAMIHOM4",1564,0)
 ;@calls
"RTN","SAMIHOM4",1565,0)
 ; parseBody^%wf
"RTN","SAMIHOM4",1566,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1567,0)
 ;  $$VALDTNM [commented out]
"RTN","SAMIHOM4",1568,0)
 ;  GETHOME [commented out]
"RTN","SAMIHOM4",1569,0)
 ;  $$NEXTNUM [commented out]
"RTN","SAMIHOM4",1570,0)
 ; $$GENSTDID^SAMIHOM3
"RTN","SAMIHOM4",1571,0)
 ; $$NOW^XLFDT
"RTN","SAMIHOM4",1572,0)
 ; $$KEYDATE^SAMIHOM3
"RTN","SAMIHOM4",1573,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMIHOM4",1574,0)
 ;  makeSbform [commented out]
"RTN","SAMIHOM4",1575,0)
 ; $$MKSIFORM^SAMIHOM3
"RTN","SAMIHOM4",1576,0)
 ; wsGetForm^%wf
"RTN","SAMIHOM4",1577,0)
 ;  WSCASE^SAMICASE [commented out]
"RTN","SAMIHOM4",1578,0)
 ;@input [tbd]
"RTN","SAMIHOM4",1579,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1580,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1581,0)
 ;@tests
"RTN","SAMIHOM4",1582,0)
 ; UTWSNC^SAMIUTH3
"RTN","SAMIHOM4",1583,0)
 ;
"RTN","SAMIHOM4",1584,0)
 ;
"RTN","SAMIHOM4",1585,0)
WSNEWCAS ; web route newcase (creates new case)
"RTN","SAMIHOM4",1586,0)
 ;
"RTN","SAMIHOM4",1587,0)
 ;@stanza 2 create new case
"RTN","SAMIHOM4",1588,0)
 ;
"RTN","SAMIHOM4",1589,0)
 merge ^SAMIUL("newCase","ARGS")=SAMIARGS
"RTN","SAMIHOM4",1590,0)
 merge ^SAMIUL("newCase","BODY")=SAMIBODY
"RTN","SAMIHOM4",1591,0)
 ;
"RTN","SAMIHOM4",1592,0)
 new vars,bdy
"RTN","SAMIHOM4",1593,0)
 set SAMIBDY=$get(SAMIBODY(1))
"RTN","SAMIHOM4",1594,0)
 if SAMIBDY="" M vars=SAMIARGS
"RTN","SAMIHOM4",1595,0)
 else  do parseBody^%wf("vars",.SAMIBDY)
"RTN","SAMIHOM4",1596,0)
 merge ^SAMIUL("newCase","vars")=vars
"RTN","SAMIHOM4",1597,0)
 ;
"RTN","SAMIHOM4",1598,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",1599,0)
 ;
"RTN","SAMIHOM4",1600,0)
 new saminame set saminame=$get(vars("name"))
"RTN","SAMIHOM4",1601,0)
 if saminame="" s saminame=$get(vars("saminame"))
"RTN","SAMIHOM4",1602,0)
 ;if $$VALDTNM(saminame,.ARGS)=-1 do  quit  ;
"RTN","SAMIHOM4",1603,0)
 ;. new r1
"RTN","SAMIHOM4",1604,0)
 ;. do GETHOME(.r1,.ARGS) ; home page to redisplay
"RTN","SAMIHOM4",1605,0)
 ;. merge RESULT=r1
"RTN","SAMIHOM4",1606,0)
 ;. quit
"RTN","SAMIHOM4",1607,0)
 ;
"RTN","SAMIHOM4",1608,0)
 new dfn s dfn=$get(vars("dfn"))
"RTN","SAMIHOM4",1609,0)
 ;if dfn="" do  quit  ;
"RTN","SAMIHOM4",1610,0)
 ;. new r1
"RTN","SAMIHOM4",1611,0)
 ;. do GETHOME(.r1,.ARGS) ; home page to redisplay
"RTN","SAMIHOM4",1612,0)
 ;. merge RESULT=r1
"RTN","SAMIHOM4",1613,0)
 ;. quit
"RTN","SAMIHOM4",1614,0)
 ;
"RTN","SAMIHOM4",1615,0)
 ; new gien set gien=$$NEXTNUM
"RTN","SAMIHOM4",1616,0)
 new gien set gien=dfn
"RTN","SAMIHOM4",1617,0)
 ;
"RTN","SAMIHOM4",1618,0)
 merge ^SAMIUL("newCase","G1")=root
"RTN","SAMIHOM4",1619,0)
 ; create dfn index
"RTN","SAMIHOM4",1620,0)
 set @root@("dfn",dfn,gien)=""
"RTN","SAMIHOM4",1621,0)
 ;
"RTN","SAMIHOM4",1622,0)
 set @root@(gien,"saminum")=gien
"RTN","SAMIHOM4",1623,0)
 set @root@(gien,"saminame")=saminame
"RTN","SAMIHOM4",1624,0)
 ;
"RTN","SAMIHOM4",1625,0)
 new studyid set studyid=$$GENSTDID^SAMIHOM3(gien,.SAMIARGS)
"RTN","SAMIHOM4",1626,0)
 set @root@(gien,"samistudyid")=studyid
"RTN","SAMIHOM4",1627,0)
 set @root@("sid",studyid,gien)=""
"RTN","SAMIHOM4",1628,0)
 ;
"RTN","SAMIHOM4",1629,0)
 new datekey set datekey=$$KEYDATE^SAMIHOM3($$NOW^XLFDT)
"RTN","SAMIHOM4",1630,0)
 set @root@(gien,"samicreatedate")=datekey
"RTN","SAMIHOM4",1631,0)
 ;
"RTN","SAMIHOM4",1632,0)
 merge ^SAMIUL("newCase",gien)=@root@(gien)
"RTN","SAMIHOM4",1633,0)
 ;
"RTN","SAMIHOM4",1634,0)
 ;
"RTN","SAMIHOM4",1635,0)
 do PREFILL^SAMIHOM3(dfn) ; prefills from the "patient-lookup" graph
"RTN","SAMIHOM4",1636,0)
 ;
"RTN","SAMIHOM4",1637,0)
 new siformkey
"RTN","SAMIHOM4",1638,0)
 ; do makeSbform(gien) ; create background form for new patient
"RTN","SAMIHOM4",1639,0)
 set siformkey=$$MKSIFORM^SAMIHOM3(gien) ; create intake for new patient
"RTN","SAMIHOM4",1640,0)
 ;
"RTN","SAMIHOM4",1641,0)
 set SAMIARGS("studyid")=studyid
"RTN","SAMIHOM4",1642,0)
 set SAMIARGS("form")="vapals:"_siformkey
"RTN","SAMIHOM4",1643,0)
 do wsGetForm^%wf(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",1644,0)
 ; do WSCASE^SAMICASE(.SAMIRESULT,.SAMIARGS) ; navigate to case review page
"RTN","SAMIHOM4",1645,0)
 ;
"RTN","SAMIHOM4",1646,0)
 ;
"RTN","SAMIHOM4",1647,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",1648,0)
 ;
"RTN","SAMIHOM4",1649,0)
 quit  ; end of wrs WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",1650,0)
 ;
"RTN","SAMIHOM4",1651,0)
 ;
"RTN","SAMIHOM4",1652,0)
 ;
"RTN","SAMIHOM4",1653,0)
EOR ; end of routine SAMIHOM4
"RTN","SAMIHUL")
0^15^B131888
"RTN","SAMIHUL",1,0)
SAMIHUL ;ven/gpl - home page log; 2024-08-21t21:13z
"RTN","SAMIHUL",2,0)
 ;;18.0;SAMI;**9,12,15,16,17**;2020-01-17;Build 8
"RTN","SAMIHUL",3,0)
 ;mdc-e1;SAMIHUL-20240822-E02WYeoc;SAMI-18-17-b6
"RTN","SAMIHUL",4,0)
 ;mdc-v7;B131888;SAMI*18.0*17 SEQ #17
"RTN","SAMIHUL",5,0)
 ;
"RTN","SAMIHUL",6,0)
 ; SAMIHOM3 contains subroutines for producing the ScreeningPlus Home
"RTN","SAMIHUL",7,0)
 ; Page. SAMIHOM4 contains more subroutines for the S+ Home Page.
"RTN","SAMIHUL",8,0)
 ; SAMIHUL contains the development log for the SAMIHOM* routines.
"RTN","SAMIHUL",9,0)
 ; It contains no executable code.
"RTN","SAMIHUL",10,0)
 ;
"RTN","SAMIHUL",11,0)
 quit  ; no entry from top
"RTN","SAMIHUL",12,0)
 ;
"RTN","SAMIHUL",13,0)
 ;
"RTN","SAMIHUL",14,0)
 ;
"RTN","SAMIHUL",15,0)
 ;
"RTN","SAMIHUL",16,0)
 ;@section 0 primary development
"RTN","SAMIHUL",17,0)
 ;
"RTN","SAMIHUL",18,0)
 ;
"RTN","SAMIHUL",19,0)
 ;
"RTN","SAMIHUL",20,0)
 ;
"RTN","SAMIHUL",21,0)
 ;@routine-credits
"RTN","SAMIHUL",22,0)
 ;
"RTN","SAMIHUL",23,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIHUL",24,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIHUL",25,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIHUL",26,0)
 ; http://vistaexpertise.net
"RTN","SAMIHUL",27,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIHUL",28,0)
 ;@license see routine SAMIUL
"RTN","SAMIHUL",29,0)
 ;
"RTN","SAMIHUL",30,0)
 ;@update 2024-08-21t21:13z
"RTN","SAMIHUL",31,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIHUL",32,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIHUL",33,0)
 ;@module Home Page - SAMIH
"RTN","SAMIHUL",34,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIHUL",35,0)
 ;@release 18-17
"RTN","SAMIHUL",36,0)
 ;@edition-date 2020-01-17
"RTN","SAMIHUL",37,0)
 ;@patches **9,12,15,16,17**
"RTN","SAMIHUL",38,0)
 ;
"RTN","SAMIHUL",39,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIHUL",40,0)
 ; toad@vistaexpertise.net
"RTN","SAMIHUL",41,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIHUL",42,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIHUL",43,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIHUL",44,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIHUL",45,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIHUL",46,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIHUL",47,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIHUL",48,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIHUL",49,0)
 ;@dev-add Domenick DiNatale (ddn)
"RTN","SAMIHUL",50,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMIHUL",51,0)
 ;
"RTN","SAMIHUL",52,0)
 ;@module-credits
"RTN","SAMIHUL",53,0)
 ;
"RTN","SAMIHUL",54,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIHUL",55,0)
 ; (VA-PALS)
"RTN","SAMIHUL",56,0)
 ; http://va-pals.org/
"RTN","SAMIHUL",57,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIHUL",58,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIHUL",59,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIHUL",60,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIHUL",61,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIHUL",62,0)
 ; http://ielcap.com/
"RTN","SAMIHUL",63,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIHUL",64,0)
 ; http://paraxialtech.com/
"RTN","SAMIHUL",65,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIHUL",66,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIHUL",67,0)
 ;
"RTN","SAMIHUL",68,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIHUL",69,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIHUL",70,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIHUL",71,0)
 ;@partner-org par
"RTN","SAMIHUL",72,0)
 ;
"RTN","SAMIHUL",73,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIHUL",74,0)
 ;
"RTN","SAMIHUL",75,0)
 ; 2018-01-13 ven/gpl 18-t4
"RTN","SAMIHUL",76,0)
 ;  SAMIHOM3 create routine from SAMIFRM to implement ELCAP Home Page.
"RTN","SAMIHUL",77,0)
 ;
"RTN","SAMIHUL",78,0)
 ; 2018-02-05 ven/toad 18-t4
"RTN","SAMIHUL",79,0)
 ;  SAMIHOM3 update license & attribution & hdr comments, add white
"RTN","SAMIHUL",80,0)
 ; space & do-dot quits, spell out language elements.
"RTN","SAMIHUL",81,0)
 ;
"RTN","SAMIHUL",82,0)
 ; 2018-02-27 ven/gpl 18-t4
"RTN","SAMIHUL",83,0)
 ;  SAMIHOM3 new subroutines PREFIX,GETHOME,SCANFOR,WSNEWCAS,PREFILL,
"RTN","SAMIHUL",84,0)
 ; MKSBFORM,MKSIFORM,VALDTNM,SID2NUM,KEYDATE,GENSTDID,NEXTNUM to
"RTN","SAMIHUL",85,0)
 ; support creation of new cases.
"RTN","SAMIHUL",86,0)
 ;
"RTN","SAMIHUL",87,0)
 ; 2018-03-01 ven/toad 18-t4
"RTN","SAMIHUL",88,0)
 ;  SAMIHOM3 refactor & reorganize new code, add hdr comments,
"RTN","SAMIHUL",89,0)
 ; r/findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMIHUL",90,0)
 ;
"RTN","SAMIHUL",91,0)
 ; 2018-03-06 ven/gpl 18-t4
"RTN","SAMIHUL",92,0)
 ;  SAMIHOM3 ?
"RTN","SAMIHUL",93,0)
 ;
"RTN","SAMIHUL",94,0)
 ; 2018-03-07 ven/toad 18-t4
"RTN","SAMIHUL",95,0)
 ;  SAMIHOM3 in $$SID2NUM add WSNUFORM^SAMICASE to called-by; in
"RTN","SAMIHUL",96,0)
 ; keyDate,GETHOME update called-by.
"RTN","SAMIHUL",97,0)
 ;
"RTN","SAMIHUL",98,0)
 ; 2018-05-18/25 ven/lgc&arc 18-t4 76020fd,81b1048,65afd99
"RTN","SAMIHUL",99,0)
 ;  SAMIHOM3 new SAMIHOM3 for new patient search page, chg submit
"RTN","SAMIHUL",100,0)
 ; processing on forms, fix bug in postform.
"RTN","SAMIHUL",101,0)
 ;
"RTN","SAMIHUL",102,0)
 ; 2018-06-14/07-10 ven/lgc&arc 18-t4 d71f4fe,8b0a432,ce345db,
"RTN","SAMIHUL",103,0)
 ; 402b6a8,14f991d,2e9662b
"RTN","SAMIHUL",104,0)
 ;  SAMIHOM3 make background form optional; 1st version of CT Eval
"RTN","SAMIHUL",105,0)
 ; Report; reorg ctreport routines & 1st crack at impressions &
"RTN","SAMIHUL",106,0)
 ; recommendations; note produced for intake form on submit; add
"RTN","SAMIHUL",107,0)
 ; support for routing by patient in CPRS Tools Menu, modify
"RTN","SAMIHUL",108,0)
 ; wsHOME^SAMIHOM3 to properly route VA-PALS web app when launced via
"RTN","SAMIHUL",109,0)
 ; CPRS Tools Menu; repair SAMIHOM3 & redact report link.
"RTN","SAMIHUL",110,0)
 ;
"RTN","SAMIHUL",111,0)
 ; 2018-08-22 ven/gpl 18-t4 6e696a9
"RTN","SAMIHUL",112,0)
 ;  SAMIHOM3 add PTINFO call to vista to pull ssn.
"RTN","SAMIHUL",113,0)
 ;
"RTN","SAMIHUL",114,0)
 ; 2018-09-30/11-01 ven/lgc&arc 18-t4 d93c640,482f522,a8e4226,
"RTN","SAMIHUL",115,0)
 ; ee5e8a1
"RTN","SAMIHUL",116,0)
 ;  SAMIHOM3 hdr & prefill of intake; new input form features, report
"RTN","SAMIHUL",117,0)
 ; menu fix; set urban/rural status at siform setup; handle zip code
"RTN","SAMIHUL",118,0)
 ; unknown.
"RTN","SAMIHUL",119,0)
 ;
"RTN","SAMIHUL",120,0)
 ; 2018-11-09/2019-01-22 ven/lgc&arc&lmry 18-t4 bac4f73,5400035,
"RTN","SAMIHUL",121,0)
 ; dd341e0,a953946,e2a44e6,2356c2b,3ceb74b,3088307,4271b46,7a5d340,
"RTN","SAMIHUL",122,0)
 ; dfbb0bc,fd1bcee,8dd6f34,51eb163,dbdb5a4,0880027,ccba017,5368121
"RTN","SAMIHUL",123,0)
 ;  SAMIHOM3 unit tests, annotation, sac compliance, XINDEX bugs, fix
"RTN","SAMIHUL",124,0)
 ; accidental reversions, add license info.
"RTN","SAMIHUL",125,0)
 ;
"RTN","SAMIHUL",126,0)
 ; 2018-12-18/20 ven/arc 18-t4 3088307f,4271b46b,dfbb0bca,
"RTN","SAMIHUL",127,0)
 ;  b8ff6da9,fd1bceee
"RTN","SAMIHUL",128,0)
 ;  SAMIHOM4 va sac compliance & variable namespacing.
"RTN","SAMIHUL",129,0)
 ;
"RTN","SAMIHUL",130,0)
 ; 2019-01-01/02-18 ven/lgc 18-t4 0880027c,18aa0fec,fcd635c1,
"RTN","SAMIHUL",131,0)
 ;  53681219,76874314
"RTN","SAMIHUL",132,0)
 ;  SAMIHOM3 update w/ recent changes.
"RTN","SAMIHUL",133,0)
 ;  SAMIHOM4 updates for va sac & code coverage, add license info.
"RTN","SAMIHUL",134,0)
 ;
"RTN","SAMIHUL",135,0)
 ; 2019-04-15 ven/gpl 18-t4 b403bf01
"RTN","SAMIHUL",136,0)
 ;  SAMIHOM4 support for new intake notes.
"RTN","SAMIHUL",137,0)
 ;
"RTN","SAMIHUL",138,0)
 ; 2019-04-16 ven/lgc 18-t4 e54b76d1
"RTN","SAMIHUL",139,0)
 ;  SAMIHOM4 update for SAMIFORM project.
"RTN","SAMIHUL",140,0)
 ;
"RTN","SAMIHUL",141,0)
 ; 2019-04-17 ven/gpl 18-t4 7d1f86db
"RTN","SAMIHUL",142,0)
 ;  SAMIHOM3 prefill date on intake prelim discussion section.
"RTN","SAMIHUL",143,0)
 ;
"RTN","SAMIHUL",144,0)
 ; 2019-06-18 ven/arc 18-t4 91022482
"RTN","SAMIHUL",145,0)
 ;  SAMIHOM4 switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMIHUL",146,0)
 ;
"RTN","SAMIHUL",147,0)
 ; 2019-08-05 ven/gpl 18-t4 9c0c2ed3
"RTN","SAMIHUL",148,0)
 ;  SAMIHOM3 add GETPRFX to get right prefix at registration.
"RTN","SAMIHUL",149,0)
 ;
"RTN","SAMIHUL",150,0)
 ; 2019-08-07 ven/lgc&arc 18-t4 603194b9,37967fc5
"RTN","SAMIHUL",151,0)
 ;  SAMIHOM3 consolidate calls to retrieve facility prefix.
"RTN","SAMIHUL",152,0)
 ;
"RTN","SAMIHUL",153,0)
 ; 2019-11-22 par/ddn 18-t4 b2cc389d vap-458
"RTN","SAMIHUL",154,0)
 ;  SAMIHOM4 manual registration.
"RTN","SAMIHUL",155,0)
 ;
"RTN","SAMIHUL",156,0)
 ; 2020-01-01/05 ven/lgc 18-t4 c169f4b1,5928064a,62e3200f
"RTN","SAMIHUL",157,0)
 ;  SAMIHOM4 support for unmatched patient processing, more changes
"RTN","SAMIHUL",158,0)
 ; for participant matching, unmatched participant processing ready
"RTN","SAMIHUL",159,0)
 ; for testing.
"RTN","SAMIHUL",160,0)
 ;
"RTN","SAMIHUL",161,0)
 ; 2020-01-08/10 ven/gpl 18 a002f850,47dfe3cd
"RTN","SAMIHUL",162,0)
 ;  SAMIHOM4 bug fix for unmatched processing, turn off & on manual
"RTN","SAMIHUL",163,0)
 ; registration link on home page.
"RTN","SAMIHUL",164,0)
 ;
"RTN","SAMIHUL",165,0)
 ; 2020-01-10 ven/gpl 18 4c8e6ebc,76b465cb
"RTN","SAMIHUL",166,0)
 ;  SAMIHOM4 3 quits with returns for cache.
"RTN","SAMIHUL",167,0)
 ;
"RTN","SAMIHUL",168,0)
 ; 2020-01-16 ven/lgc 18 0a2af965
"RTN","SAMIHUL",169,0)
 ;  SAMIHOM4 bulk commit due to switch to cache.
"RTN","SAMIHUL",170,0)
 ;
"RTN","SAMIHUL",171,0)
 ; 2020-01-17/20 ven/lgc 18-1 8557207f,dc5f618c
"RTN","SAMIHUL",172,0)
 ;  SAMIHOM4 followup note, limit to one note per followup form.
"RTN","SAMIHUL",173,0)
 ;
"RTN","SAMIHUL",174,0)
 ; 2020-02-01/02 ven/lgc 18-4 3065146d,36ae0ed1
"RTN","SAMIHUL",175,0)
 ;  SAMIHOM4 set options for text based ctreport, switch default
"RTN","SAMIHUL",176,0)
 ; ctreport to text.
"RTN","SAMIHUL",177,0)
 ;
"RTN","SAMIHUL",178,0)
 ; 2020-04-02/11 ven/gpl 18-5 d36b7cad,36607664,befde317,56bfaed6,
"RTN","SAMIHUL",179,0)
 ; 666f5b91,2f2c29c1
"RTN","SAMIHUL",180,0)
 ;  SAMIHOM3 multitenancy; in GENSTDID add ARG param, determin prefix
"RTN","SAMIHUL",181,0)
 ; from site or siteid (ARG) instead of calling $$GETPRFX^SAMIFORM.
"RTN","SAMIHUL",182,0)
 ;  SAMIHOM4 multitenancy + fix bug in WSVAPALS.
"RTN","SAMIHUL",183,0)
 ;
"RTN","SAMIHUL",184,0)
 ; 2020-04-18/05-07 ven/gpl 18-5 29d7dba7,d55de214,521e0bdc,d018f52e,
"RTN","SAMIHUL",185,0)
 ; 476b2ff4,61c7d208
"RTN","SAMIHUL",186,0)
 ;  SAMIHOM4 fix bug & weird error in manual registration, fix bug in
"RTN","SAMIHUL",187,0)
 ; logout, logout working, superuser site selection, worklist
"RTN","SAMIHUL",188,0)
 ; functionality.
"RTN","SAMIHUL",189,0)
 ;
"RTN","SAMIHUL",190,0)
 ; 2020-08-06 ven/gpl 18-6 781744c3
"RTN","SAMIHUL",191,0)
 ;  SAMIHOM4 changes to support hl7 transmission of notes.
"RTN","SAMIHUL",192,0)
 ;
"RTN","SAMIHUL",193,0)
 ; 2020-09-22 ven/gpl 18-9 06459eda
"RTN","SAMIHUL",194,0)
 ;  SAMIHOM4 correct to match kids file.
"RTN","SAMIHUL",195,0)
 ;
"RTN","SAMIHUL",196,0)
 ; 2021-03-02 ven/gpl 18-9 479dc041
"RTN","SAMIHUL",197,0)
 ;  SAMIHOM4 return error message if no ct eval form exists when
"RTN","SAMIHUL",198,0)
 ; generating a fu note.
"RTN","SAMIHUL",199,0)
 ;
"RTN","SAMIHUL",200,0)
 ; 2021-03-11 ven/toad 18-9 a46a2cc1
"RTN","SAMIHUL",201,0)
 ;  SAMIHUL create routine.
"RTN","SAMIHUL",202,0)
 ;  SAMIHOM4 bump date & patch list, add contents, lt refactor.
"RTN","SAMIHUL",203,0)
 ;
"RTN","SAMIHUL",204,0)
 ; 2021-03-17 ven/toad 18-9
"RTN","SAMIHUL",205,0)
 ;  SAMIHOM4 remove blank from end of 1 line.
"RTN","SAMIHUL",206,0)
 ;
"RTN","SAMIHUL",207,0)
 ; 2021-05-29 ven/gpl 18-12-t2 59ea0811
"RTN","SAMIHUL",208,0)
 ;  SAMIHOM3 in SID2NUM look up by pien instead of relying on sid
"RTN","SAMIHUL",209,0)
 ; containing pien.
"RTN","SAMIHUL",210,0)
 ;
"RTN","SAMIHUL",211,0)
 ; 2021-06-15 ven/gpl 18-12-t2 e247ea59
"RTN","SAMIHUL",212,0)
 ;  SAMIHOM4 eliminate icn.
"RTN","SAMIHUL",213,0)
 ;
"RTN","SAMIHUL",214,0)
 ; 2021-06-15/16 ven/mcglk&toad 18-12-t2 cbf7e46b,fa794d60
"RTN","SAMIHUL",215,0)
 ;  SAMIHOM3 move log to SAMIHUL, bump dates & versions, annotate,
"RTN","SAMIHUL",216,0)
 ; reorg, lt refactor.
"RTN","SAMIHUL",217,0)
 ;  SAMIHOM4 bump dates & versions; begin annotate, reorg, lt refactor
"RTN","SAMIHUL",218,0)
 ; but interrupted by addition of critical fix to patch & bronchitis,
"RTN","SAMIHUL",219,0)
 ; so leave refactor unfinished (but stable as far as it went).
"RTN","SAMIHUL",220,0)
 ;  SAMIUTH3 bump dates & versions, lt refactor, add COVER, in UTSCAN4
"RTN","SAMIHUL",221,0)
 ; fix $random bug, but after discovering the SAMI test suite is so
"RTN","SAMIHUL",222,0)
 ; far out of date that it fails catastrophically with thousands of
"RTN","SAMIHUL",223,0)
 ; errors, back out changes and leave as it was.
"RTN","SAMIHUL",224,0)
 ;
"RTN","SAMIHUL",225,0)
 ; 2021-08-01 ven/gpl 18-12 5bd7c627
"RTN","SAMIHUL",226,0)
 ;  SAMIHOM3 set intake form to incomplete on creation: in MKSIFORM
"RTN","SAMIHUL",227,0)
 ; r/complete w/incomplete.
"RTN","SAMIHUL",228,0)
 ;
"RTN","SAMIHUL",229,0)
 ; 2021-09-20/23 ven/gpl 18-16 db1b173a,465b009d
"RTN","SAMIHUL",230,0)
 ;  SAMIHOM4 (with new routine SAMIZPH1) developed to import data from 
"RTN","SAMIHUL",231,0)
 ;  Philadelphia VA's previous LCS database in Red Cap, bump dates & versions.
"RTN","SAMIHUL",232,0)
 ;
"RTN","SAMIHUL",233,0)
 ; 2021-9-24 ven/lmry 18-16 465b009d
"RTN","SAMIHUL",234,0)
 ;  SAMIHOM4 bumped versions and dates
"RTN","SAMIHUL",235,0)
 ;
"RTN","SAMIHUL",236,0)
 ; 2021-10-19 ven/gpl 18-15 138d45e5
"RTN","SAMIHUL",237,0)
 ;  SAMIHOM4 parameterize veteran vs participant or candidate for notes
"RTN","SAMIHUL",238,0)
 ;
"RTN","SAMIHUL",239,0)
 ; 2021-10-29 ven/lmry 18-15  4267917c
"RTN","SAMIHUL",240,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",241,0)
 ;
"RTN","SAMIHUL",242,0)
 ; 2021-11-01 ven/gpl 18-15  e4722e8f0
"RTN","SAMIHUL",243,0)
 ;  SAMIHOM4 prevent using SYS as a site
"RTN","SAMIHUL",244,0)
 ;
"RTN","SAMIHUL",245,0)
 ; 2021-11-09 ven/gpl 18-15 34367ef0
"RTN","SAMIHUL",246,0)
 ;  SAMIHOM4 change GETHOME to cut off GET requests
"RTN","SAMIHUL",247,0)
 ;
"RTN","SAMIHUL",248,0)
 ; 2021-11-10 ven/gpl 18-15 ed2a3480
"RTN","SAMIHUL",249,0)
 ;  SAMIHOM4 support for samiroute=about points to vapals:about
"RTN","SAMIHUL",250,0)
 ;
"RTN","SAMIHUL",251,0)
 ; 2021-11-18 ven/lmry 18-15 596ea463
"RTN","SAMIHUL",252,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",253,0)
 ;
"RTN","SAMIHUL",254,0)
 ; 2021-11-22 ven/gpl 18-16  d26d00a7
"RTN","SAMIHUL",255,0)
 ;  SAMIHOM4 patch 16 DCM functionality
"RTN","SAMIHUL",256,0)
 ;
"RTN","SAMIHUL",257,0)
 ; 2022-01-02 ven/gpl 18-16 45fa4633
"RTN","SAMIHUL",258,0)
 ;  SAMIHOM4 Nashville sample data processing
"RTN","SAMIHUL",259,0)
 ;
"RTN","SAMIHUL",260,0)
 ; 2022-01-12 ven/gpl 18-15  ea379b6b
"RTN","SAMIHUL",261,0)
 ;  SAMIHOM4 change calls to SAMIORU to use a parameterized site
"RTN","SAMIHUL",262,0)
 ;
"RTN","SAMIHUL",263,0)
 ; 2022-01-12 ven/lmry 18-15  bcef2106
"RTN","SAMIHUL",264,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",265,0)
 ;
"RTN","SAMIHUL",266,0)
 ; 2022-01-17 ven/lmry 18-16  e69ca23e
"RTN","SAMIHUL",267,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",268,0)
 ;
"RTN","SAMIHUL",269,0)
 ; 2022-04-04 ven/gpl 18-17   ec245b1e
"RTN","SAMIHUL",270,0)
 ;  SAMIHOM4 change logout to accomodate single signon
"RTN","SAMIHUL",271,0)
 ;
"RTN","SAMIHUL",272,0)
 ; 2022-04-04 ven/lmry 18-17  258bc926
"RTN","SAMIHUL",273,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",274,0)
 ;
"RTN","SAMIHUL",275,0)
 ; 2022-04-26 ven/gpl  18-17  89497ba8
"RTN","SAMIHUL",276,0)
 ;  SAMIHOM4 setup for logout redirect
"RTN","SAMIHUL",277,0)
 ;
"RTN","SAMIHUL",278,0)
 ; 2022-04-27 ven/lmry 18-17
"RTN","SAMIHUL",279,0)
 ;  SAMIHOM4 and SAMIHUL bumped dates, inserted space for XINDEX
"RTN","SAMIHUL",280,0)
 ;
"RTN","SAMIHUL",281,0)
 ; 2024-07-24 ven/gpl 18-17-b5 8d86b80
"RTN","SAMIHUL",282,0)
 ;  SAMIHOM4 copy simrn to the vapals-patient record after entry
"RTN","SAMIHUL",283,0)
 ;
"RTN","SAMIHUL",284,0)
 ; 2024-08-12 ven/lmry 18-17-b5
"RTN","SAMIHUL",285,0)
 ;  SAMIHOM4 bump version and date
"RTN","SAMIHUL",286,0)
 ;  SAMIHUL add history, bump version and date
"RTN","SAMIHUL",287,0)
 ;
"RTN","SAMIHUL",288,0)
 ; 2024-08-17 ven/lmry 18-17-b6
"RTN","SAMIHUL",289,0)
 ;  SAMIHOM4 regress version and bump date
"RTN","SAMIHUL",290,0)
 ;  SAMIHUL add history, regress version and bump date
"RTN","SAMIHUL",291,0)
 ;
"RTN","SAMIHUL",292,0)
 ; 2024-08-22 ven/toad 18-17-b6
"RTN","SAMIHUL",293,0)
 ;  SAMIHOM4,SAMIHUL update version-control lines, dates.
"RTN","SAMIHUL",294,0)
 ;  SAMIHUL update history.
"RTN","SAMIHUL",295,0)
 ;  SAMIHOM4 annotate, comment out debugging lines.
"RTN","SAMIHUL",296,0)
 ;
"RTN","SAMIHUL",297,0)
 ;
"RTN","SAMIHUL",298,0)
 ;@contents
"RTN","SAMIHUL",299,0)
 ;
"RTN","SAMIHUL",300,0)
 ; SAMIHOM3 homepage interface library
"RTN","SAMIHUL",301,0)
 ; SAMIHOM4 homepage subroutines
"RTN","SAMIHUL",302,0)
 ; SAMIHUL homepage development log
"RTN","SAMIHUL",303,0)
 ; SAMIUTH3 tests for SAMIHOM3
"RTN","SAMIHUL",304,0)
 ; SAMIUTH4 tests for SAMIHOM4
"RTN","SAMIHUL",305,0)
 ;
"RTN","SAMIHUL",306,0)
 ;
"RTN","SAMIHUL",307,0)
 ;
"RTN","SAMIHUL",308,0)
EOR ; end of routine SAMIHUL
"RTN","SAMIPAT")
0^3^B17344032
"RTN","SAMIPAT",1,0)
SAMIPAT ;ven/toad - post subroutines; 2024-08-30t03:30z
"RTN","SAMIPAT",2,0)
 ;;18.0;SAMI;**12,14,15,17**;2020-01-17;Build 8
"RTN","SAMIPAT",3,0)
 ;mdc-e1;SAMIPAT-20240822-E06GsDm;SAMI-18-17-b6
"RTN","SAMIPAT",4,0)
 ;mdc-v7;B16870509;SAMI*18.0*17 SEQ #17
"RTN","SAMIPAT",5,0)
 ;
"RTN","SAMIPAT",6,0)
 ; Routine SAMIPAT contains ScreeningPlus initialization subroutines
"RTN","SAMIPAT",7,0)
 ; to use as KIDS pre- & post-installs & environment checks.
"RTN","SAMIPAT",8,0)
 ;
"RTN","SAMIPAT",9,0)
 quit  ; no entry from top
"RTN","SAMIPAT",10,0)
 ;
"RTN","SAMIPAT",11,0)
 ;
"RTN","SAMIPAT",12,0)
 ;
"RTN","SAMIPAT",13,0)
 ;
"RTN","SAMIPAT",14,0)
 ;@section 0 primary development
"RTN","SAMIPAT",15,0)
 ;
"RTN","SAMIPAT",16,0)
 ;
"RTN","SAMIPAT",17,0)
 ;
"RTN","SAMIPAT",18,0)
 ;
"RTN","SAMIPAT",19,0)
 ;@routine-credits
"RTN","SAMIPAT",20,0)
 ;
"RTN","SAMIPAT",21,0)
 ;@dev Frederick D. S. Marshall (toad)
"RTN","SAMIPAT",22,0)
 ; toad@vistaexpertise.net
"RTN","SAMIPAT",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIPAT",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIPAT",25,0)
 ;@copyright 2024, toad, all rights reserved
"RTN","SAMIPAT",26,0)
 ;@license see routine SAMIUL
"RTN","SAMIPAT",27,0)
 ;
"RTN","SAMIPAT",28,0)
 ;@update 2024-08-30t03:30z
"RTN","SAMIPAT",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIPAT",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIPAT",31,0)
 ;@module Inits (patching) - SAMIPA
"RTN","SAMIPAT",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIPAT",33,0)
 ;@release 18-17
"RTN","SAMIPAT",34,0)
 ;@edition-date 2020-01-17
"RTN","SAMIPAT",35,0)
 ;@patches **12,14,15,17**
"RTN","SAMIPAT",36,0)
 ;
"RTN","SAMIPAT",37,0)
 ;@dev-add George P. Lilly (gpl)
"RTN","SAMIPAT",38,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIPAT",39,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIPAT",40,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIPAT",41,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIPAT",42,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIPAT",43,0)
 ;
"RTN","SAMIPAT",44,0)
 ;@module-credits
"RTN","SAMIPAT",45,0)
 ;
"RTN","SAMIPAT",46,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIPAT",47,0)
 ; (VA-PALS)
"RTN","SAMIPAT",48,0)
 ; http://va-pals.org/
"RTN","SAMIPAT",49,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIPAT",50,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIPAT",51,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIPAT",52,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIPAT",53,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIPAT",54,0)
 ; http://ielcap.com/
"RTN","SAMIPAT",55,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIPAT",56,0)
 ; http://paraxialtech.com/
"RTN","SAMIPAT",57,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIPAT",58,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIPAT",59,0)
 ;
"RTN","SAMIPAT",60,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIPAT",61,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIPAT",62,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIPAT",63,0)
 ;@partner-org par
"RTN","SAMIPAT",64,0)
 ;
"RTN","SAMIPAT",65,0)
 ;
"RTN","SAMIPAT",66,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIPAT",67,0)
 ;
"RTN","SAMIPAT",68,0)
 ; 2021-07-01 ven/mcglk&toad 18-12-t2 cbf7e46b
"RTN","SAMIPAT",69,0)
 ;  SAMIPAT new routine, new POS1812.
"RTN","SAMIPAT",70,0)
 ;
"RTN","SAMIPAT",71,0)
 ; 2021-07-22/23 ven/toad 18-12 
"RTN","SAMIPAT",72,0)
 ;  SAMIPAT add PRE1812 pre-install.
"RTN","SAMIPAT",73,0)
 ;
"RTN","SAMIPAT",74,0)
 ; 2021-08-11 ven/mcglk&toad 18-12  b16cd38f
"RTN","SAMIPAT",75,0)
 ;  SAMIPAT rip out PRE1812.
"RTN","SAMIPAT",76,0)
 ;
"RTN","SAMIPAT",77,0)
 ; 2021-09-08 ven/lmry 18-14 2af1f2e7
"RTN","SAMIPAT",78,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",79,0)
 ;
"RTN","SAMIPAT",80,0)
 ; 2021-10-28 ven/lmry 18-15 0b585061
"RTN","SAMIPAT",81,0)
 ;  SAMIPAT create STANDARD sub w/post-install commands used for
"RTN","SAMIPAT",82,0)
 ; almost all patches; chg POS1814 to use STANDARD, add POS1815.
"RTN","SAMIPAT",83,0)
 ;
"RTN","SAMIPAT",84,0)
 ; 2021-10-29 ven/lmry 18-15 6e9594e8
"RTN","SAMIPAT",85,0)
 ;  SAMIPAT remove space before STANDARD.
"RTN","SAMIPAT",86,0)
 ;
"RTN","SAMIPAT",87,0)
 ; 2021-11-14 ven/lmry 18-15-t2 3a30fe59
"RTN","SAMIPAT",88,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",89,0)
 ;
"RTN","SAMIPAT",90,0)
 ; 2021-11-18 ven/lmry 18-15 4d71eef7
"RTN","SAMIPAT",91,0)
 ;  SAMIPAT fix for XINDEX.
"RTN","SAMIPAT",92,0)
 ;
"RTN","SAMIPAT",93,0)
 ; 2021-12-07 ven/lmry 18-15 75a19c5c
"RTN","SAMIPAT",94,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",95,0)
 ;
"RTN","SAMIPAT",96,0)
 ; 2022-04-04 ven/lmry 18-17-t1 258bc926
"RTN","SAMIPAT",97,0)
 ;  SAMIPAT add POS1817.
"RTN","SAMIPAT",98,0)
 ;
"RTN","SAMIPAT",99,0)
 ; 2022-04-27 ven/lmry 18-17-t2 03b87fe
"RTN","SAMIPAT",100,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",101,0)
 ;
"RTN","SAMIPAT",102,0)
 ; 2022-12-13 ven/lmry 18-17-t3 1ebd6e6
"RTN","SAMIPAT",103,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",104,0)
 ;
"RTN","SAMIPAT",105,0)
 ; 2022-12-28 ven/lmry 18-17-t4 956e2716
"RTN","SAMIPAT",106,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",107,0)
 ;
"RTN","SAMIPAT",108,0)
 ; 2024-08-12 ven/lmry 18-17-b5 eea98cd
"RTN","SAMIPAT",109,0)
 ;  SAMIPAT add POS1818.
"RTN","SAMIPAT",110,0)
 ;
"RTN","SAMIPAT",111,0)
 ; 2024-08-16 ven/lmry 18-17-b6  a1a28de  d0224d9
"RTN","SAMIPAT",112,0)
 ;  SAMIPAT update POS1817.
"RTN","SAMIPAT",113,0)
 ;
"RTN","SAMIPAT",114,0)
 ; 2024-08-22 ven/toad 18-17-b6
"RTN","SAMIPAT",115,0)
 ;  SAMIPAT update history, version-control lines, hdr comments.
"RTN","SAMIPAT",116,0)
 ;
"RTN","SAMIPAT",117,0)
 ; 2024-08-30 ven/lmry 18-17-b6
"RTN","SAMIPAT",118,0)
 ;  SAMIPAT updated path for SAMIDIR under STANDARD, change update date,
"RTN","SAMIPAT",119,0)
 ;   also changed routine description to post routines instead of init
"RTN","SAMIPAT",120,0)
 ;   routines.
"RTN","SAMIPAT",121,0)
 ;  
"RTN","SAMIPAT",122,0)
 ;
"RTN","SAMIPAT",123,0)
 ;@contents
"RTN","SAMIPAT",124,0)
 ;
"RTN","SAMIPAT",125,0)
 ; STANDARD usual post-install commands
"RTN","SAMIPAT",126,0)
 ; POS1812 kids post-install for SAMI-18-12
"RTN","SAMIPAT",127,0)
 ; POS1814 kids post-install for SAMI-18-14
"RTN","SAMIPAT",128,0)
 ; POS1815 kids post-install for SAMI-18-15
"RTN","SAMIPAT",129,0)
 ; POS1817 kids post-install for SAMI-18-17
"RTN","SAMIPAT",130,0)
 ; POS1818 kids post-install for SAMI-18-18
"RTN","SAMIPAT",131,0)
 ;
"RTN","SAMIPAT",132,0)
 ;
"RTN","SAMIPAT",133,0)
 ;
"RTN","SAMIPAT",134,0)
 ;
"RTN","SAMIPAT",135,0)
 ;@section 1 subroutine for most patches
"RTN","SAMIPAT",136,0)
 ;
"RTN","SAMIPAT",137,0)
 ;
"RTN","SAMIPAT",138,0)
 ;
"RTN","SAMIPAT",139,0)
 ;
"RTN","SAMIPAT",140,0)
STANDARD ; usual post-install commands
"RTN","SAMIPAT",141,0)
 ;
"RTN","SAMIPAT",142,0)
 set SAMIDIR="/home/osehra/lib/silver/a-sami-vapals-elcap--vv-paraxtech-github/docs/form-fields/"
"RTN","SAMIPAT",143,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"background.tsv","form fields - background")
"RTN","SAMIPAT",144,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"biopsy.tsv","form fields - biopsy")
"RTN","SAMIPAT",145,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"ct-evaluation.tsv","form fields - ct evaluation")
"RTN","SAMIPAT",146,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"follow-up.tsv","form fields - follow up")
"RTN","SAMIPAT",147,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"intake.tsv","form fields - intake")
"RTN","SAMIPAT",148,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"intervention.tsv","form fields - intervention")
"RTN","SAMIPAT",149,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"pet-evaluation.tsv","form fields - pet evaluation")
"RTN","SAMIPAT",150,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"register.tsv","form fields - register")
"RTN","SAMIPAT",151,0)
 do DODD^SAMIADMN(SAMIDIR) ; to import tsv files to generate DD graphs
"RTN","SAMIPAT",152,0)
 do CLRWEB^SAMIADMN ; Clear the M Web Server files cache
"RTN","SAMIPAT",153,0)
 do INIT2GPH^SAMICTD2 ; initialize CTEVAL dictionary into graph cteval-dict
"RTN","SAMIPAT",154,0)
 ;
"RTN","SAMIPAT",155,0)
 ;
"RTN","SAMIPAT",156,0)
 ;
"RTN","SAMIPAT",157,0)
 ;
"RTN","SAMIPAT",158,0)
 ;@section 2 subroutines for SAMI-18-12
"RTN","SAMIPAT",159,0)
 ;
"RTN","SAMIPAT",160,0)
 ;
"RTN","SAMIPAT",161,0)
 ;
"RTN","SAMIPAT",162,0)
 ;
"RTN","SAMIPAT",163,0)
 ;@kids-post POST1812^SAMIPAT
"RTN","SAMIPAT",164,0)
 ;
"RTN","SAMIPAT",165,0)
POS1812 ; kids post-install for SAMI-18-12
"RTN","SAMIPAT",166,0)
 ;
"RTN","SAMIPAT",167,0)
 do ADDSVC^SAMIPARM ; install get params web service
"RTN","SAMIPAT",168,0)
 ;
"RTN","SAMIPAT",169,0)
 ; in honor of Tchaikovsky's overture: boom
"RTN","SAMIPAT",170,0)
 ;
"RTN","SAMIPAT",171,0)
 quit  ; end of kids-post POS1812^SAMIPAT
"RTN","SAMIPAT",172,0)
 ;
"RTN","SAMIPAT",173,0)
 ;
"RTN","SAMIPAT",174,0)
 ;
"RTN","SAMIPAT",175,0)
 ;
"RTN","SAMIPAT",176,0)
 ;@section 3 subroutines for SAMI-18-14
"RTN","SAMIPAT",177,0)
 ;
"RTN","SAMIPAT",178,0)
 ;
"RTN","SAMIPAT",179,0)
 ;
"RTN","SAMIPAT",180,0)
 ;
"RTN","SAMIPAT",181,0)
 ;@kids-post POST1814^SAMIPAT
"RTN","SAMIPAT",182,0)
 ;
"RTN","SAMIPAT",183,0)
POS1814 ; kids post-install for SAMI-18-14
"RTN","SAMIPAT",184,0)
 ;
"RTN","SAMIPAT",185,0)
 do STANDARD
"RTN","SAMIPAT",186,0)
 ;
"RTN","SAMIPAT",187,0)
 quit  ; end of kids-post POS1814^SAMIPAT
"RTN","SAMIPAT",188,0)
 ;
"RTN","SAMIPAT",189,0)
 ;
"RTN","SAMIPAT",190,0)
 ;
"RTN","SAMIPAT",191,0)
 ;
"RTN","SAMIPAT",192,0)
 ;@section 4 subroutines for SAMI-18-15
"RTN","SAMIPAT",193,0)
 ;
"RTN","SAMIPAT",194,0)
 ;
"RTN","SAMIPAT",195,0)
 ;
"RTN","SAMIPAT",196,0)
 ;
"RTN","SAMIPAT",197,0)
 ;@kids-post POST1815^SAMIPAT
"RTN","SAMIPAT",198,0)
 ;
"RTN","SAMIPAT",199,0)
POS1815 ; kids post-install for SAMI-18-15
"RTN","SAMIPAT",200,0)
 ;
"RTN","SAMIPAT",201,0)
 do STANDARD
"RTN","SAMIPAT",202,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-15")
"RTN","SAMIPAT",203,0)
 do deleteService^%webutils("GET","vapals")
"RTN","SAMIPAT",204,0)
 do addService^%webutils("GET","vapals","GETHOME^SAMIHOM3")
"RTN","SAMIPAT",205,0)
 do SETMAP^SAMIPARM("vapals:about","about.html")
"RTN","SAMIPAT",206,0)
 ;
"RTN","SAMIPAT",207,0)
 quit  ; end of kids-post POS1815^SAMIPAT
"RTN","SAMIPAT",208,0)
 ;
"RTN","SAMIPAT",209,0)
 ;
"RTN","SAMIPAT",210,0)
 ;
"RTN","SAMIPAT",211,0)
 ;
"RTN","SAMIPAT",212,0)
 ;@section 5 subroutines for SAMI-18-17
"RTN","SAMIPAT",213,0)
 ;
"RTN","SAMIPAT",214,0)
 ;
"RTN","SAMIPAT",215,0)
 ;
"RTN","SAMIPAT",216,0)
 ;
"RTN","SAMIPAT",217,0)
 ;@kids-post POST1817^SAMIPAT
"RTN","SAMIPAT",218,0)
 ;
"RTN","SAMIPAT",219,0)
POS1817 ; kids post-install for SAMI-18-17
"RTN","SAMIPAT",220,0)
 ;
"RTN","SAMIPAT",221,0)
 do STANDARD
"RTN","SAMIPAT",222,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-17-b6")
"RTN","SAMIPAT",223,0)
 ;
"RTN","SAMIPAT",224,0)
 quit  ; end of kids-post POS1817^SAMIPAT
"RTN","SAMIPAT",225,0)
 ;
"RTN","SAMIPAT",226,0)
 ;
"RTN","SAMIPAT",227,0)
 ;
"RTN","SAMIPAT",228,0)
 ;
"RTN","SAMIPAT",229,0)
 ;@section 6 subroutines for SAMI-18-18
"RTN","SAMIPAT",230,0)
 ;
"RTN","SAMIPAT",231,0)
 ;
"RTN","SAMIPAT",232,0)
 ;
"RTN","SAMIPAT",233,0)
 ;
"RTN","SAMIPAT",234,0)
 ;@kids-post POST1818^SAMIPAT
"RTN","SAMIPAT",235,0)
 ;
"RTN","SAMIPAT",236,0)
POS1818 ; kids post-install for SAMI-18-18
"RTN","SAMIPAT",237,0)
 ;
"RTN","SAMIPAT",238,0)
 do STANDARD
"RTN","SAMIPAT",239,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-18-b1")
"RTN","SAMIPAT",240,0)
 ;
"RTN","SAMIPAT",241,0)
 quit  ; end of kids-post POS1818^SAMIPAT
"RTN","SAMIPAT",242,0)
 ;
"RTN","SAMIPAT",243,0)
 ;
"RTN","SAMIPAT",244,0)
 ;
"RTN","SAMIPAT",245,0)
 ;
"RTN","SAMIPAT",246,0)
 ;@section X subroutines for future versions...
"RTN","SAMIPAT",247,0)
 ;
"RTN","SAMIPAT",248,0)
 ;
"RTN","SAMIPAT",249,0)
 ;
"RTN","SAMIPAT",250,0)
EOR ; end of routine SAMIPAT
"RTN","SAMISITE")
0^16^B212460993
"RTN","SAMISITE",1,0)
SAMISITE ;ven/gpl - site signon & security; 2024-08-22t21:17z
"RTN","SAMISITE",2,0)
 ;;18.0;SAMI;**5,12,14,17**;2020-01-17;Build 8
"RTN","SAMISITE",3,0)
 ;mdc-e1;SAMISITE-20240822-E0ePfmU;SAMI-18-17-b6
"RTN","SAMISITE",4,0)
 ;mdc-v7;B212460993;SAMI*18.0*17 SEQ #17
"RTN","SAMISITE",5,0)
 ;
"RTN","SAMISITE",6,0)
 ; Routine SAMISITE contains subroutines for implementing the
"RTN","SAMISITE",7,0)
 ; ScreeningPlus site signon and security.
"RTN","SAMISITE",8,0)
 ;
"RTN","SAMISITE",9,0)
 quit  ; no entry from top
"RTN","SAMISITE",10,0)
 ;
"RTN","SAMISITE",11,0)
 ;
"RTN","SAMISITE",12,0)
 ;
"RTN","SAMISITE",13,0)
 ;
"RTN","SAMISITE",14,0)
 ;@section 0 primary development
"RTN","SAMISITE",15,0)
 ;
"RTN","SAMISITE",16,0)
 ;
"RTN","SAMISITE",17,0)
 ;
"RTN","SAMISITE",18,0)
 ;
"RTN","SAMISITE",19,0)
 ;@routine-credits
"RTN","SAMISITE",20,0)
 ;
"RTN","SAMISITE",21,0)
 ;@dev: George P. Lilly (gpl)
"RTN","SAMISITE",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMISITE",23,0)
 ;@dev-org: Vista Expertise Network (ven)
"RTN","SAMISITE",24,0)
 ; http://vistaexpertise.net
"RTN","SAMISITE",25,0)
 ;@copyright: 2017/2024, gpl, all rights reserved
"RTN","SAMISITE",26,0)
 ;@license see routine SAMIUL
"RTN","SAMISITE",27,0)
 ;
"RTN","SAMISITE",28,0)
 ;@update 2024-08-22t21:17z
"RTN","SAMISITE",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMISITE",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMISITE",31,0)
 ;@module Site - SAMISI
"RTN","SAMISITE",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMISITE",33,0)
 ;@release 18-17
"RTN","SAMISITE",34,0)
 ;@edition-date 2020-01-17
"RTN","SAMISITE",35,0)
 ;@patches **5,12,14,17**
"RTN","SAMISITE",36,0)
 ;
"RTN","SAMISITE",37,0)
 ;@dev-add Alexis Carlson (arc)
"RTN","SAMISITE",38,0)
 ; alexis@vistaexpertise.net
"RTN","SAMISITE",39,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMISITE",40,0)
 ; toad@vistaexpertise.net
"RTN","SAMISITE",41,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMISITE",42,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMISITE",43,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMISITE",44,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMISITE",45,0)
 ;
"RTN","SAMISITE",46,0)
 ;@module-credits
"RTN","SAMISITE",47,0)
 ;
"RTN","SAMISITE",48,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMISITE",49,0)
 ; (VA-PALS)
"RTN","SAMISITE",50,0)
 ; http://va-pals.org/
"RTN","SAMISITE",51,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMISITE",52,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMISITE",53,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMISITE",54,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMISITE",55,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMISITE",56,0)
 ; http://ielcap.com/
"RTN","SAMISITE",57,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMISITE",58,0)
 ; http://paraxialtech.com/
"RTN","SAMISITE",59,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMISITE",60,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMISITE",61,0)
 ;
"RTN","SAMISITE",62,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMISITE",63,0)
 ; https://www.ielcap-airs.org
"RTN","SAMISITE",64,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMISITE",65,0)
 ;@partner-org par
"RTN","SAMISITE",66,0)
 ;
"RTN","SAMISITE",67,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMISITE",68,0)
 ;
"RTN","SAMISITE",69,0)
 ; 2020-04-02/05-26 ven/gpl 18-5 d36b7cad,36607664,521e0bdc,
"RTN","SAMISITE",70,0)
 ; d018f52e,156be19e,476b2ff4,0a1538ef
"RTN","SAMISITE",71,0)
 ;  SAMISITE add multitenancy, fix bug in logout, fix sitetitle on 1st
"RTN","SAMISITE",72,0)
 ; time in, add superuser site selection feature, fix bug in cache.
"RTN","SAMISITE",73,0)
 ;
"RTN","SAMISITE",74,0)
 ; 2021-06-05 ven/gpl 18-12-t2 223b5900
"RTN","SAMISITE",75,0)
 ;  SAMISITE upgrade parameter w/system overrides, add systemDemoOnly
"RTN","SAMISITE",76,0)
 ; & systemDemoUseDUZ parameters.
"RTN","SAMISITE",77,0)
 ;
"RTN","SAMISITE",78,0)
 ; 2021-07-01/07 ven/mcglk&toad&gpl 18-12-t2 cbf7e46b,bfeea24b,
"RTN","SAMISITE",79,0)
 ; 1dd91fea
"RTN","SAMISITE",80,0)
 ;  SAMISITE bump version & dates, add hdr comments & dev log; in
"RTN","SAMISITE",81,0)
 ; FINDSITE add missing 0 to quit.
"RTN","SAMISITE",82,0)
 ;
"RTN","SAMISITE",83,0)
 ; 2021-09-17 ven/gpl 18-14  1d01f4bd
"RTN","SAMISITE",84,0)
 ;  SAMISITE accept username & password as alternates to access &
"RTN","SAMISITE",85,0)
 ; verify for login.
"RTN","SAMISITE",86,0)
 ;
"RTN","SAMISITE",87,0)
 ; 2021-10-06 ven/lmry 18.14
"RTN","SAMISITE",88,0)
 ;  SAMISITE bump version & dates.
"RTN","SAMISITE",89,0)
 ;
"RTN","SAMISITE",90,0)
 ; 2022-02-14 ven/gpl 18-17 2ea7f220,b47a5e01
"RTN","SAMISITE",91,0)
 ;  SAMISITE add CRLF to site selection list for super users, add crlf
"RTN","SAMISITE",92,0)
 ; for javascript at end of site selection page.
"RTN","SAMISITE",93,0)
 ;
"RTN","SAMISITE",94,0)
 ; 2022-04-01 ven/gpl 18-17 7620d4ba
"RTN","SAMISITE",95,0)
 ;  SAMISITE single signon prototype.
"RTN","SAMISITE",96,0)
 ;
"RTN","SAMISITE",97,0)
 ; 2022-04-04 ven/lmry 18-17 258bc9269,b257e465
"RTN","SAMISITE",98,0)
 ;  SAMISITE bump versions and dates, fix blank line & blank at end of
"RTN","SAMISITE",99,0)
 ; line for XINDEX.
"RTN","SAMISITE",100,0)
 ;
"RTN","SAMISITE",101,0)
 ; 2022-04-08 ven/gpl 18-17 c08224b9
"RTN","SAMISITE",102,0)
 ;  SAMISITE updated single signon code thanks to Artit testing.
"RTN","SAMISITE",103,0)
 ;
"RTN","SAMISITE",104,0)
 ; 2022-04-11 ven/lmry 18-17 3bf9c56f
"RTN","SAMISITE",105,0)
 ;  SAMISITE add to history, bump dates, fix XINDEX blank at end of
"RTN","SAMISITE",106,0)
 ; line.
"RTN","SAMISITE",107,0)
 ;
"RTN","SAMISITE",108,0)
 ; 2022-04-26 ven/gpl 18-17 89497ba8,3f6b6117
"RTN","SAMISITE",109,0)
 ;  SAMISITE logout redirection.
"RTN","SAMISITE",110,0)
 ;
"RTN","SAMISITE",111,0)
 ; 2022-04-27 ven/lmry 18-17
"RTN","SAMISITE",112,0)
 ;  SAMISITE update history & date.
"RTN","SAMISITE",113,0)
 ;
"RTN","SAMISITE",114,0)
 ; 2024-08-17 ven/lmry 18-17-b6
"RTN","SAMISITE",115,0)
 ;  SAMISITE update history & date.
"RTN","SAMISITE",116,0)
 ;
"RTN","SAMISITE",117,0)
 ; 2024-08-22 ven/toad 18-17-b6
"RTN","SAMISITE",118,0)
 ;  SAMISITE update history, version-control lines, hdr comments.
"RTN","SAMISITE",119,0)
 ;
"RTN","SAMISITE",120,0)
 ;
"RTN","SAMISITE",121,0)
 ;@to-do
"RTN","SAMISITE",122,0)
 ; add label comments
"RTN","SAMISITE",123,0)
 ;
"RTN","SAMISITE",124,0)
 ;@contents
"RTN","SAMISITE",125,0)
 ; $$FINDSITE current site for user
"RTN","SAMISITE",126,0)
 ; $$USER ien of user accessing system
"RTN","SAMISITE",127,0)
 ; $$SITE ien of institution file entry for user's site
"RTN","SAMISITE",128,0)
 ; $$SITEID symbol for site
"RTN","SAMISITE",129,0)
 ; $$SITEACTV is site active?
"RTN","SAMISITE",130,0)
 ; $$SITENM site name from ien
"RTN","SAMISITE",131,0)
 ; $$SITENM2 site name from symbol
"RTN","SAMISITE",132,0)
 ; LOGIN login processing
"RTN","SAMISITE",133,0)
 ; REDIRECT extrinsic which issues redirect if any
"RTN","SAMISITE",134,0)
 ; LOGOURL extrinsic which returns the logout url, if any
"RTN","SAMISITE",135,0)
 ; SETLURL set the logout redirect url
"RTN","SAMISITE",136,0)
 ; $$SIGNON signon with access & verify code
"RTN","SAMISITE",137,0)
 ; SUPER site selection page for super users
"RTN","SAMISITE",138,0)
 ; UPGRADE init: convert to multi-tenancy
"RTN","SAMISITE",139,0)
 ; IDUSER Identify the user
"RTN","SAMISITE",140,0)
 ; STOREDUZ
"RTN","SAMISITE",141,0)
 ; TESTSETUP setup test environment
"RTN","SAMISITE",142,0)
 ;
"RTN","SAMISITE",143,0)
 ;
"RTN","SAMISITE",144,0)
 ;
"RTN","SAMISITE",145,0)
 ;
"RTN","SAMISITE",146,0)
 ;@section 1 subroutines
"RTN","SAMISITE",147,0)
 ;
"RTN","SAMISITE",148,0)
 ;
"RTN","SAMISITE",149,0)
 ;
"RTN","SAMISITE",150,0)
 ;
"RTN","SAMISITE",151,0)
FINDSITE(SAMIRETURN,ARGS) ; extrinsic which returns the site
"RTN","SAMISITE",152,0)
 ;
"RTN","SAMISITE",153,0)
 ; to be used by this user: ARGS("siteid")=siteid and
"RTN","SAMISITE",154,0)
 ; ARGS("sitetitle")=sitename - siteid
"RTN","SAMISITE",155,0)
 ; 1 for success 
"RTN","SAMISITE",156,0)
 ; 0 for fail - exit; page to be displayed is in SAMIRETURN
"RTN","SAMISITE",157,0)
 ;
"RTN","SAMISITE",158,0)
 ;d ^ZTER
"RTN","SAMISITE",159,0)
 I $$GET1PARM^SAMIPARM("testingSingleSignon")="true" D TESTSETUP()
"RTN","SAMISITE",160,0)
 D IDUSER()
"RTN","SAMISITE",161,0)
 n user
"RTN","SAMISITE",162,0)
 s user=$$USER()
"RTN","SAMISITE",163,0)
 i user=-1 d  q 0
"RTN","SAMISITE",164,0)
 . n vals
"RTN","SAMISITE",165,0)
 . s vals("siteid")=""
"RTN","SAMISITE",166,0)
 . s vals("sitetitle")="Unknown Site"
"RTN","SAMISITE",167,0)
 . s vals("errorMessage")=""
"RTN","SAMISITE",168,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:login",.vals)
"RTN","SAMISITE",169,0)
 . ;s ARGS("errorMessage")="Error, user not found"
"RTN","SAMISITE",170,0)
 . ;d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",171,0)
 ;
"RTN","SAMISITE",172,0)
 ;d  q 0
"RTN","SAMISITE",173,0)
 ;. s ARGS("errorMessage")="User is found: "_user
"RTN","SAMISITE",174,0)
 ;. d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",175,0)
 ;
"RTN","SAMISITE",176,0)
 n site,siteid,siteactv,sitenm
"RTN","SAMISITE",177,0)
 ;
"RTN","SAMISITE",178,0)
 i $o(^SAMI(311.13,"B",user,""))'="" d  q 0 ; superuser
"RTN","SAMISITE",179,0)
 . d SUPER("SAMIRETURN",.ARGS)
"RTN","SAMISITE",180,0)
 . s HTTPRSP("mime")="text/html"
"RTN","SAMISITE",181,0)
 ;
"RTN","SAMISITE",182,0)
 s site=$$SITE(user)
"RTN","SAMISITE",183,0)
 i site<1 s site=-1
"RTN","SAMISITE",184,0)
 i site=-1 d  q 0
"RTN","SAMISITE",185,0)
 . s ARGS("errorMessage")="Site not found for user "_user
"RTN","SAMISITE",186,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",187,0)
 ;
"RTN","SAMISITE",188,0)
 s siteid=$$SITEID(site)
"RTN","SAMISITE",189,0)
 i siteid=-1 d  q 0
"RTN","SAMISITE",190,0)
 . s ARGS("errorMessage")="Site ID not found for site "_site
"RTN","SAMISITE",191,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",192,0)
 ;
"RTN","SAMISITE",193,0)
 s siteactv=$$SITEACTV(site)
"RTN","SAMISITE",194,0)
 i siteactv<1 d  q 0
"RTN","SAMISITE",195,0)
 . s ARGS("errorMessage")="Site not active: "_siteid
"RTN","SAMISITE",196,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",197,0)
 ;
"RTN","SAMISITE",198,0)
 s sitenm=$$SITENM(site)
"RTN","SAMISITE",199,0)
 i sitenm=-1 d  q 0
"RTN","SAMISITE",200,0)
 . s ARGS("errorMessage")="Site name not found: "_siteid
"RTN","SAMISITE",201,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:syserror",.ARGS)
"RTN","SAMISITE",202,0)
 ;
"RTN","SAMISITE",203,0)
 s ARGS("siteid")=siteid
"RTN","SAMISITE",204,0)
 s ARGS("sitetitle")=$$SITENM(site)_" - "_siteid
"RTN","SAMISITE",205,0)
 ;
"RTN","SAMISITE",206,0)
 quit 1 ; end of $$FINDSITE
"RTN","SAMISITE",207,0)
 ;
"RTN","SAMISITE",208,0)
 ;
"RTN","SAMISITE",209,0)
 ;
"RTN","SAMISITE",210,0)
 ;
"RTN","SAMISITE",211,0)
USER() ; extrinsic returns the DUZ of the user accessing the system
"RTN","SAMISITE",212,0)
 ;
"RTN","SAMISITE",213,0)
 ; -1 means user not known
"RTN","SAMISITE",214,0)
 ;
"RTN","SAMISITE",215,0)
 n rtn s rtn=-1
"RTN","SAMISITE",216,0)
 s rtn=+$G(DUZ)
"RTN","SAMISITE",217,0)
 i rtn=0 s rtn=-1
"RTN","SAMISITE",218,0)
 ;
"RTN","SAMISITE",219,0)
 quit rtn ; end of $$USER
"RTN","SAMISITE",220,0)
 ;
"RTN","SAMISITE",221,0)
 ;
"RTN","SAMISITE",222,0)
 ;
"RTN","SAMISITE",223,0)
 ;
"RTN","SAMISITE",224,0)
SITE(USER) ; extrinsic returns the pointer to the Institution file
"RTN","SAMISITE",225,0)
 ;
"RTN","SAMISITE",226,0)
 ; which is the site of the user
"RTN","SAMISITE",227,0)
 ; -1 means site not found
"RTN","SAMISITE",228,0)
 ; zero means site not active
"RTN","SAMISITE",229,0)
 ;
"RTN","SAMISITE",230,0)
 n rtn
"RTN","SAMISITE",231,0)
 s rtn=$o(^VA(200,USER,2,0))
"RTN","SAMISITE",232,0)
 i +rtn="" s rtn=-1
"RTN","SAMISITE",233,0)
 ;
"RTN","SAMISITE",234,0)
 quit rtn ; end of $$SITE
"RTN","SAMISITE",235,0)
 ;
"RTN","SAMISITE",236,0)
 ;
"RTN","SAMISITE",237,0)
 ;
"RTN","SAMISITE",238,0)
 ;
"RTN","SAMISITE",239,0)
SITEID(SITE) ; extrinsic returns Site Symbol for SITE
"RTN","SAMISITE",240,0)
 ;
"RTN","SAMISITE",241,0)
 ; this is found in the SAMI SITE file
"RTN","SAMISITE",242,0)
 ; null means SITEID not found
"RTN","SAMISITE",243,0)
 ;
"RTN","SAMISITE",244,0)
 n rtn s rtn=-1
"RTN","SAMISITE",245,0)
 n ien s ien=$o(^SAMI(311.12,"B",SITE,""))
"RTN","SAMISITE",246,0)
 q:ien="" -1
"RTN","SAMISITE",247,0)
 s rtn=$$GET1^DIQ(311.12,ien_",",.02)
"RTN","SAMISITE",248,0)
 ;
"RTN","SAMISITE",249,0)
 quit rtn ; end of $$SITEID
"RTN","SAMISITE",250,0)
 ;
"RTN","SAMISITE",251,0)
 ;
"RTN","SAMISITE",252,0)
 ;
"RTN","SAMISITE",253,0)
 ; 
"RTN","SAMISITE",254,0)
SITEACTV(SITE) ; extrinsic returns 1 if site is active
"RTN","SAMISITE",255,0)
 ;
"RTN","SAMISITE",256,0)
 ; otherwise 0
"RTN","SAMISITE",257,0)
 ;
"RTN","SAMISITE",258,0)
 n rtn s rtn=-1
"RTN","SAMISITE",259,0)
 n ien s ien=$o(^SAMI(311.12,"B",SITE,""))
"RTN","SAMISITE",260,0)
 q:ien="" -1
"RTN","SAMISITE",261,0)
 s rtn=$$GET1^DIQ(311.12,ien_",",.03,"I")
"RTN","SAMISITE",262,0)
 ;
"RTN","SAMISITE",263,0)
 quit rtn ; end of $$SITEACTV
"RTN","SAMISITE",264,0)
 ;
"RTN","SAMISITE",265,0)
 ;
"RTN","SAMISITE",266,0)
 ;
"RTN","SAMISITE",267,0)
 ;
"RTN","SAMISITE",268,0)
SITENM(SITE) ; extrinsic returns site name
"RTN","SAMISITE",269,0)
 ;
"RTN","SAMISITE",270,0)
 n rtn s rtn=-1
"RTN","SAMISITE",271,0)
 s rtn=$$GET1^DIQ(4,SITE_",",.01)
"RTN","SAMISITE",272,0)
 i rtn="" s rtn=-1
"RTN","SAMISITE",273,0)
 ;
"RTN","SAMISITE",274,0)
 quit rtn ; end of $$SITENM
"RTN","SAMISITE",275,0)
 ;
"RTN","SAMISITE",276,0)
 ;
"RTN","SAMISITE",277,0)
 ;
"RTN","SAMISITE",278,0)
 ;
"RTN","SAMISITE",279,0)
SITENM2(SITEID) ; extrinsic returns site name from Site Symbol
"RTN","SAMISITE",280,0)
 ;
"RTN","SAMISITE",281,0)
 q:SITEID="" -1
"RTN","SAMISITE",282,0)
 n siteien
"RTN","SAMISITE",283,0)
 s siteien=$o(^SAMI(311.12,"SYM",SITEID,""))
"RTN","SAMISITE",284,0)
 n site
"RTN","SAMISITE",285,0)
 ;
"RTN","SAMISITE",286,0)
 quit $$GET1^DIQ(311.12,siteien_",",.01,"E") ; end of $$SITENM2
"RTN","SAMISITE",287,0)
 ;
"RTN","SAMISITE",288,0)
 ;
"RTN","SAMISITE",289,0)
 ;
"RTN","SAMISITE",290,0)
 ;
"RTN","SAMISITE",291,0)
LOGIN(RTN,VALS) ; login processing
"RTN","SAMISITE",292,0)
 ;
"RTN","SAMISITE",293,0)
 n access s access=$g(VALS("access"))
"RTN","SAMISITE",294,0)
 if access="" s access=$g(VALS("username"))
"RTN","SAMISITE",295,0)
 ;
"RTN","SAMISITE",296,0)
 n verify s verify=$g(VALS("verify"))
"RTN","SAMISITE",297,0)
 if verify="" s verify=$g(VALS("password"))
"RTN","SAMISITE",298,0)
 ;i verify="@demo123" s verify="@demo321"
"RTN","SAMISITE",299,0)
 ;i verify="@demo123" s verify="$#happy10"
"RTN","SAMISITE",300,0)
 ;i access="ZZZUSER1" s access="SUPER6"
"RTN","SAMISITE",301,0)
 ;i access="" d  ;
"RTN","SAMISITE",302,0)
 ;. s access="PHXNAV1"
"RTN","SAMISITE",303,0)
 ;. s verify="$#happy6"
"RTN","SAMISITE",304,0)
 ;
"RTN","SAMISITE",305,0)
 I $$GET1PARM^SAMIPARM("systemDemoOnly")="true" D  Q  ;
"RTN","SAMISITE",306,0)
 . S DUZ=$$GET1PARM^SAMIPARM("systemDemoUseDUZ")
"RTN","SAMISITE",307,0)
 . I +DUZ=0 D  ;
"RTN","SAMISITE",308,0)
 . . S DUZ=$O(^SAMI(311.13,"B",""))
"RTN","SAMISITE",309,0)
 . . q
"RTN","SAMISITE",310,0)
 . s VALS("samiroute")=""
"RTN","SAMISITE",311,0)
 . s VALS("siteid")=""
"RTN","SAMISITE",312,0)
 . d WSHOME^SAMIHOM3(.RTN,.VALS)
"RTN","SAMISITE",313,0)
 . q
"RTN","SAMISITE",314,0)
 ;
"RTN","SAMISITE",315,0)
 n ACVC s ACVC=access_";"_verify
"RTN","SAMISITE",316,0)
 ;
"RTN","SAMISITE",317,0)
 i $$SIGNON(ACVC) D  Q  ;
"RTN","SAMISITE",318,0)
 . D STOREDUZ()
"RTN","SAMISITE",319,0)
 . s VALS("samiroute")=""
"RTN","SAMISITE",320,0)
 . s VALS("siteid")=""
"RTN","SAMISITE",321,0)
 . d WSHOME^SAMIHOM3(.RTN,.VALS)
"RTN","SAMISITE",322,0)
 . q
"RTN","SAMISITE",323,0)
 ;
"RTN","SAMISITE",324,0)
 else  D  Q  ;
"RTN","SAMISITE",325,0)
 . s VALS("errorMessage")="Invalid login"
"RTN","SAMISITE",326,0)
 . d RTNERR^SAMIHOM4(.RTN,"vapals:login",.VALS)
"RTN","SAMISITE",327,0)
 . q
"RTN","SAMISITE",328,0)
 ;
"RTN","SAMISITE",329,0)
 quit  ; end of LOGIN
"RTN","SAMISITE",330,0)
 ;
"RTN","SAMISITE",331,0)
 ;
"RTN","SAMISITE",332,0)
 ;
"RTN","SAMISITE",333,0)
 ;
"RTN","SAMISITE",334,0)
REDIRECT(RTN,ARGS) ; extrinsic which issues redirect if any
"RTN","SAMISITE",335,0)
 ;
"RTN","SAMISITE",336,0)
 ; returns if redirect exists
"RTN","SAMISITE",337,0)
 ;
"RTN","SAMISITE",338,0)
 n reyn s reyn=0 ; default to no redirect
"RTN","SAMISITE",339,0)
 ;
"RTN","SAMISITE",340,0)
 n url
"RTN","SAMISITE",341,0)
 s url=$$LOGOURL(.ARGS)
"RTN","SAMISITE",342,0)
 i url'="" d  ;
"RTN","SAMISITE",343,0)
 . s reyn=1
"RTN","SAMISITE",344,0)
 . s RTN(1)="<html><head>"
"RTN","SAMISITE",345,0)
 . s RTN(2)="<meta http-equiv=""refresh"" content=""0; url="_url_"""/>"
"RTN","SAMISITE",346,0)
 . s RTN(3)="</head><body><p></p></body></html>"
"RTN","SAMISITE",347,0)
 . s HTTPRSP("mime")="text/html"
"RTN","SAMISITE",348,0)
 . q
"RTN","SAMISITE",349,0)
 ;
"RTN","SAMISITE",350,0)
 quit reyn ; end of $$REDIRECT
"RTN","SAMISITE",351,0)
 ;
"RTN","SAMISITE",352,0)
 ;
"RTN","SAMISITE",353,0)
 ;
"RTN","SAMISITE",354,0)
 ;
"RTN","SAMISITE",355,0)
LOGOURL(ARGS) ;extrinsic which returns the logout url, if any
"RTN","SAMISITE",356,0)
 ;
"RTN","SAMISITE",357,0)
 ; returns the null string if none
"RTN","SAMISITE",358,0)
 ;
"RTN","SAMISITE",359,0)
 n url s url=""
"RTN","SAMISITE",360,0)
 I $$GET1PARM^SAMIPARM("testingSingleSignon")="true" d  q url
"RTN","SAMISITE",361,0)
 . s url="https://vistaexpertise.net/"
"RTN","SAMISITE",362,0)
 . q
"RTN","SAMISITE",363,0)
 ;
"RTN","SAMISITE",364,0)
 s url=$$GET1PARM^SAMIPARM("systemLogoutUrl")
"RTN","SAMISITE",365,0)
 ;
"RTN","SAMISITE",366,0)
 quit url ; end of $$LOGOURL
"RTN","SAMISITE",367,0)
 ;
"RTN","SAMISITE",368,0)
 ;
"RTN","SAMISITE",369,0)
 ;
"RTN","SAMISITE",370,0)
 ;
"RTN","SAMISITE",371,0)
SETLURL(url) ; set the logout redirect url
"RTN","SAMISITE",372,0)
 ;
"RTN","SAMISITE",373,0)
 D SETPARM^SAMIPARM("SYS","systemLogoutUrl",url)
"RTN","SAMISITE",374,0)
 ;
"RTN","SAMISITE",375,0)
 quit  ; end of SETLURL
"RTN","SAMISITE",376,0)
 ;
"RTN","SAMISITE",377,0)
 ;
"RTN","SAMISITE",378,0)
 ;
"RTN","SAMISITE",379,0)
 ;
"RTN","SAMISITE",380,0)
SIGNON(ACVC) ; extrinsic returns 1 if signon is successful, else 0
"RTN","SAMISITE",381,0)
 ;
"RTN","SAMISITE",382,0)
 ; Sign-on
"RTN","SAMISITE",383,0)
 ;
"RTN","SAMISITE",384,0)
 N IO S IO=$P
"RTN","SAMISITE",385,0)
 D SETUP^XUSRB() ; Only partition set-up; No single sign-on or CAPRI
"RTN","SAMISITE",386,0)
 N RTN D VALIDAV^XUSRB(.RTN,$$ENCRYP^XUSRB1(ACVC)) ; sign-on call
"RTN","SAMISITE",387,0)
 I RTN(0)>0,'RTN(2) Q 1 ; Sign on successful!
"RTN","SAMISITE",388,0)
 I RTN(0)=0,RTN(2) Q 0  ; Verify Code must be changed NOW!
"RTN","SAMISITE",389,0)
 I $L(RTN(3)) Q 0  ; Error Message
"RTN","SAMISITE",390,0)
 ;
"RTN","SAMISITE",391,0)
 quit  ; end of SIGNON
"RTN","SAMISITE",392,0)
 ;
"RTN","SAMISITE",393,0)
 ;
"RTN","SAMISITE",394,0)
 ;
"RTN","SAMISITE",395,0)
 ;
"RTN","SAMISITE",396,0)
SUPER(RTN,FILTER) ; returns site selection page for super users
"RTN","SAMISITE",397,0)
 ;
"RTN","SAMISITE",398,0)
 n temp
"RTN","SAMISITE",399,0)
 d getThis^%wd("temp","blank_no_nav.html")
"RTN","SAMISITE",400,0)
 q:'$d(temp)
"RTN","SAMISITE",401,0)
 n cnt s cnt=0
"RTN","SAMISITE",402,0)
 ;
"RTN","SAMISITE",403,0)
 n zj s zj=0
"RTN","SAMISITE",404,0)
 f  s zj=$o(temp(zj)) q:temp(zj)["Insert"  q:+zj=0  d  ;
"RTN","SAMISITE",405,0)
 . n ln s ln=temp(zj)
"RTN","SAMISITE",406,0)
 . i ln["PAGE NAME" s ln="Site Selection"
"RTN","SAMISITE",407,0)
 . d LOAD^SAMIFORM(.ln,"","")
"RTN","SAMISITE",408,0)
 . s cnt=cnt+1
"RTN","SAMISITE",409,0)
 . s @RTN@(cnt)=ln
"RTN","SAMISITE",410,0)
 s cnt=cnt+1
"RTN","SAMISITE",411,0)
 s @RTN@(cnt)="<ul>"
"RTN","SAMISITE",412,0)
 ;
"RTN","SAMISITE",413,0)
 n gn s gn=$na(^SAMI(311.12,"B"))
"RTN","SAMISITE",414,0)
 n zi s zi=0
"RTN","SAMISITE",415,0)
 f  s zi=$o(@gn@(zi)) q:+zi=0  d  ;
"RTN","SAMISITE",416,0)
 . n zien s zien=$o(@gn@(zi,""))
"RTN","SAMISITE",417,0)
 . n active
"RTN","SAMISITE",418,0)
 . s active=$$GET1^DIQ(311.12,zien_",",.03,"I")
"RTN","SAMISITE",419,0)
 . q:active=0
"RTN","SAMISITE",420,0)
 . n name
"RTN","SAMISITE",421,0)
 . s name=$$SITENM(zi)_" - "_$$SITEID(zi)
"RTN","SAMISITE",422,0)
 . n link
"RTN","SAMISITE",423,0)
 . s link="<li>"
"RTN","SAMISITE",424,0)
 . s link=link_"<a class=""navigation"" data-method=""post"""
"RTN","SAMISITE",425,0)
 . s link=link_" data-samiroute=""home"" data-siteid="""_$$SITEID(zi)_""""
"RTN","SAMISITE",426,0)
 . ;s link=link_" data-site="""_$$SITEID(zi)_""""
"RTN","SAMISITE",427,0)
 . ;s link=link_" href=""#!"">"_$$SITENM(zi)_" - "_$$SITEID(zi)
"RTN","SAMISITE",428,0)
 . s link=link_" href=""/vapals"">"_name
"RTN","SAMISITE",429,0)
 . s link=link_"</a></li>"_$char(13,10)
"RTN","SAMISITE",430,0)
 . ;n link
"RTN","SAMISITE",431,0)
 . ;s link="<form method=POST action=""/vapals"">"
"RTN","SAMISITE",432,0)
 . ;s link=link_"<input type=hidden name=""samiroute"" value=""home"">"
"RTN","SAMISITE",433,0)
 . ;s link=link_"<input type=hidden name=""siteid"" value="""_$$SITEID(zi)_""">"
"RTN","SAMISITE",434,0)
 . ;s link=link_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMISITE",435,0)
 . s cnt=cnt+1
"RTN","SAMISITE",436,0)
 . s @RTN@(cnt)=link
"RTN","SAMISITE",437,0)
 . q
"RTN","SAMISITE",438,0)
 ;
"RTN","SAMISITE",439,0)
 s cnt=cnt+1
"RTN","SAMISITE",440,0)
 s @RTN@(cnt)="</ul>"
"RTN","SAMISITE",441,0)
 n zk s zk=zj+1
"RTN","SAMISITE",442,0)
 f  s zk=$o(temp(zk)) q:+zk=0  d  ;
"RTN","SAMISITE",443,0)
 . s cnt=cnt+1
"RTN","SAMISITE",444,0)
 . s @RTN@(cnt)=temp(zk)_$char(13,10)
"RTN","SAMISITE",445,0)
 . q
"RTN","SAMISITE",446,0)
 ;
"RTN","SAMISITE",447,0)
 quit  ; end of SUPER
"RTN","SAMISITE",448,0)
 ;
"RTN","SAMISITE",449,0)
 ;
"RTN","SAMISITE",450,0)
 ;
"RTN","SAMISITE",451,0)
 ;
"RTN","SAMISITE",452,0)
UPGRADE() ; convert VAPALS system to Multi-tenancy by adding siteid
"RTN","SAMISITE",453,0)
 ;
"RTN","SAMISITE",454,0)
 ; to all existing patients - runs one time as the Post Install 
"RTN","SAMISITE",455,0)
 ; to the installation
"RTN","SAMISITE",456,0)
 ;
"RTN","SAMISITE",457,0)
 n lroot,proot,lien,pien
"RTN","SAMISITE",458,0)
 s (lien,pien)=0
"RTN","SAMISITE",459,0)
 s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMISITE",460,0)
 s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMISITE",461,0)
 n site
"RTN","SAMISITE",462,0)
 s site=$$GET^XPAR("SYS","SAMI SID PREFIX",,"Q")
"RTN","SAMISITE",463,0)
 i site="" d  q  ;
"RTN","SAMISITE",464,0)
 . D MES^XPDUTL("No default site returned by SAMI SID PREFIX parameter, exiting")
"RTN","SAMISITE",465,0)
 . q
"RTN","SAMISITE",466,0)
 ;
"RTN","SAMISITE",467,0)
 n cnt s cnt=0
"RTN","SAMISITE",468,0)
 f  s lien=$o(@lroot@(lien)) q:+lien=0  d  ;
"RTN","SAMISITE",469,0)
 . q:$g(@lroot@(lien,"siteid"))'=""
"RTN","SAMISITE",470,0)
 . n nomatch s nomatch=0
"RTN","SAMISITE",471,0)
 . n dfn s dfn=$g(@lroot@(lien,"dfn"))
"RTN","SAMISITE",472,0)
 . i dfn="" d  q  ;
"RTN","SAMISITE",473,0)
 . . D MES^XPDUTL("Error, no dfn found for lien "_lien)
"RTN","SAMISITE",474,0)
 . . q
"RTN","SAMISITE",475,0)
 . s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMISITE",476,0)
 . ; make sure the first 3 chars of the studyid matches the site
"RTN","SAMISITE",477,0)
 . i pien'="" d  q:nomatch
"RTN","SAMISITE",478,0)
 . . n psite,psid
"RTN","SAMISITE",479,0)
 . . s psid=$g(@proot@(pien,"sisid"))
"RTN","SAMISITE",480,0)
 . . i psid="" s nomatch=1 q  ;
"RTN","SAMISITE",481,0)
 . . i $e(psid,1,3)'=site s nomatch=1 d  q  ;
"RTN","SAMISITE",482,0)
 . . . d MES^XPDUTL("skipping record - studyid "_psid_" does not match site "_site)
"RTN","SAMISITE",483,0)
 . . . q
"RTN","SAMISITE",484,0)
 . . q
"RTN","SAMISITE",485,0)
 . ;w !,"lien "_lien_" being set to "_site
"RTN","SAMISITE",486,0)
 . s cnt=cnt+1
"RTN","SAMISITE",487,0)
 . s @lroot@(lien,"siteid")=site
"RTN","SAMISITE",488,0)
 . q
"RTN","SAMISITE",489,0)
 ;
"RTN","SAMISITE",490,0)
 i cnt>0 d  ;
"RTN","SAMISITE",491,0)
 . d MES^XPDUTL("Multi-tenancy upgrade successful")
"RTN","SAMISITE",492,0)
 . d MES^XPDUTL(cnt_" patient records set to site "_site)
"RTN","SAMISITE",493,0)
 . q
"RTN","SAMISITE",494,0)
 ;
"RTN","SAMISITE",495,0)
 quit  ; end of UPGRADE
"RTN","SAMISITE",496,0)
 ;
"RTN","SAMISITE",497,0)
 ;
"RTN","SAMISITE",498,0)
 ;
"RTN","SAMISITE",499,0)
 ;
"RTN","SAMISITE",500,0)
IDUSER() ; identify user
"RTN","SAMISITE",501,0)
 ;
"RTN","SAMISITE",502,0)
 n pivroot s pivroot=$$setroot^%wd("piv-credentials")
"RTN","SAMISITE",503,0)
 n secid s secid=$g(HTTPREQ("header","secid"))
"RTN","SAMISITE",504,0)
 Q:secid=""
"RTN","SAMISITE",505,0)
 n secien
"RTN","SAMISITE",506,0)
 s secien=$o(@pivroot@("secid",secid,""))
"RTN","SAMISITE",507,0)
 i secien="" d  q  ;
"RTN","SAMISITE",508,0)
 . s secien=$o(@pivroot@(" "),-1)+1
"RTN","SAMISITE",509,0)
 . m @pivroot@(secien)=HTTPREQ("header")
"RTN","SAMISITE",510,0)
 . s @pivroot@("secid",secid,secien)=""
"RTN","SAMISITE",511,0)
 . q
"RTN","SAMISITE",512,0)
 i $d(@pivroot@(secien,"DUZ")) S DUZ=$g(@pivroot@(secien,"DUZ"))
"RTN","SAMISITE",513,0)
 ;
"RTN","SAMISITE",514,0)
 quit  ; end of IDUSER
"RTN","SAMISITE",515,0)
 ;
"RTN","SAMISITE",516,0)
 ;
"RTN","SAMISITE",517,0)
 ;
"RTN","SAMISITE",518,0)
 ;
"RTN","SAMISITE",519,0)
STOREDUZ() ;
"RTN","SAMISITE",520,0)
 ;
"RTN","SAMISITE",521,0)
 Q:'$D(DUZ)
"RTN","SAMISITE",522,0)
 n pivroot s pivroot=$$setroot^%wd("piv-credentials")
"RTN","SAMISITE",523,0)
 i '$d(HTTPREQ("header","secid")) D  ;
"RTN","SAMISITE",524,0)
 . I $$GET1PARM^SAMIPARM("testingSingleSignon")="true" D TESTSETUP
"RTN","SAMISITE",525,0)
 . q
"RTN","SAMISITE",526,0)
 n logien s logien=$o(@pivroot@("login"," "),-1)+1
"RTN","SAMISITE",527,0)
 m @pivroot@("login",logien)=HTTPREQ
"RTN","SAMISITE",528,0)
 n secid s secid=$g(HTTPREQ("header","secid"))
"RTN","SAMISITE",529,0)
 q:secid=""
"RTN","SAMISITE",530,0)
 n secien
"RTN","SAMISITE",531,0)
 s secien=$o(@pivroot@("secid",secid,""))
"RTN","SAMISITE",532,0)
 q:secien=""
"RTN","SAMISITE",533,0)
 s @pivroot@(secien,"DUZ")=DUZ
"RTN","SAMISITE",534,0)
 ;
"RTN","SAMISITE",535,0)
 quit  ; end of STOREDUZ
"RTN","SAMISITE",536,0)
 ;
"RTN","SAMISITE",537,0)
 ;
"RTN","SAMISITE",538,0)
 ;
"RTN","SAMISITE",539,0)
 ;
"RTN","SAMISITE",540,0)
TESTSETUP() ; setup test environment
"RTN","SAMISITE",541,0)
 ;
"RTN","SAMISITE",542,0)
 S HTTPREQ("USER")="CN=VAPALS,USER"
"RTN","SAMISITE",543,0)
 I $D(K) D  ;
"RTN","SAMISITE",544,0)
 . S HTTPREQ("header","secid")=$P(K,":",4)
"RTN","SAMISITE",545,0)
 . S HTTPREQ("header","K")=K
"RTN","SAMISITE",546,0)
 ;
"RTN","SAMISITE",547,0)
 quit  ; end of TESTSETUP
"RTN","SAMISITE",548,0)
 ;
"RTN","SAMISITE",549,0)
 ;
"RTN","SAMISITE",550,0)
 ;
"RTN","SAMISITE",551,0)
EOR ; end of routine SAMISITE
"RTN","SAMIUR")
0^4^B1025197513
"RTN","SAMIUR",1,0)
SAMIUR ;ven/gpl - user reports; 2024-08-22t21:19z
"RTN","SAMIUR",2,0)
 ;;18.0;SAMI;**5,10,11,12,14,15,17**;2020-01-17;Build 8
"RTN","SAMIUR",3,0)
 ;mdc-e1;SAMIUR-20240822-E01Ltf0C;SAMI-18-17-b6
"RTN","SAMIUR",4,0)
 ;mdc-v7;B1025197513;SAMI*18.0*17 SEQ #17
"RTN","SAMIUR",5,0)
 ;
"RTN","SAMIUR",6,0)
 ; SAMIUR contains a web service & associated subroutines to produce
"RTN","SAMIUR",7,0)
 ; ScreeningPlus user reports.
"RTN","SAMIUR",8,0)
 ;
"RTN","SAMIUR",9,0)
 quit  ; no entry from top
"RTN","SAMIUR",10,0)
 ;
"RTN","SAMIUR",11,0)
 ;
"RTN","SAMIUR",12,0)
 ;
"RTN","SAMIUR",13,0)
 ;
"RTN","SAMIUR",14,0)
 ;@section 0 primary development
"RTN","SAMIUR",15,0)
 ;
"RTN","SAMIUR",16,0)
 ;
"RTN","SAMIUR",17,0)
 ;
"RTN","SAMIUR",18,0)
 ;
"RTN","SAMIUR",19,0)
 ;@routine-credits
"RTN","SAMIUR",20,0)
 ;
"RTN","SAMIUR",21,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIUR",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUR",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIUR",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIUR",25,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIUR",26,0)
 ;@license see routine SAMIUL
"RTN","SAMIUR",27,0)
 ;
"RTN","SAMIUR",28,0)
 ;@update 2024-08-22t21:19z
"RTN","SAMIUR",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIUR",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIUR",31,0)
 ;@module User Reports - SAMIUR
"RTN","SAMIUR",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUR",33,0)
 ;@release 18-17
"RTN","SAMIUR",34,0)
 ;@edition-date 2024-08
"RTN","SAMIUR",35,0)
 ;@patches **5,10,11,12,14,15,17**
"RTN","SAMIUR",36,0)
 ;
"RTN","SAMIUR",37,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIUR",38,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUR",39,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIUR",40,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIUR",41,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIUR",42,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIUR",43,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIUR",44,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIUR",45,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIUR",46,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIUR",47,0)
 ;
"RTN","SAMIUR",48,0)
 ;@module-credits see SAMIURUL
"RTN","SAMIUR",49,0)
 ;
"RTN","SAMIUR",50,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUR",51,0)
 ; see SAMIURUL
"RTN","SAMIUR",52,0)
 ;
"RTN","SAMIUR",53,0)
 ;@contents
"RTN","SAMIUR",54,0)
 ;
"RTN","SAMIUR",55,0)
 ;  1. web-route service WSREPORT^SAMIUR & subroutines
"RTN","SAMIUR",56,0)
 ; WSREPORT generate report based on params in filter
"RTN","SAMIUR",57,0)
 ; SORT sort patients by name
"RTN","SAMIUR",58,0)
 ; NUHREF create nuhref link to casereview for all patients
"RTN","SAMIUR",59,0)
 ; PNAME page name for report
"RTN","SAMIUR",60,0)
 ;
"RTN","SAMIUR",61,0)
 ;  2. select subroutines
"RTN","SAMIUR",62,0)
 ; SELECT select patients for report
"RTN","SAMIUR",63,0)
 ; UNMAT build unmatched persons list
"RTN","SAMIUR",64,0)
 ; RECOMEND build recommendations persons list on entry for every ceform 
"RTN","SAMIUR",65,0)
 ;  in the date range
"RTN","SAMIUR",66,0)
 ; CEFORMS all ceforms for patient dfn in date range
"RTN","SAMIUR",67,0)
 ; WKLIST build work list
"RTN","SAMIUR",68,0)
 ;
"RTN","SAMIUR",69,0)
 ;
"RTN","SAMIUR",70,0)
 ;
"RTN","SAMIUR",71,0)
 ;
"RTN","SAMIUR",72,0)
 ;@section 1 web-route service WSREPORT^SAMIUR & subroutines
"RTN","SAMIUR",73,0)
 ;
"RTN","SAMIUR",74,0)
 ;
"RTN","SAMIUR",75,0)
 ;
"RTN","SAMIUR",76,0)
 ;
"RTN","SAMIUR",77,0)
 ;@wrs-code WSREPORT^SAMIUR
"RTN","SAMIUR",78,0)
 ;
"RTN","SAMIUR",79,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUR",80,0)
 ;
"RTN","SAMIUR",81,0)
 ;ven/gpl;wrs;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIUR",82,0)
 ;@called-by
"RTN","SAMIUR",83,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIUR",84,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIUR",85,0)
 ;@calls
"RTN","SAMIUR",86,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIUR",87,0)
 ; $$GET1PARM^SAMIPARM
"RTN","SAMIUR",88,0)
 ; getThis^%wd
"RTN","SAMIUR",89,0)
 ; SELECT^SAMIUR
"RTN","SAMIUR",90,0)
 ; LOAD^SAMIFORM
"RTN","SAMIUR",91,0)
 ; $$PNAME^SAMIUR
"RTN","SAMIUR",92,0)
 ; findReplace^%ts
"RTN","SAMIUR",93,0)
 ; RPTTBL^SAMIUR2
"RTN","SAMIUR",94,0)
 ; NUHREF^SAMIUR
"RTN","SAMIUR",95,0)
 ; SORT^SAMIUR
"RTN","SAMIUR",96,0)
 ;@input
"RTN","SAMIUR",97,0)
 ; SAMIRTN =
"RTN","SAMIUR",98,0)
 ; filter =
"RTN","SAMIUR",99,0)
 ;@output
"RTN","SAMIUR",100,0)
 ; @RPT(ir,"routine"): [from report def table from RPTTBL^SAMIUR2]
"RTN","SAMIUR",101,0)
 ;  format = $$<tag>^SAMIUR2, where tag =
"RTN","SAMIUR",102,0)
 ;  AGE       BLINEDT   CONTACT   CTPROT   DOB      FUDATE    GENDER
"RTN","SAMIUR",103,0)
 ;  IFORM     LASTEXM   MANPAT    MATCH    NAME     PACKYRS   POSSIBLE
"RTN","SAMIUR",104,0)
 ;  RECOM     RURAL     SID       SMHIS    SMKSTAT  SSN       STUDYDT
"RTN","SAMIUR",105,0)
 ;  STUDYTYP  VALS      WHEN      WORKPAT
"RTN","SAMIUR",106,0)
 ;@tests
"RTN","SAMIUR",107,0)
 ; UTWSRPT^SAMIUTUR
"RTN","SAMIUR",108,0)
 ;
"RTN","SAMIUR",109,0)
 ; here are the user reports that are defined:
"RTN","SAMIUR",110,0)
 ;  1. followup
"RTN","SAMIUR",111,0)
 ;  2. activity
"RTN","SAMIUR",112,0)
 ;  3. missingct
"RTN","SAMIUR",113,0)
 ;  4. incomplete
"RTN","SAMIUR",114,0)
 ;  5. outreach
"RTN","SAMIUR",115,0)
 ;  6. enrollment
"RTN","SAMIUR",116,0)
 ;  7. worklist
"RTN","SAMIUR",117,0)
 ; the report to generate is passed in parameter samireporttype
"RTN","SAMIUR",118,0)
 ;
"RTN","SAMIUR",119,0)
 ;
"RTN","SAMIUR",120,0)
WSREPORT(SAMIRTN,filter) ; generate report based on params in filter
"RTN","SAMIUR",121,0)
 ;
"RTN","SAMIUR",122,0)
 new debug set debug=0
"RTN","SAMIUR",123,0)
 if $get(filter("debug"))=1 set debug=1
"RTN","SAMIUR",124,0)
 if $get(filter("debug"))=1 set debug=1
"RTN","SAMIUR",125,0)
 kill SAMIRTN
"RTN","SAMIUR",126,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMIUR",127,0)
 ;
"RTN","SAMIUR",128,0)
 new type,temp,site
"RTN","SAMIUR",129,0)
 s site=$g(filter("siteid"))
"RTN","SAMIUR",130,0)
 i site="" s site=$g(filter("site"))
"RTN","SAMIUR",131,0)
 i site="" d  q  ; report site missing
"RTN","SAMIUR",132,0)
 . d GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",133,0)
 ;
"RTN","SAMIUR",134,0)
 set type=$get(filter("samireporttype"))
"RTN","SAMIUR",135,0)
 if type="" do  quit  ; report type missing
"RTN","SAMIUR",136,0)
 . do GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",137,0)
 . quit
"RTN","SAMIUR",138,0)
 ;
"RTN","SAMIUR",139,0)
 if type="unmatched" i $$GET1PARM^SAMIPARM("matchingReportEnabled",site)'="true" do  quit  ;
"RTN","SAMIUR",140,0)
 . d GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",141,0)
 ;
"RTN","SAMIUR",142,0)
 do getThis^%wd("temp","table.html") ; page template
"RTN","SAMIUR",143,0)
 quit:'$data(temp)
"RTN","SAMIUR",144,0)
 ;
"RTN","SAMIUR",145,0)
 new SAMIPATS
"RTN","SAMIUR",146,0)
 ; set pats=""
"RTN","SAMIUR",147,0)
 new datephrase
"RTN","SAMIUR",148,0)
 do SELECT^SAMIUR(.SAMIPATS,type,.datephrase,.filter) ; select pats for report
"RTN","SAMIUR",149,0)
 ; quit:'$data(SAMIPATS)
"RTN","SAMIUR",150,0)
 ;
"RTN","SAMIUR",151,0)
 new ln,cnt,ii
"RTN","SAMIUR",152,0)
 set (ii,ln,cnt)=0
"RTN","SAMIUR",153,0)
 for  do  quit:'ii  quit:$get(temp(ii))["<thead"
"RTN","SAMIUR",154,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",155,0)
 . quit:'ii
"RTN","SAMIUR",156,0)
 . quit:$get(temp(ii))["<thead"
"RTN","SAMIUR",157,0)
 . ;
"RTN","SAMIUR",158,0)
 . set cnt=cnt+1
"RTN","SAMIUR",159,0)
 . set ln=$get(temp(ii))
"RTN","SAMIUR",160,0)
 . new samikey,si
"RTN","SAMIUR",161,0)
 . set (samikey,si)=""
"RTN","SAMIUR",162,0)
 . do LOAD^SAMIFORM(.ln,samikey,si,.filter)
"RTN","SAMIUR",163,0)
 . ; if ln["PAGE NAME" do
"RTN","SAMIUR",164,0)
 . ; . do findReplace^%ts(.ln,"PAGE NAME",$$PNAME(type,datephrase))
"RTN","SAMIUR",165,0)
 . ; . quit
"RTN","SAMIUR",166,0)
 . if ln["PAGE NAME" do
"RTN","SAMIUR",167,0)
 . . do findReplace^%ts(.ln,"PAGE NAME",$$PNAME^SAMIUR(type,""))
"RTN","SAMIUR",168,0)
 . . quit
"RTN","SAMIUR",169,0)
 . if ln["CRITERIA" do
"RTN","SAMIUR",170,0)
 . . do findReplace^%ts(.ln,"CRITERIA",datephrase)
"RTN","SAMIUR",171,0)
 . . quit
"RTN","SAMIUR",172,0)
 . if ln["@@REPORTTYPE@@" do
"RTN","SAMIUR",173,0)
 . . do findReplace^%ts(.ln,"@@REPORTTYPE@@",type)
"RTN","SAMIUR",174,0)
 . . quit
"RTN","SAMIUR",175,0)
 . ;
"RTN","SAMIUR",176,0)
 . if ln["name=""start-date""" do
"RTN","SAMIUR",177,0)
 . . do findReplace^%ts(.ln,"start-date""","start-date"" value="""_$g(filter("start-date"))_"""")
"RTN","SAMIUR",178,0)
 . . quit
"RTN","SAMIUR",179,0)
 . if ln["name=""end-date""" do
"RTN","SAMIUR",180,0)
 . . do findReplace^%ts(.ln,"end-date""","end-date"" value="""_$g(filter("end-date"))_"""")
"RTN","SAMIUR",181,0)
 . . quit
"RTN","SAMIUR",182,0)
 . ;
"RTN","SAMIUR",183,0)
 . set SAMIRTN(cnt)=ln
"RTN","SAMIUR",184,0)
 . quit
"RTN","SAMIUR",185,0)
 ;
"RTN","SAMIUR",186,0)
 new RPT,ik
"RTN","SAMIUR",187,0)
 do RPTTBL^SAMIUR2(.RPT,type,site) ; load report definition table
"RTN","SAMIUR",188,0)
 if '$data(RPT) do  quit  ; don't know about this report
"RTN","SAMIUR",189,0)
 . do GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",190,0)
 . quit
"RTN","SAMIUR",191,0)
 ;
"RTN","SAMIUR",192,0)
 ; output header
"RTN","SAMIUR",193,0)
 ;
"RTN","SAMIUR",194,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="<thead><tr>"
"RTN","SAMIUR",195,0)
 set cnt=cnt+1
"RTN","SAMIUR",196,0)
 new totcnt set totcnt=cnt
"RTN","SAMIUR",197,0)
 ;
"RTN","SAMIUR",198,0)
 set ir=""
"RTN","SAMIUR",199,0)
 for  do  quit:ir=""  ;
"RTN","SAMIUR",200,0)
 . set ir=$order(RPT(ir))
"RTN","SAMIUR",201,0)
 . quit:ir=""
"RTN","SAMIUR",202,0)
 . set cnt=cnt+1
"RTN","SAMIUR",203,0)
 . set SAMIRTN(cnt)="<th>"_$get(RPT(ir,"header"))_"</th>"
"RTN","SAMIUR",204,0)
 . quit
"RTN","SAMIUR",205,0)
 ;
"RTN","SAMIUR",206,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="</tr></thead>"
"RTN","SAMIUR",207,0)
 ;
"RTN","SAMIUR",208,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="<tbody>"
"RTN","SAMIUR",209,0)
 ;
"RTN","SAMIUR",210,0)
 if type'="worklist" do  ;
"RTN","SAMIUR",211,0)
 . do NUHREF^SAMIUR(.SAMIPATS) ; create the nuhref link for all patients
"RTN","SAMIUR",212,0)
 . quit
"RTN","SAMIUR",213,0)
 ;
"RTN","SAMIUR",214,0)
 new SRT set SRT=""
"RTN","SAMIUR",215,0)
 if $get(filter("sort"))="" d  ; what kind of sort
"RTN","SAMIUR",216,0)
 . set filter("sort")="name"
"RTN","SAMIUR",217,0)
 . i type="missingct" s filter("sort")="cdate" ;sort by latest contact
"RTN","SAMIUR",218,0)
 do SORT^SAMIUR(.SRT,.SAMIPATS,.filter)
"RTN","SAMIUR",219,0)
 ; zwrite SRT
"RTN","SAMIUR",220,0)
 ;
"RTN","SAMIUR",221,0)
 ; set ij=0
"RTN","SAMIUR",222,0)
 ; for  do  quit:'ij  ;
"RTN","SAMIUR",223,0)
 ; . set ij=$order(SAMIPATS(ij))
"RTN","SAMIUR",224,0)
 ; . quit:'ij  
"RTN","SAMIUR",225,0)
 ; . new ij2 set ij2=0
"RTN","SAMIUR",226,0)
 ; . for  do  quit:'ij2  ;
"RTN","SAMIUR",227,0)
 ; . . set ij2=$order(SAMIPATS(ij,ij2))
"RTN","SAMIUR",228,0)
 ; . . quit:'ij2  
"RTN","SAMIUR",229,0)
 ; . . new dfn set dfn=ij2
"RTN","SAMIUR",230,0)
 ; . . quit
"RTN","SAMIUR",231,0)
 ; . quit
"RTN","SAMIUR",232,0)
 ;
"RTN","SAMIUR",233,0)
 new iz,ij,ij2,dfn,rows
"RTN","SAMIUR",234,0)
 set rows=0
"RTN","SAMIUR",235,0)
 set (iz,ij,ij2,dfn)=""
"RTN","SAMIUR",236,0)
 for  do  quit:iz=""  ;
"RTN","SAMIUR",237,0)
 . set iz=$order(SRT(iz))
"RTN","SAMIUR",238,0)
 . quit:iz=""
"RTN","SAMIUR",239,0)
 . set ij=$order(SRT(iz,""))
"RTN","SAMIUR",240,0)
 . set dfn=$order(SRT(iz,ij,""))
"RTN","SAMIUR",241,0)
 . do  ;
"RTN","SAMIUR",242,0)
 . . set cnt=cnt+1 set SAMIRTN(cnt)="<tr>"
"RTN","SAMIUR",243,0)
 . . set ir=""
"RTN","SAMIUR",244,0)
 . . for  do  quit:ir=""  ;
"RTN","SAMIUR",245,0)
 . . . set ir=$order(RPT(ir))
"RTN","SAMIUR",246,0)
 . . . quit:ir=""
"RTN","SAMIUR",247,0)
 . . . set cnt=cnt+1
"RTN","SAMIUR",248,0)
 . . . new XR,XRV
"RTN","SAMIUR",249,0)
 . . . ; set XR=$get(RPT(ir,"routine"))_"("_ij_",.SAMIPATS)"
"RTN","SAMIUR",250,0)
 . . . i $get(RPT(ir,"routine"))="" d  q
"RTN","SAMIUR",251,0)
 . . . . set SAMIRTN(cnt)="<td></td>"
"RTN","SAMIUR",252,0)
 . . . set XR="set XRV="_$get(RPT(ir,"routine"))_"("_ij_","_dfn_",.SAMIPATS)"
"RTN","SAMIUR",253,0)
 . . . ; set XRV=@XR
"RTN","SAMIUR",254,0)
 . . . xecute XR ; call report-field handlers in ^SAMIUR2
"RTN","SAMIUR",255,0)
 . . . if $extract(XRV,1,3)["<td" set SAMIRTN(cnt)=XRV
"RTN","SAMIUR",256,0)
 . . . else  set SAMIRTN(cnt)="<td>"_$get(XRV)_"</td>"
"RTN","SAMIUR",257,0)
 . . . quit
"RTN","SAMIUR",258,0)
 . . ;
"RTN","SAMIUR",259,0)
 . . set cnt=cnt+1
"RTN","SAMIUR",260,0)
 . . set SAMIRTN(cnt)="</tr>"_$CHAR(10,13)
"RTN","SAMIUR",261,0)
 . . set rows=rows+1
"RTN","SAMIUR",262,0)
 . . quit
"RTN","SAMIUR",263,0)
 . quit
"RTN","SAMIUR",264,0)
 ;
"RTN","SAMIUR",265,0)
 set cnt=cnt+1
"RTN","SAMIUR",266,0)
 ;set SAMIRTN(cnt)="<tr><td>Total: "_rows_"</td></tr>"
"RTN","SAMIUR",267,0)
 ;set SAMIRTN(totcnt)="<td>Total: "_rows_"</td></tr><tr>"
"RTN","SAMIUR",268,0)
 ;
"RTN","SAMIUR",269,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="</tbody>"
"RTN","SAMIUR",270,0)
 for  do  quit:temp(ii)["</tbody>"  ;
"RTN","SAMIUR",271,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",272,0)
 . quit:temp(ii)["</tbody>"
"RTN","SAMIUR",273,0)
 . ; skip past template headers & blank body
"RTN","SAMIUR",274,0)
 . quit
"RTN","SAMIUR",275,0)
 ;
"RTN","SAMIUR",276,0)
 for  do  quit:'ii  ;
"RTN","SAMIUR",277,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",278,0)
 . quit:'ii
"RTN","SAMIUR",279,0)
 . set cnt=cnt+1
"RTN","SAMIUR",280,0)
 . set ln=$get(temp(ii))
"RTN","SAMIUR",281,0)
 . new samikey,si
"RTN","SAMIUR",282,0)
 . set (samikey,si)=""
"RTN","SAMIUR",283,0)
 . do LOAD^SAMIFORM(.ln,samikey,si,.filter)
"RTN","SAMIUR",284,0)
 . set SAMIRTN(cnt)=ln
"RTN","SAMIUR",285,0)
 . quit
"RTN","SAMIUR",286,0)
 ;
"RTN","SAMIUR",287,0)
 quit  ; end of WSREPORT^SAMIUR
"RTN","SAMIUR",288,0)
 ;
"RTN","SAMIUR",289,0)
 ;
"RTN","SAMIUR",290,0)
 ;
"RTN","SAMIUR",291,0)
 ;
"RTN","SAMIUR",292,0)
 ;@proc-code SORT^SAMIUR
"RTN","SAMIUR",293,0)
 ;
"RTN","SAMIUR",294,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUR",295,0)
 ;
"RTN","SAMIUR",296,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIUR",297,0)
 ;@called-by
"RTN","SAMIUR",298,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR",299,0)
 ;@calls
"RTN","SAMIUR",300,0)
 ; $$UPCASE^XLFMSMT
"RTN","SAMIUR",301,0)
 ; $$LDOC^SAMIUR2
"RTN","SAMIUR",302,0)
 ; $$FMDT^SAMIUR2
"RTN","SAMIUR",303,0)
 ;@input
"RTN","SAMIUR",304,0)
 ; SRTN =
"RTN","SAMIUR",305,0)
 ; SAMIPATS =
"RTN","SAMIUR",306,0)
 ; FILTER =
"RTN","SAMIUR",307,0)
 ;@output [tbd]
"RTN","SAMIUR",308,0)
 ;@tests [tbd]
"RTN","SAMIUR",309,0)
 ;
"RTN","SAMIUR",310,0)
 ;
"RTN","SAMIUR",311,0)
SORT(SRTN,SAMIPATS,FILTER) ; sort patients by name
"RTN","SAMIUR",312,0)
 ;
"RTN","SAMIUR",313,0)
 ;@stanza 2 init vars
"RTN","SAMIUR",314,0)
 ;
"RTN","SAMIUR",315,0)
 new typ set typ=$get(FILTER("sort"))
"RTN","SAMIUR",316,0)
 if typ="" set typ="name"
"RTN","SAMIUR",317,0)
 ;
"RTN","SAMIUR",318,0)
 new iz,dt,dfn,nm,cdate
"RTN","SAMIUR",319,0)
 set (dt,dfn,nm)="" ; note: should dfn be initialized inside loop?
"RTN","SAMIUR",320,0)
 set iz=0
"RTN","SAMIUR",321,0)
 ;
"RTN","SAMIUR",322,0)
 ;
"RTN","SAMIUR",323,0)
 ;@stanza 3 ??
"RTN","SAMIUR",324,0)
 ;
"RTN","SAMIUR",325,0)
 new indx
"RTN","SAMIUR",326,0)
 for  do  quit:'dt  ;
"RTN","SAMIUR",327,0)
 . set dt=$order(SAMIPATS(dt))
"RTN","SAMIUR",328,0)
 . quit:'dt
"RTN","SAMIUR",329,0)
 . ; note: dfn not re-initialized to "" here; should it be?
"RTN","SAMIUR",330,0)
 . for  do  quit:'dfn  ;
"RTN","SAMIUR",331,0)
 . . set dfn=$order(SAMIPATS(dt,dfn))
"RTN","SAMIUR",332,0)
 . . quit:'dfn
"RTN","SAMIUR",333,0)
 . . if typ="name" do  ;
"RTN","SAMIUR",334,0)
 . . . set nm=$get(SAMIPATS(dt,dfn,"name"))
"RTN","SAMIUR",335,0)
 . . . set nm=$$UPCASE^XLFMSMT(nm)
"RTN","SAMIUR",336,0)
 . . . if nm="" set nm=" "
"RTN","SAMIUR",337,0)
 . . . set indx(nm,dt,dfn)=""
"RTN","SAMIUR",338,0)
 . . . quit
"RTN","SAMIUR",339,0)
 . . if typ="cdate" do  ;
"RTN","SAMIUR",340,0)
 . . . set cdate=$$LDOC^SAMIUR2(dt,dfn,.SAMIPATS)
"RTN","SAMIUR",341,0)
 . . . set cdate=$$FMDT^SAMIUR2(cdate)
"RTN","SAMIUR",342,0)
 . . . set indx(cdate,dt,dfn)=""
"RTN","SAMIUR",343,0)
 . . quit
"RTN","SAMIUR",344,0)
 . quit
"RTN","SAMIUR",345,0)
 ;
"RTN","SAMIUR",346,0)
 ;
"RTN","SAMIUR",347,0)
 ;@stanza 4 ??
"RTN","SAMIUR",348,0)
 ;
"RTN","SAMIUR",349,0)
 new iiz set iiz=""
"RTN","SAMIUR",350,0)
 set (dt,dfn)="" ; note: here, too, should inits be inside loops?
"RTN","SAMIUR",351,0)
 for  do  quit:iiz=""  ;
"RTN","SAMIUR",352,0)
 . set iiz=$order(indx(iiz))
"RTN","SAMIUR",353,0)
 . quit:iiz=""
"RTN","SAMIUR",354,0)
 . for  do  quit:dt=""  ;
"RTN","SAMIUR",355,0)
 . . set dt=$order(indx(iiz,dt))
"RTN","SAMIUR",356,0)
 . . quit:dt=""
"RTN","SAMIUR",357,0)
 . . for  do  quit:dfn=""  ;
"RTN","SAMIUR",358,0)
 . . . set dfn=$order(indx(iiz,dt,dfn))
"RTN","SAMIUR",359,0)
 . . . quit:dfn=""
"RTN","SAMIUR",360,0)
 . . . set iz=iz+1
"RTN","SAMIUR",361,0)
 . . . set SRTN(iz,dt,dfn)=iiz
"RTN","SAMIUR",362,0)
 . . . quit
"RTN","SAMIUR",363,0)
 . . quit
"RTN","SAMIUR",364,0)
 . quit
"RTN","SAMIUR",365,0)
 ;
"RTN","SAMIUR",366,0)
 ;@stanza 5 termination
"RTN","SAMIUR",367,0)
 ;
"RTN","SAMIUR",368,0)
 quit  ; end of SORT^SAMIUR
"RTN","SAMIUR",369,0)
 ;
"RTN","SAMIUR",370,0)
 ;
"RTN","SAMIUR",371,0)
 ;
"RTN","SAMIUR",372,0)
 ;
"RTN","SAMIUR",373,0)
 ;@proc-code NUHREF^SAMIUR
"RTN","SAMIUR",374,0)
 ;
"RTN","SAMIUR",375,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUR",376,0)
 ;
"RTN","SAMIUR",377,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIUR",378,0)
 ;@called-by
"RTN","SAMIUR",379,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR",380,0)
 ;@calls
"RTN","SAMIUR",381,0)
 ; $$setroot^%wd
"RTN","SAMIUR",382,0)
 ; $$GETSSN^SAMIFORM
"RTN","SAMIUR",383,0)
 ;@input
"RTN","SAMIUR",384,0)
 ; SAMIPATS =
"RTN","SAMIUR",385,0)
 ;@output [tbd]
"RTN","SAMIUR",386,0)
 ;@tests [tbd]
"RTN","SAMIUR",387,0)
 ;
"RTN","SAMIUR",388,0)
 ;
"RTN","SAMIUR",389,0)
NUHREF(SAMIPATS) ; create nuhref link to casereview for all patients
"RTN","SAMIUR",390,0)
 ;
"RTN","SAMIUR",391,0)
 ;@stanza 2 create it
"RTN","SAMIUR",392,0)
 ;
"RTN","SAMIUR",393,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",394,0)
 ;
"RTN","SAMIUR",395,0)
 new ij set ij=0
"RTN","SAMIUR",396,0)
 for  do  quit:'ij  ;
"RTN","SAMIUR",397,0)
 . set ij=$order(SAMIPATS(ij))
"RTN","SAMIUR",398,0)
 . quit:'ij
"RTN","SAMIUR",399,0)
 . new ij2 set ij2=0
"RTN","SAMIUR",400,0)
 . for  do  quit:'ij2  ;
"RTN","SAMIUR",401,0)
 . . set ij2=$order(SAMIPATS(ij,ij2))
"RTN","SAMIUR",402,0)
 . . quit:'ij2
"RTN","SAMIUR",403,0)
 . . ;
"RTN","SAMIUR",404,0)
 . . new dfn set dfn=ij2
"RTN","SAMIUR",405,0)
 . . set SAMIPATS(ij,dfn,"sid")=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR",406,0)
 . . set SAMIPATS(ij,dfn,"name")=$get(@root@(dfn,"saminame"))
"RTN","SAMIUR",407,0)
 . . ;
"RTN","SAMIUR",408,0)
 . . new sid set sid=SAMIPATS(ij,dfn,"sid")
"RTN","SAMIUR",409,0)
 . . set SAMIPATS(ij,dfn,"ssn")=$$GETSSN^SAMIFORM(sid)
"RTN","SAMIUR",410,0)
 . . new name set name=SAMIPATS(ij,dfn,"name")
"RTN","SAMIUR",411,0)
 . . ;
"RTN","SAMIUR",412,0)
 . . new nuhref
"RTN","SAMIUR",413,0)
 . . set nuhref="<td data-order="""_name_""" data-search="""_name_""">"
"RTN","SAMIUR",414,0)
 . . set nuhref=nuhref_"<form method=POST action=""/vapals"">"
"RTN","SAMIUR",415,0)
 . . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""casereview"">"
"RTN","SAMIUR",416,0)
 . . set nuhref=nuhref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMIUR",417,0)
 . . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",418,0)
 . . set nuhref=nuhref_"</td>"
"RTN","SAMIUR",419,0)
 . . set SAMIPATS(ij,dfn,"nuhref")=nuhref
"RTN","SAMIUR",420,0)
 . . quit
"RTN","SAMIUR",421,0)
 . quit
"RTN","SAMIUR",422,0)
 ;
"RTN","SAMIUR",423,0)
 ;@stanza 3 termination
"RTN","SAMIUR",424,0)
 ;
"RTN","SAMIUR",425,0)
 quit  ; end of NUHREF^SAMIUR
"RTN","SAMIUR",426,0)
 ;
"RTN","SAMIUR",427,0)
 ;
"RTN","SAMIUR",428,0)
 ;
"RTN","SAMIUR",429,0)
 ;
"RTN","SAMIUR",430,0)
 ;@func-code PNAME^SAMIUR
"RTN","SAMIUR",431,0)
 ;
"RTN","SAMIUR",432,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUR",433,0)
 ;
"RTN","SAMIUR",434,0)
 ;ven/gpl;private;function;clean?;silent;sac?;??% tests;port?
"RTN","SAMIUR",435,0)
 ;@called-by
"RTN","SAMIUR",436,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR",437,0)
 ;@calls none
"RTN","SAMIUR",438,0)
 ;@input
"RTN","SAMIUR",439,0)
 ; type =
"RTN","SAMIUR",440,0)
 ; phrase =
"RTN","SAMIUR",441,0)
 ;@output [tbd]
"RTN","SAMIUR",442,0)
 ;@tests
"RTN","SAMIUR",443,0)
 ; UTPNAME^SAMIUTUR
"RTN","SAMIUR",444,0)
 ;
"RTN","SAMIUR",445,0)
 ;
"RTN","SAMIUR",446,0)
PNAME(type,phrase) ; page name for report
"RTN","SAMIUR",447,0)
 ;
"RTN","SAMIUR",448,0)
 ;@stanza 2 return page name if recognized
"RTN","SAMIUR",449,0)
 ;
"RTN","SAMIUR",450,0)
 ; extrinsic returns the PAGE NAME for the report
"RTN","SAMIUR",451,0)
 ;
"RTN","SAMIUR",452,0)
 ; if type="followup" quit "Participant Followup next 30 days -"_$get(phrase)
"RTN","SAMIUR",453,0)
 if type="followup" quit "Participant Followup "_$get(phrase)
"RTN","SAMIUR",454,0)
 ; if type="activity" quit "Activity last 30 days -"_$get(phrase)
"RTN","SAMIUR",455,0)
 if type="activity" quit "Activity "_$get(phrase)
"RTN","SAMIUR",456,0)
 if type="missingct" quit "Intake but no CT Evaluation"_$get(phrase)
"RTN","SAMIUR",457,0)
 if type="incomplete" quit "Incomplete Forms"_$get(phrase)
"RTN","SAMIUR",458,0)
 if type="outreach" quit "Outreach"_$get(phrase)
"RTN","SAMIUR",459,0)
 if type="enrollment" quit "Enrollment"_$get(phrase)
"RTN","SAMIUR",460,0)
 if type="inactive" quit "Inactive"_$get(phrase)
"RTN","SAMIUR",461,0)
 ;
"RTN","SAMIUR",462,0)
 ;@stanza 3 return empty if not recognized
"RTN","SAMIUR",463,0)
 ;
"RTN","SAMIUR",464,0)
 quit "" ; end of $$PNAME^SAMIUR
"RTN","SAMIUR",465,0)
 ;
"RTN","SAMIUR",466,0)
 ;
"RTN","SAMIUR",467,0)
 ;
"RTN","SAMIUR",468,0)
 ;
"RTN","SAMIUR",469,0)
 ;@section 2 select subroutines
"RTN","SAMIUR",470,0)
 ;
"RTN","SAMIUR",471,0)
 ;
"RTN","SAMIUR",472,0)
 ;
"RTN","SAMIUR",473,0)
 ;
"RTN","SAMIUR",474,0)
 ;@proc-code SELECT^SAMIUR
"RTN","SAMIUR",475,0)
 ;
"RTN","SAMIUR",476,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUR",477,0)
 ;
"RTN","SAMIUR",478,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIUR",479,0)
 ;@called-by
"RTN","SAMIUR",480,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR",481,0)
 ;@calls
"RTN","SAMIUR",482,0)
 ; RECOMEND^SAMIUR
"RTN","SAMIUR",483,0)
 ; UNMAT^SAMIUR
"RTN","SAMIUR",484,0)
 ; WKLIST^SAMIUR
"RTN","SAMIUR",485,0)
 ; $$KEY2FM^SAMICASE [commented out]
"RTN","SAMIUR",486,0)
 ; $$FMDT^SAMIUR2
"RTN","SAMIUR",487,0)
 ; $$NOW^XLFDT
"RTN","SAMIUR",488,0)
 ; $$FMADD^XLFDT
"RTN","SAMIUR",489,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMIUR",490,0)
 ; $$setroot^%wd
"RTN","SAMIUR",491,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIUR",492,0)
 ; $$BASELNDT^SAMICAS4
"RTN","SAMIUR",493,0)
 ;@input
"RTN","SAMIUR",494,0)
 ; SAMIPATS =
"RTN","SAMIUR",495,0)
 ; ztype =
"RTN","SAMIUR",496,0)
 ; datephrase =
"RTN","SAMIUR",497,0)
 ; filter =
"RTN","SAMIUR",498,0)
 ;@output [tbd]
"RTN","SAMIUR",499,0)
 ;@tests
"RTN","SAMIUR",500,0)
 ; UTSELCT^SAMIUTUR
"RTN","SAMIUR",501,0)
 ;
"RTN","SAMIUR",502,0)
 ;
"RTN","SAMIUR",503,0)
SELECT(SAMIPATS,ztype,datephrase,filter) ; select patients for report
"RTN","SAMIUR",504,0)
 ;
"RTN","SAMIUR",505,0)
 ; merge ^gpl("select")=filter
"RTN","SAMIUR",506,0)
 new type set type=ztype
"RTN","SAMIUR",507,0)
 if type="recommend" do  quit  ;
"RTN","SAMIUR",508,0)
 . do RECOMEND^SAMIUR(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",509,0)
 . quit
"RTN","SAMIUR",510,0)
 if type="unmatched" do  quit  ;
"RTN","SAMIUR",511,0)
 . do UNMAT^SAMIUR(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",512,0)
 . quit
"RTN","SAMIUR",513,0)
 if type="worklist" do  quit  ;
"RTN","SAMIUR",514,0)
 . do WKLIST^SAMIUR(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",515,0)
 . quit
"RTN","SAMIUR",516,0)
 if $get(type)="" set type="enrollment"
"RTN","SAMIUR",517,0)
 if type="cumpy" set type="enrollment"
"RTN","SAMIUR",518,0)
 new site set site=$get(filter("siteid"))
"RTN","SAMIUR",519,0)
 ;
"RTN","SAMIUR",520,0)
 new strdt,enddt,fmstrdt,fmenddt
"RTN","SAMIUR",521,0)
 set strdt=$get(filter("start-date"))
"RTN","SAMIUR",522,0)
 ;set fmstrdt=$$KEY2FM^SAMICASE(strdt)
"RTN","SAMIUR",523,0)
 set fmstrdt=$$FMDT^SAMIUR2(strdt)
"RTN","SAMIUR",524,0)
 if fmstrdt=-1 do  ;
"RTN","SAMIUR",525,0)
 . set fmstrdt=2000101
"RTN","SAMIUR",526,0)
 . if type="followup" set fmstrdt=$$NOW^XLFDT
"RTN","SAMIUR",527,0)
 . if type="activity" set fmstrdt=$$FMADD^XLFDT($$NOW^XLFDT,-31)
"RTN","SAMIUR",528,0)
 . quit
"RTN","SAMIUR",529,0)
 if strdt="" set filter("start-date")=$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",530,0)
 ;
"RTN","SAMIUR",531,0)
 set enddt=$get(filter("end-date"))
"RTN","SAMIUR",532,0)
 ;set fmenddt=$$KEY2FM^SAMICASE(enddt)
"RTN","SAMIUR",533,0)
 set fmenddt=$$FMDT^SAMIUR2(enddt)
"RTN","SAMIUR",534,0)
 if fmenddt=-1 do  ;
"RTN","SAMIUR",535,0)
 . set fmenddt=$$NOW^XLFDT
"RTN","SAMIUR",536,0)
 . if type="followup" set fmenddt=$$FMADD^XLFDT($$NOW^XLFDT,31)
"RTN","SAMIUR",537,0)
 . quit
"RTN","SAMIUR",538,0)
 if enddt="" set filter("end-date")=$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",539,0)
 ;
"RTN","SAMIUR",540,0)
 set datephrase=""
"RTN","SAMIUR",541,0)
 new zi set zi=0
"RTN","SAMIUR",542,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",543,0)
 ;
"RTN","SAMIUR",544,0)
 for  do  quit:'zi  ;
"RTN","SAMIUR",545,0)
 . set zi=$order(@root@(zi))
"RTN","SAMIUR",546,0)
 . quit:'zi
"RTN","SAMIUR",547,0)
 . ;
"RTN","SAMIUR",548,0)
 . new sid set sid=$get(@root@(zi,"samistudyid"))
"RTN","SAMIUR",549,0)
 . quit:sid=""
"RTN","SAMIUR",550,0)
 . quit:$extract(sid,1,3)'=site
"RTN","SAMIUR",551,0)
 . ;
"RTN","SAMIUR",552,0)
 . new items set items=""
"RTN","SAMIUR",553,0)
 . do GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR",554,0)
 . quit:'$data(items)
"RTN","SAMIUR",555,0)
 . ;
"RTN","SAMIUR",556,0)
 . new efmdate,edate,siform,ceform,cefud,fmcefud,cedos,fmcedos
"RTN","SAMIUR",557,0)
 . set siform=$order(items("siform-"))
"RTN","SAMIUR",558,0)
 . new status set status=$get(@root@("graph",sid,siform,"sistatus"))
"RTN","SAMIUR",559,0)
 . if type="inactive",status="active" quit  ; for inactive report
"RTN","SAMIUR",560,0)
 . ;if type'="inactive",status'="active" quit  ; for other reports
"RTN","SAMIUR",561,0)
 . if type'="inactive",type'="activity",type'="enrollment",status'="active" quit  ;other rpts
"RTN","SAMIUR",562,0)
 . new eligible set eligible=$get(@root@("graph",sid,siform,"sicechrt"))
"RTN","SAMIUR",563,0)
 . if type="enrollment",eligible'="y" quit  ; must be eligible
"RTN","SAMIUR",564,0)
 . new enrolled set enrolled=$g(@root@("graph",sid,siform,"sildct"))
"RTN","SAMIUR",565,0)
 . if type="enrollment",enrolled'="y" quit  ; must be enrolled
"RTN","SAMIUR",566,0)
 . ;
"RTN","SAMIUR",567,0)
 . set (ceform,cefud,fmcefud,cedos,fmcedos)=""
"RTN","SAMIUR",568,0)
 . new lastce,sifm,cefm,baseline
"RTN","SAMIUR",569,0)
 . set (lastce,sifm,cefm,baseline)=""
"RTN","SAMIUR",570,0)
 . set sifm=$$FMDT^SAMIUR2($p(siform,"siform-",2))
"RTN","SAMIUR",571,0)
 . ;f  set ceform=$order(items(ceform),-1) q:ceform=""  q:cefud'=""  d  ;
"RTN","SAMIUR",572,0)
 . ;f  set ceform=$order(items(ceform),-1) q:ceform=""  d  ;
"RTN","SAMIUR",573,0)
 . ;. q:ceform'["form"
"RTN","SAMIUR",574,0)
 . ;. if ceform["ceform" if lastce="" set lastce=ceform
"RTN","SAMIUR",575,0)
 . ;. set cefud=$get(@root@("graph",sid,ceform,"cefud"))
"RTN","SAMIUR",576,0)
 . ;. if cefud'="" set fmcefud=$$FMDT^SAMIUR2(cefud)
"RTN","SAMIUR",577,0)
 . ;. set cedos=$get(@root@("graph",sid,ceform,"cedos"))
"RTN","SAMIUR",578,0)
 . ;. if cedos'="" set fmcedos=$$FMDT^SAMIUR2(cedos)
"RTN","SAMIUR",579,0)
 . ;. quit
"RTN","SAMIUR",580,0)
 . ;if $$FMDT^SAMIUR2($p(lastce,"ceform-",2))<sifm set lastce=""
"RTN","SAMIUR",581,0)
 . ;
"RTN","SAMIUR",582,0)
 . set baseline=$$BASELNDT^SAMICAS4(sid)
"RTN","SAMIUR",583,0)
 . set edate=$get(@root@("graph",sid,siform,"sidc"))
"RTN","SAMIUR",584,0)
 . if edate="" set edate=$get(@root@("graph",sid,siform,"samicreatedate"))
"RTN","SAMIUR",585,0)
 . set efmdate=$$FMDT^SAMIUR2(edate)
"RTN","SAMIUR",586,0)
 . set edate=$$VAPALSDT^SAMICASE(efmdate)
"RTN","SAMIUR",587,0)
 . ;
"RTN","SAMIUR",588,0)
 . new latef,latefdt set (latef,latefdt)="" ; latest form for activity report
"RTN","SAMIUR",589,0)
 . new aform,aformdt set (aform,aformdt)=""
"RTN","SAMIUR",590,0)
 . new anyform set anyform=""
"RTN","SAMIUR",591,0)
 . new proot set proot=$na(@root@("graph",sid))
"RTN","SAMIUR",592,0)
 . ;for  set anyform=$order(items("sort",anyform),-1) q:aform'=""  q:anyform=""  d  ;
"RTN","SAMIUR",593,0)
 . for  set anyform=$order(items("sort",anyform),-1) q:anyform=""  d  ;
"RTN","SAMIUR",594,0)
 . . new tempf set tempf=""
"RTN","SAMIUR",595,0)
 . . ;f  set tempf=$order(items("sort",anyform,tempf)) q:tempf=""  q:aform'=""  d  ;
"RTN","SAMIUR",596,0)
 . . f  set tempf=$order(items("sort",anyform,tempf)) q:tempf=""  d  ;
"RTN","SAMIUR",597,0)
 . . . if latef="" d  ; record the latest form for activity report
"RTN","SAMIUR",598,0)
 . . . . set latefdt=anyform ; date of latest form
"RTN","SAMIUR",599,0)
 . . . . new latekey set latekey=$order(items("sort",anyform,tempf,""))
"RTN","SAMIUR",600,0)
 . . . . set latef=$order(items("sort",anyform,tempf,latekey,""))
"RTN","SAMIUR",601,0)
 . . . if lastce="" d  ; if looking for latest ct eval
"RTN","SAMIUR",602,0)
 . . . . if tempf'["ceform" q  ; this is not a ceform
"RTN","SAMIUR",603,0)
 . . . . set lastce=$order(items("sort",anyform,tempf,""))
"RTN","SAMIUR",604,0)
 . . . . if anyform<sifm set lastce="" ; doesn't count - before enrollment
"RTN","SAMIUR",605,0)
 . . . ;if tempf["bxform" q  ; don't want any biopsy forms
"RTN","SAMIUR",606,0)
 . . . new tempk set tempk=$order(items("sort",anyform,tempf,""))
"RTN","SAMIUR",607,0)
 . . . ;if $g(@proot@(tempk,"cefud"))="" q  ; no followup date
"RTN","SAMIUR",608,0)
 . . . new tempt set tempt=$order(items("sort",anyform,tempf,tempk,""))
"RTN","SAMIUR",609,0)
 . . . if cefud="" d  ;
"RTN","SAMIUR",610,0)
 . . . . if $g(@proot@(tempk,"cefud"))="" q  ; no followup date
"RTN","SAMIUR",611,0)
 . . . . set cefud=$g(@proot@(tempk,"cefud"))
"RTN","SAMIUR",612,0)
 . . . . set fmcefud=$$FMDT^SAMIUR2(cefud)
"RTN","SAMIUR",613,0)
 . . . . set ceform=tempk
"RTN","SAMIUR",614,0)
 . . . if aform="" d  ;
"RTN","SAMIUR",615,0)
 . . . . set aform=tempt
"RTN","SAMIUR",616,0)
 . . . . set aformdt=anyform
"RTN","SAMIUR",617,0)
 . ;
"RTN","SAMIUR",618,0)
 . if type="followup" do  ;
"RTN","SAMIUR",619,0)
 . . ; new nplus30 set nplus30=$$FMADD^XLFDT($$NOW^XLFDT,31)
"RTN","SAMIUR",620,0)
 . . if +fmcefud<fmstrdt quit  ; before start date
"RTN","SAMIUR",621,0)
 . . if +fmcefud<(fmenddt+1) do  ; before end date
"RTN","SAMIUR",622,0)
 . . . quit:cefud=""  ; no followup date
"RTN","SAMIUR",623,0)
 . . . set SAMIPATS(fmcefud,zi,"aform")=aform
"RTN","SAMIUR",624,0)
 . . . ;set SAMIPATS(fmcefud,zi,"aform")=latef
"RTN","SAMIUR",625,0)
 . . . set SAMIPATS(fmcefud,zi,"aformdt")=aformdt
"RTN","SAMIUR",626,0)
 . . . ;set SAMIPATS(fmcefud,zi,"aformdt")=latefdt
"RTN","SAMIUR",627,0)
 . . . set SAMIPATS(fmcefud,zi,"edate")=edate
"RTN","SAMIUR",628,0)
 . . . set SAMIPATS(fmcefud,zi,"baseline")=baseline
"RTN","SAMIUR",629,0)
 . . . set SAMIPATS(fmcefud,zi)=""
"RTN","SAMIUR",630,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",631,0)
 . . . set SAMIPATS(fmcefud,zi,"cefud")=cefud
"RTN","SAMIUR",632,0)
 . . . set SAMIPATS(fmcefud,zi,"cedos")=cedos
"RTN","SAMIUR",633,0)
 . . . set SAMIPATS(fmcefud,zi,"ceform")=ceform
"RTN","SAMIUR",634,0)
 . . . set SAMIPATS(fmcefud,zi,"ceform-vals")=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR",635,0)
 . . . set SAMIPATS(fmcefud,zi,"siform")=siform
"RTN","SAMIUR",636,0)
 . . . set SAMIPATS(fmcefud,zi,"siform-vals")=$name(@root@("graph",sid,siform))
"RTN","SAMIUR",637,0)
 . . . merge SAMIPATS(fmcefud,zi,"items")=items
"RTN","SAMIUR",638,0)
 . . . quit
"RTN","SAMIUR",639,0)
 . . set datephrase=" before "_$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",640,0)
 . . quit
"RTN","SAMIUR",641,0)
 . ;
"RTN","SAMIUR",642,0)
 . if type="activity" do  ;
"RTN","SAMIUR",643,0)
 . . new fmanyform set fmanyform=$$FMDT^SAMIUR2(latefdt)
"RTN","SAMIUR",644,0)
 . . if fmanyform<fmstrdt quit  ; before the start date
"RTN","SAMIUR",645,0)
 . . ; if fmanyform<(fmenddt+1)!(efmdate>fmenddt) do  ; need any new form
"RTN","SAMIUR",646,0)
 . . if fmanyform<(fmenddt+1)  do  ;
"RTN","SAMIUR",647,0)
 . . . set SAMIPATS(efmdate,zi,"aform")=latef
"RTN","SAMIUR",648,0)
 . . . set SAMIPATS(efmdate,zi,"aformdt")=$$VAPALSDT^SAMICASE(fmanyform)
"RTN","SAMIUR",649,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",650,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",651,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",652,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",653,0)
 . . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",654,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",655,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",656,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",657,0)
 . . . quit
"RTN","SAMIUR",658,0)
 . . set datephrase=" after "_$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",659,0)
 . . quit
"RTN","SAMIUR",660,0)
 . ;
"RTN","SAMIUR",661,0)
 . ; date filter for all the rest of the reports
"RTN","SAMIUR",662,0)
 . ;
"RTN","SAMIUR",663,0)
 . quit:efmdate<fmstrdt  ; before the start date
"RTN","SAMIUR",664,0)
 . quit:efmdate>(fmenddt+1)  ; after the end date
"RTN","SAMIUR",665,0)
 . ;
"RTN","SAMIUR",666,0)
 . if type="incomplete" do  ;
"RTN","SAMIUR",667,0)
 . . new complete set complete=1
"RTN","SAMIUR",668,0)
 . . new zj set zj=""
"RTN","SAMIUR",669,0)
 . . new gr set gr=$name(@root@("graph",sid))
"RTN","SAMIUR",670,0)
 . . for  do  quit:zj=""  ;
"RTN","SAMIUR",671,0)
 . . . set zj=$order(@gr@(zj))
"RTN","SAMIUR",672,0)
 . . . quit:zj=""
"RTN","SAMIUR",673,0)
 . . . ;
"RTN","SAMIUR",674,0)
 . . . new stat
"RTN","SAMIUR",675,0)
 . . . set stat=$get(@gr@(zj,"samistatus"))
"RTN","SAMIUR",676,0)
 . . . if stat="" set stat="incomplete"
"RTN","SAMIUR",677,0)
 . . . if stat="incomplete" do  ;
"RTN","SAMIUR",678,0)
 . . . . set complete=0
"RTN","SAMIUR",679,0)
 . . . . set SAMIPATS(efmdate,zi,"iform")=$get(SAMIPATS(efmdate,zi,"iform"))_" "_zj
"RTN","SAMIUR",680,0)
 . . . . quit
"RTN","SAMIUR",681,0)
 . . . quit
"RTN","SAMIUR",682,0)
 . . ;
"RTN","SAMIUR",683,0)
 . . if complete=0 do  ; has incomplete form(s) 
"RTN","SAMIUR",684,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",685,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",686,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",687,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",688,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",689,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",690,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",691,0)
 . . . quit
"RTN","SAMIUR",692,0)
 . . set datephrase=""
"RTN","SAMIUR",693,0)
 . . quit
"RTN","SAMIUR",694,0)
 . ;
"RTN","SAMIUR",695,0)
 . if type="missingct" do  ;
"RTN","SAMIUR",696,0)
 . . if lastce="" do  ; has no ct since enrollment 
"RTN","SAMIUR",697,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",698,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",699,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",700,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",701,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",702,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",703,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",704,0)
 . . . quit
"RTN","SAMIUR",705,0)
 . . set datephrase=""
"RTN","SAMIUR",706,0)
 . . quit
"RTN","SAMIUR",707,0)
 . ;
"RTN","SAMIUR",708,0)
 . if type="outreach" do  ; no-op; hook for future development?
"RTN","SAMIUR",709,0)
 . . quit
"RTN","SAMIUR",710,0)
 . ;
"RTN","SAMIUR",711,0)
 . if type="enrollment" do  ;
"RTN","SAMIUR",712,0)
 . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",713,0)
 . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",714,0)
 . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",715,0)
 . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",716,0)
 . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",717,0)
 . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",718,0)
 . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",719,0)
 . . quit
"RTN","SAMIUR",720,0)
 . ;
"RTN","SAMIUR",721,0)
 . if type="inactive" do  ;
"RTN","SAMIUR",722,0)
 . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",723,0)
 . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",724,0)
 . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",725,0)
 . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",726,0)
 . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",727,0)
 . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",728,0)
 . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",729,0)
 . . quit
"RTN","SAMIUR",730,0)
 . ;
"RTN","SAMIUR",731,0)
 . set datephrase=" as of "_$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMIUR",732,0)
 . quit
"RTN","SAMIUR",733,0)
 ;
"RTN","SAMIUR",734,0)
 quit  ; end of SELECT^SAMIUR
"RTN","SAMIUR",735,0)
 ;
"RTN","SAMIUR",736,0)
 ;
"RTN","SAMIUR",737,0)
 ;
"RTN","SAMIUR",738,0)
 ;
"RTN","SAMIUR",739,0)
 ;@proc-code UNMAT^SAMIUR
"RTN","SAMIUR",740,0)
 ;
"RTN","SAMIUR",741,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUR",742,0)
 ;
"RTN","SAMIUR",743,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIUR",744,0)
 ;@called-by
"RTN","SAMIUR",745,0)
 ; SELECT^SAMIUR
"RTN","SAMIUR",746,0)
 ;@calls
"RTN","SAMIUR",747,0)
 ; $$setroot^%wd
"RTN","SAMIUR",748,0)
 ; ^ZTER
"RTN","SAMIUR",749,0)
 ;@input
"RTN","SAMIUR",750,0)
 ; SAMIPATS =
"RTN","SAMIUR",751,0)
 ; ztype =
"RTN","SAMIUR",752,0)
 ; datephrase =
"RTN","SAMIUR",753,0)
 ; filter =
"RTN","SAMIUR",754,0)
 ;@output [tbd]
"RTN","SAMIUR",755,0)
 ;@tests [tbd]
"RTN","SAMIUR",756,0)
 ;
"RTN","SAMIUR",757,0)
 ;
"RTN","SAMIUR",758,0)
UNMAT(SAMIPATS,ztype,datephrase,filter) ; build unmatched persons list
"RTN","SAMIUR",759,0)
 ;
"RTN","SAMIUR",760,0)
 set datephrase="Unmatched Persons"
"RTN","SAMIUR",761,0)
 new ERR ; k ^gpl("ERR")
"RTN","SAMIUR",762,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",763,0)
 new dfn set dfn=9000000
"RTN","SAMIUR",764,0)
 for  do  quit:'dfn  ;
"RTN","SAMIUR",765,0)
 . set dfn=$order(@lroot@("dfn",dfn))
"RTN","SAMIUR",766,0)
 . quit:'dfn
"RTN","SAMIUR",767,0)
 . ;
"RTN","SAMIUR",768,0)
 . new ien set ien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",769,0)
 . quit:ien=""
"RTN","SAMIUR",770,0)
 . i $g(@lroot@(ien,"dfn"))'=dfn d  q  ;
"RTN","SAMIUR",771,0)
 . . s ERR(dfn)="dfn index error"
"RTN","SAMIUR",772,0)
 . . ; m ^gpl("ERR",dfn)=@lroot@(ien)
"RTN","SAMIUR",773,0)
 . . q
"RTN","SAMIUR",774,0)
 . n ordern
"RTN","SAMIUR",775,0)
 . s ordern=$g(@lroot@(ien,"ORMORCordernumber"))
"RTN","SAMIUR",776,0)
 . i ordern="" s ordern=$g(@lroot@(ien,"ORM",1,"ordernumber"))
"RTN","SAMIUR",777,0)
 . i ordern'="" q  ;
"RTN","SAMIUR",778,0)
 . i $g(@lroot@(ien,"siteid"))'[site q  ;
"RTN","SAMIUR",779,0)
 . ;quit:$get(@lroot@(ien,"remotedfn"))'=""  ;
"RTN","SAMIUR",780,0)
 . ;
"RTN","SAMIUR",781,0)
 . merge SAMIPATS(ien,dfn)=@lroot@(ien)
"RTN","SAMIUR",782,0)
 . ;
"RTN","SAMIUR",783,0)
 . new name set name=$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR",784,0)
 . ; new name set name=$get(SAMIPATS(ien,dfn,"sinamef"))
"RTN","SAMIUR",785,0)
 . ; set name=name_","_SAMIPATS(ien,dfn,"sinamel")
"RTN","SAMIUR",786,0)
 . new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR",787,0)
 . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""editperson"">"
"RTN","SAMIUR",788,0)
 . set nuhref=nuhref_"<input type=hidden name=""dfn"" value="_dfn_">"
"RTN","SAMIUR",789,0)
 . set nuhref=nuhref_"<input type=hidden name=""siteid"" value="_site_">"
"RTN","SAMIUR",790,0)
 . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",791,0)
 . set SAMIPATS(ien,dfn,"editref")=nuhref
"RTN","SAMIUR",792,0)
 . quit
"RTN","SAMIUR",793,0)
 ;
"RTN","SAMIUR",794,0)
 i $d(ERR) d ^ZTER
"RTN","SAMIUR",795,0)
 ;
"RTN","SAMIUR",796,0)
 quit  ; end of UNMAT^SAMIUR
"RTN","SAMIUR",797,0)
 ;
"RTN","SAMIUR",798,0)
 ;
"RTN","SAMIUR",799,0)
 ;
"RTN","SAMIUR",800,0)
 ;
"RTN","SAMIUR",801,0)
 ;@proc-code RECOMEND^SAMIUR
"RTN","SAMIUR",802,0)
 ;
"RTN","SAMIUR",803,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUR",804,0)
 ;
"RTN","SAMIUR",805,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIUR",806,0)
 ;@called-by
"RTN","SAMIUR",807,0)
 ; SELECT^SAMIUR
"RTN","SAMIUR",808,0)
 ;@calls
"RTN","SAMIUR",809,0)
 ; $$KEY2FM^SAMICASE [commented out]
"RTN","SAMIUR",810,0)
 ; $$FMDT^SAMIUR2
"RTN","SAMIUR",811,0)
 ; $$NOW^XLFDT
"RTN","SAMIUR",812,0)
 ; $$FMADD^XLFDT
"RTN","SAMIUR",813,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMIUR",814,0)
 ; $$setroot^%wd
"RTN","SAMIUR",815,0)
 ; CEFORMS^SAMIUR
"RTN","SAMIUR",816,0)
 ; ^ZTER
"RTN","SAMIUR",817,0)
 ;@input
"RTN","SAMIUR",818,0)
 ; SAMIPATS =
"RTN","SAMIUR",819,0)
 ; ztype =
"RTN","SAMIUR",820,0)
 ; datephrase =
"RTN","SAMIUR",821,0)
 ; filter =
"RTN","SAMIUR",822,0)
 ;@output [tbd]
"RTN","SAMIUR",823,0)
 ;@tests [tbd]
"RTN","SAMIUR",824,0)
 ;
"RTN","SAMIUR",825,0)
 ;
"RTN","SAMIUR",826,0)
RECOMEND(SAMIPATS,ztype,datephrase,filter) ; recommendations persons
"RTN","SAMIUR",827,0)
 ;
"RTN","SAMIUR",828,0)
 ; build recommendations persons list on entry for every ceform in
"RTN","SAMIUR",829,0)
 ; date range
"RTN","SAMIUR",830,0)
 ;
"RTN","SAMIUR",831,0)
 new strdt,enddt,fmstrdt,fmenddt
"RTN","SAMIUR",832,0)
 set strdt=$get(filter("start-date"))
"RTN","SAMIUR",833,0)
 ;set fmstrdt=$$KEY2FM^SAMICASE(strdt)
"RTN","SAMIUR",834,0)
 set fmstrdt=$$FMDT^SAMIUR2(strdt)
"RTN","SAMIUR",835,0)
 if fmstrdt=-1 do  ;
"RTN","SAMIUR",836,0)
 . set fmstrdt=2000101
"RTN","SAMIUR",837,0)
 . if type="followup" set fmstrdt=$$NOW^XLFDT
"RTN","SAMIUR",838,0)
 . if type="activity" set fmstrdt=$$FMADD^XLFDT($$NOW^XLFDT,-31)
"RTN","SAMIUR",839,0)
 . quit
"RTN","SAMIUR",840,0)
 if strdt="" set filter("start-date")=$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",841,0)
 ;
"RTN","SAMIUR",842,0)
 set enddt=$get(filter("end-date"))
"RTN","SAMIUR",843,0)
 ;set fmenddt=$$KEY2FM^SAMICASE(enddt)
"RTN","SAMIUR",844,0)
 set fmenddt=$$FMDT^SAMIUR2(enddt)
"RTN","SAMIUR",845,0)
 if fmenddt=-1 do  ;
"RTN","SAMIUR",846,0)
 . set fmenddt=$$NOW^XLFDT
"RTN","SAMIUR",847,0)
 . q
"RTN","SAMIUR",848,0)
 if enddt="" set filter("end-date")=$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",849,0)
 ;
"RTN","SAMIUR",850,0)
 set datephrase="CT Eval Recommendations"
"RTN","SAMIUR",851,0)
 new ERR ; k ^gpl("ERR")
"RTN","SAMIUR",852,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",853,0)
 new dfn set dfn=0
"RTN","SAMIUR",854,0)
 for  do  quit:'dfn  ;
"RTN","SAMIUR",855,0)
 . set dfn=$order(@lroot@("dfn",dfn))
"RTN","SAMIUR",856,0)
 . quit:'dfn
"RTN","SAMIUR",857,0)
 . ;
"RTN","SAMIUR",858,0)
 . new ien set ien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",859,0)
 . quit:ien=""
"RTN","SAMIUR",860,0)
 . i $g(@lroot@(ien,"dfn"))'=dfn d  q  ;
"RTN","SAMIUR",861,0)
 . . s ERR(dfn)="dfn index error"
"RTN","SAMIUR",862,0)
 . . ; m ^gpl("ERR",dfn)=@lroot@(ien)
"RTN","SAMIUR",863,0)
 . . q
"RTN","SAMIUR",864,0)
 . ;
"RTN","SAMIUR",865,0)
 . i $g(@lroot@(ien,"siteid"))'[site q  ;
"RTN","SAMIUR",866,0)
 . ;
"RTN","SAMIUR",867,0)
 . n ceforms
"RTN","SAMIUR",868,0)
 . d CEFORMS^SAMIUR(.ceforms,dfn,fmstrdt,fmenddt)
"RTN","SAMIUR",869,0)
 . n cefdt s cefdt=""
"RTN","SAMIUR",870,0)
 . f  s cefdt=$o(ceforms(cefdt)) q:+cefdt=0  d  ;
"RTN","SAMIUR",871,0)
 . . n efmdate
"RTN","SAMIUR",872,0)
 . . set efmdate=$$FMDT^SAMIUR2(cefdt)
"RTN","SAMIUR",873,0)
 . . merge SAMIPATS(efmdate,dfn)=@lroot@(ien)
"RTN","SAMIUR",874,0)
 . . merge SAMIPATS(efmdate,dfn)=ceforms(cefdt)
"RTN","SAMIUR",875,0)
 . . q
"RTN","SAMIUR",876,0)
 . n rc s rc=""
"RTN","SAMIUR",877,0)
 . f  set rc=$o(ceforms("count",rc)) q:rc=""  d  ;
"RTN","SAMIUR",878,0)
 . . set SAMIPATS("rcount",rc)=$g(SAMIPATS("rcount",rc))+ceforms("count",rc)
"RTN","SAMIUR",879,0)
 . . set SAMIPATS("pcount",rc)=$g(SAMIPATS("pcount",rc))+1
"RTN","SAMIUR",880,0)
 . . q
"RTN","SAMIUR",881,0)
 . q
"RTN","SAMIUR",882,0)
 . ;
"RTN","SAMIUR",883,0)
 ;
"RTN","SAMIUR",884,0)
 i $d(ERR) d ^ZTER
"RTN","SAMIUR",885,0)
 ;
"RTN","SAMIUR",886,0)
 quit  ; end of RECOMEND^SAMIUR
"RTN","SAMIUR",887,0)
 ;
"RTN","SAMIUR",888,0)
 ;
"RTN","SAMIUR",889,0)
 ;
"RTN","SAMIUR",890,0)
 ;
"RTN","SAMIUR",891,0)
 ;@proc-code CEFORMS^SAMIUR
"RTN","SAMIUR",892,0)
 ;
"RTN","SAMIUR",893,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUR",894,0)
 ;
"RTN","SAMIUR",895,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIUR",896,0)
 ;@called-by
"RTN","SAMIUR",897,0)
 ; RECOMEND^SAMIUR
"RTN","SAMIUR",898,0)
 ;@calls
"RTN","SAMIUR",899,0)
 ; $$setroot^%wd
"RTN","SAMIUR",900,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIUR",901,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMIUR",902,0)
 ; $$FMDT^SAMIUR2
"RTN","SAMIUR",903,0)
 ;@input
"RTN","SAMIUR",904,0)
 ; ARY =
"RTN","SAMIUR",905,0)
 ; DFN =
"RTN","SAMIUR",906,0)
 ; BEGDATE =
"RTN","SAMIUR",907,0)
 ; ENDDATE =
"RTN","SAMIUR",908,0)
 ;@output [tbd]
"RTN","SAMIUR",909,0)
 ;@tests [tbd]
"RTN","SAMIUR",910,0)
 ;
"RTN","SAMIUR",911,0)
 ;
"RTN","SAMIUR",912,0)
CEFORMS(ARY,DFN,BEGDATE,ENDDATE) ; patient ce forms
"RTN","SAMIUR",913,0)
 ;
"RTN","SAMIUR",914,0)
 ; all ceforms for patient dfn in date range
"RTN","SAMIUR",915,0)
 ;
"RTN","SAMIUR",916,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",917,0)
 n sid
"RTN","SAMIUR",918,0)
 s sid=$g(@root@(DFN,"sisid"))
"RTN","SAMIUR",919,0)
 q:sid=""
"RTN","SAMIUR",920,0)
 new groot set groot=$name(@root@("graph",sid))
"RTN","SAMIUR",921,0)
 new items set items=""
"RTN","SAMIUR",922,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR",923,0)
 quit:'$data(items) ""
"RTN","SAMIUR",924,0)
 ;
"RTN","SAMIUR",925,0)
 new bdate set bdate=""
"RTN","SAMIUR",926,0)
 new bkey set bkey=""
"RTN","SAMIUR",927,0)
 new bfmdate
"RTN","SAMIUR",928,0)
 for  set bkey=$order(items("type","vapals:ceform",bkey)) quit:bkey=""  do  ;
"RTN","SAMIUR",929,0)
 . set bdate=$piece(bkey,"ceform-",2)
"RTN","SAMIUR",930,0)
 . set bdate=$$KEY2DSPD^SAMICAS2(bdate)
"RTN","SAMIUR",931,0)
 . set bfmdate=$$FMDT^SAMIUR2(bdate)
"RTN","SAMIUR",932,0)
 . quit:bfmdate<BEGDATE  ; before the start date
"RTN","SAMIUR",933,0)
 . quit:bfmdate>(ENDDATE+1)  ; after the end date
"RTN","SAMIUR",934,0)
 . n zt
"RTN","SAMIUR",935,0)
 . f zt="af","cc","pe","fn","br","pc","tb" d  ;
"RTN","SAMIUR",936,0)
 . . n y
"RTN","SAMIUR",937,0)
 . . set y=$g(@groot@(bkey,"cefu"_zt))
"RTN","SAMIUR",938,0)
 . . set ARY(bdate,"cefu"_zt)=y
"RTN","SAMIUR",939,0)
 . . i y="y" set ARY("count","cefu"_zt)=$g(ARY("count","cefu"_zt))+1
"RTN","SAMIUR",940,0)
 ;
"RTN","SAMIUR",941,0)
 quit  ; end of CEFORMS
"RTN","SAMIUR",942,0)
 ;
"RTN","SAMIUR",943,0)
 ;
"RTN","SAMIUR",944,0)
 ;
"RTN","SAMIUR",945,0)
 ;
"RTN","SAMIUR",946,0)
 ; stray code:
"RTN","SAMIUR",947,0)
 ;
"RTN","SAMIUR",948,0)
 do
"RTN","SAMIUR",949,0)
 . set ARY(bdate)=""
"RTN","SAMIUR",950,0)
 . set ARY(bdate,"key")=bkey
"RTN","SAMIUR",951,0)
 . set ARY(bdate,"cefuaf")=$g(@groot@(bkey,"cefuaf"))
"RTN","SAMIUR",952,0)
 . set ARY(bdate,"cefucc")=$g(@groot@(bkey,"cefucc"))
"RTN","SAMIUR",953,0)
 . set ARY(bdate,"cefupe")=$g(@groot@(bkey,"cefupe"))
"RTN","SAMIUR",954,0)
 . set ARY(bdate,"cefufn")=$g(@groot@(bkey,"cefufn"))
"RTN","SAMIUR",955,0)
 . set ARY(bdate,"cefubr")=$g(@groot@(bkey,"cefubr"))
"RTN","SAMIUR",956,0)
 . set ARY(bdate,"cefupc")=$g(@groot@(bkey,"cefupc"))
"RTN","SAMIUR",957,0)
 . set ARY(bdate,"cefutb")=$g(@groot@(bkey,"cefutb"))
"RTN","SAMIUR",958,0)
 ;
"RTN","SAMIUR",959,0)
 q
"RTN","SAMIUR",960,0)
 ;
"RTN","SAMIUR",961,0)
 ;
"RTN","SAMIUR",962,0)
 ;
"RTN","SAMIUR",963,0)
 ;
"RTN","SAMIUR",964,0)
 ;@proc-code WKLIST^SAMIUR
"RTN","SAMIUR",965,0)
 ;
"RTN","SAMIUR",966,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUR",967,0)
 ;
"RTN","SAMIUR",968,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIUR",969,0)
 ;@called-by
"RTN","SAMIUR",970,0)
 ; SELECT^SAMIUR
"RTN","SAMIUR",971,0)
 ;@calls
"RTN","SAMIUR",972,0)
 ; $$setroot^%wd
"RTN","SAMIUR",973,0)
 ; ^ZTER [commented out]
"RTN","SAMIUR",974,0)
 ;@input
"RTN","SAMIUR",975,0)
 ; SAMIPATS =
"RTN","SAMIUR",976,0)
 ; ztype =
"RTN","SAMIUR",977,0)
 ; datephrase =
"RTN","SAMIUR",978,0)
 ; filter =
"RTN","SAMIUR",979,0)
 ;@output [tbd]
"RTN","SAMIUR",980,0)
 ;@tests [tbd]
"RTN","SAMIUR",981,0)
 ;
"RTN","SAMIUR",982,0)
 ;
"RTN","SAMIUR",983,0)
WKLIST(SAMIPATS,ztype,datephrase,filter) ; build work list
"RTN","SAMIUR",984,0)
 ;
"RTN","SAMIUR",985,0)
 ; add site
"RTN","SAMIUR",986,0)
 ; add compare to vapals-patients
"RTN","SAMIUR",987,0)
 ; add navigation to enrollment
"RTN","SAMIUR",988,0)
 ;
"RTN","SAMIUR",989,0)
 ; kill ^gpl("worklist")
"RTN","SAMIUR",990,0)
 ; merge ^gpl("worklist")=filter
"RTN","SAMIUR",991,0)
 new site
"RTN","SAMIUR",992,0)
 set site=$get(filter("siteid"))
"RTN","SAMIUR",993,0)
 quit:site=""
"RTN","SAMIUR",994,0)
 set datephrase="Work List"
"RTN","SAMIUR",995,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",996,0)
 new proot set proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",997,0)
 ;
"RTN","SAMIUR",998,0)
 new dfn set dfn=0
"RTN","SAMIUR",999,0)
 for  set dfn=$order(@lroot@("dfn",dfn)) quit:+dfn=0  do  ;
"RTN","SAMIUR",1000,0)
 . quit:$order(@proot@("dfn",dfn,""))'=""
"RTN","SAMIUR",1001,0)
 . new ien set ien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",1002,0)
 . quit:ien=""
"RTN","SAMIUR",1003,0)
 . i $g(@lroot@(ien,"dfn"))'=dfn d  q  ;
"RTN","SAMIUR",1004,0)
 . . s ERR="dfn index error in patient-lookup dfn="_dfn
"RTN","SAMIUR",1005,0)
 . . ;D ^ZTER
"RTN","SAMIUR",1006,0)
 . ;
"RTN","SAMIUR",1007,0)
 . ; write !,"dfn= ",dfn
"RTN","SAMIUR",1008,0)
 . ; zwrite @lroot@(ien,*)
"RTN","SAMIUR",1009,0)
 . ;
"RTN","SAMIUR",1010,0)
 . quit:$get(@lroot@(ien,"siteid"))'=site
"RTN","SAMIUR",1011,0)
 . ;
"RTN","SAMIUR",1012,0)
 . ; merge ^gpl("worklist","lroot",ien)=@lroot@(ien)
"RTN","SAMIUR",1013,0)
 . merge SAMIPATS(ien,dfn)=@lroot@(ien)
"RTN","SAMIUR",1014,0)
 . ;zwr SAMIPATS
"RTN","SAMIUR",1015,0)
 . ;i dfn=9000166 B
"RTN","SAMIUR",1016,0)
 . ;i dfn=9000136 B
"RTN","SAMIUR",1017,0)
 . new name set name=$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR",1018,0)
 . ; new name set name=$get(SAMIPATS(ien,dfn,"sinamef"))
"RTN","SAMIUR",1019,0)
 . ; set name=name_","_SAMIPATS(ien,dfn,"sinamel")
"RTN","SAMIUR",1020,0)
 . new nuhref
"RTN","SAMIUR",1021,0)
 . set nuhref="<td data-search="""_name_""" data-order="""_name_""">"
"RTN","SAMIUR",1022,0)
 . set nuhref=nuhref_"<form method=POST action=""/vapals"">"
"RTN","SAMIUR",1023,0)
 . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""newcase"">"
"RTN","SAMIUR",1024,0)
 . set nuhref=nuhref_"<input type=hidden name=""dfn"" value="_dfn_">"
"RTN","SAMIUR",1025,0)
 . set nuhref=nuhref_"<input type=hidden name=""siteid"" value="_site_">"
"RTN","SAMIUR",1026,0)
 . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",1027,0)
 . set nuhref=nuhref_"</td>"
"RTN","SAMIUR",1028,0)
 . set SAMIPATS(ien,dfn,"workref")=nuhref
"RTN","SAMIUR",1029,0)
 . quit
"RTN","SAMIUR",1030,0)
 ;
"RTN","SAMIUR",1031,0)
 ; merge ^gpl("worklist","pats")=SAMIPATS
"RTN","SAMIUR",1032,0)
 ;
"RTN","SAMIUR",1033,0)
 quit  ; end of WKLIST^SAMIUR
"RTN","SAMIUR",1034,0)
 ;
"RTN","SAMIUR",1035,0)
 ;
"RTN","SAMIUR",1036,0)
 ;
"RTN","SAMIUR",1037,0)
EOR ; end of SAMIUR
"RTN","SAMIUR2")
0^5^B1536139436
"RTN","SAMIUR2",1,0)
SAMIUR2 ;ven/gpl - user reports cont; 2024-08-22t21:20z
"RTN","SAMIUR2",2,0)
 ;;18.0;SAMI;**5,11,12,14,15,17**;2020-01-17;Build 8
"RTN","SAMIUR2",3,0)
 ;mdc-e1;SAMIUR2-20240822-E018QO7h;SAMI-18-17-b6
"RTN","SAMIUR2",4,0)
 ;mdc-v7;B1536139436;SAMI*18.0*17 SEQ #17
"RTN","SAMIUR2",5,0)
 ;
"RTN","SAMIUR2",6,0)
 ; SAMIUR2 contains subroutines for creating & implementing the
"RTN","SAMIUR2",7,0)
 ; report-definition table.
"RTN","SAMIUR2",8,0)
 ;
"RTN","SAMIUR2",9,0)
 quit  ; no entry from top
"RTN","SAMIUR2",10,0)
 ;
"RTN","SAMIUR2",11,0)
 ;
"RTN","SAMIUR2",12,0)
 ;
"RTN","SAMIUR2",13,0)
 ;
"RTN","SAMIUR2",14,0)
 ;@section 0 primary development
"RTN","SAMIUR2",15,0)
 ;
"RTN","SAMIUR2",16,0)
 ;
"RTN","SAMIUR2",17,0)
 ;
"RTN","SAMIUR2",18,0)
 ;
"RTN","SAMIUR2",19,0)
 ;@routine-credits
"RTN","SAMIUR2",20,0)
 ;
"RTN","SAMIUR2",21,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIUR2",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUR2",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIUR2",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIUR2",25,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIUR2",26,0)
 ;@license see routine SAMIUL
"RTN","SAMIUR2",27,0)
 ;
"RTN","SAMIUR2",28,0)
 ;@update 2024-08-22t21:20z
"RTN","SAMIUR2",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIUR2",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIUR2",31,0)
 ;@module User Reports - SAMIUR
"RTN","SAMIUR2",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUR2",33,0)
 ;@release 18-17
"RTN","SAMIUR2",34,0)
 ;@edition-date 2021-01-17
"RTN","SAMIUR2",35,0)
 ;@patches **5,11,12,14,15,17**
"RTN","SAMIUR2",36,0)
 ;
"RTN","SAMIUR2",37,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIUR2",38,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUR2",39,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIUR2",40,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIUR2",41,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIUR2",42,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIUR2",43,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIUR2",44,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIUR2",45,0)
 ;
"RTN","SAMIUR2",46,0)
 ;@module-credits see SAMIURUL
"RTN","SAMIUR2",47,0)
 ;
"RTN","SAMIUR2",48,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUR2",49,0)
 ; see SAMIURUL
"RTN","SAMIUR2",50,0)
 ;
"RTN","SAMIUR2",51,0)
 ;@contents
"RTN","SAMIUR2",52,0)
 ;
"RTN","SAMIUR2",53,0)
 ; RPTTBL build report-definition table
"RTN","SAMIUR2",54,0)
 ;
"RTN","SAMIUR2",55,0)
 ; $$DFN2SID study id for patient DFN
"RTN","SAMIUR2",56,0)
 ; $$MKNAV html for navigation to form
"RTN","SAMIUR2",57,0)
 ;
"RTN","SAMIUR2",58,0)
 ; $$SHDET table contents for smoking history
"RTN","SAMIUR2",59,0)
 ; CUMPY forms array of cummulative pack year data
"RTN","SAMIUR2",60,0)
 ; $$TDDT embed date in table cell
"RTN","SAMIUR2",61,0)
 ; $$FMDT convert date to fileman format
"RTN","SAMIUR2",62,0)
 ; $$PKYDT pack-years from start & end & cigs/day
"RTN","SAMIUR2",63,0)
 ; $$PKY pack-years from years & packs/day
"RTN","SAMIUR2",64,0)
 ;
"RTN","SAMIUR2",65,0)
 ; $$AGE age
"RTN","SAMIUR2",66,0)
 ; $$BLINEDT baseline date
"RTN","SAMIUR2",67,0)
 ; $$CONTACT patient street address
"RTN","SAMIUR2",68,0)
 ; $$CTPROT ct protocol
"RTN","SAMIUR2",69,0)
 ; $$DOB date of birth
"RTN","SAMIUR2",70,0)
 ; $$FUDATE followup date
"RTN","SAMIUR2",71,0)
 ; $$GENDER gender
"RTN","SAMIUR2",72,0)
 ; $$IFORM name(s) of incomplete forms
"RTN","SAMIUR2",73,0)
 ; $$LASTEXM patient last exam
"RTN","SAMIUR2",74,0)
 ; $$MANPAT unmatched patient cell
"RTN","SAMIUR2",75,0)
 ; $$MATCH match button cell
"RTN","SAMIUR2",76,0)
 ; $$NAME name w/hyperlink
"RTN","SAMIUR2",77,0)
 ; $$PACKYRS smoking status
"RTN","SAMIUR2",78,0)
 ; $$POSSIBLE possible match cell
"RTN","SAMIUR2",79,0)
 ; $$RECOM recommendation
"RTN","SAMIUR2",80,0)
 ; $$RURAL patient's rural/urban status
"RTN","SAMIUR2",81,0)
 ; $$SID study id
"RTN","SAMIUR2",82,0)
 ; $$SMHIS smoking history cell
"RTN","SAMIUR2",83,0)
 ; $$SMKSTAT smoking status
"RTN","SAMIUR2",84,0)
 ; $$SSN social security number
"RTN","SAMIUR2",85,0)
 ; $$STUDYDT latest study date
"RTN","SAMIUR2",86,0)
 ; $$STUDYTYP latest study type
"RTN","SAMIUR2",87,0)
 ; $$VALS form-values cell
"RTN","SAMIUR2",88,0)
 ; $$WHEN followup text
"RTN","SAMIUR2",89,0)
 ; $$WORKPAT worklist patient name cell
"RTN","SAMIUR2",90,0)
 ;
"RTN","SAMIUR2",91,0)
 ; EPAT patient name w/nav to enrollment
"RTN","SAMIUR2",92,0)
 ; ETHNCTY ethnicity
"RTN","SAMIUR2",93,0)
 ; RACE race
"RTN","SAMIUR2",94,0)
 ; STATUS patient status
"RTN","SAMIUR2",95,0)
 ; WSVALS display form values from graph
"RTN","SAMIUR2",96,0)
 ;
"RTN","SAMIUR2",97,0)
 ;
"RTN","SAMIUR2",98,0)
 ;
"RTN","SAMIUR2",99,0)
 ;
"RTN","SAMIUR2",100,0)
 ;@section 1 ppi RPTTBL^SAMIUR2
"RTN","SAMIUR2",101,0)
 ;
"RTN","SAMIUR2",102,0)
 ;
"RTN","SAMIUR2",103,0)
 ;
"RTN","SAMIUR2",104,0)
 ;
"RTN","SAMIUR2",105,0)
RPTTBL(RPT,TYPE,SITE) ; RPT is passed by reference and returns the 
"RTN","SAMIUR2",106,0)
 ; report definition table. TYPE is the report type to be returned
"RTN","SAMIUR2",107,0)
 ; This routine could use a file or a graph in the next version
"RTN","SAMIUR2",108,0)
 ;
"RTN","SAMIUR2",109,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIUR2",110,0)
 ;@called-by
"RTN","SAMIUR2",111,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",112,0)
 ; WSREPORT^SAMIUR1 (which then calls WSREPORT^SAMIUR)
"RTN","SAMIUR2",113,0)
 ;@calls none (defines calls for WSREPORT^SAMIUR to call)
"RTN","SAMIUR2",114,0)
 ;@input
"RTN","SAMIUR2",115,0)
 ; TYPE = report type to return
"RTN","SAMIUR2",116,0)
 ;@output
"RTN","SAMIUR2",117,0)
 ; .RPT report-definition table
"RTN","SAMIUR2",118,0)
 ;
"RTN","SAMIUR2",119,0)
 ; This routine could use a file or a graph in the next version
"RTN","SAMIUR2",120,0)
 ;
"RTN","SAMIUR2",121,0)
 if TYPE="followup" do  quit  ;
"RTN","SAMIUR2",122,0)
 . set RPT(1,"header")="F/U Date"
"RTN","SAMIUR2",123,0)
 . set RPT(1,"routine")="$$FUDATE^SAMIUR2"
"RTN","SAMIUR2",124,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",125,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",126,0)
 . ;set RPT(3,"header")="SSN"
"RTN","SAMIUR2",127,0)
 . set RPT(3,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",128,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",129,0)
 . set RPT(4,"header")="Baseline Date"
"RTN","SAMIUR2",130,0)
 . set RPT(4,"routine")="$$BLINEDT^SAMIUR2"
"RTN","SAMIUR2",131,0)
 . set RPT(5,"header")="Last Form"
"RTN","SAMIUR2",132,0)
 . set RPT(5,"routine")="$$AFORM^SAMIUR2"
"RTN","SAMIUR2",133,0)
 . set RPT(6,"header")="Form Date"
"RTN","SAMIUR2",134,0)
 . set RPT(6,"routine")="$$AFORMDT^SAMIUR2"
"RTN","SAMIUR2",135,0)
 . set RPT(7,"header")="Recommend"
"RTN","SAMIUR2",136,0)
 . set RPT(7,"routine")="$$RECOM^SAMIUR2"
"RTN","SAMIUR2",137,0)
 . set RPT(8,"header")="Contact Information"
"RTN","SAMIUR2",138,0)
 . set RPT(8,"routine")="$$CONTACT^SAMIUR2"
"RTN","SAMIUR2",139,0)
 . quit
"RTN","SAMIUR2",140,0)
 ;
"RTN","SAMIUR2",141,0)
 if TYPE="activity" do  quit  ;
"RTN","SAMIUR2",142,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",143,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",144,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",145,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",146,0)
 . set RPT(2.2,"header")="Active/Inactive"
"RTN","SAMIUR2",147,0)
 . set RPT(2.2,"routine")="$$ACTIVE^SAMIUR2"
"RTN","SAMIUR2",148,0)
 . set RPT(2.5,"header")="Form"
"RTN","SAMIUR2",149,0)
 . set RPT(2.5,"routine")="$$AFORM^SAMIUR2"
"RTN","SAMIUR2",150,0)
 . set RPT(3,"header")="Form Date"
"RTN","SAMIUR2",151,0)
 . ;set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",152,0)
 . set RPT(3,"routine")="$$AFORMDT^SAMIUR2"
"RTN","SAMIUR2",153,0)
 . ;set RPT(4,"header")="Type"
"RTN","SAMIUR2",154,0)
 . ;set RPT(4,"routine")="$$STUDYTYP^SAMIUR2"
"RTN","SAMIUR2",155,0)
 . ;set RPT(5,"header")="CT Protocol"
"RTN","SAMIUR2",156,0)
 . ;set RPT(5,"routine")="$$CTPROT^SAMIUR2"
"RTN","SAMIUR2",157,0)
 . set RPT(6,"header")="Follow-up"
"RTN","SAMIUR2",158,0)
 . set RPT(6,"routine")="$$RECOM^SAMIUR2"
"RTN","SAMIUR2",159,0)
 . ;set RPT(7,"header")="When"
"RTN","SAMIUR2",160,0)
 . ;set RPT(7,"routine")="$$WHEN^SAMIUR2"
"RTN","SAMIUR2",161,0)
 . set RPT(8,"header")="on Date"
"RTN","SAMIUR2",162,0)
 . set RPT(8,"routine")="$$FUDATE^SAMIUR2"
"RTN","SAMIUR2",163,0)
 . quit
"RTN","SAMIUR2",164,0)
 ;
"RTN","SAMIUR2",165,0)
 if TYPE="enrollment" do  quit  ;
"RTN","SAMIUR2",166,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",167,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",168,0)
 . set RPT(1.5,"header")="Active/Inactive"
"RTN","SAMIUR2",169,0)
 . set RPT(1.5,"routine")="$$ACTIVE^SAMIUR2"
"RTN","SAMIUR2",170,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",171,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",172,0)
 . set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",173,0)
 . set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",174,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",175,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",176,0)
 . ; set RPT(5,"header")="Race"
"RTN","SAMIUR2",177,0)
 . ; set RPT(5,"routine")="$$RACE^SAMIUR2"
"RTN","SAMIUR2",178,0)
 . set RPT(6,"header")="Age"
"RTN","SAMIUR2",179,0)
 . set RPT(6,"routine")="$$AGE^SAMIUR2"
"RTN","SAMIUR2",180,0)
 . d  ;
"RTN","SAMIUR2",181,0)
 . . n filter s filter("siteid")=SITE
"RTN","SAMIUR2",182,0)
 . . i $$ISVA^SAMIPARM(.filter) d  ;
"RTN","SAMIUR2",183,0)
 . . . set RPT(7,"header")="Urban/Rural"
"RTN","SAMIUR2",184,0)
 . . . set RPT(7,"routine")="$$RURAL^SAMIUR2"
"RTN","SAMIUR2",185,0)
 . set RPT(8,"header")="Smoking Status"
"RTN","SAMIUR2",186,0)
 . set RPT(8,"routine")="$$SMKSTAT^SAMIUR2"
"RTN","SAMIUR2",187,0)
 . set RPT(9,"header")="Pack Years at Intake"
"RTN","SAMIUR2",188,0)
 . set RPT(9,"routine")="$$PACKYRS^SAMIUR2"
"RTN","SAMIUR2",189,0)
 . quit
"RTN","SAMIUR2",190,0)
 ;
"RTN","SAMIUR2",191,0)
 if TYPE="inactive" do  quit  ;
"RTN","SAMIUR2",192,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",193,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",194,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",195,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",196,0)
 . set RPT(3,"header")="Enrollment date"
"RTN","SAMIUR2",197,0)
 . set RPT(3,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",198,0)
 . ;set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",199,0)
 . ;set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",200,0)
 . ;set RPT(4,"header")="Gender"
"RTN","SAMIUR2",201,0)
 . ;set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",202,0)
 . ; set RPT(5,"header")="Race"
"RTN","SAMIUR2",203,0)
 . ; set RPT(5,"routine")="$$RACE^SAMIUR2"
"RTN","SAMIUR2",204,0)
 . ;set RPT(6,"header")="Age"
"RTN","SAMIUR2",205,0)
 . ;set RPT(6,"routine")="$$AGE^SAMIUR2"
"RTN","SAMIUR2",206,0)
 . set RPT(4,"header")="Date of Death"
"RTN","SAMIUR2",207,0)
 . set RPT(4,"routine")="$$INACTDT^SAMIUR2"
"RTN","SAMIUR2",208,0)
 . set RPT(5,"header")="Inactive Reason"
"RTN","SAMIUR2",209,0)
 . set RPT(5,"routine")="$$INACTRE^SAMIUR2"
"RTN","SAMIUR2",210,0)
 . set RPT(6,"header")="Inactive Comment"
"RTN","SAMIUR2",211,0)
 . set RPT(6,"routine")="$$INACTCM^SAMIUR2"
"RTN","SAMIUR2",212,0)
 . ;set RPT(7,"header")="Urban/Rural"
"RTN","SAMIUR2",213,0)
 . ;set RPT(7,"routine")="$$RURAL^SAMIUR2"
"RTN","SAMIUR2",214,0)
 . ;set RPT(8,"header")="Smoking Status"
"RTN","SAMIUR2",215,0)
 . ;set RPT(8,"routine")="$$SMKSTAT^SAMIUR2"
"RTN","SAMIUR2",216,0)
 . ;set RPT(9,"header")="Pack Years at Intake"
"RTN","SAMIUR2",217,0)
 . ;set RPT(9,"routine")="$$PACKYRS^SAMIUR2"
"RTN","SAMIUR2",218,0)
 . quit
"RTN","SAMIUR2",219,0)
 ;
"RTN","SAMIUR2",220,0)
 if TYPE="incomplete" do  quit  ;
"RTN","SAMIUR2",221,0)
 . set RPT(1,"header")="Enrollment date"
"RTN","SAMIUR2",222,0)
 . set RPT(1,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",223,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",224,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",225,0)
 . set RPT(3,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",226,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",227,0)
 . set RPT(4,"header")="Incomplete form"
"RTN","SAMIUR2",228,0)
 . set RPT(4,"routine")="$$IFORM^SAMIUR2"
"RTN","SAMIUR2",229,0)
 . quit
"RTN","SAMIUR2",230,0)
 ;
"RTN","SAMIUR2",231,0)
 if TYPE="missingct" do  quit  ;
"RTN","SAMIUR2",232,0)
 . set RPT(1,"header")="Last contact date"
"RTN","SAMIUR2",233,0)
 . set RPT(1,"routine")="$$LDOC^SAMIUR2"
"RTN","SAMIUR2",234,0)
 . set RPT(2,"header")="Last contact entry"
"RTN","SAMIUR2",235,0)
 . set RPT(2,"routine")="$$LENTRY^SAMIUR2"
"RTN","SAMIUR2",236,0)
 . set RPT(3,"header")="Name"
"RTN","SAMIUR2",237,0)
 . set RPT(3,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",238,0)
 . set RPT(4,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",239,0)
 . set RPT(4,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",240,0)
 . set RPT(5,"header")="Enrollment date"
"RTN","SAMIUR2",241,0)
 . set RPT(5,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",242,0)
 . quit
"RTN","SAMIUR2",243,0)
 ;
"RTN","SAMIUR2",244,0)
 if TYPE="cumpy" do  quit  ;
"RTN","SAMIUR2",245,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",246,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",247,0)
 . set RPT(2,"header")="Study ID"
"RTN","SAMIUR2",248,0)
 . set RPT(2,"routine")="$$SID^SAMIUR2"
"RTN","SAMIUR2",249,0)
 . set RPT(3,"header")="Form Values"
"RTN","SAMIUR2",250,0)
 . set RPT(3,"routine")="$$VALS^SAMIUR2"
"RTN","SAMIUR2",251,0)
 . set RPT(4,"header")="Smoking History"
"RTN","SAMIUR2",252,0)
 . set RPT(4,"routine")="$$SMHIS^SAMIUR2"
"RTN","SAMIUR2",253,0)
 . quit
"RTN","SAMIUR2",254,0)
 ;
"RTN","SAMIUR2",255,0)
 if TYPE="unmatched" do  ;
"RTN","SAMIUR2",256,0)
 . set RPT(1,"header")="Unmatched Manual Entry"
"RTN","SAMIUR2",257,0)
 . set RPT(1,"routine")="$$MANPAT^SAMIUR2"
"RTN","SAMIUR2",258,0)
 . set RPT(2,"header")="Possible HL7 Match"
"RTN","SAMIUR2",259,0)
 . set RPT(2,"routine")="$$POSSIBLE^SAMIUR2"
"RTN","SAMIUR2",260,0)
 . set RPT(3,"header")="Match Control"
"RTN","SAMIUR2",261,0)
 . set RPT(3,"routine")="$$MATCH^SAMIUR2"
"RTN","SAMIUR2",262,0)
 . quit
"RTN","SAMIUR2",263,0)
 ;
"RTN","SAMIUR2",264,0)
 if TYPE="recommend" do  ;
"RTN","SAMIUR2",265,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",266,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",267,0)
 . ;set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",268,0)
 . ;set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",269,0)
 . set RPT(3,"header")="Last5"
"RTN","SAMIUR2",270,0)
 . set RPT(3,"routine")="$$LAST5^SAMIUR2"
"RTN","SAMIUR2",271,0)
 . set RPT(4,"header")="CT Eval Date"
"RTN","SAMIUR2",272,0)
 . set RPT(4,"routine")="$$ZDT^SAMIUR2"
"RTN","SAMIUR2",273,0)
 . set RPT(5,"header")="Antibiotics"_$$COUNTS("cefuaf")
"RTN","SAMIUR2",274,0)
 . set RPT(5,"routine")="$$RECANTI^SAMIUR2"
"RTN","SAMIUR2",275,0)
 . set RPT(6,"header")="Contrast CT"_$$COUNTS("cefucc")
"RTN","SAMIUR2",276,0)
 . set RPT(6,"routine")="$$RECCONT^SAMIUR2"
"RTN","SAMIUR2",277,0)
 . set RPT(7,"header")="PET"_$$COUNTS("cefupe")
"RTN","SAMIUR2",278,0)
 . set RPT(7,"routine")="$$RECPET^SAMIUR2"
"RTN","SAMIUR2",279,0)
 . ;set RPT(8,"header")="Percutaneous biopsy"
"RTN","SAMIUR2",280,0)
 . set RPT(8,"header")="Perc biopsy"_$$COUNTS("cefufn")
"RTN","SAMIUR2",281,0)
 . set RPT(8,"routine")="$$RECBIOP^SAMIUR2"
"RTN","SAMIUR2",282,0)
 . set RPT(9,"header")="Bronchoscopy"_$$COUNTS("cefubr")
"RTN","SAMIUR2",283,0)
 . set RPT(9,"routine")="$$RECBRONC^SAMIUR2"
"RTN","SAMIUR2",284,0)
 . ;set RPT(10,"header")="Pulmonary consultation"
"RTN","SAMIUR2",285,0)
 . set RPT(10,"header")="Pulm consult"_$$COUNTS("cefupc")
"RTN","SAMIUR2",286,0)
 . set RPT(10,"routine")="$$RECPULM^SAMIUR2"
"RTN","SAMIUR2",287,0)
 . ;set RPT(11,"header")="Refer to tumor board"
"RTN","SAMIUR2",288,0)
 . set RPT(11,"header")="Tumor board"_$$COUNTS("cefutb")
"RTN","SAMIUR2",289,0)
 . set RPT(11,"routine")="$$RECTUMOR^SAMIUR2"
"RTN","SAMIUR2",290,0)
 . ;set RPT(12,"header")="Other"
"RTN","SAMIUR2",291,0)
 . ;set RPT(12,"routine")=""
"RTN","SAMIUR2",292,0)
 . quit
"RTN","SAMIUR2",293,0)
 ;
"RTN","SAMIUR2",294,0)
 if TYPE="worklist" do  quit  ;
"RTN","SAMIUR2",295,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",296,0)
 . set RPT(1,"routine")="$$WORKPAT^SAMIUR2"
"RTN","SAMIUR2",297,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",298,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",299,0)
 . set RPT(3,"header")="Date of birth"
"RTN","SAMIUR2",300,0)
 . set RPT(3,"routine")="$$DOB^SAMIUR2"
"RTN","SAMIUR2",301,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",302,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",303,0)
 . quit
"RTN","SAMIUR2",304,0)
 ;
"RTN","SAMIUR2",305,0)
 quit  ; end of ppi RPTTBL^SAMIUR2
"RTN","SAMIUR2",306,0)
 ;
"RTN","SAMIUR2",307,0)
 ;
"RTN","SAMIUR2",308,0)
 ;
"RTN","SAMIUR2",309,0)
 ;@section 2 shared subroutines
"RTN","SAMIUR2",310,0)
 ;
"RTN","SAMIUR2",311,0)
 ;
"RTN","SAMIUR2",312,0)
 ;
"RTN","SAMIUR2",313,0)
DFN2SID(DFN) ;studyid for patient DFN
"RTN","SAMIUR2",314,0)
 ;
"RTN","SAMIUR2",315,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",316,0)
 ;@called-by
"RTN","SAMIUR2",317,0)
 ; $$SID^SAMIUR2
"RTN","SAMIUR2",318,0)
 ; $$IFORM^SAMIUR2
"RTN","SAMIUR2",319,0)
 ; $$VALS^SAMIUR2
"RTN","SAMIUR2",320,0)
 ; $$SMHIS^SAMIUR2
"RTN","SAMIUR2",321,0)
 ;@calls
"RTN","SAMIUR2",322,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",323,0)
 ;
"RTN","SAMIUR2",324,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",325,0)
 ;
"RTN","SAMIUR2",326,0)
 quit $get(@root@(DFN,"sisid")) ; end of $$DFN2SID
"RTN","SAMIUR2",327,0)
 ;
"RTN","SAMIUR2",328,0)
 ;
"RTN","SAMIUR2",329,0)
 ;
"RTN","SAMIUR2",330,0)
MKNAV(sid,zform,fname,form) ; html for navigation to form
"RTN","SAMIUR2",331,0)
 ;
"RTN","SAMIUR2",332,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",333,0)
 ;@called-by
"RTN","SAMIUR2",334,0)
 ; $$IFORM^SAMIUR2
"RTN","SAMIUR2",335,0)
 ;@calls none
"RTN","SAMIUR2",336,0)
 ;
"RTN","SAMIUR2",337,0)
 new rtn set rtn="<form method=""post"" action=""/vapals"">"
"RTN","SAMIUR2",338,0)
 set rtn=rtn_"<input name=""samiroute"" value=""form"" type=""hidden"">"
"RTN","SAMIUR2",339,0)
 set rtn=rtn_" <input name=""studyid"" value="""_sid_""" type=""hidden"">"
"RTN","SAMIUR2",340,0)
 set rtn=rtn_" <input name=""form"" value=""vapals:"_zform_""" type=""hidden"">"
"RTN","SAMIUR2",341,0)
 set rtn=rtn_" <input value="""_fname_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"_$char(13)
"RTN","SAMIUR2",342,0)
 ;
"RTN","SAMIUR2",343,0)
 quit rtn ; end of $$MKNAV
"RTN","SAMIUR2",344,0)
 ;
"RTN","SAMIUR2",345,0)
 ;
"RTN","SAMIUR2",346,0)
 ;
"RTN","SAMIUR2",347,0)
 ;@section 3 smoking history subroutines
"RTN","SAMIUR2",348,0)
 ;
"RTN","SAMIUR2",349,0)
 ;
"RTN","SAMIUR2",350,0)
 ;
"RTN","SAMIUR2",351,0)
SHDET(SID,KEY) ; table contents for smoking history
"RTN","SAMIUR2",352,0)
 ;
"RTN","SAMIUR2",353,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",354,0)
 ;@called-by
"RTN","SAMIUR2",355,0)
 ; LOAD^SAMIFLD
"RTN","SAMIUR2",356,0)
 ; $$SMHIS^SAMIUR2
"RTN","SAMIUR2",357,0)
 ;@calls
"RTN","SAMIUR2",358,0)
 ; CUMPY
"RTN","SAMIUR2",359,0)
 ;
"RTN","SAMIUR2",360,0)
 ; KEY is the form key of the caller for "current" marker insertion
"RTN","SAMIUR2",361,0)
 ;
"RTN","SAMIUR2",362,0)
 new pyary
"RTN","SAMIUR2",363,0)
 if $get(KEY)="" set KEY=""
"RTN","SAMIUR2",364,0)
 do CUMPY("pyary",SID,KEY)
"RTN","SAMIUR2",365,0)
 ;
"RTN","SAMIUR2",366,0)
 new current set current=$get(pyary("current"))
"RTN","SAMIUR2",367,0)
 new rptcnt set rptcnt=0
"RTN","SAMIUR2",368,0)
 new rptmax set rptmax=$order(pyary("rpt",""),-1)
"RTN","SAMIUR2",369,0)
 quit:+rptmax=0
"RTN","SAMIUR2",370,0)
 ;
"RTN","SAMIUR2",371,0)
 new return set return=""
"RTN","SAMIUR2",372,0)
 new zi set zi=""
"RTN","SAMIUR2",373,0)
 for zi=1:1:rptmax do  ;
"RTN","SAMIUR2",374,0)
 . set rptcnt=rptcnt+1
"RTN","SAMIUR2",375,0)
 . if rptcnt=current set return=return_"<tr data-current-form=""true"">"
"RTN","SAMIUR2",376,0)
 . else  set return=return_"<tr>"
"RTN","SAMIUR2",377,0)
 . set return=return_"<td>"_pyary("rpt",rptcnt,1)_"</td>"
"RTN","SAMIUR2",378,0)
 . set return=return_"<td class=""reported-date"">"_pyary("rpt",rptcnt,2)_"</td>"
"RTN","SAMIUR2",379,0)
 . set return=return_"<td class=""pack-years"">"_pyary("rpt",rptcnt,3)_"</td>"
"RTN","SAMIUR2",380,0)
 . set return=return_"<td class=""cumulative-pack-years"">"_pyary("rpt",rptcnt,4)_"</td>"
"RTN","SAMIUR2",381,0)
 . set return=return_"</tr>"
"RTN","SAMIUR2",382,0)
 . quit
"RTN","SAMIUR2",383,0)
 ;
"RTN","SAMIUR2",384,0)
 quit return ; end of ppi $$SHDET^SAMIUR2
"RTN","SAMIUR2",385,0)
 ;
"RTN","SAMIUR2",386,0)
 ;
"RTN","SAMIUR2",387,0)
 ;
"RTN","SAMIUR2",388,0)
CUMPY(PYARY,sid,KEY) ; forms array of cummulative pack year data
"RTN","SAMIUR2",389,0)
 ;
"RTN","SAMIUR2",390,0)
 ;;ppi;procedure;clean;silent;sac
"RTN","SAMIUR2",391,0)
 ;@called-by
"RTN","SAMIUR2",392,0)
 ; SSTATUS^SAMINOT2
"RTN","SAMIUR2",393,0)
 ; SSTATUS^SAMINOT3
"RTN","SAMIUR2",394,0)
 ; $$SHDET
"RTN","SAMIUR2",395,0)
 ;@calls
"RTN","SAMIUR2",396,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",397,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIUR2",398,0)
 ; $$GETDTKEY^SAMICAS2
"RTN","SAMIUR2",399,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMIUR2",400,0)
 ; $$FMDT
"RTN","SAMIUR2",401,0)
 ; $$PKYDT
"RTN","SAMIUR2",402,0)
 ;
"RTN","SAMIUR2",403,0)
 ; PYARY passed by name
"RTN","SAMIUR2",404,0)
 ; KEY is the current form key for matching to a row
"RTN","SAMIUR2",405,0)
 ;
"RTN","SAMIUR2",406,0)
 kill @PYARY
"RTN","SAMIUR2",407,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",408,0)
 ; new sid set sid=$get(@root@(DFN,"samistudyid"))
"RTN","SAMIUR2",409,0)
 ; quit:sid=""
"RTN","SAMIUR2",410,0)
 ;
"RTN","SAMIUR2",411,0)
 new items set items=""
"RTN","SAMIUR2",412,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR2",413,0)
 quit:'$data(items)
"RTN","SAMIUR2",414,0)
 merge @PYARY@("items")=items
"RTN","SAMIUR2",415,0)
 ;
"RTN","SAMIUR2",416,0)
 new siform set siform=$order(items("siform"))
"RTN","SAMIUR2",417,0)
 quit:siform=""
"RTN","SAMIUR2",418,0)
 if siform=$get(KEY) set @PYARY@("current")=1 ;this row is the current form
"RTN","SAMIUR2",419,0)
 ;
"RTN","SAMIUR2",420,0)
 set @PYARY@("rpt",1,1)="Intake" ; Form
"RTN","SAMIUR2",421,0)
 new kdate set kdate=$$GETDTKEY^SAMICAS2(siform)
"RTN","SAMIUR2",422,0)
 new keydate set keydate=$$KEY2DSPD^SAMICAS2(kdate)
"RTN","SAMIUR2",423,0)
 set @PYARY@("rpt",1,2)=keydate ; Reported Date
"RTN","SAMIUR2",424,0)
 ;
"RTN","SAMIUR2",425,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",426,0)
 new lastcum set lastcum=$get(@vals@("sippy"))
"RTN","SAMIUR2",427,0)
 set @PYARY@("rpt",1,3)=lastcum ; Pack Years
"RTN","SAMIUR2",428,0)
 set @PYARY@("rpt",1,4)=lastcum ; Cumulative
"RTN","SAMIUR2",429,0)
 ;
"RTN","SAMIUR2",430,0)
 new lastdt set lastdt=keydate
"RTN","SAMIUR2",431,0)
 new rptcnt set rptcnt=1
"RTN","SAMIUR2",432,0)
 new zi set zi=""
"RTN","SAMIUR2",433,0)
 for  do  quit:zi=""  ;
"RTN","SAMIUR2",434,0)
 . set zi=$order(items("type","vapals:fuform",zi))
"RTN","SAMIUR2",435,0)
 . quit:zi=""
"RTN","SAMIUR2",436,0)
 . ;
"RTN","SAMIUR2",437,0)
 . set rptcnt=rptcnt+1
"RTN","SAMIUR2",438,0)
 . set @PYARY@("rpt",rptcnt,1)="Follow-up"
"RTN","SAMIUR2",439,0)
 . new kdate set kdate=$$GETDTKEY^SAMICAS2(zi)
"RTN","SAMIUR2",440,0)
 . new keydate set keydate=$$KEY2DSPD^SAMICAS2(kdate)
"RTN","SAMIUR2",441,0)
 . set @PYARY@("rpt",rptcnt,2)=keydate ; Reported Date
"RTN","SAMIUR2",442,0)
 . ;
"RTN","SAMIUR2",443,0)
 . set vals=$name(@root@("graph",sid,zi))
"RTN","SAMIUR2",444,0)
 . new newpd set newpd=$g(@vals@("sippd"))
"RTN","SAMIUR2",445,0)
 . new usedate set usedate=keydate
"RTN","SAMIUR2",446,0)
 . new siq set siq=$get(@vals@("siq")) ; quit date on followup form
"RTN","SAMIUR2",447,0)
 . if siq'="" do  ; quit date provided
"RTN","SAMIUR2",448,0)
 . . quit:$$FMDT(siq)<$$FMDT(lastdt)  ; quit date out of range
"RTN","SAMIUR2",449,0)
 . . quit:$$FMDT(siq)>$$FMDT(keydate)  ; quit date out of range
"RTN","SAMIUR2",450,0)
 . . set usedate=siq ; use the quit date as end of range
"RTN","SAMIUR2",451,0)
 . . quit
"RTN","SAMIUR2",452,0)
 . new newpy set newpy=$$PKYDT(lastdt,usedate,newpd)
"RTN","SAMIUR2",453,0)
 . set @vals@("sippy")=newpy
"RTN","SAMIUR2",454,0)
 . ;
"RTN","SAMIUR2",455,0)
 . ; set ^gpl("current","KEY")=$get(KEY)
"RTN","SAMIUR2",456,0)
 . ; set ^gpl("current","zi")=zi
"RTN","SAMIUR2",457,0)
 . if zi=$get(KEY) do
"RTN","SAMIUR2",458,0)
 . . set @PYARY@("current")=rptcnt ;this row is the current form
"RTN","SAMIUR2",459,0)
 . . quit
"RTN","SAMIUR2",460,0)
 . ;
"RTN","SAMIUR2",461,0)
 . new newcum set newcum=""
"RTN","SAMIUR2",462,0)
 . if newpy'="" set newcum=lastcum+newpy
"RTN","SAMIUR2",463,0)
 . set @PYARY@("rpt",rptcnt,3)=newpy ; Pack Years
"RTN","SAMIUR2",464,0)
 . set @PYARY@("rpt",rptcnt,4)=newcum ; Cumulative
"RTN","SAMIUR2",465,0)
 . set lastdt=keydate
"RTN","SAMIUR2",466,0)
 . set lastcum=newcum
"RTN","SAMIUR2",467,0)
 . quit
"RTN","SAMIUR2",468,0)
 ;
"RTN","SAMIUR2",469,0)
 quit  ; end of ppi CUMPY^SAMIUR2
"RTN","SAMIUR2",470,0)
 ;
"RTN","SAMIUR2",471,0)
 ;
"RTN","SAMIUR2",472,0)
 ;
"RTN","SAMIUR2",473,0)
TDDT(ZDT) ; embed date in table cell
"RTN","SAMIUR2",474,0)
 ;
"RTN","SAMIUR2",475,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",476,0)
 ;@called-by
"RTN","SAMIUR2",477,0)
 ; BLINEDT
"RTN","SAMIUR2",478,0)
 ; DOB
"RTN","SAMIUR2",479,0)
 ; FUDATE
"RTN","SAMIUR2",480,0)
 ; LASTEXM
"RTN","SAMIUR2",481,0)
 ; INACTDT
"RTN","SAMIUR2",482,0)
 ; LDOC
"RTN","SAMIUR2",483,0)
 ; STUDYDT
"RTN","SAMIUR2",484,0)
 ;@calls
"RTN","SAMIUR2",485,0)
 ; ^%DT
"RTN","SAMIUR2",486,0)
 ;
"RTN","SAMIUR2",487,0)
 new X,Y,Z
"RTN","SAMIUR2",488,0)
 set X=ZDT
"RTN","SAMIUR2",489,0)
 do ^%DT
"RTN","SAMIUR2",490,0)
 if Y=-1 set Y=""
"RTN","SAMIUR2",491,0)
 set Z=$$VAPALSDT^SAMICASE(Y)
"RTN","SAMIUR2",492,0)
 new cell
"RTN","SAMIUR2",493,0)
 set cell="<td data-order="""_Y_""" data-search="""_Z_""">"_Z_"</td>"
"RTN","SAMIUR2",494,0)
 ;
"RTN","SAMIUR2",495,0)
 quit cell ; end of $$TDDT
"RTN","SAMIUR2",496,0)
 ; 
"RTN","SAMIUR2",497,0)
 ;
"RTN","SAMIUR2",498,0)
 ;
"RTN","SAMIUR2",499,0)
FMDT(ZDT) ; convert date to fileman format
"RTN","SAMIUR2",500,0)
 ;
"RTN","SAMIUR2",501,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",502,0)
 ;@called-by
"RTN","SAMIUR2",503,0)
 ; MKPTLK^SAMIHOM4
"RTN","SAMIUR2",504,0)
 ; $$PKYDT
"RTN","SAMIUR2",505,0)
 ; CUMPY
"RTN","SAMIUR2",506,0)
 ;@calls
"RTN","SAMIUR2",507,0)
 ; ^%DT
"RTN","SAMIUR2",508,0)
 ;
"RTN","SAMIUR2",509,0)
 new Y
"RTN","SAMIUR2",510,0)
 new X set X=ZDT
"RTN","SAMIUR2",511,0)
 do ^%DT
"RTN","SAMIUR2",512,0)
 ;
"RTN","SAMIUR2",513,0)
 quit Y ; end of ppi $$FMDT^SAMIUR2
"RTN","SAMIUR2",514,0)
 ;
"RTN","SAMIUR2",515,0)
 ;
"RTN","SAMIUR2",516,0)
 ;
"RTN","SAMIUR2",517,0)
PKYDT(STDT,ENDT,PKS,CIGS) ; pack-years from start & end & cigs/day
"RTN","SAMIUR2",518,0)
 ;
"RTN","SAMIUR2",519,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",520,0)
 ;@called-by
"RTN","SAMIUR2",521,0)
 ; CUMPY
"RTN","SAMIUR2",522,0)
 ;@calls
"RTN","SAMIUR2",523,0)
 ; $$FMDT
"RTN","SAMIUR2",524,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIUR2",525,0)
 ; $$PKY
"RTN","SAMIUR2",526,0)
 ;
"RTN","SAMIUR2",527,0)
 ; if PKS is not provided, 20/CIGS will be used for packs per day
"RTN","SAMIUR2",528,0)
 ;
"RTN","SAMIUR2",529,0)
 new pkyr set pkyr=""
"RTN","SAMIUR2",530,0)
 if $get(PKS)="" do  ;
"RTN","SAMIUR2",531,0)
 . if $get(CIGS)="" set PKS=0 quit  ;
"RTN","SAMIUR2",532,0)
 . set PKS=20/CIGS
"RTN","SAMIUR2",533,0)
 . quit
"RTN","SAMIUR2",534,0)
 new zst set zst=$$FMDT(STDT)
"RTN","SAMIUR2",535,0)
 set:zst=-1 zst=STDT
"RTN","SAMIUR2",536,0)
 ;
"RTN","SAMIUR2",537,0)
 new zend set zend=$$FMDT(ENDT)
"RTN","SAMIUR2",538,0)
 set:zend=-1 zend=ENDT ; probably a fileman date already
"RTN","SAMIUR2",539,0)
 ;
"RTN","SAMIUR2",540,0)
 new zdif set zdif=$$FMDIFF^XLFDT(zend,zst)/365.24
"RTN","SAMIUR2",541,0)
 ;
"RTN","SAMIUR2",542,0)
 set pkyr=$$PKY(zdif,PKS)
"RTN","SAMIUR2",543,0)
 ;
"RTN","SAMIUR2",544,0)
 quit pkyr ; end of $$PKYDT
"RTN","SAMIUR2",545,0)
 ;
"RTN","SAMIUR2",546,0)
 ;
"RTN","SAMIUR2",547,0)
 ;
"RTN","SAMIUR2",548,0)
PKY(YRS,PKS) ; pack-years from years & packs/day
"RTN","SAMIUR2",549,0)
 ;
"RTN","SAMIUR2",550,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",551,0)
 ;@called-by
"RTN","SAMIUR2",552,0)
 ; $$PKYDT
"RTN","SAMIUR2",553,0)
 ;@calls none
"RTN","SAMIUR2",554,0)
 ;@input
"RTN","SAMIUR2",555,0)
 ; YRS = years
"RTN","SAMIUR2",556,0)
 ; PKS = packs/day
"RTN","SAMIUR2",557,0)
 ;
"RTN","SAMIUR2",558,0)
 new rtn set rtn=""
"RTN","SAMIUR2",559,0)
 set rtn=YRS*PKS
"RTN","SAMIUR2",560,0)
 if $length($piece(rtn,".",2))>2 do  ;
"RTN","SAMIUR2",561,0)
 . new zdec set zdec=$piece(rtn,".",2)
"RTN","SAMIUR2",562,0)
 . set rtn=$piece(rtn,".",1)_"."_$extract(zdec,1,2)
"RTN","SAMIUR2",563,0)
 . if $extract(zdec,3)>4 set rtn=rtn+.01
"RTN","SAMIUR2",564,0)
 . quit
"RTN","SAMIUR2",565,0)
 set:rtn'["." rtn=rtn_".0"
"RTN","SAMIUR2",566,0)
 ;
"RTN","SAMIUR2",567,0)
 quit rtn ; end of $$PKY
"RTN","SAMIUR2",568,0)
 ;
"RTN","SAMIUR2",569,0)
 ;
"RTN","SAMIUR2",570,0)
 ;
"RTN","SAMIUR2",571,0)
 ;@section 4 active column ppis
"RTN","SAMIUR2",572,0)
 ;
"RTN","SAMIUR2",573,0)
 ;
"RTN","SAMIUR2",574,0)
 ;
"RTN","SAMIUR2",575,0)
ACTIVE(zdt,dfn,SAMIPATS) ; Active/Inactive column
"RTN","SAMIUR2",576,0)
 ;
"RTN","SAMIUR2",577,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",578,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",579,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",580,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",581,0)
 new active set active="inactive"
"RTN","SAMIUR2",582,0)
 if $get(@vals@("sistatus"))="active" set active="active"
"RTN","SAMIUR2",583,0)
 ;
"RTN","SAMIUR2",584,0)
 quit active
"RTN","SAMIUR2",585,0)
 ; 
"RTN","SAMIUR2",586,0)
AFORM(zdt,dfn,SAMIPATS) ; Name of most recent form
"RTN","SAMIUR2",587,0)
 Q $GET(SAMIPATS(zdt,dfn,"aform"))
"RTN","SAMIUR2",588,0)
 ;
"RTN","SAMIUR2",589,0)
AFORMDT(zdt,dfn,SAMIPATS) ; Date of most recent form
"RTN","SAMIUR2",590,0)
 N ZD S ZD=$GET(SAMIPATS(zdt,dfn,"aformdt"))
"RTN","SAMIUR2",591,0)
 Q $$VAPALSDT^SAMICASE(ZD)
"RTN","SAMIUR2",592,0)
 ;
"RTN","SAMIUR2",593,0)
AGE(zdt,dfn,SAMIPATS) ; age
"RTN","SAMIUR2",594,0)
 ;
"RTN","SAMIUR2",595,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",596,0)
 ;@called-by
"RTN","SAMIUR2",597,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",598,0)
 ;@calls
"RTN","SAMIUR2",599,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",600,0)
 ; ^%DT
"RTN","SAMIUR2",601,0)
 ; $$NOW^XLFDT
"RTN","SAMIUR2",602,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIUR2",603,0)
 ;
"RTN","SAMIUR2",604,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",605,0)
 new dob set dob=$get(@root@(dfn,"sbdob")) ; dob in VAPALS format
"RTN","SAMIUR2",606,0)
 ;
"RTN","SAMIUR2",607,0)
 new Y
"RTN","SAMIUR2",608,0)
 new X set X=dob
"RTN","SAMIUR2",609,0)
 do ^%DT
"RTN","SAMIUR2",610,0)
 ;
"RTN","SAMIUR2",611,0)
 new age set age=$piece($$FMDIFF^XLFDT($$NOW^XLFDT,Y)/365,".")
"RTN","SAMIUR2",612,0)
 ;
"RTN","SAMIUR2",613,0)
 quit age ; end of ppi $$AGE^SAMIUR2
"RTN","SAMIUR2",614,0)
 ;
"RTN","SAMIUR2",615,0)
COUNTS(recvar) ; extrinsic returns (total_recommendations/total_patients)
"RTN","SAMIUR2",616,0)
 ;
"RTN","SAMIUR2",617,0)
 n n,d
"RTN","SAMIUR2",618,0)
 s (n,d)=0
"RTN","SAMIUR2",619,0)
 s n=$g(SAMIPATS("rcount",recvar))
"RTN","SAMIUR2",620,0)
 s n=+n
"RTN","SAMIUR2",621,0)
 s d=$g(SAMIPATS("pcount",recvar))
"RTN","SAMIUR2",622,0)
 s d=+d
"RTN","SAMIUR2",623,0)
 q "<br>("_n_"/"_d_")"
"RTN","SAMIUR2",624,0)
 ;
"RTN","SAMIUR2",625,0)
RECANTI(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",626,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefuaf"))="y":"X",1:"")
"RTN","SAMIUR2",627,0)
 ;
"RTN","SAMIUR2",628,0)
RECCONT(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",629,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefucc"))="y":"X",1:"")
"RTN","SAMIUR2",630,0)
 ;
"RTN","SAMIUR2",631,0)
RECPET(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",632,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefupe"))="y":"X",1:"")
"RTN","SAMIUR2",633,0)
 ;
"RTN","SAMIUR2",634,0)
RECBIOP(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",635,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefufn"))="y":"X",1:"")
"RTN","SAMIUR2",636,0)
 ;
"RTN","SAMIUR2",637,0)
RECBRONC(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",638,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefubr"))="y":"X",1:"")
"RTN","SAMIUR2",639,0)
 ;
"RTN","SAMIUR2",640,0)
RECPULM(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",641,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefupc"))="y":"X",1:"")
"RTN","SAMIUR2",642,0)
 ;
"RTN","SAMIUR2",643,0)
RECTUMOR(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",644,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefutb"))="y":"X",1:"")
"RTN","SAMIUR2",645,0)
 ;
"RTN","SAMIUR2",646,0)
LAST5(zdt,dfn,SAMIPATS) ; return last5
"RTN","SAMIUR2",647,0)
 Q $get(SAMIPATS(zdt,dfn,"last5"))
"RTN","SAMIUR2",648,0)
 ;
"RTN","SAMIUR2",649,0)
ZDT(zdt,dfn,SAMIPATS) ; insertable index date
"RTN","SAMIUR2",650,0)
 Q $$TDDT(zdt)
"RTN","SAMIUR2",651,0)
 ;
"RTN","SAMIUR2",652,0)
ENROLLDT(zdt,dfn,SAMIPATS) ; enrollment date
"RTN","SAMIUR2",653,0)
 ;
"RTN","SAMIUR2",654,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",655,0)
 ;@called-by
"RTN","SAMIUR2",656,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",657,0)
 ;@calls
"RTN","SAMIUR2",658,0)
 ; $$TDDT
"RTN","SAMIUR2",659,0)
 ;
"RTN","SAMIUR2",660,0)
 new enroldt set enroldt=$get(SAMIPATS(zdt,dfn,"edate"))
"RTN","SAMIUR2",661,0)
 ;
"RTN","SAMIUR2",662,0)
 quit $$TDDT(enroldt) ; end of ppi $$ENROLLDT^SAMIUR2
"RTN","SAMIUR2",663,0)
 ;
"RTN","SAMIUR2",664,0)
 ;
"RTN","SAMIUR2",665,0)
BLINEDT(zdt,dfn,SAMIPATS) ; baseline date
"RTN","SAMIUR2",666,0)
 ;
"RTN","SAMIUR2",667,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",668,0)
 ;@called-by
"RTN","SAMIUR2",669,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",670,0)
 ;@calls
"RTN","SAMIUR2",671,0)
 ; $$TDDT
"RTN","SAMIUR2",672,0)
 ;
"RTN","SAMIUR2",673,0)
 new bldt set bldt=$get(SAMIPATS(zdt,dfn,"baseline"))
"RTN","SAMIUR2",674,0)
 ;
"RTN","SAMIUR2",675,0)
 quit $$TDDT(bldt) ; end of ppi $$BLINEDT^SAMIUR2
"RTN","SAMIUR2",676,0)
 ;
"RTN","SAMIUR2",677,0)
 ;
"RTN","SAMIUR2",678,0)
CONTACT(zdt,dfn,SAMIPATS) ; patient street address
"RTN","SAMIUR2",679,0)
 ;
"RTN","SAMIUR2",680,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",681,0)
 ;@called-by
"RTN","SAMIUR2",682,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",683,0)
 ;@calls
"RTN","SAMIUR2",684,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",685,0)
 ;
"RTN","SAMIUR2",686,0)
 new contact set contact=""
"RTN","SAMIUR2",687,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",688,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",689,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",690,0)
 q:siform=""
"RTN","SAMIUR2",691,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",692,0)
 set contact=$get(@vals@("sinamef"))_" "_$get(@vals@("sinamel"))
"RTN","SAMIUR2",693,0)
 set contact=contact_"<br>"_$get(@vals@("sipsa"))
"RTN","SAMIUR2",694,0)
 if $get(@vals@("sipan"))'="" do
"RTN","SAMIUR2",695,0)
 . set contact=contact_" Apt "_$get(@vals@("sipan"))
"RTN","SAMIUR2",696,0)
 . quit
"RTN","SAMIUR2",697,0)
 if $get(@vals@("sipcn"))'="" do
"RTN","SAMIUR2",698,0)
 . set contact=contact_"<br>County "_@vals@("sipcn")
"RTN","SAMIUR2",699,0)
 . quit
"RTN","SAMIUR2",700,0)
 if $get(@vals@("sipc"))'="" do
"RTN","SAMIUR2",701,0)
 . set contact=contact_" <br>"_@vals@("sipc")_", "
"RTN","SAMIUR2",702,0)
 . quit
"RTN","SAMIUR2",703,0)
 set contact=contact_" "_$get(@vals@("sips"))_" "_$get(@vals@("sipz"))_"     "
"RTN","SAMIUR2",704,0)
 ;
"RTN","SAMIUR2",705,0)
 new phone set phone=$get(@vals@("sippn"))
"RTN","SAMIUR2",706,0)
 if phone'="" set contact=contact_" <br>Phone: "_phone
"RTN","SAMIUR2",707,0)
 ;
"RTN","SAMIUR2",708,0)
 quit contact ; end of ppi $$CONTACT^SAMIUR2
"RTN","SAMIUR2",709,0)
 ;
"RTN","SAMIUR2",710,0)
 ;
"RTN","SAMIUR2",711,0)
 ;
"RTN","SAMIUR2",712,0)
CTPROT(zdt,dfn,SAMIPATS) ; ct protocol
"RTN","SAMIUR2",713,0)
 ;
"RTN","SAMIUR2",714,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",715,0)
 ;@called-by
"RTN","SAMIUR2",716,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",717,0)
 ;@calls
"RTN","SAMIUR2",718,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",719,0)
 ;
"RTN","SAMIUR2",720,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",721,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",722,0)
 quit:ceform="" ""
"RTN","SAMIUR2",723,0)
 ;
"RTN","SAMIUR2",724,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",725,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",726,0)
 new cectp set cectp=$get(@vals@("cectp"))
"RTN","SAMIUR2",727,0)
 new ctyp set ctyp=$select(cectp="l":"Low-Dose CT",cectp="d":"Standard CT",cectp="i":"Limited",1:"")
"RTN","SAMIUR2",728,0)
 ;
"RTN","SAMIUR2",729,0)
 quit ctyp ; end of ppi $$CTPROT^SAMIUR2
"RTN","SAMIUR2",730,0)
 ;
"RTN","SAMIUR2",731,0)
 ;
"RTN","SAMIUR2",732,0)
 ;
"RTN","SAMIUR2",733,0)
DOB(ien,dfn,SAMIPATS) ; date of birth
"RTN","SAMIUR2",734,0)
 ;
"RTN","SAMIUR2",735,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",736,0)
 ;@called-by
"RTN","SAMIUR2",737,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",738,0)
 ;@calls
"RTN","SAMIUR2",739,0)
 ; $$TDDT
"RTN","SAMIUR2",740,0)
 ;
"RTN","SAMIUR2",741,0)
 new dob set dob=$get(SAMIPATS(ien,dfn,"dob"))
"RTN","SAMIUR2",742,0)
 if dob="" set dob=$get(SAMIPATS(ien,dfn,"sbdob"))
"RTN","SAMIUR2",743,0)
 ;
"RTN","SAMIUR2",744,0)
 quit $$TDDT(dob) ; end of ppi $$DOB^SAMIUR2
"RTN","SAMIUR2",745,0)
 ;
"RTN","SAMIUR2",746,0)
 ;
"RTN","SAMIUR2",747,0)
 ;
"RTN","SAMIUR2",748,0)
FUDATE(zdt,dfn,SAMIPATS) ; followup date
"RTN","SAMIUR2",749,0)
 ;
"RTN","SAMIUR2",750,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",751,0)
 ;@called-by
"RTN","SAMIUR2",752,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",753,0)
 ;@calls
"RTN","SAMIUR2",754,0)
 ; $TDDT
"RTN","SAMIUR2",755,0)
 ;
"RTN","SAMIUR2",756,0)
 new fud set fud="fudate"
"RTN","SAMIUR2",757,0)
 new date set date=$get(SAMIPATS(zdt,dfn,"cefud"))
"RTN","SAMIUR2",758,0)
 ;
"RTN","SAMIUR2",759,0)
 quit $$TDDT(date) ; end of ppi $$FUDATE^SAMIUR2
"RTN","SAMIUR2",760,0)
 ;
"RTN","SAMIUR2",761,0)
 ;
"RTN","SAMIUR2",762,0)
 ;
"RTN","SAMIUR2",763,0)
GENDER(zdt,dfn,SAMIPATS) ; gender
"RTN","SAMIUR2",764,0)
 ;
"RTN","SAMIUR2",765,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",766,0)
 ;@called-by
"RTN","SAMIUR2",767,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",768,0)
 ;@calls
"RTN","SAMIUR2",769,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",770,0)
 ;
"RTN","SAMIUR2",771,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",772,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",773,0)
 ;
"RTN","SAMIUR2",774,0)
 new gend set gend=$get(SAMIPATS(zdt,dfn,"gender"))
"RTN","SAMIUR2",775,0)
 if gend="" do
"RTN","SAMIUR2",776,0)
 . new pien set pien=$order(@root@("dfn",dfn,""))
"RTN","SAMIUR2",777,0)
 . if pien'="" do  ;
"RTN","SAMIUR2",778,0)
 . . set gend=$get(@root@(pien,"sex"))
"RTN","SAMIUR2",779,0)
 . . if gend="" set gend=$get(@root@(pien,"gender"))
"RTN","SAMIUR2",780,0)
 . . quit
"RTN","SAMIUR2",781,0)
 . if gend="" do  ;
"RTN","SAMIUR2",782,0)
 . . new lien set lien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR2",783,0)
 . . set gend=$get(@lroot@(lien,"gender"))
"RTN","SAMIUR2",784,0)
 . . quit
"RTN","SAMIUR2",785,0)
 if gend["^" set gend=$piece(gend,"^",1)
"RTN","SAMIUR2",786,0)
 ;
"RTN","SAMIUR2",787,0)
 quit gend ; end of ppi $$GENDER^SAMIUR2
"RTN","SAMIUR2",788,0)
 ;
"RTN","SAMIUR2",789,0)
 ;
"RTN","SAMIUR2",790,0)
 ;
"RTN","SAMIUR2",791,0)
IFORM(zdt,dfn,SAMIPATS) ; name(s) of incomplete forms
"RTN","SAMIUR2",792,0)
 ;
"RTN","SAMIUR2",793,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",794,0)
 ;@called-by
"RTN","SAMIUR2",795,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",796,0)
 ;@calls
"RTN","SAMIUR2",797,0)
 ; $$DFN2SID^SAMIUR2
"RTN","SAMIUR2",798,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMIUR2",799,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMIUR2",800,0)
 ; $$MKNAV
"RTN","SAMIUR2",801,0)
 ;
"RTN","SAMIUR2",802,0)
 new iform set iform=$get(SAMIPATS(zdt,dfn,"iform"))
"RTN","SAMIUR2",803,0)
 quit:iform="" ""  ;
"RTN","SAMIUR2",804,0)
 ;
"RTN","SAMIUR2",805,0)
 new zkey1,zn,typ
"RTN","SAMIUR2",806,0)
 new return set return="<table>"
"RTN","SAMIUR2",807,0)
 for zn=2:1  quit:$piece(iform," ",zn)=""  do  ;
"RTN","SAMIUR2",808,0)
 . set return=return_"<tr><td>"
"RTN","SAMIUR2",809,0)
 . set zkey1=$piece(iform," ",zn)
"RTN","SAMIUR2",810,0)
 . ;
"RTN","SAMIUR2",811,0)
 . new fname
"RTN","SAMIUR2",812,0)
 . if zkey1["ceform" set fname="CT Evaluation" set typ="ceform"
"RTN","SAMIUR2",813,0)
 . if zkey1["sbform" set fname="Background" set typ="sbform"
"RTN","SAMIUR2",814,0)
 . if zkey1["fuform" set fname="Participant Follow-up" set typ="fuform"
"RTN","SAMIUR2",815,0)
 . if zkey1["bxform" set fname="Biopsy" set typ="bxform"
"RTN","SAMIUR2",816,0)
 . if zkey1["ptform" set fname="PET Evaluation" set typ="ptform"
"RTN","SAMIUR2",817,0)
 . if zkey1["itform" set fname="Intervention" set typ="itform"
"RTN","SAMIUR2",818,0)
 . if zkey1["siform" set fname="Intake Form" set typ="siform"
"RTN","SAMIUR2",819,0)
 . if $get(fname)="" set fname="unknown" set typ=""
"RTN","SAMIUR2",820,0)
 . ;
"RTN","SAMIUR2",821,0)
 . new sid set sid=$$DFN2SID^SAMIUR2(dfn)
"RTN","SAMIUR2",822,0)
 . new zdate set zdate=$$VAPALSDT^SAMICASE($$KEY2FM^SAMICASE(zkey1))
"RTN","SAMIUR2",823,0)
 . set return=return_$$MKNAV(sid,zkey1,fname_" - "_zdate,typ)
"RTN","SAMIUR2",824,0)
 . set return=return_"</td></tr>"
"RTN","SAMIUR2",825,0)
 . quit
"RTN","SAMIUR2",826,0)
 ;
"RTN","SAMIUR2",827,0)
 set return=return_"</table>"
"RTN","SAMIUR2",828,0)
 ;
"RTN","SAMIUR2",829,0)
 quit return ; end of ppi $$IFORM^SAMIUR2
"RTN","SAMIUR2",830,0)
 ;
"RTN","SAMIUR2",831,0)
 ;
"RTN","SAMIUR2",832,0)
 ;
"RTN","SAMIUR2",833,0)
LASTEXM(zdt,dfn,SAMIPATS) ; patient last exam
"RTN","SAMIUR2",834,0)
 ;
"RTN","SAMIUR2",835,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",836,0)
 ;@called-by
"RTN","SAMIUR2",837,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",838,0)
 ;@calls
"RTN","SAMIUR2",839,0)
 ; $$TDDT
"RTN","SAMIUR2",840,0)
 ;
"RTN","SAMIUR2",841,0)
 new lexm set lexm=$get(SAMIPATS(zdt,dfn,"cedos"))
"RTN","SAMIUR2",842,0)
 ;
"RTN","SAMIUR2",843,0)
 quit $$TDDT(lexm) ; end of ppi $$LASTEXM^SAMIUR2
"RTN","SAMIUR2",844,0)
 ;
"RTN","SAMIUR2",845,0)
 ;
"RTN","SAMIUR2",846,0)
 ;
"RTN","SAMIUR2",847,0)
INACTDT(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",848,0)
 ;
"RTN","SAMIUR2",849,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",850,0)
 ;@called-by
"RTN","SAMIUR2",851,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",852,0)
 ;@calls
"RTN","SAMIUR2",853,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",854,0)
 ; $$TDDT
"RTN","SAMIUR2",855,0)
 ;
"RTN","SAMIUR2",856,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",857,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",858,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",859,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",860,0)
 ;
"RTN","SAMIUR2",861,0)
 quit $$TDDT($get(@vals@("sidod")))
"RTN","SAMIUR2",862,0)
 ;
"RTN","SAMIUR2",863,0)
 ;
"RTN","SAMIUR2",864,0)
 ;
"RTN","SAMIUR2",865,0)
INACTRE(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",866,0)
 ;
"RTN","SAMIUR2",867,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",868,0)
 ;@called-by
"RTN","SAMIUR2",869,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",870,0)
 ;@calls
"RTN","SAMIUR2",871,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",872,0)
 ;
"RTN","SAMIUR2",873,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",874,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",875,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",876,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",877,0)
 ;
"RTN","SAMIUR2",878,0)
 quit $get(@vals@("sistachg"))
"RTN","SAMIUR2",879,0)
 ;
"RTN","SAMIUR2",880,0)
 ;
"RTN","SAMIUR2",881,0)
 ;
"RTN","SAMIUR2",882,0)
INACTCM(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",883,0)
 ;
"RTN","SAMIUR2",884,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",885,0)
 ;@called-by
"RTN","SAMIUR2",886,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",887,0)
 ;@calls
"RTN","SAMIUR2",888,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",889,0)
 ;
"RTN","SAMIUR2",890,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",891,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",892,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",893,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",894,0)
 ;
"RTN","SAMIUR2",895,0)
 quit $get(@vals@("sistreas"))
"RTN","SAMIUR2",896,0)
 ;
"RTN","SAMIUR2",897,0)
 ;
"RTN","SAMIUR2",898,0)
 ;
"RTN","SAMIUR2",899,0)
LDE(zdt,dfn,SAMIPATS) ; last date and entry in com log
"RTN","SAMIUR2",900,0)
 ;
"RTN","SAMIUR2",901,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",902,0)
 ;@called-by
"RTN","SAMIUR2",903,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",904,0)
 ;@calls
"RTN","SAMIUR2",905,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",906,0)
 ;
"RTN","SAMIUR2",907,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",908,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",909,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",910,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",911,0)
 ;
"RTN","SAMIUR2",912,0)
 n comien,comdt,comntry
"RTN","SAMIUR2",913,0)
 s (comdt,comntry)=""
"RTN","SAMIUR2",914,0)
 s comien=$o(@vals@("comlog"," "),-1)
"RTN","SAMIUR2",915,0)
 i comien="" d  q comdt
"RTN","SAMIUR2",916,0)
 . s comdt=$g(@vals@("sidc"))
"RTN","SAMIUR2",917,0)
 s comntry=$g(@vals@("comlog",comien))
"RTN","SAMIUR2",918,0)
 s comdt=$p($p(comntry,"[",2),"@",1)
"RTN","SAMIUR2",919,0)
 ;
"RTN","SAMIUR2",920,0)
 quit comdt_"^"_comntry
"RTN","SAMIUR2",921,0)
 ;
"RTN","SAMIUR2",922,0)
 ;
"RTN","SAMIUR2",923,0)
 ;
"RTN","SAMIUR2",924,0)
LDOC(zdt,dfn,SAMIPATS) ; last date of contact
"RTN","SAMIUR2",925,0)
 ;
"RTN","SAMIUR2",926,0)
 quit $$TDDT($piece($$LDE(zdt,dfn,.SAMIPATS),"^",1))
"RTN","SAMIUR2",927,0)
 ;
"RTN","SAMIUR2",928,0)
 ;
"RTN","SAMIUR2",929,0)
 ;
"RTN","SAMIUR2",930,0)
LENTRY(zdt,dfn,SAMIPATS) ; last contact entry
"RTN","SAMIUR2",931,0)
 ;
"RTN","SAMIUR2",932,0)
 quit $piece($$LDE(zdt,dfn,.SAMIPATS),"^",2)
"RTN","SAMIUR2",933,0)
 ;
"RTN","SAMIUR2",934,0)
 ;
"RTN","SAMIUR2",935,0)
 ;
"RTN","SAMIUR2",936,0)
MANPAT(ien,dfn,SAMIPATS) ; unmatched patient cell
"RTN","SAMIUR2",937,0)
 ;
"RTN","SAMIUR2",938,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",939,0)
 ;@called-by
"RTN","SAMIUR2",940,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",941,0)
 ;@calls
"RTN","SAMIUR2",942,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",943,0)
 ;
"RTN","SAMIUR2",944,0)
 new zcell set zcell=""
"RTN","SAMIUR2",945,0)
 ; set zcell=zcell_$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR2",946,0)
 set zcell=zcell_$get(SAMIPATS(ien,dfn,"editref"))
"RTN","SAMIUR2",947,0)
 set zcell=zcell_"<br>Date of Birth: "_$get(SAMIPATS(ien,dfn,"dob"))
"RTN","SAMIUR2",948,0)
 set zcell=zcell_" Gender: "_$get(SAMIPATS(ien,dfn,"sex"))
"RTN","SAMIUR2",949,0)
 ;
"RTN","SAMIUR2",950,0)
 new ssn set ssn=$get(SAMIPATS(ien,dfn,"ssn"))
"RTN","SAMIUR2",951,0)
 if ssn="" do  ;
"RTN","SAMIUR2",952,0)
 . new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",953,0)
 . new tssn set tssn=$get(@lroot@(ien,"ssn"))
"RTN","SAMIUR2",954,0)
 . set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",955,0)
 . quit
"RTN","SAMIUR2",956,0)
 set zcell=zcell_"<br>SSN: "_ssn
"RTN","SAMIUR2",957,0)
 ;
"RTN","SAMIUR2",958,0)
 set zcell=zcell_"<br>dfn: "_dfn
"RTN","SAMIUR2",959,0)
 ;
"RTN","SAMIUR2",960,0)
 quit zcell ; end of ppi $$MANPAT^SAMIUR2
"RTN","SAMIUR2",961,0)
 ;
"RTN","SAMIUR2",962,0)
 ;
"RTN","SAMIUR2",963,0)
 ;
"RTN","SAMIUR2",964,0)
MATCH(ien,dfn,SAMIPATS) ; match button cell
"RTN","SAMIUR2",965,0)
 ;
"RTN","SAMIUR2",966,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",967,0)
 ;@called-by
"RTN","SAMIUR2",968,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",969,0)
 ;@calls none
"RTN","SAMIUR2",970,0)
 ;
"RTN","SAMIUR2",971,0)
 new matien set matien=$get(SAMIPATS(ien,dfn,"MATCHLOG"))
"RTN","SAMIUR2",972,0)
 quit:matien="" ""
"RTN","SAMIUR2",973,0)
 ;
"RTN","SAMIUR2",974,0)
 new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR2",975,0)
 set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""merge"">"
"RTN","SAMIUR2",976,0)
 set nuhref=nuhref_"<input type=hidden name=""toien"" value="_ien_">"
"RTN","SAMIUR2",977,0)
 set nuhref=nuhref_"<input value=""Merge"" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR2",978,0)
 ;
"RTN","SAMIUR2",979,0)
 quit nuhref ; end of ppi $$MATCH^SAMIUR2
"RTN","SAMIUR2",980,0)
 ;
"RTN","SAMIUR2",981,0)
 ;
"RTN","SAMIUR2",982,0)
 ;
"RTN","SAMIUR2",983,0)
NAME(zdt,dfn,SAMIPATS) ; name w/hyperlink
"RTN","SAMIUR2",984,0)
 ;
"RTN","SAMIUR2",985,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",986,0)
 ;@called-by
"RTN","SAMIUR2",987,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",988,0)
 ;@calls none
"RTN","SAMIUR2",989,0)
 ;
"RTN","SAMIUR2",990,0)
 new nam set nam="Name"
"RTN","SAMIUR2",991,0)
 ;
"RTN","SAMIUR2",992,0)
 quit $get(SAMIPATS(zdt,dfn,"nuhref")) ; end of ppi $$NAME^SAMIUR2
"RTN","SAMIUR2",993,0)
 ;
"RTN","SAMIUR2",994,0)
 ;
"RTN","SAMIUR2",995,0)
 ;
"RTN","SAMIUR2",996,0)
PACKYRS(zdt,dfn,SAMIPATS) ; smoking status
"RTN","SAMIUR2",997,0)
 ;
"RTN","SAMIUR2",998,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",999,0)
 ;@called-by
"RTN","SAMIUR2",1000,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1001,0)
 ;@calls
"RTN","SAMIUR2",1002,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1003,0)
 ;
"RTN","SAMIUR2",1004,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1005,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1006,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1007,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1008,0)
 new pkyrs set pkyrs=$get(@vals@("sippy"))
"RTN","SAMIUR2",1009,0)
 ;
"RTN","SAMIUR2",1010,0)
 quit pkyrs ; end of ppi $$PACKYRS^SAMIUR2
"RTN","SAMIUR2",1011,0)
 ;
"RTN","SAMIUR2",1012,0)
 ;
"RTN","SAMIUR2",1013,0)
 ;
"RTN","SAMIUR2",1014,0)
POSSIBLE(ien,dfn,SAMIPATS) ; possible match cell
"RTN","SAMIUR2",1015,0)
 ;
"RTN","SAMIUR2",1016,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1017,0)
 ;@called-by
"RTN","SAMIUR2",1018,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1019,0)
 ;@calls
"RTN","SAMIUR2",1020,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1021,0)
 ;
"RTN","SAMIUR2",1022,0)
 new zcell set zcell=""
"RTN","SAMIUR2",1023,0)
 new matien set matien=$get(SAMIPATS(ien,dfn,"MATCHLOG"))
"RTN","SAMIUR2",1024,0)
 quit:matien="" zcell
"RTN","SAMIUR2",1025,0)
 ;
"RTN","SAMIUR2",1026,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",1027,0)
 quit:'$data(@lroot@(matien)) zcell
"RTN","SAMIUR2",1028,0)
 ;
"RTN","SAMIUR2",1029,0)
 set zcell=zcell_$get(@lroot@(matien,"saminame"))
"RTN","SAMIUR2",1030,0)
 set zcell=zcell_"<br>Date of Birth: "_$get(@lroot@(matien,"sbdob"))
"RTN","SAMIUR2",1031,0)
 set zcell=zcell_" Gender: "_$get(@lroot@(matien,"sex"))
"RTN","SAMIUR2",1032,0)
 ;
"RTN","SAMIUR2",1033,0)
 new tssn set tssn=$get(@lroot@(matien,"ssn"))
"RTN","SAMIUR2",1034,0)
 new ssn set ssn=tssn
"RTN","SAMIUR2",1035,0)
 if tssn'["-" set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",1036,0)
 set zcell=zcell_"<br>SSN: "_ssn
"RTN","SAMIUR2",1037,0)
 ;
"RTN","SAMIUR2",1038,0)
 set zcell=zcell_"<br>dfn: "_$get(@lroot@(matien,"dfn"))
"RTN","SAMIUR2",1039,0)
 ;
"RTN","SAMIUR2",1040,0)
 quit zcell ; end of ppi $$POSSIBLE^SAMIUR2
"RTN","SAMIUR2",1041,0)
 ;
"RTN","SAMIUR2",1042,0)
 ;
"RTN","SAMIUR2",1043,0)
 ;
"RTN","SAMIUR2",1044,0)
RECOM(zdt,dfn,SAMIPATS) ; recommendation
"RTN","SAMIUR2",1045,0)
 ;
"RTN","SAMIUR2",1046,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1047,0)
 ;@called-by
"RTN","SAMIUR2",1048,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1049,0)
 ;@calls
"RTN","SAMIUR2",1050,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1051,0)
 ;
"RTN","SAMIUR2",1052,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1053,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1054,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1055,0)
 ;
"RTN","SAMIUR2",1056,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1057,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1058,0)
 new cefuw set cefuw=$get(@vals@("cefuw"))
"RTN","SAMIUR2",1059,0)
 ;
"RTN","SAMIUR2",1060,0)
 new recom set recom=""
"RTN","SAMIUR2",1061,0)
 set recom=$select(cefuw="1y":"Annual Repeat",cefuw="nw":"Now",cefuw="1m":"1 month",cefuw="3m":"3 months",cefuw="6m":"6 months",cefuw="os":"Other",1:"")
"RTN","SAMIUR2",1062,0)
 if $get(@vals@("cefuaf"))="y" set recom=recom_", Antibiotics"
"RTN","SAMIUR2",1063,0)
 if $get(@vals@("cefucc"))="y" set recom=recom_", Contrast CT"
"RTN","SAMIUR2",1064,0)
 if $get(@vals@("cefupe"))="y" set recom=recom_", PET"
"RTN","SAMIUR2",1065,0)
 if $get(@vals@("cefufn"))="y" set recom=recom_", Percutaneous biopsy"
"RTN","SAMIUR2",1066,0)
 if $get(@vals@("cefubr"))="y" set recom=recom_", Bronchoscopy"
"RTN","SAMIUR2",1067,0)
 if $get(@vals@("cefupc"))="y" set recom=recom_", Pulmonary consultation"
"RTN","SAMIUR2",1068,0)
 if $get(@vals@("cefutb"))="y" set recom=recom_", Refer to tumor board"
"RTN","SAMIUR2",1069,0)
 if $get(@vals@("cefunf"))="y" set recom=recom_", No other further follow-up"
"RTN","SAMIUR2",1070,0)
 if $extract(recom,1,2)=", " set recom=$extract(recom,3,$length(recom))
"RTN","SAMIUR2",1071,0)
 ;
"RTN","SAMIUR2",1072,0)
 quit recom ; end of ppi $$RECOM^SAMIUR2
"RTN","SAMIUR2",1073,0)
 ;
"RTN","SAMIUR2",1074,0)
 ;
"RTN","SAMIUR2",1075,0)
 ;
"RTN","SAMIUR2",1076,0)
RURAL(zdt,dfn,SAMIPATS) ; patient's rural/urban status
"RTN","SAMIUR2",1077,0)
 ;
"RTN","SAMIUR2",1078,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1079,0)
 ;@called-by
"RTN","SAMIUR2",1080,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1081,0)
 ;@calls
"RTN","SAMIUR2",1082,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1083,0)
 ;
"RTN","SAMIUR2",1084,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1085,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1086,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1087,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1088,0)
 new sirs set sirs=$get(@vals@("sirs"))
"RTN","SAMIUR2",1089,0)
 set sirs=$select(sirs="r":"rural",sirs="u":"urban",sirs="n":"unknown",1:"unknown")
"RTN","SAMIUR2",1090,0)
 ;
"RTN","SAMIUR2",1091,0)
 quit sirs ; end of ppi $$RURAL^SAMIUR2
"RTN","SAMIUR2",1092,0)
 ;
"RTN","SAMIUR2",1093,0)
 ;
"RTN","SAMIUR2",1094,0)
 ;
"RTN","SAMIUR2",1095,0)
SID(zdt,dfn,SAMIPATS) ; study ID
"RTN","SAMIUR2",1096,0)
 ;
"RTN","SAMIUR2",1097,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1098,0)
 ;@called-by
"RTN","SAMIUR2",1099,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1100,0)
 ;@calls
"RTN","SAMIUR2",1101,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1102,0)
 ;
"RTN","SAMIUR2",1103,0)
 quit $$DFN2SID(dfn) ; end of ppi $$SID^SAMIUR2
"RTN","SAMIUR2",1104,0)
 ;
"RTN","SAMIUR2",1105,0)
 ;
"RTN","SAMIUR2",1106,0)
 ;
"RTN","SAMIUR2",1107,0)
SMHIS(zdt,dfn,SAMIPATS) ; smoking history cell
"RTN","SAMIUR2",1108,0)
 ;
"RTN","SAMIUR2",1109,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1110,0)
 ;@called-by
"RTN","SAMIUR2",1111,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1112,0)
 ;@calls
"RTN","SAMIUR2",1113,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1114,0)
 ; $$SHDET
"RTN","SAMIUR2",1115,0)
 ;
"RTN","SAMIUR2",1116,0)
 new zrtn set zrtn=""
"RTN","SAMIUR2",1117,0)
 set zrtn=zrtn_"<div class=""row""><div class=""col-md-12""><table class=""table"" id=""pack-years-history"">"
"RTN","SAMIUR2",1118,0)
 set zrtn=zrtn_"<thead><tr><th>Form </th><th> Reported Date </th>"
"RTN","SAMIUR2",1119,0)
 set zrtn=zrtn_"<th>Pack Years</th><th>Cumulative</th></tr></thead><tbody>"
"RTN","SAMIUR2",1120,0)
 set zrtn=zrtn_$$SHDET($$DFN2SID(dfn))
"RTN","SAMIUR2",1121,0)
 set zrtn=zrtn_"</tbody></table></div></div>"
"RTN","SAMIUR2",1122,0)
 ;
"RTN","SAMIUR2",1123,0)
 quit zrtn ; end of ppi $$SMHIS^SAMIUR2
"RTN","SAMIUR2",1124,0)
 ;
"RTN","SAMIUR2",1125,0)
 ;
"RTN","SAMIUR2",1126,0)
 ;
"RTN","SAMIUR2",1127,0)
SMKSTAT(zdt,dfn,SAMIPATS) ; smoking status
"RTN","SAMIUR2",1128,0)
 ;
"RTN","SAMIUR2",1129,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1130,0)
 ;@called-by
"RTN","SAMIUR2",1131,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1132,0)
 ;@calls
"RTN","SAMIUR2",1133,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1134,0)
 ;
"RTN","SAMIUR2",1135,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1136,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1137,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1138,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1139,0)
 ;
"RTN","SAMIUR2",1140,0)
 new smk set smk="unknown"
"RTN","SAMIUR2",1141,0)
 if $get(@vals@("siesm"))="n" set smk="Never smoked"
"RTN","SAMIUR2",1142,0)
 if $get(@vals@("siesm"))="p" set smk="Past smoker"
"RTN","SAMIUR2",1143,0)
 if $get(@vals@("siesm"))="c" set smk="Current smoker"
"RTN","SAMIUR2",1144,0)
 ; if $get(@vals@("siesq"))=1 set smk="Cu"
"RTN","SAMIUR2",1145,0)
 ;
"RTN","SAMIUR2",1146,0)
 quit smk ; end of ppi $$SMKSTAT^SAMIUR2
"RTN","SAMIUR2",1147,0)
 ;
"RTN","SAMIUR2",1148,0)
 ;
"RTN","SAMIUR2",1149,0)
 ;
"RTN","SAMIUR2",1150,0)
SSN(zdt,dfn,SAMIPATS) ; social security number
"RTN","SAMIUR2",1151,0)
 ;
"RTN","SAMIUR2",1152,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1153,0)
 ;@called-by
"RTN","SAMIUR2",1154,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1155,0)
 ;@calls none
"RTN","SAMIUR2",1156,0)
 ;
"RTN","SAMIUR2",1157,0)
 new tssn set tssn=$get(SAMIPATS(zdt,dfn,"ssn"))
"RTN","SAMIUR2",1158,0)
 new ssn set ssn=tssn
"RTN","SAMIUR2",1159,0)
 if ssn'["-" do
"RTN","SAMIUR2",1160,0)
 . set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",1161,0)
 . quit
"RTN","SAMIUR2",1162,0)
 ;
"RTN","SAMIUR2",1163,0)
 quit ssn ; end of ppi $$SSN^SAMIUR2
"RTN","SAMIUR2",1164,0)
 ;
"RTN","SAMIUR2",1165,0)
 ;
"RTN","SAMIUR2",1166,0)
 ;
"RTN","SAMIUR2",1167,0)
SSNLABEL(SITE) ; extrinsic returns label for SSN (ie PID)
"RTN","SAMIUR2",1168,0)
 new RTN
"RTN","SAMIUR2",1169,0)
 set RTN=$$GET1PARM^SAMIPARM("socialSecurityNumber",SITE)
"RTN","SAMIUR2",1170,0)
 if RTN="" set RTN="SSN"
"RTN","SAMIUR2",1171,0)
 quit RTN
"RTN","SAMIUR2",1172,0)
 ;
"RTN","SAMIUR2",1173,0)
 ;
"RTN","SAMIUR2",1174,0)
 ;
"RTN","SAMIUR2",1175,0)
STUDYDT(zdt,dfn,SAMIPATS) ; latest study date
"RTN","SAMIUR2",1176,0)
 ;
"RTN","SAMIUR2",1177,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1178,0)
 ;@called-by
"RTN","SAMIUR2",1179,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1180,0)
 ;@calls
"RTN","SAMIUR2",1181,0)
 ; $$TDDT
"RTN","SAMIUR2",1182,0)
 ;
"RTN","SAMIUR2",1183,0)
 new stdt set stdt=$get(SAMIPATS(zdt,dfn,"cedos"))
"RTN","SAMIUR2",1184,0)
 ;
"RTN","SAMIUR2",1185,0)
 quit $$TDDT(stdt) ; end of ppi $$STUDYDT^SAMIUR2
"RTN","SAMIUR2",1186,0)
 ;
"RTN","SAMIUR2",1187,0)
 ;
"RTN","SAMIUR2",1188,0)
 ;
"RTN","SAMIUR2",1189,0)
STUDYTYP(zdt,dfn,SAMIPATS) ; latest study type
"RTN","SAMIUR2",1190,0)
 ;
"RTN","SAMIUR2",1191,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1192,0)
 ;@called-by
"RTN","SAMIUR2",1193,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1194,0)
 ;@calls
"RTN","SAMIUR2",1195,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1196,0)
 ;
"RTN","SAMIUR2",1197,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1198,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1199,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1200,0)
 ;
"RTN","SAMIUR2",1201,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1202,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1203,0)
 new stypx set stypx=$get(@vals@("cetex"))
"RTN","SAMIUR2",1204,0)
 new styp set styp=$select(stypx="a":"Annual",stypx="b":"Baseline",stypx="d":"Followup",1:"")
"RTN","SAMIUR2",1205,0)
 ;
"RTN","SAMIUR2",1206,0)
 quit styp ; end of ppi $$STUDYTYP^SAMIUR2
"RTN","SAMIUR2",1207,0)
 ;
"RTN","SAMIUR2",1208,0)
 ;
"RTN","SAMIUR2",1209,0)
 ;
"RTN","SAMIUR2",1210,0)
VALS(zdt,dfn,SAMIPATS) ; form-values cell
"RTN","SAMIUR2",1211,0)
 ;
"RTN","SAMIUR2",1212,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1213,0)
 ;@called-by
"RTN","SAMIUR2",1214,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1215,0)
 ;@calls
"RTN","SAMIUR2",1216,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1217,0)
 ;
"RTN","SAMIUR2",1218,0)
 new vrtn set vrtn=""
"RTN","SAMIUR2",1219,0)
 new vsid set vsid=$$DFN2SID(dfn)
"RTN","SAMIUR2",1220,0)
 new vgr set vgr="/vals?sid="_vsid_"&form="
"RTN","SAMIUR2",1221,0)
 quit:'$data(SAMIPATS)
"RTN","SAMIUR2",1222,0)
 ;
"RTN","SAMIUR2",1223,0)
 new vzi set vzi=""
"RTN","SAMIUR2",1224,0)
 for  do  quit:vzi="sort"  quit:vzi=""
"RTN","SAMIUR2",1225,0)
 . set vzi=$order(SAMIPATS(zdt,dfn,"items",vzi))
"RTN","SAMIUR2",1226,0)
 . quit:vzi="sort"
"RTN","SAMIUR2",1227,0)
 . quit:vzi=""
"RTN","SAMIUR2",1228,0)
 . set vrtn=vrtn_"<a href="""_vgr_vzi_""">"_vzi_"</a><br>"
"RTN","SAMIUR2",1229,0)
 . quit
"RTN","SAMIUR2",1230,0)
 ;
"RTN","SAMIUR2",1231,0)
 quit vrtn ; end of $$VALS^SAMIUR2
"RTN","SAMIUR2",1232,0)
 ;
"RTN","SAMIUR2",1233,0)
 ;
"RTN","SAMIUR2",1234,0)
 ;
"RTN","SAMIUR2",1235,0)
WHEN(zdt,dfn,SAMIPATS) ; followup text
"RTN","SAMIUR2",1236,0)
 ;
"RTN","SAMIUR2",1237,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1238,0)
 ;@called-by
"RTN","SAMIUR2",1239,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1240,0)
 ;@calls
"RTN","SAMIUR2",1241,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1242,0)
 ;
"RTN","SAMIUR2",1243,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1244,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1245,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1246,0)
 ;
"RTN","SAMIUR2",1247,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1248,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1249,0)
 new whnx set whnx=$get(@vals@("cefuw"))
"RTN","SAMIUR2",1250,0)
 quit:whnx="" ""
"RTN","SAMIUR2",1251,0)
 ;
"RTN","SAMIUR2",1252,0)
 new DICT
"RTN","SAMIUR2",1253,0)
 set DICT("cefuw","1m")="in one month"
"RTN","SAMIUR2",1254,0)
 set DICT("cefuw","1y")="in one year"
"RTN","SAMIUR2",1255,0)
 set DICT("cefuw","3m")="in three months"
"RTN","SAMIUR2",1256,0)
 set DICT("cefuw","6m")="in six months"
"RTN","SAMIUR2",1257,0)
 set DICT("cefuw","os")="other as specified"
"RTN","SAMIUR2",1258,0)
 set whn=$get(DICT("cefuw",whnx))
"RTN","SAMIUR2",1259,0)
 ;
"RTN","SAMIUR2",1260,0)
 quit whn ; end of ppi $$WHEN^SAMIUR2
"RTN","SAMIUR2",1261,0)
 ;
"RTN","SAMIUR2",1262,0)
 ;
"RTN","SAMIUR2",1263,0)
 ;
"RTN","SAMIUR2",1264,0)
WORKPAT(ien,dfn,SAMIPATS) ; worklist patient name cell
"RTN","SAMIUR2",1265,0)
 ;
"RTN","SAMIUR2",1266,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1267,0)
 ;@called-by
"RTN","SAMIUR2",1268,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1269,0)
 ;@calls none
"RTN","SAMIUR2",1270,0)
 ;
"RTN","SAMIUR2",1271,0)
 new zcell set zcell=""
"RTN","SAMIUR2",1272,0)
 set zcell=zcell_$get(SAMIPATS(ien,dfn,"workref"))
"RTN","SAMIUR2",1273,0)
 ;
"RTN","SAMIUR2",1274,0)
 quit zcell ; end of ppi $$WORKPAT^SAMIUR2
"RTN","SAMIUR2",1275,0)
 ;
"RTN","SAMIUR2",1276,0)
 ;
"RTN","SAMIUR2",1277,0)
 ;
"RTN","SAMIUR2",1278,0)
 ;@section 5 unused subroutines
"RTN","SAMIUR2",1279,0)
 ;
"RTN","SAMIUR2",1280,0)
 ;
"RTN","SAMIUR2",1281,0)
 ;
"RTN","SAMIUR2",1282,0)
EPAT(ien,dfn,SAMIPATS) ; patient name w/nav to enrollment
"RTN","SAMIUR2",1283,0)
 ;
"RTN","SAMIUR2",1284,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIUR2",1285,0)
 ;@called-by none
"RTN","SAMIUR2",1286,0)
 ;@calls none
"RTN","SAMIUR2",1287,0)
 ;
"RTN","SAMIUR2",1288,0)
 quit  ; end of $$EPAT
"RTN","SAMIUR2",1289,0)
 ;
"RTN","SAMIUR2",1290,0)
 ;
"RTN","SAMIUR2",1291,0)
 ;
"RTN","SAMIUR2",1292,0)
ETHNCTY(zdt,dfn,SAMIPATS) ; ethnicity
"RTN","SAMIUR2",1293,0)
 ;
"RTN","SAMIUR2",1294,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1295,0)
 ;@called-by none
"RTN","SAMIUR2",1296,0)
 ;@calls none
"RTN","SAMIUR2",1297,0)
 ;
"RTN","SAMIUR2",1298,0)
 quit "ethnicity" ; end of $$ETHNCTY
"RTN","SAMIUR2",1299,0)
 ;
"RTN","SAMIUR2",1300,0)
 ;
"RTN","SAMIUR2",1301,0)
 ;
"RTN","SAMIUR2",1302,0)
RACE(zdt,dfn,SAMIPATS) ; race
"RTN","SAMIUR2",1303,0)
 ;
"RTN","SAMIUR2",1304,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1305,0)
 ;@called-by none [call commented out in RPTTBL]
"RTN","SAMIUR2",1306,0)
 ;@calls
"RTN","SAMIUR2",1307,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1308,0)
 ;
"RTN","SAMIUR2",1309,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1310,0)
 new race set race=$get(@root@(dfn,"race"))
"RTN","SAMIUR2",1311,0)
 ;
"RTN","SAMIUR2",1312,0)
 quit race ; end of $$RACE
"RTN","SAMIUR2",1313,0)
 ;
"RTN","SAMIUR2",1314,0)
 ;
"RTN","SAMIUR2",1315,0)
 ;
"RTN","SAMIUR2",1316,0)
STATUS(zdt,dfn,SAMIPATS) ; patient status
"RTN","SAMIUR2",1317,0)
 ;
"RTN","SAMIUR2",1318,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1319,0)
 ;@called-by none
"RTN","SAMIUR2",1320,0)
 ;@calls
"RTN","SAMIUR2",1321,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1322,0)
 ;
"RTN","SAMIUR2",1323,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1324,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1325,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1326,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1327,0)
 new stat set stat=$get(@vals@("sistatus"))
"RTN","SAMIUR2",1328,0)
 ;
"RTN","SAMIUR2",1329,0)
 quit stat ; end of $$STATUS
"RTN","SAMIUR2",1330,0)
 ;
"RTN","SAMIUR2",1331,0)
 ;
"RTN","SAMIUR2",1332,0)
 ;
"RTN","SAMIUR2",1333,0)
WSVALS(RTN,FILTER) ; display form values from graph
"RTN","SAMIUR2",1334,0)
 ;
"RTN","SAMIUR2",1335,0)
 ;;web service;procedure;clean;silent;sac
"RTN","SAMIUR2",1336,0)
 ;@called-by none
"RTN","SAMIUR2",1337,0)
 ;@calls
"RTN","SAMIUR2",1338,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1339,0)
 ; wsGtree^SYNVPR
"RTN","SAMIUR2",1340,0)
 ;
"RTN","SAMIUR2",1341,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1342,0)
 new sid set sid=$get(FILTER("sid"))
"RTN","SAMIUR2",1343,0)
 if sid="" set sid=$get(FILTER("studyid"))
"RTN","SAMIUR2",1344,0)
 quit:sid=""
"RTN","SAMIUR2",1345,0)
 ;
"RTN","SAMIUR2",1346,0)
 new zform set zform=$get(FILTER("form"))
"RTN","SAMIUR2",1347,0)
 new groot
"RTN","SAMIUR2",1348,0)
 if zform="" set groot=$name(@root@("graph",sid))
"RTN","SAMIUR2",1349,0)
 else  set groot=$name(@root@("graph",sid,zform))
"RTN","SAMIUR2",1350,0)
 set FILTER("root")=$extract(groot,2,$length(groot))
"RTN","SAMIUR2",1351,0)
 ;
"RTN","SAMIUR2",1352,0)
 do wsGtree^SYNVPR(.RTN,.FILTER)
"RTN","SAMIUR2",1353,0)
 ;
"RTN","SAMIUR2",1354,0)
 quit  ; end of ws WSVALS^SAMIUR2
"RTN","SAMIUR2",1355,0)
 ;
"RTN","SAMIUR2",1356,0)
 ;
"RTN","SAMIUR2",1357,0)
 ;
"RTN","SAMIUR2",1358,0)
EOR ; end of routine SAMIUR2
"RTN","SAMIURUL")
0^6^B116379
"RTN","SAMIURUL",1,0)
SAMIURUL ;ven/gpl - user reports log; 2024-08-22t21:22z
"RTN","SAMIURUL",2,0)
 ;;18.0;SAMI;**12,14,15,17**;2020-01-17;Build 8
"RTN","SAMIURUL",3,0)
 ;mdc-e1;SAMIURUL-20240822-E03Rmk2v;SAMI-18-17-b6
"RTN","SAMIURUL",4,0)
 ;mdc-v7;B116379;SAMI*18.0*17 SEQ #17
"RTN","SAMIURUL",5,0)
 ;
"RTN","SAMIURUL",6,0)
 ; SAMIURUL contains the development log & module documentation for
"RTN","SAMIURUL",7,0)
 ; the ScreeningPlus user-reports routines SAMIUR & SAMIUR2. It
"RTN","SAMIURUL",8,0)
 ; contains no public interfaces or executable code.
"RTN","SAMIURUL",9,0)
 ;
"RTN","SAMIURUL",10,0)
 quit  ; no entry from top
"RTN","SAMIURUL",11,0)
 ;
"RTN","SAMIURUL",12,0)
 ;
"RTN","SAMIURUL",13,0)
 ;
"RTN","SAMIURUL",14,0)
 ;
"RTN","SAMIURUL",15,0)
 ;@section 0 primary development
"RTN","SAMIURUL",16,0)
 ;
"RTN","SAMIURUL",17,0)
 ;
"RTN","SAMIURUL",18,0)
 ;
"RTN","SAMIURUL",19,0)
 ;
"RTN","SAMIURUL",20,0)
 ;@routine-credits
"RTN","SAMIURUL",21,0)
 ;
"RTN","SAMIURUL",22,0)
 ;@dev Frederick D. S. Marshall (toad)
"RTN","SAMIURUL",23,0)
 ; toad@vistaexpertise.net
"RTN","SAMIURUL",24,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIURUL",25,0)
 ; http://vistaexpertise.net
"RTN","SAMIURUL",26,0)
 ;@copyright 2021/2024, mcglk & toad, all rights reserved
"RTN","SAMIURUL",27,0)
 ;@license see routine SAMIUL
"RTN","SAMIURUL",28,0)
 ;
"RTN","SAMIURUL",29,0)
 ;@update 2024-08-22t21:22z
"RTN","SAMIURUL",30,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIURUL",31,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIURUL",32,0)
 ;@module User Reports - SAMIUR
"RTN","SAMIURUL",33,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIURUL",34,0)
 ;@release 18-17
"RTN","SAMIURUL",35,0)
 ;@edition-date 2020-01-17
"RTN","SAMIURUL",36,0)
 ;@patches **12,14,15,17**
"RTN","SAMIURUL",37,0)
 ;
"RTN","SAMIURUL",38,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIURUL",39,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIURUL",40,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIURUL",41,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIURUL",42,0)
 ;
"RTN","SAMIURUL",43,0)
 ;@module-credits
"RTN","SAMIURUL",44,0)
 ;
"RTN","SAMIURUL",45,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIURUL",46,0)
 ; (VA-PALS)
"RTN","SAMIURUL",47,0)
 ; http://va-pals.org/
"RTN","SAMIURUL",48,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIURUL",49,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIURUL",50,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIURUL",51,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIURUL",52,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIURUL",53,0)
 ; http://ielcap.com/
"RTN","SAMIURUL",54,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIURUL",55,0)
 ; http://paraxialtech.com/
"RTN","SAMIURUL",56,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIURUL",57,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIURUL",58,0)
 ;
"RTN","SAMIURUL",59,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIURUL",60,0)
 ;
"RTN","SAMIURUL",61,0)
 ; 2020-02-10/12 ven/gpl 18-t4 d543f7bb,f9869dfb,0e4d8b9a,5e67489f
"RTN","SAMIURUL",62,0)
 ;  SAMIUR,SAMIUR2 1st version of revised user reports, progress on
"RTN","SAMIURUL",63,0)
 ; user reports, fixed a bug in enrollment report, add rural/urban &
"RTN","SAMIURUL",64,0)
 ; compute.
"RTN","SAMIURUL",65,0)
 ;
"RTN","SAMIURUL",66,0)
 ; 2020-02-18 ven/lgc 18-t4 76874314
"RTN","SAMIURUL",67,0)
 ;  SAMIUR update recently edited routines.
"RTN","SAMIURUL",68,0)
 ;
"RTN","SAMIURUL",69,0)
 ; 2020-03-10/12 ven/gpl 18-t4 8de06b06,4ad52d64
"RTN","SAMIURUL",70,0)
 ;  SAMIUR user report date filtering, fix end date logic in UR.
"RTN","SAMIURUL",71,0)
 ;
"RTN","SAMIURUL",72,0)
 ; 2019-03-24/28 ven/gpl 18-t4 1fd4a4c8,0cebb36b
"RTN","SAMIURUL",73,0)
 ;  SAMIUR2 revise incomplete form report, remove ethnicity from
"RTN","SAMIURUL",74,0)
 ; enrollment report (we can't get it).
"RTN","SAMIURUL",75,0)
 ;
"RTN","SAMIURUL",76,0)
 ; 2020-04-16/23 ven/lgc 18-t4 e54b76d1b,89bffd3b
"RTN","SAMIURUL",77,0)
 ;  SAMIUR SAMIFRM2 > SAMIFORM, SAMISUB2 > LOAD.
"RTN","SAMIURUL",78,0)
 ;
"RTN","SAMIURUL",79,0)
 ; 2019-05-08 ven/lgc 18 2172e512
"RTN","SAMIURUL",80,0)
 ;  SAMIUR2 remove blank last line.
"RTN","SAMIURUL",81,0)
 ;
"RTN","SAMIURUL",82,0)
 ; 2019-06-21 par/dom 18 c6a4a57f VAP-352
"RTN","SAMIURUL",83,0)
 ;  SAMIUR2 proper spelling of "follow up."
"RTN","SAMIURUL",84,0)
 ;
"RTN","SAMIURUL",85,0)
 ; 2019-08-03/04 ven/gpl 18 ffc94f65,d03557d4,cd865e2b VPA-438
"RTN","SAMIURUL",86,0)
 ;  SAMIUR requested changes to followup report.
"RTN","SAMIURUL",87,0)
 ;  SAMIUR2 fix smoking status on enrollment report, fix change log
"RTN","SAMIURUL",88,0)
 ; display, add pack years at intake to enrollment report, add
"RTN","SAMIURUL",89,0)
 ; requested changes to followup report.
"RTN","SAMIURUL",90,0)
 ;
"RTN","SAMIURUL",91,0)
 ; 2019-09-26 ven/gpl 18 92b12324 VAP-420
"RTN","SAMIURUL",92,0)
 ;  SAMIUR add smoking history.
"RTN","SAMIURUL",93,0)
 ;  SAMIUR2 smoking history, new cummulative packyear processing.
"RTN","SAMIURUL",94,0)
 ;
"RTN","SAMIURUL",95,0)
 ; 2019-10-01 par/dom 18 4caf1a98 VAP-344
"RTN","SAMIURUL",96,0)
 ;  SAMIUR2 make capitalization consistent.
"RTN","SAMIURUL",97,0)
 ;
"RTN","SAMIURUL",98,0)
 ; 2020-01-01/05 ven/arc 18 399f8547,62e3200f
"RTN","SAMIURUL",99,0)
 ;  SAMIUR unmatched participant processing.
"RTN","SAMIURUL",100,0)
 ;  SAMIUR2 add unmatched patient processing.
"RTN","SAMIURUL",101,0)
 ;
"RTN","SAMIURUL",102,0)
 ; 2020-01-10 ven/gpl 18 1590577c
"RTN","SAMIURUL",103,0)
 ;  SAMIUR2 fix return on RACE^SAMIUR2 for cache.
"RTN","SAMIURUL",104,0)
 ;
"RTN","SAMIURUL",105,0)
 ; 2020-04-29/05-13 ven/gpl 18-5 e8b8ea2d,61c7d208
"RTN","SAMIURUL",106,0)
 ;  SAMIUR fixes for reports, worklist functionality.
"RTN","SAMIURUL",107,0)
 ;
"RTN","SAMIURUL",108,0)
 ; 2020-05-13/14 ven/gpl 18-5 61c7d208,b05df417
"RTN","SAMIURUL",109,0)
 ;  SAMIUR2 add worklist functionality, fix gender & dob detection on
"RTN","SAMIURUL",110,0)
 ; reports.
"RTN","SAMIURUL",111,0)
 ;
"RTN","SAMIURUL",112,0)
 ; 2021-03-22/23 ven/gpl 18-10 256efe63,ba81b86a
"RTN","SAMIURUL",113,0)
 ;  SAMIUR sort all reports by name, added row totals to reports.
"RTN","SAMIURUL",114,0)
 ;
"RTN","SAMIURUL",115,0)
 ; 2021-03-23 ven/toad 18-10 96f461d0,af86e0eb
"RTN","SAMIURUL",116,0)
 ;  SAMIUR add version info & dev log, lt refactor, fix XINDEX
"RTN","SAMIURUL",117,0)
 ; errors.
"RTN","SAMIURUL",118,0)
 ;
"RTN","SAMIURUL",119,0)
 ; 2021-03-29 ven/gpl 18-11 e809f2a2
"RTN","SAMIURUL",120,0)
 ;  SAMIUR prevent crash when reports have no matches: in WSREPORT
"RTN","SAMIURUL",121,0)
 ; set SRT="" and uncomment zwrite SRT; in WKLIST add 2 commented-out
"RTN","SAMIURUL",122,0)
 ; debugging lines.
"RTN","SAMIURUL",123,0)
 ;
"RTN","SAMIURUL",124,0)
 ; 2021-03-30 ven/toad 18-11 7b14bb29
"RTN","SAMIURUL",125,0)
 ;  SAMIUR bump version, date, log; in WSREPORT comment zwrite SRT.
"RTN","SAMIURUL",126,0)
 ;
"RTN","SAMIURUL",127,0)
 ; 2021-03-31 ven/gpl 18-11 66d89cde
"RTN","SAMIURUL",128,0)
 ;  SAMIUR sort on all uppercase names for reports
"RTN","SAMIURUL",129,0)
 ;
"RTN","SAMIURUL",130,0)
 ; 2021-04-13 ven/gpl 18-11 a12765bf,f09ffef9,fb399aba
"RTN","SAMIURUL",131,0)
 ;  SAMIUR inactive report created.
"RTN","SAMIURUL",132,0)
 ;  SAMIUR2 in RPTTBL,GENDER create inactive report, move last exam
"RTN","SAMIURUL",133,0)
 ; column on followup report, fix gender being blank in reports.
"RTN","SAMIURUL",134,0)
 ;
"RTN","SAMIURUL",135,0)
 ; 2021-05-20/25 ven/mcglk&toad 18-11 43a4557c,70fc6ba3,129e96b1,
"RTN","SAMIURUL",136,0)
 ; cee2bf17
"RTN","SAMIURUL",137,0)
 ;  SAMIUR annotate, lt refactor, bump version.
"RTN","SAMIURUL",138,0)
 ;  SAMIUR2 passim hdr comments, chg log, annotate, refactor, bump
"RTN","SAMIURUL",139,0)
 ; version.
"RTN","SAMIURUL",140,0)
 ;
"RTN","SAMIURUL",141,0)
 ; 2021-05-29 ven/gpl 18-12-t2 e6fd5730,a3d6f9a0
"RTN","SAMIURUL",142,0)
 ;  SAMIUR,SAMIUR2 ssn params & matching report, update unmatched
"RTN","SAMIURUL",143,0)
 ; report headings.
"RTN","SAMIURUL",144,0)
 ;
"RTN","SAMIURUL",145,0)
 ; 2021-06-15 ven/gpl 18-12-t2 7e481426
"RTN","SAMIURUL",146,0)
 ;  SAMIUR add site to editperson navigation.
"RTN","SAMIURUL",147,0)
 ;
"RTN","SAMIURUL",148,0)
 ; 2021-06-28 ven/gpl 18-12-t2 df0aaea1,1137e2bb
"RTN","SAMIURUL",149,0)
 ;  SAMIUR change definition of inactive to not marked active, change
"RTN","SAMIURUL",150,0)
 ; definition of active to marked active.
"RTN","SAMIURUL",151,0)
 ;
"RTN","SAMIURUL",152,0)
 ; 2021-07-06 ven/mcglk&toad&gpl 18-12-t2 cbf7e46b,2d642aa4,
"RTN","SAMIURUL",153,0)
 ; b248664b
"RTN","SAMIURUL",154,0)
 ;  SAMIURUL new routine for dev log.
"RTN","SAMIURUL",155,0)
 ;  SAMIUR,SAMIUR2,SAMIURUL move dev log & module docs to SAMIURUL,
"RTN","SAMIURUL",156,0)
 ; bump version & dates.
"RTN","SAMIURUL",157,0)
 ;  SAMIUR in SELECT r/inactive w/status, test for active instead of
"RTN","SAMIURUL",158,0)
 ; inactive.
"RTN","SAMIURUL",159,0)
 ;
"RTN","SAMIURUL",160,0)
 ; 2021-07-12 ven/gpl 18-12-t3 60f4bb05,27c40485,d35bcb46
"RTN","SAMIURUL",161,0)
 ;  SAMIUR in WSREPORT,SORT add contact date & entry to missingct
"RTN","SAMIURUL",162,0)
 ; report.
"RTN","SAMIURUL",163,0)
 ;  SAMIUR2 add contact date & entry to missingct report; add
"RTN","SAMIURUL",164,0)
 ; inactive date reason & comment to inactive report; chg inactive
"RTN","SAMIURUL",165,0)
 ; date to date of death.
"RTN","SAMIURUL",166,0)
 ;
"RTN","SAMIURUL",167,0)
 ; 2021-08-01 ven/gpl 18-12 5bd7c627
"RTN","SAMIURUL",168,0)
 ;  SAMIUR set intake form to incomplete on creation: in SELECT if
"RTN","SAMIURUL",169,0)
 ; type="incomplete" ensure default status is incomplete.
"RTN","SAMIURUL",170,0)
 ;
"RTN","SAMIURUL",171,0)
 ; 2021-08-11 ven/gpl 18-12 4d4f0fc3
"RTN","SAMIURUL",172,0)
 ;  SAMIUR,SAMIUR2 add sorting to tables used for reports.
"RTN","SAMIURUL",173,0)
 ;  SAMIUR in WSREPORT,NUHREF,WKLIST.
"RTN","SAMIURUL",174,0)
 ;  SAMIUR2 in TDDT,BLINEDT,DOB,FUDATE,LASTEXM,INACTDT,LDOC,STUDYDT.
"RTN","SAMIURUL",175,0)
 ;
"RTN","SAMIURUL",176,0)
 ; 2021-08-26 ven/gpl 18-14 de044cf9
"RTN","SAMIURUL",177,0)
 ;  SAMIUR, SAMIUR2 make changes to user reports as requested.
"RTN","SAMIURUL",178,0)
 ; Reports changed were Enrollment, Activity, and Follow-up.
"RTN","SAMIURUL",179,0)
 ;
"RTN","SAMIURUL",180,0)
 ; 2021-08-28 ven/gpl 18-14 cd69ff8b, fbd9196d
"RTN","SAMIURUL",181,0)
 ;  SAMIUR, SAMIUR2 fix bugs in Activity report; fix problem with Work
"RTN","SAMIURUL",182,0)
 ; List.
"RTN","SAMIURUL",183,0)
 ;
"RTN","SAMIURUL",184,0)
 ; 2021-09-09 ven/gpl 18-14 afa4bfc2, 7f668e64, 8d45ebac
"RTN","SAMIURUL",185,0)
 ;  SAMIUR fix bugs in reports showing inactive patients on wrong
"RTN","SAMIURUL",186,0)
 ; reports, "baseline" showing up in F/U date on Follow-up report,
"RTN","SAMIURUL",187,0)
 ; wrong patients on Intake but Missing CT Eval report.
"RTN","SAMIURUL",188,0)
 ;
"RTN","SAMIURUL",189,0)
 ; 2021-10-05 ven/gpl 18-14 3251c582, c4343d69, 368fa7f7, c4343d69
"RTN","SAMIURUL",190,0)
 ; b3cd039b, 237109df, 368fa7f7
"RTN","SAMIURUL",191,0)
 ;  SAMIIUR, SAMIUR2 fix small bugs, make date formats consistent,
"RTN","SAMIURUL",192,0)
 ; bump versions & dates.
"RTN","SAMIURUL",193,0)
 ;
"RTN","SAMIURUL",194,0)
 ; 2021-10-14 ven/gpl 18-14  6a973630
"RTN","SAMIURUL",195,0)
 ;  SAMIUR fix bug where patients with CT Evals would appear on Intake
"RTN","SAMIURUL",196,0)
 ; but no CT report.
"RTN","SAMIURUL",197,0)
 ;
"RTN","SAMIURUL",198,0)
 ; 2021-10-15 ven/lmry 18-14 87fd8eb3
"RTN","SAMIURUL",199,0)
 ;  SAMIUR, SAMIURUL update history, bump dates.
"RTN","SAMIURUL",200,0)
 ;
"RTN","SAMIURUL",201,0)
 ; 2021-10-20 ven/gpl 18-15 b63bfc06
"RTN","SAMIURUL",202,0)
 ;  SAMIUR2  suppress rural column in enrollment report if not VA.
"RTN","SAMIURUL",203,0)
 ;
"RTN","SAMIURUL",204,0)
 ; 2021-10-25 ven/gpl 18-15 b6188d2c
"RTN","SAMIURUL",205,0)
 ;  SAMIUR fix for duplicates in work list & matching reports.
"RTN","SAMIURUL",206,0)
 ;
"RTN","SAMIURUL",207,0)
 ; 2021-10-28 ven/lmry,mcglk 18-15
"RTN","SAMIURUL",208,0)
 ;  SAMIUR, SAMIUR2, SAMIURUL update history, bump dates & versions.
"RTN","SAMIURUL",209,0)
 ;
"RTN","SAMIURUL",210,0)
 ; 2021-10-29 ven/lmry 18-15
"RTN","SAMIURUL",211,0)
 ;  SAMIUR remove blank at end of line for XINDEX.
"RTN","SAMIURUL",212,0)
 ;
"RTN","SAMIURUL",213,0)
 ; 2022-12-15/17 ven/gpl 18-17
"RTN","SAMIURUL",214,0)
 ;  SAMIUR, SAMIUR2 develop new CT Eval Recommendation report.
"RTN","SAMIURUL",215,0)
 ;
"RTN","SAMIURUL",216,0)
 ; 2022-12-30 ven/lmry 18-17
"RTN","SAMIURUL",217,0)
 ;  SAMIUR, SAMIUR2, SAMIURUL update history, bump dates & versions.
"RTN","SAMIURUL",218,0)
 ;
"RTN","SAMIURUL",219,0)
 ; 2022-12-30 ven/lmry 18-17
"RTN","SAMIURUL",220,0)
 ;  SAMIUR remove blank at end of line for XINDEX.
"RTN","SAMIURUL",221,0)
 ;
"RTN","SAMIURUL",222,0)
 ; 2023-01-04 ven/gpl  18-17
"RTN","SAMIURUL",223,0)
 ;  SAMIUR fix bug to make data appear in new report.
"RTN","SAMIURUL",224,0)
 ;
"RTN","SAMIURUL",225,0)
 ; 2024-08-17 ven/lmry 18-17
"RTN","SAMIURUL",226,0)
 ;  SAMIUR bump dates, update contents, remove space at end of line.
"RTN","SAMIURUL",227,0)
 ;  SAMIUR2 bump dates.
"RTN","SAMIURUL",228,0)
 ;  SAMIURUL add history, bump dates.
"RTN","SAMIURUL",229,0)
 ;
"RTN","SAMIURUL",230,0)
 ; 2024-08-21/22 ven/toad 18-17-b6
"RTN","SAMIURUL",231,0)
 ;  SAMIUR annotate.
"RTN","SAMIURUL",232,0)
 ;  SAMIURUL update history.
"RTN","SAMIURUL",233,0)
 ;  SAMIUR,2,UL update version-control lines, hdr comments, comment
"RTN","SAMIURUL",234,0)
 ; out ^gpl debugging lines.
"RTN","SAMIURUL",235,0)
 ;
"RTN","SAMIURUL",236,0)
 ;
"RTN","SAMIURUL",237,0)
 ;@contents
"RTN","SAMIURUL",238,0)
 ;
"RTN","SAMIURUL",239,0)
 ; SAMIUR user reports
"RTN","SAMIURUL",240,0)
 ; SAMIUR1 [to be added]
"RTN","SAMIURUL",241,0)
 ; SAMIUR2 user reports cont
"RTN","SAMIURUL",242,0)
 ; SAMIURUL user reports log
"RTN","SAMIURUL",243,0)
 ; SAMIUTUR user reports tests
"RTN","SAMIURUL",244,0)
 ;
"RTN","SAMIURUL",245,0)
 ;
"RTN","SAMIURUL",246,0)
 ;
"RTN","SAMIURUL",247,0)
EOR ; end of SAMIURUL
"VER")
8.0^22.2
**END**
**END**
