KIDS Distribution saved on Sep 12, 2024@10:25:33
Released SAMI*18.0*18 SEQ #18
**KIDS**:SAMI*18.0*18^

**INSTALL NAME**
SAMI*18.0*18
"BLD",11519,0)
SAMI*18.0*18^SAMI^0^3240912^n
"BLD",11519,4,0)
^9.64PA^311.11^1
"BLD",11519,4,311.11,0)
311.11
"BLD",11519,4,311.11,222)
y^y^f^^n^SAMI FILE UPLOAD^y^o^n
"BLD",11519,4,"B",311.11,311.11)

"BLD",11519,6.3)
1
"BLD",11519,"INIT")
POS1818^SAMIPAT
"BLD",11519,"KRN",0)
^9.67PA^1.5^25
"BLD",11519,"KRN",.4,0)
.4
"BLD",11519,"KRN",.401,0)
.401
"BLD",11519,"KRN",.402,0)
.402
"BLD",11519,"KRN",.403,0)
.403
"BLD",11519,"KRN",.5,0)
.5
"BLD",11519,"KRN",.84,0)
.84
"BLD",11519,"KRN",1.5,0)
1.5
"BLD",11519,"KRN",1.6,0)
1.6
"BLD",11519,"KRN",1.61,0)
1.61
"BLD",11519,"KRN",1.62,0)
1.62
"BLD",11519,"KRN",3.6,0)
3.6
"BLD",11519,"KRN",3.8,0)
3.8
"BLD",11519,"KRN",9.2,0)
9.2
"BLD",11519,"KRN",9.8,0)
9.8
"BLD",11519,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",11519,"KRN",9.8,"NM",1,0)
SAMICAS2^^0^B1038606997
"BLD",11519,"KRN",9.8,"NM",2,0)
SAMICASE^^0^B3026427
"BLD",11519,"KRN",9.8,"NM",3,0)
SAMICUL^^0^B180174
"BLD",11519,"KRN",9.8,"NM",4,0)
SAMIDCM1^^0^B233069568
"BLD",11519,"KRN",9.8,"NM",5,0)
SAMIDCM2^^0^B13901388
"BLD",11519,"KRN",9.8,"NM",6,0)
SAMIHOM4^^0^B1434661517
"BLD",11519,"KRN",9.8,"NM",7,0)
SAMIHUL^^0^B149598
"BLD",11519,"KRN",9.8,"NM",8,0)
SAMIMSH1^^0^B9513892
"BLD",11519,"KRN",9.8,"NM",9,0)
SAMIPAT^^0^B17504242
"BLD",11519,"KRN",9.8,"NM",10,0)
SAMIPTLK^^0^B50934240
"BLD",11519,"KRN",9.8,"NM",11,0)
SAMIUID^^0^B15836538
"BLD",11519,"KRN",9.8,"NM",12,0)
SAMIUR2^^0^B1541171009
"BLD",11519,"KRN",9.8,"NM",13,0)
SAMIURUL^^0^B118219
"BLD",11519,"KRN",9.8,"NM","B","SAMICAS2",1)

"BLD",11519,"KRN",9.8,"NM","B","SAMICASE",2)

"BLD",11519,"KRN",9.8,"NM","B","SAMICUL",3)

"BLD",11519,"KRN",9.8,"NM","B","SAMIDCM1",4)

"BLD",11519,"KRN",9.8,"NM","B","SAMIDCM2",5)

"BLD",11519,"KRN",9.8,"NM","B","SAMIHOM4",6)

"BLD",11519,"KRN",9.8,"NM","B","SAMIHUL",7)

"BLD",11519,"KRN",9.8,"NM","B","SAMIMSH1",8)

"BLD",11519,"KRN",9.8,"NM","B","SAMIPAT",9)

"BLD",11519,"KRN",9.8,"NM","B","SAMIPTLK",10)

"BLD",11519,"KRN",9.8,"NM","B","SAMIUID",11)

"BLD",11519,"KRN",9.8,"NM","B","SAMIUR2",12)

"BLD",11519,"KRN",9.8,"NM","B","SAMIURUL",13)

"BLD",11519,"KRN",19,0)
19
"BLD",11519,"KRN",19.1,0)
19.1
"BLD",11519,"KRN",101,0)
101
"BLD",11519,"KRN",409.61,0)
409.61
"BLD",11519,"KRN",771,0)
771
"BLD",11519,"KRN",779.2,0)
779.2
"BLD",11519,"KRN",870,0)
870
"BLD",11519,"KRN",8989.51,0)
8989.51
"BLD",11519,"KRN",8989.52,0)
8989.52
"BLD",11519,"KRN",8993,0)
8993
"BLD",11519,"KRN",8994,0)
8994
"BLD",11519,"KRN","B",.4,.4)

"BLD",11519,"KRN","B",.401,.401)

"BLD",11519,"KRN","B",.402,.402)

"BLD",11519,"KRN","B",.403,.403)

"BLD",11519,"KRN","B",.5,.5)

"BLD",11519,"KRN","B",.84,.84)

"BLD",11519,"KRN","B",1.5,1.5)

"BLD",11519,"KRN","B",1.6,1.6)

"BLD",11519,"KRN","B",1.61,1.61)

"BLD",11519,"KRN","B",1.62,1.62)

"BLD",11519,"KRN","B",3.6,3.6)

"BLD",11519,"KRN","B",3.8,3.8)

"BLD",11519,"KRN","B",9.2,9.2)

"BLD",11519,"KRN","B",9.8,9.8)

"BLD",11519,"KRN","B",19,19)

"BLD",11519,"KRN","B",19.1,19.1)

"BLD",11519,"KRN","B",101,101)

"BLD",11519,"KRN","B",409.61,409.61)

"BLD",11519,"KRN","B",771,771)

"BLD",11519,"KRN","B",779.2,779.2)

"BLD",11519,"KRN","B",870,870)

"BLD",11519,"KRN","B",8989.51,8989.51)

"BLD",11519,"KRN","B",8989.52,8989.52)

"BLD",11519,"KRN","B",8993,8993)

"BLD",11519,"KRN","B",8994,8994)

"BLD",11519,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",11519,"QUES",0)
^9.62^^
"BLD",11519,"REQB",0)
^9.611^^
"DATA",311.11,46,0)
vapals:fileupload
"DATA",311.11,46,2)
^fileupload.html
"FIA",311.11)
SAMI FORM MAPPING
"FIA",311.11,0)
^SAMI(311.11,
"FIA",311.11,0,0)
311.11
"FIA",311.11,0,1)
y^y^f^^n^SAMI FILE UPLOAD^y^o^n
"FIA",311.11,0,10)

"FIA",311.11,0,11)

"FIA",311.11,0,"RLRO")
^DIBT(953,1)
"FIA",311.11,0,"VR")
18.0^SAMI
"FIA",311.11,311.11)
0
"FIA",311.11,311.11001)
0
"INIT")
POS1818^SAMIPAT
"IX",311.11,311.11,"D",0)
311.11^D^Select variables by DD # & field #^R^^R^IR^W^311.11001^^^^^LS
"IX",311.11,311.11,"D",1)
S ^SAMI(311.11,"D",X(1),X(2),DA(1),DA)=""
"IX",311.11,311.11,"D",2)
K ^SAMI(311.11,"D",X(1),X(2),DA(1),DA)
"IX",311.11,311.11,"D",2.5)
K ^SAMI(311.11,"D")
"IX",311.11,311.11,"D",11.1,0)
^.114IA^2^2
"IX",311.11,311.11,"D",11.1,1,0)
1^F^311.11001^.5^^1^F
"IX",311.11,311.11,"D",11.1,1,3)

"IX",311.11,311.11,"D",11.1,2,0)
2^F^311.11001^1^^2^F
"IX",311.11,311.11,"D",11.1,2,3)

"MBREQ")
0
"PKG",230,-1)
1^1
"PKG",230,0)
SAMI^SAMI^SCREENING APPLICATIONS MANAGEMENT - IELCAP
"PKG",230,22,0)
^9.49I^1^1
"PKG",230,22,1,0)
18.0^3191203
"PKG",230,22,1,"PAH",1,0)
18^3240912
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","SAMICAS2")
0^1^B1038606997^B447463890
"RTN","SAMICAS2",1,0)
SAMICAS2 ;ven/gpl - case review cont; 2024-09-12t02:38z
"RTN","SAMICAS2",2,0)
 ;;18.0;SAMI;**1,5,9,12,14,18**;2020-01-17;Build 1
"RTN","SAMICAS2",3,0)
 ;mdc-e1;SAMICAS2-20240912-E3LDT9K;SAMI-18-18-b1
"RTN","SAMICAS2",4,0)
 ;mdc-v7;B1038606997;SAMI*18.0*18 SEQ #18
"RTN","SAMICAS2",5,0)
 ;
"RTN","SAMICAS2",6,0)
 ; SAMICAS2 contains ppses and other subroutines to support processing
"RTN","SAMICAS2",7,0)
 ; of the VAPALS case review page.
"RTN","SAMICAS2",8,0)
 ;
"RTN","SAMICAS2",9,0)
 quit  ; no entry from top
"RTN","SAMICAS2",10,0)
 ;
"RTN","SAMICAS2",11,0)
 ;
"RTN","SAMICAS2",12,0)
 ;
"RTN","SAMICAS2",13,0)
 ;@section 0 primary development
"RTN","SAMICAS2",14,0)
 ;
"RTN","SAMICAS2",15,0)
 ;
"RTN","SAMICAS2",16,0)
 ;
"RTN","SAMICAS2",17,0)
 ;@routine-credits
"RTN","SAMICAS2",18,0)
 ;@license see routine SAMIUL
"RTN","SAMICAS2",19,0)
 ;@documentation see SAMICUL
"RTN","SAMICAS2",20,0)
 ;@contents
"RTN","SAMICAS2",21,0)
 ;
"RTN","SAMICAS2",22,0)
 ;  1. wsCASE & related ppses:
"RTN","SAMICAS2",23,0)
 ; WSCASE wrs-code WSCASE^SAMICASE, post vapals casereview:
"RTN","SAMICAS2",24,0)
 ;  generate case review page
"RTN","SAMICAS2",25,0)
 ; $$NOTEHREF pps-code $$NOTEHREF^SAMICASE, 
"RTN","SAMICAS2",26,0)
 ;  html list of notes for form
"RTN","SAMICAS2",27,0)
 ; GETTMPL pps-code GETTMPL^SAMICASE, get html template
"RTN","SAMICAS2",28,0)
 ; $$CNTITEMS = how many forms does patient have?
"RTN","SAMICAS2",29,0)
 ; GETITEMS pps-code GETITEMS^SAMICASE
"RTN","SAMICAS2",30,0)
 ;  get items available for studyid
"RTN","SAMICAS2",31,0)
 ; $$GETDTKEY date part of form key
"RTN","SAMICAS2",32,0)
 ; $$KEY2DSPD date in elcap format from key date
"RTN","SAMICAS2",33,0)
 ; $$VAPALSDT pps-code $$VAPALSDT^SAMICASE, vapals format for dates
"RTN","SAMICAS2",34,0)
 ;
"RTN","SAMICAS2",35,0)
 ;  2. WSNUFORM & related ppses:
"RTN","SAMICAS2",36,0)
 ; WSNUFORM wrs-code WSNUFORM^SAMICASE, post vapals nuform:
"RTN","SAMICAS2",37,0)
 ;  new form for patient
"RTN","SAMICAS2",38,0)
 ; OLDNUFORM
"RTN","SAMICAS2",39,0)
 ;
"RTN","SAMICAS2",40,0)
 ;  3. WSNUUPLD & related ppses:
"RTN","SAMICAS2",41,0)
 ; WSNUUPLD wrs-code WSNUUPLD^SAMICASE, post vapals nuform:
"RTN","SAMICAS2",42,0)
 ;  new form for patient
"RTN","SAMICAS2",43,0)
 ; OLDPROCESS
"RTN","SAMICAS2",44,0)
 ; $$DOCTYPE document type
"RTN","SAMICAS2",45,0)
 ; MINIPARS parse on name=
"RTN","SAMICAS2",46,0)
 ; FILEUP process file upload
"RTN","SAMICAS2",47,0)
 ; $$DEDUP append dash # to key to make it unique
"RTN","SAMICAS2",48,0)
 ; FILEVIEW view an uploaded document
"RTN","SAMICAS2",49,0)
 ;
"RTN","SAMICAS2",50,0)
 ; $$KEY2FM pps-code $$KEY2FM^SAMICASE, convert key to fileman date
"RTN","SAMICAS2",51,0)
 ;
"RTN","SAMICAS2",52,0)
 ;  4. casetbl:
"RTN","SAMICAS2",53,0)
 ; $$GSAMISTA value of 'samistatus' from form
"RTN","SAMICAS2",54,0)
 ; SSAMISTA pps-code SSAMISTA^SAMICASE, set samistatus to val in form
"RTN","SAMICAS2",55,0)
 ; DELFORM wrs-code DELFORM^SAMICASE, post vapals deleteform:
"RTN","SAMICAS2",56,0)
 ;  delete incomplete form
"RTN","SAMICAS2",57,0)
 ; INITSTAT set all forms to 'incomplete'
"RTN","SAMICAS2",58,0)
 ;
"RTN","SAMICAS2",59,0)
 ;
"RTN","SAMICAS2",60,0)
 ;
"RTN","SAMICAS2",61,0)
 ;
"RTN","SAMICAS2",62,0)
 ;@section 1 wsCASE & related ppses
"RTN","SAMICAS2",63,0)
 ;
"RTN","SAMICAS2",64,0)
 ;
"RTN","SAMICAS2",65,0)
 ;
"RTN","SAMICAS2",66,0)
 ;
"RTN","SAMICAS2",67,0)
 ;@wrs-code WSCASE^SAMICASE
"RTN","SAMICAS2",68,0)
 ;
"RTN","SAMICAS2",69,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",70,0)
 ;
"RTN","SAMICAS2",71,0)
 ;ven/gpl;wrs;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMICAS2",72,0)
 ;@signature
"RTN","SAMICAS2",73,0)
 ; do WSCASE^SAMICASE(rtn,filter)
"RTN","SAMICAS2",74,0)
 ;@branches-from
"RTN","SAMICAS2",75,0)
 ; WSCASE^SAMICASE
"RTN","SAMICAS2",76,0)
 ;@wri-called-by
"RTN","SAMICAS2",77,0)
 ; wsPostForm^%wfhform
"RTN","SAMICAS2",78,0)
 ; DELFORM^SAMICASE
"RTN","SAMICAS2",79,0)
 ; WSNFPOST^SAMICASE
"RTN","SAMICAS2",80,0)
 ; WSVAPALS^SAMIHOM3 [wsi for ws post vapals]
"RTN","SAMICAS2",81,0)
 ; WSLOOKUP^SAMISRC2
"RTN","SAMICAS2",82,0)
 ; wsPostForm^SAMIZ2
"RTN","SAMICAS2",83,0)
 ;@called-by none
"RTN","SAMICAS2",84,0)
 ;@calls
"RTN","SAMICAS2",85,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",86,0)
 ; GETTMPL^SAMICASE
"RTN","SAMICAS2",87,0)
 ; GETITEMS^SAMICASE
"RTN","SAMICAS2",88,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS2",89,0)
 ; findReplace^%ts
"RTN","SAMICAS2",90,0)
 ; $$SITENM2^SAMISITE
"RTN","SAMICAS2",91,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMICAS2",92,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMICAS2",93,0)
 ; $$GETDTKEY
"RTN","SAMICAS2",94,0)
 ; $$KEY2DSPD
"RTN","SAMICAS2",95,0)
 ; $$NOTEHREF^SAMICASE
"RTN","SAMICAS2",96,0)
 ; $$GETLAST5^SAMIFORM
"RTN","SAMICAS2",97,0)
 ; $$GETSSN^SAMIFORM
"RTN","SAMICAS2",98,0)
 ; $$GETNAME^SAMIFORM
"RTN","SAMICAS2",99,0)
 ; $$GETIDSID^SAMIFORM
"RTN","SAMICAS2",100,0)
 ; $$GSAMISTA
"RTN","SAMICAS2",101,0)
 ; $$VIEWURL^SAMIDCM2
"RTN","SAMICAS2",102,0)
 ; D ADDCRLF^VPRJRUT
"RTN","SAMICAS2",103,0)
 ;@input
"RTN","SAMICAS2",104,0)
 ; .filter =
"RTN","SAMICAS2",105,0)
 ; .filter("studyid")=studyid of the patient
"RTN","SAMICAS2",106,0)
 ;@output
"RTN","SAMICAS2",107,0)
 ; .rtn
"RTN","SAMICAS2",108,0)
 ;@tests
"RTN","SAMICAS2",109,0)
 ; UTWSCAS^SAMIUTS2
"RTN","SAMICAS2",110,0)
 ;
"RTN","SAMICAS2",111,0)
 ;
"RTN","SAMICAS2",112,0)
WSCASE ; post vapals casereview: generate case review page
"RTN","SAMICAS2",113,0)
 ;
"RTN","SAMICAS2",114,0)
 ;@stanza 2 initialize
"RTN","SAMICAS2",115,0)
 ;
"RTN","SAMICAS2",116,0)
 kill rtn
"RTN","SAMICAS2",117,0)
 ;
"RTN","SAMICAS2",118,0)
 new groot set groot=$$setroot^%wd("vapals-patients") ; root of patient graphs
"RTN","SAMICAS2",119,0)
 ;
"RTN","SAMICAS2",120,0)
 new temp ; html template
"RTN","SAMICAS2",121,0)
 do GETTMPL^SAMICASE("temp","vapals:casereview")
"RTN","SAMICAS2",122,0)
 quit:'$data(temp)
"RTN","SAMICAS2",123,0)
 ;
"RTN","SAMICAS2",124,0)
 new sid set sid=$get(filter("studyid"))
"RTN","SAMICAS2",125,0)
 if sid="" set sid=$get(filter("studyId"))
"RTN","SAMICAS2",126,0)
 if sid="" set sid=$get(filter("fvalue"))
"RTN","SAMICAS2",127,0)
 quit:sid=""
"RTN","SAMICAS2",128,0)
 ;
"RTN","SAMICAS2",129,0)
 new items
"RTN","SAMICAS2",130,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMICAS2",131,0)
 quit:'$data(items)
"RTN","SAMICAS2",132,0)
 ;
"RTN","SAMICAS2",133,0)
 new gien set gien=$$SID2NUM^SAMIHOM3(sid) ; graph ien
"RTN","SAMICAS2",134,0)
 new name set name=$get(@groot@(gien,"saminame"))
"RTN","SAMICAS2",135,0)
 quit:name=""
"RTN","SAMICAS2",136,0)
 new fname set fname=$piece(name,",",2)
"RTN","SAMICAS2",137,0)
 new lname set lname=$piece(name,",")
"RTN","SAMICAS2",138,0)
 ;
"RTN","SAMICAS2",139,0)
 ;
"RTN","SAMICAS2",140,0)
 ;@stanza 3 change resource paths to /see/
"RTN","SAMICAS2",141,0)
 ;
"RTN","SAMICAS2",142,0)
 new cnt set cnt=0
"RTN","SAMICAS2",143,0)
 new zi set zi=0
"RTN","SAMICAS2",144,0)
 ;for  set zi=$order(temp(zi)) quit:+zi=0  quit:temp(zi)["VEP0001"  do  ;
"RTN","SAMICAS2",145,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  quit:temp(zi)["tbody"  do  ;
"RTN","SAMICAS2",146,0)
 . new ln set ln=temp(zi)
"RTN","SAMICAS2",147,0)
 . new touched set touched=0
"RTN","SAMICAS2",148,0)
 . ;
"RTN","SAMICAS2",149,0)
 . if ln["@@SITE@@" do  ; insert site id
"RTN","SAMICAS2",150,0)
 . . n siteid s siteid=$g(filter("siteid"))
"RTN","SAMICAS2",151,0)
 . . i siteid="" s siteid=$g(filter("site"))
"RTN","SAMICAS2",152,0)
 . . q:siteid=""
"RTN","SAMICAS2",153,0)
 . . do findReplace^%ts(.ln,"@@SITE@@",siteid)
"RTN","SAMICAS2",154,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",155,0)
 . ;
"RTN","SAMICAS2",156,0)
 . if ln["@@SITETITLE@@" do  ; insert site title
"RTN","SAMICAS2",157,0)
 . . n sitetit s sitetit=$g(filter("sitetitle"))
"RTN","SAMICAS2",158,0)
 . . if sitetit="" d  ;
"RTN","SAMICAS2",159,0)
 . . . n tsite s tsite=$g(filter("site"))
"RTN","SAMICAS2",160,0)
 . . . q:tsite=""
"RTN","SAMICAS2",161,0)
 . . . s sitetit=$$SITENM2^SAMISITE(tsite)_" - "_tsite
"RTN","SAMICAS2",162,0)
 . . q:sitetit=""
"RTN","SAMICAS2",163,0)
 . . do findReplace^%ts(.ln,"@@SITETITLE@@",sitetit)
"RTN","SAMICAS2",164,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",165,0)
 . ;
"RTN","SAMICAS2",166,0)
 . if ln["id" if ln["studyIdMenu" do  ;
"RTN","SAMICAS2",167,0)
 . . set zi=zi+4
"RTN","SAMICAS2",168,0)
 . ;
"RTN","SAMICAS2",169,0)
 . if ln["home.html" do  ;
"RTN","SAMICAS2",170,0)
 . . do findReplace^%ts(.ln,"home.html","/vapals")
"RTN","SAMICAS2",171,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",172,0)
 . . set touched=1
"RTN","SAMICAS2",173,0)
 . ;
"RTN","SAMICAS2",174,0)
 . if ln["href" if 'touched do  ;
"RTN","SAMICAS2",175,0)
 . . do FIXHREF^SAMIFORM(.ln)
"RTN","SAMICAS2",176,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",177,0)
 . ;
"RTN","SAMICAS2",178,0)
 . if ln["src" do  ;
"RTN","SAMICAS2",179,0)
 . . do FIXSRC^SAMIFORM(.ln)
"RTN","SAMICAS2",180,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",181,0)
 . ;
"RTN","SAMICAS2",182,0)
 . if ln["@@ERROR_MESSAGE@@" do  ; insert error message
"RTN","SAMICAS2",183,0)
 . . n zerr s zerr=$g(filter("errorMessage"))
"RTN","SAMICAS2",184,0)
 . . i zerr="" q  ;
"RTN","SAMICAS2",185,0)
 . . do findReplace^%ts(.ln,"@@ERROR_MESSAGE@@",zerr)
"RTN","SAMICAS2",186,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",187,0)
 . ;
"RTN","SAMICAS2",188,0)
 . set cnt=cnt+1
"RTN","SAMICAS2",189,0)
 . set rtn(cnt)=temp(zi)
"RTN","SAMICAS2",190,0)
 . quit
"RTN","SAMICAS2",191,0)
 ;
"RTN","SAMICAS2",192,0)
 ; ready to insert rows for selection
"RTN","SAMICAS2",193,0)
 ;
"RTN","SAMICAS2",194,0)
 ;
"RTN","SAMICAS2",195,0)
 ;@stanza 4 intake form
"RTN","SAMICAS2",196,0)
 ;
"RTN","SAMICAS2",197,0)
 new sikey set sikey=$order(items("sifor"))
"RTN","SAMICAS2",198,0)
 if sikey="" set sikey="siform-2017-12-10"
"RTN","SAMICAS2",199,0)
 new sidate set sidate=$$GETDTKEY(sikey)
"RTN","SAMICAS2",200,0)
 set sikey="vapals:"_sikey
"RTN","SAMICAS2",201,0)
 new sidispdate set sidispdate=$$KEY2DSPD(sidate)
"RTN","SAMICAS2",202,0)
 ;new geturl set geturl="/form?form=vapals:siform&studyid="_sid_"&key="_sikey
"RTN","SAMICAS2",203,0)
 new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMICAS2",204,0)
 set nuhref=nuhref_"<td><input type=hidden name=""samiroute"" value=""nuform"">"
"RTN","SAMICAS2",205,0)
 set nuhref=nuhref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMICAS2",206,0)
 set nuhref=nuhref_"<input value=""New Form"" class=""btn label label-warning"" role=""link"" type=""submit""></form></td>"
"RTN","SAMICAS2",207,0)
 ; new intake notes table
"RTN","SAMICAS2",208,0)
 n notehref,form
"RTN","SAMICAS2",209,0)
 set form=$p(sikey,":",2)
"RTN","SAMICAS2",210,0)
 set notehref=$$NOTEHREF^SAMICASE(sid,form) ; table of notes
"RTN","SAMICAS2",211,0)
 set cnt=cnt+1
"RTN","SAMICAS2",212,0)
 ;new facilitycode set facilitycode=$$GETPRFX^SAMIFORM()
"RTN","SAMICAS2",213,0)
 n siteid s siteid=$g(filter("siteid"))
"RTN","SAMICAS2",214,0)
 i siteid="" s siteid=$g(filter("site"))
"RTN","SAMICAS2",215,0)
 new facilitycode set facilitycode=siteid
"RTN","SAMICAS2",216,0)
 new last5 set last5=$$GETLAST5^SAMIFORM(sid)
"RTN","SAMICAS2",217,0)
 new pssn set pssn=$$GETSSN^SAMIFORM(sid)
"RTN","SAMICAS2",218,0)
 new pname set pname=$$GETNAME^SAMIFORM(sid)
"RTN","SAMICAS2",219,0)
 new useid set useid=$$GETIDSID^SAMIUID(sid)
"RTN","SAMICAS2",220,0)
 if useid="" set useid=last5
"RTN","SAMICAS2",221,0)
 set rtn(cnt)="<tr><td> "_useid_" </td><td> "_pname_" </td><td> "_facilitycode_" </td><td>"_sidispdate_"</td><td>"_$char(13)
"RTN","SAMICAS2",222,0)
 set cnt=cnt+1
"RTN","SAMICAS2",223,0)
 set rtn(cnt)="<form method=""post"" action=""/vapals"">"
"RTN","SAMICAS2",224,0)
 set cnt=cnt+1
"RTN","SAMICAS2",225,0)
 set rtn(cnt)="<input name=""samiroute"" value=""form"" type=""hidden"">"
"RTN","SAMICAS2",226,0)
 set rtn(cnt)=rtn(cnt)_" <input name=""studyid"" value="""_sid_""" type=""hidden"">"
"RTN","SAMICAS2",227,0)
 set rtn(cnt)=rtn(cnt)_" <input name=""form"" value="""_sikey_""" type=""hidden"">"
"RTN","SAMICAS2",228,0)
 set rtn(cnt)=rtn(cnt)_" <input value=""Intake"" class=""btn btn-link"" role=""link"" type=""submit"">"
"RTN","SAMICAS2",229,0)
 ;
"RTN","SAMICAS2",230,0)
 new samistatus set samistatus=""
"RTN","SAMICAS2",231,0)
 if $$GSAMISTA(sid,sikey)="incomplete" set samistatus="(incomplete)"
"RTN","SAMICAS2",232,0)
 set cnt=cnt+1
"RTN","SAMICAS2",233,0)
 set rtn(cnt)="</form>"_samistatus_notehref_"</td>"_$char(13)
"RTN","SAMICAS2",234,0)
 set cnt=cnt+1
"RTN","SAMICAS2",235,0)
 set rtn(cnt)=nuhref_"</tr>"
"RTN","SAMICAS2",236,0)
 ;
"RTN","SAMICAS2",237,0)
 ;
"RTN","SAMICAS2",238,0)
 ;@stanza 6 rest of the forms
"RTN","SAMICAS2",239,0)
 ;
"RTN","SAMICAS2",240,0)
 new zj set zj="" ; each of the rest of the forms
"RTN","SAMICAS2",241,0)
 if $data(items("sort")) do  ; we have more forms
"RTN","SAMICAS2",242,0)
 . for  set zj=$order(items("sort",zj)) quit:zj=""  do  ;
"RTN","SAMICAS2",243,0)
 . . new cdate set cdate=zj
"RTN","SAMICAS2",244,0)
 . . new zk set zk=""
"RTN","SAMICAS2",245,0)
 . . for  set zk=$order(items("sort",cdate,zk)) q:zk=""  do  ;
"RTN","SAMICAS2",246,0)
 . . . new zform set zform=zk
"RTN","SAMICAS2",247,0)
 . . . new zkey set zkey=""
"RTN","SAMICAS2",248,0)
 . . . f  s zkey=$order(items("sort",cdate,zform,zkey)) q:zkey=""  d  ;
"RTN","SAMICAS2",249,0)
 . . . . new zname set zname=$order(items("sort",cdate,zform,zkey,""))
"RTN","SAMICAS2",250,0)
 . . . . new imgid set imgid=$g(items("sort",cdate,zform,zkey,zname))
"RTN","SAMICAS2",251,0)
 . . . . new dispdate set dispdate=$$KEY2DSPD(cdate)
"RTN","SAMICAS2",252,0)
 . . . . if zform'["file" set zform="vapals:"_zkey ; all the new forms are vapals:key
"RTN","SAMICAS2",253,0)
 . . . . set cnt=cnt+1
"RTN","SAMICAS2",254,0)
 . . . . ;set rtn(cnt)="<tr><td> "_sid_" </td><td> - </td><td> - </td><td> - </td><td>"_dispdate_"</td><td>"
"RTN","SAMICAS2",255,0)
 . . . . set rtn(cnt)="<tr><td> "_useid_" </td><td> - </td><td> - </td><td>"_dispdate_"</td><td>"
"RTN","SAMICAS2",256,0)
 . . . . set cnt=cnt+1
"RTN","SAMICAS2",257,0)
 . . . . set rtn(cnt)="<form method=""post"" action=""/vapals"">"_$char(13)
"RTN","SAMICAS2",258,0)
 . . . . set cnt=cnt+1
"RTN","SAMICAS2",259,0)
 . . . . set rtn(cnt)="<input name=""samiroute"" value=""form"" type=""hidden"">"_$char(13)
"RTN","SAMICAS2",260,0)
 . . . . set cnt=cnt+1
"RTN","SAMICAS2",261,0)
 . . . . set rtn(cnt)=" <input name=""studyid"" value="""_sid_""" type=""hidden"">"_$char(13)
"RTN","SAMICAS2",262,0)
 . . . . set cnt=cnt+1
"RTN","SAMICAS2",263,0)
 . . . . set rtn(cnt)=" <input name=""form"" value="""_zform_""" type=""hidden"">"_$char(13)
"RTN","SAMICAS2",264,0)
 . . . . ;set rtn(cnt)=" <input name=""form"" value="""_zkey_""" type=""hidden"">"_$char(13)
"RTN","SAMICAS2",265,0)
 . . . . set cnt=cnt+1
"RTN","SAMICAS2",266,0)
 . . . . set rtn(cnt)=" <input value="""_zname_""" class=""btn btn-link"" role=""link"" type=""submit"">"_$char(13)
"RTN","SAMICAS2",267,0)
 . . . . ;
"RTN","SAMICAS2",268,0)
 . . . . new samistatus set samistatus=""
"RTN","SAMICAS2",269,0)
 . . . . if $$GSAMISTA(sid,zform)="incomplete" set samistatus="(incomplete)"
"RTN","SAMICAS2",270,0)
 . . . . set cnt=cnt+1
"RTN","SAMICAS2",271,0)
 . . . . set rtn(cnt)="</form>"_samistatus_$$NOTEHREF^SAMICASE(sid,zkey)_"</td>"
"RTN","SAMICAS2",272,0)
 . . . . set cnt=cnt+1
"RTN","SAMICAS2",273,0)
 . . . . if zform["ceform" do  ;
"RTN","SAMICAS2",274,0)
 . . . . . new rpthref set rpthref="<form method=POST action=""/vapals"">"
"RTN","SAMICAS2",275,0)
 . . . . . set rpthref=rpthref_"<td><input type=hidden name=""samiroute"" value=""ctreport"">"
"RTN","SAMICAS2",276,0)
 . . . . . set rpthref=rpthref_"<input type=hidden name=""form"" value="_$p(zform,":",2)_">"
"RTN","SAMICAS2",277,0)
 . . . . . ;set rpthref=rpthref_"<input type=hidden name=""form"" value="_zkey_">"
"RTN","SAMICAS2",278,0)
 . . . . . set rpthref=rpthref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMICAS2",279,0)
 . . . . . set rpthref=rpthref_"<input value=""Report"" class=""btn label label-warning"" role=""link"" type=""submit""></form></td>"
"RTN","SAMICAS2",280,0)
 . . . . . set rtn(cnt)=rpthref_"</tr>"
"RTN","SAMICAS2",281,0)
 . . . . . set cnt=cnt+1
"RTN","SAMICAS2",282,0)
 . . . . . ;set rtn(cnt)="</tr>" ; turn off report
"RTN","SAMICAS2",283,0)
 . . . . if zform["file" do  ;
"RTN","SAMICAS2",284,0)
 . . . . . new filehref set filehref="<form method=POST action=""/vapals"">"
"RTN","SAMICAS2",285,0)
 . . . . . set filehref=filehref_"<td><input type=hidden name=""samiroute"" value=""viewfile"">"
"RTN","SAMICAS2",286,0)
 . . . . . ;set filehref=filehref_"<input type=hidden name=""form"" value="_$p(zform,":",2)_">"
"RTN","SAMICAS2",287,0)
 . . . . . set filehref=filehref_"<input type=hidden name=""form"" value="_zkey_">"
"RTN","SAMICAS2",288,0)
 . . . . . set filehref=filehref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMICAS2",289,0)
 . . . . . set filehref=filehref_"<input value=""View"" class=""btn label label-warning"" role=""link"" type=""submit""></form></td>"
"RTN","SAMICAS2",290,0)
 . . . . . set rtn(cnt)=filehref_"</tr>"
"RTN","SAMICAS2",291,0)
 . . . . . set cnt=cnt+1
"RTN","SAMICAS2",292,0)
 . . . . if zform["image" d  ;
"RTN","SAMICAS2",293,0)
 . . . . . new imgurl set imgurl=$$VIEWURL^SAMIDCM2(siteid)
"RTN","SAMICAS2",294,0)
 . . . . . new imgview s imgview=""
"RTN","SAMICAS2",295,0)
 . . . . . s imgview=imgview_"<td><a href="_imgurl_"?StudyInstanceUIDs="_imgid
"RTN","SAMICAS2",296,0)
 . . . . . s imgview=imgview_">View</a></td></tr>"
"RTN","SAMICAS2",297,0)
 . . . . . set rtn(cnt)=imgview
"RTN","SAMICAS2",298,0)
 . . . . . set cnt=cnt+1
"RTN","SAMICAS2",299,0)
 . . . . else  set rtn(cnt)="<td></td></tr>"
"RTN","SAMICAS2",300,0)
 . . . quit
"RTN","SAMICAS2",301,0)
 . . quit
"RTN","SAMICAS2",302,0)
 . quit
"RTN","SAMICAS2",303,0)
 ;
"RTN","SAMICAS2",304,0)
 ;
"RTN","SAMICAS2",305,0)
 ;@stanza 7 skip ahead in template to tbody
"RTN","SAMICAS2",306,0)
 ;
"RTN","SAMICAS2",307,0)
 new loc set loc=zi+1
"RTN","SAMICAS2",308,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  quit:temp(zi)["/tbody"  do  ;
"RTN","SAMICAS2",309,0)
 . set x=$get(x)
"RTN","SAMICAS2",310,0)
 . quit
"RTN","SAMICAS2",311,0)
 set zi=zi-1
"RTN","SAMICAS2",312,0)
 ;
"RTN","SAMICAS2",313,0)
 ;
"RTN","SAMICAS2",314,0)
 ;@stanza 8 rest of lines
"RTN","SAMICAS2",315,0)
 ;
"RTN","SAMICAS2",316,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  do  ;
"RTN","SAMICAS2",317,0)
 . new line
"RTN","SAMICAS2",318,0)
 . set line=temp(zi)
"RTN","SAMICAS2",319,0)
 . ;
"RTN","SAMICAS2",320,0)
 . if line["@@SITE@@" do  ; insert site id
"RTN","SAMICAS2",321,0)
 . . n siteid s siteid=$g(filter("siteid"))
"RTN","SAMICAS2",322,0)
 . . i siteid="" s siteid=$g(filter("site"))
"RTN","SAMICAS2",323,0)
 . . q:siteid=""
"RTN","SAMICAS2",324,0)
 . . d findReplace^%ts(.line,"@@SITE@@",siteid)
"RTN","SAMICAS2",325,0)
 . . q
"RTN","SAMICAS2",326,0)
 . ;
"RTN","SAMICAS2",327,0)
 . if line["@@SITETITLE@@" do  ; insert site title
"RTN","SAMICAS2",328,0)
 . . n sitetit s sitetit=$g(filter("sitetitle"))
"RTN","SAMICAS2",329,0)
 . . if sitetit="" d  ;
"RTN","SAMICAS2",330,0)
 . . . n tsite s tsite=$g(filter("site"))
"RTN","SAMICAS2",331,0)
 . . . q:tsite=""
"RTN","SAMICAS2",332,0)
 . . . s sitetit=$$SITENM2^SAMISITE(tsite)_" - "_tsite
"RTN","SAMICAS2",333,0)
 . . . q
"RTN","SAMICAS2",334,0)
 . . q:sitetit=""
"RTN","SAMICAS2",335,0)
 . . d findReplace^%ts(.line,"@@SITETITLE@@",sitetit)
"RTN","SAMICAS2",336,0)
 . . q
"RTN","SAMICAS2",337,0)
 . ;
"RTN","SAMICAS2",338,0)
 . if line["XX0002" do  ;
"RTN","SAMICAS2",339,0)
 . . do findReplace^%ts(.line,"XX0002",sid)
"RTN","SAMICAS2",340,0)
 . . quit
"RTN","SAMICAS2",341,0)
 . ;
"RTN","SAMICAS2",342,0)
 . if line["@@ERROR_MESSAGE@@" do  ;
"RTN","SAMICAS2",343,0)
 . . n zerr
"RTN","SAMICAS2",344,0)
 . . k ^gpl("error")
"RTN","SAMICAS2",345,0)
 . . m ^gpl("error")=filter
"RTN","SAMICAS2",346,0)
 . . s zerr=$g(filter("errorMessage"))
"RTN","SAMICAS2",347,0)
 . . ;i err="" q  ;
"RTN","SAMICAS2",348,0)
 . . s ^gpl("error","zerr")=zerr
"RTN","SAMICAS2",349,0)
 . . d findReplace^%ts(.line,"@@ERROR_MESSAGE@@",zerr)
"RTN","SAMICAS2",350,0)
 . . s ^gpl("error","newline")=line
"RTN","SAMICAS2",351,0)
 . . q
"RTN","SAMICAS2",352,0)
 . set cnt=cnt+1
"RTN","SAMICAS2",353,0)
 . set rtn(cnt)=line
"RTN","SAMICAS2",354,0)
 . quit
"RTN","SAMICAS2",355,0)
 ;
"RTN","SAMICAS2",356,0)
 do ADDCRLF^VPRJRUT(.rtn)
"RTN","SAMICAS2",357,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMICAS2",358,0)
 ;
"RTN","SAMICAS2",359,0)
 ;
"RTN","SAMICAS2",360,0)
 ;@stanza 9 termination
"RTN","SAMICAS2",361,0)
 ;
"RTN","SAMICAS2",362,0)
 quit  ; end of wrs WSCASE^SAMICAS2
"RTN","SAMICAS2",363,0)
 ;
"RTN","SAMICAS2",364,0)
 ;
"RTN","SAMICAS2",365,0)
 ;
"RTN","SAMICAS2",366,0)
 ;
"RTN","SAMICAS2",367,0)
 ;@pps-code $$NOTEHREF^SAMICASE
"RTN","SAMICAS2",368,0)
 ;
"RTN","SAMICAS2",369,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",370,0)
 ;
"RTN","SAMICAS2",371,0)
 ;ven/gpl;pps;function;silent;clean?;sac?;tests?;port?
"RTN","SAMICAS2",372,0)
 ;@signature
"RTN","SAMICAS2",373,0)
 ; $$NOTEHREF^SAMICASE(sid,form)
"RTN","SAMICAS2",374,0)
 ;@branches-from
"RTN","SAMICAS2",375,0)
 ; NOTEHREF^SAMICASE
"RTN","SAMICAS2",376,0)
 ;@ppi-called-by
"RTN","SAMICAS2",377,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS2",378,0)
 ;@called-by none
"RTN","SAMICAS2",379,0)
 ;@calls
"RTN","SAMICAS2",380,0)
 ; NTLIST^SAMINOT1
"RTN","SAMICAS2",381,0)
 ;@input
"RTN","SAMICAS2",382,0)
 ; sid = study id
"RTN","SAMICAS2",383,0)
 ; form
"RTN","SAMICAS2",384,0)
 ;@output = html list of notes
"RTN","SAMICAS2",385,0)
 ;@examples [tbd]
"RTN","SAMICAS2",386,0)
 ;@tests [tbd]
"RTN","SAMICAS2",387,0)
 ;
"RTN","SAMICAS2",388,0)
 ;
"RTN","SAMICAS2",389,0)
NOTEHREF ; html list of notes for form
"RTN","SAMICAS2",390,0)
 ;
"RTN","SAMICAS2",391,0)
 ;@stanza 2 get list of notes
"RTN","SAMICAS2",392,0)
 ;
"RTN","SAMICAS2",393,0)
 new notehref set notehref=""
"RTN","SAMICAS2",394,0)
 new ntlist
"RTN","SAMICAS2",395,0)
 if form["sifor" do NTLIST^SAMINOT1("ntlist",sid,form)
"RTN","SAMICAS2",396,0)
 if form["fufor" do NTLIST^SAMINOT2("ntlist",sid,form)
"RTN","SAMICAS2",397,0)
 if $order(ntlist(""))="" quit notehref
"RTN","SAMICAS2",398,0)
 ;
"RTN","SAMICAS2",399,0)
 set notehref="<table>"
"RTN","SAMICAS2",400,0)
 ;
"RTN","SAMICAS2",401,0)
 new zi set zi=0
"RTN","SAMICAS2",402,0)
 for  do  quit:'zi
"RTN","SAMICAS2",403,0)
 . set zi=$order(ntlist(zi))
"RTN","SAMICAS2",404,0)
 . quit:'zi
"RTN","SAMICAS2",405,0)
 . ;
"RTN","SAMICAS2",406,0)
 . set notehref=notehref_"<td><form method=POST action=""/vapals"">"
"RTN","SAMICAS2",407,0)
 . set notehref=notehref_"<input type=hidden name=""nien"" value="""_$get(ntlist(zi,"nien"))_""">"
"RTN","SAMICAS2",408,0)
 . set notehref=notehref_"<input type=hidden name=""samiroute"" value=""note"">"
"RTN","SAMICAS2",409,0)
 . set notehref=notehref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMICAS2",410,0)
 . set notehref=notehref_"<input type=hidden name=""form"" value="_form_">"
"RTN","SAMICAS2",411,0)
 . set notehref=notehref_"<input value="""_$get(ntlist(zi,"name"))_""" class=""btn btn-link"" role=""link"" type=""submit""></form></td></tr>"
"RTN","SAMICAS2",412,0)
 . quit
"RTN","SAMICAS2",413,0)
 ;
"RTN","SAMICAS2",414,0)
 set notehref=notehref_"</table>"
"RTN","SAMICAS2",415,0)
 ;
"RTN","SAMICAS2",416,0)
 ;
"RTN","SAMICAS2",417,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",418,0)
 ;
"RTN","SAMICAS2",419,0)
 quit notehref ; end of pps $$NOTEHREF^SAMICASE
"RTN","SAMICAS2",420,0)
 ;
"RTN","SAMICAS2",421,0)
 ;
"RTN","SAMICAS2",422,0)
 ;
"RTN","SAMICAS2",423,0)
 ;
"RTN","SAMICAS2",424,0)
 ;@pps-code GETTMPL^SAMICASE
"RTN","SAMICAS2",425,0)
 ;
"RTN","SAMICAS2",426,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",427,0)
 ;
"RTN","SAMICAS2",428,0)
 ;ven/gpl;pps;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMICAS2",429,0)
 ;@signature
"RTN","SAMICAS2",430,0)
 ; do GETTMPL^SAMICASE(return,form)
"RTN","SAMICAS2",431,0)
 ;@branches-from
"RTN","SAMICAS2",432,0)
 ; GETTMPL^SAMICASE
"RTN","SAMICAS2",433,0)
 ;@ppi-called-by
"RTN","SAMICAS2",434,0)
 ; WSCASE^SAMICAS2
"RTN","SAMICAS2",435,0)
 ; GETHOME^SAMIHOM4
"RTN","SAMICAS2",436,0)
 ; WSNOTE^SAMINOT1
"RTN","SAMICAS2",437,0)
 ; WSNOTE^SAMINOT2
"RTN","SAMICAS2",438,0)
 ; WSNOTE^SAMINOT3
"RTN","SAMICAS2",439,0)
 ; WSNOTE^SAMINOTI
"RTN","SAMICAS2",440,0)
 ;@called-by none
"RTN","SAMICAS2",441,0)
 ;@calls
"RTN","SAMICAS2",442,0)
 ; $$getTemplate^%wf
"RTN","SAMICAS2",443,0)
 ; getThis^%wd
"RTN","SAMICAS2",444,0)
 ;@input
"RTN","SAMICAS2",445,0)
 ; return = name of array to return template
"RTN","SAMICAS2",446,0)
 ; form = name of form
"RTN","SAMICAS2",447,0)
 ;@output
"RTN","SAMICAS2",448,0)
 ; @return = template
"RTN","SAMICAS2",449,0)
 ;@examples [tbd]
"RTN","SAMICAS2",450,0)
 ;@tests
"RTN","SAMICAS2",451,0)
 ; UTGTMPL^SAMIUTS2
"RTN","SAMICAS2",452,0)
 ;
"RTN","SAMICAS2",453,0)
 ;
"RTN","SAMICAS2",454,0)
GETTMPL ; get html template
"RTN","SAMICAS2",455,0)
 ;
"RTN","SAMICAS2",456,0)
 ;@stanza 2 get html template
"RTN","SAMICAS2",457,0)
 ;
"RTN","SAMICAS2",458,0)
 quit:$get(form)=""
"RTN","SAMICAS2",459,0)
 ;
"RTN","SAMICAS2",460,0)
 new fn set fn=$$getTemplate^%wf(form)
"RTN","SAMICAS2",461,0)
 do getThis^%wd(return,fn)
"RTN","SAMICAS2",462,0)
 ;
"RTN","SAMICAS2",463,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMICAS2",464,0)
 ;
"RTN","SAMICAS2",465,0)
 ;
"RTN","SAMICAS2",466,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",467,0)
 ;
"RTN","SAMICAS2",468,0)
 quit  ; end of pps GETTMPL^SAMICASE
"RTN","SAMICAS2",469,0)
 ;
"RTN","SAMICAS2",470,0)
 ;
"RTN","SAMICAS2",471,0)
 ;
"RTN","SAMICAS2",472,0)
 ;
"RTN","SAMICAS2",473,0)
 ;@function $$CNTITEMS
"RTN","SAMICAS2",474,0)
 ;
"RTN","SAMICAS2",475,0)
 ;@called-by none
"RTN","SAMICAS2",476,0)
 ;@calls
"RTN","SAMICAS2",477,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",478,0)
 ;@input
"RTN","SAMICAS2",479,0)
 ; sid = patient's study ID (e.g. "XXX00001")
"RTN","SAMICAS2",480,0)
 ;@output = # forms patient has
"RTN","SAMICAS2",481,0)
 ;@tests
"RTN","SAMICAS2",482,0)
 ; SAMIUTS2
"RTN","SAMICAS2",483,0)
 ;
"RTN","SAMICAS2",484,0)
 ;
"RTN","SAMICAS2",485,0)
CNTITEMS(sid) ; how many forms does patient have?
"RTN","SAMICAS2",486,0)
 ;
"RTN","SAMICAS2",487,0)
 ; used before deleting a patient to count how many forms patient has
"RTN","SAMICAS2",488,0)
 ;
"RTN","SAMICAS2",489,0)
 new groot set groot=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",490,0)
 quit:'$data(@groot@("graph",sid)) 0  ; nothing there
"RTN","SAMICAS2",491,0)
 ;
"RTN","SAMICAS2",492,0)
 new zi set zi=""
"RTN","SAMICAS2",493,0)
 new cnt set cnt=0
"RTN","SAMICAS2",494,0)
 for  set zi=$o(@groot@("graph",sid,zi)) quit:zi=""  set cnt=cnt+1
"RTN","SAMICAS2",495,0)
 ;
"RTN","SAMICAS2",496,0)
 quit cnt  ; end of CNTITEMS
"RTN","SAMICAS2",497,0)
 ;
"RTN","SAMICAS2",498,0)
 ;
"RTN","SAMICAS2",499,0)
 ;
"RTN","SAMICAS2",500,0)
 ;
"RTN","SAMICAS2",501,0)
 ;@pps-code GETITEMS^SAMICASE
"RTN","SAMICAS2",502,0)
 ;
"RTN","SAMICAS2",503,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",504,0)
 ;
"RTN","SAMICAS2",505,0)
 ;ven/gpl;pps;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMICAS2",506,0)
 ;@signature
"RTN","SAMICAS2",507,0)
 ; do GETITEMS^SAMICASE(ary,sid)
"RTN","SAMICAS2",508,0)
 ;@branches-from
"RTN","SAMICAS2",509,0)
 ; GETITEMS^SAMICASE
"RTN","SAMICAS2",510,0)
 ;@ppi-called-by
"RTN","SAMICAS2",511,0)
 ; WSCASE^SAMICAS2
"RTN","SAMICAS2",512,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS2",513,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS2",514,0)
 ; GETFILTR^SAMICTR0
"RTN","SAMICAS2",515,0)
 ; GETFILTR^SAMICTT0
"RTN","SAMICAS2",516,0)
 ; SELECT^SAMIUR
"RTN","SAMICAS2",517,0)
 ; SELECT^SAMIUR1
"RTN","SAMICAS2",518,0)
 ; CUMPY^SAMIUR2
"RTN","SAMICAS2",519,0)
 ;@called-by none
"RTN","SAMICAS2",520,0)
 ;@calls
"RTN","SAMICAS2",521,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",522,0)
 ; $$DOCTYPE
"RTN","SAMICAS2",523,0)
 ; $$FMDT^SAMIUR2
"RTN","SAMICAS2",524,0)
 ; ADDITEMS^SAMIDCM2
"RTN","SAMICAS2",525,0)
 ;@input
"RTN","SAMICAS2",526,0)
 ; ary = name of return array
"RTN","SAMICAS2",527,0)
 ; sid = patient's study ID (e.g. "XXX00001")
"RTN","SAMICAS2",528,0)
 ;@output
"RTN","SAMICAS2",529,0)
 ; @ary = returned items available
"RTN","SAMICAS2",530,0)
 ;@examples [tbd]
"RTN","SAMICAS2",531,0)
 ;@tests
"RTN","SAMICAS2",532,0)
 ; UTCNTITM^SAMIUTS2
"RTN","SAMICAS2",533,0)
 ;
"RTN","SAMICAS2",534,0)
 ;
"RTN","SAMICAS2",535,0)
GETITEMS ; get items available for studyid
"RTN","SAMICAS2",536,0)
 ;
"RTN","SAMICAS2",537,0)
 ;@stanza 2 get items
"RTN","SAMICAS2",538,0)
 ;
"RTN","SAMICAS2",539,0)
 new groot set groot=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",540,0)
 quit:'$data(@groot@("graph",sid))  ; nothing there
"RTN","SAMICAS2",541,0)
 ;
"RTN","SAMICAS2",542,0)
 kill @ary
"RTN","SAMICAS2",543,0)
 new zi set zi=""
"RTN","SAMICAS2",544,0)
 for  set zi=$order(@groot@("graph",sid,zi)) quit:zi=""  do  ;
"RTN","SAMICAS2",545,0)
 . set @ary@(zi)=""
"RTN","SAMICAS2",546,0)
 . quit
"RTN","SAMICAS2",547,0)
 ;
"RTN","SAMICAS2",548,0)
 ;
"RTN","SAMICAS2",549,0)
 ;@stanza 3 get rest of forms (many-to-one, get dates)
"RTN","SAMICAS2",550,0)
 ;
"RTN","SAMICAS2",551,0)
 new tary
"RTN","SAMICAS2",552,0)
 for  set zi=$order(@ary@(zi)) quit:zi=""  do  ;
"RTN","SAMICAS2",553,0)
 . new zkey1,zform set zkey1=$piece(zi,"-",1)
"RTN","SAMICAS2",554,0)
 . ; if zkey1="sbform" quit  ;
"RTN","SAMICAS2",555,0)
 . if zkey1="siform" quit  ;
"RTN","SAMICAS2",556,0)
 . new fname
"RTN","SAMICAS2",557,0)
 . if zkey1="ceform" set fname="CT Evaluation"
"RTN","SAMICAS2",558,0)
 . set zform=zkey1
"RTN","SAMICAS2",559,0)
 . if zkey1="sbform" set zform="vapals:sbform"
"RTN","SAMICAS2",560,0)
 . if zkey1="sbform" set fname="Background"
"RTN","SAMICAS2",561,0)
 . if zkey1="ceform" set zform="vapals:ceform"
"RTN","SAMICAS2",562,0)
 . if zkey1="fuform" set zform="vapals:fuform"
"RTN","SAMICAS2",563,0)
 . if zkey1="fuform" set fname="Follow-up"
"RTN","SAMICAS2",564,0)
 . if zkey1="bxform" set fname="Biopsy"
"RTN","SAMICAS2",565,0)
 . if zkey1="bxform" set zform="vapals:bxform"
"RTN","SAMICAS2",566,0)
 . if zkey1="ptform" set zform="vapals:ptform"
"RTN","SAMICAS2",567,0)
 . if zkey1="ptform" set fname="PET Evaluation"
"RTN","SAMICAS2",568,0)
 . if zkey1="itform" set zform="vapals:itform"
"RTN","SAMICAS2",569,0)
 . if zkey1="itform" set fname="Intervention"
"RTN","SAMICAS2",570,0)
 . if zkey1="file" d  ;
"RTN","SAMICAS2",571,0)
 . . s zform="file"
"RTN","SAMICAS2",572,0)
 . . n doccode s doccode=$g(@groot@("graph",sid,zi,"pdtype"))
"RTN","SAMICAS2",573,0)
 . . n doctype s doctype=$$DOCTYPE(doccode)
"RTN","SAMICAS2",574,0)
 . . if doctype'="" s fname="Doc: "_doctype
"RTN","SAMICAS2",575,0)
 . . else  s fname="file"
"RTN","SAMICAS2",576,0)
 . . quit
"RTN","SAMICAS2",577,0)
 . if $get(fname)="" set fname="unknown"
"RTN","SAMICAS2",578,0)
 . ;
"RTN","SAMICAS2",579,0)
 . ;new zdate set zdate=$extract(zi,$length(zkey1)+2,$length(zi))
"RTN","SAMICAS2",580,0)
 . new zdate set zdate=$p(zi,"-",2)_"-"_$p(zi,"-",3)_"-"_$p(zi,"-",4)
"RTN","SAMICAS2",581,0)
 . set zdate=$$FMDT^SAMIUR2(zdate)
"RTN","SAMICAS2",582,0)
 . quit:$get(zdate)=""
"RTN","SAMICAS2",583,0)
 . quit:$get(zform)=""
"RTN","SAMICAS2",584,0)
 . quit:$get(zi)=""
"RTN","SAMICAS2",585,0)
 . quit:$get(fname)=""
"RTN","SAMICAS2",586,0)
 . ;
"RTN","SAMICAS2",587,0)
 . set tary("sort",zdate,zform,zi,fname)=""
"RTN","SAMICAS2",588,0)
 . set tary("type",zform,zi,fname)=""
"RTN","SAMICAS2",589,0)
 . quit
"RTN","SAMICAS2",590,0)
 ;
"RTN","SAMICAS2",591,0)
 D ADDITEMS^SAMIDCM2("tary",sid)
"RTN","SAMICAS2",592,0)
 merge @ary=tary
"RTN","SAMICAS2",593,0)
 ;
"RTN","SAMICAS2",594,0)
 ;
"RTN","SAMICAS2",595,0)
 ;@stanza 4 termination
"RTN","SAMICAS2",596,0)
 ;
"RTN","SAMICAS2",597,0)
 quit  ; end of pps GETITEMS^SAMICASE
"RTN","SAMICAS2",598,0)
 ;
"RTN","SAMICAS2",599,0)
 ;
"RTN","SAMICAS2",600,0)
 ;
"RTN","SAMICAS2",601,0)
 ;
"RTN","SAMICAS2",602,0)
 ;@function $$GETDTKEY
"RTN","SAMICAS2",603,0)
 ;
"RTN","SAMICAS2",604,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",605,0)
 ;
"RTN","SAMICAS2",606,0)
 ;ven/gpl;private;function;
"RTN","SAMICAS2",607,0)
 ;@called by
"RTN","SAMICAS2",608,0)
 ; WSCASE^SAMICAS2
"RTN","SAMICAS2",609,0)
 ;@calls none
"RTN","SAMICAS2",610,0)
 ;@input
"RTN","SAMICAS2",611,0)
 ; formid = form key
"RTN","SAMICAS2",612,0)
 ;@output = date from form key
"RTN","SAMICAS2",613,0)
 ;@examples
"RTN","SAMICAS2",614,0)
 ; $$GETDTKEY("sbform-2018-02-26") = "2018-02-26"
"RTN","SAMICAS2",615,0)
 ;@tests :
"RTN","SAMICAS2",616,0)
 ; SAMIUTS2
"RTN","SAMICAS2",617,0)
 ;
"RTN","SAMICAS2",618,0)
 ;
"RTN","SAMICAS2",619,0)
GETDTKEY(formid) ; date portion of form key
"RTN","SAMICAS2",620,0)
 ;
"RTN","SAMICAS2",621,0)
 ;@stanza 2 calculate date from key
"RTN","SAMICAS2",622,0)
 ;
"RTN","SAMICAS2",623,0)
 new frm set frm=$piece(formid,"-")
"RTN","SAMICAS2",624,0)
 ;new date set date=$piece(formid,frm_"-",2)
"RTN","SAMICAS2",625,0)
 new date set date=$piece(formid,"-",2)_"-"_$piece(formid,"-",3)_"-"_$piece(formid,"-",4)
"RTN","SAMICAS2",626,0)
 ;
"RTN","SAMICAS2",627,0)
 ;@stanza 3 return & termination
"RTN","SAMICAS2",628,0)
 ;
"RTN","SAMICAS2",629,0)
 quit date ; return date; end of $$GETDTKEY
"RTN","SAMICAS2",630,0)
 ;
"RTN","SAMICAS2",631,0)
 ;
"RTN","SAMICAS2",632,0)
 ;
"RTN","SAMICAS2",633,0)
 ;
"RTN","SAMICAS2",634,0)
 ;@function $$KEY2DSPD
"RTN","SAMICAS2",635,0)
 ;
"RTN","SAMICAS2",636,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",637,0)
 ;
"RTN","SAMICAS2",638,0)
 ;ven/gpl;private;function;silent;clean;sac?;100% tests;port?
"RTN","SAMICAS2",639,0)
 ;@called by
"RTN","SAMICAS2",640,0)
 ;  WSCASE^SAMICAS2
"RTN","SAMICAS2",641,0)
 ;@calls
"RTN","SAMICAS2",642,0)
 ; ^%DT
"RTN","SAMICAS2",643,0)
 ; $$FMTE^XLFDT [commented out]
"RTN","SAMICAS2",644,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS2",645,0)
 ;@input
"RTN","SAMICAS2",646,0)
 ; zkey = date in any format %DT can process
"RTN","SAMICAS2",647,0)
 ;@output = date in elcap format
"RTN","SAMICAS2",648,0)
 ;@examples
"RTN","SAMICAS2",649,0)
 ; date 2018-02-26 => 26/Feb/2018
"RTN","SAMICAS2",650,0)
 ;@tests
"RTN","SAMICAS2",651,0)
 ; SAMIUTS2
"RTN","SAMICAS2",652,0)
 ;
"RTN","SAMICAS2",653,0)
 ;
"RTN","SAMICAS2",654,0)
KEY2DSPD(zkey) ; date in elcap format from key date
"RTN","SAMICAS2",655,0)
 ;
"RTN","SAMICAS2",656,0)
 ;@stanza 2 convert date to elcap display format
"RTN","SAMICAS2",657,0)
 ;
"RTN","SAMICAS2",658,0)
 new X set X=zkey
"RTN","SAMICAS2",659,0)
 new Y
"RTN","SAMICAS2",660,0)
 do ^%DT
"RTN","SAMICAS2",661,0)
 ;new Z set Z=$$FMTE^XLFDT(Y,"9D")
"RTN","SAMICAS2",662,0)
 ;set Z=$translate(Z," ","/")
"RTN","SAMICAS2",663,0)
 new zdate set zdate=$$VAPALSDT^SAMICASE(Y)
"RTN","SAMICAS2",664,0)
 ;
"RTN","SAMICAS2",665,0)
 ;@stanza 3 return & termination
"RTN","SAMICAS2",666,0)
 ;
"RTN","SAMICAS2",667,0)
 quit zdate  ; return date; end of $$KEY2DSPD
"RTN","SAMICAS2",668,0)
 ;
"RTN","SAMICAS2",669,0)
 ;
"RTN","SAMICAS2",670,0)
 ;
"RTN","SAMICAS2",671,0)
 ;
"RTN","SAMICAS2",672,0)
 ;@pps-code $$VAPALSDT^SAMICASE
"RTN","SAMICAS2",673,0)
 ;
"RTN","SAMICAS2",674,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",675,0)
 ;
"RTN","SAMICAS2",676,0)
 ;ven/gpl;pps;function;clean;silent;sac;100% tests
"RTN","SAMICAS2",677,0)
 ;@signature
"RTN","SAMICAS2",678,0)
 ; $$VAPALSDT^SAMICASE(fmdate)
"RTN","SAMICAS2",679,0)
 ;@branches-from
"RTN","SAMICAS2",680,0)
 ; VAPALSDT^SAMICASE
"RTN","SAMICAS2",681,0)
 ;@pps-called-by
"RTN","SAMICAS2",682,0)
 ; KEY2DSPD^SAMICAS2
"RTN","SAMICAS2",683,0)
 ; LASTCMP^SAMICAS3
"RTN","SAMICAS2",684,0)
 ; KEY2DT^SAMICAS3
"RTN","SAMICAS2",685,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS2",686,0)
 ; MKFUFORM^SAMICAS3
"RTN","SAMICAS2",687,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS2",688,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS2",689,0)
 ; LOGIT^SAMICLOG
"RTN","SAMICAS2",690,0)
 ; MKSIFORM^SAMIHOM3
"RTN","SAMICAS2",691,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMICAS2",692,0)
 ; SELECT^SAMIUR
"RTN","SAMICAS2",693,0)
 ; SELECT^SAMIUR1
"RTN","SAMICAS2",694,0)
 ; IFORM^SAMIUR2
"RTN","SAMICAS2",695,0)
 ;@called-by none
"RTN","SAMICAS2",696,0)
 ;@calls
"RTN","SAMICAS2",697,0)
 ; $$FMTE^XLFDT
"RTN","SAMICAS2",698,0)
 ;@input
"RTN","SAMICAS2",699,0)
 ; fmdate = date in fileman format
"RTN","SAMICAS2",700,0)
 ;@output = vapals date format
"RTN","SAMICAS2",701,0)
 ;@tests
"RTN","SAMICAS2",702,0)
 ; UTVPLSD^SAMIUTS2
"RTN","SAMICAS2",703,0)
 ;
"RTN","SAMICAS2",704,0)
 ;
"RTN","SAMICAS2",705,0)
VAPALSDT ; vapals format for dates
"RTN","SAMICAS2",706,0)
 ;
"RTN","SAMICAS2",707,0)
 ;@stanza 2 convert date
"RTN","SAMICAS2",708,0)
 ;
"RTN","SAMICAS2",709,0)
 ; new vdate set vdate=$$FMTE^XLFDT(fmdate,"9D")
"RTN","SAMICAS2",710,0)
 ; set vdate=$translate(vdate," ","/")
"RTN","SAMICAS2",711,0)
 ;
"RTN","SAMICAS2",712,0)
 ;new vdate set vdate=$$FMTE^XLFDT(fmdate,"5D")
"RTN","SAMICAS2",713,0)
 new vdate set vdate=$$FMTE^XLFDT(fmdate,"5DZ")
"RTN","SAMICAS2",714,0)
 ;
"RTN","SAMICAS2",715,0)
 ;
"RTN","SAMICAS2",716,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",717,0)
 ;
"RTN","SAMICAS2",718,0)
 quit vdate ; end of pps $$VAPALSDT^SAMICASE
"RTN","SAMICAS2",719,0)
 ;
"RTN","SAMICAS2",720,0)
 ;
"RTN","SAMICAS2",721,0)
 ;
"RTN","SAMICAS2",722,0)
 ;
"RTN","SAMICAS2",723,0)
 ;@section 2 WSNUFORM & related ppses
"RTN","SAMICAS2",724,0)
 ;
"RTN","SAMICAS2",725,0)
 ;
"RTN","SAMICAS2",726,0)
 ;
"RTN","SAMICAS2",727,0)
 ;
"RTN","SAMICAS2",728,0)
 ;@wrs-code WSNUFORM^SAMICASE
"RTN","SAMICAS2",729,0)
 ;
"RTN","SAMICAS2",730,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",731,0)
 ;
"RTN","SAMICAS2",732,0)
 ;ven/gpl;wrs;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMICAS2",733,0)
 ;@signature
"RTN","SAMICAS2",734,0)
 ; do WSNUFORM^SAMICASE(rtn,filter)
"RTN","SAMICAS2",735,0)
 ;@branches-from
"RTN","SAMICAS2",736,0)
 ; WSNUFORM^SAMICASE
"RTN","SAMICAS2",737,0)
 ;@wrs-called-by
"RTN","SAMICAS2",738,0)
 ; WSVAPALS^SAMIHOM3 [wr nuform of ws post vapals]
"RTN","SAMICAS2",739,0)
 ;@called-by none
"RTN","SAMICAS2",740,0)
 ;@calls
"RTN","SAMICAS2",741,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS2",742,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",743,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS2",744,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS2",745,0)
 ; wsGetForm^%wf
"RTN","SAMICAS2",746,0)
 ;@input
"RTN","SAMICAS2",747,0)
 ; .filter =
"RTN","SAMICAS2",748,0)
 ; .filter("studyid")=studyid of the patient
"RTN","SAMICAS2",749,0)
 ;@output
"RTN","SAMICAS2",750,0)
 ; @rtn
"RTN","SAMICAS2",751,0)
 ;@tests
"RTN","SAMICAS2",752,0)
 ; UTWSNF^SAMIUTS2
"RTN","SAMICAS2",753,0)
 ;
"RTN","SAMICAS2",754,0)
 ;
"RTN","SAMICAS2",755,0)
WSNUFORM ; post vapals nuform: new form for patient
"RTN","SAMICAS2",756,0)
 ;
"RTN","SAMICAS2",757,0)
 ;@stanza 2 get select-new-form form
"RTN","SAMICAS2",758,0)
 ;
"RTN","SAMICAS2",759,0)
 new sid set sid=$get(filter("studyid"))
"RTN","SAMICAS2",760,0)
 quit:sid=""
"RTN","SAMICAS2",761,0)
 ;
"RTN","SAMICAS2",762,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS2",763,0)
 quit:+sien=0
"RTN","SAMICAS2",764,0)
 ;
"RTN","SAMICAS2",765,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",766,0)
 new groot set groot=$name(@root@(sien))
"RTN","SAMICAS2",767,0)
 new saminame set saminame=$get(@groot@("saminame"))
"RTN","SAMICAS2",768,0)
 quit:saminame=""
"RTN","SAMICAS2",769,0)
 ;
"RTN","SAMICAS2",770,0)
 ;
"RTN","SAMICAS2",771,0)
 ; gpl experiment to fool wsGetForm^%wf into processing this form
"RTN","SAMICAS2",772,0)
 ;
"RTN","SAMICAS2",773,0)
 n tmpdt s tmpdt=$$VAPALSDT^SAMICASE($$NOW^XLFDT())
"RTN","SAMICAS2",774,0)
 s tmpdt=$tr(tmpdt,"/","-")
"RTN","SAMICAS2",775,0)
 n tmpkey s tmpkey="temp-"_tmpdt ; key to fool wsGetForm
"RTN","SAMICAS2",776,0)
 s @root@("graph",sid,tmpkey,sid)=sid
"RTN","SAMICAS2",777,0)
 ;
"RTN","SAMICAS2",778,0)
 n filter
"RTN","SAMICAS2",779,0)
 s filter("form")="vapals:nuform"
"RTN","SAMICAS2",780,0)
 s filter("studyid")=sid
"RTN","SAMICAS2",781,0)
 s filter("key")=tmpkey
"RTN","SAMICAS2",782,0)
 d wsGetForm^%wf(.rtn,.filter)
"RTN","SAMICAS2",783,0)
 k @root@("graph",sid,tmpkey) ; clean up temp false form
"RTN","SAMICAS2",784,0)
 ;
"RTN","SAMICAS2",785,0)
 quit  ; end of wrs WSNUFORM^SAMICAS
"RTN","SAMICAS2",786,0)
 ;
"RTN","SAMICAS2",787,0)
 ;
"RTN","SAMICAS2",788,0)
 ;
"RTN","SAMICAS2",789,0)
 ;
"RTN","SAMICAS2",790,0)
 ;@proc OLDNUFORM
"RTN","SAMICAS2",791,0)
 ;
"RTN","SAMICAS2",792,0)
 ;@calls
"RTN","SAMICAS2",793,0)
 ; GETTMPL
"RTN","SAMICAS2",794,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMICAS2",795,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMICAS2",796,0)
 ; findReplace^%ts
"RTN","SAMICAS2",797,0)
 ; $$SITENM2^SAMISITE
"RTN","SAMICAS2",798,0)
 ;
"RTN","SAMICAS2",799,0)
OLDNUFORM() ;
"RTN","SAMICAS2",800,0)
 ;
"RTN","SAMICAS2",801,0)
 new temp,tout
"RTN","SAMICAS2",802,0)
 set return="temp"
"RTN","SAMICAS2",803,0)
 new form set form="vapals:nuform"
"RTN","SAMICAS2",804,0)
 do GETTMPL
"RTN","SAMICAS2",805,0)
 quit:'$data(temp)
"RTN","SAMICAS2",806,0)
 ;
"RTN","SAMICAS2",807,0)
 new cnt set cnt=0
"RTN","SAMICAS2",808,0)
 new zi set zi=0
"RTN","SAMICAS2",809,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  do  ;
"RTN","SAMICAS2",810,0)
 . new ln set ln=temp(zi)
"RTN","SAMICAS2",811,0)
 . new touched set touched=0
"RTN","SAMICAS2",812,0)
 . ;
"RTN","SAMICAS2",813,0)
 . if ln["href" if 'touched do  ;
"RTN","SAMICAS2",814,0)
 . . do FIXHREF^SAMIFORM(.ln)
"RTN","SAMICAS2",815,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",816,0)
 . . quit
"RTN","SAMICAS2",817,0)
 . ;
"RTN","SAMICAS2",818,0)
 . if ln["src" d  ;
"RTN","SAMICAS2",819,0)
 . . do FIXSRC^SAMIFORM(.ln)
"RTN","SAMICAS2",820,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",821,0)
 . . quit
"RTN","SAMICAS2",822,0)
 . ;
"RTN","SAMICAS2",823,0)
 . if ln["@@SID@@" do  ;
"RTN","SAMICAS2",824,0)
 . . do findReplace^%ts(.ln,"@@SID@@",sid)
"RTN","SAMICAS2",825,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",826,0)
 . . quit
"RTN","SAMICAS2",827,0)
 . ;
"RTN","SAMICAS2",828,0)
 . if ln["@@SITE@@" do  ; insert site id
"RTN","SAMICAS2",829,0)
 . . n siteid s siteid=$g(filter("siteid"))
"RTN","SAMICAS2",830,0)
 . . i siteid="" s siteid=$g(filter("site"))
"RTN","SAMICAS2",831,0)
 . . q:siteid=""
"RTN","SAMICAS2",832,0)
 . . do findReplace^%ts(.ln,"@@SITE@@",siteid)
"RTN","SAMICAS2",833,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",834,0)
 . . q
"RTN","SAMICAS2",835,0)
 . ;
"RTN","SAMICAS2",836,0)
 . if ln["@@SITETITLE@@" do  ; insert site title
"RTN","SAMICAS2",837,0)
 . . n sitetit s sitetit=$g(filter("sitetitle"))
"RTN","SAMICAS2",838,0)
 . . if sitetit="" d  ;
"RTN","SAMICAS2",839,0)
 . . . n tsite s tsite=$g(filter("site"))
"RTN","SAMICAS2",840,0)
 . . . q:tsite=""
"RTN","SAMICAS2",841,0)
 . . . s sitetit=$$SITENM2^SAMISITE(tsite)_" - "_tsite
"RTN","SAMICAS2",842,0)
 . . . q
"RTN","SAMICAS2",843,0)
 . . q:sitetit=""
"RTN","SAMICAS2",844,0)
 . . do findReplace^%ts(.ln,"@@SITETITLE@@",sitetit)
"RTN","SAMICAS2",845,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",846,0)
 . . q
"RTN","SAMICAS2",847,0)
 . ;
"RTN","SAMICAS2",848,0)
 . set cnt=cnt+1
"RTN","SAMICAS2",849,0)
 . set rtn(cnt)=temp(zi)
"RTN","SAMICAS2",850,0)
 . quit
"RTN","SAMICAS2",851,0)
 ;
"RTN","SAMICAS2",852,0)
 ;
"RTN","SAMICAS2",853,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",854,0)
 ;
"RTN","SAMICAS2",855,0)
 quit  ; end of OLDNUFORM
"RTN","SAMICAS2",856,0)
 ;
"RTN","SAMICAS2",857,0)
 ;
"RTN","SAMICAS2",858,0)
 ;
"RTN","SAMICAS2",859,0)
 ;
"RTN","SAMICAS2",860,0)
 ;@section 3 WSNUUPLD & related ppses
"RTN","SAMICAS2",861,0)
 ;
"RTN","SAMICAS2",862,0)
 ;
"RTN","SAMICAS2",863,0)
 ;
"RTN","SAMICAS2",864,0)
 ;
"RTN","SAMICAS2",865,0)
 ;@wrs-code WSNUUPLD^SAMICASE
"RTN","SAMICAS2",866,0)
 ;
"RTN","SAMICAS2",867,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",868,0)
 ;
"RTN","SAMICAS2",869,0)
 ;ven/gpl;wrs;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMICAS2",870,0)
 ;@signature
"RTN","SAMICAS2",871,0)
 ; do WSNUUPLD^SAMICASE(rtn,filter)
"RTN","SAMICAS2",872,0)
 ;@branches-from
"RTN","SAMICAS2",873,0)
 ; WSNUFORM^SAMICASE
"RTN","SAMICAS2",874,0)
 ;@wrs-called-by
"RTN","SAMICAS2",875,0)
 ; WSVAPALS^SAMIHOM3 [wr nuform of ws post vapals]
"RTN","SAMICAS2",876,0)
 ;@called-by none
"RTN","SAMICAS2",877,0)
 ;@calls
"RTN","SAMICAS2",878,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS2",879,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",880,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS2",881,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS2",882,0)
 ; wsGetForm^%wf
"RTN","SAMICAS2",883,0)
 ;@input
"RTN","SAMICAS2",884,0)
 ; .filter =
"RTN","SAMICAS2",885,0)
 ; .filter("studyid")=studyid of the patient
"RTN","SAMICAS2",886,0)
 ;@output
"RTN","SAMICAS2",887,0)
 ; @rtn
"RTN","SAMICAS2",888,0)
 ;@tests
"RTN","SAMICAS2",889,0)
 ; UTWSNF^SAMIUTS2
"RTN","SAMICAS2",890,0)
 ;
"RTN","SAMICAS2",891,0)
 ;
"RTN","SAMICAS2",892,0)
WSNUUPLD ; post vapals nuform: new form for patient
"RTN","SAMICAS2",893,0)
 ;
"RTN","SAMICAS2",894,0)
 ;@stanza 2 get select-new-form form
"RTN","SAMICAS2",895,0)
 ;
"RTN","SAMICAS2",896,0)
 new sid set sid=$get(filter("studyid"))
"RTN","SAMICAS2",897,0)
 if sid="" set sid=$get(filter("sid"))
"RTN","SAMICAS2",898,0)
 quit:sid=""
"RTN","SAMICAS2",899,0)
 ;
"RTN","SAMICAS2",900,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS2",901,0)
 quit:+sien=0
"RTN","SAMICAS2",902,0)
 ;
"RTN","SAMICAS2",903,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",904,0)
 new groot set groot=$name(@root@(sien))
"RTN","SAMICAS2",905,0)
 new saminame set saminame=$get(@groot@("saminame"))
"RTN","SAMICAS2",906,0)
 quit:saminame=""
"RTN","SAMICAS2",907,0)
 ;
"RTN","SAMICAS2",908,0)
 ; gpl experiment to fool wsGetForm^%wf into processing this form
"RTN","SAMICAS2",909,0)
 ;
"RTN","SAMICAS2",910,0)
 n tmpdt s tmpdt=$$VAPALSDT^SAMICASE($$NOW^XLFDT())
"RTN","SAMICAS2",911,0)
 s tmpdt=$tr(tmpdt,"/","-")
"RTN","SAMICAS2",912,0)
 n tmpkey s tmpkey="temp-"_tmpdt ; key to fool wsGetForm
"RTN","SAMICAS2",913,0)
 s @root@("graph",sid,tmpkey,sid)=sid
"RTN","SAMICAS2",914,0)
 ;
"RTN","SAMICAS2",915,0)
 n filter
"RTN","SAMICAS2",916,0)
 s filter("form")="vapals:fileupload"
"RTN","SAMICAS2",917,0)
 s filter("studyid")=sid
"RTN","SAMICAS2",918,0)
 s filter("key")=tmpkey
"RTN","SAMICAS2",919,0)
 d wsGetForm^%wf(.rtn,.filter)
"RTN","SAMICAS2",920,0)
 k @root@("graph",sid,tmpkey) ; clean up temp false form
"RTN","SAMICAS2",921,0)
 ;
"RTN","SAMICAS2",922,0)
 quit  ; end of wrs WSNUUPLD^SAMICASE
"RTN","SAMICAS2",923,0)
 ;
"RTN","SAMICAS2",924,0)
 ;
"RTN","SAMICAS2",925,0)
 ;
"RTN","SAMICAS2",926,0)
 ;
"RTN","SAMICAS2",927,0)
 ;@proc OLDPROCESS
"RTN","SAMICAS2",928,0)
 ;
"RTN","SAMICAS2",929,0)
 ;@calls
"RTN","SAMICAS2",930,0)
 ; GETTMPL [commented out]
"RTN","SAMICAS2",931,0)
 ; GETTMPL^SAMICASE [commented out]
"RTN","SAMICAS2",932,0)
 ; getThis^%wd
"RTN","SAMICAS2",933,0)
 ; SAMIHTM^%wf [commented out]
"RTN","SAMICAS2",934,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMICAS2",935,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMICAS2",936,0)
 ; findReplace^%ts
"RTN","SAMICAS2",937,0)
 ; $$SITENM2^SAMISITE
"RTN","SAMICAS2",938,0)
 ; ^ZTER
"RTN","SAMICAS2",939,0)
 ;
"RTN","SAMICAS2",940,0)
 ;
"RTN","SAMICAS2",941,0)
OLDPROCESS() ;
"RTN","SAMICAS2",942,0)
 ;
"RTN","SAMICAS2",943,0)
 new temp,tout,form
"RTN","SAMICAS2",944,0)
 set return="temp",form="vapals:fileupload"
"RTN","SAMICAS2",945,0)
 ;do GETTMPL
"RTN","SAMICAS2",946,0)
 ;do GETTMPL^SAMICASE("temp","vapals:fileupload")
"RTN","SAMICAS2",947,0)
 do getThis^%wd("temp","fileupload.html")
"RTN","SAMICAS2",948,0)
 ;d SAMIHTM^%wf("temp","fileupload","err")
"RTN","SAMICAS2",949,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMICAS2",950,0)
 quit:'$data(temp)
"RTN","SAMICAS2",951,0)
 ;
"RTN","SAMICAS2",952,0)
 new cnt set cnt=0
"RTN","SAMICAS2",953,0)
 new zi set zi=0
"RTN","SAMICAS2",954,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  do  ;
"RTN","SAMICAS2",955,0)
 . new ln set ln=temp(zi)_$C(13,10)
"RTN","SAMICAS2",956,0)
 . new touched set touched=0
"RTN","SAMICAS2",957,0)
 . ;
"RTN","SAMICAS2",958,0)
 . if ln["href" if 'touched do  ;
"RTN","SAMICAS2",959,0)
 . . do FIXHREF^SAMIFORM(.ln)
"RTN","SAMICAS2",960,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",961,0)
 . . quit
"RTN","SAMICAS2",962,0)
 . ;
"RTN","SAMICAS2",963,0)
 . if ln["src" d  ;
"RTN","SAMICAS2",964,0)
 . . do FIXSRC^SAMIFORM(.ln)
"RTN","SAMICAS2",965,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",966,0)
 . . quit
"RTN","SAMICAS2",967,0)
 . ;
"RTN","SAMICAS2",968,0)
 . if ln["@@SID@@" do  ;
"RTN","SAMICAS2",969,0)
 . . do findReplace^%ts(.ln,"@@SID@@",sid)
"RTN","SAMICAS2",970,0)
 . . set temp(zi)=ln
"RTN","SAMICAS2",971,0)
 . . quit
"RTN","SAMICAS2",972,0)
 . ;
"RTN","SAMICAS2",973,0)
 . if ln["@@SITE@@" do  ; insert site id
"RTN","SAMICAS2",974,0)
 . . n siteid s siteid=$g(filter("siteid"))
"RTN","SAMICAS2",975,0)
 . . i siteid="" s siteid=$g(filter("site"))
"RTN","SAMICAS2",976,0)
 . . q:siteid=""
"RTN","SAMICAS2",977,0)
 . . do findReplace^%ts(.ln,"@@SITE@@",siteid)
"RTN","SAMICAS2",978,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",979,0)
 . . q
"RTN","SAMICAS2",980,0)
 . ;
"RTN","SAMICAS2",981,0)
 . if ln["@@SITETITLE@@" do  ; insert site title
"RTN","SAMICAS2",982,0)
 . . n sitetit s sitetit=$g(filter("sitetitle"))
"RTN","SAMICAS2",983,0)
 . . if sitetit="" d  ;
"RTN","SAMICAS2",984,0)
 . . . n tsite s tsite=$g(filter("site"))
"RTN","SAMICAS2",985,0)
 . . . q:tsite=""
"RTN","SAMICAS2",986,0)
 . . . s sitetit=$$SITENM2^SAMISITE(tsite)_" - "_tsite
"RTN","SAMICAS2",987,0)
 . . . q
"RTN","SAMICAS2",988,0)
 . . q:sitetit=""
"RTN","SAMICAS2",989,0)
 . . do findReplace^%ts(.ln,"@@SITETITLE@@",sitetit)
"RTN","SAMICAS2",990,0)
 . . s temp(zi)=ln
"RTN","SAMICAS2",991,0)
 . . q
"RTN","SAMICAS2",992,0)
 . ;
"RTN","SAMICAS2",993,0)
 . set cnt=cnt+1
"RTN","SAMICAS2",994,0)
 . set rtn(cnt)=temp(zi)
"RTN","SAMICAS2",995,0)
 . quit
"RTN","SAMICAS2",996,0)
 ;
"RTN","SAMICAS2",997,0)
 ;D ^ZTER
"RTN","SAMICAS2",998,0)
 ;
"RTN","SAMICAS2",999,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",1000,0)
 ;
"RTN","SAMICAS2",1001,0)
 quit  ; end of OLDPROCESS
"RTN","SAMICAS2",1002,0)
 ;
"RTN","SAMICAS2",1003,0)
 ;
"RTN","SAMICAS2",1004,0)
 ;
"RTN","SAMICAS2",1005,0)
 ;
"RTN","SAMICAS2",1006,0)
 ;@function $$DOCTYPE
"RTN","SAMICAS2",1007,0)
 ;
"RTN","SAMICAS2",1008,0)
 ;@called-by
"RTN","SAMICAS2",1009,0)
 ; GETITEMS^SAMICASE
"RTN","SAMICAS2",1010,0)
 ;@calls none
"RTN","SAMICAS2",1011,0)
 ;@input
"RTN","SAMICAS2",1012,0)
 ; code = document code
"RTN","SAMICAS2",1013,0)
 ;@output = document type, expanded from code
"RTN","SAMICAS2",1014,0)
 ;
"RTN","SAMICAS2",1015,0)
 ;
"RTN","SAMICAS2",1016,0)
DOCTYPE(code) ; document type
"RTN","SAMICAS2",1017,0)
 ;
"RTN","SAMICAS2",1018,0)
 n dtype ; document type table
"RTN","SAMICAS2",1019,0)
 s dtype("c","CT Chest")=""
"RTN","SAMICAS2",1020,0)
 s dtype("p","PET-CT")=""
"RTN","SAMICAS2",1021,0)
 s dtype("b","Biopsy")=""
"RTN","SAMICAS2",1022,0)
 s dtype("s","Surgical")=""
"RTN","SAMICAS2",1023,0)
 s dtype("a","Operative Report")=""
"RTN","SAMICAS2",1024,0)
 s dtype("d","Discharge Summary")=""
"RTN","SAMICAS2",1025,0)
 s dtype("t","Treatment Summary")=""
"RTN","SAMICAS2",1026,0)
 s dtype("f","PFT")=""
"RTN","SAMICAS2",1027,0)
 s dtype("m","Molecular Pathology")=""
"RTN","SAMICAS2",1028,0)
 s dtype("r","Bronchoscopy")=""
"RTN","SAMICAS2",1029,0)
 s dtype("cs","Consent Form")=""
"RTN","SAMICAS2",1030,0)
 s dtype("o","Other")=""
"RTN","SAMICAS2",1031,0)
 n rtn s rtn=""
"RTN","SAMICAS2",1032,0)
 i $d(dtype(code)) s rtn=$o(dtype(code,""))
"RTN","SAMICAS2",1033,0)
 ;
"RTN","SAMICAS2",1034,0)
 quit rtn ; end of $$DOCTYPE
"RTN","SAMICAS2",1035,0)
 ;
"RTN","SAMICAS2",1036,0)
 ;
"RTN","SAMICAS2",1037,0)
 ;
"RTN","SAMICAS2",1038,0)
 ;
"RTN","SAMICAS2",1039,0)
 ;@proc MINIPARS
"RTN","SAMICAS2",1040,0)
 ;
"RTN","SAMICAS2",1041,0)
 ;@calls
"RTN","SAMICAS2",1042,0)
 ; $$STRIP^XLFSTR
"RTN","SAMICAS2",1043,0)
 ;@input
"RTN","SAMICAS2",1044,0)
 ; ARY
"RTN","SAMICAS2",1045,0)
 ;@output
"RTN","SAMICAS2",1046,0)
 ; .RTN
"RTN","SAMICAS2",1047,0)
 ;
"RTN","SAMICAS2",1048,0)
 ;
"RTN","SAMICAS2",1049,0)
MINIPARS(RTN,ARY) ; parse on name=
"RTN","SAMICAS2",1050,0)
 ;
"RTN","SAMICAS2",1051,0)
 m ^gpl("BODY")=@ARY
"RTN","SAMICAS2",1052,0)
 n lastline s lastline=$o(@ARY@(" "),-1)
"RTN","SAMICAS2",1053,0)
 n debug s debug=$g(DEBUG)
"RTN","SAMICAS2",1054,0)
 n LN
"RTN","SAMICAS2",1055,0)
 n doline
"RTN","SAMICAS2",1056,0)
 f doline=1,lastline-1,lastline d  ;
"RTN","SAMICAS2",1057,0)
 . s LN=@ARY@(doline)
"RTN","SAMICAS2",1058,0)
 . n ncnt s ncnt=$l(LN,"name=")
"RTN","SAMICAS2",1059,0)
 . n i
"RTN","SAMICAS2",1060,0)
 . for i=2:1:ncnt-1 d  ;
"RTN","SAMICAS2",1061,0)
 . . n zp s zp=$p(LN,"name=",i)
"RTN","SAMICAS2",1062,0)
 . . w:debug !,"zp: ",zp
"RTN","SAMICAS2",1063,0)
 . . n zpp s zpp=$tr(zp,$C(34),"#")
"RTN","SAMICAS2",1064,0)
 . . w:debug !,"zpp: ",zpp
"RTN","SAMICAS2",1065,0)
 . . n tag,value
"RTN","SAMICAS2",1066,0)
 . . s tag=$p(zpp,"#",2)
"RTN","SAMICAS2",1067,0)
 . . w:debug !,"tag: ",tag
"RTN","SAMICAS2",1068,0)
 . . n zp2 s zp2=$e(zp,$l(tag)+3,$l(zp))
"RTN","SAMICAS2",1069,0)
 . . w:debug !,"zp2: ",zp2
"RTN","SAMICAS2",1070,0)
 . . n zp3 s zp3=$tr(zp2," ","")
"RTN","SAMICAS2",1071,0)
 . . w:debug !,"zp3: ",zp3
"RTN","SAMICAS2",1072,0)
 . . s value=$p(zp3,"-----",1)
"RTN","SAMICAS2",1073,0)
 . . s value=$$STRIP^XLFSTR(value,$C(10)_$C(13))
"RTN","SAMICAS2",1074,0)
 . . w:debug !,"value: ",value
"RTN","SAMICAS2",1075,0)
 . . s RTN(tag)=value
"RTN","SAMICAS2",1076,0)
 . . q
"RTN","SAMICAS2",1077,0)
 . q
"RTN","SAMICAS2",1078,0)
 ;
"RTN","SAMICAS2",1079,0)
 ; now isolate the document (starting with pdf)
"RTN","SAMICAS2",1080,0)
 s LN=@ARY@(1)
"RTN","SAMICAS2",1081,0)
 n right s right=$e(LN,$f(LN,"Content-Type:"),$l(LN))
"RTN","SAMICAS2",1082,0)
 ;n mime s mime=$p(right,$C(10,13),1)
"RTN","SAMICAS2",1083,0)
 ;w:debug !,"mime: ",mime
"RTN","SAMICAS2",1084,0)
 n mime s mime="application/pdf"
"RTN","SAMICAS2",1085,0)
 s RTN("Content-Type")=mime
"RTN","SAMICAS2",1086,0)
 ;b
"RTN","SAMICAS2",1087,0)
 n pdftop s pdftop=$p(right,"application/pdf",2) ; start of pdf
"RTN","SAMICAS2",1088,0)
 s @ARY@(1)=pdftop
"RTN","SAMICAS2",1089,0)
 m RTN("file")=@ARY
"RTN","SAMICAS2",1090,0)
 ;
"RTN","SAMICAS2",1091,0)
 quit  ; end of MINIPARS
"RTN","SAMICAS2",1092,0)
 ;
"RTN","SAMICAS2",1093,0)
 ;
"RTN","SAMICAS2",1094,0)
 ;
"RTN","SAMICAS2",1095,0)
 ;
"RTN","SAMICAS2",1096,0)
 ;@proc FILEUP
"RTN","SAMICAS2",1097,0)
 ;
"RTN","SAMICAS2",1098,0)
 ;@calls
"RTN","SAMICAS2",1099,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS2",1100,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",1101,0)
 ; $$DEDUP
"RTN","SAMICAS2",1102,0)
 ; WSCASE^SAMICASE
"RTN","SAMICAS2",1103,0)
 ;
"RTN","SAMICAS2",1104,0)
 ;
"RTN","SAMICAS2",1105,0)
FILEUP(SAMIARG,SAMIBODY,SAMIRESULT) ; process file upload
"RTN","SAMICAS2",1106,0)
 ;
"RTN","SAMICAS2",1107,0)
 n vars m vars=SAMIARG
"RTN","SAMICAS2",1108,0)
 ;D TOADPARSE(.vars,.SAMIARG,.SAMIBODY)
"RTN","SAMICAS2",1109,0)
 ;D MINIPARS(.vars,"SAMIARG")
"RTN","SAMICAS2",1110,0)
 q:'$d(vars)
"RTN","SAMICAS2",1111,0)
 ;
"RTN","SAMICAS2",1112,0)
 n pddos s pddos=$g(vars("pddos")) ; document data
"RTN","SAMICAS2",1113,0)
 n spdt ; screening plus date
"RTN","SAMICAS2",1114,0)
 ;s spdt=$tr(pddos,"/","-")
"RTN","SAMICAS2",1115,0)
 s spdt=$p(pddos,"/",3)_"-"_$p(pddos,"/",1)_"-"_$p(pddos,"/",2)
"RTN","SAMICAS2",1116,0)
 ;
"RTN","SAMICAS2",1117,0)
 new sid set sid=$get(vars("studyid"))
"RTN","SAMICAS2",1118,0)
 if sid="" set sid=$get(vars("sid"))
"RTN","SAMICAS2",1119,0)
 ;set sid=$g(SAMIARG("studyid"))
"RTN","SAMICAS2",1120,0)
 quit:sid=""
"RTN","SAMICAS2",1121,0)
 ;
"RTN","SAMICAS2",1122,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS2",1123,0)
 quit:+sien=0
"RTN","SAMICAS2",1124,0)
 ;
"RTN","SAMICAS2",1125,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",1126,0)
 new groot set groot=$name(@root@(sien))
"RTN","SAMICAS2",1127,0)
 new froot set froot=$name(@root@("graph",sid))
"RTN","SAMICAS2",1128,0)
 ; form root for this person
"RTN","SAMICAS2",1129,0)
 ;
"RTN","SAMICAS2",1130,0)
 new saminame set saminame=$get(@groot@("saminame"))
"RTN","SAMICAS2",1131,0)
 quit:saminame=""
"RTN","SAMICAS2",1132,0)
 s vars("saminame")=saminame
"RTN","SAMICAS2",1133,0)
 ;
"RTN","SAMICAS2",1134,0)
 n key s key="file-"_spdt
"RTN","SAMICAS2",1135,0)
 s key=$$DEDUP(key,froot) ; append dash # to key to make it unique
"RTN","SAMICAS2",1136,0)
 ;
"RTN","SAMICAS2",1137,0)
 m @froot@(key)=vars
"RTN","SAMICAS2",1138,0)
 m SAMIARG=vars
"RTN","SAMICAS2",1139,0)
 s SAMIARG("site")="XXX"
"RTN","SAMICAS2",1140,0)
 k SAMIRESULT
"RTN","SAMICAS2",1141,0)
 d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMICAS2",1142,0)
 ;
"RTN","SAMICAS2",1143,0)
 quit  ; end of FILEUP
"RTN","SAMICAS2",1144,0)
 ;
"RTN","SAMICAS2",1145,0)
 ;
"RTN","SAMICAS2",1146,0)
 ;
"RTN","SAMICAS2",1147,0)
 ;
"RTN","SAMICAS2",1148,0)
 ;@function DEDUP
"RTN","SAMICAS2",1149,0)
 ;
"RTN","SAMICAS2",1150,0)
 ;@called-by
"RTN","SAMICAS2",1151,0)
 ; FILEUP
"RTN","SAMICAS2",1152,0)
 ;@calls none
"RTN","SAMICAS2",1153,0)
 ;@input
"RTN","SAMICAS2",1154,0)
 ; key
"RTN","SAMICAS2",1155,0)
 ; froot
"RTN","SAMICAS2",1156,0)
 ;
"RTN","SAMICAS2",1157,0)
 ;
"RTN","SAMICAS2",1158,0)
DEDUP(key,froot) ; append dash # to key to make it unique
"RTN","SAMICAS2",1159,0)
 ;
"RTN","SAMICAS2",1160,0)
 ; if needed
"RTN","SAMICAS2",1161,0)
 ;
"RTN","SAMICAS2",1162,0)
 n done s done=0
"RTN","SAMICAS2",1163,0)
 n rtn s rtn=key
"RTN","SAMICAS2",1164,0)
 i $d(@froot@(rtn)) d  ;
"RTN","SAMICAS2",1165,0)
 . n zi
"RTN","SAMICAS2",1166,0)
 . f zi=1:1:99 q:done  d  ;
"RTN","SAMICAS2",1167,0)
 . . n rtn2 s rtn2=rtn_"-"_zi
"RTN","SAMICAS2",1168,0)
 . . i '$d(@froot@(rtn2)) d  ;
"RTN","SAMICAS2",1169,0)
 . . . s done=1
"RTN","SAMICAS2",1170,0)
 . . . s rtn=rtn2
"RTN","SAMICAS2",1171,0)
 . . . q
"RTN","SAMICAS2",1172,0)
 . . q
"RTN","SAMICAS2",1173,0)
 . q
"RTN","SAMICAS2",1174,0)
 ;
"RTN","SAMICAS2",1175,0)
 quit rtn ; end of $$DEDUP
"RTN","SAMICAS2",1176,0)
 ;
"RTN","SAMICAS2",1177,0)
 ;
"RTN","SAMICAS2",1178,0)
 ;
"RTN","SAMICAS2",1179,0)
 ;
"RTN","SAMICAS2",1180,0)
 ;
"RTN","SAMICAS2",1181,0)
 ;@proc FILEVIEW
"RTN","SAMICAS2",1182,0)
 ;
"RTN","SAMICAS2",1183,0)
 ;@calls
"RTN","SAMICAS2",1184,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",1185,0)
 ;
"RTN","SAMICAS2",1186,0)
 ;
"RTN","SAMICAS2",1187,0)
FILEVIEW(SAMIARG,SAMIBODY,SAMIRESULT) ; view an uploaded document
"RTN","SAMICAS2",1188,0)
 ;
"RTN","SAMICAS2",1189,0)
 n sid s sid=$g(SAMIARG("studyid"))
"RTN","SAMICAS2",1190,0)
 q:sid=""
"RTN","SAMICAS2",1191,0)
 ;
"RTN","SAMICAS2",1192,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",1193,0)
 n form s form=$g(SAMIARG("form"))
"RTN","SAMICAS2",1194,0)
 q:'$d(@root@("graph",sid,form))
"RTN","SAMICAS2",1195,0)
 ;
"RTN","SAMICAS2",1196,0)
 n gn s gn=$na(^TMP("SAMIVIEW",$J))
"RTN","SAMICAS2",1197,0)
 q:'$d(@root@("graph",sid,form,"file"))
"RTN","SAMICAS2",1198,0)
 ;
"RTN","SAMICAS2",1199,0)
 k @gn
"RTN","SAMICAS2",1200,0)
 m @gn=@root@("graph",sid,form,"file")
"RTN","SAMICAS2",1201,0)
 s SAMIRESULT=gn
"RTN","SAMICAS2",1202,0)
 s HTTPRSP("mime")="application/pdf"
"RTN","SAMICAS2",1203,0)
 ;
"RTN","SAMICAS2",1204,0)
 quit  ; end of FILEVIEW
"RTN","SAMICAS2",1205,0)
 ;
"RTN","SAMICAS2",1206,0)
 ;
"RTN","SAMICAS2",1207,0)
 ;
"RTN","SAMICAS2",1208,0)
 ;
"RTN","SAMICAS2",1209,0)
 ;@pps-code $$KEY2FM^SAMICASE
"RTN","SAMICAS2",1210,0)
 ;
"RTN","SAMICAS2",1211,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",1212,0)
 ;
"RTN","SAMICAS2",1213,0)
 ;ven/gpl;pps;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMICAS2",1214,0)
 ;@signature
"RTN","SAMICAS2",1215,0)
 ; $$KEY2FM^SAMICASE(key)
"RTN","SAMICAS2",1216,0)
 ;@branches-from
"RTN","SAMICAS2",1217,0)
 ; KEY2FM^SAMICASE
"RTN","SAMICAS2",1218,0)
 ;@ppi-called-by
"RTN","SAMICAS2",1219,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS2",1220,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS2",1221,0)
 ; $$KEY2DT^SAMICAS3
"RTN","SAMICAS2",1222,0)
 ; SAVFILTR^SAMISAV
"RTN","SAMICAS2",1223,0)
 ; SELECT^SAMIUR
"RTN","SAMICAS2",1224,0)
 ; SELECT^SAMIUR1
"RTN","SAMICAS2",1225,0)
 ; IFORM^SAMIUM2
"RTN","SAMICAS2",1226,0)
 ;@called-by none
"RTN","SAMICAS2",1227,0)
 ;@calls
"RTN","SAMICAS2",1228,0)
 ; ^%DT
"RTN","SAMICAS2",1229,0)
 ;@input
"RTN","SAMICAS2",1230,0)
 ; key = vapals key (e.g.
"RTN","SAMICAS2",1231,0)
 ;@output
"RTN","SAMICAS2",1232,0)
 ;@examples
"RTN","SAMICAS2",1233,0)
 ;  $$KEY2FM("sbform-2018-02-26") = 3180226
"RTN","SAMICAS2",1234,0)
 ;@tests
"RTN","SAMICAS2",1235,0)
 ; UTK2FM^SAMIUTS2
"RTN","SAMICAS2",1236,0)
 ;
"RTN","SAMICAS2",1237,0)
 ;
"RTN","SAMICAS2",1238,0)
KEY2FM ; convert key to fileman date
"RTN","SAMICAS2",1239,0)
 ;
"RTN","SAMICAS2",1240,0)
 ;@stanza 2 convert key to fm date
"RTN","SAMICAS2",1241,0)
 ;
"RTN","SAMICAS2",1242,0)
 new datepart set datepart=key
"RTN","SAMICAS2",1243,0)
 ; allow key to be the whole key ie ceform-2018-10-3
"RTN","SAMICAS2",1244,0)
 if $length(key,"-")>3 do
"RTN","SAMICAS2",1245,0)
 . new frm set frm=$piece(key,"-")
"RTN","SAMICAS2",1246,0)
 . set datepart=$piece(key,"-",2)_"-"_$piece(key,"-",3)_"-"_$piece(key,"-",4)
"RTN","SAMICAS2",1247,0)
 . quit
"RTN","SAMICAS2",1248,0)
 new X set X=datepart
"RTN","SAMICAS2",1249,0)
 new Y
"RTN","SAMICAS2",1250,0)
 do ^%DT ; call fileman to convert date
"RTN","SAMICAS2",1251,0)
 ;
"RTN","SAMICAS2",1252,0)
 ;
"RTN","SAMICAS2",1253,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",1254,0)
 ;
"RTN","SAMICAS2",1255,0)
 quit Y ; end of pps $$KEY2FM^SAMICASE
"RTN","SAMICAS2",1256,0)
 ;
"RTN","SAMICAS2",1257,0)
 ;
"RTN","SAMICAS2",1258,0)
 ;
"RTN","SAMICAS2",1259,0)
 ;
"RTN","SAMICAS2",1260,0)
 ;@section 4 casetbl
"RTN","SAMICAS2",1261,0)
 ;
"RTN","SAMICAS2",1262,0)
 ;
"RTN","SAMICAS2",1263,0)
 ;
"RTN","SAMICAS2",1264,0)
 ;
"RTN","SAMICAS2",1265,0)
 ;@pps $$GSAMISTA^SAMICAS2 = value of 'samistatus' from form
"RTN","SAMICAS2",1266,0)
 ;
"RTN","SAMICAS2",1267,0)
 ;@called by
"RTN","SAMICAS2",1268,0)
 ; WSCASE^SAMICAS2
"RTN","SAMICAS2",1269,0)
 ;@calls
"RTN","SAMICAS2",1270,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",1271,0)
 ;@input
"RTN","SAMICAS2",1272,0)
 ; sid  = patient's studyid
"RTN","SAMICAS2",1273,0)
 ; form = specific study form (e.g. "sbform-2018-02-26")
"RTN","SAMICAS2",1274,0)
 ;@output
"RTN","SAMICAS2",1275,0)
 ; status of the form
"RTN","SAMICAS2",1276,0)
 ;@tests
"RTN","SAMICAS2",1277,0)
 ; SAMIUTS2
"RTN","SAMICAS2",1278,0)
 ;
"RTN","SAMICAS2",1279,0)
 ;
"RTN","SAMICAS2",1280,0)
GSAMISTA(sid,form) ; extrinsic returns value of 'samistatus' from form
"RTN","SAMICAS2",1281,0)
 ;
"RTN","SAMICAS2",1282,0)
 if form["file" q ""
"RTN","SAMICAS2",1283,0)
 if form["image" q ""
"RTN","SAMICAS2",1284,0)
 ;
"RTN","SAMICAS2",1285,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",1286,0)
 new useform set useform=form
"RTN","SAMICAS2",1287,0)
 ;if form["vapals:" set useform=$p(form,"vapals:",2)
"RTN","SAMICAS2",1288,0)
 if useform="" q ""
"RTN","SAMICAS2",1289,0)
 ;
"RTN","SAMICAS2",1290,0)
 new stat set stat=$get(@root@("graph",sid,useform,"samistatus"))
"RTN","SAMICAS2",1291,0)
 if stat="" set stat="incomplete"
"RTN","SAMICAS2",1292,0)
 if useform["file" set stat=""
"RTN","SAMICAS2",1293,0)
 ;
"RTN","SAMICAS2",1294,0)
 quit stat ; end of pps $$GSAMISTA^SAMICAS2
"RTN","SAMICAS2",1295,0)
 ;
"RTN","SAMICAS2",1296,0)
 ;
"RTN","SAMICAS2",1297,0)
 ;
"RTN","SAMICAS2",1298,0)
 ;
"RTN","SAMICAS2",1299,0)
 ;@pps-code SSAMISTA^SAMICASE
"RTN","SAMICAS2",1300,0)
 ;
"RTN","SAMICAS2",1301,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",1302,0)
 ;
"RTN","SAMICAS2",1303,0)
 ;ven/gpl;pps;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMICAS2",1304,0)
 ;@signature
"RTN","SAMICAS2",1305,0)
 ; do SSAMISTA^SAMICASE(sid,form,val)
"RTN","SAMICAS2",1306,0)
 ;@branches-from
"RTN","SAMICAS2",1307,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS2",1308,0)
 ;@ppi-called-by
"RTN","SAMICAS2",1309,0)
 ; INITSTAT^SAMICAS2
"RTN","SAMICAS2",1310,0)
 ; MKSBFORM^SAMICAS3
"RTN","SAMICAS2",1311,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS2",1312,0)
 ; MKFUFORM^SAMICAS3
"RTN","SAMICAS2",1313,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS2",1314,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS2",1315,0)
 ; MKBXFORM^SAMICAS3
"RTN","SAMICAS2",1316,0)
 ; MKSBFORM^SAMIHOM3
"RTN","SAMICAS2",1317,0)
 ; MKSIFORM^SAMIHOM3
"RTN","SAMICAS2",1318,0)
 ;@called-by none
"RTN","SAMICAS2",1319,0)
 ;@calls
"RTN","SAMICAS2",1320,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",1321,0)
 ;@input
"RTN","SAMICAS2",1322,0)
 ; sid   = patient's studyid
"RTN","SAMICAS2",1323,0)
 ; form  = specific study form (e.g. "sbform-2018-02-26")
"RTN","SAMICAS2",1324,0)
 ; value = status (complete, incomplete)
"RTN","SAMICAS2",1325,0)
 ;@output
"RTN","SAMICAS2",1326,0)
 ; sets 'samistatus' to val in form
"RTN","SAMICAS2",1327,0)
 ;@examples [tbd]
"RTN","SAMICAS2",1328,0)
 ;@tests
"RTN","SAMICAS2",1329,0)
 ; UTSSAMIS^SAMIUTS2
"RTN","SAMICAS2",1330,0)
 ;
"RTN","SAMICAS2",1331,0)
 ;
"RTN","SAMICAS2",1332,0)
SSAMISTA ; set samistatus to val in form
"RTN","SAMICAS2",1333,0)
 ;
"RTN","SAMICAS2",1334,0)
 ;@stanza 2 set status
"RTN","SAMICAS2",1335,0)
 ;
"RTN","SAMICAS2",1336,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",1337,0)
 new useform set useform=form
"RTN","SAMICAS2",1338,0)
 if form["vapals:" set useform=$piece(form,"vapals:",2)
"RTN","SAMICAS2",1339,0)
 if '$data(@root@("graph",sid,useform)) quit  ; no form
"RTN","SAMICAS2",1340,0)
 set @root@("graph",sid,useform,"samistatus")=val
"RTN","SAMICAS2",1341,0)
 ;
"RTN","SAMICAS2",1342,0)
 ;
"RTN","SAMICAS2",1343,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",1344,0)
 ;
"RTN","SAMICAS2",1345,0)
 quit  ; end of pps SSAMISTA^SAMICASE
"RTN","SAMICAS2",1346,0)
 ;
"RTN","SAMICAS2",1347,0)
 ;
"RTN","SAMICAS2",1348,0)
 ;
"RTN","SAMICAS2",1349,0)
 ;
"RTN","SAMICAS2",1350,0)
 ;@wrs-code DELFORM^SAMICASE
"RTN","SAMICAS2",1351,0)
 ;
"RTN","SAMICAS2",1352,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS2",1353,0)
 ;
"RTN","SAMICAS2",1354,0)
 ;ven/gpl;wrs;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMICAS2",1355,0)
 ;@signature
"RTN","SAMICAS2",1356,0)
 ; do DELFORM^SAMICASE(RESULT,ARGS)
"RTN","SAMICAS2",1357,0)
 ;@branches-from
"RTN","SAMICAS2",1358,0)
 ; DELFORM^SAMICASE
"RTN","SAMICAS2",1359,0)
 ;@wri-called-by
"RTN","SAMICAS2",1360,0)
 ; WSVAPALS^SAMIHOM3 [wr deleteform of ws post vapals]
"RTN","SAMICAS2",1361,0)
 ;@called-by none
"RTN","SAMICAS2",1362,0)
 ;@calls
"RTN","SAMICAS2",1363,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",1364,0)
 ; $$GSAMISTA
"RTN","SAMICAS2",1365,0)
 ; WSCASE^SAMICASE
"RTN","SAMICAS2",1366,0)
 ;@input
"RTN","SAMICAS2",1367,0)
 ; .ARGS=
"RTN","SAMICAS2",1368,0)
 ; .ARGS("studyid")
"RTN","SAMICAS2",1369,0)
 ; .ARGS("form")
"RTN","SAMICAS2",1370,0)
 ;@output
"RTN","SAMICAS2",1371,0)
 ; @RESULT
"RTN","SAMICAS2",1372,0)
 ;@tests
"RTN","SAMICAS2",1373,0)
 ; UTDELFM^SAMIUTS2
"RTN","SAMICAS2",1374,0)
 ;
"RTN","SAMICAS2",1375,0)
 ; will not delete intake or background form
"RTN","SAMICAS2",1376,0)
 ;
"RTN","SAMICAS2",1377,0)
 ;
"RTN","SAMICAS2",1378,0)
DELFORM ; post vapals deleteform: delete incomplete form
"RTN","SAMICAS2",1379,0)
 ;
"RTN","SAMICAS2",1380,0)
 ;@stanza 2 delete form
"RTN","SAMICAS2",1381,0)
 ;
"RTN","SAMICAS2",1382,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",1383,0)
 new sid set sid=$get(ARGS("studyid"))
"RTN","SAMICAS2",1384,0)
 quit:sid=""
"RTN","SAMICAS2",1385,0)
 ;
"RTN","SAMICAS2",1386,0)
 new form set form=$get(ARGS("form"))
"RTN","SAMICAS2",1387,0)
 quit:form=""
"RTN","SAMICAS2",1388,0)
 ;
"RTN","SAMICAS2",1389,0)
 quit:form["siform"
"RTN","SAMICAS2",1390,0)
 ;
"RTN","SAMICAS2",1391,0)
 ; quit:'$data(@root@("graph",sid,form))  ; form does not exist
"RTN","SAMICAS2",1392,0)
 if $$GSAMISTA(sid,form)="incomplete" do
"RTN","SAMICAS2",1393,0)
 . kill @root@("graph",sid,form)
"RTN","SAMICAS2",1394,0)
 . quit
"RTN","SAMICAS2",1395,0)
 ;
"RTN","SAMICAS2",1396,0)
 kill ARGS("samiroute")
"RTN","SAMICAS2",1397,0)
 do WSCASE^SAMICASE(.RESULT,.ARGS) ; post vapals casereview:
"RTN","SAMICAS2",1398,0)
 ; generate case review page
"RTN","SAMICAS2",1399,0)
 ;
"RTN","SAMICAS2",1400,0)
 ;
"RTN","SAMICAS2",1401,0)
 ;@stanza 3 termination
"RTN","SAMICAS2",1402,0)
 ;
"RTN","SAMICAS2",1403,0)
 quit  ; end of wrs DELFORM^SAMICASE
"RTN","SAMICAS2",1404,0)
 ;
"RTN","SAMICAS2",1405,0)
 ;
"RTN","SAMICAS2",1406,0)
 ;
"RTN","SAMICAS2",1407,0)
 ;
"RTN","SAMICAS2",1408,0)
 ;@proc INITSTAT
"RTN","SAMICAS2",1409,0)
 ;
"RTN","SAMICAS2",1410,0)
 ;@called-by none
"RTN","SAMICAS2",1411,0)
 ;@calls
"RTN","SAMICAS2",1412,0)
 ; $$setroot^%wd
"RTN","SAMICAS2",1413,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS2",1414,0)
 ;@input none
"RTN","SAMICAS2",1415,0)
 ;@output
"RTN","SAMICAS2",1416,0)
 ; set all forms to 'incomplete'
"RTN","SAMICAS2",1417,0)
 ;@tests
"RTN","SAMICAS2",1418,0)
 ;
"RTN","SAMICAS2",1419,0)
 ;
"RTN","SAMICAS2",1420,0)
INITSTAT ; set all forms to 'incomplete'
"RTN","SAMICAS2",1421,0)
 ;
"RTN","SAMICAS2",1422,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS2",1423,0)
 new zi,zj set (zi,zj)=""
"RTN","SAMICAS2",1424,0)
 for  set zi=$order(@root@("graph",zi)) quit:zi=""  do  ;
"RTN","SAMICAS2",1425,0)
 . for  set zj=$order(@root@("graph",zi,zj)) quit:zj=""  do  ;
"RTN","SAMICAS2",1426,0)
 . . if zj["siform" do SSAMISTA^SAMICASE(zi,zj,"complete") quit  ;
"RTN","SAMICAS2",1427,0)
 . . do SSAMISTA^SAMICASE(zi,zj,"incomplete")
"RTN","SAMICAS2",1428,0)
 . . q
"RTN","SAMICAS2",1429,0)
 . q
"RTN","SAMICAS2",1430,0)
 ;
"RTN","SAMICAS2",1431,0)
 quit  ; end of INITSTAT
"RTN","SAMICAS2",1432,0)
 ;
"RTN","SAMICAS2",1433,0)
 ;
"RTN","SAMICAS2",1434,0)
 ;
"RTN","SAMICAS2",1435,0)
EOR ; end of routine SAMICAS2
"RTN","SAMICASE")
0^2^B3026427^B2465434
"RTN","SAMICASE",1,0)
SAMICASE ;ven/gpl - case review library; 2024-09-07t18:49z
"RTN","SAMICASE",2,0)
 ;;18.0;SAMI;**1,12,18**;2020-01-17;Build 1
"RTN","SAMICASE",3,0)
 ;mdc-e1;SAMICASE-20240909-E1aDWct;SAMI-18-18-b1
"RTN","SAMICASE",4,0)
 ;mdc-v7;B3026427;SAMI*18.0*18 SEQ #18
"RTN","SAMICASE",5,0)
 ;
"RTN","SAMICASE",6,0)
 ; SAMICASE is the service library for ScreeningPlus's Case Review
"RTN","SAMICASE",7,0)
 ; module. These services support processing of the Case Review page.
"RTN","SAMICASE",8,0)
 ;
"RTN","SAMICASE",9,0)
 quit  ; no entry from top
"RTN","SAMICASE",10,0)
 ;
"RTN","SAMICASE",11,0)
 ;
"RTN","SAMICASE",12,0)
 ;
"RTN","SAMICASE",13,0)
 ;
"RTN","SAMICASE",14,0)
 ;@section 0 primary development
"RTN","SAMICASE",15,0)
 ;
"RTN","SAMICASE",16,0)
 ;
"RTN","SAMICASE",17,0)
 ;
"RTN","SAMICASE",18,0)
 ;
"RTN","SAMICASE",19,0)
 ;@license see routine SAMIUL
"RTN","SAMICASE",20,0)
 ;@documentation see SAMICUL
"RTN","SAMICASE",21,0)
 ;@contents
"RTN","SAMICASE",22,0)
 ; (all private services)
"RTN","SAMICASE",23,0)
 ; 
"RTN","SAMICASE",24,0)
 ;
"RTN","SAMICASE",25,0)
 ;
"RTN","SAMICASE",26,0)
 ;
"RTN","SAMICASE",27,0)
 ;@section 1 web-route services
"RTN","SAMICASE",28,0)
 ;
"RTN","SAMICASE",29,0)
 ;
"RTN","SAMICASE",30,0)
 ;
"RTN","SAMICASE",31,0)
 ;
"RTN","SAMICASE",32,0)
 ;@wrs WSCASE^SAMICASE, post vapals casereview: create case review page
"RTN","SAMICASE",33,0)
WSCASE(rtn,filter) goto WSCASE^SAMICAS2
"RTN","SAMICASE",34,0)
 ;
"RTN","SAMICASE",35,0)
 ;
"RTN","SAMICASE",36,0)
 ;
"RTN","SAMICASE",37,0)
 ;@wrs WSNUFORM^SAMICASE, post vapals nuform: new form for patient
"RTN","SAMICASE",38,0)
WSNUFORM(rtn,filter) goto WSNUFORM^SAMICAS2
"RTN","SAMICASE",39,0)
 ;
"RTN","SAMICASE",40,0)
 ;
"RTN","SAMICASE",41,0)
 ;
"RTN","SAMICASE",42,0)
 ;@wrs WSNUUPLD^SAMICASE, post vapals file upload new for patient
"RTN","SAMICASE",43,0)
WSNUUPLD(rtn,filter) goto WSNUUPLD^SAMICAS2
"RTN","SAMICASE",44,0)
 ;
"RTN","SAMICASE",45,0)
 ;
"RTN","SAMICASE",46,0)
 ;
"RTN","SAMICASE",47,0)
 ;@wrs DELFORM^SAMICASE, post vapals deleteform: delete incomplete form
"RTN","SAMICASE",48,0)
DELFORM(RESULT,ARGS) goto DELFORM^SAMICAS2
"RTN","SAMICASE",49,0)
 ;
"RTN","SAMICASE",50,0)
 ;
"RTN","SAMICASE",51,0)
 ;
"RTN","SAMICASE",52,0)
 ;@wrs WSNFPOST^SAMICASE, post vapals addform: new form
"RTN","SAMICASE",53,0)
WSNFPOST(ARGS,BODY,RESULT) goto WSNFPOST^SAMICAS3
"RTN","SAMICASE",54,0)
 ;
"RTN","SAMICASE",55,0)
 ;
"RTN","SAMICASE",56,0)
 ;
"RTN","SAMICASE",57,0)
 ;
"RTN","SAMICASE",58,0)
 ;@section 2 private program services
"RTN","SAMICASE",59,0)
 ;
"RTN","SAMICASE",60,0)
 ;
"RTN","SAMICASE",61,0)
 ;
"RTN","SAMICASE",62,0)
 ;
"RTN","SAMICASE",63,0)
 ;@pps GETTMPL^SAMICASE, get html template
"RTN","SAMICASE",64,0)
GETTMPL(return,form) goto GETTMPL^SAMICAS2
"RTN","SAMICASE",65,0)
 ;
"RTN","SAMICASE",66,0)
 ;
"RTN","SAMICASE",67,0)
 ;
"RTN","SAMICASE",68,0)
 ;@pps GETITEMS^SAMICASE, get items available for studyid
"RTN","SAMICASE",69,0)
GETITEMS(ary,sid) goto GETITEMS^SAMICAS2
"RTN","SAMICASE",70,0)
 ;
"RTN","SAMICASE",71,0)
 ;
"RTN","SAMICASE",72,0)
 ;
"RTN","SAMICASE",73,0)
 ;@pps $$NOTEHREF^SAMICASE, html list of notes for form
"RTN","SAMICASE",74,0)
NOTEHREF(sid,form) goto NOTEHREF^SAMICAS2
"RTN","SAMICASE",75,0)
 ;
"RTN","SAMICASE",76,0)
 ;
"RTN","SAMICASE",77,0)
 ;
"RTN","SAMICASE",78,0)
 ;@pps $$VAPALSDT^SAMICASE, date in vapals format
"RTN","SAMICASE",79,0)
VAPALSDT(fmdate) goto VAPALSDT^SAMICAS2
"RTN","SAMICASE",80,0)
 ;
"RTN","SAMICASE",81,0)
 ;
"RTN","SAMICASE",82,0)
 ;
"RTN","SAMICASE",83,0)
 ;@pps $$KEY2FM^SAMICASE, convert key to fileman date
"RTN","SAMICASE",84,0)
KEY2FM(key) goto KEY2FM^SAMICAS2
"RTN","SAMICASE",85,0)
 ;
"RTN","SAMICASE",86,0)
 ;
"RTN","SAMICASE",87,0)
 ;
"RTN","SAMICASE",88,0)
 ;@pps SSAMISTA^SAMICASE, set samistatus to val in form
"RTN","SAMICASE",89,0)
SSAMISTA(sid,form,val) goto SSAMISTA^SAMICAS2
"RTN","SAMICASE",90,0)
 ;
"RTN","SAMICASE",91,0)
 ;
"RTN","SAMICASE",92,0)
 ;
"RTN","SAMICASE",93,0)
EOR ; end of routine SAMICASE
"RTN","SAMICUL")
0^3^B180174^B147284
"RTN","SAMICUL",1,0)
SAMICUL ;ven/gpl - case review log; 2024-09-09t12:56z
"RTN","SAMICUL",2,0)
 ;;18.0;SAMI;**9,11,12,14,15,17,18**;2020-01-17;Build 1
"RTN","SAMICUL",3,0)
 ;mdc-e1;SAMICUL-20240909-E1nq%WL;SAMI-18-18-b1
"RTN","SAMICUL",4,0)
 ;mdc-v7;B180174;SAMI*18.0*18 SEQ #18
"RTN","SAMICUL",5,0)
 ;
"RTN","SAMICUL",6,0)
 ; SAMICUL contains the development log for the ScreeningPlus Case
"RTN","SAMICUL",7,0)
 ; Review Page (SAMICA* routines). It contains no executable code.
"RTN","SAMICUL",8,0)
 ;
"RTN","SAMICUL",9,0)
 quit  ; no entry from top
"RTN","SAMICUL",10,0)
 ;
"RTN","SAMICUL",11,0)
 ;
"RTN","SAMICUL",12,0)
 ;
"RTN","SAMICUL",13,0)
 ;
"RTN","SAMICUL",14,0)
 ;@section 0 primary development
"RTN","SAMICUL",15,0)
 ;
"RTN","SAMICUL",16,0)
 ;
"RTN","SAMICUL",17,0)
 ;
"RTN","SAMICUL",18,0)
 ;
"RTN","SAMICUL",19,0)
 ;@routine-credits
"RTN","SAMICUL",20,0)
 ;
"RTN","SAMICUL",21,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMICUL",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICUL",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMICUL",24,0)
 ; http://vistaexpertise.net
"RTN","SAMICUL",25,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMICUL",26,0)
 ;@license see routine SAMIUL
"RTN","SAMICUL",27,0)
 ;
"RTN","SAMICUL",28,0)
 ;@update 2024-09-09t12:56z
"RTN","SAMICUL",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMICUL",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMICUL",31,0)
 ;@module case review - SAMICA
"RTN","SAMICUL",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMICUL",33,0)
 ;@release SAMI-18-18
"RTN","SAMICUL",34,0)
 ;@edition-date 2020-01-17
"RTN","SAMICUL",35,0)
 ;@patches **9,11,12,14,15,17,18**
"RTN","SAMICUL",36,0)
 ;
"RTN","SAMICUL",37,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMICUL",38,0)
 ; toad@vistaexpertise.net
"RTN","SAMICUL",39,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMICUL",40,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMICUL",41,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMICUL",42,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMICUL",43,0)
 ;@dev-add Domenick DiNatale (ddn)
"RTN","SAMICUL",44,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMICUL",45,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMICUL",46,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICUL",47,0)
 ;
"RTN","SAMICUL",48,0)
 ;@module-credits
"RTN","SAMICUL",49,0)
 ;
"RTN","SAMICUL",50,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICUL",51,0)
 ; (VA-PALS)
"RTN","SAMICUL",52,0)
 ; http://va-pals.org/
"RTN","SAMICUL",53,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICUL",54,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICUL",55,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICUL",56,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICUL",57,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMICUL",58,0)
 ; http://ielcap.com/
"RTN","SAMICUL",59,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICUL",60,0)
 ; http://paraxialtech.com/
"RTN","SAMICUL",61,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICUL",62,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICUL",63,0)
 ;
"RTN","SAMICUL",64,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMICUL",65,0)
 ; https://www.ielcap-airs.org
"RTN","SAMICUL",66,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMICUL",67,0)
 ;@partner-org par
"RTN","SAMICUL",68,0)
 ;
"RTN","SAMICUL",69,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICUL",70,0)
 ;
"RTN","SAMICUL",71,0)
 ; 2018-01-14 ven/gpl 18-t4
"RTN","SAMICUL",72,0)
 ;  SAMICASE split from routine SAMIFRM, incl wsCASE,GETTMPL,GETITEMS,
"RTN","SAMICUL",73,0)
 ; casetbl.
"RTN","SAMICUL",74,0)
 ;
"RTN","SAMICUL",75,0)
 ; 2018-02-05/08 ven/toad 18-t4
"RTN","SAMICUL",76,0)
 ;  SAMICASE update style, license, & attribution, spell out language
"RTN","SAMICUL",77,0)
 ; elements, add white space & do-dot quits, r/replaceAll^%wfhfrom w/
"RTN","SAMICUL",78,0)
 ; replaceAll^%wf, r/$$getTemplate^%wfhform w/$$getTemplate^%wf.
"RTN","SAMICUL",79,0)
 ;
"RTN","SAMICUL",80,0)
 ; 2018-02-14 ven/toad 18-t4
"RTN","SAMICUL",81,0)
 ;  SAMICASE r/replaceAll^%wf w/findReplaceAll^%wf, r/ln w/line, add
"RTN","SAMICUL",82,0)
 ; @calls & @called-by tags, break up some long lines.
"RTN","SAMICUL",83,0)
 ;
"RTN","SAMICUL",84,0)
 ; 2018-02-27 ven/gpl 18-t4
"RTN","SAMICUL",85,0)
 ;  SAMICASE new subroutines $$KEY2DSPD, $$GETDTKEY; in wsCASE get
"RTN","SAMICUL",86,0)
 ; 1st & last names from graph, fix paths, key forms in graph w/date.
"RTN","SAMICUL",87,0)
 ;
"RTN","SAMICUL",88,0)
 ; 2018-03-01 ven/toad 18-t4
"RTN","SAMICUL",89,0)
 ;  SAMICASE refactor & reorganize new code, add header comments, r/
"RTN","SAMICUL",90,0)
 ; findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",91,0)
 ;
"RTN","SAMICUL",92,0)
 ; 2018-03-06 ven/gpl 18-t4
"RTN","SAMICUL",93,0)
 ;  SAMICASE add New Form button, list rest of forms for patient, add
"RTN","SAMICUL",94,0)
 ; web services wsNuForm & wsNuFormPost & method MKCEFORM, extend
"RTN","SAMICUL",95,0)
 ; GETITEMS to get rest of forms.
"RTN","SAMICUL",96,0)
 ;
"RTN","SAMICUL",97,0)
 ; 2018-03-07/08 ven/toad 18-t4
"RTN","SAMICUL",98,0)
 ;  SAMICASE merge George changes w/ rest, add white space, spell out
"RTN","SAMICUL",99,0)
 ; M elements, add hdr comments to new subroutines, r/findReplace^%wf
"RTN","SAMICUL",100,0)
 ; & replaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",101,0)
 ;
"RTN","SAMICUL",102,0)
 ; 2018-03-11 ven/gpl 18-t4 9bd663ee
"RTN","SAMICUL",103,0)
 ;  SAMICAS2 vapals forms working.
"RTN","SAMICUL",104,0)
 ;
"RTN","SAMICUL",105,0)
 ; 2018-03-12 ven/gpl 18-t4 8c36c6a7
"RTN","SAMICUL",106,0)
 ;  SAMICAS2 new form works now & charts on home page.
"RTN","SAMICUL",107,0)
 ;
"RTN","SAMICUL",108,0)
 ; 2018-03-14 ven/gpl 18-t4 9653650a
"RTN","SAMICUL",109,0)
 ;  SAMICAS2 revised casereview page link, fixed external url
"RTN","SAMICUL",110,0)
 ; preservation.
"RTN","SAMICUL",111,0)
 ;
"RTN","SAMICUL",112,0)
 ; 2018-03-21 ven/gpl 18-t4 48868561
"RTN","SAMICUL",113,0)
 ;  SAMICAS2 max date insertion, case review navigation changed to
"RTN","SAMICUL",114,0)
 ; post, date order for CT Eval in case review.
"RTN","SAMICUL",115,0)
 ;
"RTN","SAMICUL",116,0)
 ; 2018-03-26 ven/gpl 18-t4 5fa4ee96
"RTN","SAMICUL",117,0)
 ;  SAMICAS2 changes to support incomplete forms display &
"RTN","SAMICUL",118,0)
 ; processing.
"RTN","SAMICUL",119,0)
 ;
"RTN","SAMICUL",120,0)
 ; 2018-03-27 ven/gpl 18-t4 cace9756
"RTN","SAMICUL",121,0)
 ;  SAMICAS2 siforms are always complete.
"RTN","SAMICUL",122,0)
 ;
"RTN","SAMICUL",123,0)
 ; 2018-04-02 ven/gpl 18-t4 00da9146
"RTN","SAMICUL",124,0)
 ;  SAMICAS2 added followup form.
"RTN","SAMICUL",125,0)
 ;
"RTN","SAMICUL",126,0)
 ; 2018-04-24 ven/gpl 18-t4 22e39d87
"RTN","SAMICUL",127,0)
 ;  SAMICAS2 added pet & biopsy forms.
"RTN","SAMICUL",128,0)
 ;
"RTN","SAMICUL",129,0)
 ; 2018-05-01 ven/gpl 18-t4 f1751c43
"RTN","SAMICUL",130,0)
 ;  SAMICAS2 fix problem with new forms: followup & pet.
"RTN","SAMICUL",131,0)
 ;
"RTN","SAMICUL",132,0)
 ; 2018-05-18 ven/lgc 18-t4 9eba8f8c
"RTN","SAMICUL",133,0)
 ;  SAMICAS2 conversion to new graph and simplified forms processing.
"RTN","SAMICUL",134,0)
 ;
"RTN","SAMICUL",135,0)
 ; 2018-05-21 ven/lgc 18-t4 0d7ed2f7
"RTN","SAMICUL",136,0)
 ;  SAMICAS2 changes for new navigation html.
"RTN","SAMICUL",137,0)
 ;
"RTN","SAMICUL",138,0)
 ; 2018-06-14 ven/lgc 18-t4 d71f4fe4
"RTN","SAMICUL",139,0)
 ;  SAMICAS2 changes to make the background form optional.
"RTN","SAMICUL",140,0)
 ;
"RTN","SAMICUL",141,0)
 ; 2018-06-20 ven/lgc 18-t4 bf03b07f
"RTN","SAMICUL",142,0)
 ;  SAMICAS2 corrections for new forms processing navigation.
"RTN","SAMICUL",143,0)
 ;
"RTN","SAMICUL",144,0)
 ; 2018-07-01 ven/lgc 18-t4 2e1541dc,8b0a4329
"RTN","SAMICUL",145,0)
 ;  SAMICAS2 add intervention forms to case review page, 1st version
"RTN","SAMICUL",146,0)
 ; of ct eval report.
"RTN","SAMICUL",147,0)
 ;
"RTN","SAMICUL",148,0)
 ; 2018-07-04 ven/lgc 18-t4 b28c1658
"RTN","SAMICUL",149,0)
 ;  SAMICAS2 fix a typo.
"RTN","SAMICUL",150,0)
 ;
"RTN","SAMICUL",151,0)
 ; 2018-07-10 ven/lgc 18-t4 2e9662b4
"RTN","SAMICUL",152,0)
 ;  SAMICAS2 repair SAMIHOM3 & redact report link.
"RTN","SAMICUL",153,0)
 ;
"RTN","SAMICUL",154,0)
 ; 2018-08-19 ven/lgc 18-t4 2ce0cab4
"RTN","SAMICUL",155,0)
 ;  SAMICAS2 use ssn instead of last5 where available.
"RTN","SAMICUL",156,0)
 ;
"RTN","SAMICUL",157,0)
 ; 2018-08-20 ven/lgc 18-t4 955fd484
"RTN","SAMICUL",158,0)
 ;  SAMICAS2 fix case review page cr lf issue.
"RTN","SAMICUL",159,0)
 ;
"RTN","SAMICUL",160,0)
 ; 2018-08-22 ven/gpl 18-t4 d67a2fe5
"RTN","SAMICUL",161,0)
 ;  SAMICAS2 turn off ctreport.
"RTN","SAMICUL",162,0)
 ;
"RTN","SAMICUL",163,0)
 ; 2018-08-30 ven/lgc 18-t4 125f1c8b
"RTN","SAMICUL",164,0)
 ;  SAMICAS2 add type index to getItems to help find last previous
"RTN","SAMICUL",165,0)
 ; form of a type.
"RTN","SAMICUL",166,0)
 ;
"RTN","SAMICUL",167,0)
 ; 2018-09-04 ven/lgc 18-t4 3e6e326f
"RTN","SAMICUL",168,0)
 ;  SAMICAS2 hide report link.
"RTN","SAMICUL",169,0)
 ;
"RTN","SAMICUL",170,0)
 ; 2018-10-14 ven/lgc 18-t4 f6e1229f
"RTN","SAMICUL",171,0)
 ;  SAMICAS2 turn on copy forward for cteval new forms.
"RTN","SAMICUL",172,0)
 ;
"RTN","SAMICUL",173,0)
 ; 2018-10-26 ven/lgc 18-t4 f19bf1ae
"RTN","SAMICUL",174,0)
 ;  SAMICAS2 ability to add multiple forms on same day.
"RTN","SAMICUL",175,0)
 ;
"RTN","SAMICUL",176,0)
 ; 2018-11-07 ven/gpl 18-t4 c76b2eac
"RTN","SAMICUL",177,0)
 ;  SAMICAS2 defend against unit test patient 1.
"RTN","SAMICUL",178,0)
 ;
"RTN","SAMICUL",179,0)
 ; 2018-11-13 ven/toad 18-t4
"RTN","SAMICUL",180,0)
 ;  SAMICAS2 SAMIHOM2 > SAMIHOM3.
"RTN","SAMICUL",181,0)
 ;
"RTN","SAMICUL",182,0)
 ; 2018-11-14 ven/lgc 18-t4 6e9799ba
"RTN","SAMICUL",183,0)
 ;  SAMICUL fix graphstore forms.
"RTN","SAMICUL",184,0)
 ;
"RTN","SAMICUL",185,0)
 ; 2018-11-28 ven/lgc 18-t4 a9539464
"RTN","SAMICUL",186,0)
 ;  SAMICAS2 work on sac compliance.
"RTN","SAMICUL",187,0)
 ;
"RTN","SAMICUL",188,0)
 ; 2018-12-11 ven/lgc 18-t4 3ceb74b5
"RTN","SAMICUL",189,0)
 ;  SAMICAS2 update for sac compliance.
"RTN","SAMICUL",190,0)
 ;
"RTN","SAMICUL",191,0)
 ; 2018-12-19/20 ven/lgc 18-t4 7a5d3400,a14554c1
"RTN","SAMICUL",192,0)
 ;  SAMICAS2 more sac compliance, r/^gpl w/^SAMIGPL.
"RTN","SAMICUL",193,0)
 ;
"RTN","SAMICUL",194,0)
 ; 2018-12-26 ven/lgc 18-t4 8dd6f34d,51eb1635
"RTN","SAMICUL",195,0)
 ;  SAMICAS2 update for sac compliance, fix accidental reversions.
"RTN","SAMICUL",196,0)
 ;
"RTN","SAMICUL",197,0)
 ; 2019-01-10 ven/lgc 18-t4 2daba010
"RTN","SAMICUL",198,0)
 ;  SAMICAS2 update for SAC compliance.
"RTN","SAMICUL",199,0)
 ;
"RTN","SAMICUL",200,0)
 ; 2019-01-22 ven/lgc 18-t4 53681219,5ddb29c5
"RTN","SAMICUL",201,0)
 ;  SAMICAS2 add license info to each SAMI routine; edit for lower
"RTN","SAMICUL",202,0)
 ; case initials.
"RTN","SAMICUL",203,0)
 ;
"RTN","SAMICUL",204,0)
 ; 2019-02-18 ven/lgc 18-t4 76874314
"RTN","SAMICUL",205,0)
 ;  SAMICAS2,SAMICAS3 update recently edited routines.
"RTN","SAMICUL",206,0)
 ;
"RTN","SAMICUL",207,0)
 ; 2019-03-13 ven/lmry 18-t4 ef66ef16
"RTN","SAMICUL",208,0)
 ;  SAMICAS2 spell out some elements missed earlier.
"RTN","SAMICUL",209,0)
 ;
"RTN","SAMICUL",210,0)
 ; 2019-03-14 ven/lmry 18-t4 038507e2
"RTN","SAMICUL",211,0)
 ;  SAMICAS3 spell out some missed M elements, fix copy/paste errors
"RTN","SAMICUL",212,0)
 ; in comments for MKFUFORM, MKBXFORM, & MKPTFORM.
"RTN","SAMICUL",213,0)
 ;
"RTN","SAMICUL",214,0)
 ; 2019-04-16 ven/lgc 18-t4 e54b76d1
"RTN","SAMICUL",215,0)
 ;  SAMICAS2 update for SAMIFORM project.
"RTN","SAMICUL",216,0)
 ;
"RTN","SAMICUL",217,0)
 ; 2019-04-23 ven/gpl 18-t4 ce322911
"RTN","SAMICUL",218,0)
 ;  SAMICAS2 add intake notes to case review page.
"RTN","SAMICUL",219,0)
 ;
"RTN","SAMICUL",220,0)
 ; 2019-06-18 ven/lgc 18-t4 91022482
"RTN","SAMICUL",221,0)
 ;  SAMICAS3 switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMICUL",222,0)
 ;
"RTN","SAMICUL",223,0)
 ; 2019-07-01 ven/gpl 18-t4 cc87cc44
"RTN","SAMICUL",224,0)
 ;  SAMICAS3 prevent >1 bkgd form/patient.
"RTN","SAMICUL",225,0)
 ;
"RTN","SAMICUL",226,0)
 ; 2019-07-07 ven/gpl 18-t4 776f7451
"RTN","SAMICUL",227,0)
 ;  SAMICAS3 resolving can't create bkgd form, branch messed up.
"RTN","SAMICUL",228,0)
 ;
"RTN","SAMICUL",229,0)
 ; 2019-08-01 ven/lgc 18-t4 d710f27d
"RTN","SAMICUL",230,0)
 ;  SAMICAS2 pull displayed facility code from Vista parameter.
"RTN","SAMICUL",231,0)
 ;
"RTN","SAMICUL",232,0)
 ; 2019-09-26 ven/gpl 18-t4 92b12324 vap-420
"RTN","SAMICUL",233,0)
 ;  SAMICAS3 prefill form date & date of baseline ct on new followup
"RTN","SAMICUL",234,0)
 ; form.
"RTN","SAMICUL",235,0)
 ;
"RTN","SAMICUL",236,0)
 ; 2019-10-01 par/dom 18-t4 4caf1a98 vap-344
"RTN","SAMICUL",237,0)
 ;  SAMICAS2 (FIM+f B309347987 E3EG98i) use proper capitalization of the word "veteran".
"RTN","SAMICUL",238,0)
 ;
"RTN","SAMICUL",239,0)
 ; 2020-01-11 ven/lgc 18 5651698a
"RTN","SAMICUL",240,0)
 ;  SAMICAS2 (F2GXiGC B319162298 E1CRxLY)
"RTN","SAMICUL",241,0)
 ;  SAMICAS3 ()
"RTN","SAMICUL",242,0)
 ; fix duplicate form overwriting.
"RTN","SAMICUL",243,0)
 ;
"RTN","SAMICUL",244,0)
 ; 2020-01-17 ven/lgc 18-1 8557207f
"RTN","SAMICUL",245,0)
 ;  SAMICAS2 (F1bHTm1 B331580525 EXBYvm) followup note.
"RTN","SAMICUL",246,0)
 ;
"RTN","SAMICUL",247,0)
 ; 2020-01-25 ven/lgc 18-3 6a07a860,6a947567
"RTN","SAMICUL",248,0)
 ;  SAMICAS3 nodule copy & fix to ru, fix subtle bug in nodule copy.
"RTN","SAMICUL",249,0)
 ;
"RTN","SAMICUL",250,0)
 ; 2020-04-11 ven/gpl 18-5 666f5b91
"RTN","SAMICUL",251,0)
 ;  SAMICAS2 (F25+rkm B352281238 E11vF2K) multi-tenancy progress.
"RTN","SAMICUL",252,0)
 ;
"RTN","SAMICUL",253,0)
 ; 2020-04-11 ven/gpl 18-5 2f2c29c1
"RTN","SAMICUL",254,0)
 ;  SAMICAS2 (FbUQid B355765098 E3XONvI) the crux of multi-tenancy.
"RTN","SAMICUL",255,0)
 ;
"RTN","SAMICUL",256,0)
 ; 2020-05-12 ven/gpl 18-5 ad11e0ea
"RTN","SAMICUL",257,0)
 ;  SAMICAS2 (F1CMJy8 B375024495 E8GidN) fix SITE on case review page.
"RTN","SAMICUL",258,0)
 ;
"RTN","SAMICUL",259,0)
 ; 2020-11-12 ven/gpl 18-9 cec1ccd6
"RTN","SAMICUL",260,0)
 ;  SAMICAS2 (F2Q4gQo B338677866 EAbsc%)
"RTN","SAMICUL",261,0)
 ;  SAMICAS3 ()
"RTN","SAMICUL",262,0)
 ; ceform date refill upgrade.
"RTN","SAMICUL",263,0)
 ;
"RTN","SAMICUL",264,0)
 ; 2020-11-13 ven/gpl 18-9 dce3c568
"RTN","SAMICUL",265,0)
 ;  SAMICAS3 prefill ceform prior scans text field.
"RTN","SAMICUL",266,0)
 ;
"RTN","SAMICUL",267,0)
 ; 2021-02-18 ven/gpl 18-9 af2a0b8a
"RTN","SAMICUL",268,0)
 ;  SAMICAS3 copy last previous CT nodules instead of last nodules in
"RTN","SAMICUL",269,0)
 ; any form.
"RTN","SAMICUL",270,0)
 ;
"RTN","SAMICUL",271,0)
 ; 2021-02-21 ven/gpl 18-9 3fd704fb
"RTN","SAMICUL",272,0)
 ;  SAMICAS3 fix bug in prefill logic.
"RTN","SAMICUL",273,0)
 ;
"RTN","SAMICUL",274,0)
 ; 2021-03-02 ven/gpl 18-9 479dc041
"RTN","SAMICUL",275,0)
 ;  SAMICAS2 (F7egiN B346281253 E1u9j9a) return error msg if no CT
"RTN","SAMICUL",276,0)
 ; Eval form exists when generating a FU note.
"RTN","SAMICUL",277,0)
 ;
"RTN","SAMICUL",278,0)
 ; 2021-03-10 ven/toad 18-9 a46a2cc1
"RTN","SAMICUL",279,0)
 ;  SAMICUL update log, convert to new vistaver schema.
"RTN","SAMICUL",280,0)
 ;  SAMICAS2,SAMICAS3 bump date & patch list, update contents, lt
"RTN","SAMICUL",281,0)
 ; refactor.
"RTN","SAMICUL",282,0)
 ;
"RTN","SAMICUL",283,0)
 ; 2021-03-16 ven/toad 18-9 a46a2cc1
"RTN","SAMICUL",284,0)
 ;  SAMICAS2 (F1DUSfS B381191061 E3L+oln) update VAPALS-ELCAP
"RTN","SAMICUL",285,0)
 ; 1.18.0.9-i9 package elements.
"RTN","SAMICUL",286,0)
 ;
"RTN","SAMICUL",287,0)
 ; 2021-03-17 ven/toad 18-9 62da30b4
"RTN","SAMICUL",288,0)
 ;  SAMICAS2 (Fxj+tI B381201104 E34EUOc) fix xindex errors: in WSCASE
"RTN","SAMICUL",289,0)
 ; add missing space between do & comment to prevent syntax error
"RTN","SAMICUL",290,0)
 ; reported as block mismatch.
"RTN","SAMICUL",291,0)
 ;  SAMICAS3 remove extra spaces at ends of 3 lines.
"RTN","SAMICUL",292,0)
 ;
"RTN","SAMICUL",293,0)
 ; 2021-04-16 ven/gpl 18-11 ac82eec
"RTN","SAMICUL",294,0)
 ;  SAMICAS3 include baseline scan in prior scans field on prefill.
"RTN","SAMICUL",295,0)
 ;
"RTN","SAMICUL",296,0)
 ; 2021-05-14/19 ven/gpl 18-11 0cbee7b,a21b056,139c6a5,0a0cccc
"RTN","SAMICUL",297,0)
 ;  SAMICAS3 improved CT eval prefill of past scan dates, urgent
"RTN","SAMICUL",298,0)
 ; fixes to CT Report & intervention & pet form prefill.
"RTN","SAMICUL",299,0)
 ;
"RTN","SAMICUL",300,0)
 ; 2021-05-20/21 ven/mcglk&toad 18-11 43a4557,424ea11,129e96b
"RTN","SAMICUL",301,0)
 ;  SAMICAS3 bump version & dates.
"RTN","SAMICUL",302,0)
 ;
"RTN","SAMICUL",303,0)
 ; 2021-05-24 ven/gpl 18-11 4aba1a9
"RTN","SAMICUL",304,0)
 ;  SAMICAS3 in MKCEFORM,MKPTFORM,MKBXFORM pass key to
"RTN","SAMICUL",305,0)
 ; CTCOPY^SAMICTC1 to modulate node-copy operation; critical fix to
"RTN","SAMICUL",306,0)
 ; copy forward for is it new field for new ct eval forms.
"RTN","SAMICUL",307,0)
 ;
"RTN","SAMICUL",308,0)
 ; 2021-05-25 ven/toad 18-11 801d7c74
"RTN","SAMICUL",309,0)
 ;  SAMICAS3 bump date; passim lt refactor.
"RTN","SAMICUL",310,0)
 ;  SAMICUL () update logs, bump dates.
"RTN","SAMICUL",311,0)
 ;
"RTN","SAMICUL",312,0)
 ; 2021-05-26/27 ven/gpl 18-11 6edc0610,73728821
"RTN","SAMICUL",313,0)
 ;  SAMICAS3 in MKITFORM add new nodule-copy block to copy forward
"RTN","SAMICUL",314,0)
 ; for intervention form; in LASTCMP,PRIORCMP init tdt to today to
"RTN","SAMICUL",315,0)
 ; start before today, to fix last comp & prior scan field prefill in
"RTN","SAMICUL",316,0)
 ; ct eval form.
"RTN","SAMICUL",317,0)
 ;
"RTN","SAMICUL",318,0)
 ; 2021-06-01 ven/toad 18-11 7dd9410c
"RTN","SAMICUL",319,0)
 ;  SAMICAS3 fold in gpl chgs fr 2021-05-26/27, annotate, adjust news
"RTN","SAMICUL",320,0)
 ; in nodule copy blocks, bump date.
"RTN","SAMICUL",321,0)
 ;
"RTN","SAMICUL",322,0)
 ; 2021-06-04 ven/toad 18-12 7dd9410c
"RTN","SAMICUL",323,0)
 ;  SAMICUL (F3jrhqk B138062 Egziza) eight versioned, logged,
"RTN","SAMICUL",324,0)
 ; annotated, refactored routines.
"RTN","SAMICUL",325,0)
 ;
"RTN","SAMICUL",326,0)
 ; 2021-06-29 ven/gpl 18-12 50d3998b,a5bbd37a
"RTN","SAMICUL",327,0)
 ;  SAMICAS3 in LASTCMP fix bug that excluded ct forms from today in
"RTN","SAMICUL",328,0)
 ; date list, init tdt to today+1 to start today; text-box formatting
"RTN","SAMICUL",329,0)
 ; for intake & followup notes, new text-processing utils; in MKFUFORM
"RTN","SAMICUL",330,0)
 ; set basedt to $$BASELNDT or $$LASTCMP or now.
"RTN","SAMICUL",331,0)
 ;
"RTN","SAMICUL",332,0)
 ; 2021-06-30/07-06 ven/mcglk&toad&gpl 18-12 d8296fda,b248664b
"RTN","SAMICUL",333,0)
 ;  SAMICASE,3 bump version & dates.
"RTN","SAMICUL",334,0)
 ;  SAMICAS3 in MKFUFORM,LASTCMP update calls & called-by.
"RTN","SAMICUL",335,0)
 ;  SAMICASE,2,3 finish converting to ppi format, annotate; fix typos.
"RTN","SAMICUL",336,0)
 ;
"RTN","SAMICUL",337,0)
 ; 2021-07-01 ven/mcglk&toad 18-12 cbf7e46b
"RTN","SAMICUL",338,0)
 ;  SAMICAS2 (F1yRLtn B443014164 E1W9a3U)
"RTN","SAMICUL",339,0)
 ;  SAMICUL (F3uTWha B143817 E3ASV%q)
"RTN","SAMICUL",340,0)
 ; bump version & dates for sami 1.18.0.12-t2+i12.
"RTN","SAMICUL",341,0)
 ;
"RTN","SAMICUL",342,0)
 ; 2021-07-06 ven/toad 18-12-b2 b248664b
"RTN","SAMICUL",343,0)
 ;  SAMICUL (F3irXA1 B144047 E2+qPp6) fold in gpl chgs, fix other
"RTN","SAMICUL",344,0)
 ; typos, update dates & dev logs.
"RTN","SAMICUL",345,0)
 ;
"RTN","SAMICUL",346,0)
 ; 2021-07-14 ven/toad 18-12-b3 e36d755d
"RTN","SAMICUL",347,0)
 ;  SAMICAS2 (F2zRM7j B443014182 E2X9aJM)
"RTN","SAMICUL",348,0)
 ;  SAMICUL (F1v%6WV B144065 E1Bzqn7)
"RTN","SAMICUL",349,0)
 ; bump 12-t2 to 12-t3, log commit ids, date formats.
"RTN","SAMICUL",350,0)
 ;
"RTN","SAMICUL",351,0)
 ; 2021-08-01 ven/gpl 18-12 5bd7c627
"RTN","SAMICUL",352,0)
 ;  SAMICAS2 (F3vS6hS B445298931 E3TAObN) set intake form to
"RTN","SAMICUL",353,0)
 ; incomplete on creation: in GSAMISTA add final line to conditionally
"RTN","SAMICUL",354,0)
 ; set stat="incomplete".
"RTN","SAMICUL",355,0)
 ;
"RTN","SAMICUL",356,0)
 ; 2021-08-01 ven/gpl 18-12 50620b8b
"RTN","SAMICUL",357,0)
 ;  SAMICAS3 exclude current date from last compare field when prev ct
"RTN","SAMICUL",358,0)
 ; report exists: in LASTCMP start w/before today; in PRIORCMP add
"RTN","SAMICUL",359,0)
 ; line to handle retstr="".
"RTN","SAMICUL",360,0)
 ;
"RTN","SAMICUL",361,0)
 ; 2021-08-11 ven/toad 18-12 b16cd38f
"RTN","SAMICUL",362,0)
 ;  SAMICAS2 (F1TfG16-B445469337-E11Nfz9)
"RTN","SAMICUL",363,0)
 ;  SAMICUL (F2i2oJW B134436 E1+1eLO)
"RTN","SAMICUL",364,0)
 ; SAMI 18-12 routines ready to validate.
"RTN","SAMICUL",365,0)
 ;
"RTN","SAMICUL",366,0)
 ; 2021-10-04 ven/gpl 18-14-b3 ec3b6e5d
"RTN","SAMICUL",367,0)
 ;  SAMICAS2 (F3Au2YF B447463868 E2kcIFe) fix for patch 14t3.
"RTN","SAMICUL",368,0)
 ;
"RTN","SAMICUL",369,0)
 ; 2021-10-05 ven/lmry 18-14 d4d1b115
"RTN","SAMICUL",370,0)
 ;  SAMICAS2 (Fh23Ov B447463890 E2Zcbeb)
"RTN","SAMICUL",371,0)
 ;  SAMICUL (F35Kvr%-B135148-E1mumY2)
"RTN","SAMICUL",372,0)
 ; update histories, bump vers + dates.
"RTN","SAMICUL",373,0)
 ;
"RTN","SAMICUL",374,0)
 ; 2021-10-05 ven/lmry 18-14 48a6bf42
"RTN","SAMICUL",375,0)
 ;  SAMICUL (F1gOhrP B135148 ELyjQQ) add git ids.
"RTN","SAMICUL",376,0)
 ;
"RTN","SAMICUL",377,0)
 ; 2021-10-26 ven/gpl 18-15 23e68f40
"RTN","SAMICUL",378,0)
 ;  SAMICAS3 init last comparative & prior scan fields to blank if
"RTN","SAMICUL",379,0)
 ; there were none.
"RTN","SAMICUL",380,0)
 ;
"RTN","SAMICUL",381,0)
 ; 2021-10-28 ven/lmry 18-15 818f7924
"RTN","SAMICUL",382,0)
 ;  SAMICUL (F3ALMBu B136079 EAldk5)
"RTN","SAMICUL",383,0)
 ; add to module log, bump date + ver.
"RTN","SAMICUL",384,0)
 ;
"RTN","SAMICUL",385,0)
 ; 2024-07-24 ven/gpl 18-17-b5 fefbf290
"RTN","SAMICUL",386,0)
 ;  SAMICAS3 (F1E7OZJ B503791124 E2BHgUe)
"RTN","SAMICUL",387,0)
 ; chgs for Mt. Sinai MRN & STUDYID.
"RTN","SAMICUL",388,0)
 ;
"RTN","SAMICUL",389,0)
 ; 2024-07-25 ven/gpl 18-17-b5 21f8aa18
"RTN","SAMICUL",390,0)
 ;  SAMICAS4 (F3WIeHw B551554 ETT4%p)
"RTN","SAMICUL",391,0)
 ; new rtn to generate Mt. Sinai clinical info line to carry over to
"RTN","SAMICUL",392,0)
 ; CTEVAL from Background form.
"RTN","SAMICUL",393,0)
 ;
"RTN","SAMICUL",394,0)
 ; 2024-07-27 ven/gpl 18-17-b5 2e91afbf
"RTN","SAMICUL",395,0)
 ;  SAMICAS4 (F2yi1x8 B6039908 E3vsSN+)
"RTN","SAMICUL",396,0)
 ; progress on clinical info for cteval form.
"RTN","SAMICUL",397,0)
 ;
"RTN","SAMICUL",398,0)
 ; 2024-07-28 ven/gpl 18-17-b5 386103da
"RTN","SAMICUL",399,0)
 ;  SAMICAS4 (F9dNf B8278420 E16AsQZ)
"RTN","SAMICUL",400,0)
 ; background form clinic info text extract for cteval form complete.
"RTN","SAMICUL",401,0)
 ;
"RTN","SAMICUL",402,0)
 ; 2024-08-03 ven/gpl 18-17-b5 2524afd6
"RTN","SAMICUL",403,0)
 ;  SAMICAS4 (F2bZS6W B10844433 E3YjdEP)
"RTN","SAMICUL",404,0)
 ; add # years since quitting to clinical info string.
"RTN","SAMICUL",405,0)
 ;
"RTN","SAMICUL",406,0)
 ; 2024-08-05 ven/gpl 18-17-b5 b92768bc
"RTN","SAMICUL",407,0)
 ;  SAMICAS4 (F3qefGe B10892126 EnpBKO)
"RTN","SAMICUL",408,0)
 ; add space after ';' in clinical info text of CT form.
"RTN","SAMICUL",409,0)
 ;
"RTN","SAMICUL",410,0)
 ; 2024-08-06 ven/gpl 18-17-b5 8e2a78f0
"RTN","SAMICUL",411,0)
 ;  SAMICAS4 (F1wlaE0 B12404533 E2tvwV6)
"RTN","SAMICUL",412,0)
 ; preserve clinical info fr/background form to/CTEVAL.
"RTN","SAMICUL",413,0)
 ;
"RTN","SAMICUL",414,0)
 ; 2024-08-12 ven/lmry 18-17-b5 eea98cdb
"RTN","SAMICUL",415,0)
 ;  SAMICAS3 (F2MCHYU B505739599 EDYWOu)
"RTN","SAMICUL",416,0)
 ;  SAMICAS4 (F32r7Or B12746608 EwBTMA)
"RTN","SAMICUL",417,0)
 ;  SAMICUL (FqzTTA B143242 E1nLZ+t)
"RTN","SAMICUL",418,0)
 ; update history, bump dates + vers.
"RTN","SAMICUL",419,0)
 ;
"RTN","SAMICUL",420,0)
 ; 2024-08-16 ven/lmry 18-17-b6 a1a28de6
"RTN","SAMICUL",421,0)
 ;  SAMICAS3 (F3yMXKa B505739588 EBXwUh)
"RTN","SAMICUL",422,0)
 ;  SAMICAS4 (F3RsSBA B12746597 EuBeEx)
"RTN","SAMICUL",423,0)
 ;  SAMICUL (F2GT7n B144151 EIEjF+)
"RTN","SAMICUL",424,0)
 ; update history, dates, + vers of routines for 18-17-b6.
"RTN","SAMICUL",425,0)
 ;
"RTN","SAMICUL",426,0)
 ; 2024-08-16 ven/lmry 18-17-b6 d0224d9e
"RTN","SAMICUL",427,0)
 ;  SAMICUL (FQG2XL B144151 EgEIfY) some post XINDEX fixes.
"RTN","SAMICUL",428,0)
 ;
"RTN","SAMICUL",429,0)
 ; 2024-18-17 ven/lmry 18-17-b6
"RTN","SAMICUL",430,0)
 ;  SAMICUL update history
"RTN","SAMICUL",431,0)
 ;  SAMICAS3,4,UL bump dates + vers, 18-18-t1 > 18-17-b6.
"RTN","SAMICUL",432,0)
 ;
"RTN","SAMICUL",433,0)
 ; 2024-08-21/22 ven/toad 18-17-b6
"RTN","SAMICUL",434,0)
 ;  SAMICAS3,4 reorganize subroutines, annotate, move the following
"RTN","SAMICUL",435,0)
 ; SAMICAS3 subroutines to SAMICAS4 to meet VA SAC routine-size limit:
"RTN","SAMICUL",436,0)
 ; BASELNDT,KEY2DT,PRIORCMP,SORTFRMS.
"RTN","SAMICUL",437,0)
 ;  SAMICUL update history.
"RTN","SAMICUL",438,0)
 ;  SAMICAS3,4,UL update version-control lines, hdr comments.
"RTN","SAMICUL",439,0)
 ;
"RTN","SAMICUL",440,0)
 ; 2024-08-26 ven/toad 18-17-b6 bd5cfb4c
"RTN","SAMICUL",441,0)
 ;  SAMICAS3 (F3NI%og B334055891 E3VZs78)
"RTN","SAMICUL",442,0)
 ;  SAMICAS4 (F1sojs5 B106029587 E1t8Ort)
"RTN","SAMICUL",443,0)
 ;  SAMICUL (F1E7l9n B145904 EOAyoU)
"RTN","SAMICUL",444,0)
 ; Rick's revisions of the 14 routines + recipe file.
"RTN","SAMICUL",445,0)
 ;
"RTN","SAMICUL",446,0)
 ; 2024-08-26 ven/mcglk 18-17-b6 [a5dae8e9 in v18-17-b6-sinai]
"RTN","SAMICUL",447,0)
 ;  SAMICAS3 (F3NI%og B334055891 E3VZs78)
"RTN","SAMICUL",448,0)
 ;  SAMICAS4 (F1sojs5 B106029587 E1t8Ort)
"RTN","SAMICUL",449,0)
 ;  SAMICUL (F1E7l9n B145904 EOAyoU)
"RTN","SAMICUL",450,0)
 ; created side branch v18-17-b6-sinai fr/dev branch
"RTN","SAMICUL",451,0)
 ; mount-sinai-changes, to use to pkg 18-17. Imported M rtns fr/commit
"RTN","SAMICUL",452,0)
 ; bd5cfb4c1d58. NOTE: This history will be lost.
"RTN","SAMICUL",453,0)
 ;
"RTN","SAMICUL",454,0)
 ; 2024-08-28 ven/gpl 18-18-b1 a2470ae1
"RTN","SAMICUL",455,0)
 ;  SAMICAS2 (FYGW B567186182 E1ubCwu)
"RTN","SAMICUL",456,0)
 ; for second build, adds viewer to case review & file upload form: in
"RTN","SAMICUL",457,0)
 ; WSCASE stanza 6, near top get imgid, near bottom add para for if
"RTN","SAMICUL",458,0)
 ; zform["image"; in GETITEMS stanza 3 after loop do ADDITEMS^SAMIDCM2
"RTN","SAMICUL",459,0)
 ; before merge; add WSNUUPLD.
"RTN","SAMICUL",460,0)
 ;
"RTN","SAMICUL",461,0)
 ; 2024-09-01 ven/gpl 18-18-b1 5ed25cbc
"RTN","SAMICUL",462,0)
 ;  SAMICAS2 (FTRKZv B348504868 E2L%nJq)
"RTN","SAMICUL",463,0)
 ; progress toward file upload feature: in WSCASE stanza 6 push all
"RTN","SAMICUL",464,0)
 ; handling of zkey subscript down into third nested loop, insert new
"RTN","SAMICUL",465,0)
 ; handling if zform["file"; in GETITEMS stanza 3 add handling if
"RTN","SAMICUL",466,0)
 ; zkey1="file"; in GETITEMS & GETDTKEY chg set of zdate to piece
"RTN","SAMICUL",467,0)
 ; apart zi; in WSNUFORM move old handling of form to OLDNUFORM & r/w/
"RTN","SAMICUL",468,0)
 ; call to wsGetForm^%wf; do likewise in WSNUUPLD, moving old handling
"RTN","SAMICUL",469,0)
 ; to OLDPROCESS; add DOCTYPE, TOADPARSE, FILEUP, DEDUP, FILEVIEW; in
"RTN","SAMICUL",470,0)
 ; KEY2FM chg set of datepart to piece apart key; in GSAMISTA handle
"RTN","SAMICUL",471,0)
 ; if form["file" or "image".
"RTN","SAMICUL",472,0)
 ;  SAMICASE (F3D91S2 B2806782 E9J2Gg)
"RTN","SAMICUL",473,0)
 ; add wrs WSNUUPLD^SAMICASE.
"RTN","SAMICUL",474,0)
 ;
"RTN","SAMICUL",475,0)
 ; 2024-09-02 ven/gpl 18-18-b1 c8d135d1
"RTN","SAMICUL",476,0)
 ;  SAMICAS2 (F3UiZsU B348504868 E1NHUNy) file upload working: add
"RTN","SAMICUL",477,0)
 ; MINIPARS; in FILEUP call it, comment out set of sid from SAMIARG;
"RTN","SAMICUL",478,0)
 ; in FILEVIEW set HTTPRSP("mime").
"RTN","SAMICUL",479,0)
 ;
"RTN","SAMICUL",480,0)
 ; 2024-09-03 ven/toad&gpl 18-17-b8
"RTN","SAMICUL",481,0)
 ;  SAMICAS4 stop crash when no background form.
"RTN","SAMICUL",482,0)
 ;  SAMICUL update history.
"RTN","SAMICUL",483,0)
 ;  SAMICAS3,CAS4,CSV,CUL,DCM1,FLD,FUL,HOM4,HUL,PAT,SITE,UR,UR2,URUL
"RTN","SAMICUL",484,0)
 ; bump version.
"RTN","SAMICUL",485,0)
 ;
"RTN","SAMICUL",486,0)
 ; 2024-09-03 ven/gpl 18-18-b1 dc4e37b1
"RTN","SAMICUL",487,0)
 ;  SAMICAS2 (F1VsBEC B348504868 E3OQd1G) some bugs removed from file
"RTN","SAMICUL",488,0)
 ; upload: in MINIPARS revise debugging code; cut TOADPARSE; in
"RTN","SAMICUL",489,0)
 ; FILEUP comment out call to MINIPARS.
"RTN","SAMICUL",490,0)
 ;
"RTN","SAMICUL",491,0)
 ; 2024-09-04 ven/toad 18-17-b8 [9a98cb08 in v18-17-b6-sinai]
"RTN","SAMICUL",492,0)
 ;  SAMICAS3 (F3fPcga B334055891 E3VZs78)
"RTN","SAMICUL",493,0)
 ;  SAMICAS4 (F3WKTYo B106133479 E3rMewp)
"RTN","SAMICUL",494,0)
 ;  SAMICUL (F3ji8 B147284 E2pffz)
"RTN","SAMICUL",495,0)
 ; fix crash if no background form, ver + chksums: SAMI-18-17-b8.
"RTN","SAMICUL",496,0)
 ;
"RTN","SAMICUL",497,0)
 ; 2024-09-07 ven/gpl 18-18-b1 0645d7c8
"RTN","SAMICUL",498,0)
 ;  SAMICAS2 (F3a9DT5 B348790202 E1Sjqd2)
"RTN","SAMICUL",499,0)
 ; fixed mrn bugs: in WSCASE stanza 4 use $$GETIDSID^SAMIUID(sid) to
"RTN","SAMICUL",500,0)
 ; set useid.
"RTN","SAMICUL",501,0)
 ;
"RTN","SAMICUL",502,0)
 ; 2024-09-05/07,09 ven/toad 18-18-b1
"RTN","SAMICUL",503,0)
 ;  SAMICAS2 09-06 (FxOjdy B381505360 EjWhNz)
"RTN","SAMICUL",504,0)
 ; update ver-ctrl lines, version, chksums, hdr comments, subrtn hdr
"RTN","SAMICUL",505,0)
 ; comments, occasional light refactoring.
"RTN","SAMICUL",506,0)
 ;  SAMICAS2 09-09 (F2IcLpC B382829905 E1vtFzO)
"RTN","SAMICUL",507,0)
 ; convert from ssn to study id: fold in George's 09-07 mod, b1 bump.
"RTN","SAMICUL",508,0)
 ;  SAMICASE 09-07 (F3wFq3n B3026427 E1aDWct)
"RTN","SAMICUL",509,0)
 ; update ver-ctrl lines, version, chksums, hdr comments, service
"RTN","SAMICUL",510,0)
 ; comments.
"RTN","SAMICUL",511,0)
 ;  SAMICASE 09-09 (F2WE3Lb B3026427 E1aDWct)
"RTN","SAMICUL",512,0)
 ; b1 bump.
"RTN","SAMICUL",513,0)
 ;  SAMICUL 09-05 (F3KdVOH B165224 E1On9iI)
"RTN","SAMICUL",514,0)
 ;  SAMICUL 09-06 (F3lmjnD B173044 E1EBFSk)
"RTN","SAMICUL",515,0)
 ;  SAMICUL 09-07 (F2Dr%J B177874 Ek39j2)
"RTN","SAMICUL",516,0)
 ;  SAMICUL 09-09 (F??? B180174 E???)
"RTN","SAMICUL",517,0)
 ; update history with 18-17 & 18-18 work + git log + checksums; take
"RTN","SAMICUL",518,0)
 ; SAMICAS2 history back to 18-0 release; take SAMICUL history back to
"RTN","SAMICUL",519,0)
 ; 18-12.
"RTN","SAMICUL",520,0)
 ;
"RTN","SAMICUL",521,0)
 ;@to-do
"RTN","SAMICUL",522,0)
 ; finish backfilling checksums + git commit IDs + chg details
"RTN","SAMICUL",523,0)
 ; finish converting SAMICAS* subroutines to service architecture
"RTN","SAMICUL",524,0)
 ;  convert calls to use SAMICASE
"RTN","SAMICUL",525,0)
 ;  update unit tests to match
"RTN","SAMICUL",526,0)
 ;
"RTN","SAMICUL",527,0)
 ;@contents
"RTN","SAMICUL",528,0)
 ;
"RTN","SAMICUL",529,0)
 ; SAMICASE case review
"RTN","SAMICUL",530,0)
 ; SAMICAS2 case review continued
"RTN","SAMICUL",531,0)
 ; SAMICAS3 case review continued
"RTN","SAMICUL",532,0)
 ; SAMICAS4 case review subroutine library
"RTN","SAMICUL",533,0)
 ; SAMICUL case review log
"RTN","SAMICUL",534,0)
 ; SAMIUTS2 case review tests
"RTN","SAMICUL",535,0)
 ;
"RTN","SAMICUL",536,0)
 ;
"RTN","SAMICUL",537,0)
 ;
"RTN","SAMICUL",538,0)
EOR ; end of routine SAMICUL
"RTN","SAMIDCM1")
0^4^B233069568^B200371935
"RTN","SAMIDCM1",1,0)
SAMIDCM1 ;ven/gpl - import patient from siemens ai; 2024-09-09t16:33z
"RTN","SAMIDCM1",2,0)
 ;;18.0;SAMI;**16,17,18**;2020-01-17;Build 1
"RTN","SAMIDCM1",3,0)
 ;mdc-e1;SAMIDCM1-20240909-E2LXhrL;SAMI-18-18-b1
"RTN","SAMIDCM1",4,0)
 ;mdc-v7;B233069568;SAMI*18.0*18 SEQ #18
"RTN","SAMIDCM1",5,0)
 ;
"RTN","SAMIDCM1",6,0)
 ; SAMIDCM1 contains services to support importing a patient into
"RTN","SAMIDCM1",7,0)
 ; ScreeningPlus from the Siemens AI.
"RTN","SAMIDCM1",8,0)
 ;
"RTN","SAMIDCM1",9,0)
 quit  ; no entry from top
"RTN","SAMIDCM1",10,0)
 ;
"RTN","SAMIDCM1",11,0)
 ;@license: see routine SAMIUL
"RTN","SAMIDCM1",12,0)
 ;
"RTN","SAMIDCM1",13,0)
 ;
"RTN","SAMIDCM1",14,0)
 ;
"RTN","SAMIDCM1",15,0)
 ;
"RTN","SAMIDCM1",16,0)
 ;@section 0 primary development
"RTN","SAMIDCM1",17,0)
 ;
"RTN","SAMIDCM1",18,0)
 ;
"RTN","SAMIDCM1",19,0)
 ;
"RTN","SAMIDCM1",20,0)
 ;
"RTN","SAMIDCM1",21,0)
 ;@routine-credits
"RTN","SAMIDCM1",22,0)
 ;
"RTN","SAMIDCM1",23,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIDCM1",24,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIDCM1",25,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIDCM1",26,0)
 ; http://vistaexpertise.net
"RTN","SAMIDCM1",27,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIDCM1",28,0)
 ;@license see routine SAMIUL
"RTN","SAMIDCM1",29,0)
 ;
"RTN","SAMIDCM1",30,0)
 ;@update 2024-09-09t16:33z
"RTN","SAMIDCM1",31,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIDCM1",32,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIDCM1",33,0)
 ;@module import/export - SAMIDCM
"RTN","SAMIDCM1",34,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIDCM1",35,0)
 ;@release 18-17
"RTN","SAMIDCM1",36,0)
 ;@edition-date 2020-01-17
"RTN","SAMIDCM1",37,0)
 ;@patches **16,17,18**
"RTN","SAMIDCM1",38,0)
 ;
"RTN","SAMIDCM1",39,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIDCM1",40,0)
 ; toad@vistaexpertise.net
"RTN","SAMIDCM1",41,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIDCM1",42,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIDCM1",43,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIDCM1",44,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIDCM1",45,0)
 ;
"RTN","SAMIDCM1",46,0)
 ;@module-credits
"RTN","SAMIDCM1",47,0)
 ;
"RTN","SAMIDCM1",48,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIDCM1",49,0)
 ; (VA-PALS)
"RTN","SAMIDCM1",50,0)
 ; http://va-pals.org/
"RTN","SAMIDCM1",51,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIDCM1",52,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIDCM1",53,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIDCM1",54,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIDCM1",55,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIDCM1",56,0)
 ; http://ielcap.com/
"RTN","SAMIDCM1",57,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIDCM1",58,0)
 ; http://paraxialtech.com/
"RTN","SAMIDCM1",59,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIDCM1",60,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIDCM1",61,0)
 ;
"RTN","SAMIDCM1",62,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIDCM1",63,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIDCM1",64,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIDCM1",65,0)
 ;@partner-org par
"RTN","SAMIDCM1",66,0)
 ;
"RTN","SAMIDCM1",67,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIDCM1",68,0)
 ;
"RTN","SAMIDCM1",69,0)
 ; 2024-08-07 ven/gpl 18-17-b5 b0b30440
"RTN","SAMIDCM1",70,0)
 ;  SAMIDCM1 (F2kt1Ls B105843717 E3RA5X%)
"RTN","SAMIDCM1",71,0)
 ; add web service to send img transactions: in MKSVC add service post
"RTN","SAMIDCM1",72,0)
 ; dcmimgin.
"RTN","SAMIDCM1",73,0)
 ;
"RTN","SAMIDCM1",74,0)
 ; 2024-08-10 ven/gpl 18-17-b5 dd7c2196
"RTN","SAMIDCM1",75,0)
 ;  SAMIDCM1 (F1XOyAb B109906029 E2Dhqcd)
"RTN","SAMIDCM1",76,0)
 ; accept img json format: in WSDCMIN process @gp@("PatientName"); in
"RTN","SAMIDCM1",77,0)
 ; normaliz handle Dicom separator.
"RTN","SAMIDCM1",78,0)
 ;
"RTN","SAMIDCM1",79,0)
 ; 2024-08-12 ven/lmry 18-17-b5 eea98cdb
"RTN","SAMIDCM1",80,0)
 ;  SAMIDCM1 (F3XvGle B114466365 E%EcRX)
"RTN","SAMIDCM1",81,0)
 ; bump dates + vers, add log.
"RTN","SAMIDCM1",82,0)
 ;
"RTN","SAMIDCM1",83,0)
 ; 2024-08-16 ven/lmry 18-17-b6 a1a28de6
"RTN","SAMIDCM1",84,0)
 ;  SAMIDCM1 (F1Lt37K B115986477 E1B17x2)
"RTN","SAMIDCM1",85,0)
 ; update history, dates, + vers of routines for 18-17-b6.
"RTN","SAMIDCM1",86,0)
 ;
"RTN","SAMIDCM1",87,0)
 ; 2024-08-21/22 ven/toad 18-17-b6
"RTN","SAMIDCM1",88,0)
 ;  SAMIDCM1 update version-control lines, dates, history, annotate;
"RTN","SAMIDCM1",89,0)
 ; getsid>GETSID, normaliz>NORMALIZ.
"RTN","SAMIDCM1",90,0)
 ;
"RTN","SAMIDCM1",91,0)
 ; 2024-08-26 ven/toad 18-17-b8 bd5cfb4c
"RTN","SAMIDCM1",92,0)
 ;  SAMIDCM1 (F1ZaHnp B200371935 ErbJMe)
"RTN","SAMIDCM1",93,0)
 ; Rick's revisions of the 14 routines + recipe file: passim.
"RTN","SAMIDCM1",94,0)
 ;
"RTN","SAMIDCM1",95,0)
 ; 2024-08-26 ven/mcglk 18-17-b8 a5dae8e9 [in temp v18-17-b6-sinai]
"RTN","SAMIDCM1",96,0)
 ;  SAMIDCM1 (F1ZaHnp B200371935 ErbJMe)
"RTN","SAMIDCM1",97,0)
 ; Imported M routines from commit bd5cfb4c1d58. NOTE: This history
"RTN","SAMIDCM1",98,0)
 ; will be lost.
"RTN","SAMIDCM1",99,0)
 ;
"RTN","SAMIDCM1",100,0)
 ; 2024-09-04 ven/toad 18-17-b8 9a98cb08 [in temp v18-17-b6-sinai]
"RTN","SAMIDCM1",101,0)
 ;  SAMIDCM1 (F2CEdt9 B200371935 ErbJMe)
"RTN","SAMIDCM1",102,0)
 ; version & checksums: SAMI-18-17-b8.
"RTN","SAMIDCM1",103,0)
 ;
"RTN","SAMIDCM1",104,0)
 ; 2024-09-06 ven/mcglk 18-17-b8 ffdb0310
"RTN","SAMIDCM1",105,0)
 ;  SAMIDCM1 (F2CEdt9 B200371935 ErbJMe)
"RTN","SAMIDCM1",106,0)
 ; Pulling in more modified routines from 18-17-b8.
"RTN","SAMIDCM1",107,0)
 ;
"RTN","SAMIDCM1",108,0)
 ; 2024-09-08 ven/gpl 18-18-b1 e04caa1a
"RTN","SAMIDCM1",109,0)
 ;  SAMIDCM1 (F1wj36B B210253473 Ea3qP)
"RTN","SAMIDCM1",110,0)
 ; fixing an emrn processing bug: in WSDCMIN add patid chk for
"RTN","SAMIDCM1",111,0)
 ; @gp@("PatientID"); in $$MATCH add MRN support.
"RTN","SAMIDCM1",112,0)
 ;
"RTN","SAMIDCM1",113,0)
 ; 2024-09-09 ven/toad 18-18-b1
"RTN","SAMIDCM1",114,0)
 ;  SAMIDCM1 (F??? B233069568 E???)
"RTN","SAMIDCM1",115,0)
 ; bump version, complete log, in MKSVC add subrtn hdr comments.
"RTN","SAMIDCM1",116,0)
 ;
"RTN","SAMIDCM1",117,0)
 ;@to-do
"RTN","SAMIDCM1",118,0)
 ;  fill in log before 18-17
"RTN","SAMIDCM1",119,0)
 ;
"RTN","SAMIDCM1",120,0)
 ;@contents
"RTN","SAMIDCM1",121,0)
 ;
"RTN","SAMIDCM1",122,0)
 ;  1. web services & direct-mode service:
"RTN","SAMIDCM1",123,0)
 ; WSDCMIN web services post dcmin & dcmimgin, receive from addpatient
"RTN","SAMIDCM1",124,0)
 ; WSDCMQ web service get dcmquery, return dcm json
"RTN","SAMIDCM1",125,0)
 ; WSDCMKIL web service get dcmreset, kill all but 1st entry in dcm-intake
"RTN","SAMIDCM1",126,0)
 ; T1 TEST CREATE A JOHN DOE PATIENT
"RTN","SAMIDCM1",127,0)
 ;
"RTN","SAMIDCM1",128,0)
 ;  2. supplementary subroutines:
"RTN","SAMIDCM1",129,0)
 ; $$MATCH match message with an existing record
"RTN","SAMIDCM1",130,0)
 ; $$NORMALIZ normalize the name
"RTN","SAMIDCM1",131,0)
 ; $$nxtdfn next available dfn
"RTN","SAMIDCM1",132,0)
 ;
"RTN","SAMIDCM1",133,0)
 ;  3. unused supplementary subroutines:
"RTN","SAMIDCM1",134,0)
 ; $$GETSID studyid
"RTN","SAMIDCM1",135,0)
 ; IDXDCM index a dcm entry after patient record creation
"RTN","SAMIDCM1",136,0)
 ;
"RTN","SAMIDCM1",137,0)
 ;  4. init subroutine to create web services:
"RTN","SAMIDCM1",138,0)
 ; MKSVC create web services
"RTN","SAMIDCM1",139,0)
 ;
"RTN","SAMIDCM1",140,0)
 ;
"RTN","SAMIDCM1",141,0)
 ;
"RTN","SAMIDCM1",142,0)
 ;
"RTN","SAMIDCM1",143,0)
 ;@ws WSDCMIN^SAMIDCM1 web services post dcmin & dcmimgin
"RTN","SAMIDCM1",144,0)
 ;
"RTN","SAMIDCM1",145,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",146,0)
 ;
"RTN","SAMIDCM1",147,0)
 ;ven/gpl;ws;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",148,0)
 ;@called-by
"RTN","SAMIDCM1",149,0)
 ; web service post dcmin
"RTN","SAMIDCM1",150,0)
 ; web service post dcmimgin
"RTN","SAMIDCM1",151,0)
 ;@calls
"RTN","SAMIDCM1",152,0)
 ; $$DUZ^SYNDHP69 [commented out]
"RTN","SAMIDCM1",153,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",154,0)
 ; decode^%webjson
"RTN","SAMIDCM1",155,0)
 ; indexFhir [commented out]
"RTN","SAMIDCM1",156,0)
 ; $$NORMALIZ
"RTN","SAMIDCM1",157,0)
 ; $$MATCH^SAMIDCM1
"RTN","SAMIDCM1",158,0)
 ; CREATE^SAMIZPH1
"RTN","SAMIDCM1",159,0)
 ; encode^%webjson
"RTN","SAMIDCM1",160,0)
 ;@input
"RTN","SAMIDCM1",161,0)
 ; ARGS =
"RTN","SAMIDCM1",162,0)
 ; BODY =
"RTN","SAMIDCM1",163,0)
 ; RESULT =
"RTN","SAMIDCM1",164,0)
 ; ien =
"RTN","SAMIDCM1",165,0)
 ;@output [tbd]
"RTN","SAMIDCM1",166,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",167,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",168,0)
 ;
"RTN","SAMIDCM1",169,0)
 ;
"RTN","SAMIDCM1",170,0)
WSDCMIN(ARGS,BODY,RESULT,ien) ; receive from addpatient
"RTN","SAMIDCM1",171,0)
 ;
"RTN","SAMIDCM1",172,0)
 s U="^"
"RTN","SAMIDCM1",173,0)
 ;S DUZ=1
"RTN","SAMIDCM1",174,0)
 ;S DUZ("AG")="V"
"RTN","SAMIDCM1",175,0)
 ;S DUZ(2)=500
"RTN","SAMIDCM1",176,0)
 ;N USER S USER=$$DUZ^SYNDHP69
"RTN","SAMIDCM1",177,0)
 ;
"RTN","SAMIDCM1",178,0)
 new json,root,gr,id,return
"RTN","SAMIDCM1",179,0)
 set root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",180,0)
 if $get(ien)="" do
"RTN","SAMIDCM1",181,0)
 . set ien=$order(@root@(" "),-1)+1
"RTN","SAMIDCM1",182,0)
 . set gr=$name(@root@(ien,"json"))
"RTN","SAMIDCM1",183,0)
 . do decode^%webjson("BODY",gr)
"RTN","SAMIDCM1",184,0)
 . kill BODY ;
"RTN","SAMIDCM1",185,0)
 . q
"RTN","SAMIDCM1",186,0)
 ;
"RTN","SAMIDCM1",187,0)
 ;do indexFhir(ien)
"RTN","SAMIDCM1",188,0)
 ;
"RTN","SAMIDCM1",189,0)
 set site=$get(ARGS("siteid"))
"RTN","SAMIDCM1",190,0)
 if site="" set site="XXX" ; default to test site
"RTN","SAMIDCM1",191,0)
 if site'="" set @root@("SITE",site,ien)="" ;
"RTN","SAMIDCM1",192,0)
 ;
"RTN","SAMIDCM1",193,0)
 ; patient name
"RTN","SAMIDCM1",194,0)
 ;
"RTN","SAMIDCM1",195,0)
 ;
"RTN","SAMIDCM1",196,0)
 n gp s gp=$na(@root@(ien,"json","patient_study_details"))
"RTN","SAMIDCM1",197,0)
 i '$d(@gp) d  ;
"RTN","SAMIDCM1",198,0)
 . s gp=$na(@root@(ien,"patient_details"))
"RTN","SAMIDCM1",199,0)
 . q:$d(@gp)
"RTN","SAMIDCM1",200,0)
 . s gp=$na(@root@(ien,"json"))
"RTN","SAMIDCM1",201,0)
 . q:$d(@gp@("PatientName"))
"RTN","SAMIDCM1",202,0)
 . s return("error")="Missing patient study details"
"RTN","SAMIDCM1",203,0)
 . q
"RTN","SAMIDCM1",204,0)
 ;
"RTN","SAMIDCM1",205,0)
 ;patient_study_details 
"RTN","SAMIDCM1",206,0)
 ;--Frame of Reference UID 1.3.6.1.4.1.14519.5.2.1.6279.6001.178796764874541005921876698858
"RTN","SAMIDCM1",207,0)
 ;--Manufacturer Siemens Healthineers
"RTN","SAMIDCM1",208,0)
 ;--Manufacturer's Model Name AIRC Research
"RTN","SAMIDCM1",209,0)
 ;--Patient ID LIDC-IDRI-0492
"RTN","SAMIDCM1",210,0)
 ;--Patient's Birth Date 
"RTN","SAMIDCM1",211,0)
 ;--\s 
"RTN","SAMIDCM1",212,0)
 ;--Patient's Name 
"RTN","SAMIDCM1",213,0)
 ;--\s 
"RTN","SAMIDCM1",214,0)
 ;--Patient's Sex F
"RTN","SAMIDCM1",215,0)
 ;--SOP Class UID 1.2.840.10008.5.1.4.1.1.88.34
"RTN","SAMIDCM1",216,0)
 ;--Series Description AIRC Research Structured Report
"RTN","SAMIDCM1",217,0)
 ;--Slice Thickness 1
"RTN","SAMIDCM1",218,0)
 ;--\n 1.0
"RTN","SAMIDCM1",219,0)
 ;--Study Date 20000101
"RTN","SAMIDCM1",220,0)
 ;--\s 
"RTN","SAMIDCM1",221,0)
 ;--Tracking Identifier L2
"RTN","SAMIDCM1",222,0)
 ;--Tracking Unique Identifier
"RTN","SAMIDCM1",223,0)
 ;
"RTN","SAMIDCM1",224,0)
 d  ; Extract Identifying information
"RTN","SAMIDCM1",225,0)
 . n vars
"RTN","SAMIDCM1",226,0)
 . n name s name=$g(@gp@("Patient's Name"))
"RTN","SAMIDCM1",227,0)
 . i name="" s name=$g(@gp@("PatientName"))
"RTN","SAMIDCM1",228,0)
 . i name="" s vars("name")=name
"RTN","SAMIDCM1",229,0)
 . e  s vars("name")=$$NORMALIZ(name)
"RTN","SAMIDCM1",230,0)
 . n dob s dob=$g(@gp@("Patient's Birth Date"))
"RTN","SAMIDCM1",231,0)
 . i dob="" s dob=20000302
"RTN","SAMIDCM1",232,0)
 . s vars("dob")=dob
"RTN","SAMIDCM1",233,0)
 . n gender s gender=$g(@gp@("Patient's Sex"))
"RTN","SAMIDCM1",234,0)
 . i gender="" s gender="M"
"RTN","SAMIDCM1",235,0)
 . s vars("gender")=gender
"RTN","SAMIDCM1",236,0)
 . n patid s patid=$g(@gp@("Patient ID"))
"RTN","SAMIDCM1",237,0)
 . i patid="" s patid=$g(@gp@("PatientID"))
"RTN","SAMIDCM1",238,0)
 . s vars("patid")=patid
"RTN","SAMIDCM1",239,0)
 . n studyDate s studyDate=$g(@gp@("Study Date"))
"RTN","SAMIDCM1",240,0)
 . i studyDate'="" s vars("studyDate")=studyDate
"RTN","SAMIDCM1",241,0)
 . n trackID s trackID=$g(@gp@("Tracking Identifier"))
"RTN","SAMIDCM1",242,0)
 . s vars("trackingIdentifier")=trackID
"RTN","SAMIDCM1",243,0)
 . s vars("site")=site
"RTN","SAMIDCM1",244,0)
 . s vars("ssn")=999999999
"RTN","SAMIDCM1",245,0)
 . s vars("sistatus")="active"
"RTN","SAMIDCM1",246,0)
 . ;
"RTN","SAMIDCM1",247,0)
 . i '$$MATCH^SAMIDCM1(.vars) d CREATE^SAMIZPH1(.vars)
"RTN","SAMIDCM1",248,0)
 . m @root@(ien)=vars
"RTN","SAMIDCM1",249,0)
 . s name=$g(vars("name"))
"RTN","SAMIDCM1",250,0)
 . i name'="" s @root@("name",name,ien)=""
"RTN","SAMIDCM1",251,0)
 . n studyid s studyid=$g(vars("studyid"))
"RTN","SAMIDCM1",252,0)
 . i studyid'="" s @root@("studyid",studyid,ien)=""
"RTN","SAMIDCM1",253,0)
 . n dfn s dfn=$g(vars("dfn"))
"RTN","SAMIDCM1",254,0)
 . i dfn'="" s @root@("dfn",dfn,ien)=""
"RTN","SAMIDCM1",255,0)
 . i patid'="" s @root@("patid",patid,ien)=""
"RTN","SAMIDCM1",256,0)
 . q
"RTN","SAMIDCM1",257,0)
 ;
"RTN","SAMIDCM1",258,0)
 ;
"RTN","SAMIDCM1",259,0)
 set return("status")="ok"
"RTN","SAMIDCM1",260,0)
 set return("siteid")=site
"RTN","SAMIDCM1",261,0)
 set return("ien")=ien
"RTN","SAMIDCM1",262,0)
 ;
"RTN","SAMIDCM1",263,0)
 if $get(ARGS("returngraph"))=1 do  ;
"RTN","SAMIDCM1",264,0)
 . merge return("graph")=@root@(ien)
"RTN","SAMIDCM1",265,0)
 . q
"RTN","SAMIDCM1",266,0)
 ;
"RTN","SAMIDCM1",267,0)
 n jary
"RTN","SAMIDCM1",268,0)
 m jary("result")=return
"RTN","SAMIDCM1",269,0)
 d encode^%webjson("jary","RESULT")
"RTN","SAMIDCM1",270,0)
 s HTTPRSP("mime")="application/json"
"RTN","SAMIDCM1",271,0)
 ;
"RTN","SAMIDCM1",272,0)
 quit  ; end of ws WSDCMIN^SAMIDCM1
"RTN","SAMIDCM1",273,0)
 ;
"RTN","SAMIDCM1",274,0)
 ;
"RTN","SAMIDCM1",275,0)
 ;
"RTN","SAMIDCM1",276,0)
 ;
"RTN","SAMIDCM1",277,0)
 ;@ws-code WSDCMQ^SAMIDCM1 web service get dcmquery
"RTN","SAMIDCM1",278,0)
 ;
"RTN","SAMIDCM1",279,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",280,0)
 ;
"RTN","SAMIDCM1",281,0)
 ;ven/gpl;ws;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",282,0)
 ;@called-by
"RTN","SAMIDCM1",283,0)
 ; web service get dcmquery
"RTN","SAMIDCM1",284,0)
 ;@calls
"RTN","SAMIDCM1",285,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",286,0)
 ; encode^%webjson
"RTN","SAMIDCM1",287,0)
 ;@input
"RTN","SAMIDCM1",288,0)
 ; return =
"RTN","SAMIDCM1",289,0)
 ; filter =
"RTN","SAMIDCM1",290,0)
 ;@output [tbd]
"RTN","SAMIDCM1",291,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",292,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",293,0)
 ;
"RTN","SAMIDCM1",294,0)
 ;
"RTN","SAMIDCM1",295,0)
WSDCMQ(return,filter) ; return dcm json
"RTN","SAMIDCM1",296,0)
 ;
"RTN","SAMIDCM1",297,0)
 n root s root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",298,0)
 n sid s sid=$g(filter("studyid"))
"RTN","SAMIDCM1",299,0)
 i sid="" s sid=$g(filter("sid"))
"RTN","SAMIDCM1",300,0)
 i sid="" q ""
"RTN","SAMIDCM1",301,0)
 n ien s ien=$o(@root@("studyid",sid,""))
"RTN","SAMIDCM1",302,0)
 i ien="" q ""
"RTN","SAMIDCM1",303,0)
 ;n ien s ien=$o(@root@(" "),-1)
"RTN","SAMIDCM1",304,0)
 ;
"RTN","SAMIDCM1",305,0)
 n jary,json
"RTN","SAMIDCM1",306,0)
 n cnt s cnt=0
"RTN","SAMIDCM1",307,0)
 s ien=""
"RTN","SAMIDCM1",308,0)
 f  s ien=$o(@root@("studyid",sid,ien)) q:ien=""  d  ;
"RTN","SAMIDCM1",309,0)
 . s cnt=cnt+1
"RTN","SAMIDCM1",310,0)
 . m jary("result",cnt)=@root@(ien,"json")
"RTN","SAMIDCM1",311,0)
 . q
"RTN","SAMIDCM1",312,0)
 d encode^%webjson("jary","return")
"RTN","SAMIDCM1",313,0)
 ;
"RTN","SAMIDCM1",314,0)
 quit  ; end of ws WSDCMQ^SAMIDCM1
"RTN","SAMIDCM1",315,0)
 ;
"RTN","SAMIDCM1",316,0)
 ;
"RTN","SAMIDCM1",317,0)
 ;
"RTN","SAMIDCM1",318,0)
 ;
"RTN","SAMIDCM1",319,0)
 ;@ws-code WSDCMKIL^SAMIDCM1 web service get dcmreset
"RTN","SAMIDCM1",320,0)
 ;
"RTN","SAMIDCM1",321,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",322,0)
 ;
"RTN","SAMIDCM1",323,0)
 ;ven/gpl;ws;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",324,0)
 ;@called-by
"RTN","SAMIDCM1",325,0)
 ; web service get dcmreset
"RTN","SAMIDCM1",326,0)
 ;@calls
"RTN","SAMIDCM1",327,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",328,0)
 ; UNINDXPT^SAMIHOM4
"RTN","SAMIDCM1",329,0)
 ; INDXPTLK^SAMIHOM4
"RTN","SAMIDCM1",330,0)
 ;@input
"RTN","SAMIDCM1",331,0)
 ; return =
"RTN","SAMIDCM1",332,0)
 ; filter =
"RTN","SAMIDCM1",333,0)
 ;@output [tbd]
"RTN","SAMIDCM1",334,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",335,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",336,0)
 ;
"RTN","SAMIDCM1",337,0)
 ;
"RTN","SAMIDCM1",338,0)
WSDCMKIL(return,filter) ; kill all but the 1st entry in dcm-intake
"RTN","SAMIDCM1",339,0)
 ;
"RTN","SAMIDCM1",340,0)
 n lroot,proot,droot
"RTN","SAMIDCM1",341,0)
 n lien,pien,dien s (lien,pien,dien)=""
"RTN","SAMIDCM1",342,0)
 s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",343,0)
 s proot=$$setroot^%wd("vapals-patient")
"RTN","SAMIDCM1",344,0)
 s droot=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",345,0)
 ;
"RTN","SAMIDCM1",346,0)
 n nam s nam="DOE"
"RTN","SAMIDCM1",347,0)
 f i="DOE","PATIENT" d  ;
"RTN","SAMIDCM1",348,0)
 . s nam=i
"RTN","SAMIDCM1",349,0)
 . f  s nam=$o(@lroot@("name",nam)) q:nam=""  q:nam'[i  d  ;
"RTN","SAMIDCM1",350,0)
 . . f  s lien=$o(@lroot@("name",nam,lien)) q:lien=""  d  ;
"RTN","SAMIDCM1",351,0)
 . . . ;w !,nam," ",lien
"RTN","SAMIDCM1",352,0)
 . . . d UNINDXPT^SAMIHOM4(lien)
"RTN","SAMIDCM1",353,0)
 . . . n newnam
"RTN","SAMIDCM1",354,0)
 . . . s newnam="ZZZ"_$e(nam,4,$l(nam))
"RTN","SAMIDCM1",355,0)
 . . . s @lroot@(lien,"saminame")=newnam
"RTN","SAMIDCM1",356,0)
 . . . s @lroot@(lien,"name")=newnam
"RTN","SAMIDCM1",357,0)
 . . . s @lroot@(lien,"fname")=$p(newnam,",",2)
"RTN","SAMIDCM1",358,0)
 . . . s @lroot@(lien,"lname")=$p(newnam,",",1)
"RTN","SAMIDCM1",359,0)
 . . . d INDXPTLK^SAMIHOM4(lien)
"RTN","SAMIDCM1",360,0)
 . . . q
"RTN","SAMIDCM1",361,0)
 . . q
"RTN","SAMIDCM1",362,0)
 . q
"RTN","SAMIDCM1",363,0)
 ;
"RTN","SAMIDCM1",364,0)
 n atmp s atmp=@droot@(0)
"RTN","SAMIDCM1",365,0)
 k @droot
"RTN","SAMIDCM1",366,0)
 s @droot@(0)=atmp
"RTN","SAMIDCM1",367,0)
 ;i $d(^webbak(587)) d  ;
"RTN","SAMIDCM1",368,0)
 ;. m @droot=^webbak(587) ; restore default
"RTN","SAMIDCM1",369,0)
 i $d(^webbak(667)) d  ;
"RTN","SAMIDCM1",370,0)
 . m @droot=^webbak(667) ; restore default
"RTN","SAMIDCM1",371,0)
 . n sid,sidien
"RTN","SAMIDCM1",372,0)
 . ;f dfn="9000227"  d  ;
"RTN","SAMIDCM1",373,0)
 . f dfn="9000057","9000058" d  ;
"RTN","SAMIDCM1",374,0)
 . . s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIDCM1",375,0)
 . . q:lien=""
"RTN","SAMIDCM1",376,0)
 . . d UNINDXPT^SAMIHOM4(lien)
"RTN","SAMIDCM1",377,0)
 . . n newname
"RTN","SAMIDCM1",378,0)
 . . s newname="DOE"_dfn_",JOHN"
"RTN","SAMIDCM1",379,0)
 . . s @lroot@(lien,"name")=newname
"RTN","SAMIDCM1",380,0)
 . . s @lroot@(lien,"saminame")=newname
"RTN","SAMIDCM1",381,0)
 . . s @lroot@(lien,"fname")=$p(newname,",",2)
"RTN","SAMIDCM1",382,0)
 . . s @lroot@(lien,"lname")=$p(newname,",",1)
"RTN","SAMIDCM1",383,0)
 . . d INDXPTLK^SAMIHOM4(lien)
"RTN","SAMIDCM1",384,0)
 . . q
"RTN","SAMIDCM1",385,0)
 . q
"RTN","SAMIDCM1",386,0)
 ;
"RTN","SAMIDCM1",387,0)
 quit  ; end of ws WSDCMKIL^SAMIDCM1
"RTN","SAMIDCM1",388,0)
 ;
"RTN","SAMIDCM1",389,0)
 ;
"RTN","SAMIDCM1",390,0)
 ;
"RTN","SAMIDCM1",391,0)
 ;
"RTN","SAMIDCM1",392,0)
 ;n root s root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",393,0)
 ;n sid s sid=$g(@root@(1,"sid"))
"RTN","SAMIDCM1",394,0)
 ;i sid="" s sid="XXX0023"
"RTN","SAMIDCM1",395,0)
 ;n atmp m atmp=@root@(1)
"RTN","SAMIDCM1",396,0)
 ;d purgegraph^%wd("dcm-intake")
"RTN","SAMIDCM1",397,0)
 ;s root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",398,0)
 ;m @root@(1)=atmp
"RTN","SAMIDCM1",399,0)
 ;s @root@("sid",sid,1)=""
"RTN","SAMIDCM1",400,0)
 q
"RTN","SAMIDCM1",401,0)
 ;
"RTN","SAMIDCM1",402,0)
 ;
"RTN","SAMIDCM1",403,0)
 ;
"RTN","SAMIDCM1",404,0)
 ;
"RTN","SAMIDCM1",405,0)
 ;@dms T1^SAMIDCM1
"RTN","SAMIDCM1",406,0)
 ;
"RTN","SAMIDCM1",407,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",408,0)
 ;
"RTN","SAMIDCM1",409,0)
 ;ven/gpl;dms;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",410,0)
 ;@called-by [tbd]
"RTN","SAMIDCM1",411,0)
 ;@calls
"RTN","SAMIDCM1",412,0)
 ; $$nxtdfn^SAMIDCM1
"RTN","SAMIDCM1",413,0)
 ; CREATE^SAMIZPH1
"RTN","SAMIDCM1",414,0)
 ;@input [tbd]
"RTN","SAMIDCM1",415,0)
 ;@output [tbd]
"RTN","SAMIDCM1",416,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",417,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",418,0)
 ;
"RTN","SAMIDCM1",419,0)
 ;
"RTN","SAMIDCM1",420,0)
T1() ; TEST CREATE A JOHN DOE PATIENT
"RTN","SAMIDCM1",421,0)
 ;
"RTN","SAMIDCM1",422,0)
 D  ;
"RTN","SAMIDCM1",423,0)
 . n vars
"RTN","SAMIDCM1",424,0)
 . s vars("dob")=20000302
"RTN","SAMIDCM1",425,0)
 . s vars("gender")="M"
"RTN","SAMIDCM1",426,0)
 . n nxtdfn s nxtdfn=$$nxtdfn^SAMIDCM1()
"RTN","SAMIDCM1",427,0)
 . s vars("saminame")="DOE"_nxtdfn_",JOHN"
"RTN","SAMIDCM1",428,0)
 . s vars("name")=vars("saminame")
"RTN","SAMIDCM1",429,0)
 . s vars("site")="XXX"
"RTN","SAMIDCM1",430,0)
 . s vars("ssn")=999999999
"RTN","SAMIDCM1",431,0)
 . s vars("sistatus")="active"
"RTN","SAMIDCM1",432,0)
 . d CREATE^SAMIZPH1(.vars)
"RTN","SAMIDCM1",433,0)
 . x "ZWR vars"
"RTN","SAMIDCM1",434,0)
 . q
"RTN","SAMIDCM1",435,0)
 ;
"RTN","SAMIDCM1",436,0)
 quit  ; end of T1
"RTN","SAMIDCM1",437,0)
 ;
"RTN","SAMIDCM1",438,0)
 ;
"RTN","SAMIDCM1",439,0)
 ;
"RTN","SAMIDCM1",440,0)
 ;
"RTN","SAMIDCM1",441,0)
 ;@section 2 supplementary subroutines
"RTN","SAMIDCM1",442,0)
 ;
"RTN","SAMIDCM1",443,0)
 ;
"RTN","SAMIDCM1",444,0)
 ;
"RTN","SAMIDCM1",445,0)
 ;
"RTN","SAMIDCM1",446,0)
 ;@func $$MATCH^SAMIDCM1
"RTN","SAMIDCM1",447,0)
 ;
"RTN","SAMIDCM1",448,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",449,0)
 ;
"RTN","SAMIDCM1",450,0)
 ;ven/gpl;private;function;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",451,0)
 ;@called-by
"RTN","SAMIDCM1",452,0)
 ; WSDCMIN^SAMIDCM1
"RTN","SAMIDCM1",453,0)
 ;@calls
"RTN","SAMIDCM1",454,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",455,0)
 ; $$NORMALIZ
"RTN","SAMIDCM1",456,0)
 ; ENROLL^SAMIZPH1
"RTN","SAMIDCM1",457,0)
 ;@input
"RTN","SAMIDCM1",458,0)
 ; vars =
"RTN","SAMIDCM1",459,0)
 ;@output = normalized name
"RTN","SAMIDCM1",460,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",461,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",462,0)
 ;
"RTN","SAMIDCM1",463,0)
 ;
"RTN","SAMIDCM1",464,0)
MATCH(vars) ; extrinsic which tries to match the message with an
"RTN","SAMIDCM1",465,0)
 ; existing record
"RTN","SAMIDCM1",466,0)
 ;
"RTN","SAMIDCM1",467,0)
 n lroot,proot,droot
"RTN","SAMIDCM1",468,0)
 s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",469,0)
 s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIDCM1",470,0)
 s droot=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",471,0)
 n found s found=0
"RTN","SAMIDCM1",472,0)
 n name s name=$$NORMALIZ($g(vars("name")))
"RTN","SAMIDCM1",473,0)
 n patid s patid=$g(vars("patid"))
"RTN","SAMIDCM1",474,0)
 s vars("simrn")=patid
"RTN","SAMIDCM1",475,0)
 n dien,lien,pien
"RTN","SAMIDCM1",476,0)
 ;
"RTN","SAMIDCM1",477,0)
 ; first look at the dcm-intake for name matches
"RTN","SAMIDCM1",478,0)
 s dien=$o(@droot@("mrn",patid,""))
"RTN","SAMIDCM1",479,0)
 i dien="" s dien=$o(@droot@("name",name,""))
"RTN","SAMIDCM1",480,0)
 i dien'="" d  ; the name or mrn has been found locally
"RTN","SAMIDCM1",481,0)
 . s found=1
"RTN","SAMIDCM1",482,0)
 . n dfn,studyid
"RTN","SAMIDCM1",483,0)
 . s dfn=$g(@droot@(dien,"dfn"))
"RTN","SAMIDCM1",484,0)
 . i dfn'="" s vars("dfn")=dfn
"RTN","SAMIDCM1",485,0)
 . i dfn="" s found=0 q  ;
"RTN","SAMIDCM1",486,0)
 . s studyid=$g(@droot@(dien,"studyid"))
"RTN","SAMIDCM1",487,0)
 . i studyid="" s found=0 q  ;
"RTN","SAMIDCM1",488,0)
 . i studyid'="" s vars("studyid")=studyid
"RTN","SAMIDCM1",489,0)
 . s vars("simrn")=patid
"RTN","SAMIDCM1",490,0)
 . q
"RTN","SAMIDCM1",491,0)
 ;
"RTN","SAMIDCM1",492,0)
 if found=1 q found
"RTN","SAMIDCM1",493,0)
 ;
"RTN","SAMIDCM1",494,0)
 i dien="" d  ; not here, check patient-lookup
"RTN","SAMIDCM1",495,0)
 . n patid s patid=$g(vars("patid"))
"RTN","SAMIDCM1",496,0)
 . s lien=$o(@lroot@("mrn",patid,""))
"RTN","SAMIDCM1",497,0)
 . i lien="" s lien=$o(@lroot@("name",name,""))
"RTN","SAMIDCM1",498,0)
 . i lien="" s found=0 q  ;
"RTN","SAMIDCM1",499,0)
 . i lien'="" s found=1
"RTN","SAMIDCM1",500,0)
 . n dfn,studyid
"RTN","SAMIDCM1",501,0)
 . s dfn=$g(@lroot@(lien,"dfn"))
"RTN","SAMIDCM1",502,0)
 . s vars("dfn")=dfn
"RTN","SAMIDCM1",503,0)
 . i dfn="" s found=0 q  ;
"RTN","SAMIDCM1",504,0)
 . s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIDCM1",505,0)
 . d ENROLL^SAMIZPH1(.vars)
"RTN","SAMIDCM1",506,0)
 . s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIDCM1",507,0)
 . i pien="" s found=0 q  ;
"RTN","SAMIDCM1",508,0)
 . s studyid=$g(@proot@(pien,"studyid"))
"RTN","SAMIDCM1",509,0)
 . s vars("studyid")=studyid
"RTN","SAMIDCM1",510,0)
 . i studyid="" s found=0 q  ;
"RTN","SAMIDCM1",511,0)
 . s vars("simrn")=patid
"RTN","SAMIDCM1",512,0)
 . q
"RTN","SAMIDCM1",513,0)
 ;
"RTN","SAMIDCM1",514,0)
 quit found ; end of $$MATCH^SAMIDCM1
"RTN","SAMIDCM1",515,0)
 ;
"RTN","SAMIDCM1",516,0)
 ;
"RTN","SAMIDCM1",517,0)
 ;
"RTN","SAMIDCM1",518,0)
 ;
"RTN","SAMIDCM1",519,0)
 ;@func $$NORMALIZ^SAMIDCM1
"RTN","SAMIDCM1",520,0)
 ;
"RTN","SAMIDCM1",521,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",522,0)
 ;
"RTN","SAMIDCM1",523,0)
 ;ven/gpl;private;function;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",524,0)
 ;@called-by
"RTN","SAMIDCM1",525,0)
 ; WSDCMIN^SAMIDCM1
"RTN","SAMIDCM1",526,0)
 ; $$MATCH^SAMIDCM1
"RTN","SAMIDCM1",527,0)
 ;@calls none
"RTN","SAMIDCM1",528,0)
 ;@input
"RTN","SAMIDCM1",529,0)
 ; name =
"RTN","SAMIDCM1",530,0)
 ;@output = normalized name
"RTN","SAMIDCM1",531,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",532,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",533,0)
 ;
"RTN","SAMIDCM1",534,0)
 ;
"RTN","SAMIDCM1",535,0)
NORMALIZ(name) ; extrinsic which tries to normalize the name
"RTN","SAMIDCM1",536,0)
 ;
"RTN","SAMIDCM1",537,0)
 n znam s znam=name
"RTN","SAMIDCM1",538,0)
 i name["^" d  q znam  ;; if name has Dicom separator
"RTN","SAMIDCM1",539,0)
 . s znam=$tr(znam,"^",",")
"RTN","SAMIDCM1",540,0)
 . q
"RTN","SAMIDCM1",541,0)
 ;
"RTN","SAMIDCM1",542,0)
 i name'["," d  ; if no comma, then try a space
"RTN","SAMIDCM1",543,0)
 . i $l(name," ")>0 d  ;
"RTN","SAMIDCM1",544,0)
 . . n fnam,lnam
"RTN","SAMIDCM1",545,0)
 . . s fnam=$p(name," ",1)
"RTN","SAMIDCM1",546,0)
 . . s lnam=$p(name," ",$l(name," "))
"RTN","SAMIDCM1",547,0)
 . . s fnam=$p(name,lnam,1)
"RTN","SAMIDCM1",548,0)
 . . s znam=lnam_","_fnam
"RTN","SAMIDCM1",549,0)
 . . q
"RTN","SAMIDCM1",550,0)
 . q
"RTN","SAMIDCM1",551,0)
 ;
"RTN","SAMIDCM1",552,0)
 quit znam ; end of $$NORMALIZ^SAMIDCM1
"RTN","SAMIDCM1",553,0)
 ;
"RTN","SAMIDCM1",554,0)
 ;
"RTN","SAMIDCM1",555,0)
 ;
"RTN","SAMIDCM1",556,0)
 ;
"RTN","SAMIDCM1",557,0)
 ;@var $$nxtdfn^SAMIDCM1
"RTN","SAMIDCM1",558,0)
 ;
"RTN","SAMIDCM1",559,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",560,0)
 ;
"RTN","SAMIDCM1",561,0)
 ;ven/gpl;private;variable;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",562,0)
 ;@called-by
"RTN","SAMIDCM1",563,0)
 ; T1^SAMIDCM1
"RTN","SAMIDCM1",564,0)
 ; REGISTER^SAMILD2
"RTN","SAMIDCM1",565,0)
 ; REGISTER^SAMILOAD
"RTN","SAMIDCM1",566,0)
 ; REGISTER^SAMIZPH1
"RTN","SAMIDCM1",567,0)
 ;@calls
"RTN","SAMIDCM1",568,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",569,0)
 ;@input [tbd]
"RTN","SAMIDCM1",570,0)
 ;@output = available dfn
"RTN","SAMIDCM1",571,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",572,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",573,0)
 ;
"RTN","SAMIDCM1",574,0)
 ;
"RTN","SAMIDCM1",575,0)
nxtdfn() ; next available dfn
"RTN","SAMIDCM1",576,0)
 ;
"RTN","SAMIDCM1",577,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",578,0)
 ;
"RTN","SAMIDCM1",579,0)
 q $o(@root@("dfn"," "),-1)+1 ; end of $$nxtdfn^SAMIDCM1
"RTN","SAMIDCM1",580,0)
 ;
"RTN","SAMIDCM1",581,0)
 ;
"RTN","SAMIDCM1",582,0)
 ;
"RTN","SAMIDCM1",583,0)
 ;
"RTN","SAMIDCM1",584,0)
 ;@section 3 unused supplementary subroutines
"RTN","SAMIDCM1",585,0)
 ;
"RTN","SAMIDCM1",586,0)
 ;
"RTN","SAMIDCM1",587,0)
 ;
"RTN","SAMIDCM1",588,0)
 ;
"RTN","SAMIDCM1",589,0)
 ;@func $$GETSID^SAMIDCM1
"RTN","SAMIDCM1",590,0)
 ;
"RTN","SAMIDCM1",591,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",592,0)
 ;
"RTN","SAMIDCM1",593,0)
 ;ven/gpl;private;function;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",594,0)
 ;@called-by none
"RTN","SAMIDCM1",595,0)
 ;@calls
"RTN","SAMIDCM1",596,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",597,0)
 ;@input
"RTN","SAMIDCM1",598,0)
 ; name =
"RTN","SAMIDCM1",599,0)
 ;@output = study id
"RTN","SAMIDCM1",600,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",601,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",602,0)
 ;
"RTN","SAMIDCM1",603,0)
 ;
"RTN","SAMIDCM1",604,0)
GETSID(name) ; return studyid
"RTN","SAMIDCM1",605,0)
 ;
"RTN","SAMIDCM1",606,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIDCM1",607,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIDCM1",608,0)
 n lien s lien=$o(@root@("name",name,""))
"RTN","SAMIDCM1",609,0)
 n dfn s dfn=$g(@root@(lien,"dfn"))
"RTN","SAMIDCM1",610,0)
 n pien s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIDCM1",611,0)
 q:pien="" ""
"RTN","SAMIDCM1",612,0)
 ;
"RTN","SAMIDCM1",613,0)
 quit $g(@proot@(pien,"sisid")) ; end of $$GETSID^SAMIDCM1
"RTN","SAMIDCM1",614,0)
 ;
"RTN","SAMIDCM1",615,0)
 ;
"RTN","SAMIDCM1",616,0)
 ;
"RTN","SAMIDCM1",617,0)
 ;
"RTN","SAMIDCM1",618,0)
 ;@proc IDXDCM^SAMIDCM1
"RTN","SAMIDCM1",619,0)
 ;
"RTN","SAMIDCM1",620,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",621,0)
 ;
"RTN","SAMIDCM1",622,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;??% tests;port?
"RTN","SAMIDCM1",623,0)
 ;@called-by none
"RTN","SAMIDCM1",624,0)
 ;@calls
"RTN","SAMIDCM1",625,0)
 ; $$setroot^%wd
"RTN","SAMIDCM1",626,0)
 ;@input
"RTN","SAMIDCM1",627,0)
 ; dien =
"RTN","SAMIDCM1",628,0)
 ; ARY =
"RTN","SAMIDCM1",629,0)
 ;@output [tbd]
"RTN","SAMIDCM1",630,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",631,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",632,0)
 ;
"RTN","SAMIDCM1",633,0)
 ;
"RTN","SAMIDCM1",634,0)
IDXDCM(dien,ARY) ; index a dcm entry after patient record creation
"RTN","SAMIDCM1",635,0)
 ;
"RTN","SAMIDCM1",636,0)
 n droot s droot=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM1",637,0)
 i $d(ARY) m @droot@(dien)=ARY
"RTN","SAMIDCM1",638,0)
 d  ;
"RTN","SAMIDCM1",639,0)
 . n x
"RTN","SAMIDCM1",640,0)
 . s x=$g(@droot@(dien,"dfn"))
"RTN","SAMIDCM1",641,0)
 . if x'="" s @droot@("dfn",x,dien)=""
"RTN","SAMIDCM1",642,0)
 . s x=$g(@droot@(dien,"saminame"))
"RTN","SAMIDCM1",643,0)
 . i x="" s x=$g(@droot@(dien,"name"))
"RTN","SAMIDCM1",644,0)
 . i x'="" s @droot@("name",x,dien)=""
"RTN","SAMIDCM1",645,0)
 . s x=$g(@droot@(dien,"studyid"))
"RTN","SAMIDCM1",646,0)
 . i x="" s x=$g(@droot@(dien,"sid"))
"RTN","SAMIDCM1",647,0)
 . i x'="" s @droot@("sid",x,dien)=""
"RTN","SAMIDCM1",648,0)
 . q
"RTN","SAMIDCM1",649,0)
 ;
"RTN","SAMIDCM1",650,0)
 quit  ; end of IDXDCM
"RTN","SAMIDCM1",651,0)
 ;
"RTN","SAMIDCM1",652,0)
 ;
"RTN","SAMIDCM1",653,0)
 ;
"RTN","SAMIDCM1",654,0)
 ;
"RTN","SAMIDCM1",655,0)
 ;@section 4 init subroutine to create web services
"RTN","SAMIDCM1",656,0)
 ;
"RTN","SAMIDCM1",657,0)
 ;
"RTN","SAMIDCM1",658,0)
 ;
"RTN","SAMIDCM1",659,0)
 ;
"RTN","SAMIDCM1",660,0)
 ;@dms MKSVC^SAMIDCM1
"RTN","SAMIDCM1",661,0)
 ;
"RTN","SAMIDCM1",662,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM1",663,0)
 ;
"RTN","SAMIDCM1",664,0)
 ;ven/gpl;dms;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMIDCM1",665,0)
 ;@called-by none
"RTN","SAMIDCM1",666,0)
 ;@calls
"RTN","SAMIDCM1",667,0)
 ; deleteService^%webutils
"RTN","SAMIDCM1",668,0)
 ; addService^%webutils
"RTN","SAMIDCM1",669,0)
 ;@input none
"RTN","SAMIDCM1",670,0)
 ;@output
"RTN","SAMIDCM1",671,0)
 ; creates web services:
"RTN","SAMIDCM1",672,0)
 ;  post dcmimgin
"RTN","SAMIDCM1",673,0)
 ;  post dcmin
"RTN","SAMIDCM1",674,0)
 ;  post dcmquery
"RTN","SAMIDCM1",675,0)
 ;  post dcmreset
"RTN","SAMIDCM1",676,0)
 ;@examples [tbd]
"RTN","SAMIDCM1",677,0)
 ;@tests [tbd]
"RTN","SAMIDCM1",678,0)
 ;
"RTN","SAMIDCM1",679,0)
 ;
"RTN","SAMIDCM1",680,0)
MKSVC() ; create web services
"RTN","SAMIDCM1",681,0)
 ;
"RTN","SAMIDCM1",682,0)
 d deleteService^%webutils("POST","dcmimgin")
"RTN","SAMIDCM1",683,0)
 d addService^%webutils("POST","dcmimgin","WSDCMIN^SAMIDCM1")
"RTN","SAMIDCM1",684,0)
 ;
"RTN","SAMIDCM1",685,0)
 d deleteService^%webutils("POST","dcmin")
"RTN","SAMIDCM1",686,0)
 d addService^%webutils("POST","dcmin","WSDCMIN^SAMIDCM1")
"RTN","SAMIDCM1",687,0)
 ;
"RTN","SAMIDCM1",688,0)
 d deleteService^%webutils("GET","dcmquery")
"RTN","SAMIDCM1",689,0)
 d addService^%webutils("GET","dcmquery","WSDCMQ^SAMIDCM1")
"RTN","SAMIDCM1",690,0)
 ;
"RTN","SAMIDCM1",691,0)
 d deleteService^%webutils("GET","dcmreset")
"RTN","SAMIDCM1",692,0)
 d addService^%webutils("GET","dcmreset","WSDCMKIL^SAMIDCM1")
"RTN","SAMIDCM1",693,0)
 ;
"RTN","SAMIDCM1",694,0)
 quit  ; end of dms MKSVC^SAMIDCM1
"RTN","SAMIDCM1",695,0)
 ;
"RTN","SAMIDCM1",696,0)
 ;
"RTN","SAMIDCM1",697,0)
 ;
"RTN","SAMIDCM1",698,0)
EOR ; end of routine SAMIDCM1
"RTN","SAMIDCM2")
0^5^B13901388
"RTN","SAMIDCM2",1,0)
SAMIDCM2 ;ven/gpl - import from siemens ai; 2024-09-12t02:44z
"RTN","SAMIDCM2",2,0)
 ;;18.0;SAMI;**18**;2020-01-17;Build 1
"RTN","SAMIDCM2",3,0)
 ;mdc-e1;SAMIDCM2-20240912-E21JzWb;SAMI-18-18-b1
"RTN","SAMIDCM2",4,0)
 ;mdc-v7;B13901388;SAMI*18.0*18 SEQ #18
"RTN","SAMIDCM2",5,0)
 ;
"RTN","SAMIDCM2",6,0)
 ; SAMIDCM2 contains services to support importing a patient into
"RTN","SAMIDCM2",7,0)
 ; ScreeningPlus from the Siemens AI.
"RTN","SAMIDCM2",8,0)
 ;
"RTN","SAMIDCM2",9,0)
 quit  ; no entry from top
"RTN","SAMIDCM2",10,0)
 ;
"RTN","SAMIDCM2",11,0)
 ;@license: see routine SAMIUL
"RTN","SAMIDCM2",12,0)
 ;
"RTN","SAMIDCM2",13,0)
 ;
"RTN","SAMIDCM2",14,0)
 ;
"RTN","SAMIDCM2",15,0)
 ;
"RTN","SAMIDCM2",16,0)
 ;@section 0 primary development
"RTN","SAMIDCM2",17,0)
 ;
"RTN","SAMIDCM2",18,0)
 ;
"RTN","SAMIDCM2",19,0)
 ;
"RTN","SAMIDCM2",20,0)
 ;
"RTN","SAMIDCM2",21,0)
 ;@routine-credits
"RTN","SAMIDCM2",22,0)
 ;
"RTN","SAMIDCM2",23,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIDCM2",24,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIDCM2",25,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIDCM2",26,0)
 ; http://vistaexpertise.net
"RTN","SAMIDCM2",27,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIDCM2",28,0)
 ;@license see routine SAMIUL
"RTN","SAMIDCM2",29,0)
 ;
"RTN","SAMIDCM2",30,0)
 ;@update 2024-09-12t02:44z
"RTN","SAMIDCM2",31,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIDCM2",32,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIDCM2",33,0)
 ;@module import/export - SAMIDCM
"RTN","SAMIDCM2",34,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIDCM2",35,0)
 ;@release 18-18
"RTN","SAMIDCM2",36,0)
 ;@edition-date 2020-01-17
"RTN","SAMIDCM2",37,0)
 ;@patches **18**
"RTN","SAMIDCM2",38,0)
 ;
"RTN","SAMIDCM2",39,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIDCM2",40,0)
 ; toad@vistaexpertise.net
"RTN","SAMIDCM2",41,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIDCM2",42,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIDCM2",43,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIDCM2",44,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIDCM2",45,0)
 ;
"RTN","SAMIDCM2",46,0)
 ;
"RTN","SAMIDCM2",47,0)
 ;@module-credits
"RTN","SAMIDCM2",48,0)
 ;
"RTN","SAMIDCM2",49,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIDCM2",50,0)
 ; (VA-PALS)
"RTN","SAMIDCM2",51,0)
 ; http://va-pals.org/
"RTN","SAMIDCM2",52,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIDCM2",53,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIDCM2",54,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIDCM2",55,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIDCM2",56,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIDCM2",57,0)
 ; http://ielcap.com/
"RTN","SAMIDCM2",58,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIDCM2",59,0)
 ; http://paraxialtech.com/
"RTN","SAMIDCM2",60,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIDCM2",61,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIDCM2",62,0)
 ;
"RTN","SAMIDCM2",63,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIDCM2",64,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIDCM2",65,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIDCM2",66,0)
 ;@partner-org par
"RTN","SAMIDCM2",67,0)
 ;
"RTN","SAMIDCM2",68,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIDCM2",69,0)
 ;
"RTN","SAMIDCM2",70,0)
 ; 2024-08-28 ven/gpl 18-18-b1 a2470ae1
"RTN","SAMIDCM2",71,0)
 ;  SAMIDCM2 (F2mxHuw B3750990 E3TEKrb)
"RTN","SAMIDCM2",72,0)
 ; add rtn w/ADDITEMS,WSSHODOC,LOADPDF,VIEWURL; for 2nd bld, add
"RTN","SAMIDCM2",73,0)
 ; viewer to case review + file upload form.
"RTN","SAMIDCM2",74,0)
 ;
"RTN","SAMIDCM2",75,0)
 ; 2024-09-02 ven/gpl 18-18-b1 c8d135d1
"RTN","SAMIDCM2",76,0)
 ;  SAMIDCM2 (F2qWk B3750990 E2j7Bmz)
"RTN","SAMIDCM2",77,0)
 ; file upload working: overhaul WSSHODOC.
"RTN","SAMIDCM2",78,0)
 ;
"RTN","SAMIDCM2",79,0)
 ; 2024-09-09 ven/toad 18-18-b1
"RTN","SAMIDCM2",80,0)
 ;  SAMIDCM2 (F??? B7818411 E???)
"RTN","SAMIDCM2",81,0)
 ; add hdr + subrtn hdr comments, log, bump version + dates.
"RTN","SAMIDCM2",82,0)
 ;
"RTN","SAMIDCM2",83,0)
 ;@contents
"RTN","SAMIDCM2",84,0)
 ; ADDITEMS add Image items to Items array
"RTN","SAMIDCM2",85,0)
 ; WSSHODOC
"RTN","SAMIDCM2",86,0)
 ; LOADPDF
"RTN","SAMIDCM2",87,0)
 ; $$VIEWURL URL to use for image viewer
"RTN","SAMIDCM2",88,0)
 ;
"RTN","SAMIDCM2",89,0)
 ;
"RTN","SAMIDCM2",90,0)
 ;
"RTN","SAMIDCM2",91,0)
 ;
"RTN","SAMIDCM2",92,0)
 ;@section 1 subroutines
"RTN","SAMIDCM2",93,0)
 ;
"RTN","SAMIDCM2",94,0)
 ;
"RTN","SAMIDCM2",95,0)
 ;
"RTN","SAMIDCM2",96,0)
 ;
"RTN","SAMIDCM2",97,0)
 ;@proc ADDITEMS
"RTN","SAMIDCM2",98,0)
 ;
"RTN","SAMIDCM2",99,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM2",100,0)
 ;
"RTN","SAMIDCM2",101,0)
 ;ven/gpl;private;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMIDCM2",102,0)
 ;@called-by
"RTN","SAMIDCM2",103,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIDCM2",104,0)
 ;@calls
"RTN","SAMIDCM2",105,0)
 ; $$setroot^%wd
"RTN","SAMIDCM2",106,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMIDCM2",107,0)
 ;@input
"RTN","SAMIDCM2",108,0)
 ; ARY = output array, closed reference
"RTN","SAMIDCM2",109,0)
 ; SID = study id
"RTN","SAMIDCM2",110,0)
 ;@output
"RTN","SAMIDCM2",111,0)
 ; @ARY@("sort",times,"image",keys,"Image") = siuids
"RTN","SAMIDCM2",112,0)
 ;@examples [tbd]
"RTN","SAMIDCM2",113,0)
 ;@tests [tbd]
"RTN","SAMIDCM2",114,0)
 ;
"RTN","SAMIDCM2",115,0)
 ;
"RTN","SAMIDCM2",116,0)
ADDITEMS(ARY,SID) ; add Image items to Items array
"RTN","SAMIDCM2",117,0)
 ;
"RTN","SAMIDCM2",118,0)
 new root set root=$$setroot^%wd("dcm-intake")
"RTN","SAMIDCM2",119,0)
 ;
"RTN","SAMIDCM2",120,0)
 q:'$d(@root@("studyid",SID))  ; nothing to add
"RTN","SAMIDCM2",121,0)
 ;
"RTN","SAMIDCM2",122,0)
 n images s images=""
"RTN","SAMIDCM2",123,0)
 n ien s ien=""
"RTN","SAMIDCM2",124,0)
 f  s ien=$o(@root@("studyid",SID,ien)) q:ien=""  d  ;
"RTN","SAMIDCM2",125,0)
 . n studydt s studydt=$g(@root@(ien,"json","StudyDate"))
"RTN","SAMIDCM2",126,0)
 . q:studydt=""
"RTN","SAMIDCM2",127,0)
 . ;
"RTN","SAMIDCM2",128,0)
 . n siuid s siuid=$g(@root@(ien,"json","StudyInstanceUID"))
"RTN","SAMIDCM2",129,0)
 . q:siuid=""
"RTN","SAMIDCM2",130,0)
 . ;
"RTN","SAMIDCM2",131,0)
 . ; add each image item only once to Items array
"RTN","SAMIDCM2",132,0)
 . q:$d(images(siuid))
"RTN","SAMIDCM2",133,0)
 . s images(siuid)=""
"RTN","SAMIDCM2",134,0)
 . ;
"RTN","SAMIDCM2",135,0)
 . n key s key="image-"_$e(studydt,1,4)_"-"_$e(studydt,5,6)_"-"_$e(studydt,7,8)
"RTN","SAMIDCM2",136,0)
 . n fmdt s fmdt=$$KEY2FM^SAMICASE(key)
"RTN","SAMIDCM2",137,0)
 . s @ARY@("sort",fmdt,"image",key,"Image")=siuid
"RTN","SAMIDCM2",138,0)
 . q
"RTN","SAMIDCM2",139,0)
 ;
"RTN","SAMIDCM2",140,0)
 quit  ; end of ADDITEMS
"RTN","SAMIDCM2",141,0)
 ;
"RTN","SAMIDCM2",142,0)
 ;
"RTN","SAMIDCM2",143,0)
 ;
"RTN","SAMIDCM2",144,0)
 ;
"RTN","SAMIDCM2",145,0)
 ;@dms WSSHODOC
"RTN","SAMIDCM2",146,0)
 ;
"RTN","SAMIDCM2",147,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM2",148,0)
 ;
"RTN","SAMIDCM2",149,0)
 ;ven/gpl;dms;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMIDCM2",150,0)
 ;@called-by none
"RTN","SAMIDCM2",151,0)
 ;@calls none
"RTN","SAMIDCM2",152,0)
 ;@input
"RTN","SAMIDCM2",153,0)
 ; FILTER
"RTN","SAMIDCM2",154,0)
 ;@output
"RTN","SAMIDCM2",155,0)
 ; RETURN = output array, closed reference
"RTN","SAMIDCM2",156,0)
 ; @RETURN
"RTN","SAMIDCM2",157,0)
 ;@examples [tbd]
"RTN","SAMIDCM2",158,0)
 ;@tests [tbd]
"RTN","SAMIDCM2",159,0)
 ;
"RTN","SAMIDCM2",160,0)
 ;
"RTN","SAMIDCM2",161,0)
WSSHODOC(RETURN,FILTER) ;
"RTN","SAMIDCM2",162,0)
 ;
"RTN","SAMIDCM2",163,0)
 n gn s gn=$na(^TMP("GPLTEST",$J))
"RTN","SAMIDCM2",164,0)
 s HTTPRSP("mime")="application/pdf"
"RTN","SAMIDCM2",165,0)
 m @gn=^gpl("pdf")
"RTN","SAMIDCM2",166,0)
 s RETURN=""
"RTN","SAMIDCM2",167,0)
 ;n g2 s g2=""
"RTN","SAMIDCM2",168,0)
 ;n zi s zi=""
"RTN","SAMIDCM2",169,0)
 ;f  s zi=$o(^gpl("GPLPDF",zi)) q:zi=""  s g2=g2_^gpl("GPLPDF",zi)
"RTN","SAMIDCM2",170,0)
 ;s RETURN=$$URLDEC^VPRJRUT(g2)
"RTN","SAMIDCM2",171,0)
 s RETURN=gn
"RTN","SAMIDCM2",172,0)
 ;
"RTN","SAMIDCM2",173,0)
 quit  ; end of dms WSSHODOC
"RTN","SAMIDCM2",174,0)
 ;
"RTN","SAMIDCM2",175,0)
 ;
"RTN","SAMIDCM2",176,0)
 ;
"RTN","SAMIDCM2",177,0)
 ;
"RTN","SAMIDCM2",178,0)
 ;@dms LOADPDF
"RTN","SAMIDCM2",179,0)
 ;
"RTN","SAMIDCM2",180,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM2",181,0)
 ;
"RTN","SAMIDCM2",182,0)
 ;ven/gpl;dms;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMIDCM2",183,0)
 ;@called-by none
"RTN","SAMIDCM2",184,0)
 ;@calls
"RTN","SAMIDCM2",185,0)
 ; $$FTG^%ZISH
"RTN","SAMIDCM2",186,0)
 ;@input [tbd]
"RTN","SAMIDCM2",187,0)
 ;@output [tbd]
"RTN","SAMIDCM2",188,0)
 ;@examples [tbd]
"RTN","SAMIDCM2",189,0)
 ;@tests [tbd]
"RTN","SAMIDCM2",190,0)
 ;
"RTN","SAMIDCM2",191,0)
 ;
"RTN","SAMIDCM2",192,0)
LOADPDF() ;
"RTN","SAMIDCM2",193,0)
 ;
"RTN","SAMIDCM2",194,0)
 ;S FN="LCSV2_DATA_2021-06-29_REDCAP.csv"
"RTN","SAMIDCM2",195,0)
 ;S FN="LCSV2_DATA_2021-06-29_REDCAP.tsv"
"RTN","SAMIDCM2",196,0)
 S FD="/tmp/"
"RTN","SAMIDCM2",197,0)
 S FN="OHIF as Viewer.pdf"
"RTN","SAMIDCM2",198,0)
 S GN=$NA(^gpl("GPLPDF",1))
"RTN","SAMIDCM2",199,0)
 K @GN
"RTN","SAMIDCM2",200,0)
 N OK
"RTN","SAMIDCM2",201,0)
 S OK=$$FTG^%ZISH(FD,FN,GN,2)
"RTN","SAMIDCM2",202,0)
 ;
"RTN","SAMIDCM2",203,0)
 quit  ; end of dms LOADPF
"RTN","SAMIDCM2",204,0)
 ;
"RTN","SAMIDCM2",205,0)
 ;
"RTN","SAMIDCM2",206,0)
 ;
"RTN","SAMIDCM2",207,0)
 ;
"RTN","SAMIDCM2",208,0)
 ;@function $$VIEWURL
"RTN","SAMIDCM2",209,0)
 ;
"RTN","SAMIDCM2",210,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIDCM2",211,0)
 ;
"RTN","SAMIDCM2",212,0)
 ;ven/gpl;private;function;silent;clean?;sac?;tests?;port?
"RTN","SAMIDCM2",213,0)
 ;@called-by
"RTN","SAMIDCM2",214,0)
 ; WSCASE^SAMICASE
"RTN","SAMIDCM2",215,0)
 ;@calls none
"RTN","SAMIDCM2",216,0)
 ;@input
"RTN","SAMIDCM2",217,0)
 ; SITE
"RTN","SAMIDCM2",218,0)
 ;@output = url of OHIF image viewer
"RTN","SAMIDCM2",219,0)
 ;@examples [tbd]
"RTN","SAMIDCM2",220,0)
 ;@tests [tbd]
"RTN","SAMIDCM2",221,0)
 ;
"RTN","SAMIDCM2",222,0)
 ;
"RTN","SAMIDCM2",223,0)
VIEWURL(SITE) ; URL to use for image viewer
"RTN","SAMIDCM2",224,0)
 ;
"RTN","SAMIDCM2",225,0)
 ; for this site
"RTN","SAMIDCM2",226,0)
 ;
"RTN","SAMIDCM2",227,0)
 n url s url="https://viewer.ohif.org/viewer"
"RTN","SAMIDCM2",228,0)
 ; 
"RTN","SAMIDCM2",229,0)
 ; todo look up the url from the parameter file
"RTN","SAMIDCM2",230,0)
 ;
"RTN","SAMIDCM2",231,0)
 quit url ; end of $$VIEWURL
"RTN","SAMIDCM2",232,0)
 ;
"RTN","SAMIDCM2",233,0)
 ;
"RTN","SAMIDCM2",234,0)
 ;
"RTN","SAMIDCM2",235,0)
EOR ; end of routine SAMIDCM2
"RTN","SAMIHOM4")
0^6^B1434661517^B1262443514
"RTN","SAMIHOM4",1,0)
SAMIHOM4 ;ven/gpl - homepage web services; 2024-09-09t23:38z
"RTN","SAMIHOM4",2,0)
 ;;18.0;SAMI;**1,4,5,6,9,12,15,16,17,18**;2020-01-17;Build 1
"RTN","SAMIHOM4",3,0)
 ;mdc-e1;SAMIHOM4-20240909-E3fWhBP;SAMI-18-18-b1
"RTN","SAMIHOM4",4,0)
 ;mdc-v7;B1434661517;SAMI*18.0*18 SEQ #18
"RTN","SAMIHOM4",5,0)
 ;
"RTN","SAMIHOM4",6,0)
 ; SAMIHOM4 contains web services & other subroutines for producing
"RTN","SAMIHOM4",7,0)
 ; the ELCAP Home Page.
"RTN","SAMIHOM4",8,0)
 ;
"RTN","SAMIHOM4",9,0)
 quit  ; no entry from top
"RTN","SAMIHOM4",10,0)
 ;
"RTN","SAMIHOM4",11,0)
 ;
"RTN","SAMIHOM4",12,0)
 ;
"RTN","SAMIHOM4",13,0)
 ;
"RTN","SAMIHOM4",14,0)
 ;@section 0 primary development
"RTN","SAMIHOM4",15,0)
 ;
"RTN","SAMIHOM4",16,0)
 ;
"RTN","SAMIHOM4",17,0)
 ;
"RTN","SAMIHOM4",18,0)
 ;
"RTN","SAMIHOM4",19,0)
 ;@license see routine SAMIUL
"RTN","SAMIHOM4",20,0)
 ;@documentation see SAMIHUL
"RTN","SAMIHOM4",21,0)
 ;
"RTN","SAMIHOM4",22,0)
 ;@contents
"RTN","SAMIHOM4",23,0)
 ;
"RTN","SAMIHOM4",24,0)
 ;  1. web service get vapals & related subroutines:
"RTN","SAMIHOM4",25,0)
 ; WSHOME code for wsi WSHOME^SAMIHOM3
"RTN","SAMIHOM4",26,0)
 ;    get vapals (vapals-elcap homepage)
"RTN","SAMIHOM4",27,0)
 ; DEVHOME code for wps DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",28,0)
 ;    development home page
"RTN","SAMIHOM4",29,0)
 ; GETHOME code for wps GETHOME^SAMIHOM3
"RTN","SAMIHOM4",30,0)
 ;    get homepage (not subsequent visit)
"RTN","SAMIHOM4",31,0)
 ;
"RTN","SAMIHOM4",32,0)
 ;  2. web service post vapals & related subroutines:
"RTN","SAMIHOM4",33,0)
 ; WSVAPALS code for ws WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",34,0)
 ;    post vapals (main gateway)
"RTN","SAMIHOM4",35,0)
 ;
"RTN","SAMIHOM4",36,0)
 ;  3. other subroutines:
"RTN","SAMIHOM4",37,0)
 ; REG manual registration
"RTN","SAMIHOM4",38,0)
 ; MKPTLK creates patient-lookup record
"RTN","SAMIHOM4",39,0)
 ; UPDTFRMS update demographics in all forms for patient
"RTN","SAMIHOM4",40,0)
 ; MERGE merge participant records
"RTN","SAMIHOM4",41,0)
 ; ADDUNMAT adds unmatched report web service to system
"RTN","SAMIHOM4",42,0)
 ; DELUNMAT deletes unmatched web service
"RTN","SAMIHOM4",43,0)
 ; WSUNMAT navigates to unmatched report
"RTN","SAMIHOM4",44,0)
 ; $$DUPSSN true if duplicate ssn
"RTN","SAMIHOM4",45,0)
 ; $$DUPICN true if duplicate icn
"RTN","SAMIHOM4",46,0)
 ; $$BADICN true if ICN checkdigits are wrong
"RTN","SAMIHOM4",47,0)
 ; SAVE save patient-lookup record after edit
"RTN","SAMIHOM4",48,0)
 ; $$REMATCH possible match ien
"RTN","SAMIHOM4",49,0)
 ; SETINFO set information message text
"RTN","SAMIHOM4",50,0)
 ; SETWARN set warning message text
"RTN","SAMIHOM4",51,0)
 ; RTNERR redisplay page w/error message
"RTN","SAMIHOM4",52,0)
 ; RTNPAGE display page
"RTN","SAMIHOM4",53,0)
 ; REINDXPL reindex patient lookup
"RTN","SAMIHOM4",54,0)
 ; INDXPTLK generate index entries in patient-lookup graph
"RTN","SAMIHOM4",55,0)
 ; UNINDXPT remove index entries from patient-lookup graph
"RTN","SAMIHOM4",56,0)
 ; $$UCASE uppercase
"RTN","SAMIHOM4",57,0)
 ; WSNEWCAS code for wr newcase (creates new case)
"RTN","SAMIHOM4",58,0)
 ;
"RTN","SAMIHOM4",59,0)
 ;@to-do
"RTN","SAMIHOM4",60,0)
 ; Add label comments
"RTN","SAMIHOM4",61,0)
 ;
"RTN","SAMIHOM4",62,0)
 ;
"RTN","SAMIHOM4",63,0)
 ;
"RTN","SAMIHOM4",64,0)
 ;
"RTN","SAMIHOM4",65,0)
 ;@section 1 web service get vapals & related subroutines
"RTN","SAMIHOM4",66,0)
 ;
"RTN","SAMIHOM4",67,0)
 ;
"RTN","SAMIHOM4",68,0)
 ;
"RTN","SAMIHOM4",69,0)
 ;
"RTN","SAMIHOM4",70,0)
 ;@ws-code WSHOME^SAMIHOM3
"RTN","SAMIHOM4",71,0)
 ;
"RTN","SAMIHOM4",72,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",73,0)
 ;
"RTN","SAMIHOM4",74,0)
 ;ven/gpl;ws;procedure;clean;silent;sac;tests;port?
"RTN","SAMIHOM4",75,0)
 ;@signature
"RTN","SAMIHOM4",76,0)
 ; do WSHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",77,0)
 ;@branches-from
"RTN","SAMIHOM4",78,0)
 ; WSHOME^SAMIHOM3
"RTN","SAMIHOM4",79,0)
 ;@ws-called-by
"RTN","SAMIHOM4",80,0)
 ; web service get vapals
"RTN","SAMIHOM4",81,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",82,0)
 ; LOGIN^SAMISITE
"RTN","SAMIHOM4",83,0)
 ;@called-by none
"RTN","SAMIHOM4",84,0)
 ;@calls
"RTN","SAMIHOM4",85,0)
 ; DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",86,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",87,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",88,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",89,0)
 ;@input
"RTN","SAMIHOM4",90,0)
 ; SAMIFILTER (no parameters required)
"RTN","SAMIHOM4",91,0)
 ;@output
"RTN","SAMIHOM4",92,0)
 ; .SAMIRTN
"RTN","SAMIHOM4",93,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",94,0)
 ;@tests
"RTN","SAMIHOM4",95,0)
 ; UTWSHM^SAMIUTH3
"RTN","SAMIHOM4",96,0)
 ; UTWSHM1^SAMIUTH3
"RTN","SAMIHOM4",97,0)
 ; UTWSHM2^SAMIUTH3
"RTN","SAMIHOM4",98,0)
 ;
"RTN","SAMIHOM4",99,0)
 ;
"RTN","SAMIHOM4",100,0)
WSHOME ; get vapals (vapals-elcap homepage)
"RTN","SAMIHOM4",101,0)
 ;
"RTN","SAMIHOM4",102,0)
 ;@stanza 2 route to appropriate homepage or bypass to other webpage
"RTN","SAMIHOM4",103,0)
 ;
"RTN","SAMIHOM4",104,0)
 ; present development homepage for testing
"RTN","SAMIHOM4",105,0)
 if $get(SAMIFILTER("test"))=1 do  quit
"RTN","SAMIHOM4",106,0)
 . do DEVHOME^SAMIHOM3(.SAMIRTN,.SAMIFILTER)
"RTN","SAMIHOM4",107,0)
 . quit
"RTN","SAMIHOM4",108,0)
 ;
"RTN","SAMIHOM4",109,0)
 ; bypass for get access to pages
"RTN","SAMIHOM4",110,0)
 if $g(SAMIFILTER("samiroute"))'="" do  quit
"RTN","SAMIHOM4",111,0)
 . new SAMIBODY set SAMIBODY(1)=""
"RTN","SAMIHOM4",112,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIBODY,.SAMIRTN)
"RTN","SAMIHOM4",113,0)
 . quit
"RTN","SAMIHOM4",114,0)
 ;
"RTN","SAMIHOM4",115,0)
 ; V4W/DLW - bypass for get access from CPRS
"RTN","SAMIHOM4",116,0)
 if $get(SAMIFILTER("dfn"))'="" do  quit
"RTN","SAMIHOM4",117,0)
 . new dfn set dfn=$get(SAMIFILTER("dfn"))
"RTN","SAMIHOM4",118,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",119,0)
 . new studyid set studyid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIHOM4",120,0)
 . new SAMIBODY
"RTN","SAMIHOM4",121,0)
 . if studyid'="" do
"RTN","SAMIHOM4",122,0)
 . . set SAMIBODY(1)="samiroute=casereview&dfn="_dfn_"&studyid="_studyid
"RTN","SAMIHOM4",123,0)
 . . quit
"RTN","SAMIHOM4",124,0)
 . else  do
"RTN","SAMIHOM4",125,0)
 . . set SAMIBODY(1)="samiroute=lookup&dfn="_dfn_"&studyid="_studyid
"RTN","SAMIHOM4",126,0)
 . . quit
"RTN","SAMIHOM4",127,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIBODY,.SAMIRTN)
"RTN","SAMIHOM4",128,0)
 . quit
"RTN","SAMIHOM4",129,0)
 ;
"RTN","SAMIHOM4",130,0)
 ; default to VAPALS homepage
"RTN","SAMIHOM4",131,0)
 do GETHOME^SAMIHOM3(.SAMIRTN,.SAMIFILTER)
"RTN","SAMIHOM4",132,0)
 ;
"RTN","SAMIHOM4",133,0)
 ;
"RTN","SAMIHOM4",134,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",135,0)
 ;
"RTN","SAMIHOM4",136,0)
 quit  ; end of ws WSHOME^SAMIHOM4
"RTN","SAMIHOM4",137,0)
 ;
"RTN","SAMIHOM4",138,0)
 ;
"RTN","SAMIHOM4",139,0)
 ;
"RTN","SAMIHOM4",140,0)
 ;
"RTN","SAMIHOM4",141,0)
 ;@wps-code DEVHOME^SAMIHOM4
"RTN","SAMIHOM4",142,0)
 ;
"RTN","SAMIHOM4",143,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",144,0)
 ;
"RTN","SAMIHOM4",145,0)
 ;ven/gpl;wps;procedure;clean;silent;sac?;tests;port?
"RTN","SAMIHOM4",146,0)
 ;@signature
"RTN","SAMIHOM4",147,0)
 ; do DEVHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",148,0)
 ;@branches-from
"RTN","SAMIHOM4",149,0)
 ; DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",150,0)
 ;@wps-called-by
"RTN","SAMIHOM4",151,0)
 ; wsi WSHOME^SAMIHOM3 [web service get vapals]
"RTN","SAMIHOM4",152,0)
 ;@called-by none
"RTN","SAMIHOM4",153,0)
 ;@calls
"RTN","SAMIHOM4",154,0)
 ; htmltb2^%yottaweb
"RTN","SAMIHOM4",155,0)
 ; PATLIST^SAMIHOM3
"RTN","SAMIHOM4",156,0)
 ; genhtml^%yottautl
"RTN","SAMIHOM4",157,0)
 ; addary^%yottautl
"RTN","SAMIHOM4",158,0)
 ;@input
"RTN","SAMIHOM4",159,0)
 ; SAMIFILTER =
"RTN","SAMIHOM4",160,0)
 ;@output
"RTN","SAMIHOM4",161,0)
 ;.SAMIRTN =
"RTN","SAMIHOM4",162,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",163,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",164,0)
 ;
"RTN","SAMIHOM4",165,0)
 ;
"RTN","SAMIHOM4",166,0)
DEVHOME ; development home page
"RTN","SAMIHOM4",167,0)
 ;
"RTN","SAMIHOM4",168,0)
 ;@stanza 2 present development homepage
"RTN","SAMIHOM4",169,0)
 ;
"RTN","SAMIHOM4",170,0)
 new gtop,gbot
"RTN","SAMIHOM4",171,0)
 do htmltb2^%yottaweb(.gtop,.gbot,"SAMI Test Patients")
"RTN","SAMIHOM4",172,0)
 ;
"RTN","SAMIHOM4",173,0)
 new html,ary,hpat
"RTN","SAMIHOM4",174,0)
 do PATLIST^SAMIHOM3("hpat")
"RTN","SAMIHOM4",175,0)
 quit:'$data(hpat)
"RTN","SAMIHOM4",176,0)
 ;
"RTN","SAMIHOM4",177,0)
 set ary("title")="SAMI Test Patients on this system"
"RTN","SAMIHOM4",178,0)
 set ary("header",1)="StudyId"
"RTN","SAMIHOM4",179,0)
 set ary("header",2)="Name"
"RTN","SAMIHOM4",180,0)
 ;
"RTN","SAMIHOM4",181,0)
 new cnt set cnt=0
"RTN","SAMIHOM4",182,0)
 new zi set zi=""
"RTN","SAMIHOM4",183,0)
 for  do  quit:zi=""
"RTN","SAMIHOM4",184,0)
 . set zi=$order(hpat(zi))
"RTN","SAMIHOM4",185,0)
 . quit:zi=""
"RTN","SAMIHOM4",186,0)
 . ;
"RTN","SAMIHOM4",187,0)
 . set cnt=cnt+1
"RTN","SAMIHOM4",188,0)
 . new url set url="<a href=""/cform.cgi?studyId="_zi_""">"_zi_"</a>"
"RTN","SAMIHOM4",189,0)
 . set ary(cnt,1)=url
"RTN","SAMIHOM4",190,0)
 . set ary(cnt,2)=""
"RTN","SAMIHOM4",191,0)
 . quit
"RTN","SAMIHOM4",192,0)
 ;
"RTN","SAMIHOM4",193,0)
 do genhtml^%yottautl("html","ary")
"RTN","SAMIHOM4",194,0)
 ;
"RTN","SAMIHOM4",195,0)
 do addary^%yottautl("SAMIRTN","gtop")
"RTN","SAMIHOM4",196,0)
 do addary^%yottautl("SAMIRTN","html")
"RTN","SAMIHOM4",197,0)
 set SAMIRTN($order(SAMIRTN(""),-1)+1)=gbot
"RTN","SAMIHOM4",198,0)
 kill SAMIRTN(0)
"RTN","SAMIHOM4",199,0)
 ;
"RTN","SAMIHOM4",200,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMIHOM4",201,0)
 ;
"RTN","SAMIHOM4",202,0)
 ;
"RTN","SAMIHOM4",203,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",204,0)
 ;
"RTN","SAMIHOM4",205,0)
 quit  ; end of wps DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",206,0)
 ;
"RTN","SAMIHOM4",207,0)
 ;
"RTN","SAMIHOM4",208,0)
 ;
"RTN","SAMIHOM4",209,0)
 ;
"RTN","SAMIHOM4",210,0)
 ;@wps-code GETHOME^SAMIHOM3
"RTN","SAMIHOM4",211,0)
 ;
"RTN","SAMIHOM4",212,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",213,0)
 ;
"RTN","SAMIHOM4",214,0)
 ;ven/gpl;wps;procedure;clean;silent;sac?;tests;port?
"RTN","SAMIHOM4",215,0)
 ;@signature
"RTN","SAMIHOM4",216,0)
 ; do GETHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",217,0)
 ;@branches-from
"RTN","SAMIHOM4",218,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",219,0)
 ;@wps-called-by
"RTN","SAMIHOM4",220,0)
 ; WSHOME
"RTN","SAMIHOM4",221,0)
 ; WSVAPALS
"RTN","SAMIHOM4",222,0)
 ; SAVE
"RTN","SAMIHOM4",223,0)
 ;  WSNEWCAS [commented out]
"RTN","SAMIHOM4",224,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMIHOM4",225,0)
 ; WSLOOKUP^SAMISRC2
"RTN","SAMIHOM4",226,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIHOM4",227,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIHOM4",228,0)
 ;@called-by none
"RTN","SAMIHOM4",229,0)
 ;@calls
"RTN","SAMIHOM4",230,0)
 ; $$FINDSITE^SAMISITE
"RTN","SAMIHOM4",231,0)
 ; $$GET1PARM^SAMIPARM
"RTN","SAMIHOM4",232,0)
 ; GETTMPL^SAMICASE
"RTN","SAMIHOM4",233,0)
 ; MERGEHTM^%wf
"RTN","SAMIHOM4",234,0)
 ; ADDCRLF^VPRJRUT
"RTN","SAMIHOM4",235,0)
 ;@input
"RTN","SAMIHOM4",236,0)
 ; SAMIFILTER
"RTN","SAMIHOM4",237,0)
 ;@output
"RTN","SAMIHOM4",238,0)
 ; .SAMIRTN
"RTN","SAMIHOM4",239,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",240,0)
 ;@tests
"RTN","SAMIHOM4",241,0)
 ; UTGETHM^SAMIUTH3
"RTN","SAMIHOM4",242,0)
 ; UTSCAN4^SAMIUTH3
"RTN","SAMIHOM4",243,0)
 ;
"RTN","SAMIHOM4",244,0)
 ;
"RTN","SAMIHOM4",245,0)
GETHOME ; get homepage (not subsequent visit)
"RTN","SAMIHOM4",246,0)
 ;
"RTN","SAMIHOM4",247,0)
 ;@stanza 2 get template for homepage
"RTN","SAMIHOM4",248,0)
 ;
"RTN","SAMIHOM4",249,0)
 ; Processing for multi-tenancy
"RTN","SAMIHOM4",250,0)
 ;
"RTN","SAMIHOM4",251,0)
 i $g(HTTPREQ("method"))="GET" d  ;
"RTN","SAMIHOM4",252,0)
 . s SAMIFILTER("siteid")=""
"RTN","SAMIHOM4",253,0)
 ;
"RTN","SAMIHOM4",254,0)
 if $get(SAMIFILTER("siteid"))="" if '$$FINDSITE^SAMISITE(.SAMIRTN,.SAMIFILTER) quit 0
"RTN","SAMIHOM4",255,0)
 new SAMISITE,SAMITITL
"RTN","SAMIHOM4",256,0)
 set SAMISITE=$get(SAMIFILTER("siteid"))
"RTN","SAMIHOM4",257,0)
 set SAMITITL=$get(SAMIFILTER("sitetitle"))
"RTN","SAMIHOM4",258,0)
 ;
"RTN","SAMIHOM4",259,0)
 new VASITE set VASITE=$$GET1PARM^SAMIPARM("veteransAffairsSite",SAMISITE)
"RTN","SAMIHOM4",260,0)
 set SAMIFILTER("veteransAffairsSite")=VASITE
"RTN","SAMIHOM4",261,0)
 ;
"RTN","SAMIHOM4",262,0)
 new temp,tout,form
"RTN","SAMIHOM4",263,0)
 set form="vapals:home"
"RTN","SAMIHOM4",264,0)
 do GETTMPL^SAMICASE("temp",form)
"RTN","SAMIHOM4",265,0)
 quit:'$data(temp)
"RTN","SAMIHOM4",266,0)
 ;
"RTN","SAMIHOM4",267,0)
 ;
"RTN","SAMIHOM4",268,0)
 ;@stanza 3 process homepage template
"RTN","SAMIHOM4",269,0)
 ;
"RTN","SAMIHOM4",270,0)
 new err
"RTN","SAMIHOM4",271,0)
 do MERGEHTM^%wf(.temp,.SAMIFILTER,.err)
"RTN","SAMIHOM4",272,0)
 ;
"RTN","SAMIHOM4",273,0)
 do ADDCRLF^VPRJRUT(.temp)
"RTN","SAMIHOM4",274,0)
 merge SAMIRTN=temp
"RTN","SAMIHOM4",275,0)
 ;
"RTN","SAMIHOM4",276,0)
 ;
"RTN","SAMIHOM4",277,0)
 ;@stanza 4 termination
"RTN","SAMIHOM4",278,0)
 ;
"RTN","SAMIHOM4",279,0)
 quit  ; end of wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",280,0)
 ;
"RTN","SAMIHOM4",281,0)
 ;
"RTN","SAMIHOM4",282,0)
 ;
"RTN","SAMIHOM4",283,0)
 ; below is redacted from GETHOME^SAMIHOM3
"RTN","SAMIHOM4",284,0)
 ;
"RTN","SAMIHOM4",285,0)
 ;@old-calls
"RTN","SAMIHOM4",286,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIHOM4",287,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIHOM4",288,0)
 ; $$GET^XPAR
"RTN","SAMIHOM4",289,0)
 ; findReplace^%ts
"RTN","SAMIHOM4",290,0)
 ; ADDCRLF^VPRJRUT
"RTN","SAMIHOM4",291,0)
 ;
"RTN","SAMIHOM4",292,0)
 new cnt set cnt=0
"RTN","SAMIHOM4",293,0)
 new zi set zi=0
"RTN","SAMIHOM4",294,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  do  ;
"RTN","SAMIHOM4",295,0)
 . ;
"RTN","SAMIHOM4",296,0)
 . n ln s ln=temp(zi)
"RTN","SAMIHOM4",297,0)
 . n touched s touched=0
"RTN","SAMIHOM4",298,0)
 . ;
"RTN","SAMIHOM4",299,0)
 . i ln["href" i 'touched d  ;
"RTN","SAMIHOM4",300,0)
 . . d FIXHREF^SAMIFORM(.ln)
"RTN","SAMIHOM4",301,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",302,0)
 . ;
"RTN","SAMIHOM4",303,0)
 . i ln["src" d  ;
"RTN","SAMIHOM4",304,0)
 . . d FIXSRC^SAMIFORM(.ln)
"RTN","SAMIHOM4",305,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",306,0)
 . ;
"RTN","SAMIHOM4",307,0)
 . i ln["id" i ln["studyIdMenu" d  ;
"RTN","SAMIHOM4",308,0)
 . . s zi=zi+4
"RTN","SAMIHOM4",309,0)
 . ;
"RTN","SAMIHOM4",310,0)
 . if ln["@@MANUALREGISTRATION@@" do  ; turn off manual registration
"RTN","SAMIHOM4",311,0)
 . . n setman,setparm
"RTN","SAMIHOM4",312,0)
 . . s setman="true"
"RTN","SAMIHOM4",313,0)
 . . s setparm=$$GET^XPAR("SYS","SAMI ALLOW MANUAL ENTRY",,"Q")
"RTN","SAMIHOM4",314,0)
 . . i setparm=0 s setman="false"
"RTN","SAMIHOM4",315,0)
 . . do findReplace^%ts(.ln,"@@MANUALREGISTRATION@@",setman)
"RTN","SAMIHOM4",316,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",317,0)
 . . quit
"RTN","SAMIHOM4",318,0)
 . set cnt=cnt+1
"RTN","SAMIHOM4",319,0)
 . set tout(cnt)=temp(zi)
"RTN","SAMIHOM4",320,0)
 . quit
"RTN","SAMIHOM4",321,0)
 ;
"RTN","SAMIHOM4",322,0)
 ;
"RTN","SAMIHOM4",323,0)
 ;@old-stanza 4 add cr/lf & save to return array
"RTN","SAMIHOM4",324,0)
 ;
"RTN","SAMIHOM4",325,0)
 do ADDCRLF^VPRJRUT(.tout)
"RTN","SAMIHOM4",326,0)
 merge SAMIRTN=tout
"RTN","SAMIHOM4",327,0)
 ;
"RTN","SAMIHOM4",328,0)
 ;
"RTN","SAMIHOM4",329,0)
 ;@old-stanza 5 termination
"RTN","SAMIHOM4",330,0)
 ;
"RTN","SAMIHOM4",331,0)
 quit  ; old end of wps GETHOME^SAMIHOM3
"RTN","SAMIHOM4",332,0)
 ;
"RTN","SAMIHOM4",333,0)
 ;
"RTN","SAMIHOM4",334,0)
 ;
"RTN","SAMIHOM4",335,0)
 ;
"RTN","SAMIHOM4",336,0)
 ;@section 2 web service post vapals & related subroutines
"RTN","SAMIHOM4",337,0)
 ;
"RTN","SAMIHOM4",338,0)
 ;
"RTN","SAMIHOM4",339,0)
 ;
"RTN","SAMIHOM4",340,0)
 ;
"RTN","SAMIHOM4",341,0)
 ;@ws-code WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",342,0)
 ;
"RTN","SAMIHOM4",343,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",344,0)
 ;
"RTN","SAMIHOM4",345,0)
 ;ven/gpl;ws;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",346,0)
 ;@signature
"RTN","SAMIHOM4",347,0)
 ; do WSVAPALS^SAMIHOM3(SAMIARG,SAMIBODY,SAMIRESULT)
"RTN","SAMIHOM4",348,0)
 ;@branches-from
"RTN","SAMIHOM4",349,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",350,0)
 ;@ws-called-by [tbd]
"RTN","SAMIHOM4",351,0)
 ;@called-by [tbd]
"RTN","SAMIHOM4",352,0)
 ;@calls
"RTN","SAMIHOM4",353,0)
 ; parseBody^%wf
"RTN","SAMIHOM4",354,0)
 ; ^ZTER [commented out]
"RTN","SAMIHOM4",355,0)
 ; $$SITENM2^SAMISITE
"RTN","SAMIHOM4",356,0)
 ; $$FINDSITE^SAMISITE
"RTN","SAMIHOM4",357,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",358,0)
 ; RTNERR^SAMIHOM4
"RTN","SAMIHOM4",359,0)
 ; WSLOOKUP^SAMISRC2
"RTN","SAMIHOM4",360,0)
 ; LOGIN^SAMISITE
"RTN","SAMIHOM4",361,0)
 ; WSHOME^SAMIHOM3
"RTN","SAMIHOM4",362,0)
 ; WSVAPALS^SAMIHOM3 [commented out]
"RTN","SAMIHOM4",363,0)
 ; $$REDIRECT^SAMISITE
"RTN","SAMIHOM4",364,0)
 ; WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",365,0)
 ; WSCASE^SAMICASE
"RTN","SAMIHOM4",366,0)
 ; WSNUFORM^SAMICASE
"RTN","SAMIHOM4",367,0)
 ; WSNFPOST^SAMICASE
"RTN","SAMIHOM4",368,0)
 ; wsGetForm^%wf
"RTN","SAMIHOM4",369,0)
 ; wsPostForm^%wf
"RTN","SAMIHOM4",370,0)
 ; $$NOTE^SAMINOT1
"RTN","SAMIHOM4",371,0)
 ; $$EN^SAMIORU
"RTN","SAMIHOM4",372,0)
 ; $$NTIEN^SAMINOT1
"RTN","SAMIHOM4",373,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",374,0)
 ; $$NOTE^SAMINOT2
"RTN","SAMIHOM4",375,0)
 ; DELFORM^SAMICASE
"RTN","SAMIHOM4",376,0)
 ; WSNOTE^SAMINOT3
"RTN","SAMIHOM4",377,0)
 ; WSREPORT^SAMICTR0
"RTN","SAMIHOM4",378,0)
 ; wsReport^SAMICTRT [commented out]
"RTN","SAMIHOM4",379,0)
 ; WSNOTE^SAMINOT1
"RTN","SAMIHOM4",380,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIHOM4",381,0)
 ; RTNPAGE^SAMIHOM4
"RTN","SAMIHOM4",382,0)
 ; REG^SAMIHOM4
"RTN","SAMIHOM4",383,0)
 ; SAVE^SAMIHOM4
"RTN","SAMIHOM4",384,0)
 ; MERGE^SAMIHOM4
"RTN","SAMIHOM4",385,0)
 ;@input [tbd]
"RTN","SAMIHOM4",386,0)
 ;@output [tbd]
"RTN","SAMIHOM4",387,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",388,0)
 ;@tests
"RTN","SAMIHOM4",389,0)
 ; UTPOSTF^SAMIUTH3 [not working?]
"RTN","SAMIHOM4",390,0)
 ; UTWSVP1^SAMIUTH4
"RTN","SAMIHOM4",391,0)
 ; UTWSVP2^SAMIUTH4
"RTN","SAMIHOM4",392,0)
 ; UTWSVP3^SAMIUTH4
"RTN","SAMIHOM4",393,0)
 ; UTWSVP4^SAMIUTH4
"RTN","SAMIHOM4",394,0)
 ; UTWSVP5^SAMIUTH4
"RTN","SAMIHOM4",395,0)
 ;
"RTN","SAMIHOM4",396,0)
 ; all calls come through this gateway
"RTN","SAMIHOM4",397,0)
 ;
"RTN","SAMIHOM4",398,0)
 ;
"RTN","SAMIHOM4",399,0)
WSVAPALS ; post vapals (main gateway)
"RTN","SAMIHOM4",400,0)
 ;
"RTN","SAMIHOM4",401,0)
 k ^SAMIUL("vapals")
"RTN","SAMIHOM4",402,0)
 m ^SAMIUL("vapals")=SAMIARG
"RTN","SAMIHOM4",403,0)
 m ^SAMIUL("vapals","BODY")=SAMIBODY
"RTN","SAMIHOM4",404,0)
 ;
"RTN","SAMIHOM4",405,0)
 ;d ^ZTER
"RTN","SAMIHOM4",406,0)
 new vars,SAMIBDY
"RTN","SAMIHOM4",407,0)
 set SAMIBDY=$get(SAMIBODY(1))
"RTN","SAMIHOM4",408,0)
 if $e(SAMIBDY,1,5)["-----" d MINIPARS^SAMICAS2(.SAMIARG,"SAMIBODY")
"RTN","SAMIHOM4",409,0)
 else  do parseBody^%wf("vars",.SAMIBDY)
"RTN","SAMIHOM4",410,0)
 m vars=SAMIARG
"RTN","SAMIHOM4",411,0)
 i $g(vars("siteid"))'="" d  ;
"RTN","SAMIHOM4",412,0)
 . i $g(vars("site"))'=$g(vars("siteid")) s vars("site")=$g(vars("siteid"))
"RTN","SAMIHOM4",413,0)
 . q
"RTN","SAMIHOM4",414,0)
 i $g(vars("site"))="SYS" s vars("site")=""
"RTN","SAMIHOM4",415,0)
 i $g(HTTPREQ("method"))="GET" d  ;
"RTN","SAMIHOM4",416,0)
 . s vars("site")=""
"RTN","SAMIHOM4",417,0)
 . q
"RTN","SAMIHOM4",418,0)
 m SAMIARG=vars
"RTN","SAMIHOM4",419,0)
 ;m SAMIARG=SAMIBODY
"RTN","SAMIHOM4",420,0)
 ;D ^ZTER
"RTN","SAMIHOM4",421,0)
 ;
"RTN","SAMIHOM4",422,0)
 ; Processing for multi-tenancy
"RTN","SAMIHOM4",423,0)
 ;
"RTN","SAMIHOM4",424,0)
 if '$d(vars("siteid")) d  ;
"RTN","SAMIHOM4",425,0)
 . if $g(vars("studyid"))="" q
"RTN","SAMIHOM4",426,0)
 . n sym s sym=$e(vars("studyid"),1,3) ; first 3 chars in studyid
"RTN","SAMIHOM4",427,0)
 . i $$SITENM2^SAMISITE(sym)=-1 q
"RTN","SAMIHOM4",428,0)
 . s vars("siteid")=sym
"RTN","SAMIHOM4",429,0)
 . s vars("site")=sym
"RTN","SAMIHOM4",430,0)
 . q
"RTN","SAMIHOM4",431,0)
 ;
"RTN","SAMIHOM4",432,0)
 if $G(vars("site"))'="" d  ;
"RTN","SAMIHOM4",433,0)
 . n siteid s siteid=vars("site")
"RTN","SAMIHOM4",434,0)
 . s SAMIARG("siteid")=siteid
"RTN","SAMIHOM4",435,0)
 . s SAMIARG("sitetitle")=$$SITENM2^SAMISITE(siteid)_" - "_siteid
"RTN","SAMIHOM4",436,0)
 . q
"RTN","SAMIHOM4",437,0)
 k ^gpl("siteselect")
"RTN","SAMIHOM4",438,0)
 m ^gpl("siteselect")=SAMIARG
"RTN","SAMIHOM4",439,0)
 m ^gpl("siteselect","vars")=vars
"RTN","SAMIHOM4",440,0)
 if $G(SAMIARG("siteid"))="" if '$$FINDSITE^SAMISITE(.SAMIRESULT,.SAMIARG) Q 0
"RTN","SAMIHOM4",441,0)
 new SAMISITE,SAMITITL
"RTN","SAMIHOM4",442,0)
 s SAMISITE=$G(SAMIARG("siteid"))
"RTN","SAMIHOM4",443,0)
 i $G(SAMIARG("sitetitle"))="" d  ;
"RTN","SAMIHOM4",444,0)
 . s SAMIARG("sitetitle")=$$SITENM2^SAMISITE(SAMISITE)_" - "_SAMISITE
"RTN","SAMIHOM4",445,0)
 . q
"RTN","SAMIHOM4",446,0)
 s SAMITITL=$G(SAMIARG("sitetitle"))
"RTN","SAMIHOM4",447,0)
 m vars=SAMIARG
"RTN","SAMIHOM4",448,0)
 ;
"RTN","SAMIHOM4",449,0)
 k ^SAMIUL("vapals","vars")
"RTN","SAMIHOM4",450,0)
 merge ^SAMIUL("vapals","vars")=vars
"RTN","SAMIHOM4",451,0)
 merge ^SAMIUL("vapals","vars")=SAMIBODY
"RTN","SAMIHOM4",452,0)
 ;
"RTN","SAMIHOM4",453,0)
 n route s route=$g(vars("samiroute"))
"RTN","SAMIHOM4",454,0)
 ;i route=""  d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",455,0)
 ;
"RTN","SAMIHOM4",456,0)
 ;gpl testing
"RTN","SAMIHOM4",457,0)
 ;if route="fileupload" set route="postform"
"RTN","SAMIHOM4",458,0)
 ;
"RTN","SAMIHOM4",459,0)
 ;if route="fileupload" d  q 0
"RTN","SAMIHOM4",460,0)
 if route="fileupload" d  q 0
"RTN","SAMIHOM4",461,0)
 . d FILEUP^SAMICAS2(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",462,0)
 . q
"RTN","SAMIHOM4",463,0)
 ;
"RTN","SAMIHOM4",464,0)
 ; old fileupload code:
"RTN","SAMIHOM4",465,0)
 ;. ;SET route="postform" q  ;
"RTN","SAMIHOM4",466,0)
 ;. s HTTPRSP("mime")="application/pdf"
"RTN","SAMIHOM4",467,0)
 ;. n gn s gn=$na(^TMP("GPLTEST",$J))
"RTN","SAMIHOM4",468,0)
 ;. m @gn=^gpl("pdf")
"RTN","SAMIHOM4",469,0)
 ;. ;m @gn=^gpl("GPLPDF")
"RTN","SAMIHOM4",470,0)
 ;. ;n part s part="%PDF"_$P(@gn@(1),"%PDF",2)
"RTN","SAMIHOM4",471,0)
 ;. ;s @gn@(1)=part
"RTN","SAMIHOM4",472,0)
 ;. m SAMIRESULT=gn
"RTN","SAMIHOM4",473,0)
 ;. ;m SAMIRESULT=SAMIARG("file")
"RTN","SAMIHOM4",474,0)
 ;. q
"RTN","SAMIHOM4",475,0)
 ;
"RTN","SAMIHOM4",476,0)
 if route="viewfile" d  q 0
"RTN","SAMIHOM4",477,0)
 . d FILEVIEW^SAMICAS2(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",478,0)
 . q
"RTN","SAMIHOM4",479,0)
 ;
"RTN","SAMIHOM4",480,0)
 i route="" d  q 0
"RTN","SAMIHOM4",481,0)
 . n vals
"RTN","SAMIHOM4",482,0)
 . s vals("siteid")=""
"RTN","SAMIHOM4",483,0)
 . s vals("sitetitle")="Unknown Site"
"RTN","SAMIHOM4",484,0)
 . s vals("errorMessage")=""
"RTN","SAMIHOM4",485,0)
 . d RTNERR^SAMIHOM4(.SAMIRETURN,"vapals:login",.vals)
"RTN","SAMIHOM4",486,0)
 . q
"RTN","SAMIHOM4",487,0)
 ;
"RTN","SAMIHOM4",488,0)
 i route="lookup" d  q 0
"RTN","SAMIHOM4",489,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",490,0)
 . d WSLOOKUP^SAMISRC2(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",491,0)
 . q
"RTN","SAMIHOM4",492,0)
 ;
"RTN","SAMIHOM4",493,0)
 i route="login" d  q 0
"RTN","SAMIHOM4",494,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",495,0)
 . d LOGIN^SAMISITE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",496,0)
 . q
"RTN","SAMIHOM4",497,0)
 ;
"RTN","SAMIHOM4",498,0)
 i route="home" d  q 0
"RTN","SAMIHOM4",499,0)
 . ; k ^gpl("home")
"RTN","SAMIHOM4",500,0)
 . ; m ^gpl("home")=SAMIARG
"RTN","SAMIHOM4",501,0)
 . s SAMIARG("samiroute")=""
"RTN","SAMIHOM4",502,0)
 . d WSHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",503,0)
 . q
"RTN","SAMIHOM4",504,0)
 ;
"RTN","SAMIHOM4",505,0)
 i route="logout" d  q 0
"RTN","SAMIHOM4",506,0)
 . ;s SAMIARG("samiroute")="home"
"RTN","SAMIHOM4",507,0)
 . ;do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIARG,.SAMIRESULT)
"RTN","SAMIHOM4",508,0)
 . ;Q
"RTN","SAMIHOM4",509,0)
 . q:$$REDIRECT^SAMISITE(.SAMIRESULT,.SAMIARG)  ; redirect to logout screen
"RTN","SAMIHOM4",510,0)
 . s SAMIARG("sitetitle")="Unknown Site"
"RTN","SAMIHOM4",511,0)
 . s SAMIARG("siteid")=""
"RTN","SAMIHOM4",512,0)
 . s SAMIARG("errorMessage")=""
"RTN","SAMIHOM4",513,0)
 . s SAMIARG("samiroute")="home"
"RTN","SAMIHOM4",514,0)
 . d WSHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",515,0)
 . ;d RTNERR^SAMIHOM4(.SAMIRESULT,"vapals:login",.SAMIARG)
"RTN","SAMIHOM4",516,0)
 . q
"RTN","SAMIHOM4",517,0)
 ;
"RTN","SAMIHOM4",518,0)
 i route="newcase" d  q 0
"RTN","SAMIHOM4",519,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",520,0)
 . d WSNEWCAS^SAMIHOM3(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",521,0)
 . q
"RTN","SAMIHOM4",522,0)
 ;
"RTN","SAMIHOM4",523,0)
 i route="casereview" d  q 0
"RTN","SAMIHOM4",524,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",525,0)
 . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",526,0)
 . q
"RTN","SAMIHOM4",527,0)
 ;
"RTN","SAMIHOM4",528,0)
 i route="nuform" d  q 0
"RTN","SAMIHOM4",529,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",530,0)
 . d WSNUFORM^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",531,0)
 . q
"RTN","SAMIHOM4",532,0)
 ;
"RTN","SAMIHOM4",533,0)
 i route="newfileupload" d  q 0
"RTN","SAMIHOM4",534,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",535,0)
 . d WSNUUPLD^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",536,0)
 . q
"RTN","SAMIHOM4",537,0)
 ;
"RTN","SAMIHOM4",538,0)
 i route="addform" d  q 0
"RTN","SAMIHOM4",539,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",540,0)
 . d WSNFPOST^SAMICASE(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",541,0)
 . q
"RTN","SAMIHOM4",542,0)
 ;
"RTN","SAMIHOM4",543,0)
 i route="form" d  q 0
"RTN","SAMIHOM4",544,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",545,0)
 . d wsGetForm^%wf(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",546,0)
 . q
"RTN","SAMIHOM4",547,0)
 ;
"RTN","SAMIHOM4",548,0)
 i route="postform" d  q 0
"RTN","SAMIHOM4",549,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",550,0)
 . d wsPostForm^%wf(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",551,0)
 . ;
"RTN","SAMIHOM4",552,0)
 . i $g(SAMIARG("form"))["siform" d  ;
"RTN","SAMIHOM4",553,0)
 . . ; in case mrn or pid have changed, update the patient record
"RTN","SAMIHOM4",554,0)
 . . n sid s sid=$g(SAMIARG("studyid"))
"RTN","SAMIHOM4",555,0)
 . . i sid="" s sid=$g(SAMIARG("sid"))
"RTN","SAMIHOM4",556,0)
 . . i sid="" s sid=$g(SAMIARG("samistudyid"))
"RTN","SAMIHOM4",557,0)
 . . n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",558,0)
 . . n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",559,0)
 . . n pien s pien=$o(@proot@("sid",sid,""))
"RTN","SAMIHOM4",560,0)
 . . n dfn s dfn=$g(@proot@(pien,"dfn"))
"RTN","SAMIHOM4",561,0)
 . . n lien s lien=$o(@lroot@("dfn",dfn,"")) ; graphs may not be dinum
"RTN","SAMIHOM4",562,0)
 . . i pien]"",lien]"" d  ;
"RTN","SAMIHOM4",563,0)
 . . . n newmrn,newpid
"RTN","SAMIHOM4",564,0)
 . . . s newmrn=$g(SAMIARG("simrn"))
"RTN","SAMIHOM4",565,0)
 . . . s newpid=$g(SAMIARG("sipid"))
"RTN","SAMIHOM4",566,0)
 . . . ; could do a comparison here, but easiest is just to push it
"RTN","SAMIHOM4",567,0)
 . . . if newmrn]"" d  ;
"RTN","SAMIHOM4",568,0)
 . . . . s @proot@(pien,"simrn")=newmrn
"RTN","SAMIHOM4",569,0)
 . . . . s @proot@("mrn",newmrn,pien)=""
"RTN","SAMIHOM4",570,0)
 . . . . s @lroot@(lien,"simrn")=newmrn
"RTN","SAMIHOM4",571,0)
 . . . . s @lroot@("mrn",newmrn,lien)=""
"RTN","SAMIHOM4",572,0)
 . . . . s @lroot@("emrn","e"_newmrn,lien)=""
"RTN","SAMIHOM4",573,0)
 . . . . q
"RTN","SAMIHOM4",574,0)
 . . . if newpid]"" d  ;
"RTN","SAMIHOM4",575,0)
 . . . . s @proot@(pien,"sipid")=newpid
"RTN","SAMIHOM4",576,0)
 . . . . s @proot@("pid",newpid,pien)=""
"RTN","SAMIHOM4",577,0)
 . . . . s @lroot@(lien,"sipid")=newpid
"RTN","SAMIHOM4",578,0)
 . . . . s @lroot@("pid",newpid,lien)=""
"RTN","SAMIHOM4",579,0)
 . . . . q
"RTN","SAMIHOM4",580,0)
 . . . q
"RTN","SAMIHOM4",581,0)
 . . ;
"RTN","SAMIHOM4",582,0)
 . . ; generate a note and send it to VistA
"RTN","SAMIHOM4",583,0)
 . . n notr s notr=0 ; note return 0 if failure, 1 or greater if success
"RTN","SAMIHOM4",584,0)
 . . ; returns the ien of the note that was created and should be sent
"RTN","SAMIHOM4",585,0)
 . . s notr=$$NOTE^SAMINOT1(.SAMIARG)
"RTN","SAMIHOM4",586,0)
 . . if +notr>0 d  ;
"RTN","SAMIHOM4",587,0)
 . . . n SAMIFILTER
"RTN","SAMIHOM4",588,0)
 . . . s SAMIFILTER("sid")=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",589,0)
 . . . s SAMIFILTER("key")=$g(SAMIARG("form")) ;
"RTN","SAMIHOM4",590,0)
 . . . n tiuien
"RTN","SAMIHOM4",591,0)
 . . . s tiuien=+notr
"RTN","SAMIHOM4",592,0)
 . . . s SAMIFILTER("notenmbr")=tiuien
"RTN","SAMIHOM4",593,0)
 . . . n sendrslt
"RTN","SAMIHOM4",594,0)
 . . . ;s sendrslt="1^MSG9239010"
"RTN","SAMIHOM4",595,0)
 . . . s SAMIFILTER("sendprotocol")=SAMISITE_" ENROLL ORU EVN"
"RTN","SAMIHOM4",596,0)
 . . . s sendrslt=$$EN^SAMIORU(.SAMIFILTER) ; send the note to VistA
"RTN","SAMIHOM4",597,0)
 . . . i +sendrslt>0 d  ; success
"RTN","SAMIHOM4",598,0)
 . . . . n rtnid s rtnid=$p(sendrslt,"^",2) ; return id from HL7
"RTN","SAMIHOM4",599,0)
 . . . . ; post the id to the graph here
"RTN","SAMIHOM4",600,0)
 . . . . n sid s sid=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",601,0)
 . . . . n form s form=$G(SAMIARG("form"))
"RTN","SAMIHOM4",602,0)
 . . . . n nien s nien=$$NTIEN^SAMINOT1(sid,form) ; latest note ien
"RTN","SAMIHOM4",603,0)
 . . . . n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",604,0)
 . . . . s @root@("graph",sid,form,"notes",nien,"hl7id")=rtnid
"RTN","SAMIHOM4",605,0)
 . . . . s SAMIARG("errorMessage")="Note successfully sent to VistA ID: "_rtnid
"RTN","SAMIHOM4",606,0)
 . . . . q
"RTN","SAMIHOM4",607,0)
 . . . else  d  ;
"RTN","SAMIHOM4",608,0)
 . . . . n rtnmsg s rtnmsg=$p(sendrslt,"^",2)
"RTN","SAMIHOM4",609,0)
 . . . . s SAMIARG("errorMessage")=rtnmsg
"RTN","SAMIHOM4",610,0)
 . . . . q
"RTN","SAMIHOM4",611,0)
 . . . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",612,0)
 . . . q
"RTN","SAMIHOM4",613,0)
 . . q
"RTN","SAMIHOM4",614,0)
 . ;
"RTN","SAMIHOM4",615,0)
 . i $g(SAMIARG("form"))["fuform" d  ;
"RTN","SAMIHOM4",616,0)
 . . n notr s notr=0 ; note return 0 if failure, 1 or greater if success
"RTN","SAMIHOM4",617,0)
 . . ; returns the ien of the note that was created and should be sent
"RTN","SAMIHOM4",618,0)
 . . s notr=$$NOTE^SAMINOT2(.SAMIARG)
"RTN","SAMIHOM4",619,0)
 . . if +notr>0 d  ;
"RTN","SAMIHOM4",620,0)
 . . . n SAMIFILTER
"RTN","SAMIHOM4",621,0)
 . . . s SAMIFILTER("sid")=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",622,0)
 . . . s SAMIFILTER("key")=$g(SAMIARG("form")) ;
"RTN","SAMIHOM4",623,0)
 . . . n tiuien
"RTN","SAMIHOM4",624,0)
 . . . s tiuien=+notr
"RTN","SAMIHOM4",625,0)
 . . . s SAMIFILTER("notenmbr")=tiuien
"RTN","SAMIHOM4",626,0)
 . . . n sendrslt
"RTN","SAMIHOM4",627,0)
 . . . ;s sendrslt="0^Missing ORM Message"
"RTN","SAMIHOM4",628,0)
 . . . s SAMIFILTER("sendprotocol")=SAMISITE_" ENROLL ORU EVN"
"RTN","SAMIHOM4",629,0)
 . . . s sendrslt=$$EN^SAMIORU(.SAMIFILTER) ; send the note to VistA
"RTN","SAMIHOM4",630,0)
 . . . i +sendrslt>0 d  ; success
"RTN","SAMIHOM4",631,0)
 . . . . n rtnid s rtnid=$p(sendrslt,"^",2) ; return id from HL7
"RTN","SAMIHOM4",632,0)
 . . . . ; post the id to the graph here
"RTN","SAMIHOM4",633,0)
 . . . . n sid s sid=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",634,0)
 . . . . n form s form=$G(SAMIARG("form"))
"RTN","SAMIHOM4",635,0)
 . . . . n nien s nien=$$NTIEN^SAMINOT1(sid,form) ; latest note ien
"RTN","SAMIHOM4",636,0)
 . . . . n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",637,0)
 . . . . s @root@("graph",sid,form,"notes",nien,"hl7id")=rtnid
"RTN","SAMIHOM4",638,0)
 . . . . s SAMIARG("errorMessage")="Note successfully sent to VistA ID: "_rtnid
"RTN","SAMIHOM4",639,0)
 . . . . q
"RTN","SAMIHOM4",640,0)
 . . . else  d  ;
"RTN","SAMIHOM4",641,0)
 . . . . n rtnmsg s rtnmsg=$p(sendrslt,"^",2)
"RTN","SAMIHOM4",642,0)
 . . . . i $g(SAMIARG("errorMessage"))="" d  ;
"RTN","SAMIHOM4",643,0)
 . . . . . s SAMIARG("errorMessage")=rtnmsg
"RTN","SAMIHOM4",644,0)
 . . . . . q
"RTN","SAMIHOM4",645,0)
 . . . . q
"RTN","SAMIHOM4",646,0)
 . . . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",647,0)
 . . . q
"RTN","SAMIHOM4",648,0)
 . . e  d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",649,0)
 . . q
"RTN","SAMIHOM4",650,0)
 . e  d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",651,0)
 . q
"RTN","SAMIHOM4",652,0)
 ;
"RTN","SAMIHOM4",653,0)
 i route="deleteform" d  q 0
"RTN","SAMIHOM4",654,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",655,0)
 . d DELFORM^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",656,0)
 . q
"RTN","SAMIHOM4",657,0)
 ;
"RTN","SAMIHOM4",658,0)
 i route="ctreport" d  q 0
"RTN","SAMIHOM4",659,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",660,0)
 . n format s format="html"
"RTN","SAMIHOM4",661,0)
 . s format="text"
"RTN","SAMIHOM4",662,0)
 . i format="text" d WSNOTE^SAMINOT3(.SAMIRESULT,.SAMIARG) q  ;
"RTN","SAMIHOM4",663,0)
 . i format="html" d WSREPORT^SAMICTR0(.SAMIRESULT,.SAMIARG) q  ;
"RTN","SAMIHOM4",664,0)
 . ;d wsReport^SAMICTRT(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",665,0)
 . q
"RTN","SAMIHOM4",666,0)
 ;
"RTN","SAMIHOM4",667,0)
 i route="note" d  q 0
"RTN","SAMIHOM4",668,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",669,0)
 . d WSNOTE^SAMINOT1(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",670,0)
 . q
"RTN","SAMIHOM4",671,0)
 ;
"RTN","SAMIHOM4",672,0)
 i route="report" d  q 0
"RTN","SAMIHOM4",673,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",674,0)
 . d WSREPORT^SAMIUR(.SAMIRESULT,.vars)
"RTN","SAMIHOM4",675,0)
 . q
"RTN","SAMIHOM4",676,0)
 ;
"RTN","SAMIHOM4",677,0)
 i route="about" d  q 0
"RTN","SAMIHOM4",678,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",679,0)
 . n form
"RTN","SAMIHOM4",680,0)
 . s form="vapals:about"
"RTN","SAMIHOM4",681,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",682,0)
 . q
"RTN","SAMIHOM4",683,0)
 ;
"RTN","SAMIHOM4",684,0)
 i route="addperson" d  q 0
"RTN","SAMIHOM4",685,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",686,0)
 . n form
"RTN","SAMIHOM4",687,0)
 . s form="vapals:addperson"
"RTN","SAMIHOM4",688,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",689,0)
 . q
"RTN","SAMIHOM4",690,0)
 ;
"RTN","SAMIHOM4",691,0)
 i route="editperson" d  q 0
"RTN","SAMIHOM4",692,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",693,0)
 . n dfn s dfn=$g(vars("dfn")) ; must have a dfn
"RTN","SAMIHOM4",694,0)
 . i dfn="" d  q  ;
"RTN","SAMIHOM4",695,0)
 . . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",696,0)
 . . q
"RTN","SAMIHOM4",697,0)
 . n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",698,0)
 . n sien s sien=$o(@root@("dfn",dfn,""))
"RTN","SAMIHOM4",699,0)
 . i sien="" d  q  ;
"RTN","SAMIHOM4",700,0)
 . . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",701,0)
 . . q
"RTN","SAMIHOM4",702,0)
 . s vars("name")=$g(@root@(sien,"saminame"))
"RTN","SAMIHOM4",703,0)
 . s tdob=$g(@root@(sien,"dob"))
"RTN","SAMIHOM4",704,0)
 . s vars("dob")=$p(tdob,"-",2)_"/"_$p(tdob,"-",3)_"/"_$p(tdob,"-",1)
"RTN","SAMIHOM4",705,0)
 . s vars("sbdob")=$g(@root@(sien,"dob"))
"RTN","SAMIHOM4",706,0)
 . s vars("gender")=$g(@root@(sien,"sex"))
"RTN","SAMIHOM4",707,0)
 . ; s vars("icn")=$g(@root@(sien,"icn"))
"RTN","SAMIHOM4",708,0)
 . n tssn s tssn=$g(@root@(sien,"ssn"))
"RTN","SAMIHOM4",709,0)
 . s vars("ssn")=$e(tssn,1,3)_"-"_$e(tssn,4,5)_"-"_$e(tssn,6,9)
"RTN","SAMIHOM4",710,0)
 . s vars("last5")=$g(@root@(sien,"last5"))
"RTN","SAMIHOM4",711,0)
 . s vars("dfn")=$g(@root@(sien,"dfn"))
"RTN","SAMIHOM4",712,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",713,0)
 . n form,err,zhtml
"RTN","SAMIHOM4",714,0)
 . s form="vapals:editparticipant"
"RTN","SAMIHOM4",715,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",716,0)
 . q
"RTN","SAMIHOM4",717,0)
 ;
"RTN","SAMIHOM4",718,0)
 i route="register" d  q 0
"RTN","SAMIHOM4",719,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",720,0)
 . d REG^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",721,0)
 . q
"RTN","SAMIHOM4",722,0)
 ;
"RTN","SAMIHOM4",723,0)
 i route="editsave" d  q 0
"RTN","SAMIHOM4",724,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",725,0)
 . d SAVE^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",726,0)
 . q
"RTN","SAMIHOM4",727,0)
 ;
"RTN","SAMIHOM4",728,0)
 i route="merge" d  q 0
"RTN","SAMIHOM4",729,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",730,0)
 . d MERGE^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",731,0)
 . q
"RTN","SAMIHOM4",732,0)
 ;
"RTN","SAMIHOM4",733,0)
 quit 0  ; end of ws WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",734,0)
 ;
"RTN","SAMIHOM4",735,0)
 ;
"RTN","SAMIHOM4",736,0)
 ;
"RTN","SAMIHOM4",737,0)
 ;
"RTN","SAMIHOM4",738,0)
 ;@section 3 other subroutines
"RTN","SAMIHOM4",739,0)
 ;
"RTN","SAMIHOM4",740,0)
 ;
"RTN","SAMIHOM4",741,0)
 ;
"RTN","SAMIHOM4",742,0)
 ;
"RTN","SAMIHOM4",743,0)
 ;@pps REG^SAMIHOM4
"RTN","SAMIHOM4",744,0)
 ;
"RTN","SAMIHOM4",745,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",746,0)
 ;
"RTN","SAMIHOM4",747,0)
 ;ven/gpl;pps;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",748,0)
 ;@called-by
"RTN","SAMIHOM4",749,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",750,0)
 ; REGISTER^SAMILD2
"RTN","SAMIHOM4",751,0)
 ; REGISTER^SAMILOAD
"RTN","SAMIHOM4",752,0)
 ; REGISTER^SAMIZPH1
"RTN","SAMIHOM4",753,0)
 ;@calls
"RTN","SAMIHOM4",754,0)
 ; $$DUPSSN [commented out]
"RTN","SAMIHOM4",755,0)
 ; $$BADICN [commented out]
"RTN","SAMIHOM4",756,0)
 ; RTNERR
"RTN","SAMIHOM4",757,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",758,0)
 ; $$REMATCH
"RTN","SAMIHOM4",759,0)
 ; MKPTLK
"RTN","SAMIHOM4",760,0)
 ; INDXPTLK
"RTN","SAMIHOM4",761,0)
 ; SETINFO
"RTN","SAMIHOM4",762,0)
 ; SETWARN [commented out]
"RTN","SAMIHOM4",763,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",764,0)
 ;@input
"RTN","SAMIHOM4",765,0)
 ; SAMIARG =
"RTN","SAMIHOM4",766,0)
 ;@output
"RTN","SAMIHOM4",767,0)
 ;.SAMIRTN =
"RTN","SAMIHOM4",768,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",769,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",770,0)
 ;
"RTN","SAMIHOM4",771,0)
 ;
"RTN","SAMIHOM4",772,0)
REG(SAMIRTN,SAMIARG) ; manual registration
"RTN","SAMIHOM4",773,0)
 ;
"RTN","SAMIHOM4",774,0)
 n name s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",775,0)
 ;
"RTN","SAMIHOM4",776,0)
 ; m ^gpl("reg")=SAMIARG
"RTN","SAMIHOM4",777,0)
 n ssn s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",778,0)
 i ssn'="" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",779,0)
 s SAMIARG("errorMessage")=""
"RTN","SAMIHOM4",780,0)
 s SAMIARG("errorField")=""
"RTN","SAMIHOM4",781,0)
 ; test for duplicate ssn
"RTN","SAMIHOM4",782,0)
 ;
"RTN","SAMIHOM4",783,0)
 ;i $$DUPSSN(ssn) d  ;
"RTN","SAMIHOM4",784,0)
 ;. ;s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate SSN."
"RTN","SAMIHOM4",785,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate SSN error. A person with that SSN is already entered in the system."
"RTN","SAMIHOM4",786,0)
 ;. s SAMIARG("errorField")="ssn"
"RTN","SAMIHOM4",787,0)
 ;
"RTN","SAMIHOM4",788,0)
 ; test for duplicate icn
"RTN","SAMIHOM4",789,0)
 ;
"RTN","SAMIHOM4",790,0)
 ;n icn s icn=$g(SAMIARG("icn"))
"RTN","SAMIHOM4",791,0)
 ;i icn'="" i $$DUPICN(icn) d  ;
"RTN","SAMIHOM4",792,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate ICN error. A person with that ICN is already entered in the system."
"RTN","SAMIHOM4",793,0)
 ;. s SAMIARG("errorField")="icn"
"RTN","SAMIHOM4",794,0)
 ;;
"RTN","SAMIHOM4",795,0)
 ;; test for wellformed ICN
"RTN","SAMIHOM4",796,0)
 ;;
"RTN","SAMIHOM4",797,0)
 ;i icn'="" i $$BADICN(icn) d  ;
"RTN","SAMIHOM4",798,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Invalid ICN error. The check digits in the ICN do not match"
"RTN","SAMIHOM4",799,0)
 ;. s SAMIARG("errorField")="icn"
"RTN","SAMIHOM4",800,0)
 ;;
"RTN","SAMIHOM4",801,0)
 ; if there is an error, send back to edit with error message
"RTN","SAMIHOM4",802,0)
 i $g(SAMIARG("errorMessage"))'="" d  q  ;
"RTN","SAMIHOM4",803,0)
 . n form
"RTN","SAMIHOM4",804,0)
 . s form="vapals:addperson"
"RTN","SAMIHOM4",805,0)
 . d RTNERR(.SAMIRESULT,form,.SAMIARG)
"RTN","SAMIHOM4",806,0)
 . q
"RTN","SAMIHOM4",807,0)
 ;
"RTN","SAMIHOM4",808,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",809,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",810,0)
 n ptlkien s ptlkien=""
"RTN","SAMIHOM4",811,0)
 n dfn s dfn=""
"RTN","SAMIHOM4",812,0)
 n sien s sien=""
"RTN","SAMIHOM4",813,0)
 i ptlkien="" s ptlkien=$o(@root@("AAAAAA"),-1)+1
"RTN","SAMIHOM4",814,0)
 n zm
"RTN","SAMIHOM4",815,0)
 k SAMIARG("MATCHLOG")
"RTN","SAMIHOM4",816,0)
 s zm=$$REMATCH(sien,.SAMIARG)
"RTN","SAMIHOM4",817,0)
 i zm>0 d  ;
"RTN","SAMIHOM4",818,0)
 . s SAMIARG("MATCHLOG")=zm
"RTN","SAMIHOM4",819,0)
 . q
"RTN","SAMIHOM4",820,0)
 d MKPTLK(ptlkien,.SAMIARG) ; make the patient-lookup record
"RTN","SAMIHOM4",821,0)
 ;
"RTN","SAMIHOM4",822,0)
 s dfn=$o(@root@("dfn"," "),-1)+1
"RTN","SAMIHOM4",823,0)
 n pdfn
"RTN","SAMIHOM4",824,0)
 s pdfn=$o(@proot@("dfn"," "),-1)+1
"RTN","SAMIHOM4",825,0)
 i pdfn>dfn s dfn=pdfn ; need a dfn that has not been used
"RTN","SAMIHOM4",826,0)
 i dfn<9000001 s dfn=9000001
"RTN","SAMIHOM4",827,0)
 s @root@(ptlkien,"dfn")=dfn
"RTN","SAMIHOM4",828,0)
 s SAMIARG("dfn")=dfn ; pass the new dfn back to the caller
"RTN","SAMIHOM4",829,0)
 ; note: this is the only way to link to the new record via dfn
"RTN","SAMIHOM4",830,0)
 ; since nothing else is unique
"RTN","SAMIHOM4",831,0)
 d INDXPTLK(ptlkien)
"RTN","SAMIHOM4",832,0)
 s SAMIFILTER("samiroute")="addperson"
"RTN","SAMIHOM4",833,0)
 s SAMIFILTER("siteid")=$G(SAMIARG("siteid"))
"RTN","SAMIHOM4",834,0)
 s SAMIFILTER("sitetitle")=$G(SAMIARG("sitetitle"))
"RTN","SAMIHOM4",835,0)
 D  ; slight of hand for handing back SAMIARGS while also returning a form
"RTN","SAMIHOM4",836,0)
 . n SAMIARG ; return to a blank manual registration form
"RTN","SAMIHOM4",837,0)
 . s SAMIARG("siteid")=$G(SAMIFILTER("siteid"))
"RTN","SAMIHOM4",838,0)
 . s SAMIARG("sitetitle")=$G(SAMIFILTER("sitetitle"))
"RTN","SAMIHOM4",839,0)
 . d SETINFO(.SAMIFILTER,name_" was successfully entered")
"RTN","SAMIHOM4",840,0)
 . ;d SETWARN(.SAMIFILTER,"We might want to give you a warning")
"RTN","SAMIHOM4",841,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIARG,.SAMIRESULT)
"RTN","SAMIHOM4",842,0)
 . q
"RTN","SAMIHOM4",843,0)
 ;
"RTN","SAMIHOM4",844,0)
 quit  ; end of pps REG^SAMIHOM4
"RTN","SAMIHOM4",845,0)
 ;
"RTN","SAMIHOM4",846,0)
 ;
"RTN","SAMIHOM4",847,0)
 ;
"RTN","SAMIHOM4",848,0)
 ;
"RTN","SAMIHOM4",849,0)
 ;@proc MKPTLK
"RTN","SAMIHOM4",850,0)
 ;
"RTN","SAMIHOM4",851,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",852,0)
 ;
"RTN","SAMIHOM4",853,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",854,0)
 ;@called-by
"RTN","SAMIHOM4",855,0)
 ; REG
"RTN","SAMIHOM4",856,0)
 ;@calls
"RTN","SAMIHOM4",857,0)
 ; $$TRIM^XLFSTR
"RTN","SAMIHOM4",858,0)
 ; $$FMDT^SAMIUR2
"RTN","SAMIHOM4",859,0)
 ; $$FMTE^XLFDT
"RTN","SAMIHOM4",860,0)
 ; $$UCASE
"RTN","SAMIHOM4",861,0)
 ;@input
"RTN","SAMIHOM4",862,0)
 ; ptlkien =
"RTN","SAMIHOM4",863,0)
 ; SAMIARG =
"RTN","SAMIHOM4",864,0)
 ;@output [tbd]
"RTN","SAMIHOM4",865,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",866,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",867,0)
 ;
"RTN","SAMIHOM4",868,0)
 ;
"RTN","SAMIHOM4",869,0)
MKPTLK(ptlkien,SAMIARG) ; creates patient-lookup record
"RTN","SAMIHOM4",870,0)
 ;
"RTN","SAMIHOM4",871,0)
 n ssn s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",872,0)
 i ssn'="" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",873,0)
 n name s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",874,0)
 n sinamef,sinamel
"RTN","SAMIHOM4",875,0)
 s sinamel=$p(name,","),sinamel=$$TRIM^XLFSTR(sinamel,"LR")
"RTN","SAMIHOM4",876,0)
 s sinamef=$p(name,",",2),sinamef=$$TRIM^XLFSTR(sinamef,"LR")
"RTN","SAMIHOM4",877,0)
 s name=sinamel_","_sinamef
"RTN","SAMIHOM4",878,0)
 n siteid s siteid=$g(SAMIARG("siteid"))
"RTN","SAMIHOM4",879,0)
 i siteid="" s siteid=$g(SAMIARG("site"))
"RTN","SAMIHOM4",880,0)
 ;
"RTN","SAMIHOM4",881,0)
 s @root@(ptlkien,"siteid")=siteid
"RTN","SAMIHOM4",882,0)
 s @root@(ptlkien,"saminame")=name
"RTN","SAMIHOM4",883,0)
 s @root@(ptlkien,"sinamef")=sinamef
"RTN","SAMIHOM4",884,0)
 s @root@(ptlkien,"sinamel")=sinamel
"RTN","SAMIHOM4",885,0)
 n dob s dob=$g(SAMIARG("dob"))
"RTN","SAMIHOM4",886,0)
 i dob="" s dob=$g(SAMIARG("sidob"))
"RTN","SAMIHOM4",887,0)
 n fmdob s fmdob=$$FMDT^SAMIUR2(dob)
"RTN","SAMIHOM4",888,0)
 n ptlkdob s ptlkdob=$$FMTE^XLFDT(fmdob,7)
"RTN","SAMIHOM4",889,0)
 s ptlkdob=$TR(ptlkdob,"/","-")
"RTN","SAMIHOM4",890,0)
 s @root@(ptlkien,"dob")=ptlkdob
"RTN","SAMIHOM4",891,0)
 s @root@(ptlkien,"sbdob")=ptlkdob
"RTN","SAMIHOM4",892,0)
 n gender s gender=$g(SAMIARG("gender"))
"RTN","SAMIHOM4",893,0)
 i gender="" s gender=$g(SAMIARG("sex"))
"RTN","SAMIHOM4",894,0)
 s @root@(ptlkien,"gender")=$s(gender="M":"M^MALE",1:"F^FEMALE")
"RTN","SAMIHOM4",895,0)
 s @root@(ptlkien,"sex")=$g(SAMIARG("gender"))
"RTN","SAMIHOM4",896,0)
 ; s @root@(ptlkien,"icn")=SAMIARG("icn")
"RTN","SAMIHOM4",897,0)
 s @root@(ptlkien,"ssn")=ssn
"RTN","SAMIHOM4",898,0)
 s @root@(ptlkien,"simrn")=$g(SAMIARG("simrn"))
"RTN","SAMIHOM4",899,0)
 n last5 s last5=""
"RTN","SAMIHOM4",900,0)
 i ssn'="" s last5=$$UCASE($e(name,1))_$e(ssn,6,9)
"RTN","SAMIHOM4",901,0)
 s @root@(ptlkien,"last5")=last5
"RTN","SAMIHOM4",902,0)
 n mymatch s mymatch=$g(SAMIARG("MATCHLOG"))
"RTN","SAMIHOM4",903,0)
 i mymatch'="" s @root@(ptlkien,"MATCHLOG")=mymatch
"RTN","SAMIHOM4",904,0)
 ;
"RTN","SAMIHOM4",905,0)
 quit  ; end of MKPTLK
"RTN","SAMIHOM4",906,0)
 ;
"RTN","SAMIHOM4",907,0)
 ;
"RTN","SAMIHOM4",908,0)
 ;
"RTN","SAMIHOM4",909,0)
 ;
"RTN","SAMIHOM4",910,0)
 ;@proc UPDTFRMS
"RTN","SAMIHOM4",911,0)
 ;
"RTN","SAMIHOM4",912,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",913,0)
 ;
"RTN","SAMIHOM4",914,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",915,0)
 ;@called-by
"RTN","SAMIHOM4",916,0)
 ; MERGE
"RTN","SAMIHOM4",917,0)
 ; SAVE
"RTN","SAMIHOM4",918,0)
 ;@calls
"RTN","SAMIHOM4",919,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",920,0)
 ;@input
"RTN","SAMIHOM4",921,0)
 ; dfn =
"RTN","SAMIHOM4",922,0)
 ;@output [tbd]
"RTN","SAMIHOM4",923,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",924,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",925,0)
 ;
"RTN","SAMIHOM4",926,0)
 ;
"RTN","SAMIHOM4",927,0)
UPDTFRMS(dfn) ; update demographics in all forms for patient
"RTN","SAMIHOM4",928,0)
 ;
"RTN","SAMIHOM4",929,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",930,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",931,0)
 n lien s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIHOM4",932,0)
 q:lien=""
"RTN","SAMIHOM4",933,0)
 n pien s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIHOM4",934,0)
 q:pien=""
"RTN","SAMIHOM4",935,0)
 ; this patient has forms
"RTN","SAMIHOM4",936,0)
 m @proot@(pien)=@lroot@(lien) ; refresh the demos in the patient record
"RTN","SAMIHOM4",937,0)
 n ssn s ssn=$g(@proot@(pien,"ssn"))
"RTN","SAMIHOM4",938,0)
 s @proot@(pien,"sissn")=$e(ssn,1,3)_"-"_$e(ssn,4,5)_"-"_$e(ssn,6,9)
"RTN","SAMIHOM4",939,0)
 n sid s sid=$g(@proot@("sisid")) ; studyid
"RTN","SAMIHOM4",940,0)
 q:sid=""  ; no studyid
"RTN","SAMIHOM4",941,0)
 n zi s zi=""
"RTN","SAMIHOM4",942,0)
 f  s zi=$o(@proot@("graph",sid,zi)) q:zi=""  d  ; for each form
"RTN","SAMIHOM4",943,0)
 . m @proot@("graph",sid,zi)=@proot@(pien) ; stamp each form with new demos
"RTN","SAMIHOM4",944,0)
 . q
"RTN","SAMIHOM4",945,0)
 ;
"RTN","SAMIHOM4",946,0)
 quit  ; end of UPDTFRMS
"RTN","SAMIHOM4",947,0)
 ;
"RTN","SAMIHOM4",948,0)
 ;
"RTN","SAMIHOM4",949,0)
 ;
"RTN","SAMIHOM4",950,0)
 ;
"RTN","SAMIHOM4",951,0)
 ;@proc MERGE
"RTN","SAMIHOM4",952,0)
 ;
"RTN","SAMIHOM4",953,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",954,0)
 ;
"RTN","SAMIHOM4",955,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",956,0)
 ;@called-by
"RTN","SAMIHOM4",957,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",958,0)
 ;@calls
"RTN","SAMIHOM4",959,0)
 ; WSUNMAT
"RTN","SAMIHOM4",960,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",961,0)
 ; UNINDXPT
"RTN","SAMIHOM4",962,0)
 ; $$NOW^XLFDT
"RTN","SAMIHOM4",963,0)
 ; $$FMTE^XLFDT
"RTN","SAMIHOM4",964,0)
 ; INDXPTLK
"RTN","SAMIHOM4",965,0)
 ; UPDTFRMS
"RTN","SAMIHOM4",966,0)
 ;@input
"RTN","SAMIHOM4",967,0)
 ; SAMIRESULT =
"RTN","SAMIHOM4",968,0)
 ; SAMIARGS =
"RTN","SAMIHOM4",969,0)
 ;@output [tbd]
"RTN","SAMIHOM4",970,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",971,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",972,0)
 ;
"RTN","SAMIHOM4",973,0)
 ;
"RTN","SAMIHOM4",974,0)
MERGE(SAMIRESULT,SAMIARGS) ; merge participant records
"RTN","SAMIHOM4",975,0)
 ;
"RTN","SAMIHOM4",976,0)
 ; called from pressing the merge button on the unmatched report
"RTN","SAMIHOM4",977,0)
 ;
"RTN","SAMIHOM4",978,0)
 n toien s toien=$g(SAMIARGS("toien"))
"RTN","SAMIHOM4",979,0)
 i toien="" d  q  ;
"RTN","SAMIHOM4",980,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",981,0)
 . q
"RTN","SAMIHOM4",982,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",983,0)
 n fromien s fromien=$g(@lroot@(toien,"MATCHLOG"))
"RTN","SAMIHOM4",984,0)
 i fromien="" d  q  ;
"RTN","SAMIHOM4",985,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",986,0)
 . q
"RTN","SAMIHOM4",987,0)
 ;
"RTN","SAMIHOM4",988,0)
 ; test for remotedfn in from record - not valid if absent
"RTN","SAMIHOM4",989,0)
 ;
"RTN","SAMIHOM4",990,0)
 i $g(@lroot@(fromien,"remotedfn"))="" d  q  ;
"RTN","SAMIHOM4",991,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",992,0)
 . q
"RTN","SAMIHOM4",993,0)
 ;
"RTN","SAMIHOM4",994,0)
 ; remove index entries for from and to records
"RTN","SAMIHOM4",995,0)
 ;
"RTN","SAMIHOM4",996,0)
 d UNINDXPT(fromien) ; delete index entries
"RTN","SAMIHOM4",997,0)
 d UNINDXPT(toien)
"RTN","SAMIHOM4",998,0)
 ;
"RTN","SAMIHOM4",999,0)
 ; create changelog entry in to record - contains from record
"RTN","SAMIHOM4",1000,0)
 ;
"RTN","SAMIHOM4",1001,0)
 m @lroot@(toien,"changelog",$$FMTE^XLFDT($$NOW^XLFDT,5))=@lroot@(fromien)
"RTN","SAMIHOM4",1002,0)
 ;
"RTN","SAMIHOM4",1003,0)
 ; change the dfn in the from record to the to record dfn for merging
"RTN","SAMIHOM4",1004,0)
 ;
"RTN","SAMIHOM4",1005,0)
 s @lroot@(fromien,"dfn")=@lroot@(toien,"dfn")
"RTN","SAMIHOM4",1006,0)
 n dfn s dfn=@lroot@(toien,"dfn") ; for use in updating forms
"RTN","SAMIHOM4",1007,0)
 ;
"RTN","SAMIHOM4",1008,0)
 ; merge the from record to the to record
"RTN","SAMIHOM4",1009,0)
 ;
"RTN","SAMIHOM4",1010,0)
 m @lroot@(toien)=@lroot@(fromien)
"RTN","SAMIHOM4",1011,0)
 ;
"RTN","SAMIHOM4",1012,0)
 ; delete the from record
"RTN","SAMIHOM4",1013,0)
 ;
"RTN","SAMIHOM4",1014,0)
 k @lroot@(fromien)
"RTN","SAMIHOM4",1015,0)
 ;
"RTN","SAMIHOM4",1016,0)
 ; reindex the to record
"RTN","SAMIHOM4",1017,0)
 ;
"RTN","SAMIHOM4",1018,0)
 d INDXPTLK(toien)
"RTN","SAMIHOM4",1019,0)
 ;
"RTN","SAMIHOM4",1020,0)
 ; propagate the updated from record to every form
"RTN","SAMIHOM4",1021,0)
 ;
"RTN","SAMIHOM4",1022,0)
 d UPDTFRMS(dfn) ; updates the patient in the vapals-patient graph
"RTN","SAMIHOM4",1023,0)
 ;
"RTN","SAMIHOM4",1024,0)
 ; leave and return to the unmatched report
"RTN","SAMIHOM4",1025,0)
 ;   note that the form and to records will no longer be in the report
"RTN","SAMIHOM4",1026,0)
 ;
"RTN","SAMIHOM4",1027,0)
 d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",1028,0)
 ;
"RTN","SAMIHOM4",1029,0)
 quit  ; end of MERGE
"RTN","SAMIHOM4",1030,0)
 ;
"RTN","SAMIHOM4",1031,0)
 ;
"RTN","SAMIHOM4",1032,0)
 ;
"RTN","SAMIHOM4",1033,0)
 ;
"RTN","SAMIHOM4",1034,0)
 ;@proc ADDUNMAT
"RTN","SAMIHOM4",1035,0)
 ;
"RTN","SAMIHOM4",1036,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1037,0)
 ;
"RTN","SAMIHOM4",1038,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1039,0)
 ;@called-by none
"RTN","SAMIHOM4",1040,0)
 ;@calls
"RTN","SAMIHOM4",1041,0)
 ; addService^%webutils
"RTN","SAMIHOM4",1042,0)
 ;@input none
"RTN","SAMIHOM4",1043,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1044,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1045,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1046,0)
 ;
"RTN","SAMIHOM4",1047,0)
 ;
"RTN","SAMIHOM4",1048,0)
ADDUNMAT ; adds unmatched report web service to system
"RTN","SAMIHOM4",1049,0)
 ;
"RTN","SAMIHOM4",1050,0)
 d addService^%webutils("GET","unmatched","WSUNMAT^SAMIHOM4")
"RTN","SAMIHOM4",1051,0)
 ;
"RTN","SAMIHOM4",1052,0)
 quit  ; end of ADDUNMAT
"RTN","SAMIHOM4",1053,0)
 ;
"RTN","SAMIHOM4",1054,0)
 ;
"RTN","SAMIHOM4",1055,0)
 ;
"RTN","SAMIHOM4",1056,0)
 ;
"RTN","SAMIHOM4",1057,0)
 ;@proc DELUNMAT
"RTN","SAMIHOM4",1058,0)
 ;
"RTN","SAMIHOM4",1059,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1060,0)
 ;
"RTN","SAMIHOM4",1061,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1062,0)
 ;@called-by none
"RTN","SAMIHOM4",1063,0)
 ;@calls
"RTN","SAMIHOM4",1064,0)
 ; deleteService^%webutils
"RTN","SAMIHOM4",1065,0)
 ;@input none
"RTN","SAMIHOM4",1066,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1067,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1068,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1069,0)
 ;
"RTN","SAMIHOM4",1070,0)
 ;
"RTN","SAMIHOM4",1071,0)
DELUNMAT ; deletes unmatched web service
"RTN","SAMIHOM4",1072,0)
 ;
"RTN","SAMIHOM4",1073,0)
 d deleteService^%webutils("GET","unmatched")
"RTN","SAMIHOM4",1074,0)
 ;
"RTN","SAMIHOM4",1075,0)
 quit  ; end of DELUNMAT
"RTN","SAMIHOM4",1076,0)
 ;
"RTN","SAMIHOM4",1077,0)
 ;
"RTN","SAMIHOM4",1078,0)
 ;
"RTN","SAMIHOM4",1079,0)
 ;
"RTN","SAMIHOM4",1080,0)
 ;@ws-code get-unmatched WSUNMAT^SAMIHOM4
"RTN","SAMIHOM4",1081,0)
 ;
"RTN","SAMIHOM4",1082,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1083,0)
 ;
"RTN","SAMIHOM4",1084,0)
 ;ven/gpl;ws;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1085,0)
 ;@called-by
"RTN","SAMIHOM4",1086,0)
 ; web service get unmatched
"RTN","SAMIHOM4",1087,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",1088,0)
 ; LOGIN^SAMISITE
"RTN","SAMIHOM4",1089,0)
 ; MERGE
"RTN","SAMIHOM4",1090,0)
 ;@calls
"RTN","SAMIHOM4",1091,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",1092,0)
 ;@input
"RTN","SAMIHOM4",1093,0)
 ; SAMIARGS =
"RTN","SAMIHOM4",1094,0)
 ;@output
"RTN","SAMIHOM4",1095,0)
 ;.SAMIRESULT =
"RTN","SAMIHOM4",1096,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1097,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1098,0)
 ;
"RTN","SAMIHOM4",1099,0)
 ;
"RTN","SAMIHOM4",1100,0)
WSUNMAT(SAMIRESULT,SAMIARGS) ; navigates to unmatched report
"RTN","SAMIHOM4",1101,0)
 ;
"RTN","SAMIHOM4",1102,0)
 n filter,bdy
"RTN","SAMIHOM4",1103,0)
 s bdy=""
"RTN","SAMIHOM4",1104,0)
 ;s filter("siteid")="PHX"
"RTN","SAMIHOM4",1105,0)
 s filter("samiroute")="report"
"RTN","SAMIHOM4",1106,0)
 s filter("samireporttype")="unmatched"
"RTN","SAMIHOM4",1107,0)
 d WSVAPALS^SAMIHOM3(.filter,.bdy,.SAMIRESULT) ; back to the unmatched report
"RTN","SAMIHOM4",1108,0)
 ;
"RTN","SAMIHOM4",1109,0)
 quit  ; end of ws-code get-unmatched WSUNMAT^SAMIHOM4
"RTN","SAMIHOM4",1110,0)
 ;
"RTN","SAMIHOM4",1111,0)
 ;
"RTN","SAMIHOM4",1112,0)
 ;
"RTN","SAMIHOM4",1113,0)
 ;
"RTN","SAMIHOM4",1114,0)
 ;@func $$DUPSSN
"RTN","SAMIHOM4",1115,0)
 ;
"RTN","SAMIHOM4",1116,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1117,0)
 ;
"RTN","SAMIHOM4",1118,0)
 ;ven/gpl;private;function;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1119,0)
 ;@called-by none
"RTN","SAMIHOM4",1120,0)
 ; REG [commented out]
"RTN","SAMIHOM4",1121,0)
 ;@calls
"RTN","SAMIHOM4",1122,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1123,0)
 ;@input
"RTN","SAMIHOM4",1124,0)
 ; ssn =
"RTN","SAMIHOM4",1125,0)
 ;@output = 1 if ssn is duplicate; else 0
"RTN","SAMIHOM4",1126,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1127,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1128,0)
 ;
"RTN","SAMIHOM4",1129,0)
 ;
"RTN","SAMIHOM4",1130,0)
DUPSSN(ssn) ; is ssn duplicate?
"RTN","SAMIHOM4",1131,0)
 ;
"RTN","SAMIHOM4",1132,0)
 n proot s proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1133,0)
 i $d(@proot@("ssn",ssn)) q 1
"RTN","SAMIHOM4",1134,0)
 ;
"RTN","SAMIHOM4",1135,0)
 quit 0 ; end of $$DUPSSN
"RTN","SAMIHOM4",1136,0)
 ;
"RTN","SAMIHOM4",1137,0)
 ;
"RTN","SAMIHOM4",1138,0)
 ;
"RTN","SAMIHOM4",1139,0)
 ;
"RTN","SAMIHOM4",1140,0)
 ;@func $$DUPICN
"RTN","SAMIHOM4",1141,0)
 ;
"RTN","SAMIHOM4",1142,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1143,0)
 ;
"RTN","SAMIHOM4",1144,0)
 ;ven/gpl;private;function;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1145,0)
 ;@called-by none
"RTN","SAMIHOM4",1146,0)
 ; REG [commented out]
"RTN","SAMIHOM4",1147,0)
 ;@calls
"RTN","SAMIHOM4",1148,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1149,0)
 ;@input
"RTN","SAMIHOM4",1150,0)
 ; icn =
"RTN","SAMIHOM4",1151,0)
 ;@output = 1 if icn is duplicate; else 0
"RTN","SAMIHOM4",1152,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1153,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1154,0)
 ;
"RTN","SAMIHOM4",1155,0)
 ;
"RTN","SAMIHOM4",1156,0)
DUPICN(icn) ; is icn duplicate?
"RTN","SAMIHOM4",1157,0)
 ;
"RTN","SAMIHOM4",1158,0)
 n proot s proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1159,0)
 n tmpicn s tmpicn=$p(icn,"V",1)
"RTN","SAMIHOM4",1160,0)
 i $d(@proot@("icn",icn)) q 1
"RTN","SAMIHOM4",1161,0)
 i $d(@proot@("icn",tmpicn)) q 1
"RTN","SAMIHOM4",1162,0)
 ;
"RTN","SAMIHOM4",1163,0)
 quit 0 ; end of $$DUPICN
"RTN","SAMIHOM4",1164,0)
 ;
"RTN","SAMIHOM4",1165,0)
 ;
"RTN","SAMIHOM4",1166,0)
 ;
"RTN","SAMIHOM4",1167,0)
 ;
"RTN","SAMIHOM4",1168,0)
 ;@func $$BADICN
"RTN","SAMIHOM4",1169,0)
 ;
"RTN","SAMIHOM4",1170,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1171,0)
 ;
"RTN","SAMIHOM4",1172,0)
 ;ven/gpl;private;function;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1173,0)
 ;@called-by none
"RTN","SAMIHOM4",1174,0)
 ; REG [commented out]
"RTN","SAMIHOM4",1175,0)
 ;@calls
"RTN","SAMIHOM4",1176,0)
 ; $$CHECKDG^MPIFSPC
"RTN","SAMIHOM4",1177,0)
 ;@input
"RTN","SAMIHOM4",1178,0)
 ; icn =
"RTN","SAMIHOM4",1179,0)
 ;@output = 1 if icn checkdigits are wrong; else 0
"RTN","SAMIHOM4",1180,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1181,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1182,0)
 ;
"RTN","SAMIHOM4",1183,0)
 ;
"RTN","SAMIHOM4",1184,0)
BADICN(icn) ; are ICN checkdigits wrong?
"RTN","SAMIHOM4",1185,0)
 ;
"RTN","SAMIHOM4",1186,0)
 n zchk s zchk=$p(icn,"V",2)
"RTN","SAMIHOM4",1187,0)
 n zicn s zicn=$p(icn,"V",1)
"RTN","SAMIHOM4",1188,0)
 q:zchk="" 1
"RTN","SAMIHOM4",1189,0)
 i zchk'=$$CHECKDG^MPIFSPC(zicn) q 1
"RTN","SAMIHOM4",1190,0)
 ;
"RTN","SAMIHOM4",1191,0)
 quit 0 ; end of $$BADICN
"RTN","SAMIHOM4",1192,0)
 ;
"RTN","SAMIHOM4",1193,0)
 ;
"RTN","SAMIHOM4",1194,0)
 ;
"RTN","SAMIHOM4",1195,0)
 ;
"RTN","SAMIHOM4",1196,0)
 ;@proc SAVE
"RTN","SAMIHOM4",1197,0)
 ;
"RTN","SAMIHOM4",1198,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1199,0)
 ;
"RTN","SAMIHOM4",1200,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1201,0)
 ;@called-by
"RTN","SAMIHOM4",1202,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",1203,0)
 ;@calls
"RTN","SAMIHOM4",1204,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",1205,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1206,0)
 ; UNINDXPT
"RTN","SAMIHOM4",1207,0)
 ; $$REMATCH
"RTN","SAMIHOM4",1208,0)
 ; MKPTLK
"RTN","SAMIHOM4",1209,0)
 ; INDXPTLK
"RTN","SAMIHOM4",1210,0)
 ; UPDTFRMS
"RTN","SAMIHOM4",1211,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",1212,0)
 ;@input
"RTN","SAMIHOM4",1213,0)
 ; SAMIARG =
"RTN","SAMIHOM4",1214,0)
 ;@output
"RTN","SAMIHOM4",1215,0)
 ;.SAMIRESULT =
"RTN","SAMIHOM4",1216,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1217,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1218,0)
 ;
"RTN","SAMIHOM4",1219,0)
 ;
"RTN","SAMIHOM4",1220,0)
SAVE(SAMIRESULT,SAMIARG) ; save patient-lookup record after edit
"RTN","SAMIHOM4",1221,0)
 ;
"RTN","SAMIHOM4",1222,0)
 n dfn s dfn=$g(vars("dfn")) ; must have a dfn
"RTN","SAMIHOM4",1223,0)
 i dfn="" d  q  ;
"RTN","SAMIHOM4",1224,0)
 . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",1225,0)
 . q
"RTN","SAMIHOM4",1226,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1227,0)
 n sien s sien=$o(@root@("dfn",dfn,""))
"RTN","SAMIHOM4",1228,0)
 i sien="" d  q  ;
"RTN","SAMIHOM4",1229,0)
 . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",1230,0)
 . q
"RTN","SAMIHOM4",1231,0)
 d UNINDXPT(sien) ; remove old index entries
"RTN","SAMIHOM4",1232,0)
 n zm
"RTN","SAMIHOM4",1233,0)
 k SAMIARG("MATCHLOG")
"RTN","SAMIHOM4",1234,0)
 s zm=$$REMATCH(sien,.SAMIARG)
"RTN","SAMIHOM4",1235,0)
 i zm>0 d  ;
"RTN","SAMIHOM4",1236,0)
 . s SAMIARG("MATCHLOG")=zm
"RTN","SAMIHOM4",1237,0)
 . q
"RTN","SAMIHOM4",1238,0)
 d MKPTLK(sien,.SAMIARG) ; add the updated fields
"RTN","SAMIHOM4",1239,0)
 d INDXPTLK(sien) ; create new index entries
"RTN","SAMIHOM4",1240,0)
 d UPDTFRMS(dfn) ; update demographic info in all forms
"RTN","SAMIHOM4",1241,0)
 n filter,bdy
"RTN","SAMIHOM4",1242,0)
 s bdy=""
"RTN","SAMIHOM4",1243,0)
 m filter=SAMIARG
"RTN","SAMIHOM4",1244,0)
 s filter("samiroute")="report"
"RTN","SAMIHOM4",1245,0)
 s filter("samireporttype")="unmatched"
"RTN","SAMIHOM4",1246,0)
 d WSVAPALS^SAMIHOM3(.filter,.bdy,.SAMIRESULT) ; back to the unmatched report
"RTN","SAMIHOM4",1247,0)
 ;
"RTN","SAMIHOM4",1248,0)
 quit  ; end of SAVE
"RTN","SAMIHOM4",1249,0)
 ;
"RTN","SAMIHOM4",1250,0)
 ;
"RTN","SAMIHOM4",1251,0)
 ;
"RTN","SAMIHOM4",1252,0)
 ;
"RTN","SAMIHOM4",1253,0)
 ;@func $$REMATCH
"RTN","SAMIHOM4",1254,0)
 ;
"RTN","SAMIHOM4",1255,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1256,0)
 ;
"RTN","SAMIHOM4",1257,0)
 ;ven/gpl;private;function;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1258,0)
 ;@called-by
"RTN","SAMIHOM4",1259,0)
 ; REG
"RTN","SAMIHOM4",1260,0)
 ; SAVE
"RTN","SAMIHOM4",1261,0)
 ;@calls
"RTN","SAMIHOM4",1262,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1263,0)
 ; $$UCASE
"RTN","SAMIHOM4",1264,0)
 ;@input
"RTN","SAMIHOM4",1265,0)
 ; SAMIARG =
"RTN","SAMIHOM4",1266,0)
 ;@output
"RTN","SAMIHOM4",1267,0)
 ;.sien =
"RTN","SAMIHOM4",1268,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1269,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1270,0)
 ;
"RTN","SAMIHOM4",1271,0)
 ;
"RTN","SAMIHOM4",1272,0)
REMATCH(sien,SAMIARG) ; extrinsic returns possible match ien
"RTN","SAMIHOM4",1273,0)
 ;
"RTN","SAMIHOM4",1274,0)
 ; else zero
"RTN","SAMIHOM4",1275,0)
 ;
"RTN","SAMIHOM4",1276,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1277,0)
 n ssn,name,icn,x,y
"RTN","SAMIHOM4",1278,0)
 s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",1279,0)
 i ssn["-" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",1280,0)
 s name=$g(SAMIARG("saminame"))
"RTN","SAMIHOM4",1281,0)
 i name="" s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",1282,0)
 s name=$$UCASE(name)
"RTN","SAMIHOM4",1283,0)
 ; s icn=$g(SAMIARG("icn"))
"RTN","SAMIHOM4",1284,0)
 s x=0
"RTN","SAMIHOM4",1285,0)
 i ssn'="" s x=$o(@lroot@("ssn",ssn,""))
"RTN","SAMIHOM4",1286,0)
 i x=sien s x=$o(@lroot@("ssn",ssn,x))
"RTN","SAMIHOM4",1287,0)
 i +x'=0 d  ;
"RTN","SAMIHOM4",1288,0)
 . s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",1289,0)
 . ;i y>9000000 s x=0
"RTN","SAMIHOM4",1290,0)
 . q
"RTN","SAMIHOM4",1291,0)
 i x>0 q x
"RTN","SAMIHOM4",1292,0)
 i name'="" s x=$o(@lroot@("name",name,""))
"RTN","SAMIHOM4",1293,0)
 i x=sien s x=$o(@lroot@("name",name,x))
"RTN","SAMIHOM4",1294,0)
 i +x'=0 d  ;
"RTN","SAMIHOM4",1295,0)
 . s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",1296,0)
 . ;i y>9000000 s x=0
"RTN","SAMIHOM4",1297,0)
 . q
"RTN","SAMIHOM4",1298,0)
 i x>0 q x
"RTN","SAMIHOM4",1299,0)
 ;i icn'="" s x=$o(@lroot@("icn",icn,""))
"RTN","SAMIHOM4",1300,0)
 ;i x=sien s x=$o(@lroot@("icn",icn,x))
"RTN","SAMIHOM4",1301,0)
 ;i +x'=0 d  ;
"RTN","SAMIHOM4",1302,0)
 ;. s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",1303,0)
 ;. i y>9000000 s x=0
"RTN","SAMIHOM4",1304,0)
 ;i x>0 q x
"RTN","SAMIHOM4",1305,0)
 ;
"RTN","SAMIHOM4",1306,0)
 quit 0 ; end of $$REMATCH
"RTN","SAMIHOM4",1307,0)
 ;
"RTN","SAMIHOM4",1308,0)
 ;
"RTN","SAMIHOM4",1309,0)
 ;
"RTN","SAMIHOM4",1310,0)
 ;
"RTN","SAMIHOM4",1311,0)
 ;@proc SETINFO
"RTN","SAMIHOM4",1312,0)
 ;
"RTN","SAMIHOM4",1313,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1314,0)
 ;
"RTN","SAMIHOM4",1315,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1316,0)
 ;@called-by
"RTN","SAMIHOM4",1317,0)
 ; REG
"RTN","SAMIHOM4",1318,0)
 ;@calls none
"RTN","SAMIHOM4",1319,0)
 ;@input
"RTN","SAMIHOM4",1320,0)
 ; msg = info msg
"RTN","SAMIHOM4",1321,0)
 ;@output
"RTN","SAMIHOM4",1322,0)
 ;.vars("infoMessage") = info msg
"RTN","SAMIHOM4",1323,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1324,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1325,0)
 ;
"RTN","SAMIHOM4",1326,0)
 ;
"RTN","SAMIHOM4",1327,0)
SETINFO(vars,msg) ; set information message text
"RTN","SAMIHOM4",1328,0)
 ;
"RTN","SAMIHOM4",1329,0)
 ; vars are the screen variables passed by reference
"RTN","SAMIHOM4",1330,0)
 ;
"RTN","SAMIHOM4",1331,0)
 s vars("infoMessage")=msg
"RTN","SAMIHOM4",1332,0)
 ;
"RTN","SAMIHOM4",1333,0)
 quit  ; end of SETINFO
"RTN","SAMIHOM4",1334,0)
 ;
"RTN","SAMIHOM4",1335,0)
 ;
"RTN","SAMIHOM4",1336,0)
 ;
"RTN","SAMIHOM4",1337,0)
 ;
"RTN","SAMIHOM4",1338,0)
 ;@proc SETWARN
"RTN","SAMIHOM4",1339,0)
 ;
"RTN","SAMIHOM4",1340,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1341,0)
 ;
"RTN","SAMIHOM4",1342,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1343,0)
 ;@called-by none
"RTN","SAMIHOM4",1344,0)
 ; REG [commented out]
"RTN","SAMIHOM4",1345,0)
 ;@calls none
"RTN","SAMIHOM4",1346,0)
 ;@input
"RTN","SAMIHOM4",1347,0)
 ; msg = warning msg
"RTN","SAMIHOM4",1348,0)
 ;@output
"RTN","SAMIHOM4",1349,0)
 ;.vars("warnMessage") = warning msg
"RTN","SAMIHOM4",1350,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1351,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1352,0)
 ;
"RTN","SAMIHOM4",1353,0)
 ;
"RTN","SAMIHOM4",1354,0)
SETWARN(vars,msg) ; set warning message text
"RTN","SAMIHOM4",1355,0)
 ;
"RTN","SAMIHOM4",1356,0)
 ; vars are the screen variables passed by reference
"RTN","SAMIHOM4",1357,0)
 ;
"RTN","SAMIHOM4",1358,0)
 s vars("warnMessage")=msg
"RTN","SAMIHOM4",1359,0)
 ;
"RTN","SAMIHOM4",1360,0)
 quit  ; end of SETWARN
"RTN","SAMIHOM4",1361,0)
 ;
"RTN","SAMIHOM4",1362,0)
 ;
"RTN","SAMIHOM4",1363,0)
 ;
"RTN","SAMIHOM4",1364,0)
 ;
"RTN","SAMIHOM4",1365,0)
 ;@proc RTNERR
"RTN","SAMIHOM4",1366,0)
 ;
"RTN","SAMIHOM4",1367,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1368,0)
 ;
"RTN","SAMIHOM4",1369,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1370,0)
 ;@called-by
"RTN","SAMIHOM4",1371,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",1372,0)
 ; REG
"RTN","SAMIHOM4",1373,0)
 ;@calls
"RTN","SAMIHOM4",1374,0)
 ; SAMIHTM^%wf
"RTN","SAMIHOM4",1375,0)
 ; MERGEHTM^%wf
"RTN","SAMIHOM4",1376,0)
 ;@input
"RTN","SAMIHOM4",1377,0)
 ; form = form the page requires
"RTN","SAMIHOM4",1378,0)
 ;.vals = values for the page. passed by reference
"RTN","SAMIHOM4",1379,0)
 ; msg = error message to be displayed
"RTN","SAMIHOM4",1380,0)
 ; fld = name of the field where the cursor should be put
"RTN","SAMIHOM4",1381,0)
 ;@output
"RTN","SAMIHOM4",1382,0)
 ;.rtn = return array
"RTN","SAMIHOM4",1383,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1384,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1385,0)
 ;
"RTN","SAMIHOM4",1386,0)
 ;
"RTN","SAMIHOM4",1387,0)
RTNERR(rtn,form,vals,msg,fld) ; redisplay page w/error message
"RTN","SAMIHOM4",1388,0)
 ;
"RTN","SAMIHOM4",1389,0)
 n zhtml ; work area for the tempate
"RTN","SAMIHOM4",1390,0)
 d SAMIHTM^%wf(.zhtml,form,.err)
"RTN","SAMIHOM4",1391,0)
 d MERGEHTM^%wf(.zhtml,.vals,.err)
"RTN","SAMIHOM4",1392,0)
 m rtn=zhtml
"RTN","SAMIHOM4",1393,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMIHOM4",1394,0)
 ;
"RTN","SAMIHOM4",1395,0)
 quit  ; end of RTNERR
"RTN","SAMIHOM4",1396,0)
 ;
"RTN","SAMIHOM4",1397,0)
 ;
"RTN","SAMIHOM4",1398,0)
 ;
"RTN","SAMIHOM4",1399,0)
 ;
"RTN","SAMIHOM4",1400,0)
 ;@proc RTNPAGE
"RTN","SAMIHOM4",1401,0)
 ;
"RTN","SAMIHOM4",1402,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1403,0)
 ;
"RTN","SAMIHOM4",1404,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1405,0)
 ;@called-by
"RTN","SAMIHOM4",1406,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",1407,0)
 ;@calls
"RTN","SAMIHOM4",1408,0)
 ; SAMIHTM^%wf
"RTN","SAMIHOM4",1409,0)
 ; MERGEHTM^%wf
"RTN","SAMIHOM4",1410,0)
 ;@input
"RTN","SAMIHOM4",1411,0)
 ; form = form the page requires
"RTN","SAMIHOM4",1412,0)
 ;.vals = values for the page. passed by reference
"RTN","SAMIHOM4",1413,0)
 ;@output
"RTN","SAMIHOM4",1414,0)
 ;.rtn = return array
"RTN","SAMIHOM4",1415,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1416,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1417,0)
 ;
"RTN","SAMIHOM4",1418,0)
 ;
"RTN","SAMIHOM4",1419,0)
RTNPAGE(rtn,form,vals) ; display page
"RTN","SAMIHOM4",1420,0)
 ;
"RTN","SAMIHOM4",1421,0)
 ; rtn is the return array
"RTN","SAMIHOM4",1422,0)
 ; form is the form the page requires
"RTN","SAMIHOM4",1423,0)
 ; vals are the values for the page. passed by reference
"RTN","SAMIHOM4",1424,0)
 ;
"RTN","SAMIHOM4",1425,0)
 n err
"RTN","SAMIHOM4",1426,0)
 n zhtml ; work area for the tempate
"RTN","SAMIHOM4",1427,0)
 d SAMIHTM^%wf(.zhtml,form,.err)
"RTN","SAMIHOM4",1428,0)
 d MERGEHTM^%wf(.zhtml,.vals,.err)
"RTN","SAMIHOM4",1429,0)
 m SAMIRESULT=zhtml
"RTN","SAMIHOM4",1430,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMIHOM4",1431,0)
 ;
"RTN","SAMIHOM4",1432,0)
 quit  ; end of RTNPAGE
"RTN","SAMIHOM4",1433,0)
 ;
"RTN","SAMIHOM4",1434,0)
 ;
"RTN","SAMIHOM4",1435,0)
 ;
"RTN","SAMIHOM4",1436,0)
 ;
"RTN","SAMIHOM4",1437,0)
 ;@proc REINDXPL
"RTN","SAMIHOM4",1438,0)
 ;
"RTN","SAMIHOM4",1439,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1440,0)
 ;
"RTN","SAMIHOM4",1441,0)
 ;ven/gpl;private;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1442,0)
 ;@called-by none
"RTN","SAMIHOM4",1443,0)
 ;@calls
"RTN","SAMIHOM4",1444,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1445,0)
 ; INDXPTLK
"RTN","SAMIHOM4",1446,0)
 ;@input [tbd]
"RTN","SAMIHOM4",1447,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1448,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1449,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1450,0)
 ;
"RTN","SAMIHOM4",1451,0)
 ;
"RTN","SAMIHOM4",1452,0)
REINDXPL ; reindex patient lookup
"RTN","SAMIHOM4",1453,0)
 ;
"RTN","SAMIHOM4",1454,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1455,0)
 n zi s zi=0
"RTN","SAMIHOM4",1456,0)
 k @root@("dfn")
"RTN","SAMIHOM4",1457,0)
 k @root@("ssn")
"RTN","SAMIHOM4",1458,0)
 k @root@("name")
"RTN","SAMIHOM4",1459,0)
 k @root@("last5")
"RTN","SAMIHOM4",1460,0)
 k @root@("sinamef")
"RTN","SAMIHOM4",1461,0)
 k @root@("sinamel")
"RTN","SAMIHOM4",1462,0)
 k @root@("mrn")
"RTN","SAMIHOM4",1463,0)
 k @root@("emrn")
"RTN","SAMIHOM4",1464,0)
 k @root@("pid")
"RTN","SAMIHOM4",1465,0)
 ; k @root@("icn")
"RTN","SAMIHOM4",1466,0)
 f  s zi=$o(@root@(zi)) q:+zi=0  d  ;
"RTN","SAMIHOM4",1467,0)
 . d INDXPTLK(zi)
"RTN","SAMIHOM4",1468,0)
 . q
"RTN","SAMIHOM4",1469,0)
 ;
"RTN","SAMIHOM4",1470,0)
 quit  ; end of REINDXPL
"RTN","SAMIHOM4",1471,0)
 ;
"RTN","SAMIHOM4",1472,0)
 ;
"RTN","SAMIHOM4",1473,0)
 ;
"RTN","SAMIHOM4",1474,0)
 ;
"RTN","SAMIHOM4",1475,0)
 ;@pps INDXPTLK
"RTN","SAMIHOM4",1476,0)
 ;
"RTN","SAMIHOM4",1477,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1478,0)
 ;
"RTN","SAMIHOM4",1479,0)
 ;ven/gpl;pps;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1480,0)
 ;@called-by
"RTN","SAMIHOM4",1481,0)
 ; WSDCMKIL^SAMIDCM1
"RTN","SAMIHOM4",1482,0)
 ; wsPostSAMI^SAMIJS2
"RTN","SAMIHOM4",1483,0)
 ; REG
"RTN","SAMIHOM4",1484,0)
 ; MERGE
"RTN","SAMIHOM4",1485,0)
 ; SAVE
"RTN","SAMIHOM4",1486,0)
 ; REINDXPL
"RTN","SAMIHOM4",1487,0)
 ;@calls
"RTN","SAMIHOM4",1488,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1489,0)
 ; $$UCASE
"RTN","SAMIHOM4",1490,0)
 ; $$CHECKDG^MPIFSPC [commented out]
"RTN","SAMIHOM4",1491,0)
 ; $$HTE^XLFDT
"RTN","SAMIHOM4",1492,0)
 ;@input
"RTN","SAMIHOM4",1493,0)
 ; ien = entry ien
"RTN","SAMIHOM4",1494,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1495,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1496,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1497,0)
 ;
"RTN","SAMIHOM4",1498,0)
 ;
"RTN","SAMIHOM4",1499,0)
INDXPTLK(ien) ; generate index entries in patient-lookup graph
"RTN","SAMIHOM4",1500,0)
 ;
"RTN","SAMIHOM4",1501,0)
 ; for entry ien
"RTN","SAMIHOM4",1502,0)
 ;
"RTN","SAMIHOM4",1503,0)
 n proot set proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1504,0)
 n name s name=$g(@proot@(ien,"saminame"))
"RTN","SAMIHOM4",1505,0)
 s @proot@("name",name,ien)=""
"RTN","SAMIHOM4",1506,0)
 n ucname s ucname=$$UCASE(name)
"RTN","SAMIHOM4",1507,0)
 s @proot@("name",ucname,ien)=""
"RTN","SAMIHOM4",1508,0)
 n x s x=$g(@proot@(ien,"dfn")) ;w !,x
"RTN","SAMIHOM4",1509,0)
 i x="" d  ;
"RTN","SAMIHOM4",1510,0)
 . s x=$o(@proot@("dfn","   "),-1)+1
"RTN","SAMIHOM4",1511,0)
 . s @proot@(ien,"dfn")=x
"RTN","SAMIHOM4",1512,0)
 . q
"RTN","SAMIHOM4",1513,0)
 s:x]"" @proot@("dfn",x,ien)=""
"RTN","SAMIHOM4",1514,0)
 s x=$g(@proot@(ien,"last5")) ;w !,x
"RTN","SAMIHOM4",1515,0)
 s:x]"" @proot@("last5",x,ien)=""
"RTN","SAMIHOM4",1516,0)
 ;
"RTN","SAMIHOM4",1517,0)
 ; s x=$g(@proot@(ien,"icn")) ;w !,x
"RTN","SAMIHOM4",1518,0)
 ; i x'["V" d  ;
"RTN","SAMIHOM4",1519,0)
 ; . i x="" q
"RTN","SAMIHOM4",1520,0)
 ; . n chk s chk=$$CHECKDG^MPIFSPC(x)
"RTN","SAMIHOM4",1521,0)
 ; . s @proot@(ien,"icn")=x_"V"_chk
"RTN","SAMIHOM4",1522,0)
 ; . s x=x_"V"_chk
"RTN","SAMIHOM4",1523,0)
 ; s:x]"" @proot@("icn",x,ien)=""
"RTN","SAMIHOM4",1524,0)
 ;
"RTN","SAMIHOM4",1525,0)
 s x=$g(@proot@(ien,"ssn")) ;w !,x
"RTN","SAMIHOM4",1526,0)
 s:x]"" @proot@("ssn",x,ien)=""
"RTN","SAMIHOM4",1527,0)
 s x=$g(@proot@(ien,"sinamef")) ;w !,x
"RTN","SAMIHOM4",1528,0)
 s:x]"" @proot@("sinamef",x,ien)=""
"RTN","SAMIHOM4",1529,0)
 s x=$g(@proot@(ien,"sinamel")) ;w !,x
"RTN","SAMIHOM4",1530,0)
 s:x]"" @proot@("sinamel",x,ien)=""
"RTN","SAMIHOM4",1531,0)
 s x=$g(@proot@(ien,"simrn"))
"RTN","SAMIHOM4",1532,0)
 s:x]"" @proot@("mrn",x,ien)=""
"RTN","SAMIHOM4",1533,0)
 s:x]"" @proot@("emrn","e"_x,ien)=""
"RTN","SAMIHOM4",1534,0)
 s x=$g(@proot@(ien,"sipid"))
"RTN","SAMIHOM4",1535,0)
 s:x]"" @proot@("pid",x,ien)=""
"RTN","SAMIHOM4",1536,0)
 set @proot@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHOM4",1537,0)
 ;
"RTN","SAMIHOM4",1538,0)
 quit  ; end of pps INDXPTLK
"RTN","SAMIHOM4",1539,0)
 ;
"RTN","SAMIHOM4",1540,0)
 ;
"RTN","SAMIHOM4",1541,0)
 ;
"RTN","SAMIHOM4",1542,0)
 ;
"RTN","SAMIHOM4",1543,0)
 ;@pps UNINDXPT
"RTN","SAMIHOM4",1544,0)
 ;
"RTN","SAMIHOM4",1545,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1546,0)
 ;
"RTN","SAMIHOM4",1547,0)
 ;ven/gpl;pps;procedure;clean?;silent;sac?;tests?;port?
"RTN","SAMIHOM4",1548,0)
 ;@called-by
"RTN","SAMIHOM4",1549,0)
 ; WSDCMKIL^SAMIDCM1
"RTN","SAMIHOM4",1550,0)
 ;@calls
"RTN","SAMIHOM4",1551,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1552,0)
 ; $$UCASE
"RTN","SAMIHOM4",1553,0)
 ; $$CHECKDG^MPIFSPC [commented out]
"RTN","SAMIHOM4",1554,0)
 ; $$HTE^XLFDT
"RTN","SAMIHOM4",1555,0)
 ;@input
"RTN","SAMIHOM4",1556,0)
 ; ien = entry ien
"RTN","SAMIHOM4",1557,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1558,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1559,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1560,0)
 ;
"RTN","SAMIHOM4",1561,0)
 ;
"RTN","SAMIHOM4",1562,0)
UNINDXPT(ien) ; remove index entries from patient-lookup graph
"RTN","SAMIHOM4",1563,0)
 ;
"RTN","SAMIHOM4",1564,0)
 ; for entry ien
"RTN","SAMIHOM4",1565,0)
 ;
"RTN","SAMIHOM4",1566,0)
 n proot set proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",1567,0)
 n name s name=$g(@proot@(ien,"saminame"))
"RTN","SAMIHOM4",1568,0)
 k @proot@("name",name,ien)
"RTN","SAMIHOM4",1569,0)
 n ucname s ucname=$$UCASE(name)
"RTN","SAMIHOM4",1570,0)
 k @proot@("name",ucname,ien)
"RTN","SAMIHOM4",1571,0)
 n x
"RTN","SAMIHOM4",1572,0)
 s x=$g(@proot@(ien,"dfn")) ;w !,x
"RTN","SAMIHOM4",1573,0)
 k:x'="" @proot@("dfn",x,ien)
"RTN","SAMIHOM4",1574,0)
 s x=$g(@proot@(ien,"last5")) ;w !,x
"RTN","SAMIHOM4",1575,0)
 k:x'="" @proot@("last5",x,ien)
"RTN","SAMIHOM4",1576,0)
 ;
"RTN","SAMIHOM4",1577,0)
 ; s x=$g(@proot@(ien,"icn")) ;w !,x
"RTN","SAMIHOM4",1578,0)
 ; i x'["V" d  ;
"RTN","SAMIHOM4",1579,0)
 ; . i x="" q
"RTN","SAMIHOM4",1580,0)
 ; . n chk s chk=$$CHECKDG^MPIFSPC(x)
"RTN","SAMIHOM4",1581,0)
 ; . s @proot@(ien,"icn")=x_"V"_chk
"RTN","SAMIHOM4",1582,0)
 ; . s x=x_"V"_chk
"RTN","SAMIHOM4",1583,0)
 ; k:x'="" @proot@("icn",x,ien)
"RTN","SAMIHOM4",1584,0)
 ;
"RTN","SAMIHOM4",1585,0)
 s x=$g(@proot@(ien,"ssn")) ;w !,x
"RTN","SAMIHOM4",1586,0)
 k:x'="" @proot@("ssn",x,ien)
"RTN","SAMIHOM4",1587,0)
 s x=$g(@proot@(ien,"sinamef")) ;w !,x
"RTN","SAMIHOM4",1588,0)
 k:x'="" @proot@("sinamef",x,ien)
"RTN","SAMIHOM4",1589,0)
 s x=$g(@proot@(ien,"sinamel")) w !,x
"RTN","SAMIHOM4",1590,0)
 k:x'="" @proot@("sinamel",x,ien)
"RTN","SAMIHOM4",1591,0)
 set @proot@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHOM4",1592,0)
 ;
"RTN","SAMIHOM4",1593,0)
 quit  ; end of UNINDXPT
"RTN","SAMIHOM4",1594,0)
 ;
"RTN","SAMIHOM4",1595,0)
 ;
"RTN","SAMIHOM4",1596,0)
 ;
"RTN","SAMIHOM4",1597,0)
 ;
"RTN","SAMIHOM4",1598,0)
 ;@func $$UCASE
"RTN","SAMIHOM4",1599,0)
 ;
"RTN","SAMIHOM4",1600,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1601,0)
 ;
"RTN","SAMIHOM4",1602,0)
 ;ven/gpl;private;function;clean;silent;sac;tests?;port?
"RTN","SAMIHOM4",1603,0)
 ;@called-by
"RTN","SAMIHOM4",1604,0)
 ; MKPTLK
"RTN","SAMIHOM4",1605,0)
 ; REMATCH
"RTN","SAMIHOM4",1606,0)
 ; INDXPTLK
"RTN","SAMIHOM4",1607,0)
 ; UNINDXPT
"RTN","SAMIHOM4",1608,0)
 ;@calls
"RTN","SAMIHOM4",1609,0)
 ; @^%ZOSF("UPPERCASE")
"RTN","SAMIHOM4",1610,0)
 ;@input
"RTN","SAMIHOM4",1611,0)
 ; STR = string to convert to uppercase
"RTN","SAMIHOM4",1612,0)
 ;@output = uppercase string
"RTN","SAMIHOM4",1613,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1614,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1615,0)
 ;
"RTN","SAMIHOM4",1616,0)
 ;
"RTN","SAMIHOM4",1617,0)
UCASE(STR) ; uppercase string
"RTN","SAMIHOM4",1618,0)
 ;
"RTN","SAMIHOM4",1619,0)
 N X,Y
"RTN","SAMIHOM4",1620,0)
 S X=STR
"RTN","SAMIHOM4",1621,0)
 X ^%ZOSF("UPPERCASE")
"RTN","SAMIHOM4",1622,0)
 ;
"RTN","SAMIHOM4",1623,0)
 quit Y ; end of $$UCASE
"RTN","SAMIHOM4",1624,0)
 ;
"RTN","SAMIHOM4",1625,0)
 ;
"RTN","SAMIHOM4",1626,0)
 ;
"RTN","SAMIHOM4",1627,0)
 ;
"RTN","SAMIHOM4",1628,0)
 ;@wrs-code WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",1629,0)
 ;
"RTN","SAMIHOM4",1630,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1631,0)
 ;
"RTN","SAMIHOM4",1632,0)
 ;ven/gpl;wrs;procedure;clean?;silent?;sac?;tests?;port?
"RTN","SAMIHOM4",1633,0)
 ;@signature
"RTN","SAMIHOM4",1634,0)
 ; do WSNEWCAS^SAMIHOM3(SAMIARGS,SAMIBODY,SAMIRESULT)
"RTN","SAMIHOM4",1635,0)
 ;@branches-from
"RTN","SAMIHOM4",1636,0)
 ; wrs WSNEWCAS^SAMIHOM3 [wr newcase]
"RTN","SAMIHOM4",1637,0)
 ;@wrs-called-by
"RTN","SAMIHOM4",1638,0)
 ; ws WSVAPALS^SAMIHOM3 [ws post vapals]
"RTN","SAMIHOM4",1639,0)
 ;@called-by
"RTN","SAMIHOM4",1640,0)
 ; GETHOME [commented out]
"RTN","SAMIHOM4",1641,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",1642,0)
 ; ENROLL^SAMILD2
"RTN","SAMIHOM4",1643,0)
 ; ENROLL^SAMILOAD
"RTN","SAMIHOM4",1644,0)
 ; ENROLL^SAMIZPH1
"RTN","SAMIHOM4",1645,0)
 ;@calls
"RTN","SAMIHOM4",1646,0)
 ; parseBody^%wf
"RTN","SAMIHOM4",1647,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1648,0)
 ;  $$VALDTNM [commented out]
"RTN","SAMIHOM4",1649,0)
 ;  GETHOME [commented out]
"RTN","SAMIHOM4",1650,0)
 ;  $$NEXTNUM [commented out]
"RTN","SAMIHOM4",1651,0)
 ; $$GENSTDID^SAMIHOM3
"RTN","SAMIHOM4",1652,0)
 ; $$NOW^XLFDT
"RTN","SAMIHOM4",1653,0)
 ; $$KEYDATE^SAMIHOM3
"RTN","SAMIHOM4",1654,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMIHOM4",1655,0)
 ;  makeSbform [commented out]
"RTN","SAMIHOM4",1656,0)
 ; $$MKSIFORM^SAMIHOM3
"RTN","SAMIHOM4",1657,0)
 ; wsGetForm^%wf
"RTN","SAMIHOM4",1658,0)
 ;  WSCASE^SAMICASE [commented out]
"RTN","SAMIHOM4",1659,0)
 ;@input [tbd]
"RTN","SAMIHOM4",1660,0)
 ;@output [tbd]
"RTN","SAMIHOM4",1661,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1662,0)
 ;@tests
"RTN","SAMIHOM4",1663,0)
 ; UTWSNC^SAMIUTH3
"RTN","SAMIHOM4",1664,0)
 ;
"RTN","SAMIHOM4",1665,0)
 ;
"RTN","SAMIHOM4",1666,0)
WSNEWCAS ; web route newcase (creates new case)
"RTN","SAMIHOM4",1667,0)
 ;
"RTN","SAMIHOM4",1668,0)
 ;@stanza 2 create new case
"RTN","SAMIHOM4",1669,0)
 ;
"RTN","SAMIHOM4",1670,0)
 merge ^SAMIUL("newCase","ARGS")=SAMIARGS
"RTN","SAMIHOM4",1671,0)
 merge ^SAMIUL("newCase","BODY")=SAMIBODY
"RTN","SAMIHOM4",1672,0)
 ;
"RTN","SAMIHOM4",1673,0)
 new vars,bdy
"RTN","SAMIHOM4",1674,0)
 set SAMIBDY=$get(SAMIBODY(1))
"RTN","SAMIHOM4",1675,0)
 if SAMIBDY="" M vars=SAMIARGS
"RTN","SAMIHOM4",1676,0)
 else  do parseBody^%wf("vars",.SAMIBDY)
"RTN","SAMIHOM4",1677,0)
 merge ^SAMIUL("newCase","vars")=vars
"RTN","SAMIHOM4",1678,0)
 ;
"RTN","SAMIHOM4",1679,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",1680,0)
 ;
"RTN","SAMIHOM4",1681,0)
 new saminame set saminame=$get(vars("name"))
"RTN","SAMIHOM4",1682,0)
 if saminame="" s saminame=$get(vars("saminame"))
"RTN","SAMIHOM4",1683,0)
 ;if $$VALDTNM(saminame,.ARGS)=-1 do  quit  ;
"RTN","SAMIHOM4",1684,0)
 ;. new r1
"RTN","SAMIHOM4",1685,0)
 ;. do GETHOME(.r1,.ARGS) ; home page to redisplay
"RTN","SAMIHOM4",1686,0)
 ;. merge RESULT=r1
"RTN","SAMIHOM4",1687,0)
 ;. quit
"RTN","SAMIHOM4",1688,0)
 ;
"RTN","SAMIHOM4",1689,0)
 new dfn s dfn=$get(vars("dfn"))
"RTN","SAMIHOM4",1690,0)
 ;if dfn="" do  quit  ;
"RTN","SAMIHOM4",1691,0)
 ;. new r1
"RTN","SAMIHOM4",1692,0)
 ;. do GETHOME(.r1,.ARGS) ; home page to redisplay
"RTN","SAMIHOM4",1693,0)
 ;. merge RESULT=r1
"RTN","SAMIHOM4",1694,0)
 ;. quit
"RTN","SAMIHOM4",1695,0)
 ;
"RTN","SAMIHOM4",1696,0)
 ; new gien set gien=$$NEXTNUM
"RTN","SAMIHOM4",1697,0)
 new gien set gien=dfn
"RTN","SAMIHOM4",1698,0)
 ;
"RTN","SAMIHOM4",1699,0)
 merge ^SAMIUL("newCase","G1")=root
"RTN","SAMIHOM4",1700,0)
 ; create dfn index
"RTN","SAMIHOM4",1701,0)
 set @root@("dfn",dfn,gien)=""
"RTN","SAMIHOM4",1702,0)
 ;
"RTN","SAMIHOM4",1703,0)
 set @root@(gien,"saminum")=gien
"RTN","SAMIHOM4",1704,0)
 set @root@(gien,"saminame")=saminame
"RTN","SAMIHOM4",1705,0)
 ;
"RTN","SAMIHOM4",1706,0)
 new studyid set studyid=$$GENSTDID^SAMIHOM3(gien,.SAMIARGS)
"RTN","SAMIHOM4",1707,0)
 set @root@(gien,"samistudyid")=studyid
"RTN","SAMIHOM4",1708,0)
 set @root@("sid",studyid,gien)=""
"RTN","SAMIHOM4",1709,0)
 ;
"RTN","SAMIHOM4",1710,0)
 new datekey set datekey=$$KEYDATE^SAMIHOM3($$NOW^XLFDT)
"RTN","SAMIHOM4",1711,0)
 set @root@(gien,"samicreatedate")=datekey
"RTN","SAMIHOM4",1712,0)
 ;
"RTN","SAMIHOM4",1713,0)
 merge ^SAMIUL("newCase",gien)=@root@(gien)
"RTN","SAMIHOM4",1714,0)
 ;
"RTN","SAMIHOM4",1715,0)
 ;
"RTN","SAMIHOM4",1716,0)
 do PREFILL^SAMIHOM3(dfn) ; prefills from the "patient-lookup" graph
"RTN","SAMIHOM4",1717,0)
 ;
"RTN","SAMIHOM4",1718,0)
 new siformkey
"RTN","SAMIHOM4",1719,0)
 ; do makeSbform(gien) ; create background form for new patient
"RTN","SAMIHOM4",1720,0)
 set siformkey=$$MKSIFORM^SAMIHOM3(gien) ; create intake for new patient
"RTN","SAMIHOM4",1721,0)
 ;
"RTN","SAMIHOM4",1722,0)
 set SAMIARGS("studyid")=studyid
"RTN","SAMIHOM4",1723,0)
 set SAMIARGS("form")="vapals:"_siformkey
"RTN","SAMIHOM4",1724,0)
 do wsGetForm^%wf(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",1725,0)
 ; do WSCASE^SAMICASE(.SAMIRESULT,.SAMIARGS) ; navigate to case review page
"RTN","SAMIHOM4",1726,0)
 ;
"RTN","SAMIHOM4",1727,0)
 ;
"RTN","SAMIHOM4",1728,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",1729,0)
 ;
"RTN","SAMIHOM4",1730,0)
 quit  ; end of wrs WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",1731,0)
 ;
"RTN","SAMIHOM4",1732,0)
 ;
"RTN","SAMIHOM4",1733,0)
 ;
"RTN","SAMIHOM4",1734,0)
EOR ; end of routine SAMIHOM4
"RTN","SAMIHUL")
0^7^B149598^B131888
"RTN","SAMIHUL",1,0)
SAMIHUL ;ven/gpl - home page log; 2024-09-10t00:12z
"RTN","SAMIHUL",2,0)
 ;;18.0;SAMI;**9,12,15,16,17,18**;2020-01-17;Build 1
"RTN","SAMIHUL",3,0)
 ;mdc-e1;SAMIHUL-20240910-E1fnWOL;SAMI-18-18-b1
"RTN","SAMIHUL",4,0)
 ;mdc-v7;B149598;SAMI*18.0*18 SEQ #18
"RTN","SAMIHUL",5,0)
 ;
"RTN","SAMIHUL",6,0)
 ; SAMIHOM3 contains subroutines for producing the ScreeningPlus Home
"RTN","SAMIHUL",7,0)
 ; Page. SAMIHOM4 contains more subroutines for the S+ Home Page.
"RTN","SAMIHUL",8,0)
 ; SAMIHUL contains the development log for the SAMIHOM* routines.
"RTN","SAMIHUL",9,0)
 ; It contains no executable code.
"RTN","SAMIHUL",10,0)
 ;
"RTN","SAMIHUL",11,0)
 quit  ; no entry from top
"RTN","SAMIHUL",12,0)
 ;
"RTN","SAMIHUL",13,0)
 ;
"RTN","SAMIHUL",14,0)
 ;
"RTN","SAMIHUL",15,0)
 ;
"RTN","SAMIHUL",16,0)
 ;@section 0 primary development
"RTN","SAMIHUL",17,0)
 ;
"RTN","SAMIHUL",18,0)
 ;
"RTN","SAMIHUL",19,0)
 ;
"RTN","SAMIHUL",20,0)
 ;
"RTN","SAMIHUL",21,0)
 ;@routine-credits
"RTN","SAMIHUL",22,0)
 ;
"RTN","SAMIHUL",23,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIHUL",24,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIHUL",25,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIHUL",26,0)
 ; http://vistaexpertise.net
"RTN","SAMIHUL",27,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIHUL",28,0)
 ;@license see routine SAMIUL
"RTN","SAMIHUL",29,0)
 ;
"RTN","SAMIHUL",30,0)
 ;@update 2024-09-10t00:12z
"RTN","SAMIHUL",31,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIHUL",32,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIHUL",33,0)
 ;@module Home Page - SAMIH
"RTN","SAMIHUL",34,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIHUL",35,0)
 ;@release 18-18
"RTN","SAMIHUL",36,0)
 ;@edition-date 2020-01-17
"RTN","SAMIHUL",37,0)
 ;@patches **9,12,15,16,17,18**
"RTN","SAMIHUL",38,0)
 ;
"RTN","SAMIHUL",39,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIHUL",40,0)
 ; toad@vistaexpertise.net
"RTN","SAMIHUL",41,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIHUL",42,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIHUL",43,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIHUL",44,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIHUL",45,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIHUL",46,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIHUL",47,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIHUL",48,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIHUL",49,0)
 ;@dev-add Domenick DiNatale (ddn)
"RTN","SAMIHUL",50,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMIHUL",51,0)
 ;
"RTN","SAMIHUL",52,0)
 ;@module-credits
"RTN","SAMIHUL",53,0)
 ;
"RTN","SAMIHUL",54,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIHUL",55,0)
 ; (VA-PALS)
"RTN","SAMIHUL",56,0)
 ; http://va-pals.org/
"RTN","SAMIHUL",57,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIHUL",58,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIHUL",59,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIHUL",60,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIHUL",61,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIHUL",62,0)
 ; http://ielcap.com/
"RTN","SAMIHUL",63,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIHUL",64,0)
 ; http://paraxialtech.com/
"RTN","SAMIHUL",65,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIHUL",66,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIHUL",67,0)
 ;
"RTN","SAMIHUL",68,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIHUL",69,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIHUL",70,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIHUL",71,0)
 ;@partner-org par
"RTN","SAMIHUL",72,0)
 ;
"RTN","SAMIHUL",73,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIHUL",74,0)
 ;
"RTN","SAMIHUL",75,0)
 ; 2018-01-13 ven/gpl 18-t4
"RTN","SAMIHUL",76,0)
 ;  SAMIHOM3 create routine from SAMIFRM to implement ELCAP Home Page.
"RTN","SAMIHUL",77,0)
 ;
"RTN","SAMIHUL",78,0)
 ; 2018-02-05 ven/toad 18-t4
"RTN","SAMIHUL",79,0)
 ;  SAMIHOM3 update license & attribution & hdr comments, add white
"RTN","SAMIHUL",80,0)
 ; space & do-dot quits, spell out language elements.
"RTN","SAMIHUL",81,0)
 ;
"RTN","SAMIHUL",82,0)
 ; 2018-02-27 ven/gpl 18-t4
"RTN","SAMIHUL",83,0)
 ;  SAMIHOM3 new subroutines PREFIX,GETHOME,SCANFOR,WSNEWCAS,PREFILL,
"RTN","SAMIHUL",84,0)
 ; MKSBFORM,MKSIFORM,VALDTNM,SID2NUM,KEYDATE,GENSTDID,NEXTNUM to
"RTN","SAMIHUL",85,0)
 ; support creation of new cases.
"RTN","SAMIHUL",86,0)
 ;
"RTN","SAMIHUL",87,0)
 ; 2018-03-01 ven/toad 18-t4
"RTN","SAMIHUL",88,0)
 ;  SAMIHOM3 refactor & reorganize new code, add hdr comments,
"RTN","SAMIHUL",89,0)
 ; r/findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMIHUL",90,0)
 ;
"RTN","SAMIHUL",91,0)
 ; 2018-03-06 ven/gpl 18-t4
"RTN","SAMIHUL",92,0)
 ;  SAMIHOM3 ?
"RTN","SAMIHUL",93,0)
 ;
"RTN","SAMIHUL",94,0)
 ; 2018-03-07 ven/toad 18-t4
"RTN","SAMIHUL",95,0)
 ;  SAMIHOM3 in $$SID2NUM add WSNUFORM^SAMICASE to called-by; in
"RTN","SAMIHUL",96,0)
 ; keyDate,GETHOME update called-by.
"RTN","SAMIHUL",97,0)
 ;
"RTN","SAMIHUL",98,0)
 ; 2018-05-18/25 ven/lgc&arc 18-t4 76020fd,81b1048,65afd99
"RTN","SAMIHUL",99,0)
 ;  SAMIHOM3 new SAMIHOM3 for new patient search page, chg submit
"RTN","SAMIHUL",100,0)
 ; processing on forms, fix bug in postform.
"RTN","SAMIHUL",101,0)
 ;
"RTN","SAMIHUL",102,0)
 ; 2018-06-14/07-10 ven/lgc&arc 18-t4 d71f4fe,8b0a432,ce345db,
"RTN","SAMIHUL",103,0)
 ; 402b6a8,14f991d,2e9662b
"RTN","SAMIHUL",104,0)
 ;  SAMIHOM3 make background form optional; 1st version of CT Eval
"RTN","SAMIHUL",105,0)
 ; Report; reorg ctreport routines & 1st crack at impressions &
"RTN","SAMIHUL",106,0)
 ; recommendations; note produced for intake form on submit; add
"RTN","SAMIHUL",107,0)
 ; support for routing by patient in CPRS Tools Menu, modify
"RTN","SAMIHUL",108,0)
 ; wsHOME^SAMIHOM3 to properly route VA-PALS web app when launced via
"RTN","SAMIHUL",109,0)
 ; CPRS Tools Menu; repair SAMIHOM3 & redact report link.
"RTN","SAMIHUL",110,0)
 ;
"RTN","SAMIHUL",111,0)
 ; 2018-08-22 ven/gpl 18-t4 6e696a9
"RTN","SAMIHUL",112,0)
 ;  SAMIHOM3 add PTINFO call to vista to pull ssn.
"RTN","SAMIHUL",113,0)
 ;
"RTN","SAMIHUL",114,0)
 ; 2018-09-30/11-01 ven/lgc&arc 18-t4 d93c640,482f522,a8e4226,
"RTN","SAMIHUL",115,0)
 ; ee5e8a1
"RTN","SAMIHUL",116,0)
 ;  SAMIHOM3 hdr & prefill of intake; new input form features, report
"RTN","SAMIHUL",117,0)
 ; menu fix; set urban/rural status at siform setup; handle zip code
"RTN","SAMIHUL",118,0)
 ; unknown.
"RTN","SAMIHUL",119,0)
 ;
"RTN","SAMIHUL",120,0)
 ; 2018-11-09/2019-01-22 ven/lgc&arc&lmry 18-t4 bac4f73,5400035,
"RTN","SAMIHUL",121,0)
 ; dd341e0,a953946,e2a44e6,2356c2b,3ceb74b,3088307,4271b46,7a5d340,
"RTN","SAMIHUL",122,0)
 ; dfbb0bc,fd1bcee,8dd6f34,51eb163,dbdb5a4,0880027,ccba017,5368121
"RTN","SAMIHUL",123,0)
 ;  SAMIHOM3 unit tests, annotation, sac compliance, XINDEX bugs, fix
"RTN","SAMIHUL",124,0)
 ; accidental reversions, add license info.
"RTN","SAMIHUL",125,0)
 ;
"RTN","SAMIHUL",126,0)
 ; 2018-12-18/20 ven/arc 18-t4 3088307f,4271b46b,dfbb0bca,
"RTN","SAMIHUL",127,0)
 ;  b8ff6da9,fd1bceee
"RTN","SAMIHUL",128,0)
 ;  SAMIHOM4 va sac compliance & variable namespacing.
"RTN","SAMIHUL",129,0)
 ;
"RTN","SAMIHUL",130,0)
 ; 2019-01-01/02-18 ven/lgc 18-t4 0880027c,18aa0fec,fcd635c1,
"RTN","SAMIHUL",131,0)
 ;  53681219,76874314
"RTN","SAMIHUL",132,0)
 ;  SAMIHOM3 update w/ recent changes.
"RTN","SAMIHUL",133,0)
 ;  SAMIHOM4 updates for va sac & code coverage, add license info.
"RTN","SAMIHUL",134,0)
 ;
"RTN","SAMIHUL",135,0)
 ; 2019-04-15 ven/gpl 18-t4 b403bf01
"RTN","SAMIHUL",136,0)
 ;  SAMIHOM4 support for new intake notes.
"RTN","SAMIHUL",137,0)
 ;
"RTN","SAMIHUL",138,0)
 ; 2019-04-16 ven/lgc 18-t4 e54b76d1
"RTN","SAMIHUL",139,0)
 ;  SAMIHOM4 update for SAMIFORM project.
"RTN","SAMIHUL",140,0)
 ;
"RTN","SAMIHUL",141,0)
 ; 2019-04-17 ven/gpl 18-t4 7d1f86db
"RTN","SAMIHUL",142,0)
 ;  SAMIHOM3 prefill date on intake prelim discussion section.
"RTN","SAMIHUL",143,0)
 ;
"RTN","SAMIHUL",144,0)
 ; 2019-06-18 ven/arc 18-t4 91022482
"RTN","SAMIHUL",145,0)
 ;  SAMIHOM4 switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMIHUL",146,0)
 ;
"RTN","SAMIHUL",147,0)
 ; 2019-08-05 ven/gpl 18-t4 9c0c2ed3
"RTN","SAMIHUL",148,0)
 ;  SAMIHOM3 add GETPRFX to get right prefix at registration.
"RTN","SAMIHUL",149,0)
 ;
"RTN","SAMIHUL",150,0)
 ; 2019-08-07 ven/lgc&arc 18-t4 603194b9,37967fc5
"RTN","SAMIHUL",151,0)
 ;  SAMIHOM3 consolidate calls to retrieve facility prefix.
"RTN","SAMIHUL",152,0)
 ;
"RTN","SAMIHUL",153,0)
 ; 2019-11-22 par/ddn 18-t4 b2cc389d vap-458
"RTN","SAMIHUL",154,0)
 ;  SAMIHOM4 manual registration.
"RTN","SAMIHUL",155,0)
 ;
"RTN","SAMIHUL",156,0)
 ; 2020-01-01/05 ven/lgc 18-t4 c169f4b1,5928064a,62e3200f
"RTN","SAMIHUL",157,0)
 ;  SAMIHOM4 support for unmatched patient processing, more changes
"RTN","SAMIHUL",158,0)
 ; for participant matching, unmatched participant processing ready
"RTN","SAMIHUL",159,0)
 ; for testing.
"RTN","SAMIHUL",160,0)
 ;
"RTN","SAMIHUL",161,0)
 ; 2020-01-08/10 ven/gpl 18 a002f850,47dfe3cd
"RTN","SAMIHUL",162,0)
 ;  SAMIHOM4 bug fix for unmatched processing, turn off & on manual
"RTN","SAMIHUL",163,0)
 ; registration link on home page.
"RTN","SAMIHUL",164,0)
 ;
"RTN","SAMIHUL",165,0)
 ; 2020-01-10 ven/gpl 18 4c8e6ebc,76b465cb
"RTN","SAMIHUL",166,0)
 ;  SAMIHOM4 3 quits with returns for cache.
"RTN","SAMIHUL",167,0)
 ;
"RTN","SAMIHUL",168,0)
 ; 2020-01-16 ven/lgc 18 0a2af965
"RTN","SAMIHUL",169,0)
 ;  SAMIHOM4 bulk commit due to switch to cache.
"RTN","SAMIHUL",170,0)
 ;
"RTN","SAMIHUL",171,0)
 ; 2020-01-17/20 ven/lgc 18-1 8557207f,dc5f618c
"RTN","SAMIHUL",172,0)
 ;  SAMIHOM4 followup note, limit to one note per followup form.
"RTN","SAMIHUL",173,0)
 ;
"RTN","SAMIHUL",174,0)
 ; 2020-02-01/02 ven/lgc 18-4 3065146d,36ae0ed1
"RTN","SAMIHUL",175,0)
 ;  SAMIHOM4 set options for text based ctreport, switch default
"RTN","SAMIHUL",176,0)
 ; ctreport to text.
"RTN","SAMIHUL",177,0)
 ;
"RTN","SAMIHUL",178,0)
 ; 2020-04-02/11 ven/gpl 18-5 d36b7cad,36607664,befde317,56bfaed6,
"RTN","SAMIHUL",179,0)
 ; 666f5b91,2f2c29c1
"RTN","SAMIHUL",180,0)
 ;  SAMIHOM3 multitenancy; in GENSTDID add ARG param, determin prefix
"RTN","SAMIHUL",181,0)
 ; from site or siteid (ARG) instead of calling $$GETPRFX^SAMIFORM.
"RTN","SAMIHUL",182,0)
 ;  SAMIHOM4 multitenancy + fix bug in WSVAPALS.
"RTN","SAMIHUL",183,0)
 ;
"RTN","SAMIHUL",184,0)
 ; 2020-04-18/05-07 ven/gpl 18-5 29d7dba7,d55de214,521e0bdc,d018f52e,
"RTN","SAMIHUL",185,0)
 ; 476b2ff4,61c7d208
"RTN","SAMIHUL",186,0)
 ;  SAMIHOM4 fix bug & weird error in manual registration, fix bug in
"RTN","SAMIHUL",187,0)
 ; logout, logout working, superuser site selection, worklist
"RTN","SAMIHUL",188,0)
 ; functionality.
"RTN","SAMIHUL",189,0)
 ;
"RTN","SAMIHUL",190,0)
 ; 2020-08-06 ven/gpl 18-6 781744c3
"RTN","SAMIHUL",191,0)
 ;  SAMIHOM4 changes to support hl7 transmission of notes.
"RTN","SAMIHUL",192,0)
 ;
"RTN","SAMIHUL",193,0)
 ; 2020-09-22 ven/gpl 18-9 06459eda
"RTN","SAMIHUL",194,0)
 ;  SAMIHOM4 correct to match kids file.
"RTN","SAMIHUL",195,0)
 ;
"RTN","SAMIHUL",196,0)
 ; 2021-03-02 ven/gpl 18-9 479dc041
"RTN","SAMIHUL",197,0)
 ;  SAMIHOM4 return error message if no ct eval form exists when
"RTN","SAMIHUL",198,0)
 ; generating a fu note.
"RTN","SAMIHUL",199,0)
 ;
"RTN","SAMIHUL",200,0)
 ; 2021-03-11 ven/toad 18-9 a46a2cc1
"RTN","SAMIHUL",201,0)
 ;  SAMIHUL create routine.
"RTN","SAMIHUL",202,0)
 ;  SAMIHOM4 bump date & patch list, add contents, lt refactor.
"RTN","SAMIHUL",203,0)
 ;
"RTN","SAMIHUL",204,0)
 ; 2021-03-17 ven/toad 18-9
"RTN","SAMIHUL",205,0)
 ;  SAMIHOM4 remove blank from end of 1 line.
"RTN","SAMIHUL",206,0)
 ;
"RTN","SAMIHUL",207,0)
 ; 2021-05-29 ven/gpl 18-12-t2 59ea0811
"RTN","SAMIHUL",208,0)
 ;  SAMIHOM3 in SID2NUM look up by pien instead of relying on sid
"RTN","SAMIHUL",209,0)
 ; containing pien.
"RTN","SAMIHUL",210,0)
 ;
"RTN","SAMIHUL",211,0)
 ; 2021-06-15 ven/gpl 18-12-t2 e247ea59
"RTN","SAMIHUL",212,0)
 ;  SAMIHOM4 eliminate icn.
"RTN","SAMIHUL",213,0)
 ;
"RTN","SAMIHUL",214,0)
 ; 2021-06-15/16 ven/mcglk&toad 18-12-t2 cbf7e46b,fa794d60
"RTN","SAMIHUL",215,0)
 ;  SAMIHOM3 move log to SAMIHUL, bump dates & versions, annotate,
"RTN","SAMIHUL",216,0)
 ; reorg, lt refactor.
"RTN","SAMIHUL",217,0)
 ;  SAMIHOM4 bump dates & versions; begin annotate, reorg, lt refactor
"RTN","SAMIHUL",218,0)
 ; but interrupted by addition of critical fix to patch & bronchitis,
"RTN","SAMIHUL",219,0)
 ; so leave refactor unfinished (but stable as far as it went).
"RTN","SAMIHUL",220,0)
 ;  SAMIUTH3 bump dates & versions, lt refactor, add COVER, in UTSCAN4
"RTN","SAMIHUL",221,0)
 ; fix $random bug, but after discovering the SAMI test suite is so
"RTN","SAMIHUL",222,0)
 ; far out of date that it fails catastrophically with thousands of
"RTN","SAMIHUL",223,0)
 ; errors, back out changes and leave as it was.
"RTN","SAMIHUL",224,0)
 ;
"RTN","SAMIHUL",225,0)
 ; 2021-08-01 ven/gpl 18-12 5bd7c627
"RTN","SAMIHUL",226,0)
 ;  SAMIHOM3 set intake form to incomplete on creation: in MKSIFORM
"RTN","SAMIHUL",227,0)
 ; r/complete w/incomplete.
"RTN","SAMIHUL",228,0)
 ;
"RTN","SAMIHUL",229,0)
 ; 2021-09-20/23 ven/gpl 18-16 db1b173a,465b009d
"RTN","SAMIHUL",230,0)
 ;  SAMIHOM4 (with new routine SAMIZPH1) developed to import data from 
"RTN","SAMIHUL",231,0)
 ;  Philadelphia VA's previous LCS database in Red Cap, bump dates & versions.
"RTN","SAMIHUL",232,0)
 ;
"RTN","SAMIHUL",233,0)
 ; 2021-9-24 ven/lmry 18-16 465b009d
"RTN","SAMIHUL",234,0)
 ;  SAMIHOM4 bumped versions and dates
"RTN","SAMIHUL",235,0)
 ;
"RTN","SAMIHUL",236,0)
 ; 2021-10-19 ven/gpl 18-15 138d45e5
"RTN","SAMIHUL",237,0)
 ;  SAMIHOM4 parameterize veteran vs participant or candidate for notes
"RTN","SAMIHUL",238,0)
 ;
"RTN","SAMIHUL",239,0)
 ; 2021-10-29 ven/lmry 18-15  4267917c
"RTN","SAMIHUL",240,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",241,0)
 ;
"RTN","SAMIHUL",242,0)
 ; 2021-11-01 ven/gpl 18-15  e4722e8f0
"RTN","SAMIHUL",243,0)
 ;  SAMIHOM4 prevent using SYS as a site
"RTN","SAMIHUL",244,0)
 ;
"RTN","SAMIHUL",245,0)
 ; 2021-11-09 ven/gpl 18-15 34367ef0
"RTN","SAMIHUL",246,0)
 ;  SAMIHOM4 change GETHOME to cut off GET requests
"RTN","SAMIHUL",247,0)
 ;
"RTN","SAMIHUL",248,0)
 ; 2021-11-10 ven/gpl 18-15 ed2a3480
"RTN","SAMIHUL",249,0)
 ;  SAMIHOM4 support for samiroute=about points to vapals:about
"RTN","SAMIHUL",250,0)
 ;
"RTN","SAMIHUL",251,0)
 ; 2021-11-18 ven/lmry 18-15 596ea463
"RTN","SAMIHUL",252,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",253,0)
 ;
"RTN","SAMIHUL",254,0)
 ; 2021-11-22 ven/gpl 18-16  d26d00a7
"RTN","SAMIHUL",255,0)
 ;  SAMIHOM4 patch 16 DCM functionality
"RTN","SAMIHUL",256,0)
 ;
"RTN","SAMIHUL",257,0)
 ; 2022-01-02 ven/gpl 18-16 45fa4633
"RTN","SAMIHUL",258,0)
 ;  SAMIHOM4 Nashville sample data processing
"RTN","SAMIHUL",259,0)
 ;
"RTN","SAMIHUL",260,0)
 ; 2022-01-12 ven/gpl 18-15  ea379b6b
"RTN","SAMIHUL",261,0)
 ;  SAMIHOM4 change calls to SAMIORU to use a parameterized site
"RTN","SAMIHUL",262,0)
 ;
"RTN","SAMIHUL",263,0)
 ; 2022-01-12 ven/lmry 18-15  bcef2106
"RTN","SAMIHUL",264,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",265,0)
 ;
"RTN","SAMIHUL",266,0)
 ; 2022-01-17 ven/lmry 18-16  e69ca23e
"RTN","SAMIHUL",267,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",268,0)
 ;
"RTN","SAMIHUL",269,0)
 ; 2022-04-04 ven/gpl 18-17   ec245b1e
"RTN","SAMIHUL",270,0)
 ;  SAMIHOM4 change logout to accomodate single signon
"RTN","SAMIHUL",271,0)
 ;
"RTN","SAMIHUL",272,0)
 ; 2022-04-04 ven/lmry 18-17  258bc926
"RTN","SAMIHUL",273,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",274,0)
 ;
"RTN","SAMIHUL",275,0)
 ; 2022-04-26 ven/gpl  18-17  89497ba8
"RTN","SAMIHUL",276,0)
 ;  SAMIHOM4 setup for logout redirect
"RTN","SAMIHUL",277,0)
 ;
"RTN","SAMIHUL",278,0)
 ; 2022-04-27 ven/lmry 18-17-b2
"RTN","SAMIHUL",279,0)
 ;  SAMIHOM4 and SAMIHUL bump dates.
"RTN","SAMIHUL",280,0)
 ;
"RTN","SAMIHUL",281,0)
 ; 2022-04-27 ven/lmry 18-17-b2 6b24f1f3
"RTN","SAMIHUL",282,0)
 ;  SAMIHOM4 (F1%x8M7 B985660773 EzYHzb)
"RTN","SAMIHUL",283,0)
 ; insert space for XINDEX.
"RTN","SAMIHUL",284,0)
 ;
"RTN","SAMIHUL",285,0)
 ; 2024-07-24 ven/gpl 18-17-b5 8d86b80a
"RTN","SAMIHUL",286,0)
 ;  SAMIHOM4 (F4%DW B991706712 E2zhzW+)
"RTN","SAMIHUL",287,0)
 ; copy simrn to the vapals-patient record after entry: in MKPTLK let
"RTN","SAMIHUL",288,0)
 ; ssn be optional, support optional simrn.
"RTN","SAMIHUL",289,0)
 ;
"RTN","SAMIHUL",290,0)
 ; 2024-08-12 ven/lmry 18-17-b5 eea98cdb
"RTN","SAMIHUL",291,0)
 ;  SAMIHOM4 (F65FvO B991706712 E2%gQq0)
"RTN","SAMIHUL",292,0)
 ; bump version + date.
"RTN","SAMIHUL",293,0)
 ;  SAMIHUL (F3Ls7qe B122244 E1FpY7)
"RTN","SAMIHUL",294,0)
 ; update log, bump version + date.
"RTN","SAMIHUL",295,0)
 ;
"RTN","SAMIHUL",296,0)
 ; 2024-08-16 ven/lmry 18-17-b6 a1a28de6
"RTN","SAMIHUL",297,0)
 ;  SAMIHOM4 (F57Ct8 B991706712 E2+iNl0)
"RTN","SAMIHUL",298,0)
 ; regress version + bump date.
"RTN","SAMIHUL",299,0)
 ;  SAMIHUL (FI8dBB B125686 E1yYBu7)
"RTN","SAMIHUL",300,0)
 ; update log, regress version + bump date.
"RTN","SAMIHUL",301,0)
 ;
"RTN","SAMIHUL",302,0)
 ; 2024-08-22 ven/toad 18-17-b6
"RTN","SAMIHUL",303,0)
 ; update version-control lines, bump dates.
"RTN","SAMIHUL",304,0)
 ;  SAMIHOM4 (F2uBYQN B1262443514 E3R7P91)
"RTN","SAMIHUL",305,0)
 ; passim: new version-control lines, bump vers + dates, id calls +
"RTN","SAMIHUL",306,0)
 ; tests, comment out debugging code, light refactoring.
"RTN","SAMIHUL",307,0)
 ;  SAMIHUL (F3+z2h3 B131888 E4wwex)
"RTN","SAMIHUL",308,0)
 ; update log.
"RTN","SAMIHUL",309,0)
 ;
"RTN","SAMIHUL",310,0)
 ; 2024-08-26 ven/toad 18-17-b8 bd5cfb4c
"RTN","SAMIHUL",311,0)
 ;  SAMIHOM4 (F2uBYQN B1262443514 E3R7P91)
"RTN","SAMIHUL",312,0)
 ;  SAMIHUL (FK%ycv B131888 EQzKao)
"RTN","SAMIHUL",313,0)
 ; Rick's revisions of the 14 routines + recipe file.
"RTN","SAMIHUL",314,0)
 ;
"RTN","SAMIHUL",315,0)
 ; 2024-08-26 ven/mcglk 18-17-b8 a5dae8e9 [in temp v18-17-b6-sinai]
"RTN","SAMIHUL",316,0)
 ;  SAMIHOM4 (F2uBYQN B1262443514 E3R7P91)
"RTN","SAMIHUL",317,0)
 ;  SAMIHUL (FK%ycv B131888 EQzKao)
"RTN","SAMIHUL",318,0)
 ; Import M routine fr/commit bd5cfb4c1d58. NOTE: This history will be
"RTN","SAMIHUL",319,0)
 ; lost.
"RTN","SAMIHUL",320,0)
 ;
"RTN","SAMIHUL",321,0)
 ; 2024-08-28 ven/gpl 18-18-b1 a2470ae1
"RTN","SAMIHUL",322,0)
 ;  SAMIHOM4 (F1S6Kk+ B1302087893 E1%2Enf)
"RTN","SAMIHUL",323,0)
 ; for 2nd build, add viewer to case review + file upload form: in
"RTN","SAMIHUL",324,0)
 ; WSVAPALS add route="fileupload" + route="newfileupload".
"RTN","SAMIHUL",325,0)
 ;
"RTN","SAMIHUL",326,0)
 ; 2024-09-01 ven/gpl 18-18-b1 5ed25cbc
"RTN","SAMIHUL",327,0)
 ;  SAMIHOM4 (FkRuwr B1313883304 E1HNXis)
"RTN","SAMIHUL",328,0)
 ; progress toward file upload feature: in WSVAPALS try out code to
"RTN","SAMIHUL",329,0)
 ; parse PDF, uncomment debugging code, for route="fileupload" comment
"RTN","SAMIHUL",330,0)
 ; out old code & call FILEUP^SAMICAS2, add route="viewfile".
"RTN","SAMIHUL",331,0)
 ;
"RTN","SAMIHUL",332,0)
 ; 2024-09-03 ven/gpl 18-18-b1 dc4e37b1
"RTN","SAMIHUL",333,0)
 ;  SAMIHOM4 (FaoAO8 B1313429300 E17js3k)
"RTN","SAMIHUL",334,0)
 ; remove some bugs fr/file upload: in WSVAPALS r/TOADPARSE w/MINIPARS
"RTN","SAMIHUL",335,0)
 ;
"RTN","SAMIHUL",336,0)
 ; 2024-09-04 ven/toad 18-17-b8 9a98cb08 [in temp v18-17-b6-sinai]
"RTN","SAMIHUL",337,0)
 ;  SAMIHOM4 (F2pDg%9 B1262443514 E3R7P91)
"RTN","SAMIHUL",338,0)
 ;  SAMIHUL (FpoHb5 B131888 EQzKao)
"RTN","SAMIHUL",339,0)
 ; bump ver + chksums.
"RTN","SAMIHUL",340,0)
 ;
"RTN","SAMIHUL",341,0)
 ; 2024-09-06 ven/gpl 18-18-b1 2bf5bb1a
"RTN","SAMIHUL",342,0)
 ;  SAMIHOM4 (F2dRlE9 B1408784186 E3ANQRl)
"RTN","SAMIHUL",343,0)
 ; changes to index, update mrn + pid: in WSVAPALS comment out
"RTN","SAMIHUL",344,0)
 ; m SAMIARG=SAMIBODY, in route="postform" & siform add big new block
"RTN","SAMIHUL",345,0)
 ; of lines to handle ids, mrns, etc.; in REINDXPL kill mrn & pid; in
"RTN","SAMIHUL",346,0)
 ; INDXPTLK set mrn & pid.
"RTN","SAMIHUL",347,0)
 ;
"RTN","SAMIHUL",348,0)
 ; 2024-09-06 ven/mcglk 18-17-b8 3b0b8664
"RTN","SAMIHUL",349,0)
 ;  SAMIHUL (FpoHb5 B131888 EQzKao)
"RTN","SAMIHUL",350,0)
 ; Pulling in modified routines from 18-17-b8.
"RTN","SAMIHUL",351,0)
 ;
"RTN","SAMIHUL",352,0)
 ; 2024-09-07 ven/gpl 18-18-b1 0645d7c8
"RTN","SAMIHUL",353,0)
 ;  SAMIHOM4 (Fun5dl B1418234614 E1RixqQ)
"RTN","SAMIHUL",354,0)
 ; fix mrn bugs: in WSVAPALS if postform & siform set emrn; in
"RTN","SAMIHUL",355,0)
 ; REINDXPL kill emrn; in INDXPTLK set emrn.
"RTN","SAMIHUL",356,0)
 ;
"RTN","SAMIHUL",357,0)
 ; 2024-09-08 ven/gpl 18-18-b1 e04caa1a
"RTN","SAMIHUL",358,0)
 ;  SAMIHOM4 (F1zY7a B1418397616 E2WTwhj)
"RTN","SAMIHUL",359,0)
 ; fix emrn processing bug: in WSVAPALS if postform & siform prepend
"RTN","SAMIHUL",360,0)
 ; "e" before emrn value.
"RTN","SAMIHUL",361,0)
 ;
"RTN","SAMIHUL",362,0)
 ; 2024-09-09 ven/toad 18-18-b1
"RTN","SAMIHUL",363,0)
 ;  SAMIHOM4 (FGNuW3 B1434661517 E3fWhBP)
"RTN","SAMIHUL",364,0)
 ; merge parallel work from SAMI-18-17-b8 + SAMI-18-18-b1: start w/
"RTN","SAMIHUL",365,0)
 ; SAMIHOM4-20240904-F2pDg%9 & apply gpl mods from 08-28,09-01,03,06,
"RTN","SAMIHUL",366,0)
 ; 07,08; slight refactoring, bump ver + date + chksums.
"RTN","SAMIHUL",367,0)
 ;  SAMIHUL (F??? B149598 E???)
"RTN","SAMIHUL",368,0)
 ; update log, add recent details, commit IDs, checksums.
"RTN","SAMIHUL",369,0)
 ;
"RTN","SAMIHUL",370,0)
 ;
"RTN","SAMIHUL",371,0)
 ;@contents
"RTN","SAMIHUL",372,0)
 ;
"RTN","SAMIHUL",373,0)
 ; SAMIHOM3 homepage interface library
"RTN","SAMIHUL",374,0)
 ; SAMIHOM4 homepage subroutines
"RTN","SAMIHUL",375,0)
 ; SAMIHUL homepage development log
"RTN","SAMIHUL",376,0)
 ; SAMIUTH3 tests for SAMIHOM3
"RTN","SAMIHUL",377,0)
 ; SAMIUTH4 tests for SAMIHOM4
"RTN","SAMIHUL",378,0)
 ;
"RTN","SAMIHUL",379,0)
 ;@to-do
"RTN","SAMIHUL",380,0)
 ;
"RTN","SAMIHUL",381,0)
 ; add details + checksums before SAMI-18-17-b6
"RTN","SAMIHUL",382,0)
 ;
"RTN","SAMIHUL",383,0)
 ;
"RTN","SAMIHUL",384,0)
 ;
"RTN","SAMIHUL",385,0)
EOR ; end of routine SAMIHUL
"RTN","SAMIMSH1")
0^8^B9513892
"RTN","SAMIMSH1",1,0)
SAMIMSH1 ;ven/gpl - INTEROP with Mt. Sinai; 2021-09-12t02:48z
"RTN","SAMIMSH1",2,0)
 ;;18.0;SAMI;**18**;2020-01-17;Build 1
"RTN","SAMIMSH1",3,0)
 ;mdc-e1;SAMIMSH1-20240912-E2pvGJ8;SAMI-18-18-b1
"RTN","SAMIMSH1",4,0)
 ;mdc-v7;B9513892;SAMI*18.0*18 SEQ #18
"RTN","SAMIMSH1",5,0)
 ;
"RTN","SAMIMSH1",6,0)
 ; SAMIMSH1 contains services to support interoperability at Mt. Sinai for
"RTN","SAMIMSH1",7,0)
 ; ScreeningPlus
"RTN","SAMIMSH1",8,0)
 ; 
"RTN","SAMIMSH1",9,0)
 ;
"RTN","SAMIMSH1",10,0)
 quit  ; no entry from top
"RTN","SAMIMSH1",11,0)
 ;
"RTN","SAMIMSH1",12,0)
 ;
"RTN","SAMIMSH1",13,0)
 ;
"RTN","SAMIMSH1",14,0)
 ;@section 0 primary development
"RTN","SAMIMSH1",15,0)
 ;
"RTN","SAMIMSH1",16,0)
 ;
"RTN","SAMIMSH1",17,0)
 ;
"RTN","SAMIMSH1",18,0)
 ;
"RTN","SAMIMSH1",19,0)
 ;@routine-credits
"RTN","SAMIMSH1",20,0)
 ;
"RTN","SAMIMSH1",21,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIMSH1",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIMSH1",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIMSH1",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIMSH1",25,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIMSH1",26,0)
 ;@license see routine SAMIUL
"RTN","SAMIMSH1",27,0)
 ;
"RTN","SAMIMSH1",28,0)
 ;@update 2024-09-12t02:48z
"RTN","SAMIMSH1",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIMSH1",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIMSH1",31,0)
 ;@module import/export - SAMIDCM
"RTN","SAMIMSH1",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIMSH1",33,0)
 ;@release 18-18
"RTN","SAMIMSH1",34,0)
 ;@edition-date 2020-01-17
"RTN","SAMIMSH1",35,0)
 ;@patches **18**
"RTN","SAMIMSH1",36,0)
 ;
"RTN","SAMIMSH1",37,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIMSH1",38,0)
 ; toad@vistaexpertise.net
"RTN","SAMIMSH1",39,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIMSH1",40,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIMSH1",41,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIMSH1",42,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIMSH1",43,0)
 ;
"RTN","SAMIMSH1",44,0)
 ;
"RTN","SAMIMSH1",45,0)
 ;@module-credits
"RTN","SAMIMSH1",46,0)
 ;
"RTN","SAMIMSH1",47,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIMSH1",48,0)
 ; (VA-PALS)
"RTN","SAMIMSH1",49,0)
 ; http://va-pals.org/
"RTN","SAMIMSH1",50,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIMSH1",51,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIMSH1",52,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIMSH1",53,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIMSH1",54,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIMSH1",55,0)
 ; http://ielcap.com/
"RTN","SAMIMSH1",56,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIMSH1",57,0)
 ; http://paraxialtech.com/
"RTN","SAMIMSH1",58,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIMSH1",59,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIMSH1",60,0)
 ;
"RTN","SAMIMSH1",61,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIMSH1",62,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIMSH1",63,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIMSH1",64,0)
 ;@partner-org par
"RTN","SAMIMSH1",65,0)
 ;
"RTN","SAMIMSH1",66,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIMSH1",67,0)
 ;
"RTN","SAMIMSH1",68,0)
 ; 2024-09-06 ven/gpl 18-18-b1 2bf5bb1a
"RTN","SAMIMSH1",69,0)
 ;  SAMIMSH1 (F1Z17Tl B57146 E2V9xAb)
"RTN","SAMIMSH1",70,0)
 ; new rtn w/wsMSHSCH,test,SCHURL; changes to index + update MRN &
"RTN","SAMIMSH1",71,0)
 ; PID.
"RTN","SAMIMSH1",72,0)
 ;
"RTN","SAMIMSH1",73,0)
 ; 2024-09-10 ven/lmry 18-18-b1
"RTN","SAMIMSH1",74,0)
 ;  SAMIMSH1 (F2dPkFY B60916 E3GuRUs) 3671229c
"RTN","SAMIMSH1",75,0)
 ;  SAMIMSH1 (F1ajCtc B60916 E2EBw5l) a066c4fb
"RTN","SAMIMSH1",76,0)
 ;  SAMIMSH1 (Fn+mSO B4947839 E3IAA15) 98bc2f20
"RTN","SAMIMSH1",77,0)
 ;  SAMIMSH1 (F2kPtfh B4984170 EHNST3) 77855d6f
"RTN","SAMIMSH1",78,0)
 ; add routine & module credits, chksums, bump date, patches,
"RTN","SAMIMSH1",79,0)
 ; module log.
"RTN","SAMIMSH1",80,0)
 ;
"RTN","SAMIMSH1",81,0)
 ; 2024-09-10 ven/toad 18-18-b1
"RTN","SAMIMSH1",82,0)
 ;  SAMIMSH1 (F??? B5638128 E???)
"RTN","SAMIMSH1",83,0)
 ; fix chksums, add chksums to log, add contents, bump date.
"RTN","SAMIMSH1",84,0)
 ;
"RTN","SAMIMSH1",85,0)
 ;@contents
"RTN","SAMIMSH1",86,0)
 ;
"RTN","SAMIMSH1",87,0)
 ; wsMSHSCH
"RTN","SAMIMSH1",88,0)
 ; test
"RTN","SAMIMSH1",89,0)
 ; SCHURL
"RTN","SAMIMSH1",90,0)
 ;
"RTN","SAMIMSH1",91,0)
 ;
"RTN","SAMIMSH1",92,0)
 ;
"RTN","SAMIMSH1",93,0)
 ;
"RTN","SAMIMSH1",94,0)
wsMSHSCH(RTN,FILTER) ;
"RTN","SAMIMSH1",95,0)
 ;
"RTN","SAMIMSH1",96,0)
 ;example items array
"RTN","SAMIMSH1",97,0)
 ;g("ceform-2018-12-11")=""
"RTN","SAMIMSH1",98,0)
 ;g("fuform-2018-12-11")=""
"RTN","SAMIMSH1",99,0)
 ;g("itform-2018-12-11")=""
"RTN","SAMIMSH1",100,0)
 ;g("siform-2018-12-11")=""
"RTN","SAMIMSH1",101,0)
 ;g("sort",3181211,"vapals:ceform","ceform-2018-12-11","CT Evaluation")=""
"RTN","SAMIMSH1",102,0)
 ;g("sort",3181211,"vapals:fuform","fuform-2018-12-11","Follow-up")=""
"RTN","SAMIMSH1",103,0)
 ;g("sort",3181211,"vapals:itform","itform-2018-12-11","Intervention")=""
"RTN","SAMIMSH1",104,0)
 ;g("type","vapals:ceform","ceform-2018-12-11","CT Evaluation")=""
"RTN","SAMIMSH1",105,0)
 ;g("type","vapals:fuform","fuform-2018-12-11","Follow-up")=""
"RTN","SAMIMSH1",106,0)
 ;g("type","vapals:itform","itform-2018-12-11","Intervention")=""
"RTN","SAMIMSH1",107,0)
 ;
"RTN","SAMIMSH1",108,0)
 ; From the intake form, we need the following fields:
"RTN","SAMIMSH1",109,0)
 ;
"RTN","SAMIMSH1",110,0)
 ;siadcom
"RTN","SAMIMSH1",111,0)
 ;sicu54
"RTN","SAMIMSH1",112,0)
 ;simdn
"RTN","SAMIMSH1",113,0)
 ;simdp
"RTN","SAMIMSH1",114,0)
 ;simdpid
"RTN","SAMIMSH1",115,0)
 ;simrn
"RTN","SAMIMSH1",116,0)
 ;sinamef
"RTN","SAMIMSH1",117,0)
 ;sinamel
"RTN","SAMIMSH1",118,0)
 ;siph
"RTN","SAMIMSH1",119,0)
 ;sirs
"RTN","SAMIMSH1",120,0)
 ;
"RTN","SAMIMSH1",121,0)
 ;sisao
"RTN","SAMIMSH1",122,0)
 ;
"RTN","SAMIMSH1",123,0)
 ;sisid
"RTN","SAMIMSH1",124,0)
 ;
"RTN","SAMIMSH1",125,0)
 ;sisloc
"RTN","SAMIMSH1",126,0)
 ;
"RTN","SAMIMSH1",127,0)
 ;sivip, sisa
"RTN","SAMIMSH1",128,0)
 n sid s sid=$g(FILTER("sid"))
"RTN","SAMIMSH1",129,0)
 q:sid=""
"RTN","SAMIMSH1",130,0)
 n items
"RTN","SAMIMSH1",131,0)
 d GETITEMS^SAMICASE("items",sid)
"RTN","SAMIMSH1",132,0)
 q:'$d(items)
"RTN","SAMIMSH1",133,0)
 ;
"RTN","SAMIMSH1",134,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIMSH1",135,0)
 n siform,ceform
"RTN","SAMIMSH1",136,0)
 s siform=$o(items("si"))
"RTN","SAMIMSH1",137,0)
 q:siform=""
"RTN","SAMIMSH1",138,0)
 n gn s gn=$na(@root@("graph",sid,siform))
"RTN","SAMIMSH1",139,0)
 q:'$d(@gn)
"RTN","SAMIMSH1",140,0)
 ;M X=@gn
"RTN","SAMIMSH1",141,0)
 ;zwr X
"RTN","SAMIMSH1",142,0)
 ;b
"RTN","SAMIMSH1",143,0)
 ;S RTN="success"
"RTN","SAMIMSH1",144,0)
 n ary
"RTN","SAMIMSH1",145,0)
 m ary(sid,siform)=@gn
"RTN","SAMIMSH1",146,0)
 ;
"RTN","SAMIMSH1",147,0)
 n ceform
"RTN","SAMIMSH1",148,0)
 s ceform=$o(items("ce"))
"RTN","SAMIMSH1",149,0)
 q:ceform=""
"RTN","SAMIMSH1",150,0)
 n gn2 s gn2=$na(@root@("graph",sid,ceform))
"RTN","SAMIMSH1",151,0)
 q:'$d(@gn2)
"RTN","SAMIMSH1",152,0)
 m ary(sid,ceform)=@gn2
"RTN","SAMIMSH1",153,0)
 ;
"RTN","SAMIMSH1",154,0)
 ;
"RTN","SAMIMSH1",155,0)
 ;
"RTN","SAMIMSH1",156,0)
 d ENCODE^XLFJSON("ary","RTN")
"RTN","SAMIMSH1",157,0)
 Q
"RTN","SAMIMSH1",158,0)
 ;
"RTN","SAMIMSH1",159,0)
 ;
"RTN","SAMIMSH1",160,0)
 ;
"RTN","SAMIMSH1",161,0)
 ;
"RTN","SAMIMSH1",162,0)
test() ;
"RTN","SAMIMSH1",163,0)
 s filter("sid")="XXX00217"
"RTN","SAMIMSH1",164,0)
 d wsMSHSCH^SAMIMSH1(.result,.filter)
"RTN","SAMIMSH1",165,0)
 q
"RTN","SAMIMSH1",166,0)
 ;
"RTN","SAMIMSH1",167,0)
 ;
"RTN","SAMIMSH1",168,0)
 ;
"RTN","SAMIMSH1",169,0)
 ;
"RTN","SAMIMSH1",170,0)
 ;From the CT eval form, we need:
"RTN","SAMIMSH1",171,0)
 ;
"RTN","SAMIMSH1",172,0)
 ;cerads
"RTN","SAMIMSH1",173,0)
 ;
"RTN","SAMIMSH1",174,0)
 ;cefu
"RTN","SAMIMSH1",175,0)
 ;
"RTN","SAMIMSH1",176,0)
 ;cefuw
"RTN","SAMIMSH1",177,0)
 ;
"RTN","SAMIMSH1",178,0)
 ;cefud
"RTN","SAMIMSH1",179,0)
SCHURL() ;
"RTN","SAMIMSH1",180,0)
 ;
"RTN","SAMIMSH1",181,0)
 N SITE
"RTN","SAMIMSH1",182,0)
 S SITE=$$PICSITE^SAMIMOV
"RTN","SAMIMSH1",183,0)
 Q:SITE=""
"RTN","SAMIMSH1",184,0)
 S PARMTXT="SchedulingURL"
"RTN","SAMIMSH1",185,0)
 ;
"RTN","SAMIMSH1",186,0)
 n DIR set DIR(0)="F^1:230" ; free text
"RTN","SAMIMSH1",187,0)
 set DIR("A")="SchedulingURL" ; prompt
"RTN","SAMIMSH1",188,0)
 set DIR("B")="""" ; default
"RTN","SAMIMSH1",189,0)
 ;
"RTN","SAMIMSH1",190,0)
 d ^DIR
"RTN","SAMIMSH1",191,0)
 ;
"RTN","SAMIMSH1",192,0)
 W !,Y
"RTN","SAMIMSH1",193,0)
 Q
"RTN","SAMIMSH1",194,0)
 ;
"RTN","SAMIMSH1",195,0)
 ;
"RTN","SAMIMSH1",196,0)
 ;
"RTN","SAMIMSH1",197,0)
EOR ; end of routine SAMIMSH1
"RTN","SAMIPAT")
0^9^B17504242^B17344032
"RTN","SAMIPAT",1,0)
SAMIPAT ;ven/toad - post subroutines; 2024-09-10t04:27z
"RTN","SAMIPAT",2,0)
 ;;18.0;SAMI;**12,14,15,17,18**;2020-01-17;Build 1
"RTN","SAMIPAT",3,0)
 ;mdc-e1;SAMIPAT-20240910-E3msvWY;SAMI-18-18-b1
"RTN","SAMIPAT",4,0)
 ;mdc-v7;B17504242;SAMI*18.0*18 SEQ #18
"RTN","SAMIPAT",5,0)
 ;
"RTN","SAMIPAT",6,0)
 ; Routine SAMIPAT contains ScreeningPlus initialization subroutines
"RTN","SAMIPAT",7,0)
 ; to use as KIDS pre- & post-installs & environment checks.
"RTN","SAMIPAT",8,0)
 ;
"RTN","SAMIPAT",9,0)
 quit  ; no entry from top
"RTN","SAMIPAT",10,0)
 ;
"RTN","SAMIPAT",11,0)
 ;
"RTN","SAMIPAT",12,0)
 ;
"RTN","SAMIPAT",13,0)
 ;
"RTN","SAMIPAT",14,0)
 ;@section 0 primary development
"RTN","SAMIPAT",15,0)
 ;
"RTN","SAMIPAT",16,0)
 ;
"RTN","SAMIPAT",17,0)
 ;
"RTN","SAMIPAT",18,0)
 ;
"RTN","SAMIPAT",19,0)
 ;@routine-credits
"RTN","SAMIPAT",20,0)
 ;
"RTN","SAMIPAT",21,0)
 ;@dev Frederick D. S. Marshall (toad)
"RTN","SAMIPAT",22,0)
 ; toad@vistaexpertise.net
"RTN","SAMIPAT",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIPAT",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIPAT",25,0)
 ;@copyright 2024, toad, all rights reserved
"RTN","SAMIPAT",26,0)
 ;@license see routine SAMIUL
"RTN","SAMIPAT",27,0)
 ;
"RTN","SAMIPAT",28,0)
 ;@update 2024-09-10t04:27z
"RTN","SAMIPAT",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIPAT",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIPAT",31,0)
 ;@module Inits (patching) - SAMIPA
"RTN","SAMIPAT",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIPAT",33,0)
 ;@release 18-18
"RTN","SAMIPAT",34,0)
 ;@edition-date 2020-01-17
"RTN","SAMIPAT",35,0)
 ;@patches **12,14,15,17,18**
"RTN","SAMIPAT",36,0)
 ;
"RTN","SAMIPAT",37,0)
 ;@dev-add George P. Lilly (gpl)
"RTN","SAMIPAT",38,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIPAT",39,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIPAT",40,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIPAT",41,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIPAT",42,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIPAT",43,0)
 ;
"RTN","SAMIPAT",44,0)
 ;@module-credits
"RTN","SAMIPAT",45,0)
 ;
"RTN","SAMIPAT",46,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIPAT",47,0)
 ; (VA-PALS)
"RTN","SAMIPAT",48,0)
 ; http://va-pals.org/
"RTN","SAMIPAT",49,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIPAT",50,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIPAT",51,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIPAT",52,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIPAT",53,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIPAT",54,0)
 ; http://ielcap.com/
"RTN","SAMIPAT",55,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIPAT",56,0)
 ; http://paraxialtech.com/
"RTN","SAMIPAT",57,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIPAT",58,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIPAT",59,0)
 ;
"RTN","SAMIPAT",60,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIPAT",61,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIPAT",62,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIPAT",63,0)
 ;@partner-org par
"RTN","SAMIPAT",64,0)
 ;
"RTN","SAMIPAT",65,0)
 ;
"RTN","SAMIPAT",66,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIPAT",67,0)
 ;
"RTN","SAMIPAT",68,0)
 ; 2021-07-01 ven/mcglk&toad 18-12-t2 cbf7e46b
"RTN","SAMIPAT",69,0)
 ;  SAMIPAT new routine, new POS1812.
"RTN","SAMIPAT",70,0)
 ;
"RTN","SAMIPAT",71,0)
 ; 2021-07-22/23 ven/toad 18-12 
"RTN","SAMIPAT",72,0)
 ;  SAMIPAT add PRE1812 pre-install.
"RTN","SAMIPAT",73,0)
 ;
"RTN","SAMIPAT",74,0)
 ; 2021-08-11 ven/mcglk&toad 18-12  b16cd38f
"RTN","SAMIPAT",75,0)
 ;  SAMIPAT rip out PRE1812.
"RTN","SAMIPAT",76,0)
 ;
"RTN","SAMIPAT",77,0)
 ; 2021-09-08 ven/lmry 18-14 2af1f2e7
"RTN","SAMIPAT",78,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",79,0)
 ;
"RTN","SAMIPAT",80,0)
 ; 2021-10-28 ven/lmry 18-15 0b585061
"RTN","SAMIPAT",81,0)
 ;  SAMIPAT create STANDARD sub w/post-install commands used for
"RTN","SAMIPAT",82,0)
 ; almost all patches; chg POS1814 to use STANDARD, add POS1815.
"RTN","SAMIPAT",83,0)
 ;
"RTN","SAMIPAT",84,0)
 ; 2021-10-29 ven/lmry 18-15 6e9594e8
"RTN","SAMIPAT",85,0)
 ;  SAMIPAT remove space before STANDARD.
"RTN","SAMIPAT",86,0)
 ;
"RTN","SAMIPAT",87,0)
 ; 2021-11-14 ven/lmry 18-15-t2 3a30fe59
"RTN","SAMIPAT",88,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",89,0)
 ;
"RTN","SAMIPAT",90,0)
 ; 2021-11-18 ven/lmry 18-15 4d71eef7
"RTN","SAMIPAT",91,0)
 ;  SAMIPAT fix for XINDEX.
"RTN","SAMIPAT",92,0)
 ;
"RTN","SAMIPAT",93,0)
 ; 2021-12-07 ven/lmry 18-15 75a19c5c
"RTN","SAMIPAT",94,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",95,0)
 ;
"RTN","SAMIPAT",96,0)
 ; 2022-04-04 ven/lmry 18-17-t1 258bc926
"RTN","SAMIPAT",97,0)
 ;  SAMIPAT add POS1817.
"RTN","SAMIPAT",98,0)
 ;
"RTN","SAMIPAT",99,0)
 ; 2022-04-27 ven/lmry 18-17-t2 03b87fe
"RTN","SAMIPAT",100,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",101,0)
 ;
"RTN","SAMIPAT",102,0)
 ; 2022-12-13 ven/lmry 18-17-t3 1ebd6e6
"RTN","SAMIPAT",103,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",104,0)
 ;
"RTN","SAMIPAT",105,0)
 ; 2022-12-28 ven/lmry 18-17-t4 956e2716
"RTN","SAMIPAT",106,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",107,0)
 ;
"RTN","SAMIPAT",108,0)
 ; 2024-08-12 ven/lmry 18-17-b5 eea98cd
"RTN","SAMIPAT",109,0)
 ;  SAMIPAT add POS1818.
"RTN","SAMIPAT",110,0)
 ;
"RTN","SAMIPAT",111,0)
 ; 2024-08-16 ven/lmry 18-17-b6  a1a28de  d0224d9
"RTN","SAMIPAT",112,0)
 ;  SAMIPAT update POS1817.
"RTN","SAMIPAT",113,0)
 ;
"RTN","SAMIPAT",114,0)
 ; 2024-08-26 ven/toad 18-17-b6  bd5cfb4
"RTN","SAMIPAT",115,0)
 ;  SAMIPAT update history, version-control lines, hdr comments.
"RTN","SAMIPAT",116,0)
 ;
"RTN","SAMIPAT",117,0)
 ; 2024-08-30 ven/lmry 18-17-b6
"RTN","SAMIPAT",118,0)
 ;  SAMIPAT updated path for SAMIDIR under STANDARD, change update date,
"RTN","SAMIPAT",119,0)
 ;   also changed routine description to post routines instead of init
"RTN","SAMIPAT",120,0)
 ;   routines.
"RTN","SAMIPAT",121,0)
 ;
"RTN","SAMIPAT",122,0)
 ; 2024-09-10 ven/lmry 18-18-b1
"RTN","SAMIPAT",123,0)
 ;  SAMIPAT update date/times, checksums, patches
"RTN","SAMIPAT",124,0)
 ;
"RTN","SAMIPAT",125,0)
 ;@contents
"RTN","SAMIPAT",126,0)
 ;
"RTN","SAMIPAT",127,0)
 ; STANDARD usual post-install commands
"RTN","SAMIPAT",128,0)
 ; POS1812 kids post-install for SAMI-18-12
"RTN","SAMIPAT",129,0)
 ; POS1814 kids post-install for SAMI-18-14
"RTN","SAMIPAT",130,0)
 ; POS1815 kids post-install for SAMI-18-15
"RTN","SAMIPAT",131,0)
 ; POS1817 kids post-install for SAMI-18-17
"RTN","SAMIPAT",132,0)
 ; POS1818 kids post-install for SAMI-18-18
"RTN","SAMIPAT",133,0)
 ;
"RTN","SAMIPAT",134,0)
 ;
"RTN","SAMIPAT",135,0)
 ;
"RTN","SAMIPAT",136,0)
 ;
"RTN","SAMIPAT",137,0)
 ;@section 1 subroutine for most patches
"RTN","SAMIPAT",138,0)
 ;
"RTN","SAMIPAT",139,0)
 ;
"RTN","SAMIPAT",140,0)
 ;
"RTN","SAMIPAT",141,0)
 ;
"RTN","SAMIPAT",142,0)
STANDARD ; usual post-install commands
"RTN","SAMIPAT",143,0)
 ;
"RTN","SAMIPAT",144,0)
 set SAMIDIR="/home/osehra/lib/silver/a-sami-vapals-elcap--vv-paraxtech-github/docs/form-fields/"
"RTN","SAMIPAT",145,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"background.tsv","form fields - background")
"RTN","SAMIPAT",146,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"biopsy.tsv","form fields - biopsy")
"RTN","SAMIPAT",147,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"ct-evaluation.tsv","form fields - ct evaluation")
"RTN","SAMIPAT",148,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"follow-up.tsv","form fields - follow up")
"RTN","SAMIPAT",149,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"intake.tsv","form fields - intake")
"RTN","SAMIPAT",150,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"intervention.tsv","form fields - intervention")
"RTN","SAMIPAT",151,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"pet-evaluation.tsv","form fields - pet evaluation")
"RTN","SAMIPAT",152,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"register.tsv","form fields - register")
"RTN","SAMIPAT",153,0)
 do DODD^SAMIADMN(SAMIDIR) ; to import tsv files to generate DD graphs
"RTN","SAMIPAT",154,0)
 do CLRWEB^SAMIADMN ; Clear the M Web Server files cache
"RTN","SAMIPAT",155,0)
 do INIT2GPH^SAMICTD2 ; initialize CTEVAL dictionary into graph cteval-dict
"RTN","SAMIPAT",156,0)
 ;
"RTN","SAMIPAT",157,0)
 ;
"RTN","SAMIPAT",158,0)
 ;
"RTN","SAMIPAT",159,0)
 ;
"RTN","SAMIPAT",160,0)
 ;@section 2 subroutines for SAMI-18-12
"RTN","SAMIPAT",161,0)
 ;
"RTN","SAMIPAT",162,0)
 ;
"RTN","SAMIPAT",163,0)
 ;
"RTN","SAMIPAT",164,0)
 ;
"RTN","SAMIPAT",165,0)
 ;@kids-post POST1812^SAMIPAT
"RTN","SAMIPAT",166,0)
 ;
"RTN","SAMIPAT",167,0)
POS1812 ; kids post-install for SAMI-18-12
"RTN","SAMIPAT",168,0)
 ;
"RTN","SAMIPAT",169,0)
 do ADDSVC^SAMIPARM ; install get params web service
"RTN","SAMIPAT",170,0)
 ;
"RTN","SAMIPAT",171,0)
 ; in honor of Tchaikovsky's overture: boom
"RTN","SAMIPAT",172,0)
 ;
"RTN","SAMIPAT",173,0)
 quit  ; end of kids-post POS1812^SAMIPAT
"RTN","SAMIPAT",174,0)
 ;
"RTN","SAMIPAT",175,0)
 ;
"RTN","SAMIPAT",176,0)
 ;
"RTN","SAMIPAT",177,0)
 ;
"RTN","SAMIPAT",178,0)
 ;@section 3 subroutines for SAMI-18-14
"RTN","SAMIPAT",179,0)
 ;
"RTN","SAMIPAT",180,0)
 ;
"RTN","SAMIPAT",181,0)
 ;
"RTN","SAMIPAT",182,0)
 ;
"RTN","SAMIPAT",183,0)
 ;@kids-post POST1814^SAMIPAT
"RTN","SAMIPAT",184,0)
 ;
"RTN","SAMIPAT",185,0)
POS1814 ; kids post-install for SAMI-18-14
"RTN","SAMIPAT",186,0)
 ;
"RTN","SAMIPAT",187,0)
 do STANDARD
"RTN","SAMIPAT",188,0)
 ;
"RTN","SAMIPAT",189,0)
 quit  ; end of kids-post POS1814^SAMIPAT
"RTN","SAMIPAT",190,0)
 ;
"RTN","SAMIPAT",191,0)
 ;
"RTN","SAMIPAT",192,0)
 ;
"RTN","SAMIPAT",193,0)
 ;
"RTN","SAMIPAT",194,0)
 ;@section 4 subroutines for SAMI-18-15
"RTN","SAMIPAT",195,0)
 ;
"RTN","SAMIPAT",196,0)
 ;
"RTN","SAMIPAT",197,0)
 ;
"RTN","SAMIPAT",198,0)
 ;
"RTN","SAMIPAT",199,0)
 ;@kids-post POST1815^SAMIPAT
"RTN","SAMIPAT",200,0)
 ;
"RTN","SAMIPAT",201,0)
POS1815 ; kids post-install for SAMI-18-15
"RTN","SAMIPAT",202,0)
 ;
"RTN","SAMIPAT",203,0)
 do STANDARD
"RTN","SAMIPAT",204,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-15")
"RTN","SAMIPAT",205,0)
 do deleteService^%webutils("GET","vapals")
"RTN","SAMIPAT",206,0)
 do addService^%webutils("GET","vapals","GETHOME^SAMIHOM3")
"RTN","SAMIPAT",207,0)
 do SETMAP^SAMIPARM("vapals:about","about.html")
"RTN","SAMIPAT",208,0)
 ;
"RTN","SAMIPAT",209,0)
 quit  ; end of kids-post POS1815^SAMIPAT
"RTN","SAMIPAT",210,0)
 ;
"RTN","SAMIPAT",211,0)
 ;
"RTN","SAMIPAT",212,0)
 ;
"RTN","SAMIPAT",213,0)
 ;
"RTN","SAMIPAT",214,0)
 ;@section 5 subroutines for SAMI-18-17
"RTN","SAMIPAT",215,0)
 ;
"RTN","SAMIPAT",216,0)
 ;
"RTN","SAMIPAT",217,0)
 ;
"RTN","SAMIPAT",218,0)
 ;
"RTN","SAMIPAT",219,0)
 ;@kids-post POST1817^SAMIPAT
"RTN","SAMIPAT",220,0)
 ;
"RTN","SAMIPAT",221,0)
POS1817 ; kids post-install for SAMI-18-17
"RTN","SAMIPAT",222,0)
 ;
"RTN","SAMIPAT",223,0)
 do STANDARD
"RTN","SAMIPAT",224,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-17-b8")
"RTN","SAMIPAT",225,0)
 ;
"RTN","SAMIPAT",226,0)
 quit  ; end of kids-post POS1817^SAMIPAT
"RTN","SAMIPAT",227,0)
 ;
"RTN","SAMIPAT",228,0)
 ;
"RTN","SAMIPAT",229,0)
 ;
"RTN","SAMIPAT",230,0)
 ;
"RTN","SAMIPAT",231,0)
 ;@section 6 subroutines for SAMI-18-18
"RTN","SAMIPAT",232,0)
 ;
"RTN","SAMIPAT",233,0)
 ;
"RTN","SAMIPAT",234,0)
 ;
"RTN","SAMIPAT",235,0)
 ;
"RTN","SAMIPAT",236,0)
 ;@kids-post POST1818^SAMIPAT
"RTN","SAMIPAT",237,0)
 ;
"RTN","SAMIPAT",238,0)
POS1818 ; kids post-install for SAMI-18-18
"RTN","SAMIPAT",239,0)
 ;
"RTN","SAMIPAT",240,0)
 do STANDARD
"RTN","SAMIPAT",241,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-18-b1")
"RTN","SAMIPAT",242,0)
 ;
"RTN","SAMIPAT",243,0)
 quit  ; end of kids-post POS1818^SAMIPAT
"RTN","SAMIPAT",244,0)
 ;
"RTN","SAMIPAT",245,0)
 ;
"RTN","SAMIPAT",246,0)
 ;
"RTN","SAMIPAT",247,0)
 ;
"RTN","SAMIPAT",248,0)
 ;@section X subroutines for future versions...
"RTN","SAMIPAT",249,0)
 ;
"RTN","SAMIPAT",250,0)
 ;
"RTN","SAMIPAT",251,0)
 ;
"RTN","SAMIPAT",252,0)
EOR ; end of routine SAMIPAT
"RTN","SAMIPTLK")
0^10^B50934240^B11168340
"RTN","SAMIPTLK",1,0)
SAMIPTLK ;ven/gpl - patient lookup; 2024-09-10t02:12z
"RTN","SAMIPTLK",2,0)
 ;;18.0;SAMI;**5,7,18**;2020-01-17;Build 1
"RTN","SAMIPTLK",3,0)
 ;mdc-e1;SAMIPTLK-20240910-E3bjqxe;SAMI-18-18-b1
"RTN","SAMIPTLK",4,0)
 ;mdc-v7;B50934240;SAMI*18.0*18 SEQ #18
"RTN","SAMIPTLK",5,0)
 ;
"RTN","SAMIPTLK",6,0)
 ; SAMIPTLK contains web services and subroutines to support the
"RTN","SAMIPTLK",7,0)
 ; lookup of patients in ScreeningPlus.
"RTN","SAMIPTLK",8,0)
 ;
"RTN","SAMIPTLK",9,0)
 quit  ; no entry from top
"RTN","SAMIPTLK",10,0)
 ;
"RTN","SAMIPTLK",11,0)
 ;
"RTN","SAMIPTLK",12,0)
 ;
"RTN","SAMIPTLK",13,0)
 ;
"RTN","SAMIPTLK",14,0)
 ;@section 0 primary development
"RTN","SAMIPTLK",15,0)
 ;
"RTN","SAMIPTLK",16,0)
 ;
"RTN","SAMIPTLK",17,0)
 ;
"RTN","SAMIPTLK",18,0)
 ;
"RTN","SAMIPTLK",19,0)
 ;@routine-credits
"RTN","SAMIPTLK",20,0)
 ;
"RTN","SAMIPTLK",21,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIPTLK",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIPTLK",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIPTLK",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIPTLK",25,0)
 ;@copyright 2018/2024, gpl, all rights reserved
"RTN","SAMIPTLK",26,0)
 ;@license see routine SAMIUL
"RTN","SAMIPTLK",27,0)
 ;
"RTN","SAMIPTLK",28,0)
 ;@update 2024-09-10t02:12z
"RTN","SAMIPTLK",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIPTLK",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIPTLK",31,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIPTLK",32,0)
 ;@release 18-18
"RTN","SAMIPTLK",33,0)
 ;@edition-date 2020-01-17
"RTN","SAMIPTLK",34,0)
 ;@patches **5,7,18**
"RTN","SAMIPTLK",35,0)
 ;
"RTN","SAMIPTLK",36,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIPTLK",37,0)
 ; toad@vistaexpertise.net
"RTN","SAMIPTLK",38,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIPTLK",39,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIPTLK",40,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIPTLK",41,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIPTLK",42,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIPTLK",43,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIPTLK",44,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIPTLK",45,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIPTLK",46,0)
 ;
"RTN","SAMIPTLK",47,0)
 ;@module-credits
"RTN","SAMIPTLK",48,0)
 ;
"RTN","SAMIPTLK",49,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIPTLK",50,0)
 ; (VA-PALS)
"RTN","SAMIPTLK",51,0)
 ; http://va-pals.org/
"RTN","SAMIPTLK",52,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIPTLK",53,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIPTLK",54,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIPTLK",55,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIPTLK",56,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIPTLK",57,0)
 ; http://ielcap.com/
"RTN","SAMIPTLK",58,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIPTLK",59,0)
 ; http://paraxialtech.com/
"RTN","SAMIPTLK",60,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIPTLK",61,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIPTLK",62,0)
 ;
"RTN","SAMIPTLK",63,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIPTLK",64,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIPTLK",65,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIPTLK",66,0)
 ;@partner-org par
"RTN","SAMIPTLK",67,0)
 ;
"RTN","SAMIPTLK",68,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIPTLK",69,0)
 ;
"RTN","SAMIPTLK",70,0)
 ; 2020-01-16 ven/lgc 18-0 0a2af965
"RTN","SAMIPTLK",71,0)
 ;  SAMIPTLK (F1Y8RNE B9242590 EJomiC)
"RTN","SAMIPTLK",72,0)
 ; Bulk commit due to switch to Cache.
"RTN","SAMIPTLK",73,0)
 ;
"RTN","SAMIPTLK",74,0)
 ; 2020-04-11 ven/gpl 18-5 2f2c29c1
"RTN","SAMIPTLK",75,0)
 ;  SAMIPTLK (F1jn7RT B10261104 EVRktE)
"RTN","SAMIPTLK",76,0)
 ; the crux of multi-tenancy.
"RTN","SAMIPTLK",77,0)
 ;
"RTN","SAMIPTLK",78,0)
 ; 2020-04-11 ven/gpl 18-5 d895cd7a
"RTN","SAMIPTLK",79,0)
 ;  SAMIPTLK (FCOM8k B10220412 E2+2jaV)
"RTN","SAMIPTLK",80,0)
 ; turn off debugging call.
"RTN","SAMIPTLK",81,0)
 ;
"RTN","SAMIPTLK",82,0)
 ; 2020-08-24 ven/gpl 18-7 135e8fdf
"RTN","SAMIPTLK",83,0)
 ;  SAMIPTLK (F1%FgrV B11168340 E3CdCfT)
"RTN","SAMIPTLK",84,0)
 ; utility to change patient site.
"RTN","SAMIPTLK",85,0)
 ;
"RTN","SAMIPTLK",86,0)
 ; 2024-09-07 ven/gpl 18-18-b1 e6fdd47d
"RTN","SAMIPTLK",87,0)
 ;  SAMIPTLK (F1Cgyfq B15734046 E2Q2QC2)
"RTN","SAMIPTLK",88,0)
 ; mrn lookup + display working.
"RTN","SAMIPTLK",89,0)
 ;
"RTN","SAMIPTLK",90,0)
 ; 2024-09-10 ven/toad 18-18-b1
"RTN","SAMIPTLK",91,0)
 ;  SAMIPTLK (F??? B50934240 E???)
"RTN","SAMIPTLK",92,0)
 ; add hdr + subrtn hdr comments, log, bump version + dates.
"RTN","SAMIPTLK",93,0)
 ;
"RTN","SAMIPTLK",94,0)
 ;@to-do
"RTN","SAMIPTLK",95,0)
 ;
"RTN","SAMIPTLK",96,0)
 ; fill in log before 18-18, add details
"RTN","SAMIPTLK",97,0)
 ;
"RTN","SAMIPTLK",98,0)
 ;@contents
"RTN","SAMIPTLK",99,0)
 ;
"RTN","SAMIPTLK",100,0)
 ; WSPTLOOK patient lookup
"RTN","SAMIPTLK",101,0)
 ; WSPTLKUP patient lookup from patient-lookup cache
"RTN","SAMIPTLK",102,0)
 ; BUILDRTN build patient-lookup return value
"RTN","SAMIPTLK",103,0)
 ;
"RTN","SAMIPTLK",104,0)
 ;
"RTN","SAMIPTLK",105,0)
 ;
"RTN","SAMIPTLK",106,0)
 ;
"RTN","SAMIPTLK",107,0)
 ;@section 1 subroutines
"RTN","SAMIPTLK",108,0)
 ;
"RTN","SAMIPTLK",109,0)
 ;
"RTN","SAMIPTLK",110,0)
 ;
"RTN","SAMIPTLK",111,0)
 ;
"RTN","SAMIPTLK",112,0)
 ;@ws-code WSPTLOOK
"RTN","SAMIPTLK",113,0)
 ;
"RTN","SAMIPTLK",114,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIPTLK",115,0)
 ;
"RTN","SAMIPTLK",116,0)
 ;ven/gpl;ws;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMIPTLK",117,0)
 ;@called-by [tbd]
"RTN","SAMIPTLK",118,0)
 ;@calls
"RTN","SAMIPTLK",119,0)
 ; SELECT^HMPPTRPC
"RTN","SAMIPTLK",120,0)
 ; ENCODE^VPRJSON
"RTN","SAMIPTLK",121,0)
 ;@input
"RTN","SAMIPTLK",122,0)
 ; filter
"RTN","SAMIPTLK",123,0)
 ;@output
"RTN","SAMIPTLK",124,0)
 ; .rtn
"RTN","SAMIPTLK",125,0)
 ;@examples [tbd]
"RTN","SAMIPTLK",126,0)
 ;@tests [tbd]
"RTN","SAMIPTLK",127,0)
 ;
"RTN","SAMIPTLK",128,0)
 ;
"RTN","SAMIPTLK",129,0)
WSPTLOOK(rtn,filter) ; patient lookup
"RTN","SAMIPTLK",130,0)
 ;
"RTN","SAMIPTLK",131,0)
 ;@stanza 2 lookup
"RTN","SAMIPTLK",132,0)
 ;
"RTN","SAMIPTLK",133,0)
 n search s search=$g(filter("search"))
"RTN","SAMIPTLK",134,0)
 n rslt
"RTN","SAMIPTLK",135,0)
 d SELECT^HMPPTRPC(.rslt,"NAME",search)
"RTN","SAMIPTLK",136,0)
 i $d(rslt) d  ;
"RTN","SAMIPTLK",137,0)
 . d ENCODE^VPRJSON("rslt","rtn")
"RTN","SAMIPTLK",138,0)
 . q
"RTN","SAMIPTLK",139,0)
 ;
"RTN","SAMIPTLK",140,0)
 ;
"RTN","SAMIPTLK",141,0)
 ;@stanza 3 termination
"RTN","SAMIPTLK",142,0)
 ;
"RTN","SAMIPTLK",143,0)
 quit  ; end of ws WSPTLOOK
"RTN","SAMIPTLK",144,0)
 ;
"RTN","SAMIPTLK",145,0)
 ;
"RTN","SAMIPTLK",146,0)
 ;
"RTN","SAMIPTLK",147,0)
 ;
"RTN","SAMIPTLK",148,0)
 ;@ws-code WSPTLKUP
"RTN","SAMIPTLK",149,0)
 ;
"RTN","SAMIPTLK",150,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIPTLK",151,0)
 ;
"RTN","SAMIPTLK",152,0)
 ;ven/gpl;ws;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMIPTLK",153,0)
 ;@called-by [tbd]
"RTN","SAMIPTLK",154,0)
 ;@calls
"RTN","SAMIPTLK",155,0)
 ; $$setroot^%wd
"RTN","SAMIPTLK",156,0)
 ; $$UPCASE^XLFMSMT
"RTN","SAMIPTLK",157,0)
 ; BUILDRTN
"RTN","SAMIPTLK",158,0)
 ;@input
"RTN","SAMIPTLK",159,0)
 ; filter
"RTN","SAMIPTLK",160,0)
 ;@output
"RTN","SAMIPTLK",161,0)
 ; .rtn
"RTN","SAMIPTLK",162,0)
 ;@examples [tbd]
"RTN","SAMIPTLK",163,0)
 ;@tests [tbd]
"RTN","SAMIPTLK",164,0)
 ;
"RTN","SAMIPTLK",165,0)
 ;
"RTN","SAMIPTLK",166,0)
WSPTLKUP(rtn,filter) ; patient lookup from patient-lookup cache
"RTN","SAMIPTLK",167,0)
 ;
"RTN","SAMIPTLK",168,0)
 ;@stanza 2 setup
"RTN","SAMIPTLK",169,0)
 ;
"RTN","SAMIPTLK",170,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIPTLK",171,0)
 n search s search=$g(filter("search"))
"RTN","SAMIPTLK",172,0)
 n limit s limit=$g(filter("limit"))
"RTN","SAMIPTLK",173,0)
 n site s site=$g(filter("site"))
"RTN","SAMIPTLK",174,0)
 ;m ^gpl("ptlkup")=filter ;
"RTN","SAMIPTLK",175,0)
 q:site=""
"RTN","SAMIPTLK",176,0)
 i limit="" s limit=1000
"RTN","SAMIPTLK",177,0)
 s search=$$UPCASE^XLFMSMT(search)
"RTN","SAMIPTLK",178,0)
 n rslt
"RTN","SAMIPTLK",179,0)
 n cnt s cnt=0
"RTN","SAMIPTLK",180,0)
 n gn s gn=$na(@root@("name"))
"RTN","SAMIPTLK",181,0)
 n p1,p2
"RTN","SAMIPTLK",182,0)
 s p1=$p(search,",",1)
"RTN","SAMIPTLK",183,0)
 s p2=$p(search,",",2)
"RTN","SAMIPTLK",184,0)
 ;
"RTN","SAMIPTLK",185,0)
 ;
"RTN","SAMIPTLK",186,0)
 ;@stanza 3 try bs5 lookup
"RTN","SAMIPTLK",187,0)
 ;
"RTN","SAMIPTLK",188,0)
 i $l(search)=5 i +$e(search,2,5)>0 d  ;q  ; using last5
"RTN","SAMIPTLK",189,0)
 . n gn2 s gn2=$na(@root@("last5"))
"RTN","SAMIPTLK",190,0)
 . n ii s ii=""
"RTN","SAMIPTLK",191,0)
 . f  s ii=$o(@gn2@(search,ii)) q:ii=""  q:cnt=limit  d  ;
"RTN","SAMIPTLK",192,0)
 . . i $g(@root@(ii,"siteid"))'=site q
"RTN","SAMIPTLK",193,0)
 . . s cnt=cnt+1
"RTN","SAMIPTLK",194,0)
 . . s rslt(cnt,ii)=""
"RTN","SAMIPTLK",195,0)
 . . q
"RTN","SAMIPTLK",196,0)
 . i cnt>0 d  ;
"RTN","SAMIPTLK",197,0)
 . . d BUILDRTN(.rtn,.rslt,$g(filter("format")))
"RTN","SAMIPTLK",198,0)
 . . q
"RTN","SAMIPTLK",199,0)
 . q
"RTN","SAMIPTLK",200,0)
 ;
"RTN","SAMIPTLK",201,0)
 ;
"RTN","SAMIPTLK",202,0)
 ;@stanza 4 try partial-match lookup
"RTN","SAMIPTLK",203,0)
 ;
"RTN","SAMIPTLK",204,0)
 n have s have=""
"RTN","SAMIPTLK",205,0)
 n q1 s q1=$na(@gn@(p1))
"RTN","SAMIPTLK",206,0)
 n q1x s q1x=$e(q1,1,$l(q1)-1) ; removes the )
"RTN","SAMIPTLK",207,0)
 i $e(q1x,$l(q1x))="""" s $e(q1x,$l(q1x))=""
"RTN","SAMIPTLK",208,0)
 n qx s qx=q1
"RTN","SAMIPTLK",209,0)
 f  s qx=$q(@qx) q:$p(qx,q1x,2)=""  q:cnt=limit  d  ;
"RTN","SAMIPTLK",210,0)
 . n exit s exit=0
"RTN","SAMIPTLK",211,0)
 . i p2'="" d  ;
"RTN","SAMIPTLK",212,0)
 . . i p2'=$e($p(qx,",",5),1,$l(p2)) s exit=1
"RTN","SAMIPTLK",213,0)
 . . q
"RTN","SAMIPTLK",214,0)
 . q:exit
"RTN","SAMIPTLK",215,0)
 . n qx2 s qx2=+$p(qx,",",6)
"RTN","SAMIPTLK",216,0)
 . i $g(@root@(qx2,"siteid"))'[site q  ;
"RTN","SAMIPTLK",217,0)
 . i $d(have(qx2)) q  ; already got this one
"RTN","SAMIPTLK",218,0)
 . s cnt=cnt+1
"RTN","SAMIPTLK",219,0)
 . s have(qx2)=""
"RTN","SAMIPTLK",220,0)
 . s rslt(cnt,qx2)="" ; the ien
"RTN","SAMIPTLK",221,0)
 . ;w !,qx," ien=",$o(rslt(cnt,""))
"RTN","SAMIPTLK",222,0)
 . q
"RTN","SAMIPTLK",223,0)
 ;
"RTN","SAMIPTLK",224,0)
 ;
"RTN","SAMIPTLK",225,0)
 ;@stanza 5 try emrn lookup
"RTN","SAMIPTLK",226,0)
 ;
"RTN","SAMIPTLK",227,0)
 s gn3=$na(@root@("emrn"))
"RTN","SAMIPTLK",228,0)
 s q1="e"_p1
"RTN","SAMIPTLK",229,0)
 ;
"RTN","SAMIPTLK",230,0)
 ;f  s q1=$o(@gn3@(q1)) q:$p(q1,"e"_p1,2)=""  q:cnt=limit  d  ;
"RTN","SAMIPTLK",231,0)
 ;f  s q1=$o(@gn3@(q1)) q:q1'[("e"_p1)  q:cnt=limit  d  ;
"RTN","SAMIPTLK",232,0)
 f  d:$d(@gn3@(q1))  s q1=$o(@gn3@(q1)) q:q1=""  q:$p(q1,"e"_p1)]""  q:cnt=limit  ;d  ;
"RTN","SAMIPTLK",233,0)
 . n lien
"RTN","SAMIPTLK",234,0)
 . s lien=$o(@gn3@(q1,"")) ; selection ien
"RTN","SAMIPTLK",235,0)
 . ;W !,"q1= ",q1
"RTN","SAMIPTLK",236,0)
 . i $g(@root@(lien,"siteid"))'[site q  ;
"RTN","SAMIPTLK",237,0)
 . i $d(have(lien)) q  ; already got this one
"RTN","SAMIPTLK",238,0)
 . s cnt=cnt+1
"RTN","SAMIPTLK",239,0)
 . s have(lien)=""
"RTN","SAMIPTLK",240,0)
 . s rslt(cnt,lien)="" ; the ien
"RTN","SAMIPTLK",241,0)
 . ;w !,q1," ien=",$o(rslt(cnt,""))
"RTN","SAMIPTLK",242,0)
 . q
"RTN","SAMIPTLK",243,0)
 ;
"RTN","SAMIPTLK",244,0)
 ;
"RTN","SAMIPTLK",245,0)
 ;@stanza 6 build results return value
"RTN","SAMIPTLK",246,0)
 ;
"RTN","SAMIPTLK",247,0)
 i cnt>0 d BUILDRTN(.rtn,.rslt,$g(filter("format")))
"RTN","SAMIPTLK",248,0)
 ;
"RTN","SAMIPTLK",249,0)
 ;
"RTN","SAMIPTLK",250,0)
 ;@stanza 7 termination
"RTN","SAMIPTLK",251,0)
 ;
"RTN","SAMIPTLK",252,0)
 quit  ; end of ws WSPTLKUP
"RTN","SAMIPTLK",253,0)
 ;
"RTN","SAMIPTLK",254,0)
 ;
"RTN","SAMIPTLK",255,0)
 ;
"RTN","SAMIPTLK",256,0)
 ;
"RTN","SAMIPTLK",257,0)
 ;@proc BUILDRTN
"RTN","SAMIPTLK",258,0)
 ;
"RTN","SAMIPTLK",259,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIPTLK",260,0)
 ;
"RTN","SAMIPTLK",261,0)
 ;ven/gpl;private;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMIPTLK",262,0)
 ;@called-by
"RTN","SAMIPTLK",263,0)
 ; WSPTLKUP
"RTN","SAMIPTLK",264,0)
 ;@calls
"RTN","SAMIPTLK",265,0)
 ; ^ZTER (commented out)
"RTN","SAMIPTLK",266,0)
 ; $$setroot^%wd
"RTN","SAMIPTLK",267,0)
 ; $$GETUID^SAMIUID
"RTN","SAMIPTLK",268,0)
 ; ENCODE^VPRJSON
"RTN","SAMIPTLK",269,0)
 ;@input
"RTN","SAMIPTLK",270,0)
 ; ary
"RTN","SAMIPTLK",271,0)
 ; format
"RTN","SAMIPTLK",272,0)
 ;@output
"RTN","SAMIPTLK",273,0)
 ; .rtn
"RTN","SAMIPTLK",274,0)
 ;@examples [tbd]
"RTN","SAMIPTLK",275,0)
 ;@tests [tbd]
"RTN","SAMIPTLK",276,0)
 ;
"RTN","SAMIPTLK",277,0)
 ; build return json unless format=array, then return a mumps array
"RTN","SAMIPTLK",278,0)
 ;
"RTN","SAMIPTLK",279,0)
 ;
"RTN","SAMIPTLK",280,0)
BUILDRTN(rtn,ary,format) ; build patient-lookup return value
"RTN","SAMIPTLK",281,0)
 ;
"RTN","SAMIPTLK",282,0)
 ;
"RTN","SAMIPTLK",283,0)
 ;@stanza 2 setup
"RTN","SAMIPTLK",284,0)
 ;
"RTN","SAMIPTLK",285,0)
 ;d ^ZTER
"RTN","SAMIPTLK",286,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIPTLK",287,0)
 n groot s groot=$$setroot^%wd("vapals-patients")
"RTN","SAMIPTLK",288,0)
 n zi s zi=""
"RTN","SAMIPTLK",289,0)
 n r1 s r1=""
"RTN","SAMIPTLK",290,0)
 ;
"RTN","SAMIPTLK",291,0)
 ;
"RTN","SAMIPTLK",292,0)
 ;@stanza 3 main loop
"RTN","SAMIPTLK",293,0)
 ;
"RTN","SAMIPTLK",294,0)
 f  s zi=$o(ary(zi)) q:zi=""  d  ;
"RTN","SAMIPTLK",295,0)
 . n rx s rx=$o(ary(zi,""))
"RTN","SAMIPTLK",296,0)
 . s r1("result",zi,"name")=$g(@root@(rx,"saminame"))
"RTN","SAMIPTLK",297,0)
 . s r1("result",zi,"dfn")=$g(@root@(rx,"dfn"))
"RTN","SAMIPTLK",298,0)
 . s dfn=$g(@root@(rx,"dfn"))
"RTN","SAMIPTLK",299,0)
 . ;s r1("result",zi,"last5")=$g(@root@(rx,"last5"))
"RTN","SAMIPTLK",300,0)
 . s r1("result",zi,"last5")=$$GETUID^SAMIUID(dfn)
"RTN","SAMIPTLK",301,0)
 . s r1("result",zi,"gender")=$g(@root@(rx,"gender"))
"RTN","SAMIPTLK",302,0)
 . s r1("result",zi,"dob")=$g(@root@(rx,"sbdob"))
"RTN","SAMIPTLK",303,0)
 . s r1("result",zi,"vapals")=0
"RTN","SAMIPTLK",304,0)
 . n dfn s dfn=$g(@root@(rx,"dfn"))
"RTN","SAMIPTLK",305,0)
 . i $o(@groot@("dfn",dfn,""))'="" d  ;
"RTN","SAMIPTLK",306,0)
 . . s r1("result",zi,"vapals")=1
"RTN","SAMIPTLK",307,0)
 . . s r1("result",zi,"studyid")=$g(@groot@(dfn,"samistudyid"))
"RTN","SAMIPTLK",308,0)
 . . q
"RTN","SAMIPTLK",309,0)
 . q
"RTN","SAMIPTLK",310,0)
 ;
"RTN","SAMIPTLK",311,0)
 ;.;
"RTN","SAMIPTLK",312,0)
 ;.; ven/lgc 2019-12-17 missing forms
"RTN","SAMIPTLK",313,0)
 ;.;
"RTN","SAMIPTLK",314,0)
 ;. i '($data(@groot@("graph",@groot@(dfn,"samistudyid")))) d  ;
"RTN","SAMIPTLK",315,0)
 ;. . s r1("result",zi,"vapals")=0
"RTN","SAMIPTLK",316,0)
 ;
"RTN","SAMIPTLK",317,0)
 ;q:'$d(r1)
"RTN","SAMIPTLK",318,0)
 ;
"RTN","SAMIPTLK",319,0)
 ;
"RTN","SAMIPTLK",320,0)
 ;@stanza 4 build result structure
"RTN","SAMIPTLK",321,0)
 ;
"RTN","SAMIPTLK",322,0)
 i format="array" m rtn=r1 q  ; return a mumps array
"RTN","SAMIPTLK",323,0)
 d ENCODE^VPRJSON("r1","rtn")
"RTN","SAMIPTLK",324,0)
 ;
"RTN","SAMIPTLK",325,0)
 ;
"RTN","SAMIPTLK",326,0)
 ;@stanza 5 termination
"RTN","SAMIPTLK",327,0)
 ;
"RTN","SAMIPTLK",328,0)
 quit  ; end of BUILDRTN
"RTN","SAMIPTLK",329,0)
 ;
"RTN","SAMIPTLK",330,0)
 ;
"RTN","SAMIPTLK",331,0)
 ;
"RTN","SAMIPTLK",332,0)
EOR ; end of routine SAMIPTLK
"RTN","SAMIUID")
0^11^B15836538
"RTN","SAMIUID",1,0)
SAMIUID ;ven/gpl - user id; 2024-09-10t02:37z
"RTN","SAMIUID",2,0)
 ;;18.0;SAMI;**18**;2020-01-17;Build 1
"RTN","SAMIUID",3,0)
 ;mdc-e1;SAMIUID-20240910-E2WaTc0;SAMI-18-18-b1
"RTN","SAMIUID",4,0)
 ;mdc-v7;B15836538;SAMI*18.0*18 SEQ #18
"RTN","SAMIUID",5,0)
 ;
"RTN","SAMIUID",6,0)
 ; SAMIUID contains private program services to identify the current
"RTN","SAMIUID",7,0)
 ; ScreeningPlus user.
"RTN","SAMIUID",8,0)
 ;
"RTN","SAMIUID",9,0)
 quit  ; no entry from top
"RTN","SAMIUID",10,0)
 ;
"RTN","SAMIUID",11,0)
 ;
"RTN","SAMIUID",12,0)
 ;
"RTN","SAMIUID",13,0)
 ;
"RTN","SAMIUID",14,0)
 ;@section 0 primary development
"RTN","SAMIUID",15,0)
 ;
"RTN","SAMIUID",16,0)
 ;
"RTN","SAMIUID",17,0)
 ;
"RTN","SAMIUID",18,0)
 ;
"RTN","SAMIUID",19,0)
 ;@routine-credits
"RTN","SAMIUID",20,0)
 ;
"RTN","SAMIUID",21,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIUID",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUID",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIUID",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIUID",25,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIUID",26,0)
 ;@license see routine SAMIUL
"RTN","SAMIUID",27,0)
 ;
"RTN","SAMIUID",28,0)
 ;@update 2024-09-10t02:37z
"RTN","SAMIUID",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIUID",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIUID",31,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUID",32,0)
 ;@release 18-18
"RTN","SAMIUID",33,0)
 ;@edition-date 2020-01-17
"RTN","SAMIUID",34,0)
 ;@patches **18**
"RTN","SAMIUID",35,0)
 ;
"RTN","SAMIUID",36,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIUID",37,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUID",38,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIUID",39,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIUID",40,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIUID",41,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIUID",42,0)
 ;
"RTN","SAMIUID",43,0)
 ;@module-credits
"RTN","SAMIUID",44,0)
 ;
"RTN","SAMIUID",45,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIUID",46,0)
 ; (VA-PALS)
"RTN","SAMIUID",47,0)
 ; http://va-pals.org/
"RTN","SAMIUID",48,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIUID",49,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIUID",50,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIUID",51,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIUID",52,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIUID",53,0)
 ; http://ielcap.com/
"RTN","SAMIUID",54,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIUID",55,0)
 ; http://paraxialtech.com/
"RTN","SAMIUID",56,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIUID",57,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIUID",58,0)
 ;
"RTN","SAMIUID",59,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIUID",60,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIUID",61,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIUID",62,0)
 ;@partner-org par
"RTN","SAMIUID",63,0)
 ;
"RTN","SAMIUID",64,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUID",65,0)
 ;
"RTN","SAMIUID",66,0)
 ; 2024-09-07 ven/gpl 18-18-b1 e6fdd47d
"RTN","SAMIUID",67,0)
 ;  SAMIUID (F2LNW6y B9193785 E31giZd)
"RTN","SAMIUID",68,0)
 ; add rtn w/GETUID,GETIDSID: mrn lookup + display working.
"RTN","SAMIUID",69,0)
 ;
"RTN","SAMIUID",70,0)
 ; 2024-09-10 ven/toad 18-18-b1
"RTN","SAMIUID",71,0)
 ;  SAMIUID (F??? B15836538 E???)
"RTN","SAMIUID",72,0)
 ; add hdr + subrtn hdr comments, log, bump version + dates.
"RTN","SAMIUID",73,0)
 ;
"RTN","SAMIUID",74,0)
 ;@to-do
"RTN","SAMIUID",75,0)
 ;
"RTN","SAMIUID",76,0)
 ; fill in log before 18-18, add details
"RTN","SAMIUID",77,0)
 ;
"RTN","SAMIUID",78,0)
 ;@contents
"RTN","SAMIUID",79,0)
 ;
"RTN","SAMIUID",80,0)
 ; $$GETUID = id to use
"RTN","SAMIUID",81,0)
 ; $$GETIDSID = id to use based on sid
"RTN","SAMIUID",82,0)
 ;
"RTN","SAMIUID",83,0)
 ;
"RTN","SAMIUID",84,0)
 ;
"RTN","SAMIUID",85,0)
 ;
"RTN","SAMIUID",86,0)
 ;@section 1 subroutines
"RTN","SAMIUID",87,0)
 ;
"RTN","SAMIUID",88,0)
 ;
"RTN","SAMIUID",89,0)
 ;
"RTN","SAMIUID",90,0)
 ;
"RTN","SAMIUID",91,0)
 ;@function $$GETUID
"RTN","SAMIUID",92,0)
 ;
"RTN","SAMIUID",93,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUID",94,0)
 ;
"RTN","SAMIUID",95,0)
 ;ven/gpl;private;function;silent;clean?;sac?;tests?;port?
"RTN","SAMIUID",96,0)
 ;@called-by
"RTN","SAMIUID",97,0)
 ; $$GETIDSID^SAMIUID
"RTN","SAMIUID",98,0)
 ;@calls
"RTN","SAMIUID",99,0)
 ; $$setroot^%wd
"RTN","SAMIUID",100,0)
 ;@input
"RTN","SAMIUID",101,0)
 ; dfn
"RTN","SAMIUID",102,0)
 ;@output = uid
"RTN","SAMIUID",103,0)
 ;@examples [tbd]
"RTN","SAMIUID",104,0)
 ;@tests [tbd]
"RTN","SAMIUID",105,0)
 ;
"RTN","SAMIUID",106,0)
 ; The hierarchy of user IDs
"RTN","SAMIUID",107,0)
 ; 1. pid, if available. this is the manually assigned "Study ID"
"RTN","SAMIUID",108,0)
 ;    which usually has the format "MRxxxxxxxx"
"RTN","SAMIUID",109,0)
 ; 2. mrn, if available. this is an external medical record id.
"RTN","SAMIUID",110,0)
 ;    If the external system is Epic, has the format 123456789 with
"RTN","SAMIUID",111,0)
 ;    some alphabetics included
"RTN","SAMIUID",112,0)
 ; 3. ssn, if available. for systems that use the social security number
"RTN","SAMIUID",113,0)
 ;    for identification. has the format 123-45-6789
"RTN","SAMIUID",114,0)
 ; 4. last5, if available. the first letter of the last name, and the
"RTN","SAMIUID",115,0)
 ;    last 4 digits of the ssn - depends on having the ssn
"RTN","SAMIUID",116,0)
 ; 5. sid, if available. the internal studyid, assigned automatically
"RTN","SAMIUID",117,0)
 ;    when a person is enrolled. is not changeable by the user.
"RTN","SAMIUID",118,0)
 ;    has the form XXX123456 where XXX is the site signifier
"RTN","SAMIUID",119,0)
 ; 6. dfn, alway available. the dfn is the identifier, system assigned,
"RTN","SAMIUID",120,0)
 ;    which is common to patient-lookup and vapals-patients graphs, and
"RTN","SAMIUID",121,0)
 ;    is thus the only identifier which is guarentied to exist for every
"RTN","SAMIUID",122,0)
 ;    person
"RTN","SAMIUID",123,0)
 ;
"RTN","SAMIUID",124,0)
 ;
"RTN","SAMIUID",125,0)
GETUID(dfn) ; extrinsic return the id to use
"RTN","SAMIUID",126,0)
 ;
"RTN","SAMIUID",127,0)
 n id s id=""
"RTN","SAMIUID",128,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUID",129,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIUID",130,0)
 ;
"RTN","SAMIUID",131,0)
 n debug s debug=$G(DEBUG)
"RTN","SAMIUID",132,0)
 n lien s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIUID",133,0)
 w:debug !,"lien= ",lien
"RTN","SAMIUID",134,0)
 q:lien="" ""
"RTN","SAMIUID",135,0)
 ;
"RTN","SAMIUID",136,0)
 n pien s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIUID",137,0)
 w:debug !,"pien= ",pien
"RTN","SAMIUID",138,0)
 q:pien="" ""
"RTN","SAMIUID",139,0)
 ;
"RTN","SAMIUID",140,0)
 s id=$g(@proot@(pien,"sipid"))
"RTN","SAMIUID",141,0)
 if id="" s id=$g(@proot@(pien,"pid"))
"RTN","SAMIUID",142,0)
 w:debug !,"pid= ",id
"RTN","SAMIUID",143,0)
 q:id]"" id
"RTN","SAMIUID",144,0)
 ;
"RTN","SAMIUID",145,0)
 s id=$g(@proot@(pien,"simrn"))
"RTN","SAMIUID",146,0)
 i id="" s id=$g(@proot@(pien,"mrn"))
"RTN","SAMIUID",147,0)
 w:debug !,"mrn= ",id
"RTN","SAMIUID",148,0)
 q:id]"" id
"RTN","SAMIUID",149,0)
 ;
"RTN","SAMIUID",150,0)
 s id=$g(@lroot@(lien,"sissn"))
"RTN","SAMIUID",151,0)
 i id="" s id=$g(@lroot@(lien,"ssn"))
"RTN","SAMIUID",152,0)
 i id="" s id=$g(@proot@(pien,"sissn"))
"RTN","SAMIUID",153,0)
 w:debug !,"ssn= ",id
"RTN","SAMIUID",154,0)
 q:id]"" id
"RTN","SAMIUID",155,0)
 ;
"RTN","SAMIUID",156,0)
 s id=$g(@lroot@(lien,"last5"))
"RTN","SAMIUID",157,0)
 w:debug !,"last5= ",id
"RTN","SAMIUID",158,0)
 q:id]"" id
"RTN","SAMIUID",159,0)
 ;
"RTN","SAMIUID",160,0)
 s id=$g(@proot@(pien,"sid"))
"RTN","SAMIUID",161,0)
 i id="" s id=$g(@proot@(pien,"sisid"))
"RTN","SAMIUID",162,0)
 w:debug !,"sid= ",id
"RTN","SAMIUID",163,0)
 q:id]"" id
"RTN","SAMIUID",164,0)
 ;
"RTN","SAMIUID",165,0)
 s id=dfn
"RTN","SAMIUID",166,0)
 w:debug !,"dfn= ",id
"RTN","SAMIUID",167,0)
 ;
"RTN","SAMIUID",168,0)
 quit id ; end of $$GETUID
"RTN","SAMIUID",169,0)
 ;
"RTN","SAMIUID",170,0)
 ;
"RTN","SAMIUID",171,0)
 ;
"RTN","SAMIUID",172,0)
 ;
"RTN","SAMIUID",173,0)
 ;@pps $$GETIDSID^SAMIUID
"RTN","SAMIUID",174,0)
 ;
"RTN","SAMIUID",175,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIUID",176,0)
 ;
"RTN","SAMIUID",177,0)
 ;ven/gpl;pps;function;silent;clean?;sac?;tests?;port?
"RTN","SAMIUID",178,0)
 ;@called-by [tbd]
"RTN","SAMIUID",179,0)
 ;@calls
"RTN","SAMIUID",180,0)
 ; $$setroot^%wd
"RTN","SAMIUID",181,0)
 ; $$GETUID
"RTN","SAMIUID",182,0)
 ;@input
"RTN","SAMIUID",183,0)
 ; sid
"RTN","SAMIUID",184,0)
 ;@output = id to use
"RTN","SAMIUID",185,0)
 ;@examples [tbd]
"RTN","SAMIUID",186,0)
 ;@tests [tbd]
"RTN","SAMIUID",187,0)
 ;
"RTN","SAMIUID",188,0)
 ;
"RTN","SAMIUID",189,0)
GETIDSID(sid) ; id to use based on sid
"RTN","SAMIUID",190,0)
 ;
"RTN","SAMIUID",191,0)
 n debug s debug=$g(DEBUG)
"RTN","SAMIUID",192,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIUID",193,0)
 n pien s pien=$o(@proot@("sid",sid,""))
"RTN","SAMIUID",194,0)
 w:debug !,"pien= ",pien
"RTN","SAMIUID",195,0)
 q:pien="" ""
"RTN","SAMIUID",196,0)
 ;
"RTN","SAMIUID",197,0)
 n dfn s dfn=$g(@proot@(pien,"dfn"))
"RTN","SAMIUID",198,0)
 w:debug !,"dfn= ",dfn
"RTN","SAMIUID",199,0)
 ;
"RTN","SAMIUID",200,0)
 quit:dfn="" ""
"RTN","SAMIUID",201,0)
 quit $$GETUID(dfn) ; end of pps $$GETIDSID^SAMIUID
"RTN","SAMIUID",202,0)
 ;
"RTN","SAMIUID",203,0)
 ;
"RTN","SAMIUID",204,0)
 ;
"RTN","SAMIUID",205,0)
EOR ; end of routine SAMIUID
"RTN","SAMIUR2")
0^12^B1541171009^B1536139436
"RTN","SAMIUR2",1,0)
SAMIUR2 ;ven/gpl - user reports cont; 2024-09-10t04:37z
"RTN","SAMIUR2",2,0)
 ;;18.0;SAMI;**5,11,12,14,15,17,18**;2020-01-17;Build 1
"RTN","SAMIUR2",3,0)
 ;mdc-e1;SAMIUR2-20240910-ERKKN;SAMI-18-18-b1
"RTN","SAMIUR2",4,0)
 ;mdc-v7;B1541171009;SAMI*18.0*18 SEQ #18
"RTN","SAMIUR2",5,0)
 ;
"RTN","SAMIUR2",6,0)
 ; SAMIUR2 contains subroutines for creating & implementing the
"RTN","SAMIUR2",7,0)
 ; report-definition table.
"RTN","SAMIUR2",8,0)
 ;
"RTN","SAMIUR2",9,0)
 quit  ; no entry from top
"RTN","SAMIUR2",10,0)
 ;
"RTN","SAMIUR2",11,0)
 ;
"RTN","SAMIUR2",12,0)
 ;
"RTN","SAMIUR2",13,0)
 ;
"RTN","SAMIUR2",14,0)
 ;@section 0 primary development
"RTN","SAMIUR2",15,0)
 ;
"RTN","SAMIUR2",16,0)
 ;
"RTN","SAMIUR2",17,0)
 ;
"RTN","SAMIUR2",18,0)
 ;
"RTN","SAMIUR2",19,0)
 ;@routine-credits
"RTN","SAMIUR2",20,0)
 ;
"RTN","SAMIUR2",21,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIUR2",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUR2",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIUR2",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIUR2",25,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMIUR2",26,0)
 ;@license see routine SAMIUL
"RTN","SAMIUR2",27,0)
 ;
"RTN","SAMIUR2",28,0)
 ;@update 2024-09-10t04:37z
"RTN","SAMIUR2",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIUR2",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIUR2",31,0)
 ;@module User Reports - SAMIUR
"RTN","SAMIUR2",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUR2",33,0)
 ;@release 18-18
"RTN","SAMIUR2",34,0)
 ;@edition-date 2021-01-17
"RTN","SAMIUR2",35,0)
 ;@patches **5,11,12,14,15,17,18**
"RTN","SAMIUR2",36,0)
 ;
"RTN","SAMIUR2",37,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIUR2",38,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUR2",39,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIUR2",40,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIUR2",41,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIUR2",42,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIUR2",43,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIUR2",44,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIUR2",45,0)
 ;
"RTN","SAMIUR2",46,0)
 ;@module-credits see SAMIURUL
"RTN","SAMIUR2",47,0)
 ;
"RTN","SAMIUR2",48,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUR2",49,0)
 ; see SAMIURUL
"RTN","SAMIUR2",50,0)
 ;
"RTN","SAMIUR2",51,0)
 ;@contents
"RTN","SAMIUR2",52,0)
 ;
"RTN","SAMIUR2",53,0)
 ; RPTTBL build report-definition table
"RTN","SAMIUR2",54,0)
 ;
"RTN","SAMIUR2",55,0)
 ; $$DFN2SID study id for patient DFN
"RTN","SAMIUR2",56,0)
 ; $$MKNAV html for navigation to form
"RTN","SAMIUR2",57,0)
 ;
"RTN","SAMIUR2",58,0)
 ; $$SHDET table contents for smoking history
"RTN","SAMIUR2",59,0)
 ; CUMPY forms array of cummulative pack year data
"RTN","SAMIUR2",60,0)
 ; $$TDDT embed date in table cell
"RTN","SAMIUR2",61,0)
 ; $$FMDT convert date to fileman format
"RTN","SAMIUR2",62,0)
 ; $$PKYDT pack-years from start & end & cigs/day
"RTN","SAMIUR2",63,0)
 ; $$PKY pack-years from years & packs/day
"RTN","SAMIUR2",64,0)
 ;
"RTN","SAMIUR2",65,0)
 ; $$AGE age
"RTN","SAMIUR2",66,0)
 ; $$BLINEDT baseline date
"RTN","SAMIUR2",67,0)
 ; $$CONTACT patient street address
"RTN","SAMIUR2",68,0)
 ; $$CTPROT ct protocol
"RTN","SAMIUR2",69,0)
 ; $$DOB date of birth
"RTN","SAMIUR2",70,0)
 ; $$FUDATE followup date
"RTN","SAMIUR2",71,0)
 ; $$GENDER gender
"RTN","SAMIUR2",72,0)
 ; $$IFORM name(s) of incomplete forms
"RTN","SAMIUR2",73,0)
 ; $$LASTEXM patient last exam
"RTN","SAMIUR2",74,0)
 ; $$MANPAT unmatched patient cell
"RTN","SAMIUR2",75,0)
 ; $$MATCH match button cell
"RTN","SAMIUR2",76,0)
 ; $$NAME name w/hyperlink
"RTN","SAMIUR2",77,0)
 ; $$PACKYRS smoking status
"RTN","SAMIUR2",78,0)
 ; $$POSSIBLE possible match cell
"RTN","SAMIUR2",79,0)
 ; $$RECOM recommendation
"RTN","SAMIUR2",80,0)
 ; $$RURAL patient's rural/urban status
"RTN","SAMIUR2",81,0)
 ; $$SID study id
"RTN","SAMIUR2",82,0)
 ; $$SMHIS smoking history cell
"RTN","SAMIUR2",83,0)
 ; $$SMKSTAT smoking status
"RTN","SAMIUR2",84,0)
 ; $$SSN social security number
"RTN","SAMIUR2",85,0)
 ; $$STUDYDT latest study date
"RTN","SAMIUR2",86,0)
 ; $$STUDYTYP latest study type
"RTN","SAMIUR2",87,0)
 ; $$VALS form-values cell
"RTN","SAMIUR2",88,0)
 ; $$WHEN followup text
"RTN","SAMIUR2",89,0)
 ; $$WORKPAT worklist patient name cell
"RTN","SAMIUR2",90,0)
 ;
"RTN","SAMIUR2",91,0)
 ; EPAT patient name w/nav to enrollment
"RTN","SAMIUR2",92,0)
 ; ETHNCTY ethnicity
"RTN","SAMIUR2",93,0)
 ; RACE race
"RTN","SAMIUR2",94,0)
 ; STATUS patient status
"RTN","SAMIUR2",95,0)
 ; WSVALS display form values from graph
"RTN","SAMIUR2",96,0)
 ;
"RTN","SAMIUR2",97,0)
 ;
"RTN","SAMIUR2",98,0)
 ;
"RTN","SAMIUR2",99,0)
 ;
"RTN","SAMIUR2",100,0)
 ;@section 1 ppi RPTTBL^SAMIUR2
"RTN","SAMIUR2",101,0)
 ;
"RTN","SAMIUR2",102,0)
 ;
"RTN","SAMIUR2",103,0)
 ;
"RTN","SAMIUR2",104,0)
 ;
"RTN","SAMIUR2",105,0)
RPTTBL(RPT,TYPE,SITE) ; RPT is passed by reference and returns the 
"RTN","SAMIUR2",106,0)
 ; report definition table. TYPE is the report type to be returned
"RTN","SAMIUR2",107,0)
 ; This routine could use a file or a graph in the next version
"RTN","SAMIUR2",108,0)
 ;
"RTN","SAMIUR2",109,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIUR2",110,0)
 ;@called-by
"RTN","SAMIUR2",111,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",112,0)
 ; WSREPORT^SAMIUR1 (which then calls WSREPORT^SAMIUR)
"RTN","SAMIUR2",113,0)
 ;@calls none (defines calls for WSREPORT^SAMIUR to call)
"RTN","SAMIUR2",114,0)
 ;@input
"RTN","SAMIUR2",115,0)
 ; TYPE = report type to return
"RTN","SAMIUR2",116,0)
 ;@output
"RTN","SAMIUR2",117,0)
 ; .RPT report-definition table
"RTN","SAMIUR2",118,0)
 ;
"RTN","SAMIUR2",119,0)
 ; This routine could use a file or a graph in the next version
"RTN","SAMIUR2",120,0)
 ;
"RTN","SAMIUR2",121,0)
 if TYPE="followup" do  quit  ;
"RTN","SAMIUR2",122,0)
 . set RPT(1,"header")="F/U Date"
"RTN","SAMIUR2",123,0)
 . set RPT(1,"routine")="$$FUDATE^SAMIUR2"
"RTN","SAMIUR2",124,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",125,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",126,0)
 . ;set RPT(3,"header")="SSN"
"RTN","SAMIUR2",127,0)
 . set RPT(3,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",128,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",129,0)
 . set RPT(4,"header")="Baseline Date"
"RTN","SAMIUR2",130,0)
 . set RPT(4,"routine")="$$BLINEDT^SAMIUR2"
"RTN","SAMIUR2",131,0)
 . set RPT(5,"header")="Last Form"
"RTN","SAMIUR2",132,0)
 . set RPT(5,"routine")="$$AFORM^SAMIUR2"
"RTN","SAMIUR2",133,0)
 . set RPT(6,"header")="Form Date"
"RTN","SAMIUR2",134,0)
 . set RPT(6,"routine")="$$AFORMDT^SAMIUR2"
"RTN","SAMIUR2",135,0)
 . set RPT(7,"header")="Recommend"
"RTN","SAMIUR2",136,0)
 . set RPT(7,"routine")="$$RECOM^SAMIUR2"
"RTN","SAMIUR2",137,0)
 . set RPT(8,"header")="Contact Information"
"RTN","SAMIUR2",138,0)
 . set RPT(8,"routine")="$$CONTACT^SAMIUR2"
"RTN","SAMIUR2",139,0)
 . quit
"RTN","SAMIUR2",140,0)
 ;
"RTN","SAMIUR2",141,0)
 if TYPE="activity" do  quit  ;
"RTN","SAMIUR2",142,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",143,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",144,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",145,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",146,0)
 . set RPT(2.2,"header")="Active/Inactive"
"RTN","SAMIUR2",147,0)
 . set RPT(2.2,"routine")="$$ACTIVE^SAMIUR2"
"RTN","SAMIUR2",148,0)
 . set RPT(2.5,"header")="Form"
"RTN","SAMIUR2",149,0)
 . set RPT(2.5,"routine")="$$AFORM^SAMIUR2"
"RTN","SAMIUR2",150,0)
 . set RPT(3,"header")="Form Date"
"RTN","SAMIUR2",151,0)
 . ;set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",152,0)
 . set RPT(3,"routine")="$$AFORMDT^SAMIUR2"
"RTN","SAMIUR2",153,0)
 . ;set RPT(4,"header")="Type"
"RTN","SAMIUR2",154,0)
 . ;set RPT(4,"routine")="$$STUDYTYP^SAMIUR2"
"RTN","SAMIUR2",155,0)
 . ;set RPT(5,"header")="CT Protocol"
"RTN","SAMIUR2",156,0)
 . ;set RPT(5,"routine")="$$CTPROT^SAMIUR2"
"RTN","SAMIUR2",157,0)
 . set RPT(6,"header")="Follow-up"
"RTN","SAMIUR2",158,0)
 . set RPT(6,"routine")="$$RECOM^SAMIUR2"
"RTN","SAMIUR2",159,0)
 . ;set RPT(7,"header")="When"
"RTN","SAMIUR2",160,0)
 . ;set RPT(7,"routine")="$$WHEN^SAMIUR2"
"RTN","SAMIUR2",161,0)
 . set RPT(8,"header")="on Date"
"RTN","SAMIUR2",162,0)
 . set RPT(8,"routine")="$$FUDATE^SAMIUR2"
"RTN","SAMIUR2",163,0)
 . quit
"RTN","SAMIUR2",164,0)
 ;
"RTN","SAMIUR2",165,0)
 if TYPE="enrollment" do  quit  ;
"RTN","SAMIUR2",166,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",167,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",168,0)
 . set RPT(1.5,"header")="Active/Inactive"
"RTN","SAMIUR2",169,0)
 . set RPT(1.5,"routine")="$$ACTIVE^SAMIUR2"
"RTN","SAMIUR2",170,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",171,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",172,0)
 . set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",173,0)
 . set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",174,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",175,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",176,0)
 . ; set RPT(5,"header")="Race"
"RTN","SAMIUR2",177,0)
 . ; set RPT(5,"routine")="$$RACE^SAMIUR2"
"RTN","SAMIUR2",178,0)
 . set RPT(6,"header")="Age"
"RTN","SAMIUR2",179,0)
 . set RPT(6,"routine")="$$AGE^SAMIUR2"
"RTN","SAMIUR2",180,0)
 . d  ;
"RTN","SAMIUR2",181,0)
 . . n filter s filter("siteid")=SITE
"RTN","SAMIUR2",182,0)
 . . i $$ISVA^SAMIPARM(.filter) d  ;
"RTN","SAMIUR2",183,0)
 . . . set RPT(7,"header")="Urban/Rural"
"RTN","SAMIUR2",184,0)
 . . . set RPT(7,"routine")="$$RURAL^SAMIUR2"
"RTN","SAMIUR2",185,0)
 . set RPT(8,"header")="Smoking Status"
"RTN","SAMIUR2",186,0)
 . set RPT(8,"routine")="$$SMKSTAT^SAMIUR2"
"RTN","SAMIUR2",187,0)
 . set RPT(9,"header")="Pack Years at Intake"
"RTN","SAMIUR2",188,0)
 . set RPT(9,"routine")="$$PACKYRS^SAMIUR2"
"RTN","SAMIUR2",189,0)
 . quit
"RTN","SAMIUR2",190,0)
 ;
"RTN","SAMIUR2",191,0)
 if TYPE="inactive" do  quit  ;
"RTN","SAMIUR2",192,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",193,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",194,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",195,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",196,0)
 . set RPT(3,"header")="Enrollment date"
"RTN","SAMIUR2",197,0)
 . set RPT(3,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",198,0)
 . ;set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",199,0)
 . ;set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",200,0)
 . ;set RPT(4,"header")="Gender"
"RTN","SAMIUR2",201,0)
 . ;set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",202,0)
 . ; set RPT(5,"header")="Race"
"RTN","SAMIUR2",203,0)
 . ; set RPT(5,"routine")="$$RACE^SAMIUR2"
"RTN","SAMIUR2",204,0)
 . ;set RPT(6,"header")="Age"
"RTN","SAMIUR2",205,0)
 . ;set RPT(6,"routine")="$$AGE^SAMIUR2"
"RTN","SAMIUR2",206,0)
 . set RPT(4,"header")="Date of Death"
"RTN","SAMIUR2",207,0)
 . set RPT(4,"routine")="$$INACTDT^SAMIUR2"
"RTN","SAMIUR2",208,0)
 . set RPT(5,"header")="Inactive Reason"
"RTN","SAMIUR2",209,0)
 . set RPT(5,"routine")="$$INACTRE^SAMIUR2"
"RTN","SAMIUR2",210,0)
 . set RPT(6,"header")="Inactive Comment"
"RTN","SAMIUR2",211,0)
 . set RPT(6,"routine")="$$INACTCM^SAMIUR2"
"RTN","SAMIUR2",212,0)
 . ;set RPT(7,"header")="Urban/Rural"
"RTN","SAMIUR2",213,0)
 . ;set RPT(7,"routine")="$$RURAL^SAMIUR2"
"RTN","SAMIUR2",214,0)
 . ;set RPT(8,"header")="Smoking Status"
"RTN","SAMIUR2",215,0)
 . ;set RPT(8,"routine")="$$SMKSTAT^SAMIUR2"
"RTN","SAMIUR2",216,0)
 . ;set RPT(9,"header")="Pack Years at Intake"
"RTN","SAMIUR2",217,0)
 . ;set RPT(9,"routine")="$$PACKYRS^SAMIUR2"
"RTN","SAMIUR2",218,0)
 . quit
"RTN","SAMIUR2",219,0)
 ;
"RTN","SAMIUR2",220,0)
 if TYPE="incomplete" do  quit  ;
"RTN","SAMIUR2",221,0)
 . set RPT(1,"header")="Enrollment date"
"RTN","SAMIUR2",222,0)
 . set RPT(1,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",223,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",224,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",225,0)
 . set RPT(3,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",226,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",227,0)
 . set RPT(4,"header")="Incomplete form"
"RTN","SAMIUR2",228,0)
 . set RPT(4,"routine")="$$IFORM^SAMIUR2"
"RTN","SAMIUR2",229,0)
 . quit
"RTN","SAMIUR2",230,0)
 ;
"RTN","SAMIUR2",231,0)
 if TYPE="missingct" do  quit  ;
"RTN","SAMIUR2",232,0)
 . set RPT(1,"header")="Last contact date"
"RTN","SAMIUR2",233,0)
 . set RPT(1,"routine")="$$LDOC^SAMIUR2"
"RTN","SAMIUR2",234,0)
 . set RPT(2,"header")="Last contact entry"
"RTN","SAMIUR2",235,0)
 . set RPT(2,"routine")="$$LENTRY^SAMIUR2"
"RTN","SAMIUR2",236,0)
 . set RPT(3,"header")="Name"
"RTN","SAMIUR2",237,0)
 . set RPT(3,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",238,0)
 . set RPT(4,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",239,0)
 . set RPT(4,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",240,0)
 . set RPT(5,"header")="Enrollment date"
"RTN","SAMIUR2",241,0)
 . set RPT(5,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",242,0)
 . quit
"RTN","SAMIUR2",243,0)
 ;
"RTN","SAMIUR2",244,0)
 if TYPE="cumpy" do  quit  ;
"RTN","SAMIUR2",245,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",246,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",247,0)
 . set RPT(2,"header")="Study ID"
"RTN","SAMIUR2",248,0)
 . set RPT(2,"routine")="$$SID^SAMIUR2"
"RTN","SAMIUR2",249,0)
 . set RPT(3,"header")="Form Values"
"RTN","SAMIUR2",250,0)
 . set RPT(3,"routine")="$$VALS^SAMIUR2"
"RTN","SAMIUR2",251,0)
 . set RPT(4,"header")="Smoking History"
"RTN","SAMIUR2",252,0)
 . set RPT(4,"routine")="$$SMHIS^SAMIUR2"
"RTN","SAMIUR2",253,0)
 . quit
"RTN","SAMIUR2",254,0)
 ;
"RTN","SAMIUR2",255,0)
 if TYPE="unmatched" do  ;
"RTN","SAMIUR2",256,0)
 . set RPT(1,"header")="Unmatched Manual Entry"
"RTN","SAMIUR2",257,0)
 . set RPT(1,"routine")="$$MANPAT^SAMIUR2"
"RTN","SAMIUR2",258,0)
 . set RPT(2,"header")="Possible HL7 Match"
"RTN","SAMIUR2",259,0)
 . set RPT(2,"routine")="$$POSSIBLE^SAMIUR2"
"RTN","SAMIUR2",260,0)
 . set RPT(3,"header")="Match Control"
"RTN","SAMIUR2",261,0)
 . set RPT(3,"routine")="$$MATCH^SAMIUR2"
"RTN","SAMIUR2",262,0)
 . quit
"RTN","SAMIUR2",263,0)
 ;
"RTN","SAMIUR2",264,0)
 if TYPE="recommend" do  ;
"RTN","SAMIUR2",265,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",266,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",267,0)
 . ;set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",268,0)
 . ;set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",269,0)
 . set RPT(3,"header")="PID"
"RTN","SAMIUR2",270,0)
 . ;set RPT(3,"routine")="$$LAST5^SAMIUR2"
"RTN","SAMIUR2",271,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",272,0)
 . set RPT(4,"header")="CT Eval Date"
"RTN","SAMIUR2",273,0)
 . set RPT(4,"routine")="$$ZDT^SAMIUR2"
"RTN","SAMIUR2",274,0)
 . set RPT(5,"header")="Antibiotics"_$$COUNTS("cefuaf")
"RTN","SAMIUR2",275,0)
 . set RPT(5,"routine")="$$RECANTI^SAMIUR2"
"RTN","SAMIUR2",276,0)
 . set RPT(6,"header")="Contrast CT"_$$COUNTS("cefucc")
"RTN","SAMIUR2",277,0)
 . set RPT(6,"routine")="$$RECCONT^SAMIUR2"
"RTN","SAMIUR2",278,0)
 . set RPT(7,"header")="PET"_$$COUNTS("cefupe")
"RTN","SAMIUR2",279,0)
 . set RPT(7,"routine")="$$RECPET^SAMIUR2"
"RTN","SAMIUR2",280,0)
 . ;set RPT(8,"header")="Percutaneous biopsy"
"RTN","SAMIUR2",281,0)
 . set RPT(8,"header")="Perc biopsy"_$$COUNTS("cefufn")
"RTN","SAMIUR2",282,0)
 . set RPT(8,"routine")="$$RECBIOP^SAMIUR2"
"RTN","SAMIUR2",283,0)
 . set RPT(9,"header")="Bronchoscopy"_$$COUNTS("cefubr")
"RTN","SAMIUR2",284,0)
 . set RPT(9,"routine")="$$RECBRONC^SAMIUR2"
"RTN","SAMIUR2",285,0)
 . ;set RPT(10,"header")="Pulmonary consultation"
"RTN","SAMIUR2",286,0)
 . set RPT(10,"header")="Pulm consult"_$$COUNTS("cefupc")
"RTN","SAMIUR2",287,0)
 . set RPT(10,"routine")="$$RECPULM^SAMIUR2"
"RTN","SAMIUR2",288,0)
 . ;set RPT(11,"header")="Refer to tumor board"
"RTN","SAMIUR2",289,0)
 . set RPT(11,"header")="Tumor board"_$$COUNTS("cefutb")
"RTN","SAMIUR2",290,0)
 . set RPT(11,"routine")="$$RECTUMOR^SAMIUR2"
"RTN","SAMIUR2",291,0)
 . ;set RPT(12,"header")="Other"
"RTN","SAMIUR2",292,0)
 . ;set RPT(12,"routine")=""
"RTN","SAMIUR2",293,0)
 . quit
"RTN","SAMIUR2",294,0)
 ;
"RTN","SAMIUR2",295,0)
 if TYPE="worklist" do  quit  ;
"RTN","SAMIUR2",296,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",297,0)
 . set RPT(1,"routine")="$$WORKPAT^SAMIUR2"
"RTN","SAMIUR2",298,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",299,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",300,0)
 . set RPT(3,"header")="Date of birth"
"RTN","SAMIUR2",301,0)
 . set RPT(3,"routine")="$$DOB^SAMIUR2"
"RTN","SAMIUR2",302,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",303,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",304,0)
 . quit
"RTN","SAMIUR2",305,0)
 ;
"RTN","SAMIUR2",306,0)
 quit  ; end of ppi RPTTBL^SAMIUR2
"RTN","SAMIUR2",307,0)
 ;
"RTN","SAMIUR2",308,0)
 ;
"RTN","SAMIUR2",309,0)
 ;
"RTN","SAMIUR2",310,0)
 ;@section 2 shared subroutines
"RTN","SAMIUR2",311,0)
 ;
"RTN","SAMIUR2",312,0)
 ;
"RTN","SAMIUR2",313,0)
 ;
"RTN","SAMIUR2",314,0)
DFN2SID(DFN) ;studyid for patient DFN
"RTN","SAMIUR2",315,0)
 ;
"RTN","SAMIUR2",316,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",317,0)
 ;@called-by
"RTN","SAMIUR2",318,0)
 ; $$SID^SAMIUR2
"RTN","SAMIUR2",319,0)
 ; $$IFORM^SAMIUR2
"RTN","SAMIUR2",320,0)
 ; $$VALS^SAMIUR2
"RTN","SAMIUR2",321,0)
 ; $$SMHIS^SAMIUR2
"RTN","SAMIUR2",322,0)
 ;@calls
"RTN","SAMIUR2",323,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",324,0)
 ;
"RTN","SAMIUR2",325,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",326,0)
 ;
"RTN","SAMIUR2",327,0)
 quit $get(@root@(DFN,"sisid")) ; end of $$DFN2SID
"RTN","SAMIUR2",328,0)
 ;
"RTN","SAMIUR2",329,0)
 ;
"RTN","SAMIUR2",330,0)
 ;
"RTN","SAMIUR2",331,0)
MKNAV(sid,zform,fname,form) ; html for navigation to form
"RTN","SAMIUR2",332,0)
 ;
"RTN","SAMIUR2",333,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",334,0)
 ;@called-by
"RTN","SAMIUR2",335,0)
 ; $$IFORM^SAMIUR2
"RTN","SAMIUR2",336,0)
 ;@calls none
"RTN","SAMIUR2",337,0)
 ;
"RTN","SAMIUR2",338,0)
 new rtn set rtn="<form method=""post"" action=""/vapals"">"
"RTN","SAMIUR2",339,0)
 set rtn=rtn_"<input name=""samiroute"" value=""form"" type=""hidden"">"
"RTN","SAMIUR2",340,0)
 set rtn=rtn_" <input name=""studyid"" value="""_sid_""" type=""hidden"">"
"RTN","SAMIUR2",341,0)
 set rtn=rtn_" <input name=""form"" value=""vapals:"_zform_""" type=""hidden"">"
"RTN","SAMIUR2",342,0)
 set rtn=rtn_" <input value="""_fname_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"_$char(13)
"RTN","SAMIUR2",343,0)
 ;
"RTN","SAMIUR2",344,0)
 quit rtn ; end of $$MKNAV
"RTN","SAMIUR2",345,0)
 ;
"RTN","SAMIUR2",346,0)
 ;
"RTN","SAMIUR2",347,0)
 ;
"RTN","SAMIUR2",348,0)
 ;@section 3 smoking history subroutines
"RTN","SAMIUR2",349,0)
 ;
"RTN","SAMIUR2",350,0)
 ;
"RTN","SAMIUR2",351,0)
 ;
"RTN","SAMIUR2",352,0)
SHDET(SID,KEY) ; table contents for smoking history
"RTN","SAMIUR2",353,0)
 ;
"RTN","SAMIUR2",354,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",355,0)
 ;@called-by
"RTN","SAMIUR2",356,0)
 ; LOAD^SAMIFLD
"RTN","SAMIUR2",357,0)
 ; $$SMHIS^SAMIUR2
"RTN","SAMIUR2",358,0)
 ;@calls
"RTN","SAMIUR2",359,0)
 ; CUMPY
"RTN","SAMIUR2",360,0)
 ;
"RTN","SAMIUR2",361,0)
 ; KEY is the form key of the caller for "current" marker insertion
"RTN","SAMIUR2",362,0)
 ;
"RTN","SAMIUR2",363,0)
 new pyary
"RTN","SAMIUR2",364,0)
 if $get(KEY)="" set KEY=""
"RTN","SAMIUR2",365,0)
 do CUMPY("pyary",SID,KEY)
"RTN","SAMIUR2",366,0)
 ;
"RTN","SAMIUR2",367,0)
 new current set current=$get(pyary("current"))
"RTN","SAMIUR2",368,0)
 new rptcnt set rptcnt=0
"RTN","SAMIUR2",369,0)
 new rptmax set rptmax=$order(pyary("rpt",""),-1)
"RTN","SAMIUR2",370,0)
 quit:+rptmax=0
"RTN","SAMIUR2",371,0)
 ;
"RTN","SAMIUR2",372,0)
 new return set return=""
"RTN","SAMIUR2",373,0)
 new zi set zi=""
"RTN","SAMIUR2",374,0)
 for zi=1:1:rptmax do  ;
"RTN","SAMIUR2",375,0)
 . set rptcnt=rptcnt+1
"RTN","SAMIUR2",376,0)
 . if rptcnt=current set return=return_"<tr data-current-form=""true"">"
"RTN","SAMIUR2",377,0)
 . else  set return=return_"<tr>"
"RTN","SAMIUR2",378,0)
 . set return=return_"<td>"_pyary("rpt",rptcnt,1)_"</td>"
"RTN","SAMIUR2",379,0)
 . set return=return_"<td class=""reported-date"">"_pyary("rpt",rptcnt,2)_"</td>"
"RTN","SAMIUR2",380,0)
 . set return=return_"<td class=""pack-years"">"_pyary("rpt",rptcnt,3)_"</td>"
"RTN","SAMIUR2",381,0)
 . set return=return_"<td class=""cumulative-pack-years"">"_pyary("rpt",rptcnt,4)_"</td>"
"RTN","SAMIUR2",382,0)
 . set return=return_"</tr>"
"RTN","SAMIUR2",383,0)
 . quit
"RTN","SAMIUR2",384,0)
 ;
"RTN","SAMIUR2",385,0)
 quit return ; end of ppi $$SHDET^SAMIUR2
"RTN","SAMIUR2",386,0)
 ;
"RTN","SAMIUR2",387,0)
 ;
"RTN","SAMIUR2",388,0)
 ;
"RTN","SAMIUR2",389,0)
CUMPY(PYARY,sid,KEY) ; forms array of cummulative pack year data
"RTN","SAMIUR2",390,0)
 ;
"RTN","SAMIUR2",391,0)
 ;;ppi;procedure;clean;silent;sac
"RTN","SAMIUR2",392,0)
 ;@called-by
"RTN","SAMIUR2",393,0)
 ; SSTATUS^SAMINOT2
"RTN","SAMIUR2",394,0)
 ; SSTATUS^SAMINOT3
"RTN","SAMIUR2",395,0)
 ; $$SHDET
"RTN","SAMIUR2",396,0)
 ;@calls
"RTN","SAMIUR2",397,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",398,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIUR2",399,0)
 ; $$GETDTKEY^SAMICAS2
"RTN","SAMIUR2",400,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMIUR2",401,0)
 ; $$FMDT
"RTN","SAMIUR2",402,0)
 ; $$PKYDT
"RTN","SAMIUR2",403,0)
 ;
"RTN","SAMIUR2",404,0)
 ; PYARY passed by name
"RTN","SAMIUR2",405,0)
 ; KEY is the current form key for matching to a row
"RTN","SAMIUR2",406,0)
 ;
"RTN","SAMIUR2",407,0)
 kill @PYARY
"RTN","SAMIUR2",408,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",409,0)
 ; new sid set sid=$get(@root@(DFN,"samistudyid"))
"RTN","SAMIUR2",410,0)
 ; quit:sid=""
"RTN","SAMIUR2",411,0)
 ;
"RTN","SAMIUR2",412,0)
 new items set items=""
"RTN","SAMIUR2",413,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR2",414,0)
 quit:'$data(items)
"RTN","SAMIUR2",415,0)
 merge @PYARY@("items")=items
"RTN","SAMIUR2",416,0)
 ;
"RTN","SAMIUR2",417,0)
 new siform set siform=$order(items("siform"))
"RTN","SAMIUR2",418,0)
 quit:siform=""
"RTN","SAMIUR2",419,0)
 if siform=$get(KEY) set @PYARY@("current")=1 ;this row is the current form
"RTN","SAMIUR2",420,0)
 ;
"RTN","SAMIUR2",421,0)
 set @PYARY@("rpt",1,1)="Intake" ; Form
"RTN","SAMIUR2",422,0)
 new kdate set kdate=$$GETDTKEY^SAMICAS2(siform)
"RTN","SAMIUR2",423,0)
 new keydate set keydate=$$KEY2DSPD^SAMICAS2(kdate)
"RTN","SAMIUR2",424,0)
 set @PYARY@("rpt",1,2)=keydate ; Reported Date
"RTN","SAMIUR2",425,0)
 ;
"RTN","SAMIUR2",426,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",427,0)
 new lastcum set lastcum=$get(@vals@("sippy"))
"RTN","SAMIUR2",428,0)
 set @PYARY@("rpt",1,3)=lastcum ; Pack Years
"RTN","SAMIUR2",429,0)
 set @PYARY@("rpt",1,4)=lastcum ; Cumulative
"RTN","SAMIUR2",430,0)
 ;
"RTN","SAMIUR2",431,0)
 new lastdt set lastdt=keydate
"RTN","SAMIUR2",432,0)
 new rptcnt set rptcnt=1
"RTN","SAMIUR2",433,0)
 new zi set zi=""
"RTN","SAMIUR2",434,0)
 for  do  quit:zi=""  ;
"RTN","SAMIUR2",435,0)
 . set zi=$order(items("type","vapals:fuform",zi))
"RTN","SAMIUR2",436,0)
 . quit:zi=""
"RTN","SAMIUR2",437,0)
 . ;
"RTN","SAMIUR2",438,0)
 . set rptcnt=rptcnt+1
"RTN","SAMIUR2",439,0)
 . set @PYARY@("rpt",rptcnt,1)="Follow-up"
"RTN","SAMIUR2",440,0)
 . new kdate set kdate=$$GETDTKEY^SAMICAS2(zi)
"RTN","SAMIUR2",441,0)
 . new keydate set keydate=$$KEY2DSPD^SAMICAS2(kdate)
"RTN","SAMIUR2",442,0)
 . set @PYARY@("rpt",rptcnt,2)=keydate ; Reported Date
"RTN","SAMIUR2",443,0)
 . ;
"RTN","SAMIUR2",444,0)
 . set vals=$name(@root@("graph",sid,zi))
"RTN","SAMIUR2",445,0)
 . new newpd set newpd=$g(@vals@("sippd"))
"RTN","SAMIUR2",446,0)
 . new usedate set usedate=keydate
"RTN","SAMIUR2",447,0)
 . new siq set siq=$get(@vals@("siq")) ; quit date on followup form
"RTN","SAMIUR2",448,0)
 . if siq'="" do  ; quit date provided
"RTN","SAMIUR2",449,0)
 . . quit:$$FMDT(siq)<$$FMDT(lastdt)  ; quit date out of range
"RTN","SAMIUR2",450,0)
 . . quit:$$FMDT(siq)>$$FMDT(keydate)  ; quit date out of range
"RTN","SAMIUR2",451,0)
 . . set usedate=siq ; use the quit date as end of range
"RTN","SAMIUR2",452,0)
 . . quit
"RTN","SAMIUR2",453,0)
 . new newpy set newpy=$$PKYDT(lastdt,usedate,newpd)
"RTN","SAMIUR2",454,0)
 . set @vals@("sippy")=newpy
"RTN","SAMIUR2",455,0)
 . ;
"RTN","SAMIUR2",456,0)
 . ; set ^gpl("current","KEY")=$get(KEY)
"RTN","SAMIUR2",457,0)
 . ; set ^gpl("current","zi")=zi
"RTN","SAMIUR2",458,0)
 . if zi=$get(KEY) do
"RTN","SAMIUR2",459,0)
 . . set @PYARY@("current")=rptcnt ;this row is the current form
"RTN","SAMIUR2",460,0)
 . . quit
"RTN","SAMIUR2",461,0)
 . ;
"RTN","SAMIUR2",462,0)
 . new newcum set newcum=""
"RTN","SAMIUR2",463,0)
 . if newpy'="" set newcum=lastcum+newpy
"RTN","SAMIUR2",464,0)
 . set @PYARY@("rpt",rptcnt,3)=newpy ; Pack Years
"RTN","SAMIUR2",465,0)
 . set @PYARY@("rpt",rptcnt,4)=newcum ; Cumulative
"RTN","SAMIUR2",466,0)
 . set lastdt=keydate
"RTN","SAMIUR2",467,0)
 . set lastcum=newcum
"RTN","SAMIUR2",468,0)
 . quit
"RTN","SAMIUR2",469,0)
 ;
"RTN","SAMIUR2",470,0)
 quit  ; end of ppi CUMPY^SAMIUR2
"RTN","SAMIUR2",471,0)
 ;
"RTN","SAMIUR2",472,0)
 ;
"RTN","SAMIUR2",473,0)
 ;
"RTN","SAMIUR2",474,0)
TDDT(ZDT) ; embed date in table cell
"RTN","SAMIUR2",475,0)
 ;
"RTN","SAMIUR2",476,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",477,0)
 ;@called-by
"RTN","SAMIUR2",478,0)
 ; BLINEDT
"RTN","SAMIUR2",479,0)
 ; DOB
"RTN","SAMIUR2",480,0)
 ; FUDATE
"RTN","SAMIUR2",481,0)
 ; LASTEXM
"RTN","SAMIUR2",482,0)
 ; INACTDT
"RTN","SAMIUR2",483,0)
 ; LDOC
"RTN","SAMIUR2",484,0)
 ; STUDYDT
"RTN","SAMIUR2",485,0)
 ;@calls
"RTN","SAMIUR2",486,0)
 ; ^%DT
"RTN","SAMIUR2",487,0)
 ;
"RTN","SAMIUR2",488,0)
 new X,Y,Z
"RTN","SAMIUR2",489,0)
 set X=ZDT
"RTN","SAMIUR2",490,0)
 do ^%DT
"RTN","SAMIUR2",491,0)
 if Y=-1 set Y=""
"RTN","SAMIUR2",492,0)
 set Z=$$VAPALSDT^SAMICASE(Y)
"RTN","SAMIUR2",493,0)
 new cell
"RTN","SAMIUR2",494,0)
 set cell="<td data-order="""_Y_""" data-search="""_Z_""">"_Z_"</td>"
"RTN","SAMIUR2",495,0)
 ;
"RTN","SAMIUR2",496,0)
 quit cell ; end of $$TDDT
"RTN","SAMIUR2",497,0)
 ; 
"RTN","SAMIUR2",498,0)
 ;
"RTN","SAMIUR2",499,0)
 ;
"RTN","SAMIUR2",500,0)
FMDT(ZDT) ; convert date to fileman format
"RTN","SAMIUR2",501,0)
 ;
"RTN","SAMIUR2",502,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",503,0)
 ;@called-by
"RTN","SAMIUR2",504,0)
 ; MKPTLK^SAMIHOM4
"RTN","SAMIUR2",505,0)
 ; $$PKYDT
"RTN","SAMIUR2",506,0)
 ; CUMPY
"RTN","SAMIUR2",507,0)
 ;@calls
"RTN","SAMIUR2",508,0)
 ; ^%DT
"RTN","SAMIUR2",509,0)
 ;
"RTN","SAMIUR2",510,0)
 new Y
"RTN","SAMIUR2",511,0)
 new X set X=ZDT
"RTN","SAMIUR2",512,0)
 do ^%DT
"RTN","SAMIUR2",513,0)
 ;
"RTN","SAMIUR2",514,0)
 quit Y ; end of ppi $$FMDT^SAMIUR2
"RTN","SAMIUR2",515,0)
 ;
"RTN","SAMIUR2",516,0)
 ;
"RTN","SAMIUR2",517,0)
 ;
"RTN","SAMIUR2",518,0)
PKYDT(STDT,ENDT,PKS,CIGS) ; pack-years from start & end & cigs/day
"RTN","SAMIUR2",519,0)
 ;
"RTN","SAMIUR2",520,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",521,0)
 ;@called-by
"RTN","SAMIUR2",522,0)
 ; CUMPY
"RTN","SAMIUR2",523,0)
 ;@calls
"RTN","SAMIUR2",524,0)
 ; $$FMDT
"RTN","SAMIUR2",525,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIUR2",526,0)
 ; $$PKY
"RTN","SAMIUR2",527,0)
 ;
"RTN","SAMIUR2",528,0)
 ; if PKS is not provided, 20/CIGS will be used for packs per day
"RTN","SAMIUR2",529,0)
 ;
"RTN","SAMIUR2",530,0)
 new pkyr set pkyr=""
"RTN","SAMIUR2",531,0)
 if $get(PKS)="" do  ;
"RTN","SAMIUR2",532,0)
 . if $get(CIGS)="" set PKS=0 quit  ;
"RTN","SAMIUR2",533,0)
 . set PKS=20/CIGS
"RTN","SAMIUR2",534,0)
 . quit
"RTN","SAMIUR2",535,0)
 new zst set zst=$$FMDT(STDT)
"RTN","SAMIUR2",536,0)
 set:zst=-1 zst=STDT
"RTN","SAMIUR2",537,0)
 ;
"RTN","SAMIUR2",538,0)
 new zend set zend=$$FMDT(ENDT)
"RTN","SAMIUR2",539,0)
 set:zend=-1 zend=ENDT ; probably a fileman date already
"RTN","SAMIUR2",540,0)
 ;
"RTN","SAMIUR2",541,0)
 new zdif set zdif=$$FMDIFF^XLFDT(zend,zst)/365.24
"RTN","SAMIUR2",542,0)
 ;
"RTN","SAMIUR2",543,0)
 set pkyr=$$PKY(zdif,PKS)
"RTN","SAMIUR2",544,0)
 ;
"RTN","SAMIUR2",545,0)
 quit pkyr ; end of $$PKYDT
"RTN","SAMIUR2",546,0)
 ;
"RTN","SAMIUR2",547,0)
 ;
"RTN","SAMIUR2",548,0)
 ;
"RTN","SAMIUR2",549,0)
PKY(YRS,PKS) ; pack-years from years & packs/day
"RTN","SAMIUR2",550,0)
 ;
"RTN","SAMIUR2",551,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",552,0)
 ;@called-by
"RTN","SAMIUR2",553,0)
 ; $$PKYDT
"RTN","SAMIUR2",554,0)
 ;@calls none
"RTN","SAMIUR2",555,0)
 ;@input
"RTN","SAMIUR2",556,0)
 ; YRS = years
"RTN","SAMIUR2",557,0)
 ; PKS = packs/day
"RTN","SAMIUR2",558,0)
 ;
"RTN","SAMIUR2",559,0)
 new rtn set rtn=""
"RTN","SAMIUR2",560,0)
 set rtn=YRS*PKS
"RTN","SAMIUR2",561,0)
 if $length($piece(rtn,".",2))>2 do  ;
"RTN","SAMIUR2",562,0)
 . new zdec set zdec=$piece(rtn,".",2)
"RTN","SAMIUR2",563,0)
 . set rtn=$piece(rtn,".",1)_"."_$extract(zdec,1,2)
"RTN","SAMIUR2",564,0)
 . if $extract(zdec,3)>4 set rtn=rtn+.01
"RTN","SAMIUR2",565,0)
 . quit
"RTN","SAMIUR2",566,0)
 set:rtn'["." rtn=rtn_".0"
"RTN","SAMIUR2",567,0)
 ;
"RTN","SAMIUR2",568,0)
 quit rtn ; end of $$PKY
"RTN","SAMIUR2",569,0)
 ;
"RTN","SAMIUR2",570,0)
 ;
"RTN","SAMIUR2",571,0)
 ;
"RTN","SAMIUR2",572,0)
 ;@section 4 active column ppis
"RTN","SAMIUR2",573,0)
 ;
"RTN","SAMIUR2",574,0)
 ;
"RTN","SAMIUR2",575,0)
 ;
"RTN","SAMIUR2",576,0)
ACTIVE(zdt,dfn,SAMIPATS) ; Active/Inactive column
"RTN","SAMIUR2",577,0)
 ;
"RTN","SAMIUR2",578,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",579,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",580,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",581,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",582,0)
 new active set active="inactive"
"RTN","SAMIUR2",583,0)
 if $get(@vals@("sistatus"))="active" set active="active"
"RTN","SAMIUR2",584,0)
 ;
"RTN","SAMIUR2",585,0)
 quit active
"RTN","SAMIUR2",586,0)
 ; 
"RTN","SAMIUR2",587,0)
AFORM(zdt,dfn,SAMIPATS) ; Name of most recent form
"RTN","SAMIUR2",588,0)
 Q $GET(SAMIPATS(zdt,dfn,"aform"))
"RTN","SAMIUR2",589,0)
 ;
"RTN","SAMIUR2",590,0)
AFORMDT(zdt,dfn,SAMIPATS) ; Date of most recent form
"RTN","SAMIUR2",591,0)
 N ZD S ZD=$GET(SAMIPATS(zdt,dfn,"aformdt"))
"RTN","SAMIUR2",592,0)
 Q $$VAPALSDT^SAMICASE(ZD)
"RTN","SAMIUR2",593,0)
 ;
"RTN","SAMIUR2",594,0)
AGE(zdt,dfn,SAMIPATS) ; age
"RTN","SAMIUR2",595,0)
 ;
"RTN","SAMIUR2",596,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",597,0)
 ;@called-by
"RTN","SAMIUR2",598,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",599,0)
 ;@calls
"RTN","SAMIUR2",600,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",601,0)
 ; ^%DT
"RTN","SAMIUR2",602,0)
 ; $$NOW^XLFDT
"RTN","SAMIUR2",603,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIUR2",604,0)
 ;
"RTN","SAMIUR2",605,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",606,0)
 new dob set dob=$get(@root@(dfn,"sbdob")) ; dob in VAPALS format
"RTN","SAMIUR2",607,0)
 ;
"RTN","SAMIUR2",608,0)
 new Y
"RTN","SAMIUR2",609,0)
 new X set X=dob
"RTN","SAMIUR2",610,0)
 do ^%DT
"RTN","SAMIUR2",611,0)
 ;
"RTN","SAMIUR2",612,0)
 new age set age=$piece($$FMDIFF^XLFDT($$NOW^XLFDT,Y)/365,".")
"RTN","SAMIUR2",613,0)
 ;
"RTN","SAMIUR2",614,0)
 quit age ; end of ppi $$AGE^SAMIUR2
"RTN","SAMIUR2",615,0)
 ;
"RTN","SAMIUR2",616,0)
COUNTS(recvar) ; extrinsic returns (total_recommendations/total_patients)
"RTN","SAMIUR2",617,0)
 ;
"RTN","SAMIUR2",618,0)
 n n,d
"RTN","SAMIUR2",619,0)
 s (n,d)=0
"RTN","SAMIUR2",620,0)
 s n=$g(SAMIPATS("rcount",recvar))
"RTN","SAMIUR2",621,0)
 s n=+n
"RTN","SAMIUR2",622,0)
 s d=$g(SAMIPATS("pcount",recvar))
"RTN","SAMIUR2",623,0)
 s d=+d
"RTN","SAMIUR2",624,0)
 q "<br>("_n_"/"_d_")"
"RTN","SAMIUR2",625,0)
 ;
"RTN","SAMIUR2",626,0)
RECANTI(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",627,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefuaf"))="y":"X",1:"")
"RTN","SAMIUR2",628,0)
 ;
"RTN","SAMIUR2",629,0)
RECCONT(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",630,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefucc"))="y":"X",1:"")
"RTN","SAMIUR2",631,0)
 ;
"RTN","SAMIUR2",632,0)
RECPET(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",633,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefupe"))="y":"X",1:"")
"RTN","SAMIUR2",634,0)
 ;
"RTN","SAMIUR2",635,0)
RECBIOP(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",636,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefufn"))="y":"X",1:"")
"RTN","SAMIUR2",637,0)
 ;
"RTN","SAMIUR2",638,0)
RECBRONC(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",639,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefubr"))="y":"X",1:"")
"RTN","SAMIUR2",640,0)
 ;
"RTN","SAMIUR2",641,0)
RECPULM(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",642,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefupc"))="y":"X",1:"")
"RTN","SAMIUR2",643,0)
 ;
"RTN","SAMIUR2",644,0)
RECTUMOR(zdt,dfn,SAMIPATS) ; returns X if recommendation was checked
"RTN","SAMIUR2",645,0)
 Q $S($get(SAMIPATS(zdt,dfn,"cefutb"))="y":"X",1:"")
"RTN","SAMIUR2",646,0)
 ;
"RTN","SAMIUR2",647,0)
LAST5(zdt,dfn,SAMIPATS) ; return last5
"RTN","SAMIUR2",648,0)
 Q $get(SAMIPATS(zdt,dfn,"last5"))
"RTN","SAMIUR2",649,0)
 ;
"RTN","SAMIUR2",650,0)
ZDT(zdt,dfn,SAMIPATS) ; insertable index date
"RTN","SAMIUR2",651,0)
 Q $$TDDT(zdt)
"RTN","SAMIUR2",652,0)
 ;
"RTN","SAMIUR2",653,0)
ENROLLDT(zdt,dfn,SAMIPATS) ; enrollment date
"RTN","SAMIUR2",654,0)
 ;
"RTN","SAMIUR2",655,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",656,0)
 ;@called-by
"RTN","SAMIUR2",657,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",658,0)
 ;@calls
"RTN","SAMIUR2",659,0)
 ; $$TDDT
"RTN","SAMIUR2",660,0)
 ;
"RTN","SAMIUR2",661,0)
 new enroldt set enroldt=$get(SAMIPATS(zdt,dfn,"edate"))
"RTN","SAMIUR2",662,0)
 ;
"RTN","SAMIUR2",663,0)
 quit $$TDDT(enroldt) ; end of ppi $$ENROLLDT^SAMIUR2
"RTN","SAMIUR2",664,0)
 ;
"RTN","SAMIUR2",665,0)
 ;
"RTN","SAMIUR2",666,0)
BLINEDT(zdt,dfn,SAMIPATS) ; baseline date
"RTN","SAMIUR2",667,0)
 ;
"RTN","SAMIUR2",668,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",669,0)
 ;@called-by
"RTN","SAMIUR2",670,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",671,0)
 ;@calls
"RTN","SAMIUR2",672,0)
 ; $$TDDT
"RTN","SAMIUR2",673,0)
 ;
"RTN","SAMIUR2",674,0)
 new bldt set bldt=$get(SAMIPATS(zdt,dfn,"baseline"))
"RTN","SAMIUR2",675,0)
 ;
"RTN","SAMIUR2",676,0)
 quit $$TDDT(bldt) ; end of ppi $$BLINEDT^SAMIUR2
"RTN","SAMIUR2",677,0)
 ;
"RTN","SAMIUR2",678,0)
 ;
"RTN","SAMIUR2",679,0)
CONTACT(zdt,dfn,SAMIPATS) ; patient street address
"RTN","SAMIUR2",680,0)
 ;
"RTN","SAMIUR2",681,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",682,0)
 ;@called-by
"RTN","SAMIUR2",683,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",684,0)
 ;@calls
"RTN","SAMIUR2",685,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",686,0)
 ;
"RTN","SAMIUR2",687,0)
 new contact set contact=""
"RTN","SAMIUR2",688,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",689,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",690,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",691,0)
 q:siform=""
"RTN","SAMIUR2",692,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",693,0)
 set contact=$get(@vals@("sinamef"))_" "_$get(@vals@("sinamel"))
"RTN","SAMIUR2",694,0)
 set contact=contact_"<br>"_$get(@vals@("sipsa"))
"RTN","SAMIUR2",695,0)
 if $get(@vals@("sipan"))'="" do
"RTN","SAMIUR2",696,0)
 . set contact=contact_" Apt "_$get(@vals@("sipan"))
"RTN","SAMIUR2",697,0)
 . quit
"RTN","SAMIUR2",698,0)
 if $get(@vals@("sipcn"))'="" do
"RTN","SAMIUR2",699,0)
 . set contact=contact_"<br>County "_@vals@("sipcn")
"RTN","SAMIUR2",700,0)
 . quit
"RTN","SAMIUR2",701,0)
 if $get(@vals@("sipc"))'="" do
"RTN","SAMIUR2",702,0)
 . set contact=contact_" <br>"_@vals@("sipc")_", "
"RTN","SAMIUR2",703,0)
 . quit
"RTN","SAMIUR2",704,0)
 set contact=contact_" "_$get(@vals@("sips"))_" "_$get(@vals@("sipz"))_"     "
"RTN","SAMIUR2",705,0)
 ;
"RTN","SAMIUR2",706,0)
 new phone set phone=$get(@vals@("sippn"))
"RTN","SAMIUR2",707,0)
 if phone'="" set contact=contact_" <br>Phone: "_phone
"RTN","SAMIUR2",708,0)
 ;
"RTN","SAMIUR2",709,0)
 quit contact ; end of ppi $$CONTACT^SAMIUR2
"RTN","SAMIUR2",710,0)
 ;
"RTN","SAMIUR2",711,0)
 ;
"RTN","SAMIUR2",712,0)
 ;
"RTN","SAMIUR2",713,0)
CTPROT(zdt,dfn,SAMIPATS) ; ct protocol
"RTN","SAMIUR2",714,0)
 ;
"RTN","SAMIUR2",715,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",716,0)
 ;@called-by
"RTN","SAMIUR2",717,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",718,0)
 ;@calls
"RTN","SAMIUR2",719,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",720,0)
 ;
"RTN","SAMIUR2",721,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",722,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",723,0)
 quit:ceform="" ""
"RTN","SAMIUR2",724,0)
 ;
"RTN","SAMIUR2",725,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",726,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",727,0)
 new cectp set cectp=$get(@vals@("cectp"))
"RTN","SAMIUR2",728,0)
 new ctyp set ctyp=$select(cectp="l":"Low-Dose CT",cectp="d":"Standard CT",cectp="i":"Limited",1:"")
"RTN","SAMIUR2",729,0)
 ;
"RTN","SAMIUR2",730,0)
 quit ctyp ; end of ppi $$CTPROT^SAMIUR2
"RTN","SAMIUR2",731,0)
 ;
"RTN","SAMIUR2",732,0)
 ;
"RTN","SAMIUR2",733,0)
 ;
"RTN","SAMIUR2",734,0)
DOB(ien,dfn,SAMIPATS) ; date of birth
"RTN","SAMIUR2",735,0)
 ;
"RTN","SAMIUR2",736,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",737,0)
 ;@called-by
"RTN","SAMIUR2",738,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",739,0)
 ;@calls
"RTN","SAMIUR2",740,0)
 ; $$TDDT
"RTN","SAMIUR2",741,0)
 ;
"RTN","SAMIUR2",742,0)
 new dob set dob=$get(SAMIPATS(ien,dfn,"dob"))
"RTN","SAMIUR2",743,0)
 if dob="" set dob=$get(SAMIPATS(ien,dfn,"sbdob"))
"RTN","SAMIUR2",744,0)
 ;
"RTN","SAMIUR2",745,0)
 quit $$TDDT(dob) ; end of ppi $$DOB^SAMIUR2
"RTN","SAMIUR2",746,0)
 ;
"RTN","SAMIUR2",747,0)
 ;
"RTN","SAMIUR2",748,0)
 ;
"RTN","SAMIUR2",749,0)
FUDATE(zdt,dfn,SAMIPATS) ; followup date
"RTN","SAMIUR2",750,0)
 ;
"RTN","SAMIUR2",751,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",752,0)
 ;@called-by
"RTN","SAMIUR2",753,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",754,0)
 ;@calls
"RTN","SAMIUR2",755,0)
 ; $TDDT
"RTN","SAMIUR2",756,0)
 ;
"RTN","SAMIUR2",757,0)
 new fud set fud="fudate"
"RTN","SAMIUR2",758,0)
 new date set date=$get(SAMIPATS(zdt,dfn,"cefud"))
"RTN","SAMIUR2",759,0)
 ;
"RTN","SAMIUR2",760,0)
 quit $$TDDT(date) ; end of ppi $$FUDATE^SAMIUR2
"RTN","SAMIUR2",761,0)
 ;
"RTN","SAMIUR2",762,0)
 ;
"RTN","SAMIUR2",763,0)
 ;
"RTN","SAMIUR2",764,0)
GENDER(zdt,dfn,SAMIPATS) ; gender
"RTN","SAMIUR2",765,0)
 ;
"RTN","SAMIUR2",766,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",767,0)
 ;@called-by
"RTN","SAMIUR2",768,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",769,0)
 ;@calls
"RTN","SAMIUR2",770,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",771,0)
 ;
"RTN","SAMIUR2",772,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",773,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",774,0)
 ;
"RTN","SAMIUR2",775,0)
 new gend set gend=$get(SAMIPATS(zdt,dfn,"gender"))
"RTN","SAMIUR2",776,0)
 if gend="" do
"RTN","SAMIUR2",777,0)
 . new pien set pien=$order(@root@("dfn",dfn,""))
"RTN","SAMIUR2",778,0)
 . if pien'="" do  ;
"RTN","SAMIUR2",779,0)
 . . set gend=$get(@root@(pien,"sex"))
"RTN","SAMIUR2",780,0)
 . . if gend="" set gend=$get(@root@(pien,"gender"))
"RTN","SAMIUR2",781,0)
 . . quit
"RTN","SAMIUR2",782,0)
 . if gend="" do  ;
"RTN","SAMIUR2",783,0)
 . . new lien set lien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR2",784,0)
 . . set gend=$get(@lroot@(lien,"gender"))
"RTN","SAMIUR2",785,0)
 . . quit
"RTN","SAMIUR2",786,0)
 if gend["^" set gend=$piece(gend,"^",1)
"RTN","SAMIUR2",787,0)
 ;
"RTN","SAMIUR2",788,0)
 quit gend ; end of ppi $$GENDER^SAMIUR2
"RTN","SAMIUR2",789,0)
 ;
"RTN","SAMIUR2",790,0)
 ;
"RTN","SAMIUR2",791,0)
 ;
"RTN","SAMIUR2",792,0)
IFORM(zdt,dfn,SAMIPATS) ; name(s) of incomplete forms
"RTN","SAMIUR2",793,0)
 ;
"RTN","SAMIUR2",794,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",795,0)
 ;@called-by
"RTN","SAMIUR2",796,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",797,0)
 ;@calls
"RTN","SAMIUR2",798,0)
 ; $$DFN2SID^SAMIUR2
"RTN","SAMIUR2",799,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMIUR2",800,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMIUR2",801,0)
 ; $$MKNAV
"RTN","SAMIUR2",802,0)
 ;
"RTN","SAMIUR2",803,0)
 new iform set iform=$get(SAMIPATS(zdt,dfn,"iform"))
"RTN","SAMIUR2",804,0)
 quit:iform="" ""  ;
"RTN","SAMIUR2",805,0)
 ;
"RTN","SAMIUR2",806,0)
 new zkey1,zn,typ
"RTN","SAMIUR2",807,0)
 new return set return="<table>"
"RTN","SAMIUR2",808,0)
 for zn=2:1  quit:$piece(iform," ",zn)=""  do  ;
"RTN","SAMIUR2",809,0)
 . set return=return_"<tr><td>"
"RTN","SAMIUR2",810,0)
 . set zkey1=$piece(iform," ",zn)
"RTN","SAMIUR2",811,0)
 . ;
"RTN","SAMIUR2",812,0)
 . new fname
"RTN","SAMIUR2",813,0)
 . if zkey1["ceform" set fname="CT Evaluation" set typ="ceform"
"RTN","SAMIUR2",814,0)
 . if zkey1["sbform" set fname="Background" set typ="sbform"
"RTN","SAMIUR2",815,0)
 . if zkey1["fuform" set fname="Participant Follow-up" set typ="fuform"
"RTN","SAMIUR2",816,0)
 . if zkey1["bxform" set fname="Biopsy" set typ="bxform"
"RTN","SAMIUR2",817,0)
 . if zkey1["ptform" set fname="PET Evaluation" set typ="ptform"
"RTN","SAMIUR2",818,0)
 . if zkey1["itform" set fname="Intervention" set typ="itform"
"RTN","SAMIUR2",819,0)
 . if zkey1["siform" set fname="Intake Form" set typ="siform"
"RTN","SAMIUR2",820,0)
 . if $get(fname)="" set fname="unknown" set typ=""
"RTN","SAMIUR2",821,0)
 . ;
"RTN","SAMIUR2",822,0)
 . new sid set sid=$$DFN2SID^SAMIUR2(dfn)
"RTN","SAMIUR2",823,0)
 . new zdate set zdate=$$VAPALSDT^SAMICASE($$KEY2FM^SAMICASE(zkey1))
"RTN","SAMIUR2",824,0)
 . set return=return_$$MKNAV(sid,zkey1,fname_" - "_zdate,typ)
"RTN","SAMIUR2",825,0)
 . set return=return_"</td></tr>"
"RTN","SAMIUR2",826,0)
 . quit
"RTN","SAMIUR2",827,0)
 ;
"RTN","SAMIUR2",828,0)
 set return=return_"</table>"
"RTN","SAMIUR2",829,0)
 ;
"RTN","SAMIUR2",830,0)
 quit return ; end of ppi $$IFORM^SAMIUR2
"RTN","SAMIUR2",831,0)
 ;
"RTN","SAMIUR2",832,0)
 ;
"RTN","SAMIUR2",833,0)
 ;
"RTN","SAMIUR2",834,0)
LASTEXM(zdt,dfn,SAMIPATS) ; patient last exam
"RTN","SAMIUR2",835,0)
 ;
"RTN","SAMIUR2",836,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",837,0)
 ;@called-by
"RTN","SAMIUR2",838,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",839,0)
 ;@calls
"RTN","SAMIUR2",840,0)
 ; $$TDDT
"RTN","SAMIUR2",841,0)
 ;
"RTN","SAMIUR2",842,0)
 new lexm set lexm=$get(SAMIPATS(zdt,dfn,"cedos"))
"RTN","SAMIUR2",843,0)
 ;
"RTN","SAMIUR2",844,0)
 quit $$TDDT(lexm) ; end of ppi $$LASTEXM^SAMIUR2
"RTN","SAMIUR2",845,0)
 ;
"RTN","SAMIUR2",846,0)
 ;
"RTN","SAMIUR2",847,0)
 ;
"RTN","SAMIUR2",848,0)
INACTDT(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",849,0)
 ;
"RTN","SAMIUR2",850,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",851,0)
 ;@called-by
"RTN","SAMIUR2",852,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",853,0)
 ;@calls
"RTN","SAMIUR2",854,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",855,0)
 ; $$TDDT
"RTN","SAMIUR2",856,0)
 ;
"RTN","SAMIUR2",857,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",858,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",859,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",860,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",861,0)
 ;
"RTN","SAMIUR2",862,0)
 quit $$TDDT($get(@vals@("sidod")))
"RTN","SAMIUR2",863,0)
 ;
"RTN","SAMIUR2",864,0)
 ;
"RTN","SAMIUR2",865,0)
 ;
"RTN","SAMIUR2",866,0)
INACTRE(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",867,0)
 ;
"RTN","SAMIUR2",868,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",869,0)
 ;@called-by
"RTN","SAMIUR2",870,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",871,0)
 ;@calls
"RTN","SAMIUR2",872,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",873,0)
 ;
"RTN","SAMIUR2",874,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",875,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",876,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",877,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",878,0)
 ;
"RTN","SAMIUR2",879,0)
 quit $get(@vals@("sistachg"))
"RTN","SAMIUR2",880,0)
 ;
"RTN","SAMIUR2",881,0)
 ;
"RTN","SAMIUR2",882,0)
 ;
"RTN","SAMIUR2",883,0)
INACTCM(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",884,0)
 ;
"RTN","SAMIUR2",885,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",886,0)
 ;@called-by
"RTN","SAMIUR2",887,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",888,0)
 ;@calls
"RTN","SAMIUR2",889,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",890,0)
 ;
"RTN","SAMIUR2",891,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",892,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",893,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",894,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",895,0)
 ;
"RTN","SAMIUR2",896,0)
 quit $get(@vals@("sistreas"))
"RTN","SAMIUR2",897,0)
 ;
"RTN","SAMIUR2",898,0)
 ;
"RTN","SAMIUR2",899,0)
 ;
"RTN","SAMIUR2",900,0)
LDE(zdt,dfn,SAMIPATS) ; last date and entry in com log
"RTN","SAMIUR2",901,0)
 ;
"RTN","SAMIUR2",902,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",903,0)
 ;@called-by
"RTN","SAMIUR2",904,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",905,0)
 ;@calls
"RTN","SAMIUR2",906,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",907,0)
 ;
"RTN","SAMIUR2",908,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",909,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",910,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",911,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",912,0)
 ;
"RTN","SAMIUR2",913,0)
 n comien,comdt,comntry
"RTN","SAMIUR2",914,0)
 s (comdt,comntry)=""
"RTN","SAMIUR2",915,0)
 s comien=$o(@vals@("comlog"," "),-1)
"RTN","SAMIUR2",916,0)
 i comien="" d  q comdt
"RTN","SAMIUR2",917,0)
 . s comdt=$g(@vals@("sidc"))
"RTN","SAMIUR2",918,0)
 s comntry=$g(@vals@("comlog",comien))
"RTN","SAMIUR2",919,0)
 s comdt=$p($p(comntry,"[",2),"@",1)
"RTN","SAMIUR2",920,0)
 ;
"RTN","SAMIUR2",921,0)
 quit comdt_"^"_comntry
"RTN","SAMIUR2",922,0)
 ;
"RTN","SAMIUR2",923,0)
 ;
"RTN","SAMIUR2",924,0)
 ;
"RTN","SAMIUR2",925,0)
LDOC(zdt,dfn,SAMIPATS) ; last date of contact
"RTN","SAMIUR2",926,0)
 ;
"RTN","SAMIUR2",927,0)
 quit $$TDDT($piece($$LDE(zdt,dfn,.SAMIPATS),"^",1))
"RTN","SAMIUR2",928,0)
 ;
"RTN","SAMIUR2",929,0)
 ;
"RTN","SAMIUR2",930,0)
 ;
"RTN","SAMIUR2",931,0)
LENTRY(zdt,dfn,SAMIPATS) ; last contact entry
"RTN","SAMIUR2",932,0)
 ;
"RTN","SAMIUR2",933,0)
 quit $piece($$LDE(zdt,dfn,.SAMIPATS),"^",2)
"RTN","SAMIUR2",934,0)
 ;
"RTN","SAMIUR2",935,0)
 ;
"RTN","SAMIUR2",936,0)
 ;
"RTN","SAMIUR2",937,0)
MANPAT(ien,dfn,SAMIPATS) ; unmatched patient cell
"RTN","SAMIUR2",938,0)
 ;
"RTN","SAMIUR2",939,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",940,0)
 ;@called-by
"RTN","SAMIUR2",941,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",942,0)
 ;@calls
"RTN","SAMIUR2",943,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",944,0)
 ;
"RTN","SAMIUR2",945,0)
 new zcell set zcell=""
"RTN","SAMIUR2",946,0)
 ; set zcell=zcell_$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR2",947,0)
 set zcell=zcell_$get(SAMIPATS(ien,dfn,"editref"))
"RTN","SAMIUR2",948,0)
 set zcell=zcell_"<br>Date of Birth: "_$get(SAMIPATS(ien,dfn,"dob"))
"RTN","SAMIUR2",949,0)
 set zcell=zcell_" Gender: "_$get(SAMIPATS(ien,dfn,"sex"))
"RTN","SAMIUR2",950,0)
 ;
"RTN","SAMIUR2",951,0)
 new ssn set ssn=$get(SAMIPATS(ien,dfn,"ssn"))
"RTN","SAMIUR2",952,0)
 if ssn="" do  ;
"RTN","SAMIUR2",953,0)
 . new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",954,0)
 . new tssn set tssn=$get(@lroot@(ien,"ssn"))
"RTN","SAMIUR2",955,0)
 . set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",956,0)
 . quit
"RTN","SAMIUR2",957,0)
 set zcell=zcell_"<br>SSN: "_ssn
"RTN","SAMIUR2",958,0)
 ;
"RTN","SAMIUR2",959,0)
 set zcell=zcell_"<br>dfn: "_dfn
"RTN","SAMIUR2",960,0)
 ;
"RTN","SAMIUR2",961,0)
 quit zcell ; end of ppi $$MANPAT^SAMIUR2
"RTN","SAMIUR2",962,0)
 ;
"RTN","SAMIUR2",963,0)
 ;
"RTN","SAMIUR2",964,0)
 ;
"RTN","SAMIUR2",965,0)
MATCH(ien,dfn,SAMIPATS) ; match button cell
"RTN","SAMIUR2",966,0)
 ;
"RTN","SAMIUR2",967,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",968,0)
 ;@called-by
"RTN","SAMIUR2",969,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",970,0)
 ;@calls none
"RTN","SAMIUR2",971,0)
 ;
"RTN","SAMIUR2",972,0)
 new matien set matien=$get(SAMIPATS(ien,dfn,"MATCHLOG"))
"RTN","SAMIUR2",973,0)
 quit:matien="" ""
"RTN","SAMIUR2",974,0)
 ;
"RTN","SAMIUR2",975,0)
 new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR2",976,0)
 set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""merge"">"
"RTN","SAMIUR2",977,0)
 set nuhref=nuhref_"<input type=hidden name=""toien"" value="_ien_">"
"RTN","SAMIUR2",978,0)
 set nuhref=nuhref_"<input value=""Merge"" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR2",979,0)
 ;
"RTN","SAMIUR2",980,0)
 quit nuhref ; end of ppi $$MATCH^SAMIUR2
"RTN","SAMIUR2",981,0)
 ;
"RTN","SAMIUR2",982,0)
 ;
"RTN","SAMIUR2",983,0)
 ;
"RTN","SAMIUR2",984,0)
NAME(zdt,dfn,SAMIPATS) ; name w/hyperlink
"RTN","SAMIUR2",985,0)
 ;
"RTN","SAMIUR2",986,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",987,0)
 ;@called-by
"RTN","SAMIUR2",988,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",989,0)
 ;@calls none
"RTN","SAMIUR2",990,0)
 ;
"RTN","SAMIUR2",991,0)
 new nam set nam="Name"
"RTN","SAMIUR2",992,0)
 ;
"RTN","SAMIUR2",993,0)
 quit $get(SAMIPATS(zdt,dfn,"nuhref")) ; end of ppi $$NAME^SAMIUR2
"RTN","SAMIUR2",994,0)
 ;
"RTN","SAMIUR2",995,0)
 ;
"RTN","SAMIUR2",996,0)
 ;
"RTN","SAMIUR2",997,0)
PACKYRS(zdt,dfn,SAMIPATS) ; smoking status
"RTN","SAMIUR2",998,0)
 ;
"RTN","SAMIUR2",999,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1000,0)
 ;@called-by
"RTN","SAMIUR2",1001,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1002,0)
 ;@calls
"RTN","SAMIUR2",1003,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1004,0)
 ;
"RTN","SAMIUR2",1005,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1006,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1007,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1008,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1009,0)
 new pkyrs set pkyrs=$get(@vals@("sippy"))
"RTN","SAMIUR2",1010,0)
 ;
"RTN","SAMIUR2",1011,0)
 quit pkyrs ; end of ppi $$PACKYRS^SAMIUR2
"RTN","SAMIUR2",1012,0)
 ;
"RTN","SAMIUR2",1013,0)
 ;
"RTN","SAMIUR2",1014,0)
 ;
"RTN","SAMIUR2",1015,0)
POSSIBLE(ien,dfn,SAMIPATS) ; possible match cell
"RTN","SAMIUR2",1016,0)
 ;
"RTN","SAMIUR2",1017,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1018,0)
 ;@called-by
"RTN","SAMIUR2",1019,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1020,0)
 ;@calls
"RTN","SAMIUR2",1021,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1022,0)
 ;
"RTN","SAMIUR2",1023,0)
 new zcell set zcell=""
"RTN","SAMIUR2",1024,0)
 new matien set matien=$get(SAMIPATS(ien,dfn,"MATCHLOG"))
"RTN","SAMIUR2",1025,0)
 quit:matien="" zcell
"RTN","SAMIUR2",1026,0)
 ;
"RTN","SAMIUR2",1027,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",1028,0)
 quit:'$data(@lroot@(matien)) zcell
"RTN","SAMIUR2",1029,0)
 ;
"RTN","SAMIUR2",1030,0)
 set zcell=zcell_$get(@lroot@(matien,"saminame"))
"RTN","SAMIUR2",1031,0)
 set zcell=zcell_"<br>Date of Birth: "_$get(@lroot@(matien,"sbdob"))
"RTN","SAMIUR2",1032,0)
 set zcell=zcell_" Gender: "_$get(@lroot@(matien,"sex"))
"RTN","SAMIUR2",1033,0)
 ;
"RTN","SAMIUR2",1034,0)
 new tssn set tssn=$get(@lroot@(matien,"ssn"))
"RTN","SAMIUR2",1035,0)
 new ssn set ssn=tssn
"RTN","SAMIUR2",1036,0)
 if tssn'["-" set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",1037,0)
 set zcell=zcell_"<br>SSN: "_ssn
"RTN","SAMIUR2",1038,0)
 ;
"RTN","SAMIUR2",1039,0)
 set zcell=zcell_"<br>dfn: "_$get(@lroot@(matien,"dfn"))
"RTN","SAMIUR2",1040,0)
 ;
"RTN","SAMIUR2",1041,0)
 quit zcell ; end of ppi $$POSSIBLE^SAMIUR2
"RTN","SAMIUR2",1042,0)
 ;
"RTN","SAMIUR2",1043,0)
 ;
"RTN","SAMIUR2",1044,0)
 ;
"RTN","SAMIUR2",1045,0)
RECOM(zdt,dfn,SAMIPATS) ; recommendation
"RTN","SAMIUR2",1046,0)
 ;
"RTN","SAMIUR2",1047,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1048,0)
 ;@called-by
"RTN","SAMIUR2",1049,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1050,0)
 ;@calls
"RTN","SAMIUR2",1051,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1052,0)
 ;
"RTN","SAMIUR2",1053,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1054,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1055,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1056,0)
 ;
"RTN","SAMIUR2",1057,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1058,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1059,0)
 new cefuw set cefuw=$get(@vals@("cefuw"))
"RTN","SAMIUR2",1060,0)
 ;
"RTN","SAMIUR2",1061,0)
 new recom set recom=""
"RTN","SAMIUR2",1062,0)
 set recom=$select(cefuw="1y":"Annual Repeat",cefuw="nw":"Now",cefuw="1m":"1 month",cefuw="3m":"3 months",cefuw="6m":"6 months",cefuw="os":"Other",1:"")
"RTN","SAMIUR2",1063,0)
 if $get(@vals@("cefuaf"))="y" set recom=recom_", Antibiotics"
"RTN","SAMIUR2",1064,0)
 if $get(@vals@("cefucc"))="y" set recom=recom_", Contrast CT"
"RTN","SAMIUR2",1065,0)
 if $get(@vals@("cefupe"))="y" set recom=recom_", PET"
"RTN","SAMIUR2",1066,0)
 if $get(@vals@("cefufn"))="y" set recom=recom_", Percutaneous biopsy"
"RTN","SAMIUR2",1067,0)
 if $get(@vals@("cefubr"))="y" set recom=recom_", Bronchoscopy"
"RTN","SAMIUR2",1068,0)
 if $get(@vals@("cefupc"))="y" set recom=recom_", Pulmonary consultation"
"RTN","SAMIUR2",1069,0)
 if $get(@vals@("cefutb"))="y" set recom=recom_", Refer to tumor board"
"RTN","SAMIUR2",1070,0)
 if $get(@vals@("cefunf"))="y" set recom=recom_", No other further follow-up"
"RTN","SAMIUR2",1071,0)
 if $extract(recom,1,2)=", " set recom=$extract(recom,3,$length(recom))
"RTN","SAMIUR2",1072,0)
 ;
"RTN","SAMIUR2",1073,0)
 quit recom ; end of ppi $$RECOM^SAMIUR2
"RTN","SAMIUR2",1074,0)
 ;
"RTN","SAMIUR2",1075,0)
 ;
"RTN","SAMIUR2",1076,0)
 ;
"RTN","SAMIUR2",1077,0)
RURAL(zdt,dfn,SAMIPATS) ; patient's rural/urban status
"RTN","SAMIUR2",1078,0)
 ;
"RTN","SAMIUR2",1079,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1080,0)
 ;@called-by
"RTN","SAMIUR2",1081,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1082,0)
 ;@calls
"RTN","SAMIUR2",1083,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1084,0)
 ;
"RTN","SAMIUR2",1085,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1086,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1087,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1088,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1089,0)
 new sirs set sirs=$get(@vals@("sirs"))
"RTN","SAMIUR2",1090,0)
 set sirs=$select(sirs="r":"rural",sirs="u":"urban",sirs="n":"unknown",1:"unknown")
"RTN","SAMIUR2",1091,0)
 ;
"RTN","SAMIUR2",1092,0)
 quit sirs ; end of ppi $$RURAL^SAMIUR2
"RTN","SAMIUR2",1093,0)
 ;
"RTN","SAMIUR2",1094,0)
 ;
"RTN","SAMIUR2",1095,0)
 ;
"RTN","SAMIUR2",1096,0)
SID(zdt,dfn,SAMIPATS) ; study ID
"RTN","SAMIUR2",1097,0)
 ;
"RTN","SAMIUR2",1098,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1099,0)
 ;@called-by
"RTN","SAMIUR2",1100,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1101,0)
 ;@calls
"RTN","SAMIUR2",1102,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1103,0)
 ;
"RTN","SAMIUR2",1104,0)
 quit $$DFN2SID(dfn) ; end of ppi $$SID^SAMIUR2
"RTN","SAMIUR2",1105,0)
 ;
"RTN","SAMIUR2",1106,0)
 ;
"RTN","SAMIUR2",1107,0)
 ;
"RTN","SAMIUR2",1108,0)
SMHIS(zdt,dfn,SAMIPATS) ; smoking history cell
"RTN","SAMIUR2",1109,0)
 ;
"RTN","SAMIUR2",1110,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1111,0)
 ;@called-by
"RTN","SAMIUR2",1112,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1113,0)
 ;@calls
"RTN","SAMIUR2",1114,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1115,0)
 ; $$SHDET
"RTN","SAMIUR2",1116,0)
 ;
"RTN","SAMIUR2",1117,0)
 new zrtn set zrtn=""
"RTN","SAMIUR2",1118,0)
 set zrtn=zrtn_"<div class=""row""><div class=""col-md-12""><table class=""table"" id=""pack-years-history"">"
"RTN","SAMIUR2",1119,0)
 set zrtn=zrtn_"<thead><tr><th>Form </th><th> Reported Date </th>"
"RTN","SAMIUR2",1120,0)
 set zrtn=zrtn_"<th>Pack Years</th><th>Cumulative</th></tr></thead><tbody>"
"RTN","SAMIUR2",1121,0)
 set zrtn=zrtn_$$SHDET($$DFN2SID(dfn))
"RTN","SAMIUR2",1122,0)
 set zrtn=zrtn_"</tbody></table></div></div>"
"RTN","SAMIUR2",1123,0)
 ;
"RTN","SAMIUR2",1124,0)
 quit zrtn ; end of ppi $$SMHIS^SAMIUR2
"RTN","SAMIUR2",1125,0)
 ;
"RTN","SAMIUR2",1126,0)
 ;
"RTN","SAMIUR2",1127,0)
 ;
"RTN","SAMIUR2",1128,0)
SMKSTAT(zdt,dfn,SAMIPATS) ; smoking status
"RTN","SAMIUR2",1129,0)
 ;
"RTN","SAMIUR2",1130,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1131,0)
 ;@called-by
"RTN","SAMIUR2",1132,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1133,0)
 ;@calls
"RTN","SAMIUR2",1134,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1135,0)
 ;
"RTN","SAMIUR2",1136,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1137,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1138,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1139,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1140,0)
 ;
"RTN","SAMIUR2",1141,0)
 new smk set smk="unknown"
"RTN","SAMIUR2",1142,0)
 if $get(@vals@("siesm"))="n" set smk="Never smoked"
"RTN","SAMIUR2",1143,0)
 if $get(@vals@("siesm"))="p" set smk="Past smoker"
"RTN","SAMIUR2",1144,0)
 if $get(@vals@("siesm"))="c" set smk="Current smoker"
"RTN","SAMIUR2",1145,0)
 ; if $get(@vals@("siesq"))=1 set smk="Cu"
"RTN","SAMIUR2",1146,0)
 ;
"RTN","SAMIUR2",1147,0)
 quit smk ; end of ppi $$SMKSTAT^SAMIUR2
"RTN","SAMIUR2",1148,0)
 ;
"RTN","SAMIUR2",1149,0)
 ;
"RTN","SAMIUR2",1150,0)
 ;
"RTN","SAMIUR2",1151,0)
SSN(zdt,dfn,SAMIPATS) ; social security number
"RTN","SAMIUR2",1152,0)
 ;
"RTN","SAMIUR2",1153,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1154,0)
 ;@called-by
"RTN","SAMIUR2",1155,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1156,0)
 ;@calls none
"RTN","SAMIUR2",1157,0)
 ;
"RTN","SAMIUR2",1158,0)
 Q $$GETUID^SAMIUID(dfn)
"RTN","SAMIUR2",1159,0)
 ;
"RTN","SAMIUR2",1160,0)
 new tssn set tssn=$get(SAMIPATS(zdt,dfn,"ssn"))
"RTN","SAMIUR2",1161,0)
 new ssn set ssn=tssn
"RTN","SAMIUR2",1162,0)
 if ssn'["-" do
"RTN","SAMIUR2",1163,0)
 . set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",1164,0)
 . quit
"RTN","SAMIUR2",1165,0)
 ;
"RTN","SAMIUR2",1166,0)
 quit ssn ; end of ppi $$SSN^SAMIUR2
"RTN","SAMIUR2",1167,0)
 ;
"RTN","SAMIUR2",1168,0)
 ;
"RTN","SAMIUR2",1169,0)
 ;
"RTN","SAMIUR2",1170,0)
SSNLABEL(SITE) ; extrinsic returns label for SSN (ie PID)
"RTN","SAMIUR2",1171,0)
 new RTN
"RTN","SAMIUR2",1172,0)
 set RTN=$$GET1PARM^SAMIPARM("socialSecurityNumber",SITE)
"RTN","SAMIUR2",1173,0)
 if RTN="" set RTN="SSN"
"RTN","SAMIUR2",1174,0)
 quit RTN
"RTN","SAMIUR2",1175,0)
 ;
"RTN","SAMIUR2",1176,0)
 ;
"RTN","SAMIUR2",1177,0)
 ;
"RTN","SAMIUR2",1178,0)
STUDYDT(zdt,dfn,SAMIPATS) ; latest study date
"RTN","SAMIUR2",1179,0)
 ;
"RTN","SAMIUR2",1180,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1181,0)
 ;@called-by
"RTN","SAMIUR2",1182,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1183,0)
 ;@calls
"RTN","SAMIUR2",1184,0)
 ; $$TDDT
"RTN","SAMIUR2",1185,0)
 ;
"RTN","SAMIUR2",1186,0)
 new stdt set stdt=$get(SAMIPATS(zdt,dfn,"cedos"))
"RTN","SAMIUR2",1187,0)
 ;
"RTN","SAMIUR2",1188,0)
 quit $$TDDT(stdt) ; end of ppi $$STUDYDT^SAMIUR2
"RTN","SAMIUR2",1189,0)
 ;
"RTN","SAMIUR2",1190,0)
 ;
"RTN","SAMIUR2",1191,0)
 ;
"RTN","SAMIUR2",1192,0)
STUDYTYP(zdt,dfn,SAMIPATS) ; latest study type
"RTN","SAMIUR2",1193,0)
 ;
"RTN","SAMIUR2",1194,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1195,0)
 ;@called-by
"RTN","SAMIUR2",1196,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1197,0)
 ;@calls
"RTN","SAMIUR2",1198,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1199,0)
 ;
"RTN","SAMIUR2",1200,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1201,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1202,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1203,0)
 ;
"RTN","SAMIUR2",1204,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1205,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1206,0)
 new stypx set stypx=$get(@vals@("cetex"))
"RTN","SAMIUR2",1207,0)
 new styp set styp=$select(stypx="a":"Annual",stypx="b":"Baseline",stypx="d":"Followup",1:"")
"RTN","SAMIUR2",1208,0)
 ;
"RTN","SAMIUR2",1209,0)
 quit styp ; end of ppi $$STUDYTYP^SAMIUR2
"RTN","SAMIUR2",1210,0)
 ;
"RTN","SAMIUR2",1211,0)
 ;
"RTN","SAMIUR2",1212,0)
 ;
"RTN","SAMIUR2",1213,0)
VALS(zdt,dfn,SAMIPATS) ; form-values cell
"RTN","SAMIUR2",1214,0)
 ;
"RTN","SAMIUR2",1215,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1216,0)
 ;@called-by
"RTN","SAMIUR2",1217,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1218,0)
 ;@calls
"RTN","SAMIUR2",1219,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1220,0)
 ;
"RTN","SAMIUR2",1221,0)
 new vrtn set vrtn=""
"RTN","SAMIUR2",1222,0)
 new vsid set vsid=$$DFN2SID(dfn)
"RTN","SAMIUR2",1223,0)
 new vgr set vgr="/vals?sid="_vsid_"&form="
"RTN","SAMIUR2",1224,0)
 quit:'$data(SAMIPATS)
"RTN","SAMIUR2",1225,0)
 ;
"RTN","SAMIUR2",1226,0)
 new vzi set vzi=""
"RTN","SAMIUR2",1227,0)
 for  do  quit:vzi="sort"  quit:vzi=""
"RTN","SAMIUR2",1228,0)
 . set vzi=$order(SAMIPATS(zdt,dfn,"items",vzi))
"RTN","SAMIUR2",1229,0)
 . quit:vzi="sort"
"RTN","SAMIUR2",1230,0)
 . quit:vzi=""
"RTN","SAMIUR2",1231,0)
 . set vrtn=vrtn_"<a href="""_vgr_vzi_""">"_vzi_"</a><br>"
"RTN","SAMIUR2",1232,0)
 . quit
"RTN","SAMIUR2",1233,0)
 ;
"RTN","SAMIUR2",1234,0)
 quit vrtn ; end of $$VALS^SAMIUR2
"RTN","SAMIUR2",1235,0)
 ;
"RTN","SAMIUR2",1236,0)
 ;
"RTN","SAMIUR2",1237,0)
 ;
"RTN","SAMIUR2",1238,0)
WHEN(zdt,dfn,SAMIPATS) ; followup text
"RTN","SAMIUR2",1239,0)
 ;
"RTN","SAMIUR2",1240,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1241,0)
 ;@called-by
"RTN","SAMIUR2",1242,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1243,0)
 ;@calls
"RTN","SAMIUR2",1244,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1245,0)
 ;
"RTN","SAMIUR2",1246,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1247,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1248,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1249,0)
 ;
"RTN","SAMIUR2",1250,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1251,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1252,0)
 new whnx set whnx=$get(@vals@("cefuw"))
"RTN","SAMIUR2",1253,0)
 quit:whnx="" ""
"RTN","SAMIUR2",1254,0)
 ;
"RTN","SAMIUR2",1255,0)
 new DICT
"RTN","SAMIUR2",1256,0)
 set DICT("cefuw","1m")="in one month"
"RTN","SAMIUR2",1257,0)
 set DICT("cefuw","1y")="in one year"
"RTN","SAMIUR2",1258,0)
 set DICT("cefuw","3m")="in three months"
"RTN","SAMIUR2",1259,0)
 set DICT("cefuw","6m")="in six months"
"RTN","SAMIUR2",1260,0)
 set DICT("cefuw","os")="other as specified"
"RTN","SAMIUR2",1261,0)
 set whn=$get(DICT("cefuw",whnx))
"RTN","SAMIUR2",1262,0)
 ;
"RTN","SAMIUR2",1263,0)
 quit whn ; end of ppi $$WHEN^SAMIUR2
"RTN","SAMIUR2",1264,0)
 ;
"RTN","SAMIUR2",1265,0)
 ;
"RTN","SAMIUR2",1266,0)
 ;
"RTN","SAMIUR2",1267,0)
WORKPAT(ien,dfn,SAMIPATS) ; worklist patient name cell
"RTN","SAMIUR2",1268,0)
 ;
"RTN","SAMIUR2",1269,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1270,0)
 ;@called-by
"RTN","SAMIUR2",1271,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1272,0)
 ;@calls none
"RTN","SAMIUR2",1273,0)
 ;
"RTN","SAMIUR2",1274,0)
 new zcell set zcell=""
"RTN","SAMIUR2",1275,0)
 set zcell=zcell_$get(SAMIPATS(ien,dfn,"workref"))
"RTN","SAMIUR2",1276,0)
 ;
"RTN","SAMIUR2",1277,0)
 quit zcell ; end of ppi $$WORKPAT^SAMIUR2
"RTN","SAMIUR2",1278,0)
 ;
"RTN","SAMIUR2",1279,0)
 ;
"RTN","SAMIUR2",1280,0)
 ;
"RTN","SAMIUR2",1281,0)
 ;@section 5 unused subroutines
"RTN","SAMIUR2",1282,0)
 ;
"RTN","SAMIUR2",1283,0)
 ;
"RTN","SAMIUR2",1284,0)
 ;
"RTN","SAMIUR2",1285,0)
EPAT(ien,dfn,SAMIPATS) ; patient name w/nav to enrollment
"RTN","SAMIUR2",1286,0)
 ;
"RTN","SAMIUR2",1287,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIUR2",1288,0)
 ;@called-by none
"RTN","SAMIUR2",1289,0)
 ;@calls none
"RTN","SAMIUR2",1290,0)
 ;
"RTN","SAMIUR2",1291,0)
 quit  ; end of $$EPAT
"RTN","SAMIUR2",1292,0)
 ;
"RTN","SAMIUR2",1293,0)
 ;
"RTN","SAMIUR2",1294,0)
 ;
"RTN","SAMIUR2",1295,0)
ETHNCTY(zdt,dfn,SAMIPATS) ; ethnicity
"RTN","SAMIUR2",1296,0)
 ;
"RTN","SAMIUR2",1297,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1298,0)
 ;@called-by none
"RTN","SAMIUR2",1299,0)
 ;@calls none
"RTN","SAMIUR2",1300,0)
 ;
"RTN","SAMIUR2",1301,0)
 quit "ethnicity" ; end of $$ETHNCTY
"RTN","SAMIUR2",1302,0)
 ;
"RTN","SAMIUR2",1303,0)
 ;
"RTN","SAMIUR2",1304,0)
 ;
"RTN","SAMIUR2",1305,0)
RACE(zdt,dfn,SAMIPATS) ; race
"RTN","SAMIUR2",1306,0)
 ;
"RTN","SAMIUR2",1307,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1308,0)
 ;@called-by none [call commented out in RPTTBL]
"RTN","SAMIUR2",1309,0)
 ;@calls
"RTN","SAMIUR2",1310,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1311,0)
 ;
"RTN","SAMIUR2",1312,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1313,0)
 new race set race=$get(@root@(dfn,"race"))
"RTN","SAMIUR2",1314,0)
 ;
"RTN","SAMIUR2",1315,0)
 quit race ; end of $$RACE
"RTN","SAMIUR2",1316,0)
 ;
"RTN","SAMIUR2",1317,0)
 ;
"RTN","SAMIUR2",1318,0)
 ;
"RTN","SAMIUR2",1319,0)
STATUS(zdt,dfn,SAMIPATS) ; patient status
"RTN","SAMIUR2",1320,0)
 ;
"RTN","SAMIUR2",1321,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1322,0)
 ;@called-by none
"RTN","SAMIUR2",1323,0)
 ;@calls
"RTN","SAMIUR2",1324,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1325,0)
 ;
"RTN","SAMIUR2",1326,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1327,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1328,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1329,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1330,0)
 new stat set stat=$get(@vals@("sistatus"))
"RTN","SAMIUR2",1331,0)
 ;
"RTN","SAMIUR2",1332,0)
 quit stat ; end of $$STATUS
"RTN","SAMIUR2",1333,0)
 ;
"RTN","SAMIUR2",1334,0)
 ;
"RTN","SAMIUR2",1335,0)
 ;
"RTN","SAMIUR2",1336,0)
WSVALS(RTN,FILTER) ; display form values from graph
"RTN","SAMIUR2",1337,0)
 ;
"RTN","SAMIUR2",1338,0)
 ;;web service;procedure;clean;silent;sac
"RTN","SAMIUR2",1339,0)
 ;@called-by none
"RTN","SAMIUR2",1340,0)
 ;@calls
"RTN","SAMIUR2",1341,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1342,0)
 ; wsGtree^SYNVPR
"RTN","SAMIUR2",1343,0)
 ;
"RTN","SAMIUR2",1344,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1345,0)
 new sid set sid=$get(FILTER("sid"))
"RTN","SAMIUR2",1346,0)
 if sid="" set sid=$get(FILTER("studyid"))
"RTN","SAMIUR2",1347,0)
 quit:sid=""
"RTN","SAMIUR2",1348,0)
 ;
"RTN","SAMIUR2",1349,0)
 new zform set zform=$get(FILTER("form"))
"RTN","SAMIUR2",1350,0)
 new groot
"RTN","SAMIUR2",1351,0)
 if zform="" set groot=$name(@root@("graph",sid))
"RTN","SAMIUR2",1352,0)
 else  set groot=$name(@root@("graph",sid,zform))
"RTN","SAMIUR2",1353,0)
 set FILTER("root")=$extract(groot,2,$length(groot))
"RTN","SAMIUR2",1354,0)
 ;
"RTN","SAMIUR2",1355,0)
 do wsGtree^SYNVPR(.RTN,.FILTER)
"RTN","SAMIUR2",1356,0)
 ;
"RTN","SAMIUR2",1357,0)
 quit  ; end of ws WSVALS^SAMIUR2
"RTN","SAMIUR2",1358,0)
 ;
"RTN","SAMIUR2",1359,0)
 ;
"RTN","SAMIUR2",1360,0)
 ;
"RTN","SAMIUR2",1361,0)
EOR ; end of routine SAMIUR2
"RTN","SAMIURUL")
0^13^B118219^B116379
"RTN","SAMIURUL",1,0)
SAMIURUL ;ven/gpl - user reports log; 2024-09-10t05:01z
"RTN","SAMIURUL",2,0)
 ;;18.0;SAMI;**12,14,15,17,18**;2020-01-17;Build 1
"RTN","SAMIURUL",3,0)
 ;mdc-e1;SAMIURUL-20240910-EE7ZuE;SAMI-18-18-b1
"RTN","SAMIURUL",4,0)
 ;mdc-v7;B118219;SAMI*18.0*18 SEQ #18
"RTN","SAMIURUL",5,0)
 ;
"RTN","SAMIURUL",6,0)
 ; SAMIURUL contains the development log & module documentation for
"RTN","SAMIURUL",7,0)
 ; the ScreeningPlus user-reports routines SAMIUR & SAMIUR2. It
"RTN","SAMIURUL",8,0)
 ; contains no public interfaces or executable code.
"RTN","SAMIURUL",9,0)
 ;
"RTN","SAMIURUL",10,0)
 quit  ; no entry from top
"RTN","SAMIURUL",11,0)
 ;
"RTN","SAMIURUL",12,0)
 ;
"RTN","SAMIURUL",13,0)
 ;
"RTN","SAMIURUL",14,0)
 ;
"RTN","SAMIURUL",15,0)
 ;@section 0 primary development
"RTN","SAMIURUL",16,0)
 ;
"RTN","SAMIURUL",17,0)
 ;
"RTN","SAMIURUL",18,0)
 ;
"RTN","SAMIURUL",19,0)
 ;
"RTN","SAMIURUL",20,0)
 ;@routine-credits
"RTN","SAMIURUL",21,0)
 ;
"RTN","SAMIURUL",22,0)
 ;@dev Frederick D. S. Marshall (toad)
"RTN","SAMIURUL",23,0)
 ; toad@vistaexpertise.net
"RTN","SAMIURUL",24,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIURUL",25,0)
 ; http://vistaexpertise.net
"RTN","SAMIURUL",26,0)
 ;@copyright 2021/2024, mcglk & toad, all rights reserved
"RTN","SAMIURUL",27,0)
 ;@license see routine SAMIUL
"RTN","SAMIURUL",28,0)
 ;
"RTN","SAMIURUL",29,0)
 ;@update 2024-09-10t05:01z
"RTN","SAMIURUL",30,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIURUL",31,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIURUL",32,0)
 ;@module User Reports - SAMIUR
"RTN","SAMIURUL",33,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIURUL",34,0)
 ;@release 18-18
"RTN","SAMIURUL",35,0)
 ;@edition-date 2020-01-17
"RTN","SAMIURUL",36,0)
 ;@patches **12,14,15,17,18**
"RTN","SAMIURUL",37,0)
 ;
"RTN","SAMIURUL",38,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIURUL",39,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIURUL",40,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIURUL",41,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIURUL",42,0)
 ;
"RTN","SAMIURUL",43,0)
 ;@module-credits
"RTN","SAMIURUL",44,0)
 ;
"RTN","SAMIURUL",45,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIURUL",46,0)
 ; (VA-PALS)
"RTN","SAMIURUL",47,0)
 ; http://va-pals.org/
"RTN","SAMIURUL",48,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIURUL",49,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIURUL",50,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIURUL",51,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIURUL",52,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIURUL",53,0)
 ; http://ielcap.com/
"RTN","SAMIURUL",54,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIURUL",55,0)
 ; http://paraxialtech.com/
"RTN","SAMIURUL",56,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIURUL",57,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIURUL",58,0)
 ;
"RTN","SAMIURUL",59,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIURUL",60,0)
 ;
"RTN","SAMIURUL",61,0)
 ; 2020-02-10/12 ven/gpl 18-t4 d543f7bb,f9869dfb,0e4d8b9a,5e67489f
"RTN","SAMIURUL",62,0)
 ;  SAMIUR,SAMIUR2 1st version of revised user reports, progress on
"RTN","SAMIURUL",63,0)
 ; user reports, fixed a bug in enrollment report, add rural/urban &
"RTN","SAMIURUL",64,0)
 ; compute.
"RTN","SAMIURUL",65,0)
 ;
"RTN","SAMIURUL",66,0)
 ; 2020-02-18 ven/lgc 18-t4 76874314
"RTN","SAMIURUL",67,0)
 ;  SAMIUR update recently edited routines.
"RTN","SAMIURUL",68,0)
 ;
"RTN","SAMIURUL",69,0)
 ; 2020-03-10/12 ven/gpl 18-t4 8de06b06,4ad52d64
"RTN","SAMIURUL",70,0)
 ;  SAMIUR user report date filtering, fix end date logic in UR.
"RTN","SAMIURUL",71,0)
 ;
"RTN","SAMIURUL",72,0)
 ; 2019-03-24/28 ven/gpl 18-t4 1fd4a4c8,0cebb36b
"RTN","SAMIURUL",73,0)
 ;  SAMIUR2 revise incomplete form report, remove ethnicity from
"RTN","SAMIURUL",74,0)
 ; enrollment report (we can't get it).
"RTN","SAMIURUL",75,0)
 ;
"RTN","SAMIURUL",76,0)
 ; 2020-04-16/23 ven/lgc 18-t4 e54b76d1b,89bffd3b
"RTN","SAMIURUL",77,0)
 ;  SAMIUR SAMIFRM2 > SAMIFORM, SAMISUB2 > LOAD.
"RTN","SAMIURUL",78,0)
 ;
"RTN","SAMIURUL",79,0)
 ; 2019-05-08 ven/lgc 18 2172e512
"RTN","SAMIURUL",80,0)
 ;  SAMIUR2 remove blank last line.
"RTN","SAMIURUL",81,0)
 ;
"RTN","SAMIURUL",82,0)
 ; 2019-06-21 par/dom 18 c6a4a57f VAP-352
"RTN","SAMIURUL",83,0)
 ;  SAMIUR2 proper spelling of "follow up."
"RTN","SAMIURUL",84,0)
 ;
"RTN","SAMIURUL",85,0)
 ; 2019-08-03/04 ven/gpl 18 ffc94f65,d03557d4,cd865e2b VPA-438
"RTN","SAMIURUL",86,0)
 ;  SAMIUR requested changes to followup report.
"RTN","SAMIURUL",87,0)
 ;  SAMIUR2 fix smoking status on enrollment report, fix change log
"RTN","SAMIURUL",88,0)
 ; display, add pack years at intake to enrollment report, add
"RTN","SAMIURUL",89,0)
 ; requested changes to followup report.
"RTN","SAMIURUL",90,0)
 ;
"RTN","SAMIURUL",91,0)
 ; 2019-09-26 ven/gpl 18 92b12324 VAP-420
"RTN","SAMIURUL",92,0)
 ;  SAMIUR add smoking history.
"RTN","SAMIURUL",93,0)
 ;  SAMIUR2 smoking history, new cummulative packyear processing.
"RTN","SAMIURUL",94,0)
 ;
"RTN","SAMIURUL",95,0)
 ; 2019-10-01 par/dom 18 4caf1a98 VAP-344
"RTN","SAMIURUL",96,0)
 ;  SAMIUR2 make capitalization consistent.
"RTN","SAMIURUL",97,0)
 ;
"RTN","SAMIURUL",98,0)
 ; 2020-01-01/05 ven/arc 18 399f8547,62e3200f
"RTN","SAMIURUL",99,0)
 ;  SAMIUR unmatched participant processing.
"RTN","SAMIURUL",100,0)
 ;  SAMIUR2 add unmatched patient processing.
"RTN","SAMIURUL",101,0)
 ;
"RTN","SAMIURUL",102,0)
 ; 2020-01-10 ven/gpl 18 1590577c
"RTN","SAMIURUL",103,0)
 ;  SAMIUR2 fix return on RACE^SAMIUR2 for cache.
"RTN","SAMIURUL",104,0)
 ;
"RTN","SAMIURUL",105,0)
 ; 2020-04-29/05-13 ven/gpl 18-5 e8b8ea2d,61c7d208
"RTN","SAMIURUL",106,0)
 ;  SAMIUR fixes for reports, worklist functionality.
"RTN","SAMIURUL",107,0)
 ;
"RTN","SAMIURUL",108,0)
 ; 2020-05-13/14 ven/gpl 18-5 61c7d208,b05df417
"RTN","SAMIURUL",109,0)
 ;  SAMIUR2 add worklist functionality, fix gender & dob detection on
"RTN","SAMIURUL",110,0)
 ; reports.
"RTN","SAMIURUL",111,0)
 ;
"RTN","SAMIURUL",112,0)
 ; 2021-03-22/23 ven/gpl 18-10 256efe63,ba81b86a
"RTN","SAMIURUL",113,0)
 ;  SAMIUR sort all reports by name, added row totals to reports.
"RTN","SAMIURUL",114,0)
 ;
"RTN","SAMIURUL",115,0)
 ; 2021-03-23 ven/toad 18-10 96f461d0,af86e0eb
"RTN","SAMIURUL",116,0)
 ;  SAMIUR add version info & dev log, lt refactor, fix XINDEX
"RTN","SAMIURUL",117,0)
 ; errors.
"RTN","SAMIURUL",118,0)
 ;
"RTN","SAMIURUL",119,0)
 ; 2021-03-29 ven/gpl 18-11 e809f2a2
"RTN","SAMIURUL",120,0)
 ;  SAMIUR prevent crash when reports have no matches: in WSREPORT
"RTN","SAMIURUL",121,0)
 ; set SRT="" and uncomment zwrite SRT; in WKLIST add 2 commented-out
"RTN","SAMIURUL",122,0)
 ; debugging lines.
"RTN","SAMIURUL",123,0)
 ;
"RTN","SAMIURUL",124,0)
 ; 2021-03-30 ven/toad 18-11 7b14bb29
"RTN","SAMIURUL",125,0)
 ;  SAMIUR bump version, date, log; in WSREPORT comment zwrite SRT.
"RTN","SAMIURUL",126,0)
 ;
"RTN","SAMIURUL",127,0)
 ; 2021-03-31 ven/gpl 18-11 66d89cde
"RTN","SAMIURUL",128,0)
 ;  SAMIUR sort on all uppercase names for reports
"RTN","SAMIURUL",129,0)
 ;
"RTN","SAMIURUL",130,0)
 ; 2021-04-13 ven/gpl 18-11 a12765bf,f09ffef9,fb399aba
"RTN","SAMIURUL",131,0)
 ;  SAMIUR inactive report created.
"RTN","SAMIURUL",132,0)
 ;  SAMIUR2 in RPTTBL,GENDER create inactive report, move last exam
"RTN","SAMIURUL",133,0)
 ; column on followup report, fix gender being blank in reports.
"RTN","SAMIURUL",134,0)
 ;
"RTN","SAMIURUL",135,0)
 ; 2021-05-20/25 ven/mcglk&toad 18-11 43a4557c,70fc6ba3,129e96b1,
"RTN","SAMIURUL",136,0)
 ; cee2bf17
"RTN","SAMIURUL",137,0)
 ;  SAMIUR annotate, lt refactor, bump version.
"RTN","SAMIURUL",138,0)
 ;  SAMIUR2 passim hdr comments, chg log, annotate, refactor, bump
"RTN","SAMIURUL",139,0)
 ; version.
"RTN","SAMIURUL",140,0)
 ;
"RTN","SAMIURUL",141,0)
 ; 2021-05-29 ven/gpl 18-12-t2 e6fd5730,a3d6f9a0
"RTN","SAMIURUL",142,0)
 ;  SAMIUR,SAMIUR2 ssn params & matching report, update unmatched
"RTN","SAMIURUL",143,0)
 ; report headings.
"RTN","SAMIURUL",144,0)
 ;
"RTN","SAMIURUL",145,0)
 ; 2021-06-15 ven/gpl 18-12-t2 7e481426
"RTN","SAMIURUL",146,0)
 ;  SAMIUR add site to editperson navigation.
"RTN","SAMIURUL",147,0)
 ;
"RTN","SAMIURUL",148,0)
 ; 2021-06-28 ven/gpl 18-12-t2 df0aaea1,1137e2bb
"RTN","SAMIURUL",149,0)
 ;  SAMIUR change definition of inactive to not marked active, change
"RTN","SAMIURUL",150,0)
 ; definition of active to marked active.
"RTN","SAMIURUL",151,0)
 ;
"RTN","SAMIURUL",152,0)
 ; 2021-07-06 ven/mcglk&toad&gpl 18-12-t2 cbf7e46b,2d642aa4,
"RTN","SAMIURUL",153,0)
 ; b248664b
"RTN","SAMIURUL",154,0)
 ;  SAMIURUL new routine for dev log.
"RTN","SAMIURUL",155,0)
 ;  SAMIUR,SAMIUR2,SAMIURUL move dev log & module docs to SAMIURUL,
"RTN","SAMIURUL",156,0)
 ; bump version & dates.
"RTN","SAMIURUL",157,0)
 ;  SAMIUR in SELECT r/inactive w/status, test for active instead of
"RTN","SAMIURUL",158,0)
 ; inactive.
"RTN","SAMIURUL",159,0)
 ;
"RTN","SAMIURUL",160,0)
 ; 2021-07-12 ven/gpl 18-12-t3 60f4bb05,27c40485,d35bcb46
"RTN","SAMIURUL",161,0)
 ;  SAMIUR in WSREPORT,SORT add contact date & entry to missingct
"RTN","SAMIURUL",162,0)
 ; report.
"RTN","SAMIURUL",163,0)
 ;  SAMIUR2 add contact date & entry to missingct report; add
"RTN","SAMIURUL",164,0)
 ; inactive date reason & comment to inactive report; chg inactive
"RTN","SAMIURUL",165,0)
 ; date to date of death.
"RTN","SAMIURUL",166,0)
 ;
"RTN","SAMIURUL",167,0)
 ; 2021-08-01 ven/gpl 18-12 5bd7c627
"RTN","SAMIURUL",168,0)
 ;  SAMIUR set intake form to incomplete on creation: in SELECT if
"RTN","SAMIURUL",169,0)
 ; type="incomplete" ensure default status is incomplete.
"RTN","SAMIURUL",170,0)
 ;
"RTN","SAMIURUL",171,0)
 ; 2021-08-11 ven/gpl 18-12 4d4f0fc3
"RTN","SAMIURUL",172,0)
 ;  SAMIUR,SAMIUR2 add sorting to tables used for reports.
"RTN","SAMIURUL",173,0)
 ;  SAMIUR in WSREPORT,NUHREF,WKLIST.
"RTN","SAMIURUL",174,0)
 ;  SAMIUR2 in TDDT,BLINEDT,DOB,FUDATE,LASTEXM,INACTDT,LDOC,STUDYDT.
"RTN","SAMIURUL",175,0)
 ;
"RTN","SAMIURUL",176,0)
 ; 2021-08-26 ven/gpl 18-14 de044cf9
"RTN","SAMIURUL",177,0)
 ;  SAMIUR, SAMIUR2 make changes to user reports as requested.
"RTN","SAMIURUL",178,0)
 ; Reports changed were Enrollment, Activity, and Follow-up.
"RTN","SAMIURUL",179,0)
 ;
"RTN","SAMIURUL",180,0)
 ; 2021-08-28 ven/gpl 18-14 cd69ff8b, fbd9196d
"RTN","SAMIURUL",181,0)
 ;  SAMIUR, SAMIUR2 fix bugs in Activity report; fix problem with Work
"RTN","SAMIURUL",182,0)
 ; List.
"RTN","SAMIURUL",183,0)
 ;
"RTN","SAMIURUL",184,0)
 ; 2021-09-09 ven/gpl 18-14 afa4bfc2, 7f668e64, 8d45ebac
"RTN","SAMIURUL",185,0)
 ;  SAMIUR fix bugs in reports showing inactive patients on wrong
"RTN","SAMIURUL",186,0)
 ; reports, "baseline" showing up in F/U date on Follow-up report,
"RTN","SAMIURUL",187,0)
 ; wrong patients on Intake but Missing CT Eval report.
"RTN","SAMIURUL",188,0)
 ;
"RTN","SAMIURUL",189,0)
 ; 2021-10-05 ven/gpl 18-14 3251c582, c4343d69, 368fa7f7, c4343d69
"RTN","SAMIURUL",190,0)
 ; b3cd039b, 237109df, 368fa7f7
"RTN","SAMIURUL",191,0)
 ;  SAMIIUR, SAMIUR2 fix small bugs, make date formats consistent,
"RTN","SAMIURUL",192,0)
 ; bump versions & dates.
"RTN","SAMIURUL",193,0)
 ;
"RTN","SAMIURUL",194,0)
 ; 2021-10-14 ven/gpl 18-14  6a973630
"RTN","SAMIURUL",195,0)
 ;  SAMIUR fix bug where patients with CT Evals would appear on Intake
"RTN","SAMIURUL",196,0)
 ; but no CT report.
"RTN","SAMIURUL",197,0)
 ;
"RTN","SAMIURUL",198,0)
 ; 2021-10-15 ven/lmry 18-14 87fd8eb3
"RTN","SAMIURUL",199,0)
 ;  SAMIUR, SAMIURUL update history, bump dates.
"RTN","SAMIURUL",200,0)
 ;
"RTN","SAMIURUL",201,0)
 ; 2021-10-20 ven/gpl 18-15 b63bfc06
"RTN","SAMIURUL",202,0)
 ;  SAMIUR2  suppress rural column in enrollment report if not VA.
"RTN","SAMIURUL",203,0)
 ;
"RTN","SAMIURUL",204,0)
 ; 2021-10-25 ven/gpl 18-15 b6188d2c
"RTN","SAMIURUL",205,0)
 ;  SAMIUR fix for duplicates in work list & matching reports.
"RTN","SAMIURUL",206,0)
 ;
"RTN","SAMIURUL",207,0)
 ; 2021-10-28 ven/lmry,mcglk 18-15
"RTN","SAMIURUL",208,0)
 ;  SAMIUR, SAMIUR2, SAMIURUL update history, bump dates & versions.
"RTN","SAMIURUL",209,0)
 ;
"RTN","SAMIURUL",210,0)
 ; 2021-10-29 ven/lmry 18-15
"RTN","SAMIURUL",211,0)
 ;  SAMIUR remove blank at end of line for XINDEX.
"RTN","SAMIURUL",212,0)
 ;
"RTN","SAMIURUL",213,0)
 ; 2022-12-15/17 ven/gpl 18-17
"RTN","SAMIURUL",214,0)
 ;  SAMIUR, SAMIUR2 develop new CT Eval Recommendation report.
"RTN","SAMIURUL",215,0)
 ;
"RTN","SAMIURUL",216,0)
 ; 2022-12-30 ven/lmry 18-17  68d5a01
"RTN","SAMIURUL",217,0)
 ;  SAMIUR, SAMIUR2, SAMIURUL update history, bump dates & versions.
"RTN","SAMIURUL",218,0)
 ;
"RTN","SAMIURUL",219,0)
 ; 2022-12-30 ven/lmry 18-17 
"RTN","SAMIURUL",220,0)
 ;  SAMIUR remove blank at end of line for XINDEX.
"RTN","SAMIURUL",221,0)
 ;
"RTN","SAMIURUL",222,0)
 ; 2023-01-04 ven/gpl  18-17
"RTN","SAMIURUL",223,0)
 ;  SAMIUR fix bug to make data appear in new report.
"RTN","SAMIURUL",224,0)
 ;
"RTN","SAMIURUL",225,0)
 ; 2024-08-17 ven/lmry 18-17  a1a28de
"RTN","SAMIURUL",226,0)
 ;  SAMIUR bump dates, update contents, remove space at end of line.
"RTN","SAMIURUL",227,0)
 ;  SAMIUR2 bump dates.
"RTN","SAMIURUL",228,0)
 ;  SAMIURUL add history, bump dates.
"RTN","SAMIURUL",229,0)
 ;
"RTN","SAMIURUL",230,0)
 ; 2024-08-21/22 ven/toad 18-17-b6  bd5cfb4
"RTN","SAMIURUL",231,0)
 ;  SAMIUR annotate.
"RTN","SAMIURUL",232,0)
 ;  SAMIURUL update history.
"RTN","SAMIURUL",233,0)
 ;  SAMIUR,2,UL update version-control lines, hdr comments, comment
"RTN","SAMIURUL",234,0)
 ; out ^gpl debugging lines.
"RTN","SAMIURUL",235,0)
 ;
"RTN","SAMIURUL",236,0)
 ; 2024-09-07 ven/gpl 18-18-b1  e6fdd47 4942369
"RTN","SAMIURUL",237,0)
 ;  SAMIUR2 MRN lookup and display working, fix the recommendations report
"RTN","SAMIURUL",238,0)
 ;   PID field
"RTN","SAMIURUL",239,0)
 ;
"RTN","SAMIURUL",240,0)
 ; 2024-09-10 ven/lmry 18-18-b1
"RTN","SAMIURUL",241,0)
 ;  SAMIUR2 update date/time, version control lines
"RTN","SAMIURUL",242,0)
 ;  SAMIURUL update date/time, version control lines, and module log
"RTN","SAMIURUL",243,0)
 ;
"RTN","SAMIURUL",244,0)
 ;
"RTN","SAMIURUL",245,0)
 ;@contents
"RTN","SAMIURUL",246,0)
 ;
"RTN","SAMIURUL",247,0)
 ; SAMIUR user reports
"RTN","SAMIURUL",248,0)
 ; SAMIUR1 [to be added]
"RTN","SAMIURUL",249,0)
 ; SAMIUR2 user reports cont
"RTN","SAMIURUL",250,0)
 ; SAMIURUL user reports log
"RTN","SAMIURUL",251,0)
 ; SAMIUTUR user reports tests
"RTN","SAMIURUL",252,0)
 ;
"RTN","SAMIURUL",253,0)
 ;
"RTN","SAMIURUL",254,0)
 ;
"RTN","SAMIURUL",255,0)
EOR ; end of SAMIURUL
"SEC","^DIC",311.11,311.11,0,"AUDIT")
@
"SEC","^DIC",311.11,311.11,0,"DD")
@
"SEC","^DIC",311.11,311.11,0,"DEL")
@
"SEC","^DIC",311.11,311.11,0,"LAYGO")
@
"SEC","^DIC",311.11,311.11,0,"RD")
@
"SEC","^DIC",311.11,311.11,0,"WR")
@
"VER")
8.0^22.2
"^DD",311.11,311.11,0)
FIELD^^2^6
"^DD",311.11,311.11,0,"DT")
3200516
"^DD",311.11,311.11,0,"IX","B",311.11,.01)

"^DD",311.11,311.11,0,"NM","SAMI FORM MAPPING")

"^DD",311.11,311.11,0,"VRPK")
SAMI
"^DD",311.11,311.11,.01,0)
FORM^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",311.11,311.11,.01,.1)
FORM NAME
"^DD",311.11,311.11,.01,1,0)
^.1
"^DD",311.11,311.11,.01,1,1,0)
311.11^B
"^DD",311.11,311.11,.01,1,1,1)
S ^SAMI(311.11,"B",$E(X,1,30),DA)=""
"^DD",311.11,311.11,.01,1,1,2)
K ^SAMI(311.11,"B",$E(X,1,30),DA)
"^DD",311.11,311.11,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",311.11,311.11,.01,"DT")
3170913
"^DD",311.11,311.11,.02,0)
INDEXED BY^FJ20^^2;1^K:$L(X)>20!($L(X)<1) X
"^DD",311.11,311.11,.02,3)
MUMPS variable to use for lookup and indexing
"^DD",311.11,311.11,.02,21,0)
^^1^1^3170913^
"^DD",311.11,311.11,.02,21,1,0)
MUMPS symbol to use for lookup and indexing ie. studyid or DFN
"^DD",311.11,311.11,.02,"DT")
3170913
"^DD",311.11,311.11,.5,0)
FILEMAN FILE (DEFAULT)^P1'^DIC(^0;2^Q
"^DD",311.11,311.11,.5,.1)
DEFAULT FILEMAN FILE FOR MAPPING
"^DD",311.11,311.11,.5,"DT")
3170913
"^DD",311.11,311.11,.7,0)
GRAPH^P17.040801^%wd(17.040801,^0;3^Q
"^DD",311.11,311.11,.7,.1)
DEFAULT GRAPH FOR INTERMEDIATE STORAGE
"^DD",311.11,311.11,.7,"DT")
3170913
"^DD",311.11,311.11,1,0)
VARIABLE^311.11001A^^1;0
"^DD",311.11,311.11,2,0)
HTML TEMPLATE NAME^FJ90^^2;2^K:$L(X)>90!($L(X)<2) X
"^DD",311.11,311.11,2,3)
Answer must be 2-90 characters in length.
"^DD",311.11,311.11,2,"DT")
3171216
"^DD",311.11,311.11001,0)
VARIABLE SUB-FIELD^^5^8
"^DD",311.11,311.11001,0,"DT")
3170913
"^DD",311.11,311.11001,0,"IX","B",311.11001,.01)

"^DD",311.11,311.11001,0,"NM","VARIABLE")

"^DD",311.11,311.11001,0,"UP")
311.11
"^DD",311.11,311.11001,.01,0)
VARIABLE^MFJ90^^0;1^K:$L(X)>90!($L(X)<1) X
"^DD",311.11,311.11001,.01,1,0)
^.1
"^DD",311.11,311.11001,.01,1,1,0)
311.11001^B
"^DD",311.11,311.11001,.01,1,1,1)
S ^SAMI(311.11,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",311.11,311.11001,.01,1,1,2)
K ^SAMI(311.11,DA(1),1,"B",$E(X,1,30),DA)
"^DD",311.11,311.11001,.01,3)
Answer must be 1-90 characters in length.
"^DD",311.11,311.11001,.01,"DT")
3170913
"^DD",311.11,311.11001,.02,0)
TITLE^FJ90^^0;4^K:$L(X)>90!($L(X)<1) X
"^DD",311.11,311.11001,.02,3)
Answer must be 1-90 characters in length.
"^DD",311.11,311.11001,.02,21,0)
^^1^1^3170913^
"^DD",311.11,311.11001,.02,21,1,0)
Dictionary title of this variable
"^DD",311.11,311.11001,.02,"DT")
3170913
"^DD",311.11,311.11001,.5,0)
FILEMAN FILE^P1'^DIC(^0;2^Q
"^DD",311.11,311.11001,.5,"DT")
3171115
"^DD",311.11,311.11001,1,0)
FILEMAN FIELD^NJ17,7^^0;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."8N.N) X
"^DD",311.11,311.11001,1,3)
Fileman field number which maps to this variable
"^DD",311.11,311.11001,1,21,0)
^^1^1^3170913^
"^DD",311.11,311.11001,1,21,1,0)
Fileman field number which maps to this variable
"^DD",311.11,311.11001,1,"DT")
3171115
"^DD",311.11,311.11001,2,0)
DATA TYPE^FJ30^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",311.11,311.11001,2,3)
Dictionary data type of this variable
"^DD",311.11,311.11001,2,21,0)
^^1^1^3170913^
"^DD",311.11,311.11001,2,21,1,0)
Dictionary data type of this variable
"^DD",311.11,311.11001,2,"DT")
3170913
"^DD",311.11,311.11001,3,0)
REQUIRED^S^1:YES;0:NO;^0;6^Q
"^DD",311.11,311.11001,3,3)
Is this variable required?
"^DD",311.11,311.11001,3,21,0)
^^1^1^3170913^
"^DD",311.11,311.11001,3,21,1,0)
Dictionary definition of whether the variable is required
"^DD",311.11,311.11001,3,"DT")
3170913
"^DD",311.11,311.11001,4,0)
ELCAP FIELD NUMBER^NJ13,7^^1;1^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."8N.N) X
"^DD",311.11,311.11001,4,3)
ELCAP field number of this variable, if available
"^DD",311.11,311.11001,4,21,0)
^^2^2^3170913^
"^DD",311.11,311.11001,4,21,1,0)
Dictionary value of the ELCAP field number for this variable. May not be ava
"^DD",311.11,311.11001,4,21,2,0)
May not be available.
"^DD",311.11,311.11001,4,"DT")
3170913
"^DD",311.11,311.11001,5,0)
COMMENTS^FJ90^^1;2^K:$L(X)>90!($L(X)<1) X
"^DD",311.11,311.11001,5,3)
Answer must be 1-90 characters in length.
"^DD",311.11,311.11001,5,21,0)
^^1^1^3170913^
"^DD",311.11,311.11001,5,21,1,0)
Dictionary definition/comments about the variable
"^DD",311.11,311.11001,5,"DT")
3170913
"^DIC",311.11,311.11,0)
SAMI FORM MAPPING^311.11
"^DIC",311.11,311.11,0,"GL")
^SAMI(311.11,
"^DIC",311.11,311.11,"%",0)
^1.005^^0
"^DIC",311.11,311.11,"%D",0)
^^2^2^3170913^
"^DIC",311.11,311.11,"%D",1,0)
This is a form mapping file created by gpl for the VA-PALS project
"^DIC",311.11,311.11,"%D",2,0)
It maps the variable names used in the ELCAP forms to field numbers in fileman files
"^DIC",311.11,"B","SAMI FORM MAPPING",311.11)

**END**
**END**
