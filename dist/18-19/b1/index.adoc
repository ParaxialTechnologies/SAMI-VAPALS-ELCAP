:mastimg: project-va-pals
:mastcaption: va-pals
:mastdesc: Project: Screening+
:doctitle: 18-19-b1 – Distribution – Screening+ – Projects – Vista Expertise Network
:description: The Screening+ project: Increasing access to safe and effective lung-screening programs that save lives.
:addkeywords: cancer, lung cancer, screening, early detection, cancer detection, VAPALS, Screening+, ScreeningPLUS, ELCAP, I-ELCAP, VA-PALS, SAMI routines, web application in M
:numbered:
:version: 18-19-b1
:build: b1
:doctitle: Screening+: SAMI {version}
:nmsp: SAMI
:lnmsp: sami
:appname: Screening+
:va-version: {nmsp}*18.0*19 SEQ #19 b1
:vista-longversion: Version 18.0, Patch ID #19, Seq #19, Build 1
:priority: High
:categories: Routine, File
:status: Release

// grep '\$TXT' sami-18-19-b1.txt
-------------------------------------------------------------------------------
$TXT by YAW,LINDA linda.yaw@vistaexpertise.net (KIDS) 2024-09-26t02:00z
-------------------------------------------------------------------------------

[role="center h3"]
CT Evaluation Report Improvements

[role="center h1"]
{nmsp} ({appname}) {version}
[role="center h3"]
({va-version})

[role="center"]
George P. Lilly,
Domenic DiNatale,
_&_ Frederick D. S. Marshall +
2024-09-25

[[front]]
[role="h2"]
{zwj}i. Front matter

[cols=">.<0v,<.<1v",grid="none",frame="none",width="1%"]
|==============================================================================
| App         | {nmsp} ({appname})
| Version     | {version}
| Vista ID    | ††{va-version}††: {vista-longversion}
| Priority    | {priority}
| Categories  | {categories}
| Status      | {status}: ++{nmsp}-{version}.zip++
| Depends on  | SAMI 18-4 (††SAMI*18.0*4 SEQ #4††) +
                SAMI 18-7 (††SAMI*18.0*7 SEQ #7††) +
                SAMI 18-10 (††SAMI*18.0*10 SEQ #10††) +
                SAMI 18-11 (††SAMI*18.0*11 SEQ #11††) +
                SAMI 18-12 (††SAMI*18.0*12 SEQ #12††) +
                SAMI 18-13 (††SAMI*18.0*13 SEQ #13††) +
                link:../../18-14/[SAMI 18-14] (††SAMI*18.0*14 SEQ #14††) +
                link:../../18-15/[SAMI 18-15] (††SAMI*18.0*15 SEQ #15††) +
                link:../../18-16/[SAMI 18-16] (††SAMI*18.0*16 SEQ #16††) +
                link:../../18-17/[SAMI 18-17] (††SAMI*18.0*17 SEQ #17††) +
                link:../../18-18/[SAMI 18-18] (††SAMI*18.0*18 SEQ #18††)
|==============================================================================

[[toc]]
[role="h2"]
{zwj}ii. Contents

[cols="<.<1a,<.<1a",grid="none",frame="none",width="99%"]
|==============================================================================
|[options="compact",role="toc"]
* <<desc,Description>>
** <<issue-a,Improve or fix items in the CT Evaluation Report>>
** <<issue-b,Install a routine that allows the movement of patients to another
   site>>
* <<pkg-elements,Package elements>>
* <<prepare,Prepare for installation>>
** <<be-osehra,Assume the identity of your +osehra+ Unix user>>
** <<prep-installdir,Prepare install directory>>
** <<prep-archive,Download and prepare the archive file>>
** <<install-www,Install web-application files>>
** <<backup-m,Back up M routines>>
*** <<enter-m,Enter M>>
**** <<enter-m-cache,On Caché>>
**** <<enter-m-yotta,On YottaDB/GT.M>>
*** <<signin,Sign into Vista>>
*** <<routine-list,List of routines>>
*** <<run-ro,Run the backup>>
**** <<backup-cache,On Caché>>
**** <<backup-yotta,On YottaDB/GT.M>>
|[options="compact",role="toc"]
* <<install,Main install instructions>>
** <<signin-kids,Enter the KIDS Installation menu>>
** <<load-pkg,Load KIDS package>>
** <<verify-checksums,Verify checksums (_NEW_)>>
** <<install-pkg,Install KIDS package>>
* <<backout,Optional backout instructions>>
* <<routines,Routines>>
* <<authors,Authors>>
|==============================================================================

[[desc]]
== Description

{nmsp} {version} adds one medium-priority update to improve CT evaluation
reports.

The definitive source for the {appname} application---codebase, package
distributions (including this one), and documentation---is a
https://github.com/ParaxialTechnologies/SAMI-VAPALS-ELCAP/[public GitHub
repository].

These instructions are for your Vista environment's sysadmin. As usual, please
capture the complete dialog of your install and send it to your {appname}
support team.

The changes in this patch are:

[options="compact"]
* Improve or fix items in the CT Evaluation Report
  (link:#issue-a[request{nbsp}1], medium{nbsp}priority)
* Install a routine that allows the movement of patients to another site
  (link:#issue-b[change{nbsp}1], medium priority)

[[issue-a]]
=== Improve or fix items in the CT Evaluation Report

**Request 1 (medium priority):** Various changes to the CT Evaluation Report
have been requested by the iELCAP team and the Mount Sinai radiologists:

[options="compact"]
. Annual repeat CT: When the radiologists selects ††Annual repeat†† as the LDCT
  follow-up, the report says ††A followup CT scan is
  recommended{nbsp}...†† This should be changed to ††An annual repeat CT scan
  is recommended{nbsp}...††
. Follow-up recommendation is missing a dash in “followup CT.”
. The heading ††**Breast**†† is missing in the report: A situation arose where
  nothing was selected for the breast, but a comment was entered. The comment
  shows up, but there’s no heading for the Breast section, so it’s sort of a
  dangling sentence.
. CAC score: If the CAC score is 0 (that is, the radiologist selects ††None††
  for all), the report doesn’t say anything about CAC.  If the CAC score
  is{nbsp}0, it should say: ††Coronary Artery Calcifications: None. The Visual
  Coronary Artery Calcium (CAC) Score is 0.††
. Ensure generator isn't adding periods after comment blocks.
. Add text if ††insufficient information for sign off†† checkbox is checked.
. Swap order of emphysema finding and CAC score.
. The wrong study ID was on the CT Eval report. 
. Aortic valve calcification: Similar to CAC score as above---if it’s None,
  it should explicitly say None.
   
**Solution:** These changes and fixes have been made.

**Reported:** 2024-07-11 by iELCAP team, 2024-09-16 by Mt. Sinai radiologists.

[[issue-b]]
=== Install a routine that allows the movement of patients to another site

**Change 1:** Allow patient movement to another site in the same network or the
movement of an accidental duplicate patient record to a faux site. This is
actually from an earlier patch that was not taken up by the field. If needed,
request instructions from your {appname} support team.

**Solution:** Include `SAMIMOV` in release.

**Completed:** 2024-09-20 by F. Marshall.

[[pkg-elements]]
== Package elements

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<div style="display: flex; flex-flow: row wrap; align-items: flex-start;">
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

include::.dtool/packelements.adoi[]

// [cols="<.<1v,>.<0v,<.<0v",options="header,autowidth",role="center"]
// |==============================================================================
// | Fileman File                | Number   | Change
// | ††SAMI PARAMETER DEFAULTS†† | `311.14` | modified (data)
// |==============================================================================

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
</div>
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

[[prepare]]
== Prepare for installation

This involves creating a directory to work in, running a script to back up
certain datafiles and web-application files, and then going through steps to
back up M routines that will be replaced by the patch.

[[be-osehra]]
=== Assume the identity of your +osehra+ Unix user

This step assumes you use a `dzdo` or `sudo` command to do this; here, the
symbol `$DEMAND` will stand for whichever command you use. (Also, in all the
command-line examples below, `$` simply means your command-line prompt.) If
your configuration is different, please adjust this step to match your
configuration:

-------------------------------------------------------------------------------
$ $DEMAND su - osehra
$ _
-------------------------------------------------------------------------------

[[prep-installdir]]
=== Prepare install directory

If this is your first time installing this, execute the following commands.
They create a shell variable, and then create the work directory and sets it as
your current directory.

-------------------------------------------------------------------------------
$ INDIR=~/run/in/sami/18-19/b1
$ mkdir -p $INDIR
$ cd $INDIR
-------------------------------------------------------------------------------

If you've already tried installing this before, you can use the following
commands instead:

-------------------------------------------------------------------------------
$ INDIR=~/run/in/sami/18-19/b1
$ cd $INDIR
$ rm -rf ./sami*.{txt,kid} ./auxfiles
-------------------------------------------------------------------------------

[[prep-archive]]
=== Download and prepare the archive file

You may safely download the archive file
(link:sami-{version}.zip[++sami-{version}.zip++]) in advance of the actual
install.

include::.dtool/curl-snippet.adoi[]

Then unzip the archive file with the following command.

include::.dtool/unzip-snippet.adoi[]

[[install-www]]
=== Install web-application files

At this point, the web-application files must be installed. This is done with a
script that backs up the affected directories before installing anything, then
upgrades the web-application files.

-------------------------------------------------------------------------------
$ ./upgrade-auxfiles
Backing up files to ./.aux-backup:
[... lists of files backed up ...]
Compressing the backup:
[... list of files being compressed ...]
Cleaning up.
Done with backup of auxiliary files.

Updating from ./auxfiles
[... list of files being updated ...]
Done with install.

You may now proceed with the KIDS installation.
$ _
-------------------------------------------------------------------------------

Outside the VA firewall, {appname} systems maintain up-to-date clones of the
official GitHub repository, and this script will have different output.

-------------------------------------------------------------------------------
$ ./upgrade-auxfiles
Backing up files to ./.aux-backup
[... lists of files backed up ...]
Compressing the backup:
[... list of files being compressed ...]
Cleaning up.
Done with backup of auxiliary files.

Found a valid Git repository; pulling updates ...
[... output varies ...]
Done with install.
$ _
-------------------------------------------------------------------------------

// eval::[Section.setlevel(2)]

[[backup-m]]
=== Back up M routines

Before the installation, we also need to back up existing {appname} routines
that will be overwritten by this install. To do this, you will have to start a
Caché or YottaDB session (depending on your particular installation), sign in
to Vista, and then call the direct-mode interface `^%RO` (“routine out”).

We have made efforts to display accurate instructions, but there are likely to
be minor differences between implementations. Be sure to follow the correct
dialog for your implementation.

[[enter-m]]
==== Enter M

At the Unix prompt, enter the M environment in direct mode, using the
`csession` command on Caché or the `mumps` command on YottaDB/GT.M:

[[enter-m-cache]]
††**On Caché**††

-------------------------------------------------------------------------------
$ csession vapals

Node: vapalscache, Instance: VAPALS

>_
-------------------------------------------------------------------------------

[[enter-m-yotta]]
††**On YottaDB/GT.M**††

-------------------------------------------------------------------------------
$ mumps -dir

>_
-------------------------------------------------------------------------------

[[signin]]
==== Sign into Vista

At the M prompt, call Vista's direct-mode interface, enter your access code,
and then just press return at the [ttsp nowrap]##OPTION NAME## prompt to return
to direct mode. This sets up your authentication variables. Here's a sample
capture of this step:

-------------------------------------------------------------------------------
>do ^XUP

Setting up programmer environment
This is a TEST account.

Access Code: *******
Terminal Type set to: C-VT100

Select OPTION NAME:
>_
-------------------------------------------------------------------------------

[[routine-list]]
==== List of routines

The routine names to save are listed below; you may copy the list and paste it
at the appropriate `Routine` prompt. At the final `Routine` prompt, press
return to indicate the list of routines is done.

include::.dtool/routine-list.adoi[]

[[run-ro]]
==== Run the backup

Creating the routine backup file differs by implementation.

[[backup-cache]]
††**On Caché**††

Note that routines that don't currently exist will result in a warning message
(specifically, the routine name will have `[???]` after it, and the line
[ttsp]##[does not exist]## after that). These messages can be safely
disregarded.

In addition to naming the routines and routine-out file, we also provide a
+Description+ and press return at the +Parameters+ and [ttsp]##Printer Format##
prompts to accept the defaults of +WNS+ and +No+, respectively:

include::.dtool/cache-ro-snippet.adoi[]

[[backup-yotta]]
††**On YottaDB/GT.M**††

Note that routines that don't currently exist will result in the routine name
not appearing under the input line, and won't count towards the number of
routines. These can be safely disregarded.

In addition to naming the routines and routine-out file, we also provide a
[ttsp]##Header Label## and press return at the [ttsp]##Strip comments## prompt
to accept the default of +no+:

include::.dtool/yotta-ro-snippet.adoi[]

eval::[Section.setlevel(2)]

You'll remain in the M environment for the next section.

[[install]]
== Main install instructions

This consists of loading and installing the KIDS package, and activating the
new web-application files.

[[signin-kids]]
=== Enter the KIDS Installation menu

At the [ttsp]##OPTION NAME## prompt select [ttsp]##XPD MAIN## to enter the
[ttsp]##Kernel Installation & Distribution System## main menu, and at the
[ttsp]##Select \... Option## prompt select +Installation+:

include::.dtool/enter-kids-snippet.adoi[]

[[load-pkg]]
=== Load KIDS package

Select option 1 and press return at the +Continue+ prompt.

include::.dtool/load-kids-snippet.adoi[]

[[verify-checksums]]
=== Verify checksums (_NEW_)

Run the [ttsp]##Verify Checksums in the Transport Global## option. This option
will let you ensure the integrity of this update in two ways.

First, it will compare the routines you already have in your habitat to what
this update was developed to replace, and if they don't match, it will warn
you. Second, it will compare the routines that have been loaded from the KIDS
file to what the developers distributed, to be sure the KIDS file was not
corrupted in transit.

To get a checksum report, you would select Installation option 2, provide the
distribution name, verify that you want the routines listed with checksums on
your screen. Here's a sample session. In the text below, ⮐ indicates pressing
the Enter/Return key.

// Note: the block below has a zero-width word join at the beginning of the
// dashed line.

-------------------------------------------------------------------------------
Select Installation <TEST ACCOUNT> Option: 2⮐  Verify Checksums in Transport Global
Select INSTALL NAME: SAMI*18.0*19⮐       Loaded from Distribution    [datetime]
     => Released SAMI*18.0*19 SEQ #19  ;Created on [datetime]

This Distribution was loaded on [datetime] with header of
   Released SAMI*18.0*19 SEQ #19  ;Created on [datetime]
   It consisted of the following Install(s):
   SAMI*18.0*19

Want each Routine Listed with Checksums: Yes// ⮐  YES
DEVICE: HOME// ;C-SCROLL⮐  TELNET



PACKAGE: SAMI*18.0*19     [datetime]                                    PAGE 1
‍‍-------------------------------------------------------------------------------


[list of checksums; see below]

   <x> Routines checked, <y> failed.



   1      Load a Distribution
   2      Verify Checksums in Transport Global
   3      Print Transport Global
   4      Compare Transport Global to Current System
   5      Backup a Transport Global
   6      Install Package(s)
          Restart Install of Package(s)
          Unload a Distribution

Select Installation <TEST ACCOUNT> Option: _
-------------------------------------------------------------------------------

Checksums that matched will be displayed as

-------------------------------------------------------------------------------
RNAME     Calculated  xxxxxxxxx
-------------------------------------------------------------------------------

where `RNAME` is the name of the routine, and `xxxxxxxxx` is a checksum value.
This is normal; `RNAME` may be safely installed. If all of them match, the line
below should say [ttsp]##<x> Routines checked, 0 failed.##

If the routine being replaced is not what was expected to be there, you will
see something like

-------------------------------------------------------------------------------
RNAME     Before Checksum Calculated xxxxxxxxx expected value yyyyyyyyy
-------------------------------------------------------------------------------

where `xxxxxxxxx` is the checksum of the routine that's currently installed on
your system, but `yyyyyyyyy` is what was _expected_ to be there. If one of
these appears, do _not_ proceed with the installation until you understand why
these don't match, and have confirmed with the {appname} development team that
it's safe to proceed. Otherwise, you may corrupt the {appname} application,
which may break certain features---or even endanger patient health or privacy.

If the routine that you're installing doesn't have a matching checksum, you
will see something like

-------------------------------------------------------------------------------
RNAME     After Checksum Calculated xxxxxxxxx expected value yyyyyyyyy
-------------------------------------------------------------------------------

This indicates that your release has likely been corrupted somewhere along the
line. In such cases, reach out to the {appname} development team to get a clean
copy of the release.


[[install-pkg]]
=== Install KIDS package

Select option 6, enter the space bar at the [ttsp]##INSTALL NAME## prompt, and
press return at the next three prompts. Note that `[now]` denotes the current
time when you're doing the install.

include::.dtool/install-kids-snippet.adoi[]

// [[dicom]]
// ==== Optional DICOM step

// If you have a DICOM server that you want to integrate with {appname}, use
// `^` and then enter to get back out to the programmer prompt, then use the
// following command:

// -------------------------------------------------------------------------------
// >DO MKSVC^SAMIDMC1
// -------------------------------------------------------------------------------

// This will create four new entries in the Web Service URL handler file to
// register new web services.

// Sites without a DICOM server, or sites that have a DICOM server they do not
// want to integrate with ScreeningPlus, should not run this optional step.

eval::[Section.setlevel(2)]

You now have {appname} {version} (††{va-version}††) installed in your M
environment. The install is now complete. You may leave the M environment by
typing

-------------------------------------------------------------------------------
>halt
$ _
-------------------------------------------------------------------------------

We recommend running tests of your {appname} application to confirm the
environment is operational and bug-free, before notifying users that {appname}
is ready for their use.

[[backout]]
== Optional backout instructions

Should errors or other problems result from installing this package, contact
the {appname} development team for package-backout instructions.

[[routines]]
== Routines

Line 2 of each of these routines now look like:

include::.dtool/routine-lines2.adoi[]

The checksums below are Vista Type B checksums ([ttsp]##do CHECK1^XTSUMBLD##).

include::.dtool/checksums.adoi[]

[[authors]]
== Authors

[cols=">.<0v,<.<0v,<.<1v",width="1%",options="header"]
|==============================================================================
|           | Dates                 | By
| Developed | 2024-09-12/22         | George P. Lilly (VEN) +
                                      Dominic DiNatale (PAR) +
                                      Frederick D. S. Marshall (VEN) +
                                      Kenneth W. McGlothlen (VEN) +
                                      Linda M. R. Yaw (VEN)
| Tested    | 2024-09-24            | George P. Lilly (VEN) +
                                      Artit Jirapatnakul (VA-PHO) +
                                      Linda M. R. Yaw (VEN)
| Released  | 2024-09-25            | Frederick D. S. Marshall (VEN) +
                                      Kenneth W. McGlothlen (VEN) +
                                      Linda M. R. Yaw (VEN)
|==============================================================================

eval::[Section.setlevel(1)]

-------------------------------------------------------------------------------
$END TXT
-------------------------------------------------------------------------------
