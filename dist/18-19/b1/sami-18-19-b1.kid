KIDS Distribution saved on Sep 25, 2024@10:22:01
Released SAMI*18.0*19 SEQ #19
**KIDS**:SAMI*18.0*19^

**INSTALL NAME**
SAMI*18.0*19
"BLD",11520,0)
SAMI*18.0*19^^0^3240925^n
"BLD",11520,4,0)
^9.64PA^^
"BLD",11520,6.3)
1
"BLD",11520,"INID")
^n
"BLD",11520,"INIT")
POS1819^SAMIPAT
"BLD",11520,"KRN",0)
^9.67PA^1.5^25
"BLD",11520,"KRN",.4,0)
.4
"BLD",11520,"KRN",.401,0)
.401
"BLD",11520,"KRN",.402,0)
.402
"BLD",11520,"KRN",.403,0)
.403
"BLD",11520,"KRN",.5,0)
.5
"BLD",11520,"KRN",.84,0)
.84
"BLD",11520,"KRN",1.5,0)
1.5
"BLD",11520,"KRN",1.6,0)
1.6
"BLD",11520,"KRN",1.61,0)
1.61
"BLD",11520,"KRN",1.62,0)
1.62
"BLD",11520,"KRN",3.6,0)
3.6
"BLD",11520,"KRN",3.8,0)
3.8
"BLD",11520,"KRN",9.2,0)
9.2
"BLD",11520,"KRN",9.8,0)
9.8
"BLD",11520,"KRN",9.8,"NM",0)
^9.68A^10^10
"BLD",11520,"KRN",9.8,"NM",1,0)
SAMICTT0^^0^B112661946
"BLD",11520,"KRN",9.8,"NM",2,0)
SAMICTT1^^0^B154195678
"BLD",11520,"KRN",9.8,"NM",3,0)
SAMICTT2^^0^B144641835
"BLD",11520,"KRN",9.8,"NM",4,0)
SAMICTT3^^0^B483869070
"BLD",11520,"KRN",9.8,"NM",5,0)
SAMICTT4^^0^B62798123
"BLD",11520,"KRN",9.8,"NM",6,0)
SAMICTT9^^0^B30422718
"BLD",11520,"KRN",9.8,"NM",7,0)
SAMICTTA^^0^B49833239
"BLD",11520,"KRN",9.8,"NM",8,0)
SAMICTUL^^0^B125001
"BLD",11520,"KRN",9.8,"NM",9,0)
SAMIMOV^^0^B126961045
"BLD",11520,"KRN",9.8,"NM",10,0)
SAMIPAT^^0^B23769617
"BLD",11520,"KRN",9.8,"NM","B","SAMICTT0",1)

"BLD",11520,"KRN",9.8,"NM","B","SAMICTT1",2)

"BLD",11520,"KRN",9.8,"NM","B","SAMICTT2",3)

"BLD",11520,"KRN",9.8,"NM","B","SAMICTT3",4)

"BLD",11520,"KRN",9.8,"NM","B","SAMICTT4",5)

"BLD",11520,"KRN",9.8,"NM","B","SAMICTT9",6)

"BLD",11520,"KRN",9.8,"NM","B","SAMICTTA",7)

"BLD",11520,"KRN",9.8,"NM","B","SAMICTUL",8)

"BLD",11520,"KRN",9.8,"NM","B","SAMIMOV",9)

"BLD",11520,"KRN",9.8,"NM","B","SAMIPAT",10)

"BLD",11520,"KRN",19,0)
19
"BLD",11520,"KRN",19.1,0)
19.1
"BLD",11520,"KRN",101,0)
101
"BLD",11520,"KRN",409.61,0)
409.61
"BLD",11520,"KRN",771,0)
771
"BLD",11520,"KRN",779.2,0)
779.2
"BLD",11520,"KRN",870,0)
870
"BLD",11520,"KRN",8989.51,0)
8989.51
"BLD",11520,"KRN",8989.52,0)
8989.52
"BLD",11520,"KRN",8993,0)
8993
"BLD",11520,"KRN",8994,0)
8994
"BLD",11520,"KRN","B",.4,.4)

"BLD",11520,"KRN","B",.401,.401)

"BLD",11520,"KRN","B",.402,.402)

"BLD",11520,"KRN","B",.403,.403)

"BLD",11520,"KRN","B",.5,.5)

"BLD",11520,"KRN","B",.84,.84)

"BLD",11520,"KRN","B",1.5,1.5)

"BLD",11520,"KRN","B",1.6,1.6)

"BLD",11520,"KRN","B",1.61,1.61)

"BLD",11520,"KRN","B",1.62,1.62)

"BLD",11520,"KRN","B",3.6,3.6)

"BLD",11520,"KRN","B",3.8,3.8)

"BLD",11520,"KRN","B",9.2,9.2)

"BLD",11520,"KRN","B",9.8,9.8)

"BLD",11520,"KRN","B",19,19)

"BLD",11520,"KRN","B",19.1,19.1)

"BLD",11520,"KRN","B",101,101)

"BLD",11520,"KRN","B",409.61,409.61)

"BLD",11520,"KRN","B",771,771)

"BLD",11520,"KRN","B",779.2,779.2)

"BLD",11520,"KRN","B",870,870)

"BLD",11520,"KRN","B",8989.51,8989.51)

"BLD",11520,"KRN","B",8989.52,8989.52)

"BLD",11520,"KRN","B",8993,8993)

"BLD",11520,"KRN","B",8994,8994)

"BLD",11520,"QUES",0)
^9.62^^
"BLD",11520,"REQB",0)
^9.611^^
"INIT")
POS1819^SAMIPAT
"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","SAMICTT0")
0^1^B112661946^B100450717
"RTN","SAMICTT0",1,0)
SAMICTT0 ;ven/gpl - ctreport text main; 2024-09-24t17:09z
"RTN","SAMICTT0",2,0)
 ;;18.0;SAMI;**4,10,11,15,19**;2020-01-17;Build 1
"RTN","SAMICTT0",3,0)
 ;mdc-e1;SAMICTT0-20240924-E3wQFOj;SAMI-18-19-b1
"RTN","SAMICTT0",4,0)
 ;mdc-v7;B112661946;SAMI*18.0*19 SEQ #19
"RTN","SAMICTT0",5,0)
 ;
"RTN","SAMICTT0",6,0)
 ; SAMICTT0 contains a web route & associated subroutines to produce
"RTN","SAMICTT0",7,0)
 ; the ELCAP CT Report in text format (route ctreport, format text).
"RTN","SAMICTT0",8,0)
 ; SAMICTT* routines serve web service interfaces WSVAPALS^SAMIHOM3
"RTN","SAMICTT0",9,0)
 ; (the main VAPALS-ELCAP post web service) & WSHOME^SAMIHOM3 (the
"RTN","SAMICTT0",10,0)
 ; VAPALS-ELCAP home-page service).
"RTN","SAMICTT0",11,0)
 ;
"RTN","SAMICTT0",12,0)
 quit  ; no entry from top
"RTN","SAMICTT0",13,0)
 ;
"RTN","SAMICTT0",14,0)
 ;
"RTN","SAMICTT0",15,0)
 ;
"RTN","SAMICTT0",16,0)
 ;
"RTN","SAMICTT0",17,0)
 ;@section 0 primary development
"RTN","SAMICTT0",18,0)
 ;
"RTN","SAMICTT0",19,0)
 ;
"RTN","SAMICTT0",20,0)
 ;
"RTN","SAMICTT0",21,0)
 ;
"RTN","SAMICTT0",22,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT0",23,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT0",24,0)
 ;
"RTN","SAMICTT0",25,0)
 ;@contents
"RTN","SAMICTT0",26,0)
 ;
"RTN","SAMICTT0",27,0)
 ; WSREPORT web route: ctreport in text format
"RTN","SAMICTT0",28,0)
 ; OUT output a line of ct report
"RTN","SAMICTT0",29,0)
 ; HOUT output a ct report header line
"RTN","SAMICTT0",30,0)
 ; $$XVAL patient value for var
"RTN","SAMICTT0",31,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTT0",32,0)
 ; GETFILTR fill in filter for Ct Eval for sid
"RTN","SAMICTT0",33,0)
 ; T1 test
"RTN","SAMICTT0",34,0)
 ;
"RTN","SAMICTT0",35,0)
 ;
"RTN","SAMICTT0",36,0)
 ;
"RTN","SAMICTT0",37,0)
 ;
"RTN","SAMICTT0",38,0)
 ;@section 1 wsi WSREPORT & related subroutines
"RTN","SAMICTT0",39,0)
 ;
"RTN","SAMICTT0",40,0)
 ;
"RTN","SAMICTT0",41,0)
 ;
"RTN","SAMICTT0",42,0)
 ;
"RTN","SAMICTT0",43,0)
 ;@wsr WSREPORT^SAMICTT0
"RTN","SAMICTT0",44,0)
 ;
"RTN","SAMICTT0",45,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT0",46,0)
 ;
"RTN","SAMICTT0",47,0)
 ;ven/gpl;wsr;procedure;silent;clean?;sac?;tests?;port?
"RTN","SAMICTT0",48,0)
 ;@called-by
"RTN","SAMICTT0",49,0)
 ; WSNOTE^SAMINOT3
"RTN","SAMICTT0",50,0)
 ;  (called-by wsi WSVAPALS^SAMIHOM3)
"RTN","SAMICTT0",51,0)
 ;    (called by wsi WSHOME^SAMIHOM3)
"RTN","SAMICTT0",52,0)
 ;  (sibling to wri WSREPORT^SAMICTR0, keep in sync)
"RTN","SAMICTT0",53,0)
 ;@calls
"RTN","SAMICTT0",54,0)
 ; INIT2GPH^SAMICTD2
"RTN","SAMICTT0",55,0)
 ; $$setroot^%wd
"RTN","SAMICTT0",56,0)
 ; $$XVAL
"RTN","SAMICTT0",57,0)
 ; OUT
"RTN","SAMICTT0",58,0)
 ; $$XSUB
"RTN","SAMICTT0",59,0)
 ; HOUT
"RTN","SAMICTT0",60,0)
 ; NODULES^SAMICTT1
"RTN","SAMICTT0",61,0)
 ; OTHRLUNG^SAMICTT2
"RTN","SAMICTT0",62,0)
 ; EMPHYS^SAMICTT3
"RTN","SAMICTT0",63,0)
 ; BREAST^SAMICTT4
"RTN","SAMICTT0",64,0)
 ; IMPRSN^SAMICTT9
"RTN","SAMICTT0",65,0)
 ; RCMND^SAMICTTA
"RTN","SAMICTT0",66,0)
 ;
"RTN","SAMICTT0",67,0)
 ;
"RTN","SAMICTT0",68,0)
WSREPORT(return,filter) ; web route: ctreport in text format
"RTN","SAMICTT0",69,0)
 ;
"RTN","SAMICTT0",70,0)
 s debug=0
"RTN","SAMICTT0",71,0)
 n outmode s outmode="go"
"RTN","SAMICTT0",72,0)
 n line s line=""
"RTN","SAMICTT0",73,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMICTT0",74,0)
 ;
"RTN","SAMICTT0",75,0)
 ;s rtn=$na(^TMP("SAMICTT",$J))
"RTN","SAMICTT0",76,0)
 s rtn="return"
"RTN","SAMICTT0",77,0)
 k @rtn
"RTN","SAMICTT0",78,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMICTT0",79,0)
 ;
"RTN","SAMICTT0",80,0)
 n cnt s cnt=0 ; line number
"RTN","SAMICTT0",81,0)
 ;
"RTN","SAMICTT0",82,0)
 ; set up dictionary and patient values
"RTN","SAMICTT0",83,0)
 ;
"RTN","SAMICTT0",84,0)
 n dict,vals
"RTN","SAMICTT0",85,0)
 ;d INIT^SAMICTD2("dict")
"RTN","SAMICTT0",86,0)
 s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT0",87,0)
 s dict=$na(@dict@("cteval-dict"))
"RTN","SAMICTT0",88,0)
 i $g(@dict@("pet"))="" d INIT2GPH^SAMICTD2 ; init dictionary 1st time
"RTN","SAMICTT0",89,0)
 n si
"RTN","SAMICTT0",90,0)
 s si=$g(filter("studyid"))
"RTN","SAMICTT0",91,0)
 i si="" d  ;
"RTN","SAMICTT0",92,0)
 . s si="XXX00102"
"RTN","SAMICTT0",93,0)
 . q
"RTN","SAMICTT0",94,0)
 q:si=""
"RTN","SAMICTT0",95,0)
 ;
"RTN","SAMICTT0",96,0)
 n samikey
"RTN","SAMICTT0",97,0)
 s samikey=$g(filter("form"))
"RTN","SAMICTT0",98,0)
 i samikey="" d  ;
"RTN","SAMICTT0",99,0)
 . s samikey="ceform-2018-10-09"
"RTN","SAMICTT0",100,0)
 . q
"RTN","SAMICTT0",101,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICTT0",102,0)
 i $g(filter("studyid"))="" s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICTT0",103,0)
 s vals=$na(@root@("graph",si,samikey))
"RTN","SAMICTT0",104,0)
 ;W !,vals
"RTN","SAMICTT0",105,0)
 ;zwr @vals@(*)
"RTN","SAMICTT0",106,0)
 i '$d(@vals) d  q  ;
"RTN","SAMICTT0",107,0)
 . w !,"error, patient values not found"
"RTN","SAMICTT0",108,0)
 . q
"RTN","SAMICTT0",109,0)
 ;
"RTN","SAMICTT0",110,0)
 ; report parameters
"RTN","SAMICTT0",111,0)
 ;
"RTN","SAMICTT0",112,0)
 n nt,sectionheader,dummy,cac,tex,para,legout
"RTN","SAMICTT0",113,0)
 ;; n lang,lanread
"RTN","SAMICTT0",114,0)
 ;
"RTN","SAMICTT0",115,0)
 s nt=1
"RTN","SAMICTT0",116,0)
 s sectionheader=1
"RTN","SAMICTT0",117,0)
 ;;s dummy="******"
"RTN","SAMICTT0",118,0)
 s cac=""
"RTN","SAMICTT0",119,0)
 n cacrec s cacrec=""
"RTN","SAMICTT0",120,0)
 ;;s tex=0
"RTN","SAMICTT0",121,0)
 ;s para="<p>"
"RTN","SAMICTT0",122,0)
 ;s para=$char(13,10)
"RTN","SAMICTT0",123,0)
 s para=""
"RTN","SAMICTT0",124,0)
 ;;s legout=0
"RTN","SAMICTT0",125,0)
 n qheader s qheader=0
"RTN","SAMICTT0",126,0)
 ;
"RTN","SAMICTT0",127,0)
 n lang s lang=""
"RTN","SAMICTT0",128,0)
 n langread s langread=0
"RTN","SAMICTT0",129,0)
 ;
"RTN","SAMICTT0",130,0)
 n auth s auth("perm")="a"
"RTN","SAMICTT0",131,0)
 s auth("inst")=$g(filter("auth"))
"RTN","SAMICTT0",132,0)
 ;
"RTN","SAMICTT0",133,0)
 n newct s newct=0
"RTN","SAMICTT0",134,0)
 i $$XVAL("ceoppa",vals)'="" s newct=1
"RTN","SAMICTT0",135,0)
 ;
"RTN","SAMICTT0",136,0)
 n registryForm s registryForm=0
"RTN","SAMICTT0",137,0)
 i $$XVAL("ceaf",vals)]"" s registryForm=1
"RTN","SAMICTT0",138,0)
 ;
"RTN","SAMICTT0",139,0)
 ;d OUT("<HTML>")
"RTN","SAMICTT0",140,0)
 ;d OUT("<HEAD>")
"RTN","SAMICTT0",141,0)
 ;d OUT("<!-- Calling TR: CT Evaluation Report -->")
"RTN","SAMICTT0",142,0)
 ;d OUT("<TITLE>CT Evaluation Report</TITLE>")
"RTN","SAMICTT0",143,0)
 ;d OUT("<link rel='stylesheet' href='/css/report.css'>")
"RTN","SAMICTT0",144,0)
 ;d OUT("</HEAD>")
"RTN","SAMICTT0",145,0)
 ;d OUT("<BODY BGCOLOR=""#ffffff"" TEXT=""#000000"">")
"RTN","SAMICTT0",146,0)
 ;;d OUT("<TABLE border=""0"" cellspacing=""0"" cellpadding=""3"" WIDTH=""640""><TR><TD>")
"RTN","SAMICTT0",147,0)
 ;d OUT("<FONT SIZE=""+2""><CENTER>")
"RTN","SAMICTT0",148,0)
 ;d OUT("<!-- Calling TR: CT Evaluation Report -->")
"RTN","SAMICTT0",149,0)
 ;d OUT("<B>CT Evaluation Report</B>")
"RTN","SAMICTT0",150,0)
 d OUT("CT Evaluation Report")
"RTN","SAMICTT0",151,0)
 ;d OUT("</CENTER></FONT>")
"RTN","SAMICTT0",152,0)
 ;d OUT("</TD></TR><TR><TD>")
"RTN","SAMICTT0",153,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT0",154,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT0",155,0)
 ;
"RTN","SAMICTT0",156,0)
 ;d OUT("<!-- patient information -->")
"RTN","SAMICTT0",157,0)
 ;d OUT("<TR><TD><TABLE border=""0"" cellspacing=""0"" cellpadding=""3"" WIDTH=""640"">")
"RTN","SAMICTT0",158,0)
 ;
"RTN","SAMICTT0",159,0)
 ; generate header
"RTN","SAMICTT0",160,0)
 ;
"RTN","SAMICTT0",161,0)
 d  ;
"RTN","SAMICTT0",162,0)
 . n pname
"RTN","SAMICTT0",163,0)
 . ;s pname=$$XVAL("sinamel",vals)_", "_$$XVAL("sinamef",vals)
"RTN","SAMICTT0",164,0)
 . s pname=$$XVAL("saminame",vals)
"RTN","SAMICTT0",165,0)
 . d OUT("Participant Name: "_pname)
"RTN","SAMICTT0",166,0)
 . q
"RTN","SAMICTT0",167,0)
 ;
"RTN","SAMICTT0",168,0)
 ;d OUT("<TR><TD WIDTH=""180""><B>Participant Name:</B></TD><TD WIDTH=""365"">")
"RTN","SAMICTT0",169,0)
 ;d OUT($$XVAL("sinamel",vals)_", "_$$XVAL("sinamef",vals))
"RTN","SAMICTT0",170,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",171,0)
 ;
"RTN","SAMICTT0",172,0)
 d  ;
"RTN","SAMICTT0",173,0)
 . n sid s sid=$$XVAL("sisid",vals)
"RTN","SAMICTT0",174,0)
 . d OUT("Study ID: "_$$GETIDSID^SAMIUID(sid))
"RTN","SAMICTT0",175,0)
 . q
"RTN","SAMICTT0",176,0)
 ;
"RTN","SAMICTT0",177,0)
 ;d OUT("<TD WIDTH=""120""><B>Study ID:</B></TD><TD WIDTH=""75"">")
"RTN","SAMICTT0",178,0)
 ;d OUT($$XVAL("sisid",vals))
"RTN","SAMICTT0",179,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",180,0)
 ;
"RTN","SAMICTT0",181,0)
 n etype
"RTN","SAMICTT0",182,0)
 s etype=""
"RTN","SAMICTT0",183,0)
 d  ;
"RTN","SAMICTT0",184,0)
 . s etype=$$XSUB("cetex",vals,dict)_" "_$$XSUB("cectp",vals,dict)
"RTN","SAMICTT0",185,0)
 . d OUT("Type of Examination: "_etype)
"RTN","SAMICTT0",186,0)
 . q
"RTN","SAMICTT0",187,0)
 ;
"RTN","SAMICTT0",188,0)
 ;d OUT("<TR><TD><B>Type of Examination:</B></TD><TD>")
"RTN","SAMICTT0",189,0)
 ;d OUT($$XSUB("cetex",vals,dict)_" "_$$XSUB("cectp",vals,dict))
"RTN","SAMICTT0",190,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",191,0)
 ;d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",192,0)
 ;
"RTN","SAMICTT0",193,0)
 d  ;
"RTN","SAMICTT0",194,0)
 . n edate s edate=$$XVAL("cedos",vals)
"RTN","SAMICTT0",195,0)
 . d OUT("Examination Date: "_edate)
"RTN","SAMICTT0",196,0)
 . q
"RTN","SAMICTT0",197,0)
 ;
"RTN","SAMICTT0",198,0)
 ;d OUT("<TR><TD><B>Examination Date:</B></TD><TD>")
"RTN","SAMICTT0",199,0)
 ;d OUT($$XVAL("cedos",vals))
"RTN","SAMICTT0",200,0)
 ;
"RTN","SAMICTT0",201,0)
 ;i $$XVAL("sidob",vals)'=-1 d  ;
"RTN","SAMICTT0",202,0)
 ;. d OUT("<TD><B>Date of Birth:</B></TD><TD>")
"RTN","SAMICTT0",203,0)
 ;. d OUT($$XVAL("sidob",vals))
"RTN","SAMICTT0",204,0)
 ;e  d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",205,0)
 ;
"RTN","SAMICTT0",206,0)
 d  ;
"RTN","SAMICTT0",207,0)
 . n dob s dob=$$XVAL("sidob",vals)
"RTN","SAMICTT0",208,0)
 . i dob>0 d OUT("Date of Birth: "_dob)
"RTN","SAMICTT0",209,0)
 . d OUT("")
"RTN","SAMICTT0",210,0)
 . q
"RTN","SAMICTT0",211,0)
 ;
"RTN","SAMICTT0",212,0)
 ;i $$XVAL("sidob",vals)>0 d  ;
"RTN","SAMICTT0",213,0)
 ;. d OUT("<TD><B>Date of Birth:</B></TD><TD>")
"RTN","SAMICTT0",214,0)
 ;. d OUT($$XVAL("sidob",vals))
"RTN","SAMICTT0",215,0)
 ;. d OUT("</TD></TR>")
"RTN","SAMICTT0",216,0)
 ;e  d  ;
"RTN","SAMICTT0",217,0)
 ;. d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",218,0)
 ;
"RTN","SAMICTT0",219,0)
 ;# End of Header
"RTN","SAMICTT0",220,0)
 ;
"RTN","SAMICTT0",221,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTT0",222,0)
 ;;d OUT("</TD></TR><TR><TD>")
"RTN","SAMICTT0",223,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT0",224,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT0",225,0)
 ;d OUT("<!-- report -->")
"RTN","SAMICTT0",226,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTT0",227,0)
 ;d OUT("<FONT SIZE=""+2""><B>")
"RTN","SAMICTT0",228,0)
 ;d OUT("Report:")
"RTN","SAMICTT0",229,0)
 ;d OUT("</B></FONT>")
"RTN","SAMICTT0",230,0)
 ;d OUT("</TD></TR><TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTT0",231,0)
 d OUT("Report:")
"RTN","SAMICTT0",232,0)
 ;
"RTN","SAMICTT0",233,0)
 s outmode="hold"
"RTN","SAMICTT0",234,0)
 s line=""
"RTN","SAMICTT0",235,0)
 i $$XVAL("ceclin",vals)]"" d  ;
"RTN","SAMICTT0",236,0)
 . d HOUT("Clinical Information: ")
"RTN","SAMICTT0",237,0)
 . d OUT($$XVAL("ceclin",vals))
"RTN","SAMICTT0",238,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT0",239,0)
 . q
"RTN","SAMICTT0",240,0)
 ;
"RTN","SAMICTT0",241,0)
 s outmode="hold"
"RTN","SAMICTT0",242,0)
 n nopri s nopri=1
"RTN","SAMICTT0",243,0)
 d HOUT("Comparison CT Scans: ")
"RTN","SAMICTT0",244,0)
 if $$XVAL("cedcs",vals)]"" d  ;
"RTN","SAMICTT0",245,0)
 . ;i etype["Baseline" q  ;
"RTN","SAMICTT0",246,0)
 . d OUT($$XSUB("cetex",vals,dict)_". ")
"RTN","SAMICTT0",247,0)
 . ;d OUT("Comparisons: "_$$XVAL("cedcs",vals))
"RTN","SAMICTT0",248,0)
 . d OUT("Comparisons: ")
"RTN","SAMICTT0",249,0)
 . s nopri=0
"RTN","SAMICTT0",250,0)
 . q
"RTN","SAMICTT0",251,0)
 if $$XVAL("cedps",vals)]"" d  ;
"RTN","SAMICTT0",252,0)
 . ;i etype["Baseline" q  ;
"RTN","SAMICTT0",253,0)
 . d OUT(" "_$$XVAL("cedps",vals))
"RTN","SAMICTT0",254,0)
 . s nopri=0
"RTN","SAMICTT0",255,0)
 . q
"RTN","SAMICTT0",256,0)
 d:nopri OUT("None")
"RTN","SAMICTT0",257,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT0",258,0)
 ;
"RTN","SAMICTT0",259,0)
 s outmode="hold"
"RTN","SAMICTT0",260,0)
 d HOUT("Description: ")
"RTN","SAMICTT0",261,0)
 i $$XVAL("cectp",vals)="i" d  ;
"RTN","SAMICTT0",262,0)
 . d OUT("Limited Diagnostic CT examination was performed. ")
"RTN","SAMICTT0",263,0)
 . q
"RTN","SAMICTT0",264,0)
 e  d  ;
"RTN","SAMICTT0",265,0)
 . d OUT("CT examination of the entire thorax was performed at "_$$XSUB("cectp",vals,dict)_" settings. ")
"RTN","SAMICTT0",266,0)
 . q
"RTN","SAMICTT0",267,0)
 ;
"RTN","SAMICTT0",268,0)
 i $$XVAL("cectrst",vals)]"" d  ;
"RTN","SAMICTT0",269,0)
 . d OUT(" Images were obtained at "_$$XVAL("cectrst",vals)_" mm slice thickness. ")
"RTN","SAMICTT0",270,0)
 . d OUT(" Multiplanar reconstructions were performed. ")
"RTN","SAMICTT0",271,0)
 . q
"RTN","SAMICTT0",272,0)
 ;
"RTN","SAMICTT0",273,0)
 i newct d  ;
"RTN","SAMICTT0",274,0)
 . n nvadbo s nvadbo=1
"RTN","SAMICTT0",275,0)
 . n ii
"RTN","SAMICTT0",276,0)
 . f ii="ceoaa","ceaga","ceasa","ceala","ceapa","ceaaa","ceaka" d  ;
"RTN","SAMICTT0",277,0)
 . . i $$XVAL(ii,vals)="y" set nvadbo=0
"RTN","SAMICTT0",278,0)
 . . q
"RTN","SAMICTT0",279,0)
 . ;
"RTN","SAMICTT0",280,0)
 . i nvadbo=1 d  ;
"RTN","SAMICTT0",281,0)
 . . d OUT("Upper abdominal images were not acquired on the current scan due to its limited nature. ")
"RTN","SAMICTT0",282,0)
 . . q
"RTN","SAMICTT0",283,0)
 . q
"RTN","SAMICTT0",284,0)
 ;
"RTN","SAMICTT0",285,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT0",286,0)
 ;
"RTN","SAMICTT0",287,0)
 ; lung nodules
"RTN","SAMICTT0",288,0)
 ;
"RTN","SAMICTT0",289,0)
 ;d OUT("")
"RTN","SAMICTT0",290,0)
 d HOUT("Lung Nodules:")
"RTN","SAMICTT0",291,0)
 ;d OUT("")
"RTN","SAMICTT0",292,0)
 ;
"RTN","SAMICTT0",293,0)
 ; see if there are any nodules using the cectXch fields
"RTN","SAMICTT0",294,0)
 ;
"RTN","SAMICTT0",295,0)
 n hasnodules s hasnodules=0
"RTN","SAMICTT0",296,0)
 n ij
"RTN","SAMICTT0",297,0)
 f ij=1:1:10 i $$XVAL("cect"_ij_"ch",vals)]"",$$XVAL("cect"_ij_"ch",vals)'="-" s hasnodules=1
"RTN","SAMICTT0",298,0)
 ;
"RTN","SAMICTT0",299,0)
 ; check for small nodule checkboxes
"RTN","SAMICTT0",300,0)
 i $$XVAL("cectancn",vals)=1 s hasnodules=1
"RTN","SAMICTT0",301,0)
 i $$XVAL("cectacn",vals)=1 s hasnodules=1
"RTN","SAMICTT0",302,0)
 ;
"RTN","SAMICTT0",303,0)
 i hasnodules=0 d  ;
"RTN","SAMICTT0",304,0)
 . d OUT(para)
"RTN","SAMICTT0",305,0)
 . d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",306,0)
 . q
"RTN","SAMICTT0",307,0)
 ;
"RTN","SAMICTT0",308,0)
 ;i $$XVAL("cennod",vals)="" d  ;
"RTN","SAMICTT0",309,0)
 ;. d OUT(para)
"RTN","SAMICTT0",310,0)
 ;. d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",311,0)
 ;. q
"RTN","SAMICTT0",312,0)
 ;e  i $$XVAL("ceanod",vals)="n" d  ;
"RTN","SAMICTT0",313,0)
 ;. d OUT(para)
"RTN","SAMICTT0",314,0)
 ;. d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",315,0)
 ;. q
"RTN","SAMICTT0",316,0)
 ;
"RTN","SAMICTT0",317,0)
 d NODULES^SAMICTT1(rtn,.vals,.dict)
"RTN","SAMICTT0",318,0)
 ;
"RTN","SAMICTT0",319,0)
 d OTHRLUNG^SAMICTT2(rtn,.vals,.dict)
"RTN","SAMICTT0",320,0)
 ;
"RTN","SAMICTT0",321,0)
 d EMPHYS^SAMICTT3(rtn,.vals,.dict)
"RTN","SAMICTT0",322,0)
 ;
"RTN","SAMICTT0",323,0)
 d BREAST^SAMICTT4(rtn,.vals,.dict)
"RTN","SAMICTT0",324,0)
 ;
"RTN","SAMICTT0",325,0)
 d IMPRSN^SAMICTT9(rtn,.vals,.dict)
"RTN","SAMICTT0",326,0)
 ;
"RTN","SAMICTT0",327,0)
 d RCMND^SAMICTTA(rtn,.vals,.dict)
"RTN","SAMICTT0",328,0)
 ;
"RTN","SAMICTT0",329,0)
 ; etc etc
"RTN","SAMICTT0",330,0)
 ;
"RTN","SAMICTT0",331,0)
 d  ;
"RTN","SAMICTT0",332,0)
 . d OUT("References:")
"RTN","SAMICTT0",333,0)
 . d OUT("Recommendations for nodules and other findings are detailed in the I-ELCAP Protocol. ")
"RTN","SAMICTT0",334,0)
 . d OUT("A summary and the full I-ELCAP protocol can be viewed at: http://ielcap.org/protocols")
"RTN","SAMICTT0",335,0)
 . q
"RTN","SAMICTT0",336,0)
 ;
"RTN","SAMICTT0",337,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTT0",338,0)
 ;d OUT("<p><br></p><p><b>References:</b><br></p>")
"RTN","SAMICTT0",339,0)
 ;d OUT("<p>Recommendations for nodules and other findings are detailed in the I-ELCAP Protocol.<BR>")
"RTN","SAMICTT0",340,0)
 ;d OUT("A summary and the full I-ELCAP protocol can be viewed at: <a href=""http://ielcap.org/protocols"">http://ielcap.org/protocols</a></p>")
"RTN","SAMICTT0",341,0)
 ;d OUT("</TD></TR></TABLE></TD></TR></TABLE>")
"RTN","SAMICTT0",342,0)
 ;
"RTN","SAMICTT0",343,0)
 ;s debug=1
"RTN","SAMICTT0",344,0)
 d:$g(debug)  ;
"RTN","SAMICTT0",345,0)
 . n zi s zi=""
"RTN","SAMICTT0",346,0)
 . f  s zi=$o(@vals@(zi)) q:zi=""  d  ;
"RTN","SAMICTT0",347,0)
 . . d OUT(zi_" "_$g(@vals@(zi)))
"RTN","SAMICTT0",348,0)
 . . q
"RTN","SAMICTT0",349,0)
 . q
"RTN","SAMICTT0",350,0)
 ;
"RTN","SAMICTT0",351,0)
 ;d OUT("</BODY></HTML>")
"RTN","SAMICTT0",352,0)
 ;
"RTN","SAMICTT0",353,0)
 quit  ; end of wsr WSREPORT^SAMICTT0
"RTN","SAMICTT0",354,0)
 ;
"RTN","SAMICTT0",355,0)
 ;
"RTN","SAMICTT0",356,0)
 ;
"RTN","SAMICTT0",357,0)
 ;
"RTN","SAMICTT0",358,0)
 ;@proc OUT
"RTN","SAMICTT0",359,0)
 ;
"RTN","SAMICTT0",360,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT0",361,0)
 ;
"RTN","SAMICTT0",362,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT0",363,0)
 ;@called-by
"RTN","SAMICTT0",364,0)
 ; WSREPORT
"RTN","SAMICTT0",365,0)
 ;@calls none
"RTN","SAMICTT0",366,0)
 ;@input
"RTN","SAMICTT0",367,0)
 ; ln = output to add
"RTN","SAMICTT0",368,0)
 ; ]rtn output array
"RTN","SAMICTT0",369,0)
 ; ]debug
"RTN","SAMICTT0",370,0)
 ;@thruput
"RTN","SAMICTT0",371,0)
 ; cnt
"RTN","SAMICTT0",372,0)
 ;@output
"RTN","SAMICTT0",373,0)
 ; line added to ct report
"RTN","SAMICTT0",374,0)
 ;
"RTN","SAMICTT0",375,0)
 ;
"RTN","SAMICTT0",376,0)
OUT(ln) ; output ct report line
"RTN","SAMICTT0",377,0)
 ;
"RTN","SAMICTT0",378,0)
 i ln[".." s ln=$p(ln,"..")_"." ; remove double periods at the end
"RTN","SAMICTT0",379,0)
 ;
"RTN","SAMICTT0",380,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT0",381,0)
 s cnt=cnt+1
"RTN","SAMICTT0",382,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT0",383,0)
 n lnn s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",384,0)
 i outmode="go" d  ;
"RTN","SAMICTT0",385,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT0",386,0)
 . s line=""
"RTN","SAMICTT0",387,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",388,0)
 . q
"RTN","SAMICTT0",389,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT0",390,0)
 ;
"RTN","SAMICTT0",391,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT0",392,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT0",393,0)
 . n zs s zs=$STACK
"RTN","SAMICTT0",394,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT0",395,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT0",396,0)
 . q
"RTN","SAMICTT0",397,0)
 ;
"RTN","SAMICTT0",398,0)
 quit  ; end of OUT
"RTN","SAMICTT0",399,0)
 ;
"RTN","SAMICTT0",400,0)
 ;
"RTN","SAMICTT0",401,0)
 ;
"RTN","SAMICTT0",402,0)
 ;
"RTN","SAMICTT0",403,0)
 ;@proc HOUT
"RTN","SAMICTT0",404,0)
 ;
"RTN","SAMICTT0",405,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT0",406,0)
 ;
"RTN","SAMICTT0",407,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT0",408,0)
 ;@called-by
"RTN","SAMICTT0",409,0)
 ; WSREPORT
"RTN","SAMICTT0",410,0)
 ;@calls
"RTN","SAMICTT0",411,0)
 ; OUT
"RTN","SAMICTT0",412,0)
 ;@input
"RTN","SAMICTT0",413,0)
 ; ln = header output to add
"RTN","SAMICTT0",414,0)
 ; ]rtn output array
"RTN","SAMICTT0",415,0)
 ;@output
"RTN","SAMICTT0",416,0)
 ; header line added to ct report
"RTN","SAMICTT0",417,0)
 ;
"RTN","SAMICTT0",418,0)
 ;
"RTN","SAMICTT0",419,0)
HOUT(ln) ; output ct report header line
"RTN","SAMICTT0",420,0)
 ;
"RTN","SAMICTT0",421,0)
 d OUT(ln)
"RTN","SAMICTT0",422,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT0",423,0)
 ;
"RTN","SAMICTT0",424,0)
 quit  ; end of HOUT
"RTN","SAMICTT0",425,0)
 ;
"RTN","SAMICTT0",426,0)
 ;
"RTN","SAMICTT0",427,0)
 ;
"RTN","SAMICTT0",428,0)
 ;
"RTN","SAMICTT0",429,0)
 ;@func $$XVAL
"RTN","SAMICTT0",430,0)
 ;
"RTN","SAMICTT0",431,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT0",432,0)
 ;
"RTN","SAMICTT0",433,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT0",434,0)
 ;@called-by
"RTN","SAMICTT0",435,0)
 ; WSREPORT
"RTN","SAMICTT0",436,0)
 ;@calls none
"RTN","SAMICTT0",437,0)
 ;@input
"RTN","SAMICTT0",438,0)
 ; var
"RTN","SAMICTT0",439,0)
 ; vals is passed by name
"RTN","SAMICTT0",440,0)
 ;@output = patient value for var
"RTN","SAMICTT0",441,0)
 ;
"RTN","SAMICTT0",442,0)
 ;
"RTN","SAMICTT0",443,0)
XVAL(var,vals) ; patient value for var
"RTN","SAMICTT0",444,0)
 ;
"RTN","SAMICTT0",445,0)
 n zr s zr=$g(@vals@(var))
"RTN","SAMICTT0",446,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT0",447,0)
 ;
"RTN","SAMICTT0",448,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT0",449,0)
 ;
"RTN","SAMICTT0",450,0)
 ;
"RTN","SAMICTT0",451,0)
 ;
"RTN","SAMICTT0",452,0)
 ;
"RTN","SAMICTT0",453,0)
 ;@func $$XSUB
"RTN","SAMICTT0",454,0)
 ;
"RTN","SAMICTT0",455,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT0",456,0)
 ;
"RTN","SAMICTT0",457,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT0",458,0)
 ;@called-by
"RTN","SAMICTT0",459,0)
 ; WSREPORT
"RTN","SAMICTT0",460,0)
 ;@calls none
"RTN","SAMICTT0",461,0)
 ;@input
"RTN","SAMICTT0",462,0)
 ; var
"RTN","SAMICTT0",463,0)
 ; vals & dict are passed by name
"RTN","SAMICTT0",464,0)
 ; valdx is used for nodules ala cect2co with nodule # included
"RTN","SAMICTT0",465,0)
 ;@output = dictionary value for var
"RTN","SAMICTT0",466,0)
 ;
"RTN","SAMICTT0",467,0)
 ;
"RTN","SAMICTT0",468,0)
XSUB(var,vals,dict,valdx) ; dictionary value defined by var
"RTN","SAMICTT0",469,0)
 ;
"RTN","SAMICTT0",470,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT0",471,0)
 n zdx s zdx=$g(valdx)
"RTN","SAMICTT0",472,0)
 i zdx="" s zdx=var
"RTN","SAMICTT0",473,0)
 ;
"RTN","SAMICTT0",474,0)
 n zv s zv=$g(@vals@(zdx))
"RTN","SAMICTT0",475,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT0",476,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT0",477,0)
 ;
"RTN","SAMICTT0",478,0)
 n zr s zr=$g(@dict@(var,zv))
"RTN","SAMICTT0",479,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT0",480,0)
 ;
"RTN","SAMICTT0",481,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT0",482,0)
 ;
"RTN","SAMICTT0",483,0)
 ;
"RTN","SAMICTT0",484,0)
 ;
"RTN","SAMICTT0",485,0)
 ;
"RTN","SAMICTT0",486,0)
GETFILTR(filter,sid) ; fill in filter for Ct Eval for sid
"RTN","SAMICTT0",487,0)
 ;
"RTN","SAMICTT0",488,0)
 s filter("studyid")=sid
"RTN","SAMICTT0",489,0)
 n items
"RTN","SAMICTT0",490,0)
 d GETITEMS^SAMICASE("items",sid)
"RTN","SAMICTT0",491,0)
 n zform s zform=$o(items("ceform"))
"RTN","SAMICTT0",492,0)
 s filter("form")=zform
"RTN","SAMICTT0",493,0)
 ;zwr filter
"RTN","SAMICTT0",494,0)
 ;
"RTN","SAMICTT0",495,0)
 quit  ; end of GETFILTR
"RTN","SAMICTT0",496,0)
 ;
"RTN","SAMICTT0",497,0)
 ;
"RTN","SAMICTT0",498,0)
 ;
"RTN","SAMICTT0",499,0)
 ;
"RTN","SAMICTT0",500,0)
T1(grtn,debug) ; test
"RTN","SAMICTT0",501,0)
 ;
"RTN","SAMICTT0",502,0)
 n filter
"RTN","SAMICTT0",503,0)
 ;n sid s sid="XXX00333"
"RTN","SAMICTT0",504,0)
 ;n sid s sid="XXX00484"
"RTN","SAMICTT0",505,0)
 n sid s sid="XXX9000001"
"RTN","SAMICTT0",506,0)
 d GETFILTR(.filter,sid)
"RTN","SAMICTT0",507,0)
 i $g(debug)=1 s filter("debug")=1
"RTN","SAMICTT0",508,0)
 d WSNOTE^SAMINOT3(.grtn,.filter)
"RTN","SAMICTT0",509,0)
 ;d WSREPORT^SAMICTT0(.grtn,.filter)
"RTN","SAMICTT0",510,0)
 ;
"RTN","SAMICTT0",511,0)
 quit  ; end of T1
"RTN","SAMICTT0",512,0)
 ;
"RTN","SAMICTT0",513,0)
 ;
"RTN","SAMICTT0",514,0)
 ;
"RTN","SAMICTT0",515,0)
EOR ; end of routine SAMICTT0
"RTN","SAMICTT1")
0^2^B154195678^B122873178
"RTN","SAMICTT1",1,0)
SAMICTT1 ;ven/gpl - ctreport text nodules; 2024-09-24t16:52z
"RTN","SAMICTT1",2,0)
 ;;18.0;SAMI;**4,10,11,19**;2020-01-17;Build 1
"RTN","SAMICTT1",3,0)
 ;mdc-e1;SAMICTT1-20240924-Egyq4v;SAMI-18-19-b1
"RTN","SAMICTT1",4,0)
 ;mdc-v7;B154195678;SAMI*18.0*19 SEQ #19
"RTN","SAMICTT1",5,0)
 ;
"RTN","SAMICTT1",6,0)
 ; SAMICTT1 creates the Nodules section of the ELCAP CT Report in text
"RTN","SAMICTT1",7,0)
 ; format.
"RTN","SAMICTT1",8,0)
 ;
"RTN","SAMICTT1",9,0)
 quit  ; no entry from top
"RTN","SAMICTT1",10,0)
 ;
"RTN","SAMICTT1",11,0)
 ;
"RTN","SAMICTT1",12,0)
 ;
"RTN","SAMICTT1",13,0)
 ;
"RTN","SAMICTT1",14,0)
 ;@section 0 primary development
"RTN","SAMICTT1",15,0)
 ;
"RTN","SAMICTT1",16,0)
 ;
"RTN","SAMICTT1",17,0)
 ;
"RTN","SAMICTT1",18,0)
 ;
"RTN","SAMICTT1",19,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT1",20,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT1",21,0)
 ;
"RTN","SAMICTT1",22,0)
 ;@contents
"RTN","SAMICTT1",23,0)
 ;
"RTN","SAMICTT1",24,0)
 ; NODULES nodules section of ctreport in text format
"RTN","SAMICTT1",25,0)
 ; OUT output a line of ct report
"RTN","SAMICTT1",26,0)
 ; HOUT output a ct report header line
"RTN","SAMICTT1",27,0)
 ; $$XVAL patient value for var
"RTN","SAMICTT1",28,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTT1",29,0)
 ;
"RTN","SAMICTT1",30,0)
 ;
"RTN","SAMICTT1",31,0)
 ;
"RTN","SAMICTT1",32,0)
 ;
"RTN","SAMICTT1",33,0)
 ;@section 1 NODULES & related subroutines
"RTN","SAMICTT1",34,0)
 ;
"RTN","SAMICTT1",35,0)
 ;
"RTN","SAMICTT1",36,0)
 ;
"RTN","SAMICTT1",37,0)
 ;
"RTN","SAMICTT1",38,0)
 ;@proc OTHRLUNG
"RTN","SAMICTT1",39,0)
 ;
"RTN","SAMICTT1",40,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT1",41,0)
 ;
"RTN","SAMICTT1",42,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT1",43,0)
 ;@called-by
"RTN","SAMICTT1",44,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT1",45,0)
 ;@calls
"RTN","SAMICTT1",46,0)
 ; $$XVAL
"RTN","SAMICTT1",47,0)
 ; OUT
"RTN","SAMICTT1",48,0)
 ; $$XSUB
"RTN","SAMICTT1",49,0)
 ; HOUT
"RTN","SAMICTT1",50,0)
 ;@input
"RTN","SAMICTT1",51,0)
 ; rtn
"RTN","SAMICTT1",52,0)
 ; vals
"RTN","SAMICTT1",53,0)
 ; dict
"RTN","SAMICTT1",54,0)
 ;@output
"RTN","SAMICTT1",55,0)
 ; create nodules section of ct eval report
"RTN","SAMICTT1",56,0)
 ;
"RTN","SAMICTT1",57,0)
 ;
"RTN","SAMICTT1",58,0)
NODULES(rtn,vals,dict) ; nodules section of ctreport in text format
"RTN","SAMICTT1",59,0)
 ;
"RTN","SAMICTT1",60,0)
 ;# Report on Nodules
"RTN","SAMICTT1",61,0)
 n firstitem s firstitem=0
"RTN","SAMICTT1",62,0)
 n outmode s outmode="hold"
"RTN","SAMICTT1",63,0)
 n line s line=""
"RTN","SAMICTT1",64,0)
 n ii s ii=1
"RTN","SAMICTT1",65,0)
 ;# Information for each nodule
"RTN","SAMICTT1",66,0)
 f ii=1:1:10 d  ;
"RTN","SAMICTT1",67,0)
 . i $$XSUB("cectch",vals,dict,"cect"_ii_"ch")="px" q  ;
"RTN","SAMICTT1",68,0)
 . i $$XSUB("cectch",vals,dict,"cect"_ii_"ch")="" q  ;
"RTN","SAMICTT1",69,0)
 . i firstitem=0 d  ;
"RTN","SAMICTT1",70,0)
 . . ;d OUT("<!-- begin nodule info -->")
"RTN","SAMICTT1",71,0)
 . . ;d OUT("<UL TYPE=disc>")
"RTN","SAMICTT1",72,0)
 . . s firstitem=1
"RTN","SAMICTT1",73,0)
 . . q
"RTN","SAMICTT1",74,0)
 . ;
"RTN","SAMICTT1",75,0)
 . ;d OUT("<LI>")
"RTN","SAMICTT1",76,0)
 . n specialcase s specialcase=0
"RTN","SAMICTT1",77,0)
 . n ij,ik
"RTN","SAMICTT1",78,0)
 . s ik=$$XVAL("cect"_ii_"ch",vals)
"RTN","SAMICTT1",79,0)
 . ;f ij="pw","px","pr","pv" i ij=ik s specialcase=1
"RTN","SAMICTT1",80,0)
 . i "pwpxprpv"[ik s specialcase=1
"RTN","SAMICTT1",81,0)
 . ;
"RTN","SAMICTT1",82,0)
 . ;# Example Sentence
"RTN","SAMICTT1",83,0)
 . ;# LUL Nodule 1 is non-calcified, non-solid, 6 mm x 6 mm (with 3 x 3) solid component), smooth edge, previously seen and unchanged. (Series 2, Image 65)
"RTN","SAMICTT1",84,0)
 . ;# [LOCATION] Nodule [N] is [CALCIFICATION], [SOLID], [L] mm x mm, [SMOOTH], [NEW].  (Series [Series], Image [ImageNum]).
"RTN","SAMICTT1",85,0)
 . ;
"RTN","SAMICTT1",86,0)
 . n spic s spic=""
"RTN","SAMICTT1",87,0)
 . i $$XVAL("cect"_ii_"sp",vals)="y" s spic="spiculated, "
"RTN","SAMICTT1",88,0)
 . ;
"RTN","SAMICTT1",89,0)
 . n calcification,calcstr,status
"RTN","SAMICTT1",90,0)
 . s status=$$XVAL("cect"_ii_"st",vals)
"RTN","SAMICTT1",91,0)
 . s @vals@("cect"_ii_"ca")=$s(status="bc":"y",status="pc":"q",1:"n")
"RTN","SAMICTT1",92,0)
 . s calcification=$$XSUB("cectca",vals,dict,"cect"_ii_"ca")
"RTN","SAMICTT1",93,0)
 . i calcification="" s calcstr="is "_spic_$$XSUB("cectnt",vals,dict,"cect"_ii_"nt")_", "
"RTN","SAMICTT1",94,0)
 . e  s calcstr="is "_calcification_", "_spic_$$XSUB("cectnt",vals,dict,"cect"_ii_"nt")_", "
"RTN","SAMICTT1",95,0)
 . ;
"RTN","SAMICTT1",96,0)
 . n vssw s vssw=0
"RTN","SAMICTT1",97,0)
 . n avgss s avgss=0
"RTN","SAMICTT1",98,0)
 . n vssl s vssl=$$XVAL("cect"_ii_"ssl",vals)
"RTN","SAMICTT1",99,0)
 . i vssl'=0 d  ;
"RTN","SAMICTT1",100,0)
 . . s vssw=$$XVAL("cect"_ii_"ssw",vals)
"RTN","SAMICTT1",101,0)
 . . s avgss=(vssl+vssw)/2
"RTN","SAMICTT1",102,0)
 . . s avgss=$j(avgss,1,1)
"RTN","SAMICTT1",103,0)
 . . q
"RTN","SAMICTT1",104,0)
 . n vsl s vsl=$$XVAL("cect"_ii_"sl",vals)
"RTN","SAMICTT1",105,0)
 . n vsw s vsw=$$XVAL("cect"_ii_"sw",vals)
"RTN","SAMICTT1",106,0)
 . n avgs s avgs=$j(vsl+vsw/2,1,1)
"RTN","SAMICTT1",107,0)
 . n scomp s scomp=""
"RTN","SAMICTT1",108,0)
 . ;
"RTN","SAMICTT1",109,0)
 . i $$XVAL("cect"_ii_"ssl",vals)]"" d  ;
"RTN","SAMICTT1",110,0)
 . . ;s scomp=" (solid component "_$$XVAL("cect"_ii_"ssl",vals)_" mm x "_$$XVAL("cect"_ii_"ssw",vals)_" mm average diameter "_avgss_" mm)"
"RTN","SAMICTT1",111,0)
 . . s scomp=", solid component "_$$XVAL("cect"_ii_"ssl",vals)_" mm x "_$$XVAL("cect"_ii_"ssw",vals)_" mm (average diameter of "_avgss_" mm)"
"RTN","SAMICTT1",112,0)
 . . q
"RTN","SAMICTT1",113,0)
 . ;
"RTN","SAMICTT1",114,0)
 . s calcstr=calcstr_$$XVAL("cect"_ii_"sl",vals)_" mm x "_$$XVAL("cect"_ii_"sw",vals)_" mm (average diameter of "_avgs_" mm)"_scomp_", "
"RTN","SAMICTT1",115,0)
 . ;
"RTN","SAMICTT1",116,0)
 . n smooth
"RTN","SAMICTT1",117,0)
 . ;s smooth=$$XSUB("cectse",vals,dict,"cect"_ii_"se")
"RTN","SAMICTT1",118,0)
 . s smooth=$$XVAL("cect"_ii_"se",vals)
"RTN","SAMICTT1",119,0)
 . i smooth="y" s calcstr=calcstr_"smooth edges, "
"RTN","SAMICTT1",120,0)
 . ;e  s calcstr=calcstr_smooth_" edges, " ;nothing if not smooth
"RTN","SAMICTT1",121,0)
 . ;
"RTN","SAMICTT1",122,0)
 . ; adding distance from costal pleura
"RTN","SAMICTT1",123,0)
 . n pldstr
"RTN","SAMICTT1",124,0)
 . s pldstr="within "_$$XVAL("cect"_ii_"pld",vals)_" mm of the costal pleura"
"RTN","SAMICTT1",125,0)
 . ;
"RTN","SAMICTT1",126,0)
 . n skip s skip=0
"RTN","SAMICTT1",127,0)
 . ;# 3 cases: parenchymal, endobronchial, and both
"RTN","SAMICTT1",128,0)
 . ;
"RTN","SAMICTT1",129,0)
 . n loc s loc=""
"RTN","SAMICTT1",130,0)
 . n nloc s nloc=""
"RTN","SAMICTT1",131,0)
 . n en s en=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",132,0)
 . n ll s ll=$$XVAL("cect"_ii_"ll",vals)
"RTN","SAMICTT1",133,0)
 . n endo
"RTN","SAMICTT1",134,0)
 . ;
"RTN","SAMICTT1",135,0)
 . i $l(en)<2!(en="no")!(en="") d  ;
"RTN","SAMICTT1",136,0)
 . . ;# 1) parenchymal only
"RTN","SAMICTT1",137,0)
 . . n X s X=ll
"RTN","SAMICTT1",138,0)
 . . n Y
"RTN","SAMICTT1",139,0)
 . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",140,0)
 . . s loc=Y
"RTN","SAMICTT1",141,0)
 . . s nloc=Y
"RTN","SAMICTT1",142,0)
 . . s endo="Nodule"
"RTN","SAMICTT1",143,0)
 . . q
"RTN","SAMICTT1",144,0)
 . ;
"RTN","SAMICTT1",145,0)
 . e  d  ;
"RTN","SAMICTT1",146,0)
 . . i ll="end" d  ;
"RTN","SAMICTT1",147,0)
 . . . ;# 2) Endobronchial only
"RTN","SAMICTT1",148,0)
 . . . i en="tr" d  ;
"RTN","SAMICTT1",149,0)
 . . . . s endo="Endotracheal Nodule"
"RTN","SAMICTT1",150,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",151,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",152,0)
 . . . . . q
"RTN","SAMICTT1",153,0)
 . . . . ;
"RTN","SAMICTT1",154,0)
 . . . . e  d  ;
"RTN","SAMICTT1",155,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cectch"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",156,0)
 . . . . . . d OUT(endo_" "_ii_" "_calcstr_" is seen. ")
"RTN","SAMICTT1",157,0)
 . . . . . . q
"RTN","SAMICTT1",158,0)
 . . . . . e  d OUT(endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",159,0)
 . . . . . q
"RTN","SAMICTT1",160,0)
 . . . . s skip=1
"RTN","SAMICTT1",161,0)
 . . . . q
"RTN","SAMICTT1",162,0)
 . . . ;
"RTN","SAMICTT1",163,0)
 . . . i en="rm" d  ;
"RTN","SAMICTT1",164,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",165,0)
 . . . . s nloc=$$XSUB("cecten",vals,dict,"cect"_ii_"en")
"RTN","SAMICTT1",166,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",167,0)
 . . . . . ;d OUT("Previously seen "_nloc_" "_endo_" "_ii_" ")
"RTN","SAMICTT1",168,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" in the "_nloc_" "_calcstr_" ")
"RTN","SAMICTT1",169,0)
 . . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",170,0)
 . . . . . q
"RTN","SAMICTT1",171,0)
 . . . . ;
"RTN","SAMICTT1",172,0)
 . . . . e  d  ;
"RTN","SAMICTT1",173,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",174,0)
 . . . . . . ;d OUT(nloc_" "_endo_" "_ii_". ")
"RTN","SAMICTT1",175,0)
 . . . . . . d OUT(endo_" "_ii_" is seen in the "_nloc_" "_calcstr_". ")
"RTN","SAMICTT1",176,0)
 . . . . . . q
"RTN","SAMICTT1",177,0)
 . . . . . ;e  d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",178,0)
 . . . . . e  d OUT(endo_" "_ii_" in the "_nloc_" "_calcstr_", "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",179,0)
 . . . . . q
"RTN","SAMICTT1",180,0)
 . . . . ;
"RTN","SAMICTT1",181,0)
 . . . . s skip=1
"RTN","SAMICTT1",182,0)
 . . . . q
"RTN","SAMICTT1",183,0)
 . . . ;
"RTN","SAMICTT1",184,0)
 . . . i en="bi" d  ;
"RTN","SAMICTT1",185,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",186,0)
 . . . . s loc=$$XSUB("cecten",vals,dict,"cect"_ii_"en")
"RTN","SAMICTT1",187,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",188,0)
 . . . . . ;d OUT("Previously seen "_endo_" "_ii_" in the "_loc)
"RTN","SAMICTT1",189,0)
 . . . . . d OUT("Previously seen "_endo_" "_ii_" in the "_nloc_" "_calcstr_" ")
"RTN","SAMICTT1",190,0)
 . . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",191,0)
 . . . . . q
"RTN","SAMICTT1",192,0)
 . . . . ;
"RTN","SAMICTT1",193,0)
 . . . . e  d  ;
"RTN","SAMICTT1",194,0)
 . . . . . i ($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n") d  ;
"RTN","SAMICTT1",195,0)
 . . . . . . ;d OUT(endo_" "_ii_" is seen in the "_loc_". ")
"RTN","SAMICTT1",196,0)
 . . . . . . d OUT(endo_" "_ii_" is seen in the "_loc_" "_calcstr_". ")
"RTN","SAMICTT1",197,0)
 . . . . . . q
"RTN","SAMICTT1",198,0)
 . . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",199,0)
 . . . . . q
"RTN","SAMICTT1",200,0)
 . . . . ;
"RTN","SAMICTT1",201,0)
 . . . . s skip=1
"RTN","SAMICTT1",202,0)
 . . . . q
"RTN","SAMICTT1",203,0)
 . . . ;
"RTN","SAMICTT1",204,0)
 . . . i skip=0 d  ; "default"
"RTN","SAMICTT1",205,0)
 . . . . s endo="Nodule"
"RTN","SAMICTT1",206,0)
 . . . . n X s X=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",207,0)
 . . . . n Y
"RTN","SAMICTT1",208,0)
 . . . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",209,0)
 . . . . s nloc=Y
"RTN","SAMICTT1",210,0)
 . . . . ;
"RTN","SAMICTT1",211,0)
 . . . . i specialcase=1 d  ;
"RTN","SAMICTT1",212,0)
 . . . . . d OUT(nloc_" "_endo_" "_ii_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_", likely endobronchial. ")
"RTN","SAMICTT1",213,0)
 . . . . . q
"RTN","SAMICTT1",214,0)
 . . . . ;
"RTN","SAMICTT1",215,0)
 . . . . e  d  ;
"RTN","SAMICTT1",216,0)
 . . . . . ;i ($$XVAL("cetex",vals)="b")&($$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n") d  ;
"RTN","SAMICTT1",217,0)
 . . . . . i (($$XVAL("cetex",vals)="b")&($$XVAL("cect"_ii_"ch",vals)="n")) d  ; gpl 1002
"RTN","SAMICTT1",218,0)
 . . . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" likely endobronchial. ")
"RTN","SAMICTT1",219,0)
 . . . . . . q
"RTN","SAMICTT1",220,0)
 . . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_" likely endobronchial. ")
"RTN","SAMICTT1",221,0)
 . . . . ;
"RTN","SAMICTT1",222,0)
 . . . . s skip=1
"RTN","SAMICTT1",223,0)
 . . . . q
"RTN","SAMICTT1",224,0)
 . . . q
"RTN","SAMICTT1",225,0)
 . . ;
"RTN","SAMICTT1",226,0)
 . . e  d  ;
"RTN","SAMICTT1",227,0)
 . . . s endo="Nodule"
"RTN","SAMICTT1",228,0)
 . . . s loc=$$XSUB("cectll",vals,dict,"cect"_ii_"ll")
"RTN","SAMICTT1",229,0)
 . . . n X s X=$$XVAL("cect"_ii_"en",vals)
"RTN","SAMICTT1",230,0)
 . . . n Y
"RTN","SAMICTT1",231,0)
 . . . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT1",232,0)
 . . . s nloc=Y
"RTN","SAMICTT1",233,0)
 . . . ;
"RTN","SAMICTT1",234,0)
 . . . i specialcase=1 d  ;
"RTN","SAMICTT1",235,0)
 . . . . d OUT(nloc_" "_endo_" "_ii_" previously seen with possible endobronchial component")
"RTN","SAMICTT1",236,0)
 . . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",237,0)
 . . . . q
"RTN","SAMICTT1",238,0)
 . . . ;
"RTN","SAMICTT1",239,0)
 . . . e  d  ;
"RTN","SAMICTT1",240,0)
 . . . . ;i $$XVAL("cetex",vals)="b",$$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n" d  ;
"RTN","SAMICTT1",241,0)
 . . . . i $$XVAL("cetex",vals)="b",$$XVAL("cect"_ii_"ch",vals)="n" d  ; gpl 1002
"RTN","SAMICTT1",242,0)
 . . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" with possible endobronchial component")
"RTN","SAMICTT1",243,0)
 . . . . . q
"RTN","SAMICTT1",244,0)
 . . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" with possible endobronchial component "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",245,0)
 . . . . q
"RTN","SAMICTT1",246,0)
 . . . ;
"RTN","SAMICTT1",247,0)
 . . . s skip=1
"RTN","SAMICTT1",248,0)
 . . . q
"RTN","SAMICTT1",249,0)
 . . q
"RTN","SAMICTT1",250,0)
 . ;
"RTN","SAMICTT1",251,0)
 . i specialcase=1 d  ;
"RTN","SAMICTT1",252,0)
 . . i skip=0 d  ;
"RTN","SAMICTT1",253,0)
 . . . d OUT("Previously seen "_nloc_" "_endo_" "_ii_" ")
"RTN","SAMICTT1",254,0)
 . . . d OUT($$XSUB("cectch",vals,dict,"cect"_ii_"ch")_". ")
"RTN","SAMICTT1",255,0)
 . . . q
"RTN","SAMICTT1",256,0)
 . . q
"RTN","SAMICTT1",257,0)
 . ;
"RTN","SAMICTT1",258,0)
 . e  d  ;
"RTN","SAMICTT1",259,0)
 . . i skip=0 d  ;
"RTN","SAMICTT1",260,0)
 . . . ;# pleural distance only goes here
"RTN","SAMICTT1",261,0)
 . . . i $$XVAL("cect"_ii_"pld",vals)]"" s calcstr=calcstr_" "_pldstr_","
"RTN","SAMICTT1",262,0)
 . . . ;# Special Handling for "newly seen" on baseline
"RTN","SAMICTT1",263,0)
 . . . ;i $$XVAL("cetex",vals)="b",$$XSUB("cectch",vals,dict,"cect"_ii_"ch")="n" d  ;
"RTN","SAMICTT1",264,0)
 . . . i $$XVAL("cetex",vals)="b",$$XVAL("cect"_ii_"ch",vals)="n" d  ; gpl 1002
"RTN","SAMICTT1",265,0)
 . . . . d OUT(nloc_" "_endo_" "_ii_" "_calcstr)
"RTN","SAMICTT1",266,0)
 . . . . q
"RTN","SAMICTT1",267,0)
 . . . e  d OUT(nloc_" "_endo_" "_ii_" "_calcstr_" "_$$XSUB("cectch",vals,dict,"cect"_ii_"ch")_" ")
"RTN","SAMICTT1",268,0)
 . . . q
"RTN","SAMICTT1",269,0)
 . . ;
"RTN","SAMICTT1",270,0)
 . . d OUT(" (Series "_$$XVAL("cect"_ii_"sn",vals)_",") ; added from 1114 gpl1
"RTN","SAMICTT1",271,0)
 . . ;
"RTN","SAMICTT1",272,0)
 . . ;i $$XVAL("cect"_ii_"inl",vals)=$$XVAL("cect"_ii_"inh",vals) d  ;
"RTN","SAMICTT1",273,0)
 . . ;. d OUT(" image "_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",274,0)
 . . ;. q
"RTN","SAMICTT1",275,0)
 . . ;e  d  ;
"RTN","SAMICTT1",276,0)
 . . ;. d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",277,0)
 . . ;. q
"RTN","SAMICTT1",278,0)
 . . ;
"RTN","SAMICTT1",279,0)
 . . i $$XVAL("cect"_ii_"inh",vals)="" d  ;
"RTN","SAMICTT1",280,0)
 . . . d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_"). ")
"RTN","SAMICTT1",281,0)
 . . . q
"RTN","SAMICTT1",282,0)
 . . ;
"RTN","SAMICTT1",283,0)
 . . e  d  ;
"RTN","SAMICTT1",284,0)
 . . . d OUT(" image "_$$XVAL("cect"_ii_"inl",vals)_"-"_$$XVAL("cect"_ii_"inh",vals)_"). ")
"RTN","SAMICTT1",285,0)
 . . . q
"RTN","SAMICTT1",286,0)
 . . ;
"RTN","SAMICTT1",287,0)
 . . i $$XVAL("cect"_ii_"co",vals)]"" d OUT($$XVAL("cect"_ii_"co",vals)_". ") ;1122 gpl1
"RTN","SAMICTT1",288,0)
 . . n ac s ac=$$XVAL("cect"_ii_"ac",vals)
"RTN","SAMICTT1",289,0)
 . . i ac]"",ac'="-",ac'="s" d  ;
"RTN","SAMICTT1",290,0)
 . . . d OUT($$XSUB("cectac",vals,dict,"cect"_ii_"ac")_" recommended. ")
"RTN","SAMICTT1",291,0)
 . . . q
"RTN","SAMICTT1",292,0)
 . . q
"RTN","SAMICTT1",293,0)
 . ;
"RTN","SAMICTT1",294,0)
 . ; end of nodule processing
"RTN","SAMICTT1",295,0)
 . ;
"RTN","SAMICTT1",296,0)
 . s outmode="go"
"RTN","SAMICTT1",297,0)
 . d OUT("")
"RTN","SAMICTT1",298,0)
 . s outmode="hold"
"RTN","SAMICTT1",299,0)
 . q
"RTN","SAMICTT1",300,0)
 ;
"RTN","SAMICTT1",301,0)
 i firstitem'=0 d  ;
"RTN","SAMICTT1",302,0)
 . ;d OUT("</UL>")
"RTN","SAMICTT1",303,0)
 . ;d OUT("<!-- end nodule info -->")
"RTN","SAMICTT1",304,0)
 . q
"RTN","SAMICTT1",305,0)
 ;
"RTN","SAMICTT1",306,0)
 ;d OUT("</p>")
"RTN","SAMICTT1",307,0)
 ;
"RTN","SAMICTT1",308,0)
 ; added 5/19/21 gpl
"RTN","SAMICTT1",309,0)
 s outmode="go"
"RTN","SAMICTT1",310,0)
 i $$XVAL("cectancn",vals)=1 d
"RTN","SAMICTT1",311,0)
 . d OUT("Small non-calcified nodules are present ")
"RTN","SAMICTT1",312,0)
 . q
"RTN","SAMICTT1",313,0)
 ;
"RTN","SAMICTT1",314,0)
 i $$XVAL("cectacn",vals)=1 d
"RTN","SAMICTT1",315,0)
 . d OUT("Small calcified nodules are present ")
"RTN","SAMICTT1",316,0)
 . q
"RTN","SAMICTT1",317,0)
 ;
"RTN","SAMICTT1",318,0)
 d OUT(" ")
"RTN","SAMICTT1",319,0)
 ;
"RTN","SAMICTT1",320,0)
 quit  ; end of NODULES
"RTN","SAMICTT1",321,0)
 ;
"RTN","SAMICTT1",322,0)
 ;
"RTN","SAMICTT1",323,0)
 ;
"RTN","SAMICTT1",324,0)
 ;
"RTN","SAMICTT1",325,0)
 ;@proc OUT
"RTN","SAMICTT1",326,0)
 ;
"RTN","SAMICTT1",327,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT1",328,0)
 ;
"RTN","SAMICTT1",329,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT1",330,0)
 ;@called-by
"RTN","SAMICTT1",331,0)
 ; NODULES
"RTN","SAMICTT1",332,0)
 ;@calls none
"RTN","SAMICTT1",333,0)
 ;@input
"RTN","SAMICTT1",334,0)
 ; ln = output to add
"RTN","SAMICTT1",335,0)
 ; ]rtn output array
"RTN","SAMICTT1",336,0)
 ; ]debug
"RTN","SAMICTT1",337,0)
 ;@thruput
"RTN","SAMICTT1",338,0)
 ; cnt
"RTN","SAMICTT1",339,0)
 ;@output
"RTN","SAMICTT1",340,0)
 ; line added to ct report
"RTN","SAMICTT1",341,0)
 ;
"RTN","SAMICTT1",342,0)
 ;
"RTN","SAMICTT1",343,0)
OUT(ln) ; output ct report line
"RTN","SAMICTT1",344,0)
 ;
"RTN","SAMICTT1",345,0)
 i ln[".." s ln=$p(ln,"..")_"." ; remove double periods at the end
"RTN","SAMICTT1",346,0)
 ;
"RTN","SAMICTT1",347,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT1",348,0)
 s cnt=cnt+1
"RTN","SAMICTT1",349,0)
 ;s debug=1
"RTN","SAMICTT1",350,0)
 n lnn s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT1",351,0)
 i outmode="go" d  ;
"RTN","SAMICTT1",352,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT1",353,0)
 . s line=""
"RTN","SAMICTT1",354,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT1",355,0)
 . q
"RTN","SAMICTT1",356,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT1",357,0)
 ;
"RTN","SAMICTT1",358,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT1",359,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT1",360,0)
 . n zs s zs=$STACK
"RTN","SAMICTT1",361,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT1",362,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT1",363,0)
 . q
"RTN","SAMICTT1",364,0)
 ;
"RTN","SAMICTT1",365,0)
 quit  ; end of OUT
"RTN","SAMICTT1",366,0)
 ;
"RTN","SAMICTT1",367,0)
 ;
"RTN","SAMICTT1",368,0)
 ;
"RTN","SAMICTT1",369,0)
 ;
"RTN","SAMICTT1",370,0)
 ;@proc HOUT
"RTN","SAMICTT1",371,0)
 ;
"RTN","SAMICTT1",372,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT1",373,0)
 ;
"RTN","SAMICTT1",374,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT1",375,0)
 ;@called-by
"RTN","SAMICTT1",376,0)
 ; NODULES
"RTN","SAMICTT1",377,0)
 ;@calls
"RTN","SAMICTT1",378,0)
 ; OUT
"RTN","SAMICTT1",379,0)
 ;@input
"RTN","SAMICTT1",380,0)
 ; ln = header output to add
"RTN","SAMICTT1",381,0)
 ; ]rtn output array
"RTN","SAMICTT1",382,0)
 ;@output
"RTN","SAMICTT1",383,0)
 ; header line added to ct report
"RTN","SAMICTT1",384,0)
 ;
"RTN","SAMICTT1",385,0)
 ;
"RTN","SAMICTT1",386,0)
HOUT(ln) ; output ct report header line
"RTN","SAMICTT1",387,0)
 ;
"RTN","SAMICTT1",388,0)
 d OUT(ln)
"RTN","SAMICTT1",389,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT1",390,0)
 ;
"RTN","SAMICTT1",391,0)
 quit  ; end of HOUT
"RTN","SAMICTT1",392,0)
 ;
"RTN","SAMICTT1",393,0)
 ;
"RTN","SAMICTT1",394,0)
 ;
"RTN","SAMICTT1",395,0)
 ;
"RTN","SAMICTT1",396,0)
 ;@func $$XVAL
"RTN","SAMICTT1",397,0)
 ;
"RTN","SAMICTT1",398,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT1",399,0)
 ;
"RTN","SAMICTT1",400,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT1",401,0)
 ;@called-by
"RTN","SAMICTT1",402,0)
 ; NODULES
"RTN","SAMICTT1",403,0)
 ;@calls none
"RTN","SAMICTT1",404,0)
 ;@input
"RTN","SAMICTT1",405,0)
 ; var
"RTN","SAMICTT1",406,0)
 ; vals is passed by name
"RTN","SAMICTT1",407,0)
 ;@output = patient value for var
"RTN","SAMICTT1",408,0)
 ;
"RTN","SAMICTT1",409,0)
 ;
"RTN","SAMICTT1",410,0)
XVAL(var,vals) ; patient value for var
"RTN","SAMICTT1",411,0)
 ;
"RTN","SAMICTT1",412,0)
 n zr s zr=$g(@vals@(var))
"RTN","SAMICTT1",413,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT1",414,0)
 ;
"RTN","SAMICTT1",415,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT1",416,0)
 ;
"RTN","SAMICTT1",417,0)
 ;
"RTN","SAMICTT1",418,0)
 ;
"RTN","SAMICTT1",419,0)
 ;
"RTN","SAMICTT1",420,0)
 ;@func $$XSUB
"RTN","SAMICTT1",421,0)
 ;
"RTN","SAMICTT1",422,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT1",423,0)
 ;
"RTN","SAMICTT1",424,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT1",425,0)
 ;@called-by
"RTN","SAMICTT1",426,0)
 ; NODULES
"RTN","SAMICTT1",427,0)
 ;@calls none
"RTN","SAMICTT1",428,0)
 ;@input
"RTN","SAMICTT1",429,0)
 ; var
"RTN","SAMICTT1",430,0)
 ; vals & dict are passed by name
"RTN","SAMICTT1",431,0)
 ; valdx is used for nodules ala cect2co with nodule # included
"RTN","SAMICTT1",432,0)
 ;@output = dictionary value for var
"RTN","SAMICTT1",433,0)
 ;
"RTN","SAMICTT1",434,0)
 ;
"RTN","SAMICTT1",435,0)
XSUB(var,vals,dict,valdx) ; dictionary value defined by var
"RTN","SAMICTT1",436,0)
 ;
"RTN","SAMICTT1",437,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT1",438,0)
 n zdx s zdx=$g(valdx)
"RTN","SAMICTT1",439,0)
 i zdx="" s zdx=var
"RTN","SAMICTT1",440,0)
 ;
"RTN","SAMICTT1",441,0)
 n zv s zv=$g(@vals@(zdx))
"RTN","SAMICTT1",442,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT1",443,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT1",444,0)
 ;
"RTN","SAMICTT1",445,0)
 n zr s zr=$g(@dict@(var,zv))
"RTN","SAMICTT1",446,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT1",447,0)
 ;
"RTN","SAMICTT1",448,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT1",449,0)
 ;
"RTN","SAMICTT1",450,0)
 ;
"RTN","SAMICTT1",451,0)
 ;
"RTN","SAMICTT1",452,0)
EOR ; end of routine SAMICTT1
"RTN","SAMICTT2")
0^3^B144641835^B115984956
"RTN","SAMICTT2",1,0)
SAMICTT2 ;ven/gpl - ctreport text other lung; 2024-09-24t16:28z
"RTN","SAMICTT2",2,0)
 ;;18.0;SAMI;**4,10,19**;2020-01-17;Build 1
"RTN","SAMICTT2",3,0)
 ;mdc-e1;SAMICTT2-20240924-E1bbLr;SAMI-18-19-b1
"RTN","SAMICTT2",4,0)
 ;mdc-v7;B144641835;SAMI*18.0*19 SEQ #19
"RTN","SAMICTT2",5,0)
 ;
"RTN","SAMICTT2",6,0)
 ; SAMICTT2 creates the Other Lung Findings section of the ELCAP CT
"RTN","SAMICTT2",7,0)
 ; Report in text format.
"RTN","SAMICTT2",8,0)
 ;
"RTN","SAMICTT2",9,0)
 quit  ; no entry from top
"RTN","SAMICTT2",10,0)
 ;
"RTN","SAMICTT2",11,0)
 ;
"RTN","SAMICTT2",12,0)
 ;
"RTN","SAMICTT2",13,0)
 ;
"RTN","SAMICTT2",14,0)
 ;@section 0 primary development
"RTN","SAMICTT2",15,0)
 ;
"RTN","SAMICTT2",16,0)
 ;
"RTN","SAMICTT2",17,0)
 ;
"RTN","SAMICTT2",18,0)
 ;
"RTN","SAMICTT2",19,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT2",20,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT2",21,0)
 ;
"RTN","SAMICTT2",22,0)
 ;@contents
"RTN","SAMICTT2",23,0)
 ;
"RTN","SAMICTT2",24,0)
 ; OTHRLUNG other lung findings section of ctreport in text format
"RTN","SAMICTT2",25,0)
 ; $$LOBESTR extrinsic returns lobes
"RTN","SAMICTT2",26,0)
 ; HLFIND references & sets lfind in calling routine
"RTN","SAMICTT2",27,0)
 ; OUT output a line of ct report
"RTN","SAMICTT2",28,0)
 ; HOUT output a ct report header line
"RTN","SAMICTT2",29,0)
 ; $$XVAL patient value for var
"RTN","SAMICTT2",30,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTT2",31,0)
 ;
"RTN","SAMICTT2",32,0)
 ;
"RTN","SAMICTT2",33,0)
 ;
"RTN","SAMICTT2",34,0)
 ;
"RTN","SAMICTT2",35,0)
 ;@section 1 OTHRLUNG & related subroutines
"RTN","SAMICTT2",36,0)
 ;
"RTN","SAMICTT2",37,0)
 ;
"RTN","SAMICTT2",38,0)
 ;
"RTN","SAMICTT2",39,0)
 ;
"RTN","SAMICTT2",40,0)
 ;@proc OTHRLUNG
"RTN","SAMICTT2",41,0)
 ;
"RTN","SAMICTT2",42,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT2",43,0)
 ;
"RTN","SAMICTT2",44,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT2",45,0)
 ;@called-by
"RTN","SAMICTT2",46,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT2",47,0)
 ;@calls
"RTN","SAMICTT2",48,0)
 ; $$XVAL
"RTN","SAMICTT2",49,0)
 ; HLFIND
"RTN","SAMICTT2",50,0)
 ; OUT
"RTN","SAMICTT2",51,0)
 ; $$LOBESTR
"RTN","SAMICTT2",52,0)
 ;@input
"RTN","SAMICTT2",53,0)
 ; rtn
"RTN","SAMICTT2",54,0)
 ; vals
"RTN","SAMICTT2",55,0)
 ; dict
"RTN","SAMICTT2",56,0)
 ;@output
"RTN","SAMICTT2",57,0)
 ; create other lung findings section of ct eval report
"RTN","SAMICTT2",58,0)
 ;
"RTN","SAMICTT2",59,0)
 ;
"RTN","SAMICTT2",60,0)
OTHRLUNG(rtn,vals,dict) ; other lung findings sect of ct report text
"RTN","SAMICTT2",61,0)
 ;
"RTN","SAMICTT2",62,0)
 ; repgen2,repgen3
"RTN","SAMICTT2",63,0)
 ;
"RTN","SAMICTT2",64,0)
 ; starts at "Other lung findings:"
"RTN","SAMICTT2",65,0)
 ;
"RTN","SAMICTT2",66,0)
 ;#hputs "Other lung findings:"
"RTN","SAMICTT2",67,0)
 s outmode="hold"
"RTN","SAMICTT2",68,0)
 n line s line=""
"RTN","SAMICTT2",69,0)
 ;
"RTN","SAMICTT2",70,0)
 n sp1 s sp1="  "
"RTN","SAMICTT2",71,0)
 n hfind s hfind=0
"RTN","SAMICTT2",72,0)
 n lfind s lfind=0
"RTN","SAMICTT2",73,0)
 n yespp s yespp=0
"RTN","SAMICTT2",74,0)
 n newct s newct=1
"RTN","SAMICTT2",75,0)
 ;
"RTN","SAMICTT2",76,0)
 ;# Add handling for new sections
"RTN","SAMICTT2",77,0)
 ;# ceopp is new, if it doensn't exist skip whole section
"RTN","SAMICTT2",78,0)
 ;# only then should old fields be included.
"RTN","SAMICTT2",79,0)
 ;
"RTN","SAMICTT2",80,0)
 i $g(newct)=1 d  ;
"RTN","SAMICTT2",81,0)
 . i "y"="y" d  ;
"RTN","SAMICTT2",82,0)
 . . s yespp=1
"RTN","SAMICTT2",83,0)
 . . i $$XVAL("cecbc",vals)="y" d  ;
"RTN","SAMICTT2",84,0)
 . . . d HLFIND ;
"RTN","SAMICTT2",85,0)
 . . . d OUT(sp1_"Cyst seen in the "_$$LOBESTR("cecbcl1^cecbcl2^cecbcl3^cecbcl4^cecbcl5",0)_". ") d OUT("")
"RTN","SAMICTT2",86,0)
 . . . ;d OUT($$LOBESTR("cecbcl1^cecbcl2^cecbcl3^cecbcl4^cecbcl5",0)_". ")
"RTN","SAMICTT2",87,0)
 . . . s yespp=1
"RTN","SAMICTT2",88,0)
 . . . q
"RTN","SAMICTT2",89,0)
 . . ;
"RTN","SAMICTT2",90,0)
 . . if $$XVAL("cecbb",vals)="y" d  ;
"RTN","SAMICTT2",91,0)
 . . . d HLFIND ; 
"RTN","SAMICTT2",92,0)
 . . . ;d OUT("<br>"_"Bleb or bullae seen in the ")
"RTN","SAMICTT2",93,0)
 . . . d OUT(sp1_"Bleb or bullae seen in the "_$$LOBESTR("cecbbl1^cecbbl2^cecbbl3^cecbbl4^cecbbl5",0)_". ") d OUT("")
"RTN","SAMICTT2",94,0)
 . . . set yespp=1
"RTN","SAMICTT2",95,0)
 . . . q
"RTN","SAMICTT2",96,0)
 . . ;
"RTN","SAMICTT2",97,0)
 . . if $$XVAL("cebrsb",vals)="y" d  ;
"RTN","SAMICTT2",98,0)
 . . . d HLFIND ; 
"RTN","SAMICTT2",99,0)
 . . . ;d OUT("<br>"_"Bronchiectasis in the ")
"RTN","SAMICTT2",100,0)
 . . . d OUT(sp1_"Bronchiectasis in the "_$$LOBESTR("cebrsbl1^cebrsbl2^cebrsbl3^cebrsbl4^cebrsbl5",0)_". ") d OUT("")
"RTN","SAMICTT2",101,0)
 . . . set yespp=1
"RTN","SAMICTT2",102,0)
 . . . q
"RTN","SAMICTT2",103,0)
 . . ;
"RTN","SAMICTT2",104,0)
 . . if $$XVAL("cebrs",vals)="y" d  ;
"RTN","SAMICTT2",105,0)
 . . . if $$XVAL("cebrsb",vals)'="y" d  ;
"RTN","SAMICTT2",106,0)
 . . . . if $$XVAL("cebrss",vals)'="y" d  ;
"RTN","SAMICTT2",107,0)
 . . . . . d HLFIND ;
"RTN","SAMICTT2",108,0)
 . . . . . ;d OUT("<br>"_"Small Airways Disease in the ")
"RTN","SAMICTT2",109,0)
 . . . . . d OUT(sp1_"Small Airways Disease in the "_$$LOBESTR("cebrsl1^cebrsl2^cebrsl3^cebrsl4^cebrsl5",0)_". ") d OUT("")
"RTN","SAMICTT2",110,0)
 . . . . . set yespp=1
"RTN","SAMICTT2",111,0)
 . . . . . q
"RTN","SAMICTT2",112,0)
 . . . . q
"RTN","SAMICTT2",113,0)
 . . . q
"RTN","SAMICTT2",114,0)
 . . ;
"RTN","SAMICTT2",115,0)
 . . if $$XVAL("cebrss",vals)="y" d  ;
"RTN","SAMICTT2",116,0)
 . . . d HLFIND ;
"RTN","SAMICTT2",117,0)
 . . . ;d OUT("<br>"_"Small Airways Disease/Bronchiolectasis in the ")
"RTN","SAMICTT2",118,0)
 . . . d OUT(sp1_"Small Airways Disease/Bronchiolectasis in the "_$$LOBESTR("cebrssl1^cebrssl2^cebrssl3^cebrssl4^cebrssl5",0)_". ") d OUT("")
"RTN","SAMICTT2",119,0)
 . . . set yespp=1
"RTN","SAMICTT2",120,0)
 . . . q
"RTN","SAMICTT2",121,0)
 . . ;
"RTN","SAMICTT2",122,0)
 . . n numl s numl=0
"RTN","SAMICTT2",123,0)
 . . n str s str=""
"RTN","SAMICTT2",124,0)
 . . if $$XVAL("cebs",vals)="o" d  ;
"RTN","SAMICTT2",125,0)
 . . . set yespp=1
"RTN","SAMICTT2",126,0)
 . . . set numl=0
"RTN","SAMICTT2",127,0)
 . . . set str="Normal bronchial resection margin on"
"RTN","SAMICTT2",128,0)
 . . . if $$XVAL("cebsrt",vals)="r" d  ;
"RTN","SAMICTT2",129,0)
 . . . . s str=str_" right"
"RTN","SAMICTT2",130,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",131,0)
 . . . . q
"RTN","SAMICTT2",132,0)
 . . . ;
"RTN","SAMICTT2",133,0)
 . . . if $$XVAL("cebslt",vals)="l" d  ;
"RTN","SAMICTT2",134,0)
 . . . . if numl>0 d  ;
"RTN","SAMICTT2",135,0)
 . . . . . s str=str_" and"
"RTN","SAMICTT2",136,0)
 . . . . s str=str_" left"
"RTN","SAMICTT2",137,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",138,0)
 . . . . q
"RTN","SAMICTT2",139,0)
 . . . ;
"RTN","SAMICTT2",140,0)
 . . . s str=str_". "
"RTN","SAMICTT2",141,0)
 . . . if numl=0 d  ;
"RTN","SAMICTT2",142,0)
 . . . . set str="Normal bronchial resection margin noted. "
"RTN","SAMICTT2",143,0)
 . . . . q
"RTN","SAMICTT2",144,0)
 . . . ;
"RTN","SAMICTT2",145,0)
 . . . d HLFIND ;
"RTN","SAMICTT2",146,0)
 . . . d OUT(sp1_str)
"RTN","SAMICTT2",147,0)
 . . . ;d OUT("<br>")
"RTN","SAMICTT2",148,0)
 . . . q
"RTN","SAMICTT2",149,0)
 . . ;
"RTN","SAMICTT2",150,0)
 . . ;if $$XVAL("cebrsb",vals)="y" d  ;
"RTN","SAMICTT2",151,0)
 . . ;. d HLFIND
"RTN","SAMICTT2",152,0)
 . . ;. d OUT("<br>"_"Bronchiectasis in the ")
"RTN","SAMICTT2",153,0)
 . . ;. d OUT($$LOBESTR("cebrsbl1^cebrsbl2^cebrsbl3^cebrsbl4^cebrsbl5",0)_". ")
"RTN","SAMICTT2",154,0)
 . . ;. set yespp=1
"RTN","SAMICTT2",155,0)
 . . ;
"RTN","SAMICTT2",156,0)
 . . if $$XVAL("ceild",vals)="y" d  ;
"RTN","SAMICTT2",157,0)
 . . . d HLFIND
"RTN","SAMICTT2",158,0)
 . . . ;d OUT("<br>"_"Evidence of interstitial lung disease in the ")
"RTN","SAMICTT2",159,0)
 . . . d OUT(sp1_"Evidence of interstitial lung disease in the "_$$LOBESTR("ceildl1^ceildl2^ceildl3^ceildl4^ceildl5",0)_". ") d OUT("")
"RTN","SAMICTT2",160,0)
 . . . set yespp=1
"RTN","SAMICTT2",161,0)
 . . . q
"RTN","SAMICTT2",162,0)
 . . ;
"RTN","SAMICTT2",163,0)
 . . if $$XVAL("cerdc",vals)="y" d  ;
"RTN","SAMICTT2",164,0)
 . . . d HLFIND
"RTN","SAMICTT2",165,0)
 . . . ;d OUT("<br>"_"Regional or diffuse consolidation in the ")
"RTN","SAMICTT2",166,0)
 . . . d OUT(sp1_"Regional or diffuse consolidation in the "_$$LOBESTR("cerdcl1^cerdcl2^cerdcl3^cerdcl4^cerdcl5",0)_". ") d OUT("")
"RTN","SAMICTT2",167,0)
 . . . set yespp=1
"RTN","SAMICTT2",168,0)
 . . . q
"RTN","SAMICTT2",169,0)
 . . ;
"RTN","SAMICTT2",170,0)
 . . ;# scarring may be more complicated (apical, and bilateral)
"RTN","SAMICTT2",171,0)
 . . if $$XVAL("cescr",vals)="y" d  ;
"RTN","SAMICTT2",172,0)
 . . . d HLFIND
"RTN","SAMICTT2",173,0)
 . . . ;# If apical use "unilateral apical scarring", if bilateral use "bilateral apical scarring"
"RTN","SAMICTT2",174,0)
 . . . ;# Otherwise use our previouse construct
"RTN","SAMICTT2",175,0)
 . . . n done s done=0 ; flag to use for other scarring 
"RTN","SAMICTT2",176,0)
 . . . if $$XVAL("cescrl6",vals)="au" d  ;
"RTN","SAMICTT2",177,0)
 . . . . d OUT(sp1_"Unilateral apical scarring. ") d OUT("")
"RTN","SAMICTT2",178,0)
 . . . . s done=1
"RTN","SAMICTT2",179,0)
 . . . . q
"RTN","SAMICTT2",180,0)
 . . . ;
"RTN","SAMICTT2",181,0)
 . . . else  if $$XVAL("cescrl7",vals)="ab" d  ;
"RTN","SAMICTT2",182,0)
 . . . . d OUT(sp1_"Bilateral apical scarring. ") d OUT("")
"RTN","SAMICTT2",183,0)
 . . . . s done=1
"RTN","SAMICTT2",184,0)
 . . . . q
"RTN","SAMICTT2",185,0)
 . . . ;
"RTN","SAMICTT2",186,0)
 . . . if done=0  d  ;
"RTN","SAMICTT2",187,0)
 . . . . ;d OUT("<br>"_"Scarring in the ")
"RTN","SAMICTT2",188,0)
 . . . . d OUT(sp1_"Scarring in the "_$$LOBESTR("cescrl1^cescrl2^cescrl3^cescrl4^cescrl5",1)_". ") d OUT("")
"RTN","SAMICTT2",189,0)
 . . . . set yespp=1
"RTN","SAMICTT2",190,0)
 . . . . q
"RTN","SAMICTT2",191,0)
 . . . q
"RTN","SAMICTT2",192,0)
 . . ;
"RTN","SAMICTT2",193,0)
 . . if $$XVAL("cebat",vals)="y" d  ;
"RTN","SAMICTT2",194,0)
 . . . d HLFIND
"RTN","SAMICTT2",195,0)
 . . . ;d OUT("<br>"_"Other atelectasis in the ")
"RTN","SAMICTT2",196,0)
 . . . d OUT(sp1_"Other atelectasis in the "_$$LOBESTR("cebatl1^cebatl2^cebatl3^cebatl4^cebatl5",0)_". ") d OUT("")
"RTN","SAMICTT2",197,0)
 . . . set yespp=1
"RTN","SAMICTT2",198,0)
 . . . q
"RTN","SAMICTT2",199,0)
 . . ;
"RTN","SAMICTT2",200,0)
 . . if $$XVAL("cerb",vals)="y" d  ;
"RTN","SAMICTT2",201,0)
 . . . d HLFIND
"RTN","SAMICTT2",202,0)
 . . . ;d OUT("<br>"_"Traction bronchiectasis in the ")
"RTN","SAMICTT2",203,0)
 . . . d OUT(sp1_"Traction bronchiectasis in the "_$$LOBESTR("cerbl1^cerbl2^cerbl3^cerbl4^cerbl5",0)_". ") d OUT("")
"RTN","SAMICTT2",204,0)
 . . . set yespp=1
"RTN","SAMICTT2",205,0)
 . . . q
"RTN","SAMICTT2",206,0)
 . . ;
"RTN","SAMICTT2",207,0)
 . . if $$XVAL("cepgo",vals)="y" d  ;
"RTN","SAMICTT2",208,0)
 . . . d HLFIND
"RTN","SAMICTT2",209,0)
 . . . ;d OUT("<br>"_"Peripheral Ground-glass Opacities in the ")
"RTN","SAMICTT2",210,0)
 . . . d OUT(sp1_"Peripheral Ground-glass Opacities in the "_$$LOBESTR("cepgol1^cepgol2^cepgol3^cepgol4^cepgol5",0)_". ") d OUT("")
"RTN","SAMICTT2",211,0)
 . . . set yespp=1
"RTN","SAMICTT2",212,0)
 . . . q
"RTN","SAMICTT2",213,0)
 . . ;
"RTN","SAMICTT2",214,0)
 . . if $$XVAL("ceret",vals)="y" d  ;
"RTN","SAMICTT2",215,0)
 . . . d HLFIND
"RTN","SAMICTT2",216,0)
 . . . ;d OUT("<br>"_"Reticulations in the ")
"RTN","SAMICTT2",217,0)
 . . . d OUT(sp1_"Reticulations in the "_$$LOBESTR("ceretl1^ceretl2^ceretl3^ceretl4^ceretl5",0)_". ") d OUT("")
"RTN","SAMICTT2",218,0)
 . . . set yespp=1
"RTN","SAMICTT2",219,0)
 . . . q
"RTN","SAMICTT2",220,0)
 . . ;
"RTN","SAMICTT2",221,0)
 . . if $$XVAL("cephc",vals)="y" d  ;
"RTN","SAMICTT2",222,0)
 . . . d HLFIND
"RTN","SAMICTT2",223,0)
 . . . ;d OUT("<br>"_"Honeycombing in the ")
"RTN","SAMICTT2",224,0)
 . . . d OUT(sp1_"Honeycombing in the "_$$LOBESTR("cephcl1^cephcl2^cephcl3^cephcl4^cephcl5",0)_". ") d OUT("")
"RTN","SAMICTT2",225,0)
 . . . set yespp=1
"RTN","SAMICTT2",226,0)
 . . . q
"RTN","SAMICTT2",227,0)
 . . ;
"RTN","SAMICTT2",228,0)
 . . if $$XVAL("cepp",vals)="y" d  ;
"RTN","SAMICTT2",229,0)
 . . . set yespp=1
"RTN","SAMICTT2",230,0)
 . . . set numl=0
"RTN","SAMICTT2",231,0)
 . . . set str="Pleural or fissural plaques in the "
"RTN","SAMICTT2",232,0)
 . . . ;
"RTN","SAMICTT2",233,0)
 . . . if $$XVAL("cepprt",vals)="r" d  ;
"RTN","SAMICTT2",234,0)
 . . . . s str=str_"right"
"RTN","SAMICTT2",235,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",236,0)
 . . . . q
"RTN","SAMICTT2",237,0)
 . . . ;
"RTN","SAMICTT2",238,0)
 . . . if $$XVAL("cepplt",vals)="l" d  ;
"RTN","SAMICTT2",239,0)
 . . . . if numl>0 s str=str_" and"
"RTN","SAMICTT2",240,0)
 . . . . s str=str_" left"
"RTN","SAMICTT2",241,0)
 . . . . s numl=numl+1
"RTN","SAMICTT2",242,0)
 . . . . if numl>1 s str=str_" lobes"
"RTN","SAMICTT2",243,0)
 . . . . else  s str=str_" lobe"
"RTN","SAMICTT2",244,0)
 . . . . if $$XVAL("ceppca",vals)="c" s str=str_" with calcifications"
"RTN","SAMICTT2",245,0)
 . . . . s str=str_". "_para
"RTN","SAMICTT2",246,0)
 . . . . q
"RTN","SAMICTT2",247,0)
 . . . ;
"RTN","SAMICTT2",248,0)
 . . . if numl=0 set str="Pleural or fissural plaques are noted. "
"RTN","SAMICTT2",249,0)
 . . . d HLFIND
"RTN","SAMICTT2",250,0)
 . . . d OUT(sp1_str)
"RTN","SAMICTT2",251,0)
 . . . q
"RTN","SAMICTT2",252,0)
 . . ;
"RTN","SAMICTT2",253,0)
 . . ;# Note: Not used for newer CT Evaluation Forms
"RTN","SAMICTT2",254,0)
 . . ;if { 0 == [ string compare y [xval cepc] ] } {
"RTN","SAMICTT2",255,0)
 . . ;  set yespp 1
"RTN","SAMICTT2",256,0)
 . . ;     hlfind
"RTN","SAMICTT2",257,0)
 . . ;     puts "[sidestr {Pleural calcifications} cepcrt cepclt]"
"RTN","SAMICTT2",258,0)
 . . ;
"RTN","SAMICTT2",259,0)
 . . if $$XVAL("cebs",vals)="y" d  ;
"RTN","SAMICTT2",260,0)
 . . . set yespp=1
"RTN","SAMICTT2",261,0)
 . . . set numl=0
"RTN","SAMICTT2",262,0)
 . . . set str="Abnormal bronchial resection margin on"
"RTN","SAMICTT2",263,0)
 . . . d  ;
"RTN","SAMICTT2",264,0)
 . . . . if $$XVAL("cebsrt",vals)="r" d  ;
"RTN","SAMICTT2",265,0)
 . . . . . s str=str_" right"
"RTN","SAMICTT2",266,0)
 . . . . . s numl=numl+1
"RTN","SAMICTT2",267,0)
 . . . . . q
"RTN","SAMICTT2",268,0)
 . . . . ;
"RTN","SAMICTT2",269,0)
 . . . . if $$XVAL("cebslt",vals)="l" d  ;
"RTN","SAMICTT2",270,0)
 . . . . . if numl>0 s str=str_" and"
"RTN","SAMICTT2",271,0)
 . . . . . s str=str_" left"
"RTN","SAMICTT2",272,0)
 . . . . . s numl=numl+1
"RTN","SAMICTT2",273,0)
 . . . . . q
"RTN","SAMICTT2",274,0)
 . . . . ;
"RTN","SAMICTT2",275,0)
 . . . . s str=str_". "
"RTN","SAMICTT2",276,0)
 . . . . q
"RTN","SAMICTT2",277,0)
 . . . ;
"RTN","SAMICTT2",278,0)
 . . . if numl=0 set str="<br>"_"Abnormal bronchial resection margin noted. "
"RTN","SAMICTT2",279,0)
 . . . d HLFIND
"RTN","SAMICTT2",280,0)
 . . . d OUT(sp1_str)
"RTN","SAMICTT2",281,0)
 . . . ;d OUT(para)
"RTN","SAMICTT2",282,0)
 . . . q
"RTN","SAMICTT2",283,0)
 . . ;
"RTN","SAMICTT2",284,0)
 . . if $L($$XVAL("ceoppa",vals))'=0 d  ;
"RTN","SAMICTT2",285,0)
 . . . ;# puts "Additional Comments on Parenchymal or Pleural Abnormalities:"
"RTN","SAMICTT2",286,0)
 . . . d HLFIND
"RTN","SAMICTT2",287,0)
 . . . d OUT(sp1_$$XVAL("ceoppa",vals)_". ") d OUT("")
"RTN","SAMICTT2",288,0)
 . . . ;d OUT(para)
"RTN","SAMICTT2",289,0)
 . . . q
"RTN","SAMICTT2",290,0)
 . . else  if yespp=1  ;d OUT(para)
"RTN","SAMICTT2",291,0)
 . . q
"RTN","SAMICTT2",292,0)
 . q
"RTN","SAMICTT2",293,0)
 ;
"RTN","SAMICTT2",294,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT2",295,0)
 ;
"RTN","SAMICTT2",296,0)
 quit  ; end of OTHRLUNG
"RTN","SAMICTT2",297,0)
 ;
"RTN","SAMICTT2",298,0)
 ;
"RTN","SAMICTT2",299,0)
 ;
"RTN","SAMICTT2",300,0)
 ;
"RTN","SAMICTT2",301,0)
 ;@proc HLFIND
"RTN","SAMICTT2",302,0)
 ;
"RTN","SAMICTT2",303,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT2",304,0)
 ;
"RTN","SAMICTT2",305,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT2",306,0)
 ;@called-by
"RTN","SAMICTT2",307,0)
 ; OTHRLUNG
"RTN","SAMICTT2",308,0)
 ;@calls
"RTN","SAMICTT2",309,0)
 ; $$XVAL
"RTN","SAMICTT2",310,0)
 ; @^%ZOSF("UPPERCASE")
"RTN","SAMICTT2",311,0)
 ;@input
"RTN","SAMICTT2",312,0)
 ; lst = a^b^c where a,b and c are variable names
"RTN","SAMICTT2",313,0)
 ; opt
"RTN","SAMICTT2",314,0)
 ;@output = lobes
"RTN","SAMICTT2",315,0)
 ;
"RTN","SAMICTT2",316,0)
 ;
"RTN","SAMICTT2",317,0)
LOBESTR(lst,opt) ; lobes
"RTN","SAMICTT2",318,0)
 ;
"RTN","SAMICTT2",319,0)
 n tary s tary=""
"RTN","SAMICTT2",320,0)
 n rstr s rtstr=""
"RTN","SAMICTT2",321,0)
 n lln s lln=$l(lst,"^")
"RTN","SAMICTT2",322,0)
 f lzi=1:1:lln d  ;
"RTN","SAMICTT2",323,0)
 . n tval s tval=$$XVAL($p(lst,"^",lzi),vals)
"RTN","SAMICTT2",324,0)
 . n X S X=tval
"RTN","SAMICTT2",325,0)
 . n Y
"RTN","SAMICTT2",326,0)
 . X ^%ZOSF("UPPERCASE")
"RTN","SAMICTT2",327,0)
 . s tval=Y
"RTN","SAMICTT2",328,0)
 . i tval]"" s tary($o(tary(""),-1)+1)=tval
"RTN","SAMICTT2",329,0)
 . q
"RTN","SAMICTT2",330,0)
 n tcnt s tcnt=$o(tary(""),-1)
"RTN","SAMICTT2",331,0)
 q:tcnt=0
"RTN","SAMICTT2",332,0)
 i tcnt=1 q tary(1)
"RTN","SAMICTT2",333,0)
 i tcnt=2 q tary(1)_" and "_tary(2)
"RTN","SAMICTT2",334,0)
 f lzi=1:1:tcnt s rtstr=rtstr_tary(lzi)_$s(lzi<tcnt:", ",1:"")
"RTN","SAMICTT2",335,0)
 ;
"RTN","SAMICTT2",336,0)
 quit rtstr ; end of $$LOBESTR
"RTN","SAMICTT2",337,0)
 ;
"RTN","SAMICTT2",338,0)
 ;
"RTN","SAMICTT2",339,0)
 ;
"RTN","SAMICTT2",340,0)
 ;
"RTN","SAMICTT2",341,0)
 ;@proc HLFIND
"RTN","SAMICTT2",342,0)
 ;
"RTN","SAMICTT2",343,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT2",344,0)
 ;
"RTN","SAMICTT2",345,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT2",346,0)
 ;@called-by
"RTN","SAMICTT2",347,0)
 ; OTHRLUNG
"RTN","SAMICTT2",348,0)
 ;@calls
"RTN","SAMICTT2",349,0)
 ; HOUT
"RTN","SAMICTT2",350,0)
 ; OUT
"RTN","SAMICTT2",351,0)
 ;@thruput
"RTN","SAMICTT2",352,0)
 ; ]lfind
"RTN","SAMICTT2",353,0)
 ;@output
"RTN","SAMICTT2",354,0)
 ; adds other lung findings header to report
"RTN","SAMICTT2",355,0)
 ;
"RTN","SAMICTT2",356,0)
 ;
"RTN","SAMICTT2",357,0)
HLFIND() ; references & sets lfind in calling routine
"RTN","SAMICTT2",358,0)
 ;
"RTN","SAMICTT2",359,0)
 i $g(lfind)=0 d  ;
"RTN","SAMICTT2",360,0)
 . d HOUT("Other lung findings:")
"RTN","SAMICTT2",361,0)
 . d OUT("")
"RTN","SAMICTT2",362,0)
 . s lfind=1
"RTN","SAMICTT2",363,0)
 . q
"RTN","SAMICTT2",364,0)
 ;
"RTN","SAMICTT2",365,0)
 quit  ; end of HLFIND
"RTN","SAMICTT2",366,0)
 ;
"RTN","SAMICTT2",367,0)
 ;
"RTN","SAMICTT2",368,0)
 ;
"RTN","SAMICTT2",369,0)
 ;
"RTN","SAMICTT2",370,0)
 ;@proc OUT
"RTN","SAMICTT2",371,0)
 ;
"RTN","SAMICTT2",372,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT2",373,0)
 ;
"RTN","SAMICTT2",374,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT2",375,0)
 ;@called-by
"RTN","SAMICTT2",376,0)
 ; OTHRLUNG
"RTN","SAMICTT2",377,0)
 ; HLFIND
"RTN","SAMICTT2",378,0)
 ;@calls none
"RTN","SAMICTT2",379,0)
 ;@input
"RTN","SAMICTT2",380,0)
 ; ln = output to add
"RTN","SAMICTT2",381,0)
 ; ]rtn output array
"RTN","SAMICTT2",382,0)
 ; ]debug
"RTN","SAMICTT2",383,0)
 ;@thruput
"RTN","SAMICTT2",384,0)
 ; cnt
"RTN","SAMICTT2",385,0)
 ;@output
"RTN","SAMICTT2",386,0)
 ; line added to ct report
"RTN","SAMICTT2",387,0)
 ;
"RTN","SAMICTT2",388,0)
 ;
"RTN","SAMICTT2",389,0)
OUT(ln) ; output ct report line
"RTN","SAMICTT2",390,0)
 ;
"RTN","SAMICTT2",391,0)
 i ln[".." s ln=$p(ln,"..")_"." ; remove double periods at the end
"RTN","SAMICTT2",392,0)
 ;
"RTN","SAMICTT2",393,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT2",394,0)
 s cnt=cnt+1
"RTN","SAMICTT2",395,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT2",396,0)
 n lnn s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT2",397,0)
 i outmode="go" d  ;
"RTN","SAMICTT2",398,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT2",399,0)
 . s line=""
"RTN","SAMICTT2",400,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT2",401,0)
 . q
"RTN","SAMICTT2",402,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT2",403,0)
 ;
"RTN","SAMICTT2",404,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT2",405,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT2",406,0)
 . n zs s zs=$STACK
"RTN","SAMICTT2",407,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT2",408,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT2",409,0)
 . q
"RTN","SAMICTT2",410,0)
 ;
"RTN","SAMICTT2",411,0)
 quit  ; end of OUT
"RTN","SAMICTT2",412,0)
 ;
"RTN","SAMICTT2",413,0)
 ;
"RTN","SAMICTT2",414,0)
 ;
"RTN","SAMICTT2",415,0)
 ;
"RTN","SAMICTT2",416,0)
 ;@proc HOUT
"RTN","SAMICTT2",417,0)
 ;
"RTN","SAMICTT2",418,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT2",419,0)
 ;
"RTN","SAMICTT2",420,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT2",421,0)
 ;@called-by
"RTN","SAMICTT2",422,0)
 ; HLFIND
"RTN","SAMICTT2",423,0)
 ;@calls
"RTN","SAMICTT2",424,0)
 ; OUT
"RTN","SAMICTT2",425,0)
 ;@input
"RTN","SAMICTT2",426,0)
 ; ln = header output to add
"RTN","SAMICTT2",427,0)
 ; ]rtn output array
"RTN","SAMICTT2",428,0)
 ;@output
"RTN","SAMICTT2",429,0)
 ; header line added to ct report
"RTN","SAMICTT2",430,0)
 ;
"RTN","SAMICTT2",431,0)
 ;
"RTN","SAMICTT2",432,0)
HOUT(ln) ; output ct report header line
"RTN","SAMICTT2",433,0)
 ;
"RTN","SAMICTT2",434,0)
 d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT2",435,0)
 ;
"RTN","SAMICTT2",436,0)
 quit  ; end of HOUT
"RTN","SAMICTT2",437,0)
 ;
"RTN","SAMICTT2",438,0)
 ;
"RTN","SAMICTT2",439,0)
 ;
"RTN","SAMICTT2",440,0)
 ;
"RTN","SAMICTT2",441,0)
 ;@func $$XVAL
"RTN","SAMICTT2",442,0)
 ;
"RTN","SAMICTT2",443,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT2",444,0)
 ;
"RTN","SAMICTT2",445,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT2",446,0)
 ;@called-by
"RTN","SAMICTT2",447,0)
 ; OTHRLUNG
"RTN","SAMICTT2",448,0)
 ; $$LOBESTR
"RTN","SAMICTT2",449,0)
 ;@calls none
"RTN","SAMICTT2",450,0)
 ;@input
"RTN","SAMICTT2",451,0)
 ; var
"RTN","SAMICTT2",452,0)
 ; vals is passed by name
"RTN","SAMICTT2",453,0)
 ;@output = patient value for var
"RTN","SAMICTT2",454,0)
 ;
"RTN","SAMICTT2",455,0)
 ;
"RTN","SAMICTT2",456,0)
XVAL(var,vals) ; patient value for var
"RTN","SAMICTT2",457,0)
 ;
"RTN","SAMICTT2",458,0)
 n zr s zr=$g(@vals@(var))
"RTN","SAMICTT2",459,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT2",460,0)
 ;
"RTN","SAMICTT2",461,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT2",462,0)
 ;
"RTN","SAMICTT2",463,0)
 ;
"RTN","SAMICTT2",464,0)
 ;
"RTN","SAMICTT2",465,0)
 ;
"RTN","SAMICTT2",466,0)
 ;@func $$XSUB
"RTN","SAMICTT2",467,0)
 ;
"RTN","SAMICTT2",468,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT2",469,0)
 ;
"RTN","SAMICTT2",470,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT2",471,0)
 ;@called-by none
"RTN","SAMICTT2",472,0)
 ;@calls none
"RTN","SAMICTT2",473,0)
 ;@input
"RTN","SAMICTT2",474,0)
 ; var
"RTN","SAMICTT2",475,0)
 ; vals & dict are passed by name
"RTN","SAMICTT2",476,0)
 ; valdx is used for nodules ala cect2co with nodule # included
"RTN","SAMICTT2",477,0)
 ;@output = dictionary value for var
"RTN","SAMICTT2",478,0)
 ;
"RTN","SAMICTT2",479,0)
 ;
"RTN","SAMICTT2",480,0)
XSUB(var,vals,dict,valdx) ; dictionary value defined by var
"RTN","SAMICTT2",481,0)
 ;
"RTN","SAMICTT2",482,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT2",483,0)
 n zdx s zdx=$g(valdx)
"RTN","SAMICTT2",484,0)
 i zdx="" s zdx=var
"RTN","SAMICTT2",485,0)
 ;
"RTN","SAMICTT2",486,0)
 n zv s zv=$g(@vals@(zdx))
"RTN","SAMICTT2",487,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT2",488,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT2",489,0)
 ;
"RTN","SAMICTT2",490,0)
 n zr s zr=$g(@dict@(var,zv))
"RTN","SAMICTT2",491,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT2",492,0)
 ;
"RTN","SAMICTT2",493,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT2",494,0)
 ;
"RTN","SAMICTT2",495,0)
 ;
"RTN","SAMICTT2",496,0)
 ;
"RTN","SAMICTT2",497,0)
EOR ; end of routine SAMICTT2
"RTN","SAMICTT3")
0^4^B483869070^B396705116
"RTN","SAMICTT3",1,0)
SAMICTT3 ;ven/gpl - ctreport text emphysema; 2024-09-24t16:04z
"RTN","SAMICTT3",2,0)
 ;;18.0;SAMI;**4,10,13,15,19**;2020-01-17;Build 1
"RTN","SAMICTT3",3,0)
 ;mdc-e1;SAMICTT3-20240924-E3A2GyW;SAMI-18-19-b1
"RTN","SAMICTT3",4,0)
 ;mdc-v7;B483869070;SAMI*18.0*19 SEQ #19
"RTN","SAMICTT3",5,0)
 ;
"RTN","SAMICTT3",6,0)
 ; SAMICTT3 creates the Emphysema section of the ELCAP CT Report in
"RTN","SAMICTT3",7,0)
 ; text format.
"RTN","SAMICTT3",8,0)
 ;
"RTN","SAMICTT3",9,0)
 quit  ; no entry from top
"RTN","SAMICTT3",10,0)
 ;
"RTN","SAMICTT3",11,0)
 ;
"RTN","SAMICTT3",12,0)
 ;
"RTN","SAMICTT3",13,0)
 ;
"RTN","SAMICTT3",14,0)
 ;@section 0 primary development
"RTN","SAMICTT3",15,0)
 ;
"RTN","SAMICTT3",16,0)
 ;
"RTN","SAMICTT3",17,0)
 ;
"RTN","SAMICTT3",18,0)
 ;
"RTN","SAMICTT3",19,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT3",20,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT3",21,0)
 ;
"RTN","SAMICTT3",22,0)
 ;@contents
"RTN","SAMICTT3",23,0)
 ;
"RTN","SAMICTT3",24,0)
 ; EMPHYS:emphysema section of ctreport text format
"RTN","SAMICTT3",25,0)
 ; $$CCMSTR form phrases
"RTN","SAMICTT3",26,0)
 ; $$LOWC convert X to lowercase
"RTN","SAMICTT3",27,0)
 ; OUT output a line of ct report
"RTN","SAMICTT3",28,0)
 ; HOUT output a ct report header line
"RTN","SAMICTT3",29,0)
 ; $$XVAL patient value for var
"RTN","SAMICTT3",30,0)
 ; GENLNL 
"RTN","SAMICTT3",31,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTT3",32,0)
 ;
"RTN","SAMICTT3",33,0)
 ;
"RTN","SAMICTT3",34,0)
 ;
"RTN","SAMICTT3",35,0)
 ;
"RTN","SAMICTT3",36,0)
 ;@section 1 EMPHYS & related subroutines
"RTN","SAMICTT3",37,0)
 ;
"RTN","SAMICTT3",38,0)
 ;
"RTN","SAMICTT3",39,0)
 ;
"RTN","SAMICTT3",40,0)
 ;
"RTN","SAMICTT3",41,0)
 ;@proc EMPHYS
"RTN","SAMICTT3",42,0)
 ;
"RTN","SAMICTT3",43,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT3",44,0)
 ;
"RTN","SAMICTT3",45,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT3",46,0)
 ;@called-by
"RTN","SAMICTT3",47,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT3",48,0)
 ;@calls
"RTN","SAMICTT3",49,0)
 ; $$XVAL
"RTN","SAMICTT3",50,0)
 ; HOUT
"RTN","SAMICTT3",51,0)
 ; OUT
"RTN","SAMICTT3",52,0)
 ; $$XSUB
"RTN","SAMICTT3",53,0)
 ; $$LOBESTR^SAMICTR2
"RTN","SAMICTT3",54,0)
 ; $$CCMSTR
"RTN","SAMICTT3",55,0)
 ; $$LOWC
"RTN","SAMICTT3",56,0)
 ;@input
"RTN","SAMICTT3",57,0)
 ; rtn
"RTN","SAMICTT3",58,0)
 ; vals
"RTN","SAMICTT3",59,0)
 ; dict
"RTN","SAMICTT3",60,0)
 ;@output
"RTN","SAMICTT3",61,0)
 ; create emphysema section of ct eval report
"RTN","SAMICTT3",62,0)
 ;
"RTN","SAMICTT3",63,0)
 ;
"RTN","SAMICTT3",64,0)
EMPHYS(rtn,vals,dict) ; emphysema section of ct report text format
"RTN","SAMICTT3",65,0)
 ;
"RTN","SAMICTT3",66,0)
 ; repgen4,repgen5
"RTN","SAMICTT3",67,0)
 ;
"RTN","SAMICTT3",68,0)
 ;# Emphysema
"RTN","SAMICTT3",69,0)
 ;
"RTN","SAMICTT3",70,0)
 n emph1 s emph1=0
"RTN","SAMICTT3",71,0)
 n sp1 s sp1="  "
"RTN","SAMICTT3",72,0)
 s outmode="hold" s line=""
"RTN","SAMICTT3",73,0)
 ;if $$XVAL("ceemv",vals)'="e" d  ;
"RTN","SAMICTT3",74,0)
 if $$XVAL("ceem",vals)]"" d  ;
"RTN","SAMICTT3",75,0)
 . if $$XVAL("ceem",vals)="nv" q  ;
"RTN","SAMICTT3",76,0)
 . if $$XVAL("ceem",vals)="no" q  ;
"RTN","SAMICTT3",77,0)
 . if $$XVAL("ceem",vals)="nr" q  ;
"RTN","SAMICTT3",78,0)
 . ;d OUT("")
"RTN","SAMICTT3",79,0)
 . D HOUT("Emphysema: ")
"RTN","SAMICTT3",80,0)
 . ;d OUT("")
"RTN","SAMICTT3",81,0)
 . D OUT(sp1_$$XSUB("ceem",vals,dict))
"RTN","SAMICTT3",82,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",83,0)
 . s emph1=1
"RTN","SAMICTT3",84,0)
 . q
"RTN","SAMICTT3",85,0)
 ;
"RTN","SAMICTT3",86,0)
 ;if $$XVAL("ceem",vals)="" d  ;
"RTN","SAMICTT3",87,0)
 if emph1=0 d  ;
"RTN","SAMICTT3",88,0)
 . if $$XVAL("ceem",vals)="nr" d  q  ;
"RTN","SAMICTT3",89,0)
 . . D HOUT("Emphysema: Emphysema score not provided.")
"RTN","SAMICTT3",90,0)
 . . s outmode="go" d OUT("")
"RTN","SAMICTT3",91,0)
 . . q
"RTN","SAMICTT3",92,0)
 . D HOUT("Emphysema: None.")
"RTN","SAMICTT3",93,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",94,0)
 . q
"RTN","SAMICTT3",95,0)
 ;d OUT("")
"RTN","SAMICTT3",96,0)
 s outmode="hold"
"RTN","SAMICTT3",97,0)
 D HOUT("Pleura: ")
"RTN","SAMICTT3",98,0)
 ;d OUT("")
"RTN","SAMICTT3",99,0)
 ; hputs "Pleura:"
"RTN","SAMICTT3",100,0)
 n pe s pe=0
"RTN","SAMICTT3",101,0)
 ;
"RTN","SAMICTT3",102,0)
 ; # Pleural Effusion
"RTN","SAMICTT3",103,0)
 ; 
"RTN","SAMICTT3",104,0)
 ;i $$XVAL("cepev",vals)="y" d  ;
"RTN","SAMICTT3",105,0)
 ;. if $$XVAL("ceper",vals)="-" d  ;
"RTN","SAMICTT3",106,0)
 ;. . if $$XVAL("cepel",vals)="-" d  ;
"RTN","SAMICTT3",107,0)
 ;. . . s @vals@("cepev")="e"
"RTN","SAMICTT3",108,0)
 ;. . . q
"RTN","SAMICTT3",109,0)
 ;. . q
"RTN","SAMICTT3",110,0)
 ;. ;
"RTN","SAMICTT3",111,0)
 ;. if $$XVAL("cepev",vals)'="e" d  ;
"RTN","SAMICTT3",112,0)
 ;. . if $$XVAL("ceper",vals)'="-" d  ;
"RTN","SAMICTT3",113,0)
 ;. . . if $$XVAL("cepel",vals)'="-" d  ;
"RTN","SAMICTT3",114,0)
 ;. . . . if $$XVAL("cepel",vals)=$$XVAL("ceper",vals) d  ;
"RTN","SAMICTT3",115,0)
 ;. . . . . d OUT(sp1_"Bilateral "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusions. ") d OUT("")
"RTN","SAMICTT3",116,0)
 ;. . . . . q
"RTN","SAMICTT3",117,0)
 ;. . . . else  d  ;
"RTN","SAMICTT3",118,0)
 ;. . . . . d OUT(sp1_"Bilateral pleural effusions ; "_$$XSUB("cepe",vals,dict,"cepel")_" on left, and "_$$XSUB("cepe",vals,dict,"ceper")_" on right. ")
"RTN","SAMICTT3",119,0)
 ;. . . . . s pe=1
"RTN","SAMICTT3",120,0)
 ;. . . . . q
"RTN","SAMICTT3",121,0)
 ;. . . . q
"RTN","SAMICTT3",122,0)
 ;. . . else  d  ;
"RTN","SAMICTT3",123,0)
 ;. . . . ;d OUT(sp1_"On right "_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion and on left "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion. ") d OUT("")
"RTN","SAMICTT3",124,0)
 ;. . . . d OUT(sp1_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion on right and "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion on left. ") d OUT("")
"RTN","SAMICTT3",125,0)
 ;. . . . s pe=1
"RTN","SAMICTT3",126,0)
 ;. . . . q
"RTN","SAMICTT3",127,0)
 ;. . . q
"RTN","SAMICTT3",128,0)
 ;. . else  d  ;
"RTN","SAMICTT3",129,0)
 ;. . . ;d OUT(sp1_"On right "_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion and on left "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion. ") d OUT("")
"RTN","SAMICTT3",130,0)
 ;. . . d OUT(sp1_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion on right and "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion on left. ") d OUT("")
"RTN","SAMICTT3",131,0)
 ;. . . s pe=1
"RTN","SAMICTT3",132,0)
 ;. . . q
"RTN","SAMICTT3",133,0)
 ;. . q
"RTN","SAMICTT3",134,0)
 ;. ;
"RTN","SAMICTT3",135,0)
 ;i $$XVAL("cepev",vals)'="y" d  ; 
"RTN","SAMICTT3",136,0)
 ;. d OUT(sp1_"No pleural effusions. ") d OUT("")
"RTN","SAMICTT3",137,0)
 ;;  if { $pe == 0 } {
"RTN","SAMICTT3",138,0)
 ;;    puts "[tr "No pleural effusions"].${para}"
"RTN","SAMICTT3",139,0)
 ;;  }
"RTN","SAMICTT3",140,0)
 ;
"RTN","SAMICTT3",141,0)
 i $$XVAL("cepev",vals)="y" d  ;
"RTN","SAMICTT3",142,0)
 . n ceper s ceper=$$XVAL("ceper",vals)
"RTN","SAMICTT3",143,0)
 . n cepel s cepel=$$XVAL("cepel",vals)
"RTN","SAMICTT3",144,0)
 . n cepert s cepert=$$XSUB("cepe",vals,dict,"ceper")
"RTN","SAMICTT3",145,0)
 . n cepelt s cepelt=$$XSUB("cepe",vals,dict,"cepel")
"RTN","SAMICTT3",146,0)
 . ;
"RTN","SAMICTT3",147,0)
 . n left s left=1
"RTN","SAMICTT3",148,0)
 . i cepel="-" s left=0
"RTN","SAMICTT3",149,0)
 . i cepel="no" s left=0
"RTN","SAMICTT3",150,0)
 . ;
"RTN","SAMICTT3",151,0)
 . n right s right=1
"RTN","SAMICTT3",152,0)
 . i ceper="-" s right=0
"RTN","SAMICTT3",153,0)
 . i ceper="no" s right=0
"RTN","SAMICTT3",154,0)
 . ;
"RTN","SAMICTT3",155,0)
 . n both
"RTN","SAMICTT3",156,0)
 . if right+left=2 set both=1
"RTN","SAMICTT3",157,0)
 . e  set both=0
"RTN","SAMICTT3",158,0)
 . ;
"RTN","SAMICTT3",159,0)
 . n neither
"RTN","SAMICTT3",160,0)
 . if right+left=0 set neither=1
"RTN","SAMICTT3",161,0)
 . e  set neither=0
"RTN","SAMICTT3",162,0)
 . ;
"RTN","SAMICTT3",163,0)
 . n same
"RTN","SAMICTT3",164,0)
 . if ((both=1)&(ceper=cepel)) set same=1
"RTN","SAMICTT3",165,0)
 . e  set same=0
"RTN","SAMICTT3",166,0)
 . ;
"RTN","SAMICTT3",167,0)
 . if same=1 d  ;
"RTN","SAMICTT3",168,0)
 . . d OUT(sp1_"Bilateral "_cepelt_" pleural effusions. ") d OUT("")
"RTN","SAMICTT3",169,0)
 . . s pe=1
"RTN","SAMICTT3",170,0)
 . . q
"RTN","SAMICTT3",171,0)
 . ;
"RTN","SAMICTT3",172,0)
 . if both=1 d  ;
"RTN","SAMICTT3",173,0)
 . . i pe=1 q  ;
"RTN","SAMICTT3",174,0)
 . . d OUT(sp1_"Bilateral pleural effusions ; "_cepelt_" on left, and "_cepert_" on right. ")
"RTN","SAMICTT3",175,0)
 . . s pe=1
"RTN","SAMICTT3",176,0)
 . . q
"RTN","SAMICTT3",177,0)
 . ;
"RTN","SAMICTT3",178,0)
 . if pe=0 d  ; both and same not done
"RTN","SAMICTT3",179,0)
 . . if right d  ;
"RTN","SAMICTT3",180,0)
 . . . d OUT(sp1_cepert_" right pleural effusion.")
"RTN","SAMICTT3",181,0)
 . . . s pe=1
"RTN","SAMICTT3",182,0)
 . . . q
"RTN","SAMICTT3",183,0)
 . . if left d  ;
"RTN","SAMICTT3",184,0)
 . . . d OUT(sp1_cepelt_" left pleural effusion.")
"RTN","SAMICTT3",185,0)
 . . . s pe=1
"RTN","SAMICTT3",186,0)
 . . . q
"RTN","SAMICTT3",187,0)
 . ;
"RTN","SAMICTT3",188,0)
 . if pe=0 d  ; nothing worked
"RTN","SAMICTT3",189,0)
 . . d OUT(sp1_"No pleural effusion. ") d OUT("")
"RTN","SAMICTT3",190,0)
 . . q
"RTN","SAMICTT3",191,0)
 . q
"RTN","SAMICTT3",192,0)
 ;
"RTN","SAMICTT3",193,0)
 i $$XVAL("cepev",vals)'="y" d  ; 
"RTN","SAMICTT3",194,0)
 . d OUT(sp1_"No pleural effusion. ") d OUT("")
"RTN","SAMICTT3",195,0)
 ;  if { $pe == 0 } {
"RTN","SAMICTT3",196,0)
 ;    puts "[tr "No pleural effusions"].${para}"
"RTN","SAMICTT3",197,0)
 ;  }
"RTN","SAMICTT3",198,0)
 ;  
"RTN","SAMICTT3",199,0)
 n yespp s yespp=0
"RTN","SAMICTT3",200,0)
 ;
"RTN","SAMICTT3",201,0)
 if $$XVAL("cebatr",vals)="y" d  ;
"RTN","SAMICTT3",202,0)
 . ;d OUT("Rounded atelectasis in the ")
"RTN","SAMICTT3",203,0)
 . d OUT(sp1_"Rounded atelectasis in the "_$$LOBESTR^SAMICTR2("cebatrl1^cebatrl2^cebatrl3^cebatrl4^cebatrl5",0)_". ") ;d OUT("")
"RTN","SAMICTT3",204,0)
 . s yespp=1
"RTN","SAMICTT3",205,0)
 . q
"RTN","SAMICTT3",206,0)
 ;
"RTN","SAMICTT3",207,0)
 if $$XVAL("cept",vals)="y" d  ;
"RTN","SAMICTT3",208,0)
 . s yespp=1
"RTN","SAMICTT3",209,0)
 . s numl=0
"RTN","SAMICTT3",210,0)
 . set str=sp1_"Pleural thickening/plaques in the "
"RTN","SAMICTT3",211,0)
 . if $$XVAL("ceptrt",vals)="r" d  ;
"RTN","SAMICTT3",212,0)
 . . s str=str_"right"
"RTN","SAMICTT3",213,0)
 . . s numl=numl+1
"RTN","SAMICTT3",214,0)
 . . q
"RTN","SAMICTT3",215,0)
 . ;
"RTN","SAMICTT3",216,0)
 . if $$XVAL("ceptlt",vals)="l" d  ;
"RTN","SAMICTT3",217,0)
 . . i numl>0 d  ;
"RTN","SAMICTT3",218,0)
 . . . s str=str_" and"
"RTN","SAMICTT3",219,0)
 . . s str=str_" left"
"RTN","SAMICTT3",220,0)
 . . s numl=numl+1
"RTN","SAMICTT3",221,0)
 . . q
"RTN","SAMICTT3",222,0)
 . ;
"RTN","SAMICTT3",223,0)
 . ;if numl>1 d  ;
"RTN","SAMICTT3",224,0)
 . ;. s str=str_" lungs. "
"RTN","SAMICTT3",225,0)
 . ;else  d  ;
"RTN","SAMICTT3",226,0)
 . ;. s str=str_" lung. "
"RTN","SAMICTT3",227,0)
 . ;
"RTN","SAMICTT3",228,0)
 . s str=str_". "
"RTN","SAMICTT3",229,0)
 . if numl=0 set str=sp1_"Pleural thickening/plaques. "
"RTN","SAMICTT3",230,0)
 . d OUT(str) ;d OUT("")
"RTN","SAMICTT3",231,0)
 . q
"RTN","SAMICTT3",232,0)
 ;
"RTN","SAMICTT3",233,0)
 if $$XVAL("cepu",vals)="y" d  ;
"RTN","SAMICTT3",234,0)
 . s yespp=1
"RTN","SAMICTT3",235,0)
 . if $l($$XVAL("cepus",vals))'=0 d  ;
"RTN","SAMICTT3",236,0)
 . . d OUT(sp1_"Pleural rumor: "_$$XVAL("cepus",vals))
"RTN","SAMICTT3",237,0)
 . . q
"RTN","SAMICTT3",238,0)
 . e  d OUT(sp1_"Pleural tumor. ")
"RTN","SAMICTT3",239,0)
 . ;d OUT("")
"RTN","SAMICTT3",240,0)
 . q
"RTN","SAMICTT3",241,0)
 ;
"RTN","SAMICTT3",242,0)
 i yespp=0 d OUT("")
"RTN","SAMICTT3",243,0)
 ;
"RTN","SAMICTT3",244,0)
 d  ;
"RTN","SAMICTT3",245,0)
 . if $$XVAL("ceoppab",vals)'="" d OUT(sp1_$$XVAL("ceoppab",vals)_". ") ;d OUT("")
"RTN","SAMICTT3",246,0)
 . else  d
"RTN","SAMICTT3",247,0)
 . . if yespp=1 d OUT("")
"RTN","SAMICTT3",248,0)
 . . q
"RTN","SAMICTT3",249,0)
 . q
"RTN","SAMICTT3",250,0)
 ;
"RTN","SAMICTT3",251,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT3",252,0)
 ;
"RTN","SAMICTT3",253,0)
 s outmode="hold"
"RTN","SAMICTT3",254,0)
 d OUT("Coronary Artery Calcifications: ")
"RTN","SAMICTT3",255,0)
 ;# Coronary Calcification
"RTN","SAMICTT3",256,0)
 n vcac
"RTN","SAMICTT3",257,0)
 n cac s cac=""
"RTN","SAMICTT3",258,0)
 n cacrec s cacrec=""
"RTN","SAMICTT3",259,0)
 n cacout s cacout=0
"RTN","SAMICTT3",260,0)
 ;
"RTN","SAMICTT3",261,0)
 n cectot s cectot=0
"RTN","SAMICTT3",262,0)
 i $g(@vals@("cecclm"))="no" s @vals@("cecclm")="no" s cectot=cectot+1
"RTN","SAMICTT3",263,0)
 i $g(@vals@("ceccld"))="no" s @vals@("ceccld")="no" s cectot=cectot+1
"RTN","SAMICTT3",264,0)
 i $g(@vals@("cecccf"))="no" s @vals@("cecccf")="no" s cectot=cectot+1
"RTN","SAMICTT3",265,0)
 i $g(@vals@("ceccrc"))="no" s @vals@("ceccrc")="no" s cectot=cectot+1
"RTN","SAMICTT3",266,0)
 i $g(@vals@("cecclm"))="-" s @vals@("cecclm")="no" s cectot=cectot+1
"RTN","SAMICTT3",267,0)
 i $g(@vals@("ceccld"))="-" s @vals@("ceccld")="no" s cectot=cectot+1
"RTN","SAMICTT3",268,0)
 i $g(@vals@("cecccf"))="-" s @vals@("cecccf")="no" s cectot=cectot+1
"RTN","SAMICTT3",269,0)
 i $g(@vals@("ceccrc"))="-" s @vals@("ceccrc")="no" s cectot=cectot+1
"RTN","SAMICTT3",270,0)
 i $g(@vals@("cecclm"))="" s @vals@("cecclm")="no" s cectot=cectot+1
"RTN","SAMICTT3",271,0)
 i $g(@vals@("ceccld"))="" s @vals@("ceccld")="no" s cectot=cectot+1
"RTN","SAMICTT3",272,0)
 i $g(@vals@("cecccf"))="" s @vals@("cecccf")="no" s cectot=cectot+1
"RTN","SAMICTT3",273,0)
 i $g(@vals@("ceccrc"))="" s @vals@("ceccrc")="no" s cectot=cectot+1
"RTN","SAMICTT3",274,0)
 S ^gpl("cectot")=cectot
"RTN","SAMICTT3",275,0)
 ;
"RTN","SAMICTT3",276,0)
 if $$XVAL("ceccv",vals)="nr" d  ;
"RTN","SAMICTT3",277,0)
 . d OUT("Coronary Artery Calcification score not provided.") d OUT("")
"RTN","SAMICTT3",278,0)
 . s cacout=1
"RTN","SAMICTT3",279,0)
 . q
"RTN","SAMICTT3",280,0)
 ; if $$XVAL("cecccac",vals)'="" d  ;
"RTN","SAMICTT3",281,0)
 ; . s @vals@("ceccv")="e"
"RTN","SAMICTT3",282,0)
 ; . q
"RTN","SAMICTT3",283,0)
 ;
"RTN","SAMICTT3",284,0)
 ;d  if $$XVAL("ceccv",vals)'="n" d  ;
"RTN","SAMICTT3",285,0)
 if cacout=0 d  ;
"RTN","SAMICTT3",286,0)
 . set vcac=$$XVAL("cecccac",vals)
"RTN","SAMICTT3",287,0)
 . ;if cectot=4 q  ;
"RTN","SAMICTT3",288,0)
 . if vcac'="" d  ;
"RTN","SAMICTT3",289,0)
 . . s cacrec=""
"RTN","SAMICTT3",290,0)
 . . s cac="The Visual Coronary Artery Calcium (CAC) Score is "_vcac_". "
"RTN","SAMICTT3",291,0)
 . . s cacval=vcac
"RTN","SAMICTT3",292,0)
 . . i cacval>3 s cacrec=$g(@dict@("CAC_recommendation"))
"RTN","SAMICTT3",293,0)
 . . q
"RTN","SAMICTT3",294,0)
 . q
"RTN","SAMICTT3",295,0)
 ;
"RTN","SAMICTT3",296,0)
 ;n samicac s samicac=0
"RTN","SAMICTT3",297,0)
 ;i $$XVAL("cecclm",vals)'="no" s samicac=1
"RTN","SAMICTT3",298,0)
 ;i $$XVAL("ceccld",vals)'="no" s samicac=1
"RTN","SAMICTT3",299,0)
 ;;i $$XVAL("cecclf",vals)'="no" s samicac=1
"RTN","SAMICTT3",300,0)
 ;i $$XVAL("cecccf",vals)'="no" s samicac=1
"RTN","SAMICTT3",301,0)
 ;i $$XVAL("ceccrc",vals)'="no" s samicac=1
"RTN","SAMICTT3",302,0)
 ;
"RTN","SAMICTT3",303,0)
 ;;s outmode="hold" s line=""
"RTN","SAMICTT3",304,0)
 ;i samicac=1 d  ;
"RTN","SAMICTT3",305,0)
 ;
"RTN","SAMICTT3",306,0)
 i cacout=0 d  ;
"RTN","SAMICTT3",307,0)
 . ;if cectot>3 q  ;
"RTN","SAMICTT3",308,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecclm")_" in left main, ")
"RTN","SAMICTT3",309,0)
 . d OUT($$XSUB("cecc",vals,dict,"ceccld")_" in left anterior descending, ")
"RTN","SAMICTT3",310,0)
 . ;d OUT($$XSUB("cecc",vals,dict,"cecclf")_" in circumflex, and ")
"RTN","SAMICTT3",311,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecccf")_" in circumflex, and ")
"RTN","SAMICTT3",312,0)
 . d OUT($$XSUB("cecc",vals,dict,"ceccrc")_" in right coronary. "_cac)
"RTN","SAMICTT3",313,0)
 . q
"RTN","SAMICTT3",314,0)
 s outmode="go"
"RTN","SAMICTT3",315,0)
 d OUT("")
"RTN","SAMICTT3",316,0)
 ; 
"RTN","SAMICTT3",317,0)
 s outmode="hold"
"RTN","SAMICTT3",318,0)
 if $$XVAL("cecca",vals)'="-" d  ;
"RTN","SAMICTT3",319,0)
 . d HOUT("Aortic Calcifications: ")
"RTN","SAMICTT3",320,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecca"))
"RTN","SAMICTT3",321,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",322,0)
 . q
"RTN","SAMICTT3",323,0)
 ;
"RTN","SAMICTT3",324,0)
 ; 
"RTN","SAMICTT3",325,0)
 s outmode="hold"
"RTN","SAMICTT3",326,0)
 if $$XVAL("ceavc",vals)'="-" d  ;
"RTN","SAMICTT3",327,0)
 . d HOUT("Aortic Valve Calcifications: ")
"RTN","SAMICTT3",328,0)
 . d OUT($$XSUB("cecc",vals,dict,"ceavc"))
"RTN","SAMICTT3",329,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",330,0)
 . q
"RTN","SAMICTT3",331,0)
 ;
"RTN","SAMICTT3",332,0)
 s outmode="hold"
"RTN","SAMICTT3",333,0)
 n ocf s ocf=0
"RTN","SAMICTT3",334,0)
 d HOUT("Other Cardiac Findings: ")
"RTN","SAMICTT3",335,0)
 ;d HOUT("Other Cardiac Findings: ")
"RTN","SAMICTT3",336,0)
 ;
"RTN","SAMICTT3",337,0)
 ;s outmode="hold"
"RTN","SAMICTT3",338,0)
 ;# Pericardial Effusion
"RTN","SAMICTT3",339,0)
 if $$XVAL("ceprevm",vals)'="-" d  ;
"RTN","SAMICTT3",340,0)
 . if $$XVAL("ceprevm",vals)'="no" d  ;
"RTN","SAMICTT3",341,0)
 . . if $$XVAL("ceprevm",vals)]"" d
"RTN","SAMICTT3",342,0)
 . . . d OUT("A "_$$XSUB("ceprevm",vals,dict,"ceprevm")_" pericardial effusion"_". ") d OUT("")
"RTN","SAMICTT3",343,0)
 . . . s pe=1 s ocf=1
"RTN","SAMICTT3",344,0)
 . . . q
"RTN","SAMICTT3",345,0)
 . . else  d OUT("No pericardial effusion. ") d OUT("")
"RTN","SAMICTT3",346,0)
 . . q
"RTN","SAMICTT3",347,0)
 . q
"RTN","SAMICTT3",348,0)
 ;
"RTN","SAMICTT3",349,0)
 ;;# Pulmonary and Aortic Diameter
"RTN","SAMICTT3",350,0)
 i $$XVAL("cepaw",vals)]"" d  ;
"RTN","SAMICTT3",351,0)
 . d OUT("Widest main pulmonary artery diameter is "_$$XVAL("cepaw",vals)_" mm. ")
"RTN","SAMICTT3",352,0)
 . if $$XVAL("ceaow",vals)]"" d  ;
"RTN","SAMICTT3",353,0)
 . . d OUT("Widest ascending aortic diameter at the same level is "_$$XVAL("ceaow",vals)_" mm. ")
"RTN","SAMICTT3",354,0)
 . . if $$XVAL("cepar",vals)]"" d  ;
"RTN","SAMICTT3",355,0)
 . . . d OUT("The ratio is "_$$XVAL("cepar",vals)_". ")
"RTN","SAMICTT3",356,0)
 . . . q
"RTN","SAMICTT3",357,0)
 . . q
"RTN","SAMICTT3",358,0)
 . d OUT("") s ocf=1
"RTN","SAMICTT3",359,0)
 . q
"RTN","SAMICTT3",360,0)
 ;
"RTN","SAMICTT3",361,0)
 ; #"Additional Comments on Cardiac Abnormalities:"
"RTN","SAMICTT3",362,0)
 if $$XVAL("cecommca",vals)]"" d  ;
"RTN","SAMICTT3",363,0)
 . d OUT($$XVAL("cecommca",vals)_". ")
"RTN","SAMICTT3",364,0)
 . s ocf=1
"RTN","SAMICTT3",365,0)
 . q
"RTN","SAMICTT3",366,0)
 i ocf=0 d OUT("None. ")
"RTN","SAMICTT3",367,0)
 s outmode="go"
"RTN","SAMICTT3",368,0)
 d OUT("")
"RTN","SAMICTT3",369,0)
 ;
"RTN","SAMICTT3",370,0)
 ;
"RTN","SAMICTT3",371,0)
 s outmode="hold"
"RTN","SAMICTT3",372,0)
 d HOUT("Mediastinum: ")
"RTN","SAMICTT3",373,0)
 n yesmm s yesmm=0
"RTN","SAMICTT3",374,0)
 n abn
"RTN","SAMICTT3",375,0)
 ;
"RTN","SAMICTT3",376,0)
 i $$XVAL("ceoma",vals)="y",$$XVAL("ceata",vals)="y" d  ;
"RTN","SAMICTT3",377,0)
 . s yeamm=1
"RTN","SAMICTT3",378,0)
 . s abn=$$CCMSTR("ceatc^ceaty^ceatm",vals)
"RTN","SAMICTT3",379,0)
 . ;d OUT("[abn="_abn_"]")
"RTN","SAMICTT3",380,0)
 . i abn="" d OUT(sp1_"Noted in the thyroid. ")
"RTN","SAMICTT3",381,0)
 . i abn]"" d OUT(sp1_abn_" thyroid. ")
"RTN","SAMICTT3",382,0)
 . i $$XVAL("ceato",vals)="o" d OUT(sp1_$$XVAL("ceatos",vals)_"<br>")
"RTN","SAMICTT3",383,0)
 . q
"RTN","SAMICTT3",384,0)
 ;
"RTN","SAMICTT3",385,0)
 i $$XVAL("ceaya",vals)="y" d  ;
"RTN","SAMICTT3",386,0)
 . s yesmm=1
"RTN","SAMICTT3",387,0)
 . s abn=$$CCMSTR("ceayc^ceayy^ceaym",vals)
"RTN","SAMICTT3",388,0)
 . i abn="" d OUT(sp1_"Noted in the thymus")
"RTN","SAMICTT3",389,0)
 . i abn]"" d OUT(sp1_abn_" thymus. ")
"RTN","SAMICTT3",390,0)
 . i $$XVAL("ceayo",vals)="o" d OUT(sp1_$$XVAL("ceayos",vals))
"RTN","SAMICTT3",391,0)
 . q
"RTN","SAMICTT3",392,0)
 ;
"RTN","SAMICTT3",393,0)
 ;   # Non-calcified lymph nodes
"RTN","SAMICTT3",394,0)
 n lnlist,lnlistt,lnlcnt
"RTN","SAMICTT3",395,0)
 set lnlcnt=22
"RTN","SAMICTT3",396,0)
 set lnlist(1)="cemlnl1"
"RTN","SAMICTT3",397,0)
 set lnlist(2)="cemlnl2l"
"RTN","SAMICTT3",398,0)
 set lnlist(2.5)="cemlnl2r"
"RTN","SAMICTT3",399,0)
 set lnlist(3)="cemlnl3a"
"RTN","SAMICTT3",400,0)
 set lnlist(3.5)="cemlnl3p"
"RTN","SAMICTT3",401,0)
 set lnlist(4)="cemlnl4l"
"RTN","SAMICTT3",402,0)
 set lnlist(4.5)="cemlnl4r"
"RTN","SAMICTT3",403,0)
 set lnlist(5)="cemlnl5"
"RTN","SAMICTT3",404,0)
 set lnlist(6)="cemlnl6"
"RTN","SAMICTT3",405,0)
 set lnlist(7)="cemlnl7"
"RTN","SAMICTT3",406,0)
 set lnlist(8)="cemlnl8"
"RTN","SAMICTT3",407,0)
 set lnlist(9)="cemlnl9"
"RTN","SAMICTT3",408,0)
 set lnlist(10)="cemlnl10l"
"RTN","SAMICTT3",409,0)
 set lnlist(10.5)="cemlnl10r"
"RTN","SAMICTT3",410,0)
 set lnlist(11)="cemlnl11l"
"RTN","SAMICTT3",411,0)
 set lnlist(11.5)="cemlnl11r"
"RTN","SAMICTT3",412,0)
 set lnlist(12)="cemlnl12l"
"RTN","SAMICTT3",413,0)
 set lnlist(12.5)="cemlnl12r"
"RTN","SAMICTT3",414,0)
 set lnlist(13)="cemlnl13l"
"RTN","SAMICTT3",415,0)
 set lnlist(13.5)="cemlnl13r"
"RTN","SAMICTT3",416,0)
 set lnlist(14)="cemlnl14l"
"RTN","SAMICTT3",417,0)
 set lnlist(14.5)="cemlnl14r"
"RTN","SAMICTT3",418,0)
 ;
"RTN","SAMICTT3",419,0)
 set lnlistt(1)="N1: Low cervical, supraclavicular, and sternal notch nodes"
"RTN","SAMICTT3",420,0)
 set lnlistt(2)="N2L: Upper paratracheal (left)"
"RTN","SAMICTT3",421,0)
 set lnlistt(2.5)="N2R: Upper paratracheal (right)"
"RTN","SAMICTT3",422,0)
 set lnlistt(3)="N3A: Prevascular"
"RTN","SAMICTT3",423,0)
 set lnlistt(3.5)="N3P: Retrotracheal"
"RTN","SAMICTT3",424,0)
 set lnlistt(4)="N4L: Lower paratracheal (left)"
"RTN","SAMICTT3",425,0)
 set lnlistt(4.5)="N4R: Lower paratracheal (right)"
"RTN","SAMICTT3",426,0)
 set lnlistt(5)="N5: Subaortic"
"RTN","SAMICTT3",427,0)
 set lnlistt(6)="N6: Para-aortic (ascending aorta or phrenic)"
"RTN","SAMICTT3",428,0)
 set lnlistt(7)="N7: Subcarinal"
"RTN","SAMICTT3",429,0)
 set lnlistt(8)="N8: Paraesophageal (below carina)"
"RTN","SAMICTT3",430,0)
 set lnlistt(9)="N9: Pulmonary ligament"
"RTN","SAMICTT3",431,0)
 set lnlistt(10)="N10L: Hilar (left)"
"RTN","SAMICTT3",432,0)
 set lnlistt(10.5)="N10R: Hilar (right)"
"RTN","SAMICTT3",433,0)
 set lnlistt(11)="N11L: Interlobar (left)"
"RTN","SAMICTT3",434,0)
 set lnlistt(11.5)="N11R: Interlobar (right)"
"RTN","SAMICTT3",435,0)
 set lnlistt(12)="N12L: Lobar (left)"
"RTN","SAMICTT3",436,0)
 set lnlistt(12.5)="N12R: Lobar (right)"
"RTN","SAMICTT3",437,0)
 set lnlistt(13)="N13L: Segmental (left)"
"RTN","SAMICTT3",438,0)
 set lnlistt(13.5)="N13R: Segmental (right)"
"RTN","SAMICTT3",439,0)
 set lnlistt(14)="N14L: Subsegmental (left)"
"RTN","SAMICTT3",440,0)
 set lnlistt(14.5)="N14R: Subsegmental (right)"
"RTN","SAMICTT3",441,0)
 ;
"RTN","SAMICTT3",442,0)
 ;set lnlist(1)="cemlnl1"
"RTN","SAMICTT3",443,0)
 ;set lnlist(2)="cemlnl2r"
"RTN","SAMICTT3",444,0)
 ;set lnlist(3)="cemlnl2l"
"RTN","SAMICTT3",445,0)
 ;set lnlist(4)="cemlnl3"
"RTN","SAMICTT3",446,0)
 ;set lnlist(5)="cemlnl4r"
"RTN","SAMICTT3",447,0)
 ;set lnlist(6)="cemlnl4l"
"RTN","SAMICTT3",448,0)
 ;set lnlist(7)="cemlnl5"
"RTN","SAMICTT3",449,0)
 ;set lnlist(8)="cemlnl6"
"RTN","SAMICTT3",450,0)
 ;set lnlist(9)="cemlnl7"
"RTN","SAMICTT3",451,0)
 ;set lnlist(10)="cemlnl8"
"RTN","SAMICTT3",452,0)
 ;set lnlist(11)="cemlnl9"
"RTN","SAMICTT3",453,0)
 ;set lnlist(12)="cemlnl10r"
"RTN","SAMICTT3",454,0)
 ;set lnlist(13)="cemlnl10l"
"RTN","SAMICTT3",455,0)
 ;
"RTN","SAMICTT3",456,0)
 ;set lnlistt(1)="high mediastinal"
"RTN","SAMICTT3",457,0)
 ;set lnlistt(2)="right upper paratracheal"
"RTN","SAMICTT3",458,0)
 ;set lnlistt(3)="left upper paratracheal"
"RTN","SAMICTT3",459,0)
 ;set lnlistt(4)="prevascular/retrotracheal"
"RTN","SAMICTT3",460,0)
 ;set lnlistt(5)="right lower paratracheal"
"RTN","SAMICTT3",461,0)
 ;set lnlistt(6)="left lower paratracheal"
"RTN","SAMICTT3",462,0)
 ;set lnlistt(7)="sub-aortic (A-P window)"
"RTN","SAMICTT3",463,0)
 ;set lnlistt(8)="para-aortic"
"RTN","SAMICTT3",464,0)
 ;set lnlistt(9)="subcarinal"
"RTN","SAMICTT3",465,0)
 ;set lnlistt(10)="para-esophageal"
"RTN","SAMICTT3",466,0)
 ;set lnlistt(11)="pulmonary ligament"
"RTN","SAMICTT3",467,0)
 ;set lnlistt(12)="right hilar"
"RTN","SAMICTT3",468,0)
 ;set lnlistt(13)="left hilar"
"RTN","SAMICTT3",469,0)
 ;
"RTN","SAMICTT3",470,0)
 ;s outmode="hold"
"RTN","SAMICTT3",471,0)
 if $$XVAL("cemln",vals)="y" d  ;
"RTN","SAMICTT3",472,0)
 . s yesmm=1
"RTN","SAMICTT3",473,0)
 . n llist s llist=""
"RTN","SAMICTT3",474,0)
 . n item s item=""
"RTN","SAMICTT3",475,0)
 . n slnum
"RTN","SAMICTT3",476,0)
 . n lnum s lnum=0
"RTN","SAMICTT3",477,0)
 . f  s item=$o(lnlist(item)) q:item=""  d  ;
"RTN","SAMICTT3",478,0)
 . . ;i $$XVAL(lnlist(item),vals)]"" s llist($o(llist(""),-1)+1)=lnlist(item)
"RTN","SAMICTT3",479,0)
 . . i $$XVAL(lnlist(item),vals)]"" d  ;
"RTN","SAMICTT3",480,0)
 . . . s llist(item)=lnlist(item)
"RTN","SAMICTT3",481,0)
 . . . s lnum=lnum+1
"RTN","SAMICTT3",482,0)
 . . . q
"RTN","SAMICTT3",483,0)
 . . q
"RTN","SAMICTT3",484,0)
 . ;s lnum=$o(llist(""),-1)
"RTN","SAMICTT3",485,0)
 . i lnum=0 d OUT("Enlarged or growing lymph nodes are noted. ")
"RTN","SAMICTT3",486,0)
 . i lnum>0 d  ;
"RTN","SAMICTT3",487,0)
 . . s slnum=lnum
"RTN","SAMICTT3",488,0)
 . . ;d OUT("Enlarged or growing lymph nodes in the ")
"RTN","SAMICTT3",489,0)
 . . d OUT("Enlarged or growing lymph nodes: ")
"RTN","SAMICTT3",490,0)
 . . s item=""
"RTN","SAMICTT3",491,0)
 . . f  s item=$o(llist(item)) q:item=""  d  ;
"RTN","SAMICTT3",492,0)
 . . . d OUT(lnlistt(item))
"RTN","SAMICTT3",493,0)
 . . . i lnum>2 d OUT(", ")
"RTN","SAMICTT3",494,0)
 . . . i lnum=2 d OUT(" and ")
"RTN","SAMICTT3",495,0)
 . . . s lnum=lnum-1
"RTN","SAMICTT3",496,0)
 . . . q
"RTN","SAMICTT3",497,0)
 . . ;i slnum>1 d OUT(" locations. ")
"RTN","SAMICTT3",498,0)
 . . ;i slnum=1 d OUT(" location. ")
"RTN","SAMICTT3",499,0)
 . . d OUT(". ")
"RTN","SAMICTT3",500,0)
 . . q
"RTN","SAMICTT3",501,0)
 . q
"RTN","SAMICTT3",502,0)
 ;
"RTN","SAMICTT3",503,0)
 ;s outmode="go"
"RTN","SAMICTT3",504,0)
 ;d OUT("")
"RTN","SAMICTT3",505,0)
 ;
"RTN","SAMICTT3",506,0)
 if $$XVAL("cemlncab",vals)="y" d  ;
"RTN","SAMICTT3",507,0)
 . set yesmm=1
"RTN","SAMICTT3",508,0)
 . d OUT("Calcified lymph nodes present. ")
"RTN","SAMICTT3",509,0)
 . q
"RTN","SAMICTT3",510,0)
 ;
"RTN","SAMICTT3",511,0)
 if $$XVAL("ceagaln",vals)="y" d  ;
"RTN","SAMICTT3",512,0)
 . set yesmm=1
"RTN","SAMICTT3",513,0)
 . d OUT("Enlarged or growing axillary lymph nodes without central fat are seen. ")
"RTN","SAMICTT3",514,0)
 . d OUT($$XVAL("ceagalns",vals))
"RTN","SAMICTT3",515,0)
 . q
"RTN","SAMICTT3",516,0)
 ;
"RTN","SAMICTT3",517,0)
 if $$XVAL("cemva",vals)="y" d  ;
"RTN","SAMICTT3",518,0)
 . set yesmm=1
"RTN","SAMICTT3",519,0)
 . if $$XVAL("cemvaa",vals)="a" d  ;
"RTN","SAMICTT3",520,0)
 . . d OUT("Other vascular abnormalities are seen in the aorta. ")
"RTN","SAMICTT3",521,0)
 . . q
"RTN","SAMICTT3",522,0)
 . if $$XVAL("cemvaa",vals)="w" d  ;
"RTN","SAMICTT3",523,0)
 . . d OUT("Other vascular abnormalities are seen in the pulmonary series. ")
"RTN","SAMICTT3",524,0)
 . . q
"RTN","SAMICTT3",525,0)
 . d OUT($$XVAL("cemvaos",vals)_"<br>")
"RTN","SAMICTT3",526,0)
 . q
"RTN","SAMICTT3",527,0)
 ;
"RTN","SAMICTT3",528,0)
 ;s outmode="hold"
"RTN","SAMICTT3",529,0)
 ;   # Esophageal
"RTN","SAMICTT3",530,0)
 if $$XVAL("cemeln",vals)="y" d  ;
"RTN","SAMICTT3",531,0)
 . set yesmm=1
"RTN","SAMICTT3",532,0)
 . n elist s elist=""
"RTN","SAMICTT3",533,0)
 . set numl=0
"RTN","SAMICTT3",534,0)
 . if $$XVAL("cemelna",vals)="a" d  ;
"RTN","SAMICTT3",535,0)
 . . s elist($o(elist(""),-1)+1)="Air-fluid level"
"RTN","SAMICTT3",536,0)
 . . s numl=numl+1
"RTN","SAMICTT3",537,0)
 . . q
"RTN","SAMICTT3",538,0)
 . if $$XVAL("cemelnw",vals)="w" d  ;
"RTN","SAMICTT3",539,0)
 . . s elist($o(elist(""),-1)+1)="Wall thickening"
"RTN","SAMICTT3",540,0)
 . . s numl=numl+1
"RTN","SAMICTT3",541,0)
 . . q
"RTN","SAMICTT3",542,0)
 . if $$XVAL("cemelnm",vals)="m" d  ;
"RTN","SAMICTT3",543,0)
 . . s elist($o(elist(""),-1)+1)="A mass"
"RTN","SAMICTT3",544,0)
 . . s numl=numl+1
"RTN","SAMICTT3",545,0)
 . . q
"RTN","SAMICTT3",546,0)
 . if numl=0 d OUT("Esophageal abnormality noted. ")
"RTN","SAMICTT3",547,0)
 . e  d  ;
"RTN","SAMICTT3",548,0)
 . . d OUT($g(elist(1)))
"RTN","SAMICTT3",549,0)
 . . if numl=1 d OUT(" is ")
"RTN","SAMICTT3",550,0)
 . . e  d  ;
"RTN","SAMICTT3",551,0)
 . . . if numl=2 d  ;
"RTN","SAMICTT3",552,0)
 . . . . d OUT(" and ")
"RTN","SAMICTT3",553,0)
 . . . . q
"RTN","SAMICTT3",554,0)
 . . . e  d OUT(", ")
"RTN","SAMICTT3",555,0)
 . . . d OUT($$LOWC($g(elist(2))))
"RTN","SAMICTT3",556,0)
 . . . if numl=3 d  ;
"RTN","SAMICTT3",557,0)
 . . . . d OUT(", and "_$$LOWC($g(elist(3))))
"RTN","SAMICTT3",558,0)
 . . . . q
"RTN","SAMICTT3",559,0)
 . . . q
"RTN","SAMICTT3",560,0)
 . . d OUT("seen in the esophagus. ")
"RTN","SAMICTT3",561,0)
 . . q
"RTN","SAMICTT3",562,0)
 . d OUT($$XVAL("cemelnos",vals))
"RTN","SAMICTT3",563,0)
 . q
"RTN","SAMICTT3",564,0)
 ;
"RTN","SAMICTT3",565,0)
 ;s outmode="go"
"RTN","SAMICTT3",566,0)
 ;d OUT("")
"RTN","SAMICTT3",567,0)
 ;
"RTN","SAMICTT3",568,0)
 if $$XVAL("cehhn",vals)="y" d  ;
"RTN","SAMICTT3",569,0)
 . set yesmm=1
"RTN","SAMICTT3",570,0)
 . if $$XVAL("cehhnos",vals)'="" d OUT("Hiatal hernia: "_$$XVAL("cehhnos",vals))
"RTN","SAMICTT3",571,0)
 . if $$XVAL("cehhnos",vals)="" d OUT("Hiatal hernia. ")
"RTN","SAMICTT3",572,0)
 . d OUT("")
"RTN","SAMICTT3",573,0)
 . q
"RTN","SAMICTT3",574,0)
 ;
"RTN","SAMICTT3",575,0)
 if $$XVAL("ceomm",vals)="y" d  ;
"RTN","SAMICTT3",576,0)
 . set yesmm=1
"RTN","SAMICTT3",577,0)
 . n tval
"RTN","SAMICTT3",578,0)
 . set tval=$$XVAL("ceommos",vals)
"RTN","SAMICTT3",579,0)
 . set abn=$$CCMSTR("ceamc^ceamy^ceamm",vals)
"RTN","SAMICTT3",580,0)
 . if abn="" d OUT(sp1_"Abnormality noted in the mediastinum. ")
"RTN","SAMICTT3",581,0)
 . e  d OUT(sp1_abn_" mediastinum. ")
"RTN","SAMICTT3",582,0)
 . d OUT(tval)
"RTN","SAMICTT3",583,0)
 . q
"RTN","SAMICTT3",584,0)
 ;
"RTN","SAMICTT3",585,0)
 ;i yesmm=0 d OUT(sp1_"No abnormalities. ")
"RTN","SAMICTT3",586,0)
 i yesmm=0 d OUT(sp1_"Unremarkable. ")
"RTN","SAMICTT3",587,0)
 i $$XVAL("ceotabnm",vals)'="" d  ;
"RTN","SAMICTT3",588,0)
 . d OUT(sp1_$$XVAL("ceotabnm",vals)_". ")
"RTN","SAMICTT3",589,0)
 . q
"RTN","SAMICTT3",590,0)
 s outmode="go"
"RTN","SAMICTT3",591,0)
 d OUT("")
"RTN","SAMICTT3",592,0)
 ;
"RTN","SAMICTT3",593,0)
 quit  ; end of EMPHYS
"RTN","SAMICTT3",594,0)
 ;
"RTN","SAMICTT3",595,0)
 ;
"RTN","SAMICTT3",596,0)
 ;
"RTN","SAMICTT3",597,0)
 ;
"RTN","SAMICTT3",598,0)
 ;@func $$CCMSTR
"RTN","SAMICTT3",599,0)
 ;
"RTN","SAMICTT3",600,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT3",601,0)
 ;
"RTN","SAMICTT3",602,0)
 ;ven/gpl;private;function;silent;clean;sac;tests?;port
"RTN","SAMICTT3",603,0)
 ;@called-by
"RTN","SAMICTT3",604,0)
 ; EMPHYS
"RTN","SAMICTT3",605,0)
 ;@calls
"RTN","SAMICTT3",606,0)
 ; $$XVAL
"RTN","SAMICTT3",607,0)
 ; $$LOWC
"RTN","SAMICTT3",608,0)
 ;@input
"RTN","SAMICTT3",609,0)
 ; lst
"RTN","SAMICTT3",610,0)
 ; vals
"RTN","SAMICTT3",611,0)
 ;@output = phrase for comments
"RTN","SAMICTT3",612,0)
 ;
"RTN","SAMICTT3",613,0)
 ;
"RTN","SAMICTT3",614,0)
CCMSTR(lst,vals) ; form phrases
"RTN","SAMICTT3",615,0)
 ;
"RTN","SAMICTT3",616,0)
 n retstr s retstr=""
"RTN","SAMICTT3",617,0)
 n lblist s lblist=""
"RTN","SAMICTT3",618,0)
 n ib s ib=""
"RTN","SAMICTT3",619,0)
 n lb
"RTN","SAMICTT3",620,0)
 f lb=1:1:$l(lst,"^") d  ;
"RTN","SAMICTT3",621,0)
 . n lvar s lvar=$p(lst,"^",lb)
"RTN","SAMICTT3",622,0)
 . s ib=$$XVAL($p(lst,"^",lb),vals)
"RTN","SAMICTT3",623,0)
 . if ib]"" d  ;
"RTN","SAMICTT3",624,0)
 . . i ib="y" d  ; 
"RTN","SAMICTT3",625,0)
 . . . i $f("ceasc cealc ceapc ceapc ceaac ceakc",lvar)>0 s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",626,0)
 . . . ;i "ceasc cealc ceapc ceapc ceaac ceakc"[lb s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",627,0)
 . . . else  s lblist($o(lblist(""),-1)+1)="Cyst"
"RTN","SAMICTT3",628,0)
 . . . q
"RTN","SAMICTT3",629,0)
 . . i ib="c" s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",630,0)
 . . i ib="m" s lblist($o(lblist(""),-1)+1)="Mass"
"RTN","SAMICTT3",631,0)
 . . q
"RTN","SAMICTT3",632,0)
 . q
"RTN","SAMICTT3",633,0)
 i $o(lblist(""),-1)=1 s retstr=retstr_lblist(1)_" is seen in the"
"RTN","SAMICTT3",634,0)
 e  i $o(lblist(""),-1)=2 s retstr=retstr_lblist(1)_" and "_$$LOWC(lblist(2))_" are seen in the"
"RTN","SAMICTT3",635,0)
 e  i $o(lblist(""),-1)=3 s retstr=retstr_"Calicification, cyst, and mass are seen in the"
"RTN","SAMICTT3",636,0)
 ;
"RTN","SAMICTT3",637,0)
 quit retstr ; end of $$CCMSTR
"RTN","SAMICTT3",638,0)
 ;
"RTN","SAMICTT3",639,0)
 ;
"RTN","SAMICTT3",640,0)
 ;
"RTN","SAMICTT3",641,0)
 ;
"RTN","SAMICTT3",642,0)
 ;@func $$LOWC
"RTN","SAMICTT3",643,0)
 ;
"RTN","SAMICTT3",644,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT3",645,0)
 ;
"RTN","SAMICTT3",646,0)
 ;ven/gpl;private;function;silent;clean;sac;tests?;port
"RTN","SAMICTT3",647,0)
 ;@called-by
"RTN","SAMICTT3",648,0)
 ; EMPHYS
"RTN","SAMICTT3",649,0)
 ; $$CCMSTR
"RTN","SAMICTT3",650,0)
 ;@calls none
"RTN","SAMICTT3",651,0)
 ;@input
"RTN","SAMICTT3",652,0)
 ; X
"RTN","SAMICTT3",653,0)
 ;@output = lowercase string
"RTN","SAMICTT3",654,0)
 ;
"RTN","SAMICTT3",655,0)
 ;
"RTN","SAMICTT3",656,0)
LOWC(X) ; convert X to lowercase
"RTN","SAMICTT3",657,0)
 ;
"RTN","SAMICTT3",658,0)
 quit $translate(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","SAMICTT3",659,0)
 ;
"RTN","SAMICTT3",660,0)
 ;
"RTN","SAMICTT3",661,0)
 ;
"RTN","SAMICTT3",662,0)
 ;
"RTN","SAMICTT3",663,0)
 ;@proc OUT
"RTN","SAMICTT3",664,0)
 ;
"RTN","SAMICTT3",665,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT3",666,0)
 ;
"RTN","SAMICTT3",667,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT3",668,0)
 ;@called-by
"RTN","SAMICTT3",669,0)
 ; EMPHYS
"RTN","SAMICTT3",670,0)
 ;@calls none
"RTN","SAMICTT3",671,0)
 ;@input
"RTN","SAMICTT3",672,0)
 ; ln = output to add
"RTN","SAMICTT3",673,0)
 ; ]rtn output array
"RTN","SAMICTT3",674,0)
 ; ]debug
"RTN","SAMICTT3",675,0)
 ;@thruput
"RTN","SAMICTT3",676,0)
 ; cnt
"RTN","SAMICTT3",677,0)
 ;@output
"RTN","SAMICTT3",678,0)
 ; line added to ct report
"RTN","SAMICTT3",679,0)
 ;
"RTN","SAMICTT3",680,0)
 ;
"RTN","SAMICTT3",681,0)
OUT(ln) ; output ct report line
"RTN","SAMICTT3",682,0)
 ;
"RTN","SAMICTT3",683,0)
 i ln[".." s ln=$p(ln,"..")_"." ; remove double periods at the end
"RTN","SAMICTT3",684,0)
 ;
"RTN","SAMICTT3",685,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT3",686,0)
 s cnt=cnt+1
"RTN","SAMICTT3",687,0)
 ;s debug=1
"RTN","SAMICTT3",688,0)
 n lnn s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",689,0)
 i outmode="go" d  ;
"RTN","SAMICTT3",690,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT3",691,0)
 . s line=""
"RTN","SAMICTT3",692,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",693,0)
 . q
"RTN","SAMICTT3",694,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT3",695,0)
 ;
"RTN","SAMICTT3",696,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT3",697,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT3",698,0)
 . n zs s zs=$STACK
"RTN","SAMICTT3",699,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT3",700,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT3",701,0)
 . q
"RTN","SAMICTT3",702,0)
 ;
"RTN","SAMICTT3",703,0)
 quit  ; end of OUT
"RTN","SAMICTT3",704,0)
 ;
"RTN","SAMICTT3",705,0)
 ;
"RTN","SAMICTT3",706,0)
 ;
"RTN","SAMICTT3",707,0)
 ;
"RTN","SAMICTT3",708,0)
 ;@proc HOUT
"RTN","SAMICTT3",709,0)
 ;
"RTN","SAMICTT3",710,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT3",711,0)
 ;
"RTN","SAMICTT3",712,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT3",713,0)
 ;@called-by
"RTN","SAMICTT3",714,0)
 ; EMPHYS
"RTN","SAMICTT3",715,0)
 ;@calls
"RTN","SAMICTT3",716,0)
 ; OUT
"RTN","SAMICTT3",717,0)
 ;@input
"RTN","SAMICTT3",718,0)
 ; ln = header output to add
"RTN","SAMICTT3",719,0)
 ; ]rtn output array
"RTN","SAMICTT3",720,0)
 ;@output
"RTN","SAMICTT3",721,0)
 ; header line added to ct report
"RTN","SAMICTT3",722,0)
 ;
"RTN","SAMICTT3",723,0)
 ;
"RTN","SAMICTT3",724,0)
HOUT(ln) ; output ct report header line
"RTN","SAMICTT3",725,0)
 ;
"RTN","SAMICTT3",726,0)
 D OUT(ln)
"RTN","SAMICTT3",727,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT3",728,0)
 ;
"RTN","SAMICTT3",729,0)
 quit  ; end of HOUT
"RTN","SAMICTT3",730,0)
 ;
"RTN","SAMICTT3",731,0)
 ;
"RTN","SAMICTT3",732,0)
 ;
"RTN","SAMICTT3",733,0)
 ;
"RTN","SAMICTT3",734,0)
 ;@func $$XVAL
"RTN","SAMICTT3",735,0)
 ;
"RTN","SAMICTT3",736,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT3",737,0)
 ;
"RTN","SAMICTT3",738,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT3",739,0)
 ;@called-by
"RTN","SAMICTT3",740,0)
 ; EMPHYS
"RTN","SAMICTT3",741,0)
 ; $$CCMSTR
"RTN","SAMICTT3",742,0)
 ;@calls none
"RTN","SAMICTT3",743,0)
 ;@input
"RTN","SAMICTT3",744,0)
 ; var
"RTN","SAMICTT3",745,0)
 ; vals is passed by name
"RTN","SAMICTT3",746,0)
 ;@output = patient value for var
"RTN","SAMICTT3",747,0)
 ;
"RTN","SAMICTT3",748,0)
 ;
"RTN","SAMICTT3",749,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT3",750,0)
 ;
"RTN","SAMICTT3",751,0)
 ;
"RTN","SAMICTT3",752,0)
 n zr s zr=$g(@vals@(var))
"RTN","SAMICTT3",753,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT3",754,0)
 ;
"RTN","SAMICTT3",755,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT3",756,0)
 ;
"RTN","SAMICTT3",757,0)
 ;
"RTN","SAMICTT3",758,0)
 ;
"RTN","SAMICTT3",759,0)
 ;
"RTN","SAMICTT3",760,0)
 ;@func $$XSUB
"RTN","SAMICTT3",761,0)
 ;
"RTN","SAMICTT3",762,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT3",763,0)
 ;
"RTN","SAMICTT3",764,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT3",765,0)
 ;@called-by
"RTN","SAMICTT3",766,0)
 ; EMPHYS
"RTN","SAMICTT3",767,0)
 ;@calls none
"RTN","SAMICTT3",768,0)
 ;@input
"RTN","SAMICTT3",769,0)
 ; var
"RTN","SAMICTT3",770,0)
 ; vals & dict are passed by name
"RTN","SAMICTT3",771,0)
 ; valdx is used for nodules ala cect2co with nodule # included
"RTN","SAMICTT3",772,0)
 ;@output = dictionary value for var
"RTN","SAMICTT3",773,0)
 ;
"RTN","SAMICTT3",774,0)
 ;
"RTN","SAMICTT3",775,0)
XSUB(var,vals,dict,valdx) ; dictionary value defined by var
"RTN","SAMICTT3",776,0)
 ;
"RTN","SAMICTT3",777,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT3",778,0)
 n zdx s zdx=$g(valdx)
"RTN","SAMICTT3",779,0)
 i zdx="" s zdx=var
"RTN","SAMICTT3",780,0)
 ;
"RTN","SAMICTT3",781,0)
 n zv s zv=$g(@vals@(zdx))
"RTN","SAMICTT3",782,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT3",783,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT3",784,0)
 ;
"RTN","SAMICTT3",785,0)
 n zr s zr=$g(@dict@(var,zv))
"RTN","SAMICTT3",786,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT3",787,0)
 ;
"RTN","SAMICTT3",788,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT3",789,0)
 ;
"RTN","SAMICTT3",790,0)
 ;
"RTN","SAMICTT3",791,0)
 ;
"RTN","SAMICTT3",792,0)
 ;
"RTN","SAMICTT3",793,0)
GENLNL() ;
"RTN","SAMICTT3",794,0)
 ;
"RTN","SAMICTT3",795,0)
 n droot s droot=$$setroot^%wd("form fields - ct evaluation")
"RTN","SAMICTT3",796,0)
 n froot s froot=$na(@droot@("field","B"))
"RTN","SAMICTT3",797,0)
 n lnlist,lnlistt
"RTN","SAMICTT3",798,0)
 n cnt s cnt=0
"RTN","SAMICTT3",799,0)
 n cemlnl s cemlnl="cemlnl"
"RTN","SAMICTT3",800,0)
 f  s cemlnl=$o(@froot@(cemlnl)) q:cemlnl=""  q:cemlnl'["cemlnl"  d  ;
"RTN","SAMICTT3",801,0)
 . w !,cemlnl
"RTN","SAMICTT3",802,0)
 . s cnt=cnt+1
"RTN","SAMICTT3",803,0)
 . n fien s fien=$o(@froot@(cemlnl,""))
"RTN","SAMICTT3",804,0)
 . q:fien=""
"RTN","SAMICTT3",805,0)
 . ;
"RTN","SAMICTT3",806,0)
 . ;zwr @droot@("field",fien,"input",1,*)
"RTN","SAMICTT3",807,0)
 . n lbl
"RTN","SAMICTT3",808,0)
 . s lbl=$g(@droot@("field",fien,"input",1,"label"))
"RTN","SAMICTT3",809,0)
 . ;s lbl=$p(lbl,": ",2)
"RTN","SAMICTT3",810,0)
 . ;s lbl=$$LOWC^SAMICTT3(lbl)
"RTN","SAMICTT3",811,0)
 . n norder,dec
"RTN","SAMICTT3",812,0)
 . s dec=0
"RTN","SAMICTT3",813,0)
 . s norder=$g(@droot@("field",fien,"input",1,"value"))
"RTN","SAMICTT3",814,0)
 . i $e(norder,1)'="N" w !,"N error!!" ;b
"RTN","SAMICTT3",815,0)
 . s norder=$e(norder,2,$l(norder))
"RTN","SAMICTT3",816,0)
 . i $e(norder,$l(norder))="L" d  ;
"RTN","SAMICTT3",817,0)
 . . s dec=0
"RTN","SAMICTT3",818,0)
 . . s norder=$e(norder,1,$l(norder)-1)
"RTN","SAMICTT3",819,0)
 . . q
"RTN","SAMICTT3",820,0)
 . i $e(norder,$l(norder))="R" d  ;
"RTN","SAMICTT3",821,0)
 . . s dec=.5
"RTN","SAMICTT3",822,0)
 . . s norder=$e(norder,1,$l(norder)-1)
"RTN","SAMICTT3",823,0)
 . . q
"RTN","SAMICTT3",824,0)
 . i $e(norder,$l(norder))="A" d  ;
"RTN","SAMICTT3",825,0)
 . . s dec=0
"RTN","SAMICTT3",826,0)
 . . s norder=$e(norder,1,$l(norder)-1)
"RTN","SAMICTT3",827,0)
 . . q
"RTN","SAMICTT3",828,0)
 . i $e(norder,$l(norder))="P" d  ;
"RTN","SAMICTT3",829,0)
 . . s dec=.5
"RTN","SAMICTT3",830,0)
 . . s norder=$e(norder,1,$l(norder)-1)
"RTN","SAMICTT3",831,0)
 . . q
"RTN","SAMICTT3",832,0)
 . s norder=norder+dec
"RTN","SAMICTT3",833,0)
 . w !,lbl," ",norder
"RTN","SAMICTT3",834,0)
 . s lnlist(norder)=cemlnl
"RTN","SAMICTT3",835,0)
 . s lnlistt(norder)=lbl
"RTN","SAMICTT3",836,0)
 . q
"RTN","SAMICTT3",837,0)
 ;
"RTN","SAMICTT3",838,0)
 zwr lnlist
"RTN","SAMICTT3",839,0)
 zwr lnlistt
"RTN","SAMICTT3",840,0)
 w !," set lnlcnt="_cnt
"RTN","SAMICTT3",841,0)
 n i s i=""
"RTN","SAMICTT3",842,0)
 f  s i=$o(lnlist(i)) q:i=""  w !," set lnlist(",i,")=""",lnlist(i),""""
"RTN","SAMICTT3",843,0)
 w !," ;"
"RTN","SAMICTT3",844,0)
 f  s i=$o(lnlistt(i)) q:i=""  w !," set lnlistt(",i,")=""",lnlistt(i),""""
"RTN","SAMICTT3",845,0)
 ;
"RTN","SAMICTT3",846,0)
 quit  ; end of GENLNL
"RTN","SAMICTT3",847,0)
 ;
"RTN","SAMICTT3",848,0)
 ;
"RTN","SAMICTT3",849,0)
 ;
"RTN","SAMICTT3",850,0)
EOR ; end of routine SAMICTT3
"RTN","SAMICTT4")
0^5^B62798123^B54435090
"RTN","SAMICTT4",1,0)
SAMICTT4 ;ven/gpl - ctreport text breast abnorm; 2024-09-24t15:33z
"RTN","SAMICTT4",2,0)
 ;;18.0;SAMI;**4,10,19**;2020-01-17;Build 1
"RTN","SAMICTT4",3,0)
 ;mdc-e1;SAMICTT4-20240924-E25ZW78;SAMI-18-19-b1
"RTN","SAMICTT4",4,0)
 ;mdc-v7;B62798123;SAMI*18.0*19 SEQ #19
"RTN","SAMICTT4",5,0)
 ;
"RTN","SAMICTT4",6,0)
 ; SAMICTT4 creates the Breast Abnormalities section of the ELCAP CT
"RTN","SAMICTT4",7,0)
 ; Report in text format.
"RTN","SAMICTT4",8,0)
 ;
"RTN","SAMICTT4",9,0)
 quit  ; no entry from top
"RTN","SAMICTT4",10,0)
 ;
"RTN","SAMICTT4",11,0)
 ;
"RTN","SAMICTT4",12,0)
 ;
"RTN","SAMICTT4",13,0)
 ;
"RTN","SAMICTT4",14,0)
 ;@section 0 primary development
"RTN","SAMICTT4",15,0)
 ;
"RTN","SAMICTT4",16,0)
 ;
"RTN","SAMICTT4",17,0)
 ;
"RTN","SAMICTT4",18,0)
 ;
"RTN","SAMICTT4",19,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT4",20,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT4",21,0)
 ;
"RTN","SAMICTT4",22,0)
 ;@contents
"RTN","SAMICTT4",23,0)
 ;
"RTN","SAMICTT4",24,0)
 ; BREAST breast abnormalities section of ct report text
"RTN","SAMICTT4",25,0)
 ; OUT output ct report line
"RTN","SAMICTT4",26,0)
 ; HOUT output ct report header line
"RTN","SAMICTT4",27,0)
 ; $$XVAL patient value for var
"RTN","SAMICTT4",28,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTT4",29,0)
 ;
"RTN","SAMICTT4",30,0)
 ;
"RTN","SAMICTT4",31,0)
 ;
"RTN","SAMICTT4",32,0)
 ;
"RTN","SAMICTT4",33,0)
 ;@section 1 BREAST & related subroutines
"RTN","SAMICTT4",34,0)
 ;
"RTN","SAMICTT4",35,0)
 ;
"RTN","SAMICTT4",36,0)
 ;
"RTN","SAMICTT4",37,0)
 ;
"RTN","SAMICTT4",38,0)
 ;@proc BREAST
"RTN","SAMICTT4",39,0)
 ;
"RTN","SAMICTT4",40,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT4",41,0)
 ;
"RTN","SAMICTT4",42,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT4",43,0)
 ;@called-by
"RTN","SAMICTT4",44,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT4",45,0)
 ;@calls
"RTN","SAMICTT4",46,0)
 ; $$XVAL
"RTN","SAMICTT4",47,0)
 ; OUT
"RTN","SAMICTT4",48,0)
 ; $$CCMSTR^SAMICTR3
"RTN","SAMICTT4",49,0)
 ; $$XSUB
"RTN","SAMICTT4",50,0)
 ; $$LOWC^SAMICTR3
"RTN","SAMICTT4",51,0)
 ;@input
"RTN","SAMICTT4",52,0)
 ; rtn
"RTN","SAMICTT4",53,0)
 ; vals
"RTN","SAMICTT4",54,0)
 ; dict
"RTN","SAMICTT4",55,0)
 ;@output
"RTN","SAMICTT4",56,0)
 ; create breast abnormalities section of ct report text
"RTN","SAMICTT4",57,0)
 ;
"RTN","SAMICTT4",58,0)
 ;
"RTN","SAMICTT4",59,0)
BREAST(rtn,vals,dict) ; breast abnormalities section of ct report text
"RTN","SAMICTT4",60,0)
 ;
"RTN","SAMICTT4",61,0)
 ; repgen6
"RTN","SAMICTT4",62,0)
 ;
"RTN","SAMICTT4",63,0)
 n sp1 s sp1="  "
"RTN","SAMICTT4",64,0)
 n outmode s outmode="hold"
"RTN","SAMICTT4",65,0)
 n line s line=""
"RTN","SAMICTT4",66,0)
 n destr s destr="is seen"
"RTN","SAMICTT4",67,0)
 n sba s sba=0
"RTN","SAMICTT4",68,0)
 ;   # Breast Abnormalities
"RTN","SAMICTT4",69,0)
 n bd s bd=0
"RTN","SAMICTT4",70,0)
 n brt s brt=0
"RTN","SAMICTT4",71,0)
 n blt s blt=0
"RTN","SAMICTT4",72,0)
 if $$XVAL("ceobard",vals)'="-" s brt=$$XVAL("ceobard",vals)
"RTN","SAMICTT4",73,0)
 if $$XVAL("ceobald",vals)'="-" s brt=$$XVAL("ceobald",vals)
"RTN","SAMICTT4",74,0)
 if blt'=0!(brt'=0) d  ;
"RTN","SAMICTT4",75,0)
 . d OUT("Breast: ")
"RTN","SAMICTT4",76,0)
 . s bd=1
"RTN","SAMICTT4",77,0)
 . q
"RTN","SAMICTT4",78,0)
 s outmode="hold"
"RTN","SAMICTT4",79,0)
 ;
"RTN","SAMICTT4",80,0)
 if $$XVAL("ceara",vals)="y" d  ; our substitute for ceoba, which is null
"RTN","SAMICTT4",81,0)
 . if bd=0 d OUT("Breast:")
"RTN","SAMICTT4",82,0)
 . if $$XVAL("ceara",vals)="y" d  ;
"RTN","SAMICTT4",83,0)
 . . set sba=1
"RTN","SAMICTT4",84,0)
 . . n br set br=$$CCMSTR^SAMICTR3("ceobarc^ceobary^ceobarm",vals)
"RTN","SAMICTT4",85,0)
 . . if br="" d OUT("Noted in right breast: ")
"RTN","SAMICTT4",86,0)
 . . if br]"" d OUT(br_" right breast. ")
"RTN","SAMICTT4",87,0)
 . . d OUT($$XVAL("ceobaros",vals))
"RTN","SAMICTT4",88,0)
 . . q
"RTN","SAMICTT4",89,0)
 . q
"RTN","SAMICTT4",90,0)
 ;
"RTN","SAMICTT4",91,0)
 if $$XVAL("ceafa",vals)="y" d  ; our substitute for ceoba, which is null
"RTN","SAMICTT4",92,0)
 . if bd=0 d OUT("Breast:")
"RTN","SAMICTT4",93,0)
 . if $$XVAL("ceafa",vals)="y" d  ;
"RTN","SAMICTT4",94,0)
 . . set sba=1
"RTN","SAMICTT4",95,0)
 . . n br set br=$$CCMSTR^SAMICTR3("ceobafc^ceobafy^ceobafm",vals)
"RTN","SAMICTT4",96,0)
 . . if br="" d OUT("Noted in left breast: ")
"RTN","SAMICTT4",97,0)
 . . if br]"" d OUT(br_" left breast. ")
"RTN","SAMICTT4",98,0)
 . . d OUT($$XVAL("ceobafos",vals))
"RTN","SAMICTT4",99,0)
 . . q
"RTN","SAMICTT4",100,0)
 . q
"RTN","SAMICTT4",101,0)
 ;
"RTN","SAMICTT4",102,0)
 if bd=1 d  ;
"RTN","SAMICTT4",103,0)
 . if blt=brt d OUT("Density: "_$$XSUB("ceobad",vals,dict,"ceobald"))
"RTN","SAMICTT4",104,0)
 . else  d OUT("Density: Left "_$$XSUB("ceobad",vals,dict,"ceobald")_", Right "_$$XSUB("ceobad",vals,dict,"ceobard")_". ")
"RTN","SAMICTT4",105,0)
 . q
"RTN","SAMICTT4",106,0)
 ;
"RTN","SAMICTT4",107,0)
 if $$XVAL("ceobrc",vals)]"" d  ;
"RTN","SAMICTT4",108,0)
 . if sba=0,bd=0 d OUT("Breast: ")
"RTN","SAMICTT4",109,0)
 . d OUT($$XVAL("ceobrc",vals))
"RTN","SAMICTT4",110,0)
 . q
"RTN","SAMICTT4",111,0)
 else  if sba=1 d OUT("")
"RTN","SAMICTT4",112,0)
 s outmode="go"
"RTN","SAMICTT4",113,0)
 d OUT("")
"RTN","SAMICTT4",114,0)
 ;
"RTN","SAMICTT4",115,0)
 ;
"RTN","SAMICTT4",116,0)
 s outmode="hold"
"RTN","SAMICTT4",117,0)
 d OUT("Abdomen: ")
"RTN","SAMICTT4",118,0)
 n yesaa s yesaa=0
"RTN","SAMICTT4",119,0)
 ;  # Special Handling for the gallbladder
"RTN","SAMICTT4",120,0)
 ;
"RTN","SAMICTT4",121,0)
 if $$XVAL("ceaga",vals)="y" d  ;
"RTN","SAMICTT4",122,0)
 . d OUT(sp1_"Limited view of the upper abdomen reveals the following: ")
"RTN","SAMICTT4",123,0)
 . set yesaa=1
"RTN","SAMICTT4",124,0)
 . if $$XVAL("ceagh",vals)="h" d  ;
"RTN","SAMICTT4",125,0)
 . . d OUT(sp1_"status post cholecystectomy. ")
"RTN","SAMICTT4",126,0)
 . . q
"RTN","SAMICTT4",127,0)
 . if $$XVAL("ceags",vals)="s" d  ;
"RTN","SAMICTT4",128,0)
 . . d OUT(sp1_"Gallstones are noted. ")
"RTN","SAMICTT4",129,0)
 . . q
"RTN","SAMICTT4",130,0)
 . if $$XVAL("ceagl",vals)="l" d  ;
"RTN","SAMICTT4",131,0)
 . . d OUT(sp1_"Sludge is seen in the gall bladder. ")
"RTN","SAMICTT4",132,0)
 . . q
"RTN","SAMICTT4",133,0)
 . if $$XVAL("ceago",vals)="y" d  ;
"RTN","SAMICTT4",134,0)
 . . d OUT(sp1_"An abnormality was noted in the gall bladder: ")
"RTN","SAMICTT4",135,0)
 . . q
"RTN","SAMICTT4",136,0)
 . q
"RTN","SAMICTT4",137,0)
 ;
"RTN","SAMICTT4",138,0)
 if $$XVAL("ceagos",vals)]"" d  ;
"RTN","SAMICTT4",139,0)
 . d OUT($$XVAL("ceagos",vals))
"RTN","SAMICTT4",140,0)
 . q
"RTN","SAMICTT4",141,0)
 ;
"RTN","SAMICTT4",142,0)
 n aalist
"RTN","SAMICTT4",143,0)
 s aalist(1,"spleen",0)=$$XVAL("ceasa",vals)
"RTN","SAMICTT4",144,0)
 s aalist(1,"spleen",1)="ceasc^ceasy^ceasm"
"RTN","SAMICTT4",145,0)
 s aalist(1,"spleen",2)=$$XVAL("ceasos",vals)
"RTN","SAMICTT4",146,0)
 s aalist(2,"liver",0)=$$XVAL("ceala",vals)
"RTN","SAMICTT4",147,0)
 s aalist(2,"liver",1)="cealc^cealy^cealm"
"RTN","SAMICTT4",148,0)
 s aalist(2,"liver",2)=$$XVAL("cealos",vals)
"RTN","SAMICTT4",149,0)
 s aalist(3,"pancreas",0)=$$XVAL("ceapa",vals)
"RTN","SAMICTT4",150,0)
 s aalist(3,"pancreas",1)="ceapc^ceapy^ceapm"
"RTN","SAMICTT4",151,0)
 s aalist(3,"pancreas",2)=$$XVAL("ceapos",vals)
"RTN","SAMICTT4",152,0)
 s aalist(4,"adrenals",0)=$$XVAL("ceaaa",vals)
"RTN","SAMICTT4",153,0)
 s aalist(4,"adrenals",1)="ceaac^ceaay^ceaam"
"RTN","SAMICTT4",154,0)
 s aalist(4,"adrenals",2)=$$XVAL("ceaaos",vals)
"RTN","SAMICTT4",155,0)
 s aalist(5,"kidneys",0)=$$XVAL("ceaka",vals)
"RTN","SAMICTT4",156,0)
 s aalist(5,"kidneys",1)="ceakc^ceaky^ceakm"
"RTN","SAMICTT4",157,0)
 s aalist(5,"kidneys",2)=$$XVAL("ceakos",vals)
"RTN","SAMICTT4",158,0)
 ;
"RTN","SAMICTT4",159,0)
 n zaa s zaa=""
"RTN","SAMICTT4",160,0)
 n zan
"RTN","SAMICTT4",161,0)
 f zan=1:1:5  d  ;
"RTN","SAMICTT4",162,0)
 . s zaa=$o(aalist(zan,""))
"RTN","SAMICTT4",163,0)
 . if aalist(zan,zaa,0)="y" d  ;
"RTN","SAMICTT4",164,0)
 . . n zout s zout=$$CCMSTR^SAMICTR3(aalist(zan,zaa,1),vals)
"RTN","SAMICTT4",165,0)
 . . set yesaa=1
"RTN","SAMICTT4",166,0)
 . . if zout="" d  ;
"RTN","SAMICTT4",167,0)
 . . . ;d OUT(aalist(zan,zaa,2))
"RTN","SAMICTT4",168,0)
 . . . if aalist(zan,zaa,2)'="" d OUT(aalist(zan,zaa,2))
"RTN","SAMICTT4",169,0)
 . . . q
"RTN","SAMICTT4",170,0)
 . . if zout]"" d  ;
"RTN","SAMICTT4",171,0)
 . . . d OUT(sp1_"A "_$$LOWC^SAMICTR3(zout)_" "_zaa_". "_aalist(zan,zaa,2))
"RTN","SAMICTT4",172,0)
 . . . q
"RTN","SAMICTT4",173,0)
 . . q
"RTN","SAMICTT4",174,0)
 . q
"RTN","SAMICTT4",175,0)
 ;
"RTN","SAMICTT4",176,0)
 ;# Other Abdominal Abnormalities
"RTN","SAMICTT4",177,0)
 ;
"RTN","SAMICTT4",178,0)
 if $$XVAL("ceaoab",vals)]"" d  ;
"RTN","SAMICTT4",179,0)
 . d OUT($$XVAL("ceaoab",vals)_". ")
"RTN","SAMICTT4",180,0)
 . q
"RTN","SAMICTT4",181,0)
 if yesaa=0  d  ;
"RTN","SAMICTT4",182,0)
 . ;d OUT(sp1_"Limited view of the upper abdomen reveals no abnormalities. ")
"RTN","SAMICTT4",183,0)
 . d OUT(sp1_"Limited view of the upper abdomen reveals nothing remarkable. ")
"RTN","SAMICTT4",184,0)
 . q
"RTN","SAMICTT4",185,0)
 ;
"RTN","SAMICTT4",186,0)
 ;
"RTN","SAMICTT4",187,0)
 ;# Other Chest Abnormalities
"RTN","SAMICTT4",188,0)
 ;
"RTN","SAMICTT4",189,0)
 if $$XVAL("ceotab",vals)]"" d
"RTN","SAMICTT4",190,0)
 . d OUT("Other chest abnormalities:")
"RTN","SAMICTT4",191,0)
 . d OUT($$XVAL("ceotab",vals)_". ")
"RTN","SAMICTT4",192,0)
 . q
"RTN","SAMICTT4",193,0)
 ;
"RTN","SAMICTT4",194,0)
 s outmode="go"
"RTN","SAMICTT4",195,0)
 d OUT("")
"RTN","SAMICTT4",196,0)
 ;
"RTN","SAMICTT4",197,0)
 ;# Bone Abnormalities
"RTN","SAMICTT4",198,0)
 ;
"RTN","SAMICTT4",199,0)
 s outmode="hold"
"RTN","SAMICTT4",200,0)
 if $$XVAL("ceaoabb",vals)]"" d  ;
"RTN","SAMICTT4",201,0)
 . d OUT("Bone:")
"RTN","SAMICTT4",202,0)
 . d OUT($$XVAL("ceaoabb",vals)_para)
"RTN","SAMICTT4",203,0)
 . q
"RTN","SAMICTT4",204,0)
 ;
"RTN","SAMICTT4",205,0)
 d  ;
"RTN","SAMICTT4",206,0)
 . q  ; LungRADS moved to SAMICTRA
"RTN","SAMICTT4",207,0)
 . n lradModifiers
"RTN","SAMICTT4",208,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTT4",209,0)
 . ;
"RTN","SAMICTT4",210,0)
 . i $$XVAL("celrad",vals)'="-",$$XVAL("celrad",vals)]"" d  ;
"RTN","SAMICTT4",211,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTT4",212,0)
 . . d OUT("")
"RTN","SAMICTT4",213,0)
 . . q
"RTN","SAMICTT4",214,0)
 . q
"RTN","SAMICTT4",215,0)
 s outmode="go"
"RTN","SAMICTT4",216,0)
 d OUT("")
"RTN","SAMICTT4",217,0)
 ;
"RTN","SAMICTT4",218,0)
 quit  ; end of BREAST
"RTN","SAMICTT4",219,0)
 ;
"RTN","SAMICTT4",220,0)
 ;
"RTN","SAMICTT4",221,0)
 ;
"RTN","SAMICTT4",222,0)
 ;
"RTN","SAMICTT4",223,0)
 ;@proc OUT
"RTN","SAMICTT4",224,0)
 ;
"RTN","SAMICTT4",225,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT4",226,0)
 ;
"RTN","SAMICTT4",227,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT4",228,0)
 ;@called-by
"RTN","SAMICTT4",229,0)
 ; BREAST
"RTN","SAMICTT4",230,0)
 ;@calls none
"RTN","SAMICTT4",231,0)
 ;@input
"RTN","SAMICTT4",232,0)
 ; ln = output to add
"RTN","SAMICTT4",233,0)
 ; ]rtn output array
"RTN","SAMICTT4",234,0)
 ; ]debug
"RTN","SAMICTT4",235,0)
 ;@thruput
"RTN","SAMICTT4",236,0)
 ; cnt
"RTN","SAMICTT4",237,0)
 ;@output
"RTN","SAMICTT4",238,0)
 ; line added to ct report
"RTN","SAMICTT4",239,0)
 ;
"RTN","SAMICTT4",240,0)
 ;
"RTN","SAMICTT4",241,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT4",242,0)
 ;
"RTN","SAMICTT4",243,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT4",244,0)
 s cnt=cnt+1
"RTN","SAMICTT4",245,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT4",246,0)
 n lnn s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT4",247,0)
 i outmode="go" d  ;
"RTN","SAMICTT4",248,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT4",249,0)
 . s line=""
"RTN","SAMICTT4",250,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT4",251,0)
 . q
"RTN","SAMICTT4",252,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT4",253,0)
 ;
"RTN","SAMICTT4",254,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT4",255,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT4",256,0)
 . n zs s zs=$STACK
"RTN","SAMICTT4",257,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT4",258,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT4",259,0)
 . q
"RTN","SAMICTT4",260,0)
 ;
"RTN","SAMICTT4",261,0)
 quit  ; end of OUT
"RTN","SAMICTT4",262,0)
 ;
"RTN","SAMICTT4",263,0)
 ;
"RTN","SAMICTT4",264,0)
 ;
"RTN","SAMICTT4",265,0)
 ;
"RTN","SAMICTT4",266,0)
 ;@proc HOUT
"RTN","SAMICTT4",267,0)
 ;
"RTN","SAMICTT4",268,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT4",269,0)
 ;
"RTN","SAMICTT4",270,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT4",271,0)
 ;@called-by none
"RTN","SAMICTT4",272,0)
 ;@calls
"RTN","SAMICTT4",273,0)
 ; OUT
"RTN","SAMICTT4",274,0)
 ;@input
"RTN","SAMICTT4",275,0)
 ; ln = header output to add
"RTN","SAMICTT4",276,0)
 ; ]rtn output array
"RTN","SAMICTT4",277,0)
 ;@output
"RTN","SAMICTT4",278,0)
 ; header line added to ct report
"RTN","SAMICTT4",279,0)
 ;
"RTN","SAMICTT4",280,0)
 ;
"RTN","SAMICTT4",281,0)
HOUT(ln) ; output ct report header line
"RTN","SAMICTT4",282,0)
 ;
"RTN","SAMICTT4",283,0)
 d OUT(ln)
"RTN","SAMICTT4",284,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT4",285,0)
 ;
"RTN","SAMICTT4",286,0)
 quit  ; end of HOUT
"RTN","SAMICTT4",287,0)
 ;
"RTN","SAMICTT4",288,0)
 ;
"RTN","SAMICTT4",289,0)
 ;
"RTN","SAMICTT4",290,0)
 ;
"RTN","SAMICTT4",291,0)
 ;@func $$XVAL
"RTN","SAMICTT4",292,0)
 ;
"RTN","SAMICTT4",293,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT4",294,0)
 ;
"RTN","SAMICTT4",295,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT4",296,0)
 ;@called-by
"RTN","SAMICTT4",297,0)
 ; BREAST
"RTN","SAMICTT4",298,0)
 ;@calls none
"RTN","SAMICTT4",299,0)
 ;@input
"RTN","SAMICTT4",300,0)
 ; var
"RTN","SAMICTT4",301,0)
 ; vals is passed by name
"RTN","SAMICTT4",302,0)
 ;@output = patient value for var
"RTN","SAMICTT4",303,0)
 ;
"RTN","SAMICTT4",304,0)
 ;
"RTN","SAMICTT4",305,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT4",306,0)
 ;
"RTN","SAMICTT4",307,0)
 n zr s zr=$g(@vals@(var))
"RTN","SAMICTT4",308,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT4",309,0)
 ;
"RTN","SAMICTT4",310,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT4",311,0)
 ;
"RTN","SAMICTT4",312,0)
 ;
"RTN","SAMICTT4",313,0)
 ;
"RTN","SAMICTT4",314,0)
 ;
"RTN","SAMICTT4",315,0)
 ;@func $$XSUB
"RTN","SAMICTT4",316,0)
 ;
"RTN","SAMICTT4",317,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT4",318,0)
 ;
"RTN","SAMICTT4",319,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT4",320,0)
 ;@called-by
"RTN","SAMICTT4",321,0)
 ; BREAST
"RTN","SAMICTT4",322,0)
 ;@calls none
"RTN","SAMICTT4",323,0)
 ;@input
"RTN","SAMICTT4",324,0)
 ; var
"RTN","SAMICTT4",325,0)
 ; vals & dict are passed by name
"RTN","SAMICTT4",326,0)
 ; valdx is used for nodules ala cect2co with nodule # included
"RTN","SAMICTT4",327,0)
 ;@output = dictionary value for var
"RTN","SAMICTT4",328,0)
 ;
"RTN","SAMICTT4",329,0)
 ;
"RTN","SAMICTT4",330,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT4",331,0)
 ;
"RTN","SAMICTT4",332,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT4",333,0)
 n zdx s zdx=$g(valdx)
"RTN","SAMICTT4",334,0)
 i zdx="" s zdx=var
"RTN","SAMICTT4",335,0)
 ;
"RTN","SAMICTT4",336,0)
 n zv s zv=$g(@vals@(zdx))
"RTN","SAMICTT4",337,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT4",338,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT4",339,0)
 ;
"RTN","SAMICTT4",340,0)
 n zr s zr=$g(@dict@(var,zv))
"RTN","SAMICTT4",341,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT4",342,0)
 ;
"RTN","SAMICTT4",343,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT4",344,0)
 ;
"RTN","SAMICTT4",345,0)
 ;
"RTN","SAMICTT4",346,0)
 ;
"RTN","SAMICTT4",347,0)
EOR ; end of routine SAMICTT4
"RTN","SAMICTT9")
0^6^B30422718^B17246420
"RTN","SAMICTT9",1,0)
SAMICTT9 ;ven/gpl - ctreport text impressions; 2024-09-24t15:05z
"RTN","SAMICTT9",2,0)
 ;;18.0;SAMI;**4,10,19**;2020-01-17;Build 1
"RTN","SAMICTT9",3,0)
 ;mdc-e1;SAMICTT9-20240924-E1zMgz6;SAMI-18-19-b1
"RTN","SAMICTT9",4,0)
 ;mdc-v7;B30422718;SAMI*18.0*19 SEQ #19
"RTN","SAMICTT9",5,0)
 ;
"RTN","SAMICTT9",6,0)
 ; SAMICTT9 creates the Impressions section of the ELCAP CT Report in
"RTN","SAMICTT9",7,0)
 ; text format.
"RTN","SAMICTT9",8,0)
 ;
"RTN","SAMICTT9",9,0)
 quit  ; no entry from top
"RTN","SAMICTT9",10,0)
 ;
"RTN","SAMICTT9",11,0)
 ;
"RTN","SAMICTT9",12,0)
 ;
"RTN","SAMICTT9",13,0)
 ;
"RTN","SAMICTT9",14,0)
 ;@section 0 primary development
"RTN","SAMICTT9",15,0)
 ;
"RTN","SAMICTT9",16,0)
 ;
"RTN","SAMICTT9",17,0)
 ;
"RTN","SAMICTT9",18,0)
 ;
"RTN","SAMICTT9",19,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT9",20,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT9",21,0)
 ;
"RTN","SAMICTT9",22,0)
 ;@contents
"RTN","SAMICTT9",23,0)
 ;
"RTN","SAMICTT9",24,0)
 ; IMPRSN impressions section of ctreport text format
"RTN","SAMICTT9",25,0)
 ; OUT output ct report line
"RTN","SAMICTT9",26,0)
 ; HOUT output ct report header line
"RTN","SAMICTT9",27,0)
 ; $$XVAL patient value for var
"RTN","SAMICTT9",28,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTT9",29,0)
 ;
"RTN","SAMICTT9",30,0)
 ;
"RTN","SAMICTT9",31,0)
 ;
"RTN","SAMICTT9",32,0)
 ;
"RTN","SAMICTT9",33,0)
 ;@section 1 IMPRSN & related subroutines
"RTN","SAMICTT9",34,0)
 ;
"RTN","SAMICTT9",35,0)
 ;
"RTN","SAMICTT9",36,0)
 ;
"RTN","SAMICTT9",37,0)
 ;
"RTN","SAMICTT9",38,0)
 ;@proc IMPRSN
"RTN","SAMICTT9",39,0)
 ;
"RTN","SAMICTT9",40,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT9",41,0)
 ;
"RTN","SAMICTT9",42,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT9",43,0)
 ;@called-by
"RTN","SAMICTT9",44,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT9",45,0)
 ;@calls
"RTN","SAMICTT9",46,0)
 ; OUT
"RTN","SAMICTT9",47,0)
 ; $$XSUB
"RTN","SAMICTT9",48,0)
 ; $$XVAL
"RTN","SAMICTT9",49,0)
 ;@input
"RTN","SAMICTT9",50,0)
 ; rtn
"RTN","SAMICTT9",51,0)
 ; vals
"RTN","SAMICTT9",52,0)
 ; dict
"RTN","SAMICTT9",53,0)
 ;@output
"RTN","SAMICTT9",54,0)
 ; create impressions section of ct report in text format
"RTN","SAMICTT9",55,0)
 ;
"RTN","SAMICTT9",56,0)
 ;
"RTN","SAMICTT9",57,0)
IMPRSN(rtn,vals,dict) ; impressions section of ctreport text format
"RTN","SAMICTT9",58,0)
 ;
"RTN","SAMICTT9",59,0)
 ; repgen13
"RTN","SAMICTT9",60,0)
 ;
"RTN","SAMICTT9",61,0)
 ; # Impression
"RTN","SAMICTT9",62,0)
 ;d OUT("</TD></TR></TABLE><TR><TD>")
"RTN","SAMICTT9",63,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT9",64,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT9",65,0)
 ;d OUT("<!-- impression -->")
"RTN","SAMICTT9",66,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTT9",67,0)
 ;d OUT("<FONT SIZE=""+2"">")
"RTN","SAMICTT9",68,0)
 ;d OUT("<B>IMPRESSION:</B>")
"RTN","SAMICTT9",69,0)
 ;d OUT("</FONT>")
"RTN","SAMICTT9",70,0)
 ;d OUT("</TD></TR><TR><TD><TABLE>")
"RTN","SAMICTT9",71,0)
 ;d OUT("<TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTT9",72,0)
 d OUT("")
"RTN","SAMICTT9",73,0)
 d OUT("IMPRESSION:")
"RTN","SAMICTT9",74,0)
 d OUT("")
"RTN","SAMICTT9",75,0)
 ;
"RTN","SAMICTT9",76,0)
 d OUT($$XSUB("ceimn",vals,dict)_para)
"RTN","SAMICTT9",77,0)
 ;
"RTN","SAMICTT9",78,0)
 ;# Report CAC Score and Extent of Emphysema
"RTN","SAMICTT9",79,0)
 s cacval=0
"RTN","SAMICTT9",80,0)
 d  ;if $$XVAL("ceccv",vals)'="e" d  ;
"RTN","SAMICTT9",81,0)
 . set vcac=$$XVAL("cecccac",vals)
"RTN","SAMICTT9",82,0)
 . if vcac]"" d  ;
"RTN","SAMICTT9",83,0)
 . . s cacrec=""
"RTN","SAMICTT9",84,0)
 . . s cac="The Visual Coronary Artery Calcium (CAC) Score is "_vcac_". "
"RTN","SAMICTT9",85,0)
 . . s cacval=vcac
"RTN","SAMICTT9",86,0)
 . . i cacval>3 s cacrec=$g(@dict@("CAC_recommendation"))_para
"RTN","SAMICTT9",87,0)
 . . q
"RTN","SAMICTT9",88,0)
 . q
"RTN","SAMICTT9",89,0)
 ;
"RTN","SAMICTT9",90,0)
 ;i cacval>0 d  ;
"RTN","SAMICTT9",91,0)
 d  ;
"RTN","SAMICTT9",92,0)
 . d OUT("")
"RTN","SAMICTT9",93,0)
 . ;d OUT(cac_" "_cacrec_" ") d OUT("")
"RTN","SAMICTT9",94,0)
 . d  ;if $$XVAL("ceemv",vals)="e" d  ;
"RTN","SAMICTT9",95,0)
 . . if $$XVAL("ceem",vals)'="no" d  ;
"RTN","SAMICTT9",96,0)
 . . . if $$XVAL("ceem",vals)="nv" q  ;
"RTN","SAMICTT9",97,0)
 . . . d OUT("Emphysema: "_$$XSUB("ceem",vals,dict)) d OUT("")
"RTN","SAMICTT9",98,0)
 . . . ;d OUT($$XSUB("ceem",vals,dict)_". ") d OUT("")
"RTN","SAMICTT9",99,0)
 . . . q
"RTN","SAMICTT9",100,0)
 . . q
"RTN","SAMICTT9",101,0)
 . i cacval=0 d  ;
"RTN","SAMICTT9",102,0)
 . . d OUT("Coronary Artery Calcifications: None. The Visual Coronary Artery Calcium (CAC) score is 0") d OUT("")
"RTN","SAMICTT9",103,0)
 . . q
"RTN","SAMICTT9",104,0)
 . e  d OUT(cac_" "_cacrec_" ") d OUT("")
"RTN","SAMICTT9",105,0)
 . q
"RTN","SAMICTT9",106,0)
 ;
"RTN","SAMICTT9",107,0)
 i $$XVAL("ceclini",vals)="y" d  ;
"RTN","SAMICTT9",108,0)
 . d OUT($$XVAL("ceclin",vals)_". ") d OUT("")
"RTN","SAMICTT9",109,0)
 . q
"RTN","SAMICTT9",110,0)
 ;
"RTN","SAMICTT9",111,0)
 i $$XVAL("ceoppai",vals)="y" d  ;
"RTN","SAMICTT9",112,0)
 . d OUT($$XVAL("ceoppa",vals)_". ") d OUT("")
"RTN","SAMICTT9",113,0)
 . q
"RTN","SAMICTT9",114,0)
 ;
"RTN","SAMICTT9",115,0)
 i $$XVAL("ceoppabi",vals)="y" d  ;
"RTN","SAMICTT9",116,0)
 . d OUT($$XVAL("ceoppab",vals)_". ") d OUT("")
"RTN","SAMICTT9",117,0)
 . q
"RTN","SAMICTT9",118,0)
 ;
"RTN","SAMICTT9",119,0)
 i $$XVAL("cecommcai",vals)="y" d  ;
"RTN","SAMICTT9",120,0)
 . d OUT($$XVAL("cecommca",vals)_". ") d OUT("")
"RTN","SAMICTT9",121,0)
 . q
"RTN","SAMICTT9",122,0)
 ;
"RTN","SAMICTT9",123,0)
 i $$XVAL("ceotabnmi",vals)="y" d  ;
"RTN","SAMICTT9",124,0)
 . d OUT($$XVAL("ceotabnm",vals)_". ") d OUT("")
"RTN","SAMICTT9",125,0)
 . q
"RTN","SAMICTT9",126,0)
 ;
"RTN","SAMICTT9",127,0)
 i $$XVAL("ceobrci",vals)="y" d  ;
"RTN","SAMICTT9",128,0)
 . d OUT($$XVAL("ceobrc",vals)_". ") d OUT("")
"RTN","SAMICTT9",129,0)
 . q
"RTN","SAMICTT9",130,0)
 ;
"RTN","SAMICTT9",131,0)
 i $$XVAL("ceaoabbi",vals)="y" d  ;
"RTN","SAMICTT9",132,0)
 . d OUT($$XVAL("ceaoabb",vals)_". ") d OUT("")
"RTN","SAMICTT9",133,0)
 . q
"RTN","SAMICTT9",134,0)
 ;
"RTN","SAMICTT9",135,0)
 i $$XVAL("ceaoabi",vals)="y" d  ;
"RTN","SAMICTT9",136,0)
 . d OUT($$XVAL("ceaoab",vals)_". ") d OUT("")
"RTN","SAMICTT9",137,0)
 . q
"RTN","SAMICTT9",138,0)
 ;
"RTN","SAMICTT9",139,0)
 ;# Impression Remarks
"RTN","SAMICTT9",140,0)
 i $$XVAL("ceimre",vals)'="" d  ;
"RTN","SAMICTT9",141,0)
 . d OUT($$XVAL("ceimre",vals)_". ") d OUT("")
"RTN","SAMICTT9",142,0)
 . q
"RTN","SAMICTT9",143,0)
 ;
"RTN","SAMICTT9",144,0)
 n special s special=$S($$XVAL("ceimspr",vals)="y":1,1:0)
"RTN","SAMICTT9",145,0)
 n insuff s insuff=$S($$XVAL("ceimsii",vals)="y":1,1:0)
"RTN","SAMICTT9",146,0)
 i special!insuff d  ;
"RTN","SAMICTT9",147,0)
 . d OUT("")
"RTN","SAMICTT9",148,0)
 . d OUT("SPECIAL HANDLING:")
"RTN","SAMICTT9",149,0)
 . d OUT("")
"RTN","SAMICTT9",150,0)
 . i special d  ;
"RTN","SAMICTT9",151,0)
 . . d OUT("Read requires special attention by attending radiologist")
"RTN","SAMICTT9",152,0)
 . . d OUT("")
"RTN","SAMICTT9",153,0)
 . . q
"RTN","SAMICTT9",154,0)
 . i insuff d  ;
"RTN","SAMICTT9",155,0)
 . . d OUT("Insufficient information for sign off")
"RTN","SAMICTT9",156,0)
 . . d OUT("")
"RTN","SAMICTT9",157,0)
 . . q
"RTN","SAMICTT9",158,0)
 . q
"RTN","SAMICTT9",159,0)
 ;
"RTN","SAMICTT9",160,0)
 quit  ; end of IMPRSN
"RTN","SAMICTT9",161,0)
 ;
"RTN","SAMICTT9",162,0)
 ;
"RTN","SAMICTT9",163,0)
 ;
"RTN","SAMICTT9",164,0)
 ;
"RTN","SAMICTT9",165,0)
 ;@proc OUT
"RTN","SAMICTT9",166,0)
 ;
"RTN","SAMICTT9",167,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT9",168,0)
 ;
"RTN","SAMICTT9",169,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT9",170,0)
 ;@called-by
"RTN","SAMICTT9",171,0)
 ; IMPRSN
"RTN","SAMICTT9",172,0)
 ;@calls none
"RTN","SAMICTT9",173,0)
 ;@input
"RTN","SAMICTT9",174,0)
 ; ln = output to add
"RTN","SAMICTT9",175,0)
 ; ]rtn output array
"RTN","SAMICTT9",176,0)
 ; ]debug
"RTN","SAMICTT9",177,0)
 ;@thruput
"RTN","SAMICTT9",178,0)
 ; cnt
"RTN","SAMICTT9",179,0)
 ;@output
"RTN","SAMICTT9",180,0)
 ; line added to ct report
"RTN","SAMICTT9",181,0)
 ;
"RTN","SAMICTT9",182,0)
 ;
"RTN","SAMICTT9",183,0)
OUT(ln) ; output ct report line
"RTN","SAMICTT9",184,0)
 ;
"RTN","SAMICTT9",185,0)
 ;i $e(ln,$l(ln)-2,$l(ln))=".." s ln=$e(ln,1,$l(ln)-1) ; remove double dots
"RTN","SAMICTT9",186,0)
 i ln[".." s ln=$p(ln,"..")_"."
"RTN","SAMICTT9",187,0)
 s cnt=cnt+1
"RTN","SAMICTT9",188,0)
 ;s debug=1
"RTN","SAMICTT9",189,0)
 n lnn s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT9",190,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT9",191,0)
 ;
"RTN","SAMICTT9",192,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT9",193,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT9",194,0)
 . n zs s zs=$STACK
"RTN","SAMICTT9",195,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT9",196,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT9",197,0)
 . q
"RTN","SAMICTT9",198,0)
 ;
"RTN","SAMICTT9",199,0)
 quit  ; end of OUT
"RTN","SAMICTT9",200,0)
 ;
"RTN","SAMICTT9",201,0)
 ;
"RTN","SAMICTT9",202,0)
 ;
"RTN","SAMICTT9",203,0)
 ;
"RTN","SAMICTT9",204,0)
 ;@proc HOUT
"RTN","SAMICTT9",205,0)
 ;
"RTN","SAMICTT9",206,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT9",207,0)
 ;
"RTN","SAMICTT9",208,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTT9",209,0)
 ;@called-by none
"RTN","SAMICTT9",210,0)
 ;@calls
"RTN","SAMICTT9",211,0)
 ; OUT
"RTN","SAMICTT9",212,0)
 ;@input
"RTN","SAMICTT9",213,0)
 ; ln = header output to add
"RTN","SAMICTT9",214,0)
 ; ]rtn output array
"RTN","SAMICTT9",215,0)
 ;@output
"RTN","SAMICTT9",216,0)
 ; header line added to ct report
"RTN","SAMICTT9",217,0)
 ;
"RTN","SAMICTT9",218,0)
 ;
"RTN","SAMICTT9",219,0)
HOUT(ln) ; output ct report header line
"RTN","SAMICTT9",220,0)
 ;
"RTN","SAMICTT9",221,0)
 d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT9",222,0)
 ;
"RTN","SAMICTT9",223,0)
 quit  ; end of HOUT
"RTN","SAMICTT9",224,0)
 ;
"RTN","SAMICTT9",225,0)
 ;
"RTN","SAMICTT9",226,0)
 ;
"RTN","SAMICTT9",227,0)
 ;
"RTN","SAMICTT9",228,0)
 ;@func $$XVAL
"RTN","SAMICTT9",229,0)
 ;
"RTN","SAMICTT9",230,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT9",231,0)
 ;
"RTN","SAMICTT9",232,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT9",233,0)
 ;@called-by
"RTN","SAMICTT9",234,0)
 ; IMPRSN
"RTN","SAMICTT9",235,0)
 ;@calls none
"RTN","SAMICTT9",236,0)
 ;@input
"RTN","SAMICTT9",237,0)
 ; var
"RTN","SAMICTT9",238,0)
 ; vals is passed by name
"RTN","SAMICTT9",239,0)
 ;@output = patient value for var
"RTN","SAMICTT9",240,0)
 ;
"RTN","SAMICTT9",241,0)
 ;
"RTN","SAMICTT9",242,0)
XVAL(var,vals) ; patient value for var
"RTN","SAMICTT9",243,0)
 ;
"RTN","SAMICTT9",244,0)
 n zr s zr=$g(@vals@(var))
"RTN","SAMICTT9",245,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT9",246,0)
 ;
"RTN","SAMICTT9",247,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT9",248,0)
 ;
"RTN","SAMICTT9",249,0)
 ;
"RTN","SAMICTT9",250,0)
 ;
"RTN","SAMICTT9",251,0)
 ;
"RTN","SAMICTT9",252,0)
 ;@func $$XSUB
"RTN","SAMICTT9",253,0)
 ;
"RTN","SAMICTT9",254,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTT9",255,0)
 ;
"RTN","SAMICTT9",256,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTT9",257,0)
 ;@called-by
"RTN","SAMICTT9",258,0)
 ; IMPRSN
"RTN","SAMICTT9",259,0)
 ;@calls none
"RTN","SAMICTT9",260,0)
 ;@input
"RTN","SAMICTT9",261,0)
 ; var
"RTN","SAMICTT9",262,0)
 ; vals & dict are passed by name
"RTN","SAMICTT9",263,0)
 ; valdx is used for nodules ala cect2co with nodule # included
"RTN","SAMICTT9",264,0)
 ;@output = dictionary value for var
"RTN","SAMICTT9",265,0)
 ;
"RTN","SAMICTT9",266,0)
 ;
"RTN","SAMICTT9",267,0)
XSUB(var,vals,dict,valdx) ; dictionary value defined by var
"RTN","SAMICTT9",268,0)
 ;
"RTN","SAMICTT9",269,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT9",270,0)
 n zdx s zdx=$g(valdx)
"RTN","SAMICTT9",271,0)
 i zdx="" s zdx=var
"RTN","SAMICTT9",272,0)
 ;
"RTN","SAMICTT9",273,0)
 n zv s zv=$g(@vals@(zdx))
"RTN","SAMICTT9",274,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT9",275,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT9",276,0)
 ;
"RTN","SAMICTT9",277,0)
 n zr s zr=$g(@dict@(var,zv))
"RTN","SAMICTT9",278,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT9",279,0)
 ;
"RTN","SAMICTT9",280,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT9",281,0)
 ;
"RTN","SAMICTT9",282,0)
 ;
"RTN","SAMICTT9",283,0)
 ;
"RTN","SAMICTT9",284,0)
EOR ; end of routine SAMICTT9
"RTN","SAMICTTA")
0^7^B49833239^B35698365
"RTN","SAMICTTA",1,0)
SAMICTTA ;ven/gpl - ctreport text recommendations; 2024-09-24t14:31z
"RTN","SAMICTTA",2,0)
 ;;18.0;SAMI;**4,10,11,19**;2020-01-17;Build 1
"RTN","SAMICTTA",3,0)
 ;mdc-e1;SAMICTTA-20240924-E1+hRO+;SAMI-18-19-b1
"RTN","SAMICTTA",4,0)
 ;mdc-v7;B49833239;SAMI*18.0*19 SEQ #19
"RTN","SAMICTTA",5,0)
 ;
"RTN","SAMICTTA",6,0)
 ; SAMICTTA creates the Recommendations section of the ELCAP CT Report
"RTN","SAMICTTA",7,0)
 ; in text format.
"RTN","SAMICTTA",8,0)
 ;
"RTN","SAMICTTA",9,0)
 quit  ; no entry from top
"RTN","SAMICTTA",10,0)
 ;
"RTN","SAMICTTA",11,0)
 ;
"RTN","SAMICTTA",12,0)
 ;
"RTN","SAMICTTA",13,0)
 ;
"RTN","SAMICTTA",14,0)
 ;@section 0 primary development
"RTN","SAMICTTA",15,0)
 ;
"RTN","SAMICTTA",16,0)
 ;
"RTN","SAMICTTA",17,0)
 ;
"RTN","SAMICTTA",18,0)
 ;
"RTN","SAMICTTA",19,0)
 ;@license see routine SAMIUL
"RTN","SAMICTTA",20,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTTA",21,0)
 ;
"RTN","SAMICTTA",22,0)
 ;@contents
"RTN","SAMICTTA",23,0)
 ;
"RTN","SAMICTTA",24,0)
 ; RCMND recommendations section of ctreport in text format
"RTN","SAMICTTA",25,0)
 ; OUT output ct report line
"RTN","SAMICTTA",26,0)
 ; HOUT output ct report header line
"RTN","SAMICTTA",27,0)
 ; $$XVAL patient value for var
"RTN","SAMICTTA",28,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTTA",29,0)
 ;
"RTN","SAMICTTA",30,0)
 ;
"RTN","SAMICTTA",31,0)
 ;
"RTN","SAMICTTA",32,0)
 ;
"RTN","SAMICTTA",33,0)
 ;@section 1 RCMND & related subroutines
"RTN","SAMICTTA",34,0)
 ;
"RTN","SAMICTTA",35,0)
 ;
"RTN","SAMICTTA",36,0)
 ;
"RTN","SAMICTTA",37,0)
 ;
"RTN","SAMICTTA",38,0)
 ;@proc RCMND
"RTN","SAMICTTA",39,0)
 ;
"RTN","SAMICTTA",40,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTTA",41,0)
 ;
"RTN","SAMICTTA",42,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTTA",43,0)
 ;@called-by
"RTN","SAMICTTA",44,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTTA",45,0)
 ;@calls
"RTN","SAMICTTA",46,0)
 ; $$XVAL
"RTN","SAMICTTA",47,0)
 ; OUT
"RTN","SAMICTTA",48,0)
 ; $$XSUB
"RTN","SAMICTTA",49,0)
 ;@input
"RTN","SAMICTTA",50,0)
 ; rtn
"RTN","SAMICTTA",51,0)
 ; vals
"RTN","SAMICTTA",52,0)
 ; dict
"RTN","SAMICTTA",53,0)
 ;@output
"RTN","SAMICTTA",54,0)
 ; create impressions section of ct report in text format
"RTN","SAMICTTA",55,0)
 ;
"RTN","SAMICTTA",56,0)
 ;
"RTN","SAMICTTA",57,0)
RCMND(rtn,vals,dict) ; recommendations section of ctreport text format
"RTN","SAMICTTA",58,0)
 ;
"RTN","SAMICTTA",59,0)
 ; repgen14
"RTN","SAMICTTA",60,0)
 ;
"RTN","SAMICTTA",61,0)
 ;# Recommendation
"RTN","SAMICTTA",62,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",63,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTTA",64,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",65,0)
 ;d OUT("<!-- Recommendation -->")
"RTN","SAMICTTA",66,0)
 ;
"RTN","SAMICTTA",67,0)
 i $$XVAL("cefu",vals)'="nf" d  ; 2445-2450 gpl1
"RTN","SAMICTTA",68,0)
 . ;d OUT("<TR><TD><FONT SIZE=""+2""><B>")
"RTN","SAMICTTA",69,0)
 . ;d OUT("<FONT SIZE=""+2""><B>")
"RTN","SAMICTTA",70,0)
 . d OUT("")
"RTN","SAMICTTA",71,0)
 . d OUT("Recommendations:")
"RTN","SAMICTTA",72,0)
 . d OUT("")
"RTN","SAMICTTA",73,0)
 . ;d OUT("</B></FONT>")
"RTN","SAMICTTA",74,0)
 . ;d OUT("</TD></TR><TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",75,0)
 . q
"RTN","SAMICTTA",76,0)
 ;
"RTN","SAMICTTA",77,0)
 n fuw s fuw=$$XSUB("cefuw",vals,dict)
"RTN","SAMICTTA",78,0)
 ;d OUT("fuw= "_fuw)
"RTN","SAMICTTA",79,0)
 ;d OUT("vals= "_vals)
"RTN","SAMICTTA",80,0)
 ;d OUT(" dict= "_dict)
"RTN","SAMICTTA",81,0)
 ;d OUT($o(@vals@("cefuw","")))
"RTN","SAMICTTA",82,0)
 ;zwr @vals@(*)
"RTN","SAMICTTA",83,0)
 ;zwr @dict@(*)
"RTN","SAMICTTA",84,0)
 ;i fuw="" d  ;
"RTN","SAMICTTA",85,0)
 ;. d OUT(para_"<B>"_$$XSUB("cefu",vals,dict)_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",86,0)
 ;e  d  ;
"RTN","SAMICTTA",87,0)
 ;. d OUT(para_"<B>"_$$XSUB("cefu",vals,dict)_" "_fuw_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",88,0)
 ;
"RTN","SAMICTTA",89,0)
 ; request 9/17/2024 to handle Annual followup differently from 
"RTN","SAMICTTA",90,0)
 ; other followup
"RTN","SAMICTTA",91,0)
 i $$XVAL("cefuw",vals)="1y" d  ; it is an annual followup
"RTN","SAMICTTA",92,0)
 . ;d OUT(para_"<B>A followup CT scan is recommended on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",93,0)
 . i $$XVAL("cefud",vals)="" d  q  ; no date given
"RTN","SAMICTTA",94,0)
 . . d OUT("An annual CT scan is recommended. ") d OUT("")
"RTN","SAMICTTA",95,0)
 . . q
"RTN","SAMICTTA",96,0)
 . e  d OUT("An annual CT scan is recommended on "_$$XVAL("cefud",vals)_". ") d OUT("")
"RTN","SAMICTTA",97,0)
 . q
"RTN","SAMICTTA",98,0)
 ; 
"RTN","SAMICTTA",99,0)
 i $$XVAL("cefuw",vals)'="1y" d  ;
"RTN","SAMICTTA",100,0)
 . i fuw="" d  ;
"RTN","SAMICTTA",101,0)
 . . ;d OUT(para_"<B>A followup CT scan is recommended on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",102,0)
 . . i $$XVAL("cefud",vals)="" q  ; no date given
"RTN","SAMICTTA",103,0)
 . . d OUT("A follow-up CT scan is recommended on "_$$XVAL("cefud",vals)_". ") d OUT("")
"RTN","SAMICTTA",104,0)
 . . q
"RTN","SAMICTTA",105,0)
 . e  d  ;
"RTN","SAMICTTA",106,0)
 . . ;d OUT(para_"<B>A followup CT scan is recommended "_fuw_" on "_$$XVAL("cefud",vals)_".</B>"_para)
"RTN","SAMICTTA",107,0)
 . . d OUT("A follow-up CT scan is recommended "_fuw_" on "_$$XVAL("cefud",vals)_". ") d OUT("")
"RTN","SAMICTTA",108,0)
 . . q
"RTN","SAMICTTA",109,0)
 . q
"RTN","SAMICTTA",110,0)
 ;
"RTN","SAMICTTA",111,0)
 ; #Other followup
"RTN","SAMICTTA",112,0)
 n comma s comma=0
"RTN","SAMICTTA",113,0)
 n tofu s tofu=""
"RTN","SAMICTTA",114,0)
 n ofu s ofu=""
"RTN","SAMICTTA",115,0)
 n zfu
"RTN","SAMICTTA",116,0)
 f zfu="cefuaf","cefucc","cefupe","cefufn","cefubr","cefupc","cefutb" d  ;
"RTN","SAMICTTA",117,0)
 . i $$XVAL(zfu,vals)="y" s ofu=ofu_zfu
"RTN","SAMICTTA",118,0)
 . q
"RTN","SAMICTTA",119,0)
 i $$XVAL("cefuo",vals)'="" s ofu=ofu_"cefuo"
"RTN","SAMICTTA",120,0)
 ;
"RTN","SAMICTTA",121,0)
 i ofu'="" d  ;
"RTN","SAMICTTA",122,0)
 . s tofu="Follow-up: "
"RTN","SAMICTTA",123,0)
 . i ofu["cefuaf" s tofu=tofu_"Antibiotics" s comma=1
"RTN","SAMICTTA",124,0)
 . i ofu["cefucc" s tofu=tofu_$s(comma:", ",1:"")_"Diagnostic CT" s comma=1
"RTN","SAMICTTA",125,0)
 . i ofu["cefupe" s tofu=tofu_$s(comma:", ",1:"")_"PET" s comma=1
"RTN","SAMICTTA",126,0)
 . i ofu["cefufn" s tofu=tofu_$s(comma:", ",1:"")_"Percutaneous biopsy" s comma=1
"RTN","SAMICTTA",127,0)
 . i ofu["cefubr" s tofu=tofu_$s(comma:", ",1:"")_"Bronchoscopy" s comma=1
"RTN","SAMICTTA",128,0)
 . i ofu["cefupc" s tofu=tofu_$s(comma:", ",1:"")_"Pulmonary consultation" s comma=1
"RTN","SAMICTTA",129,0)
 . i ofu["cefutb" s tofu=tofu_$s(comma:", ",1:"")_"Refer to tumor board" s comma=1
"RTN","SAMICTTA",130,0)
 . i ofu["cefuo" s tofu=tofu_$s(comma:", ",1:"")_$$XVAL("cefuoo",vals) s comma=1
"RTN","SAMICTTA",131,0)
 . q
"RTN","SAMICTTA",132,0)
 ;
"RTN","SAMICTTA",133,0)
 i ofu'="" d OUT(para_tofu_para) d OUT("")
"RTN","SAMICTTA",134,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",135,0)
 ; # LungRADS
"RTN","SAMICTTA",136,0)
 ;
"RTN","SAMICTTA",137,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTTA",138,0)
 ;n lrstyle
"RTN","SAMICTTA",139,0)
 ;i $$XVAL("celrc",vals)'="" s lrstyle=1 ; dom's style
"RTN","SAMICTTA",140,0)
 ;e  s lrstyle=0 ; artit's style
"RTN","SAMICTTA",141,0)
 ;s lrstyle=0
"RTN","SAMICTTA",142,0)
 ;
"RTN","SAMICTTA",143,0)
 d  ;
"RTN","SAMICTTA",144,0)
 . q  ; LUNGRADS moved to SAMICTR4
"RTN","SAMICTTA",145,0)
 . n lradModifiers
"RTN","SAMICTTA",146,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTTA",147,0)
 . ;
"RTN","SAMICTTA",148,0)
 . i $$XVAL("celrad",vals)'="-",$$XVAL("celrad",vals)'="" d  ;
"RTN","SAMICTTA",149,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTTA",150,0)
 . . d OUT(para)
"RTN","SAMICTTA",151,0)
 . . q
"RTN","SAMICTTA",152,0)
 . q
"RTN","SAMICTTA",153,0)
 ;
"RTN","SAMICTTA",154,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",155,0)
 ;
"RTN","SAMICTTA",156,0)
 ;d OUT("<TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",157,0)
 ;
"RTN","SAMICTTA",158,0)
 ;# Check if Study is Completed
"RTN","SAMICTTA",159,0)
 ;# Find Current Study ID
"RTN","SAMICTTA",160,0)
 ;# locate most recent followup
"RTN","SAMICTTA",161,0)
 ;# get status (sies)
"RTN","SAMICTTA",162,0)
 ;# if sc=Study Complete and cefu=rs
"RTN","SAMICTTA",163,0)
 ;
"RTN","SAMICTTA",164,0)
 n patstatus s patstatus=$$XVAL("cedos",vals)
"RTN","SAMICTTA",165,0)
 ;i patstatus="sc" d OUT(para_$g(@dict@("study_complete")))
"RTN","SAMICTTA",166,0)
 i patstatus="sc" d OUT($g(@dict@("study_complete"))) d OUT("")
"RTN","SAMICTTA",167,0)
 ;
"RTN","SAMICTTA",168,0)
 ;# Radiologist
"RTN","SAMICTTA",169,0)
 i $$XVAL("cerad",vals)'="" d  ;
"RTN","SAMICTTA",170,0)
 . d OUT("Interpreted by: "_$$XVAL("cerad",vals)) d OUT("")
"RTN","SAMICTTA",171,0)
 . q
"RTN","SAMICTTA",172,0)
 ;
"RTN","SAMICTTA",173,0)
 ;d OUT("<TR><TD></TD></TR>")
"RTN","SAMICTTA",174,0)
 ; # LungRADS
"RTN","SAMICTTA",175,0)
 ;
"RTN","SAMICTTA",176,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTTA",177,0)
 n lrstyle
"RTN","SAMICTTA",178,0)
 i $$XVAL("celrc",vals)'="" s lrstyle=1 ; dom's style
"RTN","SAMICTTA",179,0)
 e  s lrstyle=0 ; artit's style
"RTN","SAMICTTA",180,0)
 s lrstyle=0
"RTN","SAMICTTA",181,0)
 ;
"RTN","SAMICTTA",182,0)
 d  ;
"RTN","SAMICTTA",183,0)
 . ;q  ; LUNGRADS moved to SAMICTR4
"RTN","SAMICTTA",184,0)
 . n lradModifiers
"RTN","SAMICTTA",185,0)
 . s lradModifiers=$$XVAL("celradc",vals)_$$XVAL("celrads",vals)
"RTN","SAMICTTA",186,0)
 . ;
"RTN","SAMICTTA",187,0)
 . i $$XVAL("celrad",vals)'="-",$$XVAL("celrad",vals)'="" d  ;
"RTN","SAMICTTA",188,0)
 . . d OUT("The LungRADS category for this scan is: "_$$XVAL("celrad",vals)_" "_lradModifiers)
"RTN","SAMICTTA",189,0)
 . . d OUT("")
"RTN","SAMICTTA",190,0)
 . . q
"RTN","SAMICTTA",191,0)
 . q
"RTN","SAMICTTA",192,0)
 ;
"RTN","SAMICTTA",193,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTTA",194,0)
 ;
"RTN","SAMICTTA",195,0)
 ;d OUT("<TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTTA",196,0)
 ;
"RTN","SAMICTTA",197,0)
 quit  ; end of RCMND
"RTN","SAMICTTA",198,0)
 ;
"RTN","SAMICTTA",199,0)
 ;
"RTN","SAMICTTA",200,0)
 ;
"RTN","SAMICTTA",201,0)
 ;
"RTN","SAMICTTA",202,0)
 ;@proc OUT
"RTN","SAMICTTA",203,0)
 ;
"RTN","SAMICTTA",204,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTTA",205,0)
 ;
"RTN","SAMICTTA",206,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTTA",207,0)
 ;@called-by
"RTN","SAMICTTA",208,0)
 ; RCMND
"RTN","SAMICTTA",209,0)
 ;@calls none
"RTN","SAMICTTA",210,0)
 ;@input
"RTN","SAMICTTA",211,0)
 ; ln = output to add
"RTN","SAMICTTA",212,0)
 ; ]rtn output array
"RTN","SAMICTTA",213,0)
 ; ]debug
"RTN","SAMICTTA",214,0)
 ;@thruput
"RTN","SAMICTTA",215,0)
 ; cnt
"RTN","SAMICTTA",216,0)
 ;@output
"RTN","SAMICTTA",217,0)
 ; line added to ct report
"RTN","SAMICTTA",218,0)
 ;
"RTN","SAMICTTA",219,0)
 ;
"RTN","SAMICTTA",220,0)
OUT(ln) ; output ct report line
"RTN","SAMICTTA",221,0)
 ;
"RTN","SAMICTTA",222,0)
 i ln[".." s ln=$p(ln,"..")_"." ; remove double periods at the end
"RTN","SAMICTTA",223,0)
 ;
"RTN","SAMICTTA",224,0)
 s cnt=cnt+1
"RTN","SAMICTTA",225,0)
 ;s debug=1
"RTN","SAMICTTA",226,0)
 n lnn s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTTA",227,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTTA",228,0)
 ;
"RTN","SAMICTTA",229,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTTA",230,0)
 . i ln["<T" q  ; no markup
"RTN","SAMICTTA",231,0)
 . i ln["</" q  ; no markup
"RTN","SAMICTTA",232,0)
 . n zs s zs=$STACK
"RTN","SAMICTTA",233,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTTA",234,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTTA",235,0)
 . q
"RTN","SAMICTTA",236,0)
 ;
"RTN","SAMICTTA",237,0)
 quit  ; end of OUT
"RTN","SAMICTTA",238,0)
 ;
"RTN","SAMICTTA",239,0)
 ;
"RTN","SAMICTTA",240,0)
 ;
"RTN","SAMICTTA",241,0)
 ;
"RTN","SAMICTTA",242,0)
 ;@proc HOUT
"RTN","SAMICTTA",243,0)
 ;
"RTN","SAMICTTA",244,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTTA",245,0)
 ;
"RTN","SAMICTTA",246,0)
 ;ven/gpl;private;procedure;silent;clean;sac?;tests?;port
"RTN","SAMICTTA",247,0)
 ;@called-by none
"RTN","SAMICTTA",248,0)
 ;@calls
"RTN","SAMICTTA",249,0)
 ; OUT
"RTN","SAMICTTA",250,0)
 ;@input
"RTN","SAMICTTA",251,0)
 ; ln = header output to add
"RTN","SAMICTTA",252,0)
 ; ]rtn output array
"RTN","SAMICTTA",253,0)
 ;@output
"RTN","SAMICTTA",254,0)
 ; header line added to ct report
"RTN","SAMICTTA",255,0)
 ;
"RTN","SAMICTTA",256,0)
 ;
"RTN","SAMICTTA",257,0)
HOUT(ln) ; output ct report header line
"RTN","SAMICTTA",258,0)
 ;
"RTN","SAMICTTA",259,0)
 d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTTA",260,0)
 ;
"RTN","SAMICTTA",261,0)
 quit  ; end of HOUT
"RTN","SAMICTTA",262,0)
 ;
"RTN","SAMICTTA",263,0)
 ;
"RTN","SAMICTTA",264,0)
 ;
"RTN","SAMICTTA",265,0)
 ;
"RTN","SAMICTTA",266,0)
 ;@func $$XVAL
"RTN","SAMICTTA",267,0)
 ;
"RTN","SAMICTTA",268,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTTA",269,0)
 ;
"RTN","SAMICTTA",270,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTTA",271,0)
 ;@called-by
"RTN","SAMICTTA",272,0)
 ; RCMND
"RTN","SAMICTTA",273,0)
 ;@calls none
"RTN","SAMICTTA",274,0)
 ;@input
"RTN","SAMICTTA",275,0)
 ; var
"RTN","SAMICTTA",276,0)
 ; vals is passed by name
"RTN","SAMICTTA",277,0)
 ;@output = patient value for var
"RTN","SAMICTTA",278,0)
 ;
"RTN","SAMICTTA",279,0)
 ;
"RTN","SAMICTTA",280,0)
XVAL(var,vals) ; patient value for var
"RTN","SAMICTTA",281,0)
 ;
"RTN","SAMICTTA",282,0)
 n zr s zr=$g(@vals@(var))
"RTN","SAMICTTA",283,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTTA",284,0)
 ;
"RTN","SAMICTTA",285,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTTA",286,0)
 ;
"RTN","SAMICTTA",287,0)
 ;
"RTN","SAMICTTA",288,0)
 ;
"RTN","SAMICTTA",289,0)
 ;
"RTN","SAMICTTA",290,0)
 ;@func $$XSUB
"RTN","SAMICTTA",291,0)
 ;
"RTN","SAMICTTA",292,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTTA",293,0)
 ;
"RTN","SAMICTTA",294,0)
 ;ven/gpl;private;function;silent;clean;sac?;tests?;port
"RTN","SAMICTTA",295,0)
 ;@called-by
"RTN","SAMICTTA",296,0)
 ; RCMND
"RTN","SAMICTTA",297,0)
 ;@calls none
"RTN","SAMICTTA",298,0)
 ;@input
"RTN","SAMICTTA",299,0)
 ; var
"RTN","SAMICTTA",300,0)
 ; vals and dict are passed by name
"RTN","SAMICTTA",301,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTTA",302,0)
 ;@output = dictionary value for var
"RTN","SAMICTTA",303,0)
 ;
"RTN","SAMICTTA",304,0)
 ;
"RTN","SAMICTTA",305,0)
XSUB(var,vals,dict,valdx) ; dictionary value defined by var
"RTN","SAMICTTA",306,0)
 ;
"RTN","SAMICTTA",307,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTTA",308,0)
 n zdx s zdx=$g(valdx)
"RTN","SAMICTTA",309,0)
 i zdx="" s zdx=var
"RTN","SAMICTTA",310,0)
 ;
"RTN","SAMICTTA",311,0)
 n zv s zv=$g(@vals@(zdx))
"RTN","SAMICTTA",312,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTTA",313,0)
 i zv="" s zr="" q zr
"RTN","SAMICTTA",314,0)
 ;
"RTN","SAMICTTA",315,0)
 n zr s zr=$g(@dict@(var,zv))
"RTN","SAMICTTA",316,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTTA",317,0)
 ;
"RTN","SAMICTTA",318,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTTA",319,0)
 ;
"RTN","SAMICTTA",320,0)
 ;
"RTN","SAMICTTA",321,0)
 ;
"RTN","SAMICTTA",322,0)
EOR ; end of routine SAMICTTA
"RTN","SAMICTUL")
0^8^B125001^B108974
"RTN","SAMICTUL",1,0)
SAMICTUL ;ven/gpl - ct report & copy log; 2024-09-24t17:15z
"RTN","SAMICTUL",2,0)
 ;;18.0;SAMI;**10,11,12,13,15**;2020-01-17;Build 1
"RTN","SAMICTUL",3,0)
 ;mdc-e1;SAMICTUL-20240924-E18XmuC;SAMI-18-19-b1
"RTN","SAMICTUL",4,0)
 ;mdc-v7;B125001;SAMI*18.0*19 SEQ #19
"RTN","SAMICTUL",5,0)
 ;
"RTN","SAMICTUL",6,0)
 ; SAMICTUL contains routine & module info & the primary development
"RTN","SAMICTUL",7,0)
 ; log for VAPALS-ELCAP's CT Report ctreport web service route, which
"RTN","SAMICTUL",8,0)
 ; is implemented by the SAMICTR* (html) and SAMICTT* (text)
"RTN","SAMICTUL",9,0)
 ; routines. It also contains the log for the SAMICTC* routines that
"RTN","SAMICTUL",10,0)
 ; implement the ct form copy operation.
"RTN","SAMICTUL",11,0)
 ; SAMICTUL contains no public interfaces or executable code.
"RTN","SAMICTUL",12,0)
 ;
"RTN","SAMICTUL",13,0)
 quit  ; no entry from top
"RTN","SAMICTUL",14,0)
 ;
"RTN","SAMICTUL",15,0)
 ;
"RTN","SAMICTUL",16,0)
 ;
"RTN","SAMICTUL",17,0)
 ;
"RTN","SAMICTUL",18,0)
 ;@section 0 primary development
"RTN","SAMICTUL",19,0)
 ;
"RTN","SAMICTUL",20,0)
 ;
"RTN","SAMICTUL",21,0)
 ;
"RTN","SAMICTUL",22,0)
 ;
"RTN","SAMICTUL",23,0)
 ;@routine-credits
"RTN","SAMICTUL",24,0)
 ;
"RTN","SAMICTUL",25,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMICTUL",26,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICTUL",27,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMICTUL",28,0)
 ; http://vistaexpertise.net
"RTN","SAMICTUL",29,0)
 ;@copyright 2017/2024, gpl, all rights reserved
"RTN","SAMICTUL",30,0)
 ;@license Apache 2.0
"RTN","SAMICTUL",31,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMICTUL",32,0)
 ;
"RTN","SAMICTUL",33,0)
 ;@update 2024-09-24t17:15z
"RTN","SAMICTUL",34,0)
 ;@app-suite Screening Applications Management -SAM
"RTN","SAMICTUL",35,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMICTUL",36,0)
 ;@module CT Report - SAMICT
"RTN","SAMICTUL",37,0)
 ;@release 18-19
"RTN","SAMICTUL",38,0)
 ;@edition-date 2020-01-17
"RTN","SAMICTUL",39,0)
 ;@patches **10,11,12,15,19**
"RTN","SAMICTUL",40,0)
 ;
"RTN","SAMICTUL",41,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMICTUL",42,0)
 ; toad@vistaexpertise.net
"RTN","SAMICTUL",43,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMICTUL",44,0)
 ; lmry@vistaexpertise.net
"RTN","SAMICTUL",45,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMICTUL",46,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICTUL",47,0)
 ;@dev-add Alexis Carlson (arc)
"RTN","SAMICTUL",48,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMICTUL",49,0)
 ;
"RTN","SAMICTUL",50,0)
 ;@module-credits
"RTN","SAMICTUL",51,0)
 ;
"RTN","SAMICTUL",52,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICTUL",53,0)
 ; (VA-PALS)
"RTN","SAMICTUL",54,0)
 ; http://va-pals.org/
"RTN","SAMICTUL",55,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICTUL",56,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICTUL",57,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICTUL",58,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICTUL",59,0)
 ;@partner-org International Early Lung Cancer Action Program (IELCAP)
"RTN","SAMICTUL",60,0)
 ; http://ielcap.com/
"RTN","SAMICTUL",61,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICTUL",62,0)
 ; http://paraxialtech.com/
"RTN","SAMICTUL",63,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICTUL",64,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICTUL",65,0)
 ;
"RTN","SAMICTUL",66,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMICTUL",67,0)
 ; https://www.ielcap-airs.org
"RTN","SAMICTUL",68,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMICTUL",69,0)
 ;@partner-org par
"RTN","SAMICTUL",70,0)
 ;
"RTN","SAMICTUL",71,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICTUL",72,0)
 ;
"RTN","SAMICTUL",73,0)
 ; 2018-07-01/05 ven/arc&lgc 18-0 8b0a4329,f5ff7eeb,5549cd30
"RTN","SAMICTUL",74,0)
 ;  SAMICTD2 1st version of CT Eval Report, fix init routine, get
"RTN","SAMICTUL",75,0)
 ; lungrads & nonodules working.
"RTN","SAMICTUL",76,0)
 ;
"RTN","SAMICTUL",77,0)
 ; 2018-10-14 ven/arc 18-0 f6e1229
"RTN","SAMICTUL",78,0)
 ;  SAMICTC1 turn on copy forward for cteval new forms
"RTN","SAMICTUL",79,0)
 ;
"RTN","SAMICTUL",80,0)
 ; 2018-12-11/2019-01-22 ven/lgc&lmry 18-0 9925713f,3ceb74b,3bb70c8,
"RTN","SAMICTUL",81,0)
 ; d22e0f21,5368121
"RTN","SAMICTUL",82,0)
 ;  SAMICTC1,2,D2 sac compliance, add license info.
"RTN","SAMICTUL",83,0)
 ;
"RTN","SAMICTUL",84,0)
 ; 2020-02-01/03 ven/arc 18-4 d47135a5,bc32c1cb,5b2e4525,7bcd14a2,
"RTN","SAMICTUL",85,0)
 ; 1c96fe0e,cb0075e8,5e553dd2,9cde6840,dcea0048e,98b7b273,a4f98f19
"RTN","SAMICTUL",86,0)
 ;  SAMICTT0,1,2,3,4,9,A routines (starting as copies of SAMICTR*) to
"RTN","SAMICTUL",87,0)
 ; implement ctreport in text format, start convert nodules to text,
"RTN","SAMICTUL",88,0)
 ; add'l lung findings, fix parag spacing, add impressions sect,
"RTN","SAMICTUL",89,0)
 ; recommendations sect, add'l sects on other abnormalities, breast
"RTN","SAMICTUL",90,0)
 ; abnorm sect, other abnorm sect, tweak format, make it more compact.
"RTN","SAMICTUL",91,0)
 ;
"RTN","SAMICTUL",92,0)
 ; 2021-02-18 ven/gpl 18-10 38fb2d70
"RTN","SAMICTUL",93,0)
 ;  SAMICTT0,1,2,3,4,9,A ct report - insert space after every period.
"RTN","SAMICTUL",94,0)
 ;
"RTN","SAMICTUL",95,0)
 ; 2021-03-04/16 ven/gpl 18-10 e09d5f16,3ea26de9,91793ba3
"RTN","SAMICTUL",96,0)
 ;  SAMICTT1,3,4 ct report: fix normal cardiac default output, CAC
"RTN","SAMICTUL",97,0)
 ; logic, other enhancements.
"RTN","SAMICTUL",98,0)
 ;
"RTN","SAMICTUL",99,0)
 ; 2021-03-23 ven/gpl 18-10 a68f7f31
"RTN","SAMICTUL",100,0)
 ;  SAMICTT3 fix CAC problem.
"RTN","SAMICTUL",101,0)
 ;
"RTN","SAMICTUL",102,0)
 ; 2021-03-21/23 ven/toad 18-10 96f461d
"RTN","SAMICTUL",103,0)
 ;  SAMICTUL: create development log routine.
"RTN","SAMICTUL",104,0)
 ;  SAMICTT0,1,2,3,4,9,A bump date & version, lt refactor.
"RTN","SAMICTUL",105,0)
 ;
"RTN","SAMICTUL",106,0)
 ; 2021-05-14 ven/gpl 18-11
"RTN","SAMICTUL",107,0)
 ;  SAMICTTA (F2hup1P B35394677 E2n+tbl) 0a01cf26
"RTN","SAMICTUL",108,0)
 ; in RCMND change to ctreport for no followup ct w/other followup
"RTN","SAMICTUL",109,0)
 ; recommendations, "Followup" instead of "Other Followup."
"RTN","SAMICTUL",110,0)
 ;
"RTN","SAMICTUL",111,0)
 ; 2021-05-19 ven/gpl 18-11 a21b056,139c6a5
"RTN","SAMICTUL",112,0)
 ;  SAMICTT0 in WSREPORT check for small nodule checkboxes.
"RTN","SAMICTUL",113,0)
 ;  SAMICTT1 in NODULES urgent fix to add to ct report "Small [non-]
"RTN","SAMICTUL",114,0)
 ; calcified nodules are present."
"RTN","SAMICTUL",115,0)
 ;
"RTN","SAMICTUL",116,0)
 ; 2021-05-20/21 ven/mcglk&toad 18-11 43a4557,129e96b
"RTN","SAMICTUL",117,0)
 ;  SAMICTT0,1 bump version & dates.
"RTN","SAMICTUL",118,0)
 ;  SAMICTTA (F3hDd8l B35394711 E2n%wGx) 43a4557c
"RTN","SAMICTUL",119,0)
 ; refactored routines.
"RTN","SAMICTUL",120,0)
 ;  SAMICTTA (FL8+iA B35698365 E3Rw+I%) 129e96b1
"RTN","SAMICTUL",121,0)
 ; upgrade semver f/1.18.0.11-i11 t/1.18.0.11+i11.
"RTN","SAMICTUL",122,0)
 ;
"RTN","SAMICTUL",123,0)
 ; 2021-05-24 ven/gpl 18-11 4aba1a9
"RTN","SAMICTUL",124,0)
 ;  SAMICTC1 in CTCOPY add new param key to control two new opening
"RTN","SAMICTUL",125,0)
 ; blocks, critical fix to copy forward for Is It New field for new ct
"RTN","SAMICTUL",126,0)
 ; eval forms.
"RTN","SAMICTUL",127,0)
 ;
"RTN","SAMICTUL",128,0)
 ; 2021-05-25 ven/toad 18-11 801d7c7
"RTN","SAMICTUL",129,0)
 ;  SAMICTC1 bump version & dates; passim annotate & lt refactor.
"RTN","SAMICTUL",130,0)
 ;  SAMICTUL add SAMICTC* routines to log.
"RTN","SAMICTUL",131,0)
 ;
"RTN","SAMICTUL",132,0)
 ; 2021-06-01 ven/gpl 18-11 e86756e
"RTN","SAMICTUL",133,0)
 ;  SAMICTC1 corrected bug on CT eval copy forward: in CTCOPY stanza
"RTN","SAMICTUL",134,0)
 ; 2 q:isnew="".
"RTN","SAMICTUL",135,0)
 ;
"RTN","SAMICTUL",136,0)
 ; 2021-06-04 ven/toad 18-11 7dd9410c,911264de
"RTN","SAMICTUL",137,0)
 ;  SAMICTC1 fold in gpl chg, log, bump dates.
"RTN","SAMICTUL",138,0)
 ;
"RTN","SAMICTUL",139,0)
 ; 2021-07-19 ven/gpl 18-12 e9359411
"RTN","SAMICTUL",140,0)
 ;  SAMICTD2 chg minimal to mild for emphysema in ct report.
"RTN","SAMICTUL",141,0)
 ;
"RTN","SAMICTUL",142,0)
 ; 2021-08-17 ven/gpl 18-13 023fcdff
"RTN","SAMICTUL",143,0)
 ;  SAMICTT3 correct typo in field name for circumflex in CAC section
"RTN","SAMICTUL",144,0)
 ;
"RTN","SAMICTUL",145,0)
 ; 2021-10-19 ven/gpl 18-15 520cbe86,f9b7b5a1,137e131e,514476c3,ba04a578,
"RTN","SAMICTUL",146,0)
 ;  013dd1ad
"RTN","SAMICTUL",147,0)
 ;  SAMICTT0 remove extra space in front of Description, surpress comparison 
"RTN","SAMICTUL",148,0)
 ;  scans on baseline CT eval
"RTN","SAMICTUL",149,0)
 ;  SAMICTT3 added GENLNL for lymph nodes, fixed pleural effusion logic, if no
"RTN","SAMICTUL",150,0)
 ;  input, say CAC score not provided,new lymph node table generated from the
"RTN","SAMICTUL",151,0)
 ;  ct eval tsv graph
"RTN","SAMICTUL",152,0)
 ;  SAMICTD2 remove above from Impression section of ct rpt and followup note
"RTN","SAMICTUL",153,0)
 ;
"RTN","SAMICTUL",154,0)
 ; 2021-10-21 ven/gpl 18-15 5b9cd54b
"RTN","SAMICTUL",155,0)
 ;  SAMICTT3 fix in lymph node description algorithm
"RTN","SAMICTUL",156,0)
 ;
"RTN","SAMICTUL",157,0)
 ; 2021-10-25 ven/gpl 18-15 d147d56f
"RTN","SAMICTUL",158,0)
 ;  SAMICTT3 corrections to pleura and lymph node report text
"RTN","SAMICTUL",159,0)
 ;
"RTN","SAMICTUL",160,0)
 ; 2021-10-26 ven/gpl 18-15 cd36ee6a,f31f8722
"RTN","SAMICTUL",161,0)
 ;  SAMICTT0 fixed CT report Comparison Scans logic
"RTN","SAMICTUL",162,0)
 ;  SAMICTT3 change working on emphysema score not provided
"RTN","SAMICTUL",163,0)
 ;
"RTN","SAMICTUL",164,0)
 ; 2021-10-28 ven/gpl 18-15
"RTN","SAMICTUL",165,0)
 ;  SAMICTT3 (F? B? E?) 194989af
"RTN","SAMICTUL",166,0)
 ; fix detecting no cac score provided.
"RTN","SAMICTUL",167,0)
 ;  SAMICTUL (F19ksFF B106674 E2Hz1Jr) c066b29a
"RTN","SAMICTUL",168,0)
 ; update module-log, bump vers + dates.
"RTN","SAMICTUL",169,0)
 ;  SAMICTUL (F2W+4mZ B106674 E3fCKM2) 46752360
"RTN","SAMICTUL",170,0)
 ; missed a couple little things.
"RTN","SAMICTUL",171,0)
 ;
"RTN","SAMICTUL",172,0)
 ; 2021-10-29 ven/lmry 18-15 3d66553e,6e9594e8
"RTN","SAMICTUL",173,0)
 ;  SAMICTT0 (F? B? E?)
"RTN","SAMICTUL",174,0)
 ; bump vers + dates.
"RTN","SAMICTUL",175,0)
 ;  SAMICTT3 (F? B? E?)
"RTN","SAMICTUL",176,0)
 ; add semi-colon after GENLNL for XINDEX; bump vers + dates.
"RTN","SAMICTUL",177,0)
 ;  SAMICTUL (F2nMtCJ B107594 E3vbBxz) 6e9594e8
"RTN","SAMICTUL",178,0)
 ; XINDEX fixes.
"RTN","SAMICTUL",179,0)
 ;
"RTN","SAMICTUL",180,0)
 ; 2021-11-10 ven/gpl 18-15 c9ab7f07
"RTN","SAMICTUL",181,0)
 ;  SAMICTT3 (F? B? E?)
"RTN","SAMICTUL",182,0)
 ; new logic for CAC & Emphysema report output.
"RTN","SAMICTUL",183,0)
 ;
"RTN","SAMICTUL",184,0)
 ; 2021-11-16 ven/lmry 18-15-b2 89a88ec0
"RTN","SAMICTUL",185,0)
 ;  SAMICTT3 (F? B? E?)
"RTN","SAMICTUL",186,0)
 ;  SAMICTUL (F3sc5+d B108974 E+qel0)
"RTN","SAMICTUL",187,0)
 ; bump vers + dates
"RTN","SAMICTUL",188,0)
 ;
"RTN","SAMICTUL",189,0)
 ; 2024-09-20 ven/gpl 18-19-b1
"RTN","SAMICTUL",190,0)
 ;  SAMICTT4 () d6ca4523
"RTN","SAMICTUL",191,0)
 ;  SAMICTT9 () d6ca4523
"RTN","SAMICTUL",192,0)
 ;  SAMICTTA (F1nOm2b B41320376 EuB8pQ) d6ca4523
"RTN","SAMICTUL",193,0)
 ; CT report changes.
"RTN","SAMICTUL",194,0)
 ;  SAMICTT9 () 9c0cb068
"RTN","SAMICTUL",195,0)
 ; further changes to CT reports.
"RTN","SAMICTUL",196,0)
 ;  SAMICTTA (F2vekZ3 B41346853 E2QmAB) c121db8a
"RTN","SAMICTUL",197,0)
 ; additional changes to CT report.
"RTN","SAMICTUL",198,0)
 ;  SAMICTT0 () 75a48d48
"RTN","SAMICTUL",199,0)
 ; change CT report to use correct Study ID.
"RTN","SAMICTUL",200,0)
 ;  SAMICTT0 () f3cd77f1
"RTN","SAMICTUL",201,0)
 ;  SAMICTT1 () f3cd77f1
"RTN","SAMICTUL",202,0)
 ;  SAMICTT2 () f3cd77f1
"RTN","SAMICTUL",203,0)
 ;  SAMICTT3 () f3cd77f1
"RTN","SAMICTUL",204,0)
 ;  SAMICTT4 () f3cd77f1
"RTN","SAMICTUL",205,0)
 ;  SAMICTT9 () f3cd77f1
"RTN","SAMICTUL",206,0)
 ;  SAMICTTA (FyhgTh B42560817 E3TxLk) f3cd77f1
"RTN","SAMICTUL",207,0)
 ; remove double periods from text in CT reports.
"RTN","SAMICTUL",208,0)
 ;
"RTN","SAMICTUL",209,0)
 ; 2024-09-22 ven/gpl 18-19-b1 2bf9a683
"RTN","SAMICTUL",210,0)
 ;  SAMICTT3 ()
"RTN","SAMICTUL",211,0)
 ; Aortic Valve Calcification bug fixed in CT Report.
"RTN","SAMICTUL",212,0)
 ;
"RTN","SAMICTUL",213,0)
 ; 2024-09-24 ven/toad 18-19-b1
"RTN","SAMICTUL",214,0)
 ;  SAMICTT0 (F3qAecA B112661946 E3wQFOj)
"RTN","SAMICTUL",215,0)
 ;  SAMICTT1 (FDHgIo B154195678 Egyq4v)
"RTN","SAMICTUL",216,0)
 ;  SAMICTT2 (F39yi3O B144641835 E1bbLr)
"RTN","SAMICTUL",217,0)
 ;  SAMICTT3 (F1qxpno B483818586 E1o9ZtO)
"RTN","SAMICTUL",218,0)
 ;  SAMICTT4 (FI%e+H B62798123 E25ZW78)
"RTN","SAMICTUL",219,0)
 ;  SAMICTT9 (F1L1LJi B30429822 E2JP4uz)
"RTN","SAMICTUL",220,0)
 ;  SAMICTTA (F1eQ6rR B49833239 E1+hRO+)
"RTN","SAMICTUL",221,0)
 ;  SAMICTUL (F? B124081 E?)
"RTN","SAMICTUL",222,0)
 ; new ver lines, bump vers + dates + project, add chksums to recent
"RTN","SAMICTUL",223,0)
 ; log entries, update hdr comments, mv subrtn hdr comments before
"RTN","SAMICTUL",224,0)
 ; subs, light refactoring.
"RTN","SAMICTUL",225,0)
 ;
"RTN","SAMICTUL",226,0)
 ; 2024-09-24 ven/lmry 18-19-b1
"RTN","SAMICTUL",227,0)
 ;  SAMICTT3 insert ; before a break to make ^XINDEX happy
"RTN","SAMICTUL",228,0)
 ;  SAMICTT9 remove space at the end of a line for ^XINDEX
"RTN","SAMICTUL",229,0)
 ;
"RTN","SAMICTUL",230,0)
 ;@to-do
"RTN","SAMICTUL",231,0)
 ;
"RTN","SAMICTUL",232,0)
 ; add chksums to older log entries, add details to log
"RTN","SAMICTUL",233,0)
 ;
"RTN","SAMICTUL",234,0)
 ;@contents
"RTN","SAMICTUL",235,0)
 ;
"RTN","SAMICTUL",236,0)
 ; SAMICTC1 ceform copy
"RTN","SAMICTUL",237,0)
 ; SAMICTC2 ceform copy continued
"RTN","SAMICTUL",238,0)
 ;
"RTN","SAMICTUL",239,0)
 ; SAMICTD2 cteval-dict init
"RTN","SAMICTUL",240,0)
 ;
"RTN","SAMICTUL",241,0)
 ; SAMICTT0 ctreport text main
"RTN","SAMICTUL",242,0)
 ; SAMICTT1 ctreport text nodules
"RTN","SAMICTUL",243,0)
 ; SAMICTT2 ctreport text other lung
"RTN","SAMICTUL",244,0)
 ; SAMICTT3 ctreport text emphysema
"RTN","SAMICTUL",245,0)
 ; SAMICTT4 ctreport text breast abnorm
"RTN","SAMICTUL",246,0)
 ; SAMICTT9 ctreport text impressions
"RTN","SAMICTUL",247,0)
 ; SAMICTTA ctreport text recommendations
"RTN","SAMICTUL",248,0)
 ; SAMICTUL ctreport log
"RTN","SAMICTUL",249,0)
 ;
"RTN","SAMICTUL",250,0)
 ; SAMICTR* ctreport html format
"RTN","SAMICTUL",251,0)
 ; SAMIUTR* test the SAMICTR routines
"RTN","SAMICTUL",252,0)
 ;
"RTN","SAMICTUL",253,0)
 ;
"RTN","SAMICTUL",254,0)
 ;
"RTN","SAMICTUL",255,0)
EOR ; end of routine SAMICTUL
"RTN","SAMIMOV")
0^9^B126961045^B53328513
"RTN","SAMIMOV",1,0)
SAMIMOV ;ven/gpl - change patient site; 2024-09-24t13:10z
"RTN","SAMIMOV",2,0)
 ;;18.0;SAMI;**7,15,16,19**;2020-01-17;Build 1
"RTN","SAMIMOV",3,0)
 ;mdc-e1;SAMIMOV-20240924-E2CPEsU;SAMI-18-19-b1
"RTN","SAMIMOV",4,0)
 ;mdc-v7;B126961045;SAMI*18.0*19 SEQ #19
"RTN","SAMIMOV",5,0)
 ;
"RTN","SAMIMOV",6,0)
 ; Routine SAMIMOV is a ScreeningPlus tool for managing duplicate
"RTN","SAMIMOV",7,0)
 ; patient records by moving duplicates to a separate site and cross-
"RTN","SAMIMOV",8,0)
 ; referencing patient records across sites.
"RTN","SAMIMOV",9,0)
 ;
"RTN","SAMIMOV",10,0)
 ; allows entry from top: do ^SAMIMOV
"RTN","SAMIMOV",11,0)
 ;
"RTN","SAMIMOV",12,0)
 ;
"RTN","SAMIMOV",13,0)
 ;
"RTN","SAMIMOV",14,0)
 ;
"RTN","SAMIMOV",15,0)
 ;@section 0 primary development
"RTN","SAMIMOV",16,0)
 ;
"RTN","SAMIMOV",17,0)
 ;
"RTN","SAMIMOV",18,0)
 ;
"RTN","SAMIMOV",19,0)
 ;
"RTN","SAMIMOV",20,0)
 ;@routine-credits
"RTN","SAMIMOV",21,0)
 ;
"RTN","SAMIMOV",22,0)
 ;@dev George P. Lilly (gpl)
"RTN","SAMIMOV",23,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIMOV",24,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIMOV",25,0)
 ; http://vistaexpertise.net
"RTN","SAMIMOV",26,0)
 ;@copyright 2021/2024, gpl, all rights reserved
"RTN","SAMIMOV",27,0)
 ;@license see routine SAMIUL
"RTN","SAMIMOV",28,0)
 ;
"RTN","SAMIMOV",29,0)
 ;@update 2024-09-24t13:10z
"RTN","SAMIMOV",30,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIMOV",31,0)
 ;@app ScreeningPlus (SAM-IECAP) - SAMI
"RTN","SAMIMOV",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIMOV",33,0)
 ;@release 18-19
"RTN","SAMIMOV",34,0)
 ;@edition-date 2020-01-17
"RTN","SAMIMOV",35,0)
 ;@patches **7,15,16,19**
"RTN","SAMIMOV",36,0)
 ;
"RTN","SAMIMOV",37,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIMOV",38,0)
 ; toad@vistaexpertise.net
"RTN","SAMIMOV",39,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIMOV",40,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIMOV",41,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIMOV",42,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIMOV",43,0)
 ;
"RTN","SAMIMOV",44,0)
 ;@module-credits
"RTN","SAMIMOV",45,0)
 ;
"RTN","SAMIMOV",46,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIMOV",47,0)
 ; (VA-PALS)
"RTN","SAMIMOV",48,0)
 ; http://va-pals.org/
"RTN","SAMIMOV",49,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIMOV",50,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIMOV",51,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIMOV",52,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIMOV",53,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIMOV",54,0)
 ; http://ielcap.com/
"RTN","SAMIMOV",55,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIMOV",56,0)
 ; http://paraxialtech.com/
"RTN","SAMIMOV",57,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIMOV",58,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIMOV",59,0)
 ;
"RTN","SAMIMOV",60,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIMOV",61,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIMOV",62,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIMOV",63,0)
 ;@partner-org par
"RTN","SAMIMOV",64,0)
 ;
"RTN","SAMIMOV",65,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIMOV",66,0)
 ;
"RTN","SAMIMOV",67,0)
 ; 2020-08-24 ven/gpl 18-7 SAMIMOV
"RTN","SAMIMOV",68,0)
 ;  (F1vmhnT B14271873 E3kALaa) 915b85e6
"RTN","SAMIMOV",69,0)
 ; add utility to change patient site.
"RTN","SAMIMOV",70,0)
 ;
"RTN","SAMIMOV",71,0)
 ; 2020-09-03 ven/gpl 18-7 SAMIMOV
"RTN","SAMIMOV",72,0)
 ;  (F2Oh8MK B15330427 ED58CO) 5ae08772
"RTN","SAMIMOV",73,0)
 ; upgrade CHANGE SITE to handle patients without forms; add AUDIT
"RTN","SAMIMOV",74,0)
 ; report.
"RTN","SAMIMOV",75,0)
 ;
"RTN","SAMIMOV",76,0)
 ; 2020-09-07 ven/gpl 18-7 SAMIMOV
"RTN","SAMIMOV",77,0)
 ;  (F274Xxj B15330427 E3xUS5q) 498e57d5
"RTN","SAMIMOV",78,0)
 ; tweak the audit report.
"RTN","SAMIMOV",79,0)
 ;
"RTN","SAMIMOV",80,0)
 ; 2020-12-11 ven/18-15 gpl SAMIMOV
"RTN","SAMIMOV",81,0)
 ;  (F18YzNY B15532682 E2yyafw) 92138cdb
"RTN","SAMIMOV",82,0)
 ; add DETAIL^SAMIJS1 for debugging.
"RTN","SAMIMOV",83,0)
 ;
"RTN","SAMIMOV",84,0)
 ; 2021-10-26 ven/gpl 18-15 SAMIMOV
"RTN","SAMIMOV",85,0)
 ;  (F2dqpoR B15532682 ESE%h7) d12b1b10
"RTN","SAMIMOV",86,0)
 ; add param detection routine for IDing VA systems.
"RTN","SAMIMOV",87,0)
 ;
"RTN","SAMIMOV",88,0)
 ; 2021-10-29 ven/lmry 18-15 SAMIMOV
"RTN","SAMIMOV",89,0)
 ;  (F1rLb+y B26175405 EqUHp) 2bcb0ddc
"RTN","SAMIMOV",90,0)
 ;  (F1uDHw5 B53328513 Esu726) 6e9594e8
"RTN","SAMIMOV",91,0)
 ; add section 0, bump versions + dates, add semicolon after PICSITE
"RTN","SAMIMOV",92,0)
 ; for XINDEX.
"RTN","SAMIMOV",93,0)
 ;
"RTN","SAMIMOV",94,0)
 ; 2022-03-24 ven/gpl 18-16-b4 SAMIMOV
"RTN","SAMIMOV",95,0)
 ;  (FJ1J2y B81805087 E3Hhoxp) 0a767f16
"RTN","SAMIMOV",96,0)
 ; add DEDUP^SAMIMOV tool to move duplicate records; add ability to
"RTN","SAMIMOV",97,0)
 ; create a site index showing patients & the ability to automatically
"RTN","SAMIMOV",98,0)
 ; move duplicate entries to another site to fix a problem with
"RTN","SAMIMOV",99,0)
 ; inputing data from a spreadsheet.
"RTN","SAMIMOV",100,0)
 ;
"RTN","SAMIMOV",101,0)
 ; 2022-03-24 ven/lmry 18-16-b4 SAMIMOV
"RTN","SAMIMOV",102,0)
 ;  (F14aBNU B84568110 E2S3ifr) 554e8856
"RTN","SAMIMOV",103,0)
 ; update date & contents.
"RTN","SAMIMOV",104,0)
 ;
"RTN","SAMIMOV",105,0)
 ; 2024-09-24 ven/toad 18-19-b1 SAMIMOV
"RTN","SAMIMOV",106,0)
 ;  (F? B126961045 E?)
"RTN","SAMIMOV",107,0)
 ; bump vers + dates, hdr comments & log; new release because most
"RTN","SAMIMOV",108,0)
 ; sites never received SAMI-18-16-b4, and new sites now being rapidly
"RTN","SAMIMOV",109,0)
 ; added; passim r/outaudit w/OUTAUDIT, slight refactoring.
"RTN","SAMIMOV",110,0)
 ;
"RTN","SAMIMOV",111,0)
 ;@to-do
"RTN","SAMIMOV",112,0)
 ;
"RTN","SAMIMOV",113,0)
 ; add subrtn hdr comments
"RTN","SAMIMOV",114,0)
 ; do full SAC update
"RTN","SAMIMOV",115,0)
 ; add details to log
"RTN","SAMIMOV",116,0)
 ;
"RTN","SAMIMOV",117,0)
 ;@contents
"RTN","SAMIMOV",118,0)
 ;
"RTN","SAMIMOV",119,0)
 ; EN entry point to change a patient's site
"RTN","SAMIMOV",120,0)
 ; DEDUP move duplicate patient records from one site to another
"RTN","SAMIMOV",121,0)
 ; SITEIDX generate a siteid index in the patient lookup graph
"RTN","SAMIMOV",122,0)
 ; MOV change patient PAT from site FROM to site TO 
"RTN","SAMIMOV",123,0)
 ; SETSID propogate the new sid to all forms
"RTN","SAMIMOV",124,0)
 ; PICPAT pick a patient in site SITE
"RTN","SAMIMOV",125,0)
 ; PICSITE pick a site
"RTN","SAMIMOV",126,0)
 ; AUDIT audit report
"RTN","SAMIMOV",127,0)
 ; OUTAUDIT add line to audit report
"RTN","SAMIMOV",128,0)
 ; 
"RTN","SAMIMOV",129,0)
 ;
"RTN","SAMIMOV",130,0)
 ;
"RTN","SAMIMOV",131,0)
 ;
"RTN","SAMIMOV",132,0)
 ;@section 1 subroutines
"RTN","SAMIMOV",133,0)
 ;
"RTN","SAMIMOV",134,0)
 ;
"RTN","SAMIMOV",135,0)
 ;
"RTN","SAMIMOV",136,0)
 ;
"RTN","SAMIMOV",137,0)
EN ; entry point to change a patient's site
"RTN","SAMIMOV",138,0)
 ;
"RTN","SAMIMOV",139,0)
 n FROM,TO,PAT
"RTN","SAMIMOV",140,0)
 W !,"Pick the FROM Site -"
"RTN","SAMIMOV",141,0)
 S FROM=$$PICSITE()
"RTN","SAMIMOV",142,0)
 IF FROM="^" Q  ;
"RTN","SAMIMOV",143,0)
 ;
"RTN","SAMIMOV",144,0)
 W !,"Pick the TO Site -"
"RTN","SAMIMOV",145,0)
 S TO=$$PICSITE()
"RTN","SAMIMOV",146,0)
 IF TO="^" Q  ;
"RTN","SAMIMOV",147,0)
 ;
"RTN","SAMIMOV",148,0)
 D PICPAT(.PAT,FROM)
"RTN","SAMIMOV",149,0)
 I $G(PAT("name"))="" D  Q  ;
"RTN","SAMIMOV",150,0)
 . W !,"No patient selected, canceling"
"RTN","SAMIMOV",151,0)
 . Q
"RTN","SAMIMOV",152,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","SAMIMOV",153,0)
 S DIR("A")="Confirm change site of patient "_PAT("name")_" from "_FROM_" to "_TO
"RTN","SAMIMOV",154,0)
 S DIR(0)="Y"
"RTN","SAMIMOV",155,0)
 D ^DIR
"RTN","SAMIMOV",156,0)
 ;
"RTN","SAMIMOV",157,0)
 I Y'=1 D  Q  ;
"RTN","SAMIMOV",158,0)
 . W !,"Cancel, no change made"
"RTN","SAMIMOV",159,0)
 . Q
"RTN","SAMIMOV",160,0)
 ;
"RTN","SAMIMOV",161,0)
 do MOV(.PAT,FROM,TO)
"RTN","SAMIMOV",162,0)
 ;
"RTN","SAMIMOV",163,0)
 quit  ; end of ^SAMIMOV / EN^SAMIMOV
"RTN","SAMIMOV",164,0)
 ;
"RTN","SAMIMOV",165,0)
 ;
"RTN","SAMIMOV",166,0)
 ;
"RTN","SAMIMOV",167,0)
 ;
"RTN","SAMIMOV",168,0)
DEDUP() ; remove duplicate names from a site
"RTN","SAMIMOV",169,0)
 ;
"RTN","SAMIMOV",170,0)
 n FROM,TO,PAT
"RTN","SAMIMOV",171,0)
 W !,"Pick the FROM Site -"
"RTN","SAMIMOV",172,0)
 S FROM=$$PICSITE()
"RTN","SAMIMOV",173,0)
 IF FROM="^" Q  ;
"RTN","SAMIMOV",174,0)
 ;
"RTN","SAMIMOV",175,0)
 W !,"Pick the TO Site -"
"RTN","SAMIMOV",176,0)
 S TO=$$PICSITE()
"RTN","SAMIMOV",177,0)
 IF TO="^" Q  ;
"RTN","SAMIMOV",178,0)
 ;
"RTN","SAMIMOV",179,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","SAMIMOV",180,0)
 S DIR("A")="Confirm removing duplicates from  "_FROM_" by moving them to "_TO
"RTN","SAMIMOV",181,0)
 S DIR(0)="Y"
"RTN","SAMIMOV",182,0)
 D ^DIR
"RTN","SAMIMOV",183,0)
 ;
"RTN","SAMIMOV",184,0)
 I Y'=1 D  Q  ;
"RTN","SAMIMOV",185,0)
 . W !,"Cancel, no change made"
"RTN","SAMIMOV",186,0)
 . Q
"RTN","SAMIMOV",187,0)
 ;
"RTN","SAMIMOV",188,0)
 d SITEIDX ; insure we have a site index
"RTN","SAMIMOV",189,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIMOV",190,0)
 q:lroot=""
"RTN","SAMIMOV",191,0)
 n site s site=FROM
"RTN","SAMIMOV",192,0)
 n gn s gn=$na(@lroot@("siteid",site))
"RTN","SAMIMOV",193,0)
 i '$d(@gn) d  q  ;
"RTN","SAMIMOV",194,0)
 . w !,"Error name index not found"
"RTN","SAMIMOV",195,0)
 . q
"RTN","SAMIMOV",196,0)
 n zi,zj
"RTN","SAMIMOV",197,0)
 s zi=""
"RTN","SAMIMOV",198,0)
 f  s zi=$o(@gn@(zi)) q:zi=""  d  ;
"RTN","SAMIMOV",199,0)
 . s zj=$o(@gn@(zi,"")) ; ien of non-duplicate record
"RTN","SAMIMOV",200,0)
 . q:$g(@lroot@(zj,"siteid"))'=FROM
"RTN","SAMIMOV",201,0)
 . f  s zj=$o(@gn@(zi,zj)) q:zj=""  d  ;
"RTN","SAMIMOV",202,0)
 . . q:'$d(@lroot@(zj))
"RTN","SAMIMOV",203,0)
 . . m PAT=@lroot@(zj)
"RTN","SAMIMOV",204,0)
 . . q:$g(PAT("siteid"))'=FROM
"RTN","SAMIMOV",205,0)
 . . w !,"found a duplicate "_zi_" "_zj
"RTN","SAMIMOV",206,0)
 . . do MOV(.PAT,FROM,TO)
"RTN","SAMIMOV",207,0)
 . . K PAT
"RTN","SAMIMOV",208,0)
 . . q
"RTN","SAMIMOV",209,0)
 . q
"RTN","SAMIMOV",210,0)
 D SITEIDX
"RTN","SAMIMOV",211,0)
 ;
"RTN","SAMIMOV",212,0)
 quit  ; end of DEDUP
"RTN","SAMIMOV",213,0)
 ;
"RTN","SAMIMOV",214,0)
 ;
"RTN","SAMIMOV",215,0)
 ;
"RTN","SAMIMOV",216,0)
 ;
"RTN","SAMIMOV",217,0)
SITEIDX() ; generate a siteid index in the patient lookup graph
"RTN","SAMIMOV",218,0)
 ;
"RTN","SAMIMOV",219,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIMOV",220,0)
 q:lroot=""
"RTN","SAMIMOV",221,0)
 k @lroot@("siteid")
"RTN","SAMIMOV",222,0)
 n site,nm,ien
"RTN","SAMIMOV",223,0)
 s (site,nm)=""
"RTN","SAMIMOV",224,0)
 s ien=0
"RTN","SAMIMOV",225,0)
 f  s ien=$o(@lroot@(ien)) q:+ien=0  d  ;
"RTN","SAMIMOV",226,0)
 . s site=$g(@lroot@(ien,"siteid"))
"RTN","SAMIMOV",227,0)
 . ;q:site="XXX"
"RTN","SAMIMOV",228,0)
 . ;w !,ien_" site: "_site
"RTN","SAMIMOV",229,0)
 . s nm=$g(@lroot@(ien,"saminame"))
"RTN","SAMIMOV",230,0)
 . q:nm=""
"RTN","SAMIMOV",231,0)
 . q:site=""
"RTN","SAMIMOV",232,0)
 . s @lroot@("siteid",site,nm,ien)=""
"RTN","SAMIMOV",233,0)
 . q
"RTN","SAMIMOV",234,0)
 ;
"RTN","SAMIMOV",235,0)
 quit  ; end of SITEIDX
"RTN","SAMIMOV",236,0)
 ;
"RTN","SAMIMOV",237,0)
 ;
"RTN","SAMIMOV",238,0)
 ;
"RTN","SAMIMOV",239,0)
 ;
"RTN","SAMIMOV",240,0)
MOV(PAT,FROM,TO) ; change patient PAT from site FROM to site TO
"RTN","SAMIMOV",241,0)
 ;
"RTN","SAMIMOV",242,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIMOV",243,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIMOV",244,0)
 n dfn s dfn=$g(PAT("dfn"))
"RTN","SAMIMOV",245,0)
 i dfn="" d  q  ;
"RTN","SAMIMOV",246,0)
 . w !,"Error, patient not valid"
"RTN","SAMIMOV",247,0)
 . q
"RTN","SAMIMOV",248,0)
 n lien
"RTN","SAMIMOV",249,0)
 s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIMOV",250,0)
 i $g(@lroot@(lien,"siteid"))'=FROM d  q  ;
"RTN","SAMIMOV",251,0)
 . w !,"Error, from site not valid for patient"
"RTN","SAMIMOV",252,0)
 . q
"RTN","SAMIMOV",253,0)
 ;
"RTN","SAMIMOV",254,0)
 n pien s pien=$o(@root@("dfn",dfn,""))
"RTN","SAMIMOV",255,0)
 i pien="" d  q  ;
"RTN","SAMIMOV",256,0)
 . w !,"Patient has no forms"
"RTN","SAMIMOV",257,0)
 . s @lroot@(lien,"siteid")=TO
"RTN","SAMIMOV",258,0)
 . w !,"Change successful"
"RTN","SAMIMOV",259,0)
 . q
"RTN","SAMIMOV",260,0)
 ;
"RTN","SAMIMOV",261,0)
 n oldsid s oldsid=$g(@root@(pien,"studyid"))
"RTN","SAMIMOV",262,0)
 i oldsid="" s oldsid=$g(@root@(pien,"samistudyid"))
"RTN","SAMIMOV",263,0)
 w !,"oldsid=",oldsid
"RTN","SAMIMOV",264,0)
 i oldsid="" d  q  ;
"RTN","SAMIMOV",265,0)
 . w !,"Error studyid not found"
"RTN","SAMIMOV",266,0)
 . q
"RTN","SAMIMOV",267,0)
 ;b
"RTN","SAMIMOV",268,0)
 s @lroot@(lien,"siteid")=TO
"RTN","SAMIMOV",269,0)
 s PAT("siteid")=TO
"RTN","SAMIMOV",270,0)
 k @root@("sid",oldsid,pien) ; remove sid index
"RTN","SAMIMOV",271,0)
 ;
"RTN","SAMIMOV",272,0)
 n newsid s newsid=$$GENSTDID^SAMIHOM3(dfn,.PAT)
"RTN","SAMIMOV",273,0)
 s @lroot@(lien,"studyid")=newsid
"RTN","SAMIMOV",274,0)
 s @root@(pien,"studyid")=newsid
"RTN","SAMIMOV",275,0)
 s @root@(pien,"sisid")=newsid
"RTN","SAMIMOV",276,0)
 s @root@(pien,"samistudyid")=newsid
"RTN","SAMIMOV",277,0)
 s @root@("sid",newsid,pien)=""
"RTN","SAMIMOV",278,0)
 ;
"RTN","SAMIMOV",279,0)
 w !,"New studyid = "_newsid
"RTN","SAMIMOV",280,0)
 m @root@("graph",newsid)=@root@("graph",oldsid)
"RTN","SAMIMOV",281,0)
 d SETSID(newsid) ;propogate the new sid to all forms
"RTN","SAMIMOV",282,0)
 k @root@("graph",oldsid)
"RTN","SAMIMOV",283,0)
 w !,"Change successful"
"RTN","SAMIMOV",284,0)
 ;
"RTN","SAMIMOV",285,0)
 quit  ; end of MOV
"RTN","SAMIMOV",286,0)
 ;
"RTN","SAMIMOV",287,0)
 ;
"RTN","SAMIMOV",288,0)
 ;
"RTN","SAMIMOV",289,0)
 ;
"RTN","SAMIMOV",290,0)
SETSID(newsid) ; propagate the new sid to all forms
"RTN","SAMIMOV",291,0)
 ;
"RTN","SAMIMOV",292,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIMOV",293,0)
 n zi s zi=""
"RTN","SAMIMOV",294,0)
 f  s zi=$o(@root@("graph",newsid,zi)) q:zi=""  d  ;
"RTN","SAMIMOV",295,0)
 . s @root@("graph",newsid,zi,"samistudyid")=newsid
"RTN","SAMIMOV",296,0)
 . s @root@("graph",newsid,zi,"studyid")=newsid
"RTN","SAMIMOV",297,0)
 . s @root@("graph",newsid,zi,"sisid")=newsid
"RTN","SAMIMOV",298,0)
 . q
"RTN","SAMIMOV",299,0)
 ;
"RTN","SAMIMOV",300,0)
 quit  ; end of SETSID
"RTN","SAMIMOV",301,0)
 ;
"RTN","SAMIMOV",302,0)
 ;
"RTN","SAMIMOV",303,0)
 ;
"RTN","SAMIMOV",304,0)
 ;
"RTN","SAMIMOV",305,0)
PICPAT(PATRTN,SITE) ; pick a patient in site SITE
"RTN","SAMIMOV",306,0)
 ;
"RTN","SAMIMOV",307,0)
 N FILTER,LIST
"RTN","SAMIMOV",308,0)
 I $G(SITE)="" S SITE="*"
"RTN","SAMIMOV",309,0)
 S FILTER("site")=$G(SITE)
"RTN","SAMIMOV",310,0)
 S FILTER("format")="array"
"RTN","SAMIMOV",311,0)
 ;
"RTN","SAMIMOV",312,0)
 new DIR set DIR(0)="F^1:120" ; free text
"RTN","SAMIMOV",313,0)
 set DIR("A")="Patient name: " ; prompt
"RTN","SAMIMOV",314,0)
 set DIR("B")="""" ; default
"RTN","SAMIMOV",315,0)
 N DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","SAMIMOV",316,0)
 ;
"RTN","SAMIMOV",317,0)
 D ^DIR
"RTN","SAMIMOV",318,0)
 ;
"RTN","SAMIMOV",319,0)
 S FILTER("search")=Y
"RTN","SAMIMOV",320,0)
 D WSPTLKUP^SAMIPTLK(.LIST,.FILTER)
"RTN","SAMIMOV",321,0)
 ;ZWR LIST(:,:,"name")
"RTN","SAMIMOV",322,0)
 ;
"RTN","SAMIMOV",323,0)
 N LCNT S LCNT=$O(LIST("result",""),-1)
"RTN","SAMIMOV",324,0)
 Q:+LCNT=0
"RTN","SAMIMOV",325,0)
 S Y=1
"RTN","SAMIMOV",326,0)
 I LCNT>1 D  ; more than one in the list
"RTN","SAMIMOV",327,0)
 . K DIR
"RTN","SAMIMOV",328,0)
 . N ZI S ZI=0
"RTN","SAMIMOV",329,0)
 . S DIR("A")="Select the patient"
"RTN","SAMIMOV",330,0)
 . F  S ZI=$O(LIST("result",ZI)) Q:+ZI=0  D  ;
"RTN","SAMIMOV",331,0)
 . . S DIR("A",ZI)=ZI_" "_LIST("result",ZI,"name")_" "_LIST("result",ZI,"last5")
"RTN","SAMIMOV",332,0)
 . . Q
"RTN","SAMIMOV",333,0)
 . S DIR(0)="N^1:"_LCNT_":0"
"RTN","SAMIMOV",334,0)
 . D ^DIR
"RTN","SAMIMOV",335,0)
 . ;W !,"Y=",Y
"RTN","SAMIMOV",336,0)
 . Q
"RTN","SAMIMOV",337,0)
 I +Y>0 M PATRTN=LIST("result",Y)
"RTN","SAMIMOV",338,0)
 ;
"RTN","SAMIMOV",339,0)
 quit  ; end of PICPAT
"RTN","SAMIMOV",340,0)
 ;
"RTN","SAMIMOV",341,0)
 ;
"RTN","SAMIMOV",342,0)
 ;
"RTN","SAMIMOV",343,0)
 ;
"RTN","SAMIMOV",344,0)
PICSITE() ; pick a site
"RTN","SAMIMOV",345,0)
 ;
"RTN","SAMIMOV",346,0)
 N X,Y,DIC,SITEIEN,SITEID
"RTN","SAMIMOV",347,0)
 S DIC=311.12
"RTN","SAMIMOV",348,0)
 S DIC(0)="AEMQ"
"RTN","SAMIMOV",349,0)
 D ^DIC
"RTN","SAMIMOV",350,0)
 I Y<1 Q  ; EXIT
"RTN","SAMIMOV",351,0)
 S SITENUM=$P(Y,"^",2)
"RTN","SAMIMOV",352,0)
 S SITEID=$$SITEID^SAMISITE(SITENUM)
"RTN","SAMIMOV",353,0)
 ;
"RTN","SAMIMOV",354,0)
 QUIT SITEID ; end of $$PICSITE
"RTN","SAMIMOV",355,0)
 ;
"RTN","SAMIMOV",356,0)
 ;
"RTN","SAMIMOV",357,0)
 ;
"RTN","SAMIMOV",358,0)
 ;
"RTN","SAMIMOV",359,0)
AUDIT() ; audit report
"RTN","SAMIMOV",360,0)
 ;
"RTN","SAMIMOV",361,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIMOV",362,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIMOV",363,0)
 n rpt s rpt=$na(^TMP("SAMIAUDIT",$J))
"RTN","SAMIMOV",364,0)
 k @rpt
"RTN","SAMIMOV",365,0)
 d OUTAUDIT(rpt,"cdate NAME  lien  dfn site  PNAME  pien  pdfn sid")
"RTN","SAMIMOV",366,0)
 n ln,lname,lien,cdate,pname,pien,ldfn,pdfn,site,sid
"RTN","SAMIMOV",367,0)
 s (ln,lname,lien,site,cdate,pname,pien,ldfn,pdfn,sid)=""
"RTN","SAMIMOV",368,0)
 n zi s zi=" "
"RTN","SAMIMOV",369,0)
 f  s zi=$o(@lroot@(zi),-1) q:+zi=0  d  ;
"RTN","SAMIMOV",370,0)
 . s lien=zi
"RTN","SAMIMOV",371,0)
 . s site=$g(@lroot@(zi,"siteid"))
"RTN","SAMIMOV",372,0)
 . s lname=$g(@lroot@(zi,"saminame"))
"RTN","SAMIMOV",373,0)
 . s ldfn=$g(@lroot@(zi,"dfn"))
"RTN","SAMIMOV",374,0)
 . i ldfn="" d  q  ;
"RTN","SAMIMOV",375,0)
 . . ;d ^ZTER
"RTN","SAMIMOV",376,0)
 . . w !,"error ",zi
"RTN","SAMIMOV",377,0)
 . . s ln="error, missing dfn lien="_lien
"RTN","SAMIMOV",378,0)
 . . s ln=ln_" "_$g(@lroot@(zi,"saminame"))
"RTN","SAMIMOV",379,0)
 . . d OUTAUDIT(rpt,ln)
"RTN","SAMIMOV",380,0)
 . . s ln=""
"RTN","SAMIMOV",381,0)
 . . q
"RTN","SAMIMOV",382,0)
 . i $o(@lroot@("dfn",ldfn,""))'=lien d  ;
"RTN","SAMIMOV",383,0)
 . . w !,"error in dfn index dfn="_ldfn_" lien="_lien
"RTN","SAMIMOV",384,0)
 . . q
"RTN","SAMIMOV",385,0)
 . s pien=$o(@proot@("dfn",ldfn,""))
"RTN","SAMIMOV",386,0)
 . i +pien'=0 d  ;
"RTN","SAMIMOV",387,0)
 . . s cdate=$g(@proot@(pien,"samicreatedate"))
"RTN","SAMIMOV",388,0)
 . . s pname=$g(@proot@(pien,"saminame"))
"RTN","SAMIMOV",389,0)
 . . s pdfn=$g(@proot@(pien,"dfn"))
"RTN","SAMIMOV",390,0)
 . . s sid=$g(@proot@(pien,"samistudyid"))
"RTN","SAMIMOV",391,0)
 . . q
"RTN","SAMIMOV",392,0)
 . s ln=ln_$g(cdate)_" "
"RTN","SAMIMOV",393,0)
 . s ln=ln_$e(lname,1,20)_"  "
"RTN","SAMIMOV",394,0)
 . s ln=ln_$J(lien,5)
"RTN","SAMIMOV",395,0)
 . s ln=ln_$j(ldfn,8)
"RTN","SAMIMOV",396,0)
 . s ln=ln_" "_site_" "
"RTN","SAMIMOV",397,0)
 . s ln=ln_" "_$e(pname,1,20)_" "
"RTN","SAMIMOV",398,0)
 . s ln=ln_$j(pien,5)
"RTN","SAMIMOV",399,0)
 . i pien="" s ln=ln_"Not Enrolled"
"RTN","SAMIMOV",400,0)
 . s ln=ln_$j(pdfn,8)
"RTN","SAMIMOV",401,0)
 . s ln=ln_" "_sid
"RTN","SAMIMOV",402,0)
 . d OUTAUDIT(rpt,ln)
"RTN","SAMIMOV",403,0)
 . s (ln,lname,lien,site,cdate,pname,pien,ldfn,pdfn,sid)=""
"RTN","SAMIMOV",404,0)
 . q
"RTN","SAMIMOV",405,0)
 ;B
"RTN","SAMIMOV",406,0)
 D BROWSE^DDBR(rpt,"N","audit")
"RTN","SAMIMOV",407,0)
 ;
"RTN","SAMIMOV",408,0)
 quit  ; end of AUDIT
"RTN","SAMIMOV",409,0)
 ;
"RTN","SAMIMOV",410,0)
 ;
"RTN","SAMIMOV",411,0)
 ;
"RTN","SAMIMOV",412,0)
 ;
"RTN","SAMIMOV",413,0)
OUTAUDIT(rpt,ln) ; add line to audit report
"RTN","SAMIMOV",414,0)
 ;
"RTN","SAMIMOV",415,0)
 s @rpt@($o(@rpt@(" "),-1)+1)=$g(ln)
"RTN","SAMIMOV",416,0)
 ;w !,ln
"RTN","SAMIMOV",417,0)
 ;
"RTN","SAMIMOV",418,0)
 quit  ; end of OUTAUDIT
"RTN","SAMIMOV",419,0)
 ;
"RTN","SAMIMOV",420,0)
 ;
"RTN","SAMIMOV",421,0)
 ;
"RTN","SAMIMOV",422,0)
EOR ; end of routine SAMIMOV
"RTN","SAMIPAT")
0^10^B23769617^B17504242
"RTN","SAMIPAT",1,0)
SAMIPAT ;ven/lmry - post subroutines; 2024-09-24t02:16z
"RTN","SAMIPAT",2,0)
 ;;18.0;SAMI;**12,14,15,17,18,19**;2020-01-17;Build 1
"RTN","SAMIPAT",3,0)
 ;mdc-e1;SAMIPAT-20240924-E129BpK;SAMI-18-19-b1
"RTN","SAMIPAT",4,0)
 ;mdc-v7;B23769617;SAMI*18.0*19 SEQ #19
"RTN","SAMIPAT",5,0)
 ;
"RTN","SAMIPAT",6,0)
 ; Routine SAMIPAT contains ScreeningPlus initialization subroutines
"RTN","SAMIPAT",7,0)
 ; to use as KIDS pre- & post-installs & environment checks.
"RTN","SAMIPAT",8,0)
 ;
"RTN","SAMIPAT",9,0)
 quit  ; no entry from top
"RTN","SAMIPAT",10,0)
 ;
"RTN","SAMIPAT",11,0)
 ;
"RTN","SAMIPAT",12,0)
 ;
"RTN","SAMIPAT",13,0)
 ;
"RTN","SAMIPAT",14,0)
 ;@section 0 primary development
"RTN","SAMIPAT",15,0)
 ;
"RTN","SAMIPAT",16,0)
 ;
"RTN","SAMIPAT",17,0)
 ;
"RTN","SAMIPAT",18,0)
 ;
"RTN","SAMIPAT",19,0)
 ;@routine-credits
"RTN","SAMIPAT",20,0)
 ;
"RTN","SAMIPAT",21,0)
 ;@dev Linda M. R. Yaw (lmry)
"RTN","SAMIPAT",22,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIPAT",23,0)
 ;@dev-org Vista Expertise Network (ven)
"RTN","SAMIPAT",24,0)
 ; http://vistaexpertise.net
"RTN","SAMIPAT",25,0)
 ;@copyright 2024, toad, all rights reserved
"RTN","SAMIPAT",26,0)
 ;@license see routine SAMIUL
"RTN","SAMIPAT",27,0)
 ;
"RTN","SAMIPAT",28,0)
 ;@update 2024-09-24t02:16z
"RTN","SAMIPAT",29,0)
 ;@app-suite Screening Applications Management - SAM
"RTN","SAMIPAT",30,0)
 ;@app ScreeningPlus (SAM-IELCAP) - SAMI
"RTN","SAMIPAT",31,0)
 ;@module Inits (patching) - SAMIPA
"RTN","SAMIPAT",32,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIPAT",33,0)
 ;@release 18-19
"RTN","SAMIPAT",34,0)
 ;@edition-date 2020-01-17
"RTN","SAMIPAT",35,0)
 ;@patches **12,14,15,17,18,19**
"RTN","SAMIPAT",36,0)
 ;
"RTN","SAMIPAT",37,0)
 ;@dev-add George P. Lilly (gpl)
"RTN","SAMIPAT",38,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIPAT",39,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIPAT",40,0)
 ; toad@vistaexpertise.net
"RTN","SAMIPAT",41,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIPAT",42,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIPAT",43,0)
 ;
"RTN","SAMIPAT",44,0)
 ;@module-credits
"RTN","SAMIPAT",45,0)
 ;
"RTN","SAMIPAT",46,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIPAT",47,0)
 ; (VA-PALS)
"RTN","SAMIPAT",48,0)
 ; http://va-pals.org/
"RTN","SAMIPAT",49,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIPAT",50,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIPAT",51,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIPAT",52,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIPAT",53,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIPAT",54,0)
 ; http://ielcap.com/
"RTN","SAMIPAT",55,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIPAT",56,0)
 ; http://paraxialtech.com/
"RTN","SAMIPAT",57,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIPAT",58,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIPAT",59,0)
 ;
"RTN","SAMIPAT",60,0)
 ;@project I-ELCAP AIRS Automated Image Reading System
"RTN","SAMIPAT",61,0)
 ; https://www.ielcap-airs.org
"RTN","SAMIPAT",62,0)
 ;@funding 2024, Mt. Sinai Hospital (msh)
"RTN","SAMIPAT",63,0)
 ;@partner-org par
"RTN","SAMIPAT",64,0)
 ;
"RTN","SAMIPAT",65,0)
 ;
"RTN","SAMIPAT",66,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIPAT",67,0)
 ;
"RTN","SAMIPAT",68,0)
 ; 2021-07-01 ven/mcglk&toad 18-12-t2 cbf7e46b
"RTN","SAMIPAT",69,0)
 ;  SAMIPAT new routine, new POS1812.
"RTN","SAMIPAT",70,0)
 ;
"RTN","SAMIPAT",71,0)
 ; 2021-07-22/23 ven/toad 18-12 
"RTN","SAMIPAT",72,0)
 ;  SAMIPAT add PRE1812 pre-install.
"RTN","SAMIPAT",73,0)
 ;
"RTN","SAMIPAT",74,0)
 ; 2021-08-11 ven/mcglk&toad 18-12  b16cd38f
"RTN","SAMIPAT",75,0)
 ;  SAMIPAT rip out PRE1812.
"RTN","SAMIPAT",76,0)
 ;
"RTN","SAMIPAT",77,0)
 ; 2021-09-08 ven/lmry 18-14 2af1f2e7
"RTN","SAMIPAT",78,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",79,0)
 ;
"RTN","SAMIPAT",80,0)
 ; 2021-10-28 ven/lmry 18-15 0b585061
"RTN","SAMIPAT",81,0)
 ;  SAMIPAT create STANDARD sub w/post-install commands used for
"RTN","SAMIPAT",82,0)
 ; almost all patches; chg POS1814 to use STANDARD, add POS1815.
"RTN","SAMIPAT",83,0)
 ;
"RTN","SAMIPAT",84,0)
 ; 2021-10-29 ven/lmry 18-15 6e9594e8
"RTN","SAMIPAT",85,0)
 ;  SAMIPAT remove space before STANDARD.
"RTN","SAMIPAT",86,0)
 ;
"RTN","SAMIPAT",87,0)
 ; 2021-11-14 ven/lmry 18-15-t2 3a30fe59
"RTN","SAMIPAT",88,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",89,0)
 ;
"RTN","SAMIPAT",90,0)
 ; 2021-11-18 ven/lmry 18-15 4d71eef7
"RTN","SAMIPAT",91,0)
 ;  SAMIPAT fix for XINDEX.
"RTN","SAMIPAT",92,0)
 ;
"RTN","SAMIPAT",93,0)
 ; 2021-12-07 ven/lmry 18-15 75a19c5c
"RTN","SAMIPAT",94,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",95,0)
 ;
"RTN","SAMIPAT",96,0)
 ; 2022-04-04 ven/lmry 18-17-t1 258bc926
"RTN","SAMIPAT",97,0)
 ;  SAMIPAT add POS1817.
"RTN","SAMIPAT",98,0)
 ;
"RTN","SAMIPAT",99,0)
 ; 2022-04-27 ven/lmry 18-17-t2 03b87fe
"RTN","SAMIPAT",100,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",101,0)
 ;
"RTN","SAMIPAT",102,0)
 ; 2022-12-13 ven/lmry 18-17-t3 1ebd6e6
"RTN","SAMIPAT",103,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",104,0)
 ;
"RTN","SAMIPAT",105,0)
 ; 2022-12-28 ven/lmry 18-17-t4 956e2716
"RTN","SAMIPAT",106,0)
 ;  SAMIPAT update.
"RTN","SAMIPAT",107,0)
 ;
"RTN","SAMIPAT",108,0)
 ; 2024-08-12 ven/lmry 18-17-b5 eea98cd
"RTN","SAMIPAT",109,0)
 ;  SAMIPAT add POS1818.
"RTN","SAMIPAT",110,0)
 ;
"RTN","SAMIPAT",111,0)
 ; 2024-08-16 ven/lmry 18-17-b6  a1a28de  d0224d9
"RTN","SAMIPAT",112,0)
 ;  SAMIPAT update POS1817.
"RTN","SAMIPAT",113,0)
 ;
"RTN","SAMIPAT",114,0)
 ; 2024-08-26 ven/toad 18-17-b8 SAMIPAT
"RTN","SAMIPAT",115,0)
 ;  (F2z5aM B16870509 EiGtFM) bd5cfb4c
"RTN","SAMIPAT",116,0)
 ; update history, ver-ctrl lines, hdr cmnts.
"RTN","SAMIPAT",117,0)
 ;
"RTN","SAMIPAT",118,0)
 ; 2024-08-26 ven/mcglk 18-17-b8 SAMIPAT
"RTN","SAMIPAT",119,0)
 ;  (F2z5aM B16870509 EiGtFM) a5dae8e9 [in temp v18-17-b6-sinai]
"RTN","SAMIPAT",120,0)
 ; Import rtns fr/commit bd5cfb4c1d58. NOTE: This history will be lost
"RTN","SAMIPAT",121,0)
 ;
"RTN","SAMIPAT",122,0)
 ; 2024-08-29 ven/lmry 18-17-b8 SAMIPAT
"RTN","SAMIPAT",123,0)
 ;  (F2EK5r+ B17344032 E2tdr5N) 6090182e [in temp v18-17-b6-sinai]
"RTN","SAMIPAT",124,0)
 ; update path for SAMIDIR under STANDARD, change update date, also
"RTN","SAMIPAT",125,0)
 ; chg rtn desc to post routines instead of init routines.
"RTN","SAMIPAT",126,0)
 ;
"RTN","SAMIPAT",127,0)
 ; 2024-09-04 ven/toad 18-17-b8 SAMIPAT
"RTN","SAMIPAT",128,0)
 ;  (F3kNXg9 B17344032 E2tdr5N) 9a98cb08 [in temp v18-17-b6-sinai]
"RTN","SAMIPAT",129,0)
 ; fix crash if no background form, vers & chksum: SAMI-18-17-b8.
"RTN","SAMIPAT",130,0)
 ;
"RTN","SAMIPAT",131,0)
 ; 2024-09-06 ven/mcglk 18-17-b8 SAMIPAT
"RTN","SAMIPAT",132,0)
 ;  (F3kNXg9 B17344032 E2tdr5N) a7e5e793
"RTN","SAMIPAT",133,0)
 ; Pulling modified rtns from 18-17-b8 side branch.
"RTN","SAMIPAT",134,0)
 ;
"RTN","SAMIPAT",135,0)
 ; 2024-09-09 ven/lmry 18-18-b1 SAMIPAT
"RTN","SAMIPAT",136,0)
 ;  (F3kp2n B17504242 E2MdtUB) d30d4032
"RTN","SAMIPAT",137,0)
 ; update date/times, checksums, patches; nearly complete routine
"RTN","SAMIPAT",138,0)
 ; uploaded for current checksums.
"RTN","SAMIPAT",139,0)
 ;  (F3wf+B B17504242 E2MdtUB) 4315d4e4
"RTN","SAMIPAT",140,0)
 ; shiny checksummed routine.
"RTN","SAMIPAT",141,0)
 ;  (FR9+fj B17504242 E3msvWY) 884b6766
"RTN","SAMIPAT",142,0)
 ; forgot a thing, so uploading for updated checksums.
"RTN","SAMIPAT",143,0)
 ;  (F1KEQfj B17504242 E3msvWY) f3fb0509
"RTN","SAMIPAT",144,0)
 ; maybe this will be the last time to upload these shiny routines for this build--fingers crossed
"RTN","SAMIPAT",145,0)
 ;
"RTN","SAMIPAT",146,0)
 ; 2024-09-23 ven/lmry 18-19-b1 SAMIPAT
"RTN","SAMIPAT",147,0)
 ;  (F3MDo3g B20732095 E6i2qq) eb2f7628
"RTN","SAMIPAT",148,0)
 ; add POS1819, correcting lines like ";@kids-post POST1812^SAMIPAT"
"RTN","SAMIPAT",149,0)
 ; to remove T for consistency with sub-routine name. Update date/
"RTN","SAMIPAT",150,0)
 ; times, patches, history.
"RTN","SAMIPAT",151,0)
 ;
"RTN","SAMIPAT",152,0)
 ; 2024-09-23 ven/toad 18-19-b1 SAMIPAT
"RTN","SAMIPAT",153,0)
 ;  (F? B23501325 E?)
"RTN","SAMIPAT",154,0)
 ; add chksums to log entries back to 18-17-b8, make lmry lead dev for
"RTN","SAMIPAT",155,0)
 ; rtn.
"RTN","SAMIPAT",156,0)
 ;
"RTN","SAMIPAT",157,0)
 ; 2024-09-24 ven/lmry 18-19-b1 SAMIPAT
"RTN","SAMIPAT",158,0)
 ; Correct label for POS1819.
"RTN","SAMIPAT",159,0)
 ;
"RTN","SAMIPAT",160,0)
 ;@to-do
"RTN","SAMIPAT",161,0)
 ;
"RTN","SAMIPAT",162,0)
 ; extend details pre-18-17-b8, add details.
"RTN","SAMIPAT",163,0)
 ;
"RTN","SAMIPAT",164,0)
 ;@contents
"RTN","SAMIPAT",165,0)
 ;
"RTN","SAMIPAT",166,0)
 ; STANDARD usual post-install commands
"RTN","SAMIPAT",167,0)
 ; POS1812 kids post-install for SAMI-18-12
"RTN","SAMIPAT",168,0)
 ; POS1814 kids post-install for SAMI-18-14
"RTN","SAMIPAT",169,0)
 ; POS1815 kids post-install for SAMI-18-15
"RTN","SAMIPAT",170,0)
 ; POS1817 kids post-install for SAMI-18-17
"RTN","SAMIPAT",171,0)
 ; POS1818 kids post-install for SAMI-18-18
"RTN","SAMIPAT",172,0)
 ; POS1819 kids post-install for SAMI-18-19
"RTN","SAMIPAT",173,0)
 ;
"RTN","SAMIPAT",174,0)
 ;
"RTN","SAMIPAT",175,0)
 ;
"RTN","SAMIPAT",176,0)
 ;
"RTN","SAMIPAT",177,0)
 ;@section 1 subroutine for most patches
"RTN","SAMIPAT",178,0)
 ;
"RTN","SAMIPAT",179,0)
 ;
"RTN","SAMIPAT",180,0)
 ;
"RTN","SAMIPAT",181,0)
 ;
"RTN","SAMIPAT",182,0)
STANDARD ; usual post-install commands
"RTN","SAMIPAT",183,0)
 ;
"RTN","SAMIPAT",184,0)
 set SAMIDIR="/home/osehra/lib/silver/a-sami-vapals-elcap--vv-paraxtech-github/docs/form-fields/"
"RTN","SAMIPAT",185,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"background.tsv","form fields - background")
"RTN","SAMIPAT",186,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"biopsy.tsv","form fields - biopsy")
"RTN","SAMIPAT",187,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"ct-evaluation.tsv","form fields - ct evaluation")
"RTN","SAMIPAT",188,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"follow-up.tsv","form fields - follow up")
"RTN","SAMIPAT",189,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"intake.tsv","form fields - intake")
"RTN","SAMIPAT",190,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"intervention.tsv","form fields - intervention")
"RTN","SAMIPAT",191,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"pet-evaluation.tsv","form fields - pet evaluation")
"RTN","SAMIPAT",192,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"register.tsv","form fields - register")
"RTN","SAMIPAT",193,0)
 do DODD^SAMIADMN(SAMIDIR) ; to import tsv files to generate DD graphs
"RTN","SAMIPAT",194,0)
 do CLRWEB^SAMIADMN ; Clear the M Web Server files cache
"RTN","SAMIPAT",195,0)
 do INIT2GPH^SAMICTD2 ; initialize CTEVAL dictionary into graph cteval-dict
"RTN","SAMIPAT",196,0)
 ;
"RTN","SAMIPAT",197,0)
 ;
"RTN","SAMIPAT",198,0)
 ;
"RTN","SAMIPAT",199,0)
 ;
"RTN","SAMIPAT",200,0)
 ;@section 2 subroutines for SAMI-18-12
"RTN","SAMIPAT",201,0)
 ;
"RTN","SAMIPAT",202,0)
 ;
"RTN","SAMIPAT",203,0)
 ;
"RTN","SAMIPAT",204,0)
 ;
"RTN","SAMIPAT",205,0)
 ;@kids-post POS1812^SAMIPAT
"RTN","SAMIPAT",206,0)
 ;
"RTN","SAMIPAT",207,0)
POS1812 ; kids post-install for SAMI-18-12
"RTN","SAMIPAT",208,0)
 ;
"RTN","SAMIPAT",209,0)
 do ADDSVC^SAMIPARM ; install get params web service
"RTN","SAMIPAT",210,0)
 ;
"RTN","SAMIPAT",211,0)
 ; in honor of Tchaikovsky's overture: boom
"RTN","SAMIPAT",212,0)
 ;
"RTN","SAMIPAT",213,0)
 quit  ; end of kids-post POS1812^SAMIPAT
"RTN","SAMIPAT",214,0)
 ;
"RTN","SAMIPAT",215,0)
 ;
"RTN","SAMIPAT",216,0)
 ;
"RTN","SAMIPAT",217,0)
 ;
"RTN","SAMIPAT",218,0)
 ;@section 3 subroutines for SAMI-18-14
"RTN","SAMIPAT",219,0)
 ;
"RTN","SAMIPAT",220,0)
 ;
"RTN","SAMIPAT",221,0)
 ;
"RTN","SAMIPAT",222,0)
 ;
"RTN","SAMIPAT",223,0)
 ;@kids-post POS1814^SAMIPAT
"RTN","SAMIPAT",224,0)
 ;
"RTN","SAMIPAT",225,0)
POS1814 ; kids post-install for SAMI-18-14
"RTN","SAMIPAT",226,0)
 ;
"RTN","SAMIPAT",227,0)
 do STANDARD
"RTN","SAMIPAT",228,0)
 ;
"RTN","SAMIPAT",229,0)
 quit  ; end of kids-post POS1814^SAMIPAT
"RTN","SAMIPAT",230,0)
 ;
"RTN","SAMIPAT",231,0)
 ;
"RTN","SAMIPAT",232,0)
 ;
"RTN","SAMIPAT",233,0)
 ;
"RTN","SAMIPAT",234,0)
 ;@section 4 subroutines for SAMI-18-15
"RTN","SAMIPAT",235,0)
 ;
"RTN","SAMIPAT",236,0)
 ;
"RTN","SAMIPAT",237,0)
 ;
"RTN","SAMIPAT",238,0)
 ;
"RTN","SAMIPAT",239,0)
 ;@kids-post POS1815^SAMIPAT
"RTN","SAMIPAT",240,0)
 ;
"RTN","SAMIPAT",241,0)
POS1815 ; kids post-install for SAMI-18-15
"RTN","SAMIPAT",242,0)
 ;
"RTN","SAMIPAT",243,0)
 do STANDARD
"RTN","SAMIPAT",244,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-15")
"RTN","SAMIPAT",245,0)
 do deleteService^%webutils("GET","vapals")
"RTN","SAMIPAT",246,0)
 do addService^%webutils("GET","vapals","GETHOME^SAMIHOM3")
"RTN","SAMIPAT",247,0)
 do SETMAP^SAMIPARM("vapals:about","about.html")
"RTN","SAMIPAT",248,0)
 ;
"RTN","SAMIPAT",249,0)
 quit  ; end of kids-post POS1815^SAMIPAT
"RTN","SAMIPAT",250,0)
 ;
"RTN","SAMIPAT",251,0)
 ;
"RTN","SAMIPAT",252,0)
 ;
"RTN","SAMIPAT",253,0)
 ;
"RTN","SAMIPAT",254,0)
 ;@section 5 subroutines for SAMI-18-17
"RTN","SAMIPAT",255,0)
 ;
"RTN","SAMIPAT",256,0)
 ;
"RTN","SAMIPAT",257,0)
 ;
"RTN","SAMIPAT",258,0)
 ;
"RTN","SAMIPAT",259,0)
 ;@kids-post POS1817^SAMIPAT
"RTN","SAMIPAT",260,0)
 ;
"RTN","SAMIPAT",261,0)
POS1817 ; kids post-install for SAMI-18-17
"RTN","SAMIPAT",262,0)
 ;
"RTN","SAMIPAT",263,0)
 do STANDARD
"RTN","SAMIPAT",264,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-17-b8")
"RTN","SAMIPAT",265,0)
 ;
"RTN","SAMIPAT",266,0)
 quit  ; end of kids-post POS1817^SAMIPAT
"RTN","SAMIPAT",267,0)
 ;
"RTN","SAMIPAT",268,0)
 ;
"RTN","SAMIPAT",269,0)
 ;
"RTN","SAMIPAT",270,0)
 ;
"RTN","SAMIPAT",271,0)
 ;@section 6 subroutines for SAMI-18-18
"RTN","SAMIPAT",272,0)
 ;
"RTN","SAMIPAT",273,0)
 ;
"RTN","SAMIPAT",274,0)
 ;
"RTN","SAMIPAT",275,0)
 ;
"RTN","SAMIPAT",276,0)
 ;@kids-post POS1818^SAMIPAT
"RTN","SAMIPAT",277,0)
 ;
"RTN","SAMIPAT",278,0)
POS1818 ; kids post-install for SAMI-18-18
"RTN","SAMIPAT",279,0)
 ;
"RTN","SAMIPAT",280,0)
 do STANDARD
"RTN","SAMIPAT",281,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-18-b1")
"RTN","SAMIPAT",282,0)
 ;
"RTN","SAMIPAT",283,0)
 quit  ; end of kids-post POS1818^SAMIPAT
"RTN","SAMIPAT",284,0)
 ;
"RTN","SAMIPAT",285,0)
 ;
"RTN","SAMIPAT",286,0)
 ;
"RTN","SAMIPAT",287,0)
 ;
"RTN","SAMIPAT",288,0)
 ;@section 7 subroutines for SAMI-18-19
"RTN","SAMIPAT",289,0)
 ;
"RTN","SAMIPAT",290,0)
 ;
"RTN","SAMIPAT",291,0)
 ;
"RTN","SAMIPAT",292,0)
 ;
"RTN","SAMIPAT",293,0)
 ;@kids-post POS1819^SAMIPAT
"RTN","SAMIPAT",294,0)
 ;
"RTN","SAMIPAT",295,0)
POS1819 ; kids post-install for SAMI-18-19
"RTN","SAMIPAT",296,0)
 ;
"RTN","SAMIPAT",297,0)
 do STANDARD
"RTN","SAMIPAT",298,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-19-b1")
"RTN","SAMIPAT",299,0)
 ;
"RTN","SAMIPAT",300,0)
 quit  ; end of kids-post POS1819^SAMIPAT;
"RTN","SAMIPAT",301,0)
 ;
"RTN","SAMIPAT",302,0)
 ;
"RTN","SAMIPAT",303,0)
 ;
"RTN","SAMIPAT",304,0)
 ;@section X subroutines for future versions...
"RTN","SAMIPAT",305,0)
 ;
"RTN","SAMIPAT",306,0)
 ;
"RTN","SAMIPAT",307,0)
 ;
"RTN","SAMIPAT",308,0)
EOR ; end of routine SAMIPAT
"VER")
8.0^22.2
**END**
**END**
