KIDS Distribution saved on Nov 01, 2021@20:52:50
Test Release SAMI*18.0*15 SEQ #15 T1 (sami-18-x-15-t1)
**KIDS**:SAMI*18.0*15^

**INSTALL NAME**
SAMI*18.0*15
"BLD",11517,0)
SAMI*18.0*15^SAMI^0^3211101^n
"BLD",11517,4,0)
^9.64PA^311.14^1
"BLD",11517,4,311.14,0)
311.14
"BLD",11517,4,311.14,222)
y^y^f^^^^y
"BLD",11517,4,"B",311.14,311.14)

"BLD",11517,6.3)
2
"BLD",11517,"INID")
^n
"BLD",11517,"INIT")
POS1815^SAMIPAT
"BLD",11517,"KRN",0)
^9.67PA^1.5^25
"BLD",11517,"KRN",.4,0)
.4
"BLD",11517,"KRN",.401,0)
.401
"BLD",11517,"KRN",.402,0)
.402
"BLD",11517,"KRN",.403,0)
.403
"BLD",11517,"KRN",.5,0)
.5
"BLD",11517,"KRN",.84,0)
.84
"BLD",11517,"KRN",1.5,0)
1.5
"BLD",11517,"KRN",1.6,0)
1.6
"BLD",11517,"KRN",1.61,0)
1.61
"BLD",11517,"KRN",1.62,0)
1.62
"BLD",11517,"KRN",3.6,0)
3.6
"BLD",11517,"KRN",3.8,0)
3.8
"BLD",11517,"KRN",9.2,0)
9.2
"BLD",11517,"KRN",9.8,0)
9.8
"BLD",11517,"KRN",9.8,"NM",0)
^9.68A^19^19
"BLD",11517,"KRN",9.8,"NM",1,0)
SAMIADMN^^0^B83894517
"BLD",11517,"KRN",9.8,"NM",2,0)
SAMICAS3^^0^B497699119
"BLD",11517,"KRN",9.8,"NM",3,0)
SAMICTD2^^0^B193069319
"BLD",11517,"KRN",9.8,"NM",4,0)
SAMICTT0^^0^B100450717
"BLD",11517,"KRN",9.8,"NM",5,0)
SAMICTT3^^0^B385554142
"BLD",11517,"KRN",9.8,"NM",6,0)
SAMICTUL^^0^B107594
"BLD",11517,"KRN",9.8,"NM",7,0)
SAMICUL^^0^B136079
"BLD",11517,"KRN",9.8,"NM",8,0)
SAMIHOM4^^0^B911986320
"BLD",11517,"KRN",9.8,"NM",9,0)
SAMIHUL^^0^B111434
"BLD",11517,"KRN",9.8,"NM",10,0)
SAMIMOV^^0^B53328513
"BLD",11517,"KRN",9.8,"NM",11,0)
SAMINOT1^^0^B553022339
"BLD",11517,"KRN",9.8,"NM",12,0)
SAMINOT2^^0^B485555129
"BLD",11517,"KRN",9.8,"NM",13,0)
SAMINOT3^^0^B302971406
"BLD",11517,"KRN",9.8,"NM",14,0)
SAMINUL^^0^B99336
"BLD",11517,"KRN",9.8,"NM",15,0)
SAMIPARM^^0^B19044741
"BLD",11517,"KRN",9.8,"NM",16,0)
SAMIPAT^^0^B5966351
"BLD",11517,"KRN",9.8,"NM",17,0)
SAMIUR^^0^B672809912
"BLD",11517,"KRN",9.8,"NM",18,0)
SAMIUR2^^0^B1367473447
"BLD",11517,"KRN",9.8,"NM",19,0)
SAMIURUL^^0^B107481
"BLD",11517,"KRN",9.8,"NM","B","SAMIADMN",1)

"BLD",11517,"KRN",9.8,"NM","B","SAMICAS3",2)

"BLD",11517,"KRN",9.8,"NM","B","SAMICTD2",3)

"BLD",11517,"KRN",9.8,"NM","B","SAMICTT0",4)

"BLD",11517,"KRN",9.8,"NM","B","SAMICTT3",5)

"BLD",11517,"KRN",9.8,"NM","B","SAMICTUL",6)

"BLD",11517,"KRN",9.8,"NM","B","SAMICUL",7)

"BLD",11517,"KRN",9.8,"NM","B","SAMIHOM4",8)

"BLD",11517,"KRN",9.8,"NM","B","SAMIHUL",9)

"BLD",11517,"KRN",9.8,"NM","B","SAMIMOV",10)

"BLD",11517,"KRN",9.8,"NM","B","SAMINOT1",11)

"BLD",11517,"KRN",9.8,"NM","B","SAMINOT2",12)

"BLD",11517,"KRN",9.8,"NM","B","SAMINOT3",13)

"BLD",11517,"KRN",9.8,"NM","B","SAMINUL",14)

"BLD",11517,"KRN",9.8,"NM","B","SAMIPARM",15)

"BLD",11517,"KRN",9.8,"NM","B","SAMIPAT",16)

"BLD",11517,"KRN",9.8,"NM","B","SAMIUR",17)

"BLD",11517,"KRN",9.8,"NM","B","SAMIUR2",18)

"BLD",11517,"KRN",9.8,"NM","B","SAMIURUL",19)

"BLD",11517,"KRN",19,0)
19
"BLD",11517,"KRN",19.1,0)
19.1
"BLD",11517,"KRN",101,0)
101
"BLD",11517,"KRN",409.61,0)
409.61
"BLD",11517,"KRN",771,0)
771
"BLD",11517,"KRN",779.2,0)
779.2
"BLD",11517,"KRN",870,0)
870
"BLD",11517,"KRN",8989.51,0)
8989.51
"BLD",11517,"KRN",8989.52,0)
8989.52
"BLD",11517,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",11517,"KRN",8993,0)
8993
"BLD",11517,"KRN",8994,0)
8994
"BLD",11517,"KRN","B",.4,.4)

"BLD",11517,"KRN","B",.401,.401)

"BLD",11517,"KRN","B",.402,.402)

"BLD",11517,"KRN","B",.403,.403)

"BLD",11517,"KRN","B",.5,.5)

"BLD",11517,"KRN","B",.84,.84)

"BLD",11517,"KRN","B",1.5,1.5)

"BLD",11517,"KRN","B",1.6,1.6)

"BLD",11517,"KRN","B",1.61,1.61)

"BLD",11517,"KRN","B",1.62,1.62)

"BLD",11517,"KRN","B",3.6,3.6)

"BLD",11517,"KRN","B",3.8,3.8)

"BLD",11517,"KRN","B",9.2,9.2)

"BLD",11517,"KRN","B",9.8,9.8)

"BLD",11517,"KRN","B",19,19)

"BLD",11517,"KRN","B",19.1,19.1)

"BLD",11517,"KRN","B",101,101)

"BLD",11517,"KRN","B",409.61,409.61)

"BLD",11517,"KRN","B",771,771)

"BLD",11517,"KRN","B",779.2,779.2)

"BLD",11517,"KRN","B",870,870)

"BLD",11517,"KRN","B",8989.51,8989.51)

"BLD",11517,"KRN","B",8989.52,8989.52)

"BLD",11517,"KRN","B",8993,8993)

"BLD",11517,"KRN","B",8994,8994)

"BLD",11517,"QUES",0)
^9.62^^
"BLD",11517,"REQB",0)
^9.611^14^13
"BLD",11517,"REQB",1,0)
SAMI*18.0*1^0
"BLD",11517,"REQB",2,0)
SAMI*18.0*2^0
"BLD",11517,"REQB",3,0)
SAMI*18.0*3^0
"BLD",11517,"REQB",4,0)
SAMI*18.0*4^0
"BLD",11517,"REQB",5,0)
SAMI 18.0T05^0
"BLD",11517,"REQB",6,0)
SAMI*18.0*6^0
"BLD",11517,"REQB",8,0)
SAMI*18.0*8^0
"BLD",11517,"REQB",9,0)
SAMI*18.0*9^0
"BLD",11517,"REQB",10,0)
SAMI*18.0*10^0
"BLD",11517,"REQB",11,0)
SAMI*18.0*11^0
"BLD",11517,"REQB",12,0)
SAMI*18.0*12^0
"BLD",11517,"REQB",13,0)
SAMI*18.0*13^0
"BLD",11517,"REQB",14,0)
SAMI*18.0*14^0
"BLD",11517,"REQB","B","SAMI 18.0T05",5)

"BLD",11517,"REQB","B","SAMI*18.0*1",1)

"BLD",11517,"REQB","B","SAMI*18.0*10",10)

"BLD",11517,"REQB","B","SAMI*18.0*11",11)

"BLD",11517,"REQB","B","SAMI*18.0*12",12)

"BLD",11517,"REQB","B","SAMI*18.0*13",13)

"BLD",11517,"REQB","B","SAMI*18.0*14",14)

"BLD",11517,"REQB","B","SAMI*18.0*2",2)

"BLD",11517,"REQB","B","SAMI*18.0*3",3)

"BLD",11517,"REQB","B","SAMI*18.0*4",4)

"BLD",11517,"REQB","B","SAMI*18.0*6",6)

"BLD",11517,"REQB","B","SAMI*18.0*8",8)

"BLD",11517,"REQB","B","SAMI*18.0*9",9)

"DATA",311.14,1,0)
Non VA
"DATA",311.14,1,1,0)
^311.141^10^10
"DATA",311.14,1,1,1,0)
socialSecurityNumber^Patient ID
"DATA",311.14,1,1,2,0)
socialSecurityNumber.short^PID
"DATA",311.14,1,1,3,0)
socialSecurityNumber.mask
"DATA",311.14,1,1,4,0)
socialSecurityNumber.regex
"DATA",311.14,1,1,5,0)
matchingReportEnabled^true
"DATA",311.14,1,1,6,0)
ruralUrbanChartEnabled^false
"DATA",311.14,1,1,7,0)
lungradsOrElcapCTtemplate^elcap
"DATA",311.14,1,1,8,0)
username^User Name
"DATA",311.14,1,1,9,0)
password^Password
"DATA",311.14,1,1,10,0)
veteransAffairsSite^false
"DATA",311.14,2,0)
VHA
"DATA",311.14,2,1,0)
^311.141^10^10
"DATA",311.14,2,1,1,0)
socialSecurityNumber^Social Security Number
"DATA",311.14,2,1,2,0)
socialSecurityNumber.short^SSN
"DATA",311.14,2,1,3,0)
socialSecurityNumber.mask^000-00-0000
"DATA",311.14,2,1,4,0)
socialSecurityNumber.regex^`(?!(000|666|9(?!99)))\d{3}-(?!00)\d{2}-(?!0000)\d{4}$
"DATA",311.14,2,1,5,0)
matchingReportEnabled^true
"DATA",311.14,2,1,6,0)
ruralUrbanChartEnabled^true
"DATA",311.14,2,1,7,0)
lungradsOrElcapCTtemplate^lungrads
"DATA",311.14,2,1,8,0)
username^Access
"DATA",311.14,2,1,9,0)
password^Verify
"DATA",311.14,2,1,10,0)
veteransAffairsSite^true
"DATA",311.14,3,0)
SYS
"DATA",311.14,3,1,0)
^311.141^7^5
"DATA",311.14,3,1,1,0)
samiSystemVersion^sami-18-15-t1
"DATA",311.14,3,1,2,0)
systemDemoOnly^false
"DATA",311.14,3,1,3,0)
systemDemoUseDUZ
"DATA",311.14,3,1,5,0)
username^Access
"DATA",311.14,3,1,7,0)
password^Verify
"FIA",311.14)
SAMI PARAMETER DEFAULTS
"FIA",311.14,0)
^SAMI(311.14,
"FIA",311.14,0,0)
311.14
"FIA",311.14,0,1)
y^y^f^^^^y
"FIA",311.14,0,10)

"FIA",311.14,0,11)

"FIA",311.14,0,"RLRO")

"FIA",311.14,0,"VR")
18.0^SAMI
"FIA",311.14,311.14)
0
"FIA",311.14,311.141)
0
"INIT")
POS1815^SAMIPAT
"IX",311.14,311.14,"D",0)
311.14^D^PARMS^MU^^F^IR^W^311.141^^^^^LS
"IX",311.14,311.14,"D",1)
S ^SAMI(311.14,"D",X(1),X(3))=$TR(X(2),"`","^")
"IX",311.14,311.14,"D",2)
K ^SAMI(311.14,"D",X(1))
"IX",311.14,311.14,"D",2.5)
K ^SAMI(311.14,"D")
"IX",311.14,311.14,"D",11.1,0)
^.114IA^3^3
"IX",311.14,311.14,"D",11.1,1,0)
1^C^^^30^1
"IX",311.14,311.14,"D",11.1,1,1.5)
S X=$$GET1^DIQ(311.14,DA(1)_",",.01)
"IX",311.14,311.14,"D",11.1,2,0)
2^C
"IX",311.14,311.14,"D",11.1,2,1.5)
S X=$$GET1^DIQ(311.141,DA_","_DA(1)_",",.02)
"IX",311.14,311.14,"D",11.1,3,0)
3^F^311.141^.01^^2^F
"IX",311.14,311.14,"D",11.1,3,3)

"MBREQ")
0
"PKG",230,-1)
1^1
"PKG",230,0)
SAMI^SAMI^SCREENING APPLICATIONS MANAGEMENT - IELCAP
"PKG",230,22,0)
^9.49I^1^1
"PKG",230,22,1,0)
18.0^3191203
"PKG",230,22,1,"PAH",1,0)
15^3211101
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
19
"RTN","SAMIADMN")
0^1^B83894517
"RTN","SAMIADMN",1,0)
SAMIADMN ; ven/arc - IELCAP: Admin tools ;2021-10-29t22:35z
"RTN","SAMIADMN",2,0)
 ;;18.0;SAMI;**15**;2020-01;Build 2
"RTN","SAMIADMN",3,0)
 ;;18-15
"RTN","SAMIADMN",4,0)
 ;
"RTN","SAMIADMN",5,0)
 ;@license: see routine SAMIUL
"RTN","SAMIADMN",6,0)
 ;
"RTN","SAMIADMN",7,0)
 ; Primary development:
"RTN","SAMIADMN",8,0)
 ;
"RTN","SAMIADMN",9,0)
 ; @primary-dev: Alexis Carlson (arc)
"RTN","SAMIADMN",10,0)
 ; @additional-dev: Larry Carlson (lgc)
"RTN","SAMIADMN",11,0)
 ; @additional-dev: George Lilly (gpl)
"RTN","SAMIADMN",12,0)
 ; @additional-dev: Linda M. R. Yaw (lmry)
"RTN","SAMIADMN",13,0)
 ; Primary development organization: Vista Expertise Network (VEN)
"RTN","SAMIADMN",14,0)
 ;
"RTN","SAMIADMN",15,0)
 ; @change-log
"RTN","SAMIADMN",16,0)
 ;   2018-05-03 ven/arc   4a67353e
"RTN","SAMIADMN",17,0)
 ;     New Mumps routine for admin actions, like clearing the web server cache.
"RTN","SAMIADMN",18,0)
 ;   2018-07-01 ven/arc   45cd1b95
"RTN","SAMIADMN",19,0)
 ;     added SETELCAP and SETLUNGRADS to switch between Ct Evaluation forms
"RTN","SAMIADMN",20,0)
 ;   2018-08-14 ven/arc   972c5196,31d4be6f
"RTN","SAMIADMN",21,0)
 ;     web services for setlrads and setelcap, fix to setelcap and 
"RTN","SAMIADMN",22,0)
 ;     setlungrads web services
"RTN","SAMIADMN",23,0)
 ;   2018-08-16 ven/arc   12e4b537
"RTN","SAMIADMN",24,0)
 ;     adding quotes to json, return valid json and added /ctversion
"RTN","SAMIADMN",25,0)
 ;   2018-08-20 ven/gpl   3f2c0f46
"RTN","SAMIADMN",26,0)
 ;     fixed bug in /ctversion
"RTN","SAMIADMN",27,0)
 ;   2018-12-06 ven/lmry  9925713f
"RTN","SAMIADMN",28,0)
 ;     minor edits for SAC compliance
"RTN","SAMIADMN",29,0)
 ;   2018-12-11 ven/lgc   3ceb74b5
"RTN","SAMIADMN",30,0)
 ;     update routines for SAC compliance
"RTN","SAMIADMN",31,0)
 ;   2018-12-27 ven/lgc   d22e0f21
"RTN","SAMIADMN",32,0)
 ;     update routines for SAC compliance
"RTN","SAMIADMN",33,0)
 ;   2019-01-22 ven/lgc   5ddb29c5,53681219
"RTN","SAMIADMN",34,0)
 ;     add license info and edit for lower case initials
"RTN","SAMIADMN",35,0)
 ;   2019-03-12 ven/lmry   0519c1db
"RTN","SAMIADMN",36,0)
 ;     Spell out commands, add table of contents, few format changes, also 
"RTN","SAMIADMN",37,0)
 ;     noted routines used for debugging, added history, added gpl, lgc, me to
"RTN","SAMIADMN",38,0)
 ;     devs
"RTN","SAMIADMN",39,0)
 ;   2019-05-09 ven/lgc   3c969b31
"RTN","SAMIADMN",40,0)
 ;     updated for new web server file
"RTN","SAMIADMN",41,0)
 ;   2019-05-10 ven/lgc   1c7a3aa1
"RTN","SAMIADMN",42,0)
 ;      modifications for new web service file
"RTN","SAMIADMN",43,0)
 ;   2019-05-17 ven/lgc   19798fe7
"RTN","SAMIADMN",44,0)
 ;     correct second line of routines
"RTN","SAMIADMN",45,0)
 ;   2019-05-28 ven/lgc   33e150a2
"RTN","SAMIADMN",46,0)
 ;     replace ^%WO with ^%webapi
"RTN","SAMIADMN",47,0)
 ;   2019-10-11 ven/arc   e4a64268
"RTN","SAMIADMN",48,0)
 ;     Add entry point DODD
"RTN","SAMIADMN",49,0)
 ;   2020-01-17 ven/arc   7936ae40
"RTN","SAMIADMN",50,0)
 ;     Clean up TSV utilities.
"RTN","SAMIADMN",51,0)
 ;   2020-02-04 ven/arc   4981a87a
"RTN","SAMIADMN",52,0)
 ;     Fix TSV utilities. Add utility (DEVMSG) for debug and unit testing
"RTN","SAMIADMN",53,0)
 ;   2020-09-20 ven/lgc 18-15 6771aee4
"RTN","SAMIADMN",54,0)
 ;     Change set msgSubscript= from "Dev Message" to "DEV MSG"
"RTN","SAMIADMN",55,0)
 ;   2021-10-28 ven/lmry  18-15
"RTN","SAMIADMN",56,0)
 ;     Add parameter for path to DODD, added to change log, added short IDs to
"RTN","SAMIADMN",57,0)
 ;     change log, added to toc.
"RTN","SAMIADMN",58,0)
 ;   2021-10-29 ven/lmry 18-15
"RTN","SAMIADMN",59,0)
 ;     Remove null line at bottom of routine for XINDEX
"RTN","SAMIADMN",60,0)
 ;
"RTN","SAMIADMN",61,0)
 quit  ; No entry from top
"RTN","SAMIADMN",62,0)
 ;
"RTN","SAMIADMN",63,0)
 ;@contents
"RTN","SAMIADMN",64,0)
 ; CLRWEB ; Clear the M Web Server files cache
"RTN","SAMIADMN",65,0)
 ; SETELCAP() ; set VA-PALS to use the ELCAP version of the Ct Evaluation form--for 
"RTN","SAMIADMN",66,0)
 ;   debugging
"RTN","SAMIADMN",67,0)
 ; SETLGRDS() ; set VA-PALS to use the LungRads version of the Ct Evaluation form--
"RTN","SAMIADMN",68,0)
 ;   for debugging
"RTN","SAMIADMN",69,0)
 ; WSSTELCP(rtn,filter) ; set VA-PALS to use the ELCAP version of the Ct Evaluation form
"RTN","SAMIADMN",70,0)
 ; WSSTLRAD(rtn,filter) ; set VA-PALS to use the LungRads version of the Ct Evaluation form
"RTN","SAMIADMN",71,0)
 ; WSCTVERS(rtn,filter) ; web service to return the current ctform version
"RTN","SAMIADMN",72,0)
 ; DODD(path) ; Import TSV files to build form field DDs
"RTN","SAMIADMN",73,0)
 ; DEVMSG ; utility for debug and unit testing.
"RTN","SAMIADMN",74,0)
 ;
"RTN","SAMIADMN",75,0)
CLRWEB ; Clear the M Web Server files cache
"RTN","SAMIADMN",76,0)
 ;ven/arc;test;procedure;dirty;silent;non-sac
"RTN","SAMIADMN",77,0)
 ;
"RTN","SAMIADMN",78,0)
 do purgegraph^%wd("html-cache")
"RTN","SAMIADMN",79,0)
 do purgegraph^%wd("seeGraph")
"RTN","SAMIADMN",80,0)
 do build^%yottagr
"RTN","SAMIADMN",81,0)
 ;
"RTN","SAMIADMN",82,0)
 quit  ; end of CLRWEB
"RTN","SAMIADMN",83,0)
 ;
"RTN","SAMIADMN",84,0)
 ;
"RTN","SAMIADMN",85,0)
SETELCAP() ; set VA-PALS to use the ELCAP version of the Ct Evaluation form--debugging
"RTN","SAMIADMN",86,0)
 new GLB,FN,IEN
"RTN","SAMIADMN",87,0)
 set FN=311.11
"RTN","SAMIADMN",88,0)
 set GLB=$name(^SAMI(311.11))
"RTN","SAMIADMN",89,0)
 set IEN=$order(@GLB@("B","vapals:ceform",""))
"RTN","SAMIADMN",90,0)
 if IEN="" do  quit  ;
"RTN","SAMIADMN",91,0)
 . write !,"Error, record vapals:ceform is not found in SAMI FORM MAPPING file!"
"RTN","SAMIADMN",92,0)
 new FDA
"RTN","SAMIADMN",93,0)
 set FDA(FN,IEN_",",2)="ctevaluation-elcap.html"
"RTN","SAMIADMN",94,0)
 new ZERR
"RTN","SAMIADMN",95,0)
 do UPDATE^DIE("","FDA","","ZERR")
"RTN","SAMIADMN",96,0)
 if $data(ZERR) do  quit  ;
"RTN","SAMIADMN",97,0)
 .; ZWR ZERR
"RTN","SAMIADMN",98,0)
 .; do ^ZTER
"RTN","SAMIADMN",99,0)
 quit
"RTN","SAMIADMN",100,0)
 ;
"RTN","SAMIADMN",101,0)
SETLGRDS() ; set VA-PALS to use the LungRads version of the Ct Evaluation form--debugging
"RTN","SAMIADMN",102,0)
 new GLB,FN,IEN
"RTN","SAMIADMN",103,0)
 set FN=311.11
"RTN","SAMIADMN",104,0)
 set GLB=$name(^SAMI(311.11))
"RTN","SAMIADMN",105,0)
 set IEN=$order(@GLB@("B","vapals:ceform",""))
"RTN","SAMIADMN",106,0)
 if IEN="" do  quit  ;
"RTN","SAMIADMN",107,0)
 . write !,"Error, record vapals:ceform is not found in SAMI FORM MAPPING file!"
"RTN","SAMIADMN",108,0)
 new FDA
"RTN","SAMIADMN",109,0)
 set FDA(FN,IEN_",",2)="ctevaluation.html"
"RTN","SAMIADMN",110,0)
 new ZERR
"RTN","SAMIADMN",111,0)
 do UPDATE^DIE("","FDA","","ZERR")
"RTN","SAMIADMN",112,0)
 if $data(ZERR) do  quit  ;
"RTN","SAMIADMN",113,0)
 .; ZWR ZERR
"RTN","SAMIADMN",114,0)
 .; do ^ZTER
"RTN","SAMIADMN",115,0)
 quit
"RTN","SAMIADMN",116,0)
 ;
"RTN","SAMIADMN",117,0)
WSSTELCP(rtn,filter) ; set VA-PALS to use the ELCAP version of the Ct Evaluation form
"RTN","SAMIADMN",118,0)
 new GLB,FN,IEN
"RTN","SAMIADMN",119,0)
 set FN=311.11
"RTN","SAMIADMN",120,0)
 set GLB=$name(^SAMI(311.11))
"RTN","SAMIADMN",121,0)
 set IEN=$order(@GLB@("B","vapals:ceform",""))
"RTN","SAMIADMN",122,0)
 if IEN="" do  quit  ;
"RTN","SAMIADMN",123,0)
 . ;write !,"Error, record vapals:ceform is not found in SAMI FORM MAPPING file!"
"RTN","SAMIADMN",124,0)
 . ;do ^ZTER
"RTN","SAMIADMN",125,0)
 new FDA
"RTN","SAMIADMN",126,0)
 set FDA(FN,IEN_",",2)="ctevaluation-elcap.html"
"RTN","SAMIADMN",127,0)
 new ZERR
"RTN","SAMIADMN",128,0)
 do UPDATE^DIE("","FDA","","ZERR")
"RTN","SAMIADMN",129,0)
 if $data(ZERR) do  quit  ;
"RTN","SAMIADMN",130,0)
 . ;ZWR ZERR
"RTN","SAMIADMN",131,0)
 . ;do ^ZTER
"RTN","SAMIADMN",132,0)
 set rtn="{""status"": ""ok""}"
"RTN","SAMIADMN",133,0)
 quit
"RTN","SAMIADMN",134,0)
 ;
"RTN","SAMIADMN",135,0)
WSSTLRAD(rtn,filter) ; set VA-PALS to use the LungRads version of the Ct Evaluation form
"RTN","SAMIADMN",136,0)
 new GLB,FN,IEN
"RTN","SAMIADMN",137,0)
 set FN=311.11
"RTN","SAMIADMN",138,0)
 set GLB=$name(^SAMI(311.11))
"RTN","SAMIADMN",139,0)
 set IEN=$order(@GLB@("B","vapals:ceform",""))
"RTN","SAMIADMN",140,0)
 if IEN="" do  quit  ;
"RTN","SAMIADMN",141,0)
 . ;write !,"Error, record vapals:ceform is not found in SAMI FORM MAPPING file!"
"RTN","SAMIADMN",142,0)
 . ;do ^ZTER
"RTN","SAMIADMN",143,0)
 new FDA
"RTN","SAMIADMN",144,0)
 set FDA(FN,IEN_",",2)="ctevaluation.html"
"RTN","SAMIADMN",145,0)
 new ZERR
"RTN","SAMIADMN",146,0)
 do UPDATE^DIE("","FDA","","ZERR")
"RTN","SAMIADMN",147,0)
 if $data(ZERR) do  quit  ;
"RTN","SAMIADMN",148,0)
 . ;ZWR ZERR
"RTN","SAMIADMN",149,0)
 . ;do ^ZTER
"RTN","SAMIADMN",150,0)
 set rtn="{""status"": ""ok""}"
"RTN","SAMIADMN",151,0)
 quit
"RTN","SAMIADMN",152,0)
 ;
"RTN","SAMIADMN",153,0)
WSCTVERS(rtn,filter) ; web service to return the current ctform version
"RTN","SAMIADMN",154,0)
 ;
"RTN","SAMIADMN",155,0)
 new fn,ver,ien
"RTN","SAMIADMN",156,0)
 set ien=$order(^SAMI(311.11,"B","vapals:ceform",""))
"RTN","SAMIADMN",157,0)
 quit:ien=""
"RTN","SAMIADMN",158,0)
 set fn=$$GET1^DIQ(311.11,ien_",",2)
"RTN","SAMIADMN",159,0)
 if fn["elcap" set ver="elcap"
"RTN","SAMIADMN",160,0)
 else  set ver="lungrads"
"RTN","SAMIADMN",161,0)
 set rtn="{""ctversion"": """_ver_"""}"
"RTN","SAMIADMN",162,0)
 quit
"RTN","SAMIADMN",163,0)
 ;
"RTN","SAMIADMN",164,0)
WINIT(method,urlpattern,routine) ; Add Web service
"RTN","SAMIADMN",165,0)
 ;Input
"RTN","SAMIADMN",166,0)
 ;  method        = HTTP VERB
"RTN","SAMIADMN",167,0)
 ;  urlpattern    = URI
"RTN","SAMIADMN",168,0)
 ;  routine       = EXECUTION ENDPOINT
"RTN","SAMIADMN",169,0)
 ;Exit
"RTN","SAMIADMN",170,0)
 ;  ien of new service in 17.6001
"RTN","SAMIADMN",171,0)
 quit:($get(method)="") 0
"RTN","SAMIADMN",172,0)
 quit:($get(urlpattern)="") 0
"RTN","SAMIADMN",173,0)
 quit:($get(routine)="") 0
"RTN","SAMIADMN",174,0)
 quit $$addService^%webutils(method,urlpattern,routine)
"RTN","SAMIADMN",175,0)
 ;
"RTN","SAMIADMN",176,0)
WDEL(method,urlpattern) ; Delete a Web service
"RTN","SAMIADMN",177,0)
 ;Input
"RTN","SAMIADMN",178,0)
 ;  method        = HTTP VERB
"RTN","SAMIADMN",179,0)
 ;  urlpattern    = URI
"RTN","SAMIADMN",180,0)
 ;Exit
"RTN","SAMIADMN",181,0)
 ;  none
"RTN","SAMIADMN",182,0)
 quit:($get(method)="")
"RTN","SAMIADMN",183,0)
 quit:($get(urlpattern)="")
"RTN","SAMIADMN",184,0)
 do deleteService^%webutils(method,urlpattern)
"RTN","SAMIADMN",185,0)
 quit
"RTN","SAMIADMN",186,0)
 ;
"RTN","SAMIADMN",187,0)
WINITA ; Build all production web services
"RTN","SAMIADMN",188,0)
 new method,urlpattern,routine,xstr,xcnt,xrslt
"RTN","SAMIADMN",189,0)
 if $data(%ut) set ^TMP("SAMIADMN","WINITA")=0
"RTN","SAMIADMN",190,0)
 f  s xcnt=$g(xcnt)+1,xstr=$text(PRODSERV+xcnt) q:(xstr["***END***")  do
"RTN","SAMIADMN",191,0)
 . set method=$p($piece(xstr,";;",2),",")
"RTN","SAMIADMN",192,0)
 . set urlpattern=$p($piece(xstr,";;",2),",",2)
"RTN","SAMIADMN",193,0)
 . set routine=$p($piece(xstr,";;",2),",",3)
"RTN","SAMIADMN",194,0)
 . set xrslt=$$WINIT^SAMIADMN(method,urlpattern,routine)
"RTN","SAMIADMN",195,0)
 . if '($get(xrslt)) do
"RTN","SAMIADMN",196,0)
 .. set ^TMP("SAMIADMN","WINITA")=1
"RTN","SAMIADMN",197,0)
 .. write !,!,xcnt," ",method," ",urlpattern," ",routine," FAILED",!
"RTN","SAMIADMN",198,0)
 quit
"RTN","SAMIADMN",199,0)
 ;
"RTN","SAMIADMN",200,0)
PRODSERV ;;
"RTN","SAMIADMN",201,0)
 ;;GET,ctversion,WSCTVERS^SAMIADMN,
"RTN","SAMIADMN",202,0)
 ;;GET,ptlookup/{search},WSPTLKUP^SAMIPTLK,
"RTN","SAMIADMN",203,0)
 ;;GET,ruralurbancount,WSGETRU^SAMIRU,
"RTN","SAMIADMN",204,0)
 ;;GET,setelcap,WSSTELCP^SAMIADMN,
"RTN","SAMIADMN",205,0)
 ;;GET,setlungrads,WSSTLRAD^SAMIADMN,
"RTN","SAMIADMN",206,0)
 ;;GET,vapals,WSHOME^SAMIHOM3,
"RTN","SAMIADMN",207,0)
 ;;GET,zipru/{zip},WSZIPRU^SAMIRU,
"RTN","SAMIADMN",208,0)
 ;;POST,vapals,WSVAPALS^SAMIHOM3,
"RTN","SAMIADMN",209,0)
 ;;GET,filesystem/*,FILESYS^%webapi,
"RTN","SAMIADMN",210,0)
 ;;GET,form/*,wsGetForm^%wf,
"RTN","SAMIADMN",211,0)
 ;;GET,global/{root},wsGLOBAL^KBAIVPR,
"RTN","SAMIADMN",212,0)
 ;;GET,graph/{graph},wsGetGraph^%wdgraph,
"RTN","SAMIADMN",213,0)
 ;;GET,gtree/{root},wsGtree^SYNVPR,
"RTN","SAMIADMN",214,0)
 ;;GET,r/{routine?.1"%25".32AN},R^%webapi,
"RTN","SAMIADMN",215,0)
 ;;GET,resources/*,FILESYS^%webapi,
"RTN","SAMIADMN",216,0)
 ;;GET,see/*,wssee^%yottagr,
"RTN","SAMIADMN",217,0)
 ;;GET,testptinfo,wsPTNFO^KBAIPTIN,
"RTN","SAMIADMN",218,0)
 ;;GET,vpr/{dfn},wsVPR^KBAIVPR,
"RTN","SAMIADMN",219,0)
 ;;GET,xml,XML^VPRJRSP,
"RTN","SAMIADMN",220,0)
 ;;POST,form/*,wsPostForm^%wf,
"RTN","SAMIADMN",221,0)
 ;;POST,postform/*,wsPostForm^%wf,
"RTN","SAMIADMN",222,0)
 ;;POST,sami/intake,wsPostForm^%yottaq,
"RTN","SAMIADMN",223,0)
 ;;GET,background,WSSBFORM^SAMIFORM,
"RTN","SAMIADMN",224,0)
 ;;GET,intake,WSSIFORM^SAMIFORM,
"RTN","SAMIADMN",225,0)
 ;;GET,ctevaluation,WSCEFORM^SAMIFORM,
"RTN","SAMIADMN",226,0)
 ;;***END***
"RTN","SAMIADMN",227,0)
 ;
"RTN","SAMIADMN",228,0)
 ;
"RTN","SAMIADMN",229,0)
DODD(path) ; Import TSV files to build form field DDs
"RTN","SAMIADMN",230,0)
 if $get(path)="" set path=$$GET^XPAR("SYS","SAMI FORM FIELDS DEF PATH",,"Q")
"RTN","SAMIADMN",231,0)
 quit:path=""
"RTN","SAMIADMN",232,0)
 ;
"RTN","SAMIADMN",233,0)
 do PRSTSV^SAMIFF(path,"background.tsv","form fields - background")
"RTN","SAMIADMN",234,0)
 do PRSTSV^SAMIFF(path,"biopsy.tsv","form fields - biopsy")
"RTN","SAMIADMN",235,0)
 do PRSTSV^SAMIFF(path,"ct-evaluation.tsv","form fields - ct evaluation")
"RTN","SAMIADMN",236,0)
 do PRSTSV^SAMIFF(path,"follow-up.tsv","form fields - follow up")
"RTN","SAMIADMN",237,0)
 do PRSTSV^SAMIFF(path,"intake.tsv","form fields - intake")
"RTN","SAMIADMN",238,0)
 do PRSTSV^SAMIFF(path,"intervention.tsv","form fields - intervention")
"RTN","SAMIADMN",239,0)
 do PRSTSV^SAMIFF(path,"pet-evaluation.tsv","form fields - pet evaluation")
"RTN","SAMIADMN",240,0)
 do PRSTSV^SAMIFF(path,"register.tsv","form fields - register")
"RTN","SAMIADMN",241,0)
 ;
"RTN","SAMIADMN",242,0)
 quit  ; End of entry point DODD
"RTN","SAMIADMN",243,0)
 ;
"RTN","SAMIADMN",244,0)
 ;
"RTN","SAMIADMN",245,0)
DEVMSG(routine,type,message) ; Create a dev/test message in ^TMP
"RTN","SAMIADMN",246,0)
 ; @input
"RTN","SAMIADMN",247,0)
 ;   routine = routine, with or without entry point (optional)
"RTN","SAMIADMN",248,0)
 ;   type = type of message (optional)
"RTN","SAMIADMN",249,0)
 ;   message
"RTN","SAMIADMN",250,0)
 ;
"RTN","SAMIADMN",251,0)
 quit:$get(message)=""
"RTN","SAMIADMN",252,0)
 set routine=$get(routine)
"RTN","SAMIADMN",253,0)
 set type=$get(type)
"RTN","SAMIADMN",254,0)
 ;
"RTN","SAMIADMN",255,0)
 set msgSubscript="DEV MSG"
"RTN","SAMIADMN",256,0)
 new timestamp set timestamp=$horolog
"RTN","SAMIADMN",257,0)
 new timeSubscript set timeSubscript=$piece(timestamp,",",2)
"RTN","SAMIADMN",258,0)
 ;
"RTN","SAMIADMN",259,0)
 set ^TMP(msgSubscript,$job,0,"TIME")=$piece($$HTE^XLFDT(timestamp,7),"@",2)
"RTN","SAMIADMN",260,0)
 set ^TMP(msgSubscript,$job,0,"ROUTINE")=routine
"RTN","SAMIADMN",261,0)
 set ^TMP(msgSubscript,$job,0,"TYPE")=type
"RTN","SAMIADMN",262,0)
 set ^TMP(msgSubscript,$job,0,"MESSAGE")=message
"RTN","SAMIADMN",263,0)
 ;
"RTN","SAMIADMN",264,0)
 set ^TMP(msgSubscript,$job,timeSubscript,"TIME")=$piece($$HTE^XLFDT(timestamp,7),"@",2)
"RTN","SAMIADMN",265,0)
 set ^TMP(msgSubscript,$job,timeSubscript,"ROUTINE")=routine
"RTN","SAMIADMN",266,0)
 set ^TMP(msgSubscript,$job,timeSubscript,"TYPE")=type
"RTN","SAMIADMN",267,0)
 set ^TMP(msgSubscript,$job,timeSubscript,"MESSAGE")=message
"RTN","SAMIADMN",268,0)
 ;
"RTN","SAMIADMN",269,0)
 quit  ; End of entry point DEVMSG
"RTN","SAMIADMN",270,0)
 ;
"RTN","SAMIADMN",271,0)
 ;
"RTN","SAMIADMN",272,0)
EOR ; End of routine SAMIADMN
"RTN","SAMICAS3")
0^2^B497699119
"RTN","SAMICAS3",1,0)
SAMICAS3 ;ven/gpl - case review cont ;2021-10-26t19:39z
"RTN","SAMICAS3",2,0)
 ;;18.0;SAMI;**3,9,11,12,15**;2020-01;Build 2
"RTN","SAMICAS3",3,0)
 ;;18-15
"RTN","SAMICAS3",4,0)
 ;
"RTN","SAMICAS3",5,0)
 ; SAMICAS3 contains ppis and other subroutines to support processing
"RTN","SAMICAS3",6,0)
 ; of the VAPALS-IELCAP case review page.
"RTN","SAMICAS3",7,0)
 ;
"RTN","SAMICAS3",8,0)
 quit  ; no entry from top
"RTN","SAMICAS3",9,0)
 ;
"RTN","SAMICAS3",10,0)
 ;
"RTN","SAMICAS3",11,0)
 ;
"RTN","SAMICAS3",12,0)
 ;@section 0 primary development: see routine %wful
"RTN","SAMICAS3",13,0)
 ;
"RTN","SAMICAS3",14,0)
 ;
"RTN","SAMICAS3",15,0)
 ;
"RTN","SAMICAS3",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICAS3",17,0)
 ;@documentation see SAMICUL
"RTN","SAMICAS3",18,0)
 ;@contents
"RTN","SAMICAS3",19,0)
 ; WSNFPOST wri-code WSNFPOST^SAMICAS3, post vapals addform: new form
"RTN","SAMICAS3",20,0)
 ; MKSBFORM create background form
"RTN","SAMICAS3",21,0)
 ;
"RTN","SAMICAS3",22,0)
 ; $$PREVNOD key of latest form including nodule grid
"RTN","SAMICAS3",23,0)
 ; $$LASTCMP date & key of last comparison scan
"RTN","SAMICAS3",24,0)
 ; $$PRIORCMP dates of all scans before last comparison scan
"RTN","SAMICAS3",25,0)
 ; $$KEY2DT date to put in prior scans field
"RTN","SAMICAS3",26,0)
 ; SORTFRMS sorts all forms for patient sid by date
"RTN","SAMICAS3",27,0)
 ;
"RTN","SAMICAS3",28,0)
 ; MKCEFORM create ct evaluation form
"RTN","SAMICAS3",29,0)
 ; MKFUFORM create follow-up form
"RTN","SAMICAS3",30,0)
 ; $$BASELNDT last previous baseline ct date
"RTN","SAMICAS3",31,0)
 ; MKPTFORM create pet evaluation form
"RTN","SAMICAS3",32,0)
 ; MKITFORM create intervention form
"RTN","SAMICAS3",33,0)
 ; MKBXFORM create biopsy form
"RTN","SAMICAS3",34,0)
 ; CASETBL generates case review table
"RTN","SAMICAS3",35,0)
 ;
"RTN","SAMICAS3",36,0)
 ;
"RTN","SAMICAS3",37,0)
 ;
"RTN","SAMICAS3",38,0)
 ;@section 1 WSNFPOST & related subroutines
"RTN","SAMICAS3",39,0)
 ;
"RTN","SAMICAS3",40,0)
 ;
"RTN","SAMICAS3",41,0)
 ;
"RTN","SAMICAS3",42,0)
 ;@wri-code WSNFPOST^SAMICAS3
"RTN","SAMICAS3",43,0)
WSNFPOST ; post vapals addform: new form
"RTN","SAMICAS3",44,0)
 ;
"RTN","SAMICAS3",45,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",46,0)
 ;
"RTN","SAMICAS3",47,0)
 ;ven/gpl;wri;procedure;clean;silent;sac;??% tests
"RTN","SAMICAS3",48,0)
 ;@signature
"RTN","SAMICAS3",49,0)
 ; do WSNFPOST^SAMICASE(ARGS,BODY,RESULT)
"RTN","SAMICAS3",50,0)
 ;@branches-from
"RTN","SAMICAS3",51,0)
 ; WSNFPOST^SAMICASE
"RTN","SAMICAS3",52,0)
 ;@ppi-called-by
"RTN","SAMICAS3",53,0)
 ; WSVAPALS^SAMIHOME [wr addform of ws post vapals]
"RTN","SAMICAS3",54,0)
 ;@called-by none
"RTN","SAMICAS3",55,0)
 ;@calls
"RTN","SAMICAS3",56,0)
 ; parseBody^%wf
"RTN","SAMICAS3",57,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMICAS3",58,0)
 ; $$KEYDATE^SAMIHOM3
"RTN","SAMICAS3",59,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",60,0)
 ; $$KEY2FM^SAMICAS2
"RTN","SAMICAS3",61,0)
 ; $$FMADD^XLFDT
"RTN","SAMICAS3",62,0)
 ; WSCASE^SAMICASE
"RTN","SAMICAS3",63,0)
 ; MKSBFORM^SAMICAS3
"RTN","SAMICAS3",64,0)
 ; MKCEFORM^SAMICAS3
"RTN","SAMICAS3",65,0)
 ; MKFUFORM^SAMICAS3
"RTN","SAMICAS3",66,0)
 ; MKBXFORM^SAMICAS3
"RTN","SAMICAS3",67,0)
 ; MKPTFORM^SAMICAS3
"RTN","SAMICAS3",68,0)
 ; MKITFORM^SAMICAS3
"RTN","SAMICAS3",69,0)
 ; wsGetForm^%wf
"RTN","SAMICAS3",70,0)
 ;@input
"RTN","SAMICAS3",71,0)
 ; .ARGS
"RTN","SAMICAS3",72,0)
 ; .ARGS("form")
"RTN","SAMICAS3",73,0)
 ; .ARGS("studyid")
"RTN","SAMICAS3",74,0)
 ; .ARGS("sid")
"RTN","SAMICAS3",75,0)
 ; .BODY
"RTN","SAMICAS3",76,0)
 ; .BODY(1) (e.g. "samiroute=casereview&dfn="_dfn_"&studyid="_studyid)
"RTN","SAMICAS3",77,0)
 ;@output
"RTN","SAMICAS3",78,0)
 ; @RESULT
"RTN","SAMICAS3",79,0)
 ;@tests
"RTN","SAMICAS3",80,0)
 ; UTNFPST^SAMIUTS2
"RTN","SAMICAS3",81,0)
 ;
"RTN","SAMICAS3",82,0)
 ;
"RTN","SAMICAS3",83,0)
 ;@stanza 2 get new form
"RTN","SAMICAS3",84,0)
 ;
"RTN","SAMICAS3",85,0)
 new vars,bdy
"RTN","SAMICAS3",86,0)
 set bdy=$get(BODY(1))
"RTN","SAMICAS3",87,0)
 do parseBody^%wf("vars",.bdy)
"RTN","SAMICAS3",88,0)
 merge vars=ARGS
"RTN","SAMICAS3",89,0)
 merge ^SAMIUL("nuform","vars")=vars
"RTN","SAMICAS3",90,0)
 ;
"RTN","SAMICAS3",91,0)
 new sid set sid=$get(vars("studyid"))
"RTN","SAMICAS3",92,0)
 if sid="" set sid=$get(ARGS("sid"))
"RTN","SAMICAS3",93,0)
 if sid="" do  quit  ;
"RTN","SAMICAS3",94,0)
 . do GETHOME^SAMIHOM3(.RESULT,.ARGS) ; on error return to home page
"RTN","SAMICAS3",95,0)
 . quit
"RTN","SAMICAS3",96,0)
 ;
"RTN","SAMICAS3",97,0)
 set nuform=$get(vars("form"))
"RTN","SAMICAS3",98,0)
 if nuform="" set nuform="ceform"
"RTN","SAMICAS3",99,0)
 ;
"RTN","SAMICAS3",100,0)
 new datekey set datekey=$$KEYDATE^SAMIHOM3($$NOW^XLFDT)
"RTN","SAMICAS3",101,0)
 ;
"RTN","SAMICAS3",102,0)
 ; check to see if form already exists
"RTN","SAMICAS3",103,0)
 ;
"RTN","SAMICAS3",104,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",105,0)
 new collide set collide=0 ; duplicate form for today - backdate forms scenario
"RTN","SAMICAS3",106,0)
 if $data(@root@("graph",sid,nuform_"-"_datekey)) do  ; already exists
"RTN","SAMICAS3",107,0)
 . set collide=1
"RTN","SAMICAS3",108,0)
 . if nuform="siform" quit
"RTN","SAMICAS3",109,0)
 . if nuform="sbform" quit  ; do not create multiple background forms
"RTN","SAMICAS3",110,0)
 . new lastone
"RTN","SAMICAS3",111,0)
 . set lastone=$order(@root@("graph",sid,nuform_"-a  "),-1)
"RTN","SAMICAS3",112,0)
 . quit:lastone=""
"RTN","SAMICAS3",113,0)
 . set newfm=$$KEY2FM^SAMICASE(lastone)
"RTN","SAMICAS3",114,0)
 . set datekey=$$KEYDATE^SAMIHOM3($$FMADD^XLFDT(newfm,1)) ; add one day to the last form
"RTN","SAMICAS3",115,0)
 . quit
"RTN","SAMICAS3",116,0)
 ;
"RTN","SAMICAS3",117,0)
 ; code to not allow two same forms for a patient a day
"RTN","SAMICAS3",118,0)
 ;
"RTN","SAMICAS3",119,0)
 if collide=1 do  quit  ;
"RTN","SAMICAS3",120,0)
 . set ARGS("errorMessage")="Form already exists for today"
"RTN","SAMICAS3",121,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",122,0)
 . do WSCASE^SAMICASE(.RESULT,.ARGS)
"RTN","SAMICAS3",123,0)
 . quit
"RTN","SAMICAS3",124,0)
 ;
"RTN","SAMICAS3",125,0)
 if nuform="sbform" do  ;
"RTN","SAMICAS3",126,0)
 . new oldkey set oldkey=$order(@root@("graph",sid,"sbform"))
"RTN","SAMICAS3",127,0)
 . if $extract(oldkey,1,6)="sbform" do  quit  ;
"RTN","SAMICAS3",128,0)
 . . set ARGS("key")=oldkey
"RTN","SAMICAS3",129,0)
 . . set ARGS("studyid")=sid
"RTN","SAMICAS3",130,0)
 . . set ARGS("form")="vapals:sbform"
"RTN","SAMICAS3",131,0)
 . . quit
"RTN","SAMICAS3",132,0)
 . new key set key="sbform-"_datekey
"RTN","SAMICAS3",133,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",134,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",135,0)
 . set ARGS("form")="vapals:sbform"
"RTN","SAMICAS3",136,0)
 . do MKSBFORM(sid,key)
"RTN","SAMICAS3",137,0)
 . quit
"RTN","SAMICAS3",138,0)
 ;
"RTN","SAMICAS3",139,0)
 if nuform="ceform" do  ;
"RTN","SAMICAS3",140,0)
 . new key set key="ceform-"_datekey
"RTN","SAMICAS3",141,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",142,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",143,0)
 . set ARGS("form")="vapals:ceform"
"RTN","SAMICAS3",144,0)
 . do MKCEFORM(sid,key)
"RTN","SAMICAS3",145,0)
 . quit
"RTN","SAMICAS3",146,0)
 ;
"RTN","SAMICAS3",147,0)
 if nuform="fuform" do  ;
"RTN","SAMICAS3",148,0)
 . new key set key="fuform-"_datekey
"RTN","SAMICAS3",149,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",150,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",151,0)
 . set ARGS("form")="vapals:fuform"
"RTN","SAMICAS3",152,0)
 . do MKFUFORM(sid,key)
"RTN","SAMICAS3",153,0)
 . quit
"RTN","SAMICAS3",154,0)
 ;
"RTN","SAMICAS3",155,0)
 if nuform="bxform" do  ;
"RTN","SAMICAS3",156,0)
 . new key set key="bxform-"_datekey
"RTN","SAMICAS3",157,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",158,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",159,0)
 . set ARGS("form")="vapals:bxform"
"RTN","SAMICAS3",160,0)
 . do MKBXFORM(sid,key)
"RTN","SAMICAS3",161,0)
 . quit
"RTN","SAMICAS3",162,0)
 ;
"RTN","SAMICAS3",163,0)
 if nuform="ptform" do  ;
"RTN","SAMICAS3",164,0)
 . new key set key="ptform-"_datekey
"RTN","SAMICAS3",165,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",166,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",167,0)
 . set ARGS("form")="vapals:ptform"
"RTN","SAMICAS3",168,0)
 . do MKPTFORM(sid,key)
"RTN","SAMICAS3",169,0)
 . quit
"RTN","SAMICAS3",170,0)
 ;
"RTN","SAMICAS3",171,0)
 if nuform="itform" do  ;
"RTN","SAMICAS3",172,0)
 . new key set key="itform-"_datekey
"RTN","SAMICAS3",173,0)
 . set ARGS("key")=key
"RTN","SAMICAS3",174,0)
 . set ARGS("studyid")=sid
"RTN","SAMICAS3",175,0)
 . set ARGS("form")="vapals:itform"
"RTN","SAMICAS3",176,0)
 . do MKITFORM(sid,key)
"RTN","SAMICAS3",177,0)
 . quit
"RTN","SAMICAS3",178,0)
 ;
"RTN","SAMICAS3",179,0)
 do wsGetForm^%wf(.RESULT,.ARGS)
"RTN","SAMICAS3",180,0)
 ;
"RTN","SAMICAS3",181,0)
 ;
"RTN","SAMICAS3",182,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",183,0)
 ;
"RTN","SAMICAS3",184,0)
 quit  ; end of wri WSNFPOST^SAMICASE
"RTN","SAMICAS3",185,0)
 ;
"RTN","SAMICAS3",186,0)
 ;
"RTN","SAMICAS3",187,0)
 ;
"RTN","SAMICAS3",188,0)
MKSBFORM(sid,key) ; create background form
"RTN","SAMICAS3",189,0)
 ;
"RTN","SAMICAS3",190,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",191,0)
 ;
"RTN","SAMICAS3",192,0)
 ;ven/gpl;private;procedure;
"RTN","SAMICAS3",193,0)
 ;@called-by
"RTN","SAMICAS3",194,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",195,0)
 ;@calls
"RTN","SAMICAS3",196,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",197,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",198,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",199,0)
 ;@input
"RTN","SAMICAS3",200,0)
 ; sid = study id
"RTN","SAMICAS3",201,0)
 ; key = form key, e.g. sbform-2021-05-25
"RTN","SAMICAS3",202,0)
 ;@output
"RTN","SAMICAS3",203,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",204,0)
 ;@examples [tbd]
"RTN","SAMICAS3",205,0)
 ;@tests [tbd]
"RTN","SAMICAS3",206,0)
 ;
"RTN","SAMICAS3",207,0)
 ;@stanza 2 create background form
"RTN","SAMICAS3",208,0)
 ;
"RTN","SAMICAS3",209,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",210,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",211,0)
 quit:+sien=0
"RTN","SAMICAS3",212,0)
 ;
"RTN","SAMICAS3",213,0)
 new cdate set cdate=$piece(key,"sbform-",2)
"RTN","SAMICAS3",214,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",215,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",216,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",217,0)
 ;
"RTN","SAMICAS3",218,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",219,0)
 ;
"RTN","SAMICAS3",220,0)
 quit  ; end of MKSBFORM
"RTN","SAMICAS3",221,0)
 ;
"RTN","SAMICAS3",222,0)
 ;
"RTN","SAMICAS3",223,0)
 ;
"RTN","SAMICAS3",224,0)
PREVNOD(sid) ; key of latest form including nodule grid
"RTN","SAMICAS3",225,0)
 ;
"RTN","SAMICAS3",226,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",227,0)
 ;
"RTN","SAMICAS3",228,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",229,0)
 ;@called-by none [commented out in MKCEFORM,MKPTFORM,MKBXFORM]
"RTN","SAMICAS3",230,0)
 ;@calls
"RTN","SAMICAS3",231,0)
 ; SORTFRMS
"RTN","SAMICAS3",232,0)
 ;@input
"RTN","SAMICAS3",233,0)
 ; sid = study id
"RTN","SAMICAS3",234,0)
 ;@output = key of latest form incl nodule grid
"RTN","SAMICAS3",235,0)
 ;@examples [tbd]
"RTN","SAMICAS3",236,0)
 ;@tests [tbd]
"RTN","SAMICAS3",237,0)
 ;
"RTN","SAMICAS3",238,0)
 ; used for nodule copy
"RTN","SAMICAS3",239,0)
 ;
"RTN","SAMICAS3",240,0)
 ;
"RTN","SAMICAS3",241,0)
 ;@stanza 2 calculate key of latest form incl nodule grid
"RTN","SAMICAS3",242,0)
 ;
"RTN","SAMICAS3",243,0)
 new retkey set retkey=""
"RTN","SAMICAS3",244,0)
 new fary
"RTN","SAMICAS3",245,0)
 do SORTFRMS(.fary,sid)
"RTN","SAMICAS3",246,0)
 ;
"RTN","SAMICAS3",247,0)
 new tdt set tdt=""
"RTN","SAMICAS3",248,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",249,0)
 . new tmpkey set tmpkey=""
"RTN","SAMICAS3",250,0)
 . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",251,0)
 . . if tmpkey["ceform" set retkey=tmpkey
"RTN","SAMICAS3",252,0)
 . . if tmpkey["ptform" set retkey=tmpkey
"RTN","SAMICAS3",253,0)
 . . if tmpkey["bxform" set retkey=tmpkey
"RTN","SAMICAS3",254,0)
 . . quit
"RTN","SAMICAS3",255,0)
 . quit
"RTN","SAMICAS3",256,0)
 ;
"RTN","SAMICAS3",257,0)
 ;
"RTN","SAMICAS3",258,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",259,0)
 ;
"RTN","SAMICAS3",260,0)
 quit retkey ; end of $$PREVNOD
"RTN","SAMICAS3",261,0)
 ;
"RTN","SAMICAS3",262,0)
 ;
"RTN","SAMICAS3",263,0)
 ;
"RTN","SAMICAS3",264,0)
LASTCMP(sid,retkey) ; date & key of last comparison scan
"RTN","SAMICAS3",265,0)
 ;
"RTN","SAMICAS3",266,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",267,0)
 ;
"RTN","SAMICAS3",268,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",269,0)
 ;@called-by
"RTN","SAMICAS3",270,0)
 ; MKBXFORM
"RTN","SAMICAS3",271,0)
 ; MKCEFORM
"RTN","SAMICAS3",272,0)
 ; MKFUFORM
"RTN","SAMICAS3",273,0)
 ; MKITFORM
"RTN","SAMICAS3",274,0)
 ; MKPTFORM
"RTN","SAMICAS3",275,0)
 ;@calls
"RTN","SAMICAS3",276,0)
 ; SORTFRMS
"RTN","SAMICAS3",277,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS3",278,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMICAS3",279,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",280,0)
 ;@input
"RTN","SAMICAS3",281,0)
 ; sid = study id
"RTN","SAMICAS3",282,0)
 ;@output = date of last comparison scan
"RTN","SAMICAS3",283,0)
 ; .retkey = key of last comparison scan
"RTN","SAMICAS3",284,0)
 ;@examples [tbd]
"RTN","SAMICAS3",285,0)
 ;@tests [tbd]
"RTN","SAMICAS3",286,0)
 ;
"RTN","SAMICAS3",287,0)
 ;
"RTN","SAMICAS3",288,0)
 ;@stanza 2 calculate date & key of last comparison scan
"RTN","SAMICAS3",289,0)
 ;
"RTN","SAMICAS3",290,0)
 set retkey=""
"RTN","SAMICAS3",291,0)
 new fary
"RTN","SAMICAS3",292,0)
 do SORTFRMS(.fary,sid)
"RTN","SAMICAS3",293,0)
 ;
"RTN","SAMICAS3",294,0)
 ;new tdt set tdt=$piece($$NOW^XLFDT,".",1)+1 ; start with today
"RTN","SAMICAS3",295,0)
 new tdt set tdt=$piece($$NOW^XLFDT,".",1) ; start with before today
"RTN","SAMICAS3",296,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",297,0)
 . new tmpkey set tmpkey=""
"RTN","SAMICAS3",298,0)
 . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:retkey'=""  do  ; 
"RTN","SAMICAS3",299,0)
 . . if tmpkey["ceform" set retkey=tmpkey
"RTN","SAMICAS3",300,0)
 . . quit
"RTN","SAMICAS3",301,0)
 . quit
"RTN","SAMICAS3",302,0)
 ;
"RTN","SAMICAS3",303,0)
 new retdt set retdt=-1
"RTN","SAMICAS3",304,0)
 if retkey'="" do  ;
"RTN","SAMICAS3",305,0)
 . new fmdt set fmdt=$$KEY2FM^SAMICASE(retkey)
"RTN","SAMICAS3",306,0)
 . set retdt=$$VAPALSDT^SAMICASE(fmdt)
"RTN","SAMICAS3",307,0)
 . quit
"RTN","SAMICAS3",308,0)
 ;
"RTN","SAMICAS3",309,0)
 ;
"RTN","SAMICAS3",310,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",311,0)
 ;
"RTN","SAMICAS3",312,0)
 quit retdt ; end of $$LASTCMP
"RTN","SAMICAS3",313,0)
 ;
"RTN","SAMICAS3",314,0)
 ;
"RTN","SAMICAS3",315,0)
 ;
"RTN","SAMICAS3",316,0)
PRIORCMP(sid) ; dates of all scans before last comparison scan
"RTN","SAMICAS3",317,0)
 ;
"RTN","SAMICAS3",318,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",319,0)
 ;
"RTN","SAMICAS3",320,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",321,0)
 ;@called-by
"RTN","SAMICAS3",322,0)
 ; MKCEFORM
"RTN","SAMICAS3",323,0)
 ; MKPTFORM
"RTN","SAMICAS3",324,0)
 ; MKITFORM
"RTN","SAMICAS3",325,0)
 ;@calls
"RTN","SAMICAS3",326,0)
 ; SORTFRMS
"RTN","SAMICAS3",327,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS3",328,0)
 ; $$KEY2DT
"RTN","SAMICAS3",329,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",330,0)
 ;@input
"RTN","SAMICAS3",331,0)
 ; sid = study id
"RTN","SAMICAS3",332,0)
 ;@output = dates of all scans before last comparison scan
"RTN","SAMICAS3",333,0)
 ;@examples [tbd]
"RTN","SAMICAS3",334,0)
 ;@tests [tbd]
"RTN","SAMICAS3",335,0)
 ;
"RTN","SAMICAS3",336,0)
 ;
"RTN","SAMICAS3",337,0)
 ;@stanza 2 calculate dates of all scans before last comparison scan
"RTN","SAMICAS3",338,0)
 ;
"RTN","SAMICAS3",339,0)
 new retstr set retstr=""
"RTN","SAMICAS3",340,0)
 new lastcmp set lastcmp=""
"RTN","SAMICAS3",341,0)
 new fary
"RTN","SAMICAS3",342,0)
 do SORTFRMS(.fary,sid)
"RTN","SAMICAS3",343,0)
 ;
"RTN","SAMICAS3",344,0)
 ;new tdt set tdt=$piece($$NOW^XLFDT,".",1)+1 ; start with today
"RTN","SAMICAS3",345,0)
 new tdt set tdt=$piece($$NOW^XLFDT,".",1) ; start with before today
"RTN","SAMICAS3",346,0)
 for  set tdt=$order(fary(tdt),-1) quit:tdt=""  do  ; 
"RTN","SAMICAS3",347,0)
 . ;
"RTN","SAMICAS3",348,0)
 . if lastcmp="" do  ; first find the last comparison scan
"RTN","SAMICAS3",349,0)
 . . new tmpkey set tmpkey=""
"RTN","SAMICAS3",350,0)
 . . for  set tmpkey=$order(fary(tdt,tmpkey)) quit:tmpkey=""  quit:lastcmp'=""  do  ; 
"RTN","SAMICAS3",351,0)
 . . . if tmpkey["ceform" set lastcmp=tmpkey
"RTN","SAMICAS3",352,0)
 . . . quit
"RTN","SAMICAS3",353,0)
 . . quit
"RTN","SAMICAS3",354,0)
 . ;
"RTN","SAMICAS3",355,0)
 . do  ;
"RTN","SAMICAS3",356,0)
 . . ; next add all previous scans to retstr
"RTN","SAMICAS3",357,0)
 . . new tmpkey2 set tmpkey2=""
"RTN","SAMICAS3",358,0)
 . . for  set tmpkey2=$order(fary(tdt,tmpkey2)) quit:tmpkey2=""  do  ; 
"RTN","SAMICAS3",359,0)
 . . . if tmpkey2["ceform" do  ; convert to external date
"RTN","SAMICAS3",360,0)
 . . . . set retstr=$$KEY2DT(tmpkey2)_retstr
"RTN","SAMICAS3",361,0)
 . . . . quit
"RTN","SAMICAS3",362,0)
 . . . quit
"RTN","SAMICAS3",363,0)
 . . quit
"RTN","SAMICAS3",364,0)
 . quit
"RTN","SAMICAS3",365,0)
 ;
"RTN","SAMICAS3",366,0)
 if $extract(retstr,$length(retstr))="," do
"RTN","SAMICAS3",367,0)
 . set retstr=$extract(retstr,1,$length(retstr)-1)
"RTN","SAMICAS3",368,0)
 . quit
"RTN","SAMICAS3",369,0)
 ;
"RTN","SAMICAS3",370,0)
 ;if retstr="" set retstr=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",371,0)
 ;
"RTN","SAMICAS3",372,0)
 ;
"RTN","SAMICAS3",373,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",374,0)
 ;
"RTN","SAMICAS3",375,0)
 quit retstr ; end of $$PRIORCMP
"RTN","SAMICAS3",376,0)
 ;
"RTN","SAMICAS3",377,0)
 ;
"RTN","SAMICAS3",378,0)
 ;
"RTN","SAMICAS3",379,0)
KEY2DT(key) ; date to put in prior scans field
"RTN","SAMICAS3",380,0)
 ;
"RTN","SAMICAS3",381,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",382,0)
 ;
"RTN","SAMICAS3",383,0)
 ;ven/gpl;private;function;clean;silent;sac;
"RTN","SAMICAS3",384,0)
 ;@called-by
"RTN","SAMICAS3",385,0)
 ; $$PRIORCMP
"RTN","SAMICAS3",386,0)
 ;@calls
"RTN","SAMICAS3",387,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMICAS3",388,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",389,0)
 ;@input
"RTN","SAMICAS3",390,0)
 ; key = form key, e.g. ctform-2021-05-25
"RTN","SAMICAS3",391,0)
 ;@output = date to put in prior scans field
"RTN","SAMICAS3",392,0)
 ;@examples [tbd]
"RTN","SAMICAS3",393,0)
 ;@tests [tbd]
"RTN","SAMICAS3",394,0)
 ;
"RTN","SAMICAS3",395,0)
 ;
"RTN","SAMICAS3",396,0)
 ;@stanza 2 calculate prior scans date
"RTN","SAMICAS3",397,0)
 ;
"RTN","SAMICAS3",398,0)
 new retstr2 set retstr2=""
"RTN","SAMICAS3",399,0)
 new fmdt set fmdt=$$KEY2FM^SAMICASE(tmpkey2)
"RTN","SAMICAS3",400,0)
 set retstr2=$$VAPALSDT^SAMICASE(fmdt)_","_retstr2
"RTN","SAMICAS3",401,0)
 ;
"RTN","SAMICAS3",402,0)
 ;
"RTN","SAMICAS3",403,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",404,0)
 ;
"RTN","SAMICAS3",405,0)
 quit retstr2 ; end of $$KEY2DT
"RTN","SAMICAS3",406,0)
 ;
"RTN","SAMICAS3",407,0)
 ;
"RTN","SAMICAS3",408,0)
 ;
"RTN","SAMICAS3",409,0)
SORTFRMS(ARY,sid) ; sorts all forms for patient sid by date
"RTN","SAMICAS3",410,0)
 ;
"RTN","SAMICAS3",411,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",412,0)
 ;
"RTN","SAMICAS3",413,0)
 ;ven/gpl;private;procedure;clean;silent;sac;
"RTN","SAMICAS3",414,0)
 ;@called-by
"RTN","SAMICAS3",415,0)
 ; $$PREVNOD
"RTN","SAMICAS3",416,0)
 ; $$LASTCMP
"RTN","SAMICAS3",417,0)
 ; $$PRIORCMP
"RTN","SAMICAS3",418,0)
 ;@calls
"RTN","SAMICAS3",419,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",420,0)
 ; ^%DT
"RTN","SAMICAS3",421,0)
 ; ^%ZTER
"RTN","SAMICAS3",422,0)
 ;@input
"RTN","SAMICAS3",423,0)
 ; sid = study id
"RTN","SAMICAS3",424,0)
 ;@output
"RTN","SAMICAS3",425,0)
 ; .ARY: sorted array of all forms for patient by date
"RTN","SAMICAS3",426,0)
 ;  ARY(fmdate,key)=""
"RTN","SAMICAS3",427,0)
 ;@examples [tbd]
"RTN","SAMICAS3",428,0)
 ;@tests [tbd]
"RTN","SAMICAS3",429,0)
 ;
"RTN","SAMICAS3",430,0)
 ;
"RTN","SAMICAS3",431,0)
 ;@stanza 2 sort patient's forms by date
"RTN","SAMICAS3",432,0)
 ;
"RTN","SAMICAS3",433,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",434,0)
 quit:'$data(@root@("graph",sid))
"RTN","SAMICAS3",435,0)
 new froot set froot=$name(@root@("graph",sid))
"RTN","SAMICAS3",436,0)
 ;
"RTN","SAMICAS3",437,0)
 new zi set zi=""
"RTN","SAMICAS3",438,0)
 for  set zi=$order(@froot@(zi)) quit:zi=""  do  ;
"RTN","SAMICAS3",439,0)
 . new ftype set ftype=$piece(zi,"-",1)
"RTN","SAMICAS3",440,0)
 . new fdate set fdate=$piece(zi,ftype_"-",2)
"RTN","SAMICAS3",441,0)
 . new X,Y
"RTN","SAMICAS3",442,0)
 . set X=fdate
"RTN","SAMICAS3",443,0)
 . do ^%DT
"RTN","SAMICAS3",444,0)
 . if Y=-1 do ^%ZTER quit  ;
"RTN","SAMICAS3",445,0)
 . set ARY(Y,zi)=""
"RTN","SAMICAS3",446,0)
 . quit
"RTN","SAMICAS3",447,0)
 ;
"RTN","SAMICAS3",448,0)
 ;
"RTN","SAMICAS3",449,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",450,0)
 ;
"RTN","SAMICAS3",451,0)
 quit  ; end of SORTFRMS
"RTN","SAMICAS3",452,0)
 ;
"RTN","SAMICAS3",453,0)
 ;
"RTN","SAMICAS3",454,0)
 ;
"RTN","SAMICAS3",455,0)
MKCEFORM(sid,key) ; create ct evaluation form
"RTN","SAMICAS3",456,0)
 ;
"RTN","SAMICAS3",457,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",458,0)
 ;
"RTN","SAMICAS3",459,0)
 ;ven/gpl;private;procedure;clean;silent;sac;
"RTN","SAMICAS3",460,0)
 ;@called-by
"RTN","SAMICAS3",461,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",462,0)
 ;@calls
"RTN","SAMICAS3",463,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",464,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",465,0)
 ; $$LASTCMP
"RTN","SAMICAS3",466,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",467,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",468,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS3",469,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",470,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",471,0)
 ; $$PRIORCMP^SAMICAS3
"RTN","SAMICAS3",472,0)
 ;@input
"RTN","SAMICAS3",473,0)
 ; sid = study id
"RTN","SAMICAS3",474,0)
 ; key = form key, e.g. ceform-2021-05-25
"RTN","SAMICAS3",475,0)
 ;@output
"RTN","SAMICAS3",476,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",477,0)
 ;@examples [tbd]
"RTN","SAMICAS3",478,0)
 ;@tests [tbd]
"RTN","SAMICAS3",479,0)
 ;
"RTN","SAMICAS3",480,0)
 ;
"RTN","SAMICAS3",481,0)
 ;@stanza 2 create ct eval form
"RTN","SAMICAS3",482,0)
 ;
"RTN","SAMICAS3",483,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",484,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",485,0)
 quit:+sien=0
"RTN","SAMICAS3",486,0)
 new cdate set cdate=$piece(key,"ceform-",2)
"RTN","SAMICAS3",487,0)
 ;
"RTN","SAMICAS3",488,0)
 ; nodule copy
"RTN","SAMICAS3",489,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",490,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",491,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",492,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",493,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",494,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",495,0)
 . quit
"RTN","SAMICAS3",496,0)
 ; end nodule copy
"RTN","SAMICAS3",497,0)
 ;
"RTN","SAMICAS3",498,0)
 ; new items,prevct
"RTN","SAMICAS3",499,0)
 ; do GETITEMS^SAMICASE("items",sid)
"RTN","SAMICAS3",500,0)
 ; set prevct=""
"RTN","SAMICAS3",501,0)
 ; if $data(items("type","vapals:ceform")) do  ; previous cteval exists
"RTN","SAMICAS3",502,0)
 ; . set prevct=$order(items("type","vapals:ceform",""),-1) ; latest ceform
"RTN","SAMICAS3",503,0)
 ; . quit
"RTN","SAMICAS3",504,0)
 ; if prevct'="" do  ;
"RTN","SAMICAS3",505,0)
 ; . new target,source
"RTN","SAMICAS3",506,0)
 ; . set source=$name(@root@("graph",sid,prevct))
"RTN","SAMICAS3",507,0)
 ; . set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",508,0)
 ; . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",509,0)
 ; . quit
"RTN","SAMICAS3",510,0)
 ;
"RTN","SAMICAS3",511,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",512,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",513,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",514,0)
 ;
"RTN","SAMICAS3",515,0)
 ; set baseline CT date and last comparison scan date
"RTN","SAMICAS3",516,0)
 do  ;
"RTN","SAMICAS3",517,0)
 . new basedt
"RTN","SAMICAS3",518,0)
 . set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",519,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",520,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",521,0)
 . if lastdt=-1 set lastdt=""
"RTN","SAMICAS3",522,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS3(sid)
"RTN","SAMICAS3",523,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",524,0)
 . if priordt="" set priordt=lastdt
"RTN","SAMICAS3",525,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",526,0)
 . set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",527,0)
 . set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",528,0)
 . quit
"RTN","SAMICAS3",529,0)
 ;
"RTN","SAMICAS3",530,0)
 ;
"RTN","SAMICAS3",531,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",532,0)
 ;
"RTN","SAMICAS3",533,0)
 quit  ; end of MKCEFORM
"RTN","SAMICAS3",534,0)
 ;
"RTN","SAMICAS3",535,0)
 ;
"RTN","SAMICAS3",536,0)
 ;
"RTN","SAMICAS3",537,0)
MKFUFORM(sid,key) ; create Follow-up form
"RTN","SAMICAS3",538,0)
 ;
"RTN","SAMICAS3",539,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",540,0)
 ;
"RTN","SAMICAS3",541,0)
 ;ven/gpl;private;procedure;clean;silent;sac;
"RTN","SAMICAS3",542,0)
 ;@called-by
"RTN","SAMICAS3",543,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",544,0)
 ;@calls
"RTN","SAMICAS3",545,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",546,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",547,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMICAS3",548,0)
 ; $$BASELNDT
"RTN","SAMICAS3",549,0)
 ; $$LASTCMP
"RTN","SAMICAS3",550,0)
 ; $$NOW^XLFDT
"RTN","SAMICAS3",551,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",552,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",553,0)
 ;@input
"RTN","SAMICAS3",554,0)
 ; sid = study id
"RTN","SAMICAS3",555,0)
 ; key = form key, e.g. fuform-2021-05-25
"RTN","SAMICAS3",556,0)
 ;@output
"RTN","SAMICAS3",557,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",558,0)
 ;@examples [tbd]
"RTN","SAMICAS3",559,0)
 ;@tests [tbd]
"RTN","SAMICAS3",560,0)
 ;
"RTN","SAMICAS3",561,0)
 ;
"RTN","SAMICAS3",562,0)
 ;@stanza 2 create Follow-up form
"RTN","SAMICAS3",563,0)
 ;
"RTN","SAMICAS3",564,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",565,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",566,0)
 quit:+sien=0
"RTN","SAMICAS3",567,0)
 ;
"RTN","SAMICAS3",568,0)
 new cdate set cdate=$piece(key,"fuform-",2)
"RTN","SAMICAS3",569,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",570,0)
 ;
"RTN","SAMICAS3",571,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",572,0)
 set @root@("graph",sid,key,"sidof")=$$KEY2DSPD^SAMICAS2(cdate)
"RTN","SAMICAS3",573,0)
 new basedt
"RTN","SAMICAS3",574,0)
 set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",575,0)
 if basedt=-1 set basedt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",576,0)
 if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",577,0)
 set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",578,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",579,0)
 ;
"RTN","SAMICAS3",580,0)
 ;
"RTN","SAMICAS3",581,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",582,0)
 ;
"RTN","SAMICAS3",583,0)
 quit  ; end of MKFUFORM
"RTN","SAMICAS3",584,0)
 ;
"RTN","SAMICAS3",585,0)
 ;
"RTN","SAMICAS3",586,0)
 ;
"RTN","SAMICAS3",587,0)
BASELNDT(sid) ; last previous baseline ct date
"RTN","SAMICAS3",588,0)
 ;
"RTN","SAMICAS3",589,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",590,0)
 ;
"RTN","SAMICAS3",591,0)
 ;ven/gpl;private;function;clean;silent;sac
"RTN","SAMICAS3",592,0)
 ;@called-by
"RTN","SAMICAS3",593,0)
 ; MKCEFORM
"RTN","SAMICAS3",594,0)
 ; MKFUFORM
"RTN","SAMICAS3",595,0)
 ; MKPTFORM
"RTN","SAMICAS3",596,0)
 ; MKITFORM
"RTN","SAMICAS3",597,0)
 ;@calls
"RTN","SAMICAS3",598,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",599,0)
 ; GETITEMS^SAMICASE
"RTN","SAMICAS3",600,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMICAS3",601,0)
 ;@input
"RTN","SAMICAS3",602,0)
 ; sid = study id
"RTN","SAMICAS3",603,0)
 ;@output = last previous baseline ct date
"RTN","SAMICAS3",604,0)
 ;@examples [tbd]
"RTN","SAMICAS3",605,0)
 ;@tests [tbd]
"RTN","SAMICAS3",606,0)
 ;
"RTN","SAMICAS3",607,0)
 ;
"RTN","SAMICAS3",608,0)
 ;@stanza 2 calculate last previous baseline ct date
"RTN","SAMICAS3",609,0)
 ;
"RTN","SAMICAS3",610,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",611,0)
 new groot set groot=$name(@root@("graph",sid))
"RTN","SAMICAS3",612,0)
 new items set items=""
"RTN","SAMICAS3",613,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMICAS3",614,0)
 quit:'$data(items) ""
"RTN","SAMICAS3",615,0)
 ;
"RTN","SAMICAS3",616,0)
 new bdate set bdate=""
"RTN","SAMICAS3",617,0)
 new bkey set bkey=""
"RTN","SAMICAS3",618,0)
 new done set done=0
"RTN","SAMICAS3",619,0)
 for  set bkey=$order(items("type","vapals:ceform",bkey)) quit:bkey=""  do  ;
"RTN","SAMICAS3",620,0)
 . ; write !,bkey," ",$get(@groot@(bkey,"cetex"))
"RTN","SAMICAS3",621,0)
 . if $get(@groot@(bkey,"cetex"))="b" do  ;
"RTN","SAMICAS3",622,0)
 . . set done=1
"RTN","SAMICAS3",623,0)
 . . set bdate=$piece(bkey,"ceform-",2)
"RTN","SAMICAS3",624,0)
 . . quit
"RTN","SAMICAS3",625,0)
 . quit
"RTN","SAMICAS3",626,0)
 set bdate=$$KEY2DSPD^SAMICAS2(bdate)
"RTN","SAMICAS3",627,0)
 ;
"RTN","SAMICAS3",628,0)
 ;
"RTN","SAMICAS3",629,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",630,0)
 ;
"RTN","SAMICAS3",631,0)
 quit bdate ; end of $$BASELNDT
"RTN","SAMICAS3",632,0)
 ;
"RTN","SAMICAS3",633,0)
 ;
"RTN","SAMICAS3",634,0)
 ;
"RTN","SAMICAS3",635,0)
MKPTFORM(sid,key) ; create pet evaluation form
"RTN","SAMICAS3",636,0)
 ;
"RTN","SAMICAS3",637,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",638,0)
 ;
"RTN","SAMICAS3",639,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",640,0)
 ;@called-by
"RTN","SAMICAS3",641,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",642,0)
 ;@calls
"RTN","SAMICAS3",643,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",644,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",645,0)
 ; $$LASTCMP
"RTN","SAMICAS3",646,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",647,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",648,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS3",649,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",650,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",651,0)
 ; $$PRIORCMP^SAMICAS3
"RTN","SAMICAS3",652,0)
 ;@input
"RTN","SAMICAS3",653,0)
 ; sid = study id
"RTN","SAMICAS3",654,0)
 ; key = form key, e.g. ptform-2021-05-25
"RTN","SAMICAS3",655,0)
 ;@output
"RTN","SAMICAS3",656,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",657,0)
 ;@examples [tbd]
"RTN","SAMICAS3",658,0)
 ;@tests [tbd]
"RTN","SAMICAS3",659,0)
 ;
"RTN","SAMICAS3",660,0)
 ;
"RTN","SAMICAS3",661,0)
 ;@stanza 2 create pet eval form
"RTN","SAMICAS3",662,0)
 ;
"RTN","SAMICAS3",663,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",664,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",665,0)
 quit:+sien=0
"RTN","SAMICAS3",666,0)
 ;
"RTN","SAMICAS3",667,0)
 ; nodule copy
"RTN","SAMICAS3",668,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",669,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",670,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",671,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",672,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",673,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",674,0)
 . quit
"RTN","SAMICAS3",675,0)
 ; end nodule copy
"RTN","SAMICAS3",676,0)
 ;
"RTN","SAMICAS3",677,0)
 new cdate set cdate=$piece(key,"ptform-",2)
"RTN","SAMICAS3",678,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",679,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",680,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",681,0)
 ;
"RTN","SAMICAS3",682,0)
 do  ;
"RTN","SAMICAS3",683,0)
 . new basedt
"RTN","SAMICAS3",684,0)
 . set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",685,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",686,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",687,0)
 . if lastdt=-1 set lastdt=basedt
"RTN","SAMICAS3",688,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS3(sid)
"RTN","SAMICAS3",689,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",690,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",691,0)
 . ; set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",692,0)
 . set @root@("graph",sid,key,"cedos")=lastdt ; it's different than on the ce
"RTN","SAMICAS3",693,0)
 . ; set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",694,0)
 . quit
"RTN","SAMICAS3",695,0)
 ;
"RTN","SAMICAS3",696,0)
 ;
"RTN","SAMICAS3",697,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",698,0)
 ;
"RTN","SAMICAS3",699,0)
 quit  ; end of MKPTFORM
"RTN","SAMICAS3",700,0)
 ;
"RTN","SAMICAS3",701,0)
 ;
"RTN","SAMICAS3",702,0)
 ;
"RTN","SAMICAS3",703,0)
MKITFORM(sid,key) ; create intervention form
"RTN","SAMICAS3",704,0)
 ;
"RTN","SAMICAS3",705,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",706,0)
 ;
"RTN","SAMICAS3",707,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",708,0)
 ;@called-by
"RTN","SAMICAS3",709,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",710,0)
 ;@calls
"RTN","SAMICAS3",711,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",712,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",713,0)
 ; $$PREVNODE [commented out]
"RTN","SAMICAS3",714,0)
 ; $$LASTCMP
"RTN","SAMICAS3",715,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",716,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",717,0)
 ; $$BASELNDT^SAMICAS3
"RTN","SAMICAS3",718,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMICAS3",719,0)
 ; $$LASTCMP^SAMICAS3
"RTN","SAMICAS3",720,0)
 ; $$PRIORCMP^SAMICAS3
"RTN","SAMICAS3",721,0)
 ;@input
"RTN","SAMICAS3",722,0)
 ; sid = study id
"RTN","SAMICAS3",723,0)
 ; key = form key, e.g. itform-2021-05-25
"RTN","SAMICAS3",724,0)
 ;@output
"RTN","SAMICAS3",725,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",726,0)
 ;@examples [tbd]
"RTN","SAMICAS3",727,0)
 ;@tests [tbd]
"RTN","SAMICAS3",728,0)
 ;
"RTN","SAMICAS3",729,0)
 ;
"RTN","SAMICAS3",730,0)
 ;@stanza 2 create intervention form
"RTN","SAMICAS3",731,0)
 ;
"RTN","SAMICAS3",732,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",733,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",734,0)
 quit:+sien=0
"RTN","SAMICAS3",735,0)
 ;
"RTN","SAMICAS3",736,0)
 new cdate set cdate=$piece(key,"itform-",2)
"RTN","SAMICAS3",737,0)
 ;
"RTN","SAMICAS3",738,0)
 ; nodule copy
"RTN","SAMICAS3",739,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",740,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",741,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",742,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",743,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",744,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",745,0)
 . quit
"RTN","SAMICAS3",746,0)
 ; end nodule copy
"RTN","SAMICAS3",747,0)
 ;
"RTN","SAMICAS3",748,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",749,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",750,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",751,0)
 ;
"RTN","SAMICAS3",752,0)
 do  ;
"RTN","SAMICAS3",753,0)
 . new basedt
"RTN","SAMICAS3",754,0)
 . set basedt=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMICAS3",755,0)
 . if basedt=-1 set basedt=$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMICAS3",756,0)
 . new lastdt set lastdt=$$LASTCMP^SAMICAS3(sid)
"RTN","SAMICAS3",757,0)
 . if lastdt=-1 set lastdt=basedt
"RTN","SAMICAS3",758,0)
 . new priordt set priordt=$$PRIORCMP^SAMICAS3(sid)
"RTN","SAMICAS3",759,0)
 . if priordt=-1 set priordt=lastdt
"RTN","SAMICAS3",760,0)
 . set @root@("graph",sid,key,"sidoe")=basedt
"RTN","SAMICAS3",761,0)
 . ; set @root@("graph",sid,key,"cedcs")=lastdt
"RTN","SAMICAS3",762,0)
 . set @root@("graph",sid,key,"cedos")=lastdt ; it's different than on the ce
"RTN","SAMICAS3",763,0)
 . ; set @root@("graph",sid,key,"cedps")=priordt
"RTN","SAMICAS3",764,0)
 . quit
"RTN","SAMICAS3",765,0)
 ;
"RTN","SAMICAS3",766,0)
 ;
"RTN","SAMICAS3",767,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",768,0)
 ;
"RTN","SAMICAS3",769,0)
 quit  ; end of MKITFORM
"RTN","SAMICAS3",770,0)
 ;
"RTN","SAMICAS3",771,0)
 ;
"RTN","SAMICAS3",772,0)
 ;
"RTN","SAMICAS3",773,0)
MKBXFORM(sid,key) ; create biopsy form
"RTN","SAMICAS3",774,0)
 ;
"RTN","SAMICAS3",775,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",776,0)
 ;
"RTN","SAMICAS3",777,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",778,0)
 ;@called-by
"RTN","SAMICAS3",779,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMICAS3",780,0)
 ;@calls
"RTN","SAMICAS3",781,0)
 ; $$setroot^%wd
"RTN","SAMICAS3",782,0)
 ; $$SID2NUM^SAMIHOM3
"RTN","SAMICAS3",783,0)
 ; $$LASTCMP
"RTN","SAMICAS3",784,0)
 ; CTCOPY^SAMICTC1
"RTN","SAMICAS3",785,0)
 ; SSAMISTA^SAMICASE
"RTN","SAMICAS3",786,0)
 ;@input
"RTN","SAMICAS3",787,0)
 ; sid = study id
"RTN","SAMICAS3",788,0)
 ; key = form key, e.g. bxform-2021-05-25
"RTN","SAMICAS3",789,0)
 ;@output
"RTN","SAMICAS3",790,0)
 ; @root@("graph",sid,key)
"RTN","SAMICAS3",791,0)
 ;@examples [tbd]
"RTN","SAMICAS3",792,0)
 ;@tests [tbd]
"RTN","SAMICAS3",793,0)
 ;
"RTN","SAMICAS3",794,0)
 ;
"RTN","SAMICAS3",795,0)
 ;@stanza 2 create background form
"RTN","SAMICAS3",796,0)
 ;
"RTN","SAMICAS3",797,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMICAS3",798,0)
 new sien set sien=$$SID2NUM^SAMIHOM3(sid)
"RTN","SAMICAS3",799,0)
 quit:+sien=0
"RTN","SAMICAS3",800,0)
 new cdate set cdate=$piece(key,"bxform-",2)
"RTN","SAMICAS3",801,0)
 ;
"RTN","SAMICAS3",802,0)
 ; nodule copy
"RTN","SAMICAS3",803,0)
 ; new srckey set srckey=$$PREVNOD(sid)
"RTN","SAMICAS3",804,0)
 new srckey,srcdate set srcdate=$$LASTCMP(sid,.srckey)
"RTN","SAMICAS3",805,0)
 if srckey'="" do  ;
"RTN","SAMICAS3",806,0)
 . new source set source=$name(@root@("graph",sid,srckey))
"RTN","SAMICAS3",807,0)
 . new target set target=$name(@root@("graph",sid,key))
"RTN","SAMICAS3",808,0)
 . do CTCOPY^SAMICTC1(source,target,key)
"RTN","SAMICAS3",809,0)
 . quit
"RTN","SAMICAS3",810,0)
 ; end nodule copy
"RTN","SAMICAS3",811,0)
 ;
"RTN","SAMICAS3",812,0)
 merge @root@("graph",sid,key)=@root@(sien)
"RTN","SAMICAS3",813,0)
 set @root@("graph",sid,key,"samicreatedate")=cdate
"RTN","SAMICAS3",814,0)
 do SSAMISTA^SAMICASE(sid,key,"incomplete")
"RTN","SAMICAS3",815,0)
 ;
"RTN","SAMICAS3",816,0)
 ;
"RTN","SAMICAS3",817,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",818,0)
 ;
"RTN","SAMICAS3",819,0)
 quit  ; end of MKBXFORM
"RTN","SAMICAS3",820,0)
 ;
"RTN","SAMICAS3",821,0)
 ;
"RTN","SAMICAS3",822,0)
 ;
"RTN","SAMICAS3",823,0)
CASETBL(ary) ; generates case review table
"RTN","SAMICAS3",824,0)
 ;
"RTN","SAMICAS3",825,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICAS3",826,0)
 ;
"RTN","SAMICAS3",827,0)
 ;ven/gpl;private;procedure;clean;silent;sac
"RTN","SAMICAS3",828,0)
 ;@called by none
"RTN","SAMICAS3",829,0)
 ;@calls
"RTN","SAMICAS3",830,0)
 ;@input
"RTN","SAMICAS3",831,0)
 ; ary = name of array (passed by name, will be cleared)
"RTN","SAMICAS3",832,0)
 ;@output
"RTN","SAMICAS3",833,0)
 ; @ary
"RTN","SAMICAS3",834,0)
 ;@tests
"RTN","SAMICAS3",835,0)
 ; SAMIUTS2
"RTN","SAMICAS3",836,0)
 ;
"RTN","SAMICAS3",837,0)
 ;
"RTN","SAMICAS3",838,0)
 ;@stanza 2 build table
"RTN","SAMICAS3",839,0)
 ;
"RTN","SAMICAS3",840,0)
 kill @ary
"RTN","SAMICAS3",841,0)
 ;
"RTN","SAMICAS3",842,0)
 set @ary@("siform","form")="siform"
"RTN","SAMICAS3",843,0)
 set @ary@("siform","js")="subPr"
"RTN","SAMICAS3",844,0)
 set @ary@("siform","name")="Intake"
"RTN","SAMICAS3",845,0)
 set @ary@("siform","image")="preview.gif"
"RTN","SAMICAS3",846,0)
 ;
"RTN","SAMICAS3",847,0)
 set @ary@("nuform","form")="nuform"
"RTN","SAMICAS3",848,0)
 set @ary@("nuform","js")="subFr"
"RTN","SAMICAS3",849,0)
 set @ary@("nuform","name")="New Form"
"RTN","SAMICAS3",850,0)
 set @ary@("nuform","image")="nform.gif"
"RTN","SAMICAS3",851,0)
 ;
"RTN","SAMICAS3",852,0)
 set @ary@("sched","form")="sched"
"RTN","SAMICAS3",853,0)
 set @ary@("sched","js")="subSc"
"RTN","SAMICAS3",854,0)
 set @ary@("sched","name")="Schedule"
"RTN","SAMICAS3",855,0)
 set @ary@("sched","image")="schedule.gif"
"RTN","SAMICAS3",856,0)
 ;
"RTN","SAMICAS3",857,0)
 set @ary@("sbform","form")="sbform"
"RTN","SAMICAS3",858,0)
 set @ary@("sbform","js")="subPr"
"RTN","SAMICAS3",859,0)
 set @ary@("sbform","name")="Background"
"RTN","SAMICAS3",860,0)
 set @ary@("sbform","image")="preview.gif"
"RTN","SAMICAS3",861,0)
 ;
"RTN","SAMICAS3",862,0)
 set @ary@("ceform","form")="ceform"
"RTN","SAMICAS3",863,0)
 set @ary@("ceform","js")="subPr"
"RTN","SAMICAS3",864,0)
 set @ary@("ceform","name")="CT Evaluation"
"RTN","SAMICAS3",865,0)
 set @ary@("ceform","image")="preview.gif"
"RTN","SAMICAS3",866,0)
 ;
"RTN","SAMICAS3",867,0)
 set @ary@("report","form")="report"
"RTN","SAMICAS3",868,0)
 set @ary@("report","js")="subRp"
"RTN","SAMICAS3",869,0)
 set @ary@("report","name")="Report"
"RTN","SAMICAS3",870,0)
 set @ary@("report","image")="report.gif"
"RTN","SAMICAS3",871,0)
 ;
"RTN","SAMICAS3",872,0)
 set @ary@("ptform","form")="ptform"
"RTN","SAMICAS3",873,0)
 set @ary@("ptform","js")="subPr"
"RTN","SAMICAS3",874,0)
 set @ary@("ptform","name")="PET Evaluation"
"RTN","SAMICAS3",875,0)
 set @ary@("ptform","image")="preview.gif"
"RTN","SAMICAS3",876,0)
 ;
"RTN","SAMICAS3",877,0)
 set @ary@("bxform","form")="bxform"
"RTN","SAMICAS3",878,0)
 set @ary@("bxform","js")="subPr"
"RTN","SAMICAS3",879,0)
 set @ary@("bxform","name")="Biopsy"
"RTN","SAMICAS3",880,0)
 set @ary@("bxform","image")="preview.gif"
"RTN","SAMICAS3",881,0)
 ;
"RTN","SAMICAS3",882,0)
 set @ary@("rbform","form")="rbform"
"RTN","SAMICAS3",883,0)
 set @ary@("rbform","js")="subPr"
"RTN","SAMICAS3",884,0)
 set @ary@("rbform","name")="Intervention"
"RTN","SAMICAS3",885,0)
 set @ary@("rbform","image")="preview.gif"
"RTN","SAMICAS3",886,0)
 ;
"RTN","SAMICAS3",887,0)
 set @ary@("ceform","form")="ceform"
"RTN","SAMICAS3",888,0)
 set @ary@("ceform","js")="subPr"
"RTN","SAMICAS3",889,0)
 set @ary@("ceform","name")="CT Evaluation"
"RTN","SAMICAS3",890,0)
 set @ary@("ceform","image")="preview.gif"
"RTN","SAMICAS3",891,0)
 ;
"RTN","SAMICAS3",892,0)
 ;
"RTN","SAMICAS3",893,0)
 ;@stanza 3 termination
"RTN","SAMICAS3",894,0)
 ;
"RTN","SAMICAS3",895,0)
 quit  ; end of CASETBL
"RTN","SAMICAS3",896,0)
 ;
"RTN","SAMICAS3",897,0)
 ;
"RTN","SAMICAS3",898,0)
 ;
"RTN","SAMICAS3",899,0)
EOR ; end of routine SAMICAS3
"RTN","SAMICTD2")
0^3^B193069319
"RTN","SAMICTD2",1,0)
SAMICTD2 ;ven/gpl - cteval-dict init ;2021-10-19t22:03z
"RTN","SAMICTD2",2,0)
 ;;18.0;SAMI;**12,15**;2020-01;Build 2
"RTN","SAMICTD2",3,0)
 ;;18-15
"RTN","SAMICTD2",4,0)
 ;
"RTN","SAMICTD2",5,0)
 ; SAMICTD2 contains a pps to initialize the cteval-dict graphstore.
"RTN","SAMICTD2",6,0)
 ;
"RTN","SAMICTD2",7,0)
 quit  ; no entry from top
"RTN","SAMICTD2",8,0)
 ;
"RTN","SAMICTD2",9,0)
 ;
"RTN","SAMICTD2",10,0)
 ;
"RTN","SAMICTD2",11,0)
 ;@section 0 primary development
"RTN","SAMICTD2",12,0)
 ;
"RTN","SAMICTD2",13,0)
 ;
"RTN","SAMICTD2",14,0)
 ;
"RTN","SAMICTD2",15,0)
 ;@routine-credits
"RTN","SAMICTD2",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICTD2",17,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTD2",18,0)
 ;
"RTN","SAMICTD2",19,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMICTD2",20,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICTD2",21,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMICTD2",22,0)
 ; http://vistaexpertise.net
"RTN","SAMICTD2",23,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMICTD2",24,0)
 ;@license Apache 2.0
"RTN","SAMICTD2",25,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMICTD2",26,0)
 ;
"RTN","SAMICTD2",27,0)
 ;@last-update 2021-07-21t20:12z
"RTN","SAMICTD2",28,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMICTD2",29,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMICTD2",30,0)
 ;@version 18.12
"RTN","SAMICTD2",31,0)
 ;@release-date 2020-01
"RTN","SAMICTD2",32,0)
 ;@patch-list **12**
"RTN","SAMICTD2",33,0)
 ;
"RTN","SAMICTD2",34,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMICTD2",35,0)
 ; toad@vistaexpertise.net
"RTN","SAMICTD2",36,0)
 ;
"RTN","SAMICTD2",37,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICTD2",38,0)
 ; see routine SAMICTUL
"RTN","SAMICTD2",39,0)
 ;
"RTN","SAMICTD2",40,0)
 ;@contents
"RTN","SAMICTD2",41,0)
 ; INIT2GPH pps INIT2GPH^SAMICTD2,
"RTN","SAMICTD2",42,0)
 ;  initialize CTEVAL dictionary into graph cteval-dict
"RTN","SAMICTD2",43,0)
 ; INIT initialize cteval-dict graph
"RTN","SAMICTD2",44,0)
 ;
"RTN","SAMICTD2",45,0)
 ;
"RTN","SAMICTD2",46,0)
 ;
"RTN","SAMICTD2",47,0)
 ;@section 1 INIT2GPH^SAMICTD2 pps & subroutine
"RTN","SAMICTD2",48,0)
 ;
"RTN","SAMICTD2",49,0)
 ;
"RTN","SAMICTD2",50,0)
 ;
"RTN","SAMICTD2",51,0)
 ;@pps INIT2GPH^SAMICTD2
"RTN","SAMICTD2",52,0)
INIT2GPH() ; initialize CTEVAL dictionary into graph cteval-dict
"RTN","SAMICTD2",53,0)
 ;
"RTN","SAMICTD2",54,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTD2",55,0)
 ;
"RTN","SAMICTD2",56,0)
 ;ven/gpl;pps;procedure;silent;clean;sac;??% tests
"RTN","SAMICTD2",57,0)
 ;@called-by
"RTN","SAMICTD2",58,0)
 ; WSREPORT^SAMICTR
"RTN","SAMICTD2",59,0)
 ; WSREPORT^SAMICTR0
"RTN","SAMICTD2",60,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTD2",61,0)
 ;@calls
"RTN","SAMICTD2",62,0)
 ; $$setroot^%wd
"RTN","SAMICTD2",63,0)
 ; INIT
"RTN","SAMICTD2",64,0)
 ;@input none
"RTN","SAMICTD2",65,0)
 ;@output
"RTN","SAMICTD2",66,0)
 ; cteval-dict graph is initialized
"RTN","SAMICTD2",67,0)
 ;@tests
"RTN","SAMICTD2",68,0)
 ; UTIN2G^SAMIUTD2
"RTN","SAMICTD2",69,0)
 ;
"RTN","SAMICTD2",70,0)
 ;
"RTN","SAMICTD2",71,0)
 ;@stanza 2 init cteval-dict graph
"RTN","SAMICTD2",72,0)
 ;
"RTN","SAMICTD2",73,0)
 new root set root=$$setroot^%wd("cteval-dict")
"RTN","SAMICTD2",74,0)
 kill @root ; clear contents of cteval-dict graph
"RTN","SAMICTD2",75,0)
 ;
"RTN","SAMICTD2",76,0)
 new g set g=$name(@root@("cteval-dict"))
"RTN","SAMICTD2",77,0)
 do INIT(g) ; initialize graph
"RTN","SAMICTD2",78,0)
 ;
"RTN","SAMICTD2",79,0)
 ;
"RTN","SAMICTD2",80,0)
 ;@stanza 3 termination
"RTN","SAMICTD2",81,0)
 ;
"RTN","SAMICTD2",82,0)
 quit  ; end of INIT2GPH
"RTN","SAMICTD2",83,0)
 ;
"RTN","SAMICTD2",84,0)
 ;
"RTN","SAMICTD2",85,0)
 ;
"RTN","SAMICTD2",86,0)
INIT(g) ; initialize cteval-dict graph
"RTN","SAMICTD2",87,0)
 ;
"RTN","SAMICTD2",88,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMICTD2",89,0)
 ;
"RTN","SAMICTD2",90,0)
 ;ven/gpl;private;procedure;silent;clean;sac;??% tests
"RTN","SAMICTD2",91,0)
 ;@called-by
"RTN","SAMICTD2",92,0)
 ; INIT2GPH
"RTN","SAMICTD2",93,0)
 ;@calls none
"RTN","SAMICTD2",94,0)
 ;@input
"RTN","SAMICTD2",95,0)
 ; g = root of cteval-dict graph
"RTN","SAMICTD2",96,0)
 ;@output
"RTN","SAMICTD2",97,0)
 ; @g = initialized cteval-dict graph
"RTN","SAMICTD2",98,0)
 ;@tests
"RTN","SAMICTD2",99,0)
 ; UTIN2G^SAMIUTD2
"RTN","SAMICTD2",100,0)
 ;
"RTN","SAMICTD2",101,0)
 ;
"RTN","SAMICTD2",102,0)
 ;@stanza 2 init cteval-dict graph
"RTN","SAMICTD2",103,0)
 ;
"RTN","SAMICTD2",104,0)
 ;# English Translation Dictionary for CT report generation
"RTN","SAMICTD2",105,0)
 ;# Last Updated: December 14, 2016
"RTN","SAMICTD2",106,0)
 ;#
"RTN","SAMICTD2",107,0)
 ;# - Phrasing shortened for updated CT Report used at Mount Sinai
"RTN","SAMICTD2",108,0)
 ;# - Breast Density Added
"RTN","SAMICTD2",109,0)
 ;# - Correction of nonsolid and noncalcified
"RTN","SAMICTD2",110,0)
 ;
"RTN","SAMICTD2",111,0)
 ;# Recommendations
"RTN","SAMICTD2",112,0)
 set @g@("repeatscreen")="Repeat screening"
"RTN","SAMICTD2",113,0)
 set @g@("annual")="Annual repeat CT"
"RTN","SAMICTD2",114,0)
 set @g@("followup")="Follow-up CT"
"RTN","SAMICTD2",115,0)
 set @g@("followupcontrast")="Follow-up CT with contrast"
"RTN","SAMICTD2",116,0)
 set @g@("bronchoscopy")="Bronchoscopy"
"RTN","SAMICTD2",117,0)
 set @g@("resection")="Resection"
"RTN","SAMICTD2",118,0)
 set @g@("biopsy")="CT-guided biopsy"
"RTN","SAMICTD2",119,0)
 set @g@("pet")="PET"
"RTN","SAMICTD2",120,0)
 set @g@("vat")="VAT"
"RTN","SAMICTD2",121,0)
 set @g@("ctfull")="Full diagnostic CT"
"RTN","SAMICTD2",122,0)
 set @g@("ctlimited")="Limited diagnostic CT"
"RTN","SAMICTD2",123,0)
 set @g@("ctbiopsy")="Full diagnostic CT and biopsy"
"RTN","SAMICTD2",124,0)
 set @g@("antibiotic")="Antibiotic treatment with a follow-up CT"
"RTN","SAMICTD2",125,0)
 set @g@("annualrepeat")="Annual repeat Diagnostic CT"
"RTN","SAMICTD2",126,0)
 ;
"RTN","SAMICTD2",127,0)
 ;# CT Type of Exam (cetex)
"RTN","SAMICTD2",128,0)
 set @g@("cetex","b")="Baseline"
"RTN","SAMICTD2",129,0)
 set @g@("cetex","a")="Annual repeat"
"RTN","SAMICTD2",130,0)
 set @g@("cetex","d")="Follow-up"
"RTN","SAMICTD2",131,0)
 ;
"RTN","SAMICTD2",132,0)
 ;# CT Protocol (cectp)
"RTN","SAMICTD2",133,0)
 set @g@("cectp","l")="low-dose CT"
"RTN","SAMICTD2",134,0)
 set @g@("cectp","m")="low-dose Dx CT / HRCT"
"RTN","SAMICTD2",135,0)
 set @g@("cectp","d")="standard Dx CT / HRCT"
"RTN","SAMICTD2",136,0)
 set @g@("cectp","i")="limited Dx CT / HRCT"
"RTN","SAMICTD2",137,0)
 ;
"RTN","SAMICTD2",138,0)
 ;# Is It New (Nodule x)? (cect[x]ch, x=1..10)
"RTN","SAMICTD2",139,0)
 set @g@("cectch","n")="is newly seen"
"RTN","SAMICTD2",140,0)
 set @g@("cectch","pn")="unchanged"
"RTN","SAMICTD2",141,0)
 set @g@("cectch","pd")="shows slight decrease"
"RTN","SAMICTD2",142,0)
 set @g@("cectch","pe")="shows marked decrease"
"RTN","SAMICTD2",143,0)
 set @g@("cectch","pi")="shows slight increase"
"RTN","SAMICTD2",144,0)
 set @g@("cectch","pj")="shows marked increase"
"RTN","SAMICTD2",145,0)
 set @g@("cectch","pw")="has resolved"
"RTN","SAMICTD2",146,0)
 set @g@("cectch","px")="is not a nodule"
"RTN","SAMICTD2",147,0)
 set @g@("cectch","pr")="has been resected"
"RTN","SAMICTD2",148,0)
 set @g@("cectch","pk")="previously seen but is not mentioned in outside report"
"RTN","SAMICTD2",149,0)
 set @g@("cectch","rn")="seen in retrospect with no change"
"RTN","SAMICTD2",150,0)
 set @g@("cectch","pv")="was not included in this scan"
"RTN","SAMICTD2",151,0)
 set @g@("cectch","po")="is obscured"
"RTN","SAMICTD2",152,0)
 set @g@("cectch","rd")="seen in retrospect with decrease"
"RTN","SAMICTD2",153,0)
 set @g@("cectch","ri")="seen in retrospect with slight increase"
"RTN","SAMICTD2",154,0)
 set @g@("cectch","rj")="seen in retrospect with marked increase"
"RTN","SAMICTD2",155,0)
 ;
"RTN","SAMICTD2",156,0)
 ;# Endoibronchial
"RTN","SAMICTD2",157,0)
 set @g@("cecten","tr")="trachea"
"RTN","SAMICTD2",158,0)
 set @g@("cecten","rm")="right main bronchus"
"RTN","SAMICTD2",159,0)
 set @g@("cecten","lm")="left main bronchus"
"RTN","SAMICTD2",160,0)
 set @g@("cecten","bi")="bronchus intermedius"
"RTN","SAMICTD2",161,0)
 set @g@("cecten","lul")="left upper lobe"
"RTN","SAMICTD2",162,0)
 set @g@("cecten","lll")="left lower lobe"
"RTN","SAMICTD2",163,0)
 set @g@("cecten","rul")="right upper lobe"
"RTN","SAMICTD2",164,0)
 set @g@("cecten","rml")="right middle lobe"
"RTN","SAMICTD2",165,0)
 set @g@("cecten","rll")="right lower lobe"
"RTN","SAMICTD2",166,0)
 ;
"RTN","SAMICTD2",167,0)
 ;# Likely Location (Nodule x) (cect[x]ll, x=1..10)
"RTN","SAMICTD2",168,0)
 set @g@("cectll","lul")="left upper lobe"
"RTN","SAMICTD2",169,0)
 set @g@("cectll","lll")="left lower lobe"
"RTN","SAMICTD2",170,0)
 set @g@("cectll","rul")="right upper lobe"
"RTN","SAMICTD2",171,0)
 set @g@("cectll","rml")="right middle lobe"
"RTN","SAMICTD2",172,0)
 set @g@("cectll","rll")="right lower lobe"
"RTN","SAMICTD2",173,0)
 ;
"RTN","SAMICTD2",174,0)
 ;# Nodule Texture (Nodule x) (cect[x]nt, x=1..10)
"RTN","SAMICTD2",175,0)
 set @g@("cectnt","s")="solid"
"RTN","SAMICTD2",176,0)
 set @g@("cectnt","m")="part-solid"
"RTN","SAMICTD2",177,0)
 set @g@("cectnt","g")="nonsolid"
"RTN","SAMICTD2",178,0)
 set @g@("cectnt","o")="unusual"
"RTN","SAMICTD2",179,0)
 ;
"RTN","SAMICTD2",180,0)
 ;# Smooth Edges (Nodule x) (cect[x]nt, x=1..10)
"RTN","SAMICTD2",181,0)
 set @g@("cectse","y")="smooth"
"RTN","SAMICTD2",182,0)
 set @g@("cectse","n")="irregularly marginated"
"RTN","SAMICTD2",183,0)
 set @g@("cectse","q")="ill-defined"
"RTN","SAMICTD2",184,0)
 ;
"RTN","SAMICTD2",185,0)
 ;# Calcifications (Nodule x) (cect[x]ca, x=1..10)
"RTN","SAMICTD2",186,0)
 set @g@("cectca","y")="calcified"
"RTN","SAMICTD2",187,0)
 set @g@("cectca","n")="noncalcified"
"RTN","SAMICTD2",188,0)
 set @g@("cectca","q")="possibly calcified"
"RTN","SAMICTD2",189,0)
 ;
"RTN","SAMICTD2",190,0)
 ;# Spiculations/Pleural Tags (Nodule x) (cect[x]sp, x=1..10)
"RTN","SAMICTD2",191,0)
 set @g@("cectsp","y")="spiculations / pleural tags are seen"
"RTN","SAMICTD2",192,0)
 set @g@("cectsp","n")="no spiculations or pleural tags are seen"
"RTN","SAMICTD2",193,0)
 ;
"RTN","SAMICTD2",194,0)
 ;# Pathologic Diagnosis (Nodule x) (cect[x]pd, x=1..10)
"RTN","SAMICTD2",195,0)
 set @g@("cectpd","aa")="AAH"
"RTN","SAMICTD2",196,0)
 set @g@("cectpd","ba")="BAC"
"RTN","SAMICTD2",197,0)
 set @g@("cectpd","ad")="Adenocarcinoma"
"RTN","SAMICTD2",198,0)
 set @g@("cectpd","as")="Adenosquamous"
"RTN","SAMICTD2",199,0)
 set @g@("cectpd","la")="Large cell"
"RTN","SAMICTD2",200,0)
 set @g@("cectpd","sq")="Squamous cell"
"RTN","SAMICTD2",201,0)
 set @g@("cectpd","sm")="Small cell"
"RTN","SAMICTD2",202,0)
 set @g@("cectpd","ct")="Carcinoid(typical)"
"RTN","SAMICTD2",203,0)
 set @g@("cectpd","ca")="Carcinoid(atypical)"
"RTN","SAMICTD2",204,0)
 set @g@("cectpd","be")="Benign"
"RTN","SAMICTD2",205,0)
 set @g@("cectpd","bs")="Benign specific"
"RTN","SAMICTD2",206,0)
 ;
"RTN","SAMICTD2",207,0)
 set @g@("cectac","f")="Follow-up CT"
"RTN","SAMICTD2",208,0)
 set @g@("cectac","a")="Antibiotic treatment with a follow-up CT"
"RTN","SAMICTD2",209,0)
 set @g@("cectac","e")="PET"
"RTN","SAMICTD2",210,0)
 set @g@("cectac","c")="Follow-up CT with contrast"
"RTN","SAMICTD2",211,0)
 set @g@("cectac","b")="CT-guided biopsy"
"RTN","SAMICTD2",212,0)
 set @g@("cectac","p")="Bronchoscopy"
"RTN","SAMICTD2",213,0)
 set @g@("cectac","v")="VAT"
"RTN","SAMICTD2",214,0)
 set @g@("cectac","r")="Resection"
"RTN","SAMICTD2",215,0)
 ;
"RTN","SAMICTD2",216,0)
 ;# The following is deprecated, but available for old forms
"RTN","SAMICTD2",217,0)
 set @g@("cectac","s")="repeat SCT"
"RTN","SAMICTD2",218,0)
 ;
"RTN","SAMICTD2",219,0)
 ;# Emphysema (ceem)
"RTN","SAMICTD2",220,0)
 set @g@("ceem","no")="None"
"RTN","SAMICTD2",221,0)
 ;set @g@("ceem","mi")="Minimal"
"RTN","SAMICTD2",222,0)
 set @g@("ceem","mi")="Mild"
"RTN","SAMICTD2",223,0)
 set @g@("ceem","mo")="Moderate"
"RTN","SAMICTD2",224,0)
 set @g@("ceem","se")="Severe"
"RTN","SAMICTD2",225,0)
 ;
"RTN","SAMICTD2",226,0)
 ;# Bronchiectasis/Small Airway Disease (cebrs) [***IGNORE cebrs(n)]
"RTN","SAMICTD2",227,0)
 set @g@("cebrs","y")="Bronchiectasis/small airways disease"
"RTN","SAMICTD2",228,0)
 set @g@("cebrs","n")="No bronchiectasis or small airways disease"
"RTN","SAMICTD2",229,0)
 ;
"RTN","SAMICTD2",230,0)
 ;# Coronary Calcifications (cecclm, ceccld, cecccf, cdccrc)
"RTN","SAMICTD2",231,0)
 set @g@("cecc","no")="none"
"RTN","SAMICTD2",232,0)
 set @g@("cecc","mi")="minimal"
"RTN","SAMICTD2",233,0)
 set @g@("cecc","mo")="moderate"
"RTN","SAMICTD2",234,0)
 set @g@("cecc","ex")="extensive"
"RTN","SAMICTD2",235,0)
 ;
"RTN","SAMICTD2",236,0)
 set @g@("cebat","y")="Non-obstructive atelectasis seen in the"
"RTN","SAMICTD2",237,0)
 ;
"RTN","SAMICTD2",238,0)
 ;# Lymph Nodes (cemln, cemlnca)
"RTN","SAMICTD2",239,0)
 set @g@("cemln","y")="Lymph nodes are seen"
"RTN","SAMICTD2",240,0)
 set @g@("cemln","n")="No abnormal lymph nodes are seen"
"RTN","SAMICTD2",241,0)
 set @g@("cemlnca","c")="Lymph nodes are calcified."
"RTN","SAMICTD2",242,0)
 set @g@("cemlnca","n")="Lymph nodes are non-calcified."
"RTN","SAMICTD2",243,0)
 set @g@("cemlnca","b")="Lymph nodes are both calcified and non-calcified."
"RTN","SAMICTD2",244,0)
 ;
"RTN","SAMICTD2",245,0)
 ;# Hilar Abnormalities (ceha) [***IGNORE ceha(n)]
"RTN","SAMICTD2",246,0)
 set @g@("ceha","y")="Hilar Abnormalities:"
"RTN","SAMICTD2",247,0)
 set @g@("ceha","n")="No hilar abnormalities are seen"
"RTN","SAMICTD2",248,0)
 ;
"RTN","SAMICTD2",249,0)
 ;# Hilar Abnormalities - what(cehaw)
"RTN","SAMICTD2",250,0)
 set @g@("cehaw","hm")="hilar mass"
"RTN","SAMICTD2",251,0)
 ;
"RTN","SAMICTD2",252,0)
 ;# Hilar Abnormalities action (cehaa)
"RTN","SAMICTD2",253,0)
 set @g@("cehaa","f")=@g@("followup")
"RTN","SAMICTD2",254,0)
 set @g@("cehaa","c")=@g@("followupcontrast")
"RTN","SAMICTD2",255,0)
 set @g@("cehaa","b")=@g@("biopsy")
"RTN","SAMICTD2",256,0)
 set @g@("cehaa","p")=@g@("bronchoscopy")
"RTN","SAMICTD2",257,0)
 ;
"RTN","SAMICTD2",258,0)
 ;# Mediastinal Abnormalities (ceoma) [***IGNORE ceoma(n)]
"RTN","SAMICTD2",259,0)
 set @g@("ceoma","y")="Mediastinal Abnormalities:"
"RTN","SAMICTD2",260,0)
 set @g@("ceoma","n")="no mediastinal abnormalities are seen"
"RTN","SAMICTD2",261,0)
 ;
"RTN","SAMICTD2",262,0)
 ;# Mediastinal Abnormalities Action (ceomaa)[*** for ceomaa(o) use ceomas]
"RTN","SAMICTD2",263,0)
 set @g@("ceomaa","f")=@g@("followup")
"RTN","SAMICTD2",264,0)
 set @g@("ceomaa","c")=@g@("followupcontrast")
"RTN","SAMICTD2",265,0)
 set @g@("ceomaa","b")=@g@("biopsy")
"RTN","SAMICTD2",266,0)
 set @g@("ceomaa","p")=@g@("bronchoscopy")
"RTN","SAMICTD2",267,0)
 set @g@("ceomaa","e")=@g@("pet")
"RTN","SAMICTD2",268,0)
 set @g@("ceomaa","r")=@g@("resection")
"RTN","SAMICTD2",269,0)
 set @g@("ceomaa","v")=@g@("vat")
"RTN","SAMICTD2",270,0)
 set @g@("ceomaa","s")=@g@("repeatscreen")
"RTN","SAMICTD2",271,0)
 ;
"RTN","SAMICTD2",272,0)
 ;# Endobronchial Abnormalities (ceeba) [***IGNORE ceeba(n)]
"RTN","SAMICTD2",273,0)
 set @g@("ceeba","y")="Endobronchial Abnormalities: "
"RTN","SAMICTD2",274,0)
 set @g@("ceeba","n")="no endobroncial abnormalities are seen"
"RTN","SAMICTD2",275,0)
 ;
"RTN","SAMICTD2",276,0)
 ;# Endobronchial Abnormalities Action (ceebaa)
"RTN","SAMICTD2",277,0)
 set @g@("ceebaa","f")=@g@("followup")
"RTN","SAMICTD2",278,0)
 set @g@("ceebaa","p")=@g@("bronchoscopy")
"RTN","SAMICTD2",279,0)
 set @g@("ceebaa","b")=@g@("biopsy")
"RTN","SAMICTD2",280,0)
 set @g@("ceebaa","s")=@g@("repeatscreen")
"RTN","SAMICTD2",281,0)
 ;
"RTN","SAMICTD2",282,0)
 ;# Other clincially significant abnormalities location (ceafl)
"RTN","SAMICTD2",283,0)
 set @g@("ceafl","b")="breast"
"RTN","SAMICTD2",284,0)
 set @g@("ceafl","a")="abdomen"
"RTN","SAMICTD2",285,0)
 set @g@("ceafl","h")="head"
"RTN","SAMICTD2",286,0)
 set @g@("ceafl","n")="neck"
"RTN","SAMICTD2",287,0)
 ;
"RTN","SAMICTD2",288,0)
 ;# Consolidation (cefcp) [***IGNORE cefcp(n)]
"RTN","SAMICTD2",289,0)
 set @g@("cefcp","y")="consolidation is noted"
"RTN","SAMICTD2",290,0)
 set @g@("cefcp","n")="no consolidation is noted"
"RTN","SAMICTD2",291,0)
 ;
"RTN","SAMICTD2",292,0)
 ;# Consolidation What (cefcpw) [*** for cefcpw(os) use cefcps]
"RTN","SAMICTD2",293,0)
 set @g@("cefcpw","f")="Focal"
"RTN","SAMICTD2",294,0)
 set @g@("cefcpw","p")="Patchy"
"RTN","SAMICTD2",295,0)
 set @g@("cefcpw","d")="Diffuse"
"RTN","SAMICTD2",296,0)
 ;
"RTN","SAMICTD2",297,0)
 ;# Recommended Consolidation Action (cefcpa)[*** for cefcpa(o) use cefcpas]
"RTN","SAMICTD2",298,0)
 set @g@("cefcpa","s")=@g@("repeatscreen")
"RTN","SAMICTD2",299,0)
 set @g@("cefcpa","a")=@g@("antibiotic")
"RTN","SAMICTD2",300,0)
 set @g@("cefcpa","f")=@g@("followup")
"RTN","SAMICTD2",301,0)
 set @g@("cefcpa","b")=@g@("biopsy")
"RTN","SAMICTD2",302,0)
 set @g@("cefcpa","p")=@g@("bronchoscopy")
"RTN","SAMICTD2",303,0)
 ;
"RTN","SAMICTD2",304,0)
 ;# Pleural Effusion (cepel, ceper) [***IGNORE if both are no]
"RTN","SAMICTD2",305,0)
 set @g@("cepe","no")="no"
"RTN","SAMICTD2",306,0)
 set @g@("cepe","sm")="small"
"RTN","SAMICTD2",307,0)
 set @g@("cepe","mo")="moderate"
"RTN","SAMICTD2",308,0)
 set @g@("cepe","lg")="large"
"RTN","SAMICTD2",309,0)
 ;
"RTN","SAMICTD2",310,0)
 ;# Pericardial Effusion
"RTN","SAMICTD2",311,0)
 set @g@("ceprevm","mi")="minimal"
"RTN","SAMICTD2",312,0)
 set @g@("ceprevm","mo")="moderate"
"RTN","SAMICTD2",313,0)
 set @g@("ceprevm","ex")="marked"
"RTN","SAMICTD2",314,0)
 ;
"RTN","SAMICTD2",315,0)
 ;# Recommended Followup (cefu)
"RTN","SAMICTD2",316,0)
 set @g@("cefu","rs")=@g@("annual")
"RTN","SAMICTD2",317,0)
 set @g@("cefu","dx")=@g@("followup")
"RTN","SAMICTD2",318,0)
 set @g@("cefu","dl")=@g@("ctlimited")
"RTN","SAMICTD2",319,0)
 set @g@("cefu","af")=@g@("antibiotic")
"RTN","SAMICTD2",320,0)
 set @g@("cefu","fn")=@g@("biopsy")
"RTN","SAMICTD2",321,0)
 set @g@("cefu","cb")=@g@("ctbiopsy")
"RTN","SAMICTD2",322,0)
 set @g@("cefu","cc")=@g@("followupcontrast")
"RTN","SAMICTD2",323,0)
 set @g@("cefu","pe")=@g@("pet")
"RTN","SAMICTD2",324,0)
 set @g@("cefu","br")=@g@("bronchoscopy")
"RTN","SAMICTD2",325,0)
 set @g@("cefu","va")=@g@("vat")
"RTN","SAMICTD2",326,0)
 set @g@("cefu","su")=@g@("resection")
"RTN","SAMICTD2",327,0)
 set @g@("cefu","ad")=@g@("annualrepeat")
"RTN","SAMICTD2",328,0)
 ;
"RTN","SAMICTD2",329,0)
 ;# Recommended Follow-up (When) (cefuw)
"RTN","SAMICTD2",330,0)
 set @g@("cefuw","nw")="at this time"
"RTN","SAMICTD2",331,0)
 set @g@("cefuw","1m")="in one month"
"RTN","SAMICTD2",332,0)
 set @g@("cefuw","3m")="in three months"
"RTN","SAMICTD2",333,0)
 set @g@("cefuw","6m")="in six months"
"RTN","SAMICTD2",334,0)
 set @g@("cefuw","1y")="in one year"
"RTN","SAMICTD2",335,0)
 ;
"RTN","SAMICTD2",336,0)
 ;# Impression (Nodules) (ceimn)
"RTN","SAMICTD2",337,0)
 set @g@("ceimn","rs")="No evidence of nodules"
"RTN","SAMICTD2",338,0)
 set @g@("ceimn","ro")="Nodule(s) as described. Consistent with old granulomatous disease"
"RTN","SAMICTD2",339,0)
 set @g@("ceimn","ru")="Nodule(s) unchanged, as described"
"RTN","SAMICTD2",340,0)
 set @g@("ceimn","nf")="Nodule(s) as described"
"RTN","SAMICTD2",341,0)
 ;
"RTN","SAMICTD2",342,0)
 ;# Impression (Other Findings) (ceimo)
"RTN","SAMICTD2",343,0)
 set @g@("ceimo","no")="No other abnormalities"
"RTN","SAMICTD2",344,0)
 set @g@("ceimo","oa")="Other abnormalities as described"
"RTN","SAMICTD2",345,0)
 set @g@("ceimo","da")="Diffuse abnormalities"
"RTN","SAMICTD2",346,0)
 ;
"RTN","SAMICTD2",347,0)
 ;# Breast Density
"RTN","SAMICTD2",348,0)
 set @g@("ceobad","1")="almost entirely fatty"
"RTN","SAMICTD2",349,0)
 set @g@("ceobad","2")="scattered areas of fibroglandular density"
"RTN","SAMICTD2",350,0)
 set @g@("ceobad","3")="heterogeneously dense"
"RTN","SAMICTD2",351,0)
 set @g@("ceobad","4")="extremely dense"
"RTN","SAMICTD2",352,0)
 ;
"RTN","SAMICTD2",353,0)
 ;# LungRADS
"RTN","SAMICTD2",354,0)
 set @g@("celrad","0")="incomplete"
"RTN","SAMICTD2",355,0)
 set @g@("celrad","1")="negative"
"RTN","SAMICTD2",356,0)
 set @g@("celrad","2")="benign appearance or behavior"
"RTN","SAMICTD2",357,0)
 set @g@("celrad","3")="probably benign"
"RTN","SAMICTD2",358,0)
 set @g@("celrad","4A")="suspicious"
"RTN","SAMICTD2",359,0)
 set @g@("celrad","4B")="suspicious"
"RTN","SAMICTD2",360,0)
 set @g@("celrad","4X")="suspicious"
"RTN","SAMICTD2",361,0)
 ;
"RTN","SAMICTD2",362,0)
 ;# LungRADS also
"RTN","SAMICTD2",363,0)
 set @g@("celrc","0")="incomplete"
"RTN","SAMICTD2",364,0)
 set @g@("celrc","1")="negative"
"RTN","SAMICTD2",365,0)
 set @g@("celrc","2")="benign appearance or behavior"
"RTN","SAMICTD2",366,0)
 set @g@("celrc","3")="probably benign"
"RTN","SAMICTD2",367,0)
 set @g@("celrc","4A")="suspicious"
"RTN","SAMICTD2",368,0)
 set @g@("celrc","4B")="suspicious"
"RTN","SAMICTD2",369,0)
 set @g@("celrc","4X")="suspicious"
"RTN","SAMICTD2",370,0)
 ;
"RTN","SAMICTD2",371,0)
 ;# Impression Note:
"RTN","SAMICTD2",372,0)
 set @g@("note_imp")="Note: If LIMITED diagnostic scans are done to follow nodules, each one-year diagnostic scan which serves as the annual screening test MUST BE A FULL DIAGNOSTIC SCAN."
"RTN","SAMICTD2",373,0)
 ;
"RTN","SAMICTD2",374,0)
 ;# Study Complete Notice
"RTN","SAMICTD2",375,0)
 set @g@("study_complete")="You have completed the free screening provided by the New York Early Lung Cancer Action Program.  "
"RTN","SAMICTD2",376,0)
 set @g@("study_complete")=@g@("study_complete")_"Further screening outside of this project is at the discretion of you and your physician.  Please call if you have any questions or concerns."
"RTN","SAMICTD2",377,0)
 ;
"RTN","SAMICTD2",378,0)
 ;#set CAC_recommendation "Since your Visual Coronary Artery Calcium Score (CAC), which is calculated by The Coordinating Site at Weill Medical College of Cornell University, is above 3, "
"RTN","SAMICTD2",379,0)
 ;we recommend that you consult with a cardiologist, as you may be at risk for coronary artery disease."
"RTN","SAMICTD2",380,0)
 ;
"RTN","SAMICTD2",381,0)
 ;#set CAC_recommendation "Clinical interpretation of the Visual Coronary Artery Calcium Score (CAC) is provided in the attached writeup."
"RTN","SAMICTD2",382,0)
 ;
"RTN","SAMICTD2",383,0)
 ;#set CAC_recommendation "Since your Visual Coronary Artery Calcium Score (CAC) is above 3, we recommend that you consult with your physician for a clinical interpretation of this score, as you may be at risk for coronary artery disease."
"RTN","SAMICTD2",384,0)
 ;
"RTN","SAMICTD2",385,0)
 set @g@("CAC_recommendation")="Since your Visual CAC Score is above 3, we recommend that you consult with your physician for a clinical interpretation, as you may be at risk for coronary artery disease."
"RTN","SAMICTD2",386,0)
 ;
"RTN","SAMICTD2",387,0)
 ;
"RTN","SAMICTD2",388,0)
 ;@stanza 3 termination
"RTN","SAMICTD2",389,0)
 ;
"RTN","SAMICTD2",390,0)
 quit  ; end of INIT
"RTN","SAMICTD2",391,0)
 ;
"RTN","SAMICTD2",392,0)
 ;
"RTN","SAMICTD2",393,0)
 ;
"RTN","SAMICTD2",394,0)
EOR ; end of routine SAMICTD2
"RTN","SAMICTT0")
0^4^B100450717
"RTN","SAMICTT0",1,0)
SAMICTT0 ;ven/gpl - ctreport text main ;2021-10-27t03:21z
"RTN","SAMICTT0",2,0)
 ;;18.0;SAMI;**4,10,11,15**;2020-01;Build 2
"RTN","SAMICTT0",3,0)
 ;;18-15
"RTN","SAMICTT0",4,0)
 ;
"RTN","SAMICTT0",5,0)
 ; SAMICTT0 contains a web route & associated subroutines to produce
"RTN","SAMICTT0",6,0)
 ; the ELCAP CT Report in text format (route ctreport, format text).
"RTN","SAMICTT0",7,0)
 ; SAMICTT* routines serve web service interfaces WSVAPALS^SAMIHOM3
"RTN","SAMICTT0",8,0)
 ; (the main VAPALS-ELCAP post web service) & WSHOME^SAMIHOM3 (the
"RTN","SAMICTT0",9,0)
 ; VAPALS-ELCAP home-page service).
"RTN","SAMICTT0",10,0)
 ;
"RTN","SAMICTT0",11,0)
 quit  ; no entry from top
"RTN","SAMICTT0",12,0)
 ;
"RTN","SAMICTT0",13,0)
 ;
"RTN","SAMICTT0",14,0)
 ;
"RTN","SAMICTT0",15,0)
 ;@section 0 primary development
"RTN","SAMICTT0",16,0)
 ;
"RTN","SAMICTT0",17,0)
 ;
"RTN","SAMICTT0",18,0)
 ;
"RTN","SAMICTT0",19,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT0",20,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT0",21,0)
 ;@contents
"RTN","SAMICTT0",22,0)
 ; WSREPORT web route: ctreport in text format
"RTN","SAMICTT0",23,0)
 ; OUT output a line of ct report
"RTN","SAMICTT0",24,0)
 ; OUTOLD old version of out
"RTN","SAMICTT0",25,0)
 ; HOUT output a ct report header line
"RTN","SAMICTT0",26,0)
 ; $$XVAL patient value for var
"RTN","SAMICTT0",27,0)
 ; $$XSUB dictionary value defined by var
"RTN","SAMICTT0",28,0)
 ; GETFILTR fill in the filter for Ct Eval for sid
"RTN","SAMICTT0",29,0)
 ; T1 test
"RTN","SAMICTT0",30,0)
 ;
"RTN","SAMICTT0",31,0)
 ;
"RTN","SAMICTT0",32,0)
 ;
"RTN","SAMICTT0",33,0)
 ;@section 1 wsi WSREPORT & related subroutines
"RTN","SAMICTT0",34,0)
 ;
"RTN","SAMICTT0",35,0)
 ;
"RTN","SAMICTT0",36,0)
 ;
"RTN","SAMICTT0",37,0)
 ;@wsr WSREPORT^SAMICTT0
"RTN","SAMICTT0",38,0)
WSREPORT(return,filter) ; web route: ctreport in text format
"RTN","SAMICTT0",39,0)
 ;
"RTN","SAMICTT0",40,0)
 ;@called-by
"RTN","SAMICTT0",41,0)
 ; WSNOTE^SAMINOT3
"RTN","SAMICTT0",42,0)
 ;  (called-by wsi WSVAPALS^SAMIHOM3)
"RTN","SAMICTT0",43,0)
 ;    (called by wsi WSHOME^SAMIHOM3)
"RTN","SAMICTT0",44,0)
 ;  (sibling to wri WSREPORT^SAMICTR0, keep in sync)
"RTN","SAMICTT0",45,0)
 ;@calls
"RTN","SAMICTT0",46,0)
 ; INIT2GPH^SAMICTD2
"RTN","SAMICTT0",47,0)
 ; $$setroot^%wd
"RTN","SAMICTT0",48,0)
 ; $$XVAL
"RTN","SAMICTT0",49,0)
 ; OUT
"RTN","SAMICTT0",50,0)
 ; $$XSUB
"RTN","SAMICTT0",51,0)
 ; HOUT
"RTN","SAMICTT0",52,0)
 ; NODULES^SAMICTT1
"RTN","SAMICTT0",53,0)
 ; OTHRLUNG^SAMICTT2
"RTN","SAMICTT0",54,0)
 ; EMPHYS^SAMICTT3
"RTN","SAMICTT0",55,0)
 ; BREAST^SAMICTT4
"RTN","SAMICTT0",56,0)
 ; IMPRSN^SAMICTT9
"RTN","SAMICTT0",57,0)
 ; RCMND^SAMICTTA
"RTN","SAMICTT0",58,0)
 ;
"RTN","SAMICTT0",59,0)
 s debug=0
"RTN","SAMICTT0",60,0)
 n outmode s outmode="go"
"RTN","SAMICTT0",61,0)
 n line s line=""
"RTN","SAMICTT0",62,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMICTT0",63,0)
 ;
"RTN","SAMICTT0",64,0)
 ;s rtn=$na(^TMP("SAMICTT",$J))
"RTN","SAMICTT0",65,0)
 s rtn="return"
"RTN","SAMICTT0",66,0)
 k @rtn
"RTN","SAMICTT0",67,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMICTT0",68,0)
 ;
"RTN","SAMICTT0",69,0)
 n cnt s cnt=0 ; line number
"RTN","SAMICTT0",70,0)
 ;
"RTN","SAMICTT0",71,0)
 ; set up dictionary and patient values
"RTN","SAMICTT0",72,0)
 ;
"RTN","SAMICTT0",73,0)
 n dict,vals
"RTN","SAMICTT0",74,0)
 ;d INIT^SAMICTD2("dict")
"RTN","SAMICTT0",75,0)
 s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT0",76,0)
 s dict=$na(@dict@("cteval-dict"))
"RTN","SAMICTT0",77,0)
 i $g(@dict@("pet"))="" d INIT2GPH^SAMICTD2 ; init dictionary 1st time
"RTN","SAMICTT0",78,0)
 n si
"RTN","SAMICTT0",79,0)
 s si=$g(filter("studyid"))
"RTN","SAMICTT0",80,0)
 i si="" d  ;
"RTN","SAMICTT0",81,0)
 . s si="XXX00102"
"RTN","SAMICTT0",82,0)
 q:si=""
"RTN","SAMICTT0",83,0)
 n samikey
"RTN","SAMICTT0",84,0)
 s samikey=$g(filter("form"))
"RTN","SAMICTT0",85,0)
 i samikey="" d  ;
"RTN","SAMICTT0",86,0)
 . s samikey="ceform-2018-10-09"
"RTN","SAMICTT0",87,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICTT0",88,0)
 i $g(filter("studyid"))="" s root=$$setroot^%wd("vapals-patients")
"RTN","SAMICTT0",89,0)
 s vals=$na(@root@("graph",si,samikey))
"RTN","SAMICTT0",90,0)
 ;W !,vals
"RTN","SAMICTT0",91,0)
 ;zwr @vals@(*)
"RTN","SAMICTT0",92,0)
 i '$d(@vals) d  q  ;
"RTN","SAMICTT0",93,0)
 . w !,"error, patient values not found"
"RTN","SAMICTT0",94,0)
 ;
"RTN","SAMICTT0",95,0)
 ; report parameters
"RTN","SAMICTT0",96,0)
 ;
"RTN","SAMICTT0",97,0)
 n nt,sectionheader,dummy,cac,tex,para,legout
"RTN","SAMICTT0",98,0)
 ;; n lang,lanread
"RTN","SAMICTT0",99,0)
 ;
"RTN","SAMICTT0",100,0)
 s nt=1
"RTN","SAMICTT0",101,0)
 s sectionheader=1
"RTN","SAMICTT0",102,0)
 ;;s dummy="******"
"RTN","SAMICTT0",103,0)
 s cac=""
"RTN","SAMICTT0",104,0)
 n cacrec s cacrec=""
"RTN","SAMICTT0",105,0)
 ;;s tex=0
"RTN","SAMICTT0",106,0)
 ;s para="<p>"
"RTN","SAMICTT0",107,0)
 ;s para=$char(13,10)
"RTN","SAMICTT0",108,0)
 s para=""
"RTN","SAMICTT0",109,0)
 ;;s legout=0
"RTN","SAMICTT0",110,0)
 n qheader s qheader=0
"RTN","SAMICTT0",111,0)
 ;
"RTN","SAMICTT0",112,0)
 n lang s lang=""
"RTN","SAMICTT0",113,0)
 n langread s langread=0
"RTN","SAMICTT0",114,0)
 ;
"RTN","SAMICTT0",115,0)
 n auth s auth("perm")="a"
"RTN","SAMICTT0",116,0)
 s auth("inst")=$g(filter("auth"))
"RTN","SAMICTT0",117,0)
 ;
"RTN","SAMICTT0",118,0)
 n newct s newct=0
"RTN","SAMICTT0",119,0)
 i $$XVAL("ceoppa",vals)'="" s newct=1
"RTN","SAMICTT0",120,0)
 ;
"RTN","SAMICTT0",121,0)
 n registryForm s registryForm=0
"RTN","SAMICTT0",122,0)
 i $$XVAL("ceaf",vals)'="" s registryForm=1
"RTN","SAMICTT0",123,0)
 ;
"RTN","SAMICTT0",124,0)
 ;d OUT("<HTML>")
"RTN","SAMICTT0",125,0)
 ;d OUT("<HEAD>")
"RTN","SAMICTT0",126,0)
 ;d OUT("<!-- Calling TR: CT Evaluation Report -->")
"RTN","SAMICTT0",127,0)
 ;d OUT("<TITLE>CT Evaluation Report</TITLE>")
"RTN","SAMICTT0",128,0)
 ;d OUT("<link rel='stylesheet' href='/css/report.css'>")
"RTN","SAMICTT0",129,0)
 ;d OUT("</HEAD>")
"RTN","SAMICTT0",130,0)
 ;d OUT("<BODY BGCOLOR=""#ffffff"" TEXT=""#000000"">")
"RTN","SAMICTT0",131,0)
 ;;d OUT("<TABLE border=""0"" cellspacing=""0"" cellpadding=""3"" WIDTH=""640""><TR><TD>")
"RTN","SAMICTT0",132,0)
 ;d OUT("<FONT SIZE=""+2""><CENTER>")
"RTN","SAMICTT0",133,0)
 ;d OUT("<!-- Calling TR: CT Evaluation Report -->")
"RTN","SAMICTT0",134,0)
 ;d OUT("<B>CT Evaluation Report</B>")
"RTN","SAMICTT0",135,0)
 d OUT("CT Evaluation Report")
"RTN","SAMICTT0",136,0)
 ;d OUT("</CENTER></FONT>")
"RTN","SAMICTT0",137,0)
 ;d OUT("</TD></TR><TR><TD>")
"RTN","SAMICTT0",138,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT0",139,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT0",140,0)
 ;
"RTN","SAMICTT0",141,0)
 ;d OUT("<!-- patient information -->")
"RTN","SAMICTT0",142,0)
 ;d OUT("<TR><TD><TABLE border=""0"" cellspacing=""0"" cellpadding=""3"" WIDTH=""640"">")
"RTN","SAMICTT0",143,0)
 ;
"RTN","SAMICTT0",144,0)
 ; generate header
"RTN","SAMICTT0",145,0)
 ;
"RTN","SAMICTT0",146,0)
 d  ;
"RTN","SAMICTT0",147,0)
 . n pname
"RTN","SAMICTT0",148,0)
 . ;s pname=$$XVAL("sinamel",vals)_", "_$$XVAL("sinamef",vals)
"RTN","SAMICTT0",149,0)
 . s pname=$$XVAL("saminame",vals)
"RTN","SAMICTT0",150,0)
 . d OUT("Participant Name: "_pname)
"RTN","SAMICTT0",151,0)
 ;d OUT("<TR><TD WIDTH=""180""><B>Participant Name:</B></TD><TD WIDTH=""365"">")
"RTN","SAMICTT0",152,0)
 ;d OUT($$XVAL("sinamel",vals)_", "_$$XVAL("sinamef",vals))
"RTN","SAMICTT0",153,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",154,0)
 ;
"RTN","SAMICTT0",155,0)
 d  ;
"RTN","SAMICTT0",156,0)
 . n sid s sid=$$XVAL("sisid",vals)
"RTN","SAMICTT0",157,0)
 . d OUT("Study ID: "_sid)
"RTN","SAMICTT0",158,0)
 ;d OUT("<TD WIDTH=""120""><B>Study ID:</B></TD><TD WIDTH=""75"">")
"RTN","SAMICTT0",159,0)
 ;d OUT($$XVAL("sisid",vals))
"RTN","SAMICTT0",160,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",161,0)
 ;
"RTN","SAMICTT0",162,0)
 n etype
"RTN","SAMICTT0",163,0)
 s etype=""
"RTN","SAMICTT0",164,0)
 d  ;
"RTN","SAMICTT0",165,0)
 . s etype=$$XSUB("cetex",vals,dict)_" "_$$XSUB("cectp",vals,dict)
"RTN","SAMICTT0",166,0)
 . d OUT("Type of Examination: "_etype)
"RTN","SAMICTT0",167,0)
 ;d OUT("<TR><TD><B>Type of Examination:</B></TD><TD>")
"RTN","SAMICTT0",168,0)
 ;d OUT($$XSUB("cetex",vals,dict)_" "_$$XSUB("cectp",vals,dict))
"RTN","SAMICTT0",169,0)
 ;d OUT("</TD>")
"RTN","SAMICTT0",170,0)
 ;d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",171,0)
 ;
"RTN","SAMICTT0",172,0)
 d  ;
"RTN","SAMICTT0",173,0)
 . n edate s edate=$$XVAL("cedos",vals)
"RTN","SAMICTT0",174,0)
 . d OUT("Examination Date: "_edate)
"RTN","SAMICTT0",175,0)
 ;d OUT("<TR><TD><B>Examination Date:</B></TD><TD>")
"RTN","SAMICTT0",176,0)
 ;d OUT($$XVAL("cedos",vals))
"RTN","SAMICTT0",177,0)
 ;
"RTN","SAMICTT0",178,0)
 ;i $$XVAL("sidob",vals)'=-1 d  ;
"RTN","SAMICTT0",179,0)
 ;. d OUT("<TD><B>Date of Birth:</B></TD><TD>")
"RTN","SAMICTT0",180,0)
 ;. d OUT($$XVAL("sidob",vals))
"RTN","SAMICTT0",181,0)
 ;e  d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",182,0)
 ;
"RTN","SAMICTT0",183,0)
 d  ;
"RTN","SAMICTT0",184,0)
 . n dob s dob=$$XVAL("sidob",vals)
"RTN","SAMICTT0",185,0)
 . i dob>0 d OUT("Date of Birth: "_dob)
"RTN","SAMICTT0",186,0)
 . d OUT("")
"RTN","SAMICTT0",187,0)
 ;i $$XVAL("sidob",vals)>0 d  ;
"RTN","SAMICTT0",188,0)
 ;. d OUT("<TD><B>Date of Birth:</B></TD><TD>")
"RTN","SAMICTT0",189,0)
 ;. d OUT($$XVAL("sidob",vals))
"RTN","SAMICTT0",190,0)
 ;. d OUT("</TD></TR>")
"RTN","SAMICTT0",191,0)
 ;e  d  ;
"RTN","SAMICTT0",192,0)
 ;. d OUT("<TD> &nbsp; </TD><TD> &nbsp; </TD></TR>")
"RTN","SAMICTT0",193,0)
 ;
"RTN","SAMICTT0",194,0)
 ;# End of Header
"RTN","SAMICTT0",195,0)
 ;
"RTN","SAMICTT0",196,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTT0",197,0)
 ;;d OUT("</TD></TR><TR><TD>")
"RTN","SAMICTT0",198,0)
 ;d OUT("<HR SIZE=""2"" WIDTH=""100%"" ALIGN=""center"" NOSHADE>")
"RTN","SAMICTT0",199,0)
 ;d OUT("</TD></TR>")
"RTN","SAMICTT0",200,0)
 ;d OUT("<!-- report -->")
"RTN","SAMICTT0",201,0)
 ;d OUT("<TR><TD>")
"RTN","SAMICTT0",202,0)
 ;d OUT("<FONT SIZE=""+2""><B>")
"RTN","SAMICTT0",203,0)
 ;d OUT("Report:")
"RTN","SAMICTT0",204,0)
 ;d OUT("</B></FONT>")
"RTN","SAMICTT0",205,0)
 ;d OUT("</TD></TR><TR><TD><TABLE><TR><TD WIDTH=20></TD><TD>")
"RTN","SAMICTT0",206,0)
 d OUT("Report:")
"RTN","SAMICTT0",207,0)
 ;
"RTN","SAMICTT0",208,0)
 s outmode="hold"
"RTN","SAMICTT0",209,0)
 s line=""
"RTN","SAMICTT0",210,0)
 i $$XVAL("ceclin",vals)'="" d  ;
"RTN","SAMICTT0",211,0)
 . d HOUT("Clinical Information: ")
"RTN","SAMICTT0",212,0)
 . d OUT($$XVAL("ceclin",vals))
"RTN","SAMICTT0",213,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT0",214,0)
 ;
"RTN","SAMICTT0",215,0)
 s outmode="hold"
"RTN","SAMICTT0",216,0)
 n nopri s nopri=1
"RTN","SAMICTT0",217,0)
 d HOUT("Comparison CT Scans: ")
"RTN","SAMICTT0",218,0)
 if $$XVAL("cedcs",vals)'="" d  ;
"RTN","SAMICTT0",219,0)
 . ;i etype["Baseline" q  ;
"RTN","SAMICTT0",220,0)
 . d OUT($$XSUB("cetex",vals,dict)_". ")
"RTN","SAMICTT0",221,0)
 . ;d OUT("Comparisons: "_$$XVAL("cedcs",vals))
"RTN","SAMICTT0",222,0)
 . d OUT("Comparisons: ")
"RTN","SAMICTT0",223,0)
 . s nopri=0
"RTN","SAMICTT0",224,0)
 if $$XVAL("cedps",vals)'="" d  ;
"RTN","SAMICTT0",225,0)
 . ;i etype["Baseline" q  ;
"RTN","SAMICTT0",226,0)
 . d OUT(" "_$$XVAL("cedps",vals))
"RTN","SAMICTT0",227,0)
 . s nopri=0
"RTN","SAMICTT0",228,0)
 d:nopri OUT("None")
"RTN","SAMICTT0",229,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT0",230,0)
 ;
"RTN","SAMICTT0",231,0)
 s outmode="hold"
"RTN","SAMICTT0",232,0)
 d HOUT("Description: ")
"RTN","SAMICTT0",233,0)
 i $$XVAL("cectp",vals)="i" d  ;
"RTN","SAMICTT0",234,0)
 . d OUT("Limited Diagnostic CT examination was performed. ")
"RTN","SAMICTT0",235,0)
 e  d  ;
"RTN","SAMICTT0",236,0)
 . d OUT("CT examination of the entire thorax was performed at "_$$XSUB("cectp",vals,dict)_" settings. ")
"RTN","SAMICTT0",237,0)
 ;
"RTN","SAMICTT0",238,0)
 i $$XVAL("cectrst",vals)'="" d  ;
"RTN","SAMICTT0",239,0)
 . d OUT(" Images were obtained at "_$$XVAL("cectrst",vals)_" mm slice thickness. ")
"RTN","SAMICTT0",240,0)
 . d OUT(" Multiplanar reconstructions were performed. ")
"RTN","SAMICTT0",241,0)
 ;
"RTN","SAMICTT0",242,0)
 i newct d  ;
"RTN","SAMICTT0",243,0)
 . n nvadbo s nvadbo=1
"RTN","SAMICTT0",244,0)
 . n ii
"RTN","SAMICTT0",245,0)
 . f ii="ceoaa","ceaga","ceasa","ceala","ceapa","ceaaa","ceaka" d  ;
"RTN","SAMICTT0",246,0)
 . . i $$XVAL(ii,vals)="y" set nvadbo=0
"RTN","SAMICTT0",247,0)
 . ;
"RTN","SAMICTT0",248,0)
 . i nvadbo=1 d  ;
"RTN","SAMICTT0",249,0)
 . . d OUT("Upper abdominal images were not acquired on the current scan due to its limited nature. ")
"RTN","SAMICTT0",250,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT0",251,0)
 ;
"RTN","SAMICTT0",252,0)
 ; lung nodules
"RTN","SAMICTT0",253,0)
 ;
"RTN","SAMICTT0",254,0)
 ;d OUT("")
"RTN","SAMICTT0",255,0)
 d HOUT("Lung Nodules:")
"RTN","SAMICTT0",256,0)
 ;d OUT("")
"RTN","SAMICTT0",257,0)
 ;
"RTN","SAMICTT0",258,0)
 ; see if there are any nodules using the cectXch fields
"RTN","SAMICTT0",259,0)
 ;
"RTN","SAMICTT0",260,0)
 n ij,hasnodules s hasnodules=0
"RTN","SAMICTT0",261,0)
 f ij=1:1:10 i ($$XVAL("cect"_ij_"ch",vals)'="")&($$XVAL("cect"_ij_"ch",vals)'="-") s hasnodules=1
"RTN","SAMICTT0",262,0)
 ;
"RTN","SAMICTT0",263,0)
 ; check for small nodule checkboxes
"RTN","SAMICTT0",264,0)
 i $$XVAL("cectancn",vals)=1 s hasnodules=1
"RTN","SAMICTT0",265,0)
 i $$XVAL("cectacn",vals)=1 s hasnodules=1
"RTN","SAMICTT0",266,0)
 ;
"RTN","SAMICTT0",267,0)
 i hasnodules=0 d  ;
"RTN","SAMICTT0",268,0)
 . d OUT(para)
"RTN","SAMICTT0",269,0)
 . d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",270,0)
 ;
"RTN","SAMICTT0",271,0)
 ;i $$XVAL("cennod",vals)="" d  ;
"RTN","SAMICTT0",272,0)
 ;. d OUT(para)
"RTN","SAMICTT0",273,0)
 ;. d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",274,0)
 ;e  i $$XVAL("ceanod",vals)="n" d  ;
"RTN","SAMICTT0",275,0)
 ;. d OUT(para)
"RTN","SAMICTT0",276,0)
 ;. d OUT("No pulmonary nodules are seen. "_para)
"RTN","SAMICTT0",277,0)
 ;
"RTN","SAMICTT0",278,0)
 d NODULES^SAMICTT1(rtn,.vals,.dict)
"RTN","SAMICTT0",279,0)
 ;
"RTN","SAMICTT0",280,0)
 d OTHRLUNG^SAMICTT2(rtn,.vals,.dict)
"RTN","SAMICTT0",281,0)
 ;
"RTN","SAMICTT0",282,0)
 d EMPHYS^SAMICTT3(rtn,.vals,.dict)
"RTN","SAMICTT0",283,0)
 ;
"RTN","SAMICTT0",284,0)
 d BREAST^SAMICTT4(rtn,.vals,.dict)
"RTN","SAMICTT0",285,0)
 ;
"RTN","SAMICTT0",286,0)
 d IMPRSN^SAMICTT9(rtn,.vals,.dict)
"RTN","SAMICTT0",287,0)
 ;
"RTN","SAMICTT0",288,0)
 d RCMND^SAMICTTA(rtn,.vals,.dict)
"RTN","SAMICTT0",289,0)
 ;
"RTN","SAMICTT0",290,0)
 ; etc etc
"RTN","SAMICTT0",291,0)
 ;
"RTN","SAMICTT0",292,0)
 d  ;
"RTN","SAMICTT0",293,0)
 . d OUT("References:")
"RTN","SAMICTT0",294,0)
 . d OUT("Recommendations for nodules and other findings are detailed in the I-ELCAP Protocol. ")
"RTN","SAMICTT0",295,0)
 . d OUT("A summary and the full I-ELCAP protocol can be viewed at: http://ielcap.org/protocols")
"RTN","SAMICTT0",296,0)
 ;d OUT("</TABLE>")
"RTN","SAMICTT0",297,0)
 ;d OUT("<p><br></p><p><b>References:</b><br></p>")
"RTN","SAMICTT0",298,0)
 ;d OUT("<p>Recommendations for nodules and other findings are detailed in the I-ELCAP Protocol.<BR>")
"RTN","SAMICTT0",299,0)
 ;d OUT("A summary and the full I-ELCAP protocol can be viewed at: <a href=""http://ielcap.org/protocols"">http://ielcap.org/protocols</a></p>")
"RTN","SAMICTT0",300,0)
 ;d OUT("</TD></TR></TABLE></TD></TR></TABLE>")
"RTN","SAMICTT0",301,0)
 ;s debug=1
"RTN","SAMICTT0",302,0)
 d:$g(debug)  ;
"RTN","SAMICTT0",303,0)
 . n zi s zi=""
"RTN","SAMICTT0",304,0)
 . f  s zi=$o(@vals@(zi)) q:zi=""  d  ;
"RTN","SAMICTT0",305,0)
 . . d OUT(zi_" "_$g(@vals@(zi)))
"RTN","SAMICTT0",306,0)
 ;d OUT("</BODY></HTML>")
"RTN","SAMICTT0",307,0)
 ;
"RTN","SAMICTT0",308,0)
 quit  ; end of wsr WSREPORT^SAMICTT0
"RTN","SAMICTT0",309,0)
 ;
"RTN","SAMICTT0",310,0)
 ;
"RTN","SAMICTT0",311,0)
 ;
"RTN","SAMICTT0",312,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT0",313,0)
 ;
"RTN","SAMICTT0",314,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT0",315,0)
 s cnt=cnt+1
"RTN","SAMICTT0",316,0)
 n lnn
"RTN","SAMICTT0",317,0)
 i $g(debug)'=1 s debug=0
"RTN","SAMICTT0",318,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",319,0)
 i outmode="go" d  ;
"RTN","SAMICTT0",320,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT0",321,0)
 . s line=""
"RTN","SAMICTT0",322,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",323,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT0",324,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT0",325,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT0",326,0)
 . n zs s zs=$STACK
"RTN","SAMICTT0",327,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT0",328,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT0",329,0)
 ;
"RTN","SAMICTT0",330,0)
 quit  ; end of OUT
"RTN","SAMICTT0",331,0)
 ;
"RTN","SAMICTT0",332,0)
 ;
"RTN","SAMICTT0",333,0)
 ;
"RTN","SAMICTT0",334,0)
OUTOLD(ln) ; old version of out
"RTN","SAMICTT0",335,0)
 ;
"RTN","SAMICTT0",336,0)
 s cnt=cnt+1
"RTN","SAMICTT0",337,0)
 n lnn
"RTN","SAMICTT0",338,0)
 ;s debug=1
"RTN","SAMICTT0",339,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT0",340,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT0",341,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT0",342,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT0",343,0)
 . n zs s zs=$STACK
"RTN","SAMICTT0",344,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT0",345,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT0",346,0)
 ;
"RTN","SAMICTT0",347,0)
 quit  ; end of OUTOLD
"RTN","SAMICTT0",348,0)
 ;
"RTN","SAMICTT0",349,0)
 ;
"RTN","SAMICTT0",350,0)
 ;
"RTN","SAMICTT0",351,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTT0",352,0)
 ;
"RTN","SAMICTT0",353,0)
 d OUT(ln)
"RTN","SAMICTT0",354,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT0",355,0)
 ;
"RTN","SAMICTT0",356,0)
 quit  ; end of HOUT
"RTN","SAMICTT0",357,0)
 ;
"RTN","SAMICTT0",358,0)
 ;
"RTN","SAMICTT0",359,0)
 ;
"RTN","SAMICTT0",360,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT0",361,0)
 ;
"RTN","SAMICTT0",362,0)
 ;@input
"RTN","SAMICTT0",363,0)
 ; @vals is passed by name
"RTN","SAMICTT0",364,0)
 ;
"RTN","SAMICTT0",365,0)
 n zr
"RTN","SAMICTT0",366,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT0",367,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT0",368,0)
 ;
"RTN","SAMICTT0",369,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT0",370,0)
 ;
"RTN","SAMICTT0",371,0)
 ;
"RTN","SAMICTT0",372,0)
 ;
"RTN","SAMICTT0",373,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT0",374,0)
 ;
"RTN","SAMICTT0",375,0)
 ; vals and dict are passed by name
"RTN","SAMICTT0",376,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT0",377,0)
 ;
"RTN","SAMICTT0",378,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT0",379,0)
 n zr,zv,zdx
"RTN","SAMICTT0",380,0)
 s zdx=$g(valdx)
"RTN","SAMICTT0",381,0)
 i zdx="" s zdx=var
"RTN","SAMICTT0",382,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT0",383,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT0",384,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT0",385,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT0",386,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT0",387,0)
 ;
"RTN","SAMICTT0",388,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT0",389,0)
 ;
"RTN","SAMICTT0",390,0)
 ;
"RTN","SAMICTT0",391,0)
 ;
"RTN","SAMICTT0",392,0)
GETFILTR(filter,sid) ; fill in the filter for Ct Eval for sid
"RTN","SAMICTT0",393,0)
 ;
"RTN","SAMICTT0",394,0)
 s filter("studyid")=sid
"RTN","SAMICTT0",395,0)
 n items,zform
"RTN","SAMICTT0",396,0)
 d GETITEMS^SAMICASE("items",sid)
"RTN","SAMICTT0",397,0)
 s zform=$o(items("ceform"))
"RTN","SAMICTT0",398,0)
 s filter("form")=zform
"RTN","SAMICTT0",399,0)
 ;zwr filter
"RTN","SAMICTT0",400,0)
 ;
"RTN","SAMICTT0",401,0)
 quit  ; end of GETFILTR
"RTN","SAMICTT0",402,0)
 ;
"RTN","SAMICTT0",403,0)
 ;
"RTN","SAMICTT0",404,0)
 ;
"RTN","SAMICTT0",405,0)
T1(grtn,debug) ; test
"RTN","SAMICTT0",406,0)
 ;
"RTN","SAMICTT0",407,0)
 n filter
"RTN","SAMICTT0",408,0)
 ;n sid s sid="XXX00333"
"RTN","SAMICTT0",409,0)
 ;n sid s sid="XXX00484"
"RTN","SAMICTT0",410,0)
 n sid s sid="XXX9000001"
"RTN","SAMICTT0",411,0)
 d GETFILTR(.filter,sid)
"RTN","SAMICTT0",412,0)
 i $g(debug)=1 s filter("debug")=1
"RTN","SAMICTT0",413,0)
 d WSNOTE^SAMINOT3(.grtn,.filter)
"RTN","SAMICTT0",414,0)
 ;d WSREPORT^SAMICTT0(.grtn,.filter)
"RTN","SAMICTT0",415,0)
 ;
"RTN","SAMICTT0",416,0)
 quit  ; end of T1
"RTN","SAMICTT0",417,0)
 ;
"RTN","SAMICTT0",418,0)
 ;
"RTN","SAMICTT0",419,0)
 ;
"RTN","SAMICTT0",420,0)
EOR ; end of routine SAMICTT0
"RTN","SAMICTT3")
0^5^B385554142
"RTN","SAMICTT3",1,0)
SAMICTT3 ;ven/gpl - ctreport text emphysema ;2021-10-29t22:43z
"RTN","SAMICTT3",2,0)
 ;;18.0;SAMI;**4,10,13,15**;2020-01;Build 2
"RTN","SAMICTT3",3,0)
 ;;18-15
"RTN","SAMICTT3",4,0)
 ;
"RTN","SAMICTT3",5,0)
 ; SAMICTT3 creates the Emphysema section of the ELCAP CT Report in
"RTN","SAMICTT3",6,0)
 ; text format.
"RTN","SAMICTT3",7,0)
 ;
"RTN","SAMICTT3",8,0)
 quit  ; no entry from top
"RTN","SAMICTT3",9,0)
 ;
"RTN","SAMICTT3",10,0)
 ;
"RTN","SAMICTT3",11,0)
 ;
"RTN","SAMICTT3",12,0)
 ;@section 0 primary development
"RTN","SAMICTT3",13,0)
 ;
"RTN","SAMICTT3",14,0)
 ;
"RTN","SAMICTT3",15,0)
 ;
"RTN","SAMICTT3",16,0)
 ;@license see routine SAMIUL
"RTN","SAMICTT3",17,0)
 ;@documentation see SAMICTUL
"RTN","SAMICTT3",18,0)
 ;@contents
"RTN","SAMICTT3",19,0)
 ; EMPHYS: emphysema section of ctreport text format
"RTN","SAMICTT3",20,0)
 ; $$CCMSTR = form phrases
"RTN","SAMICTT3",21,0)
 ; $$LOWC = convert X to lowercase
"RTN","SAMICTT3",22,0)
 ; OUT: output a line of ct report
"RTN","SAMICTT3",23,0)
 ; OUTOLD: old version of out
"RTN","SAMICTT3",24,0)
 ; HOUT: output a ct report header line
"RTN","SAMICTT3",25,0)
 ; $$XVAL = patient value for var
"RTN","SAMICTT3",26,0)
 ; GENLNL 
"RTN","SAMICTT3",27,0)
 ; $$XSUB = dictionary value defined by var
"RTN","SAMICTT3",28,0)
 ;
"RTN","SAMICTT3",29,0)
 ;
"RTN","SAMICTT3",30,0)
 ;
"RTN","SAMICTT3",31,0)
 ;@section 1 EMPHYS & related subroutines
"RTN","SAMICTT3",32,0)
 ;
"RTN","SAMICTT3",33,0)
 ;
"RTN","SAMICTT3",34,0)
 ;
"RTN","SAMICTT3",35,0)
EMPHYS(rtn,vals,dict) ; emphysema section of ct report text format
"RTN","SAMICTT3",36,0)
 ;
"RTN","SAMICTT3",37,0)
 ; repgen4,repgen5
"RTN","SAMICTT3",38,0)
 ;
"RTN","SAMICTT3",39,0)
 ;@called-by
"RTN","SAMICTT3",40,0)
 ; WSREPORT^SAMICTT0
"RTN","SAMICTT3",41,0)
 ;@calls
"RTN","SAMICTT3",42,0)
 ; $$XVAL
"RTN","SAMICTT3",43,0)
 ; HOUT
"RTN","SAMICTT3",44,0)
 ; OUT
"RTN","SAMICTT3",45,0)
 ; $$XSUB
"RTN","SAMICTT3",46,0)
 ; $$LOBESTR^SAMICTR2
"RTN","SAMICTT3",47,0)
 ; $$CCMSTR
"RTN","SAMICTT3",48,0)
 ; $$LOWC
"RTN","SAMICTT3",49,0)
 ;@input
"RTN","SAMICTT3",50,0)
 ; rtn
"RTN","SAMICTT3",51,0)
 ; vals
"RTN","SAMICTT3",52,0)
 ; dict
"RTN","SAMICTT3",53,0)
 ;@output: create emphysema section of ct eval report
"RTN","SAMICTT3",54,0)
 ;  
"RTN","SAMICTT3",55,0)
 ;# Emphysema
"RTN","SAMICTT3",56,0)
 ;
"RTN","SAMICTT3",57,0)
 n sp1 s sp1="  "
"RTN","SAMICTT3",58,0)
 s outmode="hold" s line=""
"RTN","SAMICTT3",59,0)
 ;if $$XVAL("ceemv",vals)'="e" d  ;
"RTN","SAMICTT3",60,0)
 if $$XVAL("ceem",vals)'="" d  ;
"RTN","SAMICTT3",61,0)
 . if $$XVAL("ceem",vals)="nv" q  ;
"RTN","SAMICTT3",62,0)
 . if $$XVAL("ceem",vals)="no" q  ;
"RTN","SAMICTT3",63,0)
 . ;d OUT("")
"RTN","SAMICTT3",64,0)
 . D HOUT("Emphysema: ")
"RTN","SAMICTT3",65,0)
 . ;d OUT("")
"RTN","SAMICTT3",66,0)
 . D OUT(sp1_$$XSUB("ceem",vals,dict))
"RTN","SAMICTT3",67,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",68,0)
 ;
"RTN","SAMICTT3",69,0)
 if $$XVAL("ceem",vals)="" d  ;
"RTN","SAMICTT3",70,0)
 . D HOUT("Emphysema: Emphysema score not provided.")
"RTN","SAMICTT3",71,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",72,0)
 ;d OUT("")
"RTN","SAMICTT3",73,0)
 s outmode="hold"
"RTN","SAMICTT3",74,0)
 D HOUT("Pleura: ")
"RTN","SAMICTT3",75,0)
 ;d OUT("")
"RTN","SAMICTT3",76,0)
 ; hputs "Pleura:"
"RTN","SAMICTT3",77,0)
 N pe s pe=0
"RTN","SAMICTT3",78,0)
 ;
"RTN","SAMICTT3",79,0)
 ; # Pleural Effusion
"RTN","SAMICTT3",80,0)
 ; 
"RTN","SAMICTT3",81,0)
 ;i $$XVAL("cepev",vals)="y" d  ;
"RTN","SAMICTT3",82,0)
 ;. if $$XVAL("ceper",vals)="-" d  ;
"RTN","SAMICTT3",83,0)
 ;. . if $$XVAL("cepel",vals)="-" d  ;
"RTN","SAMICTT3",84,0)
 ;. . . s @vals@("cepev")="e"
"RTN","SAMICTT3",85,0)
 ;. ;
"RTN","SAMICTT3",86,0)
 ;. if $$XVAL("cepev",vals)'="e" d  ;
"RTN","SAMICTT3",87,0)
 ;. . if $$XVAL("ceper",vals)'="-" d  ;
"RTN","SAMICTT3",88,0)
 ;. . . if $$XVAL("cepel",vals)'="-" d  ;
"RTN","SAMICTT3",89,0)
 ;. . . . if $$XVAL("cepel",vals)=$$XVAL("ceper",vals) d  ;
"RTN","SAMICTT3",90,0)
 ;. . . . . d OUT(sp1_"Bilateral "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusions. ") d OUT("")
"RTN","SAMICTT3",91,0)
 ;. . . . else  d  ;
"RTN","SAMICTT3",92,0)
 ;. . . . . d OUT(sp1_"Bilateral pleural effusions ; "_$$XSUB("cepe",vals,dict,"cepel")_" on left, and "_$$XSUB("cepe",vals,dict,"ceper")_" on right. ")
"RTN","SAMICTT3",93,0)
 ;. . . . . s pe=1
"RTN","SAMICTT3",94,0)
 ;. . . else  d  ;
"RTN","SAMICTT3",95,0)
 ;. . . . ;d OUT(sp1_"On right "_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion and on left "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion. ") d OUT("")
"RTN","SAMICTT3",96,0)
 ;. . . . d OUT(sp1_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion on right and "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion on left. ") d OUT("")
"RTN","SAMICTT3",97,0)
 ;. . . . s pe=1
"RTN","SAMICTT3",98,0)
 ;. . else  d  ;
"RTN","SAMICTT3",99,0)
 ;. . . ;d OUT(sp1_"On right "_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion and on left "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion. ") d OUT("")
"RTN","SAMICTT3",100,0)
 ;. . . d OUT(sp1_$$XSUB("cepe",vals,dict,"cepr")_" pleural effusion on right and "_$$XSUB("cepe",vals,dict,"cepel")_" pleural effusion on left. ") d OUT("")
"RTN","SAMICTT3",101,0)
 ;. . . s pe=1
"RTN","SAMICTT3",102,0)
 ;. ;
"RTN","SAMICTT3",103,0)
 ;i $$XVAL("cepev",vals)'="y" d  ; 
"RTN","SAMICTT3",104,0)
 ;. d OUT(sp1_"No pleural effusions. ") d OUT("")
"RTN","SAMICTT3",105,0)
 ;;  if { $pe == 0 } {
"RTN","SAMICTT3",106,0)
 ;;    puts "[tr "No pleural effusions"].${para}"
"RTN","SAMICTT3",107,0)
 ;;  }
"RTN","SAMICTT3",108,0)
 i $$XVAL("cepev",vals)="y" d  ;
"RTN","SAMICTT3",109,0)
 . n ceper,cepel,cepert,cepelt
"RTN","SAMICTT3",110,0)
 . s ceper=$$XVAL("ceper",vals)
"RTN","SAMICTT3",111,0)
 . s cepel=$$XVAL("cepel",vals)
"RTN","SAMICTT3",112,0)
 . s cepert=$$XSUB("cepe",vals,dict,"ceper")
"RTN","SAMICTT3",113,0)
 . s cepelt=$$XSUB("cepe",vals,dict,"cepel")
"RTN","SAMICTT3",114,0)
 . n left,right,both,neither,same
"RTN","SAMICTT3",115,0)
 . s left=1
"RTN","SAMICTT3",116,0)
 . i cepel="-" s left=0
"RTN","SAMICTT3",117,0)
 . i cepel="no" s left=0
"RTN","SAMICTT3",118,0)
 . s right=1
"RTN","SAMICTT3",119,0)
 . i ceper="-" s right=0
"RTN","SAMICTT3",120,0)
 . i ceper="no" s right=0
"RTN","SAMICTT3",121,0)
 . if right+left=2 set both=1
"RTN","SAMICTT3",122,0)
 . e  set both=0
"RTN","SAMICTT3",123,0)
 . if right+left=0 set neither=1
"RTN","SAMICTT3",124,0)
 . e  set neither=0
"RTN","SAMICTT3",125,0)
 . if ((both=1)&(ceper=cepel)) set same=1
"RTN","SAMICTT3",126,0)
 . e  set same=0
"RTN","SAMICTT3",127,0)
 . if same=1 d  ;
"RTN","SAMICTT3",128,0)
 . . d OUT(sp1_"Bilateral "_cepelt_" pleural effusions. ") d OUT("")
"RTN","SAMICTT3",129,0)
 . . s pe=1
"RTN","SAMICTT3",130,0)
 . if both=1 d  ;
"RTN","SAMICTT3",131,0)
 . . i pe=1 q  ;
"RTN","SAMICTT3",132,0)
 . . d OUT(sp1_"Bilateral pleural effusions ; "_cepelt_" on left, and "_cepert_" on right. ")
"RTN","SAMICTT3",133,0)
 . . s pe=1
"RTN","SAMICTT3",134,0)
 . if pe=0 d  ; both and same not done
"RTN","SAMICTT3",135,0)
 . . if right d  ;
"RTN","SAMICTT3",136,0)
 . . . d OUT(sp1_cepert_" right pleural effusion.")
"RTN","SAMICTT3",137,0)
 . . . s pe=1
"RTN","SAMICTT3",138,0)
 . . if left d  ;
"RTN","SAMICTT3",139,0)
 . . . d OUT(sp1_cepelt_" left pleural effusion.")
"RTN","SAMICTT3",140,0)
 . . . s pe=1
"RTN","SAMICTT3",141,0)
 . if pe=0 d  ; nothing worked
"RTN","SAMICTT3",142,0)
 . . d OUT(sp1_"No pleural effusion. ") d OUT("")
"RTN","SAMICTT3",143,0)
 ;
"RTN","SAMICTT3",144,0)
 i $$XVAL("cepev",vals)'="y" d  ; 
"RTN","SAMICTT3",145,0)
 . d OUT(sp1_"No pleural effusion. ") d OUT("")
"RTN","SAMICTT3",146,0)
 ;  if { $pe == 0 } {
"RTN","SAMICTT3",147,0)
 ;    puts "[tr "No pleural effusions"].${para}"
"RTN","SAMICTT3",148,0)
 ;  }
"RTN","SAMICTT3",149,0)
 ;  
"RTN","SAMICTT3",150,0)
 n yespp s yespp=0
"RTN","SAMICTT3",151,0)
 ;
"RTN","SAMICTT3",152,0)
 if $$XVAL("cebatr",vals)="y" d  ;
"RTN","SAMICTT3",153,0)
 . ;d OUT("Rounded atelectasis in the ")
"RTN","SAMICTT3",154,0)
 . d OUT(sp1_"Rounded atelectasis in the "_$$LOBESTR^SAMICTR2("cebatrl1^cebatrl2^cebatrl3^cebatrl4^cebatrl5",0)_". ") ;d OUT("")
"RTN","SAMICTT3",155,0)
 . s yespp=1
"RTN","SAMICTT3",156,0)
 ;
"RTN","SAMICTT3",157,0)
 if $$XVAL("cept",vals)="y" d  ;
"RTN","SAMICTT3",158,0)
 . s yespp=1
"RTN","SAMICTT3",159,0)
 . s numl=0
"RTN","SAMICTT3",160,0)
 . set str=sp1_"Pleural thickening/plaques in the "
"RTN","SAMICTT3",161,0)
 . if $$XVAL("ceptrt",vals)="r" d  ;
"RTN","SAMICTT3",162,0)
 . . s str=str_"right"
"RTN","SAMICTT3",163,0)
 . . s numl=numl+1
"RTN","SAMICTT3",164,0)
 . if $$XVAL("ceptlt",vals)="l" d  ;
"RTN","SAMICTT3",165,0)
 . . i numl>0 d  ;
"RTN","SAMICTT3",166,0)
 . . . s str=str_" and"
"RTN","SAMICTT3",167,0)
 . . s str=str_" left"
"RTN","SAMICTT3",168,0)
 . . s numl=numl+1
"RTN","SAMICTT3",169,0)
 . ;if numl>1 d  ;
"RTN","SAMICTT3",170,0)
 . ;. s str=str_" lungs. "
"RTN","SAMICTT3",171,0)
 . ;else  d  ;
"RTN","SAMICTT3",172,0)
 . ;. s str=str_" lung. "
"RTN","SAMICTT3",173,0)
 . s str=str_". "
"RTN","SAMICTT3",174,0)
 . if numl=0 set str=sp1_"Pleural thickening/plaques. "
"RTN","SAMICTT3",175,0)
 . d OUT(str) ;d OUT("")
"RTN","SAMICTT3",176,0)
 ;
"RTN","SAMICTT3",177,0)
 if $$XVAL("cepu",vals)="y" d  ;
"RTN","SAMICTT3",178,0)
 . s yespp=1
"RTN","SAMICTT3",179,0)
 . if $l($$XVAL("cepus",vals))'=0 d  ;
"RTN","SAMICTT3",180,0)
 . . d OUT(sp1_"Pleural rumor: "_$$XVAL("cepus",vals))
"RTN","SAMICTT3",181,0)
 . e  d OUT(sp1_"Pleural tumor. ")
"RTN","SAMICTT3",182,0)
 . ;d OUT("")
"RTN","SAMICTT3",183,0)
 ;
"RTN","SAMICTT3",184,0)
 i yespp=0 d OUT("")
"RTN","SAMICTT3",185,0)
 ;
"RTN","SAMICTT3",186,0)
 d  ;
"RTN","SAMICTT3",187,0)
 . if $$XVAL("ceoppab",vals)'="" d OUT(sp1_$$XVAL("ceoppab",vals)_". ") ;d OUT("")
"RTN","SAMICTT3",188,0)
 . else  d
"RTN","SAMICTT3",189,0)
 . . if yespp=1 d OUT("")
"RTN","SAMICTT3",190,0)
 ;
"RTN","SAMICTT3",191,0)
 s outmode="go" d OUT("")
"RTN","SAMICTT3",192,0)
 ;
"RTN","SAMICTT3",193,0)
 s outmode="hold"
"RTN","SAMICTT3",194,0)
 d OUT("Coronary Artery Calcifications: ")
"RTN","SAMICTT3",195,0)
 ;# Coronary Calcification
"RTN","SAMICTT3",196,0)
 n vcac,cac,cacrec
"RTN","SAMICTT3",197,0)
 s (cac,cacrec)=""
"RTN","SAMICTT3",198,0)
 ;
"RTN","SAMICTT3",199,0)
 n cectot s cectot=0
"RTN","SAMICTT3",200,0)
 i $g(@vals@("cecclm"))="no" s @vals@("cecclm")="no" s cectot=cectot+1
"RTN","SAMICTT3",201,0)
 i $g(@vals@("ceccld"))="no" s @vals@("ceccld")="no" s cectot=cectot+1
"RTN","SAMICTT3",202,0)
 i $g(@vals@("cecccf"))="no" s @vals@("cecccf")="no" s cectot=cectot+1
"RTN","SAMICTT3",203,0)
 i $g(@vals@("ceccrc"))="no" s @vals@("ceccrc")="no" s cectot=cectot+1
"RTN","SAMICTT3",204,0)
 i $g(@vals@("cecclm"))="-" s @vals@("cecclm")="no" s cectot=cectot+1
"RTN","SAMICTT3",205,0)
 i $g(@vals@("ceccld"))="-" s @vals@("ceccld")="no" s cectot=cectot+1
"RTN","SAMICTT3",206,0)
 i $g(@vals@("cecccf"))="-" s @vals@("cecccf")="no" s cectot=cectot+1
"RTN","SAMICTT3",207,0)
 i $g(@vals@("ceccrc"))="-" s @vals@("ceccrc")="no" s cectot=cectot+1
"RTN","SAMICTT3",208,0)
 i $g(@vals@("cecclm"))="" s @vals@("cecclm")="no" s cectot=cectot+1
"RTN","SAMICTT3",209,0)
 i $g(@vals@("ceccld"))="" s @vals@("ceccld")="no" s cectot=cectot+1
"RTN","SAMICTT3",210,0)
 i $g(@vals@("cecccf"))="" s @vals@("cecccf")="no" s cectot=cectot+1
"RTN","SAMICTT3",211,0)
 i $g(@vals@("ceccrc"))="" s @vals@("ceccrc")="no" s cectot=cectot+1
"RTN","SAMICTT3",212,0)
 S ^gpl("cectot")=cectot
"RTN","SAMICTT3",213,0)
 i cectot>3 d  ;
"RTN","SAMICTT3",214,0)
 . d OUT("Coronary Artery Calcification score not provided.") d OUT("")
"RTN","SAMICTT3",215,0)
 ; if $$XVAL("cecccac",vals)'="" d  ;
"RTN","SAMICTT3",216,0)
 ; . s @vals@("ceccv")="e"
"RTN","SAMICTT3",217,0)
 ;
"RTN","SAMICTT3",218,0)
 d  if $$XVAL("ceccv",vals)'="n" d  ;
"RTN","SAMICTT3",219,0)
 . set vcac=$$XVAL("cecccac",vals)
"RTN","SAMICTT3",220,0)
 . if cectot=4 q  ;
"RTN","SAMICTT3",221,0)
 . if vcac'="" d  ;
"RTN","SAMICTT3",222,0)
 . . s cacrec=""
"RTN","SAMICTT3",223,0)
 . . s cac="The Visual Coronary Artery Calcium (CAC) Score is "_vcac_". "
"RTN","SAMICTT3",224,0)
 . . s cacval=vcac
"RTN","SAMICTT3",225,0)
 . . i cacval>3 s cacrec=$g(@dict@("CAC_recommendation"))
"RTN","SAMICTT3",226,0)
 ;
"RTN","SAMICTT3",227,0)
 ;
"RTN","SAMICTT3",228,0)
 ;n samicac s samicac=0
"RTN","SAMICTT3",229,0)
 ;i $$XVAL("cecclm",vals)'="no" s samicac=1
"RTN","SAMICTT3",230,0)
 ;i $$XVAL("ceccld",vals)'="no" s samicac=1
"RTN","SAMICTT3",231,0)
 ;;i $$XVAL("cecclf",vals)'="no" s samicac=1
"RTN","SAMICTT3",232,0)
 ;i $$XVAL("cecccf",vals)'="no" s samicac=1
"RTN","SAMICTT3",233,0)
 ;i $$XVAL("ceccrc",vals)'="no" s samicac=1
"RTN","SAMICTT3",234,0)
 ;
"RTN","SAMICTT3",235,0)
 ;;s outmode="hold" s line=""
"RTN","SAMICTT3",236,0)
 ;i samicac=1 d  ;
"RTN","SAMICTT3",237,0)
 ;
"RTN","SAMICTT3",238,0)
 d  ;
"RTN","SAMICTT3",239,0)
 . if cectot>3 q  ;
"RTN","SAMICTT3",240,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecclm")_" in left main, ")
"RTN","SAMICTT3",241,0)
 . d OUT($$XSUB("cecc",vals,dict,"ceccld")_" in left anterior descending, ")
"RTN","SAMICTT3",242,0)
 . ;d OUT($$XSUB("cecc",vals,dict,"cecclf")_" in circumflex, and ")
"RTN","SAMICTT3",243,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecccf")_" in circumflex, and ")
"RTN","SAMICTT3",244,0)
 . d OUT($$XSUB("cecc",vals,dict,"ceccrc")_" in right coronary. "_cac)
"RTN","SAMICTT3",245,0)
 s outmode="go"
"RTN","SAMICTT3",246,0)
 d OUT("")
"RTN","SAMICTT3",247,0)
 ; 
"RTN","SAMICTT3",248,0)
 s outmode="hold"
"RTN","SAMICTT3",249,0)
 if $$XVAL("cecca",vals)'="-" d  ;
"RTN","SAMICTT3",250,0)
 . d HOUT("Aortic Calcifications: ")
"RTN","SAMICTT3",251,0)
 . d OUT($$XSUB("cecc",vals,dict,"cecca"))
"RTN","SAMICTT3",252,0)
 . s outmode="go" d OUT("")
"RTN","SAMICTT3",253,0)
 ;
"RTN","SAMICTT3",254,0)
 s outmode="hold"
"RTN","SAMICTT3",255,0)
 n ocf s ocf=0
"RTN","SAMICTT3",256,0)
 d HOUT("Other Cardiac Findings: ")
"RTN","SAMICTT3",257,0)
 ;d HOUT("Other Cardiac Findings: ")
"RTN","SAMICTT3",258,0)
 ;
"RTN","SAMICTT3",259,0)
 ;s outmode="hold"
"RTN","SAMICTT3",260,0)
 ;# Pericardial Effusion
"RTN","SAMICTT3",261,0)
 if $$XVAL("ceprevm",vals)'="-" d  ;
"RTN","SAMICTT3",262,0)
 . if $$XVAL("ceprevm",vals)'="no" d  ;
"RTN","SAMICTT3",263,0)
 . . if $$XVAL("ceprevm",vals)'="" d
"RTN","SAMICTT3",264,0)
 . . . d OUT("A "_$$XSUB("ceprevm",vals,dict,"ceprevm")_" pericardial effusion"_". ") d OUT("")
"RTN","SAMICTT3",265,0)
 . . . s pe=1 s ocf=1
"RTN","SAMICTT3",266,0)
 . . else  d OUT("No pericardial effusion. ") d OUT("")
"RTN","SAMICTT3",267,0)
 ;
"RTN","SAMICTT3",268,0)
 ;
"RTN","SAMICTT3",269,0)
 ;;# Pulmonary and Aortic Diameter
"RTN","SAMICTT3",270,0)
 i $$XVAL("cepaw",vals)'="" d  ;
"RTN","SAMICTT3",271,0)
 . d OUT("Widest main pulmonary artery diameter is "_$$XVAL("cepaw",vals)_" mm. ")
"RTN","SAMICTT3",272,0)
 . if $$XVAL("ceaow",vals)'="" d  ;
"RTN","SAMICTT3",273,0)
 . . d OUT("Widest ascending aortic diameter at the same level is "_$$XVAL("ceaow",vals)_" mm. ")
"RTN","SAMICTT3",274,0)
 . . if $$XVAL("cepar",vals)'="" d  ;
"RTN","SAMICTT3",275,0)
 . . . d OUT("The ratio is "_$$XVAL("cepar",vals)_". ")
"RTN","SAMICTT3",276,0)
 . d OUT("") s ocf=1
"RTN","SAMICTT3",277,0)
 ;
"RTN","SAMICTT3",278,0)
 ; #"Additional Comments on Cardiac Abnormalities:"
"RTN","SAMICTT3",279,0)
 if $$XVAL("cecommca",vals)'="" d  ;
"RTN","SAMICTT3",280,0)
 . d OUT($$XVAL("cecommca",vals)_". ")
"RTN","SAMICTT3",281,0)
 . s ocf=1
"RTN","SAMICTT3",282,0)
 i ocf=0 d OUT("None. ")
"RTN","SAMICTT3",283,0)
 s outmode="go"
"RTN","SAMICTT3",284,0)
 d OUT("")
"RTN","SAMICTT3",285,0)
 ;
"RTN","SAMICTT3",286,0)
 ;
"RTN","SAMICTT3",287,0)
 s outmode="hold"
"RTN","SAMICTT3",288,0)
 d HOUT("Mediastinum: ")
"RTN","SAMICTT3",289,0)
 n yesmm s yesmm=0
"RTN","SAMICTT3",290,0)
 n abn
"RTN","SAMICTT3",291,0)
 i ($$XVAL("ceoma",vals)="y")&($$XVAL("ceata",vals)="y") d  ;
"RTN","SAMICTT3",292,0)
 . s yeamm=1
"RTN","SAMICTT3",293,0)
 . s abn=$$CCMSTR("ceatc^ceaty^ceatm",vals)
"RTN","SAMICTT3",294,0)
 . ;d OUT("[abn="_abn_"]")
"RTN","SAMICTT3",295,0)
 . i abn="" d OUT(sp1_"Noted in the thyroid. ")
"RTN","SAMICTT3",296,0)
 . i abn'="" d OUT(sp1_abn_" thyroid. ")
"RTN","SAMICTT3",297,0)
 . i $$XVAL("ceato",vals)="o" d OUT(sp1_$$XVAL("ceatos",vals)_"<br>")
"RTN","SAMICTT3",298,0)
 i $$XVAL("ceaya",vals)="y" d  ;
"RTN","SAMICTT3",299,0)
 . s yesmm=1
"RTN","SAMICTT3",300,0)
 . s abn=$$CCMSTR("ceayc^ceayy^ceaym",vals)
"RTN","SAMICTT3",301,0)
 . i abn="" d OUT(sp1_"Noted in the thymus")
"RTN","SAMICTT3",302,0)
 . i abn'="" d OUT(sp1_abn_" thymus. ")
"RTN","SAMICTT3",303,0)
 . i $$XVAL("ceayo",vals)="o" d OUT(sp1_$$XVAL("ceayos",vals))
"RTN","SAMICTT3",304,0)
 ;
"RTN","SAMICTT3",305,0)
 ;   # Non-calcified lymph nodes
"RTN","SAMICTT3",306,0)
 n lnlist,lnlistt,lnlcnt
"RTN","SAMICTT3",307,0)
 set lnlcnt=22
"RTN","SAMICTT3",308,0)
 set lnlist(1)="cemlnl1"
"RTN","SAMICTT3",309,0)
 set lnlist(2)="cemlnl2l"
"RTN","SAMICTT3",310,0)
 set lnlist(2.5)="cemlnl2r"
"RTN","SAMICTT3",311,0)
 set lnlist(3)="cemlnl3a"
"RTN","SAMICTT3",312,0)
 set lnlist(3.5)="cemlnl3p"
"RTN","SAMICTT3",313,0)
 set lnlist(4)="cemlnl4l"
"RTN","SAMICTT3",314,0)
 set lnlist(4.5)="cemlnl4r"
"RTN","SAMICTT3",315,0)
 set lnlist(5)="cemlnl5"
"RTN","SAMICTT3",316,0)
 set lnlist(6)="cemlnl6"
"RTN","SAMICTT3",317,0)
 set lnlist(7)="cemlnl7"
"RTN","SAMICTT3",318,0)
 set lnlist(8)="cemlnl8"
"RTN","SAMICTT3",319,0)
 set lnlist(9)="cemlnl9"
"RTN","SAMICTT3",320,0)
 set lnlist(10)="cemlnl10l"
"RTN","SAMICTT3",321,0)
 set lnlist(10.5)="cemlnl10r"
"RTN","SAMICTT3",322,0)
 set lnlist(11)="cemlnl11l"
"RTN","SAMICTT3",323,0)
 set lnlist(11.5)="cemlnl11r"
"RTN","SAMICTT3",324,0)
 set lnlist(12)="cemlnl12l"
"RTN","SAMICTT3",325,0)
 set lnlist(12.5)="cemlnl12r"
"RTN","SAMICTT3",326,0)
 set lnlist(13)="cemlnl13l"
"RTN","SAMICTT3",327,0)
 set lnlist(13.5)="cemlnl13r"
"RTN","SAMICTT3",328,0)
 set lnlist(14)="cemlnl14l"
"RTN","SAMICTT3",329,0)
 set lnlist(14.5)="cemlnl14r"
"RTN","SAMICTT3",330,0)
 ;
"RTN","SAMICTT3",331,0)
 set lnlistt(1)="N1: Low cervical, supraclavicular, and sternal notch nodes"
"RTN","SAMICTT3",332,0)
 set lnlistt(2)="N2L: Upper paratracheal (left)"
"RTN","SAMICTT3",333,0)
 set lnlistt(2.5)="N2R: Upper paratracheal (right)"
"RTN","SAMICTT3",334,0)
 set lnlistt(3)="N3A: Prevascular"
"RTN","SAMICTT3",335,0)
 set lnlistt(3.5)="N3P: Retrotracheal"
"RTN","SAMICTT3",336,0)
 set lnlistt(4)="N4L: Lower paratracheal (left)"
"RTN","SAMICTT3",337,0)
 set lnlistt(4.5)="N4R: Lower paratracheal (right)"
"RTN","SAMICTT3",338,0)
 set lnlistt(5)="N5: Subaortic"
"RTN","SAMICTT3",339,0)
 set lnlistt(6)="N6: Para-aortic (ascending aorta or phrenic)"
"RTN","SAMICTT3",340,0)
 set lnlistt(7)="N7: Subcarinal"
"RTN","SAMICTT3",341,0)
 set lnlistt(8)="N8: Paraesophageal (below carina)"
"RTN","SAMICTT3",342,0)
 set lnlistt(9)="N9: Pulmonary ligament"
"RTN","SAMICTT3",343,0)
 set lnlistt(10)="N10L: Hilar (left)"
"RTN","SAMICTT3",344,0)
 set lnlistt(10.5)="N10R: Hilar (right)"
"RTN","SAMICTT3",345,0)
 set lnlistt(11)="N11L: Interlobar (left)"
"RTN","SAMICTT3",346,0)
 set lnlistt(11.5)="N11R: Interlobar (right)"
"RTN","SAMICTT3",347,0)
 set lnlistt(12)="N12L: Lobar (left)"
"RTN","SAMICTT3",348,0)
 set lnlistt(12.5)="N12R: Lobar (right)"
"RTN","SAMICTT3",349,0)
 set lnlistt(13)="N13L: Segmental (left)"
"RTN","SAMICTT3",350,0)
 set lnlistt(13.5)="N13R: Segmental (right)"
"RTN","SAMICTT3",351,0)
 set lnlistt(14)="N14L: Subsegmental (left)"
"RTN","SAMICTT3",352,0)
 set lnlistt(14.5)="N14R: Subsegmental (right)"
"RTN","SAMICTT3",353,0)
 ;
"RTN","SAMICTT3",354,0)
 ;set lnlist(1)="cemlnl1"
"RTN","SAMICTT3",355,0)
 ;set lnlist(2)="cemlnl2r"
"RTN","SAMICTT3",356,0)
 ;set lnlist(3)="cemlnl2l"
"RTN","SAMICTT3",357,0)
 ;set lnlist(4)="cemlnl3"
"RTN","SAMICTT3",358,0)
 ;set lnlist(5)="cemlnl4r"
"RTN","SAMICTT3",359,0)
 ;set lnlist(6)="cemlnl4l"
"RTN","SAMICTT3",360,0)
 ;set lnlist(7)="cemlnl5"
"RTN","SAMICTT3",361,0)
 ;set lnlist(8)="cemlnl6"
"RTN","SAMICTT3",362,0)
 ;set lnlist(9)="cemlnl7"
"RTN","SAMICTT3",363,0)
 ;set lnlist(10)="cemlnl8"
"RTN","SAMICTT3",364,0)
 ;set lnlist(11)="cemlnl9"
"RTN","SAMICTT3",365,0)
 ;set lnlist(12)="cemlnl10r"
"RTN","SAMICTT3",366,0)
 ;set lnlist(13)="cemlnl10l"
"RTN","SAMICTT3",367,0)
 ;
"RTN","SAMICTT3",368,0)
 ;set lnlistt(1)="high mediastinal"
"RTN","SAMICTT3",369,0)
 ;set lnlistt(2)="right upper paratracheal"
"RTN","SAMICTT3",370,0)
 ;set lnlistt(3)="left upper paratracheal"
"RTN","SAMICTT3",371,0)
 ;set lnlistt(4)="prevascular/retrotracheal"
"RTN","SAMICTT3",372,0)
 ;set lnlistt(5)="right lower paratracheal"
"RTN","SAMICTT3",373,0)
 ;set lnlistt(6)="left lower paratracheal"
"RTN","SAMICTT3",374,0)
 ;set lnlistt(7)="sub-aortic (A-P window)"
"RTN","SAMICTT3",375,0)
 ;set lnlistt(8)="para-aortic"
"RTN","SAMICTT3",376,0)
 ;set lnlistt(9)="subcarinal"
"RTN","SAMICTT3",377,0)
 ;set lnlistt(10)="para-esophageal"
"RTN","SAMICTT3",378,0)
 ;set lnlistt(11)="pulmonary ligament"
"RTN","SAMICTT3",379,0)
 ;set lnlistt(12)="right hilar"
"RTN","SAMICTT3",380,0)
 ;set lnlistt(13)="left hilar"
"RTN","SAMICTT3",381,0)
 ;
"RTN","SAMICTT3",382,0)
 ;
"RTN","SAMICTT3",383,0)
 ;s outmode="hold"
"RTN","SAMICTT3",384,0)
 if $$XVAL("cemln",vals)="y" d  ;
"RTN","SAMICTT3",385,0)
 . s yesmm=1
"RTN","SAMICTT3",386,0)
 . n llist,item
"RTN","SAMICTT3",387,0)
 . s (llist,item)=""
"RTN","SAMICTT3",388,0)
 . n lnum,slnum
"RTN","SAMICTT3",389,0)
 . s lnum=0
"RTN","SAMICTT3",390,0)
 . f  s item=$o(lnlist(item)) q:item=""  d  ;
"RTN","SAMICTT3",391,0)
 . . ;i $$XVAL(lnlist(item),vals)'="" s llist($o(llist(""),-1)+1)=lnlist(item)
"RTN","SAMICTT3",392,0)
 . . i $$XVAL(lnlist(item),vals)'="" d  ;
"RTN","SAMICTT3",393,0)
 . . . s llist(item)=lnlist(item)
"RTN","SAMICTT3",394,0)
 . . . s lnum=lnum+1
"RTN","SAMICTT3",395,0)
 . ;s lnum=$o(llist(""),-1)
"RTN","SAMICTT3",396,0)
 . i lnum=0 d OUT("Enlarged or growing lymph nodes are noted. ")
"RTN","SAMICTT3",397,0)
 . i lnum>0 d  ;
"RTN","SAMICTT3",398,0)
 . . s slnum=lnum
"RTN","SAMICTT3",399,0)
 . . ;d OUT("Enlarged or growing lymph nodes in the ")
"RTN","SAMICTT3",400,0)
 . . d OUT("Enlarged or growing lymph nodes: ")
"RTN","SAMICTT3",401,0)
 . . s item=""
"RTN","SAMICTT3",402,0)
 . . f  s item=$o(llist(item)) q:item=""  d  ;
"RTN","SAMICTT3",403,0)
 . . . d OUT(lnlistt(item))
"RTN","SAMICTT3",404,0)
 . . . i lnum>2 d OUT(", ")
"RTN","SAMICTT3",405,0)
 . . . i lnum=2 d OUT(" and ")
"RTN","SAMICTT3",406,0)
 . . . s lnum=lnum-1
"RTN","SAMICTT3",407,0)
 . . ;i slnum>1 d OUT(" locations. ")
"RTN","SAMICTT3",408,0)
 . . ;i slnum=1 d OUT(" location. ")
"RTN","SAMICTT3",409,0)
 . . d OUT(". ")
"RTN","SAMICTT3",410,0)
 ;
"RTN","SAMICTT3",411,0)
 ;s outmode="go"
"RTN","SAMICTT3",412,0)
 ;d OUT("")
"RTN","SAMICTT3",413,0)
 ;
"RTN","SAMICTT3",414,0)
 if $$XVAL("cemlncab",vals)="y" d  ;
"RTN","SAMICTT3",415,0)
 . set yesmm=1
"RTN","SAMICTT3",416,0)
 . d OUT("Calcified lymph nodes present. ")
"RTN","SAMICTT3",417,0)
 ;
"RTN","SAMICTT3",418,0)
 if $$XVAL("ceagaln",vals)="y" d  ;
"RTN","SAMICTT3",419,0)
 . set yesmm=1
"RTN","SAMICTT3",420,0)
 . d OUT("Enlarged or growing axillary lymph nodes without central fat are seen. ")
"RTN","SAMICTT3",421,0)
 . d OUT($$XVAL("ceagalns",vals))
"RTN","SAMICTT3",422,0)
 ;
"RTN","SAMICTT3",423,0)
 if $$XVAL("cemva",vals)="y" d  ;
"RTN","SAMICTT3",424,0)
 . set yesmm=1
"RTN","SAMICTT3",425,0)
 . if $$XVAL("cemvaa",vals)="a" d  ;
"RTN","SAMICTT3",426,0)
 . . d OUT("Other vascular abnormalities are seen in the aorta. ")
"RTN","SAMICTT3",427,0)
 . if $$XVAL("cemvaa",vals)="w" d  ;
"RTN","SAMICTT3",428,0)
 . . d OUT("Other vascular abnormalities are seen in the pulmonary series. ")
"RTN","SAMICTT3",429,0)
 . d OUT($$XVAL("cemvaos",vals)_"<br>")
"RTN","SAMICTT3",430,0)
 ;
"RTN","SAMICTT3",431,0)
 ;s outmode="hold"
"RTN","SAMICTT3",432,0)
 ;   # Esophageal
"RTN","SAMICTT3",433,0)
 if $$XVAL("cemeln",vals)="y" d  ;
"RTN","SAMICTT3",434,0)
 . set yesmm=1
"RTN","SAMICTT3",435,0)
 . n elist s elist=""
"RTN","SAMICTT3",436,0)
 . set numl=0
"RTN","SAMICTT3",437,0)
 . if $$XVAL("cemelna",vals)="a" d  ;
"RTN","SAMICTT3",438,0)
 . . s elist($o(elist(""),-1)+1)="Air-fluid level"
"RTN","SAMICTT3",439,0)
 . . s numl=numl+1
"RTN","SAMICTT3",440,0)
 . if $$XVAL("cemelnw",vals)="w" d  ;
"RTN","SAMICTT3",441,0)
 . . s elist($o(elist(""),-1)+1)="Wall thickening"
"RTN","SAMICTT3",442,0)
 . . s numl=numl+1
"RTN","SAMICTT3",443,0)
 . if $$XVAL("cemelnm",vals)="m" d  ;
"RTN","SAMICTT3",444,0)
 . . s elist($o(elist(""),-1)+1)="A mass"
"RTN","SAMICTT3",445,0)
 . . s numl=numl+1
"RTN","SAMICTT3",446,0)
 . if numl=0 d OUT("Esophageal abnormality noted. ")
"RTN","SAMICTT3",447,0)
 . e  d  ;
"RTN","SAMICTT3",448,0)
 . . d OUT($g(elist(1)))
"RTN","SAMICTT3",449,0)
 . . if numl=1 d OUT(" is ")
"RTN","SAMICTT3",450,0)
 . . e  d  ;
"RTN","SAMICTT3",451,0)
 . . . if numl=2 d  ;
"RTN","SAMICTT3",452,0)
 . . . . d OUT(" and ")
"RTN","SAMICTT3",453,0)
 . . . e  d OUT(", ")
"RTN","SAMICTT3",454,0)
 . . . d OUT($$LOWC($g(elist(2))))
"RTN","SAMICTT3",455,0)
 . . . if numl=3 d  ;
"RTN","SAMICTT3",456,0)
 . . . . d OUT(", and "_$$LOWC($g(elist(3))))
"RTN","SAMICTT3",457,0)
 . . d OUT("seen in the esophagus. ")
"RTN","SAMICTT3",458,0)
 . d OUT($$XVAL("cemelnos",vals))
"RTN","SAMICTT3",459,0)
 ;s outmode="go"
"RTN","SAMICTT3",460,0)
 ;d OUT("")
"RTN","SAMICTT3",461,0)
 ;
"RTN","SAMICTT3",462,0)
 ;
"RTN","SAMICTT3",463,0)
 if $$XVAL("cehhn",vals)="y" d  ;
"RTN","SAMICTT3",464,0)
 . set yesmm=1
"RTN","SAMICTT3",465,0)
 . if $$XVAL("cehhnos",vals)'="" d OUT("Hiatal hernia: "_$$XVAL("cehhnos",vals))
"RTN","SAMICTT3",466,0)
 . if $$XVAL("cehhnos",vals)="" d OUT("Hiatal hernia. ")
"RTN","SAMICTT3",467,0)
 . d OUT("")
"RTN","SAMICTT3",468,0)
 ;
"RTN","SAMICTT3",469,0)
 if $$XVAL("ceomm",vals)="y" d  ;
"RTN","SAMICTT3",470,0)
 . set yesmm=1
"RTN","SAMICTT3",471,0)
 . n tval
"RTN","SAMICTT3",472,0)
 . set tval=$$XVAL("ceommos",vals)
"RTN","SAMICTT3",473,0)
 . set abn=$$CCMSTR("ceamc^ceamy^ceamm",vals)
"RTN","SAMICTT3",474,0)
 . if abn="" d OUT(sp1_"Abnormality noted in the mediastinum. ")
"RTN","SAMICTT3",475,0)
 . e  d OUT(sp1_abn_" mediastinum. ")
"RTN","SAMICTT3",476,0)
 . d OUT(tval)
"RTN","SAMICTT3",477,0)
 ;i yesmm=0 d OUT(sp1_"No abnormalities. ")
"RTN","SAMICTT3",478,0)
 i yesmm=0 d OUT(sp1_"Unremarkable. ")
"RTN","SAMICTT3",479,0)
 i $$XVAL("ceotabnm",vals)'="" d  ;
"RTN","SAMICTT3",480,0)
 . d OUT(sp1_$$XVAL("ceotabnm",vals)_". ")
"RTN","SAMICTT3",481,0)
 s outmode="go"
"RTN","SAMICTT3",482,0)
 d OUT("")
"RTN","SAMICTT3",483,0)
 ;
"RTN","SAMICTT3",484,0)
 ;
"RTN","SAMICTT3",485,0)
 quit  ; end of EMPHYS
"RTN","SAMICTT3",486,0)
 ;
"RTN","SAMICTT3",487,0)
 ;
"RTN","SAMICTT3",488,0)
 ;
"RTN","SAMICTT3",489,0)
CCMSTR(lst,vals) ; extrinsic that forms phrases
"RTN","SAMICTT3",490,0)
 ;
"RTN","SAMICTT3",491,0)
 ;@called-by
"RTN","SAMICTT3",492,0)
 ; EMPHYS
"RTN","SAMICTT3",493,0)
 ;@calls
"RTN","SAMICTT3",494,0)
 ; $$XVAL
"RTN","SAMICTT3",495,0)
 ; $$LOWC
"RTN","SAMICTT3",496,0)
 ;@input
"RTN","SAMICTT3",497,0)
 ; lst
"RTN","SAMICTT3",498,0)
 ; vals
"RTN","SAMICTT3",499,0)
 ;@output = phrase for comments
"RTN","SAMICTT3",500,0)
 ;
"RTN","SAMICTT3",501,0)
 n retstr s retstr=""
"RTN","SAMICTT3",502,0)
 n lblist s lblist=""
"RTN","SAMICTT3",503,0)
 n lb,ib s ib=""
"RTN","SAMICTT3",504,0)
 f lb=1:1:$l(lst,"^") d  ;
"RTN","SAMICTT3",505,0)
 . n lvar s lvar=$p(lst,"^",lb)
"RTN","SAMICTT3",506,0)
 . s ib=$$XVAL($p(lst,"^",lb),vals)
"RTN","SAMICTT3",507,0)
 . if ib'="" d  ;
"RTN","SAMICTT3",508,0)
 . . i ib="y" d  ; 
"RTN","SAMICTT3",509,0)
 . . . i $f("ceasc cealc ceapc ceapc ceaac ceakc",lvar)>0 s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",510,0)
 . . . ;i "ceasc cealc ceapc ceapc ceaac ceakc"[lb s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",511,0)
 . . . else  s lblist($o(lblist(""),-1)+1)="Cyst"
"RTN","SAMICTT3",512,0)
 . . i ib="c" s lblist($o(lblist(""),-1)+1)="Calcification"
"RTN","SAMICTT3",513,0)
 . . i ib="m" s lblist($o(lblist(""),-1)+1)="Mass"
"RTN","SAMICTT3",514,0)
 i $o(lblist(""),-1)=1 s retstr=retstr_lblist(1)_" is seen in the"
"RTN","SAMICTT3",515,0)
 e  i $o(lblist(""),-1)=2 s retstr=retstr_lblist(1)_" and "_$$LOWC(lblist(2))_" are seen in the"
"RTN","SAMICTT3",516,0)
 e  i $o(lblist(""),-1)=3 s retstr=retstr_"Calicification, cyst, and mass are seen in the"
"RTN","SAMICTT3",517,0)
 ;
"RTN","SAMICTT3",518,0)
 quit retstr ; end of $$CCMSTR
"RTN","SAMICTT3",519,0)
 ;
"RTN","SAMICTT3",520,0)
 ;
"RTN","SAMICTT3",521,0)
 ;
"RTN","SAMICTT3",522,0)
LOWC(X) ; convert X to lowercase
"RTN","SAMICTT3",523,0)
 ;
"RTN","SAMICTT3",524,0)
 ;@called-by
"RTN","SAMICTT3",525,0)
 ; EMPHYS
"RTN","SAMICTT3",526,0)
 ; $$CCMSTR
"RTN","SAMICTT3",527,0)
 ;@calls none
"RTN","SAMICTT3",528,0)
 ;@input
"RTN","SAMICTT3",529,0)
 ; X
"RTN","SAMICTT3",530,0)
 ;@output = lowercase string
"RTN","SAMICTT3",531,0)
 ;
"RTN","SAMICTT3",532,0)
 quit $translate(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","SAMICTT3",533,0)
 ;
"RTN","SAMICTT3",534,0)
 ;
"RTN","SAMICTT3",535,0)
 ;
"RTN","SAMICTT3",536,0)
OUT(ln) ; output a line of ct report
"RTN","SAMICTT3",537,0)
 ;
"RTN","SAMICTT3",538,0)
 ;@called-by
"RTN","SAMICTT3",539,0)
 ; EMPHYS
"RTN","SAMICTT3",540,0)
 ;@calls none
"RTN","SAMICTT3",541,0)
 ;@input
"RTN","SAMICTT3",542,0)
 ; ln = output to add
"RTN","SAMICTT3",543,0)
 ;@output: line added to report
"RTN","SAMICTT3",544,0)
 ;
"RTN","SAMICTT3",545,0)
 i outmode="hold" s line=line_ln q  ;
"RTN","SAMICTT3",546,0)
 s cnt=cnt+1
"RTN","SAMICTT3",547,0)
 n lnn
"RTN","SAMICTT3",548,0)
 ;s debug=1
"RTN","SAMICTT3",549,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",550,0)
 i outmode="go" d  ;
"RTN","SAMICTT3",551,0)
 . s @rtn@(lnn)=line
"RTN","SAMICTT3",552,0)
 . s line=""
"RTN","SAMICTT3",553,0)
 . s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",554,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT3",555,0)
 ;
"RTN","SAMICTT3",556,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT3",557,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT3",558,0)
 . n zs s zs=$STACK
"RTN","SAMICTT3",559,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT3",560,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT3",561,0)
 ;
"RTN","SAMICTT3",562,0)
 quit  ; end of OUT
"RTN","SAMICTT3",563,0)
 ;
"RTN","SAMICTT3",564,0)
 ;
"RTN","SAMICTT3",565,0)
 ;
"RTN","SAMICTT3",566,0)
OUTOLD(ln) ; old version of out
"RTN","SAMICTT3",567,0)
 ;
"RTN","SAMICTT3",568,0)
 ;@called-by none
"RTN","SAMICTT3",569,0)
 ;@calls none
"RTN","SAMICTT3",570,0)
 ;@input
"RTN","SAMICTT3",571,0)
 ; ln = output to add
"RTN","SAMICTT3",572,0)
 ;@output: line added to report
"RTN","SAMICTT3",573,0)
 ;
"RTN","SAMICTT3",574,0)
 s cnt=cnt+1
"RTN","SAMICTT3",575,0)
 n lnn
"RTN","SAMICTT3",576,0)
 ;s debug=1
"RTN","SAMICTT3",577,0)
 s lnn=$o(@rtn@(" "),-1)+1
"RTN","SAMICTT3",578,0)
 s @rtn@(lnn)=ln
"RTN","SAMICTT3",579,0)
 ;
"RTN","SAMICTT3",580,0)
 i $g(debug)=1 d  ;
"RTN","SAMICTT3",581,0)
 . i ln["<" q  ; no markup
"RTN","SAMICTT3",582,0)
 . n zs s zs=$STACK
"RTN","SAMICTT3",583,0)
 . n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMICTT3",584,0)
 . s @rtn@(lnn)=zp_":"_ln
"RTN","SAMICTT3",585,0)
 ;
"RTN","SAMICTT3",586,0)
 quit  ; end of OUTOLD
"RTN","SAMICTT3",587,0)
 ;
"RTN","SAMICTT3",588,0)
 ;
"RTN","SAMICTT3",589,0)
 ;
"RTN","SAMICTT3",590,0)
HOUT(ln) ; output a ct report header line
"RTN","SAMICTT3",591,0)
 ;
"RTN","SAMICTT3",592,0)
 ;@called-by
"RTN","SAMICTT3",593,0)
 ; EMPHYS
"RTN","SAMICTT3",594,0)
 ;@calls
"RTN","SAMICTT3",595,0)
 ; OUT
"RTN","SAMICTT3",596,0)
 ;@input
"RTN","SAMICTT3",597,0)
 ; ln = header output to add
"RTN","SAMICTT3",598,0)
 ;@output: header line added to report
"RTN","SAMICTT3",599,0)
 ;
"RTN","SAMICTT3",600,0)
 D OUT(ln)
"RTN","SAMICTT3",601,0)
 ;d OUT("<p><span class='sectionhead'>"_ln_"</span>")
"RTN","SAMICTT3",602,0)
 ;
"RTN","SAMICTT3",603,0)
 quit  ; end of HOUT
"RTN","SAMICTT3",604,0)
 ;
"RTN","SAMICTT3",605,0)
 ;
"RTN","SAMICTT3",606,0)
 ;
"RTN","SAMICTT3",607,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMICTT3",608,0)
 ;
"RTN","SAMICTT3",609,0)
 ;@called-by
"RTN","SAMICTT3",610,0)
 ; EMPHYS
"RTN","SAMICTT3",611,0)
 ; $$CCMSTR
"RTN","SAMICTT3",612,0)
 ;@calls none
"RTN","SAMICTT3",613,0)
 ;@input
"RTN","SAMICTT3",614,0)
 ; var
"RTN","SAMICTT3",615,0)
 ; vals is passed by nam
"RTN","SAMICTT3",616,0)
 ;@output = patient value for var
"RTN","SAMICTT3",617,0)
 ;
"RTN","SAMICTT3",618,0)
 ;e
"RTN","SAMICTT3",619,0)
 n zr
"RTN","SAMICTT3",620,0)
 s zr=$g(@vals@(var))
"RTN","SAMICTT3",621,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMICTT3",622,0)
 ;
"RTN","SAMICTT3",623,0)
 quit zr ; end of $$XVAL
"RTN","SAMICTT3",624,0)
 ;
"RTN","SAMICTT3",625,0)
 ;
"RTN","SAMICTT3",626,0)
 ;
"RTN","SAMICTT3",627,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMICTT3",628,0)
 ;
"RTN","SAMICTT3",629,0)
 ;@called-by
"RTN","SAMICTT3",630,0)
 ; EMPHYS
"RTN","SAMICTT3",631,0)
 ;@calls none
"RTN","SAMICTT3",632,0)
 ;@input
"RTN","SAMICTT3",633,0)
 ; var
"RTN","SAMICTT3",634,0)
 ; vals and dict are passed by name
"RTN","SAMICTT3",635,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMICTT3",636,0)
 ;@output = dictionary value for var
"RTN","SAMICTT3",637,0)
 ;
"RTN","SAMICTT3",638,0)
 ;
"RTN","SAMICTT3",639,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMICTT3",640,0)
 n zr,zv,zdx
"RTN","SAMICTT3",641,0)
 s zdx=$g(valdx)
"RTN","SAMICTT3",642,0)
 i zdx="" s zdx=var
"RTN","SAMICTT3",643,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMICTT3",644,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMICTT3",645,0)
 i zv="" s zr="" q zr
"RTN","SAMICTT3",646,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMICTT3",647,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMICTT3",648,0)
 ;
"RTN","SAMICTT3",649,0)
 quit zr ; end of $$XSUB
"RTN","SAMICTT3",650,0)
 ;
"RTN","SAMICTT3",651,0)
GENLNL() ;
"RTN","SAMICTT3",652,0)
 ;
"RTN","SAMICTT3",653,0)
 n droot s droot=$$setroot^%wd("form fields - ct evaluation")
"RTN","SAMICTT3",654,0)
 n froot s froot=$na(@droot@("field","B"))
"RTN","SAMICTT3",655,0)
 n lnlist,lnlistt
"RTN","SAMICTT3",656,0)
 n cnt s cnt=0
"RTN","SAMICTT3",657,0)
 n cemlnl s cemlnl="cemlnl"
"RTN","SAMICTT3",658,0)
 f  s cemlnl=$o(@froot@(cemlnl)) q:cemlnl=""  q:cemlnl'["cemlnl"  d  ;
"RTN","SAMICTT3",659,0)
 . w !,cemlnl
"RTN","SAMICTT3",660,0)
 . s cnt=cnt+1
"RTN","SAMICTT3",661,0)
 . n fien s fien=$o(@froot@(cemlnl,""))
"RTN","SAMICTT3",662,0)
 . q:fien=""
"RTN","SAMICTT3",663,0)
 . ;zwr @droot@("field",fien,"input",1,*)
"RTN","SAMICTT3",664,0)
 . n lbl
"RTN","SAMICTT3",665,0)
 . s lbl=$g(@droot@("field",fien,"input",1,"label"))
"RTN","SAMICTT3",666,0)
 . ;s lbl=$p(lbl,": ",2)
"RTN","SAMICTT3",667,0)
 . ;s lbl=$$LOWC^SAMICTT3(lbl)
"RTN","SAMICTT3",668,0)
 . n norder,dec
"RTN","SAMICTT3",669,0)
 . s dec=0
"RTN","SAMICTT3",670,0)
 . s norder=$g(@droot@("field",fien,"input",1,"value"))
"RTN","SAMICTT3",671,0)
 . i $e(norder,1)'="N" w !,"N error!!" b
"RTN","SAMICTT3",672,0)
 . s norder=$e(norder,2,$l(norder))
"RTN","SAMICTT3",673,0)
 . i $e(norder,$l(norder))="L" d  ;
"RTN","SAMICTT3",674,0)
 . . s dec=0
"RTN","SAMICTT3",675,0)
 . . s norder=$e(norder,1,$l(norder)-1)
"RTN","SAMICTT3",676,0)
 . i $e(norder,$l(norder))="R" d  ;
"RTN","SAMICTT3",677,0)
 . . s dec=.5
"RTN","SAMICTT3",678,0)
 . . s norder=$e(norder,1,$l(norder)-1)
"RTN","SAMICTT3",679,0)
 . i $e(norder,$l(norder))="A" d  ;
"RTN","SAMICTT3",680,0)
 . . s dec=0
"RTN","SAMICTT3",681,0)
 . . s norder=$e(norder,1,$l(norder)-1)
"RTN","SAMICTT3",682,0)
 . i $e(norder,$l(norder))="P" d  ;
"RTN","SAMICTT3",683,0)
 . . s dec=.5
"RTN","SAMICTT3",684,0)
 . . s norder=$e(norder,1,$l(norder)-1)
"RTN","SAMICTT3",685,0)
 . s norder=norder+dec
"RTN","SAMICTT3",686,0)
 . w !,lbl," ",norder
"RTN","SAMICTT3",687,0)
 . s lnlist(norder)=cemlnl
"RTN","SAMICTT3",688,0)
 . s lnlistt(norder)=lbl
"RTN","SAMICTT3",689,0)
 zwr lnlist
"RTN","SAMICTT3",690,0)
 zwr lnlistt
"RTN","SAMICTT3",691,0)
 w !," set lnlcnt="_cnt
"RTN","SAMICTT3",692,0)
 n i s i=""
"RTN","SAMICTT3",693,0)
 f  s i=$o(lnlist(i)) q:i=""  w !," set lnlist(",i,")=""",lnlist(i),""""
"RTN","SAMICTT3",694,0)
 w !," ;"
"RTN","SAMICTT3",695,0)
 f  s i=$o(lnlistt(i)) q:i=""  w !," set lnlistt(",i,")=""",lnlistt(i),""""
"RTN","SAMICTT3",696,0)
 q
"RTN","SAMICTT3",697,0)
 ;
"RTN","SAMICTT3",698,0)
 ;
"RTN","SAMICTT3",699,0)
EOR ; end of routine SAMICTT3
"RTN","SAMICTUL")
0^6^B107594
"RTN","SAMICTUL",1,0)
SAMICTUL ;ven/gpl - ct report & copy log ;2021-10-29t22:43z
"RTN","SAMICTUL",2,0)
 ;;18.0;SAMI;**10,11,12,13,15**;2020-01;Build 2
"RTN","SAMICTUL",3,0)
 ;;18.15
"RTN","SAMICTUL",4,0)
 ;
"RTN","SAMICTUL",5,0)
 ; SAMICTUL contains routine & module info & the primary development
"RTN","SAMICTUL",6,0)
 ; log for VAPALS-ELCAP's CT Report ctreport web service route, which
"RTN","SAMICTUL",7,0)
 ; is implemented by the SAMICTR* (html) and SAMICTT* (text)
"RTN","SAMICTUL",8,0)
 ; routines. It also contains the log for the SAMICTC* routines that
"RTN","SAMICTUL",9,0)
 ; implement the ct form copy operation.
"RTN","SAMICTUL",10,0)
 ; SAMICTUL contains no public interfaces or executable code.
"RTN","SAMICTUL",11,0)
 ;
"RTN","SAMICTUL",12,0)
 quit  ; no entry from top
"RTN","SAMICTUL",13,0)
 ;
"RTN","SAMICTUL",14,0)
 ;
"RTN","SAMICTUL",15,0)
 ;
"RTN","SAMICTUL",16,0)
 ;@section 0 primary development
"RTN","SAMICTUL",17,0)
 ;
"RTN","SAMICTUL",18,0)
 ;
"RTN","SAMICTUL",19,0)
 ;
"RTN","SAMICTUL",20,0)
 ;@routine-credits
"RTN","SAMICTUL",21,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMICTUL",22,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICTUL",23,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMICTUL",24,0)
 ; http://vistaexpertise.net
"RTN","SAMICTUL",25,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMICTUL",26,0)
 ;@license Apache 2.0
"RTN","SAMICTUL",27,0)
 ; https://www.apache.org/licenses/LICENSE-2.0.html
"RTN","SAMICTUL",28,0)
 ;
"RTN","SAMICTUL",29,0)
 ;@last-update 2021-10-29t22:43z
"RTN","SAMICTUL",30,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMICTUL",31,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMICTUL",32,0)
 ;@version 18.15
"RTN","SAMICTUL",33,0)
 ;@release-date 2020-01
"RTN","SAMICTUL",34,0)
 ;@patch-list **10,11,12,15**
"RTN","SAMICTUL",35,0)
 ;
"RTN","SAMICTUL",36,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMICTUL",37,0)
 ; toad@vistaexpertise.net
"RTN","SAMICTUL",38,0)
 ;@dev-add Alexis Carlson (arc)
"RTN","SAMICTUL",39,0)
 ; alexis.carlson@vistaexpertise.net
"RTN","SAMICTUL",40,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMICTUL",41,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICTUL",42,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMICTUL",43,0)
 ; lmry@vistaexpertise.net
"RTN","SAMICTUL",44,0)
 ;
"RTN","SAMICTUL",45,0)
 ;@module-credits
"RTN","SAMICTUL",46,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICTUL",47,0)
 ; (VA-PALS)
"RTN","SAMICTUL",48,0)
 ; http://va-pals.org/
"RTN","SAMICTUL",49,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICTUL",50,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICTUL",51,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICTUL",52,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICTUL",53,0)
 ;@partner-org International Early Lung Cancer Action Program (IELCAP)
"RTN","SAMICTUL",54,0)
 ; http://ielcap.com/
"RTN","SAMICTUL",55,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICTUL",56,0)
 ; http://paraxialtech.com/
"RTN","SAMICTUL",57,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICTUL",58,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICTUL",59,0)
 ;
"RTN","SAMICTUL",60,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICTUL",61,0)
 ;
"RTN","SAMICTUL",62,0)
 ; 2018-07-01/05 ven/arc&lgc 18.0 8b0a4329,f5ff7eeb,5549cd30
"RTN","SAMICTUL",63,0)
 ;  SAMICTD2 1st version of CT Eval Report, fix init routine, get
"RTN","SAMICTUL",64,0)
 ; lungrads & nonodules working.
"RTN","SAMICTUL",65,0)
 ;
"RTN","SAMICTUL",66,0)
 ; 2018-10-14 ven/arc 18.0 f6e1229
"RTN","SAMICTUL",67,0)
 ;  SAMICTC1 turn on copy forward for cteval new forms
"RTN","SAMICTUL",68,0)
 ;
"RTN","SAMICTUL",69,0)
 ; 2018-12-11/2019-01-22 ven/lgc&lmry 18.0 9925713f,3ceb74b,3bb70c8,
"RTN","SAMICTUL",70,0)
 ; d22e0f21,5368121
"RTN","SAMICTUL",71,0)
 ;  SAMICTC1,2,D2 sac compliance, add license info.
"RTN","SAMICTUL",72,0)
 ;
"RTN","SAMICTUL",73,0)
 ; 2020-02-01/03 ven/arc 18.4 d47135a5,bc32c1cb,5b2e4525,7bcd14a2,
"RTN","SAMICTUL",74,0)
 ; 1c96fe0e,cb0075e8,5e553dd2,9cde6840,dcea0048e,98b7b273,a4f98f19
"RTN","SAMICTUL",75,0)
 ;  SAMICTT0,1,2,3,4,9,A routines (starting as copies of SAMICTR*) to
"RTN","SAMICTUL",76,0)
 ; implement ctreport in text format, start convert nodules to text,
"RTN","SAMICTUL",77,0)
 ; add'l lung findings, fix parag spacing, add impressions sect,
"RTN","SAMICTUL",78,0)
 ; recommendations sect, add'l sects on other abnormalities, breast
"RTN","SAMICTUL",79,0)
 ; abnorm sect, other abnorm sect, tweak format, make it more compact.
"RTN","SAMICTUL",80,0)
 ;
"RTN","SAMICTUL",81,0)
 ; 2021-02-18 ven/gpl 18.10 38fb2d70
"RTN","SAMICTUL",82,0)
 ;  SAMICTT0,1,2,3,4,9,A ct report - insert space after every period.
"RTN","SAMICTUL",83,0)
 ;
"RTN","SAMICTUL",84,0)
 ; 2021-03-04/16 ven/gpl 18.10 e09d5f16,3ea26de9,91793ba3
"RTN","SAMICTUL",85,0)
 ;  SAMICTT1,3,4 ct report: fix normal cardiac default output, CAC
"RTN","SAMICTUL",86,0)
 ; logic, other enhancements.
"RTN","SAMICTUL",87,0)
 ;
"RTN","SAMICTUL",88,0)
 ; 2021-03-23 ven/gpl 18.10 a68f7f31
"RTN","SAMICTUL",89,0)
 ;  SAMICTT3 fix CAC problem.
"RTN","SAMICTUL",90,0)
 ;
"RTN","SAMICTUL",91,0)
 ; 2021-03-21/23 ven/toad 18.10 96f461d
"RTN","SAMICTUL",92,0)
 ;  SAMICTUL: create development log routine.
"RTN","SAMICTUL",93,0)
 ;  SAMICTT0,1,2,3,4,9,A bump date & version, lt refactor.
"RTN","SAMICTUL",94,0)
 ;
"RTN","SAMICTUL",95,0)
 ; 2021-05-14 ven/gpl 18.11 0a01cf2
"RTN","SAMICTUL",96,0)
 ;  SAMICTTA in RCMND change to ctreport for no followup ct w/other
"RTN","SAMICTUL",97,0)
 ; followup recommendations, "Followup" instead of "Other Followup."
"RTN","SAMICTUL",98,0)
 ;
"RTN","SAMICTUL",99,0)
 ; 2021-05-19 ven/gpl 18.11 a21b056,139c6a5
"RTN","SAMICTUL",100,0)
 ;  SAMICTT0 in WSREPORT check for small nodule checkboxes.
"RTN","SAMICTUL",101,0)
 ;  SAMICTT1 in NODULES urgent fix to add to ct report "Small [non-]
"RTN","SAMICTUL",102,0)
 ; calcified nodules are present."
"RTN","SAMICTUL",103,0)
 ;
"RTN","SAMICTUL",104,0)
 ; 2021-05-20/21 ven/mcglk&toad 18.11 43a4557,129e96b
"RTN","SAMICTUL",105,0)
 ;  SAMICTT0,1 bump version & dates.
"RTN","SAMICTUL",106,0)
 ;
"RTN","SAMICTUL",107,0)
 ; 2021-05-24 ven/gpl 18.11 4aba1a9
"RTN","SAMICTUL",108,0)
 ;  SAMICTC1 in CTCOPY add new param key to control two new opening
"RTN","SAMICTUL",109,0)
 ; blocks, critical fix to copy forward for Is It New field for new ct
"RTN","SAMICTUL",110,0)
 ; eval forms.
"RTN","SAMICTUL",111,0)
 ;
"RTN","SAMICTUL",112,0)
 ; 2021-05-25 ven/toad 18.11 801d7c7
"RTN","SAMICTUL",113,0)
 ;  SAMICTC1 bump version & dates; passim annotate & lt refactor.
"RTN","SAMICTUL",114,0)
 ;  SAMICTUL add SAMICTC* routines to log.
"RTN","SAMICTUL",115,0)
 ;
"RTN","SAMICTUL",116,0)
 ; 2021-06-01 ven/gpl 18.11 e86756e
"RTN","SAMICTUL",117,0)
 ;  SAMICTC1 corrected bug on CT eval copy forward: in CTCOPY stanza
"RTN","SAMICTUL",118,0)
 ; 2 q:isnew="".
"RTN","SAMICTUL",119,0)
 ;
"RTN","SAMICTUL",120,0)
 ; 2021-06-04 ven/toad 18.11 7dd9410c,911264de
"RTN","SAMICTUL",121,0)
 ;  SAMICTC1 fold in gpl chg, log, bump dates.
"RTN","SAMICTUL",122,0)
 ;
"RTN","SAMICTUL",123,0)
 ; 2021-07-19 ven/gpl 18.12 e9359411
"RTN","SAMICTUL",124,0)
 ;  SAMICTD2 chg minimal to mild for emphysema in ct report.
"RTN","SAMICTUL",125,0)
 ;
"RTN","SAMICTUL",126,0)
 ; 2021-08-17 ven/gpl 18.13 023fcdff
"RTN","SAMICTUL",127,0)
 ;  SAMICTT3 correct typo in field name for circumflex in CAC section
"RTN","SAMICTUL",128,0)
 ;
"RTN","SAMICTUL",129,0)
 ; 2021-10-19 ven/gpl 18-15 520cbe86,f9b7b5a1,137e131e,514476c3,ba04a578,
"RTN","SAMICTUL",130,0)
 ;  013dd1ad
"RTN","SAMICTUL",131,0)
 ;  SAMICTT0 remove extra space in front of Description, surpress comparison 
"RTN","SAMICTUL",132,0)
 ;  scans on baseline CT eval
"RTN","SAMICTUL",133,0)
 ;  SAMICTT3 added GENLNL for lymph nodes, fixed pleural effusion logic, if no
"RTN","SAMICTUL",134,0)
 ;  input, say CAC score not provided,new lymph node table generated from the
"RTN","SAMICTUL",135,0)
 ;  ct eval tsv graph
"RTN","SAMICTUL",136,0)
 ;  SAMICTD2 remove above from Impression section of ct rpt and followup note
"RTN","SAMICTUL",137,0)
 ;
"RTN","SAMICTUL",138,0)
 ; 2021-10-21 ven/gpl 18-15 5b9cd54b
"RTN","SAMICTUL",139,0)
 ;  SAMICTT3 fix in lymph node description algorithm
"RTN","SAMICTUL",140,0)
 ;
"RTN","SAMICTUL",141,0)
 ; 2021-10-25 ven/gpl 18-15 d147d56f
"RTN","SAMICTUL",142,0)
 ;  SAMICTT3 corrections to pleura and lymph node report text
"RTN","SAMICTUL",143,0)
 ;
"RTN","SAMICTUL",144,0)
 ; 2021-10-26 ven/gpl 18-15 cd36ee6a,f31f8722
"RTN","SAMICTUL",145,0)
 ;  SAMICTT0 fixed CT report Comparison Scans logic
"RTN","SAMICTUL",146,0)
 ;  SAMICTT3 change working on emphysema score not provided
"RTN","SAMICTUL",147,0)
 ;
"RTN","SAMICTUL",148,0)
 ; 2021-10-28 ven/gpl 18-15 194989af
"RTN","SAMICTUL",149,0)
 ;  SAMICTT3 fix detecting no cac score provided
"RTN","SAMICTUL",150,0)
 ;
"RTN","SAMICTUL",151,0)
 ; 2021-10-29 ven/lmry 18-15
"RTN","SAMICTUL",152,0)
 ;  SAMICTT0 SAMICTT3 bump versions and dates
"RTN","SAMICTUL",153,0)
 ;  SAMICTT3 add semi-colon after GENLNL for XINDEX
"RTN","SAMICTUL",154,0)
 ;
"RTN","SAMICTUL",155,0)
 ;
"RTN","SAMICTUL",156,0)
 ;@contents
"RTN","SAMICTUL",157,0)
 ; SAMICTC1 ceform copy
"RTN","SAMICTUL",158,0)
 ; SAMICTC2 ceform copy continued
"RTN","SAMICTUL",159,0)
 ;
"RTN","SAMICTUL",160,0)
 ; SAMICTD2 cteval-dict init
"RTN","SAMICTUL",161,0)
 ;
"RTN","SAMICTUL",162,0)
 ; SAMICTT0 ctreport text main
"RTN","SAMICTUL",163,0)
 ; SAMICTT1 ctreport text nodules
"RTN","SAMICTUL",164,0)
 ; SAMICTT2 ctreport text other lung
"RTN","SAMICTUL",165,0)
 ; SAMICTT3 ctreport text emphysema
"RTN","SAMICTUL",166,0)
 ; SAMICTT4 ctreport text breast abnorm
"RTN","SAMICTUL",167,0)
 ; SAMICTT9 ctreport text impressions
"RTN","SAMICTUL",168,0)
 ; SAMICTTA ctreport text recommendations
"RTN","SAMICTUL",169,0)
 ; SAMICTUL ctreport log
"RTN","SAMICTUL",170,0)
 ;
"RTN","SAMICTUL",171,0)
 ; SAMICTR* ctreport html format
"RTN","SAMICTUL",172,0)
 ; SAMIUTR* test the SAMICTR routines
"RTN","SAMICTUL",173,0)
 ;
"RTN","SAMICTUL",174,0)
 ;
"RTN","SAMICTUL",175,0)
 ;
"RTN","SAMICTUL",176,0)
EOR ; end of routine SAMICTUL
"RTN","SAMICUL")
0^7^B136079
"RTN","SAMICUL",1,0)
SAMICUL ;ven/gpl - case review log ;2021-10-29t02:24z
"RTN","SAMICUL",2,0)
 ;;18.0;SAMI;**9,11,12,14,15**;2020-01;Build 2
"RTN","SAMICUL",3,0)
 ;;18.15
"RTN","SAMICUL",4,0)
 ;
"RTN","SAMICUL",5,0)
 ; SAMICUL contains the development log for the VAPALS-IELCAP Case
"RTN","SAMICUL",6,0)
 ; Review Page (SAMICA* routines).
"RTN","SAMICUL",7,0)
 ; It contains no executable code.
"RTN","SAMICUL",8,0)
 ;
"RTN","SAMICUL",9,0)
 quit  ; no entry from top
"RTN","SAMICUL",10,0)
 ;
"RTN","SAMICUL",11,0)
 ;
"RTN","SAMICUL",12,0)
 ;
"RTN","SAMICUL",13,0)
 ;@section 0 primary development
"RTN","SAMICUL",14,0)
 ;
"RTN","SAMICUL",15,0)
 ;
"RTN","SAMICUL",16,0)
 ;
"RTN","SAMICUL",17,0)
 ;@routine-credits
"RTN","SAMICUL",18,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMICUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMICUL",20,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMICUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMICUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMICUL",23,0)
 ;@license see routine SAMIUL
"RTN","SAMICUL",24,0)
 ;
"RTN","SAMICUL",25,0)
 ;@last-update 2021-10-29t02:24z
"RTN","SAMICUL",26,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMICUL",27,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMICUL",28,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMICUL",29,0)
 ;@version 18.15
"RTN","SAMICUL",30,0)
 ;@release-date 2020-01
"RTN","SAMICUL",31,0)
 ;@patch-list **9,11,12,14,15**
"RTN","SAMICUL",32,0)
 ;
"RTN","SAMICUL",33,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMICUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMICUL",35,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMICUL",36,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMICUL",37,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMICUL",38,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMICUL",39,0)
 ;@dev-add Domenick DiNatale (ddn)
"RTN","SAMICUL",40,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMICUL",41,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMICUL",42,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMICUL",43,0)
 ;
"RTN","SAMICUL",44,0)
 ;@module-credits
"RTN","SAMICUL",45,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMICUL",46,0)
 ; (VA-PALS)
"RTN","SAMICUL",47,0)
 ; http://va-pals.org/
"RTN","SAMICUL",48,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMICUL",49,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMICUL",50,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMICUL",51,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMICUL",52,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMICUL",53,0)
 ; http://ielcap.com/
"RTN","SAMICUL",54,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMICUL",55,0)
 ; http://paraxialtech.com/
"RTN","SAMICUL",56,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMICUL",57,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMICUL",58,0)
 ;
"RTN","SAMICUL",59,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMICUL",60,0)
 ;
"RTN","SAMICUL",61,0)
 ; 2018-01-14 ven/gpl 18.0-t4
"RTN","SAMICUL",62,0)
 ;  SAMICASE split from routine SAMIFRM, incl wsCASE,GETTMPL,GETITEMS,
"RTN","SAMICUL",63,0)
 ; casetbl.
"RTN","SAMICUL",64,0)
 ;
"RTN","SAMICUL",65,0)
 ; 2018-02-05/08 ven/toad 18.0-t4
"RTN","SAMICUL",66,0)
 ;  SAMICASE update style, license, & attribution, spell out language
"RTN","SAMICUL",67,0)
 ; elements, add white space & do-dot quits, r/replaceAll^%wfhfrom w/
"RTN","SAMICUL",68,0)
 ; replaceAll^%wf, r/$$getTemplate^%wfhform w/$$getTemplate^%wf.
"RTN","SAMICUL",69,0)
 ;
"RTN","SAMICUL",70,0)
 ; 2018-02-14 ven/toad 18.0-t4
"RTN","SAMICUL",71,0)
 ;  SAMICASE r/replaceAll^%wf w/findReplaceAll^%wf, r/ln w/line, add
"RTN","SAMICUL",72,0)
 ; @calls & @called-by tags, break up some long lines.
"RTN","SAMICUL",73,0)
 ;
"RTN","SAMICUL",74,0)
 ; 2018-02-27 ven/gpl 18.0-t4
"RTN","SAMICUL",75,0)
 ;  SAMICASE new subroutines $$KEY2DSPD, $$GETDTKEY; in wsCASE get
"RTN","SAMICUL",76,0)
 ; 1st & last names from graph, fix paths, key forms in graph w/date.
"RTN","SAMICUL",77,0)
 ;
"RTN","SAMICUL",78,0)
 ; 2018-03-01 ven/toad 18.0-t4
"RTN","SAMICUL",79,0)
 ;  SAMICASE refactor & reorganize new code, add header comments, r/
"RTN","SAMICUL",80,0)
 ; findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",81,0)
 ;
"RTN","SAMICUL",82,0)
 ; 2018-03-06 ven/gpl 18.0-t4
"RTN","SAMICUL",83,0)
 ;  SAMICASE add New Form button, list rest of forms for patient, add
"RTN","SAMICUL",84,0)
 ; web services wsNuForm & wsNuFormPost & method MKCEFORM, extend
"RTN","SAMICUL",85,0)
 ; GETITEMS to get rest of forms.
"RTN","SAMICUL",86,0)
 ;
"RTN","SAMICUL",87,0)
 ; 2018-03-07/08 ven/toad 18.0-t4
"RTN","SAMICUL",88,0)
 ;  SAMICASE merge George changes w/ rest, add white space, spell out
"RTN","SAMICUL",89,0)
 ; M elements, add hdr comments to new subroutines, r/findReplace^%wf
"RTN","SAMICUL",90,0)
 ; & replaceAll^%wf w/findReplace^%ts.
"RTN","SAMICUL",91,0)
 ;
"RTN","SAMICUL",92,0)
 ; 2018-03-11 ven/gpl 18.0-t4 9bd663ee
"RTN","SAMICUL",93,0)
 ;  SAMICAS2 vapals forms working.
"RTN","SAMICUL",94,0)
 ;
"RTN","SAMICUL",95,0)
 ; 2018-03-12 ven/gpl 18.0-t4 8c36c6a7
"RTN","SAMICUL",96,0)
 ;  SAMICAS2 new form works now & charts on home page.
"RTN","SAMICUL",97,0)
 ;
"RTN","SAMICUL",98,0)
 ; 2018-03-14 ven/gpl 18.0-t4 9653650a
"RTN","SAMICUL",99,0)
 ;  SAMICAS2 revised casereview page link, fixed external url
"RTN","SAMICUL",100,0)
 ; preservation.
"RTN","SAMICUL",101,0)
 ;
"RTN","SAMICUL",102,0)
 ; 2018-03-21 ven/gpl 18.0-t4 48868561
"RTN","SAMICUL",103,0)
 ;  SAMICAS2 max date insertion, case review navigation changed to
"RTN","SAMICUL",104,0)
 ; post, date order for CT Eval in case review.
"RTN","SAMICUL",105,0)
 ;
"RTN","SAMICUL",106,0)
 ; 2018-03-26 ven/gpl 18.0-t4 5fa4ee96
"RTN","SAMICUL",107,0)
 ;  SAMICAS2 changes to support incomplete forms display &
"RTN","SAMICUL",108,0)
 ; processing.
"RTN","SAMICUL",109,0)
 ;
"RTN","SAMICUL",110,0)
 ; 2018-03-27 ven/gpl 18.0-t4 cace9756
"RTN","SAMICUL",111,0)
 ;  SAMICAS2 siforms are always complete.
"RTN","SAMICUL",112,0)
 ;
"RTN","SAMICUL",113,0)
 ; 2018-04-02 ven/gpl 18.0-t4 00da9146
"RTN","SAMICUL",114,0)
 ;  SAMICAS2 added followup form.
"RTN","SAMICUL",115,0)
 ;
"RTN","SAMICUL",116,0)
 ; 2018-04-24 ven/gpl 18.0-t4 22e39d87
"RTN","SAMICUL",117,0)
 ;  SAMICAS2 added pet & biopsy forms.
"RTN","SAMICUL",118,0)
 ;
"RTN","SAMICUL",119,0)
 ; 2018-05-01 ven/gpl 18.0-t4 f1751c43
"RTN","SAMICUL",120,0)
 ;  SAMICAS2 fix problem with new forms: followup & pet.
"RTN","SAMICUL",121,0)
 ;
"RTN","SAMICUL",122,0)
 ; 2018-05-18 ven/lgc 18.0-t4 9eba8f8c
"RTN","SAMICUL",123,0)
 ;  SAMICAS2 conversion to new graph and simplified forms processing.
"RTN","SAMICUL",124,0)
 ;
"RTN","SAMICUL",125,0)
 ; 2018-05-21 ven/lgc 18.0-t4 0d7ed2f7
"RTN","SAMICUL",126,0)
 ;  SAMICAS2 changes for new navigation html.
"RTN","SAMICUL",127,0)
 ;
"RTN","SAMICUL",128,0)
 ; 2018-06-14 ven/lgc 18.0-t4 d71f4fe4
"RTN","SAMICUL",129,0)
 ;  SAMICAS2 changes to make the background form optional.
"RTN","SAMICUL",130,0)
 ;
"RTN","SAMICUL",131,0)
 ; 2018-06-20 ven/lgc 18.0-t4 bf03b07f
"RTN","SAMICUL",132,0)
 ;  SAMICAS2 corrections for new forms processing navigation.
"RTN","SAMICUL",133,0)
 ;
"RTN","SAMICUL",134,0)
 ; 2018-07-01 ven/lgc 18.0-t4 2e1541dc,8b0a4329
"RTN","SAMICUL",135,0)
 ;  SAMICAS2 add intervention forms to case review page, 1st version
"RTN","SAMICUL",136,0)
 ; of ct eval report.
"RTN","SAMICUL",137,0)
 ;
"RTN","SAMICUL",138,0)
 ; 2018-07-04 ven/lgc 18.0-t4 b28c1658
"RTN","SAMICUL",139,0)
 ;  SAMICAS2 fix a typo.
"RTN","SAMICUL",140,0)
 ;
"RTN","SAMICUL",141,0)
 ; 2018-07-10 ven/lgc 18.0-t4 2e9662b4
"RTN","SAMICUL",142,0)
 ;  SAMICAS2 repair SAMIHOM3 & redact report link.
"RTN","SAMICUL",143,0)
 ;
"RTN","SAMICUL",144,0)
 ; 2018-08-19 ven/lgc 18.0-t4 2ce0cab4
"RTN","SAMICUL",145,0)
 ;  SAMICAS2 use ssn instead of last5 where available.
"RTN","SAMICUL",146,0)
 ;
"RTN","SAMICUL",147,0)
 ; 2018-08-20 ven/lgc 18.0-t4 955fd484
"RTN","SAMICUL",148,0)
 ;  SAMICAS2 fix case review page cr lf issue.
"RTN","SAMICUL",149,0)
 ;
"RTN","SAMICUL",150,0)
 ; 2018-08-22 ven/gpl 18.0-t4 d67a2fe5
"RTN","SAMICUL",151,0)
 ;  SAMICAS2 turn off ctreport.
"RTN","SAMICUL",152,0)
 ;
"RTN","SAMICUL",153,0)
 ; 2018-08-30 ven/lgc 18.0-t4 125f1c8b
"RTN","SAMICUL",154,0)
 ;  SAMICAS2 add type index to getItems to help find last previous
"RTN","SAMICUL",155,0)
 ; form of a type.
"RTN","SAMICUL",156,0)
 ;
"RTN","SAMICUL",157,0)
 ; 2018-09-04 ven/lgc 18.0-t4 3e6e326f
"RTN","SAMICUL",158,0)
 ;  SAMICAS2 hide report link.
"RTN","SAMICUL",159,0)
 ;
"RTN","SAMICUL",160,0)
 ; 2018-10-14 ven/lgc 18.0-t4 f6e1229f
"RTN","SAMICUL",161,0)
 ;  SAMICAS2 turn on copy forward for cteval new forms.
"RTN","SAMICUL",162,0)
 ;
"RTN","SAMICUL",163,0)
 ; 2018-10-26 ven/lgc 18.0-t4 f19bf1ae
"RTN","SAMICUL",164,0)
 ;  SAMICAS2 ability to add multiple forms on same day.
"RTN","SAMICUL",165,0)
 ;
"RTN","SAMICUL",166,0)
 ; 2018-11-07 ven/gpl 18.0-t4 c76b2eac
"RTN","SAMICUL",167,0)
 ;  SAMICAS2 defend against unit test patient 1.
"RTN","SAMICUL",168,0)
 ;
"RTN","SAMICUL",169,0)
 ; 2018-11-13 ven/toad 18.0-t4
"RTN","SAMICUL",170,0)
 ;  SAMICAS2 SAMIHOM2 > SAMIHOM3.
"RTN","SAMICUL",171,0)
 ;
"RTN","SAMICUL",172,0)
 ; 2018-11-14 ven/lgc 18.0-t4 6e9799ba
"RTN","SAMICUL",173,0)
 ;  SAMICUL fix graphstore forms.
"RTN","SAMICUL",174,0)
 ;
"RTN","SAMICUL",175,0)
 ; 2018-11-28 ven/lgc 18.0-t4 a9539464
"RTN","SAMICUL",176,0)
 ;  SAMICAS2 work on sac compliance.
"RTN","SAMICUL",177,0)
 ;
"RTN","SAMICUL",178,0)
 ; 2018-12-11 ven/lgc 18.0-t4 3ceb74b5
"RTN","SAMICUL",179,0)
 ;  SAMICAS2 update for sac compliance.
"RTN","SAMICUL",180,0)
 ;
"RTN","SAMICUL",181,0)
 ; 2018-12-19/20 ven/lgc 18.0-t4 7a5d3400,a14554c1
"RTN","SAMICUL",182,0)
 ;  SAMICAS2 more sac compliance, r/^gpl w/^SAMIGPL.
"RTN","SAMICUL",183,0)
 ;
"RTN","SAMICUL",184,0)
 ; 2018-12-26 ven/lgc 18.0-t4 8dd6f34d,51eb1635
"RTN","SAMICUL",185,0)
 ;  SAMICAS2 update for sac compliance, fix accidental reversions.
"RTN","SAMICUL",186,0)
 ;
"RTN","SAMICUL",187,0)
 ; 2019-01-10 ven/lgc 18.0-t4 2daba010
"RTN","SAMICUL",188,0)
 ;  SAMICAS2 update for SAC compliance.
"RTN","SAMICUL",189,0)
 ;
"RTN","SAMICUL",190,0)
 ; 2019-01-22 ven/lgc 18.0-t4 53681219,5ddb29c5
"RTN","SAMICUL",191,0)
 ;  SAMICAS2 add license info to each SAMI routine; edit for lower
"RTN","SAMICUL",192,0)
 ; case initials.
"RTN","SAMICUL",193,0)
 ;
"RTN","SAMICUL",194,0)
 ; 2019-02-18 ven/lgc 18.0-t4 76874314
"RTN","SAMICUL",195,0)
 ;  SAMICAS2,SAMICAS3 update recently edited routines.
"RTN","SAMICUL",196,0)
 ;
"RTN","SAMICUL",197,0)
 ; 2019-03-13 ven/lmry 18.0-t4 ef66ef16
"RTN","SAMICUL",198,0)
 ;  SAMICAS2 spell out some elements missed earlier.
"RTN","SAMICUL",199,0)
 ;
"RTN","SAMICUL",200,0)
 ; 2019-03-14 ven/lmry 18.0-t4 038507e2
"RTN","SAMICUL",201,0)
 ;  SAMICAS3 spell out some missed M elements, fix copy/paste errors
"RTN","SAMICUL",202,0)
 ; in comments for MKFUFORM, MKBXFORM, & MKPTFORM.
"RTN","SAMICUL",203,0)
 ;
"RTN","SAMICUL",204,0)
 ; 2019-04-16 ven/lgc 18.0-t4 e54b76d1
"RTN","SAMICUL",205,0)
 ;  SAMICAS2 update for SAMIFORM project.
"RTN","SAMICUL",206,0)
 ;
"RTN","SAMICUL",207,0)
 ; 2019-04-23 ven/gpl 18.0-t4 ce322911
"RTN","SAMICUL",208,0)
 ;  SAMICAS2 add intake notes to case review page.
"RTN","SAMICUL",209,0)
 ;
"RTN","SAMICUL",210,0)
 ; 2019-06-18 ven/lgc 18.0-t4 91022482
"RTN","SAMICUL",211,0)
 ;  SAMICAS3 switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMICUL",212,0)
 ;
"RTN","SAMICUL",213,0)
 ; 2019-07-01 ven/gpl 18.0-t4 cc87cc44
"RTN","SAMICUL",214,0)
 ;  SAMICAS3 prevent >1 bkgd form/patient.
"RTN","SAMICUL",215,0)
 ;
"RTN","SAMICUL",216,0)
 ; 2019-07-07 ven/gpl 18.0-t4 776f7451
"RTN","SAMICUL",217,0)
 ;  SAMICAS3 resolving can't create bkgd form, branch messed up.
"RTN","SAMICUL",218,0)
 ;
"RTN","SAMICUL",219,0)
 ; 2019-08-01 ven/lgc 18.0-t4 d710f27d
"RTN","SAMICUL",220,0)
 ;  SAMICAS2 pull displayed facility code from Vista parameter.
"RTN","SAMICUL",221,0)
 ;
"RTN","SAMICUL",222,0)
 ; 2019-09-26 ven/gpl 18.0-t4 92b12324 vap-420
"RTN","SAMICUL",223,0)
 ;  SAMICAS3 prefill form date & date of baseline ct on new followup
"RTN","SAMICUL",224,0)
 ; form.
"RTN","SAMICUL",225,0)
 ;
"RTN","SAMICUL",226,0)
 ; 2019-10-01 par/ddn 18.0-t4 4caf1a98 vap-344
"RTN","SAMICUL",227,0)
 ;  SAMICAS2 use proper capitalization of the word "veteran".
"RTN","SAMICUL",228,0)
 ;
"RTN","SAMICUL",229,0)
 ; 2020-01-11 ven/lgc 18.1 5651698a
"RTN","SAMICUL",230,0)
 ;  SAMICAS2,SAMICAS3 fix duplicate form overwriting.
"RTN","SAMICUL",231,0)
 ;
"RTN","SAMICUL",232,0)
 ; 2020-01-17 ven/lgc 18.1 8557207f
"RTN","SAMICUL",233,0)
 ;  SAMICAS2 followup note.
"RTN","SAMICUL",234,0)
 ;
"RTN","SAMICUL",235,0)
 ; 2020-01-25 ven/lgc 18.3 6a07a860,6a947567
"RTN","SAMICUL",236,0)
 ;  SAMICAS3 nodule copy & fix to ru, fix subtle bug in nodule copy.
"RTN","SAMICUL",237,0)
 ;
"RTN","SAMICUL",238,0)
 ; 2020-04-11 ven/gpl 18.5 666f5b91,2f2c29c1
"RTN","SAMICUL",239,0)
 ;  SAMICAS2 multi-tenancy.
"RTN","SAMICUL",240,0)
 ;
"RTN","SAMICUL",241,0)
 ; 2020-05-12 ven/gpl 18.5 ad11e0ea
"RTN","SAMICUL",242,0)
 ;  SAMICAS2 fix SITE on case review page.
"RTN","SAMICUL",243,0)
 ;
"RTN","SAMICUL",244,0)
 ; 2020-11-12 ven/gpl 18.9 cec1ccd6
"RTN","SAMICUL",245,0)
 ;  SAMICAS2,SAMICAS3 ceform date refill upgrade.
"RTN","SAMICUL",246,0)
 ;
"RTN","SAMICUL",247,0)
 ; 2020-11-13 ven/gpl 18.9 dce3c568
"RTN","SAMICUL",248,0)
 ;  SAMICAS3 prefill ceform prior scans text field.
"RTN","SAMICUL",249,0)
 ;
"RTN","SAMICUL",250,0)
 ; 2021-02-18 ven/gpl 18.9 af2a0b8a
"RTN","SAMICUL",251,0)
 ;  SAMICAS3 copy last previous CT nodules instead of last nodules in
"RTN","SAMICUL",252,0)
 ; any form.
"RTN","SAMICUL",253,0)
 ;
"RTN","SAMICUL",254,0)
 ; 2021-02-21 ven/gpl 18.9 3fd704fb
"RTN","SAMICUL",255,0)
 ;  SAMICAS3 fix bug in prefill logic.
"RTN","SAMICUL",256,0)
 ;
"RTN","SAMICUL",257,0)
 ; 2021-03-02 ven/gpl 18.9 479dc041
"RTN","SAMICUL",258,0)
 ;  SAMICAS2 return error msg if no CT Eval form exists when
"RTN","SAMICUL",259,0)
 ; generating a FU note.
"RTN","SAMICUL",260,0)
 ;
"RTN","SAMICUL",261,0)
 ; 2021-03-10 ven/toad 18.9 a46a2cc1
"RTN","SAMICUL",262,0)
 ;  SAMICUL update log, convert to new vistaver schema.
"RTN","SAMICUL",263,0)
 ;  SAMICAS2,SAMICAS3 bump date & patch list, update contents, lt
"RTN","SAMICUL",264,0)
 ; refactor.
"RTN","SAMICUL",265,0)
 ;
"RTN","SAMICUL",266,0)
 ; 2021-03-17 ven/toad 18.9 62da30b
"RTN","SAMICUL",267,0)
 ;  SAMICAS2 fix xindex errors: in WSCASE add missing space between
"RTN","SAMICUL",268,0)
 ; do & comment to prevent syntax error reported as block mismatch.
"RTN","SAMICUL",269,0)
 ;  SAMICAS3 remove extra spaces at ends of 3 lines.
"RTN","SAMICUL",270,0)
 ;
"RTN","SAMICUL",271,0)
 ; 2021-04-16 ven/gpl 18.11 ac82eec
"RTN","SAMICUL",272,0)
 ;  SAMICAS3 include baseline scan in prior scans field on prefill.
"RTN","SAMICUL",273,0)
 ;
"RTN","SAMICUL",274,0)
 ; 2021-05-14/19 ven/gpl 18.11 0cbee7b,a21b056,139c6a5,0a0cccc
"RTN","SAMICUL",275,0)
 ;  SAMICAS3 improved CT eval prefill of past scan dates, urgent
"RTN","SAMICUL",276,0)
 ; fixes to CT Report & intervention & pet form prefill.
"RTN","SAMICUL",277,0)
 ;
"RTN","SAMICUL",278,0)
 ; 2021-05-20/21 ven/mcglk&toad 18.11 43a4557,424ea11,129e96b
"RTN","SAMICUL",279,0)
 ;  SAMICAS3 bump version & dates.
"RTN","SAMICUL",280,0)
 ;
"RTN","SAMICUL",281,0)
 ; 2021-05-24 ven/gpl 18.11 4aba1a9
"RTN","SAMICUL",282,0)
 ;  SAMICAS3 in MKCEFORM,MKPTFORM,MKBXFORM pass key to
"RTN","SAMICUL",283,0)
 ; CTCOPY^SAMICTC1 to modulate node-copy operation; critical fix to
"RTN","SAMICUL",284,0)
 ; copy forward for is it new field for new ct eval forms.
"RTN","SAMICUL",285,0)
 ;
"RTN","SAMICUL",286,0)
 ; 2021-05-25 ven/toad 18.11 801d7c74
"RTN","SAMICUL",287,0)
 ;  SAMICAS3 bump date; passim lt refactor.
"RTN","SAMICUL",288,0)
 ;
"RTN","SAMICUL",289,0)
 ; 2021-05-26/27 ven/gpl 18.11 6edc0610,73728821
"RTN","SAMICUL",290,0)
 ;  SAMICAS3 in MKITFORM add new nodule-copy block to copy forward
"RTN","SAMICUL",291,0)
 ; for intervention form; in LASTCMP,PRIORCMP init tdt to today to
"RTN","SAMICUL",292,0)
 ; start before today, to fix last comp & prior scan field prefill in
"RTN","SAMICUL",293,0)
 ; ct eval form.
"RTN","SAMICUL",294,0)
 ;
"RTN","SAMICUL",295,0)
 ; 2021-06-01 ven/toad 18.11 7dd9410c
"RTN","SAMICUL",296,0)
 ;  SAMICAS3 fold in gpl chgs fr 2021-05-26/27, annotate, adjust news
"RTN","SAMICUL",297,0)
 ; in nodule copy blocks, bump date.
"RTN","SAMICUL",298,0)
 ;
"RTN","SAMICUL",299,0)
 ; 2021-06-29 ven/gpl 18.12 50d3998b,a5bbd37a
"RTN","SAMICUL",300,0)
 ;  SAMICAS3 in LASTCMP fix bug that excluded ct forms from today in
"RTN","SAMICUL",301,0)
 ; date list, init tdt to today+1 to start today; text-box formatting
"RTN","SAMICUL",302,0)
 ; for intake & followup notes, new text-processing utils; in MKFUFORM
"RTN","SAMICUL",303,0)
 ; set basedt to $$BASELNDT or $$LASTCMP or now.
"RTN","SAMICUL",304,0)
 ;
"RTN","SAMICUL",305,0)
 ; 2021-06-30/07-06 ven/mcglk&toad&gpl 18.12 cbf7e46b,d8296fda,
"RTN","SAMICUL",306,0)
 ; b248664b
"RTN","SAMICUL",307,0)
 ;  SAMICASE,2,3 bump version & dates.
"RTN","SAMICUL",308,0)
 ;  SAMICAS3 in MKFUFORM,LASTCMP update calls & called-by.
"RTN","SAMICUL",309,0)
 ;  SAMICASE,2,3 finish converting to ppi format, annotate; fix typos.
"RTN","SAMICUL",310,0)
 ;
"RTN","SAMICUL",311,0)
 ; 2021-08-01 ven/gpl 18.12 5bd7c627,50620b8b
"RTN","SAMICUL",312,0)
 ;  SAMICAS2 set intake form to incomplete on creation: in GSAMISTA
"RTN","SAMICUL",313,0)
 ; add final line to conditionally set stat="incomplete".
"RTN","SAMICUL",314,0)
 ;  SAMICAS3 exclude current date from last compare field when prev ct
"RTN","SAMICUL",315,0)
 ; report exists: in LASTCMP start w/before today; in PRIORCMP add
"RTN","SAMICUL",316,0)
 ; line to handle retstr="".
"RTN","SAMICUL",317,0)
 ;
"RTN","SAMICUL",318,0)
 ; 2021-10-04/05 ven/gpl&lmry 18.14 ec3b6e5d,d4d1b115
"RTN","SAMICUL",319,0)
 ;  SAMICAS2 updated date format, bumped date and version.
"RTN","SAMICUL",320,0)
 ;
"RTN","SAMICUL",321,0)
 ; 2021-10-26 ven/gpl 18.15 23e68f40
"RTN","SAMICUL",322,0)
 ;  SAMICAS3 initialize last comparitive and prior scan fields to blank if
"RTN","SAMICUL",323,0)
 ;  there were none
"RTN","SAMICUL",324,0)
 ;
"RTN","SAMICUL",325,0)
 ;@contents
"RTN","SAMICUL",326,0)
 ; SAMICASE case review
"RTN","SAMICUL",327,0)
 ; SAMICAS2 case review continued
"RTN","SAMICUL",328,0)
 ; SAMICAS3 case review continued
"RTN","SAMICUL",329,0)
 ; SAMICUL case review log
"RTN","SAMICUL",330,0)
 ;
"RTN","SAMICUL",331,0)
 ;
"RTN","SAMICUL",332,0)
 ;
"RTN","SAMICUL",333,0)
EOR ; end of routine SAMICUL
"RTN","SAMIHOM4")
0^8^B911986320
"RTN","SAMIHOM4",1,0)
SAMIHOM4 ;ven/gpl,arc - homepage web services ;2021-10-29t20:25z
"RTN","SAMIHOM4",2,0)
 ;;18.0;SAMI;**1,4,5,6,9,12,15,16**;2020-01;Build 2
"RTN","SAMIHOM4",3,0)
 ;18-15
"RTN","SAMIHOM4",4,0)
 ;
"RTN","SAMIHOM4",5,0)
 ; SAMIHOM4 contains web services & other subroutines for producing
"RTN","SAMIHOM4",6,0)
 ; the ELCAP Home Page.
"RTN","SAMIHOM4",7,0)
 ;
"RTN","SAMIHOM4",8,0)
 quit  ; no entry from top
"RTN","SAMIHOM4",9,0)
 ;
"RTN","SAMIHOM4",10,0)
 ;
"RTN","SAMIHOM4",11,0)
 ;
"RTN","SAMIHOM4",12,0)
 ;@section 0 primary development
"RTN","SAMIHOM4",13,0)
 ;
"RTN","SAMIHOM4",14,0)
 ;
"RTN","SAMIHOM4",15,0)
 ;
"RTN","SAMIHOM4",16,0)
 ;@license see routine SAMIUL
"RTN","SAMIHOM4",17,0)
 ;@documentation see SAMIHUL
"RTN","SAMIHOM4",18,0)
 ;@contents
"RTN","SAMIHOM4",19,0)
 ;
"RTN","SAMIHOM4",20,0)
 ;  web service get vapals & related subroutines
"RTN","SAMIHOM4",21,0)
 ;
"RTN","SAMIHOM4",22,0)
 ; WSHOME code for wsi WSHOME^SAMIHOM3
"RTN","SAMIHOM4",23,0)
 ;    get vapals (vapals-elcap homepage)
"RTN","SAMIHOM4",24,0)
 ; DEVHOME code for wpi DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",25,0)
 ;    development home page
"RTN","SAMIHOM4",26,0)
 ; GETHOME code for wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",27,0)
 ;    get homepage (not subsequent visit)
"RTN","SAMIHOM4",28,0)
 ;
"RTN","SAMIHOM4",29,0)
 ;  web service post vapals & related subroutines
"RTN","SAMIHOM4",30,0)
 ;
"RTN","SAMIHOM4",31,0)
 ; WSVAPALS code for wsi WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",32,0)
 ;    post vapals (main gateway)
"RTN","SAMIHOM4",33,0)
 ;
"RTN","SAMIHOM4",34,0)
 ;  other
"RTN","SAMIHOM4",35,0)
 ;
"RTN","SAMIHOM4",36,0)
 ; REG manual registration
"RTN","SAMIHOM4",37,0)
 ; MKPTLK creates patient-lookup record
"RTN","SAMIHOM4",38,0)
 ; UPDTFRMS update demographics in all forms for patient
"RTN","SAMIHOM4",39,0)
 ; MERGE merge participant records
"RTN","SAMIHOM4",40,0)
 ; ADDUNMAT adds unmatched report web service to system
"RTN","SAMIHOM4",41,0)
 ; DELUNMAT deletes unmatched web service
"RTN","SAMIHOM4",42,0)
 ; WSUNMAT navigates to unmatched report
"RTN","SAMIHOM4",43,0)
 ; $$DUPSSN true if duplicate ssn
"RTN","SAMIHOM4",44,0)
 ; $$DUPICN true if duplicate icn
"RTN","SAMIHOM4",45,0)
 ; $$BADICN true if ICN checkdigits are wrong
"RTN","SAMIHOM4",46,0)
 ; SAVE save patient-lookup record after edit
"RTN","SAMIHOM4",47,0)
 ; $$REMATCH possible match ien
"RTN","SAMIHOM4",48,0)
 ; SETINFO set information message text
"RTN","SAMIHOM4",49,0)
 ; SETWARN set warning message text
"RTN","SAMIHOM4",50,0)
 ; RTNERR redisplay page w/error message
"RTN","SAMIHOM4",51,0)
 ; RTNPAGE display page
"RTN","SAMIHOM4",52,0)
 ; REINDXPL reindex patient lookup
"RTN","SAMIHOM4",53,0)
 ; INDXPTLK generate index entries in patient-lookup graph
"RTN","SAMIHOM4",54,0)
 ; UNINDXPT remove index entries from patient-lookup graph
"RTN","SAMIHOM4",55,0)
 ; $$UCASE uppercase
"RTN","SAMIHOM4",56,0)
 ; WSNEWCAS code for wr newcase (creates new case)
"RTN","SAMIHOM4",57,0)
 ;
"RTN","SAMIHOM4",58,0)
 ;@to-do
"RTN","SAMIHOM4",59,0)
 ; Add label comments
"RTN","SAMIHOM4",60,0)
 ;
"RTN","SAMIHOM4",61,0)
 ;
"RTN","SAMIHOM4",62,0)
 ;
"RTN","SAMIHOM4",63,0)
 ;@section 1 web service get vapals & related subroutines
"RTN","SAMIHOM4",64,0)
 ;
"RTN","SAMIHOM4",65,0)
 ;
"RTN","SAMIHOM4",66,0)
 ;
"RTN","SAMIHOM4",67,0)
 ;@wsi-code WSHOME^SAMIHOM3
"RTN","SAMIHOM4",68,0)
WSHOME ; get vapals (vapals-elcap homepage)
"RTN","SAMIHOM4",69,0)
 ;
"RTN","SAMIHOM4",70,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",71,0)
 ;
"RTN","SAMIHOM4",72,0)
 ;ven/gpl;wsi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",73,0)
 ;@signature
"RTN","SAMIHOM4",74,0)
 ; do WSHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",75,0)
 ;@branches-from
"RTN","SAMIHOM4",76,0)
 ; WSHOME^SAMIHOM3
"RTN","SAMIHOM4",77,0)
 ;@wsi-called-by
"RTN","SAMIHOM4",78,0)
 ; web service get vapals
"RTN","SAMIHOM4",79,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",80,0)
 ; LOGIN^SAMISITE
"RTN","SAMIHOM4",81,0)
 ;@called-by none
"RTN","SAMIHOM4",82,0)
 ;@calls
"RTN","SAMIHOM4",83,0)
 ; DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",84,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",85,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",86,0)
 ;@input
"RTN","SAMIHOM4",87,0)
 ; SAMIFILTER (no parameters required)
"RTN","SAMIHOM4",88,0)
 ;@output
"RTN","SAMIHOM4",89,0)
 ; .SAMIRTN
"RTN","SAMIHOM4",90,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",91,0)
 ;@tests
"RTN","SAMIHOM4",92,0)
 ; UTWSHM^SAMIUTH3
"RTN","SAMIHOM4",93,0)
 ; UTWSHM1^SAMIUTH3
"RTN","SAMIHOM4",94,0)
 ; UTWSHM2^SAMIUTH3
"RTN","SAMIHOM4",95,0)
 ;
"RTN","SAMIHOM4",96,0)
 ;
"RTN","SAMIHOM4",97,0)
 ;@stanza 2 route to appropriate homepage or bypass to other webpage
"RTN","SAMIHOM4",98,0)
 ;
"RTN","SAMIHOM4",99,0)
 ; present development homepage for testing
"RTN","SAMIHOM4",100,0)
 if $get(SAMIFILTER("test"))=1 do  quit
"RTN","SAMIHOM4",101,0)
 . do DEVHOME^SAMIHOM3(.SAMIRTN,.SAMIFILTER)
"RTN","SAMIHOM4",102,0)
 . quit
"RTN","SAMIHOM4",103,0)
 ;
"RTN","SAMIHOM4",104,0)
 ; bypass for get access to pages
"RTN","SAMIHOM4",105,0)
 if $g(SAMIFILTER("samiroute"))'="" do  quit
"RTN","SAMIHOM4",106,0)
 . new SAMIBODY set SAMIBODY(1)=""
"RTN","SAMIHOM4",107,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIBODY,.SAMIRTN)
"RTN","SAMIHOM4",108,0)
 . quit
"RTN","SAMIHOM4",109,0)
 ;
"RTN","SAMIHOM4",110,0)
 ; V4W/DLW - bypass for get access from CPRS
"RTN","SAMIHOM4",111,0)
 if $get(SAMIFILTER("dfn"))'="" do  quit
"RTN","SAMIHOM4",112,0)
 . new dfn set dfn=$get(SAMIFILTER("dfn"))
"RTN","SAMIHOM4",113,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",114,0)
 . new studyid set studyid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIHOM4",115,0)
 . new SAMIBODY
"RTN","SAMIHOM4",116,0)
 . if studyid'="" do
"RTN","SAMIHOM4",117,0)
 . . set SAMIBODY(1)="samiroute=casereview&dfn="_dfn_"&studyid="_studyid
"RTN","SAMIHOM4",118,0)
 . . quit
"RTN","SAMIHOM4",119,0)
 . else  do
"RTN","SAMIHOM4",120,0)
 . . set SAMIBODY(1)="samiroute=lookup&dfn="_dfn_"&studyid="_studyid
"RTN","SAMIHOM4",121,0)
 . . quit
"RTN","SAMIHOM4",122,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIBODY,.SAMIRTN)
"RTN","SAMIHOM4",123,0)
 . quit
"RTN","SAMIHOM4",124,0)
 ;
"RTN","SAMIHOM4",125,0)
 ; default to VAPALS homepage
"RTN","SAMIHOM4",126,0)
 do GETHOME^SAMIHOM3(.SAMIRTN,.SAMIFILTER)
"RTN","SAMIHOM4",127,0)
 ;
"RTN","SAMIHOM4",128,0)
 ;
"RTN","SAMIHOM4",129,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",130,0)
 ;
"RTN","SAMIHOM4",131,0)
 quit  ; end of wsi WSHOME^SAMIHOM3
"RTN","SAMIHOM4",132,0)
 ;
"RTN","SAMIHOM4",133,0)
 ;
"RTN","SAMIHOM4",134,0)
 ;
"RTN","SAMIHOM4",135,0)
 ;@wpi-code DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",136,0)
DEVHOME ; development home page
"RTN","SAMIHOM4",137,0)
 ;
"RTN","SAMIHOM4",138,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",139,0)
 ;
"RTN","SAMIHOM4",140,0)
 ;ven/gpl;wpi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",141,0)
 ;@signature
"RTN","SAMIHOM4",142,0)
 ; do DEVHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",143,0)
 ;@branches-from
"RTN","SAMIHOM4",144,0)
 ; DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",145,0)
 ;@wpi-called-by
"RTN","SAMIHOM4",146,0)
 ; wsi WSHOME^SAMIHOM3 [web service get vapals]
"RTN","SAMIHOM4",147,0)
 ;@called-by none
"RTN","SAMIHOM4",148,0)
 ;@calls
"RTN","SAMIHOM4",149,0)
 ; htmltb2^%yottaweb
"RTN","SAMIHOM4",150,0)
 ; PATLIST^SAMIHOM3
"RTN","SAMIHOM4",151,0)
 ; genhtml^%yottautl
"RTN","SAMIHOM4",152,0)
 ; addary^%yottautl
"RTN","SAMIHOM4",153,0)
 ;@input
"RTN","SAMIHOM4",154,0)
 ; SAMIFILTER =
"RTN","SAMIHOM4",155,0)
 ;@output
"RTN","SAMIHOM4",156,0)
 ;.SAMIRTN =
"RTN","SAMIHOM4",157,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",158,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",159,0)
 ;
"RTN","SAMIHOM4",160,0)
 ;
"RTN","SAMIHOM4",161,0)
 ;@stanza 2 present development homepage
"RTN","SAMIHOM4",162,0)
 ;
"RTN","SAMIHOM4",163,0)
 new gtop,gbot
"RTN","SAMIHOM4",164,0)
 do htmltb2^%yottaweb(.gtop,.gbot,"SAMI Test Patients")
"RTN","SAMIHOM4",165,0)
 ;
"RTN","SAMIHOM4",166,0)
 new html,ary,hpat
"RTN","SAMIHOM4",167,0)
 do PATLIST^SAMIHOM3("hpat")
"RTN","SAMIHOM4",168,0)
 quit:'$data(hpat)
"RTN","SAMIHOM4",169,0)
 ;
"RTN","SAMIHOM4",170,0)
 set ary("title")="SAMI Test Patients on this system"
"RTN","SAMIHOM4",171,0)
 set ary("header",1)="StudyId"
"RTN","SAMIHOM4",172,0)
 set ary("header",2)="Name"
"RTN","SAMIHOM4",173,0)
 ;
"RTN","SAMIHOM4",174,0)
 new cnt set cnt=0
"RTN","SAMIHOM4",175,0)
 new zi set zi=""
"RTN","SAMIHOM4",176,0)
 for  do  quit:zi=""
"RTN","SAMIHOM4",177,0)
 . set zi=$order(hpat(zi))
"RTN","SAMIHOM4",178,0)
 . quit:zi=""
"RTN","SAMIHOM4",179,0)
 . ;
"RTN","SAMIHOM4",180,0)
 . set cnt=cnt+1
"RTN","SAMIHOM4",181,0)
 . new url set url="<a href=""/cform.cgi?studyId="_zi_""">"_zi_"</a>"
"RTN","SAMIHOM4",182,0)
 . set ary(cnt,1)=url
"RTN","SAMIHOM4",183,0)
 . set ary(cnt,2)=""
"RTN","SAMIHOM4",184,0)
 . quit
"RTN","SAMIHOM4",185,0)
 ;
"RTN","SAMIHOM4",186,0)
 do genhtml^%yottautl("html","ary")
"RTN","SAMIHOM4",187,0)
 ;
"RTN","SAMIHOM4",188,0)
 do addary^%yottautl("SAMIRTN","gtop")
"RTN","SAMIHOM4",189,0)
 do addary^%yottautl("SAMIRTN","html")
"RTN","SAMIHOM4",190,0)
 set SAMIRTN($order(SAMIRTN(""),-1)+1)=gbot
"RTN","SAMIHOM4",191,0)
 kill SAMIRTN(0)
"RTN","SAMIHOM4",192,0)
 ;
"RTN","SAMIHOM4",193,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMIHOM4",194,0)
 ;
"RTN","SAMIHOM4",195,0)
 ;
"RTN","SAMIHOM4",196,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",197,0)
 ;
"RTN","SAMIHOM4",198,0)
 quit  ; end of wpi DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",199,0)
 ;
"RTN","SAMIHOM4",200,0)
 ;
"RTN","SAMIHOM4",201,0)
 ;
"RTN","SAMIHOM4",202,0)
 ;@wpi-code GETHOME^SAMIHOM3
"RTN","SAMIHOM4",203,0)
GETHOME ; get homepage (not subsequent visit)
"RTN","SAMIHOM4",204,0)
 ;
"RTN","SAMIHOM4",205,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",206,0)
 ;
"RTN","SAMIHOM4",207,0)
 ;ven/gpl;wpi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",208,0)
 ;@signature
"RTN","SAMIHOM4",209,0)
 ; do GETHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",210,0)
 ;@branches-from
"RTN","SAMIHOM4",211,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",212,0)
 ;@wpi-called-by
"RTN","SAMIHOM4",213,0)
 ; WSHOME
"RTN","SAMIHOM4",214,0)
 ; WSVAPALS
"RTN","SAMIHOM4",215,0)
 ; SAVE
"RTN","SAMIHOM4",216,0)
 ;  WSNEWCAS [commented out]
"RTN","SAMIHOM4",217,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMIHOM4",218,0)
 ; WSLOOKUP^SAMISRC2
"RTN","SAMIHOM4",219,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIHOM4",220,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIHOM4",221,0)
 ;@called-by none
"RTN","SAMIHOM4",222,0)
 ;@calls
"RTN","SAMIHOM4",223,0)
 ; $$FINDSITE^SAMISITE
"RTN","SAMIHOM4",224,0)
 ; GETTMPL^SAMICASE
"RTN","SAMIHOM4",225,0)
 ; MERGEHTM^%wf
"RTN","SAMIHOM4",226,0)
 ; ADDCRLF^VPRJRUT
"RTN","SAMIHOM4",227,0)
 ;@input
"RTN","SAMIHOM4",228,0)
 ; SAMIFILTER
"RTN","SAMIHOM4",229,0)
 ;@output
"RTN","SAMIHOM4",230,0)
 ; .SAMIRTN
"RTN","SAMIHOM4",231,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",232,0)
 ;@tests
"RTN","SAMIHOM4",233,0)
 ; UTGETHM^SAMIUTH3
"RTN","SAMIHOM4",234,0)
 ; UTSCAN4^SAMIUTH3
"RTN","SAMIHOM4",235,0)
 ;
"RTN","SAMIHOM4",236,0)
 ;
"RTN","SAMIHOM4",237,0)
 ;@stanza 2 get template for homepage
"RTN","SAMIHOM4",238,0)
 ;
"RTN","SAMIHOM4",239,0)
 ; Processing for multi-tenancy
"RTN","SAMIHOM4",240,0)
 ;
"RTN","SAMIHOM4",241,0)
 if $get(SAMIFILTER("siteid"))="" if '$$FINDSITE^SAMISITE(.SAMIRTN,.SAMIFILTER) quit 0
"RTN","SAMIHOM4",242,0)
 new SAMISITE,SAMITITL
"RTN","SAMIHOM4",243,0)
 set SAMISITE=$get(SAMIFILTER("siteid"))
"RTN","SAMIHOM4",244,0)
 set SAMITITL=$get(SAMIFILTER("sitetitle"))
"RTN","SAMIHOM4",245,0)
 ;
"RTN","SAMIHOM4",246,0)
 new VASITE set VASITE=$$GET1PARM^SAMIPARM("veteransAffairsSite",SAMISITE)
"RTN","SAMIHOM4",247,0)
 set SAMIFILTER("veteransAffairsSite")=VASITE
"RTN","SAMIHOM4",248,0)
 ;
"RTN","SAMIHOM4",249,0)
 new temp,tout,form
"RTN","SAMIHOM4",250,0)
 set form="vapals:home"
"RTN","SAMIHOM4",251,0)
 do GETTMPL^SAMICASE("temp",form)
"RTN","SAMIHOM4",252,0)
 quit:'$data(temp)
"RTN","SAMIHOM4",253,0)
 ;
"RTN","SAMIHOM4",254,0)
 ;
"RTN","SAMIHOM4",255,0)
 ;@stanza 3 process homepage template
"RTN","SAMIHOM4",256,0)
 ;
"RTN","SAMIHOM4",257,0)
 new err
"RTN","SAMIHOM4",258,0)
 do MERGEHTM^%wf(.temp,.SAMIFILTER,.err)
"RTN","SAMIHOM4",259,0)
 ;
"RTN","SAMIHOM4",260,0)
 do ADDCRLF^VPRJRUT(.temp)
"RTN","SAMIHOM4",261,0)
 merge SAMIRTN=temp
"RTN","SAMIHOM4",262,0)
 ;
"RTN","SAMIHOM4",263,0)
 ;
"RTN","SAMIHOM4",264,0)
 ;@stanza 4 termination
"RTN","SAMIHOM4",265,0)
 ;
"RTN","SAMIHOM4",266,0)
 quit  ; end of wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",267,0)
 ;
"RTN","SAMIHOM4",268,0)
 ;
"RTN","SAMIHOM4",269,0)
 ;
"RTN","SAMIHOM4",270,0)
 ; below is redacted from GETHOME^SAMIHOM3
"RTN","SAMIHOM4",271,0)
 ;
"RTN","SAMIHOM4",272,0)
 ;@old-calls
"RTN","SAMIHOM4",273,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIHOM4",274,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIHOM4",275,0)
 ; $$GET^XPAR
"RTN","SAMIHOM4",276,0)
 ; findReplace^%ts
"RTN","SAMIHOM4",277,0)
 ; ADDCRLF^VPRJRUT
"RTN","SAMIHOM4",278,0)
 ;
"RTN","SAMIHOM4",279,0)
 new cnt set cnt=0
"RTN","SAMIHOM4",280,0)
 new zi set zi=0
"RTN","SAMIHOM4",281,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  do  ;
"RTN","SAMIHOM4",282,0)
 . ;
"RTN","SAMIHOM4",283,0)
 . n ln s ln=temp(zi)
"RTN","SAMIHOM4",284,0)
 . n touched s touched=0
"RTN","SAMIHOM4",285,0)
 . ;
"RTN","SAMIHOM4",286,0)
 . i ln["href" i 'touched d  ;
"RTN","SAMIHOM4",287,0)
 . . d FIXHREF^SAMIFORM(.ln)
"RTN","SAMIHOM4",288,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",289,0)
 . ;
"RTN","SAMIHOM4",290,0)
 . i ln["src" d  ;
"RTN","SAMIHOM4",291,0)
 . . d FIXSRC^SAMIFORM(.ln)
"RTN","SAMIHOM4",292,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",293,0)
 . ;
"RTN","SAMIHOM4",294,0)
 . i ln["id" i ln["studyIdMenu" d  ;
"RTN","SAMIHOM4",295,0)
 . . s zi=zi+4
"RTN","SAMIHOM4",296,0)
 . ;
"RTN","SAMIHOM4",297,0)
 . if ln["@@MANUALREGISTRATION@@" do  ; turn off manual registration
"RTN","SAMIHOM4",298,0)
 . . n setman,setparm
"RTN","SAMIHOM4",299,0)
 . . s setman="true"
"RTN","SAMIHOM4",300,0)
 . . s setparm=$$GET^XPAR("SYS","SAMI ALLOW MANUAL ENTRY",,"Q")
"RTN","SAMIHOM4",301,0)
 . . i setparm=0 s setman="false"
"RTN","SAMIHOM4",302,0)
 . . do findReplace^%ts(.ln,"@@MANUALREGISTRATION@@",setman)
"RTN","SAMIHOM4",303,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",304,0)
 . . quit 
"RTN","SAMIHOM4",305,0)
 . set cnt=cnt+1
"RTN","SAMIHOM4",306,0)
 . set tout(cnt)=temp(zi)
"RTN","SAMIHOM4",307,0)
 . quit
"RTN","SAMIHOM4",308,0)
 ;
"RTN","SAMIHOM4",309,0)
 ;
"RTN","SAMIHOM4",310,0)
 ;@old-stanza 4 add cr/lf & save to return array
"RTN","SAMIHOM4",311,0)
 ;
"RTN","SAMIHOM4",312,0)
 do ADDCRLF^VPRJRUT(.tout)
"RTN","SAMIHOM4",313,0)
 merge SAMIRTN=tout
"RTN","SAMIHOM4",314,0)
 ;
"RTN","SAMIHOM4",315,0)
 ;
"RTN","SAMIHOM4",316,0)
 ;@old-stanza 5 termination
"RTN","SAMIHOM4",317,0)
 ;
"RTN","SAMIHOM4",318,0)
 quit  ; old end of wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",319,0)
 ;
"RTN","SAMIHOM4",320,0)
 ;
"RTN","SAMIHOM4",321,0)
 ;
"RTN","SAMIHOM4",322,0)
 ;@section 2 web service post vapals & related subroutines
"RTN","SAMIHOM4",323,0)
 ;
"RTN","SAMIHOM4",324,0)
 ;
"RTN","SAMIHOM4",325,0)
 ;
"RTN","SAMIHOM4",326,0)
 ;@wsi-code WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",327,0)
WSVAPALS ; post vapals (main gateway)
"RTN","SAMIHOM4",328,0)
 ;
"RTN","SAMIHOM4",329,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",330,0)
 ;
"RTN","SAMIHOM4",331,0)
 ;ven/gpl;wsi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",332,0)
 ;@signature
"RTN","SAMIHOM4",333,0)
 ; do WSVAPALS^SAMIHOM3(SAMIARG,SAMIBODY,SAMIRESULT)
"RTN","SAMIHOM4",334,0)
 ;@branches-from
"RTN","SAMIHOM4",335,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",336,0)
 ;@wsi-called-by
"RTN","SAMIHOM4",337,0)
 ;@called-by
"RTN","SAMIHOM4",338,0)
 ;@calls
"RTN","SAMIHOM4",339,0)
 ;@input [tbd]
"RTN","SAMIHOM4",340,0)
 ;@output [tbd]
"RTN","SAMIHOM4",341,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",342,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",343,0)
 ;
"RTN","SAMIHOM4",344,0)
 ; all calls come through this gateway
"RTN","SAMIHOM4",345,0)
 ;
"RTN","SAMIHOM4",346,0)
 k ^SAMIUL("vapals")
"RTN","SAMIHOM4",347,0)
 m ^SAMIUL("vapals")=SAMIARG
"RTN","SAMIHOM4",348,0)
 m ^SAMIUL("vapals","BODY")=SAMIBODY
"RTN","SAMIHOM4",349,0)
 ;
"RTN","SAMIHOM4",350,0)
 new vars,SAMIBDY
"RTN","SAMIHOM4",351,0)
 set SAMIBDY=$get(SAMIBODY(1))
"RTN","SAMIHOM4",352,0)
 do parseBody^%wf("vars",.SAMIBDY)
"RTN","SAMIHOM4",353,0)
 m vars=SAMIARG
"RTN","SAMIHOM4",354,0)
 i $g(vars("siteid"))'="" d  ;
"RTN","SAMIHOM4",355,0)
 . i $g(vars("site"))'=$g(vars("siteid")) s vars("site")=$g(vars("siteid"))
"RTN","SAMIHOM4",356,0)
 i $g(vars("site"))="SYS" s vars("site")=""
"RTN","SAMIHOM4",357,0)
 m SAMIARG=vars
"RTN","SAMIHOM4",358,0)
 m SAMIARG=SAMIBODY
"RTN","SAMIHOM4",359,0)
 ;
"RTN","SAMIHOM4",360,0)
 ; Processing for multi-tenancy
"RTN","SAMIHOM4",361,0)
 ;
"RTN","SAMIHOM4",362,0)
 if '$d(vars("siteid")) d  ;
"RTN","SAMIHOM4",363,0)
 . if $g(vars("studyid"))="" q
"RTN","SAMIHOM4",364,0)
 . n sym s sym=$e(vars("studyid"),1,3) ; first 3 chars in studyid
"RTN","SAMIHOM4",365,0)
 . i $$SITENM2^SAMISITE(sym)=-1 q
"RTN","SAMIHOM4",366,0)
 . s vars("siteid")=sym
"RTN","SAMIHOM4",367,0)
 . s vars("site")=sym
"RTN","SAMIHOM4",368,0)
 ;
"RTN","SAMIHOM4",369,0)
 if $G(vars("site"))'="" d  ;
"RTN","SAMIHOM4",370,0)
 . n siteid s siteid=vars("site")
"RTN","SAMIHOM4",371,0)
 . s SAMIARG("siteid")=siteid
"RTN","SAMIHOM4",372,0)
 . s SAMIARG("sitetitle")=$$SITENM2^SAMISITE(siteid)_" - "_siteid
"RTN","SAMIHOM4",373,0)
 k ^gpl("siteselect")
"RTN","SAMIHOM4",374,0)
 m ^gpl("siteselect")=SAMIARG
"RTN","SAMIHOM4",375,0)
 m ^gpl("siteselect","vars")=vars
"RTN","SAMIHOM4",376,0)
 if $G(SAMIARG("siteid"))="" if '$$FINDSITE^SAMISITE(.SAMIRESULT,.SAMIARG) Q 0
"RTN","SAMIHOM4",377,0)
 new SAMISITE,SAMITITL
"RTN","SAMIHOM4",378,0)
 s SAMISITE=$G(SAMIARG("siteid"))
"RTN","SAMIHOM4",379,0)
 i $G(SAMIARG("sitetitle"))="" d  ;
"RTN","SAMIHOM4",380,0)
 . s SAMIARG("sitetitle")=$$SITENM2^SAMISITE(SAMISITE)_" - "_SAMISITE
"RTN","SAMIHOM4",381,0)
 s SAMITITL=$G(SAMIARG("sitetitle"))
"RTN","SAMIHOM4",382,0)
 m vars=SAMIARG
"RTN","SAMIHOM4",383,0)
 ;
"RTN","SAMIHOM4",384,0)
 k ^SAMIUL("vapals","vars")
"RTN","SAMIHOM4",385,0)
 merge ^SAMIUL("vapals","vars")=vars
"RTN","SAMIHOM4",386,0)
 merge ^SAMIUL("vapals","vars")=SAMIBODY
"RTN","SAMIHOM4",387,0)
 ;
"RTN","SAMIHOM4",388,0)
 n route s route=$g(vars("samiroute"))
"RTN","SAMIHOM4",389,0)
 i route=""  d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",390,0)
 ;
"RTN","SAMIHOM4",391,0)
 i route="lookup" d  q 0
"RTN","SAMIHOM4",392,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",393,0)
 . d WSLOOKUP^SAMISRC2(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",394,0)
 ;
"RTN","SAMIHOM4",395,0)
 i route="login" d  q 0
"RTN","SAMIHOM4",396,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",397,0)
 . d LOGIN^SAMISITE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",398,0)
 ;
"RTN","SAMIHOM4",399,0)
 i route="home" d  q 0
"RTN","SAMIHOM4",400,0)
 . k ^gpl("home")
"RTN","SAMIHOM4",401,0)
 . m ^gpl("home")=SAMIARG
"RTN","SAMIHOM4",402,0)
 . s SAMIARG("samiroute")=""
"RTN","SAMIHOM4",403,0)
 . d WSHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",404,0)
 ;
"RTN","SAMIHOM4",405,0)
 i route="logout" d  q 0
"RTN","SAMIHOM4",406,0)
 . ;s SAMIARG("samiroute")="home"
"RTN","SAMIHOM4",407,0)
 . ;do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIARG,.SAMIRESULT)
"RTN","SAMIHOM4",408,0)
 . ;Q
"RTN","SAMIHOM4",409,0)
 . s SAMIARG("sitetitle")="Unknown Site"
"RTN","SAMIHOM4",410,0)
 . s SAMIARG("siteid")=""
"RTN","SAMIHOM4",411,0)
 . s SAMIARG("errorMessage")=""
"RTN","SAMIHOM4",412,0)
 . d RTNERR^SAMIHOM4(.SAMIRESULT,"vapals:login",.SAMIARG)
"RTN","SAMIHOM4",413,0)
 ;
"RTN","SAMIHOM4",414,0)
 i route="newcase" d  q 0
"RTN","SAMIHOM4",415,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",416,0)
 . d WSNEWCAS^SAMIHOM3(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",417,0)
 ;
"RTN","SAMIHOM4",418,0)
 i route="casereview" d  q 0
"RTN","SAMIHOM4",419,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",420,0)
 . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",421,0)
 ;
"RTN","SAMIHOM4",422,0)
 i route="nuform" d  q 0
"RTN","SAMIHOM4",423,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",424,0)
 . d WSNUFORM^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",425,0)
 ;
"RTN","SAMIHOM4",426,0)
 i route="addform" d  q 0
"RTN","SAMIHOM4",427,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",428,0)
 . d WSNFPOST^SAMICASE(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",429,0)
 ;
"RTN","SAMIHOM4",430,0)
 i route="form" d  q 0
"RTN","SAMIHOM4",431,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",432,0)
 . d wsGetForm^%wf(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",433,0)
 ;
"RTN","SAMIHOM4",434,0)
 i route="postform" d  q 0
"RTN","SAMIHOM4",435,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",436,0)
 . d wsPostForm^%wf(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",437,0)
 . i $g(SAMIARG("form"))["siform" d  ;
"RTN","SAMIHOM4",438,0)
 . . n notr s notr=0 ; note return 0 if failure, 1 or greater if success
"RTN","SAMIHOM4",439,0)
 . . ; returns the ien of the note that was created and should be sent
"RTN","SAMIHOM4",440,0)
 . . s notr=$$NOTE^SAMINOT1(.SAMIARG)
"RTN","SAMIHOM4",441,0)
 . . if +notr>0 d  ;
"RTN","SAMIHOM4",442,0)
 . . . n SAMIFILTER
"RTN","SAMIHOM4",443,0)
 . . . s SAMIFILTER("sid")=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",444,0)
 . . . s SAMIFILTER("key")=$g(SAMIARG("form")) ;
"RTN","SAMIHOM4",445,0)
 . . . n tiuien
"RTN","SAMIHOM4",446,0)
 . . . s tiuien=+notr
"RTN","SAMIHOM4",447,0)
 . . . s SAMIFILTER("notenmbr")=tiuien
"RTN","SAMIHOM4",448,0)
 . . . n sendrslt
"RTN","SAMIHOM4",449,0)
 . . . ;s sendrslt="1^MSG9239010"
"RTN","SAMIHOM4",450,0)
 . . . s sendrslt=$$EN^SAMIORU(.SAMIFILTER) ; send the note to VistA
"RTN","SAMIHOM4",451,0)
 . . . i +sendrslt>0 d  ; success
"RTN","SAMIHOM4",452,0)
 . . . . n rtnid s rtnid=$p(sendrslt,"^",2) ; return id from HL7
"RTN","SAMIHOM4",453,0)
 . . . . ; post the id to the graph here
"RTN","SAMIHOM4",454,0)
 . . . . n sid s sid=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",455,0)
 . . . . n form s form=$G(SAMIARG("form"))
"RTN","SAMIHOM4",456,0)
 . . . . n nien s nien=$$NTIEN^SAMINOT1(sid,form) ; latest note ien
"RTN","SAMIHOM4",457,0)
 . . . . n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",458,0)
 . . . . s @root@("graph",sid,form,"notes",nien,"hl7id")=rtnid
"RTN","SAMIHOM4",459,0)
 . . . . s SAMIARG("errorMessage")="Note successfully sent to VistA ID: "_rtnid
"RTN","SAMIHOM4",460,0)
 . . . else  d  ;
"RTN","SAMIHOM4",461,0)
 . . . . n rtnmsg s rtnmsg=$p(sendrslt,"^",2)
"RTN","SAMIHOM4",462,0)
 . . . . s SAMIARG("errorMessage")=rtnmsg
"RTN","SAMIHOM4",463,0)
 . . . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",464,0)
 . i $g(SAMIARG("form"))["fuform" d  ;
"RTN","SAMIHOM4",465,0)
 . . n notr s notr=0 ; note return 0 if failure, 1 or greater if success
"RTN","SAMIHOM4",466,0)
 . . ; returns the ien of the note that was created and should be sent
"RTN","SAMIHOM4",467,0)
 . . s notr=$$NOTE^SAMINOT2(.SAMIARG)
"RTN","SAMIHOM4",468,0)
 . . if +notr>0 d  ;
"RTN","SAMIHOM4",469,0)
 . . . n SAMIFILTER
"RTN","SAMIHOM4",470,0)
 . . . s SAMIFILTER("sid")=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",471,0)
 . . . s SAMIFILTER("key")=$g(SAMIARG("form")) ;
"RTN","SAMIHOM4",472,0)
 . . . n tiuien
"RTN","SAMIHOM4",473,0)
 . . . s tiuien=+notr
"RTN","SAMIHOM4",474,0)
 . . . s SAMIFILTER("notenmbr")=tiuien
"RTN","SAMIHOM4",475,0)
 . . . n sendrslt
"RTN","SAMIHOM4",476,0)
 . . . ;s sendrslt="0^Missing ORM Message"
"RTN","SAMIHOM4",477,0)
 . . . s sendrslt=$$EN^SAMIORU(.SAMIFILTER) ; send the note to VistA
"RTN","SAMIHOM4",478,0)
 . . . i +sendrslt>0 d  ; success
"RTN","SAMIHOM4",479,0)
 . . . . n rtnid s rtnid=$p(sendrslt,"^",2) ; return id from HL7
"RTN","SAMIHOM4",480,0)
 . . . . ; post the id to the graph here
"RTN","SAMIHOM4",481,0)
 . . . . n sid s sid=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",482,0)
 . . . . n form s form=$G(SAMIARG("form"))
"RTN","SAMIHOM4",483,0)
 . . . . n nien s nien=$$NTIEN^SAMINOT1(sid,form) ; latest note ien
"RTN","SAMIHOM4",484,0)
 . . . . n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",485,0)
 . . . . s @root@("graph",sid,form,"notes",nien,"hl7id")=rtnid
"RTN","SAMIHOM4",486,0)
 . . . . s SAMIARG("errorMessage")="Note successfully sent to VistA ID: "_rtnid
"RTN","SAMIHOM4",487,0)
 . . . else  d  ;
"RTN","SAMIHOM4",488,0)
 . . . . n rtnmsg s rtnmsg=$p(sendrslt,"^",2)
"RTN","SAMIHOM4",489,0)
 . . . . i $g(SAMIARG("errorMessage"))="" d  ;
"RTN","SAMIHOM4",490,0)
 . . . . . s SAMIARG("errorMessage")=rtnmsg
"RTN","SAMIHOM4",491,0)
 . . . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",492,0)
 . . e  d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",493,0)
 . e  d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",494,0)
 ;
"RTN","SAMIHOM4",495,0)
 i route="deleteform" d  q 0
"RTN","SAMIHOM4",496,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",497,0)
 . d DELFORM^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",498,0)
 ;
"RTN","SAMIHOM4",499,0)
 i route="ctreport" d  q 0
"RTN","SAMIHOM4",500,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",501,0)
 . n format s format="html"
"RTN","SAMIHOM4",502,0)
 . s format="text"
"RTN","SAMIHOM4",503,0)
 . i format="text" d WSNOTE^SAMINOT3(.SAMIRESULT,.SAMIARG) q  ;
"RTN","SAMIHOM4",504,0)
 . i format="html" d WSREPORT^SAMICTR0(.SAMIRESULT,.SAMIARG) q  ;
"RTN","SAMIHOM4",505,0)
 . ;d wsReport^SAMICTRT(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",506,0)
 ;
"RTN","SAMIHOM4",507,0)
 i route="note" d  q 0
"RTN","SAMIHOM4",508,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",509,0)
 . d WSNOTE^SAMINOT1(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",510,0)
 ;
"RTN","SAMIHOM4",511,0)
 i route="report" d  q 0
"RTN","SAMIHOM4",512,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",513,0)
 . d WSREPORT^SAMIUR(.SAMIRESULT,.vars)
"RTN","SAMIHOM4",514,0)
 ;
"RTN","SAMIHOM4",515,0)
 i route="addperson" d  q 0
"RTN","SAMIHOM4",516,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",517,0)
 . n form
"RTN","SAMIHOM4",518,0)
 . s form="vapals:addperson"
"RTN","SAMIHOM4",519,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",520,0)
 ;
"RTN","SAMIHOM4",521,0)
 i route="editperson" d  q 0
"RTN","SAMIHOM4",522,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",523,0)
 . n dfn s dfn=$g(vars("dfn")) ; must have a dfn
"RTN","SAMIHOM4",524,0)
 . i dfn="" d  q  ;
"RTN","SAMIHOM4",525,0)
 . . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",526,0)
 . n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",527,0)
 . n sien s sien=$o(@root@("dfn",dfn,""))
"RTN","SAMIHOM4",528,0)
 . i sien="" d  q  ;
"RTN","SAMIHOM4",529,0)
 . . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",530,0)
 . s vars("name")=$g(@root@(sien,"saminame"))
"RTN","SAMIHOM4",531,0)
 . s tdob=$g(@root@(sien,"dob"))
"RTN","SAMIHOM4",532,0)
 . s vars("dob")=$p(tdob,"-",2)_"/"_$p(tdob,"-",3)_"/"_$p(tdob,"-",1)
"RTN","SAMIHOM4",533,0)
 . s vars("sbdob")=$g(@root@(sien,"dob"))
"RTN","SAMIHOM4",534,0)
 . s vars("gender")=$g(@root@(sien,"sex"))
"RTN","SAMIHOM4",535,0)
 . ; s vars("icn")=$g(@root@(sien,"icn"))
"RTN","SAMIHOM4",536,0)
 . n tssn s tssn=$g(@root@(sien,"ssn"))
"RTN","SAMIHOM4",537,0)
 . s vars("ssn")=$e(tssn,1,3)_"-"_$e(tssn,4,5)_"-"_$e(tssn,6,9)
"RTN","SAMIHOM4",538,0)
 . s vars("last5")=$g(@root@(sien,"last5"))
"RTN","SAMIHOM4",539,0)
 . s vars("dfn")=$g(@root@(sien,"dfn"))
"RTN","SAMIHOM4",540,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",541,0)
 . n form,err,zhtml
"RTN","SAMIHOM4",542,0)
 . s form="vapals:editparticipant"
"RTN","SAMIHOM4",543,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",544,0)
 ;
"RTN","SAMIHOM4",545,0)
 i route="register" d  q 0
"RTN","SAMIHOM4",546,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",547,0)
 . d REG^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",548,0)
 ; 
"RTN","SAMIHOM4",549,0)
 i route="editsave" d  q 0
"RTN","SAMIHOM4",550,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",551,0)
 . d SAVE^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",552,0)
 ;
"RTN","SAMIHOM4",553,0)
 i route="merge" d  q 0
"RTN","SAMIHOM4",554,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",555,0)
 . d MERGE^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",556,0)
 ;
"RTN","SAMIHOM4",557,0)
 quit 0  ; end of wsi WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",558,0)
 ;
"RTN","SAMIHOM4",559,0)
 ;
"RTN","SAMIHOM4",560,0)
 ;
"RTN","SAMIHOM4",561,0)
 ;@section 3 other
"RTN","SAMIHOM4",562,0)
 ;
"RTN","SAMIHOM4",563,0)
 ;
"RTN","SAMIHOM4",564,0)
 ;
"RTN","SAMIHOM4",565,0)
REG(SAMIRTN,SAMIARG) ; manual registration
"RTN","SAMIHOM4",566,0)
 ;
"RTN","SAMIHOM4",567,0)
 n name s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",568,0)
 ;
"RTN","SAMIHOM4",569,0)
 m ^gpl("reg")=SAMIARG
"RTN","SAMIHOM4",570,0)
 n ssn s ssn=SAMIARG("ssn")
"RTN","SAMIHOM4",571,0)
 s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",572,0)
 s SAMIARG("errorMessage")=""
"RTN","SAMIHOM4",573,0)
 s SAMIARG("errorField")=""
"RTN","SAMIHOM4",574,0)
 ; test for duplicate ssn
"RTN","SAMIHOM4",575,0)
 ;
"RTN","SAMIHOM4",576,0)
 ;i $$DUPSSN(ssn) d  ;
"RTN","SAMIHOM4",577,0)
 ;. ;s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate SSN."
"RTN","SAMIHOM4",578,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate SSN error. A person with that SSN is already entered in the system."
"RTN","SAMIHOM4",579,0)
 ;. s SAMIARG("errorField")="ssn"
"RTN","SAMIHOM4",580,0)
 ;
"RTN","SAMIHOM4",581,0)
 ; test for duplicate icn
"RTN","SAMIHOM4",582,0)
 ;
"RTN","SAMIHOM4",583,0)
 ;n icn s icn=$g(SAMIARG("icn"))
"RTN","SAMIHOM4",584,0)
 ;i icn'="" i $$DUPICN(icn) d  ;
"RTN","SAMIHOM4",585,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate ICN error. A person with that ICN is already entered in the system."
"RTN","SAMIHOM4",586,0)
 ;. s SAMIARG("errorField")="icn"
"RTN","SAMIHOM4",587,0)
 ;;
"RTN","SAMIHOM4",588,0)
 ;; test for wellformed ICN
"RTN","SAMIHOM4",589,0)
 ;;
"RTN","SAMIHOM4",590,0)
 ;i icn'="" i $$BADICN(icn) d  ;
"RTN","SAMIHOM4",591,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Invalid ICN error. The check digits in the ICN do not match"
"RTN","SAMIHOM4",592,0)
 ;. s SAMIARG("errorField")="icn"
"RTN","SAMIHOM4",593,0)
 ;;
"RTN","SAMIHOM4",594,0)
 ; if there is an error, send back to edit with error message
"RTN","SAMIHOM4",595,0)
 i $g(SAMIARG("errorMessage"))'="" d  q  ;
"RTN","SAMIHOM4",596,0)
 . n form
"RTN","SAMIHOM4",597,0)
 . s form="vapals:addperson"
"RTN","SAMIHOM4",598,0)
 . d RTNERR(.SAMIRESULT,form,.SAMIARG)
"RTN","SAMIHOM4",599,0)
 ;
"RTN","SAMIHOM4",600,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",601,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",602,0)
 n ptlkien s ptlkien=""
"RTN","SAMIHOM4",603,0)
 n dfn s dfn=""
"RTN","SAMIHOM4",604,0)
 n sien s sien=""
"RTN","SAMIHOM4",605,0)
 i ptlkien="" s ptlkien=$o(@root@("AAAAAA"),-1)+1
"RTN","SAMIHOM4",606,0)
 n zm
"RTN","SAMIHOM4",607,0)
 k SAMIARG("MATCHLOG")
"RTN","SAMIHOM4",608,0)
 s zm=$$REMATCH(sien,.SAMIARG)
"RTN","SAMIHOM4",609,0)
 i zm>0 d  ;
"RTN","SAMIHOM4",610,0)
 . s SAMIARG("MATCHLOG")=zm
"RTN","SAMIHOM4",611,0)
 d MKPTLK(ptlkien,.SAMIARG) ; make the patient-lookup record
"RTN","SAMIHOM4",612,0)
 ;
"RTN","SAMIHOM4",613,0)
 s dfn=$o(@root@("dfn"," "),-1)+1
"RTN","SAMIHOM4",614,0)
 n pdfn
"RTN","SAMIHOM4",615,0)
 s pdfn=$o(@proot@("dfn"," "),-1)+1
"RTN","SAMIHOM4",616,0)
 i pdfn>dfn s dfn=pdfn ; need a dfn that has not been used
"RTN","SAMIHOM4",617,0)
 i dfn<9000001 s dfn=9000001
"RTN","SAMIHOM4",618,0)
 s @root@(ptlkien,"dfn")=dfn
"RTN","SAMIHOM4",619,0)
 d INDXPTLK(ptlkien)
"RTN","SAMIHOM4",620,0)
 s SAMIFILTER("samiroute")="addperson"
"RTN","SAMIHOM4",621,0)
 s SAMIFILTER("siteid")=$G(SAMIARG("siteid"))
"RTN","SAMIHOM4",622,0)
 s SAMIFILTER("sitetitle")=$G(SAMIARG("sitetitle"))
"RTN","SAMIHOM4",623,0)
 k SAMIARG ; return to a blank manual registration form
"RTN","SAMIHOM4",624,0)
 s SAMIARG("siteid")=$G(SAMIFILTER("siteid"))
"RTN","SAMIHOM4",625,0)
 s SAMIARG("sitetitle")=$G(SAMIFILTER("sitetitle"))
"RTN","SAMIHOM4",626,0)
 d SETINFO(.SAMIFILTER,name_" was successfully entered")
"RTN","SAMIHOM4",627,0)
 ;d SETWARN(.SAMIFILTER,"We might want to give you a warning")
"RTN","SAMIHOM4",628,0)
 do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIARG,.SAMIRESULT)
"RTN","SAMIHOM4",629,0)
 ;
"RTN","SAMIHOM4",630,0)
 quit  ; end of REG
"RTN","SAMIHOM4",631,0)
 ;
"RTN","SAMIHOM4",632,0)
 ;
"RTN","SAMIHOM4",633,0)
 ;
"RTN","SAMIHOM4",634,0)
MKPTLK(ptlkien,SAMIARG) ; creates patient-lookup record
"RTN","SAMIHOM4",635,0)
 ;
"RTN","SAMIHOM4",636,0)
 n ssn s ssn=SAMIARG("ssn")
"RTN","SAMIHOM4",637,0)
 s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",638,0)
 n name s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",639,0)
 n sinamef,sinamel
"RTN","SAMIHOM4",640,0)
 s sinamel=$p(name,","),sinamel=$$TRIM^XLFSTR(sinamel,"LR")
"RTN","SAMIHOM4",641,0)
 s sinamef=$p(name,",",2),sinamef=$$TRIM^XLFSTR(sinamef,"LR")
"RTN","SAMIHOM4",642,0)
 s name=sinamel_","_sinamef
"RTN","SAMIHOM4",643,0)
 n siteid s siteid=$g(SAMIARG("siteid"))
"RTN","SAMIHOM4",644,0)
 i siteid="" s siteid=$g(SAMIARG("site"))
"RTN","SAMIHOM4",645,0)
 ;
"RTN","SAMIHOM4",646,0)
 s @root@(ptlkien,"siteid")=siteid
"RTN","SAMIHOM4",647,0)
 s @root@(ptlkien,"saminame")=name
"RTN","SAMIHOM4",648,0)
 s @root@(ptlkien,"sinamef")=sinamef
"RTN","SAMIHOM4",649,0)
 s @root@(ptlkien,"sinamel")=sinamel
"RTN","SAMIHOM4",650,0)
 n fmdob s fmdob=$$FMDT^SAMIUR2(SAMIARG("dob"))
"RTN","SAMIHOM4",651,0)
 n ptlkdob s ptlkdob=$$FMTE^XLFDT(fmdob,7)
"RTN","SAMIHOM4",652,0)
 s ptlkdob=$TR(ptlkdob,"/","-")
"RTN","SAMIHOM4",653,0)
 s @root@(ptlkien,"dob")=ptlkdob
"RTN","SAMIHOM4",654,0)
 s @root@(ptlkien,"sbdob")=ptlkdob
"RTN","SAMIHOM4",655,0)
 n gender s gender=SAMIARG("gender")
"RTN","SAMIHOM4",656,0)
 s @root@(ptlkien,"gender")=$s(gender="M":"M^MALE",1:"F^FEMALE")
"RTN","SAMIHOM4",657,0)
 s @root@(ptlkien,"sex")=SAMIARG("gender")
"RTN","SAMIHOM4",658,0)
 ; s @root@(ptlkien,"icn")=SAMIARG("icn")
"RTN","SAMIHOM4",659,0)
 s @root@(ptlkien,"ssn")=ssn
"RTN","SAMIHOM4",660,0)
 n last5 s last5=$$UCASE($e(name,1))_$e(ssn,6,9)
"RTN","SAMIHOM4",661,0)
 s @root@(ptlkien,"last5")=last5
"RTN","SAMIHOM4",662,0)
 n mymatch s mymatch=$g(SAMIARG("MATCHLOG"))
"RTN","SAMIHOM4",663,0)
 i mymatch'="" s @root@(ptlkien,"MATCHLOG")=mymatch
"RTN","SAMIHOM4",664,0)
 ;
"RTN","SAMIHOM4",665,0)
 quit  ; end of MKPTLK
"RTN","SAMIHOM4",666,0)
 ;
"RTN","SAMIHOM4",667,0)
 ;
"RTN","SAMIHOM4",668,0)
 ;
"RTN","SAMIHOM4",669,0)
UPDTFRMS(dfn) ; update demographics in all forms for patient
"RTN","SAMIHOM4",670,0)
 ;
"RTN","SAMIHOM4",671,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",672,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",673,0)
 n lien s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIHOM4",674,0)
 q:lien=""
"RTN","SAMIHOM4",675,0)
 n pien s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIHOM4",676,0)
 q:pien=""
"RTN","SAMIHOM4",677,0)
 ; this patient has forms
"RTN","SAMIHOM4",678,0)
 m @proot@(pien)=@lroot@(lien) ; refresh the demos in the patient record
"RTN","SAMIHOM4",679,0)
 n ssn s ssn=$g(@proot@(pien,"ssn"))
"RTN","SAMIHOM4",680,0)
 s @proot@(pien,"sissn")=$e(ssn,1,3)_"-"_$e(ssn,4,5)_"-"_$e(ssn,6,9)
"RTN","SAMIHOM4",681,0)
 n sid s sid=$g(@proot@("sisid")) ; studyid 
"RTN","SAMIHOM4",682,0)
 q:sid=""  ; no studyid
"RTN","SAMIHOM4",683,0)
 n zi s zi=""
"RTN","SAMIHOM4",684,0)
 f  s zi=$o(@proot@("graph",sid,zi)) q:zi=""  d  ; for each form
"RTN","SAMIHOM4",685,0)
 . m @proot@("graph",sid,zi)=@proot@(pien) ; stamp each form with new demos
"RTN","SAMIHOM4",686,0)
 ;
"RTN","SAMIHOM4",687,0)
 quit  ; end of UPDTFRMS
"RTN","SAMIHOM4",688,0)
 ;
"RTN","SAMIHOM4",689,0)
 ;
"RTN","SAMIHOM4",690,0)
 ;
"RTN","SAMIHOM4",691,0)
MERGE(SAMIRESULT,SAMIARGS) ; merge participant records
"RTN","SAMIHOM4",692,0)
 ;
"RTN","SAMIHOM4",693,0)
 ; called from pressing the merge button on the unmatched report
"RTN","SAMIHOM4",694,0)
 ;
"RTN","SAMIHOM4",695,0)
 n toien s toien=$g(SAMIARGS("toien"))
"RTN","SAMIHOM4",696,0)
 i toien="" d  q  ;
"RTN","SAMIHOM4",697,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",698,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",699,0)
 n fromien s fromien=$g(@lroot@(toien,"MATCHLOG"))
"RTN","SAMIHOM4",700,0)
 i fromien="" d  q  ;
"RTN","SAMIHOM4",701,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",702,0)
 ;
"RTN","SAMIHOM4",703,0)
 ; test for remotedfn in from record - not valid if absent
"RTN","SAMIHOM4",704,0)
 ;
"RTN","SAMIHOM4",705,0)
 i $g(@lroot@(fromien,"remotedfn"))="" d  q  ;
"RTN","SAMIHOM4",706,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",707,0)
 ;
"RTN","SAMIHOM4",708,0)
 ; remove index entries for from and to records
"RTN","SAMIHOM4",709,0)
 ;
"RTN","SAMIHOM4",710,0)
 d UNINDXPT(fromien) ; delete index entries
"RTN","SAMIHOM4",711,0)
 d UNINDXPT(toien)
"RTN","SAMIHOM4",712,0)
 ;
"RTN","SAMIHOM4",713,0)
 ; create changelog entry in to record - contains from record
"RTN","SAMIHOM4",714,0)
 ;
"RTN","SAMIHOM4",715,0)
 m @lroot@(toien,"changelog",$$FMTE^XLFDT($$NOW^XLFDT,5))=@lroot@(fromien)
"RTN","SAMIHOM4",716,0)
 ;
"RTN","SAMIHOM4",717,0)
 ; change the dfn in the from record to the to record dfn for merging
"RTN","SAMIHOM4",718,0)
 ;
"RTN","SAMIHOM4",719,0)
 s @lroot@(fromien,"dfn")=@lroot@(toien,"dfn")
"RTN","SAMIHOM4",720,0)
 n dfn s dfn=@lroot@(toien,"dfn") ; for use in updating forms
"RTN","SAMIHOM4",721,0)
 ;
"RTN","SAMIHOM4",722,0)
 ; merge the from record to the to record
"RTN","SAMIHOM4",723,0)
 ;
"RTN","SAMIHOM4",724,0)
 m @lroot@(toien)=@lroot@(fromien)
"RTN","SAMIHOM4",725,0)
 ;
"RTN","SAMIHOM4",726,0)
 ; delete the from record
"RTN","SAMIHOM4",727,0)
 ;
"RTN","SAMIHOM4",728,0)
 k @lroot@(fromien)
"RTN","SAMIHOM4",729,0)
 ;
"RTN","SAMIHOM4",730,0)
 ; reindex the to record
"RTN","SAMIHOM4",731,0)
 ;
"RTN","SAMIHOM4",732,0)
 d INDXPTLK(toien)
"RTN","SAMIHOM4",733,0)
 ;
"RTN","SAMIHOM4",734,0)
 ; propagate the updated from record to every form
"RTN","SAMIHOM4",735,0)
 ;
"RTN","SAMIHOM4",736,0)
 d UPDTFRMS(dfn) ; updates the patient in the vapals-patient graph
"RTN","SAMIHOM4",737,0)
 ;
"RTN","SAMIHOM4",738,0)
 ; leave and return to the unmatched report
"RTN","SAMIHOM4",739,0)
 ;   note that the form and to records will no longer be in the report
"RTN","SAMIHOM4",740,0)
 ;
"RTN","SAMIHOM4",741,0)
 d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",742,0)
 ;
"RTN","SAMIHOM4",743,0)
 quit  ; end of MERGE
"RTN","SAMIHOM4",744,0)
 ;
"RTN","SAMIHOM4",745,0)
 ;
"RTN","SAMIHOM4",746,0)
 ;
"RTN","SAMIHOM4",747,0)
ADDUNMAT ; adds unmatched report web service to system
"RTN","SAMIHOM4",748,0)
 ;
"RTN","SAMIHOM4",749,0)
 d addService^%webutils("GET","unmatched","WSUNMAT^SAMIHOM4")
"RTN","SAMIHOM4",750,0)
 ;
"RTN","SAMIHOM4",751,0)
 quit  ; end of ADDUNMAT
"RTN","SAMIHOM4",752,0)
 ;
"RTN","SAMIHOM4",753,0)
 ;
"RTN","SAMIHOM4",754,0)
 ;
"RTN","SAMIHOM4",755,0)
DELUNMAT ; deletes unmatched web service
"RTN","SAMIHOM4",756,0)
 ;
"RTN","SAMIHOM4",757,0)
 d deleteService^%webutils("GET","unmatched")
"RTN","SAMIHOM4",758,0)
 ;
"RTN","SAMIHOM4",759,0)
 quit  ; end of DELUNMAT
"RTN","SAMIHOM4",760,0)
 ;
"RTN","SAMIHOM4",761,0)
 ;
"RTN","SAMIHOM4",762,0)
 ;
"RTN","SAMIHOM4",763,0)
WSUNMAT(SAMIRESULT,SAMIARGS) ; navigates to unmatched report
"RTN","SAMIHOM4",764,0)
 ; 
"RTN","SAMIHOM4",765,0)
 n filter,bdy
"RTN","SAMIHOM4",766,0)
 s bdy=""
"RTN","SAMIHOM4",767,0)
 ;s filter("siteid")="PHX"
"RTN","SAMIHOM4",768,0)
 s filter("samiroute")="report"
"RTN","SAMIHOM4",769,0)
 s filter("samireporttype")="unmatched"
"RTN","SAMIHOM4",770,0)
 d WSVAPALS^SAMIHOM3(.filter,.bdy,.SAMIRESULT) ; back to the unmatched report
"RTN","SAMIHOM4",771,0)
 ;
"RTN","SAMIHOM4",772,0)
 quit  ; end of WSUNMAT
"RTN","SAMIHOM4",773,0)
 ;
"RTN","SAMIHOM4",774,0)
 ;
"RTN","SAMIHOM4",775,0)
 ;
"RTN","SAMIHOM4",776,0)
DUPSSN(ssn) ; extrinsic returns true if duplicate ssn
"RTN","SAMIHOM4",777,0)
 ;
"RTN","SAMIHOM4",778,0)
 n proot s proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",779,0)
 i $d(@proot@("ssn",ssn)) q 1
"RTN","SAMIHOM4",780,0)
 ;
"RTN","SAMIHOM4",781,0)
 quit 0 ; end of $$DUPSSN
"RTN","SAMIHOM4",782,0)
 ;
"RTN","SAMIHOM4",783,0)
 ;
"RTN","SAMIHOM4",784,0)
 ;
"RTN","SAMIHOM4",785,0)
DUPICN(icn) ; extrinsic returns true if duplicate icn
"RTN","SAMIHOM4",786,0)
 ;
"RTN","SAMIHOM4",787,0)
 n proot s proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",788,0)
 n tmpicn s tmpicn=$p(icn,"V",1)
"RTN","SAMIHOM4",789,0)
 i $d(@proot@("icn",icn)) q 1
"RTN","SAMIHOM4",790,0)
 i $d(@proot@("icn",tmpicn)) q 1
"RTN","SAMIHOM4",791,0)
 ;
"RTN","SAMIHOM4",792,0)
 quit 0 ; end of $$DUPICN
"RTN","SAMIHOM4",793,0)
 ;
"RTN","SAMIHOM4",794,0)
 ;
"RTN","SAMIHOM4",795,0)
 ;
"RTN","SAMIHOM4",796,0)
BADICN(icn) ; extrinsic returns true if ICN checkdigits are wrong
"RTN","SAMIHOM4",797,0)
 ;
"RTN","SAMIHOM4",798,0)
 n zchk s zchk=$p(icn,"V",2)
"RTN","SAMIHOM4",799,0)
 n zicn s zicn=$p(icn,"V",1)
"RTN","SAMIHOM4",800,0)
 q:zchk="" 1
"RTN","SAMIHOM4",801,0)
 i zchk'=$$CHECKDG^MPIFSPC(zicn) q 1
"RTN","SAMIHOM4",802,0)
 ;
"RTN","SAMIHOM4",803,0)
 quit 0
"RTN","SAMIHOM4",804,0)
 ;
"RTN","SAMIHOM4",805,0)
 ;
"RTN","SAMIHOM4",806,0)
 ;
"RTN","SAMIHOM4",807,0)
SAVE(SAMIRESULT,SAMIARG) ; save patient-lookup record after edit
"RTN","SAMIHOM4",808,0)
 ;
"RTN","SAMIHOM4",809,0)
 n dfn s dfn=$g(vars("dfn")) ; must have a dfn
"RTN","SAMIHOM4",810,0)
 i dfn="" d  q  ;
"RTN","SAMIHOM4",811,0)
 . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home 
"RTN","SAMIHOM4",812,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",813,0)
 n sien s sien=$o(@root@("dfn",dfn,""))
"RTN","SAMIHOM4",814,0)
 i sien="" d  q  ;
"RTN","SAMIHOM4",815,0)
 . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home 
"RTN","SAMIHOM4",816,0)
 d UNINDXPT(sien) ; remove old index entries
"RTN","SAMIHOM4",817,0)
 n zm
"RTN","SAMIHOM4",818,0)
 k SAMIARG("MATCHLOG")
"RTN","SAMIHOM4",819,0)
 s zm=$$REMATCH(sien,.SAMIARG)
"RTN","SAMIHOM4",820,0)
 i zm>0 d  ;
"RTN","SAMIHOM4",821,0)
 . s SAMIARG("MATCHLOG")=zm
"RTN","SAMIHOM4",822,0)
 d MKPTLK(sien,.SAMIARG) ; add the updated fields
"RTN","SAMIHOM4",823,0)
 d INDXPTLK(sien) ; create new index entries
"RTN","SAMIHOM4",824,0)
 d UPDTFRMS(dfn) ; update demographic info in all forms
"RTN","SAMIHOM4",825,0)
 n filter,bdy
"RTN","SAMIHOM4",826,0)
 s bdy=""
"RTN","SAMIHOM4",827,0)
 m filter=SAMIARG
"RTN","SAMIHOM4",828,0)
 s filter("samiroute")="report"
"RTN","SAMIHOM4",829,0)
 s filter("samireporttype")="unmatched"
"RTN","SAMIHOM4",830,0)
 d WSVAPALS^SAMIHOM3(.filter,.bdy,.SAMIRESULT) ; back to the unmatched report
"RTN","SAMIHOM4",831,0)
 ;
"RTN","SAMIHOM4",832,0)
 quit  ; end of SAVE
"RTN","SAMIHOM4",833,0)
 ;
"RTN","SAMIHOM4",834,0)
 ;
"RTN","SAMIHOM4",835,0)
 ;
"RTN","SAMIHOM4",836,0)
REMATCH(sien,SAMIARG) ; extrinsic returns possible match ien
"RTN","SAMIHOM4",837,0)
 ;
"RTN","SAMIHOM4",838,0)
 ; else zero
"RTN","SAMIHOM4",839,0)
 ;
"RTN","SAMIHOM4",840,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",841,0)
 n ssn,name,icn,x,y
"RTN","SAMIHOM4",842,0)
 s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",843,0)
 i ssn["-" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",844,0)
 s name=$g(SAMIARG("saminame"))
"RTN","SAMIHOM4",845,0)
 i name="" s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",846,0)
 s name=$$UCASE(name)
"RTN","SAMIHOM4",847,0)
 ; s icn=$g(SAMIARG("icn"))
"RTN","SAMIHOM4",848,0)
 s x=0
"RTN","SAMIHOM4",849,0)
 i ssn'="" s x=$o(@lroot@("ssn",ssn,""))
"RTN","SAMIHOM4",850,0)
 i x=sien s x=$o(@lroot@("ssn",ssn,x))
"RTN","SAMIHOM4",851,0)
 i +x'=0 d  ;
"RTN","SAMIHOM4",852,0)
 . s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",853,0)
 . ;i y>9000000 s x=0
"RTN","SAMIHOM4",854,0)
 i x>0 q x
"RTN","SAMIHOM4",855,0)
 i name'="" s x=$o(@lroot@("name",name,""))
"RTN","SAMIHOM4",856,0)
 i x=sien s x=$o(@lroot@("name",name,x))
"RTN","SAMIHOM4",857,0)
 i +x'=0 d  ;
"RTN","SAMIHOM4",858,0)
 . s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",859,0)
 . ;i y>9000000 s x=0
"RTN","SAMIHOM4",860,0)
 i x>0 q x
"RTN","SAMIHOM4",861,0)
 ;i icn'="" s x=$o(@lroot@("icn",icn,""))
"RTN","SAMIHOM4",862,0)
 ;i x=sien s x=$o(@lroot@("icn",icn,x))
"RTN","SAMIHOM4",863,0)
 ;i +x'=0 d  ;
"RTN","SAMIHOM4",864,0)
 ;. s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",865,0)
 ;. i y>9000000 s x=0
"RTN","SAMIHOM4",866,0)
 ;i x>0 q x
"RTN","SAMIHOM4",867,0)
 ;
"RTN","SAMIHOM4",868,0)
 quit 0 ; end of $$REMATCH
"RTN","SAMIHOM4",869,0)
 ;
"RTN","SAMIHOM4",870,0)
 ;
"RTN","SAMIHOM4",871,0)
 ;
"RTN","SAMIHOM4",872,0)
SETINFO(vars,msg) ; set information message text
"RTN","SAMIHOM4",873,0)
 ;
"RTN","SAMIHOM4",874,0)
 ; vars are the screen variables passed by reference
"RTN","SAMIHOM4",875,0)
 ;
"RTN","SAMIHOM4",876,0)
 s vars("infoMessage")=msg
"RTN","SAMIHOM4",877,0)
 ;
"RTN","SAMIHOM4",878,0)
 quit  ; end of SETINFO
"RTN","SAMIHOM4",879,0)
 ;
"RTN","SAMIHOM4",880,0)
 ;
"RTN","SAMIHOM4",881,0)
 ;
"RTN","SAMIHOM4",882,0)
SETWARN(vars,msg) ; set warning message text
"RTN","SAMIHOM4",883,0)
 ;
"RTN","SAMIHOM4",884,0)
 ; vars are the screen variables passed by reference
"RTN","SAMIHOM4",885,0)
 ;
"RTN","SAMIHOM4",886,0)
 s vars("warnMessage")=msg
"RTN","SAMIHOM4",887,0)
 ;
"RTN","SAMIHOM4",888,0)
 quit  ; end of SETWARN
"RTN","SAMIHOM4",889,0)
 ;
"RTN","SAMIHOM4",890,0)
 ;
"RTN","SAMIHOM4",891,0)
 ; 
"RTN","SAMIHOM4",892,0)
RTNERR(rtn,form,vals,msg,fld) ; redisplay page w/error message
"RTN","SAMIHOM4",893,0)
 ;
"RTN","SAMIHOM4",894,0)
 ; rtn is the return array
"RTN","SAMIHOM4",895,0)
 ; form is the form the page requires
"RTN","SAMIHOM4",896,0)
 ; vals are the values for the page. passed by reference
"RTN","SAMIHOM4",897,0)
 ; msg is the error message to be displayed
"RTN","SAMIHOM4",898,0)
 ; fld is the name of the field where the cursor should be put
"RTN","SAMIHOM4",899,0)
 ;
"RTN","SAMIHOM4",900,0)
 n zhtml ; work area for the tempate
"RTN","SAMIHOM4",901,0)
 d SAMIHTM^%wf(.zhtml,form,.err)
"RTN","SAMIHOM4",902,0)
 d MERGEHTM^%wf(.zhtml,.vals,.err)
"RTN","SAMIHOM4",903,0)
 m rtn=zhtml
"RTN","SAMIHOM4",904,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMIHOM4",905,0)
 ;
"RTN","SAMIHOM4",906,0)
 quit  ; end of RTNERR
"RTN","SAMIHOM4",907,0)
 ;
"RTN","SAMIHOM4",908,0)
 ;
"RTN","SAMIHOM4",909,0)
 ;
"RTN","SAMIHOM4",910,0)
RTNPAGE(rtn,form,vals) ; display page
"RTN","SAMIHOM4",911,0)
 ;
"RTN","SAMIHOM4",912,0)
 ; rtn is the return array
"RTN","SAMIHOM4",913,0)
 ; form is the form the page requires
"RTN","SAMIHOM4",914,0)
 ; vals are the values for the page. passed by reference
"RTN","SAMIHOM4",915,0)
 ;
"RTN","SAMIHOM4",916,0)
 n err
"RTN","SAMIHOM4",917,0)
 n zhtml ; work area for the tempate
"RTN","SAMIHOM4",918,0)
 d SAMIHTM^%wf(.zhtml,form,.err)
"RTN","SAMIHOM4",919,0)
 d MERGEHTM^%wf(.zhtml,.vals,.err)
"RTN","SAMIHOM4",920,0)
 m SAMIRESULT=zhtml
"RTN","SAMIHOM4",921,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMIHOM4",922,0)
 ;
"RTN","SAMIHOM4",923,0)
 quit  ; end of RTNPAGE
"RTN","SAMIHOM4",924,0)
 ;
"RTN","SAMIHOM4",925,0)
 ;
"RTN","SAMIHOM4",926,0)
 ;
"RTN","SAMIHOM4",927,0)
REINDXPL ; reindex patient lookup
"RTN","SAMIHOM4",928,0)
 ;
"RTN","SAMIHOM4",929,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",930,0)
 n zi s zi=0
"RTN","SAMIHOM4",931,0)
 k @root@("ssn")
"RTN","SAMIHOM4",932,0)
 k @root@("name")
"RTN","SAMIHOM4",933,0)
 k @root@("last5")
"RTN","SAMIHOM4",934,0)
 k @root@("sinamef")
"RTN","SAMIHOM4",935,0)
 k @root@("sinamel")
"RTN","SAMIHOM4",936,0)
 ; k @root@("icn")
"RTN","SAMIHOM4",937,0)
 f  s zi=$o(@root@(zi)) q:+zi=0  d  ;
"RTN","SAMIHOM4",938,0)
 . d INDXPTLK(zi)
"RTN","SAMIHOM4",939,0)
 ;
"RTN","SAMIHOM4",940,0)
 quit  ; end of REINDXPL
"RTN","SAMIHOM4",941,0)
 ;
"RTN","SAMIHOM4",942,0)
 ;
"RTN","SAMIHOM4",943,0)
 ;
"RTN","SAMIHOM4",944,0)
INDXPTLK(ien) ; generate index entries in patient-lookup graph
"RTN","SAMIHOM4",945,0)
 ;
"RTN","SAMIHOM4",946,0)
 ; for entry ien
"RTN","SAMIHOM4",947,0)
 ;
"RTN","SAMIHOM4",948,0)
 n proot set proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",949,0)
 n name s name=$g(@proot@(ien,"saminame"))
"RTN","SAMIHOM4",950,0)
 s @proot@("name",name,ien)=""
"RTN","SAMIHOM4",951,0)
 n ucname s ucname=$$UCASE(name)
"RTN","SAMIHOM4",952,0)
 s @proot@("name",ucname,ien)=""
"RTN","SAMIHOM4",953,0)
 n x
"RTN","SAMIHOM4",954,0)
 s x=$g(@proot@(ien,"dfn")) ;w !,x
"RTN","SAMIHOM4",955,0)
 s:x'="" @proot@("dfn",x,ien)=""
"RTN","SAMIHOM4",956,0)
 s x=$g(@proot@(ien,"last5")) ;w !,x
"RTN","SAMIHOM4",957,0)
 s:x'="" @proot@("last5",x,ien)=""
"RTN","SAMIHOM4",958,0)
 ;
"RTN","SAMIHOM4",959,0)
 ; s x=$g(@proot@(ien,"icn")) ;w !,x
"RTN","SAMIHOM4",960,0)
 ; i x'["V" d  ;
"RTN","SAMIHOM4",961,0)
 ; . i x="" q
"RTN","SAMIHOM4",962,0)
 ; . n chk s chk=$$CHECKDG^MPIFSPC(x)
"RTN","SAMIHOM4",963,0)
 ; . s @proot@(ien,"icn")=x_"V"_chk
"RTN","SAMIHOM4",964,0)
 ; . s x=x_"V"_chk
"RTN","SAMIHOM4",965,0)
 ; s:x'="" @proot@("icn",x,ien)=""
"RTN","SAMIHOM4",966,0)
 ;
"RTN","SAMIHOM4",967,0)
 s x=$g(@proot@(ien,"ssn")) ;w !,x
"RTN","SAMIHOM4",968,0)
 s:x'="" @proot@("ssn",x,ien)=""
"RTN","SAMIHOM4",969,0)
 s x=$g(@proot@(ien,"sinamef")) ;w !,x
"RTN","SAMIHOM4",970,0)
 s:x'="" @proot@("sinamef",x,ien)=""
"RTN","SAMIHOM4",971,0)
 s x=$g(@proot@(ien,"sinamel")) w !,x
"RTN","SAMIHOM4",972,0)
 s:x'="" @proot@("sinamel",x,ien)=""
"RTN","SAMIHOM4",973,0)
 set @proot@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHOM4",974,0)
 ;
"RTN","SAMIHOM4",975,0)
 quit  ; end of INDXPTLK
"RTN","SAMIHOM4",976,0)
 ;
"RTN","SAMIHOM4",977,0)
 ;
"RTN","SAMIHOM4",978,0)
 ;
"RTN","SAMIHOM4",979,0)
UNINDXPT(ien) ; remove index entries from patient-lookup graph
"RTN","SAMIHOM4",980,0)
 ;
"RTN","SAMIHOM4",981,0)
 ; for entry ien
"RTN","SAMIHOM4",982,0)
 ;
"RTN","SAMIHOM4",983,0)
 n proot set proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",984,0)
 n name s name=$g(@proot@(ien,"saminame"))
"RTN","SAMIHOM4",985,0)
 k @proot@("name",name,ien)
"RTN","SAMIHOM4",986,0)
 n ucname s ucname=$$UCASE(name)
"RTN","SAMIHOM4",987,0)
 k @proot@("name",ucname,ien)
"RTN","SAMIHOM4",988,0)
 n x
"RTN","SAMIHOM4",989,0)
 s x=$g(@proot@(ien,"dfn")) ;w !,x
"RTN","SAMIHOM4",990,0)
 k:x'="" @proot@("dfn",x,ien)
"RTN","SAMIHOM4",991,0)
 s x=$g(@proot@(ien,"last5")) ;w !,x
"RTN","SAMIHOM4",992,0)
 k:x'="" @proot@("last5",x,ien)
"RTN","SAMIHOM4",993,0)
 ;
"RTN","SAMIHOM4",994,0)
 ; s x=$g(@proot@(ien,"icn")) ;w !,x
"RTN","SAMIHOM4",995,0)
 ; i x'["V" d  ;
"RTN","SAMIHOM4",996,0)
 ; . i x="" q
"RTN","SAMIHOM4",997,0)
 ; . n chk s chk=$$CHECKDG^MPIFSPC(x)
"RTN","SAMIHOM4",998,0)
 ; . s @proot@(ien,"icn")=x_"V"_chk
"RTN","SAMIHOM4",999,0)
 ; . s x=x_"V"_chk
"RTN","SAMIHOM4",1000,0)
 ; k:x'="" @proot@("icn",x,ien)
"RTN","SAMIHOM4",1001,0)
 ;
"RTN","SAMIHOM4",1002,0)
 s x=$g(@proot@(ien,"ssn")) ;w !,x
"RTN","SAMIHOM4",1003,0)
 k:x'="" @proot@("ssn",x,ien)
"RTN","SAMIHOM4",1004,0)
 s x=$g(@proot@(ien,"sinamef")) ;w !,x
"RTN","SAMIHOM4",1005,0)
 k:x'="" @proot@("sinamef",x,ien)
"RTN","SAMIHOM4",1006,0)
 s x=$g(@proot@(ien,"sinamel")) w !,x
"RTN","SAMIHOM4",1007,0)
 k:x'="" @proot@("sinamel",x,ien)
"RTN","SAMIHOM4",1008,0)
 set @proot@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHOM4",1009,0)
 ;
"RTN","SAMIHOM4",1010,0)
 quit  ; end of UNINDXPT
"RTN","SAMIHOM4",1011,0)
 ;
"RTN","SAMIHOM4",1012,0)
 ;
"RTN","SAMIHOM4",1013,0)
 ;
"RTN","SAMIHOM4",1014,0)
UCASE(STR) ; extrinsic returns uppercase of STR
"RTN","SAMIHOM4",1015,0)
 ;
"RTN","SAMIHOM4",1016,0)
 N X,Y
"RTN","SAMIHOM4",1017,0)
 S X=STR
"RTN","SAMIHOM4",1018,0)
 X ^%ZOSF("UPPERCASE")
"RTN","SAMIHOM4",1019,0)
 ;
"RTN","SAMIHOM4",1020,0)
 quit Y ; end of $$UCASE
"RTN","SAMIHOM4",1021,0)
 ;
"RTN","SAMIHOM4",1022,0)
 ;
"RTN","SAMIHOM4",1023,0)
 ;
"RTN","SAMIHOM4",1024,0)
 ;@wri-code WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",1025,0)
WSNEWCAS ; web route newcase (creates new case)
"RTN","SAMIHOM4",1026,0)
 ;
"RTN","SAMIHOM4",1027,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1028,0)
 ;
"RTN","SAMIHOM4",1029,0)
 ;ven/gpl;wri;procedure;
"RTN","SAMIHOM4",1030,0)
 ;@signature
"RTN","SAMIHOM4",1031,0)
 ; do WSNEWCAS^SAMIHOM3(SAMIARGS,SAMIBODY,SAMIRESULT)
"RTN","SAMIHOM4",1032,0)
 ;@branches-from
"RTN","SAMIHOM4",1033,0)
 ; wri WSNEWCAS^SAMIHOM3 [wr newcase]
"RTN","SAMIHOM4",1034,0)
 ;@wri-called-by
"RTN","SAMIHOM4",1035,0)
 ; wsi WSVAPALS^SAMIHOM3 [ws post vapals]
"RTN","SAMIHOM4",1036,0)
 ;@called-by none
"RTN","SAMIHOM4",1037,0)
 ;@calls
"RTN","SAMIHOM4",1038,0)
 ; parseBody^%wf
"RTN","SAMIHOM4",1039,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1040,0)
 ;  $$VALDTNM [commented out]
"RTN","SAMIHOM4",1041,0)
 ;  GETHOME [commented out]
"RTN","SAMIHOM4",1042,0)
 ;  $$NEXTNUM [commented out]
"RTN","SAMIHOM4",1043,0)
 ; $$GENSTDID^SAMIHOM3
"RTN","SAMIHOM4",1044,0)
 ; $$NOW^XLFDT
"RTN","SAMIHOM4",1045,0)
 ; $$KEYDATE^SAMIHOM3
"RTN","SAMIHOM4",1046,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMIHOM4",1047,0)
 ;  makeSbform [commented out]
"RTN","SAMIHOM4",1048,0)
 ; $$MKSIFORM^SAMIHOM3
"RTN","SAMIHOM4",1049,0)
 ; wsGetForm^%wf
"RTN","SAMIHOM4",1050,0)
 ;  WSCASE^SAMICASE [commented out]
"RTN","SAMIHOM4",1051,0)
 ;@input
"RTN","SAMIHOM4",1052,0)
 ;.ARGS =
"RTN","SAMIHOM4",1053,0)
 ; BODY =
"RTN","SAMIHOM4",1054,0)
 ;.RESULT =
"RTN","SAMIHOM4",1055,0)
 ;@output: ?
"RTN","SAMIHOM4",1056,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1057,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1058,0)
 ;
"RTN","SAMIHOM4",1059,0)
 ;
"RTN","SAMIHOM4",1060,0)
 ;@stanza 2 create new case
"RTN","SAMIHOM4",1061,0)
 ;
"RTN","SAMIHOM4",1062,0)
 merge ^SAMIUL("newCase","ARGS")=SAMIARGS
"RTN","SAMIHOM4",1063,0)
 merge ^SAMIUL("newCase","BODY")=SAMIBODY
"RTN","SAMIHOM4",1064,0)
 ;
"RTN","SAMIHOM4",1065,0)
 new vars,bdy
"RTN","SAMIHOM4",1066,0)
 set SAMIBDY=$get(SAMIBODY(1))
"RTN","SAMIHOM4",1067,0)
 if SAMIBDY="" M vars=SAMIARGS
"RTN","SAMIHOM4",1068,0)
 else  do parseBody^%wf("vars",.SAMIBDY)
"RTN","SAMIHOM4",1069,0)
 merge ^SAMIUL("newCase","vars")=vars
"RTN","SAMIHOM4",1070,0)
 ;
"RTN","SAMIHOM4",1071,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",1072,0)
 ;
"RTN","SAMIHOM4",1073,0)
 new saminame set saminame=$get(vars("name"))
"RTN","SAMIHOM4",1074,0)
 if saminame="" s saminame=$get(vars("saminame"))
"RTN","SAMIHOM4",1075,0)
 ;if $$VALDTNM(saminame,.ARGS)=-1 do  quit  ;
"RTN","SAMIHOM4",1076,0)
 ;. new r1
"RTN","SAMIHOM4",1077,0)
 ;. do GETHOME(.r1,.ARGS) ; home page to redisplay
"RTN","SAMIHOM4",1078,0)
 ;. merge RESULT=r1
"RTN","SAMIHOM4",1079,0)
 ;. quit
"RTN","SAMIHOM4",1080,0)
 ;
"RTN","SAMIHOM4",1081,0)
 new dfn s dfn=$get(vars("dfn"))
"RTN","SAMIHOM4",1082,0)
 ;if dfn="" do  quit  ;
"RTN","SAMIHOM4",1083,0)
 ;. new r1
"RTN","SAMIHOM4",1084,0)
 ;. do GETHOME(.r1,.ARGS) ; home page to redisplay
"RTN","SAMIHOM4",1085,0)
 ;. merge RESULT=r1
"RTN","SAMIHOM4",1086,0)
 ;. quit
"RTN","SAMIHOM4",1087,0)
 ;
"RTN","SAMIHOM4",1088,0)
 ; new gien set gien=$$NEXTNUM
"RTN","SAMIHOM4",1089,0)
 new gien set gien=dfn
"RTN","SAMIHOM4",1090,0)
 ;
"RTN","SAMIHOM4",1091,0)
 merge ^SAMIUL("newCase","G1")=root
"RTN","SAMIHOM4",1092,0)
 ; create dfn index
"RTN","SAMIHOM4",1093,0)
 set @root@("dfn",dfn,gien)=""
"RTN","SAMIHOM4",1094,0)
 ;
"RTN","SAMIHOM4",1095,0)
 set @root@(gien,"saminum")=gien
"RTN","SAMIHOM4",1096,0)
 set @root@(gien,"saminame")=saminame
"RTN","SAMIHOM4",1097,0)
 ;
"RTN","SAMIHOM4",1098,0)
 new studyid set studyid=$$GENSTDID^SAMIHOM3(gien,.SAMIARGS)
"RTN","SAMIHOM4",1099,0)
 set @root@(gien,"samistudyid")=studyid
"RTN","SAMIHOM4",1100,0)
 set @root@("sid",studyid,gien)=""
"RTN","SAMIHOM4",1101,0)
 ;
"RTN","SAMIHOM4",1102,0)
 new datekey set datekey=$$KEYDATE^SAMIHOM3($$NOW^XLFDT)
"RTN","SAMIHOM4",1103,0)
 set @root@(gien,"samicreatedate")=datekey
"RTN","SAMIHOM4",1104,0)
 ;
"RTN","SAMIHOM4",1105,0)
 merge ^SAMIUL("newCase",gien)=@root@(gien)
"RTN","SAMIHOM4",1106,0)
 ;
"RTN","SAMIHOM4",1107,0)
 ;
"RTN","SAMIHOM4",1108,0)
 do PREFILL^SAMIHOM3(dfn) ; prefills from the "patient-lookup" graph
"RTN","SAMIHOM4",1109,0)
 ;
"RTN","SAMIHOM4",1110,0)
 new siformkey
"RTN","SAMIHOM4",1111,0)
 ; do makeSbform(gien) ; create background form for new patient
"RTN","SAMIHOM4",1112,0)
 set siformkey=$$MKSIFORM^SAMIHOM3(gien) ; create intake for new patient
"RTN","SAMIHOM4",1113,0)
 ;
"RTN","SAMIHOM4",1114,0)
 set SAMIARGS("studyid")=studyid
"RTN","SAMIHOM4",1115,0)
 set SAMIARGS("form")="vapals:"_siformkey
"RTN","SAMIHOM4",1116,0)
 do wsGetForm^%wf(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",1117,0)
 ; do WSCASE^SAMICASE(.SAMIRESULT,.SAMIARGS) ; navigate to case review page
"RTN","SAMIHOM4",1118,0)
 ;
"RTN","SAMIHOM4",1119,0)
 ;
"RTN","SAMIHOM4",1120,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",1121,0)
 ;
"RTN","SAMIHOM4",1122,0)
 quit  ; end of wri WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",1123,0)
 ;
"RTN","SAMIHOM4",1124,0)
 ;
"RTN","SAMIHOM4",1125,0)
 ;
"RTN","SAMIHOM4",1126,0)
EOR ; end of routine SAMIHOM4
"RTN","SAMIHUL")
0^9^B111434
"RTN","SAMIHUL",1,0)
SAMIHUL ;ven/gpl - ielcap: home page log ;2021-10-29t02:34z
"RTN","SAMIHUL",2,0)
 ;;18.0;SAMI;**9,12,15,16**;2020-01;Build 2
"RTN","SAMIHUL",3,0)
 ;18-15
"RTN","SAMIHUL",4,0)
 ;
"RTN","SAMIHUL",5,0)
 ; SAMIHOM3 contains subroutines for producing the ELCAP Home Page.
"RTN","SAMIHUL",6,0)
 ; SAMIHUL contains the development log for the SAMIHOM* routines.
"RTN","SAMIHUL",7,0)
 ; It contains no executable code.
"RTN","SAMIHUL",8,0)
 ;
"RTN","SAMIHUL",9,0)
 quit  ; no entry from top
"RTN","SAMIHUL",10,0)
 ;
"RTN","SAMIHUL",11,0)
 ;
"RTN","SAMIHUL",12,0)
 ;
"RTN","SAMIHUL",13,0)
 ;@section 0 primary development
"RTN","SAMIHUL",14,0)
 ;
"RTN","SAMIHUL",15,0)
 ;
"RTN","SAMIHUL",16,0)
 ;
"RTN","SAMIHUL",17,0)
 ;@routine-credits
"RTN","SAMIHUL",18,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIHUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIHUL",20,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIHUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMIHUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIHUL",23,0)
 ;@license see routine SAMIUL
"RTN","SAMIHUL",24,0)
 ;
"RTN","SAMIHUL",25,0)
 ;@last-update 2021-10-29t02:34z
"RTN","SAMIHUL",26,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIHUL",27,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIHUL",28,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIHUL",29,0)
 ;@version 18-15
"RTN","SAMIHUL",30,0)
 ;@release-date 2020-01
"RTN","SAMIHUL",31,0)
 ;@patch-list **9,12,15,16**
"RTN","SAMIHUL",32,0)
 ;
"RTN","SAMIHUL",33,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIHUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMIHUL",35,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIHUL",36,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIHUL",37,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIHUL",38,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIHUL",39,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIHUL",40,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIHUL",41,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIHUL",42,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIHUL",43,0)
 ;@dev-add Domenick DiNatale (ddn)
"RTN","SAMIHUL",44,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMIHUL",45,0)
 ;
"RTN","SAMIHUL",46,0)
 ;@module-credits
"RTN","SAMIHUL",47,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIHUL",48,0)
 ; (VA-PALS)
"RTN","SAMIHUL",49,0)
 ; http://va-pals.org/
"RTN","SAMIHUL",50,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIHUL",51,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIHUL",52,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIHUL",53,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIHUL",54,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIHUL",55,0)
 ; http://ielcap.com/
"RTN","SAMIHUL",56,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIHUL",57,0)
 ; http://paraxialtech.com/
"RTN","SAMIHUL",58,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIHUL",59,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIHUL",60,0)
 ;
"RTN","SAMIHUL",61,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIHUL",62,0)
 ;
"RTN","SAMIHUL",63,0)
 ; 2018-01-13 ven/gpl 18.0-t4
"RTN","SAMIHUL",64,0)
 ;  SAMIHOM3 create routine from SAMIFRM to implement ELCAP Home Page.
"RTN","SAMIHUL",65,0)
 ;
"RTN","SAMIHUL",66,0)
 ; 2018-02-05 ven/toad 18.0-t4
"RTN","SAMIHUL",67,0)
 ;  SAMIHOM3 update license & attribution & hdr comments, add white
"RTN","SAMIHUL",68,0)
 ; space & do-dot quits, spell out language elements.
"RTN","SAMIHUL",69,0)
 ;
"RTN","SAMIHUL",70,0)
 ; 2018-02-27 ven/gpl 18.0-t4
"RTN","SAMIHUL",71,0)
 ;  SAMIHOM3 new subroutines PREFIX,GETHOME,SCANFOR,WSNEWCAS,PREFILL,
"RTN","SAMIHUL",72,0)
 ; MKSBFORM,MKSIFORM,VALDTNM,SID2NUM,KEYDATE,GENSTDID,NEXTNUM to
"RTN","SAMIHUL",73,0)
 ; support creation of new cases.
"RTN","SAMIHUL",74,0)
 ;
"RTN","SAMIHUL",75,0)
 ; 2018-03-01 ven/toad 18.0-t4
"RTN","SAMIHUL",76,0)
 ;  SAMIHOM3 refactor & reorganize new code, add hdr comments,
"RTN","SAMIHUL",77,0)
 ; r/findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMIHUL",78,0)
 ;
"RTN","SAMIHUL",79,0)
 ; 2018-03-06 ven/gpl 18.0-t4
"RTN","SAMIHUL",80,0)
 ;  SAMIHOM3 ?
"RTN","SAMIHUL",81,0)
 ;
"RTN","SAMIHUL",82,0)
 ; 2018-03-07 ven/toad 18.0-t4
"RTN","SAMIHUL",83,0)
 ;  SAMIHOM3 in $$SID2NUM add WSNUFORM^SAMICASE to called-by; in
"RTN","SAMIHUL",84,0)
 ; keyDate,GETHOME update called-by.
"RTN","SAMIHUL",85,0)
 ;
"RTN","SAMIHUL",86,0)
 ; 2018-05-18/25 ven/lgc&arc 18.0-t4 76020fd,81b1048,65afd99
"RTN","SAMIHUL",87,0)
 ;  SAMIHOM3 new SAMIHOM3 for new patient search page, chg submit
"RTN","SAMIHUL",88,0)
 ; processing on forms, fix bug in postform.
"RTN","SAMIHUL",89,0)
 ;
"RTN","SAMIHUL",90,0)
 ; 2018-06-14/07-10 ven/lgc&arc 18.0-t4 d71f4fe,8b0a432,ce345db,
"RTN","SAMIHUL",91,0)
 ; 402b6a8,14f991d,2e9662b
"RTN","SAMIHUL",92,0)
 ;  SAMIHOM3 make background form optional; 1st version of CT Eval
"RTN","SAMIHUL",93,0)
 ; Report; reorg ctreport routines & 1st crack at impressions &
"RTN","SAMIHUL",94,0)
 ; recommendations; note produced for intake form on submit; add
"RTN","SAMIHUL",95,0)
 ; support for routing by patient in CPRS Tools Menu, modify
"RTN","SAMIHUL",96,0)
 ; wsHOME^SAMIHOM3 to properly route VA-PALS web app when launced via
"RTN","SAMIHUL",97,0)
 ; CPRS Tools Menu; repair SAMIHOM3 & redact report link.
"RTN","SAMIHUL",98,0)
 ;
"RTN","SAMIHUL",99,0)
 ; 2018-08-22 ven/gpl 18.0-t4 6e696a9
"RTN","SAMIHUL",100,0)
 ;  SAMIHOM3 add PTINFO call to vista to pull ssn.
"RTN","SAMIHUL",101,0)
 ;
"RTN","SAMIHUL",102,0)
 ; 2018-09-30/11-01 ven/lgc&arc 18.0-t4 d93c640,482f522,a8e4226,
"RTN","SAMIHUL",103,0)
 ; ee5e8a1
"RTN","SAMIHUL",104,0)
 ;  SAMIHOM3 hdr & prefill of intake; new input form features, report
"RTN","SAMIHUL",105,0)
 ; menu fix; set urban/rural status at siform setup; handle zip code
"RTN","SAMIHUL",106,0)
 ; unknown.
"RTN","SAMIHUL",107,0)
 ;
"RTN","SAMIHUL",108,0)
 ; 2018-11-09/2019-01-22 ven/lgc&arc&lmry 18.0-t4 bac4f73,5400035,
"RTN","SAMIHUL",109,0)
 ; dd341e0,a953946,e2a44e6,2356c2b,3ceb74b,3088307,4271b46,7a5d340,
"RTN","SAMIHUL",110,0)
 ; dfbb0bc,fd1bcee,8dd6f34,51eb163,dbdb5a4,0880027,ccba017,5368121
"RTN","SAMIHUL",111,0)
 ;  SAMIHOM3 unit tests, annotation, sac compliance, XINDEX bugs, fix
"RTN","SAMIHUL",112,0)
 ; accidental reversions, add license info.
"RTN","SAMIHUL",113,0)
 ;
"RTN","SAMIHUL",114,0)
 ; 2018-12-18/20 ven/arc 18.0-t4 3088307f,4271b46b,dfbb0bca,
"RTN","SAMIHUL",115,0)
 ;  b8ff6da9,fd1bceee
"RTN","SAMIHUL",116,0)
 ;  SAMIHOM4 va sac compliance & variable namespacing.
"RTN","SAMIHUL",117,0)
 ;
"RTN","SAMIHUL",118,0)
 ; 2019-01-01/02-18 ven/lgc 18.0-t4 0880027c,18aa0fec,fcd635c1,
"RTN","SAMIHUL",119,0)
 ;  53681219,76874314
"RTN","SAMIHUL",120,0)
 ;  SAMIHOM3 update w/ recent changes.
"RTN","SAMIHUL",121,0)
 ;  SAMIHOM4 updates for va sac & code coverage, add license info.
"RTN","SAMIHUL",122,0)
 ;
"RTN","SAMIHUL",123,0)
 ; 2019-04-15 ven/gpl 18.0-t4 b403bf01
"RTN","SAMIHUL",124,0)
 ;  SAMIHOM4 support for new intake notes.
"RTN","SAMIHUL",125,0)
 ;
"RTN","SAMIHUL",126,0)
 ; 2019-04-16 ven/lgc 18.0-t4 e54b76d1
"RTN","SAMIHUL",127,0)
 ;  SAMIHOM4 update for SAMIFORM project.
"RTN","SAMIHUL",128,0)
 ;
"RTN","SAMIHUL",129,0)
 ; 2019-04-17 ven/gpl 18.0-t4 7d1f86db
"RTN","SAMIHUL",130,0)
 ;  SAMIHOM3 prefill date on intake prelim discussion section.
"RTN","SAMIHUL",131,0)
 ;
"RTN","SAMIHUL",132,0)
 ; 2019-06-18 ven/arc 18.0-t4 91022482
"RTN","SAMIHUL",133,0)
 ;  SAMIHOM4 switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMIHUL",134,0)
 ;
"RTN","SAMIHUL",135,0)
 ; 2019-08-05 ven/gpl 18.0-t4 9c0c2ed3
"RTN","SAMIHUL",136,0)
 ;  SAMIHOM3 add GETPRFX to get right prefix at registration.
"RTN","SAMIHUL",137,0)
 ;
"RTN","SAMIHUL",138,0)
 ; 2019-08-07 ven/lgc&arc 18.0-t4 603194b9,37967fc5
"RTN","SAMIHUL",139,0)
 ;  SAMIHOM3 consolidate calls to retrieve facility prefix.
"RTN","SAMIHUL",140,0)
 ;
"RTN","SAMIHUL",141,0)
 ; 2019-11-22 par/ddn 18.0-t4 b2cc389d vap-458
"RTN","SAMIHUL",142,0)
 ;  SAMIHOM4 manual registration.
"RTN","SAMIHUL",143,0)
 ;
"RTN","SAMIHUL",144,0)
 ; 2020-01-01/05 ven/lgc 18.0-t4 c169f4b1,5928064a,62e3200f
"RTN","SAMIHUL",145,0)
 ;  SAMIHOM4 support for unmatched patient processing, more changes
"RTN","SAMIHUL",146,0)
 ; for participant matching, unmatched participant processing ready
"RTN","SAMIHUL",147,0)
 ; for testing.
"RTN","SAMIHUL",148,0)
 ;
"RTN","SAMIHUL",149,0)
 ; 2020-01-08/10 ven/gpl 18.0 a002f850,47dfe3cd
"RTN","SAMIHUL",150,0)
 ;  SAMIHOM4 bug fix for unmatched processing, turn off & on manual
"RTN","SAMIHUL",151,0)
 ; registration link on home page.
"RTN","SAMIHUL",152,0)
 ;
"RTN","SAMIHUL",153,0)
 ; 2020-01-10 ven/gpl 18.0 4c8e6ebc,76b465cb
"RTN","SAMIHUL",154,0)
 ;  SAMIHOM4 3 quits with returns for cache.
"RTN","SAMIHUL",155,0)
 ;
"RTN","SAMIHUL",156,0)
 ; 2020-01-16 ven/lgc 18.0 0a2af965
"RTN","SAMIHUL",157,0)
 ;  SAMIHOM4 bulk commit due to switch to cache.
"RTN","SAMIHUL",158,0)
 ;
"RTN","SAMIHUL",159,0)
 ; 2020-01-17/20 ven/lgc 18.1 8557207f,dc5f618c
"RTN","SAMIHUL",160,0)
 ;  SAMIHOM4 followup note, limit to one note per followup form.
"RTN","SAMIHUL",161,0)
 ;
"RTN","SAMIHUL",162,0)
 ; 2020-02-01/02 ven/lgc 18.4 3065146d,36ae0ed1
"RTN","SAMIHUL",163,0)
 ;  SAMIHOM4 set options for text based ctreport, switch default
"RTN","SAMIHUL",164,0)
 ; ctreport to text.
"RTN","SAMIHUL",165,0)
 ;
"RTN","SAMIHUL",166,0)
 ; 2020-04-02/11 ven/gpl 18.5 d36b7cad,36607664,befde317,56bfaed6,
"RTN","SAMIHUL",167,0)
 ; 666f5b91,2f2c29c1
"RTN","SAMIHUL",168,0)
 ;  SAMIHOM3 multitenancy; in GENSTDID add ARG param, determin prefix
"RTN","SAMIHUL",169,0)
 ; from site or siteid (ARG) instead of calling $$GETPRFX^SAMIFORM.
"RTN","SAMIHUL",170,0)
 ;  SAMIHOM4 multitenancy + fix bug in WSVAPALS.
"RTN","SAMIHUL",171,0)
 ;
"RTN","SAMIHUL",172,0)
 ; 2020-04-18/05-07 ven/gpl 18.5 29d7dba7,d55de214,521e0bdc,d018f52e,
"RTN","SAMIHUL",173,0)
 ; 476b2ff4,61c7d208
"RTN","SAMIHUL",174,0)
 ;  SAMIHOM4 fix bug & weird error in manual registration, fix bug in
"RTN","SAMIHUL",175,0)
 ; logout, logout working, superuser site selection, worklist
"RTN","SAMIHUL",176,0)
 ; functionality.
"RTN","SAMIHUL",177,0)
 ;
"RTN","SAMIHUL",178,0)
 ; 2020-08-06 ven/gpl 18.6 781744c3
"RTN","SAMIHUL",179,0)
 ;  SAMIHOM4 changes to support hl7 transmission of notes.
"RTN","SAMIHUL",180,0)
 ;
"RTN","SAMIHUL",181,0)
 ; 2020-09-22 ven/gpl 18.9 06459eda
"RTN","SAMIHUL",182,0)
 ;  SAMIHOM4 correct to match kids file.
"RTN","SAMIHUL",183,0)
 ;
"RTN","SAMIHUL",184,0)
 ; 2021-03-02 ven/gpl 18.9 479dc041
"RTN","SAMIHUL",185,0)
 ;  SAMIHOM4 return error message if no ct eval form exists when
"RTN","SAMIHUL",186,0)
 ; generating a fu note.
"RTN","SAMIHUL",187,0)
 ;
"RTN","SAMIHUL",188,0)
 ; 2021-03-11 ven/toad 18.9 a46a2cc1
"RTN","SAMIHUL",189,0)
 ;  SAMIHUL create routine.
"RTN","SAMIHUL",190,0)
 ;  SAMIHOM4 bump date & patch list, add contents, lt refactor.
"RTN","SAMIHUL",191,0)
 ;
"RTN","SAMIHUL",192,0)
 ; 2021-03-17 ven/toad 18.9
"RTN","SAMIHUL",193,0)
 ;  SAMIHOM4 remove blank from end of 1 line.
"RTN","SAMIHUL",194,0)
 ;
"RTN","SAMIHUL",195,0)
 ; 2021-05-29 ven/gpl 18.12-t2 59ea0811
"RTN","SAMIHUL",196,0)
 ;  SAMIHOM3 in SID2NUM look up by pien instead of relying on sid
"RTN","SAMIHUL",197,0)
 ; containing pien.
"RTN","SAMIHUL",198,0)
 ;
"RTN","SAMIHUL",199,0)
 ; 2021-06-15 ven/gpl 18.12-t2 e247ea59
"RTN","SAMIHUL",200,0)
 ;  SAMIHOM4 eliminate icn.
"RTN","SAMIHUL",201,0)
 ;
"RTN","SAMIHUL",202,0)
 ; 2021-06-15/16 ven/mcglk&toad 18.12-t2 cbf7e46b,fa794d60
"RTN","SAMIHUL",203,0)
 ;  SAMIHOM3 move log to SAMIHUL, bump dates & versions, annotate,
"RTN","SAMIHUL",204,0)
 ; reorg, lt refactor.
"RTN","SAMIHUL",205,0)
 ;  SAMIHOM4 bump dates & versions; begin annotate, reorg, lt refactor
"RTN","SAMIHUL",206,0)
 ; but interrupted by addition of critical fix to patch & bronchitis,
"RTN","SAMIHUL",207,0)
 ; so leave refactor unfinished (but stable as far as it went).
"RTN","SAMIHUL",208,0)
 ;  SAMIUTH3 bump dates & versions, lt refactor, add COVER, in UTSCAN4
"RTN","SAMIHUL",209,0)
 ; fix $random bug, but after discovering the SAMI test suite is so
"RTN","SAMIHUL",210,0)
 ; far out of date that it fails catastrophically with thousands of
"RTN","SAMIHUL",211,0)
 ; errors, back out changes and leave as it was.
"RTN","SAMIHUL",212,0)
 ;
"RTN","SAMIHUL",213,0)
 ; 2021-08-01 ven/gpl 18.12 5bd7c627
"RTN","SAMIHUL",214,0)
 ;  SAMIHOM3 set intake form to incomplete on creation: in MKSIFORM
"RTN","SAMIHUL",215,0)
 ; r/complete w/incomplete.
"RTN","SAMIHUL",216,0)
 ;
"RTN","SAMIHUL",217,0)
 ; 2021-09-20/23 ven/gpl 18-x-16 db1b173a,465b009d
"RTN","SAMIHUL",218,0)
 ;  SAMIHOM4 (with new routine SAMIZPH1) developed to import data from 
"RTN","SAMIHUL",219,0)
 ;  Philadelphia VA's previous LCS database in Red Cap, bump dates & versions.
"RTN","SAMIHUL",220,0)
 ;
"RTN","SAMIHUL",221,0)
 ; 2021-9-24 ven/lmry 18-16 465b009d
"RTN","SAMIHUL",222,0)
 ;  SAMIHOM4 bumped versions and dates
"RTN","SAMIHUL",223,0)
 ;
"RTN","SAMIHUL",224,0)
 ; 2021-10-19 ven/gpl 18-15 138d45e5
"RTN","SAMIHUL",225,0)
 ;  SAMIHOM4 parameterize veteran vs participant or candidate for notes
"RTN","SAMIHUL",226,0)
 ;
"RTN","SAMIHUL",227,0)
 ; 2021-10-29 ven/lmry 18-15
"RTN","SAMIHUL",228,0)
 ;  SAMIHOM4 and SAMIHUL bumped versions and dates
"RTN","SAMIHUL",229,0)
 ;
"RTN","SAMIHUL",230,0)
 ;@contents
"RTN","SAMIHUL",231,0)
 ; SAMIHOM3 homepage interface library
"RTN","SAMIHUL",232,0)
 ; SAMIHOM4 homepage subroutines
"RTN","SAMIHUL",233,0)
 ; SAMIHUL homepage development log
"RTN","SAMIHUL",234,0)
 ; SAMIUTH3 tests for SAMIHOM3
"RTN","SAMIHUL",235,0)
 ; SAMIUTH4 tests for SAMIHOM4
"RTN","SAMIHUL",236,0)
 ;
"RTN","SAMIHUL",237,0)
 ;
"RTN","SAMIHUL",238,0)
 ;
"RTN","SAMIHUL",239,0)
EOR ; end of routine SAMIHUL
"RTN","SAMIMOV")
0^10^B53328513
"RTN","SAMIMOV",1,0)
SAMIMOV ;ven/gpl - VAPALS CHANGE PATIENT SITE ; 2021-10-29t23:29z
"RTN","SAMIMOV",2,0)
 ;;18.0;SAMI;**7,15**;;Build 2
"RTN","SAMIMOV",3,0)
 ;;18-15
"RTN","SAMIMOV",4,0)
 ;
"RTN","SAMIMOV",5,0)
 ;@license: see routine SAMIUL
"RTN","SAMIMOV",6,0)
 ;
"RTN","SAMIMOV",7,0)
 ; allow fallthrough
"RTN","SAMIMOV",8,0)
 ;
"RTN","SAMIMOV",9,0)
 ;
"RTN","SAMIMOV",10,0)
 ;@section 0 primary development
"RTN","SAMIMOV",11,0)
 ;
"RTN","SAMIMOV",12,0)
 ;
"RTN","SAMIMOV",13,0)
 ;
"RTN","SAMIMOV",14,0)
 ;@routine-credits
"RTN","SAMIMOV",15,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIMOV",16,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIMOV",17,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIMOV",18,0)
 ; http://vistaexpertise.net
"RTN","SAMIMOV",19,0)
 ;@copyright 2021, gpl, all rights reserved
"RTN","SAMIMOV",20,0)
 ;@license see routine SAMIUL
"RTN","SAMIMOV",21,0)
 ;
"RTN","SAMIMOV",22,0)
 ;@last-update 2021-10-29t23:29z
"RTN","SAMIMOV",23,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIMOV",24,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIMOV",25,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIMOV",26,0)
 ;@version 18.15
"RTN","SAMIMOV",27,0)
 ;@release-date 2020-01
"RTN","SAMIMOV",28,0)
 ;@patch-list **7,15**
"RTN","SAMIMOV",29,0)
 ;
"RTN","SAMIMOV",30,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIMOV",31,0)
 ; toad@vistaexpertise.net
"RTN","SAMIMOV",32,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIMOV",33,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIMOV",34,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIMOV",35,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIMOV",36,0)
 ;
"RTN","SAMIMOV",37,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIMOV",38,0)
 ; 2020-08-24 ven/gpl 18-7 915b85e6
"RTN","SAMIMOV",39,0)
 ;  SAMIMOV create utility to change patient site
"RTN","SAMIMOV",40,0)
 ; 2020-09-03 ven/gpl 5ae08772
"RTN","SAMIMOV",41,0)
 ;  SAMIMOV upgrade CHANGE SITE to handle patients without forms ... also
"RTN","SAMIMOV",42,0)
 ;  AUDIT report
"RTN","SAMIMOV",43,0)
 ; 2020-09-07 ven/gpl 498e57d5
"RTN","SAMIMOV",44,0)
 ;  SAMIMOV tweeking the audit report
"RTN","SAMIMOV",45,0)
 ; 2020-12-11 ven/gpl 92138cdb
"RTN","SAMIMOV",46,0)
 ; 2021-10-26 ven/gpl 18-15 d12b1b10
"RTN","SAMIMOV",47,0)
 ;  SAMIMOV parameter detection routine for identifying VA systems
"RTN","SAMIMOV",48,0)
 ; 2021-10-29 ven/lmry 18-15
"RTN","SAMIMOV",49,0)
 ;  SAMIMOV insert section 0, bump versions and dates, added semicolon after
"RTN","SAMIMOV",50,0)
 ;  PICSITE for XINDEX
"RTN","SAMIMOV",51,0)
 ;
"RTN","SAMIMOV",52,0)
 ;@contents
"RTN","SAMIMOV",53,0)
 ; EN entry point to change a patient's site
"RTN","SAMIMOV",54,0)
 ; MOV change patient PAT from site FROM to site TO 
"RTN","SAMIMOV",55,0)
 ; SETSID propogate the new sid to all forms
"RTN","SAMIMOV",56,0)
 ; PICPAT pick a patient in site SITE
"RTN","SAMIMOV",57,0)
 ; PICSITE()
"RTN","SAMIMOV",58,0)
 ; AUDIT()
"RTN","SAMIMOV",59,0)
 ; outaudit(rpt,ln)
"RTN","SAMIMOV",60,0)
 ; 
"RTN","SAMIMOV",61,0)
 ;
"RTN","SAMIMOV",62,0)
 ;
"RTN","SAMIMOV",63,0)
 ;
"RTN","SAMIMOV",64,0)
 ;@section 1 subroutines
"RTN","SAMIMOV",65,0)
 ;
"RTN","SAMIMOV",66,0)
EN ; entry point to change a patient's site
"RTN","SAMIMOV",67,0)
 ;
"RTN","SAMIMOV",68,0)
 n FROM,TO,PAT
"RTN","SAMIMOV",69,0)
 W !,"Pick the FROM Site -"
"RTN","SAMIMOV",70,0)
 S FROM=$$PICSITE()
"RTN","SAMIMOV",71,0)
 IF FROM="^" Q  ;
"RTN","SAMIMOV",72,0)
 ;
"RTN","SAMIMOV",73,0)
 W !,"Pick the TO Site -"
"RTN","SAMIMOV",74,0)
 S TO=$$PICSITE()
"RTN","SAMIMOV",75,0)
 IF TO="^" Q  ;
"RTN","SAMIMOV",76,0)
 ;
"RTN","SAMIMOV",77,0)
 D PICPAT(.PAT,FROM)
"RTN","SAMIMOV",78,0)
 I $G(PAT("name"))="" D  Q  ;
"RTN","SAMIMOV",79,0)
 . W !,"No patient selected, canceling"
"RTN","SAMIMOV",80,0)
 K DIR
"RTN","SAMIMOV",81,0)
 S DIR("A")="Confirm change site of patient "_PAT("name")_" from "_FROM_" to "_TO
"RTN","SAMIMOV",82,0)
 S DIR(0)="Y"
"RTN","SAMIMOV",83,0)
 D ^DIR
"RTN","SAMIMOV",84,0)
 ;
"RTN","SAMIMOV",85,0)
 I Y'=1 D  Q  ;
"RTN","SAMIMOV",86,0)
 . W !,"Cancel, no change made"
"RTN","SAMIMOV",87,0)
 ;
"RTN","SAMIMOV",88,0)
 do MOV(.PAT,FROM,TO)
"RTN","SAMIMOV",89,0)
 q
"RTN","SAMIMOV",90,0)
 ;
"RTN","SAMIMOV",91,0)
MOV(PAT,FROM,TO) ; change patient PAT from site FROM to site TO
"RTN","SAMIMOV",92,0)
 ;
"RTN","SAMIMOV",93,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIMOV",94,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIMOV",95,0)
 n dfn s dfn=$g(PAT("dfn"))
"RTN","SAMIMOV",96,0)
 i dfn="" d  q  ;
"RTN","SAMIMOV",97,0)
 . w !,"Error, patient not valid"
"RTN","SAMIMOV",98,0)
 n lien
"RTN","SAMIMOV",99,0)
 s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIMOV",100,0)
 i $g(@lroot@(lien,"siteid"))'=FROM d  q  ;
"RTN","SAMIMOV",101,0)
 . w !,"Error, from site not valid for patient"
"RTN","SAMIMOV",102,0)
 ;
"RTN","SAMIMOV",103,0)
 n pien s pien=$o(@root@("dfn",dfn,""))
"RTN","SAMIMOV",104,0)
 i pien="" d  q  ;
"RTN","SAMIMOV",105,0)
 . w !,"Patient has no forms"
"RTN","SAMIMOV",106,0)
 . s @lroot@(lien,"siteid")=TO
"RTN","SAMIMOV",107,0)
 . w !,"Change successful"
"RTN","SAMIMOV",108,0)
 ;
"RTN","SAMIMOV",109,0)
 n oldsid s oldsid=$g(@root@(pien,"studyid"))
"RTN","SAMIMOV",110,0)
 i oldsid="" s oldsid=$g(@root@(pien,"samistudyid"))
"RTN","SAMIMOV",111,0)
 w !,"oldsid=",oldsid
"RTN","SAMIMOV",112,0)
 i oldsid="" d  q  ;
"RTN","SAMIMOV",113,0)
 . w !,"Error studyid not found"
"RTN","SAMIMOV",114,0)
 ;b
"RTN","SAMIMOV",115,0)
 s @lroot@(lien,"siteid")=TO
"RTN","SAMIMOV",116,0)
 s PAT("siteid")=TO
"RTN","SAMIMOV",117,0)
 k @root@("sid",oldsid,pien) ; remove sid index
"RTN","SAMIMOV",118,0)
 ;
"RTN","SAMIMOV",119,0)
 n newsid s newsid=$$GENSTDID^SAMIHOM3(dfn,.PAT)
"RTN","SAMIMOV",120,0)
 s @lroot@(lien,"studyid")=newsid
"RTN","SAMIMOV",121,0)
 s @root@(pien,"studyid")=newsid
"RTN","SAMIMOV",122,0)
 s @root@(pien,"sisid")=newsid
"RTN","SAMIMOV",123,0)
 s @root@(pien,"samistudyid")=newsid
"RTN","SAMIMOV",124,0)
 s @root@("sid",newsid,pien)=""
"RTN","SAMIMOV",125,0)
 ;
"RTN","SAMIMOV",126,0)
 w !,"New studyid = "_newsid
"RTN","SAMIMOV",127,0)
 m @root@("graph",newsid)=@root@("graph",oldsid)
"RTN","SAMIMOV",128,0)
 d SETSID(newsid) ;propogate the new sid to all forms
"RTN","SAMIMOV",129,0)
 k @root@("graph",oldsid)
"RTN","SAMIMOV",130,0)
 w !,"Change successful"
"RTN","SAMIMOV",131,0)
 ;
"RTN","SAMIMOV",132,0)
 q
"RTN","SAMIMOV",133,0)
 ;
"RTN","SAMIMOV",134,0)
SETSID(newsid) ; propogate the new sid to all forms
"RTN","SAMIMOV",135,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIMOV",136,0)
 n zi s zi=""
"RTN","SAMIMOV",137,0)
 f  s zi=$o(@root@("graph",newsid,zi)) q:zi=""  d  ;
"RTN","SAMIMOV",138,0)
 . s @root@("graph",newsid,zi,"samistudyid")=newsid
"RTN","SAMIMOV",139,0)
 . s @root@("graph",newsid,zi,"studyid")=newsid
"RTN","SAMIMOV",140,0)
 . s @root@("graph",newsid,zi,"sisid")=newsid
"RTN","SAMIMOV",141,0)
 q
"RTN","SAMIMOV",142,0)
 ;
"RTN","SAMIMOV",143,0)
PICPAT(PATRTN,SITE) ; pick a patient in site SITE
"RTN","SAMIMOV",144,0)
 ;
"RTN","SAMIMOV",145,0)
 N FILTER,LIST,X,Y
"RTN","SAMIMOV",146,0)
 I $G(SITE)="" S SITE="*"
"RTN","SAMIMOV",147,0)
 S FILTER("site")=$G(SITE)
"RTN","SAMIMOV",148,0)
 S FILTER("format")="array"
"RTN","SAMIMOV",149,0)
 ;
"RTN","SAMIMOV",150,0)
 new DIR set DIR(0)="F^1:120" ; free text
"RTN","SAMIMOV",151,0)
 set DIR("A")="Patient name: " ; prompt
"RTN","SAMIMOV",152,0)
 set DIR("B")="""" ; default
"RTN","SAMIMOV",153,0)
 ;
"RTN","SAMIMOV",154,0)
 d ^DIR
"RTN","SAMIMOV",155,0)
 ;
"RTN","SAMIMOV",156,0)
 S FILTER("search")=Y
"RTN","SAMIMOV",157,0)
 D WSPTLKUP^SAMIPTLK(.LIST,.FILTER)
"RTN","SAMIMOV",158,0)
 ;ZWR LIST(:,:,"name")
"RTN","SAMIMOV",159,0)
 ;
"RTN","SAMIMOV",160,0)
 N LCNT S LCNT=$O(LIST("result",""),-1)
"RTN","SAMIMOV",161,0)
 Q:+LCNT=0
"RTN","SAMIMOV",162,0)
 S Y=1
"RTN","SAMIMOV",163,0)
 I LCNT>1 D  ; more than one in the list
"RTN","SAMIMOV",164,0)
 . K DIR
"RTN","SAMIMOV",165,0)
 . N ZI S ZI=0
"RTN","SAMIMOV",166,0)
 . S DIR("A")="Select the patient"
"RTN","SAMIMOV",167,0)
 . F  S ZI=$O(LIST("result",ZI)) Q:+ZI=0  D  ;
"RTN","SAMIMOV",168,0)
 . . S DIR("A",ZI)=ZI_" "_LIST("result",ZI,"name")_" "_LIST("result",ZI,"last5")
"RTN","SAMIMOV",169,0)
 . S DIR(0)="N^1:"_LCNT_":0"
"RTN","SAMIMOV",170,0)
 . D ^DIR
"RTN","SAMIMOV",171,0)
 . ;W !,"Y=",Y
"RTN","SAMIMOV",172,0)
 I +Y>0 M PATRTN=LIST("result",Y)
"RTN","SAMIMOV",173,0)
 q
"RTN","SAMIMOV",174,0)
 ;
"RTN","SAMIMOV",175,0)
PICSITE()  ;
"RTN","SAMIMOV",176,0)
 ;
"RTN","SAMIMOV",177,0)
 ; pick a site
"RTN","SAMIMOV",178,0)
 N X,Y,DIC,SITEIEN,SITEID
"RTN","SAMIMOV",179,0)
 S DIC=311.12
"RTN","SAMIMOV",180,0)
 S DIC(0)="AEMQ"
"RTN","SAMIMOV",181,0)
 D ^DIC
"RTN","SAMIMOV",182,0)
 I Y<1 Q  ; EXIT
"RTN","SAMIMOV",183,0)
 S SITENUM=$P(Y,"^",2)
"RTN","SAMIMOV",184,0)
 S SITEID=$$SITEID^SAMISITE(SITENUM)
"RTN","SAMIMOV",185,0)
 Q SITEID
"RTN","SAMIMOV",186,0)
 ;
"RTN","SAMIMOV",187,0)
AUDIT() ;
"RTN","SAMIMOV",188,0)
 ;
"RTN","SAMIMOV",189,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIMOV",190,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIMOV",191,0)
 n rpt s rpt=$na(^TMP("SAMIAUDIT",$J))
"RTN","SAMIMOV",192,0)
 k @rpt
"RTN","SAMIMOV",193,0)
 d outaudit(rpt,"cdate NAME  lien  dfn site  PNAME  pien  pdfn sid")
"RTN","SAMIMOV",194,0)
 n ln,lname,lien,cdate,pname,pien,ldfn,pdfn,site,sid
"RTN","SAMIMOV",195,0)
 s (ln,lname,lien,site,cdate,pname,pien,ldfn,pdfn,sid)=""
"RTN","SAMIMOV",196,0)
 n zi s zi=" "
"RTN","SAMIMOV",197,0)
 f  s zi=$o(@lroot@(zi),-1) q:+zi=0  d  ;
"RTN","SAMIMOV",198,0)
 . s lien=zi
"RTN","SAMIMOV",199,0)
 . s site=$g(@lroot@(zi,"siteid"))
"RTN","SAMIMOV",200,0)
 . s lname=$g(@lroot@(zi,"saminame"))
"RTN","SAMIMOV",201,0)
 . s ldfn=$g(@lroot@(zi,"dfn"))
"RTN","SAMIMOV",202,0)
 . i ldfn="" d  q  ;
"RTN","SAMIMOV",203,0)
 . . ;d ^ZTER
"RTN","SAMIMOV",204,0)
 . . w !,"error ",zi
"RTN","SAMIMOV",205,0)
 . . s ln="error, missing dfn lien="_lien
"RTN","SAMIMOV",206,0)
 . . s ln=ln_" "_$g(@lroot@(zi,"saminame"))
"RTN","SAMIMOV",207,0)
 . . d outaudit(rpt,ln)
"RTN","SAMIMOV",208,0)
 . . s ln=""
"RTN","SAMIMOV",209,0)
 . i $o(@lroot@("dfn",ldfn,""))'=lien d  ;
"RTN","SAMIMOV",210,0)
 . . w !,"error in dfn index dfn="_ldfn_" lien="_lien
"RTN","SAMIMOV",211,0)
 . s pien=$o(@proot@("dfn",ldfn,""))
"RTN","SAMIMOV",212,0)
 . i +pien'=0 d  ;
"RTN","SAMIMOV",213,0)
 . . s cdate=$g(@proot@(pien,"samicreatedate"))
"RTN","SAMIMOV",214,0)
 . . s pname=$g(@proot@(pien,"saminame"))
"RTN","SAMIMOV",215,0)
 . . s pdfn=$g(@proot@(pien,"dfn"))
"RTN","SAMIMOV",216,0)
 . . s sid=$g(@proot@(pien,"samistudyid"))
"RTN","SAMIMOV",217,0)
 . s ln=ln_$g(cdate)_" "
"RTN","SAMIMOV",218,0)
 . s ln=ln_$e(lname,1,20)_"  "
"RTN","SAMIMOV",219,0)
 . s ln=ln_$J(lien,5)
"RTN","SAMIMOV",220,0)
 . s ln=ln_$j(ldfn,8)
"RTN","SAMIMOV",221,0)
 . s ln=ln_" "_site_" "
"RTN","SAMIMOV",222,0)
 . s ln=ln_" "_$e(pname,1,20)_" "
"RTN","SAMIMOV",223,0)
 . s ln=ln_$j(pien,5)
"RTN","SAMIMOV",224,0)
 . i pien="" s ln=ln_"Not Enrolled"
"RTN","SAMIMOV",225,0)
 . s ln=ln_$j(pdfn,8)
"RTN","SAMIMOV",226,0)
 . s ln=ln_" "_sid
"RTN","SAMIMOV",227,0)
 . d outaudit(rpt,ln)
"RTN","SAMIMOV",228,0)
 . s (ln,lname,lien,site,cdate,pname,pien,ldfn,pdfn,sid)=""
"RTN","SAMIMOV",229,0)
 ;B
"RTN","SAMIMOV",230,0)
 D BROWSE^DDBR(rpt,"N","audit")
"RTN","SAMIMOV",231,0)
 ;
"RTN","SAMIMOV",232,0)
 q
"RTN","SAMIMOV",233,0)
 ;
"RTN","SAMIMOV",234,0)
outaudit(rpt,ln) ;
"RTN","SAMIMOV",235,0)
 s @rpt@($o(@rpt@(" "),-1)+1)=$g(ln)
"RTN","SAMIMOV",236,0)
 ;w !,ln
"RTN","SAMIMOV",237,0)
 q
"RTN","SAMIMOV",238,0)
 ;
"RTN","SAMINOT1")
0^11^B553022339
"RTN","SAMINOT1",1,0)
SAMINOT1 ;ven/gpl - text notes ;2021-10-29t20:26z
"RTN","SAMINOT1",2,0)
 ;;18.0;SAMI;**2,6,8,10,11,12,15**;2020-01;Build 2
"RTN","SAMINOT1",3,0)
 ;;18-15
"RTN","SAMINOT1",4,0)
 ;
"RTN","SAMINOT1",5,0)
 ; SAMINOT1 contains a web service & associated subroutines to produce
"RTN","SAMINOT1",6,0)
 ; VAPALS-ELCAP text notes.
"RTN","SAMINOT1",7,0)
 ;
"RTN","SAMINOT1",8,0)
 quit  ; no entry from top
"RTN","SAMINOT1",9,0)
 ;
"RTN","SAMINOT1",10,0)
 ;
"RTN","SAMINOT1",11,0)
 ;
"RTN","SAMINOT1",12,0)
 ;@section 0 primary development
"RTN","SAMINOT1",13,0)
 ;
"RTN","SAMINOT1",14,0)
 ;
"RTN","SAMINOT1",15,0)
 ;
"RTN","SAMINOT1",16,0)
 ;@routine-credits
"RTN","SAMINOT1",17,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMINOT1",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMINOT1",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMINOT1",20,0)
 ; http://vistaexpertise.net
"RTN","SAMINOT1",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMINOT1",22,0)
 ;@license see routine SAMIUL
"RTN","SAMINOT1",23,0)
 ;
"RTN","SAMINOT1",24,0)
 ;@last-update 2021-07-01t17:21z
"RTN","SAMINOT1",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMINOT1",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMINOT1",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMINOT1",28,0)
 ;@version 18-15
"RTN","SAMINOT1",29,0)
 ;@release-date 2020-01
"RTN","SAMINOT1",30,0)
 ;@patch-list **2,6,8,10,11,12,15**
"RTN","SAMINOT1",31,0)
 ;
"RTN","SAMINOT1",32,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMINOT1",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMINOT1",34,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMINOT1",35,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMINOT1",36,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMINOT1",37,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMINOT1",38,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMINOT1",39,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMINOT1",40,0)
 ;@dev-add Domenic DiNatale (dom)
"RTN","SAMINOT1",41,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMINOT1",42,0)
 ;
"RTN","SAMINOT1",43,0)
 ;@module-credits
"RTN","SAMINOT1",44,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMINOT1",45,0)
 ; (VA-PALS)
"RTN","SAMINOT1",46,0)
 ; http://va-pals.org/
"RTN","SAMINOT1",47,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMINOT1",48,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMINOT1",49,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMINOT1",50,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMINOT1",51,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMINOT1",52,0)
 ; http://ielcap.com/
"RTN","SAMINOT1",53,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMINOT1",54,0)
 ; http://paraxialtech.com/
"RTN","SAMINOT1",55,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMINOT1",56,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMINOT1",57,0)
 ;
"RTN","SAMINOT1",58,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMINOT1",59,0)
 ; see routine SAMINUL
"RTN","SAMINOT1",60,0)
 ;
"RTN","SAMINOT1",61,0)
 ;@contents
"RTN","SAMINOT1",62,0)
 ; $$EXISTCE does chart eligibility note exist?
"RTN","SAMINOT1",63,0)
 ; $$EXISTPRE does pre-enrollment note exist?
"RTN","SAMINOT1",64,0)
 ; $$EXISTINT does intake note exist?
"RTN","SAMINOT1",65,0)
 ; WSNOTE web service: text note
"RTN","SAMINOT1",66,0)
 ; NOTE create note
"RTN","SAMINOT1",67,0)
 ; $$HASINNT is intake note present?
"RTN","SAMINOT1",68,0)
 ; MKEL make eligibility note
"RTN","SAMINOT1",69,0)
 ; MKPRE make pre-enrollment note
"RTN","SAMINOT1",70,0)
 ; MKIN make intake note
"RTN","SAMINOT1",71,0)
 ; $$MKNT make note
"RTN","SAMINOT1",72,0)
 ; $$MKNTLOC location for note
"RTN","SAMINOT1",73,0)
 ; $$NTDTTM date & time in note format
"RTN","SAMINOT1",74,0)
 ; $$NTLOCN location of nth note
"RTN","SAMINOT1",75,0)
 ; $$NTLAST location of latest note
"RTN","SAMINOT1",76,0)
 ; $$NTIEN latest note for this form
"RTN","SAMINOT1",77,0)
 ; $$NTLIST note list
"RTN","SAMINOT1",78,0)
 ; TLST ???
"RTN","SAMINOT1",79,0)
 ; ELNOTE eligibility note text
"RTN","SAMINOT1",80,0)
 ; PRENOTE pre-enrollment note
"RTN","SAMINOT1",81,0)
 ; SUBRSLT translation of discussion result
"RTN","SAMINOT1",82,0)
 ; INNOTE intake note
"RTN","SAMINOT1",83,0)
 ; SDM add shared decision making text to array
"RTN","SAMINOT1",84,0)
 ; GLOUT glob out, 1st wrap ln, then put in dest
"RTN","SAMINOT1",85,0)
 ; OUT ???
"RTN","SAMINOT1",86,0)
 ; $$XVAL patient value for variable
"RTN","SAMINOT1",87,0)
 ;
"RTN","SAMINOT1",88,0)
 ;
"RTN","SAMINOT1",89,0)
 ;
"RTN","SAMINOT1",90,0)
 ;@section 1 wsi WSNOTE^SAMINOT1 & related subroutines
"RTN","SAMINOT1",91,0)
 ;
"RTN","SAMINOT1",92,0)
 ;
"RTN","SAMINOT1",93,0)
 ;
"RTN","SAMINOT1",94,0)
EXISTCE(SID,FORM) ; extrinsic returns "true" or "false"
"RTN","SAMINOT1",95,0)
 ;
"RTN","SAMINOT1",96,0)
 ; if a Chart Eligibility Note exists
"RTN","SAMINOT1",97,0)
 ;
"RTN","SAMINOT1",98,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",99,0)
 n gvals s gvals=$na(@root@("graph",SID,FORM))
"RTN","SAMINOT1",100,0)
 ;i $g(@root@("graph",SID,FORM,"sicechrt"))="y" q "true"
"RTN","SAMINOT1",101,0)
 i $g(@gvals@("chart-eligibility-complete"))="true" q "true"
"RTN","SAMINOT1",102,0)
 ;
"RTN","SAMINOT1",103,0)
 quit "false" ; end of $$EXISTCE
"RTN","SAMINOT1",104,0)
 ;
"RTN","SAMINOT1",105,0)
 ;
"RTN","SAMINOT1",106,0)
 ;
"RTN","SAMINOT1",107,0)
EXISTPRE(SID,FORM) ; extrinsic returns "true" or "false"
"RTN","SAMINOT1",108,0)
 ;
"RTN","SAMINOT1",109,0)
 ; if a Pre-enrollment Note exists
"RTN","SAMINOT1",110,0)
 ;
"RTN","SAMINOT1",111,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",112,0)
 n gvals s gvals=$na(@root@("graph",SID,FORM))
"RTN","SAMINOT1",113,0)
 ;i $g(@root@("graph",SID,FORM,"sipedisc"))="y" q "true"
"RTN","SAMINOT1",114,0)
 ;i $g(@gvals@("pre-note-complete"))="true" i $g(@gvals@("siperslt"))="y" q "true"
"RTN","SAMINOT1",115,0)
 i $g(@gvals@("pre-note-complete"))="true" q "true"
"RTN","SAMINOT1",116,0)
 ;
"RTN","SAMINOT1",117,0)
 quit "false" ; end of $$EXISTPRE
"RTN","SAMINOT1",118,0)
 ;
"RTN","SAMINOT1",119,0)
 ;
"RTN","SAMINOT1",120,0)
 ;
"RTN","SAMINOT1",121,0)
EXISTINT(SID,FORM) ; extrinsic returns "true" or "false"
"RTN","SAMINOT1",122,0)
 ;
"RTN","SAMINOT1",123,0)
 ; if an Intake Note exists
"RTN","SAMINOT1",124,0)
 ;
"RTN","SAMINOT1",125,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",126,0)
 i $g(@root@("graph",SID,FORM,"sistatus"))="y" q "true"
"RTN","SAMINOT1",127,0)
 ;
"RTN","SAMINOT1",128,0)
 quit "false" ; end of $$EXISTINT
"RTN","SAMINOT1",129,0)
 ;
"RTN","SAMINOT1",130,0)
 ;
"RTN","SAMINOT1",131,0)
 ;
"RTN","SAMINOT1",132,0)
WSNOTE(return,filter) ; web service which returns a text note
"RTN","SAMINOT1",133,0)
 ;
"RTN","SAMINOT1",134,0)
 n debug s debug=0
"RTN","SAMINOT1",135,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMINOT1",136,0)
 ;
"RTN","SAMINOT1",137,0)
 k return
"RTN","SAMINOT1",138,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMINOT1",139,0)
 ;
"RTN","SAMINOT1",140,0)
 n si
"RTN","SAMINOT1",141,0)
 s si=$g(filter("studyid"))
"RTN","SAMINOT1",142,0)
 i si="" d  ;
"RTN","SAMINOT1",143,0)
 . s si="XXX00333"
"RTN","SAMINOT1",144,0)
 q:si=""
"RTN","SAMINOT1",145,0)
 ;
"RTN","SAMINOT1",146,0)
 n vetstxt s vetstxt="veteran"
"RTN","SAMINOT1",147,0)
 n vetstxt2 s vetstxt2="Veteran"
"RTN","SAMINOT1",148,0)
 ;i $g(filter("veteransAffairsSite"))="false" d  ;
"RTN","SAMINOT1",149,0)
 i '$$ISVA^SAMIPARM(.filter) d  ;
"RTN","SAMINOT1",150,0)
 . set vetstxt="candidate"
"RTN","SAMINOT1",151,0)
 . set vetstxt2="Candidate"
"RTN","SAMINOT1",152,0)
 set filter("vetstxt")=vetstxt
"RTN","SAMINOT1",153,0)
 ;
"RTN","SAMINOT1",154,0)
 n samikey
"RTN","SAMINOT1",155,0)
 s samikey=$g(filter("form"))
"RTN","SAMINOT1",156,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",157,0)
 i samikey="" d  ;
"RTN","SAMINOT1",158,0)
 . s samikey=$o(@root@("graph",si,"siform"))
"RTN","SAMINOT1",159,0)
 . ;w !,samikey
"RTN","SAMINOT1",160,0)
 . ;b
"RTN","SAMINOT1",161,0)
 ;
"RTN","SAMINOT1",162,0)
 n vals
"RTN","SAMINOT1",163,0)
 m vals=@root@("graph",si,samikey)
"RTN","SAMINOT1",164,0)
 ;
"RTN","SAMINOT1",165,0)
 n note,nien,ntype
"RTN","SAMINOT1",166,0)
 s ntype=""
"RTN","SAMINOT1",167,0)
 s note=""
"RTN","SAMINOT1",168,0)
 s nien=$g(filter("nien"))
"RTN","SAMINOT1",169,0)
 i nien="" d
"RTN","SAMINOT1",170,0)
 . s:$g(vals("samistatus"))="complete" ntype="intake"
"RTN","SAMINOT1",171,0)
 . s:$g(vals("samistatus"))="chart-eligibility" ntype="eligibility"
"RTN","SAMINOT1",172,0)
 . s:$g(vals("samistatus"))="pre-enrollment-discussion" ntype="pre-note"
"RTN","SAMINOT1",173,0)
 . q:ntype=""
"RTN","SAMINOT1",174,0)
 . ;d nien=$$NTTYPE add code to pull the latest note by type
"RTN","SAMINOT1",175,0)
 q:nien=""
"RTN","SAMINOT1",176,0)
 n notebase
"RTN","SAMINOT1",177,0)
 s notebase=$$NTLOCN(si,samikey,nien) ; global location for the note
"RTN","SAMINOT1",178,0)
 s note=$na(@notebase@("text"))
"RTN","SAMINOT1",179,0)
 i '$d(@note) q
"RTN","SAMINOT1",180,0)
 ;
"RTN","SAMINOT1",181,0)
 new temp,tout
"RTN","SAMINOT1",182,0)
 do GETTMPL^SAMICASE("temp","vapals:note")
"RTN","SAMINOT1",183,0)
 quit:'$data(temp)
"RTN","SAMINOT1",184,0)
 ;
"RTN","SAMINOT1",185,0)
 n cnt s cnt=0
"RTN","SAMINOT1",186,0)
 n zi s zi=""
"RTN","SAMINOT1",187,0)
 ;
"RTN","SAMINOT1",188,0)
 f  s zi=$o(temp(zi)) q:zi=""  d  ;
"RTN","SAMINOT1",189,0)
 . ;
"RTN","SAMINOT1",190,0)
 . n line s line=temp(zi)
"RTN","SAMINOT1",191,0)
 . D LOAD^SAMIFORM(.line,samikey,si,.filter,.vals)
"RTN","SAMINOT1",192,0)
 . s temp(zi)=line
"RTN","SAMINOT1",193,0)
 . ;
"RTN","SAMINOT1",194,0)
 . s cnt=cnt+1
"RTN","SAMINOT1",195,0)
 . s tout(cnt)=temp(zi)
"RTN","SAMINOT1",196,0)
 . ;
"RTN","SAMINOT1",197,0)
 . i temp(zi)["report-text" d  ;
"RTN","SAMINOT1",198,0)
 . . i temp(zi)["#" q  ;
"RTN","SAMINOT1",199,0)
 . . n zj s zj=""
"RTN","SAMINOT1",200,0)
 . . f  s zj=$o(@note@(zj)) q:zj=""  d  ;
"RTN","SAMINOT1",201,0)
 . . . s cnt=cnt+1
"RTN","SAMINOT1",202,0)
 . . . ;s tout(cnt)=@note@(zj)_"<br>"
"RTN","SAMINOT1",203,0)
 . . . s tout(cnt)=@note@(zj)_$char(13,10)
"RTN","SAMINOT1",204,0)
 m return=tout
"RTN","SAMINOT1",205,0)
 ;
"RTN","SAMINOT1",206,0)
 quit  ; end of WSNOTE
"RTN","SAMINOT1",207,0)
 ;
"RTN","SAMINOT1",208,0)
 ;
"RTN","SAMINOT1",209,0)
 ;
"RTN","SAMINOT1",210,0)
NOTE(filter) ; extrnisic which creates a note
"RTN","SAMINOT1",211,0)
 ;
"RTN","SAMINOT1",212,0)
 ; returns 1 if successful, 0 if not
"RTN","SAMINOT1",213,0)
 ;
"RTN","SAMINOT1",214,0)
 ; set up patient values
"RTN","SAMINOT1",215,0)
 ;
"RTN","SAMINOT1",216,0)
 n vals
"RTN","SAMINOT1",217,0)
 ;
"RTN","SAMINOT1",218,0)
 n si
"RTN","SAMINOT1",219,0)
 s si=$g(filter("studyid"))
"RTN","SAMINOT1",220,0)
 i si="" d  ;
"RTN","SAMINOT1",221,0)
 . s si="XXX00333"
"RTN","SAMINOT1",222,0)
 q:si=""
"RTN","SAMINOT1",223,0)
 ;
"RTN","SAMINOT1",224,0)
 ;
"RTN","SAMINOT1",225,0)
 n vetstxt s vetstxt="veteran"
"RTN","SAMINOT1",226,0)
 n vetstxt2 s vetstxt="Veteran"
"RTN","SAMINOT1",227,0)
 ;i $g(filter("veteransAffairsSite"))="false" d  ;
"RTN","SAMINOT1",228,0)
 i '$$ISVA^SAMIPARM(.filter) d  ;
"RTN","SAMINOT1",229,0)
 . set vetstxt="candidate"
"RTN","SAMINOT1",230,0)
 . set vetstxt2="Candidate"
"RTN","SAMINOT1",231,0)
 set filter("vetstxt")=vetstxt
"RTN","SAMINOT1",232,0)
 ;
"RTN","SAMINOT1",233,0)
 n samikey
"RTN","SAMINOT1",234,0)
 s samikey=$g(filter("form"))
"RTN","SAMINOT1",235,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",236,0)
 i samikey="" d  ;
"RTN","SAMINOT1",237,0)
 . s samikey=$o(@root@("graph",si,"siform"))
"RTN","SAMINOT1",238,0)
 . ;w !,samikey
"RTN","SAMINOT1",239,0)
 . ;b
"RTN","SAMINOT1",240,0)
 ;
"RTN","SAMINOT1",241,0)
 s vals=$na(@root@("graph",si,samikey))
"RTN","SAMINOT1",242,0)
 ;
"RTN","SAMINOT1",243,0)
 i '$d(@vals) d  q 0 ;
"RTN","SAMINOT1",244,0)
 . ;w !,"error, patient values not found"
"RTN","SAMINOT1",245,0)
 ;zwr @vals@(*)
"RTN","SAMINOT1",246,0)
 ;
"RTN","SAMINOT1",247,0)
 k ^SAMIUL("NOTE")
"RTN","SAMINOT1",248,0)
 m ^SAMIUL("NOTE","vals")=@vals
"RTN","SAMINOT1",249,0)
 m ^SAMIUL("NOTE","filter")=filter
"RTN","SAMINOT1",250,0)
 ;
"RTN","SAMINOT1",251,0)
 n didnote s didnote=0
"RTN","SAMINOT1",252,0)
 ;
"RTN","SAMINOT1",253,0)
 i $g(@vals@("samistatus"))="chart-eligibility" d  ;
"RTN","SAMINOT1",254,0)
 . q:$g(@vals@("chart-eligibility-complete"))="true"
"RTN","SAMINOT1",255,0)
 . d MKEL(si,samikey,vals,.filter) ;
"RTN","SAMINOT1",256,0)
 . s didnote=1
"RTN","SAMINOT1",257,0)
 ;
"RTN","SAMINOT1",258,0)
 i $g(@vals@("samistatus"))="pre-enrollment-discussion" d  ;
"RTN","SAMINOT1",259,0)
 . q:$g(@vals@("pre-note-complete"))="true"
"RTN","SAMINOT1",260,0)
 . d MKPRE(si,samikey,vals,.filter) ;
"RTN","SAMINOT1",261,0)
 . s didnote=1
"RTN","SAMINOT1",262,0)
 ;
"RTN","SAMINOT1",263,0)
 i $g(@vals@("samistatus"))="complete" d  ;
"RTN","SAMINOT1",264,0)
 . q:$$HASINNT(vals)
"RTN","SAMINOT1",265,0)
 . d MKIN(si,samikey,vals,.filter) ;
"RTN","SAMINOT1",266,0)
 . s didnote=1
"RTN","SAMINOT1",267,0)
 ;
"RTN","SAMINOT1",268,0)
 n nien s nien=0
"RTN","SAMINOT1",269,0)
 i didnote=1 s nien=$$NTIEN(si,samikey)
"RTN","SAMINOT1",270,0)
 ;
"RTN","SAMINOT1",271,0)
 quit nien ; end of $$NOTE
"RTN","SAMINOT1",272,0)
 ;
"RTN","SAMINOT1",273,0)
 ;
"RTN","SAMINOT1",274,0)
 ;
"RTN","SAMINOT1",275,0)
HASINNT(vals) ; extrinsic returns 1 if intake note is present
"RTN","SAMINOT1",276,0)
 ;
"RTN","SAMINOT1",277,0)
 ; else returns 0
"RTN","SAMINOT1",278,0)
 ;
"RTN","SAMINOT1",279,0)
 n zzi,zzrtn s (zzi,zzrtn)=0
"RTN","SAMINOT1",280,0)
 q:'$d(@vals)
"RTN","SAMINOT1",281,0)
 f  s zzi=$o(@vals@("notes",zzi)) q:+zzi=0  d  ;
"RTN","SAMINOT1",282,0)
 . i $g(@vals@("notes",zzi,"name"))["Intake" s zzrtn=1
"RTN","SAMINOT1",283,0)
 ;
"RTN","SAMINOT1",284,0)
 quit zzrtn ; end of $$HASINNT
"RTN","SAMINOT1",285,0)
 ;
"RTN","SAMINOT1",286,0)
 ;
"RTN","SAMINOT1",287,0)
 ;
"RTN","SAMINOT1",288,0)
MKEL(sid,form,vals,filter) ;
"RTN","SAMINOT1",289,0)
 ;
"RTN","SAMINOT1",290,0)
 n cnt s cnt=0
"RTN","SAMINOT1",291,0)
 ;n dest s dest=$na(@vals@("eligibility-note"))
"RTN","SAMINOT1",292,0)
 n dest s dest=$$MKNT(vals,"Eligibility Note","eligibility",.filter)
"RTN","SAMINOT1",293,0)
 k @dest
"RTN","SAMINOT1",294,0)
 d OUT("Lung Screening Program Chart Eligibility Note")
"RTN","SAMINOT1",295,0)
 d OUT("")
"RTN","SAMINOT1",296,0)
 d ELNOTE(vals,dest,cnt,.filter)
"RTN","SAMINOT1",297,0)
 ;
"RTN","SAMINOT1",298,0)
 quit  ; end of MKEL
"RTN","SAMINOT1",299,0)
 ;
"RTN","SAMINOT1",300,0)
 ;
"RTN","SAMINOT1",301,0)
 ;
"RTN","SAMINOT1",302,0)
MKPRE(sid,form,vals,filter) ;
"RTN","SAMINOT1",303,0)
 ;
"RTN","SAMINOT1",304,0)
 n cnt s cnt=0
"RTN","SAMINOT1",305,0)
 ;n dest s dest=$na(@vals@("pre-note"))
"RTN","SAMINOT1",306,0)
 n dest s dest=$$MKNT(vals,"Pre-enrollment Discussion Note","prenote",.filter)
"RTN","SAMINOT1",307,0)
 k @dest
"RTN","SAMINOT1",308,0)
 i $g(@vals@("chart-eligibility-complete"))'="true" d  ;
"RTN","SAMINOT1",309,0)
 . d OUT("Lung Screening Program Chart Eligibility and Pre-enrollment Discussion Note")
"RTN","SAMINOT1",310,0)
 . d OUT("")
"RTN","SAMINOT1",311,0)
 . d ELNOTE(vals,dest,cnt,.filter)
"RTN","SAMINOT1",312,0)
 i $g(@vals@("chart-eligibility-complete"))="true" d  ;
"RTN","SAMINOT1",313,0)
 . d OUT("Lung Screening Program Pre-enrollment Discussion Note")
"RTN","SAMINOT1",314,0)
 . d OUT("")
"RTN","SAMINOT1",315,0)
 d PRENOTE(vals,dest,cnt,.filter)
"RTN","SAMINOT1",316,0)
 ;
"RTN","SAMINOT1",317,0)
 quit  ; end of MKPRE
"RTN","SAMINOT1",318,0)
 ;
"RTN","SAMINOT1",319,0)
 ;
"RTN","SAMINOT1",320,0)
 ;
"RTN","SAMINOT1",321,0)
MKIN(sid,form,vals,filter) ;
"RTN","SAMINOT1",322,0)
 ;
"RTN","SAMINOT1",323,0)
 n cnt s cnt=0
"RTN","SAMINOT1",324,0)
 ;n dest s dest=$na(@vals@("intake-note"))
"RTN","SAMINOT1",325,0)
 n dest s dest=$$MKNT(vals,"Intake Note","intake",.filter)
"RTN","SAMINOT1",326,0)
 k @dest
"RTN","SAMINOT1",327,0)
 d OUT("Lung Screening Program Intake Note")
"RTN","SAMINOT1",328,0)
 d OUT("")
"RTN","SAMINOT1",329,0)
 i $g(@vals@("chart-eligibility-complete"))'="true" d  ;
"RTN","SAMINOT1",330,0)
 . d ELNOTE(vals,dest,cnt,.filter)
"RTN","SAMINOT1",331,0)
 i $g(@vals@("pre-note-complete"))'="true" d  ;
"RTN","SAMINOT1",332,0)
 . d PRENOTE(vals,dest,cnt,.filter)
"RTN","SAMINOT1",333,0)
 d INNOTE(vals,dest,cnt,.filter)
"RTN","SAMINOT1",334,0)
 ;
"RTN","SAMINOT1",335,0)
 quit  ; end of MKIN
"RTN","SAMINOT1",336,0)
 ;
"RTN","SAMINOT1",337,0)
 ;
"RTN","SAMINOT1",338,0)
 ;
"RTN","SAMINOT1",339,0)
MKNT(vals,title,ntype,filter) ; extrinsic makes a note date=now returns 
"RTN","SAMINOT1",340,0)
 ;
"RTN","SAMINOT1",341,0)
 ; global addr. filter must be passed by reference
"RTN","SAMINOT1",342,0)
 ;
"RTN","SAMINOT1",343,0)
 n ntdt s ntdt=$$NTDTTM($$NOW^XLFDT)
"RTN","SAMINOT1",344,0)
 n ntptr
"RTN","SAMINOT1",345,0)
 s ntptr=$$MKNTLOC(vals,title,ntdt,$g(ntype),.filter)
"RTN","SAMINOT1",346,0)
 ;
"RTN","SAMINOT1",347,0)
 quit ntptr ; end of $$MKNT
"RTN","SAMINOT1",348,0)
 ;
"RTN","SAMINOT1",349,0)
 ;
"RTN","SAMINOT1",350,0)
 ;
"RTN","SAMINOT1",351,0)
MKNTLOC(vals,title,ndate,ntype,filter) ; extrinsic returns the 
"RTN","SAMINOT1",352,0)
 ;
"RTN","SAMINOT1",353,0)
 ;location for the note
"RTN","SAMINOT1",354,0)
 ;
"RTN","SAMINOT1",355,0)
 n nien
"RTN","SAMINOT1",356,0)
 s nien=$o(@vals@("notes",""),-1)+1
"RTN","SAMINOT1",357,0)
 s filter("nien")=nien
"RTN","SAMINOT1",358,0)
 n nloc s nloc=$na(@vals@("notes",nien))
"RTN","SAMINOT1",359,0)
 s @nloc@("name")=title_" "_$g(ndate)
"RTN","SAMINOT1",360,0)
 s @nloc@("date")=$g(ndate)
"RTN","SAMINOT1",361,0)
 s @nloc@("type")=$g(ntype)
"RTN","SAMINOT1",362,0)
 ;
"RTN","SAMINOT1",363,0)
 quit $name(@nloc@("text")) ; end of $$MKNTLOC
"RTN","SAMINOT1",364,0)
 ;
"RTN","SAMINOT1",365,0)
 ;
"RTN","SAMINOT1",366,0)
 ;
"RTN","SAMINOT1",367,0)
NTDTTM(ZFMDT) ; extrinsic returns the date and time in Note format
"RTN","SAMINOT1",368,0)
 ;
"RTN","SAMINOT1",369,0)
 ; ZFMDT is the fileman date/time to translate
"RTN","SAMINOT1",370,0)
 ;
"RTN","SAMINOT1",371,0)
 quit $$FMTE^XLFDT(ZFMDT,"5") ; end of $$NTDTTM
"RTN","SAMINOT1",372,0)
 ;
"RTN","SAMINOT1",373,0)
 ;
"RTN","SAMINOT1",374,0)
 ;
"RTN","SAMINOT1",375,0)
NTLOCN(sid,form,nien) ; extrinsic returns the location of the Nth note
"RTN","SAMINOT1",376,0)
 ;
"RTN","SAMINOT1",377,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",378,0)
 ;
"RTN","SAMINOT1",379,0)
 quit $name(@root@("graph",sid,form,"notes",nien)) ; end of $$NTLOCN
"RTN","SAMINOT1",380,0)
 ;
"RTN","SAMINOT1",381,0)
 ;
"RTN","SAMINOT1",382,0)
 ;
"RTN","SAMINOT1",383,0)
NTLAST(sid,form,ntype) ; extrinsic returns the location of the latest note
"RTN","SAMINOT1",384,0)
 ;
"RTN","SAMINOT1",385,0)
 ; of the type ntype
"RTN","SAMINOT1",386,0)
 ;
"RTN","SAMINOT1",387,0)
 quit  ; end of NTLAST
"RTN","SAMINOT1",388,0)
 ;
"RTN","SAMINOT1",389,0)
 ;
"RTN","SAMINOT1",390,0)
 ;
"RTN","SAMINOT1",391,0)
NTIEN(sid,form) ; extrinsic which returns the latest note for this form
"RTN","SAMINOT1",392,0)
 ;
"RTN","SAMINOT1",393,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",394,0)
 n rtn s rtn=$o(@root@("graph",sid,form,"notes"," "),-1)
"RTN","SAMINOT1",395,0)
 ;
"RTN","SAMINOT1",396,0)
 quit rtn ; end of $$NTIEN
"RTN","SAMINOT1",397,0)
 ;
"RTN","SAMINOT1",398,0)
 ;
"RTN","SAMINOT1",399,0)
 ;
"RTN","SAMINOT1",400,0)
NTLIST(nlist,sid,form) ; returns the note list in nlist, passed by ref
"RTN","SAMINOT1",401,0)
 ;
"RTN","SAMINOT1",402,0)
 n zn,root,gn
"RTN","SAMINOT1",403,0)
 s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT1",404,0)
 s zn=0
"RTN","SAMINOT1",405,0)
 s gn=$na(@root@("graph",sid,form,"notes"))
"RTN","SAMINOT1",406,0)
 q:'$d(@gn)
"RTN","SAMINOT1",407,0)
 f  s zn=$o(@gn@(zn)) q:+zn=0  d  ;
"RTN","SAMINOT1",408,0)
 . s @nlist@(zn,"name")=@gn@(zn,"name")
"RTN","SAMINOT1",409,0)
 . s @nlist@(zn,"nien")=zn
"RTN","SAMINOT1",410,0)
 ;
"RTN","SAMINOT1",411,0)
 quit  ; end of NTLIST
"RTN","SAMINOT1",412,0)
 ;
"RTN","SAMINOT1",413,0)
 ;
"RTN","SAMINOT1",414,0)
 ;
"RTN","SAMINOT1",415,0)
TLST ;
"RTN","SAMINOT1",416,0)
 ;
"RTN","SAMINOT1",417,0)
 set SID="XXX00677"
"RTN","SAMINOT1",418,0)
 set FORM="siform-2019-04-23"
"RTN","SAMINOT1",419,0)
 do NTLIST("G",SID,FORM)
"RTN","SAMINOT1",420,0)
 ;ZWR G
"RTN","SAMINOT1",421,0)
 ;
"RTN","SAMINOT1",422,0)
 quit  ; end of TLST
"RTN","SAMINOT1",423,0)
 ;
"RTN","SAMINOT1",424,0)
 ;
"RTN","SAMINOT1",425,0)
 ;
"RTN","SAMINOT1",426,0)
ELNOTE(vals,dest,cnt,filter) ; eligibility NOTE TEXT
"RTN","SAMINOT1",427,0)
 ;
"RTN","SAMINOT1",428,0)
 ;
"RTN","SAMINOT1",429,0)
 n vetstxt s vetstxt="veteran"
"RTN","SAMINOT1",430,0)
 n vetstxt2 s vetstxt2="Veteran"
"RTN","SAMINOT1",431,0)
 i '$$ISVA^SAMIPARM(.filter) d  ;
"RTN","SAMINOT1",432,0)
 . set vetstxt="candidate"
"RTN","SAMINOT1",433,0)
 . set vetstxt2="Candidate"
"RTN","SAMINOT1",434,0)
 set filter("vetstxt")=vetstxt
"RTN","SAMINOT1",435,0)
 ;
"RTN","SAMINOT1",436,0)
 D OUT("")
"RTN","SAMINOT1",437,0)
 D OUT("Date of chart review: "_$$XVAL("sidc",vals))
"RTN","SAMINOT1",438,0)
 D GLOUT("The participant was identified as a potential lung screening candidate by: ")
"RTN","SAMINOT1",439,0)
 D GLOUT($$XVAL("siceiden",vals),4)
"RTN","SAMINOT1",440,0)
 if $$XVAL("siceiden",vals)="referral" d  ;
"RTN","SAMINOT1",441,0)
 . D OUT("Date of Referral: "_$$XVAL("sicerfdt",vals))
"RTN","SAMINOT1",442,0)
 . n spec s spec=""
"RTN","SAMINOT1",443,0)
 . s:$$XVAL("sicerfpc",vals)="y" spec=spec_" Primary Care"
"RTN","SAMINOT1",444,0)
 . s:$$XVAL("sicerfwh",vals)="y" spec=spec_" Women's Health"
"RTN","SAMINOT1",445,0)
 . s:$$XVAL("sicerfge",vals)="y" spec=spec_" Geriatrics"
"RTN","SAMINOT1",446,0)
 . s:$$XVAL("sicerfpu",vals)="y" spec=spec_" Pulmonology"
"RTN","SAMINOT1",447,0)
 . s:$$XVAL("sicerfon",vals)="y" spec=spec_" Oncology"
"RTN","SAMINOT1",448,0)
 . s:$$XVAL("sicerfsc",vals)="y" spec=spec_" Smoking Cessation"
"RTN","SAMINOT1",449,0)
 . s:$$XVAL("sicerfot",vals)="y" spec=spec_" "_$$XVAL("sicerfoo",vals)
"RTN","SAMINOT1",450,0)
 . D GLOUT("Specialty of referring provider: ")
"RTN","SAMINOT1",451,0)
 . D GLOUT(spec,4)
"RTN","SAMINOT1",452,0)
 n elig
"RTN","SAMINOT1",453,0)
 s elig=$$XVAL("sicechrt",vals)
"RTN","SAMINOT1",454,0)
 D OUT("The participant is eligible based on chart review: "_$s(elig="y":"Yes",1:"no"))
"RTN","SAMINOT1",455,0)
 D OUT("")
"RTN","SAMINOT1",456,0)
 s @vals@("chart-eligibility-complete")="true"
"RTN","SAMINOT1",457,0)
 ;
"RTN","SAMINOT1",458,0)
 quit  ; end of ELNOTE
"RTN","SAMINOT1",459,0)
 ;
"RTN","SAMINOT1",460,0)
 ;
"RTN","SAMINOT1",461,0)
 ;
"RTN","SAMINOT1",462,0)
PRENOTE(vals,dest,cnt,filter) ;
"RTN","SAMINOT1",463,0)
 ;
"RTN","SAMINOT1",464,0)
 ;
"RTN","SAMINOT1",465,0)
 n vetstxt s vetstxt="veteran"
"RTN","SAMINOT1",466,0)
 n vetstxt2 s vetstxt2="Veteran"
"RTN","SAMINOT1",467,0)
 i '$$ISVA^SAMIPARM(.filter) d  ;
"RTN","SAMINOT1",468,0)
 . set vetstxt="candidate"
"RTN","SAMINOT1",469,0)
 . set vetstxt2="Candidate"
"RTN","SAMINOT1",470,0)
 set filter("vetstxt")=vetstxt
"RTN","SAMINOT1",471,0)
 ;
"RTN","SAMINOT1",472,0)
 i $g(@vals@("sipedisc"))'="y" q  ; no prelim discussion
"RTN","SAMINOT1",473,0)
 D OUT("")
"RTN","SAMINOT1",474,0)
 ;d OUT("A pre-enrollment discussion was held.")
"RTN","SAMINOT1",475,0)
 ;[If Yes is selected then add the following 5 lines]
"RTN","SAMINOT1",476,0)
 D OUT("The program attempted to reach the "_vetstxt_" to discuss lung screening.")
"RTN","SAMINOT1",477,0)
 D OUT("Date of pre-enrollment discussion: "_$$XVAL("sipedc",vals))
"RTN","SAMINOT1",478,0)
 n via s via=""
"RTN","SAMINOT1",479,0)
 s:$$XVAL("sipecnip",vals)="1" via=via_" In person"
"RTN","SAMINOT1",480,0)
 s:$$XVAL("sipecnte",vals)="1" via=via_" Telephone"
"RTN","SAMINOT1",481,0)
 s:$$XVAL("sipecnth",vals)="1" via=via_" TeleHealth"
"RTN","SAMINOT1",482,0)
 s:$$XVAL("sipecnml",vals)="1" via=via_" Mailed Letter"
"RTN","SAMINOT1",483,0)
 s:$$XVAL("sipecnpp",vals)="1" via=via_" Message in patient portal"
"RTN","SAMINOT1",484,0)
 s:$$XVAL("sipecnvd",vals)="1" via=via_" Video-on-Demand (VOD)"
"RTN","SAMINOT1",485,0)
 s:$$XVAL("sipecnot",vals)="1" via=via_" "_$$XVAL("sipecnoo",vals)
"RTN","SAMINOT1",486,0)
 ;D OUT("The lung screening program reached the potential candidate or was contacted via:"_via)
"RTN","SAMINOT1",487,0)
 D GLOUT("The lung screening program reached the potential candidate or was contacted via:")
"RTN","SAMINOT1",488,0)
 D GLOUT(via,4)
"RTN","SAMINOT1",489,0)
 ;D OUT("The pre-enrollment discussion with the participant resulted in: "_$$SUBRSLT($$XVAL("siperslt",vals)))
"RTN","SAMINOT1",490,0)
 D OUT("The pre-enrollment discussion with the participant resulted in: ")
"RTN","SAMINOT1",491,0)
 D GLOUT($$SUBRSLT($$XVAL("siperslt",vals)),4)
"RTN","SAMINOT1",492,0)
 D OUT("Comments: ")
"RTN","SAMINOT1",493,0)
 D GLOUT($$XVAL("sipecmnt",vals),4)
"RTN","SAMINOT1",494,0)
 ;
"RTN","SAMINOT1",495,0)
 s @vals@("pre-note-complete")="true"
"RTN","SAMINOT1",496,0)
 ;
"RTN","SAMINOT1",497,0)
 quit  ; end of PRENOTE
"RTN","SAMINOT1",498,0)
 ;
"RTN","SAMINOT1",499,0)
 ;
"RTN","SAMINOT1",500,0)
 ;
"RTN","SAMINOT1",501,0)
SUBRSLT(XVAL) ; translation of discussion result
"RTN","SAMINOT1",502,0)
 ;
"RTN","SAMINOT1",503,0)
 q:XVAL="y" "Participant is interested in discussing lung screening. The program will proceed with enrollment process."
"RTN","SAMINOT1",504,0)
 q:XVAL="u" "Participant is unsure of lung screening. Ok to contact in the future."
"RTN","SAMINOT1",505,0)
 q:XVAL="nn" "Participant is not interested in discussing lung screening at this time. Ok to contact in the future."
"RTN","SAMINOT1",506,0)
 q:XVAL="nf" "Participant is not interested in discussing lung screening in the future."
"RTN","SAMINOT1",507,0)
 q:XVAL="na" "Unable to reach participant at this time"
"RTN","SAMINOT1",508,0)
 ;
"RTN","SAMINOT1",509,0)
 quit "" ; end of $$SUBRSLT
"RTN","SAMINOT1",510,0)
 ;
"RTN","SAMINOT1",511,0)
 ;
"RTN","SAMINOT1",512,0)
 ;
"RTN","SAMINOT1",513,0)
INNOTE(vals,dest,cnt,filter) ;
"RTN","SAMINOT1",514,0)
 ;
"RTN","SAMINOT1",515,0)
 ;Lung Screening Program Intake Note
"RTN","SAMINOT1",516,0)
 ;
"RTN","SAMINOT1",517,0)
 ;Date of intake discussion contact:       [Date]
"RTN","SAMINOT1",518,0)
 ;How did you learn about the Lung Screening Program?:  [Selection]
"RTN","SAMINOT1",519,0)
 ;Primary address verified:                 [Yes/No]
"RTN","SAMINOT1",520,0)
 ;Rural status:                                        [Urban/Rural/Unknown]
"RTN","SAMINOT1",521,0)
 ;Preferred address and contact number:
"RTN","SAMINOT1",522,0)
 ;     [Address 1]
"RTN","SAMINOT1",523,0)
 ;           [Address 2]
"RTN","SAMINOT1",524,0)
 ;              [Address]
"RTN","SAMINOT1",525,0)
 ;
"RTN","SAMINOT1",526,0)
 ;Ever smoked?:            [Ever Smoked Text]
"RTN","SAMINOT1",527,0)
 ;Smoking Status:          [Never Smoked/Past/Current/Willing to Quit]
"RTN","SAMINOT1",528,0)
 ;CIGs per day:               [Input Number]
"RTN","SAMINOT1",529,0)
 ;PPD:                              [Computed Number]
"RTN","SAMINOT1",530,0)
 ;# of years:                    [Input Number]
"RTN","SAMINOT1",531,0)
 ;Pack Years:                   [Computed Number]
"RTN","SAMINOT1",532,0)
 ;
"RTN","SAMINOT1",533,0)
 ;[If a Quit Date is entered add the following line]
"RTN","SAMINOT1",534,0)
 ;Quit smoking on:         [Date]
"RTN","SAMINOT1",535,0)
 ;
"RTN","SAMINOT1",536,0)
 ;[If Smoking Cessation education text is entered add the following line]
"RTN","SAMINOT1",537,0)
 ;Smoking cessation education provided: [Show Input Text]
"RTN","SAMINOT1",538,0)
 ;
"RTN","SAMINOT1",539,0)
 ;[If a Lung Cancer Dx date is entered show the following 1 to 2 lines]
"RTN","SAMINOT1",540,0)
 ;Prior lung cancer diagnosis date: [Date]
"RTN","SAMINOT1",541,0)
 ;[If a location not in the VA is specified show the next line]
"RTN","SAMINOT1",542,0)
 ;Location where prior lung cancer diagnosis was made: [Location Text]
"RTN","SAMINOT1",543,0)
 ;
"RTN","SAMINOT1",544,0)
 ;[If Any Prior CT Date is entered show the following 1 to 2 lines]
"RTN","SAMINOT1",545,0)
 ;Prior CT:                   [Date]
"RTN","SAMINOT1",546,0)
 ;[If a location not in the VA is specified show the next line]
"RTN","SAMINOT1",547,0)
 ;Location where prior lung cancer diagnosis was made: [Location Text]
"RTN","SAMINOT1",548,0)
 ;
"RTN","SAMINOT1",549,0)
 ;Shared Decision Making:
"RTN","SAMINOT1",550,0)
 ;
"RTN","SAMINOT1",551,0)
 ;
"RTN","SAMINOT1",552,0)
 n vetstxt s vetstxt="veteran"
"RTN","SAMINOT1",553,0)
 n vetstxt2 s vetstxt2="Veteran"
"RTN","SAMINOT1",554,0)
 ;i $g(filter("veteransAffairsSite"))="false" d  ;
"RTN","SAMINOT1",555,0)
 i '$$ISVA^SAMIPARM(.filter) d  ;
"RTN","SAMINOT1",556,0)
 . set vetstxt="candidate"
"RTN","SAMINOT1",557,0)
 . set vetstxt2="Candidate"
"RTN","SAMINOT1",558,0)
 set filter("vetstxt")=vetstxt
"RTN","SAMINOT1",559,0)
 ;
"RTN","SAMINOT1",560,0)
 d OUT(" ")
"RTN","SAMINOT1",561,0)
 d OUT("   "_"Date of intake discussion contact: "_$$XVAL("sidc",vals))
"RTN","SAMINOT1",562,0)
 n learn s learn=""
"RTN","SAMINOT1",563,0)
 s:$$XVAL("silnip",vals) learn=learn_" In person"
"RTN","SAMINOT1",564,0)
 s:$$XVAL("silnph",vals) learn=learn_" Telephone"
"RTN","SAMINOT1",565,0)
 s:$$XVAL("silnth",vals) learn=learn_" TeleHealth"
"RTN","SAMINOT1",566,0)
 s:$$XVAL("silnml",vals) learn=learn_" Mailed letter"
"RTN","SAMINOT1",567,0)
 s:$$XVAL("silnpp",vals) learn=learn_" Message in patient portal"
"RTN","SAMINOT1",568,0)
 s:$$XVAL("silnvd",vals) learn=learn_" Video-on-Demand (VOD)"
"RTN","SAMINOT1",569,0)
 s:$$XVAL("silnot",vals) learn=learn_" "_$$XVAL("silnoo",vals)
"RTN","SAMINOT1",570,0)
 ;d GLOUT("   "_"How did you learn about the Lung Screening Program?: "_learn,4)
"RTN","SAMINOT1",571,0)
 d GLOUT("How did you learn about the Lung Screening Program?: ",4)
"RTN","SAMINOT1",572,0)
 d GLOUT(learn,6)
"RTN","SAMINOT1",573,0)
 n verified s verified=""
"RTN","SAMINOT1",574,0)
 s:$$XVAL("sipav",vals)="y" verified="Yes"
"RTN","SAMINOT1",575,0)
 s:$$XVAL("sipav",vals)="n" verified="No"
"RTN","SAMINOT1",576,0)
 d OUT("   "_"Primary address verified: "_verified)
"RTN","SAMINOT1",577,0)
 n rural s rural=""
"RTN","SAMINOT1",578,0)
 s:$$XVAL("sirs",vals)="r" rural="rural"
"RTN","SAMINOT1",579,0)
 s:$$XVAL("sirs",vals)="u" rural="urban"
"RTN","SAMINOT1",580,0)
 d OUT("   "_""_"Rural status: "_rural)
"RTN","SAMINOT1",581,0)
 d OUT("   "_"Preferred address and contact number: ")
"RTN","SAMINOT1",582,0)
 n pa s pa=""
"RTN","SAMINOT1",583,0)
 i $$XVAL("sipsa",vals)'="" d  ;
"RTN","SAMINOT1",584,0)
 . d OUT("      "_$$XVAL("sipsa",vals))
"RTN","SAMINOT1",585,0)
 . n csz s csz=""
"RTN","SAMINOT1",586,0)
 . s:$$XVAL("sipc",vals)'="" csz=$$XVAL("sipc",vals)
"RTN","SAMINOT1",587,0)
 . s:$$XVAL("sips",vals)'="" csz=csz_", "_$$XVAL("sips",vals)
"RTN","SAMINOT1",588,0)
 . s:$$XVAL("sipz",vals)'="" csz=csz_" "_$$XVAL("sipz",vals)
"RTN","SAMINOT1",589,0)
 . d OUT("      "_csz)
"RTN","SAMINOT1",590,0)
 d:$$XVAL("sippn",vals)'="" OUT("      "_$$XVAL("sippn",vals))
"RTN","SAMINOT1",591,0)
 d OUT("   "_"Ever smoked?: ")
"RTN","SAMINOT1",592,0)
 d GLOUT($$XVAL("sies",vals),6)
"RTN","SAMINOT1",593,0)
 n sstatus s sstatus=""
"RTN","SAMINOT1",594,0)
 s:$$XVAL("siesm",vals)="n" sstatus=sstatus_" Never smoked"
"RTN","SAMINOT1",595,0)
 s:$$XVAL("siesm",vals)="p" sstatus=sstatus_" Past"
"RTN","SAMINOT1",596,0)
 s:$$XVAL("siesm",vals)="c" sstatus=sstatus_" Current"
"RTN","SAMINOT1",597,0)
 s:$$XVAL("siesq",vals)=1 sstatus=sstatus_" Willing to quit"
"RTN","SAMINOT1",598,0)
 d OUT("   Smoking Status: "_sstatus)
"RTN","SAMINOT1",599,0)
 d OUT("   "_"CIGs per day: ")
"RTN","SAMINOT1",600,0)
 d OUT("      "_$$XVAL("sicpd",vals))
"RTN","SAMINOT1",601,0)
 d OUT("   "_"PPD: ")
"RTN","SAMINOT1",602,0)
 d OUT("      "_$$XVAL("sippd",vals))
"RTN","SAMINOT1",603,0)
 d OUT("   "_"# of years: ")
"RTN","SAMINOT1",604,0)
 d OUT("      "_$$XVAL("sisny",vals))
"RTN","SAMINOT1",605,0)
 d OUT("   "_"PPY: ")
"RTN","SAMINOT1",606,0)
 d OUT("      "_$$XVAL("sippy",vals))
"RTN","SAMINOT1",607,0)
 d OUT("")
"RTN","SAMINOT1",608,0)
 i $$XVAL("siq",vals)'="" d  ;
"RTN","SAMINOT1",609,0)
 . d OUT("Quit smoking on: "_$$XVAL("siq",vals))
"RTN","SAMINOT1",610,0)
 . d OUT("")
"RTN","SAMINOT1",611,0)
 i $$XVAL("sicep",vals)'="" d  ;
"RTN","SAMINOT1",612,0)
 . d OUT("Smoking cessation education provided:")
"RTN","SAMINOT1",613,0)
 . d GLOUT("    "_$$XVAL("sicep",vals),4)
"RTN","SAMINOT1",614,0)
 i $$XVAL("sicadx",vals)'="" d
"RTN","SAMINOT1",615,0)
 . d OUT("Prior lung cancer diagnosis date: "_$$XVAL("sicadx",vals))
"RTN","SAMINOT1",616,0)
 . i $$XVAL("sicadxl",vals)'="" d  ;
"RTN","SAMINOT1",617,0)
 . . d OUT("Location where prior lung cancer diagnosis was made:")
"RTN","SAMINOT1",618,0)
 . . d GLOUT("    "_$$XVAL("sicadxl",vals),4)
"RTN","SAMINOT1",619,0)
 i $$XVAL("siptct",vals)'="" d
"RTN","SAMINOT1",620,0)
 . d OUT("Prior CT: "_$$XVAL("siptct",vals))
"RTN","SAMINOT1",621,0)
 . i $$XVAL("siptctl",vals)'="" d  ;
"RTN","SAMINOT1",622,0)
 . . d OUT("Location where prior CT was made:")
"RTN","SAMINOT1",623,0)
 . . d GLOUT("    "_$$XVAL("siptctl",vals),4)
"RTN","SAMINOT1",624,0)
 d OUT(" ")
"RTN","SAMINOT1",625,0)
 d OUT("Shared Decision Making: ")
"RTN","SAMINOT1",626,0)
 d OUT(" ")
"RTN","SAMINOT1",627,0)
 n shareddm
"RTN","SAMINOT1",628,0)
 s shareddm=+$$XVAL("siidmdc",vals)
"RTN","SAMINOT1",629,0)
 i shareddm=1 d SDM(dest,.filter)
"RTN","SAMINOT1",630,0)
 e  d OUT("Shared decision making was not applicable")
"RTN","SAMINOT1",631,0)
 d OUT(" ")
"RTN","SAMINOT1",632,0)
 n ldct s ldct=""
"RTN","SAMINOT1",633,0)
 s:$$XVAL("sildct",vals)="n" ldct="No"
"RTN","SAMINOT1",634,0)
 s:$$XVAL("sildct",vals)="l" ldct="No"
"RTN","SAMINOT1",635,0)
 s:$$XVAL("sildct",vals)="y" ldct="Yes"
"RTN","SAMINOT1",636,0)
 d GLOUT("The "_vetstxt_" has decided to enroll in the Lung Screening Program: "_ldct)
"RTN","SAMINOT1",637,0)
 i $$XVAL("sildct",vals)="l" d  ;
"RTN","SAMINOT1",638,0)
 . d GLOUT("The "_vetstxt_" has indicated it is okay to contact in the future to discuss enrolling in the Lung Screening Program.",4)
"RTN","SAMINOT1",639,0)
 i ldct="Yes" d  ;
"RTN","SAMINOT1",640,0)
 . d OUT("LDCT ordered: "_ldct)
"RTN","SAMINOT1",641,0)
 . d OUT("    "_vetstxt2_" enrolled in the LSS program. Results and coordination of care ")
"RTN","SAMINOT1",642,0)
 . d OUT("    "_"will be made by the LSS team.  ")
"RTN","SAMINOT1",643,0)
 . i $$XVAL("siclin",vals)'="" d  ;
"RTN","SAMINOT1",644,0)
 . . quit
"RTN","SAMINOT1",645,0)
 . quit
"RTN","SAMINOT1",646,0)
 n tmpclin s tmpclin=$$XVAL("siclin",vals)
"RTN","SAMINOT1",647,0)
 i tmpclin'="" d  ;
"RTN","SAMINOT1",648,0)
 . d OUT("Clinical Indications for Initial Screening CT:")
"RTN","SAMINOT1",649,0)
 . d GLOUT("    "_tmpclin,4)
"RTN","SAMINOT1",650,0)
 ;
"RTN","SAMINOT1",651,0)
 ;The veteran has decided to enroll in the Lung Screening Program: [Yes/No]
"RTN","SAMINOT1",652,0)
 ;
"RTN","SAMINOT1",653,0)
 ;[If Not enroll at this time but okay to contact in the future, add the following line]
"RTN","SAMINOT1",654,0)
 ;The veteran has indicated it is okay to contact in the future to discuss enrolling in the Lung Screening Program.
"RTN","SAMINOT1",655,0)
 ;
"RTN","SAMINOT1",656,0)
 ;[If Yes is answered for enrollment add the following two lines]
"RTN","SAMINOT1",657,0)
 ;LDCT ordered:                Yes
"RTN","SAMINOT1",658,0)
 ;Veteran enrolled in the Lung Screening Program. Results and coordination of care will be made by the Lung Screening Program team.
"RTN","SAMINOT1",659,0)
 ;
"RTN","SAMINOT1",660,0)
 ;[If Clinical Indication text is provided add them to the note]
"RTN","SAMINOT1",661,0)
 ;Clinical Indications:          [Show Input Text]
"RTN","SAMINOT1",662,0)
 ;
"RTN","SAMINOT1",663,0)
 ;
"RTN","SAMINOT1",664,0)
 quit  ; end of INNOTE
"RTN","SAMINOT1",665,0)
 ;
"RTN","SAMINOT1",666,0)
 ;
"RTN","SAMINOT1",667,0)
 ;
"RTN","SAMINOT1",668,0)
SDM(ary,filter) ; adds Shared Decision Making text to array ary, passed by name
"RTN","SAMINOT1",669,0)
 ;
"RTN","SAMINOT1",670,0)
 ;
"RTN","SAMINOT1",671,0)
 n vetstxt s vetstxt="veteran"
"RTN","SAMINOT1",672,0)
 n vetstxt2 s vetstxt2="Veteran"
"RTN","SAMINOT1",673,0)
 ;i $g(filter("veteransAffairsSite"))="false" d  ;
"RTN","SAMINOT1",674,0)
 i '$$ISVA^SAMIPARM(.filter) d  ;
"RTN","SAMINOT1",675,0)
 . set vetstxt="candidate"
"RTN","SAMINOT1",676,0)
 . set vetstxt2="Candidate"
"RTN","SAMINOT1",677,0)
 set filter("vetstxt")=vetstxt
"RTN","SAMINOT1",678,0)
 ;
"RTN","SAMINOT1",679,0)
 n ii s ii=$o(@ary@(" "),-1)
"RTN","SAMINOT1",680,0)
 s ii=ii+1
"RTN","SAMINOT1",681,0)
 s @ary@(ii)=vetstxt2_" of age and exposure to cigarette smoke as described above, and "
"RTN","SAMINOT1",682,0)
 s ii=ii+1
"RTN","SAMINOT1",683,0)
 s @ary@(ii)="without a current diagnosis or obvious symptoms suggestive of lung cancer, "
"RTN","SAMINOT1",684,0)
 s ii=ii+1
"RTN","SAMINOT1",685,0)
 s @ary@(ii)="has been educated today about the estimated risk for lung cancer, the "
"RTN","SAMINOT1",686,0)
 s ii=ii+1
"RTN","SAMINOT1",687,0)
 s @ary@(ii)="possibility of cure or life prolonging if an early lung cancer were to be "
"RTN","SAMINOT1",688,0)
 s ii=ii+1
"RTN","SAMINOT1",689,0)
 s @ary@(ii)="found during screening, the possibility of imaging abnormalities not being "
"RTN","SAMINOT1",690,0)
 s ii=ii+1
"RTN","SAMINOT1",691,0)
 s @ary@(ii)="lung cancer, the possibility of complications from additional diagnostic "
"RTN","SAMINOT1",692,0)
 s ii=ii+1
"RTN","SAMINOT1",693,0)
 s @ary@(ii)="procedures, and the approximate amount of radiation exposure associated "
"RTN","SAMINOT1",694,0)
 s ii=ii+1
"RTN","SAMINOT1",695,0)
 s @ary@(ii)="with each screening procedure. In addition, the "_vetstxt_" has been educated "
"RTN","SAMINOT1",696,0)
 s ii=ii+1
"RTN","SAMINOT1",697,0)
 s @ary@(ii)="today about the importance of adhering to annual lung screening, the "
"RTN","SAMINOT1",698,0)
 s ii=ii+1
"RTN","SAMINOT1",699,0)
 s @ary@(ii)="possible impact of other medical conditions on the overall health status, "
"RTN","SAMINOT1",700,0)
 s ii=ii+1
"RTN","SAMINOT1",701,0)
 s @ary@(ii)="the importance of avoiding exposure to cigarette smoke, available tobacco "
"RTN","SAMINOT1",702,0)
 s ii=ii+1
"RTN","SAMINOT1",703,0)
 s @ary@(ii)="cessation programs and available lung screening services at this site. "
"RTN","SAMINOT1",704,0)
 s ii=ii+1
"RTN","SAMINOT1",705,0)
 s @ary@(ii)="Education material was provided to the "_vetstxt_". "
"RTN","SAMINOT1",706,0)
 s ii=ii+1
"RTN","SAMINOT1",707,0)
 ;s @ary@(ii)="Based on this information, the Veteran has opted for "
"RTN","SAMINOT1",708,0)
 ;
"RTN","SAMINOT1",709,0)
 quit  ; end of SDM
"RTN","SAMINOT1",710,0)
 ;
"RTN","SAMINOT1",711,0)
 ;
"RTN","SAMINOT1",712,0)
 ;
"RTN","SAMINOT1",713,0)
GLOUT(ln,indent) ; glob out first wrap ln then put it in dest
"RTN","SAMINOT1",714,0)
 ;
"RTN","SAMINOT1",715,0)
 i $$CRWRAP^SAMITTW(ln,dest,.cnt,80) q  ;
"RTN","SAMINOT1",716,0)
 n arytmp
"RTN","SAMINOT1",717,0)
 s arytmp(1)=ln
"RTN","SAMINOT1",718,0)
 i $g(indent)="" s indent=1
"RTN","SAMINOT1",719,0)
 d wrap^%tt("arytmp",indent_":80")
"RTN","SAMINOT1",720,0)
 n ii s ii=""
"RTN","SAMINOT1",721,0)
 f  s ii=$o(arytmp(ii)) q:ii=""  d  ;
"RTN","SAMINOT1",722,0)
 . d OUT(arytmp(ii))
"RTN","SAMINOT1",723,0)
 ;
"RTN","SAMINOT1",724,0)
 quit  ; end of GLOUT
"RTN","SAMINOT1",725,0)
 ;
"RTN","SAMINOT1",726,0)
 ;
"RTN","SAMINOT1",727,0)
 ;
"RTN","SAMINOT1",728,0)
OUT(ln) ;
"RTN","SAMINOT1",729,0)
 ;
"RTN","SAMINOT1",730,0)
 i $$CRWRAP^SAMITTW(ln,dest,.cnt,80) q  ;
"RTN","SAMINOT1",731,0)
 ;
"RTN","SAMINOT1",732,0)
 s cnt=cnt+1
"RTN","SAMINOT1",733,0)
 n lnn
"RTN","SAMINOT1",734,0)
 ;s debug=1
"RTN","SAMINOT1",735,0)
 s lnn=$o(@dest@(" "),-1)+1
"RTN","SAMINOT1",736,0)
 s @dest@(lnn)=ln
"RTN","SAMINOT1",737,0)
 ;
"RTN","SAMINOT1",738,0)
 ;i $g(debug)=1 d  ;
"RTN","SAMINOT1",739,0)
 ;. i ln["<" q  ; no markup
"RTN","SAMINOT1",740,0)
 ;. n zs s zs=$STACK
"RTN","SAMINOT1",741,0)
 ;. n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMINOT1",742,0)
 ;. s @dest@(lnn)=zp_":"_ln
"RTN","SAMINOT1",743,0)
 ;
"RTN","SAMINOT1",744,0)
 quit  ; end of OUT
"RTN","SAMINOT1",745,0)
 ;
"RTN","SAMINOT1",746,0)
 ;
"RTN","SAMINOT1",747,0)
 ;
"RTN","SAMINOT1",748,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMINOT1",749,0)
 ;
"RTN","SAMINOT1",750,0)
 ; vals is passed by name
"RTN","SAMINOT1",751,0)
 ;
"RTN","SAMINOT1",752,0)
 n zr
"RTN","SAMINOT1",753,0)
 s zr=$g(@vals@(var))
"RTN","SAMINOT1",754,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMINOT1",755,0)
 ;
"RTN","SAMINOT1",756,0)
 quit zr ; end of $$XVAL
"RTN","SAMINOT1",757,0)
 ;
"RTN","SAMINOT1",758,0)
 ;
"RTN","SAMINOT1",759,0)
 ;
"RTN","SAMINOT1",760,0)
EOR ; end of routine SAMINOT1
"RTN","SAMINOT2")
0^12^B485555129
"RTN","SAMINOT2",1,0)
SAMINOT2 ;ven/gpl - followup form notes ;2021-10-29t20:27z
"RTN","SAMINOT2",2,0)
 ;;18.0;SAMI;**1,9,12,15**;2020-01;Build 2
"RTN","SAMINOT2",3,0)
 ;;18-15
"RTN","SAMINOT2",4,0)
 ;
"RTN","SAMINOT2",5,0)
 ; SAMINOT2 contains web services & other subroutines for producing
"RTN","SAMINOT2",6,0)
 ; the ELCAP Followup Form Notes.
"RTN","SAMINOT2",7,0)
 ;
"RTN","SAMINOT2",8,0)
 quit  ; no entry from top
"RTN","SAMINOT2",9,0)
 ;
"RTN","SAMINOT2",10,0)
 ;
"RTN","SAMINOT2",11,0)
 ;
"RTN","SAMINOT2",12,0)
 ;@section 0 primary development
"RTN","SAMINOT2",13,0)
 ;
"RTN","SAMINOT2",14,0)
 ;
"RTN","SAMINOT2",15,0)
 ;
"RTN","SAMINOT2",16,0)
 ;@license see routine SAMIUL
"RTN","SAMINOT2",17,0)
 ;@documentation see SAMINUL
"RTN","SAMINOT2",18,0)
 ;@contents
"RTN","SAMINOT2",19,0)
 ; WSNOTE web service to return text note
"RTN","SAMINOT2",20,0)
 ; $$NOTE create note
"RTN","SAMINOT2",21,0)
 ; $$HASINNT is intake note present?
"RTN","SAMINOT2",22,0)
 ; $$HASVCNT is communication note present?
"RTN","SAMINOT2",23,0)
 ; $$HASLCSNT is lung cancer screening note present?
"RTN","SAMINOT2",24,0)
 ; MKVC make communication note
"RTN","SAMINOT2",25,0)
 ; MKLCS make lung cancer screening note
"RTN","SAMINOT2",26,0)
 ; $$MKNT make note w/date=now
"RTN","SAMINOT2",27,0)
 ; $$MKNTLOC make note
"RTN","SAMINOT2",28,0)
 ; $$NTDTTM convert date/time fr/fm to/note format
"RTN","SAMINOT2",29,0)
 ; $$NTLOCN location of nth note
"RTN","SAMINOT2",30,0)
 ; $$NTLAST location of latest note of a type
"RTN","SAMINOT2",31,0)
 ; NTLIST return note list
"RTN","SAMINOT2",32,0)
 ; TLST test NTLIST
"RTN","SAMINOT2",33,0)
 ; VCNOTE veteran communication note
"RTN","SAMINOT2",34,0)
 ; SSTATUS smoking status
"RTN","SAMINOT2",35,0)
 ; LCSNOTE lung cancer screening note
"RTN","SAMINOT2",36,0)
 ; OUT output new line to note
"RTN","SAMINOT2",37,0)
 ; $$XVAL value of form variable
"RTN","SAMINOT2",38,0)
 ; $$PREVCT key to previous ct eval form
"RTN","SAMINOT2",39,0)
 ; CTINFO extracts from latest ct eval form
"RTN","SAMINOT2",40,0)
 ; IMPRESS impressions from ct eval report
"RTN","SAMINOT2",41,0)
 ; $$XSUB dictionary value for variable
"RTN","SAMINOT2",42,0)
 ;
"RTN","SAMINOT2",43,0)
 ;
"RTN","SAMINOT2",44,0)
 ;
"RTN","SAMINOT2",45,0)
 ;@section 1 wsi WSNOTE & related subroutines
"RTN","SAMINOT2",46,0)
 ;
"RTN","SAMINOT2",47,0)
 ;
"RTN","SAMINOT2",48,0)
 ;
"RTN","SAMINOT2",49,0)
 ;@wsi WSNOTE^SAMINOT2, vapals-elcap followup note
"RTN","SAMINOT2",50,0)
WSNOTE(return,filter) ; web service to return text note
"RTN","SAMINOT2",51,0)
 ;
"RTN","SAMINOT2",52,0)
 ;ven/gpl;web service;procedure;
"RTN","SAMINOT2",53,0)
 ;
"RTN","SAMINOT2",54,0)
 n debug s debug=0
"RTN","SAMINOT2",55,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMINOT2",56,0)
 ;
"RTN","SAMINOT2",57,0)
 k return
"RTN","SAMINOT2",58,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMINOT2",59,0)
 ;
"RTN","SAMINOT2",60,0)
 n si
"RTN","SAMINOT2",61,0)
 s si=$g(filter("studyid"))
"RTN","SAMINOT2",62,0)
 i si="" d  ;
"RTN","SAMINOT2",63,0)
 . s si="XXX00333"
"RTN","SAMINOT2",64,0)
 q:si=""
"RTN","SAMINOT2",65,0)
 ;
"RTN","SAMINOT2",66,0)
 n samikey
"RTN","SAMINOT2",67,0)
 s samikey=$g(filter("form"))
"RTN","SAMINOT2",68,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT2",69,0)
 i samikey="" d  ;
"RTN","SAMINOT2",70,0)
 . s samikey=$o(@root@("graph",si,"siform"))
"RTN","SAMINOT2",71,0)
 . ;w !,samikey
"RTN","SAMINOT2",72,0)
 . ;b
"RTN","SAMINOT2",73,0)
 ;
"RTN","SAMINOT2",74,0)
 n vals
"RTN","SAMINOT2",75,0)
 m vals=@root@("graph",si,samikey)
"RTN","SAMINOT2",76,0)
 ;
"RTN","SAMINOT2",77,0)
 n note,nien,ntype
"RTN","SAMINOT2",78,0)
 s ntype=""
"RTN","SAMINOT2",79,0)
 s note=""
"RTN","SAMINOT2",80,0)
 s nien=$g(filter("nien"))
"RTN","SAMINOT2",81,0)
 i nien="" d
"RTN","SAMINOT2",82,0)
 . s:$g(vals("samistatus"))="complete" ntype="intake"
"RTN","SAMINOT2",83,0)
 . s:$g(vals("samistatus"))="chart-eligibility" ntype="eligibility"
"RTN","SAMINOT2",84,0)
 . s:$g(vals("samistatus"))="pre-enrollment-discussion" ntype="pre-note"
"RTN","SAMINOT2",85,0)
 . q:ntype=""
"RTN","SAMINOT2",86,0)
 . ;d nien=$$NTTYPE add code to pull the latest note by type
"RTN","SAMINOT2",87,0)
 q:nien=""
"RTN","SAMINOT2",88,0)
 n notebase
"RTN","SAMINOT2",89,0)
 s notebase=$$NTLOCN(si,samikey,nien) ; global location for the note
"RTN","SAMINOT2",90,0)
 s note=$na(@notebase@("text"))
"RTN","SAMINOT2",91,0)
 i '$d(@note) q
"RTN","SAMINOT2",92,0)
 ;
"RTN","SAMINOT2",93,0)
 new temp,tout
"RTN","SAMINOT2",94,0)
 do GETTMPL^SAMICASE("temp","vapals:note")
"RTN","SAMINOT2",95,0)
 quit:'$data(temp)
"RTN","SAMINOT2",96,0)
 ;
"RTN","SAMINOT2",97,0)
 n cnt s cnt=0
"RTN","SAMINOT2",98,0)
 n zi s zi=""
"RTN","SAMINOT2",99,0)
 ;
"RTN","SAMINOT2",100,0)
 f  s zi=$o(temp(zi)) q:zi=""  d  ;
"RTN","SAMINOT2",101,0)
 . ;
"RTN","SAMINOT2",102,0)
 . n line s line=temp(zi)
"RTN","SAMINOT2",103,0)
 . D LOAD^SAMIFORM(.line,samikey,si,.filter,.vals)
"RTN","SAMINOT2",104,0)
 . s temp(zi)=line
"RTN","SAMINOT2",105,0)
 . ;
"RTN","SAMINOT2",106,0)
 . s cnt=cnt+1
"RTN","SAMINOT2",107,0)
 . s tout(cnt)=temp(zi)
"RTN","SAMINOT2",108,0)
 . ;
"RTN","SAMINOT2",109,0)
 . i temp(zi)["report-text" d  ;
"RTN","SAMINOT2",110,0)
 . . i temp(zi)["#" q  ;
"RTN","SAMINOT2",111,0)
 . . n zj s zj=""
"RTN","SAMINOT2",112,0)
 . . f  s zj=$o(@note@(zj)) q:zj=""  d  ;
"RTN","SAMINOT2",113,0)
 . . . s cnt=cnt+1
"RTN","SAMINOT2",114,0)
 . . . ;s tout(cnt)=@note@(zj)_"<br>"
"RTN","SAMINOT2",115,0)
 . . . s tout(cnt)=@note@(zj)_$char(13,10)
"RTN","SAMINOT2",116,0)
 m return=tout
"RTN","SAMINOT2",117,0)
 ;
"RTN","SAMINOT2",118,0)
 quit  ; end of wsi WSNOTE^SAMINOT2
"RTN","SAMINOT2",119,0)
 ;
"RTN","SAMINOT2",120,0)
 ;
"RTN","SAMINOT2",121,0)
 ;
"RTN","SAMINOT2",122,0)
NOTE(filter) ; extrnisic to create note
"RTN","SAMINOT2",123,0)
 ;
"RTN","SAMINOT2",124,0)
 ;ven/gpl;private;function;
"RTN","SAMINOT2",125,0)
 ;@output = 1 if successful, 0 if not
"RTN","SAMINOT2",126,0)
 ;
"RTN","SAMINOT2",127,0)
 k ^gpl("funote")
"RTN","SAMINOT2",128,0)
 m ^gpl("funote")=filter
"RTN","SAMINOT2",129,0)
 ;q 0  ; while we are developing
"RTN","SAMINOT2",130,0)
 ;
"RTN","SAMINOT2",131,0)
 ; set up patient values
"RTN","SAMINOT2",132,0)
 ;
"RTN","SAMINOT2",133,0)
 n vals
"RTN","SAMINOT2",134,0)
 ;
"RTN","SAMINOT2",135,0)
 n si
"RTN","SAMINOT2",136,0)
 s si=$g(filter("studyid"))
"RTN","SAMINOT2",137,0)
 q:si="" 0
"RTN","SAMINOT2",138,0)
 ;
"RTN","SAMINOT2",139,0)
 n samikey
"RTN","SAMINOT2",140,0)
 s samikey=$g(filter("form"))
"RTN","SAMINOT2",141,0)
 q:samikey="" 0
"RTN","SAMINOT2",142,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT2",143,0)
 ;
"RTN","SAMINOT2",144,0)
 s vals=$na(@root@("graph",si,samikey))
"RTN","SAMINOT2",145,0)
 ;
"RTN","SAMINOT2",146,0)
 i '$d(@vals) d  q 0 ;
"RTN","SAMINOT2",147,0)
 . ;w !,"error, patient values not found"
"RTN","SAMINOT2",148,0)
 ;zwr @vals@(*)
"RTN","SAMINOT2",149,0)
 ;
"RTN","SAMINOT2",150,0)
 n vetstxt s vetstxt="veteran"
"RTN","SAMINOT2",151,0)
 n vetstxt2 s vetstxt2="Veteran"
"RTN","SAMINOT2",152,0)
 ;i $g(filter("veteransAffairsSite"))="false" d  ;
"RTN","SAMINOT2",153,0)
 i '$$ISVA^SAMIPARM(.filter) d  ;
"RTN","SAMINOT2",154,0)
 . set vetstxt="participant"
"RTN","SAMINOT2",155,0)
 . set vetstxt2="Participant"
"RTN","SAMINOT2",156,0)
 set filter("vetstxt")=vetstxt
"RTN","SAMINOT2",157,0)
 ;
"RTN","SAMINOT2",158,0)
 k ^SAMIUL("NOTE")
"RTN","SAMINOT2",159,0)
 m ^SAMIUL("NOTE","vals")=@vals
"RTN","SAMINOT2",160,0)
 m ^SAMIUL("NOTE","filter")=filter
"RTN","SAMINOT2",161,0)
 ;
"RTN","SAMINOT2",162,0)
 n didnote s didnote=0
"RTN","SAMINOT2",163,0)
 ;
"RTN","SAMINOT2",164,0)
 i $d(@vals@("notes")) d  q didnote ;
"RTN","SAMINOT2",165,0)
 . s filter("errorMessage")="Note already exists for this form."
"RTN","SAMINOT2",166,0)
 ;
"RTN","SAMINOT2",167,0)
 i $g(@vals@("futype"))="other" d  ;
"RTN","SAMINOT2",168,0)
 . i $g(@vals@("samistatus"))'="complete" q  ;
"RTN","SAMINOT2",169,0)
 . ;q:$$HASVCNT(vals)
"RTN","SAMINOT2",170,0)
 . d MKVC(si,samikey,vals,.filter) ;
"RTN","SAMINOT2",171,0)
 . s didnote=1
"RTN","SAMINOT2",172,0)
 ;
"RTN","SAMINOT2",173,0)
 i $g(@vals@("futype"))="ct" d  ;
"RTN","SAMINOT2",174,0)
 . i $g(@vals@("samistatus"))'="complete" q  ;
"RTN","SAMINOT2",175,0)
 . ;q:$$HASLCSNT(vals)
"RTN","SAMINOT2",176,0)
 . n ctdt,ctkey
"RTN","SAMINOT2",177,0)
 . s ctdt=$$LASTCMP^SAMICAS3(si,.ctkey)
"RTN","SAMINOT2",178,0)
 . i ctdt=-1 d  q  ;
"RTN","SAMINOT2",179,0)
 . . s filter("errorMessage")="No CT Eval form exists, followup note not created."
"RTN","SAMINOT2",180,0)
 . d MKLCS(si,samikey,vals,.filter) ;
"RTN","SAMINOT2",181,0)
 . s didnote=1
"RTN","SAMINOT2",182,0)
 ;
"RTN","SAMINOT2",183,0)
 ;i $g(@vals@("samistatus"))="complete" d  ;
"RTN","SAMINOT2",184,0)
 ;. q:$$HASVCNT(vals)
"RTN","SAMINOT2",185,0)
 ;. d MKVC(si,samikey,vals,.filter) ;
"RTN","SAMINOT2",186,0)
 ;. s didnote=1
"RTN","SAMINOT2",187,0)
 ;
"RTN","SAMINOT2",188,0)
 quit didnote ; end of $$NOTE
"RTN","SAMINOT2",189,0)
 ;
"RTN","SAMINOT2",190,0)
 ;
"RTN","SAMINOT2",191,0)
 ;
"RTN","SAMINOT2",192,0)
HASINNT(vals) ; is intake note present?
"RTN","SAMINOT2",193,0)
 ;
"RTN","SAMINOT2",194,0)
 ;ven/gpl;private;function;
"RTN","SAMINOT2",195,0)
 ;@output = 1 if intake note is present, 0 if not
"RTN","SAMINOT2",196,0)
 ;
"RTN","SAMINOT2",197,0)
 n zzi,zzrtn s (zzi,zzrtn)=0
"RTN","SAMINOT2",198,0)
 q:'$d(@vals)
"RTN","SAMINOT2",199,0)
 f  s zzi=$o(@vals@("notes",zzi)) q:+zzi=0  d  ;
"RTN","SAMINOT2",200,0)
 . i $g(@vals@("notes",zzi,"name"))["Intake" s zzrtn=1
"RTN","SAMINOT2",201,0)
 ;
"RTN","SAMINOT2",202,0)
 quit zzrtn ; end of $$HASINNT
"RTN","SAMINOT2",203,0)
 ;
"RTN","SAMINOT2",204,0)
 ;
"RTN","SAMINOT2",205,0)
 ;
"RTN","SAMINOT2",206,0)
HASVCNT(vals) ; is communication note present?
"RTN","SAMINOT2",207,0)
 ;
"RTN","SAMINOT2",208,0)
 ;ven/gpl;private;function;
"RTN","SAMINOT2",209,0)
 ;@output = 1 if communication note is present, 0 if not
"RTN","SAMINOT2",210,0)
 ;
"RTN","SAMINOT2",211,0)
 n zzi,zzrtn s (zzi,zzrtn)=0
"RTN","SAMINOT2",212,0)
 q:'$d(@vals)
"RTN","SAMINOT2",213,0)
 f  s zzi=$o(@vals@("notes",zzi)) q:+zzi=0  d  ;
"RTN","SAMINOT2",214,0)
 . i $g(@vals@("notes",zzi,"name"))["Communication" s zzrtn=1
"RTN","SAMINOT2",215,0)
 ;
"RTN","SAMINOT2",216,0)
 quit zzrtn ; end of $$HASVCNT
"RTN","SAMINOT2",217,0)
 ;
"RTN","SAMINOT2",218,0)
 ;
"RTN","SAMINOT2",219,0)
 ;
"RTN","SAMINOT2",220,0)
HASLCSNT(vals) ; is lung cancer screening note present?
"RTN","SAMINOT2",221,0)
 ;
"RTN","SAMINOT2",222,0)
 ;ven/gpl;private;function;
"RTN","SAMINOT2",223,0)
 ;@output = 1 if communication note is present, 0 if not
"RTN","SAMINOT2",224,0)
 ;
"RTN","SAMINOT2",225,0)
 n zzi,zzrtn s (zzi,zzrtn)=0
"RTN","SAMINOT2",226,0)
 q:'$d(@vals)
"RTN","SAMINOT2",227,0)
 f  s zzi=$o(@vals@("notes",zzi)) q:+zzi=0  d  ;
"RTN","SAMINOT2",228,0)
 . i $g(@vals@("notes",zzi,"name"))["Lung" s zzrtn=1
"RTN","SAMINOT2",229,0)
 ;
"RTN","SAMINOT2",230,0)
 quit zzrtn ; end of $$HASLCSNT
"RTN","SAMINOT2",231,0)
 ;
"RTN","SAMINOT2",232,0)
 ;
"RTN","SAMINOT2",233,0)
 ;
"RTN","SAMINOT2",234,0)
MKVC(sid,form,vals,filter) ; make communication note
"RTN","SAMINOT2",235,0)
 ;
"RTN","SAMINOT2",236,0)
 ;ven/gpl;private;procedure;
"RTN","SAMINOT2",237,0)
 ;
"RTN","SAMINOT2",238,0)
 n cnt s cnt=0
"RTN","SAMINOT2",239,0)
 ;n dest s dest=$na(@vals@("communication-note"))
"RTN","SAMINOT2",240,0)
 n dest s dest=$$MKNT(vals,"Communication Note","communication",.filter)
"RTN","SAMINOT2",241,0)
 k @dest
"RTN","SAMINOT2",242,0)
 d OUT(vetstxt2_" Communication Note")
"RTN","SAMINOT2",243,0)
 d OUT("")
"RTN","SAMINOT2",244,0)
 d VCNOTE(vals,dest,cnt,.filter)
"RTN","SAMINOT2",245,0)
 ;
"RTN","SAMINOT2",246,0)
 quit  ; end of MKVC
"RTN","SAMINOT2",247,0)
 ;
"RTN","SAMINOT2",248,0)
 ;
"RTN","SAMINOT2",249,0)
 ;
"RTN","SAMINOT2",250,0)
MKLCS(sid,form,vals,filter) ; make lung cancer screening note
"RTN","SAMINOT2",251,0)
 ;
"RTN","SAMINOT2",252,0)
 ;ven/gpl;private;procedure;
"RTN","SAMINOT2",253,0)
 ;
"RTN","SAMINOT2",254,0)
 n cnt s cnt=0
"RTN","SAMINOT2",255,0)
 ;n dest s dest=$na(@vals@("lcs-note"))
"RTN","SAMINOT2",256,0)
 n dest s dest=$$MKNT(vals,"Lung Cancer Screening Note","lcs",.filter)
"RTN","SAMINOT2",257,0)
 k @dest
"RTN","SAMINOT2",258,0)
 d OUT("Lung Screening and Surveillance Follow up Note")
"RTN","SAMINOT2",259,0)
 d OUT("")
"RTN","SAMINOT2",260,0)
 d LCSNOTE(vals,dest,cnt,.filter)
"RTN","SAMINOT2",261,0)
 ;
"RTN","SAMINOT2",262,0)
 quit  ; end of MKLCS
"RTN","SAMINOT2",263,0)
 ;
"RTN","SAMINOT2",264,0)
 ;
"RTN","SAMINOT2",265,0)
 ;
"RTN","SAMINOT2",266,0)
MKNT(vals,title,ntype,filter) ; make note w/date=now
"RTN","SAMINOT2",267,0)
 ;
"RTN","SAMINOT2",268,0)
 ;ven/gpl;private;pseudo-function;
"RTN","SAMINOT2",269,0)
 ;@input
"RTN","SAMINOT2",270,0)
 ; .filter (passed by reference)
"RTN","SAMINOT2",271,0)
 ;@output = global address
"RTN","SAMINOT2",272,0)
 ;
"RTN","SAMINOT2",273,0)
 n ntdt s ntdt=$$NTDTTM($$NOW^XLFDT)
"RTN","SAMINOT2",274,0)
 n ntptr
"RTN","SAMINOT2",275,0)
 s ntptr=$$MKNTLOC(vals,title,ntdt,$g(ntype),.filter)
"RTN","SAMINOT2",276,0)
 ;
"RTN","SAMINOT2",277,0)
 quit ntptr ; end of $$MKNT
"RTN","SAMINOT2",278,0)
 ;
"RTN","SAMINOT2",279,0)
 ;
"RTN","SAMINOT2",280,0)
 ;
"RTN","SAMINOT2",281,0)
MKNTLOC(vals,title,ndate,ntype,filter) ; make note
"RTN","SAMINOT2",282,0)
 ;
"RTN","SAMINOT2",283,0)
 ;ven/gpl;private;pseudo-function;
"RTN","SAMINOT2",284,0)
 ;@output = note location (global address)
"RTN","SAMINOT2",285,0)
 ;
"RTN","SAMINOT2",286,0)
 n nien
"RTN","SAMINOT2",287,0)
 s nien=$o(@vals@("notes",""),-1)+1
"RTN","SAMINOT2",288,0)
 s filter("nien")=nien
"RTN","SAMINOT2",289,0)
 n nloc s nloc=$na(@vals@("notes",nien))
"RTN","SAMINOT2",290,0)
 s @nloc@("name")=title_" "_$g(ndate)
"RTN","SAMINOT2",291,0)
 s @nloc@("date")=$g(ndate)
"RTN","SAMINOT2",292,0)
 s @nloc@("type")=$g(ntype)
"RTN","SAMINOT2",293,0)
 ;
"RTN","SAMINOT2",294,0)
 quit $na(@nloc@("text"))
"RTN","SAMINOT2",295,0)
 ;
"RTN","SAMINOT2",296,0)
 ;
"RTN","SAMINOT2",297,0)
 ;
"RTN","SAMINOT2",298,0)
NTDTTM(ZFMDT) ; convert date/time fr/fm to/note format
"RTN","SAMINOT2",299,0)
 ;
"RTN","SAMINOT2",300,0)
 ;ven/gpl;private;function;
"RTN","SAMINOT2",301,0)
 ;@input
"RTN","SAMINOT2",302,0)
 ; ZFMDT = fileman date/time to translate
"RTN","SAMINOT2",303,0)
 ;@output = date/time in note format
"RTN","SAMINOT2",304,0)
 ;
"RTN","SAMINOT2",305,0)
 quit $$FMTE^XLFDT(ZFMDT,"5") ; end of $$NTDTTM
"RTN","SAMINOT2",306,0)
 ;
"RTN","SAMINOT2",307,0)
 ;
"RTN","SAMINOT2",308,0)
 ;
"RTN","SAMINOT2",309,0)
NTLOCN(sid,form,nien) ; location of nth note
"RTN","SAMINOT2",310,0)
 ;
"RTN","SAMINOT2",311,0)
 ;ven/gpl;private;function;
"RTN","SAMINOT2",312,0)
 ;@output = global location of Nth note
"RTN","SAMINOT2",313,0)
 ;
"RTN","SAMINOT2",314,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT2",315,0)
 ;
"RTN","SAMINOT2",316,0)
 quit $na(@root@("graph",sid,form,"notes",nien)) ; end of $$NTLOCN
"RTN","SAMINOT2",317,0)
 ;
"RTN","SAMINOT2",318,0)
 ;
"RTN","SAMINOT2",319,0)
 ;
"RTN","SAMINOT2",320,0)
NTLAST(sid,form,ntype) ; location of latest note of a type
"RTN","SAMINOT2",321,0)
 ;
"RTN","SAMINOT2",322,0)
 ;ven/gpl;private;function;
"RTN","SAMINOT2",323,0)
 ;@input
"RTN","SAMINOT2",324,0)
 ; ntype = type of note
"RTN","SAMINOT2",325,0)
 ;@output = global location of latest note of type ntype
"RTN","SAMINOT2",326,0)
 ;
"RTN","SAMINOT2",327,0)
 ; not yet written
"RTN","SAMINOT2",328,0)
 ;
"RTN","SAMINOT2",329,0)
 quit  ; end of $$NTLAST
"RTN","SAMINOT2",330,0)
 ;
"RTN","SAMINOT2",331,0)
 ;
"RTN","SAMINOT2",332,0)
 ;
"RTN","SAMINOT2",333,0)
NTLIST(nlist,sid,form) ; return note list
"RTN","SAMINOT2",334,0)
 ;
"RTN","SAMINOT2",335,0)
 ;ven/gpl;private;procedure;
"RTN","SAMINOT2",336,0)
 ;@output
"RTN","SAMINOT2",337,0)
 ; .nlist = note list [pass by reference]
"RTN","SAMINOT2",338,0)
 ;
"RTN","SAMINOT2",339,0)
 n zn,root,gn
"RTN","SAMINOT2",340,0)
 s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT2",341,0)
 s zn=0
"RTN","SAMINOT2",342,0)
 s gn=$na(@root@("graph",sid,form,"notes"))
"RTN","SAMINOT2",343,0)
 q:'$d(@gn)
"RTN","SAMINOT2",344,0)
 f  s zn=$o(@gn@(zn)) q:+zn=0  d  ;
"RTN","SAMINOT2",345,0)
 . s @nlist@(zn,"name")=@gn@(zn,"name")
"RTN","SAMINOT2",346,0)
 . s @nlist@(zn,"nien")=zn
"RTN","SAMINOT2",347,0)
 ;
"RTN","SAMINOT2",348,0)
 quit  ; end of NTLIST
"RTN","SAMINOT2",349,0)
 ;
"RTN","SAMINOT2",350,0)
 ;
"RTN","SAMINOT2",351,0)
 ;
"RTN","SAMINOT2",352,0)
TLST ; test NTLIST
"RTN","SAMINOT2",353,0)
 ;
"RTN","SAMINOT2",354,0)
 ;ven/gpl;test;procedure;
"RTN","SAMINOT2",355,0)
 ;
"RTN","SAMINOT2",356,0)
 set SID="XXX00677"
"RTN","SAMINOT2",357,0)
 set FORM="siform-2019-04-23"
"RTN","SAMINOT2",358,0)
 do NTLIST("G",SID,FORM)
"RTN","SAMINOT2",359,0)
 ;
"RTN","SAMINOT2",360,0)
 ; zwrite G
"RTN","SAMINOT2",361,0)
 ;
"RTN","SAMINOT2",362,0)
 quit  ; end of TLST
"RTN","SAMINOT2",363,0)
 ;
"RTN","SAMINOT2",364,0)
 ;
"RTN","SAMINOT2",365,0)
 ;
"RTN","SAMINOT2",366,0)
VCNOTE(vals,dest,cnt,filter) ; veteran communication note
"RTN","SAMINOT2",367,0)
 ;
"RTN","SAMINOT2",368,0)
 ;ven/gpl;private;procedure;
"RTN","SAMINOT2",369,0)
 ;
"RTN","SAMINOT2",370,0)
 ; do OUT("")
"RTN","SAMINOT2",371,0)
 ;
"RTN","SAMINOT2",372,0)
 d OUT(vetstxt2_" was contacted via:")
"RTN","SAMINOT2",373,0)
 n sp1 s sp1="    "
"RTN","SAMINOT2",374,0)
 d:$$XVAL("fucmotip",vals) OUT(sp1_"In person")
"RTN","SAMINOT2",375,0)
 d:$$XVAL("fucmotte",vals) OUT(sp1_"Telephone")
"RTN","SAMINOT2",376,0)
 d:$$XVAL("fucmotth",vals) OUT(sp1_"TeleHealth")
"RTN","SAMINOT2",377,0)
 d:$$XVAL("fucmotml",vals) OUT(sp1_"Mailed Letter")
"RTN","SAMINOT2",378,0)
 d:$$XVAL("fucmotpp",vals) OUT(sp1_"Message in patient portal")
"RTN","SAMINOT2",379,0)
 d:$$XVAL("fucmotvd",vals) OUT(sp1_"Video-on-demand (VOD)")
"RTN","SAMINOT2",380,0)
 d:$$XVAL("fucmotot",vals) OUT(sp1_"Other: "_$$XVAL("fucmotoo",vals))
"RTN","SAMINOT2",381,0)
 d OUT("")
"RTN","SAMINOT2",382,0)
 ;
"RTN","SAMINOT2",383,0)
 d:$$XVAL("fucmotde",vals)'=""
"RTN","SAMINOT2",384,0)
 . d OUT("Communication details:")
"RTN","SAMINOT2",385,0)
 . d OUT(sp1_$$XVAL("fucmotde",vals))
"RTN","SAMINOT2",386,0)
 ;
"RTN","SAMINOT2",387,0)
 d SSTATUS(vals) ; insert smoking status section
"RTN","SAMINOT2",388,0)
 ;
"RTN","SAMINOT2",389,0)
 quit  ; end of VCNOTE
"RTN","SAMINOT2",390,0)
 ;
"RTN","SAMINOT2",391,0)
 ;
"RTN","SAMINOT2",392,0)
 ;
"RTN","SAMINOT2",393,0)
SSTATUS(vals) ; smoking status
"RTN","SAMINOT2",394,0)
 ;
"RTN","SAMINOT2",395,0)
 ;ven/gpl;private;procedure;
"RTN","SAMINOT2",396,0)
 ;
"RTN","SAMINOT2",397,0)
 n sstat s sstat=""
"RTN","SAMINOT2",398,0)
 i $$XVAL("sisa",vals)="y" d  ; 
"RTN","SAMINOT2",399,0)
 . s sstat="Current"
"RTN","SAMINOT2",400,0)
 . d OUT("Smoking status: "_sstat)
"RTN","SAMINOT2",401,0)
 . d OUT(sp1_"Current cigarette smoker (patient advised that active tobacco use")
"RTN","SAMINOT2",402,0)
 . d OUT(sp1_"increases risk of future lung cancer, heart disease and stroke,")
"RTN","SAMINOT2",403,0)
 . d OUT(sp1_"advised stability now does not guarantee will not develop future")
"RTN","SAMINOT2",404,0)
 . d OUT(sp1_"lung cancer or risks of premature death from tobacco related heart")
"RTN","SAMINOT2",405,0)
 . d OUT(sp1_"disease and stroke)")
"RTN","SAMINOT2",406,0)
 i $$XVAL("sisa",vals)="n" d  ;
"RTN","SAMINOT2",407,0)
 . s sstat="Former"
"RTN","SAMINOT2",408,0)
 . d OUT("Smoking status: "_sstat)
"RTN","SAMINOT2",409,0)
 . n qdate s qdate=""
"RTN","SAMINOT2",410,0)
 . s qdate=$$XVAL("siq",vals)
"RTN","SAMINOT2",411,0)
 . i qdate'="" d OUT(sp1_"Former cigarette smoker. Quit date: "_qdate)
"RTN","SAMINOT2",412,0)
 . e  d OUT(sp1_"Former cigarette smoker.")
"RTN","SAMINOT2",413,0)
 i $$XVAL("sisa",vals)="o" d  ;
"RTN","SAMINOT2",414,0)
 . s sstat="Never"
"RTN","SAMINOT2",415,0)
 . d OUT("Smoking status: "_sstat)
"RTN","SAMINOT2",416,0)
 . d OUT(sp1_"Never cigarette smoker")
"RTN","SAMINOT2",417,0)
 ;
"RTN","SAMINOT2",418,0)
 n cumary
"RTN","SAMINOT2",419,0)
 d CUMPY^SAMIUR2("cumary",sid,form)
"RTN","SAMINOT2",420,0)
 k ^gpl("funote","cumary")
"RTN","SAMINOT2",421,0)
 m ^gpl("funote","cumary")=cumary
"RTN","SAMINOT2",422,0)
 n cur s cur=$g(cumary("current"))
"RTN","SAMINOT2",423,0)
 n newcum s newcum=$g(cumary("rpt",cur,4)) ; new cumulative pack years
"RTN","SAMINOT2",424,0)
 ;
"RTN","SAMINOT2",425,0)
 i $$XVAL("sisa",vals)="y" d  ;  
"RTN","SAMINOT2",426,0)
 . d OUT("Smoking history (since last visit):")
"RTN","SAMINOT2",427,0)
 . d OUT(sp1_"Cigarettes/day: "_$$XVAL("sicpd",vals))
"RTN","SAMINOT2",428,0)
 . d OUT(sp1_"PPD: "_$$XVAL("sippd",vals))
"RTN","SAMINOT2",429,0)
 . d OUT(sp1_"Current cumulative pack years: "_newcum)
"RTN","SAMINOT2",430,0)
 i $$XVAL("sisa",vals)'="y" d  ;  
"RTN","SAMINOT2",431,0)
 . d OUT("Smoking History")
"RTN","SAMINOT2",432,0)
 n zi
"RTN","SAMINOT2",433,0)
 f zi=1:1:cur d  ;
"RTN","SAMINOT2",434,0)
 . d OUT(sp1_cumary("rpt",zi,1)_" "_cumary("rpt",zi,2))
"RTN","SAMINOT2",435,0)
 . d OUT(sp1_sp1_"Pack Years: "_cumary("rpt",zi,3))
"RTN","SAMINOT2",436,0)
 . d OUT(sp1_sp1_"Cumulative: "_cumary("rpt",zi,4))
"RTN","SAMINOT2",437,0)
 ;
"RTN","SAMINOT2",438,0)
 n tried s tried=$$XVAL("sittq",vals)
"RTN","SAMINOT2",439,0)
 n ptried s ptried=$s(tried="y":"Yes",tried="n":"No",tried="o":"Not applicable",1:"")
"RTN","SAMINOT2",440,0)
 i ptried'="" d OUT("Since your prior CT scan have you ever tried to quit smoking? "_ptried)
"RTN","SAMINOT2",441,0)
 ;
"RTN","SAMINOT2",442,0)
 n tryary,cnt
"RTN","SAMINOT2",443,0)
 s cnt=0
"RTN","SAMINOT2",444,0)
 i $$XVAL("sisca",vals)'="" s cnt=cnt+1 s tryary(cnt)="Have not tried to quit"
"RTN","SAMINOT2",445,0)
 i $$XVAL("siscb",vals)'="" s cnt=cnt+1 s tryary(cnt)="""Cold Turkey"" by completely stopping on your own with no other assistance"
"RTN","SAMINOT2",446,0)
 i $$XVAL("siscc",vals)'="" s cnt=cnt+1 s tryary(cnt)="Tapering or reducing number of cigarettes smoked per day"
"RTN","SAMINOT2",447,0)
 i $$XVAL("siscd",vals)'="" s cnt=cnt+1 s tryary(cnt)="Self-help material (e.g., brochure, cessation website)"
"RTN","SAMINOT2",448,0)
 i $$XVAL("sisce",vals)'="" s cnt=cnt+1 s tryary(cnt)="Individual consultation or cessation counseling"
"RTN","SAMINOT2",449,0)
 i $$XVAL("siscf",vals)'="" s cnt=cnt+1 s tryary(cnt)="Telephone cessation counseling hotline (e.g., 1-855-QUIT-VET, 1-800-QUIT-NOW)"
"RTN","SAMINOT2",450,0)
 i $$XVAL("siscg",vals)'="" s cnt=cnt+1 s tryary(cnt)="Peer support (e.g., Nicotine Anonymous)"
"RTN","SAMINOT2",451,0)
 i $$XVAL("sisch",vals)'="" s cnt=cnt+1 s tryary(cnt)="Nicotine replacement therapy (e.g., patch, gum, inhaler, nasal spray, lozenge)"
"RTN","SAMINOT2",452,0)
 i $$XVAL("sisci",vals)'="" s cnt=cnt+1 s tryary(cnt)="Zyban"
"RTN","SAMINOT2",453,0)
 i $$XVAL("siscj",vals)'="" s cnt=cnt+1 s tryary(cnt)="Hypnosis"
"RTN","SAMINOT2",454,0)
 i $$XVAL("sisck",vals)'="" s cnt=cnt+1 s tryary(cnt)="Acupuncture / acupressure"
"RTN","SAMINOT2",455,0)
 n tryot s tryot=""
"RTN","SAMINOT2",456,0)
 i $$XVAL("siscl",vals)'="" d  ;
"RTN","SAMINOT2",457,0)
 . s cnt=cnt+1 s tryary(cnt)="Other (specify)"
"RTN","SAMINOT2",458,0)
 . s tryot=$$XVAL("siscos",vals)
"RTN","SAMINOT2",459,0)
 ;
"RTN","SAMINOT2",460,0)
 i cnt>0 d  ;
"RTN","SAMINOT2",461,0)
 .  i ptried="" d OUT("Since your prior CT scan have you ever tried to quit smoking? ")
"RTN","SAMINOT2",462,0)
 . n zi s zi=""
"RTN","SAMINOT2",463,0)
 . f  s zi=$o(tryary(zi)) q:zi=""  d  ;
"RTN","SAMINOT2",464,0)
 . . d OUT(sp1_tryary(zi))
"RTN","SAMINOT2",465,0)
 . i tryot'="" d OUT(sp1_sp1_tryot)
"RTN","SAMINOT2",466,0)
 ;
"RTN","SAMINOT2",467,0)
 n cess,cess2 s cess="" s cess2=""
"RTN","SAMINOT2",468,0)
 i $$XVAL("siscmd",vals)="d" s cess="Declined"
"RTN","SAMINOT2",469,0)
 i $$XVAL("siscmd",vals)="a" s cess="Advised to quit smoking; VA resources provided"
"RTN","SAMINOT2",470,0)
 i $$XVAL("siscmd",vals)="i" d  ;
"RTN","SAMINOT2",471,0)
 . s cess="Interested in VA tobacco cessation medication. Encouraged "_vetstxt
"RTN","SAMINOT2",472,0)
 . s cess2="to talk to provider or pharmacist about which medication option is best for you."
"RTN","SAMINOT2",473,0)
 i cess'="" d  ;
"RTN","SAMINOT2",474,0)
 . d OUT("Tobacco cessation provided:")
"RTN","SAMINOT2",475,0)
 . d OUT(sp1_cess)
"RTN","SAMINOT2",476,0)
 . i cess2'="" d OUT(sp1_cess2)
"RTN","SAMINOT2",477,0)
 ;
"RTN","SAMINOT2",478,0)
 quit  ; end of SSTATUS
"RTN","SAMINOT2",479,0)
 ;
"RTN","SAMINOT2",480,0)
 ;
"RTN","SAMINOT2",481,0)
 ;
"RTN","SAMINOT2",482,0)
LCSNOTE(vals,dest,cnt,filter) ; lung cancer screening note
"RTN","SAMINOT2",483,0)
 ;
"RTN","SAMINOT2",484,0)
 ;ven/gpl;private;procedure;
"RTN","SAMINOT2",485,0)
 ;
"RTN","SAMINOT2",486,0)
 ; do OUT("")
"RTN","SAMINOT2",487,0)
 ;
"RTN","SAMINOT2",488,0)
 n sp1 s sp1="    "
"RTN","SAMINOT2",489,0)
 d OUT("Initial LDCT/Baseline: "_$$XVAL("sidoe",vals))
"RTN","SAMINOT2",490,0)
 d OUT("Date of most recent CT/LDCT: "_$$XVAL("fulctdt",vals))
"RTN","SAMINOT2",491,0)
 d OUT(sp1_"Notification of Results: "_$$XVAL("sidof",vals))
"RTN","SAMINOT2",492,0)
 n addcmt s addcmt=$$XVAL("fucmctde",vals)
"RTN","SAMINOT2",493,0)
 i addcmt'="" d  ;
"RTN","SAMINOT2",494,0)
 . d OUT("Additional comments:")
"RTN","SAMINOT2",495,0)
 . d OUT(sp1_addcmt)
"RTN","SAMINOT2",496,0)
 n impress s impress=""
"RTN","SAMINOT2",497,0)
 n ctary
"RTN","SAMINOT2",498,0)
 d CTINFO("ctary",sid,form)
"RTN","SAMINOT2",499,0)
 s impress=$g(ctary("impression"))
"RTN","SAMINOT2",500,0)
 ; get impression from lastest CT Eval here
"RTN","SAMINOT2",501,0)
 d IMPRESS("ctary",sid)
"RTN","SAMINOT2",502,0)
 ;i impress'="" d  ;
"RTN","SAMINOT2",503,0)
 ;. d OUT("Impression:")
"RTN","SAMINOT2",504,0)
 ;. d OUT(sp1_impress)
"RTN","SAMINOT2",505,0)
 ; smoking status follows
"RTN","SAMINOT2",506,0)
 d SSTATUS(vals)
"RTN","SAMINOT2",507,0)
 ;d OUT("Veteran was contacted via:")
"RTN","SAMINOT2",508,0)
 ;n sp1 s sp1="    "
"RTN","SAMINOT2",509,0)
 ;d:$$XVAL("fucmctip",vals) OUT(sp1_"In person")
"RTN","SAMINOT2",510,0)
 ;d:$$XVAL("fucmctte",vals) OUT(sp1_"Telephone")
"RTN","SAMINOT2",511,0)
 ;d:$$XVAL("fucmctth",vals) OUT(sp1_"TeleHealth")
"RTN","SAMINOT2",512,0)
 ;d:$$XVAL("fucmctml",vals) OUT(sp1_"Mailed Letter")
"RTN","SAMINOT2",513,0)
 ;d:$$XVAL("fucmctpp",vals) OUT(sp1_"Message in patient portal")
"RTN","SAMINOT2",514,0)
 ;d:$$XVAL("fucmctvd",vals) OUT(sp1_"Video-on-demand (VOD)")
"RTN","SAMINOT2",515,0)
 ;d:$$XVAL("fucmctot",vals) OUT(sp1_"Other: "_$$XVAL("fucmctoo",vals))
"RTN","SAMINOT2",516,0)
 ;d OUT("")
"RTN","SAMINOT2",517,0)
 ;
"RTN","SAMINOT2",518,0)
 ;d:$$XVAL("fucmctde",vals)'=""
"RTN","SAMINOT2",519,0)
 ;. d OUT("Communication details:")
"RTN","SAMINOT2",520,0)
 ;. d OUT(sp1_$$XVAL("fucmctde",vals))
"RTN","SAMINOT2",521,0)
 n recom s recom=""
"RTN","SAMINOT2",522,0)
 ; get recommendations from CT eval form here
"RTN","SAMINOT2",523,0)
 s recom=$g(ctary("followup"))
"RTN","SAMINOT2",524,0)
 i recom'="" d  ;
"RTN","SAMINOT2",525,0)
 . d OUT("Recommendations:")
"RTN","SAMINOT2",526,0)
 . d OUT(sp1_recom)
"RTN","SAMINOT2",527,0)
 . i $g(ctary("followup2"))'="" d  ;
"RTN","SAMINOT2",528,0)
 . . d OUT(sp1_ctary("followup2"))
"RTN","SAMINOT2",529,0)
 . i $g(ctary("followup3"))'="" d  ;
"RTN","SAMINOT2",530,0)
 . . d OUT(sp1_ctary("followup3"))
"RTN","SAMINOT2",531,0)
 n ordered s ordered=$$XVAL("funewct",vals)
"RTN","SAMINOT2",532,0)
 i ordered'="" d  ;
"RTN","SAMINOT2",533,0)
 . s ordered=$s(ordered="y":"Yes",ordered="n":"No",1:"")
"RTN","SAMINOT2",534,0)
 . d OUT("CT/LDCT ordered: "_ordered)
"RTN","SAMINOT2",535,0)
 n pulmon s pulmon=$$XVAL("fucompul",vals)
"RTN","SAMINOT2",536,0)
 i pulmon'="" d  ;
"RTN","SAMINOT2",537,0)
 . s pulmon=$s(pulmon="y":"Yes",pulmon="n":"No",1:"")
"RTN","SAMINOT2",538,0)
 . d OUT("Communicated to Pulmonary: "_pulmon)
"RTN","SAMINOT2",539,0)
 ;
"RTN","SAMINOT2",540,0)
 quit  ; end of LCSNOTE
"RTN","SAMINOT2",541,0)
 ;
"RTN","SAMINOT2",542,0)
 ;
"RTN","SAMINOT2",543,0)
TOUT(sid) ;
"RTN","SAMINOT2",544,0)
 s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT2",545,0)
 s groot=$na(@root@("graph",sid))
"RTN","SAMINOT2",546,0)
 s g=""
"RTN","SAMINOT2",547,0)
 f  s g=$o(@groot@(g)) q:g=""  d  ;
"RTN","SAMINOT2",548,0)
 . w !,g
"RTN","SAMINOT2",549,0)
 quit
"RTN","SAMINOT2",550,0)
 ;
"RTN","SAMINOT2",551,0)
OUT(ln) ; output new line to note
"RTN","SAMINOT2",552,0)
 ;
"RTN","SAMINOT2",553,0)
 ;ven/gpl;private;procedure;
"RTN","SAMINOT2",554,0)
 ;
"RTN","SAMINOT2",555,0)
 i $$CRWRAP^SAMITTW(ln,dest,.cnt,80) q  ;
"RTN","SAMINOT2",556,0)
 ;
"RTN","SAMINOT2",557,0)
 s cnt=cnt+1
"RTN","SAMINOT2",558,0)
 n lnn
"RTN","SAMINOT2",559,0)
 ;s debug=1
"RTN","SAMINOT2",560,0)
 s lnn=$o(@dest@(" "),-1)+1
"RTN","SAMINOT2",561,0)
 s @dest@(lnn)=ln
"RTN","SAMINOT2",562,0)
 ;
"RTN","SAMINOT2",563,0)
 ;i $g(debug)=1 d  ;
"RTN","SAMINOT2",564,0)
 ;. i ln["<" q  ; no markup
"RTN","SAMINOT2",565,0)
 ;. n zs s zs=$STACK
"RTN","SAMINOT2",566,0)
 ;. n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMINOT2",567,0)
 ;. s @dest@(lnn)=zp_":"_ln
"RTN","SAMINOT2",568,0)
 ;
"RTN","SAMINOT2",569,0)
 quit  ; end of OUT
"RTN","SAMINOT2",570,0)
 ;
"RTN","SAMINOT2",571,0)
 ;
"RTN","SAMINOT2",572,0)
 ;
"RTN","SAMINOT2",573,0)
XVAL(var,vals) ; value of form variable
"RTN","SAMINOT2",574,0)
 ;
"RTN","SAMINOT2",575,0)
 ;ven/gpl;private;function;
"RTN","SAMINOT2",576,0)
 ;@input
"RTN","SAMINOT2",577,0)
 ; var = name of form variable
"RTN","SAMINOT2",578,0)
 ; vals = global root of form variable array
"RTN","SAMINOT2",579,0)
 ; @vals = form variable array [pass by name]
"RTN","SAMINOT2",580,0)
 ;@output = value of form variable
"RTN","SAMINOT2",581,0)
 ;
"RTN","SAMINOT2",582,0)
 new zr
"RTN","SAMINOT2",583,0)
 set zr=$get(@vals@(var))
"RTN","SAMINOT2",584,0)
 ;
"RTN","SAMINOT2",585,0)
 ; i zr="" s zr="["_var_"]"
"RTN","SAMINOT2",586,0)
 ;
"RTN","SAMINOT2",587,0)
 quit zr ; end of $$XVAL
"RTN","SAMINOT2",588,0)
 ;
"RTN","SAMINOT2",589,0)
 ;
"RTN","SAMINOT2",590,0)
 ;
"RTN","SAMINOT2",591,0)
PREVCT(SID,FORM) ; key to previous ct eval form
"RTN","SAMINOT2",592,0)
 ;
"RTN","SAMINOT2",593,0)
 ;ven/gpl;private;function;
"RTN","SAMINOT2",594,0)
 ;@input
"RTN","SAMINOT2",595,0)
 ; FORM = [not yet implemented, always treated as if FORM=""]
"RTN","SAMINOT2",596,0)
 ;@output = form key of CT Eval form previous to FORM
"RTN","SAMINOT2",597,0)
 ;
"RTN","SAMINOT2",598,0)
 ; $$PREVCT returns the form key to the CT Eval form previous to
"RTN","SAMINOT2",599,0)
 ; FORM. If FORM is null, the latest CT Eval form key is returned.
"RTN","SAMINOT2",600,0)
 ;
"RTN","SAMINOT2",601,0)
 new gn set gn=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT2",602,0)
 new prev set prev=$order(@gn@("graph",SID,"ceform-30"),-1)
"RTN","SAMINOT2",603,0)
 ;
"RTN","SAMINOT2",604,0)
 quit prev ; end of $$PREVCT
"RTN","SAMINOT2",605,0)
 ;
"RTN","SAMINOT2",606,0)
 ;
"RTN","SAMINOT2",607,0)
 ;
"RTN","SAMINOT2",608,0)
CTINFO(ARY,SID,FORM) ; extracts from latest CT Eval form
"RTN","SAMINOT2",609,0)
 ;
"RTN","SAMINOT2",610,0)
 ;ven/gpl;private;procedure;
"RTN","SAMINOT2",611,0)
 ;@input
"RTN","SAMINOT2",612,0)
 ; ARY = name of output array
"RTN","SAMINOT2",613,0)
 ; SID
"RTN","SAMINOT2",614,0)
 ; FORM
"RTN","SAMINOT2",615,0)
 ;@output
"RTN","SAMINOT2",616,0)
 ; @ARY = extract from latest ct eval form [passed by name]
"RTN","SAMINOT2",617,0)
 ;
"RTN","SAMINOT2",618,0)
 n ctkey s ctkey=$$PREVCT(SID,$G(FORM))
"RTN","SAMINOT2",619,0)
 q:ctkey=""
"RTN","SAMINOT2",620,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT2",621,0)
 n ctroot s ctroot=$na(@root@("graph",SID,ctkey))
"RTN","SAMINOT2",622,0)
 ;
"RTN","SAMINOT2",623,0)
 s @ARY@("ctform")=ctkey
"RTN","SAMINOT2",624,0)
 s @ARY@("impression")=$g(@ctroot@("ceimre"))
"RTN","SAMINOT2",625,0)
 n futext
"RTN","SAMINOT2",626,0)
 s futext=$g(@ctroot@("cefuw"))
"RTN","SAMINOT2",627,0)
 n futbl
"RTN","SAMINOT2",628,0)
 s futbl("1y")="Annual repeat"
"RTN","SAMINOT2",629,0)
 s futbl("nw")="Now"
"RTN","SAMINOT2",630,0)
 s futbl("1m")="1 month"
"RTN","SAMINOT2",631,0)
 s futbl("3m")="3 months"
"RTN","SAMINOT2",632,0)
 s futbl("6m")="6 months"
"RTN","SAMINOT2",633,0)
 s futbl("os")="other"
"RTN","SAMINOT2",634,0)
 i futext'="" s futext=$g(futbl(futext))
"RTN","SAMINOT2",635,0)
 n fudate s fudate=$g(@ctroot@("cefud"))
"RTN","SAMINOT2",636,0)
 ; #Other followup
"RTN","SAMINOT2",637,0)
 n zfu,ofu,tofu,comma
"RTN","SAMINOT2",638,0)
 n vals s vals=ctroot
"RTN","SAMINOT2",639,0)
 s comma=0,tofu=""
"RTN","SAMINOT2",640,0)
 s ofu=""
"RTN","SAMINOT2",641,0)
 f zfu="cefuaf","cefucc","cefupe","cefufn","cefubr","cefupc","cefutb" d  ;
"RTN","SAMINOT2",642,0)
 . i $$XVAL(zfu,vals)="y" s ofu=ofu_zfu
"RTN","SAMINOT2",643,0)
 i $$XVAL("cefuo",vals)'="" s ofu=ofu_"cefuo"
"RTN","SAMINOT2",644,0)
 i ofu'="" d  ;
"RTN","SAMINOT2",645,0)
 . s tofu="Other followup: "
"RTN","SAMINOT2",646,0)
 . i ofu["cefuaf" s tofu=tofu_"Antibiotics" s comma=1
"RTN","SAMINOT2",647,0)
 . i ofu["cefucc" s tofu=tofu_$s(comma:", ",1:"")_"Diagnostic CT" s comma=1
"RTN","SAMINOT2",648,0)
 . i ofu["cefupe" s tofu=tofu_$s(comma:", ",1:"")_"PET" s comma=1
"RTN","SAMINOT2",649,0)
 . i ofu["cefufn" s tofu=tofu_$s(comma:", ",1:"")_"Percutaneous biopsy" s comma=1
"RTN","SAMINOT2",650,0)
 . i ofu["cefubr" s tofu=tofu_$s(comma:", ",1:"")_"Bronchoscopy" s comma=1
"RTN","SAMINOT2",651,0)
 . i ofu["cefupc" s tofu=tofu_$s(comma:", ",1:"")_"Pulmonary consultation" s comma=1
"RTN","SAMINOT2",652,0)
 . i ofu["cefutb" s tofu=tofu_$s(comma:", ",1:"")_"Refer to tumor board" s comma=1
"RTN","SAMINOT2",653,0)
 . i ofu["cefuo" s tofu=tofu_$s(comma:", ",1:"")_"Other:" s comma=1
"RTN","SAMINOT2",654,0)
 s @ARY@("followup")=futext_" "_fudate
"RTN","SAMINOT2",655,0)
 s @ARY@("followup2")=tofu
"RTN","SAMINOT2",656,0)
 s @ARY@("followup3")=$$XVAL("cefuoo",vals)
"RTN","SAMINOT2",657,0)
 ;
"RTN","SAMINOT2",658,0)
 quit  ; end of CTINFO
"RTN","SAMINOT2",659,0)
 ;
"RTN","SAMINOT2",660,0)
 ;
"RTN","SAMINOT2",661,0)
 ; 
"RTN","SAMINOT2",662,0)
IMPRESS(ARY,SID) ; impressions from ct eval report
"RTN","SAMINOT2",663,0)
 ;
"RTN","SAMINOT2",664,0)
 ;ven/gpl;private;procedure;
"RTN","SAMINOT2",665,0)
 ;@input
"RTN","SAMINOT2",666,0)
 ; ARY = name of output array
"RTN","SAMINOT2",667,0)
 ; SID
"RTN","SAMINOT2",668,0)
 ;@output
"RTN","SAMINOT2",669,0)
 ; @ARY = impressions from ct eval report [passed by name]
"RTN","SAMINOT2",670,0)
 ;
"RTN","SAMINOT2",671,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT2",672,0)
 n ctkey s ctkey=$g(@ARY@("ctform"))
"RTN","SAMINOT2",673,0)
 n vals s vals=$na(@root@("graph",SID,ctkey))
"RTN","SAMINOT2",674,0)
 n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMINOT2",675,0)
 s dict=$na(@dict@("cteval-dict"))
"RTN","SAMINOT2",676,0)
 n para s para=""
"RTN","SAMINOT2",677,0)
 n sp1 s sp1="    "
"RTN","SAMINOT2",678,0)
 ; 
"RTN","SAMINOT2",679,0)
 d OUT("Impression:")
"RTN","SAMINOT2",680,0)
 d OUT(sp1_$$XSUB("ceimn",vals,dict)_para)
"RTN","SAMINOT2",681,0)
 ;
"RTN","SAMINOT2",682,0)
 ;# Report CAC Score and Extent of Emphysema
"RTN","SAMINOT2",683,0)
 s cacval=0
"RTN","SAMINOT2",684,0)
 d  ;if $$XVAL("ceccv",vals)'="e" d  ;
"RTN","SAMINOT2",685,0)
 . set vcac=$$XVAL("cecccac",vals)
"RTN","SAMINOT2",686,0)
 . if vcac'="" d  ;
"RTN","SAMINOT2",687,0)
 . . s cacrec=""
"RTN","SAMINOT2",688,0)
 . . s cac="The Visual Coronary Artery Calcium (CAC) Score is "_vcac_". "
"RTN","SAMINOT2",689,0)
 . . s cacval=vcac
"RTN","SAMINOT2",690,0)
 . . i cacval>3 s cacrec=$g(@dict@("CAC_recommendation"))_para
"RTN","SAMINOT2",691,0)
 ;
"RTN","SAMINOT2",692,0)
 i cacval>0 d  ;
"RTN","SAMINOT2",693,0)
 . d OUT(sp1_cac_" "_cacrec_" "_para)
"RTN","SAMINOT2",694,0)
 . d  ;if $$XVAL("ceemv",vals)="e" d  ;
"RTN","SAMINOT2",695,0)
 . . if $$XVAL("ceem",vals)'="no" d  ;
"RTN","SAMINOT2",696,0)
 . . . if $$XVAL("ceem",vals)="nv" q  ;
"RTN","SAMINOT2",697,0)
 . . . d OUT(sp1_"Emphysema: "_$$XSUB("ceem",vals,dict)_"."_para)
"RTN","SAMINOT2",698,0)
 ;
"RTN","SAMINOT2",699,0)
 i $$XVAL("ceclini",vals)="y" d  ;
"RTN","SAMINOT2",700,0)
 . d OUT(sp1_$$XVAL("ceclin",vals)_"."_para)
"RTN","SAMINOT2",701,0)
 ;
"RTN","SAMINOT2",702,0)
 i $$XVAL("ceoppai",vals)="y" d  ;
"RTN","SAMINOT2",703,0)
 . d OUT(sp1_$$XVAL("ceoppa",vals)_"."_para)
"RTN","SAMINOT2",704,0)
 ;
"RTN","SAMINOT2",705,0)
 i $$XVAL("ceoppabi",vals)="y" d  ;
"RTN","SAMINOT2",706,0)
 . d OUT(sp1_$$XVAL("ceoppab",vals)_"."_para)
"RTN","SAMINOT2",707,0)
 ;
"RTN","SAMINOT2",708,0)
 i $$XVAL("cecommcai",vals)="y" d  ;
"RTN","SAMINOT2",709,0)
 . d OUT(sp1_$$XVAL("cecommca",vals)_"."_para)
"RTN","SAMINOT2",710,0)
 ;
"RTN","SAMINOT2",711,0)
 i $$XVAL("ceotabnmi",vals)="y" d  ;
"RTN","SAMINOT2",712,0)
 . d OUT(sp1_$$XVAL("ceotabnm",vals)_"."_para)
"RTN","SAMINOT2",713,0)
 ;
"RTN","SAMINOT2",714,0)
 i $$XVAL("ceobrci",vals)="y" d  ;
"RTN","SAMINOT2",715,0)
 . d OUT(sp1_$$XVAL("ceobrc",vals)_"."_para)
"RTN","SAMINOT2",716,0)
 ;
"RTN","SAMINOT2",717,0)
 i $$XVAL("ceaoabbi",vals)="y" d  ;
"RTN","SAMINOT2",718,0)
 . d OUT(sp1_$$XVAL("ceaoabb",vals)_"."_para)
"RTN","SAMINOT2",719,0)
 ;
"RTN","SAMINOT2",720,0)
 i $$XVAL("ceaoabi",vals)="y" d  ;
"RTN","SAMINOT2",721,0)
 . d OUT(sp1_$$XVAL("ceaoab",vals)_"."_para)
"RTN","SAMINOT2",722,0)
 ;
"RTN","SAMINOT2",723,0)
 ;# Impression Remarks
"RTN","SAMINOT2",724,0)
 i $$XVAL("ceimre",vals)'="" d  ;
"RTN","SAMINOT2",725,0)
 . d OUT(sp1_$$XVAL("ceimre",vals)_"."_para)
"RTN","SAMINOT2",726,0)
 ;
"RTN","SAMINOT2",727,0)
 quit  ; end of IMPRESS
"RTN","SAMINOT2",728,0)
 ;
"RTN","SAMINOT2",729,0)
 ;
"RTN","SAMINOT2",730,0)
 ;
"RTN","SAMINOT2",731,0)
XSUB(var,vals,dict,valdx) ; dictionary value for variable
"RTN","SAMINOT2",732,0)
 ;
"RTN","SAMINOT2",733,0)
 ;ven/gpl;private;function;
"RTN","SAMINOT2",734,0)
 ;@input
"RTN","SAMINOT2",735,0)
 ; var = name of dictionary value
"RTN","SAMINOT2",736,0)
 ; vals = name of variables array
"RTN","SAMINOT2",737,0)
 ; @vals = variables array [passed by name]
"RTN","SAMINOT2",738,0)
 ; dict = name of dictionary array
"RTN","SAMINOT2",739,0)
 ; @dict = dictionary array [passed by name]
"RTN","SAMINOT2",740,0)
 ; valdx = used for nodules ala cect2co with nodule # included
"RTN","SAMINOT2",741,0)
 ;@output = dictionary value for variable
"RTN","SAMINOT2",742,0)
 ;
"RTN","SAMINOT2",743,0)
 ; new dict set dict=$$setroot^%wd("cteval-dict")
"RTN","SAMINOT2",744,0)
 ;
"RTN","SAMINOT2",745,0)
 n zr,zv,zdx
"RTN","SAMINOT2",746,0)
 s zdx=$g(valdx)
"RTN","SAMINOT2",747,0)
 i zdx="" s zdx=var
"RTN","SAMINOT2",748,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMINOT2",749,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMINOT2",750,0)
 i zv="" s zr="" q zr
"RTN","SAMINOT2",751,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMINOT2",752,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMINOT2",753,0)
 ;
"RTN","SAMINOT2",754,0)
 quit zr ; end of $$XSUB
"RTN","SAMINOT2",755,0)
 ;
"RTN","SAMINOT2",756,0)
 ;
"RTN","SAMINOT2",757,0)
 ;
"RTN","SAMINOT2",758,0)
EOR ; end of routine SAMINOT2
"RTN","SAMINOT3")
0^13^B302971406
"RTN","SAMINOT3",1,0)
SAMINOT3 ;ven/gpl - CTeval report plain text ; 2021-10-29t23:36z
"RTN","SAMINOT3",2,0)
 ;;18.0;SAMI;**15**;;Build 2
"RTN","SAMINOT3",3,0)
 ;;18-15
"RTN","SAMINOT3",4,0)
 ;
"RTN","SAMINOT3",5,0)
 ;@license: see routine SAMIUL
"RTN","SAMINOT3",6,0)
 ;
"RTN","SAMINOT3",7,0)
 quit  ; no entry from top
"RTN","SAMINOT3",8,0)
 ;
"RTN","SAMINOT3",9,0)
WSNOTE(return,filter) ; web service which returns a text note
"RTN","SAMINOT3",10,0)
 ;
"RTN","SAMINOT3",11,0)
 n debug s debug=0
"RTN","SAMINOT3",12,0)
 i $g(filter("debug"))=1 s debug=1
"RTN","SAMINOT3",13,0)
 ;
"RTN","SAMINOT3",14,0)
 k return
"RTN","SAMINOT3",15,0)
 s HTTPRSP("mime")="text/html"
"RTN","SAMINOT3",16,0)
 ;
"RTN","SAMINOT3",17,0)
 n si
"RTN","SAMINOT3",18,0)
 s si=$g(filter("studyid"))
"RTN","SAMINOT3",19,0)
 i si="" d  ;
"RTN","SAMINOT3",20,0)
 . s si="XXX00333"
"RTN","SAMINOT3",21,0)
 q:si=""
"RTN","SAMINOT3",22,0)
 ;
"RTN","SAMINOT3",23,0)
 n samikey
"RTN","SAMINOT3",24,0)
 s samikey=$g(filter("form"))
"RTN","SAMINOT3",25,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT3",26,0)
 ;
"RTN","SAMINOT3",27,0)
 n vals
"RTN","SAMINOT3",28,0)
 m vals=@root@("graph",si,samikey)
"RTN","SAMINOT3",29,0)
 ;
"RTN","SAMINOT3",30,0)
 n notebase
"RTN","SAMINOT3",31,0)
 d WSREPORT^SAMICTT0(.notebase,.filter)
"RTN","SAMINOT3",32,0)
 s note="notebase"
"RTN","SAMINOT3",33,0)
 i '$d(@note) q
"RTN","SAMINOT3",34,0)
 ;
"RTN","SAMINOT3",35,0)
 new temp,tout
"RTN","SAMINOT3",36,0)
 do GETTMPL^SAMICASE("temp","vapals:note")
"RTN","SAMINOT3",37,0)
 quit:'$data(temp)
"RTN","SAMINOT3",38,0)
 ;
"RTN","SAMINOT3",39,0)
 n cnt s cnt=0
"RTN","SAMINOT3",40,0)
 n zi s zi=""
"RTN","SAMINOT3",41,0)
 ;
"RTN","SAMINOT3",42,0)
 f  s zi=$o(temp(zi)) q:zi=""  d  ;
"RTN","SAMINOT3",43,0)
 . ;
"RTN","SAMINOT3",44,0)
 . n line s line=temp(zi)
"RTN","SAMINOT3",45,0)
 . D LOAD^SAMIFORM(.line,samikey,si,.filter,.vals)
"RTN","SAMINOT3",46,0)
 . s temp(zi)=line
"RTN","SAMINOT3",47,0)
 . ;
"RTN","SAMINOT3",48,0)
 . s cnt=cnt+1
"RTN","SAMINOT3",49,0)
 . s tout(cnt)=temp(zi)
"RTN","SAMINOT3",50,0)
 . ;
"RTN","SAMINOT3",51,0)
 . i temp(zi)["report-text" d  ;
"RTN","SAMINOT3",52,0)
 . . i temp(zi)["#" q  ;
"RTN","SAMINOT3",53,0)
 . . n zj s zj=""
"RTN","SAMINOT3",54,0)
 . . f  s zj=$o(@note@(zj)) q:zj=""  d  ;
"RTN","SAMINOT3",55,0)
 . . . s cnt=cnt+1
"RTN","SAMINOT3",56,0)
 . . . ;s tout(cnt)=@note@(zj)_"<br>"
"RTN","SAMINOT3",57,0)
 . . . s tout(cnt)=@note@(zj)_$char(13,10)
"RTN","SAMINOT3",58,0)
 m return=tout
"RTN","SAMINOT3",59,0)
 q
"RTN","SAMINOT3",60,0)
 ;
"RTN","SAMINOT3",61,0)
NOTE(filter) ; extrnisic which creates a note
"RTN","SAMINOT3",62,0)
 ; returns 1 if successful, 0 if not
"RTN","SAMINOT3",63,0)
 ;
"RTN","SAMINOT3",64,0)
 ;
"RTN","SAMINOT3",65,0)
 k ^gpl("funote")
"RTN","SAMINOT3",66,0)
 m ^gpl("funote")=filter
"RTN","SAMINOT3",67,0)
 ;q 0  ; while we are developing
"RTN","SAMINOT3",68,0)
 ;
"RTN","SAMINOT3",69,0)
 ; set up patient values
"RTN","SAMINOT3",70,0)
 ;
"RTN","SAMINOT3",71,0)
 n vals
"RTN","SAMINOT3",72,0)
 ;
"RTN","SAMINOT3",73,0)
 n si
"RTN","SAMINOT3",74,0)
 s si=$g(filter("studyid"))
"RTN","SAMINOT3",75,0)
 q:si="" 0
"RTN","SAMINOT3",76,0)
 ;
"RTN","SAMINOT3",77,0)
 n samikey
"RTN","SAMINOT3",78,0)
 s samikey=$g(filter("form"))
"RTN","SAMINOT3",79,0)
 q:samikey="" 0
"RTN","SAMINOT3",80,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT3",81,0)
 ;
"RTN","SAMINOT3",82,0)
 s vals=$na(@root@("graph",si,samikey))
"RTN","SAMINOT3",83,0)
 ;
"RTN","SAMINOT3",84,0)
 i '$d(@vals) d  q 0 ;
"RTN","SAMINOT3",85,0)
 . ;w !,"error, patient values not found"
"RTN","SAMINOT3",86,0)
 ;zwr @vals@(*)
"RTN","SAMINOT3",87,0)
 ;
"RTN","SAMINOT3",88,0)
 n vetstxt s vetstxt="veteran"
"RTN","SAMINOT3",89,0)
 n vetstxt2 s vetstxt2="Veteran"
"RTN","SAMINOT3",90,0)
 i $g(filter("veteransAffairsSite"))="false" d  ;
"RTN","SAMINOT3",91,0)
 . set vetstxt="participant"
"RTN","SAMINOT3",92,0)
 . set vetstxt2="Participant"
"RTN","SAMINOT3",93,0)
 set filter("vetstxt")=vetstxt
"RTN","SAMINOT3",94,0)
 ;
"RTN","SAMINOT3",95,0)
 k ^SAMIUL("NOTE")
"RTN","SAMINOT3",96,0)
 m ^SAMIUL("NOTE","vals")=@vals
"RTN","SAMINOT3",97,0)
 m ^SAMIUL("NOTE","filter")=filter
"RTN","SAMINOT3",98,0)
 ;
"RTN","SAMINOT3",99,0)
 n didnote s didnote=0
"RTN","SAMINOT3",100,0)
 ;
"RTN","SAMINOT3",101,0)
 i $d(@vals@("notes")) d  q didnote ;
"RTN","SAMINOT3",102,0)
 . s filter("errorMessage")="Note already exists for this form."
"RTN","SAMINOT3",103,0)
 ;
"RTN","SAMINOT3",104,0)
 i $g(@vals@("futype"))="other" d  ;
"RTN","SAMINOT3",105,0)
 . i $g(@vals@("samistatus"))'="complete" q  ;
"RTN","SAMINOT3",106,0)
 . ;q:$$HASVCNT(vals)
"RTN","SAMINOT3",107,0)
 . d MKVC(si,samikey,vals,.filter) ;
"RTN","SAMINOT3",108,0)
 . s didnote=1
"RTN","SAMINOT3",109,0)
 ;
"RTN","SAMINOT3",110,0)
 i $g(@vals@("futype"))="ct" d  ;
"RTN","SAMINOT3",111,0)
 . i $g(@vals@("samistatus"))'="complete" q  ;
"RTN","SAMINOT3",112,0)
 . ;q:$$HASLCSNT(vals)
"RTN","SAMINOT3",113,0)
 . d MKLCS(si,samikey,vals,.filter) ;
"RTN","SAMINOT3",114,0)
 . s didnote=1
"RTN","SAMINOT3",115,0)
 ;
"RTN","SAMINOT3",116,0)
 ;i $g(@vals@("samistatus"))="complete" d  ;
"RTN","SAMINOT3",117,0)
 ;. q:$$HASVCNT(vals)
"RTN","SAMINOT3",118,0)
 ;. d MKVC(si,samikey,vals,.filter) ;
"RTN","SAMINOT3",119,0)
 ;. s didnote=1
"RTN","SAMINOT3",120,0)
 ;
"RTN","SAMINOT3",121,0)
 q didnote
"RTN","SAMINOT3",122,0)
 ;
"RTN","SAMINOT3",123,0)
HASINNT(vals) ; extrinsic returns 1 if intake note is present
"RTN","SAMINOT3",124,0)
 ; else returns 0
"RTN","SAMINOT3",125,0)
 n zzi,zzrtn s (zzi,zzrtn)=0
"RTN","SAMINOT3",126,0)
 q:'$d(@vals)
"RTN","SAMINOT3",127,0)
 f  s zzi=$o(@vals@("notes",zzi)) q:+zzi=0  d  ;
"RTN","SAMINOT3",128,0)
 . i $g(@vals@("notes",zzi,"name"))["Intake" s zzrtn=1
"RTN","SAMINOT3",129,0)
 q zzrtn
"RTN","SAMINOT3",130,0)
 ;
"RTN","SAMINOT3",131,0)
HASVCNT(vals) ; extrinsic returns 1 if communication note is present
"RTN","SAMINOT3",132,0)
 ; else returns 0
"RTN","SAMINOT3",133,0)
 n zzi,zzrtn s (zzi,zzrtn)=0
"RTN","SAMINOT3",134,0)
 q:'$d(@vals)
"RTN","SAMINOT3",135,0)
 f  s zzi=$o(@vals@("notes",zzi)) q:+zzi=0  d  ;
"RTN","SAMINOT3",136,0)
 . i $g(@vals@("notes",zzi,"name"))["Communication" s zzrtn=1
"RTN","SAMINOT3",137,0)
 q zzrtn
"RTN","SAMINOT3",138,0)
 ;
"RTN","SAMINOT3",139,0)
HASLCSNT(vals) ; extrinsic returns 1 if communication note is present
"RTN","SAMINOT3",140,0)
 ; else returns 0
"RTN","SAMINOT3",141,0)
 n zzi,zzrtn s (zzi,zzrtn)=0
"RTN","SAMINOT3",142,0)
 q:'$d(@vals)
"RTN","SAMINOT3",143,0)
 f  s zzi=$o(@vals@("notes",zzi)) q:+zzi=0  d  ;
"RTN","SAMINOT3",144,0)
 . i $g(@vals@("notes",zzi,"name"))["Lung" s zzrtn=1
"RTN","SAMINOT3",145,0)
 q zzrtn
"RTN","SAMINOT3",146,0)
 ;
"RTN","SAMINOT3",147,0)
MKVC(sid,form,vals,filter) ;
"RTN","SAMINOT3",148,0)
 n cnt s cnt=0
"RTN","SAMINOT3",149,0)
 ;n dest s dest=$na(@vals@("communication-note"))
"RTN","SAMINOT3",150,0)
 n dest s dest=$$MKNT(vals,"Communication Note","communication",.filter)
"RTN","SAMINOT3",151,0)
 k @dest
"RTN","SAMINOT3",152,0)
 d OUT(vetstxt_" Communication Note")
"RTN","SAMINOT3",153,0)
 d OUT("")
"RTN","SAMINOT3",154,0)
 d VCNOTE(vals,dest,cnt)
"RTN","SAMINOT3",155,0)
 q
"RTN","SAMINOT3",156,0)
 ;
"RTN","SAMINOT3",157,0)
MKLCS(sid,form,vals,filter) ;
"RTN","SAMINOT3",158,0)
 n cnt s cnt=0
"RTN","SAMINOT3",159,0)
 ;n dest s dest=$na(@vals@("lcs-note"))
"RTN","SAMINOT3",160,0)
 n dest s dest=$$MKNT(vals,"Lung Cancer Screening Note","lcs",.filter)
"RTN","SAMINOT3",161,0)
 k @dest
"RTN","SAMINOT3",162,0)
 d OUT("Lung Screening and Surveillance Follow up Note")
"RTN","SAMINOT3",163,0)
 d OUT("")
"RTN","SAMINOT3",164,0)
 d LCSNOTE(vals,dest,cnt)
"RTN","SAMINOT3",165,0)
 q
"RTN","SAMINOT3",166,0)
 ;
"RTN","SAMINOT3",167,0)
MKNT(vals,title,ntype,filter) ; extrinsic makes a note date=now returns 
"RTN","SAMINOT3",168,0)
 ; global addr. filter must be passed by reference
"RTN","SAMINOT3",169,0)
 n ntdt s ntdt=$$NTDTTM($$NOW^XLFDT)
"RTN","SAMINOT3",170,0)
 n ntptr
"RTN","SAMINOT3",171,0)
 s ntptr=$$MKNTLOC(vals,title,ntdt,$g(ntype),.filter)
"RTN","SAMINOT3",172,0)
 q ntptr
"RTN","SAMINOT3",173,0)
 ;
"RTN","SAMINOT3",174,0)
MKNTLOC(vals,title,ndate,ntype,filter) ; extrinsic returns the 
"RTN","SAMINOT3",175,0)
 ;location for the note
"RTN","SAMINOT3",176,0)
 n nien
"RTN","SAMINOT3",177,0)
 s nien=$o(@vals@("notes",""),-1)+1
"RTN","SAMINOT3",178,0)
 s filter("nien")=nien
"RTN","SAMINOT3",179,0)
 n nloc s nloc=$na(@vals@("notes",nien))
"RTN","SAMINOT3",180,0)
 s @nloc@("name")=title_" "_$g(ndate)
"RTN","SAMINOT3",181,0)
 s @nloc@("date")=$g(ndate)
"RTN","SAMINOT3",182,0)
 s @nloc@("type")=$g(ntype)
"RTN","SAMINOT3",183,0)
 q $na(@nloc@("text"))
"RTN","SAMINOT3",184,0)
 ;
"RTN","SAMINOT3",185,0)
NTDTTM(ZFMDT) ; extrinsic returns the date and time in Note format
"RTN","SAMINOT3",186,0)
 ; ZFMDT is the fileman date/time to translate
"RTN","SAMINOT3",187,0)
 q $$FMTE^XLFDT(ZFMDT,"5")
"RTN","SAMINOT3",188,0)
 ;
"RTN","SAMINOT3",189,0)
NTLOCN(sid,form,nien) ; extrinsic returns the location of the Nth note
"RTN","SAMINOT3",190,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT3",191,0)
 q $na(@root@("graph",sid,form,"notes",nien))
"RTN","SAMINOT3",192,0)
 ;
"RTN","SAMINOT3",193,0)
NTLAST(sid,form,ntype) ; extrinsic returns the location of the latest note
"RTN","SAMINOT3",194,0)
 ; of the type ntype
"RTN","SAMINOT3",195,0)
 q
"RTN","SAMINOT3",196,0)
 ;
"RTN","SAMINOT3",197,0)
NTLIST(nlist,sid,form) ; returns the note list in nlist, passed by ref
"RTN","SAMINOT3",198,0)
 ;
"RTN","SAMINOT3",199,0)
 n zn,root,gn
"RTN","SAMINOT3",200,0)
 s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT3",201,0)
 s zn=0
"RTN","SAMINOT3",202,0)
 s gn=$na(@root@("graph",sid,form,"notes"))
"RTN","SAMINOT3",203,0)
 q:'$d(@gn)
"RTN","SAMINOT3",204,0)
 f  s zn=$o(@gn@(zn)) q:+zn=0  d  ;
"RTN","SAMINOT3",205,0)
 . s @nlist@(zn,"name")=@gn@(zn,"name")
"RTN","SAMINOT3",206,0)
 . s @nlist@(zn,"nien")=zn
"RTN","SAMINOT3",207,0)
 ;
"RTN","SAMINOT3",208,0)
 q
"RTN","SAMINOT3",209,0)
 ;
"RTN","SAMINOT3",210,0)
TLST ;
"RTN","SAMINOT3",211,0)
 S SID="XXX00677"
"RTN","SAMINOT3",212,0)
 S FORM="siform-2019-04-23"
"RTN","SAMINOT3",213,0)
 D NTLIST("G",SID,FORM)
"RTN","SAMINOT3",214,0)
 ;ZWR G
"RTN","SAMINOT3",215,0)
 Q
"RTN","SAMINOT3",216,0)
 ;
"RTN","SAMINOT3",217,0)
VCNOTE(vals,dest,cnt) ; Veteran Communication Note
"RTN","SAMINOT3",218,0)
 ;d OUT("")
"RTN","SAMINOT3",219,0)
 d OUT(vetstxt2_" was contacted via:")
"RTN","SAMINOT3",220,0)
 n sp1 s sp1="    "
"RTN","SAMINOT3",221,0)
 d:$$XVAL("fucmotip",vals) OUT(sp1_"In person")
"RTN","SAMINOT3",222,0)
 d:$$XVAL("fucmotte",vals) OUT(sp1_"Telephone")
"RTN","SAMINOT3",223,0)
 d:$$XVAL("fucmotth",vals) OUT(sp1_"TeleHealth")
"RTN","SAMINOT3",224,0)
 d:$$XVAL("fucmotml",vals) OUT(sp1_"Mailed Letter")
"RTN","SAMINOT3",225,0)
 d:$$XVAL("fucmotpp",vals) OUT(sp1_"Message in patient portal")
"RTN","SAMINOT3",226,0)
 d:$$XVAL("fucmotvd",vals) OUT(sp1_"Video-on-demand (VOD)")
"RTN","SAMINOT3",227,0)
 d:$$XVAL("fucmotot",vals) OUT(sp1_"Other: "_$$XVAL("fucmotoo",vals))
"RTN","SAMINOT3",228,0)
 d OUT("")
"RTN","SAMINOT3",229,0)
 ;
"RTN","SAMINOT3",230,0)
 d:$$XVAL("fucmotde",vals)'=""
"RTN","SAMINOT3",231,0)
 . d OUT("Communication details:")
"RTN","SAMINOT3",232,0)
 . d OUT(sp1_$$XVAL("fucmotde",vals))
"RTN","SAMINOT3",233,0)
 ;
"RTN","SAMINOT3",234,0)
 d SSTATUS(vals) ; insert smoking status section
"RTN","SAMINOT3",235,0)
 q
"RTN","SAMINOT3",236,0)
 ;
"RTN","SAMINOT3",237,0)
SSTATUS(vals)  ;
"RTN","SAMINOT3",238,0)
 n sstat s sstat=""
"RTN","SAMINOT3",239,0)
 i $$XVAL("sisa",vals)="y" d  ; 
"RTN","SAMINOT3",240,0)
 . s sstat="Current"
"RTN","SAMINOT3",241,0)
 . d OUT("Smoking status: "_sstat)
"RTN","SAMINOT3",242,0)
 . d OUT(sp1_"Current cigarette smoker (patient advised that active tobacco use")
"RTN","SAMINOT3",243,0)
 . d OUT(sp1_"increases risk of future lung cancer, heart disease and stroke,")
"RTN","SAMINOT3",244,0)
 . d OUT(sp1_"advised stability now does not guarantee will not develop future")
"RTN","SAMINOT3",245,0)
 . d OUT(sp1_"lung cancer or risks of premature death from tobacco related heart")
"RTN","SAMINOT3",246,0)
 . d OUT(sp1_"disease and stroke)")
"RTN","SAMINOT3",247,0)
 i $$XVAL("sisa",vals)="n" d  ;
"RTN","SAMINOT3",248,0)
 . s sstat="Former"
"RTN","SAMINOT3",249,0)
 . d OUT("Smoking status: "_sstat)
"RTN","SAMINOT3",250,0)
 . n qdate s qdate=""
"RTN","SAMINOT3",251,0)
 . s qdate=$$XVAL("siq",vals)
"RTN","SAMINOT3",252,0)
 . i qdate'="" d OUT(sp1_"Former cigarette smoker. Quit date: "_qdate)
"RTN","SAMINOT3",253,0)
 . e  d OUT(sp1_"Former cigarette smoker.")
"RTN","SAMINOT3",254,0)
 i $$XVAL("sisa",vals)="o" d  ;
"RTN","SAMINOT3",255,0)
 . s sstat="Never"
"RTN","SAMINOT3",256,0)
 . d OUT("Smoking status: "_sstat)
"RTN","SAMINOT3",257,0)
 . d OUT(sp1_"Never cigarette smoker")
"RTN","SAMINOT3",258,0)
 ;
"RTN","SAMINOT3",259,0)
 n cumary
"RTN","SAMINOT3",260,0)
 d CUMPY^SAMIUR2("cumary",sid,form)
"RTN","SAMINOT3",261,0)
 k ^gpl("funote","cumary")
"RTN","SAMINOT3",262,0)
 m ^gpl("funote","cumary")=cumary
"RTN","SAMINOT3",263,0)
 n cur s cur=$g(cumary("current"))
"RTN","SAMINOT3",264,0)
 n newcum s newcum=$g(cumary("rpt",cur,4)) ; new cumulative pack years
"RTN","SAMINOT3",265,0)
 ;
"RTN","SAMINOT3",266,0)
 i $$XVAL("sisa",vals)="y" d  ;  
"RTN","SAMINOT3",267,0)
 . d OUT("Smoking history (since last visit):")
"RTN","SAMINOT3",268,0)
 . d OUT(sp1_"Cigarettes/day: "_$$XVAL("sicpd",vals))
"RTN","SAMINOT3",269,0)
 . d OUT(sp1_"PPD: "_$$XVAL("sippd",vals))
"RTN","SAMINOT3",270,0)
 . d OUT(sp1_"Current cumulative pack years: "_newcum)
"RTN","SAMINOT3",271,0)
 i $$XVAL("sisa",vals)'="y" d  ;
"RTN","SAMINOT3",272,0)
 . d OUT("Smoking History")
"RTN","SAMINOT3",273,0)
 n zi
"RTN","SAMINOT3",274,0)
 f zi=1:1:cur d  ;
"RTN","SAMINOT3",275,0)
 . d OUT(sp1_cumary("rpt",zi,1)_" "_cumary("rpt",zi,2))
"RTN","SAMINOT3",276,0)
 . d OUT(sp1_sp1_"Pack Years: "_cumary("rpt",zi,3))
"RTN","SAMINOT3",277,0)
 . d OUT(sp1_sp1_"Cumulative: "_cumary("rpt",zi,4))
"RTN","SAMINOT3",278,0)
 ;
"RTN","SAMINOT3",279,0)
 n tried s tried=$$XVAL("sittq",vals)
"RTN","SAMINOT3",280,0)
 n ptried s ptried=$s(tried="y":"Yes",tried="n":"No",tried="o":"Not applicable",1:"")
"RTN","SAMINOT3",281,0)
 i ptried'="" d OUT("Since your prior CT scan have you ever tried to quit smoking? "_ptried)
"RTN","SAMINOT3",282,0)
 ;
"RTN","SAMINOT3",283,0)
 n tryary,cnt
"RTN","SAMINOT3",284,0)
 s cnt=0
"RTN","SAMINOT3",285,0)
 i $$XVAL("sisca",vals)'="" s cnt=cnt+1 s tryary(cnt)="Have not tried to quit"
"RTN","SAMINOT3",286,0)
 i $$XVAL("siscb",vals)'="" s cnt=cnt+1 s tryary(cnt)="""Cold Turkey"" by completely stopping on your own with no other assistance"
"RTN","SAMINOT3",287,0)
 i $$XVAL("siscc",vals)'="" s cnt=cnt+1 s tryary(cnt)="Tapering or reducing number of cigarettes smoked per day"
"RTN","SAMINOT3",288,0)
 i $$XVAL("siscd",vals)'="" s cnt=cnt+1 s tryary(cnt)="Self-help material (e.g., brochure, cessation website)"
"RTN","SAMINOT3",289,0)
 i $$XVAL("sisce",vals)'="" s cnt=cnt+1 s tryary(cnt)="Individual consultation or cessation counseling"
"RTN","SAMINOT3",290,0)
 ;i $$XVAL("siscf",vals)'="" s cnt=cnt+1 s tryary(cnt)="Telephone cessation counseling hotline (e.g., 1-855-QUIT-VET, 1-800-QUIT-NOW)"
"RTN","SAMINOT3",291,0)
 i $$XVAL("siscf",vals)'="" s cnt=cnt+1 s tryary(cnt)="Telephone cessation counseling hotline"
"RTN","SAMINOT3",292,0)
 i $$XVAL("siscg",vals)'="" s cnt=cnt+1 s tryary(cnt)="Peer support (e.g., Nicotine Anonymous)"
"RTN","SAMINOT3",293,0)
 i $$XVAL("sisch",vals)'="" s cnt=cnt+1 s tryary(cnt)="Nicotine replacement therapy (e.g., patch, gum, inhaler, nasal spray, lozenge)"
"RTN","SAMINOT3",294,0)
 i $$XVAL("sisci",vals)'="" s cnt=cnt+1 s tryary(cnt)="Zyban"
"RTN","SAMINOT3",295,0)
 i $$XVAL("siscj",vals)'="" s cnt=cnt+1 s tryary(cnt)="Hypnosis"
"RTN","SAMINOT3",296,0)
 i $$XVAL("sisck",vals)'="" s cnt=cnt+1 s tryary(cnt)="Acupuncture / acupressure"
"RTN","SAMINOT3",297,0)
 n tryot s tryot=""
"RTN","SAMINOT3",298,0)
 i $$XVAL("siscl",vals)'="" d  ;
"RTN","SAMINOT3",299,0)
 . s cnt=cnt+1 s tryary(cnt)="Other (specify)"
"RTN","SAMINOT3",300,0)
 . s tryot=$$XVAL("siscos",vals)
"RTN","SAMINOT3",301,0)
 ;
"RTN","SAMINOT3",302,0)
 i cnt>0 d  ;
"RTN","SAMINOT3",303,0)
 .  i ptried="" d OUT("Since your prior CT scan have you ever tried to quit smoking? ")
"RTN","SAMINOT3",304,0)
 . n zi s zi=""
"RTN","SAMINOT3",305,0)
 . f  s zi=$o(tryary(zi)) q:zi=""  d  ;
"RTN","SAMINOT3",306,0)
 . . d OUT(sp1_tryary(zi))
"RTN","SAMINOT3",307,0)
 . i tryot'="" d OUT(sp1_sp1_tryot)
"RTN","SAMINOT3",308,0)
 ;
"RTN","SAMINOT3",309,0)
 n cess,cess2 s cess="" s cess2=""
"RTN","SAMINOT3",310,0)
 i $$XVAL("siscmd",vals)="d" s cess="Declined"
"RTN","SAMINOT3",311,0)
 i $$XVAL("siscmd",vals)="a" s cess="Advised to quit smoking; VA resources provided"
"RTN","SAMINOT3",312,0)
 i $$XVAL("siscmd",vals)="i" d  ;
"RTN","SAMINOT3",313,0)
 . s cess="Interested in VA tobacco cessation medication. Encouraged "_vetstxt
"RTN","SAMINOT3",314,0)
 . s cess2="to talk to provider or pharmacist about which medication option is best for you."
"RTN","SAMINOT3",315,0)
 i cess'="" d  ;
"RTN","SAMINOT3",316,0)
 . d OUT("Tobacco cessation provided:")
"RTN","SAMINOT3",317,0)
 . d OUT(sp1_cess)
"RTN","SAMINOT3",318,0)
 . i cess2'="" d OUT(sp1_cess2)
"RTN","SAMINOT3",319,0)
 q
"RTN","SAMINOT3",320,0)
 ;
"RTN","SAMINOT3",321,0)
LCSNOTE(vals,dest,cnt) ; Lung Screening Note
"RTN","SAMINOT3",322,0)
 ;d OUT("")
"RTN","SAMINOT3",323,0)
 n sp1 s sp1="    "
"RTN","SAMINOT3",324,0)
 d OUT("Initial LDCT/Baseline: "_$$XVAL("sidoe",vals))
"RTN","SAMINOT3",325,0)
 d OUT("Date of most recent CT/LDCT: "_$$XVAL("fulctdt",vals))
"RTN","SAMINOT3",326,0)
 d OUT(sp1_"Notification of Results: "_$$XVAL("sidof",vals))
"RTN","SAMINOT3",327,0)
 n addcmt s addcmt=$$XVAL("fucmctde",vals)
"RTN","SAMINOT3",328,0)
 i addcmt'="" d  ;
"RTN","SAMINOT3",329,0)
 . d OUT("Additional comments:")
"RTN","SAMINOT3",330,0)
 . d OUT(sp1_addcmt)
"RTN","SAMINOT3",331,0)
 n impress s impress=""
"RTN","SAMINOT3",332,0)
 n ctary
"RTN","SAMINOT3",333,0)
 d CTINFO("ctary",sid,form)
"RTN","SAMINOT3",334,0)
 s impress=$g(ctary("impression"))
"RTN","SAMINOT3",335,0)
 ; get impression from lastest CT Eval here
"RTN","SAMINOT3",336,0)
 d IMPRESS("ctary",sid)
"RTN","SAMINOT3",337,0)
 ;i impress'="" d  ;
"RTN","SAMINOT3",338,0)
 ;. d OUT("Impression:")
"RTN","SAMINOT3",339,0)
 ;. d OUT(sp1_impress)
"RTN","SAMINOT3",340,0)
 ; smoking status follows
"RTN","SAMINOT3",341,0)
 d SSTATUS(vals)
"RTN","SAMINOT3",342,0)
 ;d OUT("Veteran was contacted via:")
"RTN","SAMINOT3",343,0)
 ;n sp1 s sp1="    "
"RTN","SAMINOT3",344,0)
 ;d:$$XVAL("fucmctip",vals) OUT(sp1_"In person")
"RTN","SAMINOT3",345,0)
 ;d:$$XVAL("fucmctte",vals) OUT(sp1_"Telephone")
"RTN","SAMINOT3",346,0)
 ;d:$$XVAL("fucmctth",vals) OUT(sp1_"TeleHealth")
"RTN","SAMINOT3",347,0)
 ;d:$$XVAL("fucmctml",vals) OUT(sp1_"Mailed Letter")
"RTN","SAMINOT3",348,0)
 ;d:$$XVAL("fucmctpp",vals) OUT(sp1_"Message in patient portal")
"RTN","SAMINOT3",349,0)
 ;d:$$XVAL("fucmctvd",vals) OUT(sp1_"Video-on-demand (VOD)")
"RTN","SAMINOT3",350,0)
 ;d:$$XVAL("fucmctot",vals) OUT(sp1_"Other: "_$$XVAL("fucmctoo",vals))
"RTN","SAMINOT3",351,0)
 ;d OUT("")
"RTN","SAMINOT3",352,0)
 ;
"RTN","SAMINOT3",353,0)
 ;d:$$XVAL("fucmctde",vals)'=""
"RTN","SAMINOT3",354,0)
 ;. d OUT("Communication details:")
"RTN","SAMINOT3",355,0)
 ;. d OUT(sp1_$$XVAL("fucmctde",vals))
"RTN","SAMINOT3",356,0)
 n recom s recom=""
"RTN","SAMINOT3",357,0)
 ; get recommendations from CT eval form here
"RTN","SAMINOT3",358,0)
 s recom=$g(ctary("followup"))
"RTN","SAMINOT3",359,0)
 i recom'="" d  ;
"RTN","SAMINOT3",360,0)
 . d OUT("Recommendations:")
"RTN","SAMINOT3",361,0)
 . d OUT(sp1_recom)
"RTN","SAMINOT3",362,0)
 . i $g(ctary("followup2"))'="" d  ;
"RTN","SAMINOT3",363,0)
 . . d OUT(sp1_ctary("followup2"))
"RTN","SAMINOT3",364,0)
 . i $g(ctary("followup3"))'="" d  ;
"RTN","SAMINOT3",365,0)
 . . d OUT(sp1_ctary("followup3"))
"RTN","SAMINOT3",366,0)
 n ordered s ordered=$$XVAL("funewct",vals)
"RTN","SAMINOT3",367,0)
 i ordered'="" d  ;
"RTN","SAMINOT3",368,0)
 . s ordered=$s(ordered="y":"Yes",ordered="n":"No",1:"")
"RTN","SAMINOT3",369,0)
 . d OUT("CT/LDCT ordered: "_ordered)
"RTN","SAMINOT3",370,0)
 n pulmon s pulmon=$$XVAL("fucompul",vals)
"RTN","SAMINOT3",371,0)
 i pulmon'="" d  ;
"RTN","SAMINOT3",372,0)
 . s pulmon=$s(pulmon="y":"Yes",pulmon="n":"No",1:"")
"RTN","SAMINOT3",373,0)
 . d OUT("Communicated to Pulmonary: "_pulmon)
"RTN","SAMINOT3",374,0)
 q
"RTN","SAMINOT3",375,0)
 ;
"RTN","SAMINOT3",376,0)
OUT(ln) ;
"RTN","SAMINOT3",377,0)
 s cnt=cnt+1
"RTN","SAMINOT3",378,0)
 n lnn
"RTN","SAMINOT3",379,0)
 ;s debug=1
"RTN","SAMINOT3",380,0)
 s lnn=$o(@dest@(" "),-1)+1
"RTN","SAMINOT3",381,0)
 s @dest@(lnn)=ln
"RTN","SAMINOT3",382,0)
 ;i $g(debug)=1 d  ;
"RTN","SAMINOT3",383,0)
 ;. i ln["<" q  ; no markup
"RTN","SAMINOT3",384,0)
 ;. n zs s zs=$STACK
"RTN","SAMINOT3",385,0)
 ;. n zp s zp=$STACK(zs-2,"PLACE")
"RTN","SAMINOT3",386,0)
 ;. s @dest@(lnn)=zp_":"_ln
"RTN","SAMINOT3",387,0)
 q
"RTN","SAMINOT3",388,0)
 ;
"RTN","SAMINOT3",389,0)
XVAL(var,vals) ; extrinsic returns the patient value for var
"RTN","SAMINOT3",390,0)
 ; vals is passed by name
"RTN","SAMINOT3",391,0)
 n zr
"RTN","SAMINOT3",392,0)
 s zr=$g(@vals@(var))
"RTN","SAMINOT3",393,0)
 ;i zr="" s zr="["_var_"]"
"RTN","SAMINOT3",394,0)
 q zr
"RTN","SAMINOT3",395,0)
 ;
"RTN","SAMINOT3",396,0)
PREVCT(SID,FORM) ; extrinic returns the form key to the CT Eval form
"RTN","SAMINOT3",397,0)
 ; previous to FORM. If FORM is null, the latest CT Eval form key is returned
"RTN","SAMINOT3",398,0)
 ; FORM sensitivity is tbd.. always returns latest CTEval
"RTN","SAMINOT3",399,0)
 n gn s gn=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT3",400,0)
 n prev s prev=$o(@gn@("graph",SID,"ceform-30"),-1)
"RTN","SAMINOT3",401,0)
 q prev
"RTN","SAMINOT3",402,0)
 ;
"RTN","SAMINOT3",403,0)
CTINFO(ARY,SID,FORM) ; returns extracts from latest CT Eval form
"RTN","SAMINOT3",404,0)
 ; ARY passed by name
"RTN","SAMINOT3",405,0)
 ;
"RTN","SAMINOT3",406,0)
 n ctkey s ctkey=$$PREVCT(SID,$G(FORM))
"RTN","SAMINOT3",407,0)
 q:ctkey=""
"RTN","SAMINOT3",408,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT3",409,0)
 n ctroot s ctroot=$na(@root@("graph",SID,ctkey))
"RTN","SAMINOT3",410,0)
 ;
"RTN","SAMINOT3",411,0)
 s @ARY@("ctform")=ctkey
"RTN","SAMINOT3",412,0)
 s @ARY@("impression")=$g(@ctroot@("ceimre"))
"RTN","SAMINOT3",413,0)
 n futext
"RTN","SAMINOT3",414,0)
 s futext=$g(@ctroot@("cefuw"))
"RTN","SAMINOT3",415,0)
 n futbl
"RTN","SAMINOT3",416,0)
 s futbl("1y")="Annual repeat"
"RTN","SAMINOT3",417,0)
 s futbl("nw")="Now"
"RTN","SAMINOT3",418,0)
 s futbl("1m")="1 month"
"RTN","SAMINOT3",419,0)
 s futbl("3m")="3 months"
"RTN","SAMINOT3",420,0)
 s futbl("6m")="6 months"
"RTN","SAMINOT3",421,0)
 s futbl("os")="other"
"RTN","SAMINOT3",422,0)
 i futext'="" s futext=$g(futbl(futext))
"RTN","SAMINOT3",423,0)
 n fudate s fudate=$g(@ctroot@("cefud"))
"RTN","SAMINOT3",424,0)
 ; #Other followup
"RTN","SAMINOT3",425,0)
 n zfu,ofu,tofu,comma
"RTN","SAMINOT3",426,0)
 n vals s vals=ctroot
"RTN","SAMINOT3",427,0)
 s comma=0,tofu=""
"RTN","SAMINOT3",428,0)
 s ofu=""
"RTN","SAMINOT3",429,0)
 f zfu="cefuaf","cefucc","cefupe","cefufn","cefubr","cefupc","cefutb" d  ;
"RTN","SAMINOT3",430,0)
 . i $$XVAL(zfu,vals)="y" s ofu=ofu_zfu
"RTN","SAMINOT3",431,0)
 i $$XVAL("cefuo",vals)'="" s ofu=ofu_"cefuo"
"RTN","SAMINOT3",432,0)
 i ofu'="" d  ;
"RTN","SAMINOT3",433,0)
 . s tofu="Other followup: "
"RTN","SAMINOT3",434,0)
 . i ofu["cefuaf" s tofu=tofu_"Antibiotics" s comma=1
"RTN","SAMINOT3",435,0)
 . i ofu["cefucc" s tofu=tofu_$s(comma:", ",1:"")_"Diagnostic CT" s comma=1
"RTN","SAMINOT3",436,0)
 . i ofu["cefupe" s tofu=tofu_$s(comma:", ",1:"")_"PET" s comma=1
"RTN","SAMINOT3",437,0)
 . i ofu["cefufn" s tofu=tofu_$s(comma:", ",1:"")_"Percutaneous biopsy" s comma=1
"RTN","SAMINOT3",438,0)
 . i ofu["cefubr" s tofu=tofu_$s(comma:", ",1:"")_"Bronchoscopy" s comma=1
"RTN","SAMINOT3",439,0)
 . i ofu["cefupc" s tofu=tofu_$s(comma:", ",1:"")_"Pulmonary consultation" s comma=1
"RTN","SAMINOT3",440,0)
 . i ofu["cefutb" s tofu=tofu_$s(comma:", ",1:"")_"Refer to tumor board" s comma=1
"RTN","SAMINOT3",441,0)
 . i ofu["cefuo" s tofu=tofu_$s(comma:", ",1:"")_"Other:" s comma=1
"RTN","SAMINOT3",442,0)
 s @ARY@("followup")=futext_" "_fudate
"RTN","SAMINOT3",443,0)
 s @ARY@("followup2")=tofu
"RTN","SAMINOT3",444,0)
 s @ARY@("followup3")=$$XVAL("cefuoo",vals)
"RTN","SAMINOT3",445,0)
 ;
"RTN","SAMINOT3",446,0)
 q
"RTN","SAMINOT3",447,0)
 ; 
"RTN","SAMINOT3",448,0)
IMPRESS(ARY,SID) ; impressions from CTEval report
"RTN","SAMINOT3",449,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMINOT3",450,0)
 n ctkey s ctkey=$g(@ARY@("ctform"))
"RTN","SAMINOT3",451,0)
 n vals s vals=$na(@root@("graph",SID,ctkey))
"RTN","SAMINOT3",452,0)
 n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMINOT3",453,0)
 s dict=$na(@dict@("cteval-dict"))
"RTN","SAMINOT3",454,0)
 n para s para=""
"RTN","SAMINOT3",455,0)
 n sp1 s sp1="    "
"RTN","SAMINOT3",456,0)
 ; 
"RTN","SAMINOT3",457,0)
 d OUT("Impression:")
"RTN","SAMINOT3",458,0)
 d OUT(sp1_$$XSUB("ceimn",vals,dict)_para)
"RTN","SAMINOT3",459,0)
 ;
"RTN","SAMINOT3",460,0)
 ;# Report CAC Score and Extent of Emphysema
"RTN","SAMINOT3",461,0)
 s cacval=0
"RTN","SAMINOT3",462,0)
 d  ;if $$XVAL("ceccv",vals)'="e" d  ;
"RTN","SAMINOT3",463,0)
 . set vcac=$$XVAL("cecccac",vals)
"RTN","SAMINOT3",464,0)
 . if vcac'="" d  ;
"RTN","SAMINOT3",465,0)
 . . s cacrec=""
"RTN","SAMINOT3",466,0)
 . . s cac="The Visual Coronary Artery Calcium (CAC) Score is "_vcac_". "
"RTN","SAMINOT3",467,0)
 . . s cacval=vcac
"RTN","SAMINOT3",468,0)
 . . i cacval>3 s cacrec=$g(@dict@("CAC_recommendation"))_para
"RTN","SAMINOT3",469,0)
 ;
"RTN","SAMINOT3",470,0)
 i cacval>0 d  ;
"RTN","SAMINOT3",471,0)
 . d OUT(sp1_cac_" "_cacrec_" "_para)
"RTN","SAMINOT3",472,0)
 . d  ;if $$XVAL("ceemv",vals)="e" d  ;
"RTN","SAMINOT3",473,0)
 . . if $$XVAL("ceem",vals)'="no" d  ;
"RTN","SAMINOT3",474,0)
 . . . if $$XVAL("ceem",vals)="nv" q  ;
"RTN","SAMINOT3",475,0)
 . . . d OUT(sp1_"Emphysema: "_$$XSUB("ceem",vals,dict)_"."_para)
"RTN","SAMINOT3",476,0)
 ;
"RTN","SAMINOT3",477,0)
 i $$XVAL("ceclini",vals)="y" d  ;
"RTN","SAMINOT3",478,0)
 . d OUT(sp1_$$XVAL("ceclin",vals)_"."_para)
"RTN","SAMINOT3",479,0)
 ;
"RTN","SAMINOT3",480,0)
 i $$XVAL("ceoppai",vals)="y" d  ;
"RTN","SAMINOT3",481,0)
 . d OUT(sp1_$$XVAL("ceoppa",vals)_"."_para)
"RTN","SAMINOT3",482,0)
 ;
"RTN","SAMINOT3",483,0)
 i $$XVAL("ceoppabi",vals)="y" d  ;
"RTN","SAMINOT3",484,0)
 . d OUT(sp1_$$XVAL("ceoppab",vals)_"."_para)
"RTN","SAMINOT3",485,0)
 ;
"RTN","SAMINOT3",486,0)
 i $$XVAL("cecommcai",vals)="y" d  ;
"RTN","SAMINOT3",487,0)
 . d OUT(sp1_$$XVAL("cecommca",vals)_"."_para)
"RTN","SAMINOT3",488,0)
 ;
"RTN","SAMINOT3",489,0)
 i $$XVAL("ceotabnmi",vals)="y" d  ;
"RTN","SAMINOT3",490,0)
 . d OUT(sp1_$$XVAL("ceotabnm",vals)_"."_para)
"RTN","SAMINOT3",491,0)
 ;
"RTN","SAMINOT3",492,0)
 i $$XVAL("ceobrci",vals)="y" d  ;
"RTN","SAMINOT3",493,0)
 . d OUT(sp1_$$XVAL("ceobrc",vals)_"."_para)
"RTN","SAMINOT3",494,0)
 ;
"RTN","SAMINOT3",495,0)
 i $$XVAL("ceaoabbi",vals)="y" d  ;
"RTN","SAMINOT3",496,0)
 . d OUT(sp1_$$XVAL("ceaoabb",vals)_"."_para)
"RTN","SAMINOT3",497,0)
 ;
"RTN","SAMINOT3",498,0)
 i $$XVAL("ceaoabi",vals)="y" d  ;
"RTN","SAMINOT3",499,0)
 . d OUT(sp1_$$XVAL("ceaoab",vals)_"."_para)
"RTN","SAMINOT3",500,0)
 ;
"RTN","SAMINOT3",501,0)
 ;# Impression Remarks
"RTN","SAMINOT3",502,0)
 i $$XVAL("ceimre",vals)'="" d  ;
"RTN","SAMINOT3",503,0)
 . d OUT(sp1_$$XVAL("ceimre",vals)_"."_para)
"RTN","SAMINOT3",504,0)
 q
"RTN","SAMINOT3",505,0)
 ;
"RTN","SAMINOT3",506,0)
XSUB(var,vals,dict,valdx) ; extrinsic which returns the dictionary value defined by var
"RTN","SAMINOT3",507,0)
 ; vals and dict are passed by name
"RTN","SAMINOT3",508,0)
 ; valdx is used for nodules ala cect2co with the nodule number included
"RTN","SAMINOT3",509,0)
 ;n dict s dict=$$setroot^%wd("cteval-dict")
"RTN","SAMINOT3",510,0)
 n zr,zv,zdx
"RTN","SAMINOT3",511,0)
 s zdx=$g(valdx)
"RTN","SAMINOT3",512,0)
 i zdx="" s zdx=var
"RTN","SAMINOT3",513,0)
 s zv=$g(@vals@(zdx))
"RTN","SAMINOT3",514,0)
 ;i zv="" s zr="["_var_"]" q zr
"RTN","SAMINOT3",515,0)
 i zv="" s zr="" q zr
"RTN","SAMINOT3",516,0)
 s zr=$g(@dict@(var,zv))
"RTN","SAMINOT3",517,0)
 ;i zr="" s zr="["_var_","_zv_"]"
"RTN","SAMINOT3",518,0)
 q zr
"RTN","SAMINOT3",519,0)
 ;
"RTN","SAMINUL")
0^14^B99336
"RTN","SAMINUL",1,0)
SAMINUL ;ven/gpl - ielcap: note log ;2021-10-29t23:40z
"RTN","SAMINUL",2,0)
 ;;18.0;SAMI;**9,10,11,12,15**;2020-01;Build 2
"RTN","SAMINUL",3,0)
 ;;18-15
"RTN","SAMINUL",4,0)
 ;
"RTN","SAMINUL",5,0)
 ; SAMINOTE contains subroutines for producing the ELCAP Note Pages.
"RTN","SAMINUL",6,0)
 ; SAMINUL contains the development log for the SAMINOT* routines.
"RTN","SAMINUL",7,0)
 ; It contains no executable code.
"RTN","SAMINUL",8,0)
 ;
"RTN","SAMINUL",9,0)
 quit  ; no entry from top
"RTN","SAMINUL",10,0)
 ;
"RTN","SAMINUL",11,0)
 ;
"RTN","SAMINUL",12,0)
 ;
"RTN","SAMINUL",13,0)
 ;@section 0 primary development
"RTN","SAMINUL",14,0)
 ;
"RTN","SAMINUL",15,0)
 ;
"RTN","SAMINUL",16,0)
 ;
"RTN","SAMINUL",17,0)
 ;@routine-credits
"RTN","SAMINUL",18,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMINUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMINUL",20,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMINUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMINUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMINUL",23,0)
 ;@license see routine SAMIUL
"RTN","SAMINUL",24,0)
 ;
"RTN","SAMINUL",25,0)
 ;@last-update 2021-10-29t02:49z
"RTN","SAMINUL",26,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMINUL",27,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMINUL",28,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMINUL",29,0)
 ;@version 18-15
"RTN","SAMINUL",30,0)
 ;@release-date 2020-01
"RTN","SAMINUL",31,0)
 ;@patch-list **9,10,11,12,15**
"RTN","SAMINUL",32,0)
 ;
"RTN","SAMINUL",33,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMINUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMINUL",35,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMINUL",36,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMINUL",37,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMINUL",38,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMINUL",39,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMINUL",40,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMINUL",41,0)
 ;@dev-add Domenic DiNatale (dom)
"RTN","SAMINUL",42,0)
 ; domenic.dinatale@paraxialtech.com
"RTN","SAMINUL",43,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMINUL",44,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMINUL",45,0)
 ;
"RTN","SAMINUL",46,0)
 ;@module-credits
"RTN","SAMINUL",47,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMINUL",48,0)
 ; (VA-PALS)
"RTN","SAMINUL",49,0)
 ; http://va-pals.org/
"RTN","SAMINUL",50,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMINUL",51,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMINUL",52,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMINUL",53,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMINUL",54,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMINUL",55,0)
 ; http://ielcap.com/
"RTN","SAMINUL",56,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMINUL",57,0)
 ; http://paraxialtech.com/
"RTN","SAMINUL",58,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMINUL",59,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMINUL",60,0)
 ;
"RTN","SAMINUL",61,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMINUL",62,0)
 ;
"RTN","SAMINUL",63,0)
 ; 2019-04-04/18 ven/gpl 18.0-t4 c0bb7dbf,f7b48936,9d1f2cdc,ba5f366d,
"RTN","SAMINUL",64,0)
 ; 5b2e32dc,ce322911
"RTN","SAMINUL",65,0)
 ;  SAMINOT1 flags for intake form, fix crash on intake form, initial
"RTN","SAMINUL",66,0)
 ; version of new intake notes, revise text for pre-enrollment
"RTN","SAMINUL",67,0)
 ; discusstion note, complete new intake notes, add intake notes to
"RTN","SAMINUL",68,0)
 ; case review page.
"RTN","SAMINUL",69,0)
 ;
"RTN","SAMINUL",70,0)
 ; 2019-04-16/23 ven/lgc 18.0-t4 e54b76d1,21388d8a,f0505e51,
"RTN","SAMINUL",71,0)
 ;  89bffd3b
"RTN","SAMINUL",72,0)
 ;  SAMINOT1 SAMIFRM2 > SAMIFORM, remove spaces at end of lines,
"RTN","SAMINUL",73,0)
 ; control characters, SAMISUB2 > LOAD.
"RTN","SAMINUL",74,0)
 ;
"RTN","SAMINUL",75,0)
 ; 2019-04-23 ven/toad 18.0-t4 423a3946
"RTN","SAMINUL",76,0)
 ;  SAMINOT1 resolve gpl/lgc collision, restore SAMISUB2 > LOAD.
"RTN","SAMINUL",77,0)
 ;
"RTN","SAMINUL",78,0)
 ; 2019-04-30 ven/gpl 18.0-t4 cf73510c
"RTN","SAMINUL",79,0)
 ;  SAMINOT1 additions to intake note for prior scans & format.
"RTN","SAMINUL",80,0)
 ;
"RTN","SAMINUL",81,0)
 ; 2019-05-07 ven/lmry 18.0-t4 4a8ead45
"RTN","SAMINUL",82,0)
 ;  SAMINOT1 edit SAMINOT1 for XINDEX.
"RTN","SAMINUL",83,0)
 ;
"RTN","SAMINUL",84,0)
 ; 2019-05-07 ven/lgc 18.0-t4 f63ef57c
"RTN","SAMINUL",85,0)
 ;  SAMINOT1 cleanup for XINDEX.
"RTN","SAMINUL",86,0)
 ;
"RTN","SAMINUL",87,0)
 ; 2019-06-18 ven/arc 18.0-t4 91022482
"RTN","SAMINUL",88,0)
 ;  SAMINOT1 ^SAMIGPL > ^SAMIUL.
"RTN","SAMINUL",89,0)
 ;
"RTN","SAMINUL",90,0)
 ; 2019-07-01 ven/gpl 18.0-t4 72868e60
"RTN","SAMINUL",91,0)
 ;  SAMINOT1 update shared decision making text in intake note.
"RTN","SAMINUL",92,0)
 ;
"RTN","SAMINUL",93,0)
 ; 2019-08-03/14 ven/gpl 18.0-t4 bea65f7b,578f61d4
"RTN","SAMINUL",94,0)
 ;  SAMINOT1 fix bugs in Have you ever smoked processing in changelog
"RTN","SAMINUL",95,0)
 ; & intake note, restored ever smoked comment field to intake note.
"RTN","SAMINUL",96,0)
 ;
"RTN","SAMINUL",97,0)
 ; 2019-09-06 par/dom 18.0-t4 2ff47189 VAP-452
"RTN","SAMINUL",98,0)
 ;  SAMINOT1 patient > participant.
"RTN","SAMINUL",99,0)
 ;
"RTN","SAMINUL",100,0)
 ; 2019-09-26 ven/gpl 18.0-t4 92b12324 VAP-420
"RTN","SAMINUL",101,0)
 ;  SAMINOT1 smoking history.
"RTN","SAMINUL",102,0)
 ;
"RTN","SAMINUL",103,0)
 ; 2019-10-01 par/dom 18.0-t4 37c418a1,4caf1a98 VAP-457,344
"RTN","SAMINUL",104,0)
 ;  SAMINOT1 remove thorax, capitalization consistency.
"RTN","SAMINUL",105,0)
 ;
"RTN","SAMINUL",106,0)
 ; 2020-01-17/20 ven/lgc 18.1 8557207f,d7d24834,0301ad95,659f2526,
"RTN","SAMINUL",107,0)
 ; 0ff2b83f,49615242,5bf7c398,dc5f618c
"RTN","SAMINUL",108,0)
 ;  SAMINOT2 followup note, fixed typos in VC note, followup LCS note
"RTN","SAMINUL",109,0)
 ; minus CT Eval pulls, LCS note with CT Eval extracts, fixed bug in
"RTN","SAMINUL",110,0)
 ; LSC CT eval extract, include entire impression section of CT Eval
"RTN","SAMINUL",111,0)
 ; report in LCS Note, improved import of impressions, limit to one
"RTN","SAMINUL",112,0)
 ; note per followup form.
"RTN","SAMINUL",113,0)
 ;
"RTN","SAMINUL",114,0)
 ; 2020-01-23 ven/arc 18.2 9a24242a
"RTN","SAMINUL",115,0)
 ;  SAMINOT1 fix word wrap on intake note & typos in ct
"RTN","SAMINUL",116,0)
 ; eval report.
"RTN","SAMINUL",117,0)
 ;
"RTN","SAMINUL",118,0)
 ; 2020-08-12 ven/gpl 18.6 781744c3
"RTN","SAMINUL",119,0)
 ;  SAMINOT1 chg to support hl7 transmission of notes.
"RTN","SAMINUL",120,0)
 ;
"RTN","SAMINUL",121,0)
 ; 2020-09-22 ven/gpl 18.6 06459eda
"RTN","SAMINUL",122,0)
 ;  SAMINOT1 fix to match kids file.
"RTN","SAMINUL",123,0)
 ;
"RTN","SAMINUL",124,0)
 ; 2021-02-01/24 ven/gpl 18.8 8e4ec441,cde71a55
"RTN","SAMINUL",125,0)
 ;  SAMINOT1 fix intake note format, fix error that sent note twice
"RTN","SAMINUL",126,0)
 ; to VistA.
"RTN","SAMINUL",127,0)
 ;
"RTN","SAMINUL",128,0)
 ; 2021-03-02 ven/gpl 18.9 479dc041
"RTN","SAMINUL",129,0)
 ;  SAMINOT2 return error message if no ct eval form exists when
"RTN","SAMINUL",130,0)
 ; generating a fu note.
"RTN","SAMINUL",131,0)
 ;
"RTN","SAMINUL",132,0)
 ; 2021-03-15/16 ven/toad 18.9 a46a2cc1
"RTN","SAMINUL",133,0)
 ;  SAMINUL create routine.
"RTN","SAMINUL",134,0)
 ;  SAMINOT2 bump date & patch list, add contents, lt refactor.
"RTN","SAMINUL",135,0)
 ;
"RTN","SAMINUL",136,0)
 ; 2021-03-17 ven/toad 18.9 62da30b4
"RTN","SAMINUL",137,0)
 ; SAMINOT2 remove blank from end of 1 line.
"RTN","SAMINUL",138,0)
 ;
"RTN","SAMINUL",139,0)
 ; 2021-03-22 ven/gpl 18.10 6319a1eb
"RTN","SAMINUL",140,0)
 ;  SAMINOT1 fix logic bug in detecting pre-enrollment existing.
"RTN","SAMINUL",141,0)
 ;
"RTN","SAMINUL",142,0)
 ; 2021-03-23 ven/toad 18.10 96f461d0
"RTN","SAMINUL",143,0)
 ;  SAMINOT1 bump date & patch list, lt refactor.
"RTN","SAMINUL",144,0)
 ;
"RTN","SAMINUL",145,0)
 ; 2021-03-29 ven/gpl 18.11 6cd83445 VAP-483
"RTN","SAMINUL",146,0)
 ;  SAMINOT1 allow N/A for shared decision making on intake form:
"RTN","SAMINUL",147,0)
 ; in INNOTE new & set shareddm & use to call SDM or report n/a, based
"RTN","SAMINUL",148,0)
 ; on siidmdc.
"RTN","SAMINUL",149,0)
 ;
"RTN","SAMINUL",150,0)
 ; 2021-03-30/05-21 ven/mcglk&toad 18.11 7b14bb2,
"RTN","SAMINUL",151,0)
 ;  SAMINOT1 bump version, date, log, add quit to stop block mismatch
"RTN","SAMINUL",152,0)
 ; complaint from XINDEX.
"RTN","SAMINUL",153,0)
 ;
"RTN","SAMINUL",154,0)
 ; 2021-06-29 ven/gpl 18.12-t2 a5bbd37a,d865b0dc
"RTN","SAMINUL",155,0)
 ;  SAMINOT1,2 text box formatting for intake & followup notes, new
"RTN","SAMINUL",156,0)
 ; text processing utils; restrict follow forms to one generated note.
"RTN","SAMINUL",157,0)
 ;
"RTN","SAMINUL",158,0)
 ; 2021-07-01 ven/mcglk&toad 18.12-t2 cbf7e46b
"RTN","SAMINUL",159,0)
 ;  SAMINOT1,2 bump dates & versions, update dev log, update contents.
"RTN","SAMINUL",160,0)
 ;
"RTN","SAMINUL",161,0)
 ; 2021-10-19 ven/gpl 18-15 138d45e5
"RTN","SAMINUL",162,0)
 ;  SAMINOT1,2,3 parameterize veteran vs participant or candidate for notes
"RTN","SAMINUL",163,0)
 ;
"RTN","SAMINUL",164,0)
 ; 2021-10-25 ven/gpl 18-15 15b95a8b
"RTN","SAMINUL",165,0)
 ;  SAMINOT3 removed parenthetical phone numbers
"RTN","SAMINUL",166,0)
 ;
"RTN","SAMINUL",167,0)
 ; 2021-10-29 ven/lmry 18-15
"RTN","SAMINUL",168,0)
 ;  SAMINUL SAMINOT1,2,3 bump dates & versions, update dev log
"RTN","SAMINUL",169,0)
 ;  SAMINOT3 add semicolon; remove space, add space for XINDEX
"RTN","SAMINUL",170,0)
 ;
"RTN","SAMINUL",171,0)
 ;
"RTN","SAMINUL",172,0)
 ;
"RTN","SAMINUL",173,0)
EOR ; end of routine SAMINUL
"RTN","SAMIPARM")
0^15^B19044741
"RTN","SAMIPARM",1,0)
SAMIPARM ;ven/gpl - get params web service ;2021-10-29t20:11z
"RTN","SAMIPARM",2,0)
 ;;18.0;SAMI;**12,15**;2020-01;Build 2
"RTN","SAMIPARM",3,0)
 ;;18-15
"RTN","SAMIPARM",4,0)
 ;
"RTN","SAMIPARM",5,0)
 ; Routine SAMIPARM contains subroutines for implementing the VAPALS-
"RTN","SAMIPARM",6,0)
 ; ELCAP get params web service.
"RTN","SAMIPARM",7,0)
 ;
"RTN","SAMIPARM",8,0)
 quit  ; no entry from top
"RTN","SAMIPARM",9,0)
 ;
"RTN","SAMIPARM",10,0)
 ;
"RTN","SAMIPARM",11,0)
 ;
"RTN","SAMIPARM",12,0)
 ;@section 0 primary development
"RTN","SAMIPARM",13,0)
 ;
"RTN","SAMIPARM",14,0)
 ;
"RTN","SAMIPARM",15,0)
 ;
"RTN","SAMIPARM",16,0)
 ;@routine-credits
"RTN","SAMIPARM",17,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIPARM",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIPARM",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIPARM",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIPARM",21,0)
 ;@copyright 2021, gpl, all rights reserved
"RTN","SAMIPARM",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIPARM",23,0)
 ;
"RTN","SAMIPARM",24,0)
 ;@last-update 2021-10-29t20:11z
"RTN","SAMIPARM",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIPARM",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIPARM",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIPARM",28,0)
 ;@version 18-15
"RTN","SAMIPARM",29,0)
 ;@release-date 2020-01
"RTN","SAMIPARM",30,0)
 ;@patch-list **12,15**
"RTN","SAMIPARM",31,0)
 ;
"RTN","SAMIPARM",32,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIPARM",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMIPARM",34,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIPARM",35,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIPARM",36,0)
 ;
"RTN","SAMIPARM",37,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIPARM",38,0)
 ; 2021-05-29/06-05 ven/gpl 18.12-t2 46bab765,223b5900
"RTN","SAMIPARM",39,0)
 ;  SAMIPARM new routine to implement new web service get params,
"RTN","SAMIPARM",40,0)
 ; update for ssn in report, also, matching report; upgrade PARM with
"RTN","SAMIPARM",41,0)
 ; SYS overrides, add systemDemoOnly & systemDemoUseDUZ.
"RTN","SAMIPARM",42,0)
 ;
"RTN","SAMIPARM",43,0)
 ; 2021-07-01 ven/mcglk&toad 18.12-t2 cbf7e46b
"RTN","SAMIPARM",44,0)
 ;  SAMIPARM bump version & dates, add hdr comments & dev log.
"RTN","SAMIPARM",45,0)
 ;
"RTN","SAMIPARM",46,0)
 ; 2021-07-14 ven/toad 18-12-t3 e36d755d
"RTN","SAMIPARM",47,0)
 ;  SAMIPARM bump 12-t2 to 12-t3, log commit ids, date formats
"RTN","SAMIPARM",48,0)
 ;
"RTN","SAMIPARM",49,0)
 ; 2021-08-11 ven/toad 18-12 b16cd38f
"RTN","SAMIPARM",50,0)
 ;  SAMIPARM SAMI 18.12 routines ready to validate
"RTN","SAMIPARM",51,0)
 ;
"RTN","SAMIPARM",52,0)
 ; 2021-10-17 ven/gpl 18-15 b14fcbcf
"RTN","SAMIPARM",53,0)
 ;  SAMIPARM fix the param web service to provide SYS parameters if no site
"RTN","SAMIPARM",54,0)
 ;  is provided
"RTN","SAMIPARM",55,0)
 ;
"RTN","SAMIPARM",56,0)
 ; 2021-10-26 ven/gpl 18-15 d12b1b10
"RTN","SAMIPARM",57,0)
 ;  SAMIPARM parameter detection routine for identifying VA systems
"RTN","SAMIPARM",58,0)
 ;
"RTN","SAMIPARM",59,0)
 ; 2021-10-27 ven/gpl 18-15 a7274e10,a58c42df
"RTN","SAMIPARM",60,0)
 ;  SAMIPARM create SETPARM routine, upgraded SETPARM to add SYS if not there
"RTN","SAMIPARM",61,0)
 ;
"RTN","SAMIPARM",62,0)
 ; 2021-10-29 ven/lmry 18-15
"RTN","SAMIPARM",63,0)
 ;  SAMIPARM update history and table of contents, bump dates and versions
"RTN","SAMIPARM",64,0)
 ;
"RTN","SAMIPARM",65,0)
 ;@contents
"RTN","SAMIPARM",66,0)
 ; WSPARAMS web service WSPARAMS^SAMIPARM, site paramters
"RTN","SAMIPARM",67,0)
 ; $$GET1PARM value of one parameter for site
"RTN","SAMIPARM",68,0)
 ; GETARY return parameter array
"RTN","SAMIPARM",69,0)
 ; GETSYS returns SYS (system) parameters
"RTN","SAMIPARM",70,0)
 ; ISVA sets filter based on parms
"RTN","SAMIPARM",71,0)
 ; SETPARM
"RTN","SAMIPARM",72,0)
 ; ADDSVC init to install get params web service
"RTN","SAMIPARM",73,0)
 ;
"RTN","SAMIPARM",74,0)
 ;
"RTN","SAMIPARM",75,0)
 ;
"RTN","SAMIPARM",76,0)
 ;@section 1 subroutines
"RTN","SAMIPARM",77,0)
 ;
"RTN","SAMIPARM",78,0)
 ;
"RTN","SAMIPARM",79,0)
 ;
"RTN","SAMIPARM",80,0)
WSPARAMS(parmsjson,filter) ; web service that returns the paramters to use
"RTN","SAMIPARM",81,0)
 ; for the site, passed in as fliter("site"), as json
"RTN","SAMIPARM",82,0)
 d  ;
"RTN","SAMIPARM",83,0)
 . n site
"RTN","SAMIPARM",84,0)
 . s site=$g(filter("site"))
"RTN","SAMIPARM",85,0)
 . i site="" s site=$g(filter("siteid"))
"RTN","SAMIPARM",86,0)
 . ;q:site=""
"RTN","SAMIPARM",87,0)
 . n parms
"RTN","SAMIPARM",88,0)
 . i site="" d  ;
"RTN","SAMIPARM",89,0)
 . . d GETSYS(.parms)
"RTN","SAMIPARM",90,0)
 . e  d GETARY(.parms,site)
"RTN","SAMIPARM",91,0)
 . d ENCODE^%webjson("parms","parmsjson")
"RTN","SAMIPARM",92,0)
 . set HTTPRSP("mime")="application/json"
"RTN","SAMIPARM",93,0)
 q
"RTN","SAMIPARM",94,0)
 ;
"RTN","SAMIPARM",95,0)
 ;
"RTN","SAMIPARM",96,0)
 ;
"RTN","SAMIPARM",97,0)
GET1PARM(PARM,SITE) ; extrinsic returns the vale of PARM for site SITE
"RTN","SAMIPARM",98,0)
 ; both passed by value
"RTN","SAMIPARM",99,0)
 i '$d(SITE) S SITE=""
"RTN","SAMIPARM",100,0)
 n ary
"RTN","SAMIPARM",101,0)
 d GETARY(.ary,SITE)
"RTN","SAMIPARM",102,0)
 ;ZWR ary
"RTN","SAMIPARM",103,0)
 Q:'$D(ary) ""
"RTN","SAMIPARM",104,0)
 q $g(ary(PARM))
"RTN","SAMIPARM",105,0)
 ;
"RTN","SAMIPARM",106,0)
 ;
"RTN","SAMIPARM",107,0)
 ;
"RTN","SAMIPARM",108,0)
GETARY(ARY,SITE) ; return the parameter array ARY, passed by reference
"RTN","SAMIPARM",109,0)
 ;
"RTN","SAMIPARM",110,0)
 I $L(SITE)'=3 D  Q  ; poorly formed SITE indicator
"RTN","SAMIPARM",111,0)
 . D GETSYS(.ARY) ; pass back only SYS parameters
"RTN","SAMIPARM",112,0)
 N SITEIEN S SITEIEN=""
"RTN","SAMIPARM",113,0)
 I SITE'="" S SITEIEN=$O(^SAMI(311.12,"SYM",SITE,""))
"RTN","SAMIPARM",114,0)
 N DEFREC ; default record in SAMI PARAMETER DEFAULT 311.14
"RTN","SAMIPARM",115,0)
 I SITEIEN'="" S DEFREC=$$GET1^DIQ(311.12,SITEIEN_",",.04,"E")
"RTN","SAMIPARM",116,0)
 I $G(DEFREC)="" S DEFREC="VHA"
"RTN","SAMIPARM",117,0)
 M ARY=^SAMI(311.14,"D",DEFREC)
"RTN","SAMIPARM",118,0)
 I SITE'="" M ARY=^SAMI(311.12,"D",SITE)
"RTN","SAMIPARM",119,0)
 D GETSYS(.ARY)
"RTN","SAMIPARM",120,0)
 Q
"RTN","SAMIPARM",121,0)
 ;
"RTN","SAMIPARM",122,0)
GETSYS(ARY) ; returns SYS (system) parameters
"RTN","SAMIPARM",123,0)
 Q:'$D(^SAMI(311.14,"D","SYS"))
"RTN","SAMIPARM",124,0)
 M ARY=^SAMI(311.14,"D","SYS")
"RTN","SAMIPARM",125,0)
 Q
"RTN","SAMIPARM",126,0)
 ;
"RTN","SAMIPARM",127,0)
ISVA(filter) ; sets filter based on parms
"RTN","SAMIPARM",128,0)
 ;
"RTN","SAMIPARM",129,0)
 n site s site=$g(filter("siteid"))
"RTN","SAMIPARM",130,0)
 q:site=""
"RTN","SAMIPARM",131,0)
 new ISVA set ISVA=$$GET1PARM^SAMIPARM("veteransAffairsSite",site)
"RTN","SAMIPARM",132,0)
 set filter("veteransAffairsSite")=ISVA
"RTN","SAMIPARM",133,0)
 Q $S(ISVA="false":0,1:1)
"RTN","SAMIPARM",134,0)
 ;
"RTN","SAMIPARM",135,0)
SETPARM(LVL,PNAME,VALUE) ; 
"RTN","SAMIPARM",136,0)
 ;
"RTN","SAMIPARM",137,0)
 N ien,SAMIERR
"RTN","SAMIPARM",138,0)
 S ien=$o(^SAMI(311.14,"B",$G(LVL),"")) ; locate parameter set
"RTN","SAMIPARM",139,0)
 i ien="" d  ;
"RTN","SAMIPARM",140,0)
 . if LVL="SYS" d  ;
"RTN","SAMIPARM",141,0)
 . . n fda
"RTN","SAMIPARM",142,0)
 . . s fda(311.14,"?+1,",.01)="SYS"
"RTN","SAMIPARM",143,0)
 . . d UPDATE^DIE("","fda","","SAMIERR")
"RTN","SAMIPARM",144,0)
 . . i $d(SAMIERR) D ^ZTER
"RTN","SAMIPARM",145,0)
 . . S ien=$o(^SAMI(311.14,"B",$G(LVL),"")) ; locate parameter set
"RTN","SAMIPARM",146,0)
 I ien="" q
"RTN","SAMIPARM",147,0)
 Q:$G(PNAME)=""
"RTN","SAMIPARM",148,0)
 n pien s pien=$o(^SAMI(311.14,ien,1,"B",$G(PNAME),""))
"RTN","SAMIPARM",149,0)
 i pien="" d  ; add the parameter to the set
"RTN","SAMIPARM",150,0)
 . n fda
"RTN","SAMIPARM",151,0)
 . s fda(311.141,"?+1,"_ien_",",.01)=PNAME
"RTN","SAMIPARM",152,0)
 . D UPDATE^DIE("","fda","","SAMIERR")
"RTN","SAMIPARM",153,0)
 . s pien=$o(^SAMI(311.14,ien,1,"B",$G(PNAME),""))
"RTN","SAMIPARM",154,0)
 i pien="" D ^ZTER
"RTN","SAMIPARM",155,0)
 ;
"RTN","SAMIPARM",156,0)
 N FDA
"RTN","SAMIPARM",157,0)
 S FDA(311.141,pien_","_ien_",",.02)=VALUE
"RTN","SAMIPARM",158,0)
 D UPDATE^DIE("","FDA","","SAMIERR")
"RTN","SAMIPARM",159,0)
 I $D(SAMIERR) D ^ZTER
"RTN","SAMIPARM",160,0)
 S ^SAMI(311.14,"D",LVL,PNAME)=VALUE
"RTN","SAMIPARM",161,0)
 Q
"RTN","SAMIPARM",162,0)
 ;
"RTN","SAMIPARM",163,0)
ADDSVC() ; add the params webservice to the system
"RTN","SAMIPARM",164,0)
 d addService^%webutils("GET","params","WSPARAMS^SAMIPARM")
"RTN","SAMIPARM",165,0)
 Q
"RTN","SAMIPARM",166,0)
 ;
"RTN","SAMIPARM",167,0)
 ;
"RTN","SAMIPARM",168,0)
 ;
"RTN","SAMIPARM",169,0)
EOR ; end of routine SAMIPARM
"RTN","SAMIPAT")
0^16^B5966351
"RTN","SAMIPAT",1,0)
SAMIPAT ;ven/toad - init subroutines ;2021-10-29t22:32z
"RTN","SAMIPAT",2,0)
 ;;18.0;SAMI;**12,14,15**;2020-01;Build 2
"RTN","SAMIPAT",3,0)
 ;;18-15
"RTN","SAMIPAT",4,0)
 ;
"RTN","SAMIPAT",5,0)
 ; Routine SAMIPAT contains VAPALS-ELCAP initialization subroutines
"RTN","SAMIPAT",6,0)
 ; to use as KIDS pre- & post-installs & environment checks.
"RTN","SAMIPAT",7,0)
 ;
"RTN","SAMIPAT",8,0)
 quit  ; no entry from top
"RTN","SAMIPAT",9,0)
 ;
"RTN","SAMIPAT",10,0)
 ;
"RTN","SAMIPAT",11,0)
 ;
"RTN","SAMIPAT",12,0)
 ;@section 0 primary development
"RTN","SAMIPAT",13,0)
 ;
"RTN","SAMIPAT",14,0)
 ;
"RTN","SAMIPAT",15,0)
 ;
"RTN","SAMIPAT",16,0)
 ;@routine-credits
"RTN","SAMIPAT",17,0)
 ;@dev-main Frederick D. S. Marshall (toad)
"RTN","SAMIPAT",18,0)
 ; toad@vistaexpertise.net
"RTN","SAMIPAT",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIPAT",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIPAT",21,0)
 ;@copyright 2021, toad, all rights reserved
"RTN","SAMIPAT",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIPAT",23,0)
 ;
"RTN","SAMIPAT",24,0)
 ;@last-update 2021-10-29t22:32z
"RTN","SAMIPAT",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIPAT",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIPAT",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIPAT",28,0)
 ;@version 18.14
"RTN","SAMIPAT",29,0)
 ;@release-date 2020-01
"RTN","SAMIPAT",30,0)
 ;@patch-list **12,14**
"RTN","SAMIPAT",31,0)
 ;
"RTN","SAMIPAT",32,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIPAT",33,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIPAT",34,0)
 ;@dev-add George P. Lilly (gpl)
"RTN","SAMIPAT",35,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIPAT",36,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIPAT",37,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIPAT",38,0)
 ;
"RTN","SAMIPAT",39,0)
 ;@routine-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIPAT",40,0)
 ; 2021-07-01 ven/mcglk&toad 18.12-t2 cbf7e46b
"RTN","SAMIPAT",41,0)
 ;  SAMIPAT new routine, new POS1812 post-install for patch 12.
"RTN","SAMIPAT",42,0)
 ;
"RTN","SAMIPAT",43,0)
 ; 2021-07-22/23 ven/toad 18.12  
"RTN","SAMIPAT",44,0)
 ;  SAMIPAT add PRE1812 pre-install.
"RTN","SAMIPAT",45,0)
 ;
"RTN","SAMIPAT",46,0)
 ; 2021-08-11 ven/mcglk&toad 18.12  b16cd38f
"RTN","SAMIPAT",47,0)
 ;  SAMIPAT rip out PRE1812.
"RTN","SAMIPAT",48,0)
 ;
"RTN","SAMIPAT",49,0)
 ; 2021-09-08 ven/lmry 18.14  2af1f2e7
"RTN","SAMIPAT",50,0)
 ;  SAMIPAT add post-install for patch SAMI*1.18*14
"RTN","SAMIPAT",51,0)
 ;
"RTN","SAMIPAT",52,0)
 ; 2021-10-28 ven/lmry 18-15
"RTN","SAMIPAT",53,0)
 ;  SAMIPAT create a STANDARD subroutine with post-install commands that are used
"RTN","SAMIPAT",54,0)
 ;  for almost all patches. Change POS1814 to use that routine and add POS1815.
"RTN","SAMIPAT",55,0)
 ;
"RTN","SAMIPAT",56,0)
 ; 2021-10-29 ven/lmry 18-15
"RTN","SAMIPAT",57,0)
 ;  SAMIPAT remove a space before STANDARD
"RTN","SAMIPAT",58,0)
 ;
"RTN","SAMIPAT",59,0)
 ;
"RTN","SAMIPAT",60,0)
 ;@contents
"RTN","SAMIPAT",61,0)
 ; STANDARD usual post-install commands
"RTN","SAMIPAT",62,0)
 ; POS1812 kids post-install for sami 18.12
"RTN","SAMIPAT",63,0)
 ; POS1814 kids post-install for sami 18.14
"RTN","SAMIPAT",64,0)
 ; POS1815 kids post-install for sami 18.15
"RTN","SAMIPAT",65,0)
 ;
"RTN","SAMIPAT",66,0)
 ;
"RTN","SAMIPAT",67,0)
 ;
"RTN","SAMIPAT",68,0)
 ;@section 1 subroutine for most patches
"RTN","SAMIPAT",69,0)
 ;
"RTN","SAMIPAT",70,0)
STANDARD ; usual post-install commands
"RTN","SAMIPAT",71,0)
 set SAMIDIR="/home/osehra/lib/silver/a-sami-vapals-elcap--vo-osehra-github/docs/form-fields/"
"RTN","SAMIPAT",72,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"background.tsv","form fields - background")
"RTN","SAMIPAT",73,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"biopsy.tsv","form fields - biopsy")
"RTN","SAMIPAT",74,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"ct-evaluation.tsv","form fields - ct evaluation")
"RTN","SAMIPAT",75,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"follow-up.tsv","form fields - follow up")
"RTN","SAMIPAT",76,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"intake.tsv","form fields - intake")
"RTN","SAMIPAT",77,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"intervention.tsv","form fields - intervention")
"RTN","SAMIPAT",78,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"pet-evaluation.tsv","form fields - pet evaluation")
"RTN","SAMIPAT",79,0)
 ;do PRSTSV^SAMIFF(SAMIDIR,"register.tsv","form fields - register")
"RTN","SAMIPAT",80,0)
 do DODD^SAMIADMN(SAMIDIR) ; to import tsv files to generate DD graphs
"RTN","SAMIPAT",81,0)
 do CLRWEB^SAMIADMN ; Clear the M Web Server files cache
"RTN","SAMIPAT",82,0)
 do INIT2GPH^SAMICTD2 ; initialize CTEVAL dictionary into graph cteval-dict
"RTN","SAMIPAT",83,0)
 ;
"RTN","SAMIPAT",84,0)
 ;
"RTN","SAMIPAT",85,0)
 ;
"RTN","SAMIPAT",86,0)
 ;@section 2 subroutines for SAMI 18.12
"RTN","SAMIPAT",87,0)
 ;
"RTN","SAMIPAT",88,0)
 ;@kids-post POST1812^SAMIPAT
"RTN","SAMIPAT",89,0)
POS1812 ; kids post-install for sami 18.12
"RTN","SAMIPAT",90,0)
 ;
"RTN","SAMIPAT",91,0)
 do ADDSVC^SAMIPARM ; install get params web service
"RTN","SAMIPAT",92,0)
 ;
"RTN","SAMIPAT",93,0)
 ; in honor of Tchaikovsky's overture: boom
"RTN","SAMIPAT",94,0)
 ;
"RTN","SAMIPAT",95,0)
 quit  ; end of kids-post POS1812^SAMIPAT
"RTN","SAMIPAT",96,0)
 ;
"RTN","SAMIPAT",97,0)
 ;
"RTN","SAMIPAT",98,0)
 ;
"RTN","SAMIPAT",99,0)
 ;@section 3 subroutines for SAMI 18.14
"RTN","SAMIPAT",100,0)
 ;
"RTN","SAMIPAT",101,0)
 ;@kids-post POST1814^SAMIPAT
"RTN","SAMIPAT",102,0)
POS1814 ; kids post-install for sami 18.14
"RTN","SAMIPAT",103,0)
 ;
"RTN","SAMIPAT",104,0)
 do STANDARD
"RTN","SAMIPAT",105,0)
 ;
"RTN","SAMIPAT",106,0)
 quit  ; end of kids-post POS1814^SAMIPAT
"RTN","SAMIPAT",107,0)
 ;
"RTN","SAMIPAT",108,0)
 ;
"RTN","SAMIPAT",109,0)
 ;
"RTN","SAMIPAT",110,0)
 ;@section 4 subroutines for SAMI 18.15
"RTN","SAMIPAT",111,0)
 ;
"RTN","SAMIPAT",112,0)
 ;@kids-post POST1815^SAMIPAT
"RTN","SAMIPAT",113,0)
POS1815 ; kids post-install for sami 18.15
"RTN","SAMIPAT",114,0)
 ;
"RTN","SAMIPAT",115,0)
 do STANDARD
"RTN","SAMIPAT",116,0)
 do SETPARM^SAMIPARM("SYS","samiSystemVersion","sami-18-15-t1")
"RTN","SAMIPAT",117,0)
 ;
"RTN","SAMIPAT",118,0)
 quit  ; end of kids-post POS1815^SAMIPAT
"RTN","SAMIPAT",119,0)
 ;
"RTN","SAMIPAT",120,0)
 ;
"RTN","SAMIPAT",121,0)
 ;
"RTN","SAMIPAT",122,0)
 ;@section 5 subroutines for future versions...
"RTN","SAMIPAT",123,0)
 ;
"RTN","SAMIPAT",124,0)
 ;
"RTN","SAMIPAT",125,0)
 ;
"RTN","SAMIPAT",126,0)
EOR ; end of routine SAMIPAT
"RTN","SAMIUR")
0^17^B672809912
"RTN","SAMIUR",1,0)
SAMIUR ;ven/gpl - user reports ;2021-10-29t23:57z
"RTN","SAMIUR",2,0)
 ;;18.0;SAMI;**5,10,11,12,14,15**;2020-01;Build 2
"RTN","SAMIUR",3,0)
 ;;18-15
"RTN","SAMIUR",4,0)
 ;
"RTN","SAMIUR",5,0)
 ; SAMIUR contains a web service & associated subroutines to produce
"RTN","SAMIUR",6,0)
 ; VAPALS-ELCAP user reports.
"RTN","SAMIUR",7,0)
 ;
"RTN","SAMIUR",8,0)
 quit  ; no entry from top
"RTN","SAMIUR",9,0)
 ;
"RTN","SAMIUR",10,0)
 ;
"RTN","SAMIUR",11,0)
 ;
"RTN","SAMIUR",12,0)
 ;@section 0 primary development
"RTN","SAMIUR",13,0)
 ;
"RTN","SAMIUR",14,0)
 ;
"RTN","SAMIUR",15,0)
 ;
"RTN","SAMIUR",16,0)
 ;@routine-credits
"RTN","SAMIUR",17,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIUR",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUR",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIUR",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIUR",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIUR",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIUR",23,0)
 ;
"RTN","SAMIUR",24,0)
 ;@last-update 2021-10-29t23:57z
"RTN","SAMIUR",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIUR",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIUR",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUR",28,0)
 ;@version 18-15
"RTN","SAMIUR",29,0)
 ;@release-date 2020-01
"RTN","SAMIUR",30,0)
 ;@patch-list **5,10,11,12,14,15**
"RTN","SAMIUR",31,0)
 ;
"RTN","SAMIUR",32,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIUR",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUR",34,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIUR",35,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIUR",36,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIUR",37,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIUR",38,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIUR",39,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIUR",40,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIUR",41,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIUR",42,0)
 ;
"RTN","SAMIUR",43,0)
 ;@module-credits see SAMIHUL
"RTN","SAMIUR",44,0)
 ;
"RTN","SAMIUR",45,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUR",46,0)
 ; see SAMIURUL
"RTN","SAMIUR",47,0)
 ;
"RTN","SAMIUR",48,0)
 ;@contents
"RTN","SAMIUR",49,0)
 ; WSREPORT generate report based on params in filter
"RTN","SAMIUR",50,0)
 ; SORT sort patients by name
"RTN","SAMIUR",51,0)
 ; NUHREF create nuhref link to casereview for all patients
"RTN","SAMIUR",52,0)
 ; PNAME page name for report
"RTN","SAMIUR",53,0)
 ;
"RTN","SAMIUR",54,0)
 ; SELECT select patients for report
"RTN","SAMIUR",55,0)
 ; UNMAT build unmatched persons list
"RTN","SAMIUR",56,0)
 ; WKLIST build work list
"RTN","SAMIUR",57,0)
 ;
"RTN","SAMIUR",58,0)
 ;
"RTN","SAMIUR",59,0)
 ;
"RTN","SAMIUR",60,0)
 ;@section 1 wsreport subroutines
"RTN","SAMIUR",61,0)
 ;
"RTN","SAMIUR",62,0)
 ;
"RTN","SAMIUR",63,0)
 ;
"RTN","SAMIUR",64,0)
WSREPORT(SAMIRTN,filter) ; generate report based on params in filter
"RTN","SAMIUR",65,0)
 ;
"RTN","SAMIUR",66,0)
 ;@called-by
"RTN","SAMIUR",67,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIUR",68,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIUR",69,0)
 ;@calls
"RTN","SAMIUR",70,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIUR",71,0)
 ; getThis^%wd
"RTN","SAMIUR",72,0)
 ; SELECT
"RTN","SAMIUR",73,0)
 ; LOAD^SAMIFORM
"RTN","SAMIUR",74,0)
 ; $$PNAME
"RTN","SAMIUR",75,0)
 ; findReplace^%ts
"RTN","SAMIUR",76,0)
 ; RPTTBL^SAMIUR2
"RTN","SAMIUR",77,0)
 ; NUHREF
"RTN","SAMIUR",78,0)
 ; SORT
"RTN","SAMIUR",79,0)
 ; @RPT(ir,"routine"): [from report def table from RPTTBL^SAMIUR2]
"RTN","SAMIUR",80,0)
 ;  format = $$<tag>^SAMIUR2, where tag =
"RTN","SAMIUR",81,0)
 ;  AGE       BLINEDT   CONTACT   CTPROT   DOB      FUDATE    GENDER
"RTN","SAMIUR",82,0)
 ;  IFORM     LASTEXM   MANPAT    MATCH    NAME     PACKYRS   POSSIBLE
"RTN","SAMIUR",83,0)
 ;  RECOM     RURAL     SID       SMHIS    SMKSTAT  SSN       STUDYDT
"RTN","SAMIUR",84,0)
 ;  STUDYTYP  VALS      WHEN      WORKPAT
"RTN","SAMIUR",85,0)
 ;
"RTN","SAMIUR",86,0)
 ; here are the user reports that are defined:
"RTN","SAMIUR",87,0)
 ;  1. followup
"RTN","SAMIUR",88,0)
 ;  2. activity
"RTN","SAMIUR",89,0)
 ;  3. missingct
"RTN","SAMIUR",90,0)
 ;  4. incomplete
"RTN","SAMIUR",91,0)
 ;  5. outreach
"RTN","SAMIUR",92,0)
 ;  6. enrollment
"RTN","SAMIUR",93,0)
 ;  7. worklist
"RTN","SAMIUR",94,0)
 ; the report to generate is passed in parameter samireporttype
"RTN","SAMIUR",95,0)
 ;
"RTN","SAMIUR",96,0)
 new debug set debug=0
"RTN","SAMIUR",97,0)
 if $get(filter("debug"))=1 set debug=1
"RTN","SAMIUR",98,0)
 if $get(filter("debug"))=1 set debug=1
"RTN","SAMIUR",99,0)
 kill SAMIRTN
"RTN","SAMIUR",100,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMIUR",101,0)
 ;
"RTN","SAMIUR",102,0)
 new type,temp,site
"RTN","SAMIUR",103,0)
 s site=$g(filter("siteid"))
"RTN","SAMIUR",104,0)
 i site="" s site=$g(filter("site"))
"RTN","SAMIUR",105,0)
 i site="" d  q  ; report site missing
"RTN","SAMIUR",106,0)
 . d GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",107,0)
 ;
"RTN","SAMIUR",108,0)
 set type=$get(filter("samireporttype"))
"RTN","SAMIUR",109,0)
 if type="" do  quit  ; report type missing
"RTN","SAMIUR",110,0)
 . do GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",111,0)
 . quit
"RTN","SAMIUR",112,0)
 ;
"RTN","SAMIUR",113,0)
 if type="unmatched" i $$GET1PARM^SAMIPARM("matchingReportEnabled",site)'="true" do  quit  ;
"RTN","SAMIUR",114,0)
 . d GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",115,0)
 ;
"RTN","SAMIUR",116,0)
 do getThis^%wd("temp","table.html") ; page template
"RTN","SAMIUR",117,0)
 quit:'$data(temp)
"RTN","SAMIUR",118,0)
 ;
"RTN","SAMIUR",119,0)
 new SAMIPATS
"RTN","SAMIUR",120,0)
 ; set pats=""
"RTN","SAMIUR",121,0)
 new datephrase
"RTN","SAMIUR",122,0)
 do SELECT(.SAMIPATS,type,.datephrase,.filter) ; select pats for report
"RTN","SAMIUR",123,0)
 ; quit:'$data(SAMIPATS)
"RTN","SAMIUR",124,0)
 ;
"RTN","SAMIUR",125,0)
 new ln,cnt,ii
"RTN","SAMIUR",126,0)
 set (ii,ln,cnt)=0
"RTN","SAMIUR",127,0)
 for  do  quit:'ii  quit:$get(temp(ii))["<thead"
"RTN","SAMIUR",128,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",129,0)
 . quit:'ii
"RTN","SAMIUR",130,0)
 . quit:$get(temp(ii))["<thead"
"RTN","SAMIUR",131,0)
 . ;
"RTN","SAMIUR",132,0)
 . set cnt=cnt+1
"RTN","SAMIUR",133,0)
 . set ln=$get(temp(ii))
"RTN","SAMIUR",134,0)
 . new samikey,si
"RTN","SAMIUR",135,0)
 . set (samikey,si)=""
"RTN","SAMIUR",136,0)
 . do LOAD^SAMIFORM(.ln,samikey,si,.filter)
"RTN","SAMIUR",137,0)
 . ; if ln["PAGE NAME" do
"RTN","SAMIUR",138,0)
 . ; . do findReplace^%ts(.ln,"PAGE NAME",$$PNAME(type,datephrase))
"RTN","SAMIUR",139,0)
 . ; . quit
"RTN","SAMIUR",140,0)
 . if ln["PAGE NAME" do
"RTN","SAMIUR",141,0)
 . . do findReplace^%ts(.ln,"PAGE NAME",$$PNAME(type,""))
"RTN","SAMIUR",142,0)
 . . quit
"RTN","SAMIUR",143,0)
 . if ln["CRITERIA" do
"RTN","SAMIUR",144,0)
 . . do findReplace^%ts(.ln,"CRITERIA",datephrase)
"RTN","SAMIUR",145,0)
 . . quit
"RTN","SAMIUR",146,0)
 . if ln["@@REPORTTYPE@@" do
"RTN","SAMIUR",147,0)
 . . do findReplace^%ts(.ln,"@@REPORTTYPE@@",type)
"RTN","SAMIUR",148,0)
 . . quit
"RTN","SAMIUR",149,0)
 . ;
"RTN","SAMIUR",150,0)
 . if ln["name=""start-date""" do
"RTN","SAMIUR",151,0)
 . . do findReplace^%ts(.ln,"start-date""","start-date"" value="""_$g(filter("start-date"))_"""")
"RTN","SAMIUR",152,0)
 . . quit
"RTN","SAMIUR",153,0)
 . if ln["name=""end-date""" do
"RTN","SAMIUR",154,0)
 . . do findReplace^%ts(.ln,"end-date""","end-date"" value="""_$g(filter("end-date"))_"""")
"RTN","SAMIUR",155,0)
 . . quit
"RTN","SAMIUR",156,0)
 . ;
"RTN","SAMIUR",157,0)
 . set SAMIRTN(cnt)=ln
"RTN","SAMIUR",158,0)
 . quit
"RTN","SAMIUR",159,0)
 ;
"RTN","SAMIUR",160,0)
 new RPT,ik
"RTN","SAMIUR",161,0)
 do RPTTBL^SAMIUR2(.RPT,type,site) ; load report definition table
"RTN","SAMIUR",162,0)
 if '$data(RPT) do  quit  ; don't know about this report
"RTN","SAMIUR",163,0)
 . do GETHOME^SAMIHOM3(.SAMIRTN,.filter) ; send them to home
"RTN","SAMIUR",164,0)
 . quit
"RTN","SAMIUR",165,0)
 ;
"RTN","SAMIUR",166,0)
 ; output header
"RTN","SAMIUR",167,0)
 ;
"RTN","SAMIUR",168,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="<thead><tr>"
"RTN","SAMIUR",169,0)
 set cnt=cnt+1
"RTN","SAMIUR",170,0)
 new totcnt set totcnt=cnt
"RTN","SAMIUR",171,0)
 ;
"RTN","SAMIUR",172,0)
 set ir=""
"RTN","SAMIUR",173,0)
 for  do  quit:ir=""  ;
"RTN","SAMIUR",174,0)
 . set ir=$order(RPT(ir))
"RTN","SAMIUR",175,0)
 . quit:ir=""
"RTN","SAMIUR",176,0)
 . set cnt=cnt+1
"RTN","SAMIUR",177,0)
 . set SAMIRTN(cnt)="<th>"_$get(RPT(ir,"header"))_"</th>"
"RTN","SAMIUR",178,0)
 . quit
"RTN","SAMIUR",179,0)
 ;
"RTN","SAMIUR",180,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="</tr></thead>"
"RTN","SAMIUR",181,0)
 ;
"RTN","SAMIUR",182,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="<tbody>"
"RTN","SAMIUR",183,0)
 ;
"RTN","SAMIUR",184,0)
 if type'="worklist" do  ;
"RTN","SAMIUR",185,0)
 . do NUHREF(.SAMIPATS) ; create the nuhref link for all patients
"RTN","SAMIUR",186,0)
 . quit
"RTN","SAMIUR",187,0)
 ;
"RTN","SAMIUR",188,0)
 new SRT set SRT=""
"RTN","SAMIUR",189,0)
 if $get(filter("sort"))="" d  ; what kind of sort
"RTN","SAMIUR",190,0)
 . set filter("sort")="name"
"RTN","SAMIUR",191,0)
 . i type="missingct" s filter("sort")="cdate" ;sort by latest contact
"RTN","SAMIUR",192,0)
 do SORT(.SRT,.SAMIPATS,.filter)
"RTN","SAMIUR",193,0)
 ; zwrite SRT
"RTN","SAMIUR",194,0)
 ;
"RTN","SAMIUR",195,0)
 ; set ij=0
"RTN","SAMIUR",196,0)
 ; for  do  quit:'ij  ;
"RTN","SAMIUR",197,0)
 ; . set ij=$order(SAMIPATS(ij))
"RTN","SAMIUR",198,0)
 ; . quit:'ij  
"RTN","SAMIUR",199,0)
 ; . new ij2 set ij2=0
"RTN","SAMIUR",200,0)
 ; . for  do  quit:'ij2  ;
"RTN","SAMIUR",201,0)
 ; . . set ij2=$order(SAMIPATS(ij,ij2))
"RTN","SAMIUR",202,0)
 ; . . quit:'ij2  
"RTN","SAMIUR",203,0)
 ; . . new dfn set dfn=ij2
"RTN","SAMIUR",204,0)
 ; . . quit
"RTN","SAMIUR",205,0)
 ; . quit
"RTN","SAMIUR",206,0)
 ;
"RTN","SAMIUR",207,0)
 new iz,ij,ij2,dfn,rows
"RTN","SAMIUR",208,0)
 set rows=0
"RTN","SAMIUR",209,0)
 set (iz,ij,ij2,dfn)=""
"RTN","SAMIUR",210,0)
 for  do  quit:iz=""  ;
"RTN","SAMIUR",211,0)
 . set iz=$order(SRT(iz))
"RTN","SAMIUR",212,0)
 . quit:iz=""
"RTN","SAMIUR",213,0)
 . set ij=$order(SRT(iz,""))
"RTN","SAMIUR",214,0)
 . set dfn=$order(SRT(iz,ij,""))
"RTN","SAMIUR",215,0)
 . do  ;
"RTN","SAMIUR",216,0)
 . . set cnt=cnt+1 set SAMIRTN(cnt)="<tr>"
"RTN","SAMIUR",217,0)
 . . set ir=""
"RTN","SAMIUR",218,0)
 . . for  do  quit:ir=""  ;
"RTN","SAMIUR",219,0)
 . . . set ir=$order(RPT(ir))
"RTN","SAMIUR",220,0)
 . . . quit:ir=""
"RTN","SAMIUR",221,0)
 . . . set cnt=cnt+1
"RTN","SAMIUR",222,0)
 . . . new XR,XRV
"RTN","SAMIUR",223,0)
 . . . ; set XR=$get(RPT(ir,"routine"))_"("_ij_",.SAMIPATS)"
"RTN","SAMIUR",224,0)
 . . . set XR="set XRV="_$get(RPT(ir,"routine"))_"("_ij_","_dfn_",.SAMIPATS)"
"RTN","SAMIUR",225,0)
 . . . ; set XRV=@XR
"RTN","SAMIUR",226,0)
 . . . xecute XR ; call report-field handlers in ^SAMIUR2
"RTN","SAMIUR",227,0)
 . . . if $extract(XRV,1,3)["<td" set SAMIRTN(cnt)=XRV
"RTN","SAMIUR",228,0)
 . . . else  set SAMIRTN(cnt)="<td>"_$get(XRV)_"</td>"
"RTN","SAMIUR",229,0)
 . . . quit
"RTN","SAMIUR",230,0)
 . . ;
"RTN","SAMIUR",231,0)
 . . set cnt=cnt+1
"RTN","SAMIUR",232,0)
 . . set SAMIRTN(cnt)="</tr>"_$CHAR(10,13)
"RTN","SAMIUR",233,0)
 . . set rows=rows+1
"RTN","SAMIUR",234,0)
 . . quit
"RTN","SAMIUR",235,0)
 . quit
"RTN","SAMIUR",236,0)
 ;
"RTN","SAMIUR",237,0)
 set cnt=cnt+1
"RTN","SAMIUR",238,0)
 ;set SAMIRTN(cnt)="<tr><td>Total: "_rows_"</td></tr>"
"RTN","SAMIUR",239,0)
 ;set SAMIRTN(totcnt)="<td>Total: "_rows_"</td></tr><tr>"
"RTN","SAMIUR",240,0)
 ;
"RTN","SAMIUR",241,0)
 set cnt=cnt+1 set SAMIRTN(cnt)="</tbody>"
"RTN","SAMIUR",242,0)
 for  do  quit:temp(ii)["</tbody>"  ;
"RTN","SAMIUR",243,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",244,0)
 . quit:temp(ii)["</tbody>"
"RTN","SAMIUR",245,0)
 . ; skip past template headers & blank body
"RTN","SAMIUR",246,0)
 . quit
"RTN","SAMIUR",247,0)
 ;
"RTN","SAMIUR",248,0)
 for  do  quit:'ii  ;
"RTN","SAMIUR",249,0)
 . set ii=$order(temp(ii))
"RTN","SAMIUR",250,0)
 . quit:'ii
"RTN","SAMIUR",251,0)
 . set cnt=cnt+1
"RTN","SAMIUR",252,0)
 . set ln=$get(temp(ii))
"RTN","SAMIUR",253,0)
 . new samikey,si
"RTN","SAMIUR",254,0)
 . set (samikey,si)=""
"RTN","SAMIUR",255,0)
 . do LOAD^SAMIFORM(.ln,samikey,si,.filter)
"RTN","SAMIUR",256,0)
 . set SAMIRTN(cnt)=ln
"RTN","SAMIUR",257,0)
 . quit
"RTN","SAMIUR",258,0)
 ;
"RTN","SAMIUR",259,0)
 quit  ; end of WSREPORT
"RTN","SAMIUR",260,0)
 ;
"RTN","SAMIUR",261,0)
 ;
"RTN","SAMIUR",262,0)
SORT(SRTN,SAMIPATS,FILTER) ; sort patients by name
"RTN","SAMIUR",263,0)
 ;
"RTN","SAMIUR",264,0)
 ;@called-by
"RTN","SAMIUR",265,0)
 ; WSREPORT
"RTN","SAMIUR",266,0)
 ;@calls
"RTN","SAMIUR",267,0)
 ; $$UPCASE^XLFMSMT
"RTN","SAMIUR",268,0)
 ;
"RTN","SAMIUR",269,0)
 new typ set typ=$get(FILTER("sort"))
"RTN","SAMIUR",270,0)
 ;
"RTN","SAMIUR",271,0)
 if typ="" set typ="name"
"RTN","SAMIUR",272,0)
 new iz,dt,dfn,nm,cdate
"RTN","SAMIUR",273,0)
 set (dt,dfn,nm)="" ; note: should dfn be initialized inside loop?
"RTN","SAMIUR",274,0)
 set iz=0
"RTN","SAMIUR",275,0)
 ;
"RTN","SAMIUR",276,0)
 new indx
"RTN","SAMIUR",277,0)
 for  do  quit:'dt  ;
"RTN","SAMIUR",278,0)
 . set dt=$order(SAMIPATS(dt))
"RTN","SAMIUR",279,0)
 . quit:'dt
"RTN","SAMIUR",280,0)
 . ; note: dfn not re-initialized to "" here; should it be?
"RTN","SAMIUR",281,0)
 . for  do  quit:'dfn  ;
"RTN","SAMIUR",282,0)
 . . set dfn=$order(SAMIPATS(dt,dfn))
"RTN","SAMIUR",283,0)
 . . quit:'dfn
"RTN","SAMIUR",284,0)
 . . if typ="name" do  ;
"RTN","SAMIUR",285,0)
 . . . set nm=$get(SAMIPATS(dt,dfn,"name"))
"RTN","SAMIUR",286,0)
 . . . set nm=$$UPCASE^XLFMSMT(nm)
"RTN","SAMIUR",287,0)
 . . . if nm="" set nm=" "
"RTN","SAMIUR",288,0)
 . . . set indx(nm,dt,dfn)=""
"RTN","SAMIUR",289,0)
 . . . quit
"RTN","SAMIUR",290,0)
 . . if typ="cdate" do  ;
"RTN","SAMIUR",291,0)
 . . . set cdate=$$LDOC^SAMIUR2(dt,dfn,.SAMIPATS)
"RTN","SAMIUR",292,0)
 . . . set cdate=$$FMDT^SAMIUR2(cdate)
"RTN","SAMIUR",293,0)
 . . . set indx(cdate,dt,dfn)=""
"RTN","SAMIUR",294,0)
 . . quit
"RTN","SAMIUR",295,0)
 . quit
"RTN","SAMIUR",296,0)
 ;
"RTN","SAMIUR",297,0)
 new iiz set iiz=""
"RTN","SAMIUR",298,0)
 set (dt,dfn)="" ; note: here, too, should inits be inside loops?
"RTN","SAMIUR",299,0)
 for  do  quit:iiz=""  ;
"RTN","SAMIUR",300,0)
 . set iiz=$order(indx(iiz))
"RTN","SAMIUR",301,0)
 . quit:iiz=""
"RTN","SAMIUR",302,0)
 . for  do  quit:dt=""  ;
"RTN","SAMIUR",303,0)
 . . set dt=$order(indx(iiz,dt))
"RTN","SAMIUR",304,0)
 . . quit:dt=""
"RTN","SAMIUR",305,0)
 . . for  do  quit:dfn=""  ;
"RTN","SAMIUR",306,0)
 . . . set dfn=$order(indx(iiz,dt,dfn))
"RTN","SAMIUR",307,0)
 . . . quit:dfn=""
"RTN","SAMIUR",308,0)
 . . . set iz=iz+1
"RTN","SAMIUR",309,0)
 . . . set SRTN(iz,dt,dfn)=iiz
"RTN","SAMIUR",310,0)
 . . . quit
"RTN","SAMIUR",311,0)
 . . quit
"RTN","SAMIUR",312,0)
 . quit
"RTN","SAMIUR",313,0)
 ;
"RTN","SAMIUR",314,0)
 quit  ; end of SORT
"RTN","SAMIUR",315,0)
 ;
"RTN","SAMIUR",316,0)
 ;
"RTN","SAMIUR",317,0)
 ;
"RTN","SAMIUR",318,0)
NUHREF(SAMIPATS) ; create nuhref link to casereview for all patients
"RTN","SAMIUR",319,0)
 ;
"RTN","SAMIUR",320,0)
 ;@called-by
"RTN","SAMIUR",321,0)
 ; WSREPORT
"RTN","SAMIUR",322,0)
 ;@calls
"RTN","SAMIUR",323,0)
 ; $$setroot^%wd
"RTN","SAMIUR",324,0)
 ; $$GETSSN^SAMIFORM
"RTN","SAMIUR",325,0)
 ;
"RTN","SAMIUR",326,0)
 new ij
"RTN","SAMIUR",327,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",328,0)
 set ij=0
"RTN","SAMIUR",329,0)
 for  do  quit:'ij  ;
"RTN","SAMIUR",330,0)
 . set ij=$order(SAMIPATS(ij))
"RTN","SAMIUR",331,0)
 . quit:'ij
"RTN","SAMIUR",332,0)
 . new ij2 set ij2=0
"RTN","SAMIUR",333,0)
 . for  do  quit:'ij2  ;
"RTN","SAMIUR",334,0)
 . . set ij2=$order(SAMIPATS(ij,ij2))
"RTN","SAMIUR",335,0)
 . . quit:'ij2
"RTN","SAMIUR",336,0)
 . . ;
"RTN","SAMIUR",337,0)
 . . new dfn set dfn=ij2
"RTN","SAMIUR",338,0)
 . . set SAMIPATS(ij,dfn,"sid")=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR",339,0)
 . . set SAMIPATS(ij,dfn,"name")=$get(@root@(dfn,"saminame"))
"RTN","SAMIUR",340,0)
 . . ;
"RTN","SAMIUR",341,0)
 . . new sid set sid=SAMIPATS(ij,dfn,"sid")
"RTN","SAMIUR",342,0)
 . . set SAMIPATS(ij,dfn,"ssn")=$$GETSSN^SAMIFORM(sid)
"RTN","SAMIUR",343,0)
 . . new name set name=SAMIPATS(ij,dfn,"name")
"RTN","SAMIUR",344,0)
 . . ;
"RTN","SAMIUR",345,0)
 . . new nuhref
"RTN","SAMIUR",346,0)
 . . set nuhref="<td data-order="""_name_""" data-search="""_name_""">"
"RTN","SAMIUR",347,0)
 . . set nuhref=nuhref_"<form method=POST action=""/vapals"">"
"RTN","SAMIUR",348,0)
 . . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""casereview"">"
"RTN","SAMIUR",349,0)
 . . set nuhref=nuhref_"<input type=hidden name=""studyid"" value="_sid_">"
"RTN","SAMIUR",350,0)
 . . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",351,0)
 . . set nuhref=nuhref_"</td>"
"RTN","SAMIUR",352,0)
 . . set SAMIPATS(ij,dfn,"nuhref")=nuhref
"RTN","SAMIUR",353,0)
 . . quit
"RTN","SAMIUR",354,0)
 . quit
"RTN","SAMIUR",355,0)
 ;
"RTN","SAMIUR",356,0)
 quit  ; end of NUHREF
"RTN","SAMIUR",357,0)
 ;
"RTN","SAMIUR",358,0)
 ;
"RTN","SAMIUR",359,0)
 ;
"RTN","SAMIUR",360,0)
PNAME(type,phrase) ; page name for report
"RTN","SAMIUR",361,0)
 ;
"RTN","SAMIUR",362,0)
 ;@called-by
"RTN","SAMIUR",363,0)
 ; WSREPORT
"RTN","SAMIUR",364,0)
 ;@calls none
"RTN","SAMIUR",365,0)
 ;
"RTN","SAMIUR",366,0)
 ; extrinsic returns the PAGE NAME for the report
"RTN","SAMIUR",367,0)
 ;
"RTN","SAMIUR",368,0)
 ; if type="followup" quit "Participant Followup next 30 days -"_$get(phrase)
"RTN","SAMIUR",369,0)
 if type="followup" quit "Participant Followup "_$get(phrase)
"RTN","SAMIUR",370,0)
 ; if type="activity" quit "Activity last 30 days -"_$get(phrase)
"RTN","SAMIUR",371,0)
 if type="activity" quit "Activity "_$get(phrase)
"RTN","SAMIUR",372,0)
 if type="missingct" quit "Intake but no CT Evaluation"_$get(phrase)
"RTN","SAMIUR",373,0)
 if type="incomplete" quit "Incomplete Forms"_$get(phrase)
"RTN","SAMIUR",374,0)
 if type="outreach" quit "Outreach"_$get(phrase)
"RTN","SAMIUR",375,0)
 if type="enrollment" quit "Enrollment"_$get(phrase)
"RTN","SAMIUR",376,0)
 if type="inactive" quit "Inactive"_$get(phrase)
"RTN","SAMIUR",377,0)
 ;
"RTN","SAMIUR",378,0)
 quit "" ; end of $$PNAME
"RTN","SAMIUR",379,0)
 ;
"RTN","SAMIUR",380,0)
 ;
"RTN","SAMIUR",381,0)
 ;
"RTN","SAMIUR",382,0)
 ;@section 2 select subroutines
"RTN","SAMIUR",383,0)
 ;
"RTN","SAMIUR",384,0)
 ;
"RTN","SAMIUR",385,0)
 ;
"RTN","SAMIUR",386,0)
SELECT(SAMIPATS,ztype,datephrase,filter) ; select patients for report
"RTN","SAMIUR",387,0)
 ;
"RTN","SAMIUR",388,0)
 ;@called-by
"RTN","SAMIUR",389,0)
 ; WSREPORT
"RTN","SAMIUR",390,0)
 ;@calls
"RTN","SAMIUR",391,0)
 ; UNMAT
"RTN","SAMIUR",392,0)
 ; WKLIST
"RTN","SAMIUR",393,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMIUR",394,0)
 ; $$NOW^XLFDT
"RTN","SAMIUR",395,0)
 ; $$FMADD^XLFDT
"RTN","SAMIUR",396,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMIUR",397,0)
 ; $$setroot^%wd
"RTN","SAMIUR",398,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIUR",399,0)
 ;
"RTN","SAMIUR",400,0)
 ; merge ^gpl("select")=filter
"RTN","SAMIUR",401,0)
 new type set type=ztype
"RTN","SAMIUR",402,0)
 if type="unmatched" do  quit  ;
"RTN","SAMIUR",403,0)
 . do UNMAT(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",404,0)
 . quit
"RTN","SAMIUR",405,0)
 if type="worklist" do  quit  ;
"RTN","SAMIUR",406,0)
 . do WKLIST(.SAMIPATS,ztype,.datephrase,.filter)
"RTN","SAMIUR",407,0)
 . quit
"RTN","SAMIUR",408,0)
 if $get(type)="" set type="enrollment"
"RTN","SAMIUR",409,0)
 if type="cumpy" set type="enrollment"
"RTN","SAMIUR",410,0)
 new site set site=$get(filter("siteid"))
"RTN","SAMIUR",411,0)
 ;
"RTN","SAMIUR",412,0)
 new strdt,enddt,fmstrdt,fmenddt
"RTN","SAMIUR",413,0)
 set strdt=$get(filter("start-date"))
"RTN","SAMIUR",414,0)
 ;set fmstrdt=$$KEY2FM^SAMICASE(strdt)
"RTN","SAMIUR",415,0)
 set fmstrdt=$$FMDT^SAMIUR2(strdt)
"RTN","SAMIUR",416,0)
 if fmstrdt=-1 do  ;
"RTN","SAMIUR",417,0)
 . set fmstrdt=2000101
"RTN","SAMIUR",418,0)
 . if type="followup" set fmstrdt=$$NOW^XLFDT
"RTN","SAMIUR",419,0)
 . if type="activity" set fmstrdt=$$FMADD^XLFDT($$NOW^XLFDT,-31)
"RTN","SAMIUR",420,0)
 . quit
"RTN","SAMIUR",421,0)
 if strdt="" set filter("start-date")=$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",422,0)
 ;
"RTN","SAMIUR",423,0)
 set enddt=$get(filter("end-date"))
"RTN","SAMIUR",424,0)
 ;set fmenddt=$$KEY2FM^SAMICASE(enddt)
"RTN","SAMIUR",425,0)
 set fmenddt=$$FMDT^SAMIUR2(enddt)
"RTN","SAMIUR",426,0)
 if fmenddt=-1 do  ;
"RTN","SAMIUR",427,0)
 . set fmenddt=$$NOW^XLFDT
"RTN","SAMIUR",428,0)
 . if type="followup" set fmenddt=$$FMADD^XLFDT($$NOW^XLFDT,31)
"RTN","SAMIUR",429,0)
 . quit
"RTN","SAMIUR",430,0)
 if enddt="" set filter("end-date")=$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",431,0)
 ;
"RTN","SAMIUR",432,0)
 set datephrase=""
"RTN","SAMIUR",433,0)
 new zi set zi=0
"RTN","SAMIUR",434,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",435,0)
 ;
"RTN","SAMIUR",436,0)
 for  do  quit:'zi  ;
"RTN","SAMIUR",437,0)
 . set zi=$order(@root@(zi))
"RTN","SAMIUR",438,0)
 . quit:'zi
"RTN","SAMIUR",439,0)
 . ;
"RTN","SAMIUR",440,0)
 . new sid set sid=$get(@root@(zi,"samistudyid"))
"RTN","SAMIUR",441,0)
 . quit:sid=""
"RTN","SAMIUR",442,0)
 . quit:$extract(sid,1,3)'=site
"RTN","SAMIUR",443,0)
 . ;
"RTN","SAMIUR",444,0)
 . new items set items=""
"RTN","SAMIUR",445,0)
 . do GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR",446,0)
 . quit:'$data(items)
"RTN","SAMIUR",447,0)
 . ;
"RTN","SAMIUR",448,0)
 . new efmdate,edate,siform,ceform,cefud,fmcefud,cedos,fmcedos
"RTN","SAMIUR",449,0)
 . set siform=$order(items("siform-"))
"RTN","SAMIUR",450,0)
 . new status set status=$get(@root@("graph",sid,siform,"sistatus"))
"RTN","SAMIUR",451,0)
 . if type="inactive",status="active" quit  ; for inactive report
"RTN","SAMIUR",452,0)
 . ;if type'="inactive",status'="active" quit  ; for other reports
"RTN","SAMIUR",453,0)
 . if type'="inactive",type'="activity",type'="enrollment",status'="active" quit  ;other rpts
"RTN","SAMIUR",454,0)
 . new eligible set eligible=$get(@root@("graph",sid,siform,"sicechrt"))
"RTN","SAMIUR",455,0)
 . if type="enrollment",eligible'="y" quit  ; must be eligible
"RTN","SAMIUR",456,0)
 . new enrolled set enrolled=$g(@root@("graph",sid,siform,"sildct"))
"RTN","SAMIUR",457,0)
 . if type="enrollment",enrolled'="y" quit  ; must be enrolled
"RTN","SAMIUR",458,0)
 . ;
"RTN","SAMIUR",459,0)
 . set (ceform,cefud,fmcefud,cedos,fmcedos)=""
"RTN","SAMIUR",460,0)
 . new lastce,sifm,cefm,baseline
"RTN","SAMIUR",461,0)
 . set (lastce,sifm,cefm,baseline)=""
"RTN","SAMIUR",462,0)
 . set sifm=$$FMDT^SAMIUR2($p(siform,"siform-",2))
"RTN","SAMIUR",463,0)
 . ;f  set ceform=$order(items(ceform),-1) q:ceform=""  q:cefud'=""  d  ;
"RTN","SAMIUR",464,0)
 . ;f  set ceform=$order(items(ceform),-1) q:ceform=""  d  ;
"RTN","SAMIUR",465,0)
 . ;. q:ceform'["form"
"RTN","SAMIUR",466,0)
 . ;. if ceform["ceform" if lastce="" set lastce=ceform
"RTN","SAMIUR",467,0)
 . ;. set cefud=$get(@root@("graph",sid,ceform,"cefud"))
"RTN","SAMIUR",468,0)
 . ;. if cefud'="" set fmcefud=$$FMDT^SAMIUR2(cefud)
"RTN","SAMIUR",469,0)
 . ;. set cedos=$get(@root@("graph",sid,ceform,"cedos"))
"RTN","SAMIUR",470,0)
 . ;. if cedos'="" set fmcedos=$$FMDT^SAMIUR2(cedos)
"RTN","SAMIUR",471,0)
 . ;. quit
"RTN","SAMIUR",472,0)
 . ;if $$FMDT^SAMIUR2($p(lastce,"ceform-",2))<sifm set lastce=""
"RTN","SAMIUR",473,0)
 . ;
"RTN","SAMIUR",474,0)
 . set baseline=$$BASELNDT^SAMICAS3(sid)
"RTN","SAMIUR",475,0)
 . set edate=$get(@root@("graph",sid,siform,"sidc"))
"RTN","SAMIUR",476,0)
 . if edate="" set edate=$get(@root@("graph",sid,siform,"samicreatedate"))
"RTN","SAMIUR",477,0)
 . set efmdate=$$FMDT^SAMIUR2(edate)
"RTN","SAMIUR",478,0)
 . set edate=$$VAPALSDT^SAMICASE(efmdate)
"RTN","SAMIUR",479,0)
 . ;
"RTN","SAMIUR",480,0)
 . new latef,latefdt set (latef,latefdt)="" ; latest form for activity report
"RTN","SAMIUR",481,0)
 . new aform,aformdt set (aform,aformdt)=""
"RTN","SAMIUR",482,0)
 . new anyform set anyform=""
"RTN","SAMIUR",483,0)
 . new proot set proot=$na(@root@("graph",sid))
"RTN","SAMIUR",484,0)
 . ;for  set anyform=$order(items("sort",anyform),-1) q:aform'=""  q:anyform=""  d  ;
"RTN","SAMIUR",485,0)
 . for  set anyform=$order(items("sort",anyform),-1) q:anyform=""  d  ;
"RTN","SAMIUR",486,0)
 . . new tempf set tempf=""
"RTN","SAMIUR",487,0)
 . . ;f  set tempf=$order(items("sort",anyform,tempf)) q:tempf=""  q:aform'=""  d  ;
"RTN","SAMIUR",488,0)
 . . f  set tempf=$order(items("sort",anyform,tempf)) q:tempf=""  d  ;
"RTN","SAMIUR",489,0)
 . . . if latef="" d  ; record the latest form for activity report
"RTN","SAMIUR",490,0)
 . . . . set latefdt=anyform ; date of latest form
"RTN","SAMIUR",491,0)
 . . . . new latekey set latekey=$order(items("sort",anyform,tempf,""))
"RTN","SAMIUR",492,0)
 . . . . set latef=$order(items("sort",anyform,tempf,latekey,""))
"RTN","SAMIUR",493,0)
 . . . if lastce="" d  ; if looking for latest ct eval
"RTN","SAMIUR",494,0)
 . . . . if tempf'["ceform" q  ; this is not a ceform
"RTN","SAMIUR",495,0)
 . . . . set lastce=$order(items("sort",anyform,tempf,""))
"RTN","SAMIUR",496,0)
 . . . . if anyform<sifm set lastce="" ; doesn't count - before enrollment
"RTN","SAMIUR",497,0)
 . . . ;if tempf["bxform" q  ; don't want any biopsy forms
"RTN","SAMIUR",498,0)
 . . . new tempk set tempk=$order(items("sort",anyform,tempf,""))
"RTN","SAMIUR",499,0)
 . . . ;if $g(@proot@(tempk,"cefud"))="" q  ; no followup date
"RTN","SAMIUR",500,0)
 . . . new tempt set tempt=$order(items("sort",anyform,tempf,tempk,""))
"RTN","SAMIUR",501,0)
 . . . if cefud="" d  ;
"RTN","SAMIUR",502,0)
 . . . . if $g(@proot@(tempk,"cefud"))="" q  ; no followup date
"RTN","SAMIUR",503,0)
 . . . . set cefud=$g(@proot@(tempk,"cefud"))
"RTN","SAMIUR",504,0)
 . . . . set fmcefud=$$FMDT^SAMIUR2(cefud)
"RTN","SAMIUR",505,0)
 . . . . set ceform=tempk
"RTN","SAMIUR",506,0)
 . . . if aform="" d  ;
"RTN","SAMIUR",507,0)
 . . . . set aform=tempt
"RTN","SAMIUR",508,0)
 . . . . set aformdt=anyform
"RTN","SAMIUR",509,0)
 . ;
"RTN","SAMIUR",510,0)
 . if type="followup" do  ;
"RTN","SAMIUR",511,0)
 . . ; new nplus30 set nplus30=$$FMADD^XLFDT($$NOW^XLFDT,31)
"RTN","SAMIUR",512,0)
 . . if +fmcefud<fmstrdt quit  ; before start date
"RTN","SAMIUR",513,0)
 . . if +fmcefud<(fmenddt+1) do  ; before end date
"RTN","SAMIUR",514,0)
 . . . quit:cefud=""  ; no followup date
"RTN","SAMIUR",515,0)
 . . . set SAMIPATS(fmcefud,zi,"aform")=aform
"RTN","SAMIUR",516,0)
 . . . ;set SAMIPATS(fmcefud,zi,"aform")=latef
"RTN","SAMIUR",517,0)
 . . . set SAMIPATS(fmcefud,zi,"aformdt")=aformdt
"RTN","SAMIUR",518,0)
 . . . ;set SAMIPATS(fmcefud,zi,"aformdt")=latefdt
"RTN","SAMIUR",519,0)
 . . . set SAMIPATS(fmcefud,zi,"edate")=edate
"RTN","SAMIUR",520,0)
 . . . set SAMIPATS(fmcefud,zi,"baseline")=baseline
"RTN","SAMIUR",521,0)
 . . . set SAMIPATS(fmcefud,zi)=""
"RTN","SAMIUR",522,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",523,0)
 . . . set SAMIPATS(fmcefud,zi,"cefud")=cefud
"RTN","SAMIUR",524,0)
 . . . set SAMIPATS(fmcefud,zi,"cedos")=cedos
"RTN","SAMIUR",525,0)
 . . . set SAMIPATS(fmcefud,zi,"ceform")=ceform
"RTN","SAMIUR",526,0)
 . . . set SAMIPATS(fmcefud,zi,"ceform-vals")=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR",527,0)
 . . . set SAMIPATS(fmcefud,zi,"siform")=siform
"RTN","SAMIUR",528,0)
 . . . set SAMIPATS(fmcefud,zi,"siform-vals")=$name(@root@("graph",sid,siform))
"RTN","SAMIUR",529,0)
 . . . merge SAMIPATS(fmcefud,zi,"items")=items
"RTN","SAMIUR",530,0)
 . . . quit
"RTN","SAMIUR",531,0)
 . . set datephrase=" before "_$$VAPALSDT^SAMICASE(fmenddt)
"RTN","SAMIUR",532,0)
 . . quit
"RTN","SAMIUR",533,0)
 . ;
"RTN","SAMIUR",534,0)
 . if type="activity" do  ;
"RTN","SAMIUR",535,0)
 . . new fmanyform set fmanyform=$$FMDT^SAMIUR2(latefdt)
"RTN","SAMIUR",536,0)
 . . if fmanyform<fmstrdt quit  ; before the start date
"RTN","SAMIUR",537,0)
 . . ; if fmanyform<(fmenddt+1)!(efmdate>fmenddt) do  ; need any new form
"RTN","SAMIUR",538,0)
 . . if fmanyform<(fmenddt+1)  do  ;
"RTN","SAMIUR",539,0)
 . . . set SAMIPATS(efmdate,zi,"aform")=latef
"RTN","SAMIUR",540,0)
 . . . set SAMIPATS(efmdate,zi,"aformdt")=$$VAPALSDT^SAMICASE(fmanyform)
"RTN","SAMIUR",541,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",542,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",543,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",544,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",545,0)
 . . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",546,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",547,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",548,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",549,0)
 . . . quit
"RTN","SAMIUR",550,0)
 . . set datephrase=" after "_$$VAPALSDT^SAMICASE(fmstrdt)
"RTN","SAMIUR",551,0)
 . . quit
"RTN","SAMIUR",552,0)
 . ;
"RTN","SAMIUR",553,0)
 . ; date filter for all the rest of the reports
"RTN","SAMIUR",554,0)
 . ;
"RTN","SAMIUR",555,0)
 . quit:efmdate<fmstrdt  ; before the start date
"RTN","SAMIUR",556,0)
 . quit:efmdate>(fmenddt+1)  ; after the end date
"RTN","SAMIUR",557,0)
 . ;
"RTN","SAMIUR",558,0)
 . if type="incomplete" do  ;
"RTN","SAMIUR",559,0)
 . . new complete set complete=1
"RTN","SAMIUR",560,0)
 . . new zj set zj=""
"RTN","SAMIUR",561,0)
 . . new gr set gr=$name(@root@("graph",sid))
"RTN","SAMIUR",562,0)
 . . for  do  quit:zj=""  ;
"RTN","SAMIUR",563,0)
 . . . set zj=$order(@gr@(zj))
"RTN","SAMIUR",564,0)
 . . . quit:zj=""
"RTN","SAMIUR",565,0)
 . . . ;
"RTN","SAMIUR",566,0)
 . . . new stat
"RTN","SAMIUR",567,0)
 . . . set stat=$get(@gr@(zj,"samistatus"))
"RTN","SAMIUR",568,0)
 . . . if stat="" set stat="incomplete"
"RTN","SAMIUR",569,0)
 . . . if stat="incomplete" do  ;
"RTN","SAMIUR",570,0)
 . . . . set complete=0
"RTN","SAMIUR",571,0)
 . . . . set SAMIPATS(efmdate,zi,"iform")=$get(SAMIPATS(efmdate,zi,"iform"))_" "_zj
"RTN","SAMIUR",572,0)
 . . . . quit
"RTN","SAMIUR",573,0)
 . . . quit
"RTN","SAMIUR",574,0)
 . . ;
"RTN","SAMIUR",575,0)
 . . if complete=0 do  ; has incomplete form(s) 
"RTN","SAMIUR",576,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",577,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",578,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",579,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",580,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",581,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",582,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",583,0)
 . . . quit
"RTN","SAMIUR",584,0)
 . . set datephrase=""
"RTN","SAMIUR",585,0)
 . . quit
"RTN","SAMIUR",586,0)
 . ;
"RTN","SAMIUR",587,0)
 . if type="missingct" do  ;
"RTN","SAMIUR",588,0)
 . . if lastce="" do  ; has no ct since enrollment 
"RTN","SAMIUR",589,0)
 . . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",590,0)
 . . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",591,0)
 . . . ;if ceform="" set cefud="baseline"
"RTN","SAMIUR",592,0)
 . . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",593,0)
 . . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",594,0)
 . . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",595,0)
 . . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",596,0)
 . . . quit
"RTN","SAMIUR",597,0)
 . . set datephrase=""
"RTN","SAMIUR",598,0)
 . . quit
"RTN","SAMIUR",599,0)
 . ;
"RTN","SAMIUR",600,0)
 . if type="outreach" do  ; no-op; hook for future development?
"RTN","SAMIUR",601,0)
 . . quit
"RTN","SAMIUR",602,0)
 . ;
"RTN","SAMIUR",603,0)
 . if type="enrollment" do  ;
"RTN","SAMIUR",604,0)
 . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",605,0)
 . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",606,0)
 . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",607,0)
 . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",608,0)
 . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",609,0)
 . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",610,0)
 . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",611,0)
 . . quit
"RTN","SAMIUR",612,0)
 . ;
"RTN","SAMIUR",613,0)
 . if type="inactive" do  ;
"RTN","SAMIUR",614,0)
 . . set SAMIPATS(efmdate,zi,"edate")=edate
"RTN","SAMIUR",615,0)
 . . set SAMIPATS(efmdate,zi)=""
"RTN","SAMIUR",616,0)
 . . set SAMIPATS(efmdate,zi,"cefud")=cefud
"RTN","SAMIUR",617,0)
 . . set SAMIPATS(efmdate,zi,"ceform")=ceform
"RTN","SAMIUR",618,0)
 . . set SAMIPATS(efmdate,zi,"cedos")=cedos
"RTN","SAMIUR",619,0)
 . . set SAMIPATS(efmdate,zi,"siform")=siform
"RTN","SAMIUR",620,0)
 . . merge SAMIPATS(efmdate,zi,"items")=items
"RTN","SAMIUR",621,0)
 . . quit
"RTN","SAMIUR",622,0)
 . ;
"RTN","SAMIUR",623,0)
 . set datephrase=" as of "_$$VAPALSDT^SAMICASE($$NOW^XLFDT)
"RTN","SAMIUR",624,0)
 . quit
"RTN","SAMIUR",625,0)
 ;
"RTN","SAMIUR",626,0)
 quit  ; end of SELECT
"RTN","SAMIUR",627,0)
 ;
"RTN","SAMIUR",628,0)
 ;
"RTN","SAMIUR",629,0)
 ;
"RTN","SAMIUR",630,0)
UNMAT(SAMIPATS,ztype,datephrase,filter) ; build unmatched persons list
"RTN","SAMIUR",631,0)
 ;
"RTN","SAMIUR",632,0)
 ;@called-by
"RTN","SAMIUR",633,0)
 ; SELECT
"RTN","SAMIUR",634,0)
 ;@calls
"RTN","SAMIUR",635,0)
 ; $$setroot^%wd
"RTN","SAMIUR",636,0)
 ;
"RTN","SAMIUR",637,0)
 set datephrase="Unmatched Persons"
"RTN","SAMIUR",638,0)
 new ERR k ^gpl("ERR")
"RTN","SAMIUR",639,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",640,0)
 new dfn set dfn=9000000
"RTN","SAMIUR",641,0)
 for  do  quit:'dfn  ;
"RTN","SAMIUR",642,0)
 . set dfn=$order(@lroot@("dfn",dfn))
"RTN","SAMIUR",643,0)
 . quit:'dfn
"RTN","SAMIUR",644,0)
 . ;
"RTN","SAMIUR",645,0)
 . new ien set ien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",646,0)
 . quit:ien=""
"RTN","SAMIUR",647,0)
 . i $g(@lroot@(ien,"dfn"))'=dfn d  q  ;
"RTN","SAMIUR",648,0)
 . . s ERR(dfn)="dfn index error"
"RTN","SAMIUR",649,0)
 . . m ^gpl("ERR",dfn)=@lroot@(ien)
"RTN","SAMIUR",650,0)
 . n ordern
"RTN","SAMIUR",651,0)
 . s ordern=$g(@lroot@(ien,"ORMORCordernumber"))
"RTN","SAMIUR",652,0)
 . i ordern="" s ordern=$g(@lroot@(ien,"ORM",1,"ordernumber"))
"RTN","SAMIUR",653,0)
 . i ordern'="" q  ;
"RTN","SAMIUR",654,0)
 . i $g(@lroot@(ien,"siteid"))'[site q  ;
"RTN","SAMIUR",655,0)
 . ;quit:$get(@lroot@(ien,"remotedfn"))'=""  ;
"RTN","SAMIUR",656,0)
 . ;
"RTN","SAMIUR",657,0)
 . merge SAMIPATS(ien,dfn)=@lroot@(ien)
"RTN","SAMIUR",658,0)
 . ;
"RTN","SAMIUR",659,0)
 . new name set name=$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR",660,0)
 . ; new name set name=$get(SAMIPATS(ien,dfn,"sinamef"))
"RTN","SAMIUR",661,0)
 . ; set name=name_","_SAMIPATS(ien,dfn,"sinamel")
"RTN","SAMIUR",662,0)
 . new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR",663,0)
 . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""editperson"">"
"RTN","SAMIUR",664,0)
 . set nuhref=nuhref_"<input type=hidden name=""dfn"" value="_dfn_">"
"RTN","SAMIUR",665,0)
 . set nuhref=nuhref_"<input type=hidden name=""siteid"" value="_site_">"
"RTN","SAMIUR",666,0)
 . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",667,0)
 . set SAMIPATS(ien,dfn,"editref")=nuhref
"RTN","SAMIUR",668,0)
 . quit
"RTN","SAMIUR",669,0)
 ;
"RTN","SAMIUR",670,0)
 i $d(ERR) d ^ZTER
"RTN","SAMIUR",671,0)
 ;
"RTN","SAMIUR",672,0)
 quit  ; end of UNMAT
"RTN","SAMIUR",673,0)
 ;
"RTN","SAMIUR",674,0)
 ;
"RTN","SAMIUR",675,0)
 ;
"RTN","SAMIUR",676,0)
WKLIST(SAMIPATS,ztype,datephrase,filter) ; build work list
"RTN","SAMIUR",677,0)
 ;
"RTN","SAMIUR",678,0)
 ;@called-by
"RTN","SAMIUR",679,0)
 ; SELECT
"RTN","SAMIUR",680,0)
 ;@calls
"RTN","SAMIUR",681,0)
 ; $$setroot^%wd
"RTN","SAMIUR",682,0)
 ;
"RTN","SAMIUR",683,0)
 ; add site
"RTN","SAMIUR",684,0)
 ; add compare to vapals-patients
"RTN","SAMIUR",685,0)
 ; add navigation to enrollment
"RTN","SAMIUR",686,0)
 ;
"RTN","SAMIUR",687,0)
 kill ^gpl("worklist")
"RTN","SAMIUR",688,0)
 merge ^gpl("worklist")=filter
"RTN","SAMIUR",689,0)
 new site
"RTN","SAMIUR",690,0)
 set site=$get(filter("siteid"))
"RTN","SAMIUR",691,0)
 quit:site=""
"RTN","SAMIUR",692,0)
 set datephrase="Work List"
"RTN","SAMIUR",693,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR",694,0)
 new proot set proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR",695,0)
 ;
"RTN","SAMIUR",696,0)
 new dfn set dfn=0
"RTN","SAMIUR",697,0)
 for  set dfn=$order(@lroot@("dfn",dfn)) quit:+dfn=0  do  ;
"RTN","SAMIUR",698,0)
 . quit:$order(@proot@("dfn",dfn,""))'=""
"RTN","SAMIUR",699,0)
 . new ien set ien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR",700,0)
 . quit:ien=""
"RTN","SAMIUR",701,0)
 . i $g(@lroot@(ien,"dfn"))'=dfn d  q  ;
"RTN","SAMIUR",702,0)
 . . s ERR="dfn index error in patient-lookup dfn="_dfn
"RTN","SAMIUR",703,0)
 . . ;D ^ZTER
"RTN","SAMIUR",704,0)
 . ;
"RTN","SAMIUR",705,0)
 . ; write !,"dfn= ",dfn
"RTN","SAMIUR",706,0)
 . ; zwrite @lroot@(ien,*)
"RTN","SAMIUR",707,0)
 . ;
"RTN","SAMIUR",708,0)
 . quit:$get(@lroot@(ien,"siteid"))'=site
"RTN","SAMIUR",709,0)
 . ;
"RTN","SAMIUR",710,0)
 . merge ^gpl("worklist","lroot",ien)=@lroot@(ien)
"RTN","SAMIUR",711,0)
 . merge SAMIPATS(ien,dfn)=@lroot@(ien)
"RTN","SAMIUR",712,0)
 . ;zwr SAMIPATS
"RTN","SAMIUR",713,0)
 . ;i dfn=9000166 B
"RTN","SAMIUR",714,0)
 . ;i dfn=9000136 B
"RTN","SAMIUR",715,0)
 . new name set name=$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR",716,0)
 . ; new name set name=$get(SAMIPATS(ien,dfn,"sinamef"))
"RTN","SAMIUR",717,0)
 . ; set name=name_","_SAMIPATS(ien,dfn,"sinamel")
"RTN","SAMIUR",718,0)
 . new nuhref
"RTN","SAMIUR",719,0)
 . set nuhref="<td data-search="""_name_""" data-order="""_name_""">"
"RTN","SAMIUR",720,0)
 . set nuhref=nuhref_"<form method=POST action=""/vapals"">"
"RTN","SAMIUR",721,0)
 . set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""newcase"">"
"RTN","SAMIUR",722,0)
 . set nuhref=nuhref_"<input type=hidden name=""dfn"" value="_dfn_">"
"RTN","SAMIUR",723,0)
 . set nuhref=nuhref_"<input type=hidden name=""siteid"" value="_site_">"
"RTN","SAMIUR",724,0)
 . set nuhref=nuhref_"<input value="""_name_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR",725,0)
 . set nuhref=nuhref_"</td>"
"RTN","SAMIUR",726,0)
 . set SAMIPATS(ien,dfn,"workref")=nuhref
"RTN","SAMIUR",727,0)
 . quit
"RTN","SAMIUR",728,0)
 ;
"RTN","SAMIUR",729,0)
 merge ^gpl("worklist","pats")=SAMIPATS
"RTN","SAMIUR",730,0)
 ;
"RTN","SAMIUR",731,0)
 quit  ; end of WKLIST
"RTN","SAMIUR",732,0)
 ;
"RTN","SAMIUR",733,0)
 ;
"RTN","SAMIUR",734,0)
 ;
"RTN","SAMIUR",735,0)
EOR ; end of SAMIUR
"RTN","SAMIUR2")
0^18^B1367473447
"RTN","SAMIUR2",1,0)
SAMIUR2 ;ven/gpl - user reports cont ;2021-10-29t20:32z
"RTN","SAMIUR2",2,0)
 ;;18.0;SAMI;**5,11,12,14,15**;2020-01;Build 2
"RTN","SAMIUR2",3,0)
 ;;18-15
"RTN","SAMIUR2",4,0)
 ;
"RTN","SAMIUR2",5,0)
 ; SAMIUR2 contains subroutines for creating & implementing the
"RTN","SAMIUR2",6,0)
 ; report-definition table.
"RTN","SAMIUR2",7,0)
 ;
"RTN","SAMIUR2",8,0)
 quit  ; no entry from top
"RTN","SAMIUR2",9,0)
 ;
"RTN","SAMIUR2",10,0)
 ;
"RTN","SAMIUR2",11,0)
 ;
"RTN","SAMIUR2",12,0)
 ;@section 0 primary development
"RTN","SAMIUR2",13,0)
 ;
"RTN","SAMIUR2",14,0)
 ;
"RTN","SAMIUR2",15,0)
 ;
"RTN","SAMIUR2",16,0)
 ;@routine-credits
"RTN","SAMIUR2",17,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIUR2",18,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIUR2",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIUR2",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIUR2",21,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIUR2",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIUR2",23,0)
 ;
"RTN","SAMIUR2",24,0)
 ;@last-update 2021-10-29t20:32z
"RTN","SAMIUR2",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIUR2",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIUR2",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIUR2",28,0)
 ;@version 18-15
"RTN","SAMIUR2",29,0)
 ;@release-date 2020-01
"RTN","SAMIUR2",30,0)
 ;@patch-list **5,11,12,14,15**
"RTN","SAMIUR2",31,0)
 ;
"RTN","SAMIUR2",32,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIUR2",33,0)
 ; toad@vistaexpertise.net
"RTN","SAMIUR2",34,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIUR2",35,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIUR2",36,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIUR2",37,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIUR2",38,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIUR2",39,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIUR2",40,0)
 ;
"RTN","SAMIUR2",41,0)
 ;@module-credits see SAMIHUL
"RTN","SAMIUR2",42,0)
 ;
"RTN","SAMIUR2",43,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIUR2",44,0)
 ; see SAMIURUL
"RTN","SAMIUR2",45,0)
 ;
"RTN","SAMIUR2",46,0)
 ;@contents
"RTN","SAMIUR2",47,0)
 ; RPTTBL build report-definition table
"RTN","SAMIUR2",48,0)
 ;
"RTN","SAMIUR2",49,0)
 ; $$DFN2SID study id for patient DFN
"RTN","SAMIUR2",50,0)
 ; $$MKNAV html for navigation to form
"RTN","SAMIUR2",51,0)
 ;
"RTN","SAMIUR2",52,0)
 ; $$SHDET table contents for smoking history
"RTN","SAMIUR2",53,0)
 ; CUMPY forms array of cummulative pack year data
"RTN","SAMIUR2",54,0)
 ; $$TDDT embed date in table cell
"RTN","SAMIUR2",55,0)
 ; $$FMDT convert date to fileman format
"RTN","SAMIUR2",56,0)
 ; $$PKYDT pack-years from start & end & cigs/day
"RTN","SAMIUR2",57,0)
 ; $$PKY pack-years from years & packs/day
"RTN","SAMIUR2",58,0)
 ;
"RTN","SAMIUR2",59,0)
 ; $$AGE age
"RTN","SAMIUR2",60,0)
 ; $$BLINEDT baseline date
"RTN","SAMIUR2",61,0)
 ; $$CONTACT patient street address
"RTN","SAMIUR2",62,0)
 ; $$CTPROT ct protocol
"RTN","SAMIUR2",63,0)
 ; $$DOB date of birth
"RTN","SAMIUR2",64,0)
 ; $$FUDATE followup date
"RTN","SAMIUR2",65,0)
 ; $$GENDER gender
"RTN","SAMIUR2",66,0)
 ; $$IFORM name(s) of incomplete forms
"RTN","SAMIUR2",67,0)
 ; $$LASTEXM patient last exam
"RTN","SAMIUR2",68,0)
 ; $$MANPAT unmatched patient cell
"RTN","SAMIUR2",69,0)
 ; $$MATCH match button cell
"RTN","SAMIUR2",70,0)
 ; $$NAME name w/hyperlink
"RTN","SAMIUR2",71,0)
 ; $$PACKYRS smoking status
"RTN","SAMIUR2",72,0)
 ; $$POSSIBLE possible match cell
"RTN","SAMIUR2",73,0)
 ; $$RECOM recommendation
"RTN","SAMIUR2",74,0)
 ; $$RURAL patient's rural/urban status
"RTN","SAMIUR2",75,0)
 ; $$SID study id
"RTN","SAMIUR2",76,0)
 ; $$SMHIS smoking history cell
"RTN","SAMIUR2",77,0)
 ; $$SMKSTAT smoking status
"RTN","SAMIUR2",78,0)
 ; $$SSN social security number
"RTN","SAMIUR2",79,0)
 ; $$STUDYDT latest study date
"RTN","SAMIUR2",80,0)
 ; $$STUDYTYP latest study type
"RTN","SAMIUR2",81,0)
 ; $$VALS form-values cell
"RTN","SAMIUR2",82,0)
 ; $$WHEN followup text
"RTN","SAMIUR2",83,0)
 ; $$WORKPAT worklist patient name cell
"RTN","SAMIUR2",84,0)
 ;
"RTN","SAMIUR2",85,0)
 ; EPAT patient name w/nav to enrollment
"RTN","SAMIUR2",86,0)
 ; ETHNCTY ethnicity
"RTN","SAMIUR2",87,0)
 ; RACE race
"RTN","SAMIUR2",88,0)
 ; STATUS patient status
"RTN","SAMIUR2",89,0)
 ; WSVALS display form values from graph
"RTN","SAMIUR2",90,0)
 ;
"RTN","SAMIUR2",91,0)
 ;
"RTN","SAMIUR2",92,0)
 ;
"RTN","SAMIUR2",93,0)
 ;@section 1 ppi RPTTBL^SAMIUR2
"RTN","SAMIUR2",94,0)
 ;
"RTN","SAMIUR2",95,0)
 ;
"RTN","SAMIUR2",96,0)
 ;
"RTN","SAMIUR2",97,0)
RPTTBL(RPT,TYPE,SITE) ; RPT is passed by reference and returns the 
"RTN","SAMIUR2",98,0)
 ; report definition table. TYPE is the report type to be returned
"RTN","SAMIUR2",99,0)
 ; This routine could use a file or a graph in the next version
"RTN","SAMIUR2",100,0)
 ;
"RTN","SAMIUR2",101,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIUR2",102,0)
 ;@called-by
"RTN","SAMIUR2",103,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",104,0)
 ; WSREPORT^SAMIUR1 (which then calls WSREPORT^SAMIUR)
"RTN","SAMIUR2",105,0)
 ;@calls none (defines calls for WSREPORT^SAMIUR to call)
"RTN","SAMIUR2",106,0)
 ;@input
"RTN","SAMIUR2",107,0)
 ; TYPE = report type to return
"RTN","SAMIUR2",108,0)
 ;@output
"RTN","SAMIUR2",109,0)
 ; .RPT report-definition table
"RTN","SAMIUR2",110,0)
 ;
"RTN","SAMIUR2",111,0)
 ; This routine could use a file or a graph in the next version
"RTN","SAMIUR2",112,0)
 ;
"RTN","SAMIUR2",113,0)
 if TYPE="followup" do  quit  ;
"RTN","SAMIUR2",114,0)
 . set RPT(1,"header")="F/U Date"
"RTN","SAMIUR2",115,0)
 . set RPT(1,"routine")="$$FUDATE^SAMIUR2"
"RTN","SAMIUR2",116,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",117,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",118,0)
 . ;set RPT(3,"header")="SSN"
"RTN","SAMIUR2",119,0)
 . set RPT(3,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",120,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",121,0)
 . set RPT(4,"header")="Baseline Date"
"RTN","SAMIUR2",122,0)
 . set RPT(4,"routine")="$$BLINEDT^SAMIUR2"
"RTN","SAMIUR2",123,0)
 . set RPT(5,"header")="Last Form"
"RTN","SAMIUR2",124,0)
 . set RPT(5,"routine")="$$AFORM^SAMIUR2"
"RTN","SAMIUR2",125,0)
 . set RPT(6,"header")="Form Date"
"RTN","SAMIUR2",126,0)
 . set RPT(6,"routine")="$$AFORMDT^SAMIUR2"
"RTN","SAMIUR2",127,0)
 . set RPT(7,"header")="Recommend"
"RTN","SAMIUR2",128,0)
 . set RPT(7,"routine")="$$RECOM^SAMIUR2"
"RTN","SAMIUR2",129,0)
 . set RPT(8,"header")="Contact Information"
"RTN","SAMIUR2",130,0)
 . set RPT(8,"routine")="$$CONTACT^SAMIUR2"
"RTN","SAMIUR2",131,0)
 . quit
"RTN","SAMIUR2",132,0)
 ;
"RTN","SAMIUR2",133,0)
 if TYPE="activity" do  quit  ;
"RTN","SAMIUR2",134,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",135,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",136,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",137,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",138,0)
 . set RPT(2.2,"header")="Active/Inactive"
"RTN","SAMIUR2",139,0)
 . set RPT(2.2,"routine")="$$ACTIVE^SAMIUR2"
"RTN","SAMIUR2",140,0)
 . set RPT(2.5,"header")="Form"
"RTN","SAMIUR2",141,0)
 . set RPT(2.5,"routine")="$$AFORM^SAMIUR2"
"RTN","SAMIUR2",142,0)
 . set RPT(3,"header")="Form Date"
"RTN","SAMIUR2",143,0)
 . ;set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",144,0)
 . set RPT(3,"routine")="$$AFORMDT^SAMIUR2"
"RTN","SAMIUR2",145,0)
 . ;set RPT(4,"header")="Type"
"RTN","SAMIUR2",146,0)
 . ;set RPT(4,"routine")="$$STUDYTYP^SAMIUR2"
"RTN","SAMIUR2",147,0)
 . ;set RPT(5,"header")="CT Protocol"
"RTN","SAMIUR2",148,0)
 . ;set RPT(5,"routine")="$$CTPROT^SAMIUR2"
"RTN","SAMIUR2",149,0)
 . set RPT(6,"header")="Follow-up"
"RTN","SAMIUR2",150,0)
 . set RPT(6,"routine")="$$RECOM^SAMIUR2"
"RTN","SAMIUR2",151,0)
 . ;set RPT(7,"header")="When"
"RTN","SAMIUR2",152,0)
 . ;set RPT(7,"routine")="$$WHEN^SAMIUR2"
"RTN","SAMIUR2",153,0)
 . set RPT(8,"header")="on Date"
"RTN","SAMIUR2",154,0)
 . set RPT(8,"routine")="$$FUDATE^SAMIUR2"
"RTN","SAMIUR2",155,0)
 . quit
"RTN","SAMIUR2",156,0)
 ;
"RTN","SAMIUR2",157,0)
 if TYPE="enrollment" do  quit  ;
"RTN","SAMIUR2",158,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",159,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",160,0)
 . set RPT(1.5,"header")="Active/Inactive"
"RTN","SAMIUR2",161,0)
 . set RPT(1.5,"routine")="$$ACTIVE^SAMIUR2"
"RTN","SAMIUR2",162,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",163,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",164,0)
 . set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",165,0)
 . set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",166,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",167,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",168,0)
 . ; set RPT(5,"header")="Race"
"RTN","SAMIUR2",169,0)
 . ; set RPT(5,"routine")="$$RACE^SAMIUR2"
"RTN","SAMIUR2",170,0)
 . set RPT(6,"header")="Age"
"RTN","SAMIUR2",171,0)
 . set RPT(6,"routine")="$$AGE^SAMIUR2"
"RTN","SAMIUR2",172,0)
 . d  ;
"RTN","SAMIUR2",173,0)
 . . n filter s filter("siteid")=SITE
"RTN","SAMIUR2",174,0)
 . . i $$ISVA^SAMIPARM(.filter) d  ;
"RTN","SAMIUR2",175,0)
 . . . set RPT(7,"header")="Urban/Rural"
"RTN","SAMIUR2",176,0)
 . . . set RPT(7,"routine")="$$RURAL^SAMIUR2"
"RTN","SAMIUR2",177,0)
 . set RPT(8,"header")="Smoking Status"
"RTN","SAMIUR2",178,0)
 . set RPT(8,"routine")="$$SMKSTAT^SAMIUR2"
"RTN","SAMIUR2",179,0)
 . set RPT(9,"header")="Pack Years at Intake"
"RTN","SAMIUR2",180,0)
 . set RPT(9,"routine")="$$PACKYRS^SAMIUR2"
"RTN","SAMIUR2",181,0)
 . quit
"RTN","SAMIUR2",182,0)
 ;
"RTN","SAMIUR2",183,0)
 if TYPE="inactive" do  quit  ;
"RTN","SAMIUR2",184,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",185,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",186,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",187,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",188,0)
 . set RPT(3,"header")="Enrollment date"
"RTN","SAMIUR2",189,0)
 . set RPT(3,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",190,0)
 . ;set RPT(3,"header")="CT Date"
"RTN","SAMIUR2",191,0)
 . ;set RPT(3,"routine")="$$STUDYDT^SAMIUR2"
"RTN","SAMIUR2",192,0)
 . ;set RPT(4,"header")="Gender"
"RTN","SAMIUR2",193,0)
 . ;set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",194,0)
 . ; set RPT(5,"header")="Race"
"RTN","SAMIUR2",195,0)
 . ; set RPT(5,"routine")="$$RACE^SAMIUR2"
"RTN","SAMIUR2",196,0)
 . ;set RPT(6,"header")="Age"
"RTN","SAMIUR2",197,0)
 . ;set RPT(6,"routine")="$$AGE^SAMIUR2"
"RTN","SAMIUR2",198,0)
 . set RPT(4,"header")="Date of Death"
"RTN","SAMIUR2",199,0)
 . set RPT(4,"routine")="$$INACTDT^SAMIUR2"
"RTN","SAMIUR2",200,0)
 . set RPT(5,"header")="Inactive Reason"
"RTN","SAMIUR2",201,0)
 . set RPT(5,"routine")="$$INACTRE^SAMIUR2"
"RTN","SAMIUR2",202,0)
 . set RPT(6,"header")="Inactive Comment"
"RTN","SAMIUR2",203,0)
 . set RPT(6,"routine")="$$INACTCM^SAMIUR2"
"RTN","SAMIUR2",204,0)
 . ;set RPT(7,"header")="Urban/Rural"
"RTN","SAMIUR2",205,0)
 . ;set RPT(7,"routine")="$$RURAL^SAMIUR2"
"RTN","SAMIUR2",206,0)
 . ;set RPT(8,"header")="Smoking Status"
"RTN","SAMIUR2",207,0)
 . ;set RPT(8,"routine")="$$SMKSTAT^SAMIUR2"
"RTN","SAMIUR2",208,0)
 . ;set RPT(9,"header")="Pack Years at Intake"
"RTN","SAMIUR2",209,0)
 . ;set RPT(9,"routine")="$$PACKYRS^SAMIUR2"
"RTN","SAMIUR2",210,0)
 . quit
"RTN","SAMIUR2",211,0)
 ;
"RTN","SAMIUR2",212,0)
 if TYPE="incomplete" do  quit  ;
"RTN","SAMIUR2",213,0)
 . set RPT(1,"header")="Enrollment date"
"RTN","SAMIUR2",214,0)
 . set RPT(1,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",215,0)
 . set RPT(2,"header")="Name"
"RTN","SAMIUR2",216,0)
 . set RPT(2,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",217,0)
 . set RPT(3,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",218,0)
 . set RPT(3,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",219,0)
 . set RPT(4,"header")="Incomplete form"
"RTN","SAMIUR2",220,0)
 . set RPT(4,"routine")="$$IFORM^SAMIUR2"
"RTN","SAMIUR2",221,0)
 . quit
"RTN","SAMIUR2",222,0)
 ;
"RTN","SAMIUR2",223,0)
 if TYPE="missingct" do  quit  ;
"RTN","SAMIUR2",224,0)
 . set RPT(1,"header")="Last contact date"
"RTN","SAMIUR2",225,0)
 . set RPT(1,"routine")="$$LDOC^SAMIUR2"
"RTN","SAMIUR2",226,0)
 . set RPT(2,"header")="Last contact entry"
"RTN","SAMIUR2",227,0)
 . set RPT(2,"routine")="$$LENTRY^SAMIUR2"
"RTN","SAMIUR2",228,0)
 . set RPT(3,"header")="Name"
"RTN","SAMIUR2",229,0)
 . set RPT(3,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",230,0)
 . set RPT(4,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",231,0)
 . set RPT(4,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",232,0)
 . set RPT(5,"header")="Enrollment date"
"RTN","SAMIUR2",233,0)
 . set RPT(5,"routine")="$$ENROLLDT^SAMIUR2"
"RTN","SAMIUR2",234,0)
 . quit
"RTN","SAMIUR2",235,0)
 ;
"RTN","SAMIUR2",236,0)
 if TYPE="cumpy" do  quit  ;
"RTN","SAMIUR2",237,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",238,0)
 . set RPT(1,"routine")="$$NAME^SAMIUR2"
"RTN","SAMIUR2",239,0)
 . set RPT(2,"header")="Study ID"
"RTN","SAMIUR2",240,0)
 . set RPT(2,"routine")="$$SID^SAMIUR2"
"RTN","SAMIUR2",241,0)
 . set RPT(3,"header")="Form Values"
"RTN","SAMIUR2",242,0)
 . set RPT(3,"routine")="$$VALS^SAMIUR2"
"RTN","SAMIUR2",243,0)
 . set RPT(4,"header")="Smoking History"
"RTN","SAMIUR2",244,0)
 . set RPT(4,"routine")="$$SMHIS^SAMIUR2"
"RTN","SAMIUR2",245,0)
 . quit
"RTN","SAMIUR2",246,0)
 ;
"RTN","SAMIUR2",247,0)
 if TYPE="unmatched" do  ;
"RTN","SAMIUR2",248,0)
 . set RPT(1,"header")="Unmatched Manual Entry"
"RTN","SAMIUR2",249,0)
 . set RPT(1,"routine")="$$MANPAT^SAMIUR2"
"RTN","SAMIUR2",250,0)
 . set RPT(2,"header")="Possible HL7 Match"
"RTN","SAMIUR2",251,0)
 . set RPT(2,"routine")="$$POSSIBLE^SAMIUR2"
"RTN","SAMIUR2",252,0)
 . set RPT(3,"header")="Match Control"
"RTN","SAMIUR2",253,0)
 . set RPT(3,"routine")="$$MATCH^SAMIUR2"
"RTN","SAMIUR2",254,0)
 . quit
"RTN","SAMIUR2",255,0)
 ;
"RTN","SAMIUR2",256,0)
 if TYPE="worklist" do  quit  ;
"RTN","SAMIUR2",257,0)
 . set RPT(1,"header")="Name"
"RTN","SAMIUR2",258,0)
 . set RPT(1,"routine")="$$WORKPAT^SAMIUR2"
"RTN","SAMIUR2",259,0)
 . set RPT(2,"header")=$$SSNLABEL(SITE)
"RTN","SAMIUR2",260,0)
 . set RPT(2,"routine")="$$SSN^SAMIUR2"
"RTN","SAMIUR2",261,0)
 . set RPT(3,"header")="Date of birth"
"RTN","SAMIUR2",262,0)
 . set RPT(3,"routine")="$$DOB^SAMIUR2"
"RTN","SAMIUR2",263,0)
 . set RPT(4,"header")="Gender"
"RTN","SAMIUR2",264,0)
 . set RPT(4,"routine")="$$GENDER^SAMIUR2"
"RTN","SAMIUR2",265,0)
 . quit
"RTN","SAMIUR2",266,0)
 ;
"RTN","SAMIUR2",267,0)
 quit  ; end of ppi RPTTBL^SAMIUR2
"RTN","SAMIUR2",268,0)
 ;
"RTN","SAMIUR2",269,0)
 ;
"RTN","SAMIUR2",270,0)
 ;
"RTN","SAMIUR2",271,0)
 ;@section 2 shared subroutines
"RTN","SAMIUR2",272,0)
 ;
"RTN","SAMIUR2",273,0)
 ;
"RTN","SAMIUR2",274,0)
 ;
"RTN","SAMIUR2",275,0)
DFN2SID(DFN) ;studyid for patient DFN
"RTN","SAMIUR2",276,0)
 ;
"RTN","SAMIUR2",277,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",278,0)
 ;@called-by
"RTN","SAMIUR2",279,0)
 ; $$SID^SAMIUR2
"RTN","SAMIUR2",280,0)
 ; $$IFORM^SAMIUR2
"RTN","SAMIUR2",281,0)
 ; $$VALS^SAMIUR2
"RTN","SAMIUR2",282,0)
 ; $$SMHIS^SAMIUR2
"RTN","SAMIUR2",283,0)
 ;@calls
"RTN","SAMIUR2",284,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",285,0)
 ;
"RTN","SAMIUR2",286,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",287,0)
 ;
"RTN","SAMIUR2",288,0)
 quit $get(@root@(DFN,"sisid")) ; end of $$DFN2SID
"RTN","SAMIUR2",289,0)
 ;
"RTN","SAMIUR2",290,0)
 ;
"RTN","SAMIUR2",291,0)
 ;
"RTN","SAMIUR2",292,0)
MKNAV(sid,zform,fname,form) ; html for navigation to form
"RTN","SAMIUR2",293,0)
 ;
"RTN","SAMIUR2",294,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",295,0)
 ;@called-by
"RTN","SAMIUR2",296,0)
 ; $$IFORM^SAMIUR2
"RTN","SAMIUR2",297,0)
 ;@calls none
"RTN","SAMIUR2",298,0)
 ;
"RTN","SAMIUR2",299,0)
 new rtn set rtn="<form method=""post"" action=""/vapals"">"
"RTN","SAMIUR2",300,0)
 set rtn=rtn_"<input name=""samiroute"" value=""form"" type=""hidden"">"
"RTN","SAMIUR2",301,0)
 set rtn=rtn_" <input name=""studyid"" value="""_sid_""" type=""hidden"">"
"RTN","SAMIUR2",302,0)
 set rtn=rtn_" <input name=""form"" value=""vapals:"_zform_""" type=""hidden"">"
"RTN","SAMIUR2",303,0)
 set rtn=rtn_" <input value="""_fname_""" class=""btn btn-link"" role=""link"" type=""submit""></form>"_$char(13)
"RTN","SAMIUR2",304,0)
 ;
"RTN","SAMIUR2",305,0)
 quit rtn ; end of $$MKNAV
"RTN","SAMIUR2",306,0)
 ;
"RTN","SAMIUR2",307,0)
 ;
"RTN","SAMIUR2",308,0)
 ;
"RTN","SAMIUR2",309,0)
 ;@section 3 smoking history subroutines
"RTN","SAMIUR2",310,0)
 ;
"RTN","SAMIUR2",311,0)
 ;
"RTN","SAMIUR2",312,0)
 ;
"RTN","SAMIUR2",313,0)
SHDET(SID,KEY) ; table contents for smoking history
"RTN","SAMIUR2",314,0)
 ;
"RTN","SAMIUR2",315,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",316,0)
 ;@called-by
"RTN","SAMIUR2",317,0)
 ; LOAD^SAMIFLD
"RTN","SAMIUR2",318,0)
 ; $$SMHIS^SAMIUR2
"RTN","SAMIUR2",319,0)
 ;@calls
"RTN","SAMIUR2",320,0)
 ; CUMPY
"RTN","SAMIUR2",321,0)
 ;
"RTN","SAMIUR2",322,0)
 ; KEY is the form key of the caller for "current" marker insertion
"RTN","SAMIUR2",323,0)
 ;
"RTN","SAMIUR2",324,0)
 new pyary
"RTN","SAMIUR2",325,0)
 if $get(KEY)="" set KEY=""
"RTN","SAMIUR2",326,0)
 do CUMPY("pyary",SID,KEY)
"RTN","SAMIUR2",327,0)
 ;
"RTN","SAMIUR2",328,0)
 new current set current=$get(pyary("current"))
"RTN","SAMIUR2",329,0)
 new rptcnt set rptcnt=0
"RTN","SAMIUR2",330,0)
 new rptmax set rptmax=$order(pyary("rpt",""),-1)
"RTN","SAMIUR2",331,0)
 quit:+rptmax=0
"RTN","SAMIUR2",332,0)
 ;
"RTN","SAMIUR2",333,0)
 new return set return=""
"RTN","SAMIUR2",334,0)
 new zi set zi=""
"RTN","SAMIUR2",335,0)
 for zi=1:1:rptmax do  ;
"RTN","SAMIUR2",336,0)
 . set rptcnt=rptcnt+1
"RTN","SAMIUR2",337,0)
 . if rptcnt=current set return=return_"<tr data-current-form=""true"">"
"RTN","SAMIUR2",338,0)
 . else  set return=return_"<tr>"
"RTN","SAMIUR2",339,0)
 . set return=return_"<td>"_pyary("rpt",rptcnt,1)_"</td>"
"RTN","SAMIUR2",340,0)
 . set return=return_"<td class=""reported-date"">"_pyary("rpt",rptcnt,2)_"</td>"
"RTN","SAMIUR2",341,0)
 . set return=return_"<td class=""pack-years"">"_pyary("rpt",rptcnt,3)_"</td>"
"RTN","SAMIUR2",342,0)
 . set return=return_"<td class=""cumulative-pack-years"">"_pyary("rpt",rptcnt,4)_"</td>"
"RTN","SAMIUR2",343,0)
 . set return=return_"</tr>"
"RTN","SAMIUR2",344,0)
 . quit
"RTN","SAMIUR2",345,0)
 ;
"RTN","SAMIUR2",346,0)
 quit return ; end of ppi $$SHDET^SAMIUR2
"RTN","SAMIUR2",347,0)
 ;
"RTN","SAMIUR2",348,0)
 ;
"RTN","SAMIUR2",349,0)
 ;
"RTN","SAMIUR2",350,0)
CUMPY(PYARY,sid,KEY) ; forms array of cummulative pack year data
"RTN","SAMIUR2",351,0)
 ;
"RTN","SAMIUR2",352,0)
 ;;ppi;procedure;clean;silent;sac
"RTN","SAMIUR2",353,0)
 ;@called-by
"RTN","SAMIUR2",354,0)
 ; SSTATUS^SAMINOT2
"RTN","SAMIUR2",355,0)
 ; SSTATUS^SAMINOT3
"RTN","SAMIUR2",356,0)
 ; $$SHDET
"RTN","SAMIUR2",357,0)
 ;@calls
"RTN","SAMIUR2",358,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",359,0)
 ; GETITEMS^SAMICASE
"RTN","SAMIUR2",360,0)
 ; $$GETDTKEY^SAMICAS2
"RTN","SAMIUR2",361,0)
 ; $$KEY2DSPD^SAMICAS2
"RTN","SAMIUR2",362,0)
 ; $$FMDT
"RTN","SAMIUR2",363,0)
 ; $$PKYDT
"RTN","SAMIUR2",364,0)
 ;
"RTN","SAMIUR2",365,0)
 ; PYARY passed by name
"RTN","SAMIUR2",366,0)
 ; KEY is the current form key for matching to a row
"RTN","SAMIUR2",367,0)
 ;
"RTN","SAMIUR2",368,0)
 kill @PYARY
"RTN","SAMIUR2",369,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",370,0)
 ; new sid set sid=$get(@root@(DFN,"samistudyid"))
"RTN","SAMIUR2",371,0)
 ; quit:sid=""
"RTN","SAMIUR2",372,0)
 ;
"RTN","SAMIUR2",373,0)
 new items set items=""
"RTN","SAMIUR2",374,0)
 do GETITEMS^SAMICASE("items",sid)
"RTN","SAMIUR2",375,0)
 quit:'$data(items)
"RTN","SAMIUR2",376,0)
 merge @PYARY@("items")=items
"RTN","SAMIUR2",377,0)
 ;
"RTN","SAMIUR2",378,0)
 new siform set siform=$order(items("siform"))
"RTN","SAMIUR2",379,0)
 quit:siform=""
"RTN","SAMIUR2",380,0)
 if siform=$get(KEY) set @PYARY@("current")=1 ;this row is the current form
"RTN","SAMIUR2",381,0)
 ;
"RTN","SAMIUR2",382,0)
 set @PYARY@("rpt",1,1)="Intake" ; Form
"RTN","SAMIUR2",383,0)
 new kdate set kdate=$$GETDTKEY^SAMICAS2(siform)
"RTN","SAMIUR2",384,0)
 new keydate set keydate=$$KEY2DSPD^SAMICAS2(kdate)
"RTN","SAMIUR2",385,0)
 set @PYARY@("rpt",1,2)=keydate ; Reported Date
"RTN","SAMIUR2",386,0)
 ;
"RTN","SAMIUR2",387,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",388,0)
 new lastcum set lastcum=$get(@vals@("sippy"))
"RTN","SAMIUR2",389,0)
 set @PYARY@("rpt",1,3)=lastcum ; Pack Years
"RTN","SAMIUR2",390,0)
 set @PYARY@("rpt",1,4)=lastcum ; Cumulative
"RTN","SAMIUR2",391,0)
 ;
"RTN","SAMIUR2",392,0)
 new lastdt set lastdt=keydate
"RTN","SAMIUR2",393,0)
 new rptcnt set rptcnt=1
"RTN","SAMIUR2",394,0)
 new zi set zi=""
"RTN","SAMIUR2",395,0)
 for  do  quit:zi=""  ;
"RTN","SAMIUR2",396,0)
 . set zi=$order(items("type","vapals:fuform",zi))
"RTN","SAMIUR2",397,0)
 . quit:zi=""
"RTN","SAMIUR2",398,0)
 . ;
"RTN","SAMIUR2",399,0)
 . set rptcnt=rptcnt+1
"RTN","SAMIUR2",400,0)
 . set @PYARY@("rpt",rptcnt,1)="Follow-up"
"RTN","SAMIUR2",401,0)
 . new kdate set kdate=$$GETDTKEY^SAMICAS2(zi)
"RTN","SAMIUR2",402,0)
 . new keydate set keydate=$$KEY2DSPD^SAMICAS2(kdate)
"RTN","SAMIUR2",403,0)
 . set @PYARY@("rpt",rptcnt,2)=keydate ; Reported Date
"RTN","SAMIUR2",404,0)
 . ;
"RTN","SAMIUR2",405,0)
 . set vals=$name(@root@("graph",sid,zi))
"RTN","SAMIUR2",406,0)
 . new newpd set newpd=$g(@vals@("sippd"))
"RTN","SAMIUR2",407,0)
 . new usedate set usedate=keydate
"RTN","SAMIUR2",408,0)
 . new siq set siq=$get(@vals@("siq")) ; quit date on followup form
"RTN","SAMIUR2",409,0)
 . if siq'="" do  ; quit date provided
"RTN","SAMIUR2",410,0)
 . . quit:$$FMDT(siq)<$$FMDT(lastdt)  ; quit date out of range
"RTN","SAMIUR2",411,0)
 . . quit:$$FMDT(siq)>$$FMDT(keydate)  ; quit date out of range
"RTN","SAMIUR2",412,0)
 . . set usedate=siq ; use the quit date as end of range
"RTN","SAMIUR2",413,0)
 . . quit
"RTN","SAMIUR2",414,0)
 . new newpy set newpy=$$PKYDT(lastdt,usedate,newpd)
"RTN","SAMIUR2",415,0)
 . set @vals@("sippy")=newpy
"RTN","SAMIUR2",416,0)
 . ;
"RTN","SAMIUR2",417,0)
 . set ^gpl("current","KEY")=$get(KEY)
"RTN","SAMIUR2",418,0)
 . set ^gpl("current","zi")=zi
"RTN","SAMIUR2",419,0)
 . if zi=$get(KEY) do
"RTN","SAMIUR2",420,0)
 . . set @PYARY@("current")=rptcnt ;this row is the current form
"RTN","SAMIUR2",421,0)
 . . quit
"RTN","SAMIUR2",422,0)
 . ;
"RTN","SAMIUR2",423,0)
 . new newcum set newcum=""
"RTN","SAMIUR2",424,0)
 . if newpy'="" set newcum=lastcum+newpy
"RTN","SAMIUR2",425,0)
 . set @PYARY@("rpt",rptcnt,3)=newpy ; Pack Years
"RTN","SAMIUR2",426,0)
 . set @PYARY@("rpt",rptcnt,4)=newcum ; Cumulative
"RTN","SAMIUR2",427,0)
 . set lastdt=keydate
"RTN","SAMIUR2",428,0)
 . set lastcum=newcum
"RTN","SAMIUR2",429,0)
 . quit
"RTN","SAMIUR2",430,0)
 ;
"RTN","SAMIUR2",431,0)
 quit  ; end of ppi CUMPY^SAMIUR2
"RTN","SAMIUR2",432,0)
 ;
"RTN","SAMIUR2",433,0)
 ;
"RTN","SAMIUR2",434,0)
 ;
"RTN","SAMIUR2",435,0)
TDDT(ZDT) ; embed date in table cell
"RTN","SAMIUR2",436,0)
 ;
"RTN","SAMIUR2",437,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",438,0)
 ;@called-by
"RTN","SAMIUR2",439,0)
 ; BLINEDT
"RTN","SAMIUR2",440,0)
 ; DOB
"RTN","SAMIUR2",441,0)
 ; FUDATE
"RTN","SAMIUR2",442,0)
 ; LASTEXM
"RTN","SAMIUR2",443,0)
 ; INACTDT
"RTN","SAMIUR2",444,0)
 ; LDOC
"RTN","SAMIUR2",445,0)
 ; STUDYDT
"RTN","SAMIUR2",446,0)
 ;@calls
"RTN","SAMIUR2",447,0)
 ; ^%DT
"RTN","SAMIUR2",448,0)
 ;
"RTN","SAMIUR2",449,0)
 new X,Y,Z
"RTN","SAMIUR2",450,0)
 set X=ZDT
"RTN","SAMIUR2",451,0)
 do ^%DT
"RTN","SAMIUR2",452,0)
 if Y=-1 set Y=""
"RTN","SAMIUR2",453,0)
 set Z=$$VAPALSDT^SAMICASE(Y)
"RTN","SAMIUR2",454,0)
 new cell
"RTN","SAMIUR2",455,0)
 set cell="<td data-order="""_Y_""" data-search="""_Z_""">"_Z_"</td>"
"RTN","SAMIUR2",456,0)
 ;
"RTN","SAMIUR2",457,0)
 quit cell ; end of $$TDDT
"RTN","SAMIUR2",458,0)
 ; 
"RTN","SAMIUR2",459,0)
 ;
"RTN","SAMIUR2",460,0)
 ;
"RTN","SAMIUR2",461,0)
FMDT(ZDT) ; convert date to fileman format
"RTN","SAMIUR2",462,0)
 ;
"RTN","SAMIUR2",463,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",464,0)
 ;@called-by
"RTN","SAMIUR2",465,0)
 ; MKPTLK^SAMIHOM4
"RTN","SAMIUR2",466,0)
 ; $$PKYDT
"RTN","SAMIUR2",467,0)
 ; CUMPY
"RTN","SAMIUR2",468,0)
 ;@calls
"RTN","SAMIUR2",469,0)
 ; ^%DT
"RTN","SAMIUR2",470,0)
 ;
"RTN","SAMIUR2",471,0)
 new Y
"RTN","SAMIUR2",472,0)
 new X set X=ZDT
"RTN","SAMIUR2",473,0)
 do ^%DT
"RTN","SAMIUR2",474,0)
 ;
"RTN","SAMIUR2",475,0)
 quit Y ; end of ppi $$FMDT^SAMIUR2
"RTN","SAMIUR2",476,0)
 ;
"RTN","SAMIUR2",477,0)
 ;
"RTN","SAMIUR2",478,0)
 ;
"RTN","SAMIUR2",479,0)
PKYDT(STDT,ENDT,PKS,CIGS) ; pack-years from start & end & cigs/day
"RTN","SAMIUR2",480,0)
 ;
"RTN","SAMIUR2",481,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",482,0)
 ;@called-by
"RTN","SAMIUR2",483,0)
 ; CUMPY
"RTN","SAMIUR2",484,0)
 ;@calls
"RTN","SAMIUR2",485,0)
 ; $$FMDT
"RTN","SAMIUR2",486,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIUR2",487,0)
 ; $$PKY
"RTN","SAMIUR2",488,0)
 ;
"RTN","SAMIUR2",489,0)
 ; if PKS is not provided, 20/CIGS will be used for packs per day
"RTN","SAMIUR2",490,0)
 ;
"RTN","SAMIUR2",491,0)
 new pkyr set pkyr=""
"RTN","SAMIUR2",492,0)
 if $get(PKS)="" do  ;
"RTN","SAMIUR2",493,0)
 . if $get(CIGS)="" set PKS=0 quit  ;
"RTN","SAMIUR2",494,0)
 . set PKS=20/CIGS
"RTN","SAMIUR2",495,0)
 . quit
"RTN","SAMIUR2",496,0)
 new zst set zst=$$FMDT(STDT)
"RTN","SAMIUR2",497,0)
 set:zst=-1 zst=STDT
"RTN","SAMIUR2",498,0)
 ;
"RTN","SAMIUR2",499,0)
 new zend set zend=$$FMDT(ENDT)
"RTN","SAMIUR2",500,0)
 set:zend=-1 zend=ENDT ; probably a fileman date already
"RTN","SAMIUR2",501,0)
 ;
"RTN","SAMIUR2",502,0)
 new zdif set zdif=$$FMDIFF^XLFDT(zend,zst)/365.24
"RTN","SAMIUR2",503,0)
 ;
"RTN","SAMIUR2",504,0)
 set pkyr=$$PKY(zdif,PKS)
"RTN","SAMIUR2",505,0)
 ;
"RTN","SAMIUR2",506,0)
 quit pkyr ; end of $$PKYDT
"RTN","SAMIUR2",507,0)
 ;
"RTN","SAMIUR2",508,0)
 ;
"RTN","SAMIUR2",509,0)
 ;
"RTN","SAMIUR2",510,0)
PKY(YRS,PKS) ; pack-years from years & packs/day
"RTN","SAMIUR2",511,0)
 ;
"RTN","SAMIUR2",512,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",513,0)
 ;@called-by
"RTN","SAMIUR2",514,0)
 ; $$PKYDT
"RTN","SAMIUR2",515,0)
 ;@calls none
"RTN","SAMIUR2",516,0)
 ;@input
"RTN","SAMIUR2",517,0)
 ; YRS = years
"RTN","SAMIUR2",518,0)
 ; PKS = packs/day
"RTN","SAMIUR2",519,0)
 ;
"RTN","SAMIUR2",520,0)
 new rtn set rtn=""
"RTN","SAMIUR2",521,0)
 set rtn=YRS*PKS
"RTN","SAMIUR2",522,0)
 if $length($piece(rtn,".",2))>2 do  ;
"RTN","SAMIUR2",523,0)
 . new zdec set zdec=$piece(rtn,".",2)
"RTN","SAMIUR2",524,0)
 . set rtn=$piece(rtn,".",1)_"."_$extract(zdec,1,2)
"RTN","SAMIUR2",525,0)
 . if $extract(zdec,3)>4 set rtn=rtn+.01
"RTN","SAMIUR2",526,0)
 . quit
"RTN","SAMIUR2",527,0)
 set:rtn'["." rtn=rtn_".0"
"RTN","SAMIUR2",528,0)
 ;
"RTN","SAMIUR2",529,0)
 quit rtn ; end of $$PKY
"RTN","SAMIUR2",530,0)
 ;
"RTN","SAMIUR2",531,0)
 ;
"RTN","SAMIUR2",532,0)
 ;
"RTN","SAMIUR2",533,0)
 ;@section 4 active column ppis
"RTN","SAMIUR2",534,0)
 ;
"RTN","SAMIUR2",535,0)
 ;
"RTN","SAMIUR2",536,0)
 ;
"RTN","SAMIUR2",537,0)
ACTIVE(zdt,dfn,SAMIPATS) ; Active/Inactive column
"RTN","SAMIUR2",538,0)
 ;
"RTN","SAMIUR2",539,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",540,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",541,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",542,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",543,0)
 new active set active="inactive"
"RTN","SAMIUR2",544,0)
 if $get(@vals@("sistatus"))="active" set active="active"
"RTN","SAMIUR2",545,0)
 ;
"RTN","SAMIUR2",546,0)
 quit active
"RTN","SAMIUR2",547,0)
 ; 
"RTN","SAMIUR2",548,0)
AFORM(zdt,dfn,SAMIPATS) ; Name of most recent form
"RTN","SAMIUR2",549,0)
 Q $GET(SAMIPATS(zdt,dfn,"aform"))
"RTN","SAMIUR2",550,0)
 ;
"RTN","SAMIUR2",551,0)
AFORMDT(zdt,dfn,SAMIPATS) ; Date of most recent form
"RTN","SAMIUR2",552,0)
 N ZD S ZD=$GET(SAMIPATS(zdt,dfn,"aformdt"))
"RTN","SAMIUR2",553,0)
 Q $$VAPALSDT^SAMICASE(ZD)
"RTN","SAMIUR2",554,0)
 ;
"RTN","SAMIUR2",555,0)
AGE(zdt,dfn,SAMIPATS) ; age
"RTN","SAMIUR2",556,0)
 ;
"RTN","SAMIUR2",557,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",558,0)
 ;@called-by
"RTN","SAMIUR2",559,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",560,0)
 ;@calls
"RTN","SAMIUR2",561,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",562,0)
 ; ^%DT
"RTN","SAMIUR2",563,0)
 ; $$NOW^XLFDT
"RTN","SAMIUR2",564,0)
 ; $$FMDIFF^XLFDT
"RTN","SAMIUR2",565,0)
 ;
"RTN","SAMIUR2",566,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",567,0)
 new dob set dob=$get(@root@(dfn,"sbdob")) ; dob in VAPALS format
"RTN","SAMIUR2",568,0)
 ;
"RTN","SAMIUR2",569,0)
 new Y
"RTN","SAMIUR2",570,0)
 new X set X=dob
"RTN","SAMIUR2",571,0)
 do ^%DT
"RTN","SAMIUR2",572,0)
 ;
"RTN","SAMIUR2",573,0)
 new age set age=$piece($$FMDIFF^XLFDT($$NOW^XLFDT,Y)/365,".")
"RTN","SAMIUR2",574,0)
 ;
"RTN","SAMIUR2",575,0)
 quit age ; end of ppi $$AGE^SAMIUR2
"RTN","SAMIUR2",576,0)
 ;
"RTN","SAMIUR2",577,0)
 ;
"RTN","SAMIUR2",578,0)
 ;
"RTN","SAMIUR2",579,0)
ENROLLDT(zdt,dfn,SAMIPATS) ; enrollment date
"RTN","SAMIUR2",580,0)
 ;
"RTN","SAMIUR2",581,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",582,0)
 ;@called-by
"RTN","SAMIUR2",583,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",584,0)
 ;@calls
"RTN","SAMIUR2",585,0)
 ; $$TDDT
"RTN","SAMIUR2",586,0)
 ;
"RTN","SAMIUR2",587,0)
 new enroldt set enroldt=$get(SAMIPATS(zdt,dfn,"edate"))
"RTN","SAMIUR2",588,0)
 ;
"RTN","SAMIUR2",589,0)
 quit $$TDDT(enroldt) ; end of ppi $$ENROLLDT^SAMIUR2
"RTN","SAMIUR2",590,0)
 ;
"RTN","SAMIUR2",591,0)
 ;
"RTN","SAMIUR2",592,0)
BLINEDT(zdt,dfn,SAMIPATS) ; baseline date
"RTN","SAMIUR2",593,0)
 ;
"RTN","SAMIUR2",594,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",595,0)
 ;@called-by
"RTN","SAMIUR2",596,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",597,0)
 ;@calls
"RTN","SAMIUR2",598,0)
 ; $$TDDT
"RTN","SAMIUR2",599,0)
 ;
"RTN","SAMIUR2",600,0)
 new bldt set bldt=$get(SAMIPATS(zdt,dfn,"baseline"))
"RTN","SAMIUR2",601,0)
 ;
"RTN","SAMIUR2",602,0)
 quit $$TDDT(bldt) ; end of ppi $$BLINEDT^SAMIUR2
"RTN","SAMIUR2",603,0)
 ;
"RTN","SAMIUR2",604,0)
 ;
"RTN","SAMIUR2",605,0)
CONTACT(zdt,dfn,SAMIPATS) ; patient street address
"RTN","SAMIUR2",606,0)
 ;
"RTN","SAMIUR2",607,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",608,0)
 ;@called-by
"RTN","SAMIUR2",609,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",610,0)
 ;@calls
"RTN","SAMIUR2",611,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",612,0)
 ;
"RTN","SAMIUR2",613,0)
 new contact set contact=""
"RTN","SAMIUR2",614,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",615,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",616,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",617,0)
 q:siform=""
"RTN","SAMIUR2",618,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",619,0)
 set contact=$get(@vals@("sinamef"))_" "_$get(@vals@("sinamel"))
"RTN","SAMIUR2",620,0)
 set contact=contact_"<br>"_$get(@vals@("sipsa"))
"RTN","SAMIUR2",621,0)
 if $get(@vals@("sipan"))'="" do
"RTN","SAMIUR2",622,0)
 . set contact=contact_" Apt "_$get(@vals@("sipan"))
"RTN","SAMIUR2",623,0)
 . quit
"RTN","SAMIUR2",624,0)
 if $get(@vals@("sipcn"))'="" do
"RTN","SAMIUR2",625,0)
 . set contact=contact_"<br>County "_@vals@("sipcn")
"RTN","SAMIUR2",626,0)
 . quit
"RTN","SAMIUR2",627,0)
 if $get(@vals@("sipc"))'="" do
"RTN","SAMIUR2",628,0)
 . set contact=contact_" <br>"_@vals@("sipc")_", "
"RTN","SAMIUR2",629,0)
 . quit
"RTN","SAMIUR2",630,0)
 set contact=contact_" "_$get(@vals@("sips"))_" "_$get(@vals@("sipz"))_"     "
"RTN","SAMIUR2",631,0)
 ;
"RTN","SAMIUR2",632,0)
 new phone set phone=$get(@vals@("sippn"))
"RTN","SAMIUR2",633,0)
 if phone'="" set contact=contact_" <br>Phone: "_phone
"RTN","SAMIUR2",634,0)
 ;
"RTN","SAMIUR2",635,0)
 quit contact ; end of ppi $$CONTACT^SAMIUR2
"RTN","SAMIUR2",636,0)
 ;
"RTN","SAMIUR2",637,0)
 ;
"RTN","SAMIUR2",638,0)
 ;
"RTN","SAMIUR2",639,0)
CTPROT(zdt,dfn,SAMIPATS) ; ct protocol
"RTN","SAMIUR2",640,0)
 ;
"RTN","SAMIUR2",641,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",642,0)
 ;@called-by
"RTN","SAMIUR2",643,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",644,0)
 ;@calls
"RTN","SAMIUR2",645,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",646,0)
 ;
"RTN","SAMIUR2",647,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",648,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",649,0)
 quit:ceform="" ""
"RTN","SAMIUR2",650,0)
 ;
"RTN","SAMIUR2",651,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",652,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",653,0)
 new cectp set cectp=$get(@vals@("cectp"))
"RTN","SAMIUR2",654,0)
 new ctyp set ctyp=$select(cectp="l":"Low-Dose CT",cectp="d":"Standard CT",cectp="i":"Limited",1:"")
"RTN","SAMIUR2",655,0)
 ;
"RTN","SAMIUR2",656,0)
 quit ctyp ; end of ppi $$CTPROT^SAMIUR2
"RTN","SAMIUR2",657,0)
 ;
"RTN","SAMIUR2",658,0)
 ;
"RTN","SAMIUR2",659,0)
 ;
"RTN","SAMIUR2",660,0)
DOB(ien,dfn,SAMIPATS) ; date of birth
"RTN","SAMIUR2",661,0)
 ;
"RTN","SAMIUR2",662,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",663,0)
 ;@called-by
"RTN","SAMIUR2",664,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",665,0)
 ;@calls
"RTN","SAMIUR2",666,0)
 ; $$TDDT
"RTN","SAMIUR2",667,0)
 ;
"RTN","SAMIUR2",668,0)
 new dob set dob=$get(SAMIPATS(ien,dfn,"dob"))
"RTN","SAMIUR2",669,0)
 if dob="" set dob=$get(SAMIPATS(ien,dfn,"sbdob"))
"RTN","SAMIUR2",670,0)
 ;
"RTN","SAMIUR2",671,0)
 quit $$TDDT(dob) ; end of ppi $$DOB^SAMIUR2
"RTN","SAMIUR2",672,0)
 ;
"RTN","SAMIUR2",673,0)
 ;
"RTN","SAMIUR2",674,0)
 ;
"RTN","SAMIUR2",675,0)
FUDATE(zdt,dfn,SAMIPATS) ; followup date
"RTN","SAMIUR2",676,0)
 ;
"RTN","SAMIUR2",677,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",678,0)
 ;@called-by
"RTN","SAMIUR2",679,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",680,0)
 ;@calls
"RTN","SAMIUR2",681,0)
 ; $TDDT
"RTN","SAMIUR2",682,0)
 ;
"RTN","SAMIUR2",683,0)
 new fud set fud="fudate"
"RTN","SAMIUR2",684,0)
 new date set date=$get(SAMIPATS(zdt,dfn,"cefud"))
"RTN","SAMIUR2",685,0)
 ;
"RTN","SAMIUR2",686,0)
 quit $$TDDT(date) ; end of ppi $$FUDATE^SAMIUR2
"RTN","SAMIUR2",687,0)
 ;
"RTN","SAMIUR2",688,0)
 ;
"RTN","SAMIUR2",689,0)
 ;
"RTN","SAMIUR2",690,0)
GENDER(zdt,dfn,SAMIPATS) ; gender
"RTN","SAMIUR2",691,0)
 ;
"RTN","SAMIUR2",692,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",693,0)
 ;@called-by
"RTN","SAMIUR2",694,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",695,0)
 ;@calls
"RTN","SAMIUR2",696,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",697,0)
 ;
"RTN","SAMIUR2",698,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",699,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",700,0)
 ;
"RTN","SAMIUR2",701,0)
 new gend set gend=$get(SAMIPATS(zdt,dfn,"gender"))
"RTN","SAMIUR2",702,0)
 if gend="" do
"RTN","SAMIUR2",703,0)
 . new pien set pien=$order(@root@("dfn",dfn,""))
"RTN","SAMIUR2",704,0)
 . if pien'="" do  ;
"RTN","SAMIUR2",705,0)
 . . set gend=$get(@root@(pien,"sex"))
"RTN","SAMIUR2",706,0)
 . . if gend="" set gend=$get(@root@(pien,"gender"))
"RTN","SAMIUR2",707,0)
 . . quit
"RTN","SAMIUR2",708,0)
 . if gend="" do  ;
"RTN","SAMIUR2",709,0)
 . . new lien set lien=$order(@lroot@("dfn",dfn,""))
"RTN","SAMIUR2",710,0)
 . . set gend=$get(@lroot@(lien,"gender"))
"RTN","SAMIUR2",711,0)
 . . quit
"RTN","SAMIUR2",712,0)
 if gend["^" set gend=$piece(gend,"^",1)
"RTN","SAMIUR2",713,0)
 ;
"RTN","SAMIUR2",714,0)
 quit gend ; end of ppi $$GENDER^SAMIUR2
"RTN","SAMIUR2",715,0)
 ;
"RTN","SAMIUR2",716,0)
 ;
"RTN","SAMIUR2",717,0)
 ;
"RTN","SAMIUR2",718,0)
IFORM(zdt,dfn,SAMIPATS) ; name(s) of incomplete forms
"RTN","SAMIUR2",719,0)
 ;
"RTN","SAMIUR2",720,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",721,0)
 ;@called-by
"RTN","SAMIUR2",722,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",723,0)
 ;@calls
"RTN","SAMIUR2",724,0)
 ; $$DFN2SID^SAMIUR2
"RTN","SAMIUR2",725,0)
 ; $$KEY2FM^SAMICASE
"RTN","SAMIUR2",726,0)
 ; $$VAPALSDT^SAMICASE
"RTN","SAMIUR2",727,0)
 ; $$MKNAV
"RTN","SAMIUR2",728,0)
 ;
"RTN","SAMIUR2",729,0)
 new iform set iform=$get(SAMIPATS(zdt,dfn,"iform"))
"RTN","SAMIUR2",730,0)
 quit:iform="" ""  ;
"RTN","SAMIUR2",731,0)
 ;
"RTN","SAMIUR2",732,0)
 new zkey1,zn,typ
"RTN","SAMIUR2",733,0)
 new return set return="<table>"
"RTN","SAMIUR2",734,0)
 for zn=2:1  quit:$piece(iform," ",zn)=""  do  ;
"RTN","SAMIUR2",735,0)
 . set return=return_"<tr><td>"
"RTN","SAMIUR2",736,0)
 . set zkey1=$piece(iform," ",zn)
"RTN","SAMIUR2",737,0)
 . ;
"RTN","SAMIUR2",738,0)
 . new fname
"RTN","SAMIUR2",739,0)
 . if zkey1["ceform" set fname="CT Evaluation" set typ="ceform"
"RTN","SAMIUR2",740,0)
 . if zkey1["sbform" set fname="Background" set typ="sbform"
"RTN","SAMIUR2",741,0)
 . if zkey1["fuform" set fname="Participant Follow-up" set typ="fuform"
"RTN","SAMIUR2",742,0)
 . if zkey1["bxform" set fname="Biopsy" set typ="bxform"
"RTN","SAMIUR2",743,0)
 . if zkey1["ptform" set fname="PET Evaluation" set typ="ptform"
"RTN","SAMIUR2",744,0)
 . if zkey1["itform" set fname="Intervention" set typ="itform"
"RTN","SAMIUR2",745,0)
 . if zkey1["siform" set fname="Intake Form" set typ="siform"
"RTN","SAMIUR2",746,0)
 . if $get(fname)="" set fname="unknown" set typ=""
"RTN","SAMIUR2",747,0)
 . ;
"RTN","SAMIUR2",748,0)
 . new sid set sid=$$DFN2SID^SAMIUR2(dfn)
"RTN","SAMIUR2",749,0)
 . new zdate set zdate=$$VAPALSDT^SAMICASE($$KEY2FM^SAMICASE(zkey1))
"RTN","SAMIUR2",750,0)
 . set return=return_$$MKNAV(sid,zkey1,fname_" - "_zdate,typ)
"RTN","SAMIUR2",751,0)
 . set return=return_"</td></tr>"
"RTN","SAMIUR2",752,0)
 . quit
"RTN","SAMIUR2",753,0)
 ;
"RTN","SAMIUR2",754,0)
 set return=return_"</table>"
"RTN","SAMIUR2",755,0)
 ;
"RTN","SAMIUR2",756,0)
 quit return ; end of ppi $$IFORM^SAMIUR2
"RTN","SAMIUR2",757,0)
 ;
"RTN","SAMIUR2",758,0)
 ;
"RTN","SAMIUR2",759,0)
 ;
"RTN","SAMIUR2",760,0)
LASTEXM(zdt,dfn,SAMIPATS) ; patient last exam
"RTN","SAMIUR2",761,0)
 ;
"RTN","SAMIUR2",762,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",763,0)
 ;@called-by
"RTN","SAMIUR2",764,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",765,0)
 ;@calls
"RTN","SAMIUR2",766,0)
 ; $$TDDT
"RTN","SAMIUR2",767,0)
 ;
"RTN","SAMIUR2",768,0)
 new lexm set lexm=$get(SAMIPATS(zdt,dfn,"cedos"))
"RTN","SAMIUR2",769,0)
 ;
"RTN","SAMIUR2",770,0)
 quit $$TDDT(lexm) ; end of ppi $$LASTEXM^SAMIUR2
"RTN","SAMIUR2",771,0)
 ;
"RTN","SAMIUR2",772,0)
 ;
"RTN","SAMIUR2",773,0)
 ;
"RTN","SAMIUR2",774,0)
INACTDT(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",775,0)
 ;
"RTN","SAMIUR2",776,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",777,0)
 ;@called-by
"RTN","SAMIUR2",778,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",779,0)
 ;@calls
"RTN","SAMIUR2",780,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",781,0)
 ; $$TDDT
"RTN","SAMIUR2",782,0)
 ;
"RTN","SAMIUR2",783,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",784,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",785,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",786,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",787,0)
 ;
"RTN","SAMIUR2",788,0)
 quit $$TDDT($get(@vals@("sidod")))
"RTN","SAMIUR2",789,0)
 ;
"RTN","SAMIUR2",790,0)
 ;
"RTN","SAMIUR2",791,0)
 ;
"RTN","SAMIUR2",792,0)
INACTRE(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",793,0)
 ;
"RTN","SAMIUR2",794,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",795,0)
 ;@called-by
"RTN","SAMIUR2",796,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",797,0)
 ;@calls
"RTN","SAMIUR2",798,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",799,0)
 ;
"RTN","SAMIUR2",800,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",801,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",802,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",803,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",804,0)
 ;
"RTN","SAMIUR2",805,0)
 quit $get(@vals@("sistachg"))
"RTN","SAMIUR2",806,0)
 ;
"RTN","SAMIUR2",807,0)
 ;
"RTN","SAMIUR2",808,0)
 ;
"RTN","SAMIUR2",809,0)
INACTCM(zdt,dfn,SAMIPATS) ; inactive date
"RTN","SAMIUR2",810,0)
 ;
"RTN","SAMIUR2",811,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",812,0)
 ;@called-by
"RTN","SAMIUR2",813,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",814,0)
 ;@calls
"RTN","SAMIUR2",815,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",816,0)
 ;
"RTN","SAMIUR2",817,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",818,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",819,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",820,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",821,0)
 ;
"RTN","SAMIUR2",822,0)
 quit $get(@vals@("sistreas"))
"RTN","SAMIUR2",823,0)
 ;
"RTN","SAMIUR2",824,0)
 ;
"RTN","SAMIUR2",825,0)
 ;
"RTN","SAMIUR2",826,0)
LDE(zdt,dfn,SAMIPATS) ; last date and entry in com log
"RTN","SAMIUR2",827,0)
 ;
"RTN","SAMIUR2",828,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",829,0)
 ;@called-by
"RTN","SAMIUR2",830,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",831,0)
 ;@calls
"RTN","SAMIUR2",832,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",833,0)
 ;
"RTN","SAMIUR2",834,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",835,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",836,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",837,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",838,0)
 ;
"RTN","SAMIUR2",839,0)
 n comien,comdt,comntry
"RTN","SAMIUR2",840,0)
 s (comdt,comntry)=""
"RTN","SAMIUR2",841,0)
 s comien=$o(@vals@("comlog"," "),-1)
"RTN","SAMIUR2",842,0)
 i comien="" d  q comdt
"RTN","SAMIUR2",843,0)
 . s comdt=$g(@vals@("sidc"))
"RTN","SAMIUR2",844,0)
 s comntry=$g(@vals@("comlog",comien))
"RTN","SAMIUR2",845,0)
 s comdt=$p($p(comntry,"[",2),"@",1)
"RTN","SAMIUR2",846,0)
 ;
"RTN","SAMIUR2",847,0)
 quit comdt_"^"_comntry
"RTN","SAMIUR2",848,0)
 ;
"RTN","SAMIUR2",849,0)
 ;
"RTN","SAMIUR2",850,0)
 ;
"RTN","SAMIUR2",851,0)
LDOC(zdt,dfn,SAMIPATS) ; last date of contact
"RTN","SAMIUR2",852,0)
 ;
"RTN","SAMIUR2",853,0)
 quit $$TDDT($piece($$LDE(zdt,dfn,.SAMIPATS),"^",1))
"RTN","SAMIUR2",854,0)
 ;
"RTN","SAMIUR2",855,0)
 ;
"RTN","SAMIUR2",856,0)
 ;
"RTN","SAMIUR2",857,0)
LENTRY(zdt,dfn,SAMIPATS) ; last contact entry
"RTN","SAMIUR2",858,0)
 ;
"RTN","SAMIUR2",859,0)
 quit $piece($$LDE(zdt,dfn,.SAMIPATS),"^",2)
"RTN","SAMIUR2",860,0)
 ;
"RTN","SAMIUR2",861,0)
 ;
"RTN","SAMIUR2",862,0)
 ;
"RTN","SAMIUR2",863,0)
MANPAT(ien,dfn,SAMIPATS) ; unmatched patient cell
"RTN","SAMIUR2",864,0)
 ;
"RTN","SAMIUR2",865,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",866,0)
 ;@called-by
"RTN","SAMIUR2",867,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",868,0)
 ;@calls
"RTN","SAMIUR2",869,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",870,0)
 ;
"RTN","SAMIUR2",871,0)
 new zcell set zcell=""
"RTN","SAMIUR2",872,0)
 ; set zcell=zcell_$get(SAMIPATS(ien,dfn,"saminame"))
"RTN","SAMIUR2",873,0)
 set zcell=zcell_$get(SAMIPATS(ien,dfn,"editref"))
"RTN","SAMIUR2",874,0)
 set zcell=zcell_"<br>Date of Birth: "_$get(SAMIPATS(ien,dfn,"dob"))
"RTN","SAMIUR2",875,0)
 set zcell=zcell_" Gender: "_$get(SAMIPATS(ien,dfn,"sex"))
"RTN","SAMIUR2",876,0)
 ;
"RTN","SAMIUR2",877,0)
 new ssn set ssn=$get(SAMIPATS(ien,dfn,"ssn"))
"RTN","SAMIUR2",878,0)
 if ssn="" do  ;
"RTN","SAMIUR2",879,0)
 . new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",880,0)
 . new tssn set tssn=$get(@lroot@(ien,"ssn"))
"RTN","SAMIUR2",881,0)
 . set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",882,0)
 . quit
"RTN","SAMIUR2",883,0)
 set zcell=zcell_"<br>SSN: "_ssn
"RTN","SAMIUR2",884,0)
 ;
"RTN","SAMIUR2",885,0)
 set zcell=zcell_"<br>dfn: "_dfn
"RTN","SAMIUR2",886,0)
 ;
"RTN","SAMIUR2",887,0)
 quit zcell ; end of ppi $$MANPAT^SAMIUR2
"RTN","SAMIUR2",888,0)
 ;
"RTN","SAMIUR2",889,0)
 ;
"RTN","SAMIUR2",890,0)
 ;
"RTN","SAMIUR2",891,0)
MATCH(ien,dfn,SAMIPATS) ; match button cell
"RTN","SAMIUR2",892,0)
 ;
"RTN","SAMIUR2",893,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",894,0)
 ;@called-by
"RTN","SAMIUR2",895,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",896,0)
 ;@calls none
"RTN","SAMIUR2",897,0)
 ;
"RTN","SAMIUR2",898,0)
 new matien set matien=$get(SAMIPATS(ien,dfn,"MATCHLOG"))
"RTN","SAMIUR2",899,0)
 quit:matien="" ""
"RTN","SAMIUR2",900,0)
 ;
"RTN","SAMIUR2",901,0)
 new nuhref set nuhref="<form method=POST action=""/vapals"">"
"RTN","SAMIUR2",902,0)
 set nuhref=nuhref_"<input type=hidden name=""samiroute"" value=""merge"">"
"RTN","SAMIUR2",903,0)
 set nuhref=nuhref_"<input type=hidden name=""toien"" value="_ien_">"
"RTN","SAMIUR2",904,0)
 set nuhref=nuhref_"<input value=""Merge"" class=""btn btn-link"" role=""link"" type=""submit""></form>"
"RTN","SAMIUR2",905,0)
 ;
"RTN","SAMIUR2",906,0)
 quit nuhref ; end of ppi $$MATCH^SAMIUR2
"RTN","SAMIUR2",907,0)
 ;
"RTN","SAMIUR2",908,0)
 ;
"RTN","SAMIUR2",909,0)
 ;
"RTN","SAMIUR2",910,0)
NAME(zdt,dfn,SAMIPATS) ; name w/hyperlink
"RTN","SAMIUR2",911,0)
 ;
"RTN","SAMIUR2",912,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",913,0)
 ;@called-by
"RTN","SAMIUR2",914,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",915,0)
 ;@calls none
"RTN","SAMIUR2",916,0)
 ;
"RTN","SAMIUR2",917,0)
 new nam set nam="Name"
"RTN","SAMIUR2",918,0)
 ;
"RTN","SAMIUR2",919,0)
 quit $get(SAMIPATS(zdt,dfn,"nuhref")) ; end of ppi $$NAME^SAMIUR2
"RTN","SAMIUR2",920,0)
 ;
"RTN","SAMIUR2",921,0)
 ;
"RTN","SAMIUR2",922,0)
 ;
"RTN","SAMIUR2",923,0)
PACKYRS(zdt,dfn,SAMIPATS) ; smoking status
"RTN","SAMIUR2",924,0)
 ;
"RTN","SAMIUR2",925,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",926,0)
 ;@called-by
"RTN","SAMIUR2",927,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",928,0)
 ;@calls
"RTN","SAMIUR2",929,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",930,0)
 ;
"RTN","SAMIUR2",931,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",932,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",933,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",934,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",935,0)
 new pkyrs set pkyrs=$get(@vals@("sippy"))
"RTN","SAMIUR2",936,0)
 ;
"RTN","SAMIUR2",937,0)
 quit pkyrs ; end of ppi $$PACKYRS^SAMIUR2
"RTN","SAMIUR2",938,0)
 ;
"RTN","SAMIUR2",939,0)
 ;
"RTN","SAMIUR2",940,0)
 ;
"RTN","SAMIUR2",941,0)
POSSIBLE(ien,dfn,SAMIPATS) ; possible match cell
"RTN","SAMIUR2",942,0)
 ;
"RTN","SAMIUR2",943,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",944,0)
 ;@called-by
"RTN","SAMIUR2",945,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",946,0)
 ;@calls
"RTN","SAMIUR2",947,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",948,0)
 ;
"RTN","SAMIUR2",949,0)
 new zcell set zcell=""
"RTN","SAMIUR2",950,0)
 new matien set matien=$get(SAMIPATS(ien,dfn,"MATCHLOG"))
"RTN","SAMIUR2",951,0)
 quit:matien="" zcell
"RTN","SAMIUR2",952,0)
 ;
"RTN","SAMIUR2",953,0)
 new lroot set lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIUR2",954,0)
 quit:'$data(@lroot@(matien)) zcell
"RTN","SAMIUR2",955,0)
 ;
"RTN","SAMIUR2",956,0)
 set zcell=zcell_$get(@lroot@(matien,"saminame"))
"RTN","SAMIUR2",957,0)
 set zcell=zcell_"<br>Date of Birth: "_$get(@lroot@(matien,"sbdob"))
"RTN","SAMIUR2",958,0)
 set zcell=zcell_" Gender: "_$get(@lroot@(matien,"sex"))
"RTN","SAMIUR2",959,0)
 ;
"RTN","SAMIUR2",960,0)
 new tssn set tssn=$get(@lroot@(matien,"ssn"))
"RTN","SAMIUR2",961,0)
 new ssn set ssn=tssn
"RTN","SAMIUR2",962,0)
 if tssn'["-" set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",963,0)
 set zcell=zcell_"<br>SSN: "_ssn
"RTN","SAMIUR2",964,0)
 ;
"RTN","SAMIUR2",965,0)
 set zcell=zcell_"<br>dfn: "_$get(@lroot@(matien,"dfn"))
"RTN","SAMIUR2",966,0)
 ;
"RTN","SAMIUR2",967,0)
 quit zcell ; end of ppi $$POSSIBLE^SAMIUR2
"RTN","SAMIUR2",968,0)
 ;
"RTN","SAMIUR2",969,0)
 ;
"RTN","SAMIUR2",970,0)
 ;
"RTN","SAMIUR2",971,0)
RECOM(zdt,dfn,SAMIPATS) ; recommendation
"RTN","SAMIUR2",972,0)
 ;
"RTN","SAMIUR2",973,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",974,0)
 ;@called-by
"RTN","SAMIUR2",975,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",976,0)
 ;@calls
"RTN","SAMIUR2",977,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",978,0)
 ;
"RTN","SAMIUR2",979,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",980,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",981,0)
 quit:ceform="" ""
"RTN","SAMIUR2",982,0)
 ;
"RTN","SAMIUR2",983,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",984,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",985,0)
 new cefuw set cefuw=$get(@vals@("cefuw"))
"RTN","SAMIUR2",986,0)
 ;
"RTN","SAMIUR2",987,0)
 new recom set recom=""
"RTN","SAMIUR2",988,0)
 set recom=$select(cefuw="1y":"Annual Repeat",cefuw="nw":"Now",cefuw="1m":"1 month",cefuw="3m":"3 months",cefuw="6m":"6 months",cefuw="os":"Other",1:"")
"RTN","SAMIUR2",989,0)
 if $get(@vals@("cefuaf"))="y" set recom=recom_", Antibiotics"
"RTN","SAMIUR2",990,0)
 if $get(@vals@("cefucc"))="y" set recom=recom_", Contrast CT"
"RTN","SAMIUR2",991,0)
 if $get(@vals@("cefupe"))="y" set recom=recom_", PET"
"RTN","SAMIUR2",992,0)
 if $get(@vals@("cefufn"))="y" set recom=recom_", Percutaneous biopsy"
"RTN","SAMIUR2",993,0)
 if $get(@vals@("cefubr"))="y" set recom=recom_", Bronchoscopy"
"RTN","SAMIUR2",994,0)
 if $get(@vals@("cefupc"))="y" set recom=recom_", Pulmonary consultation"
"RTN","SAMIUR2",995,0)
 if $get(@vals@("cefutb"))="y" set recom=recom_", Refer to tumor board"
"RTN","SAMIUR2",996,0)
 if $get(@vals@("cefunf"))="y" set recom=recom_", No other further follow-up"
"RTN","SAMIUR2",997,0)
 if $extract(recom,1,2)=", " set recom=$extract(recom,3,$length(recom))
"RTN","SAMIUR2",998,0)
 ;
"RTN","SAMIUR2",999,0)
 quit recom ; end of ppi $$RECOM^SAMIUR2
"RTN","SAMIUR2",1000,0)
 ;
"RTN","SAMIUR2",1001,0)
 ;
"RTN","SAMIUR2",1002,0)
 ;
"RTN","SAMIUR2",1003,0)
RURAL(zdt,dfn,SAMIPATS) ; patient's rural/urban status
"RTN","SAMIUR2",1004,0)
 ;
"RTN","SAMIUR2",1005,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1006,0)
 ;@called-by
"RTN","SAMIUR2",1007,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1008,0)
 ;@calls
"RTN","SAMIUR2",1009,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1010,0)
 ;
"RTN","SAMIUR2",1011,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1012,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1013,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1014,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1015,0)
 new sirs set sirs=$get(@vals@("sirs"))
"RTN","SAMIUR2",1016,0)
 set sirs=$select(sirs="r":"rural",sirs="u":"urban",sirs="n":"unknown",1:"unknown")
"RTN","SAMIUR2",1017,0)
 ;
"RTN","SAMIUR2",1018,0)
 quit sirs ; end of ppi $$RURAL^SAMIUR2
"RTN","SAMIUR2",1019,0)
 ;
"RTN","SAMIUR2",1020,0)
 ;
"RTN","SAMIUR2",1021,0)
 ;
"RTN","SAMIUR2",1022,0)
SID(zdt,dfn,SAMIPATS) ; study ID
"RTN","SAMIUR2",1023,0)
 ;
"RTN","SAMIUR2",1024,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1025,0)
 ;@called-by
"RTN","SAMIUR2",1026,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1027,0)
 ;@calls
"RTN","SAMIUR2",1028,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1029,0)
 ;
"RTN","SAMIUR2",1030,0)
 quit $$DFN2SID(dfn) ; end of ppi $$SID^SAMIUR2
"RTN","SAMIUR2",1031,0)
 ;
"RTN","SAMIUR2",1032,0)
 ;
"RTN","SAMIUR2",1033,0)
 ;
"RTN","SAMIUR2",1034,0)
SMHIS(zdt,dfn,SAMIPATS) ; smoking history cell
"RTN","SAMIUR2",1035,0)
 ;
"RTN","SAMIUR2",1036,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1037,0)
 ;@called-by
"RTN","SAMIUR2",1038,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1039,0)
 ;@calls
"RTN","SAMIUR2",1040,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1041,0)
 ; $$SHDET
"RTN","SAMIUR2",1042,0)
 ;
"RTN","SAMIUR2",1043,0)
 new zrtn set zrtn=""
"RTN","SAMIUR2",1044,0)
 set zrtn=zrtn_"<div class=""row""><div class=""col-md-12""><table class=""table"" id=""pack-years-history"">"
"RTN","SAMIUR2",1045,0)
 set zrtn=zrtn_"<thead><tr><th>Form </th><th> Reported Date </th>"
"RTN","SAMIUR2",1046,0)
 set zrtn=zrtn_"<th>Pack Years</th><th>Cumulative</th></tr></thead><tbody>"
"RTN","SAMIUR2",1047,0)
 set zrtn=zrtn_$$SHDET($$DFN2SID(dfn))
"RTN","SAMIUR2",1048,0)
 set zrtn=zrtn_"</tbody></table></div></div>"
"RTN","SAMIUR2",1049,0)
 ;
"RTN","SAMIUR2",1050,0)
 quit zrtn ; end of ppi $$SMHIS^SAMIUR2
"RTN","SAMIUR2",1051,0)
 ;
"RTN","SAMIUR2",1052,0)
 ;
"RTN","SAMIUR2",1053,0)
 ;
"RTN","SAMIUR2",1054,0)
SMKSTAT(zdt,dfn,SAMIPATS) ; smoking status
"RTN","SAMIUR2",1055,0)
 ;
"RTN","SAMIUR2",1056,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1057,0)
 ;@called-by
"RTN","SAMIUR2",1058,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1059,0)
 ;@calls
"RTN","SAMIUR2",1060,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1061,0)
 ;
"RTN","SAMIUR2",1062,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1063,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1064,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1065,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1066,0)
 ;
"RTN","SAMIUR2",1067,0)
 new smk set smk="unknown"
"RTN","SAMIUR2",1068,0)
 if $get(@vals@("siesm"))="n" set smk="Never smoked"
"RTN","SAMIUR2",1069,0)
 if $get(@vals@("siesm"))="p" set smk="Past smoker"
"RTN","SAMIUR2",1070,0)
 if $get(@vals@("siesm"))="c" set smk="Current smoker"
"RTN","SAMIUR2",1071,0)
 ; if $get(@vals@("siesq"))=1 set smk="Cu"
"RTN","SAMIUR2",1072,0)
 ;
"RTN","SAMIUR2",1073,0)
 quit smk ; end of ppi $$SMKSTAT^SAMIUR2
"RTN","SAMIUR2",1074,0)
 ;
"RTN","SAMIUR2",1075,0)
 ;
"RTN","SAMIUR2",1076,0)
 ;
"RTN","SAMIUR2",1077,0)
SSN(zdt,dfn,SAMIPATS) ; social security number
"RTN","SAMIUR2",1078,0)
 ;
"RTN","SAMIUR2",1079,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1080,0)
 ;@called-by
"RTN","SAMIUR2",1081,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1082,0)
 ;@calls none
"RTN","SAMIUR2",1083,0)
 ;
"RTN","SAMIUR2",1084,0)
 new tssn set tssn=$get(SAMIPATS(zdt,dfn,"ssn"))
"RTN","SAMIUR2",1085,0)
 new ssn set ssn=tssn
"RTN","SAMIUR2",1086,0)
 if ssn'["-" do
"RTN","SAMIUR2",1087,0)
 . set ssn=$extract(tssn,1,3)_"-"_$extract(tssn,4,5)_"-"_$extract(tssn,6,9)
"RTN","SAMIUR2",1088,0)
 . quit
"RTN","SAMIUR2",1089,0)
 ;
"RTN","SAMIUR2",1090,0)
 quit ssn ; end of ppi $$SSN^SAMIUR2
"RTN","SAMIUR2",1091,0)
 ;
"RTN","SAMIUR2",1092,0)
 ;
"RTN","SAMIUR2",1093,0)
 ;
"RTN","SAMIUR2",1094,0)
SSNLABEL(SITE) ; extrinsic returns label for SSN (ie PID)
"RTN","SAMIUR2",1095,0)
 new RTN
"RTN","SAMIUR2",1096,0)
 set RTN=$$GET1PARM^SAMIPARM("socialSecurityNumber",SITE)
"RTN","SAMIUR2",1097,0)
 if RTN="" set RTN="SSN"
"RTN","SAMIUR2",1098,0)
 quit RTN
"RTN","SAMIUR2",1099,0)
 ;
"RTN","SAMIUR2",1100,0)
 ;
"RTN","SAMIUR2",1101,0)
 ;
"RTN","SAMIUR2",1102,0)
STUDYDT(zdt,dfn,SAMIPATS) ; latest study date
"RTN","SAMIUR2",1103,0)
 ;
"RTN","SAMIUR2",1104,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1105,0)
 ;@called-by
"RTN","SAMIUR2",1106,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1107,0)
 ;@calls
"RTN","SAMIUR2",1108,0)
 ; $$TDDT
"RTN","SAMIUR2",1109,0)
 ;
"RTN","SAMIUR2",1110,0)
 new stdt set stdt=$get(SAMIPATS(zdt,dfn,"cedos"))
"RTN","SAMIUR2",1111,0)
 ;
"RTN","SAMIUR2",1112,0)
 quit $$TDDT(stdt) ; end of ppi $$STUDYDT^SAMIUR2
"RTN","SAMIUR2",1113,0)
 ;
"RTN","SAMIUR2",1114,0)
 ;
"RTN","SAMIUR2",1115,0)
 ;
"RTN","SAMIUR2",1116,0)
STUDYTYP(zdt,dfn,SAMIPATS) ; latest study type
"RTN","SAMIUR2",1117,0)
 ;
"RTN","SAMIUR2",1118,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1119,0)
 ;@called-by
"RTN","SAMIUR2",1120,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1121,0)
 ;@calls
"RTN","SAMIUR2",1122,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1123,0)
 ;
"RTN","SAMIUR2",1124,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1125,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1126,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1127,0)
 ;
"RTN","SAMIUR2",1128,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1129,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1130,0)
 new stypx set stypx=$get(@vals@("cetex"))
"RTN","SAMIUR2",1131,0)
 new styp set styp=$select(stypx="a":"Annual",stypx="b":"Baseline",stypx="d":"Followup",1:"")
"RTN","SAMIUR2",1132,0)
 ;
"RTN","SAMIUR2",1133,0)
 quit styp ; end of ppi $$STUDYTYP^SAMIUR2
"RTN","SAMIUR2",1134,0)
 ;
"RTN","SAMIUR2",1135,0)
 ;
"RTN","SAMIUR2",1136,0)
 ;
"RTN","SAMIUR2",1137,0)
VALS(zdt,dfn,SAMIPATS) ; form-values cell
"RTN","SAMIUR2",1138,0)
 ;
"RTN","SAMIUR2",1139,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1140,0)
 ;@called-by
"RTN","SAMIUR2",1141,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1142,0)
 ;@calls
"RTN","SAMIUR2",1143,0)
 ; $$DFN2SID
"RTN","SAMIUR2",1144,0)
 ;
"RTN","SAMIUR2",1145,0)
 new vrtn set vrtn=""
"RTN","SAMIUR2",1146,0)
 new vsid set vsid=$$DFN2SID(dfn)
"RTN","SAMIUR2",1147,0)
 new vgr set vgr="/vals?sid="_vsid_"&form="
"RTN","SAMIUR2",1148,0)
 quit:'$data(SAMIPATS)
"RTN","SAMIUR2",1149,0)
 ;
"RTN","SAMIUR2",1150,0)
 new vzi set vzi=""
"RTN","SAMIUR2",1151,0)
 for  do  quit:vzi="sort"  quit:vzi=""
"RTN","SAMIUR2",1152,0)
 . set vzi=$order(SAMIPATS(zdt,dfn,"items",vzi))
"RTN","SAMIUR2",1153,0)
 . quit:vzi="sort"
"RTN","SAMIUR2",1154,0)
 . quit:vzi=""
"RTN","SAMIUR2",1155,0)
 . set vrtn=vrtn_"<a href="""_vgr_vzi_""">"_vzi_"</a><br>"
"RTN","SAMIUR2",1156,0)
 . quit
"RTN","SAMIUR2",1157,0)
 ;
"RTN","SAMIUR2",1158,0)
 quit vrtn ; end of $$VALS^SAMIUR2
"RTN","SAMIUR2",1159,0)
 ;
"RTN","SAMIUR2",1160,0)
 ;
"RTN","SAMIUR2",1161,0)
 ;
"RTN","SAMIUR2",1162,0)
WHEN(zdt,dfn,SAMIPATS) ; followup text
"RTN","SAMIUR2",1163,0)
 ;
"RTN","SAMIUR2",1164,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1165,0)
 ;@called-by
"RTN","SAMIUR2",1166,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1167,0)
 ;@calls
"RTN","SAMIUR2",1168,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1169,0)
 ;
"RTN","SAMIUR2",1170,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1171,0)
 new ceform set ceform=$get(SAMIPATS(zdt,dfn,"ceform"))
"RTN","SAMIUR2",1172,0)
 quit:ceform="" ""
"RTN","SAMIUR2",1173,0)
 ;
"RTN","SAMIUR2",1174,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1175,0)
 new vals set vals=$name(@root@("graph",sid,ceform))
"RTN","SAMIUR2",1176,0)
 new whnx set whnx=$get(@vals@("cefuw"))
"RTN","SAMIUR2",1177,0)
 quit:whnx="" ""
"RTN","SAMIUR2",1178,0)
 ;
"RTN","SAMIUR2",1179,0)
 new DICT
"RTN","SAMIUR2",1180,0)
 set DICT("cefuw","1m")="in one month"
"RTN","SAMIUR2",1181,0)
 set DICT("cefuw","1y")="in one year"
"RTN","SAMIUR2",1182,0)
 set DICT("cefuw","3m")="in three months"
"RTN","SAMIUR2",1183,0)
 set DICT("cefuw","6m")="in six months"
"RTN","SAMIUR2",1184,0)
 set DICT("cefuw","os")="other as specified"
"RTN","SAMIUR2",1185,0)
 set whn=$get(DICT("cefuw",whnx))
"RTN","SAMIUR2",1186,0)
 ;
"RTN","SAMIUR2",1187,0)
 quit whn ; end of ppi $$WHEN^SAMIUR2
"RTN","SAMIUR2",1188,0)
 ;
"RTN","SAMIUR2",1189,0)
 ;
"RTN","SAMIUR2",1190,0)
 ;
"RTN","SAMIUR2",1191,0)
WORKPAT(ien,dfn,SAMIPATS) ; worklist patient name cell
"RTN","SAMIUR2",1192,0)
 ;
"RTN","SAMIUR2",1193,0)
 ;;ppi;function;clean;silent;sac
"RTN","SAMIUR2",1194,0)
 ;@called-by
"RTN","SAMIUR2",1195,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIUR2",1196,0)
 ;@calls none
"RTN","SAMIUR2",1197,0)
 ;
"RTN","SAMIUR2",1198,0)
 new zcell set zcell=""
"RTN","SAMIUR2",1199,0)
 set zcell=zcell_$get(SAMIPATS(ien,dfn,"workref"))
"RTN","SAMIUR2",1200,0)
 ;
"RTN","SAMIUR2",1201,0)
 quit zcell ; end of ppi $$WORKPAT^SAMIUR2
"RTN","SAMIUR2",1202,0)
 ;
"RTN","SAMIUR2",1203,0)
 ;
"RTN","SAMIUR2",1204,0)
 ;
"RTN","SAMIUR2",1205,0)
 ;@section 5 unused subroutines
"RTN","SAMIUR2",1206,0)
 ;
"RTN","SAMIUR2",1207,0)
 ;
"RTN","SAMIUR2",1208,0)
 ;
"RTN","SAMIUR2",1209,0)
EPAT(ien,dfn,SAMIPATS) ; patient name w/nav to enrollment
"RTN","SAMIUR2",1210,0)
 ;
"RTN","SAMIUR2",1211,0)
 ;;private;procedure;clean;silent;sac
"RTN","SAMIUR2",1212,0)
 ;@called-by none
"RTN","SAMIUR2",1213,0)
 ;@calls none
"RTN","SAMIUR2",1214,0)
 ;
"RTN","SAMIUR2",1215,0)
 quit  ; end of $$EPAT
"RTN","SAMIUR2",1216,0)
 ;
"RTN","SAMIUR2",1217,0)
 ;
"RTN","SAMIUR2",1218,0)
 ;
"RTN","SAMIUR2",1219,0)
ETHNCTY(zdt,dfn,SAMIPATS) ; ethnicity
"RTN","SAMIUR2",1220,0)
 ;
"RTN","SAMIUR2",1221,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1222,0)
 ;@called-by none
"RTN","SAMIUR2",1223,0)
 ;@calls none
"RTN","SAMIUR2",1224,0)
 ;
"RTN","SAMIUR2",1225,0)
 quit "ethnicity" ; end of $$ETHNCTY
"RTN","SAMIUR2",1226,0)
 ;
"RTN","SAMIUR2",1227,0)
 ;
"RTN","SAMIUR2",1228,0)
 ;
"RTN","SAMIUR2",1229,0)
RACE(zdt,dfn,SAMIPATS) ; race
"RTN","SAMIUR2",1230,0)
 ;
"RTN","SAMIUR2",1231,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1232,0)
 ;@called-by none [call commented out in RPTTBL]
"RTN","SAMIUR2",1233,0)
 ;@calls
"RTN","SAMIUR2",1234,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1235,0)
 ;
"RTN","SAMIUR2",1236,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1237,0)
 new race set race=$get(@root@(dfn,"race"))
"RTN","SAMIUR2",1238,0)
 ;
"RTN","SAMIUR2",1239,0)
 quit race ; end of $$RACE
"RTN","SAMIUR2",1240,0)
 ;
"RTN","SAMIUR2",1241,0)
 ;
"RTN","SAMIUR2",1242,0)
 ;
"RTN","SAMIUR2",1243,0)
STATUS(zdt,dfn,SAMIPATS) ; patient status
"RTN","SAMIUR2",1244,0)
 ;
"RTN","SAMIUR2",1245,0)
 ;;private;function;clean;silent;sac
"RTN","SAMIUR2",1246,0)
 ;@called-by none
"RTN","SAMIUR2",1247,0)
 ;@calls
"RTN","SAMIUR2",1248,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1249,0)
 ;
"RTN","SAMIUR2",1250,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1251,0)
 new sid set sid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIUR2",1252,0)
 new siform set siform=$get(SAMIPATS(zdt,dfn,"siform"))
"RTN","SAMIUR2",1253,0)
 new vals set vals=$name(@root@("graph",sid,siform))
"RTN","SAMIUR2",1254,0)
 new stat set stat=$get(@vals@("sistatus"))
"RTN","SAMIUR2",1255,0)
 ;
"RTN","SAMIUR2",1256,0)
 quit stat ; end of $$STATUS
"RTN","SAMIUR2",1257,0)
 ;
"RTN","SAMIUR2",1258,0)
 ;
"RTN","SAMIUR2",1259,0)
 ;
"RTN","SAMIUR2",1260,0)
WSVALS(RTN,FILTER) ; display form values from graph
"RTN","SAMIUR2",1261,0)
 ;
"RTN","SAMIUR2",1262,0)
 ;;web service;procedure;clean;silent;sac
"RTN","SAMIUR2",1263,0)
 ;@called-by none
"RTN","SAMIUR2",1264,0)
 ;@calls
"RTN","SAMIUR2",1265,0)
 ; $$setroot^%wd
"RTN","SAMIUR2",1266,0)
 ; wsGtree^SYNVPR
"RTN","SAMIUR2",1267,0)
 ;
"RTN","SAMIUR2",1268,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIUR2",1269,0)
 new sid set sid=$get(FILTER("sid"))
"RTN","SAMIUR2",1270,0)
 if sid="" set sid=$get(FILTER("studyid"))
"RTN","SAMIUR2",1271,0)
 quit:sid=""
"RTN","SAMIUR2",1272,0)
 ;
"RTN","SAMIUR2",1273,0)
 new zform set zform=$get(FILTER("form"))
"RTN","SAMIUR2",1274,0)
 new groot
"RTN","SAMIUR2",1275,0)
 if zform="" set groot=$name(@root@("graph",sid))
"RTN","SAMIUR2",1276,0)
 else  set groot=$name(@root@("graph",sid,zform))
"RTN","SAMIUR2",1277,0)
 set FILTER("root")=$extract(groot,2,$length(groot))
"RTN","SAMIUR2",1278,0)
 ;
"RTN","SAMIUR2",1279,0)
 do wsGtree^SYNVPR(.RTN,.FILTER)
"RTN","SAMIUR2",1280,0)
 ;
"RTN","SAMIUR2",1281,0)
 quit  ; end of ws WSVALS^SAMIUR2
"RTN","SAMIUR2",1282,0)
 ;
"RTN","SAMIUR2",1283,0)
 ;
"RTN","SAMIUR2",1284,0)
 ;
"RTN","SAMIUR2",1285,0)
EOR ; end of routine SAMIUR2
"RTN","SAMIURUL")
0^19^B107481
"RTN","SAMIURUL",1,0)
SAMIURUL ;ven/gpl - user reports log 2021-10-29T23:59Z
"RTN","SAMIURUL",2,0)
 ;;18.0;SAMI;**12,14,15**;2020-01;Build 2
"RTN","SAMIURUL",3,0)
 ;;18-15
"RTN","SAMIURUL",4,0)
 ;
"RTN","SAMIURUL",5,0)
 ; SAMIURUL contains the development log & module documentation for
"RTN","SAMIURUL",6,0)
 ; the VAPALS-ELCAP user-reports routines SAMIUR & SAMIUR2.
"RTN","SAMIURUL",7,0)
 ;
"RTN","SAMIURUL",8,0)
 quit  ; no entry from top
"RTN","SAMIURUL",9,0)
 ;
"RTN","SAMIURUL",10,0)
 ;
"RTN","SAMIURUL",11,0)
 ;
"RTN","SAMIURUL",12,0)
 ;@section 0 primary development
"RTN","SAMIURUL",13,0)
 ;
"RTN","SAMIURUL",14,0)
 ;
"RTN","SAMIURUL",15,0)
 ;
"RTN","SAMIURUL",16,0)
 ;@routine-credits
"RTN","SAMIURUL",17,0)
 ;@dev-main Frederick D. S. Marshall (toad)
"RTN","SAMIURUL",18,0)
 ; toad@vistaexpertise.net
"RTN","SAMIURUL",19,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIURUL",20,0)
 ; http://vistaexpertise.net
"RTN","SAMIURUL",21,0)
 ;@copyright 2021, mcglk & toad, all rights reserved
"RTN","SAMIURUL",22,0)
 ;@license see routine SAMIUL
"RTN","SAMIURUL",23,0)
 ;
"RTN","SAMIURUL",24,0)
 ;@last-update 2021-10-29T23:59Z
"RTN","SAMIURUL",25,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIURUL",26,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIURUL",27,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIURUL",28,0)
 ;@version 18-15
"RTN","SAMIURUL",29,0)
 ;@release-date 2020-01
"RTN","SAMIURUL",30,0)
 ;@patch-list **12,14,15**
"RTN","SAMIURUL",31,0)
 ;
"RTN","SAMIURUL",32,0)
 ;@dev-add Kenneth McGlothlen (mcglk)
"RTN","SAMIURUL",33,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIURUL",34,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIURUL",35,0)
 ; lmry@vistaexpertise.net
"RTN","SAMIURUL",36,0)
 ;
"RTN","SAMIURUL",37,0)
 ;@module-credits
"RTN","SAMIURUL",38,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIURUL",39,0)
 ; (VA-PALS)
"RTN","SAMIURUL",40,0)
 ; http://va-pals.org/
"RTN","SAMIURUL",41,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIURUL",42,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIURUL",43,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIURUL",44,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIURUL",45,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIURUL",46,0)
 ; http://ielcap.com/
"RTN","SAMIURUL",47,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIURUL",48,0)
 ; http://paraxialtech.com/
"RTN","SAMIURUL",49,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIURUL",50,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIURUL",51,0)
 ;
"RTN","SAMIURUL",52,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIURUL",53,0)
 ;
"RTN","SAMIURUL",54,0)
 ; 2020-02-10/12 ven/gpl 18.0-t4 d543f7bb,f9869dfb,0e4d8b9a,5e67489f
"RTN","SAMIURUL",55,0)
 ;  SAMIUR,SAMIUR2 1st version of revised user reports, progress on
"RTN","SAMIURUL",56,0)
 ; user reports, fixed a bug in enrollment report, add rural/urban &
"RTN","SAMIURUL",57,0)
 ; compute.
"RTN","SAMIURUL",58,0)
 ;
"RTN","SAMIURUL",59,0)
 ; 2020-02-18 ven/lgc 18.0-t4 76874314
"RTN","SAMIURUL",60,0)
 ;  SAMIUR update recently edited routines.
"RTN","SAMIURUL",61,0)
 ;
"RTN","SAMIURUL",62,0)
 ; 2020-03-10/12 ven/gpl 18.0-t4 8de06b06,4ad52d64
"RTN","SAMIURUL",63,0)
 ;  SAMIUR user report date filtering, fix end date logic in UR.
"RTN","SAMIURUL",64,0)
 ;
"RTN","SAMIURUL",65,0)
 ; 2019-03-24/28 ven/gpl 18.0-t4 1fd4a4c8,0cebb36b
"RTN","SAMIURUL",66,0)
 ;  SAMIUR2 revise incomplete form report, remove ethnicity from
"RTN","SAMIURUL",67,0)
 ; enrollment report (we can't get it).
"RTN","SAMIURUL",68,0)
 ;
"RTN","SAMIURUL",69,0)
 ; 2020-04-16/23 ven/lgc 18.0-t4 e54b76d1b,89bffd3b
"RTN","SAMIURUL",70,0)
 ;  SAMIUR SAMIFRM2 > SAMIFORM, SAMISUB2 > LOAD.
"RTN","SAMIURUL",71,0)
 ;
"RTN","SAMIURUL",72,0)
 ; 2019-05-08 ven/lgc 18.0 2172e512
"RTN","SAMIURUL",73,0)
 ;  SAMIUR2 remove blank last line.
"RTN","SAMIURUL",74,0)
 ;
"RTN","SAMIURUL",75,0)
 ; 2019-06-21 par/dom 18.0 c6a4a57f VAP-352
"RTN","SAMIURUL",76,0)
 ;  SAMIUR2 proper spelling of "follow up."
"RTN","SAMIURUL",77,0)
 ;
"RTN","SAMIURUL",78,0)
 ; 2019-08-03/04 ven/gpl 18.0 ffc94f65,d03557d4,cd865e2b VPA-438
"RTN","SAMIURUL",79,0)
 ;  SAMIUR requested changes to followup report.
"RTN","SAMIURUL",80,0)
 ;  SAMIUR2 fix smoking status on enrollment report, fix change log
"RTN","SAMIURUL",81,0)
 ; display, add pack years at intake to enrollment report, add
"RTN","SAMIURUL",82,0)
 ; requested changes to followup report.
"RTN","SAMIURUL",83,0)
 ;
"RTN","SAMIURUL",84,0)
 ; 2019-09-26 ven/gpl 18.0 92b12324 VAP-420
"RTN","SAMIURUL",85,0)
 ;  SAMIUR add smoking history.
"RTN","SAMIURUL",86,0)
 ;  SAMIUR2 smoking history, new cummulative packyear processing.
"RTN","SAMIURUL",87,0)
 ;
"RTN","SAMIURUL",88,0)
 ; 2019-10-01 par/dom 18.0 4caf1a98 VAP-344
"RTN","SAMIURUL",89,0)
 ;  SAMIUR2 make capitalization consistent.
"RTN","SAMIURUL",90,0)
 ;
"RTN","SAMIURUL",91,0)
 ; 2020-01-01/05 ven/arc 18.0 399f8547,62e3200f
"RTN","SAMIURUL",92,0)
 ;  SAMIUR unmatched participant processing.
"RTN","SAMIURUL",93,0)
 ;  SAMIUR2 add unmatched patient processing.
"RTN","SAMIURUL",94,0)
 ;
"RTN","SAMIURUL",95,0)
 ; 2020-01-10 ven/gpl 18.0 1590577c
"RTN","SAMIURUL",96,0)
 ;  SAMIUR2 fix return on RACE^SAMIUR2 for cache.
"RTN","SAMIURUL",97,0)
 ;
"RTN","SAMIURUL",98,0)
 ; 2020-04-29/05-13 ven/gpl 18.5 e8b8ea2d,61c7d208
"RTN","SAMIURUL",99,0)
 ;  SAMIUR fixes for reports, worklist functionality.
"RTN","SAMIURUL",100,0)
 ;
"RTN","SAMIURUL",101,0)
 ; 2020-05-13/14 ven/gpl 18.5 61c7d208,b05df417
"RTN","SAMIURUL",102,0)
 ;  SAMIUR2 add worklist functionality, fix gender & dob detection on
"RTN","SAMIURUL",103,0)
 ; reports.
"RTN","SAMIURUL",104,0)
 ;
"RTN","SAMIURUL",105,0)
 ; 2021-03-22/23 ven/gpl 18.10 256efe63,ba81b86a
"RTN","SAMIURUL",106,0)
 ;  SAMIUR sort all reports by name, added row totals to reports.
"RTN","SAMIURUL",107,0)
 ;
"RTN","SAMIURUL",108,0)
 ; 2021-03-23 ven/toad 18.10 96f461d0,af86e0eb
"RTN","SAMIURUL",109,0)
 ;  SAMIUR add version info & dev log, lt refactor, fix XINDEX
"RTN","SAMIURUL",110,0)
 ; errors.
"RTN","SAMIURUL",111,0)
 ;
"RTN","SAMIURUL",112,0)
 ; 2021-03-29 ven/gpl 18.11 e809f2a2
"RTN","SAMIURUL",113,0)
 ;  SAMIUR prevent crash when reports have no matches: in WSREPORT
"RTN","SAMIURUL",114,0)
 ; set SRT="" and uncomment zwrite SRT; in WKLIST add 2 commented-out
"RTN","SAMIURUL",115,0)
 ; debugging lines.
"RTN","SAMIURUL",116,0)
 ;
"RTN","SAMIURUL",117,0)
 ; 2021-03-30 ven/toad 18.11 7b14bb29
"RTN","SAMIURUL",118,0)
 ;  SAMIUR bump version, date, log; in WSREPORT comment zwrite SRT.
"RTN","SAMIURUL",119,0)
 ;
"RTN","SAMIURUL",120,0)
 ; 2021-03-31 ven/gpl 18.11 66d89cde
"RTN","SAMIURUL",121,0)
 ;  SAMIUR sort on all uppercase names for reports
"RTN","SAMIURUL",122,0)
 ;
"RTN","SAMIURUL",123,0)
 ; 2021-04-13 ven/gpl 18.11 a12765bf,f09ffef9,fb399aba
"RTN","SAMIURUL",124,0)
 ;  SAMIUR inactive report created.
"RTN","SAMIURUL",125,0)
 ;  SAMIUR2 in RPTTBL,GENDER create inactive report, move last exam
"RTN","SAMIURUL",126,0)
 ; column on followup report, fix gender being blank in reports.
"RTN","SAMIURUL",127,0)
 ;
"RTN","SAMIURUL",128,0)
 ; 2021-05-20/25 ven/mcglk&toad 18.11 43a4557c,70fc6ba3,129e96b1,
"RTN","SAMIURUL",129,0)
 ; cee2bf17
"RTN","SAMIURUL",130,0)
 ;  SAMIUR annotate, lt refactor, bump version.
"RTN","SAMIURUL",131,0)
 ;  SAMIUR2 passim hdr comments, chg log, annotate, refactor, bump
"RTN","SAMIURUL",132,0)
 ; version.
"RTN","SAMIURUL",133,0)
 ;
"RTN","SAMIURUL",134,0)
 ; 2021-05-29 ven/gpl 18.12-t2 e6fd5730,a3d6f9a0
"RTN","SAMIURUL",135,0)
 ;  SAMIUR,SAMIUR2 ssn params & matching report, update unmatched
"RTN","SAMIURUL",136,0)
 ; report headings.
"RTN","SAMIURUL",137,0)
 ;
"RTN","SAMIURUL",138,0)
 ; 2021-06-15 ven/gpl 18.12-t2 7e481426
"RTN","SAMIURUL",139,0)
 ;  SAMIUR add site to editperson navigation.
"RTN","SAMIURUL",140,0)
 ;
"RTN","SAMIURUL",141,0)
 ; 2021-06-28 ven/gpl 18.12-t2 df0aaea1,1137e2bb
"RTN","SAMIURUL",142,0)
 ;  SAMIUR change definition of inactive to not marked active, change
"RTN","SAMIURUL",143,0)
 ; definition of active to marked active.
"RTN","SAMIURUL",144,0)
 ;
"RTN","SAMIURUL",145,0)
 ; 2021-07-06 ven/mcglk&toad&gpl 18.12-t2 cbf7e46b,2d642aa4,
"RTN","SAMIURUL",146,0)
 ; b248664b
"RTN","SAMIURUL",147,0)
 ;  SAMIURUL new routine for dev log.
"RTN","SAMIURUL",148,0)
 ;  SAMIUR,SAMIUR2,SAMIURUL move dev log & module docs to SAMIURUL,
"RTN","SAMIURUL",149,0)
 ; bump version & dates.
"RTN","SAMIURUL",150,0)
 ;  SAMIUR in SELECT r/inactive w/status, test for active instead of
"RTN","SAMIURUL",151,0)
 ; inactive.
"RTN","SAMIURUL",152,0)
 ;
"RTN","SAMIURUL",153,0)
 ; 2021-07-12 ven/gpl 18.12-t3 60f4bb05,27c40485,d35bcb46
"RTN","SAMIURUL",154,0)
 ;  SAMIUR in WSREPORT,SORT add contact date & entry to missingct
"RTN","SAMIURUL",155,0)
 ; report.
"RTN","SAMIURUL",156,0)
 ;  SAMIUR2 add contact date & entry to missingct report; add
"RTN","SAMIURUL",157,0)
 ; inactive date reason & comment to inactive report; chg inactive
"RTN","SAMIURUL",158,0)
 ; date to date of death.
"RTN","SAMIURUL",159,0)
 ;
"RTN","SAMIURUL",160,0)
 ; 2021-08-01 ven/gpl 18.12 5bd7c627
"RTN","SAMIURUL",161,0)
 ;  SAMIUR set intake form to incomplete on creation: in SELECT if
"RTN","SAMIURUL",162,0)
 ; type="incomplete" ensure default status is incomplete.
"RTN","SAMIURUL",163,0)
 ;
"RTN","SAMIURUL",164,0)
 ; 2021-08-11 ven/gpl 18.12 4d4f0fc3
"RTN","SAMIURUL",165,0)
 ;  SAMIUR,SAMIUR2 add sorting to tables used for reports
"RTN","SAMIURUL",166,0)
 ;  SAMIUR in WSREPORT,NUHREF,WKLIST.
"RTN","SAMIURUL",167,0)
 ;  SAMIUR2 in TDDT,BLINEDT,DOB,FUDATE,LASTEXM,INACTDT,LDOC,STUDYDT
"RTN","SAMIURUL",168,0)
 ;
"RTN","SAMIURUL",169,0)
 ; 2021-08-26 ven/gpl 18.14 de044cf9
"RTN","SAMIURUL",170,0)
 ; SAMIUR, SAMIUR2 make changes to user reports as requested.
"RTN","SAMIURUL",171,0)
 ; Reports changed were Enrollment, Activity, and Follow-up.
"RTN","SAMIURUL",172,0)
 ;
"RTN","SAMIURUL",173,0)
 ; 2021-08-28 ven/gpl 18.14  cd69ff8b, fbd9196d
"RTN","SAMIURUL",174,0)
 ; SAMIUR, SAMIUR2 fix bugs causing Activity report to work incorrectly.
"RTN","SAMIURUL",175,0)
 ; Also fixed problem with Work List.
"RTN","SAMIURUL",176,0)
 ;
"RTN","SAMIURUL",177,0)
 ; 2021-09-09 ven/gpl 18.14  afa4bfc2, 7f668e64, 8d45ebac
"RTN","SAMIURUL",178,0)
 ; SAMIUR fix bugs in reports showing inactive patients on wrong reports,
"RTN","SAMIURUL",179,0)
 ; "baseline" showing up in F/U date on Follow-up report, wrong patients
"RTN","SAMIURUL",180,0)
 ; on Intake but Missing CT Eval report.
"RTN","SAMIURUL",181,0)
 ;
"RTN","SAMIURUL",182,0)
 ; 2021-10-05 ven/gpl 18.14   3251c582, c4343d69, 368fa7f7, c4343d69
"RTN","SAMIURUL",183,0)
 ;  b3cd039b, 237109df, 368fa7f7
"RTN","SAMIURUL",184,0)
 ; SAMIIUR, SAMIUR2 fix some small bugs, make date formats consistent, bump 
"RTN","SAMIURUL",185,0)
 ; versions and dates.
"RTN","SAMIURUL",186,0)
 ;
"RTN","SAMIURUL",187,0)
 ; 2021-10-14 ven/gpl 18.14  6a973630
"RTN","SAMIURUL",188,0)
 ; SAMIUR fix bug where patients with CT Evals would appear on the Intake
"RTN","SAMIURUL",189,0)
 ; but no CT report
"RTN","SAMIURUL",190,0)
 ;
"RTN","SAMIURUL",191,0)
 ; 2021-10-15 ven/lmry 18.14 87fd8eb3
"RTN","SAMIURUL",192,0)
 ; SAMIUR, SAMIURUL update history, bump dates
"RTN","SAMIURUL",193,0)
 ;
"RTN","SAMIURUL",194,0)
 ; 2021-10-20 ven/gpl 18-15 b63bfc06
"RTN","SAMIURUL",195,0)
 ;  SAMIUR2  suppress rural column in enrollment report if not VA
"RTN","SAMIURUL",196,0)
 ;
"RTN","SAMIURUL",197,0)
 ; 2021-10-25 ven/gpl 18-15 b6188d2c
"RTN","SAMIURUL",198,0)
 ;  SAMIUR fix for duplicates in work list and matching reports
"RTN","SAMIURUL",199,0)
 ;
"RTN","SAMIURUL",200,0)
 ; 2021-10-28 ven/lmry,mcglk 18-15
"RTN","SAMIURUL",201,0)
 ;  SAMIUR, SAMIUR2, SAMIURUL update history, bump dates and versions
"RTN","SAMIURUL",202,0)
 ;
"RTN","SAMIURUL",203,0)
 ; 2021-10-29 ven/lmry 18-15
"RTN","SAMIURUL",204,0)
 ;  SAMIUR remove blank at end of line for XINDEX
"RTN","SAMIURUL",205,0)
 ;
"RTN","SAMIURUL",206,0)
 ;@contents
"RTN","SAMIURUL",207,0)
 ; SAMIUR user reports
"RTN","SAMIURUL",208,0)
 ; SAMIUR2 user reports cont
"RTN","SAMIURUL",209,0)
 ; SAMIURUL user reports log
"RTN","SAMIURUL",210,0)
 ;
"RTN","SAMIURUL",211,0)
 ; SAMIUR1 [to be added]
"RTN","SAMIURUL",212,0)
 ;
"RTN","SAMIURUL",213,0)
 ;
"RTN","SAMIURUL",214,0)
 ;
"RTN","SAMIURUL",215,0)
EOR ; end of SAMIURUL
"SEC","^DIC",311.14,311.14,0,"AUDIT")
@
"SEC","^DIC",311.14,311.14,0,"DD")
@
"SEC","^DIC",311.14,311.14,0,"DEL")
@
"SEC","^DIC",311.14,311.14,0,"LAYGO")
@
"SEC","^DIC",311.14,311.14,0,"RD")
@
"SEC","^DIC",311.14,311.14,0,"WR")
@
"VER")
8.0^22.2
"^DD",311.14,311.14,0)
FIELD^^1^2
"^DD",311.14,311.14,0,"DT")
3211101
"^DD",311.14,311.14,0,"IX","B",311.14,.01)

"^DD",311.14,311.14,0,"NM","SAMI PARAMETER DEFAULTS")

"^DD",311.14,311.14,0,"PT",311.12,.04)

"^DD",311.14,311.14,0,"VRPK")
SAMI
"^DD",311.14,311.14,.01,0)
NAME^RFJ30^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",311.14,311.14,.01,.1)
DEFAULT PARAMETER SET NAME
"^DD",311.14,311.14,.01,1,0)
^.1
"^DD",311.14,311.14,.01,1,1,0)
311.14^B
"^DD",311.14,311.14,.01,1,1,1)
S ^SAMI(311.14,"B",$E(X,1,30),DA)=""
"^DD",311.14,311.14,.01,1,1,2)
K ^SAMI(311.14,"B",$E(X,1,30),DA)
"^DD",311.14,311.14,.01,3)
Answer must be 3-30 characters in length.
"^DD",311.14,311.14,.01,"DT")
3210419
"^DD",311.14,311.14,1,0)
PARM^311.141^^1;0
"^DD",311.14,311.141,0)
PARM SUB-FIELD^^.02^2
"^DD",311.14,311.141,0,"DT")
3210419
"^DD",311.14,311.141,0,"IX","B",311.141,.01)

"^DD",311.14,311.141,0,"NM","PARM")

"^DD",311.14,311.141,0,"UP")
311.14
"^DD",311.14,311.141,.01,0)
PARM^MMFJ30^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",311.14,311.141,.01,.1)
PARAMETER NAME
"^DD",311.14,311.141,.01,1,0)
^.1
"^DD",311.14,311.141,.01,1,1,0)
311.141^B
"^DD",311.14,311.141,.01,1,1,1)
S ^SAMI(311.14,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",311.14,311.141,.01,1,1,2)
K ^SAMI(311.14,DA(1),1,"B",$E(X,1,30),DA)
"^DD",311.14,311.141,.01,3)
Answer must be 1-30 characters in length.
"^DD",311.14,311.141,.01,"DT")
3210420
"^DD",311.14,311.141,.02,0)
VALUE^FJ180^^0;2^K:$L(X)>180!($L(X)<1) X
"^DD",311.14,311.141,.02,.1)
PARAMETER VALUE
"^DD",311.14,311.141,.02,3)
Answer must be 1-180 characters in length.
"^DD",311.14,311.141,.02,"DT")
3210419
"^DIC",311.14,311.14,0)
SAMI PARAMETER DEFAULTS^311.14
"^DIC",311.14,311.14,0,"GL")
^SAMI(311.14,
"^DIC",311.14,"B","SAMI PARAMETER DEFAULTS",311.14)

**END**
**END**
