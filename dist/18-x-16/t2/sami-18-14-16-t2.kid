KIDS Distribution saved on Sep 27, 2021@14:11:20
Test release SAMI*18.0*16 SEQ #14 T2
**KIDS**:SAMI*18.0*16^

**INSTALL NAME**
SAMI*18.0*16
"BLD",11515,0)
SAMI*18.0*16^^0^3210927^n
"BLD",11515,1,0)
^^1^1^3210924^
"BLD",11515,1,1,0)
Test release SAMI*18.0*16 SEQ #14 T1.
"BLD",11515,4,0)
^9.64PA^^
"BLD",11515,6.3)
2
"BLD",11515,"KRN",0)
^9.67PA^1.5^25
"BLD",11515,"KRN",.4,0)
.4
"BLD",11515,"KRN",.401,0)
.401
"BLD",11515,"KRN",.402,0)
.402
"BLD",11515,"KRN",.403,0)
.403
"BLD",11515,"KRN",.5,0)
.5
"BLD",11515,"KRN",.84,0)
.84
"BLD",11515,"KRN",1.5,0)
1.5
"BLD",11515,"KRN",1.6,0)
1.6
"BLD",11515,"KRN",1.61,0)
1.61
"BLD",11515,"KRN",1.62,0)
1.62
"BLD",11515,"KRN",3.6,0)
3.6
"BLD",11515,"KRN",3.8,0)
3.8
"BLD",11515,"KRN",9.2,0)
9.2
"BLD",11515,"KRN",9.8,0)
9.8
"BLD",11515,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",11515,"KRN",9.8,"NM",1,0)
SAMIHOM4^^0^B902907585
"BLD",11515,"KRN",9.8,"NM",2,0)
SAMIHUL^^0^B109364
"BLD",11515,"KRN",9.8,"NM",3,0)
SAMIZPH1^^0^B252745932
"BLD",11515,"KRN",9.8,"NM","B","SAMIHOM4",1)

"BLD",11515,"KRN",9.8,"NM","B","SAMIHUL",2)

"BLD",11515,"KRN",9.8,"NM","B","SAMIZPH1",3)

"BLD",11515,"KRN",19,0)
19
"BLD",11515,"KRN",19.1,0)
19.1
"BLD",11515,"KRN",101,0)
101
"BLD",11515,"KRN",409.61,0)
409.61
"BLD",11515,"KRN",771,0)
771
"BLD",11515,"KRN",779.2,0)
779.2
"BLD",11515,"KRN",870,0)
870
"BLD",11515,"KRN",8989.51,0)
8989.51
"BLD",11515,"KRN",8989.52,0)
8989.52
"BLD",11515,"KRN",8993,0)
8993
"BLD",11515,"KRN",8994,0)
8994
"BLD",11515,"KRN","B",.4,.4)

"BLD",11515,"KRN","B",.401,.401)

"BLD",11515,"KRN","B",.402,.402)

"BLD",11515,"KRN","B",.403,.403)

"BLD",11515,"KRN","B",.5,.5)

"BLD",11515,"KRN","B",.84,.84)

"BLD",11515,"KRN","B",1.5,1.5)

"BLD",11515,"KRN","B",1.6,1.6)

"BLD",11515,"KRN","B",1.61,1.61)

"BLD",11515,"KRN","B",1.62,1.62)

"BLD",11515,"KRN","B",3.6,3.6)

"BLD",11515,"KRN","B",3.8,3.8)

"BLD",11515,"KRN","B",9.2,9.2)

"BLD",11515,"KRN","B",9.8,9.8)

"BLD",11515,"KRN","B",19,19)

"BLD",11515,"KRN","B",19.1,19.1)

"BLD",11515,"KRN","B",101,101)

"BLD",11515,"KRN","B",409.61,409.61)

"BLD",11515,"KRN","B",771,771)

"BLD",11515,"KRN","B",779.2,779.2)

"BLD",11515,"KRN","B",870,870)

"BLD",11515,"KRN","B",8989.51,8989.51)

"BLD",11515,"KRN","B",8989.52,8989.52)

"BLD",11515,"KRN","B",8993,8993)

"BLD",11515,"KRN","B",8994,8994)

"BLD",11515,"QUES",0)
^9.62^^
"BLD",11515,"REQB",0)
^9.611^12^12
"BLD",11515,"REQB",1,0)
SAMI*18.0*1^0
"BLD",11515,"REQB",2,0)
SAMI*18.0*2^0
"BLD",11515,"REQB",3,0)
SAMI*18.0*3^0
"BLD",11515,"REQB",4,0)
SAMI*18.0*4^0
"BLD",11515,"REQB",5,0)
SAMI 18.0T05^0
"BLD",11515,"REQB",6,0)
SAMI*18.0*6^0
"BLD",11515,"REQB",7,0)
SAMI*18.0*8^0
"BLD",11515,"REQB",8,0)
SAMI*18.0*9^0
"BLD",11515,"REQB",9,0)
SAMI*18.0*10^0
"BLD",11515,"REQB",10,0)
SAMI*18.0*11^0
"BLD",11515,"REQB",11,0)
SAMI*18.0*12^0
"BLD",11515,"REQB",12,0)
SAMI*18.0*13^0
"BLD",11515,"REQB","B","SAMI 18.0T05",5)

"BLD",11515,"REQB","B","SAMI*18.0*1",1)

"BLD",11515,"REQB","B","SAMI*18.0*10",9)

"BLD",11515,"REQB","B","SAMI*18.0*11",10)

"BLD",11515,"REQB","B","SAMI*18.0*12",11)

"BLD",11515,"REQB","B","SAMI*18.0*13",12)

"BLD",11515,"REQB","B","SAMI*18.0*2",2)

"BLD",11515,"REQB","B","SAMI*18.0*3",3)

"BLD",11515,"REQB","B","SAMI*18.0*4",4)

"BLD",11515,"REQB","B","SAMI*18.0*6",6)

"BLD",11515,"REQB","B","SAMI*18.0*8",7)

"BLD",11515,"REQB","B","SAMI*18.0*9",8)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","SAMIHOM4")
0^1^B902907585
"RTN","SAMIHOM4",1,0)
SAMIHOM4 ;ven/gpl,arc - homepage web services ;2021-9-24t20:33z
"RTN","SAMIHOM4",2,0)
 ;;18.0;SAMI;**1,4,5,6,9,12,16**;2020-01;Build 2
"RTN","SAMIHOM4",3,0)
 ;18-x-16-t1
"RTN","SAMIHOM4",4,0)
 ;
"RTN","SAMIHOM4",5,0)
 ; SAMIHOM4 contains web services & other subroutines for producing
"RTN","SAMIHOM4",6,0)
 ; the ELCAP Home Page.
"RTN","SAMIHOM4",7,0)
 ;
"RTN","SAMIHOM4",8,0)
 quit  ; no entry from top
"RTN","SAMIHOM4",9,0)
 ;
"RTN","SAMIHOM4",10,0)
 ;
"RTN","SAMIHOM4",11,0)
 ;
"RTN","SAMIHOM4",12,0)
 ;@section 0 primary development
"RTN","SAMIHOM4",13,0)
 ;
"RTN","SAMIHOM4",14,0)
 ;
"RTN","SAMIHOM4",15,0)
 ;
"RTN","SAMIHOM4",16,0)
 ;@license see routine SAMIUL
"RTN","SAMIHOM4",17,0)
 ;@documentation see SAMIHUL
"RTN","SAMIHOM4",18,0)
 ;@contents
"RTN","SAMIHOM4",19,0)
 ;
"RTN","SAMIHOM4",20,0)
 ;  web service get vapals & related subroutines
"RTN","SAMIHOM4",21,0)
 ;
"RTN","SAMIHOM4",22,0)
 ; WSHOME code for wsi WSHOME^SAMIHOM3
"RTN","SAMIHOM4",23,0)
 ;    get vapals (vapals-elcap homepage)
"RTN","SAMIHOM4",24,0)
 ; DEVHOME code for wpi DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",25,0)
 ;    development home page
"RTN","SAMIHOM4",26,0)
 ; GETHOME code for wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",27,0)
 ;    get homepage (not subsequent visit)
"RTN","SAMIHOM4",28,0)
 ;
"RTN","SAMIHOM4",29,0)
 ;  web service post vapals & related subroutines
"RTN","SAMIHOM4",30,0)
 ;
"RTN","SAMIHOM4",31,0)
 ; WSVAPALS code for wsi WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",32,0)
 ;    post vapals (main gateway)
"RTN","SAMIHOM4",33,0)
 ;
"RTN","SAMIHOM4",34,0)
 ;  other
"RTN","SAMIHOM4",35,0)
 ;
"RTN","SAMIHOM4",36,0)
 ; REG manual registration
"RTN","SAMIHOM4",37,0)
 ; MKPTLK creates patient-lookup record
"RTN","SAMIHOM4",38,0)
 ; UPDTFRMS update demographics in all forms for patient
"RTN","SAMIHOM4",39,0)
 ; MERGE merge participant records
"RTN","SAMIHOM4",40,0)
 ; ADDUNMAT adds unmatched report web service to system
"RTN","SAMIHOM4",41,0)
 ; DELUNMAT deletes unmatched web service
"RTN","SAMIHOM4",42,0)
 ; WSUNMAT navigates to unmatched report
"RTN","SAMIHOM4",43,0)
 ; $$DUPSSN true if duplicate ssn
"RTN","SAMIHOM4",44,0)
 ; $$DUPICN true if duplicate icn
"RTN","SAMIHOM4",45,0)
 ; $$BADICN true if ICN checkdigits are wrong
"RTN","SAMIHOM4",46,0)
 ; SAVE save patient-lookup record after edit
"RTN","SAMIHOM4",47,0)
 ; $$REMATCH possible match ien
"RTN","SAMIHOM4",48,0)
 ; SETINFO set information message text
"RTN","SAMIHOM4",49,0)
 ; SETWARN set warning message text
"RTN","SAMIHOM4",50,0)
 ; RTNERR redisplay page w/error message
"RTN","SAMIHOM4",51,0)
 ; RTNPAGE display page
"RTN","SAMIHOM4",52,0)
 ; REINDXPL reindex patient lookup
"RTN","SAMIHOM4",53,0)
 ; INDXPTLK generate index entries in patient-lookup graph
"RTN","SAMIHOM4",54,0)
 ; UNINDXPT remove index entries from patient-lookup graph
"RTN","SAMIHOM4",55,0)
 ; $$UCASE uppercase
"RTN","SAMIHOM4",56,0)
 ; WSNEWCAS code for wr newcase (creates new case)
"RTN","SAMIHOM4",57,0)
 ;
"RTN","SAMIHOM4",58,0)
 ;@to-do
"RTN","SAMIHOM4",59,0)
 ; Add label comments
"RTN","SAMIHOM4",60,0)
 ;
"RTN","SAMIHOM4",61,0)
 ;
"RTN","SAMIHOM4",62,0)
 ;
"RTN","SAMIHOM4",63,0)
 ;@section 1 web service get vapals & related subroutines
"RTN","SAMIHOM4",64,0)
 ;
"RTN","SAMIHOM4",65,0)
 ;
"RTN","SAMIHOM4",66,0)
 ;
"RTN","SAMIHOM4",67,0)
 ;@wsi-code WSHOME^SAMIHOM3
"RTN","SAMIHOM4",68,0)
WSHOME ; get vapals (vapals-elcap homepage)
"RTN","SAMIHOM4",69,0)
 ;
"RTN","SAMIHOM4",70,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",71,0)
 ;
"RTN","SAMIHOM4",72,0)
 ;ven/gpl;wsi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",73,0)
 ;@signature
"RTN","SAMIHOM4",74,0)
 ; do WSHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",75,0)
 ;@branches-from
"RTN","SAMIHOM4",76,0)
 ; WSHOME^SAMIHOM3
"RTN","SAMIHOM4",77,0)
 ;@wsi-called-by
"RTN","SAMIHOM4",78,0)
 ; web service get vapals
"RTN","SAMIHOM4",79,0)
 ; WSVAPALS^SAMIHOM4
"RTN","SAMIHOM4",80,0)
 ; LOGIN^SAMISITE
"RTN","SAMIHOM4",81,0)
 ;@called-by none
"RTN","SAMIHOM4",82,0)
 ;@calls
"RTN","SAMIHOM4",83,0)
 ; DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",84,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",85,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",86,0)
 ;@input
"RTN","SAMIHOM4",87,0)
 ; SAMIFILTER (no parameters required)
"RTN","SAMIHOM4",88,0)
 ;@output
"RTN","SAMIHOM4",89,0)
 ; .SAMIRTN
"RTN","SAMIHOM4",90,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",91,0)
 ;@tests
"RTN","SAMIHOM4",92,0)
 ; UTWSHM^SAMIUTH3
"RTN","SAMIHOM4",93,0)
 ; UTWSHM1^SAMIUTH3
"RTN","SAMIHOM4",94,0)
 ; UTWSHM2^SAMIUTH3
"RTN","SAMIHOM4",95,0)
 ;
"RTN","SAMIHOM4",96,0)
 ;
"RTN","SAMIHOM4",97,0)
 ;@stanza 2 route to appropriate homepage or bypass to other webpage
"RTN","SAMIHOM4",98,0)
 ;
"RTN","SAMIHOM4",99,0)
 ; present development homepage for testing
"RTN","SAMIHOM4",100,0)
 if $get(SAMIFILTER("test"))=1 do  quit
"RTN","SAMIHOM4",101,0)
 . do DEVHOME^SAMIHOM3(.SAMIRTN,.SAMIFILTER)
"RTN","SAMIHOM4",102,0)
 . quit
"RTN","SAMIHOM4",103,0)
 ;
"RTN","SAMIHOM4",104,0)
 ; bypass for get access to pages
"RTN","SAMIHOM4",105,0)
 if $g(SAMIFILTER("samiroute"))'="" do  quit
"RTN","SAMIHOM4",106,0)
 . new SAMIBODY set SAMIBODY(1)=""
"RTN","SAMIHOM4",107,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIBODY,.SAMIRTN)
"RTN","SAMIHOM4",108,0)
 . quit
"RTN","SAMIHOM4",109,0)
 ;
"RTN","SAMIHOM4",110,0)
 ; V4W/DLW - bypass for get access from CPRS
"RTN","SAMIHOM4",111,0)
 if $get(SAMIFILTER("dfn"))'="" do  quit
"RTN","SAMIHOM4",112,0)
 . new dfn set dfn=$get(SAMIFILTER("dfn"))
"RTN","SAMIHOM4",113,0)
 . new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",114,0)
 . new studyid set studyid=$get(@root@(dfn,"samistudyid"))
"RTN","SAMIHOM4",115,0)
 . new SAMIBODY
"RTN","SAMIHOM4",116,0)
 . if studyid'="" do
"RTN","SAMIHOM4",117,0)
 . . set SAMIBODY(1)="samiroute=casereview&dfn="_dfn_"&studyid="_studyid
"RTN","SAMIHOM4",118,0)
 . . quit
"RTN","SAMIHOM4",119,0)
 . else  do
"RTN","SAMIHOM4",120,0)
 . . set SAMIBODY(1)="samiroute=lookup&dfn="_dfn_"&studyid="_studyid
"RTN","SAMIHOM4",121,0)
 . . quit
"RTN","SAMIHOM4",122,0)
 . do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIBODY,.SAMIRTN)
"RTN","SAMIHOM4",123,0)
 . quit
"RTN","SAMIHOM4",124,0)
 ;
"RTN","SAMIHOM4",125,0)
 ; default to VAPALS homepage
"RTN","SAMIHOM4",126,0)
 do GETHOME^SAMIHOM3(.SAMIRTN,.SAMIFILTER)
"RTN","SAMIHOM4",127,0)
 ;
"RTN","SAMIHOM4",128,0)
 ;
"RTN","SAMIHOM4",129,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",130,0)
 ;
"RTN","SAMIHOM4",131,0)
 quit  ; end of wsi WSHOME^SAMIHOM3
"RTN","SAMIHOM4",132,0)
 ;
"RTN","SAMIHOM4",133,0)
 ;
"RTN","SAMIHOM4",134,0)
 ;
"RTN","SAMIHOM4",135,0)
 ;@wpi-code DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",136,0)
DEVHOME ; development home page
"RTN","SAMIHOM4",137,0)
 ;
"RTN","SAMIHOM4",138,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",139,0)
 ;
"RTN","SAMIHOM4",140,0)
 ;ven/gpl;wpi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",141,0)
 ;@signature
"RTN","SAMIHOM4",142,0)
 ; do DEVHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",143,0)
 ;@branches-from
"RTN","SAMIHOM4",144,0)
 ; DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",145,0)
 ;@wpi-called-by
"RTN","SAMIHOM4",146,0)
 ; wsi WSHOME^SAMIHOM3 [web service get vapals]
"RTN","SAMIHOM4",147,0)
 ;@called-by none
"RTN","SAMIHOM4",148,0)
 ;@calls
"RTN","SAMIHOM4",149,0)
 ; htmltb2^%yottaweb
"RTN","SAMIHOM4",150,0)
 ; PATLIST^SAMIHOM3
"RTN","SAMIHOM4",151,0)
 ; genhtml^%yottautl
"RTN","SAMIHOM4",152,0)
 ; addary^%yottautl
"RTN","SAMIHOM4",153,0)
 ;@input
"RTN","SAMIHOM4",154,0)
 ; SAMIFILTER =
"RTN","SAMIHOM4",155,0)
 ;@output
"RTN","SAMIHOM4",156,0)
 ;.SAMIRTN =
"RTN","SAMIHOM4",157,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",158,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",159,0)
 ;
"RTN","SAMIHOM4",160,0)
 ;
"RTN","SAMIHOM4",161,0)
 ;@stanza 2 present development homepage
"RTN","SAMIHOM4",162,0)
 ;
"RTN","SAMIHOM4",163,0)
 new gtop,gbot
"RTN","SAMIHOM4",164,0)
 do htmltb2^%yottaweb(.gtop,.gbot,"SAMI Test Patients")
"RTN","SAMIHOM4",165,0)
 ;
"RTN","SAMIHOM4",166,0)
 new html,ary,hpat
"RTN","SAMIHOM4",167,0)
 do PATLIST^SAMIHOM3("hpat")
"RTN","SAMIHOM4",168,0)
 quit:'$data(hpat)
"RTN","SAMIHOM4",169,0)
 ;
"RTN","SAMIHOM4",170,0)
 set ary("title")="SAMI Test Patients on this system"
"RTN","SAMIHOM4",171,0)
 set ary("header",1)="StudyId"
"RTN","SAMIHOM4",172,0)
 set ary("header",2)="Name"
"RTN","SAMIHOM4",173,0)
 ;
"RTN","SAMIHOM4",174,0)
 new cnt set cnt=0
"RTN","SAMIHOM4",175,0)
 new zi set zi=""
"RTN","SAMIHOM4",176,0)
 for  do  quit:zi=""
"RTN","SAMIHOM4",177,0)
 . set zi=$order(hpat(zi))
"RTN","SAMIHOM4",178,0)
 . quit:zi=""
"RTN","SAMIHOM4",179,0)
 . ;
"RTN","SAMIHOM4",180,0)
 . set cnt=cnt+1
"RTN","SAMIHOM4",181,0)
 . new url set url="<a href=""/cform.cgi?studyId="_zi_""">"_zi_"</a>"
"RTN","SAMIHOM4",182,0)
 . set ary(cnt,1)=url
"RTN","SAMIHOM4",183,0)
 . set ary(cnt,2)=""
"RTN","SAMIHOM4",184,0)
 . quit
"RTN","SAMIHOM4",185,0)
 ;
"RTN","SAMIHOM4",186,0)
 do genhtml^%yottautl("html","ary")
"RTN","SAMIHOM4",187,0)
 ;
"RTN","SAMIHOM4",188,0)
 do addary^%yottautl("SAMIRTN","gtop")
"RTN","SAMIHOM4",189,0)
 do addary^%yottautl("SAMIRTN","html")
"RTN","SAMIHOM4",190,0)
 set SAMIRTN($order(SAMIRTN(""),-1)+1)=gbot
"RTN","SAMIHOM4",191,0)
 kill SAMIRTN(0)
"RTN","SAMIHOM4",192,0)
 ;
"RTN","SAMIHOM4",193,0)
 set HTTPRSP("mime")="text/html"
"RTN","SAMIHOM4",194,0)
 ;
"RTN","SAMIHOM4",195,0)
 ;
"RTN","SAMIHOM4",196,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",197,0)
 ;
"RTN","SAMIHOM4",198,0)
 quit  ; end of wpi DEVHOME^SAMIHOM3
"RTN","SAMIHOM4",199,0)
 ;
"RTN","SAMIHOM4",200,0)
 ;
"RTN","SAMIHOM4",201,0)
 ;
"RTN","SAMIHOM4",202,0)
 ;@wpi-code GETHOME^SAMIHOM3
"RTN","SAMIHOM4",203,0)
GETHOME ; get homepage (not subsequent visit)
"RTN","SAMIHOM4",204,0)
 ;
"RTN","SAMIHOM4",205,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",206,0)
 ;
"RTN","SAMIHOM4",207,0)
 ;ven/gpl;wpi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",208,0)
 ;@signature
"RTN","SAMIHOM4",209,0)
 ; do GETHOME^SAMIHOM3(SAMIRTN,SAMIFILTER)
"RTN","SAMIHOM4",210,0)
 ;@branches-from
"RTN","SAMIHOM4",211,0)
 ; GETHOME^SAMIHOM3
"RTN","SAMIHOM4",212,0)
 ;@wpi-called-by
"RTN","SAMIHOM4",213,0)
 ; WSHOME
"RTN","SAMIHOM4",214,0)
 ; WSVAPALS
"RTN","SAMIHOM4",215,0)
 ; SAVE
"RTN","SAMIHOM4",216,0)
 ;  WSNEWCAS [commented out]
"RTN","SAMIHOM4",217,0)
 ; WSNFPOST^SAMICAS3
"RTN","SAMIHOM4",218,0)
 ; WSLOOKUP^SAMISRC2
"RTN","SAMIHOM4",219,0)
 ; WSREPORT^SAMIUR
"RTN","SAMIHOM4",220,0)
 ; WSREPORT^SAMIUR1
"RTN","SAMIHOM4",221,0)
 ;@called-by none
"RTN","SAMIHOM4",222,0)
 ;@calls
"RTN","SAMIHOM4",223,0)
 ; $$FINDSITE^SAMISITE
"RTN","SAMIHOM4",224,0)
 ; GETTMPL^SAMICASE
"RTN","SAMIHOM4",225,0)
 ; MERGEHTM^%wf
"RTN","SAMIHOM4",226,0)
 ; ADDCRLF^VPRJRUT
"RTN","SAMIHOM4",227,0)
 ;@input
"RTN","SAMIHOM4",228,0)
 ; SAMIFILTER
"RTN","SAMIHOM4",229,0)
 ;@output
"RTN","SAMIHOM4",230,0)
 ; .SAMIRTN
"RTN","SAMIHOM4",231,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",232,0)
 ;@tests
"RTN","SAMIHOM4",233,0)
 ; UTGETHM^SAMIUTH3
"RTN","SAMIHOM4",234,0)
 ; UTSCAN4^SAMIUTH3
"RTN","SAMIHOM4",235,0)
 ;
"RTN","SAMIHOM4",236,0)
 ;
"RTN","SAMIHOM4",237,0)
 ;@stanza 2 get template for homepage
"RTN","SAMIHOM4",238,0)
 ;
"RTN","SAMIHOM4",239,0)
 ; Processing for multi-tenancy
"RTN","SAMIHOM4",240,0)
 ;
"RTN","SAMIHOM4",241,0)
 if $get(SAMIFILTER("siteid"))="" if '$$FINDSITE^SAMISITE(.SAMIRTN,.SAMIFILTER) quit 0
"RTN","SAMIHOM4",242,0)
 new SAMISITE,SAMITITL
"RTN","SAMIHOM4",243,0)
 set SAMISITE=$get(SAMIFILTER("siteid"))
"RTN","SAMIHOM4",244,0)
 set SAMITITL=$get(SAMIFILTER("sitetitle"))
"RTN","SAMIHOM4",245,0)
 ;
"RTN","SAMIHOM4",246,0)
 new temp,tout,form
"RTN","SAMIHOM4",247,0)
 set form="vapals:home"
"RTN","SAMIHOM4",248,0)
 do GETTMPL^SAMICASE("temp",form)
"RTN","SAMIHOM4",249,0)
 quit:'$data(temp)
"RTN","SAMIHOM4",250,0)
 ;
"RTN","SAMIHOM4",251,0)
 ;
"RTN","SAMIHOM4",252,0)
 ;@stanza 3 process homepage template
"RTN","SAMIHOM4",253,0)
 ;
"RTN","SAMIHOM4",254,0)
 new err
"RTN","SAMIHOM4",255,0)
 do MERGEHTM^%wf(.temp,.SAMIFILTER,.err)
"RTN","SAMIHOM4",256,0)
 ;
"RTN","SAMIHOM4",257,0)
 do ADDCRLF^VPRJRUT(.temp)
"RTN","SAMIHOM4",258,0)
 merge SAMIRTN=temp
"RTN","SAMIHOM4",259,0)
 ;
"RTN","SAMIHOM4",260,0)
 ;
"RTN","SAMIHOM4",261,0)
 ;@stanza 4 termination
"RTN","SAMIHOM4",262,0)
 ;
"RTN","SAMIHOM4",263,0)
 quit  ; end of wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",264,0)
 ;
"RTN","SAMIHOM4",265,0)
 ;
"RTN","SAMIHOM4",266,0)
 ;
"RTN","SAMIHOM4",267,0)
 ; below is redacted from GETHOME^SAMIHOM3
"RTN","SAMIHOM4",268,0)
 ;
"RTN","SAMIHOM4",269,0)
 ;@old-calls
"RTN","SAMIHOM4",270,0)
 ; FIXHREF^SAMIFORM
"RTN","SAMIHOM4",271,0)
 ; FIXSRC^SAMIFORM
"RTN","SAMIHOM4",272,0)
 ; $$GET^XPAR
"RTN","SAMIHOM4",273,0)
 ; findReplace^%ts
"RTN","SAMIHOM4",274,0)
 ; ADDCRLF^VPRJRUT
"RTN","SAMIHOM4",275,0)
 ;
"RTN","SAMIHOM4",276,0)
 new cnt set cnt=0
"RTN","SAMIHOM4",277,0)
 new zi set zi=0
"RTN","SAMIHOM4",278,0)
 for  set zi=$order(temp(zi)) quit:+zi=0  do  ;
"RTN","SAMIHOM4",279,0)
 . ;
"RTN","SAMIHOM4",280,0)
 . n ln s ln=temp(zi)
"RTN","SAMIHOM4",281,0)
 . n touched s touched=0
"RTN","SAMIHOM4",282,0)
 . ;
"RTN","SAMIHOM4",283,0)
 . i ln["href" i 'touched d  ;
"RTN","SAMIHOM4",284,0)
 . . d FIXHREF^SAMIFORM(.ln)
"RTN","SAMIHOM4",285,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",286,0)
 . ;
"RTN","SAMIHOM4",287,0)
 . i ln["src" d  ;
"RTN","SAMIHOM4",288,0)
 . . d FIXSRC^SAMIFORM(.ln)
"RTN","SAMIHOM4",289,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",290,0)
 . ;
"RTN","SAMIHOM4",291,0)
 . i ln["id" i ln["studyIdMenu" d  ;
"RTN","SAMIHOM4",292,0)
 . . s zi=zi+4
"RTN","SAMIHOM4",293,0)
 . ;
"RTN","SAMIHOM4",294,0)
 . if ln["@@MANUALREGISTRATION@@" do  ; turn off manual registration
"RTN","SAMIHOM4",295,0)
 . . n setman,setparm
"RTN","SAMIHOM4",296,0)
 . . s setman="true"
"RTN","SAMIHOM4",297,0)
 . . s setparm=$$GET^XPAR("SYS","SAMI ALLOW MANUAL ENTRY",,"Q")
"RTN","SAMIHOM4",298,0)
 . . i setparm=0 s setman="false"
"RTN","SAMIHOM4",299,0)
 . . do findReplace^%ts(.ln,"@@MANUALREGISTRATION@@",setman)
"RTN","SAMIHOM4",300,0)
 . . s temp(zi)=ln
"RTN","SAMIHOM4",301,0)
 . . quit 
"RTN","SAMIHOM4",302,0)
 . set cnt=cnt+1
"RTN","SAMIHOM4",303,0)
 . set tout(cnt)=temp(zi)
"RTN","SAMIHOM4",304,0)
 . quit
"RTN","SAMIHOM4",305,0)
 ;
"RTN","SAMIHOM4",306,0)
 ;
"RTN","SAMIHOM4",307,0)
 ;@old-stanza 4 add cr/lf & save to return array
"RTN","SAMIHOM4",308,0)
 ;
"RTN","SAMIHOM4",309,0)
 do ADDCRLF^VPRJRUT(.tout)
"RTN","SAMIHOM4",310,0)
 merge SAMIRTN=tout
"RTN","SAMIHOM4",311,0)
 ;
"RTN","SAMIHOM4",312,0)
 ;
"RTN","SAMIHOM4",313,0)
 ;@old-stanza 5 termination
"RTN","SAMIHOM4",314,0)
 ;
"RTN","SAMIHOM4",315,0)
 quit  ; old end of wpi GETHOME^SAMIHOM3
"RTN","SAMIHOM4",316,0)
 ;
"RTN","SAMIHOM4",317,0)
 ;
"RTN","SAMIHOM4",318,0)
 ;
"RTN","SAMIHOM4",319,0)
 ;@section 2 web service post vapals & related subroutines
"RTN","SAMIHOM4",320,0)
 ;
"RTN","SAMIHOM4",321,0)
 ;
"RTN","SAMIHOM4",322,0)
 ;
"RTN","SAMIHOM4",323,0)
 ;@wsi-code WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",324,0)
WSVAPALS ; post vapals (main gateway)
"RTN","SAMIHOM4",325,0)
 ;
"RTN","SAMIHOM4",326,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",327,0)
 ;
"RTN","SAMIHOM4",328,0)
 ;ven/gpl;wsi;procedure;clean;silent;sac;tests
"RTN","SAMIHOM4",329,0)
 ;@signature
"RTN","SAMIHOM4",330,0)
 ; do WSVAPALS^SAMIHOM3(SAMIARG,SAMIBODY,SAMIRESULT)
"RTN","SAMIHOM4",331,0)
 ;@branches-from
"RTN","SAMIHOM4",332,0)
 ; WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",333,0)
 ;@wsi-called-by
"RTN","SAMIHOM4",334,0)
 ;@called-by
"RTN","SAMIHOM4",335,0)
 ;@calls
"RTN","SAMIHOM4",336,0)
 ;@input [tbd]
"RTN","SAMIHOM4",337,0)
 ;@output [tbd]
"RTN","SAMIHOM4",338,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",339,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",340,0)
 ;
"RTN","SAMIHOM4",341,0)
 ; all calls come through this gateway
"RTN","SAMIHOM4",342,0)
 ;
"RTN","SAMIHOM4",343,0)
 k ^SAMIUL("vapals")
"RTN","SAMIHOM4",344,0)
 m ^SAMIUL("vapals")=SAMIARG
"RTN","SAMIHOM4",345,0)
 m ^SAMIUL("vapals","BODY")=SAMIBODY
"RTN","SAMIHOM4",346,0)
 ;
"RTN","SAMIHOM4",347,0)
 new vars,SAMIBDY
"RTN","SAMIHOM4",348,0)
 set SAMIBDY=$get(SAMIBODY(1))
"RTN","SAMIHOM4",349,0)
 do parseBody^%wf("vars",.SAMIBDY)
"RTN","SAMIHOM4",350,0)
 m vars=SAMIARG
"RTN","SAMIHOM4",351,0)
 i $g(vars("siteid"))'="" d  ;
"RTN","SAMIHOM4",352,0)
 . i $g(vars("site"))'=$g(vars("siteid")) s vars("site")=$g(vars("siteid"))
"RTN","SAMIHOM4",353,0)
 m SAMIARG=vars
"RTN","SAMIHOM4",354,0)
 m SAMIARG=SAMIBODY
"RTN","SAMIHOM4",355,0)
 ;
"RTN","SAMIHOM4",356,0)
 ; Processing for multi-tenancy
"RTN","SAMIHOM4",357,0)
 ;
"RTN","SAMIHOM4",358,0)
 if '$d(vars("siteid")) d  ;
"RTN","SAMIHOM4",359,0)
 . if $g(vars("studyid"))="" q
"RTN","SAMIHOM4",360,0)
 . n sym s sym=$e(vars("studyid"),1,3) ; first 3 chars in studyid
"RTN","SAMIHOM4",361,0)
 . i $$SITENM2^SAMISITE(sym)=-1 q
"RTN","SAMIHOM4",362,0)
 . s vars("siteid")=sym
"RTN","SAMIHOM4",363,0)
 . s vars("site")=sym
"RTN","SAMIHOM4",364,0)
 ;
"RTN","SAMIHOM4",365,0)
 if $G(vars("site"))'="" d  ;
"RTN","SAMIHOM4",366,0)
 . n siteid s siteid=vars("site")
"RTN","SAMIHOM4",367,0)
 . s SAMIARG("siteid")=siteid
"RTN","SAMIHOM4",368,0)
 . s SAMIARG("sitetitle")=$$SITENM2^SAMISITE(siteid)_" - "_siteid
"RTN","SAMIHOM4",369,0)
 k ^gpl("siteselect")
"RTN","SAMIHOM4",370,0)
 m ^gpl("siteselect")=SAMIARG
"RTN","SAMIHOM4",371,0)
 m ^gpl("siteselect","vars")=vars
"RTN","SAMIHOM4",372,0)
 if $G(SAMIARG("siteid"))="" if '$$FINDSITE^SAMISITE(.SAMIRESULT,.SAMIARG) Q 0
"RTN","SAMIHOM4",373,0)
 new SAMISITE,SAMITITL
"RTN","SAMIHOM4",374,0)
 s SAMISITE=$G(SAMIARG("siteid"))
"RTN","SAMIHOM4",375,0)
 i $G(SAMIARG("sitetitle"))="" d  ;
"RTN","SAMIHOM4",376,0)
 . s SAMIARG("sitetitle")=$$SITENM2^SAMISITE(SAMISITE)_" - "_SAMISITE
"RTN","SAMIHOM4",377,0)
 s SAMITITL=$G(SAMIARG("sitetitle"))
"RTN","SAMIHOM4",378,0)
 m vars=SAMIARG
"RTN","SAMIHOM4",379,0)
 ;
"RTN","SAMIHOM4",380,0)
 k ^SAMIUL("vapals","vars")
"RTN","SAMIHOM4",381,0)
 merge ^SAMIUL("vapals","vars")=vars
"RTN","SAMIHOM4",382,0)
 merge ^SAMIUL("vapals","vars")=SAMIBODY
"RTN","SAMIHOM4",383,0)
 ;
"RTN","SAMIHOM4",384,0)
 n route s route=$g(vars("samiroute"))
"RTN","SAMIHOM4",385,0)
 i route=""  d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",386,0)
 ;
"RTN","SAMIHOM4",387,0)
 i route="lookup" d  q 0
"RTN","SAMIHOM4",388,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",389,0)
 . d WSLOOKUP^SAMISRC2(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",390,0)
 ;
"RTN","SAMIHOM4",391,0)
 i route="login" d  q 0
"RTN","SAMIHOM4",392,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",393,0)
 . d LOGIN^SAMISITE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",394,0)
 ;
"RTN","SAMIHOM4",395,0)
 i route="home" d  q 0
"RTN","SAMIHOM4",396,0)
 . k ^gpl("home")
"RTN","SAMIHOM4",397,0)
 . m ^gpl("home")=SAMIARG
"RTN","SAMIHOM4",398,0)
 . s SAMIARG("samiroute")=""
"RTN","SAMIHOM4",399,0)
 . d WSHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",400,0)
 ;
"RTN","SAMIHOM4",401,0)
 i route="logout" d  q 0
"RTN","SAMIHOM4",402,0)
 . ;s SAMIARG("samiroute")="home"
"RTN","SAMIHOM4",403,0)
 . ;do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIARG,.SAMIRESULT)
"RTN","SAMIHOM4",404,0)
 . ;Q
"RTN","SAMIHOM4",405,0)
 . s SAMIARG("sitetitle")="Unknown Site"
"RTN","SAMIHOM4",406,0)
 . s SAMIARG("siteid")=""
"RTN","SAMIHOM4",407,0)
 . s SAMIARG("errorMessage")=""
"RTN","SAMIHOM4",408,0)
 . d RTNERR^SAMIHOM4(.SAMIRESULT,"vapals:login",.SAMIARG)
"RTN","SAMIHOM4",409,0)
 ;
"RTN","SAMIHOM4",410,0)
 i route="newcase" d  q 0
"RTN","SAMIHOM4",411,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",412,0)
 . d WSNEWCAS^SAMIHOM3(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",413,0)
 ;
"RTN","SAMIHOM4",414,0)
 i route="casereview" d  q 0
"RTN","SAMIHOM4",415,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",416,0)
 . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",417,0)
 ;
"RTN","SAMIHOM4",418,0)
 i route="nuform" d  q 0
"RTN","SAMIHOM4",419,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",420,0)
 . d WSNUFORM^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",421,0)
 ;
"RTN","SAMIHOM4",422,0)
 i route="addform" d  q 0
"RTN","SAMIHOM4",423,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",424,0)
 . d WSNFPOST^SAMICASE(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",425,0)
 ;
"RTN","SAMIHOM4",426,0)
 i route="form" d  q 0
"RTN","SAMIHOM4",427,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",428,0)
 . d wsGetForm^%wf(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",429,0)
 ;
"RTN","SAMIHOM4",430,0)
 i route="postform" d  q 0
"RTN","SAMIHOM4",431,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",432,0)
 . d wsPostForm^%wf(.SAMIARG,.SAMIBODY,.SAMIRESULT)
"RTN","SAMIHOM4",433,0)
 . i $g(SAMIARG("form"))["siform" d  ;
"RTN","SAMIHOM4",434,0)
 . . n notr s notr=0 ; note return 0 if failure, 1 or greater if success
"RTN","SAMIHOM4",435,0)
 . . ; returns the ien of the note that was created and should be sent
"RTN","SAMIHOM4",436,0)
 . . s notr=$$NOTE^SAMINOT1(.SAMIARG)
"RTN","SAMIHOM4",437,0)
 . . if +notr>0 d  ;
"RTN","SAMIHOM4",438,0)
 . . . n SAMIFILTER
"RTN","SAMIHOM4",439,0)
 . . . s SAMIFILTER("sid")=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",440,0)
 . . . s SAMIFILTER("key")=$g(SAMIARG("form")) ;
"RTN","SAMIHOM4",441,0)
 . . . n tiuien
"RTN","SAMIHOM4",442,0)
 . . . s tiuien=+notr
"RTN","SAMIHOM4",443,0)
 . . . s SAMIFILTER("notenmbr")=tiuien
"RTN","SAMIHOM4",444,0)
 . . . n sendrslt
"RTN","SAMIHOM4",445,0)
 . . . ;s sendrslt="1^MSG9239010"
"RTN","SAMIHOM4",446,0)
 . . . s sendrslt=$$EN^SAMIORU(.SAMIFILTER) ; send the note to VistA
"RTN","SAMIHOM4",447,0)
 . . . i +sendrslt>0 d  ; success
"RTN","SAMIHOM4",448,0)
 . . . . n rtnid s rtnid=$p(sendrslt,"^",2) ; return id from HL7
"RTN","SAMIHOM4",449,0)
 . . . . ; post the id to the graph here
"RTN","SAMIHOM4",450,0)
 . . . . n sid s sid=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",451,0)
 . . . . n form s form=$G(SAMIARG("form"))
"RTN","SAMIHOM4",452,0)
 . . . . n nien s nien=$$NTIEN^SAMINOT1(sid,form) ; latest note ien
"RTN","SAMIHOM4",453,0)
 . . . . n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",454,0)
 . . . . s @root@("graph",sid,form,"notes",nien,"hl7id")=rtnid
"RTN","SAMIHOM4",455,0)
 . . . . s SAMIARG("errorMessage")="Note successfully sent to VistA ID: "_rtnid
"RTN","SAMIHOM4",456,0)
 . . . else  d  ;
"RTN","SAMIHOM4",457,0)
 . . . . n rtnmsg s rtnmsg=$p(sendrslt,"^",2)
"RTN","SAMIHOM4",458,0)
 . . . . s SAMIARG("errorMessage")=rtnmsg
"RTN","SAMIHOM4",459,0)
 . . . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",460,0)
 . i $g(SAMIARG("form"))["fuform" d  ;
"RTN","SAMIHOM4",461,0)
 . . n notr s notr=0 ; note return 0 if failure, 1 or greater if success
"RTN","SAMIHOM4",462,0)
 . . ; returns the ien of the note that was created and should be sent
"RTN","SAMIHOM4",463,0)
 . . s notr=$$NOTE^SAMINOT2(.SAMIARG)
"RTN","SAMIHOM4",464,0)
 . . if +notr>0 d  ;
"RTN","SAMIHOM4",465,0)
 . . . n SAMIFILTER
"RTN","SAMIHOM4",466,0)
 . . . s SAMIFILTER("sid")=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",467,0)
 . . . s SAMIFILTER("key")=$g(SAMIARG("form")) ;
"RTN","SAMIHOM4",468,0)
 . . . n tiuien
"RTN","SAMIHOM4",469,0)
 . . . s tiuien=+notr
"RTN","SAMIHOM4",470,0)
 . . . s SAMIFILTER("notenmbr")=tiuien
"RTN","SAMIHOM4",471,0)
 . . . n sendrslt
"RTN","SAMIHOM4",472,0)
 . . . ;s sendrslt="0^Missing ORM Message"
"RTN","SAMIHOM4",473,0)
 . . . s sendrslt=$$EN^SAMIORU(.SAMIFILTER) ; send the note to VistA
"RTN","SAMIHOM4",474,0)
 . . . i +sendrslt>0 d  ; success
"RTN","SAMIHOM4",475,0)
 . . . . n rtnid s rtnid=$p(sendrslt,"^",2) ; return id from HL7
"RTN","SAMIHOM4",476,0)
 . . . . ; post the id to the graph here
"RTN","SAMIHOM4",477,0)
 . . . . n sid s sid=$G(SAMIARG("studyid"))
"RTN","SAMIHOM4",478,0)
 . . . . n form s form=$G(SAMIARG("form"))
"RTN","SAMIHOM4",479,0)
 . . . . n nien s nien=$$NTIEN^SAMINOT1(sid,form) ; latest note ien
"RTN","SAMIHOM4",480,0)
 . . . . n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",481,0)
 . . . . s @root@("graph",sid,form,"notes",nien,"hl7id")=rtnid
"RTN","SAMIHOM4",482,0)
 . . . . s SAMIARG("errorMessage")="Note successfully sent to VistA ID: "_rtnid
"RTN","SAMIHOM4",483,0)
 . . . else  d  ;
"RTN","SAMIHOM4",484,0)
 . . . . n rtnmsg s rtnmsg=$p(sendrslt,"^",2)
"RTN","SAMIHOM4",485,0)
 . . . . i $g(SAMIARG("errorMessage"))="" d  ;
"RTN","SAMIHOM4",486,0)
 . . . . . s SAMIARG("errorMessage")=rtnmsg
"RTN","SAMIHOM4",487,0)
 . . . d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",488,0)
 . . e  d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",489,0)
 . e  d WSCASE^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",490,0)
 ;
"RTN","SAMIHOM4",491,0)
 i route="deleteform" d  q 0
"RTN","SAMIHOM4",492,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",493,0)
 . d DELFORM^SAMICASE(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",494,0)
 ;
"RTN","SAMIHOM4",495,0)
 i route="ctreport" d  q 0
"RTN","SAMIHOM4",496,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",497,0)
 . n format s format="html"
"RTN","SAMIHOM4",498,0)
 . s format="text"
"RTN","SAMIHOM4",499,0)
 . i format="text" d WSNOTE^SAMINOT3(.SAMIRESULT,.SAMIARG) q  ;
"RTN","SAMIHOM4",500,0)
 . i format="html" d WSREPORT^SAMICTR0(.SAMIRESULT,.SAMIARG) q  ;
"RTN","SAMIHOM4",501,0)
 . ;d wsReport^SAMICTRT(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",502,0)
 ;
"RTN","SAMIHOM4",503,0)
 i route="note" d  q 0
"RTN","SAMIHOM4",504,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",505,0)
 . d WSNOTE^SAMINOT1(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",506,0)
 ;
"RTN","SAMIHOM4",507,0)
 i route="report" d  q 0
"RTN","SAMIHOM4",508,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",509,0)
 . d WSREPORT^SAMIUR(.SAMIRESULT,.vars)
"RTN","SAMIHOM4",510,0)
 ;
"RTN","SAMIHOM4",511,0)
 i route="addperson" d  q 0
"RTN","SAMIHOM4",512,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",513,0)
 . n form
"RTN","SAMIHOM4",514,0)
 . s form="vapals:addperson"
"RTN","SAMIHOM4",515,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",516,0)
 ;
"RTN","SAMIHOM4",517,0)
 i route="editperson" d  q 0
"RTN","SAMIHOM4",518,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",519,0)
 . n dfn s dfn=$g(vars("dfn")) ; must have a dfn
"RTN","SAMIHOM4",520,0)
 . i dfn="" d  q  ;
"RTN","SAMIHOM4",521,0)
 . . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",522,0)
 . n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",523,0)
 . n sien s sien=$o(@root@("dfn",dfn,""))
"RTN","SAMIHOM4",524,0)
 . i sien="" d  q  ;
"RTN","SAMIHOM4",525,0)
 . . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home
"RTN","SAMIHOM4",526,0)
 . s vars("name")=$g(@root@(sien,"saminame"))
"RTN","SAMIHOM4",527,0)
 . s tdob=$g(@root@(sien,"dob"))
"RTN","SAMIHOM4",528,0)
 . s vars("dob")=$p(tdob,"-",2)_"/"_$p(tdob,"-",3)_"/"_$p(tdob,"-",1)
"RTN","SAMIHOM4",529,0)
 . s vars("sbdob")=$g(@root@(sien,"dob"))
"RTN","SAMIHOM4",530,0)
 . s vars("gender")=$g(@root@(sien,"sex"))
"RTN","SAMIHOM4",531,0)
 . ; s vars("icn")=$g(@root@(sien,"icn"))
"RTN","SAMIHOM4",532,0)
 . n tssn s tssn=$g(@root@(sien,"ssn"))
"RTN","SAMIHOM4",533,0)
 . s vars("ssn")=$e(tssn,1,3)_"-"_$e(tssn,4,5)_"-"_$e(tssn,6,9)
"RTN","SAMIHOM4",534,0)
 . s vars("last5")=$g(@root@(sien,"last5"))
"RTN","SAMIHOM4",535,0)
 . s vars("dfn")=$g(@root@(sien,"dfn"))
"RTN","SAMIHOM4",536,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",537,0)
 . n form,err,zhtml
"RTN","SAMIHOM4",538,0)
 . s form="vapals:editparticipant"
"RTN","SAMIHOM4",539,0)
 . d RTNPAGE^SAMIHOM4(.SAMIRESULT,form,.SAMIARG) q  ;
"RTN","SAMIHOM4",540,0)
 ;
"RTN","SAMIHOM4",541,0)
 i route="register" d  q 0
"RTN","SAMIHOM4",542,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",543,0)
 . d REG^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",544,0)
 ; 
"RTN","SAMIHOM4",545,0)
 i route="editsave" d  q 0
"RTN","SAMIHOM4",546,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",547,0)
 . d SAVE^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",548,0)
 ;
"RTN","SAMIHOM4",549,0)
 i route="merge" d  q 0
"RTN","SAMIHOM4",550,0)
 . m SAMIARG=vars
"RTN","SAMIHOM4",551,0)
 . d MERGE^SAMIHOM4(.SAMIRESULT,.SAMIARG)
"RTN","SAMIHOM4",552,0)
 ;
"RTN","SAMIHOM4",553,0)
 quit 0  ; end of wsi WSVAPALS^SAMIHOM3
"RTN","SAMIHOM4",554,0)
 ;
"RTN","SAMIHOM4",555,0)
 ;
"RTN","SAMIHOM4",556,0)
 ;
"RTN","SAMIHOM4",557,0)
 ;@section 3 other
"RTN","SAMIHOM4",558,0)
 ;
"RTN","SAMIHOM4",559,0)
 ;
"RTN","SAMIHOM4",560,0)
 ;
"RTN","SAMIHOM4",561,0)
REG(SAMIRTN,SAMIARG) ; manual registration
"RTN","SAMIHOM4",562,0)
 ;
"RTN","SAMIHOM4",563,0)
 n name s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",564,0)
 ;
"RTN","SAMIHOM4",565,0)
 m ^gpl("reg")=SAMIARG
"RTN","SAMIHOM4",566,0)
 n ssn s ssn=SAMIARG("ssn")
"RTN","SAMIHOM4",567,0)
 s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",568,0)
 s SAMIARG("errorMessage")=""
"RTN","SAMIHOM4",569,0)
 s SAMIARG("errorField")=""
"RTN","SAMIHOM4",570,0)
 ; test for duplicate ssn
"RTN","SAMIHOM4",571,0)
 ;
"RTN","SAMIHOM4",572,0)
 ;i $$DUPSSN(ssn) d  ;
"RTN","SAMIHOM4",573,0)
 ;. ;s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate SSN."
"RTN","SAMIHOM4",574,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate SSN error. A person with that SSN is already entered in the system."
"RTN","SAMIHOM4",575,0)
 ;. s SAMIARG("errorField")="ssn"
"RTN","SAMIHOM4",576,0)
 ;
"RTN","SAMIHOM4",577,0)
 ; test for duplicate icn
"RTN","SAMIHOM4",578,0)
 ;
"RTN","SAMIHOM4",579,0)
 ;n icn s icn=$g(SAMIARG("icn"))
"RTN","SAMIHOM4",580,0)
 ;i icn'="" i $$DUPICN(icn) d  ;
"RTN","SAMIHOM4",581,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Duplicate ICN error. A person with that ICN is already entered in the system."
"RTN","SAMIHOM4",582,0)
 ;. s SAMIARG("errorField")="icn"
"RTN","SAMIHOM4",583,0)
 ;;
"RTN","SAMIHOM4",584,0)
 ;; test for wellformed ICN
"RTN","SAMIHOM4",585,0)
 ;;
"RTN","SAMIHOM4",586,0)
 ;i icn'="" i $$BADICN(icn) d  ;
"RTN","SAMIHOM4",587,0)
 ;. s SAMIARG("errorMessage")=SAMIARG("errorMessage")_" Invalid ICN error. The check digits in the ICN do not match"
"RTN","SAMIHOM4",588,0)
 ;. s SAMIARG("errorField")="icn"
"RTN","SAMIHOM4",589,0)
 ;;
"RTN","SAMIHOM4",590,0)
 ; if there is an error, send back to edit with error message
"RTN","SAMIHOM4",591,0)
 i $g(SAMIARG("errorMessage"))'="" d  q  ;
"RTN","SAMIHOM4",592,0)
 . n form
"RTN","SAMIHOM4",593,0)
 . s form="vapals:addperson"
"RTN","SAMIHOM4",594,0)
 . d RTNERR(.SAMIRESULT,form,.SAMIARG)
"RTN","SAMIHOM4",595,0)
 ;
"RTN","SAMIHOM4",596,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",597,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",598,0)
 n ptlkien s ptlkien=""
"RTN","SAMIHOM4",599,0)
 n dfn s dfn=""
"RTN","SAMIHOM4",600,0)
 n sien s sien=""
"RTN","SAMIHOM4",601,0)
 i ptlkien="" s ptlkien=$o(@root@("AAAAAA"),-1)+1
"RTN","SAMIHOM4",602,0)
 n zm
"RTN","SAMIHOM4",603,0)
 k SAMIARG("MATCHLOG")
"RTN","SAMIHOM4",604,0)
 s zm=$$REMATCH(sien,.SAMIARG)
"RTN","SAMIHOM4",605,0)
 i zm>0 d  ;
"RTN","SAMIHOM4",606,0)
 . s SAMIARG("MATCHLOG")=zm
"RTN","SAMIHOM4",607,0)
 d MKPTLK(ptlkien,.SAMIARG) ; make the patient-lookup record
"RTN","SAMIHOM4",608,0)
 ;
"RTN","SAMIHOM4",609,0)
 s dfn=$o(@root@("dfn"," "),-1)+1
"RTN","SAMIHOM4",610,0)
 n pdfn
"RTN","SAMIHOM4",611,0)
 s pdfn=$o(@proot@("dfn"," "),-1)+1
"RTN","SAMIHOM4",612,0)
 i pdfn>dfn s dfn=pdfn ; need a dfn that has not been used
"RTN","SAMIHOM4",613,0)
 i dfn<9000001 s dfn=9000001
"RTN","SAMIHOM4",614,0)
 s @root@(ptlkien,"dfn")=dfn
"RTN","SAMIHOM4",615,0)
 d INDXPTLK(ptlkien)
"RTN","SAMIHOM4",616,0)
 s SAMIFILTER("samiroute")="addperson"
"RTN","SAMIHOM4",617,0)
 s SAMIFILTER("siteid")=$G(SAMIARG("siteid"))
"RTN","SAMIHOM4",618,0)
 s SAMIFILTER("sitetitle")=$G(SAMIARG("sitetitle"))
"RTN","SAMIHOM4",619,0)
 k SAMIARG ; return to a blank manual registration form
"RTN","SAMIHOM4",620,0)
 s SAMIARG("siteid")=$G(SAMIFILTER("siteid"))
"RTN","SAMIHOM4",621,0)
 s SAMIARG("sitetitle")=$G(SAMIFILTER("sitetitle"))
"RTN","SAMIHOM4",622,0)
 d SETINFO(.SAMIFILTER,name_" was successfully entered")
"RTN","SAMIHOM4",623,0)
 ;d SETWARN(.SAMIFILTER,"We might want to give you a warning")
"RTN","SAMIHOM4",624,0)
 do WSVAPALS^SAMIHOM3(.SAMIFILTER,.SAMIARG,.SAMIRESULT)
"RTN","SAMIHOM4",625,0)
 ;
"RTN","SAMIHOM4",626,0)
 quit  ; end of REG
"RTN","SAMIHOM4",627,0)
 ;
"RTN","SAMIHOM4",628,0)
 ;
"RTN","SAMIHOM4",629,0)
 ;
"RTN","SAMIHOM4",630,0)
MKPTLK(ptlkien,SAMIARG) ; creates patient-lookup record
"RTN","SAMIHOM4",631,0)
 ;
"RTN","SAMIHOM4",632,0)
 n ssn s ssn=SAMIARG("ssn")
"RTN","SAMIHOM4",633,0)
 s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",634,0)
 n name s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",635,0)
 n sinamef,sinamel
"RTN","SAMIHOM4",636,0)
 s sinamel=$p(name,","),sinamel=$$TRIM^XLFSTR(sinamel,"LR")
"RTN","SAMIHOM4",637,0)
 s sinamef=$p(name,",",2),sinamef=$$TRIM^XLFSTR(sinamef,"LR")
"RTN","SAMIHOM4",638,0)
 s name=sinamel_","_sinamef
"RTN","SAMIHOM4",639,0)
 n siteid s siteid=$g(SAMIARG("siteid"))
"RTN","SAMIHOM4",640,0)
 i siteid="" s siteid=$g(SAMIARG("site"))
"RTN","SAMIHOM4",641,0)
 ;
"RTN","SAMIHOM4",642,0)
 s @root@(ptlkien,"siteid")=siteid
"RTN","SAMIHOM4",643,0)
 s @root@(ptlkien,"saminame")=name
"RTN","SAMIHOM4",644,0)
 s @root@(ptlkien,"sinamef")=sinamef
"RTN","SAMIHOM4",645,0)
 s @root@(ptlkien,"sinamel")=sinamel
"RTN","SAMIHOM4",646,0)
 n fmdob s fmdob=$$FMDT^SAMIUR2(SAMIARG("dob"))
"RTN","SAMIHOM4",647,0)
 n ptlkdob s ptlkdob=$$FMTE^XLFDT(fmdob,7)
"RTN","SAMIHOM4",648,0)
 s ptlkdob=$TR(ptlkdob,"/","-")
"RTN","SAMIHOM4",649,0)
 s @root@(ptlkien,"dob")=ptlkdob
"RTN","SAMIHOM4",650,0)
 s @root@(ptlkien,"sbdob")=ptlkdob
"RTN","SAMIHOM4",651,0)
 n gender s gender=SAMIARG("gender")
"RTN","SAMIHOM4",652,0)
 s @root@(ptlkien,"gender")=$s(gender="M":"M^MALE",1:"F^FEMALE")
"RTN","SAMIHOM4",653,0)
 s @root@(ptlkien,"sex")=SAMIARG("gender")
"RTN","SAMIHOM4",654,0)
 ; s @root@(ptlkien,"icn")=SAMIARG("icn")
"RTN","SAMIHOM4",655,0)
 s @root@(ptlkien,"ssn")=ssn
"RTN","SAMIHOM4",656,0)
 n last5 s last5=$$UCASE($e(name,1))_$e(ssn,6,9)
"RTN","SAMIHOM4",657,0)
 s @root@(ptlkien,"last5")=last5
"RTN","SAMIHOM4",658,0)
 n mymatch s mymatch=$g(SAMIARG("MATCHLOG"))
"RTN","SAMIHOM4",659,0)
 i mymatch'="" s @root@(ptlkien,"MATCHLOG")=mymatch
"RTN","SAMIHOM4",660,0)
 ;
"RTN","SAMIHOM4",661,0)
 quit  ; end of MKPTLK
"RTN","SAMIHOM4",662,0)
 ;
"RTN","SAMIHOM4",663,0)
 ;
"RTN","SAMIHOM4",664,0)
 ;
"RTN","SAMIHOM4",665,0)
UPDTFRMS(dfn) ; update demographics in all forms for patient
"RTN","SAMIHOM4",666,0)
 ;
"RTN","SAMIHOM4",667,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",668,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",669,0)
 n lien s lien=$o(@lroot@("dfn",dfn,""))
"RTN","SAMIHOM4",670,0)
 q:lien=""
"RTN","SAMIHOM4",671,0)
 n pien s pien=$o(@proot@("dfn",dfn,""))
"RTN","SAMIHOM4",672,0)
 q:pien=""
"RTN","SAMIHOM4",673,0)
 ; this patient has forms
"RTN","SAMIHOM4",674,0)
 m @proot@(pien)=@lroot@(lien) ; refresh the demos in the patient record
"RTN","SAMIHOM4",675,0)
 n ssn s ssn=$g(@proot@(pien,"ssn"))
"RTN","SAMIHOM4",676,0)
 s @proot@(pien,"sissn")=$e(ssn,1,3)_"-"_$e(ssn,4,5)_"-"_$e(ssn,6,9)
"RTN","SAMIHOM4",677,0)
 n sid s sid=$g(@proot@("sisid")) ; studyid 
"RTN","SAMIHOM4",678,0)
 q:sid=""  ; no studyid
"RTN","SAMIHOM4",679,0)
 n zi s zi=""
"RTN","SAMIHOM4",680,0)
 f  s zi=$o(@proot@("graph",sid,zi)) q:zi=""  d  ; for each form
"RTN","SAMIHOM4",681,0)
 . m @proot@("graph",sid,zi)=@proot@(pien) ; stamp each form with new demos
"RTN","SAMIHOM4",682,0)
 ;
"RTN","SAMIHOM4",683,0)
 quit  ; end of UPDTFRMS
"RTN","SAMIHOM4",684,0)
 ;
"RTN","SAMIHOM4",685,0)
 ;
"RTN","SAMIHOM4",686,0)
 ;
"RTN","SAMIHOM4",687,0)
MERGE(SAMIRESULT,SAMIARGS) ; merge participant records
"RTN","SAMIHOM4",688,0)
 ;
"RTN","SAMIHOM4",689,0)
 ; called from pressing the merge button on the unmatched report
"RTN","SAMIHOM4",690,0)
 ;
"RTN","SAMIHOM4",691,0)
 n toien s toien=$g(SAMIARGS("toien"))
"RTN","SAMIHOM4",692,0)
 i toien="" d  q  ;
"RTN","SAMIHOM4",693,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",694,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",695,0)
 n fromien s fromien=$g(@lroot@(toien,"MATCHLOG"))
"RTN","SAMIHOM4",696,0)
 i fromien="" d  q  ;
"RTN","SAMIHOM4",697,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",698,0)
 ;
"RTN","SAMIHOM4",699,0)
 ; test for remotedfn in from record - not valid if absent
"RTN","SAMIHOM4",700,0)
 ;
"RTN","SAMIHOM4",701,0)
 i $g(@lroot@(fromien,"remotedfn"))="" d  q  ;
"RTN","SAMIHOM4",702,0)
 . d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",703,0)
 ;
"RTN","SAMIHOM4",704,0)
 ; remove index entries for from and to records
"RTN","SAMIHOM4",705,0)
 ;
"RTN","SAMIHOM4",706,0)
 d UNINDXPT(fromien) ; delete index entries
"RTN","SAMIHOM4",707,0)
 d UNINDXPT(toien)
"RTN","SAMIHOM4",708,0)
 ;
"RTN","SAMIHOM4",709,0)
 ; create changelog entry in to record - contains from record
"RTN","SAMIHOM4",710,0)
 ;
"RTN","SAMIHOM4",711,0)
 m @lroot@(toien,"changelog",$$FMTE^XLFDT($$NOW^XLFDT,5))=@lroot@(fromien)
"RTN","SAMIHOM4",712,0)
 ;
"RTN","SAMIHOM4",713,0)
 ; change the dfn in the from record to the to record dfn for merging
"RTN","SAMIHOM4",714,0)
 ;
"RTN","SAMIHOM4",715,0)
 s @lroot@(fromien,"dfn")=@lroot@(toien,"dfn")
"RTN","SAMIHOM4",716,0)
 n dfn s dfn=@lroot@(toien,"dfn") ; for use in updating forms
"RTN","SAMIHOM4",717,0)
 ;
"RTN","SAMIHOM4",718,0)
 ; merge the from record to the to record
"RTN","SAMIHOM4",719,0)
 ;
"RTN","SAMIHOM4",720,0)
 m @lroot@(toien)=@lroot@(fromien)
"RTN","SAMIHOM4",721,0)
 ;
"RTN","SAMIHOM4",722,0)
 ; delete the from record
"RTN","SAMIHOM4",723,0)
 ;
"RTN","SAMIHOM4",724,0)
 k @lroot@(fromien)
"RTN","SAMIHOM4",725,0)
 ;
"RTN","SAMIHOM4",726,0)
 ; reindex the to record
"RTN","SAMIHOM4",727,0)
 ;
"RTN","SAMIHOM4",728,0)
 d INDXPTLK(toien)
"RTN","SAMIHOM4",729,0)
 ;
"RTN","SAMIHOM4",730,0)
 ; propagate the updated from record to every form
"RTN","SAMIHOM4",731,0)
 ;
"RTN","SAMIHOM4",732,0)
 d UPDTFRMS(dfn) ; updates the patient in the vapals-patient graph
"RTN","SAMIHOM4",733,0)
 ;
"RTN","SAMIHOM4",734,0)
 ; leave and return to the unmatched report
"RTN","SAMIHOM4",735,0)
 ;   note that the form and to records will no longer be in the report
"RTN","SAMIHOM4",736,0)
 ;
"RTN","SAMIHOM4",737,0)
 d WSUNMAT(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",738,0)
 ;
"RTN","SAMIHOM4",739,0)
 quit  ; end of MERGE
"RTN","SAMIHOM4",740,0)
 ;
"RTN","SAMIHOM4",741,0)
 ;
"RTN","SAMIHOM4",742,0)
 ;
"RTN","SAMIHOM4",743,0)
ADDUNMAT ; adds unmatched report web service to system
"RTN","SAMIHOM4",744,0)
 ;
"RTN","SAMIHOM4",745,0)
 d addService^%webutils("GET","unmatched","WSUNMAT^SAMIHOM4")
"RTN","SAMIHOM4",746,0)
 ;
"RTN","SAMIHOM4",747,0)
 quit  ; end of ADDUNMAT
"RTN","SAMIHOM4",748,0)
 ;
"RTN","SAMIHOM4",749,0)
 ;
"RTN","SAMIHOM4",750,0)
 ;
"RTN","SAMIHOM4",751,0)
DELUNMAT ; deletes unmatched web service
"RTN","SAMIHOM4",752,0)
 ;
"RTN","SAMIHOM4",753,0)
 d deleteService^%webutils("GET","unmatched")
"RTN","SAMIHOM4",754,0)
 ;
"RTN","SAMIHOM4",755,0)
 quit  ; end of DELUNMAT
"RTN","SAMIHOM4",756,0)
 ;
"RTN","SAMIHOM4",757,0)
 ;
"RTN","SAMIHOM4",758,0)
 ;
"RTN","SAMIHOM4",759,0)
WSUNMAT(SAMIRESULT,SAMIARGS) ; navigates to unmatched report
"RTN","SAMIHOM4",760,0)
 ; 
"RTN","SAMIHOM4",761,0)
 n filter,bdy
"RTN","SAMIHOM4",762,0)
 s bdy=""
"RTN","SAMIHOM4",763,0)
 ;s filter("siteid")="PHX"
"RTN","SAMIHOM4",764,0)
 s filter("samiroute")="report"
"RTN","SAMIHOM4",765,0)
 s filter("samireporttype")="unmatched"
"RTN","SAMIHOM4",766,0)
 d WSVAPALS^SAMIHOM3(.filter,.bdy,.SAMIRESULT) ; back to the unmatched report
"RTN","SAMIHOM4",767,0)
 ;
"RTN","SAMIHOM4",768,0)
 quit  ; end of WSUNMAT
"RTN","SAMIHOM4",769,0)
 ;
"RTN","SAMIHOM4",770,0)
 ;
"RTN","SAMIHOM4",771,0)
 ;
"RTN","SAMIHOM4",772,0)
DUPSSN(ssn) ; extrinsic returns true if duplicate ssn
"RTN","SAMIHOM4",773,0)
 ;
"RTN","SAMIHOM4",774,0)
 n proot s proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",775,0)
 i $d(@proot@("ssn",ssn)) q 1
"RTN","SAMIHOM4",776,0)
 ;
"RTN","SAMIHOM4",777,0)
 quit 0 ; end of $$DUPSSN
"RTN","SAMIHOM4",778,0)
 ;
"RTN","SAMIHOM4",779,0)
 ;
"RTN","SAMIHOM4",780,0)
 ;
"RTN","SAMIHOM4",781,0)
DUPICN(icn) ; extrinsic returns true if duplicate icn
"RTN","SAMIHOM4",782,0)
 ;
"RTN","SAMIHOM4",783,0)
 n proot s proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",784,0)
 n tmpicn s tmpicn=$p(icn,"V",1)
"RTN","SAMIHOM4",785,0)
 i $d(@proot@("icn",icn)) q 1
"RTN","SAMIHOM4",786,0)
 i $d(@proot@("icn",tmpicn)) q 1
"RTN","SAMIHOM4",787,0)
 ;
"RTN","SAMIHOM4",788,0)
 quit 0 ; end of $$DUPICN
"RTN","SAMIHOM4",789,0)
 ;
"RTN","SAMIHOM4",790,0)
 ;
"RTN","SAMIHOM4",791,0)
 ;
"RTN","SAMIHOM4",792,0)
BADICN(icn) ; extrinsic returns true if ICN checkdigits are wrong
"RTN","SAMIHOM4",793,0)
 ;
"RTN","SAMIHOM4",794,0)
 n zchk s zchk=$p(icn,"V",2)
"RTN","SAMIHOM4",795,0)
 n zicn s zicn=$p(icn,"V",1)
"RTN","SAMIHOM4",796,0)
 q:zchk="" 1
"RTN","SAMIHOM4",797,0)
 i zchk'=$$CHECKDG^MPIFSPC(zicn) q 1
"RTN","SAMIHOM4",798,0)
 ;
"RTN","SAMIHOM4",799,0)
 quit 0
"RTN","SAMIHOM4",800,0)
 ;
"RTN","SAMIHOM4",801,0)
 ;
"RTN","SAMIHOM4",802,0)
 ;
"RTN","SAMIHOM4",803,0)
SAVE(SAMIRESULT,SAMIARG) ; save patient-lookup record after edit
"RTN","SAMIHOM4",804,0)
 ;
"RTN","SAMIHOM4",805,0)
 n dfn s dfn=$g(vars("dfn")) ; must have a dfn
"RTN","SAMIHOM4",806,0)
 i dfn="" d  q  ;
"RTN","SAMIHOM4",807,0)
 . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home 
"RTN","SAMIHOM4",808,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",809,0)
 n sien s sien=$o(@root@("dfn",dfn,""))
"RTN","SAMIHOM4",810,0)
 i sien="" d  q  ;
"RTN","SAMIHOM4",811,0)
 . d GETHOME^SAMIHOM3(.SAMIRESULT,.SAMIARG) ; on error go home 
"RTN","SAMIHOM4",812,0)
 d UNINDXPT(sien) ; remove old index entries
"RTN","SAMIHOM4",813,0)
 n zm
"RTN","SAMIHOM4",814,0)
 k SAMIARG("MATCHLOG")
"RTN","SAMIHOM4",815,0)
 s zm=$$REMATCH(sien,.SAMIARG)
"RTN","SAMIHOM4",816,0)
 i zm>0 d  ;
"RTN","SAMIHOM4",817,0)
 . s SAMIARG("MATCHLOG")=zm
"RTN","SAMIHOM4",818,0)
 d MKPTLK(sien,.SAMIARG) ; add the updated fields
"RTN","SAMIHOM4",819,0)
 d INDXPTLK(sien) ; create new index entries
"RTN","SAMIHOM4",820,0)
 d UPDTFRMS(dfn) ; update demographic info in all forms
"RTN","SAMIHOM4",821,0)
 n filter,bdy
"RTN","SAMIHOM4",822,0)
 s bdy=""
"RTN","SAMIHOM4",823,0)
 m filter=SAMIARG
"RTN","SAMIHOM4",824,0)
 s filter("samiroute")="report"
"RTN","SAMIHOM4",825,0)
 s filter("samireporttype")="unmatched"
"RTN","SAMIHOM4",826,0)
 d WSVAPALS^SAMIHOM3(.filter,.bdy,.SAMIRESULT) ; back to the unmatched report
"RTN","SAMIHOM4",827,0)
 ;
"RTN","SAMIHOM4",828,0)
 quit  ; end of SAVE
"RTN","SAMIHOM4",829,0)
 ;
"RTN","SAMIHOM4",830,0)
 ;
"RTN","SAMIHOM4",831,0)
 ;
"RTN","SAMIHOM4",832,0)
REMATCH(sien,SAMIARG) ; extrinsic returns possible match ien
"RTN","SAMIHOM4",833,0)
 ;
"RTN","SAMIHOM4",834,0)
 ; else zero
"RTN","SAMIHOM4",835,0)
 ;
"RTN","SAMIHOM4",836,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",837,0)
 n ssn,name,icn,x,y
"RTN","SAMIHOM4",838,0)
 s ssn=$g(SAMIARG("ssn"))
"RTN","SAMIHOM4",839,0)
 i ssn["-" s ssn=$tr(ssn,"-")
"RTN","SAMIHOM4",840,0)
 s name=$g(SAMIARG("saminame"))
"RTN","SAMIHOM4",841,0)
 i name="" s name=$g(SAMIARG("name"))
"RTN","SAMIHOM4",842,0)
 s name=$$UCASE(name)
"RTN","SAMIHOM4",843,0)
 ; s icn=$g(SAMIARG("icn"))
"RTN","SAMIHOM4",844,0)
 s x=0
"RTN","SAMIHOM4",845,0)
 i ssn'="" s x=$o(@lroot@("ssn",ssn,""))
"RTN","SAMIHOM4",846,0)
 i x=sien s x=$o(@lroot@("ssn",ssn,x))
"RTN","SAMIHOM4",847,0)
 i +x'=0 d  ;
"RTN","SAMIHOM4",848,0)
 . s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",849,0)
 . ;i y>9000000 s x=0
"RTN","SAMIHOM4",850,0)
 i x>0 q x
"RTN","SAMIHOM4",851,0)
 i name'="" s x=$o(@lroot@("name",name,""))
"RTN","SAMIHOM4",852,0)
 i x=sien s x=$o(@lroot@("name",name,x))
"RTN","SAMIHOM4",853,0)
 i +x'=0 d  ;
"RTN","SAMIHOM4",854,0)
 . s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",855,0)
 . ;i y>9000000 s x=0
"RTN","SAMIHOM4",856,0)
 i x>0 q x
"RTN","SAMIHOM4",857,0)
 ;i icn'="" s x=$o(@lroot@("icn",icn,""))
"RTN","SAMIHOM4",858,0)
 ;i x=sien s x=$o(@lroot@("icn",icn,x))
"RTN","SAMIHOM4",859,0)
 ;i +x'=0 d  ;
"RTN","SAMIHOM4",860,0)
 ;. s y=$g(@lroot@(x,"dfn"))
"RTN","SAMIHOM4",861,0)
 ;. i y>9000000 s x=0
"RTN","SAMIHOM4",862,0)
 ;i x>0 q x
"RTN","SAMIHOM4",863,0)
 ;
"RTN","SAMIHOM4",864,0)
 quit 0 ; end of $$REMATCH
"RTN","SAMIHOM4",865,0)
 ;
"RTN","SAMIHOM4",866,0)
 ;
"RTN","SAMIHOM4",867,0)
 ;
"RTN","SAMIHOM4",868,0)
SETINFO(vars,msg) ; set information message text
"RTN","SAMIHOM4",869,0)
 ;
"RTN","SAMIHOM4",870,0)
 ; vars are the screen variables passed by reference
"RTN","SAMIHOM4",871,0)
 ;
"RTN","SAMIHOM4",872,0)
 s vars("infoMessage")=msg
"RTN","SAMIHOM4",873,0)
 ;
"RTN","SAMIHOM4",874,0)
 quit  ; end of SETINFO
"RTN","SAMIHOM4",875,0)
 ;
"RTN","SAMIHOM4",876,0)
 ;
"RTN","SAMIHOM4",877,0)
 ;
"RTN","SAMIHOM4",878,0)
SETWARN(vars,msg) ; set warning message text
"RTN","SAMIHOM4",879,0)
 ;
"RTN","SAMIHOM4",880,0)
 ; vars are the screen variables passed by reference
"RTN","SAMIHOM4",881,0)
 ;
"RTN","SAMIHOM4",882,0)
 s vars("warnMessage")=msg
"RTN","SAMIHOM4",883,0)
 ;
"RTN","SAMIHOM4",884,0)
 quit  ; end of SETWARN
"RTN","SAMIHOM4",885,0)
 ;
"RTN","SAMIHOM4",886,0)
 ;
"RTN","SAMIHOM4",887,0)
 ; 
"RTN","SAMIHOM4",888,0)
RTNERR(rtn,form,vals,msg,fld) ; redisplay page w/error message
"RTN","SAMIHOM4",889,0)
 ;
"RTN","SAMIHOM4",890,0)
 ; rtn is the return array
"RTN","SAMIHOM4",891,0)
 ; form is the form the page requires
"RTN","SAMIHOM4",892,0)
 ; vals are the values for the page. passed by reference
"RTN","SAMIHOM4",893,0)
 ; msg is the error message to be displayed
"RTN","SAMIHOM4",894,0)
 ; fld is the name of the field where the cursor should be put
"RTN","SAMIHOM4",895,0)
 ;
"RTN","SAMIHOM4",896,0)
 n zhtml ; work area for the tempate
"RTN","SAMIHOM4",897,0)
 d SAMIHTM^%wf(.zhtml,form,.err)
"RTN","SAMIHOM4",898,0)
 d MERGEHTM^%wf(.zhtml,.vals,.err)
"RTN","SAMIHOM4",899,0)
 m rtn=zhtml
"RTN","SAMIHOM4",900,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMIHOM4",901,0)
 ;
"RTN","SAMIHOM4",902,0)
 quit  ; end of RTNERR
"RTN","SAMIHOM4",903,0)
 ;
"RTN","SAMIHOM4",904,0)
 ;
"RTN","SAMIHOM4",905,0)
 ;
"RTN","SAMIHOM4",906,0)
RTNPAGE(rtn,form,vals) ; display page
"RTN","SAMIHOM4",907,0)
 ;
"RTN","SAMIHOM4",908,0)
 ; rtn is the return array
"RTN","SAMIHOM4",909,0)
 ; form is the form the page requires
"RTN","SAMIHOM4",910,0)
 ; vals are the values for the page. passed by reference
"RTN","SAMIHOM4",911,0)
 ;
"RTN","SAMIHOM4",912,0)
 n err
"RTN","SAMIHOM4",913,0)
 n zhtml ; work area for the tempate
"RTN","SAMIHOM4",914,0)
 d SAMIHTM^%wf(.zhtml,form,.err)
"RTN","SAMIHOM4",915,0)
 d MERGEHTM^%wf(.zhtml,.vals,.err)
"RTN","SAMIHOM4",916,0)
 m SAMIRESULT=zhtml
"RTN","SAMIHOM4",917,0)
 set HTTPRSP("mime")="text/html" ; set mime type
"RTN","SAMIHOM4",918,0)
 ;
"RTN","SAMIHOM4",919,0)
 quit  ; end of RTNPAGE
"RTN","SAMIHOM4",920,0)
 ;
"RTN","SAMIHOM4",921,0)
 ;
"RTN","SAMIHOM4",922,0)
 ;
"RTN","SAMIHOM4",923,0)
REINDXPL ; reindex patient lookup
"RTN","SAMIHOM4",924,0)
 ;
"RTN","SAMIHOM4",925,0)
 n root s root=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",926,0)
 n zi s zi=0
"RTN","SAMIHOM4",927,0)
 k @root@("ssn")
"RTN","SAMIHOM4",928,0)
 k @root@("name")
"RTN","SAMIHOM4",929,0)
 k @root@("last5")
"RTN","SAMIHOM4",930,0)
 k @root@("sinamef")
"RTN","SAMIHOM4",931,0)
 k @root@("sinamel")
"RTN","SAMIHOM4",932,0)
 ; k @root@("icn")
"RTN","SAMIHOM4",933,0)
 f  s zi=$o(@root@(zi)) q:+zi=0  d  ;
"RTN","SAMIHOM4",934,0)
 . d INDXPTLK(zi)
"RTN","SAMIHOM4",935,0)
 ;
"RTN","SAMIHOM4",936,0)
 quit  ; end of REINDXPL
"RTN","SAMIHOM4",937,0)
 ;
"RTN","SAMIHOM4",938,0)
 ;
"RTN","SAMIHOM4",939,0)
 ;
"RTN","SAMIHOM4",940,0)
INDXPTLK(ien) ; generate index entries in patient-lookup graph
"RTN","SAMIHOM4",941,0)
 ;
"RTN","SAMIHOM4",942,0)
 ; for entry ien
"RTN","SAMIHOM4",943,0)
 ;
"RTN","SAMIHOM4",944,0)
 n proot set proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",945,0)
 n name s name=$g(@proot@(ien,"saminame"))
"RTN","SAMIHOM4",946,0)
 s @proot@("name",name,ien)=""
"RTN","SAMIHOM4",947,0)
 n ucname s ucname=$$UCASE(name)
"RTN","SAMIHOM4",948,0)
 s @proot@("name",ucname,ien)=""
"RTN","SAMIHOM4",949,0)
 n x
"RTN","SAMIHOM4",950,0)
 s x=$g(@proot@(ien,"dfn")) ;w !,x
"RTN","SAMIHOM4",951,0)
 s:x'="" @proot@("dfn",x,ien)=""
"RTN","SAMIHOM4",952,0)
 s x=$g(@proot@(ien,"last5")) ;w !,x
"RTN","SAMIHOM4",953,0)
 s:x'="" @proot@("last5",x,ien)=""
"RTN","SAMIHOM4",954,0)
 ;
"RTN","SAMIHOM4",955,0)
 ; s x=$g(@proot@(ien,"icn")) ;w !,x
"RTN","SAMIHOM4",956,0)
 ; i x'["V" d  ;
"RTN","SAMIHOM4",957,0)
 ; . i x="" q
"RTN","SAMIHOM4",958,0)
 ; . n chk s chk=$$CHECKDG^MPIFSPC(x)
"RTN","SAMIHOM4",959,0)
 ; . s @proot@(ien,"icn")=x_"V"_chk
"RTN","SAMIHOM4",960,0)
 ; . s x=x_"V"_chk
"RTN","SAMIHOM4",961,0)
 ; s:x'="" @proot@("icn",x,ien)=""
"RTN","SAMIHOM4",962,0)
 ;
"RTN","SAMIHOM4",963,0)
 s x=$g(@proot@(ien,"ssn")) ;w !,x
"RTN","SAMIHOM4",964,0)
 s:x'="" @proot@("ssn",x,ien)=""
"RTN","SAMIHOM4",965,0)
 s x=$g(@proot@(ien,"sinamef")) ;w !,x
"RTN","SAMIHOM4",966,0)
 s:x'="" @proot@("sinamef",x,ien)=""
"RTN","SAMIHOM4",967,0)
 s x=$g(@proot@(ien,"sinamel")) w !,x
"RTN","SAMIHOM4",968,0)
 s:x'="" @proot@("sinamel",x,ien)=""
"RTN","SAMIHOM4",969,0)
 set @proot@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHOM4",970,0)
 ;
"RTN","SAMIHOM4",971,0)
 quit  ; end of INDXPTLK
"RTN","SAMIHOM4",972,0)
 ;
"RTN","SAMIHOM4",973,0)
 ;
"RTN","SAMIHOM4",974,0)
 ;
"RTN","SAMIHOM4",975,0)
UNINDXPT(ien) ; remove index entries from patient-lookup graph
"RTN","SAMIHOM4",976,0)
 ;
"RTN","SAMIHOM4",977,0)
 ; for entry ien
"RTN","SAMIHOM4",978,0)
 ;
"RTN","SAMIHOM4",979,0)
 n proot set proot=$$setroot^%wd("patient-lookup")
"RTN","SAMIHOM4",980,0)
 n name s name=$g(@proot@(ien,"saminame"))
"RTN","SAMIHOM4",981,0)
 k @proot@("name",name,ien)
"RTN","SAMIHOM4",982,0)
 n ucname s ucname=$$UCASE(name)
"RTN","SAMIHOM4",983,0)
 k @proot@("name",ucname,ien)
"RTN","SAMIHOM4",984,0)
 n x
"RTN","SAMIHOM4",985,0)
 s x=$g(@proot@(ien,"dfn")) ;w !,x
"RTN","SAMIHOM4",986,0)
 k:x'="" @proot@("dfn",x,ien)
"RTN","SAMIHOM4",987,0)
 s x=$g(@proot@(ien,"last5")) ;w !,x
"RTN","SAMIHOM4",988,0)
 k:x'="" @proot@("last5",x,ien)
"RTN","SAMIHOM4",989,0)
 ;
"RTN","SAMIHOM4",990,0)
 ; s x=$g(@proot@(ien,"icn")) ;w !,x
"RTN","SAMIHOM4",991,0)
 ; i x'["V" d  ;
"RTN","SAMIHOM4",992,0)
 ; . i x="" q
"RTN","SAMIHOM4",993,0)
 ; . n chk s chk=$$CHECKDG^MPIFSPC(x)
"RTN","SAMIHOM4",994,0)
 ; . s @proot@(ien,"icn")=x_"V"_chk
"RTN","SAMIHOM4",995,0)
 ; . s x=x_"V"_chk
"RTN","SAMIHOM4",996,0)
 ; k:x'="" @proot@("icn",x,ien)
"RTN","SAMIHOM4",997,0)
 ;
"RTN","SAMIHOM4",998,0)
 s x=$g(@proot@(ien,"ssn")) ;w !,x
"RTN","SAMIHOM4",999,0)
 k:x'="" @proot@("ssn",x,ien)
"RTN","SAMIHOM4",1000,0)
 s x=$g(@proot@(ien,"sinamef")) ;w !,x
"RTN","SAMIHOM4",1001,0)
 k:x'="" @proot@("sinamef",x,ien)
"RTN","SAMIHOM4",1002,0)
 s x=$g(@proot@(ien,"sinamel")) w !,x
"RTN","SAMIHOM4",1003,0)
 k:x'="" @proot@("sinamel",x,ien)
"RTN","SAMIHOM4",1004,0)
 set @proot@("Date Last Updated")=$$HTE^XLFDT($horolog)
"RTN","SAMIHOM4",1005,0)
 ;
"RTN","SAMIHOM4",1006,0)
 quit  ; end of UNINDXPT
"RTN","SAMIHOM4",1007,0)
 ;
"RTN","SAMIHOM4",1008,0)
 ;
"RTN","SAMIHOM4",1009,0)
 ;
"RTN","SAMIHOM4",1010,0)
UCASE(STR) ; extrinsic returns uppercase of STR
"RTN","SAMIHOM4",1011,0)
 ;
"RTN","SAMIHOM4",1012,0)
 N X,Y
"RTN","SAMIHOM4",1013,0)
 S X=STR
"RTN","SAMIHOM4",1014,0)
 X ^%ZOSF("UPPERCASE")
"RTN","SAMIHOM4",1015,0)
 ;
"RTN","SAMIHOM4",1016,0)
 quit Y ; end of $$UCASE
"RTN","SAMIHOM4",1017,0)
 ;
"RTN","SAMIHOM4",1018,0)
 ;
"RTN","SAMIHOM4",1019,0)
 ;
"RTN","SAMIHOM4",1020,0)
 ;@wri-code WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",1021,0)
WSNEWCAS ; web route newcase (creates new case)
"RTN","SAMIHOM4",1022,0)
 ;
"RTN","SAMIHOM4",1023,0)
 ;@stanza 1 invocation, binding, & branching
"RTN","SAMIHOM4",1024,0)
 ;
"RTN","SAMIHOM4",1025,0)
 ;ven/gpl;wri;procedure;
"RTN","SAMIHOM4",1026,0)
 ;@signature
"RTN","SAMIHOM4",1027,0)
 ; do WSNEWCAS^SAMIHOM3(SAMIARGS,SAMIBODY,SAMIRESULT)
"RTN","SAMIHOM4",1028,0)
 ;@branches-from
"RTN","SAMIHOM4",1029,0)
 ; wri WSNEWCAS^SAMIHOM3 [wr newcase]
"RTN","SAMIHOM4",1030,0)
 ;@wri-called-by
"RTN","SAMIHOM4",1031,0)
 ; wsi WSVAPALS^SAMIHOM3 [ws post vapals]
"RTN","SAMIHOM4",1032,0)
 ;@called-by none
"RTN","SAMIHOM4",1033,0)
 ;@calls
"RTN","SAMIHOM4",1034,0)
 ; parseBody^%wf
"RTN","SAMIHOM4",1035,0)
 ; $$setroot^%wd
"RTN","SAMIHOM4",1036,0)
 ;  $$VALDTNM [commented out]
"RTN","SAMIHOM4",1037,0)
 ;  GETHOME [commented out]
"RTN","SAMIHOM4",1038,0)
 ;  $$NEXTNUM [commented out]
"RTN","SAMIHOM4",1039,0)
 ; $$GENSTDID^SAMIHOM3
"RTN","SAMIHOM4",1040,0)
 ; $$NOW^XLFDT
"RTN","SAMIHOM4",1041,0)
 ; $$KEYDATE^SAMIHOM3
"RTN","SAMIHOM4",1042,0)
 ; PREFILL^SAMIHOM3
"RTN","SAMIHOM4",1043,0)
 ;  makeSbform [commented out]
"RTN","SAMIHOM4",1044,0)
 ; $$MKSIFORM^SAMIHOM3
"RTN","SAMIHOM4",1045,0)
 ; wsGetForm^%wf
"RTN","SAMIHOM4",1046,0)
 ;  WSCASE^SAMICASE [commented out]
"RTN","SAMIHOM4",1047,0)
 ;@input
"RTN","SAMIHOM4",1048,0)
 ;.ARGS =
"RTN","SAMIHOM4",1049,0)
 ; BODY =
"RTN","SAMIHOM4",1050,0)
 ;.RESULT =
"RTN","SAMIHOM4",1051,0)
 ;@output: ?
"RTN","SAMIHOM4",1052,0)
 ;@examples [tbd]
"RTN","SAMIHOM4",1053,0)
 ;@tests [tbd]
"RTN","SAMIHOM4",1054,0)
 ;
"RTN","SAMIHOM4",1055,0)
 ;
"RTN","SAMIHOM4",1056,0)
 ;@stanza 2 create new case
"RTN","SAMIHOM4",1057,0)
 ;
"RTN","SAMIHOM4",1058,0)
 merge ^SAMIUL("newCase","ARGS")=SAMIARGS
"RTN","SAMIHOM4",1059,0)
 merge ^SAMIUL("newCase","BODY")=SAMIBODY
"RTN","SAMIHOM4",1060,0)
 ;
"RTN","SAMIHOM4",1061,0)
 new vars,bdy
"RTN","SAMIHOM4",1062,0)
 set SAMIBDY=$get(SAMIBODY(1))
"RTN","SAMIHOM4",1063,0)
 if SAMIBDY="" M vars=SAMIARGS
"RTN","SAMIHOM4",1064,0)
 else  do parseBody^%wf("vars",.SAMIBDY)
"RTN","SAMIHOM4",1065,0)
 merge ^SAMIUL("newCase","vars")=vars
"RTN","SAMIHOM4",1066,0)
 ;
"RTN","SAMIHOM4",1067,0)
 new root set root=$$setroot^%wd("vapals-patients")
"RTN","SAMIHOM4",1068,0)
 ;
"RTN","SAMIHOM4",1069,0)
 new saminame set saminame=$get(vars("name"))
"RTN","SAMIHOM4",1070,0)
 if saminame="" s saminame=$get(vars("saminame"))
"RTN","SAMIHOM4",1071,0)
 ;if $$VALDTNM(saminame,.ARGS)=-1 do  quit  ;
"RTN","SAMIHOM4",1072,0)
 ;. new r1
"RTN","SAMIHOM4",1073,0)
 ;. do GETHOME(.r1,.ARGS) ; home page to redisplay
"RTN","SAMIHOM4",1074,0)
 ;. merge RESULT=r1
"RTN","SAMIHOM4",1075,0)
 ;. quit
"RTN","SAMIHOM4",1076,0)
 ;
"RTN","SAMIHOM4",1077,0)
 new dfn s dfn=$get(vars("dfn"))
"RTN","SAMIHOM4",1078,0)
 ;if dfn="" do  quit  ;
"RTN","SAMIHOM4",1079,0)
 ;. new r1
"RTN","SAMIHOM4",1080,0)
 ;. do GETHOME(.r1,.ARGS) ; home page to redisplay
"RTN","SAMIHOM4",1081,0)
 ;. merge RESULT=r1
"RTN","SAMIHOM4",1082,0)
 ;. quit
"RTN","SAMIHOM4",1083,0)
 ;
"RTN","SAMIHOM4",1084,0)
 ; new gien set gien=$$NEXTNUM
"RTN","SAMIHOM4",1085,0)
 new gien set gien=dfn
"RTN","SAMIHOM4",1086,0)
 ;
"RTN","SAMIHOM4",1087,0)
 merge ^SAMIUL("newCase","G1")=root
"RTN","SAMIHOM4",1088,0)
 ; create dfn index
"RTN","SAMIHOM4",1089,0)
 set @root@("dfn",dfn,gien)=""
"RTN","SAMIHOM4",1090,0)
 ;
"RTN","SAMIHOM4",1091,0)
 set @root@(gien,"saminum")=gien
"RTN","SAMIHOM4",1092,0)
 set @root@(gien,"saminame")=saminame
"RTN","SAMIHOM4",1093,0)
 ;
"RTN","SAMIHOM4",1094,0)
 new studyid set studyid=$$GENSTDID^SAMIHOM3(gien,.SAMIARGS)
"RTN","SAMIHOM4",1095,0)
 set @root@(gien,"samistudyid")=studyid
"RTN","SAMIHOM4",1096,0)
 set @root@("sid",studyid,gien)=""
"RTN","SAMIHOM4",1097,0)
 ;
"RTN","SAMIHOM4",1098,0)
 new datekey set datekey=$$KEYDATE^SAMIHOM3($$NOW^XLFDT)
"RTN","SAMIHOM4",1099,0)
 set @root@(gien,"samicreatedate")=datekey
"RTN","SAMIHOM4",1100,0)
 ;
"RTN","SAMIHOM4",1101,0)
 merge ^SAMIUL("newCase",gien)=@root@(gien)
"RTN","SAMIHOM4",1102,0)
 ;
"RTN","SAMIHOM4",1103,0)
 ;
"RTN","SAMIHOM4",1104,0)
 do PREFILL^SAMIHOM3(dfn) ; prefills from the "patient-lookup" graph
"RTN","SAMIHOM4",1105,0)
 ;
"RTN","SAMIHOM4",1106,0)
 new siformkey
"RTN","SAMIHOM4",1107,0)
 ; do makeSbform(gien) ; create background form for new patient
"RTN","SAMIHOM4",1108,0)
 set siformkey=$$MKSIFORM^SAMIHOM3(gien) ; create intake for new patient
"RTN","SAMIHOM4",1109,0)
 ;
"RTN","SAMIHOM4",1110,0)
 set SAMIARGS("studyid")=studyid
"RTN","SAMIHOM4",1111,0)
 set SAMIARGS("form")="vapals:"_siformkey
"RTN","SAMIHOM4",1112,0)
 do wsGetForm^%wf(.SAMIRESULT,.SAMIARGS)
"RTN","SAMIHOM4",1113,0)
 ; do WSCASE^SAMICASE(.SAMIRESULT,.SAMIARGS) ; navigate to case review page
"RTN","SAMIHOM4",1114,0)
 ;
"RTN","SAMIHOM4",1115,0)
 ;
"RTN","SAMIHOM4",1116,0)
 ;@stanza 3 termination
"RTN","SAMIHOM4",1117,0)
 ;
"RTN","SAMIHOM4",1118,0)
 quit  ; end of wri WSNEWCAS^SAMIHOM3
"RTN","SAMIHOM4",1119,0)
 ;
"RTN","SAMIHOM4",1120,0)
 ;
"RTN","SAMIHOM4",1121,0)
 ;
"RTN","SAMIHOM4",1122,0)
EOR ; end of routine SAMIHOM4
"RTN","SAMIHUL")
0^2^B109364
"RTN","SAMIHUL",1,0)
SAMIHUL ;ven/gpl - ielcap: home page log ;2021-09-24t22:28z
"RTN","SAMIHUL",2,0)
 ;;18.0;SAMI;**9,12,16**;2020-01;Build 2
"RTN","SAMIHUL",3,0)
 ;18-x-16-t1
"RTN","SAMIHUL",4,0)
 ;
"RTN","SAMIHUL",5,0)
 ; SAMIHOM3 contains subroutines for producing the ELCAP Home Page.
"RTN","SAMIHUL",6,0)
 ; SAMIHUL contains the development log for the SAMIHOM* routines.
"RTN","SAMIHUL",7,0)
 ; It contains no executable code.
"RTN","SAMIHUL",8,0)
 ;
"RTN","SAMIHUL",9,0)
 quit  ; no entry from top
"RTN","SAMIHUL",10,0)
 ;
"RTN","SAMIHUL",11,0)
 ;
"RTN","SAMIHUL",12,0)
 ;
"RTN","SAMIHUL",13,0)
 ;@section 0 primary development
"RTN","SAMIHUL",14,0)
 ;
"RTN","SAMIHUL",15,0)
 ;
"RTN","SAMIHUL",16,0)
 ;
"RTN","SAMIHUL",17,0)
 ;@routine-credits
"RTN","SAMIHUL",18,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIHUL",19,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIHUL",20,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIHUL",21,0)
 ; http://vistaexpertise.net
"RTN","SAMIHUL",22,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIHUL",23,0)
 ;@license see routine SAMIUL
"RTN","SAMIHUL",24,0)
 ;
"RTN","SAMIHUL",25,0)
 ;@last-update 2021-09-24t22:28z
"RTN","SAMIHUL",26,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIHUL",27,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIHUL",28,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIHUL",29,0)
 ;@version 18-14-16
"RTN","SAMIHUL",30,0)
 ;@release-date 2020-01
"RTN","SAMIHUL",31,0)
 ;@patch-list **9,12,16**
"RTN","SAMIHUL",32,0)
 ;
"RTN","SAMIHUL",33,0)
 ;@dev-add Frederick D. S. Marshall (toad)
"RTN","SAMIHUL",34,0)
 ; toad@vistaexpertise.net
"RTN","SAMIHUL",35,0)
 ;@dev-add Kenneth W. McGlothlen (mcglk)
"RTN","SAMIHUL",36,0)
 ; mcglk@vistaexpertise.net
"RTN","SAMIHUL",37,0)
 ;@dev-add Linda M. R. Yaw (lmry)
"RTN","SAMIHUL",38,0)
 ; linda.yaw@vistaexpertise.net
"RTN","SAMIHUL",39,0)
 ;@dev-add Larry G. Carlson (lgc)
"RTN","SAMIHUL",40,0)
 ; larry.g.carlson@gmail.com
"RTN","SAMIHUL",41,0)
 ;@dev-add Alexis R. Carlson (arc)
"RTN","SAMIHUL",42,0)
 ; whatisthehumanspirit@gmail.com
"RTN","SAMIHUL",43,0)
 ;@dev-add Domenick DiNatale (ddn)
"RTN","SAMIHUL",44,0)
 ; domenic@intellitechinnovations.com
"RTN","SAMIHUL",45,0)
 ;
"RTN","SAMIHUL",46,0)
 ;@module-credits
"RTN","SAMIHUL",47,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIHUL",48,0)
 ; (VA-PALS)
"RTN","SAMIHUL",49,0)
 ; http://va-pals.org/
"RTN","SAMIHUL",50,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIHUL",51,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIHUL",52,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIHUL",53,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIHUL",54,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIHUL",55,0)
 ; http://ielcap.com/
"RTN","SAMIHUL",56,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIHUL",57,0)
 ; http://paraxialtech.com/
"RTN","SAMIHUL",58,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIHUL",59,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIHUL",60,0)
 ;
"RTN","SAMIHUL",61,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIHUL",62,0)
 ;
"RTN","SAMIHUL",63,0)
 ; 2018-01-13 ven/gpl 18.0-t4
"RTN","SAMIHUL",64,0)
 ;  SAMIHOM3 create routine from SAMIFRM to implement ELCAP Home Page.
"RTN","SAMIHUL",65,0)
 ;
"RTN","SAMIHUL",66,0)
 ; 2018-02-05 ven/toad 18.0-t4
"RTN","SAMIHUL",67,0)
 ;  SAMIHOM3 update license & attribution & hdr comments, add white
"RTN","SAMIHUL",68,0)
 ; space & do-dot quits, spell out language elements.
"RTN","SAMIHUL",69,0)
 ;
"RTN","SAMIHUL",70,0)
 ; 2018-02-27 ven/gpl 18.0-t4
"RTN","SAMIHUL",71,0)
 ;  SAMIHOM3 new subroutines PREFIX,GETHOME,SCANFOR,WSNEWCAS,PREFILL,
"RTN","SAMIHUL",72,0)
 ; MKSBFORM,MKSIFORM,VALDTNM,SID2NUM,KEYDATE,GENSTDID,NEXTNUM to
"RTN","SAMIHUL",73,0)
 ; support creation of new cases.
"RTN","SAMIHUL",74,0)
 ;
"RTN","SAMIHUL",75,0)
 ; 2018-03-01 ven/toad 18.0-t4
"RTN","SAMIHUL",76,0)
 ;  SAMIHOM3 refactor & reorganize new code, add hdr comments,
"RTN","SAMIHUL",77,0)
 ; r/findReplaceAll^%wf w/findReplace^%ts.
"RTN","SAMIHUL",78,0)
 ;
"RTN","SAMIHUL",79,0)
 ; 2018-03-06 ven/gpl 18.0-t4
"RTN","SAMIHUL",80,0)
 ;  SAMIHOM3 ?
"RTN","SAMIHUL",81,0)
 ;
"RTN","SAMIHUL",82,0)
 ; 2018-03-07 ven/toad 18.0-t4
"RTN","SAMIHUL",83,0)
 ;  SAMIHOM3 in $$SID2NUM add WSNUFORM^SAMICASE to called-by; in
"RTN","SAMIHUL",84,0)
 ; keyDate,GETHOME update called-by.
"RTN","SAMIHUL",85,0)
 ;
"RTN","SAMIHUL",86,0)
 ; 2018-05-18/25 ven/lgc&arc 18.0-t4 76020fd,81b1048,65afd99
"RTN","SAMIHUL",87,0)
 ;  SAMIHOM3 new SAMIHOM3 for new patient search page, chg submit
"RTN","SAMIHUL",88,0)
 ; processing on forms, fix bug in postform.
"RTN","SAMIHUL",89,0)
 ;
"RTN","SAMIHUL",90,0)
 ; 2018-06-14/07-10 ven/lgc&arc 18.0-t4 d71f4fe,8b0a432,ce345db,
"RTN","SAMIHUL",91,0)
 ; 402b6a8,14f991d,2e9662b
"RTN","SAMIHUL",92,0)
 ;  SAMIHOM3 make background form optional; 1st version of CT Eval
"RTN","SAMIHUL",93,0)
 ; Report; reorg ctreport routines & 1st crack at impressions &
"RTN","SAMIHUL",94,0)
 ; recommendations; note produced for intake form on submit; add
"RTN","SAMIHUL",95,0)
 ; support for routing by patient in CPRS Tools Menu, modify
"RTN","SAMIHUL",96,0)
 ; wsHOME^SAMIHOM3 to properly route VA-PALS web app when launced via
"RTN","SAMIHUL",97,0)
 ; CPRS Tools Menu; repair SAMIHOM3 & redact report link.
"RTN","SAMIHUL",98,0)
 ;
"RTN","SAMIHUL",99,0)
 ; 2018-08-22 ven/gpl 18.0-t4 6e696a9
"RTN","SAMIHUL",100,0)
 ;  SAMIHOM3 add PTINFO call to vista to pull ssn.
"RTN","SAMIHUL",101,0)
 ;
"RTN","SAMIHUL",102,0)
 ; 2018-09-30/11-01 ven/lgc&arc 18.0-t4 d93c640,482f522,a8e4226,
"RTN","SAMIHUL",103,0)
 ; ee5e8a1
"RTN","SAMIHUL",104,0)
 ;  SAMIHOM3 hdr & prefill of intake; new input form features, report
"RTN","SAMIHUL",105,0)
 ; menu fix; set urban/rural status at siform setup; handle zip code
"RTN","SAMIHUL",106,0)
 ; unknown.
"RTN","SAMIHUL",107,0)
 ;
"RTN","SAMIHUL",108,0)
 ; 2018-11-09/2019-01-22 ven/lgc&arc&lmry 18.0-t4 bac4f73,5400035,
"RTN","SAMIHUL",109,0)
 ; dd341e0,a953946,e2a44e6,2356c2b,3ceb74b,3088307,4271b46,7a5d340,
"RTN","SAMIHUL",110,0)
 ; dfbb0bc,fd1bcee,8dd6f34,51eb163,dbdb5a4,0880027,ccba017,5368121
"RTN","SAMIHUL",111,0)
 ;  SAMIHOM3 unit tests, annotation, sac compliance, XINDEX bugs, fix
"RTN","SAMIHUL",112,0)
 ; accidental reversions, add license info.
"RTN","SAMIHUL",113,0)
 ;
"RTN","SAMIHUL",114,0)
 ; 2018-12-18/20 ven/arc 18.0-t4 3088307f,4271b46b,dfbb0bca,
"RTN","SAMIHUL",115,0)
 ;  b8ff6da9,fd1bceee
"RTN","SAMIHUL",116,0)
 ;  SAMIHOM4 va sac compliance & variable namespacing.
"RTN","SAMIHUL",117,0)
 ;
"RTN","SAMIHUL",118,0)
 ; 2019-01-01/02-18 ven/lgc 18.0-t4 0880027c,18aa0fec,fcd635c1,
"RTN","SAMIHUL",119,0)
 ;  53681219,76874314
"RTN","SAMIHUL",120,0)
 ;  SAMIHOM3 update w/ recent changes.
"RTN","SAMIHUL",121,0)
 ;  SAMIHOM4 updates for va sac & code coverage, add license info.
"RTN","SAMIHUL",122,0)
 ;
"RTN","SAMIHUL",123,0)
 ; 2019-04-15 ven/gpl 18.0-t4 b403bf01
"RTN","SAMIHUL",124,0)
 ;  SAMIHOM4 support for new intake notes.
"RTN","SAMIHUL",125,0)
 ;
"RTN","SAMIHUL",126,0)
 ; 2019-04-16 ven/lgc 18.0-t4 e54b76d1
"RTN","SAMIHUL",127,0)
 ;  SAMIHOM4 update for SAMIFORM project.
"RTN","SAMIHUL",128,0)
 ;
"RTN","SAMIHUL",129,0)
 ; 2019-04-17 ven/gpl 18.0-t4 7d1f86db
"RTN","SAMIHUL",130,0)
 ;  SAMIHOM3 prefill date on intake prelim discussion section.
"RTN","SAMIHUL",131,0)
 ;
"RTN","SAMIHUL",132,0)
 ; 2019-06-18 ven/arc 18.0-t4 91022482
"RTN","SAMIHUL",133,0)
 ;  SAMIHOM4 switch fr/global ^SAMIGPL to/^SAMIUL.
"RTN","SAMIHUL",134,0)
 ;
"RTN","SAMIHUL",135,0)
 ; 2019-08-05 ven/gpl 18.0-t4 9c0c2ed3
"RTN","SAMIHUL",136,0)
 ;  SAMIHOM3 add GETPRFX to get right prefix at registration.
"RTN","SAMIHUL",137,0)
 ;
"RTN","SAMIHUL",138,0)
 ; 2019-08-07 ven/lgc&arc 18.0-t4 603194b9,37967fc5
"RTN","SAMIHUL",139,0)
 ;  SAMIHOM3 consolidate calls to retrieve facility prefix.
"RTN","SAMIHUL",140,0)
 ;
"RTN","SAMIHUL",141,0)
 ; 2019-11-22 par/ddn 18.0-t4 b2cc389d vap-458
"RTN","SAMIHUL",142,0)
 ;  SAMIHOM4 manual registration.
"RTN","SAMIHUL",143,0)
 ;
"RTN","SAMIHUL",144,0)
 ; 2020-01-01/05 ven/lgc 18.0-t4 c169f4b1,5928064a,62e3200f
"RTN","SAMIHUL",145,0)
 ;  SAMIHOM4 support for unmatched patient processing, more changes
"RTN","SAMIHUL",146,0)
 ; for participant matching, unmatched participant processing ready
"RTN","SAMIHUL",147,0)
 ; for testing.
"RTN","SAMIHUL",148,0)
 ;
"RTN","SAMIHUL",149,0)
 ; 2020-01-08/10 ven/gpl 18.0 a002f850,47dfe3cd
"RTN","SAMIHUL",150,0)
 ;  SAMIHOM4 bug fix for unmatched processing, turn off & on manual
"RTN","SAMIHUL",151,0)
 ; registration link on home page.
"RTN","SAMIHUL",152,0)
 ;
"RTN","SAMIHUL",153,0)
 ; 2020-01-10 ven/gpl 18.0 4c8e6ebc,76b465cb
"RTN","SAMIHUL",154,0)
 ;  SAMIHOM4 3 quits with returns for cache.
"RTN","SAMIHUL",155,0)
 ;
"RTN","SAMIHUL",156,0)
 ; 2020-01-16 ven/lgc 18.0 0a2af965
"RTN","SAMIHUL",157,0)
 ;  SAMIHOM4 bulk commit due to switch to cache.
"RTN","SAMIHUL",158,0)
 ;
"RTN","SAMIHUL",159,0)
 ; 2020-01-17/20 ven/lgc 18.1 8557207f,dc5f618c
"RTN","SAMIHUL",160,0)
 ;  SAMIHOM4 followup note, limit to one note per followup form.
"RTN","SAMIHUL",161,0)
 ;
"RTN","SAMIHUL",162,0)
 ; 2020-02-01/02 ven/lgc 18.4 3065146d,36ae0ed1
"RTN","SAMIHUL",163,0)
 ;  SAMIHOM4 set options for text based ctreport, switch default
"RTN","SAMIHUL",164,0)
 ; ctreport to text.
"RTN","SAMIHUL",165,0)
 ;
"RTN","SAMIHUL",166,0)
 ; 2020-04-02/11 ven/gpl 18.5 d36b7cad,36607664,befde317,56bfaed6,
"RTN","SAMIHUL",167,0)
 ; 666f5b91,2f2c29c1
"RTN","SAMIHUL",168,0)
 ;  SAMIHOM3 multitenancy; in GENSTDID add ARG param, determin prefix
"RTN","SAMIHUL",169,0)
 ; from site or siteid (ARG) instead of calling $$GETPRFX^SAMIFORM.
"RTN","SAMIHUL",170,0)
 ;  SAMIHOM4 multitenancy + fix bug in WSVAPALS.
"RTN","SAMIHUL",171,0)
 ;
"RTN","SAMIHUL",172,0)
 ; 2020-04-18/05-07 ven/gpl 18.5 29d7dba7,d55de214,521e0bdc,d018f52e,
"RTN","SAMIHUL",173,0)
 ; 476b2ff4,61c7d208
"RTN","SAMIHUL",174,0)
 ;  SAMIHOM4 fix bug & weird error in manual registration, fix bug in
"RTN","SAMIHUL",175,0)
 ; logout, logout working, superuser site selection, worklist
"RTN","SAMIHUL",176,0)
 ; functionality.
"RTN","SAMIHUL",177,0)
 ;
"RTN","SAMIHUL",178,0)
 ; 2020-08-06 ven/gpl 18.6 781744c3
"RTN","SAMIHUL",179,0)
 ;  SAMIHOM4 changes to support hl7 transmission of notes.
"RTN","SAMIHUL",180,0)
 ;
"RTN","SAMIHUL",181,0)
 ; 2020-09-22 ven/gpl 18.9 06459eda
"RTN","SAMIHUL",182,0)
 ;  SAMIHOM4 correct to match kids file.
"RTN","SAMIHUL",183,0)
 ;
"RTN","SAMIHUL",184,0)
 ; 2021-03-02 ven/gpl 18.9 479dc041
"RTN","SAMIHUL",185,0)
 ;  SAMIHOM4 return error message if no ct eval form exists when
"RTN","SAMIHUL",186,0)
 ; generating a fu note.
"RTN","SAMIHUL",187,0)
 ;
"RTN","SAMIHUL",188,0)
 ; 2021-03-11 ven/toad 18.9 a46a2cc1
"RTN","SAMIHUL",189,0)
 ;  SAMIHUL create routine.
"RTN","SAMIHUL",190,0)
 ;  SAMIHOM4 bump date & patch list, add contents, lt refactor.
"RTN","SAMIHUL",191,0)
 ;
"RTN","SAMIHUL",192,0)
 ; 2021-03-17 ven/toad 18.9
"RTN","SAMIHUL",193,0)
 ;  SAMIHOM4 remove blank from end of 1 line.
"RTN","SAMIHUL",194,0)
 ;
"RTN","SAMIHUL",195,0)
 ; 2021-05-29 ven/gpl 18.12-t2 59ea0811
"RTN","SAMIHUL",196,0)
 ;  SAMIHOM3 in SID2NUM look up by pien instead of relying on sid
"RTN","SAMIHUL",197,0)
 ; containing pien.
"RTN","SAMIHUL",198,0)
 ;
"RTN","SAMIHUL",199,0)
 ; 2021-06-15 ven/gpl 18.12-t2 e247ea59
"RTN","SAMIHUL",200,0)
 ;  SAMIHOM4 eliminate icn.
"RTN","SAMIHUL",201,0)
 ;
"RTN","SAMIHUL",202,0)
 ; 2021-06-15/16 ven/mcglk&toad 18.12-t2 cbf7e46b,fa794d60
"RTN","SAMIHUL",203,0)
 ;  SAMIHOM3 move log to SAMIHUL, bump dates & versions, annotate,
"RTN","SAMIHUL",204,0)
 ; reorg, lt refactor.
"RTN","SAMIHUL",205,0)
 ;  SAMIHOM4 bump dates & versions; begin annotate, reorg, lt refactor
"RTN","SAMIHUL",206,0)
 ; but interrupted by addition of critical fix to patch & bronchitis,
"RTN","SAMIHUL",207,0)
 ; so leave refactor unfinished (but stable as far as it went).
"RTN","SAMIHUL",208,0)
 ;  SAMIUTH3 bump dates & versions, lt refactor, add COVER, in UTSCAN4
"RTN","SAMIHUL",209,0)
 ; fix $random bug, but after discovering the SAMI test suite is so
"RTN","SAMIHUL",210,0)
 ; far out of date that it fails catastrophically with thousands of
"RTN","SAMIHUL",211,0)
 ; errors, back out changes and leave as it was.
"RTN","SAMIHUL",212,0)
 ;
"RTN","SAMIHUL",213,0)
 ; 2021-08-01 ven/gpl 18.12 5bd7c627
"RTN","SAMIHUL",214,0)
 ;  SAMIHOM3 set intake form to incomplete on creation: in MKSIFORM
"RTN","SAMIHUL",215,0)
 ; r/complete w/incomplete.
"RTN","SAMIHUL",216,0)
 ;
"RTN","SAMIHUL",217,0)
 ; 2021-09-20/23 ven/gpl 18-14-16 db1b173a,465b009d
"RTN","SAMIHUL",218,0)
 ;  SAMIHOM4 (with new routine SAMIZPH1) developed to import data from 
"RTN","SAMIHUL",219,0)
 ;  Philadelphia VA's previous LCS database in Red Cap, bump dates & versions.
"RTN","SAMIHUL",220,0)
 ;
"RTN","SAMIHUL",221,0)
 ;@contents
"RTN","SAMIHUL",222,0)
 ; SAMIHOM3 homepage interface library
"RTN","SAMIHUL",223,0)
 ; SAMIHOM4 homepage subroutines
"RTN","SAMIHUL",224,0)
 ; SAMIHUL homepage development log
"RTN","SAMIHUL",225,0)
 ; SAMIUTH3 tests for SAMIHOM3
"RTN","SAMIHUL",226,0)
 ; SAMIUTH4 tests for SAMIHOM4
"RTN","SAMIHUL",227,0)
 ;
"RTN","SAMIHUL",228,0)
 ;
"RTN","SAMIHUL",229,0)
 ;
"RTN","SAMIHUL",230,0)
EOR ; end of routine SAMIHUL
"RTN","SAMIZPH1")
0^3^B252745932
"RTN","SAMIZPH1",1,0)
SAMIZPH1 ;ven/gpl - VAPALS PATIENT IMPORT FOR PHILIDELPHIA ; 2021-09-27t20:30z
"RTN","SAMIZPH1",2,0)
 ;;18.0;SAMI;**16**;2020-01;Build 2
"RTN","SAMIZPH1",3,0)
 ;18-x-16-t2
"RTN","SAMIZPH1",4,0)
 ;
"RTN","SAMIZPH1",5,0)
 ;@license: see routine SAMIUL
"RTN","SAMIZPH1",6,0)
 ;
"RTN","SAMIZPH1",7,0)
 ;@section 0 primary development
"RTN","SAMIZPH1",8,0)
 ;
"RTN","SAMIZPH1",9,0)
 ;
"RTN","SAMIZPH1",10,0)
 ;
"RTN","SAMIZPH1",11,0)
 ;@routine-credits
"RTN","SAMIZPH1",12,0)
 ;@dev-main George P. Lilly (gpl)
"RTN","SAMIZPH1",13,0)
 ; gpl@vistaexpertise.net
"RTN","SAMIZPH1",14,0)
 ;@dev-org-main Vista Expertise Network (ven)
"RTN","SAMIZPH1",15,0)
 ; http://vistaexpertise.net
"RTN","SAMIZPH1",16,0)
 ;@copyright 2017/2021, gpl, all rights reserved
"RTN","SAMIZPH1",17,0)
 ;@license see routine SAMIUL
"RTN","SAMIZPH1",18,0)
 ;
"RTN","SAMIZPH1",19,0)
 ;@last-update 2021-09-27t20:30z
"RTN","SAMIZPH1",20,0)
 ;@application Screening Applications Management (SAM)
"RTN","SAMIZPH1",21,0)
 ;@module Screening Applications Management - IELCAP (SAMI)
"RTN","SAMIZPH1",22,0)
 ;@suite-of-files SAMI Forms (311.101-311.199)
"RTN","SAMIZPH1",23,0)
 ;@version 18-14-16
"RTN","SAMIZPH1",24,0)
 ;@release-date 2020-01
"RTN","SAMIZPH1",25,0)
 ;@patch-list **16**
"RTN","SAMIZPH1",26,0)
 ;
"RTN","SAMIZPH1",27,0)
 ;
"RTN","SAMIZPH1",28,0)
 ;@module-credits
"RTN","SAMIZPH1",29,0)
 ;@project VA Partnership to Increase Access to Lung Screening
"RTN","SAMIZPH1",30,0)
 ; (VA-PALS)
"RTN","SAMIZPH1",31,0)
 ; http://va-pals.org/
"RTN","SAMIZPH1",32,0)
 ;@funding 2017/2021, Bristol-Myers Squibb Foundation (bmsf)
"RTN","SAMIZPH1",33,0)
 ; https://www.bms.com/about-us/responsibility/bristol-myers-squibb-foundation.html
"RTN","SAMIZPH1",34,0)
 ;@partner-org Veterans Affairs Office of Rural health
"RTN","SAMIZPH1",35,0)
 ; https://www.ruralhealth.va.gov/
"RTN","SAMIZPH1",36,0)
 ;@partner-org International Early Lung Cancer Action Program (I-ELCAP)
"RTN","SAMIZPH1",37,0)
 ; http://ielcap.com/
"RTN","SAMIZPH1",38,0)
 ;@partner-org Paraxial Technologies (par)
"RTN","SAMIZPH1",39,0)
 ; http://paraxialtech.com/
"RTN","SAMIZPH1",40,0)
 ;@partner-org Open Source Electronic Health Record Alliance (OSEHRA)
"RTN","SAMIZPH1",41,0)
 ; https://www.osehra.org/groups/va-pals-open-source-project-group
"RTN","SAMIZPH1",42,0)
 ;
"RTN","SAMIZPH1",43,0)
 ;@module-log repo github.com:VA-PALS-ELCAP/SAMI-VAPALS-ELCAP.git
"RTN","SAMIZPH1",44,0)
 ;
"RTN","SAMIZPH1",45,0)
 ; 2021-09-20/23 ven/gpl sami-18-14-16-t1
"RTN","SAMIZPH1",46,0)
 ; SAMIZPH1 develop method to import data from a REDCap data system used by
"RTN","SAMIZPH1",47,0)
 ; the Philadelphia VA.
"RTN","SAMIZPH1",48,0)
 ;
"RTN","SAMIZPH1",49,0)
 ; 2021-09-27 ven/gpl sami-18-14-16-t1
"RTN","SAMIZPH1",50,0)
 ; SAMIZPH1 fix bug where Cache was putting the TSV records in overflow
"RTN","SAMIZPH1",51,0)
 ;
"RTN","SAMIZPH1",52,0)
 ;
"RTN","SAMIZPH1",53,0)
 Q
"RTN","SAMIZPH1",54,0)
 ;
"RTN","SAMIZPH1",55,0)
SEP() ; extrinsic returns the separator character used
"RTN","SAMIZPH1",56,0)
 Q $CHAR(9)
"RTN","SAMIZPH1",57,0)
 ;
"RTN","SAMIZPH1",58,0)
EN ;
"RTN","SAMIZPH1",59,0)
 N SITE
"RTN","SAMIZPH1",60,0)
 s SITE=$$PICSITE^SAMIMOV()
"RTN","SAMIZPH1",61,0)
 Q:SITE="^"
"RTN","SAMIZPH1",62,0)
 N FN,GN
"RTN","SAMIZPH1",63,0)
 ;S DIR="/tmp/"
"RTN","SAMIZPH1",64,0)
  ; prompt for the directory
"RTN","SAMIZPH1",65,0)
 N SAMIDIR
"RTN","SAMIZPH1",66,0)
 D GETDIR^SAMIFDM(.SAMIDIR)
"RTN","SAMIZPH1",67,0)
 Q:SAMIDIR=""
"RTN","SAMIZPH1",68,0)
 ;
"RTN","SAMIZPH1",69,0)
 do
"RTN","SAMIZPH1",70,0)
 . N DIR,X,Y,DA,DIRUT,DTOUT,DUOUT,DIROUT
"RTN","SAMIZPH1",71,0)
 . S DIR(0)="F^0:1024"
"RTN","SAMIZPH1",72,0)
 . S DIR("A")="Enter filename to load."
"RTN","SAMIZPH1",73,0)
 . S DIR("B")="LCSV2_DATA_2021-06-29_REDCAP.tsv"
"RTN","SAMIZPH1",74,0)
 . D ^DIR
"RTN","SAMIZPH1",75,0)
 . W !
"RTN","SAMIZPH1",76,0)
 . if '$data(DIRUT) set FN=Y
"RTN","SAMIZPH1",77,0)
 quit:'$data(FN)
"RTN","SAMIZPH1",78,0)
 ;
"RTN","SAMIZPH1",79,0)
 ;S FN="LCSV2_DATA_2021-06-29_REDCAP.csv"
"RTN","SAMIZPH1",80,0)
 ;S FN="LCSV2_DATA_2021-06-29_REDCAP.tsv"
"RTN","SAMIZPH1",81,0)
 S GN=$NA(^TMP("SAMICSV",$J,1))
"RTN","SAMIZPH1",82,0)
 K @GN
"RTN","SAMIZPH1",83,0)
 N OK
"RTN","SAMIZPH1",84,0)
 S OK=$$FTG^%ZISH(SAMIDIR,FN,GN,3)
"RTN","SAMIZPH1",85,0)
 D  ;
"RTN","SAMIZPH1",86,0)
 . ;
"RTN","SAMIZPH1",87,0)
 . ; Normalize overflow nodes (and hope for the best that we don't go over 32k)
"RTN","SAMIZPH1",88,0)
 . new i,j set (i,j)=""
"RTN","SAMIZPH1",89,0)
 . for  set i=$order(^TMP("SAMICSV",$J,i)) quit:'i  for  set j=$order(^TMP("SAMICSV",$J,i,"OVF",j)) quit:'j  do
"RTN","SAMIZPH1",90,0)
 .. set ^TMP("SAMICSV",$J,i)=^TMP("SAMICSV",$J,i)_^TMP("SAMICSV",$J,i,"OVF",j)  ;
"RTN","SAMIZPH1",91,0)
 K ^gpl("CSV")
"RTN","SAMIZPH1",92,0)
 M ^gpl("CSV")=^TMP("SAMICSV",$J)
"RTN","SAMIZPH1",93,0)
 D TOGRAPH(SITE)
"RTN","SAMIZPH1",94,0)
 D REDCAP(SITE)
"RTN","SAMIZPH1",95,0)
 D IMPORT(SITE)
"RTN","SAMIZPH1",96,0)
 Q
"RTN","SAMIZPH1",97,0)
 ;
"RTN","SAMIZPH1",98,0)
TOGRAPH(SITE) ;
"RTN","SAMIZPH1",99,0)
 N GN S GN=$NA(^TMP("SAMICSV",$J))
"RTN","SAMIZPH1",100,0)
 d purgegraph^%wd(SITE_"-INTAKE")
"RTN","SAMIZPH1",101,0)
 n root s root=$$setroot^%wd(SITE_"-INTAKE")
"RTN","SAMIZPH1",102,0)
 n zi,zl
"RTN","SAMIZPH1",103,0)
 ; first row
"RTN","SAMIZPH1",104,0)
 f zi=1:1:$l(@GN@(1),$$SEP) d  ;
"RTN","SAMIZPH1",105,0)
 . s zl=$p(@GN@(1),$$SEP,zi)
"RTN","SAMIZPH1",106,0)
 . s @root@("key",zi,zl)=""
"RTN","SAMIZPH1",107,0)
 . s @root@("key","B",zl,zi)=""
"RTN","SAMIZPH1",108,0)
 q
"RTN","SAMIZPH1",109,0)
 ;
"RTN","SAMIZPH1",110,0)
REDCAP(SITE) ;
"RTN","SAMIZPH1",111,0)
 n root s root=$$setroot^%wd(SITE_"-INTAKE")
"RTN","SAMIZPH1",112,0)
 n proot s proot=$na(@root@("REDCAP"))
"RTN","SAMIZPH1",113,0)
 n GN s GN=$NA(^TMP("SAMICSV",$J))
"RTN","SAMIZPH1",114,0)
 n key s key=$na(@root@("key"))
"RTN","SAMIZPH1",115,0)
 n zi s zi=1
"RTN","SAMIZPH1",116,0)
 f  s zi=$o(@GN@(zi)) q:+zi=0  d  ;
"RTN","SAMIZPH1",117,0)
 . n zj
"RTN","SAMIZPH1",118,0)
 . f zj=1:1:$l(@GN@(zi),$$SEP) d  ;
"RTN","SAMIZPH1",119,0)
 . . n zl s zl=$o(@key@(zj,""))
"RTN","SAMIZPH1",120,0)
 . . i zl="" s zl="piece"_zj
"RTN","SAMIZPH1",121,0)
 . . s @proot@(zi,zl)=$p(@GN@(zi),$$SEP,zj)
"RTN","SAMIZPH1",122,0)
 q
"RTN","SAMIZPH1",123,0)
 ;
"RTN","SAMIZPH1",124,0)
IMPORT(SITE) ; import from csv stored in SITE-INTAKE graph
"RTN","SAMIZPH1",125,0)
 N root,zi,proot
"RTN","SAMIZPH1",126,0)
 s root=$$setroot^%wd(SITE_"-INTAKE")
"RTN","SAMIZPH1",127,0)
 s proot=$na(@root@("REDCAP"))
"RTN","SAMIZPH1",128,0)
 s zi=""
"RTN","SAMIZPH1",129,0)
 f  s zi=$o(@proot@(zi)) q:zi=""  d  ;
"RTN","SAMIZPH1",130,0)
 . n onepat,ztbl
"RTN","SAMIZPH1",131,0)
 . m onepat=@proot@(zi)
"RTN","SAMIZPH1",132,0)
 . d RCAPHACK("ztbl","onepat")
"RTN","SAMIZPH1",133,0)
 . s onepat("site")=SITE
"RTN","SAMIZPH1",134,0)
 . d CREATE(.onepat)
"RTN","SAMIZPH1",135,0)
 Q
"RTN","SAMIZPH1",136,0)
 ;
"RTN","SAMIZPH1",137,0)
T1() ;
"RTN","SAMIZPH1",138,0)
 ;
"RTN","SAMIZPH1",139,0)
 n vars
"RTN","SAMIZPH1",140,0)
 n saminame
"RTN","SAMIZPH1",141,0)
 s saminame="GPL34567,TEST76543"
"RTN","SAMIZPH1",142,0)
 s vars("name")=saminame
"RTN","SAMIZPH1",143,0)
 S vars("ssn")="999990027"
"RTN","SAMIZPH1",144,0)
 s vars("dob")="1952-01-12"
"RTN","SAMIZPH1",145,0)
 s vars("gender")="M"
"RTN","SAMIZPH1",146,0)
 s vars("site")="XXX"
"RTN","SAMIZPH1",147,0)
 d CREATE(.vars)
"RTN","SAMIZPH1",148,0)
 q
"RTN","SAMIZPH1",149,0)
 ;
"RTN","SAMIZPH1",150,0)
CREATE(vars) ; create a patient record and an intake form from vars
"RTN","SAMIZPH1",151,0)
 ;
"RTN","SAMIZPH1",152,0)
 n varscpy m varscpy=vars
"RTN","SAMIZPH1",153,0)
 N SAMIRTN
"RTN","SAMIZPH1",154,0)
 D REG^SAMIHOM4(.SAMIRTN,.varscpy)
"RTN","SAMIZPH1",155,0)
 N saminame
"RTN","SAMIZPH1",156,0)
 s saminame=$g(vars("saminame"))
"RTN","SAMIZPH1",157,0)
 i saminame="" b
"RTN","SAMIZPH1",158,0)
 s vars("name")=saminame
"RTN","SAMIZPH1",159,0)
 s vars("dfn")=$$GETDFN(saminame)
"RTN","SAMIZPH1",160,0)
 m varscpy=vars
"RTN","SAMIZPH1",161,0)
 D WSNEWCAS^SAMIHOM3(.varscpy,.SAMIBDY,.SAMIRESULT)
"RTN","SAMIZPH1",162,0)
 ;ZWR varscpy
"RTN","SAMIZPH1",163,0)
 n sid,sikey
"RTN","SAMIZPH1",164,0)
 s sid=$g(varscpy("studyid"))
"RTN","SAMIZPH1",165,0)
 s sikey=$g(varscpy("form"))
"RTN","SAMIZPH1",166,0)
 s sikey=$p(sikey,"vapals:",2)
"RTN","SAMIZPH1",167,0)
 w !,"sid: ",sid," sikey: ",sikey
"RTN","SAMIZPH1",168,0)
 n root s root=$$setroot^%wd("vapals-patients")
"RTN","SAMIZPH1",169,0)
 q:sid=""
"RTN","SAMIZPH1",170,0)
 q:sikey=""
"RTN","SAMIZPH1",171,0)
 m @root@("graph",sid,sikey)=vars
"RTN","SAMIZPH1",172,0)
 ;N NUM S NUM=$$GETNUM(saminame)
"RTN","SAMIZPH1",173,0)
 ;D MKSIFORM^SAMIHOM3(NUM)
"RTN","SAMIZPH1",174,0)
 Q
"RTN","SAMIZPH1",175,0)
 ;
"RTN","SAMIZPH1",176,0)
GETNUM(SAMINAME) ; extrinsic returns the ien in vapals-patients for 
"RTN","SAMIZPH1",177,0)
 ; name of SAMINAME
"RTN","SAMIZPH1",178,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIZPH1",179,0)
 n proot s proot=$$setroot^%wd("vapals-patients")
"RTN","SAMIZPH1",180,0)
 n lien s lien=$o(@lroot@("name",SAMINAME,""))
"RTN","SAMIZPH1",181,0)
 n dfn s dfn=$g(@lroot@(lien,"dfn"))
"RTN","SAMIZPH1",182,0)
 n num s num=$o(@proot@("dfn",dfn,""))
"RTN","SAMIZPH1",183,0)
 q num
"RTN","SAMIZPH1",184,0)
 ;
"RTN","SAMIZPH1",185,0)
GETDFN(SAMINAME) ; extrinsic returns the ien in vapals-patients for 
"RTN","SAMIZPH1",186,0)
 ; name of SAMINAME
"RTN","SAMIZPH1",187,0)
 n lroot s lroot=$$setroot^%wd("patient-lookup")
"RTN","SAMIZPH1",188,0)
 n lien s lien=$o(@lroot@("name",SAMINAME,""))
"RTN","SAMIZPH1",189,0)
 n dfn s dfn=$g(@lroot@(lien,"dfn"))
"RTN","SAMIZPH1",190,0)
 q dfn
"RTN","SAMIZPH1",191,0)
 ;
"RTN","SAMIZPH1",192,0)
PROCTBL(ARY,TBL) ; process an array (ARY) using a mapping table (TBL)
"RTN","SAMIZPH1",193,0)
 ; both passed by name
"RTN","SAMIZPH1",194,0)
 ;
"RTN","SAMIZPH1",195,0)
 n samiv s samiv=""
"RTN","SAMIZPH1",196,0)
 f  s samiv=$o(@TBL@(samiv)) q:samiv=""  d  ;
"RTN","SAMIZPH1",197,0)
 . W !,samiv
"RTN","SAMIZPH1",198,0)
 . n otherv
"RTN","SAMIZPH1",199,0)
 . s otherv=$o(@TBL@(samiv,""))
"RTN","SAMIZPH1",200,0)
 . w !,"otherv: "_otherv
"RTN","SAMIZPH1",201,0)
 . ;if $g(@ARY@(samiv))'="" q  ;
"RTN","SAMIZPH1",202,0)
 . if otherv="" s @ARY@(samiv)=$G(@TBL@(samiv)) q  ;
"RTN","SAMIZPH1",203,0)
 . n proc
"RTN","SAMIZPH1",204,0)
 . s proc=$g(@TBL@(samiv,otherv))
"RTN","SAMIZPH1",205,0)
 . i $e(proc,1,2)="$$" d  q  ;
"RTN","SAMIZPH1",206,0)
 . . ; call an extrinsic
"RTN","SAMIZPH1",207,0)
 . . n X s X="S @ARY@("""_samiv_""")="_proc_"(ARY)"
"RTN","SAMIZPH1",208,0)
 . . B
"RTN","SAMIZPH1",209,0)
 . . X @X
"RTN","SAMIZPH1",210,0)
 . i $e(proc,1,1)="$" d  q  ;
"RTN","SAMIZPH1",211,0)
 . . ; execute a line of code ie $select or $tr
"RTN","SAMIZPH1",212,0)
 . . n X s X="S @ARY@("""_samiv_""")="_proc
"RTN","SAMIZPH1",213,0)
 . . W !,"proc: ",X
"RTN","SAMIZPH1",214,0)
 . . X @X
"RTN","SAMIZPH1",215,0)
 . set @ARY@(samiv)=@ARY@(otherv) ; simple assignment
"RTN","SAMIZPH1",216,0)
 ;
"RTN","SAMIZPH1",217,0)
 Q
"RTN","SAMIZPH1",218,0)
 ;
"RTN","SAMIZPH1",219,0)
CALC5(SARY) ; extrinsic returns last5
"RTN","SAMIZPH1",220,0)
 n lname,ssn
"RTN","SAMIZPH1",221,0)
 s lname=@SARY@("last_name")
"RTN","SAMIZPH1",222,0)
 s ssn=@SARY@("ssn")
"RTN","SAMIZPH1",223,0)
 if $l(ssn)<4 s ssn=$e("0000",1,4-$l(ssn))_ssn
"RTN","SAMIZPH1",224,0)
 Q $e(lname,1,1)_ssn
"RTN","SAMIZPH1",225,0)
 ;
"RTN","SAMIZPH1",226,0)
CALCNAME(SARY) ; extrinsic returns lastname,firstname from array
"RTN","SAMIZPH1",227,0)
 Q $g(@SARY@("last_name"))_","_$g(@SARY@("first_name"))
"RTN","SAMIZPH1",228,0)
 ;
"RTN","SAMIZPH1",229,0)
CALCSSN(SARY) ; extrinsic returns false but correctly formatted ssn
"RTN","SAMIZPH1",230,0)
 n ssn s ssn=$g(@SARY@("ssn"))
"RTN","SAMIZPH1",231,0)
 i $l(ssn)<9 d  ;
"RTN","SAMIZPH1",232,0)
 . i $l(ssn)=4 s ssn=99999_ssn q
"RTN","SAMIZPH1",233,0)
 . s ssn=99999_$e("0000",1,4-$l(ssn))_ssn
"RTN","SAMIZPH1",234,0)
 Q ssn
"RTN","SAMIZPH1",235,0)
 ;
"RTN","SAMIZPH1",236,0)
RCAPTBL(PARY) ; initialize the redcap mapping table
"RTN","SAMIZPH1",237,0)
 ;chart-eligibility-complete true
"RTN","SAMIZPH1",238,0)
 S @PARY@("chart-eligibility-complete")="true"
"RTN","SAMIZPH1",239,0)
 ;dfn 9000098
"RTN","SAMIZPH1",240,0)
 ;dob 1952-1-12
"RTN","SAMIZPH1",241,0)
 S @PARY@("dob","dob")=""
"RTN","SAMIZPH1",242,0)
 ;form siform-2021-09-21
"RTN","SAMIZPH1",243,0)
 ;gender M^MALE
"RTN","SAMIZPH1",244,0)
 S @PARY@("gender","gender")="$S(gender=2:""F"",1:""M"")"
"RTN","SAMIZPH1",245,0)
 ;last5 G0027
"RTN","SAMIZPH1",246,0)
 S @PARY@("last5","ssn")="$$CALC5"
"RTN","SAMIZPH1",247,0)
 ;notes 
"RTN","SAMIZPH1",248,0)
 ;samicreatedate 2021-09-21
"RTN","SAMIZPH1",249,0)
 S @PARY@("samicreatedate","sdm_visit_date")=""
"RTN","SAMIZPH1",250,0)
 ;samifirsttime false
"RTN","SAMIZPH1",251,0)
 S @PARY@("samifirsttime")="false"
"RTN","SAMIZPH1",252,0)
 ;saminame GPL34567,TEST76543
"RTN","SAMIZPH1",253,0)
 S @PARY@("saminame","last_name")="$$CALCNAME"
"RTN","SAMIZPH1",254,0)
 ;saminum 9000098
"RTN","SAMIZPH1",255,0)
 ;samiroute postform
"RTN","SAMIZPH1",256,0)
 ;samistatus complete
"RTN","SAMIZPH1",257,0)
 ;samistudyid XXX9000098
"RTN","SAMIZPH1",258,0)
 ;sbdob 1/12/1952
"RTN","SAMIZPH1",259,0)
 S @PARY@("sbdob","dob")=""
"RTN","SAMIZPH1",260,0)
 ;sex M
"RTN","SAMIZPH1",261,0)
 S @PARY@("sex","gender")="$S(gender=2:""F"",1:""M"")"
"RTN","SAMIZPH1",262,0)
 ;sicadx 
"RTN","SAMIZPH1",263,0)
 ;sicadxl 
"RTN","SAMIZPH1",264,0)
 ;siceceho 
"RTN","SAMIZPH1",265,0)
 ;sicecenc 
"RTN","SAMIZPH1",266,0)
 ;siceceoo 
"RTN","SAMIZPH1",267,0)
 ;siceceot 
"RTN","SAMIZPH1",268,0)
 ;sicecepc 
"RTN","SAMIZPH1",269,0)
 ;sicecepr 
"RTN","SAMIZPH1",270,0)
 ;sicechrt y
"RTN","SAMIZPH1",271,0)
 S @PARY@("sicechrt")="y"
"RTN","SAMIZPH1",272,0)
 n elig s elig=$g(@HACK@("elig_enroll"))
"RTN","SAMIZPH1",273,0)
 S @HACK@("sicechrt")=$s(elig=0:"n",1:"y")
"RTN","SAMIZPH1",274,0)
 ;sicectap 08/27/2018
"RTN","SAMIZPH1",275,0)
 S @PARY@("sicectap","base_order_date")=""
"RTN","SAMIZPH1",276,0)
 ;siceiden outreach
"RTN","SAMIZPH1",277,0)
 S @PARY@("siceiden")="outreach"
"RTN","SAMIZPH1",278,0)
 ;sicemhhs 
"RTN","SAMIZPH1",279,0)
 ;sicemhlc 
"RTN","SAMIZPH1",280,0)
 ;sicemhoo 
"RTN","SAMIZPH1",281,0)
 ;sicemhot 
"RTN","SAMIZPH1",282,0)
 ;sicep declined smoking cessation
"RTN","SAMIZPH1",283,0)
 S @PARY@("sicep","smoking_cessation_not")=""
"RTN","SAMIZPH1",284,0)
 ;sicerfdt 
"RTN","SAMIZPH1",285,0)
 ;sicerfge 
"RTN","SAMIZPH1",286,0)
 ;sicerfon 
"RTN","SAMIZPH1",287,0)
 ;sicerfoo 
"RTN","SAMIZPH1",288,0)
 ;sicerfot 
"RTN","SAMIZPH1",289,0)
 ;sicerfpc 
"RTN","SAMIZPH1",290,0)
 ;sicerfpu 
"RTN","SAMIZPH1",291,0)
 ;sicerfsc 
"RTN","SAMIZPH1",292,0)
 ;sicerfwh 
"RTN","SAMIZPH1",293,0)
 ;siceshnc 
"RTN","SAMIZPH1",294,0)
 ;siceshoo 
"RTN","SAMIZPH1",295,0)
 ;siceshot 
"RTN","SAMIZPH1",296,0)
 ;siceshpy 
"RTN","SAMIZPH1",297,0)
 ;siceshqd 
"RTN","SAMIZPH1",298,0)
 ;siclin 2s-pcp notified
"RTN","SAMIZPH1",299,0)
 S @PARY@("siclin","patient_notes")=""
"RTN","SAMIZPH1",300,0)
 ;sicpd 40
"RTN","SAMIZPH1",301,0)
 S @PARY@("sicpd","smoking_per_day")=""
"RTN","SAMIZPH1",302,0)
 ;sidc 09/21/2021
"RTN","SAMIZPH1",303,0)
 S @PARY@("sidc","sdm_visit_date")=""
"RTN","SAMIZPH1",304,0)
 ;sidob 1/12/1952
"RTN","SAMIZPH1",305,0)
 S @PARY@("sidob","dob")=""
"RTN","SAMIZPH1",306,0)
 ;sies 
"RTN","SAMIZPH1",307,0)
 ;siesm p
"RTN","SAMIZPH1",308,0)
 S @PARY@("siesm")="p"
"RTN","SAMIZPH1",309,0)
 ;siesq 
"RTN","SAMIZPH1",310,0)
 ;siidmdc 1
"RTN","SAMIZPH1",311,0)
 S @PARY@("siidmdc")=1
"RTN","SAMIZPH1",312,0)
 ;sildct y
"RTN","SAMIZPH1",313,0)
 S @PARY@("sildct")="y"
"RTN","SAMIZPH1",314,0)
 ;silnip 
"RTN","SAMIZPH1",315,0)
 ;silnml 
"RTN","SAMIZPH1",316,0)
 ;silnot 
"RTN","SAMIZPH1",317,0)
 ;silnph 1
"RTN","SAMIZPH1",318,0)
 S @PARY@("silnph")=1
"RTN","SAMIZPH1",319,0)
 ;silnpp 
"RTN","SAMIZPH1",320,0)
 ;silnth 
"RTN","SAMIZPH1",321,0)
 ;silnvd 
"RTN","SAMIZPH1",322,0)
 ;sinamef TEST76543
"RTN","SAMIZPH1",323,0)
 S @PARY@("sinamef","first_name")=""
"RTN","SAMIZPH1",324,0)
 ;sinamel GPL34567
"RTN","SAMIZPH1",325,0)
 S @PARY@("sinamel","last_name")=""
"RTN","SAMIZPH1",326,0)
 ;sipan 
"RTN","SAMIZPH1",327,0)
 ;sipav n
"RTN","SAMIZPH1",328,0)
 S @PARY@("sipav")="n"
"RTN","SAMIZPH1",329,0)
 ;sipc 
"RTN","SAMIZPH1",330,0)
 ;sipcn 
"RTN","SAMIZPH1",331,0)
 ;sipcr USA
"RTN","SAMIZPH1",332,0)
 S @PARY@("sipcr")="USA"
"RTN","SAMIZPH1",333,0)
 ;sipcrn 
"RTN","SAMIZPH1",334,0)
 ;sipecmnt 
"RTN","SAMIZPH1",335,0)
 ;sipecnip 
"RTN","SAMIZPH1",336,0)
 ;sipecnml 
"RTN","SAMIZPH1",337,0)
 ;sipecnot 
"RTN","SAMIZPH1",338,0)
 ;sipecnpp 
"RTN","SAMIZPH1",339,0)
 ;sipecnte 
"RTN","SAMIZPH1",340,0)
 ;sipecnth 
"RTN","SAMIZPH1",341,0)
 ;sipecnvd 
"RTN","SAMIZPH1",342,0)
 ;sipedc 09/21/2021
"RTN","SAMIZPH1",343,0)
 S @PARY@("sipedc","sdm_visit_date")=""
"RTN","SAMIZPH1",344,0)
 ;sipedisc n
"RTN","SAMIZPH1",345,0)
 S @PARY@("sipedisc")="n"
"RTN","SAMIZPH1",346,0)
 ;sippd 2.00
"RTN","SAMIZPH1",347,0)
 ;sippn 
"RTN","SAMIZPH1",348,0)
 ;sippy 118.00
"RTN","SAMIZPH1",349,0)
 ;sips 
"RTN","SAMIZPH1",350,0)
 ;sipsa 
"RTN","SAMIZPH1",351,0)
 ;siptct 
"RTN","SAMIZPH1",352,0)
 ;siptctl 
"RTN","SAMIZPH1",353,0)
 ;sipz 
"RTN","SAMIZPH1",354,0)
 ;siq 01/01/2018
"RTN","SAMIZPH1",355,0)
 S @PARY@("siq","year_quit")=""
"RTN","SAMIZPH1",356,0)
 ;sisid XXX9000098
"RTN","SAMIZPH1",357,0)
 ;sisny 59.0
"RTN","SAMIZPH1",358,0)
 S @PARY@("sisny","smoked_years")=""
"RTN","SAMIZPH1",359,0)
 ;sissn 999-99-0027
"RTN","SAMIZPH1",360,0)
 S @PARY@("sissn","ssn")="$$CALCSSN"
"RTN","SAMIZPH1",361,0)
 ;sistatus active
"RTN","SAMIZPH1",362,0)
 S @PARY@("sistatus")="active"
"RTN","SAMIZPH1",363,0)
 ;site XXX
"RTN","SAMIZPH1",364,0)
 ;siteid XXX
"RTN","SAMIZPH1",365,0)
 ;ssn 999990027
"RTN","SAMIZPH1",366,0)
 S @PARY@("ssn","ssn")="$$CALCSSN"
"RTN","SAMIZPH1",367,0)
 ;studyid XXX9000098
"RTN","SAMIZPH1",368,0)
 Q
"RTN","SAMIZPH1",369,0)
 ;
"RTN","SAMIZPH1",370,0)
RCAPHACK(PARY,HACK) ; initialize the redcap mapping table
"RTN","SAMIZPH1",371,0)
 ;chart-eligibility-complete true
"RTN","SAMIZPH1",372,0)
 ; this hack version accepts a redcap data array in HACK, passed by name
"RTN","SAMIZPH1",373,0)
 ; and hard codes the results of the mapping rules in that same array
"RTN","SAMIZPH1",374,0)
 ; for use while we are trying to get the mapper to work.
"RTN","SAMIZPH1",375,0)
 ;
"RTN","SAMIZPH1",376,0)
 S @PARY@("chart-eligibility-complete")="true"
"RTN","SAMIZPH1",377,0)
 S @HACK@("chart-eligibility-complete")="true"
"RTN","SAMIZPH1",378,0)
 ;dfn 9000098
"RTN","SAMIZPH1",379,0)
 ;dob 1952-1-12
"RTN","SAMIZPH1",380,0)
 S @PARY@("dob","dob")=""
"RTN","SAMIZPH1",381,0)
 ;form siform-2021-09-21
"RTN","SAMIZPH1",382,0)
 ;gender M^MALE
"RTN","SAMIZPH1",383,0)
 S @PARY@("gender","gender")="$S(gender=2:""F^FEMALE"",1:""M^MALE"")"
"RTN","SAMIZPH1",384,0)
 I $g(@HACK@("gender"))=2 s @HACK@("gender")="F"
"RTN","SAMIZPH1",385,0)
 e  s @HACK@("gender")="M"
"RTN","SAMIZPH1",386,0)
 ;last5 G0027
"RTN","SAMIZPH1",387,0)
 S @PARY@("last5","ssn")="$$CALC5"
"RTN","SAMIZPH1",388,0)
 S @HACK@("last5")=$$CALC5(HACK)
"RTN","SAMIZPH1",389,0)
 ;notes 
"RTN","SAMIZPH1",390,0)
 ;samicreatedate 2021-09-21
"RTN","SAMIZPH1",391,0)
 S @PARY@("samicreatedate","sdm_visit_date")=""
"RTN","SAMIZPH1",392,0)
 N formdate
"RTN","SAMIZPH1",393,0)
 s formdate=$g(@HACK@("sdm_visit_date"))
"RTN","SAMIZPH1",394,0)
 i formdate='"" s @HACK@("samicreatedate")=formdate
"RTN","SAMIZPH1",395,0)
 ;samifirsttime false
"RTN","SAMIZPH1",396,0)
 S @PARY@("samifirsttime")="false"
"RTN","SAMIZPH1",397,0)
 S @HACK@("samifirsttime")="false"
"RTN","SAMIZPH1",398,0)
 ;saminame GPL34567,TEST76543
"RTN","SAMIZPH1",399,0)
 S @PARY@("saminame","last_name")="$$CALCNAME"
"RTN","SAMIZPH1",400,0)
 S @HACK@("saminame")=$$CALCNAME(HACK)
"RTN","SAMIZPH1",401,0)
 S @HACK@("name")=@HACK@("saminame")
"RTN","SAMIZPH1",402,0)
 ;saminum 9000098
"RTN","SAMIZPH1",403,0)
 ;samiroute postform
"RTN","SAMIZPH1",404,0)
 ;samistatus complete
"RTN","SAMIZPH1",405,0)
 ;samistudyid XXX9000098
"RTN","SAMIZPH1",406,0)
 ;sbdob 1/12/1952
"RTN","SAMIZPH1",407,0)
 S @PARY@("sbdob","dob")=""
"RTN","SAMIZPH1",408,0)
 S @HACK@("sbdob")=@HACK@("dob")
"RTN","SAMIZPH1",409,0)
 ;sex M
"RTN","SAMIZPH1",410,0)
 S @HACK@("sex")=$g(@HACK@("gender"))
"RTN","SAMIZPH1",411,0)
 ;I $g(@HACK@("gender"))=2 s @HACK@("sex")="F"
"RTN","SAMIZPH1",412,0)
 ;e  s @HACK@("sex")="M"
"RTN","SAMIZPH1",413,0)
 S @PARY@("sex","gender")="$S(gender=2:""F"",1:""M"")"
"RTN","SAMIZPH1",414,0)
 ;sicadx 
"RTN","SAMIZPH1",415,0)
 ;sicadxl 
"RTN","SAMIZPH1",416,0)
 ;siceceho 
"RTN","SAMIZPH1",417,0)
 ;sicecenc 
"RTN","SAMIZPH1",418,0)
 ;siceceoo 
"RTN","SAMIZPH1",419,0)
 ;siceceot 
"RTN","SAMIZPH1",420,0)
 ;sicecepc 
"RTN","SAMIZPH1",421,0)
 ;sicecepr 
"RTN","SAMIZPH1",422,0)
 ;sicechrt y
"RTN","SAMIZPH1",423,0)
 S @PARY@("sicechrt")="y"
"RTN","SAMIZPH1",424,0)
 S @HACK@("sicechrt")="y"
"RTN","SAMIZPH1",425,0)
 ;sicectap 08/27/2018
"RTN","SAMIZPH1",426,0)
 S @PARY@("sicectap","base_order_date")=""
"RTN","SAMIZPH1",427,0)
 S @HACK@("sicectap")=$g(@HACK@("base_order_date"))
"RTN","SAMIZPH1",428,0)
 ;siceiden outreach
"RTN","SAMIZPH1",429,0)
 S @PARY@("siceiden")="primary/self"
"RTN","SAMIZPH1",430,0)
 S @HACK@("siceiden")="primary/self"
"RTN","SAMIZPH1",431,0)
 ;sicemhhs 
"RTN","SAMIZPH1",432,0)
 ;sicemhlc 
"RTN","SAMIZPH1",433,0)
 ;sicemhoo 
"RTN","SAMIZPH1",434,0)
 ;sicemhot 
"RTN","SAMIZPH1",435,0)
 ;sicep declined smoking cessation
"RTN","SAMIZPH1",436,0)
 S @PARY@("sicep","smoking_cessation_not")=""
"RTN","SAMIZPH1",437,0)
 S @HACK@("sicep")=$G(@HACK@("smoking_cessation_not"))
"RTN","SAMIZPH1",438,0)
 ;sicerfdt
"RTN","SAMIZPH1",439,0)
 S @PARY@("sicerfdt","consult")=""
"RTN","SAMIZPH1",440,0)
 S @HACK@("sicerfdt")=$G(@HACK@("consult"))
"RTN","SAMIZPH1",441,0)
 ;sicerfge 
"RTN","SAMIZPH1",442,0)
 ;sicerfon 
"RTN","SAMIZPH1",443,0)
 ;sicerfoo 
"RTN","SAMIZPH1",444,0)
 ;sicerfot 
"RTN","SAMIZPH1",445,0)
 ;sicerfpc 
"RTN","SAMIZPH1",446,0)
 ;sicerfpu 
"RTN","SAMIZPH1",447,0)
 ;sicerfsc 
"RTN","SAMIZPH1",448,0)
 ;sicerfwh 
"RTN","SAMIZPH1",449,0)
 ;siceshnc 
"RTN","SAMIZPH1",450,0)
 ;siceshoo 
"RTN","SAMIZPH1",451,0)
 ;siceshot 
"RTN","SAMIZPH1",452,0)
 ;siceshpy 
"RTN","SAMIZPH1",453,0)
 ;siceshqd 
"RTN","SAMIZPH1",454,0)
 ;siclin 2s-pcp notified
"RTN","SAMIZPH1",455,0)
 S @PARY@("siclin","patient_notes")=""
"RTN","SAMIZPH1",456,0)
 S @HACK@("siclin")=$g(@HACK@("patient_notes"))
"RTN","SAMIZPH1",457,0)
 ;sicpd 40
"RTN","SAMIZPH1",458,0)
 S @PARY@("sicpd","smoking_per_day")=""
"RTN","SAMIZPH1",459,0)
 S @HACK@("sicpd")=$g(@HACK@("smoking_per_day"))
"RTN","SAMIZPH1",460,0)
 ;sidc 09/21/2021
"RTN","SAMIZPH1",461,0)
 S @PARY@("sidc","sdm_visit_date")=""
"RTN","SAMIZPH1",462,0)
 s formdate=$g(@HACK@("sdm_visit_date"))
"RTN","SAMIZPH1",463,0)
 i formdate'="" s @HACK@("sidc")=formdate
"RTN","SAMIZPH1",464,0)
 ;sidob 1/12/1952
"RTN","SAMIZPH1",465,0)
 S @PARY@("sidob","dob")=""
"RTN","SAMIZPH1",466,0)
 s @HACK@("sidob")=$g(@HACK@("dob"))
"RTN","SAMIZPH1",467,0)
 ;sies 
"RTN","SAMIZPH1",468,0)
 ;siesm p
"RTN","SAMIZPH1",469,0)
 S @PARY@("siesm","smoking_history")="$$HISTORY"
"RTN","SAMIZPH1",470,0)
 n history s history=$g(@HACK@("smoking_history"))
"RTN","SAMIZPH1",471,0)
 S @HACK@("siesm")=$s(history=2:"p",history=3:"n",1:"c")
"RTN","SAMIZPH1",472,0)
 ;siesq 
"RTN","SAMIZPH1",473,0)
 ;siidmdc 1
"RTN","SAMIZPH1",474,0)
 S @PARY@("siidmdc")=1
"RTN","SAMIZPH1",475,0)
 S @HACK@("siidmdc")=1
"RTN","SAMIZPH1",476,0)
 ;sildct y
"RTN","SAMIZPH1",477,0)
 S @PARY@("sildct")="y"
"RTN","SAMIZPH1",478,0)
 S @HACK@("sildct")="y"
"RTN","SAMIZPH1",479,0)
 ;silnip 
"RTN","SAMIZPH1",480,0)
 ;silnml 
"RTN","SAMIZPH1",481,0)
 ;silnot 
"RTN","SAMIZPH1",482,0)
 ;silnph 1
"RTN","SAMIZPH1",483,0)
 S @PARY@("silnph")=1
"RTN","SAMIZPH1",484,0)
 S @HACK@("silnph")=1
"RTN","SAMIZPH1",485,0)
 ;silnpp 
"RTN","SAMIZPH1",486,0)
 ;silnth 
"RTN","SAMIZPH1",487,0)
 ;silnvd 
"RTN","SAMIZPH1",488,0)
 ;sinamef TEST76543
"RTN","SAMIZPH1",489,0)
 S @PARY@("sinamef","first_name")=""
"RTN","SAMIZPH1",490,0)
 S @HACK@("sinamef")=$G(@HACK@("first_name"))
"RTN","SAMIZPH1",491,0)
 ;sinamel GPL34567
"RTN","SAMIZPH1",492,0)
 S @PARY@("sinamel","last_name")=""
"RTN","SAMIZPH1",493,0)
 S @HACK@("sinamel")=$G(@HACK@("last_name"))
"RTN","SAMIZPH1",494,0)
 ;sipan 
"RTN","SAMIZPH1",495,0)
 ;sipav n
"RTN","SAMIZPH1",496,0)
 S @PARY@("sipav")="n"
"RTN","SAMIZPH1",497,0)
 S @HACK@("sipav")="n"
"RTN","SAMIZPH1",498,0)
 ;sipc 
"RTN","SAMIZPH1",499,0)
 ;sipcn 
"RTN","SAMIZPH1",500,0)
 ;sipcr USA
"RTN","SAMIZPH1",501,0)
 S @PARY@("sipcr")="USA"
"RTN","SAMIZPH1",502,0)
 S @HACK@("sipcr")="USA"
"RTN","SAMIZPH1",503,0)
 ;sipcrn 
"RTN","SAMIZPH1",504,0)
 ;sipecmnt 
"RTN","SAMIZPH1",505,0)
 ;sipecnip 
"RTN","SAMIZPH1",506,0)
 ;sipecnml 
"RTN","SAMIZPH1",507,0)
 ;sipecnot 
"RTN","SAMIZPH1",508,0)
 ;sipecnpp 
"RTN","SAMIZPH1",509,0)
 ;sipecnte 
"RTN","SAMIZPH1",510,0)
 ;sipecnth 
"RTN","SAMIZPH1",511,0)
 ;sipecnvd 
"RTN","SAMIZPH1",512,0)
 ;sipedc 09/21/2021
"RTN","SAMIZPH1",513,0)
 S @PARY@("sipedc","sdm_visit_date")=""
"RTN","SAMIZPH1",514,0)
 i formdate'="" s @HACK@("sipedc")=formdate
"RTN","SAMIZPH1",515,0)
 ;sipedisc n
"RTN","SAMIZPH1",516,0)
 S @PARY@("sipedisc")="n"
"RTN","SAMIZPH1",517,0)
 S @HACK@("sipedisc")="n"
"RTN","SAMIZPH1",518,0)
 ;sippd 2.00
"RTN","SAMIZPH1",519,0)
 ;sippn 
"RTN","SAMIZPH1",520,0)
 ;sippy 118.00
"RTN","SAMIZPH1",521,0)
 ;sips 
"RTN","SAMIZPH1",522,0)
 ;sipsa 
"RTN","SAMIZPH1",523,0)
 ;siptct 
"RTN","SAMIZPH1",524,0)
 ;siptctl 
"RTN","SAMIZPH1",525,0)
 ;sipz 
"RTN","SAMIZPH1",526,0)
 ;siq 01/01/2018
"RTN","SAMIZPH1",527,0)
 S @PARY@("siq","year_quit")=""
"RTN","SAMIZPH1",528,0)
 S @HACK@("siq")=$g(@HACK@("year_quit"))
"RTN","SAMIZPH1",529,0)
 ;sirs r
"RTN","SAMIZPH1",530,0)
 S @PARY@("sirs","rural")="$$RURAL"
"RTN","SAMIZPH1",531,0)
 n rural s rural=$g(@HACK@("rural"))
"RTN","SAMIZPH1",532,0)
 S @HACK@("sirs")=$s(rural=1:"r",rural=0:"u",1:"n")
"RTN","SAMIZPH1",533,0)
 ;sisid XXX9000098
"RTN","SAMIZPH1",534,0)
 ;sisny 59.0
"RTN","SAMIZPH1",535,0)
 S @PARY@("sisny","smoked_years")=""
"RTN","SAMIZPH1",536,0)
 S @HACK@("sisny")=$G(@HACK@("smoked_years"))
"RTN","SAMIZPH1",537,0)
 ;sissn 999-99-0027
"RTN","SAMIZPH1",538,0)
 S @PARY@("sissn","ssn")="$$CALCSSN"
"RTN","SAMIZPH1",539,0)
 S @HACK@("sissn")=$$CALCSSN(HACK)
"RTN","SAMIZPH1",540,0)
 ;sistatus active
"RTN","SAMIZPH1",541,0)
 n noshow s noshow=$g(@HACK@("ldct_no_show_base"))
"RTN","SAMIZPH1",542,0)
 S @PARY@("sistatus")="active"
"RTN","SAMIZPH1",543,0)
 S @HACK@("sistatus")=$S(noshow'="":"inactive",1:"active")
"RTN","SAMIZPH1",544,0)
 ;site XXX
"RTN","SAMIZPH1",545,0)
 ;siteid XXX
"RTN","SAMIZPH1",546,0)
 ;ssn 999990027
"RTN","SAMIZPH1",547,0)
 S @PARY@("ssn","ssn")="$$CALCSSN"
"RTN","SAMIZPH1",548,0)
 S @HACK@("ssn")=$$CALCSSN(HACK)
"RTN","SAMIZPH1",549,0)
 ;studyid XXX9000098
"RTN","SAMIZPH1",550,0)
 Q
"RTN","SAMIZPH1",551,0)
 ;
"RTN","SAMIZPH1",552,0)
T2() ;
"RTN","SAMIZPH1",553,0)
 N RCAPARY,ZTBL
"RTN","SAMIZPH1",554,0)
 D RCAPTBL("ZTBL")
"RTN","SAMIZPH1",555,0)
 D RCAPTST("RCAPARY")
"RTN","SAMIZPH1",556,0)
 ;
"RTN","SAMIZPH1",557,0)
 D PROCTBL("RCAPARY","ZTBL")
"RTN","SAMIZPH1",558,0)
 ZWR RCAPARY
"RTN","SAMIZPH1",559,0)
 Q
"RTN","SAMIZPH1",560,0)
 ;
"RTN","SAMIZPH1",561,0)
T3() ; HACK VERSION 
"RTN","SAMIZPH1",562,0)
 N RCAPARY,ZTBL
"RTN","SAMIZPH1",563,0)
 D RCAPTST("RCAPARY")
"RTN","SAMIZPH1",564,0)
 D RCAPHACK("ZTBL","RCAPARY")
"RTN","SAMIZPH1",565,0)
 ZWR RCAPARY
"RTN","SAMIZPH1",566,0)
 S RCAPARY("site")="XXX"
"RTN","SAMIZPH1",567,0)
 D CREATE(.RCAPARY)
"RTN","SAMIZPH1",568,0)
 Q
"RTN","SAMIZPH1",569,0)
 ;
"RTN","SAMIZPH1",570,0)
RCAPTST(RARY) ; initialize a Redcap test array
"RTN","SAMIZPH1",571,0)
 ;|--REDCAP 
"RTN","SAMIZPH1",572,0)
 S @RARY@("age")=70.1
"RTN","SAMIZPH1",573,0)
 S @RARY@("airway_disease___1")=1
"RTN","SAMIZPH1",574,0)
 S @RARY@("airway_disease___2")=1
"RTN","SAMIZPH1",575,0)
 S @RARY@("airway_disease___3")=0
"RTN","SAMIZPH1",576,0)
 S @RARY@("base_completion_date")="8/27/2018"
"RTN","SAMIZPH1",577,0)
 S @RARY@("base_order_date")="8/27/2018"
"RTN","SAMIZPH1",578,0)
 S @RARY@("base_schedule")=""
"RTN","SAMIZPH1",579,0)
 S @RARY@("bmi")=38.7
"RTN","SAMIZPH1",580,0)
 S @RARY@("cancer_hx")=1
"RTN","SAMIZPH1",581,0)
 S @RARY@("cancer_type")=""
"RTN","SAMIZPH1",582,0)
 S @RARY@("consult")="8/3/2018"
"RTN","SAMIZPH1",583,0)
 S @RARY@("dob")="6/15/1948"
"RTN","SAMIZPH1",584,0)
 S @RARY@("educ_level")=""
"RTN","SAMIZPH1",585,0)
 S @RARY@("elig_enroll")=1
"RTN","SAMIZPH1",586,0)
 S @RARY@("environ_exp___1")=0
"RTN","SAMIZPH1",587,0)
 S @RARY@("environ_exp___2")=0
"RTN","SAMIZPH1",588,0)
 S @RARY@("environ_exp___3")=0
"RTN","SAMIZPH1",589,0)
 S @RARY@("environ_exp___4")=0
"RTN","SAMIZPH1",590,0)
 S @RARY@("ethnicity")=2
"RTN","SAMIZPH1",591,0)
 S @RARY@("failed_enroll")=""
"RTN","SAMIZPH1",592,0)
 S @RARY@("failed_other")=""
"RTN","SAMIZPH1",593,0)
 S @RARY@("fam_hx")=1
"RTN","SAMIZPH1",594,0)
 S @RARY@("first_name")="Mac5"
"RTN","SAMIZPH1",595,0)
 S @RARY@("gender")=1
"RTN","SAMIZPH1",596,0)
 S @RARY@("height")=69
"RTN","SAMIZPH1",597,0)
 S @RARY@("imported_age")=70
"RTN","SAMIZPH1",598,0)
 S @RARY@("last_name")="McDonald"
"RTN","SAMIZPH1",599,0)
 S @RARY@("ldct_no_show_base")=""
"RTN","SAMIZPH1",600,0)
 S @RARY@("oth_enviorn_exp")=""
"RTN","SAMIZPH1",601,0)
 S @RARY@("other_referral_type")=""
"RTN","SAMIZPH1",602,0)
 S @RARY@("pack_years")=100
"RTN","SAMIZPH1",603,0)
 S @RARY@("patient_notes")="2s-pcp notified"
"RTN","SAMIZPH1",604,0)
 S @RARY@("pt_age")=72.1
"RTN","SAMIZPH1",605,0)
 S @RARY@("pt_pcp")="Keenan"
"RTN","SAMIZPH1",606,0)
 S @RARY@("quit_smoking")=""
"RTN","SAMIZPH1",607,0)
 S @RARY@("record_id")=1
"RTN","SAMIZPH1",608,0)
 S @RARY@("referral_type")=""
"RTN","SAMIZPH1",609,0)
 S @RARY@("rural")=0
"RTN","SAMIZPH1",610,0)
 S @RARY@("sdm___1")=1
"RTN","SAMIZPH1",611,0)
 S @RARY@("sdm___2")=0
"RTN","SAMIZPH1",612,0)
 S @RARY@("sdm___3")=0
"RTN","SAMIZPH1",613,0)
 S @RARY@("sdm_visit_date")="8/27/2018"
"RTN","SAMIZPH1",614,0)
 S @RARY@("smoked_years")=59
"RTN","SAMIZPH1",615,0)
 S @RARY@("smoking_cessation_not")="Declined smoking cessation support"
"RTN","SAMIZPH1",616,0)
 S @RARY@("smoking_history")=1
"RTN","SAMIZPH1",617,0)
 S @RARY@("smoking_per_day")=40
"RTN","SAMIZPH1",618,0)
 S @RARY@("ssn")=4958
"RTN","SAMIZPH1",619,0)
 S @RARY@("tobacco_cessation_referral")=2
"RTN","SAMIZPH1",620,0)
 S @RARY@("weight")=262
"RTN","SAMIZPH1",621,0)
 S @RARY@("year_quit")=""
"RTN","SAMIZPH1",622,0)
 q
"RTN","SAMIZPH1",623,0)
 ;
"VER")
8.0^22.2
**END**
**END**
