<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
  <meta content="2019.01.02" name="version"/>
  <meta content="Domenic DiNatale, domenic.dinatale@paraxialtech.com" name="author"/>
  <title>
   Lung Screening and Surveillance Intake Form
  </title>
  <link href="lib/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="lib/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
  <link href="lib/formvalidation/dist/css/formValidation.min.css" rel="stylesheet"/>
  <link href="lib/bootstrap-datetimepicker-4.17.47/css/bootstrap-datetimepicker.css" rel="stylesheet"/>
  <link href="vapals.css" rel="stylesheet"/>
  <link href="lib/jquery-ui-1.12.1/jquery-ui.min.css" rel="stylesheet"/>
  <link href="lib/jquery-ui-1.12.1/jquery-ui.structure.min.css" rel="stylesheet"/>
  <link href="lib/jquery-ui-1.12.1/jquery-ui.theme.min.css" rel="stylesheet"/>
  <link href="lib/bootstrap-dialog-1.35.4/bootstrap-dialog.min.css" rel="stylesheet"/>
 </head>
 <body id="body" style="position: relative;">
  <script src="lib/jquery-3.3.1.min.js">
  </script>
  <script src="lib/jquery-ui-1.12.1/jquery-ui.min.js">
  </script>
  <script src="lib/popper.min.js">
  </script>
  <script src="lib/bootstrap-3.3.7-dist/js/bootstrap.min.js">
  </script>
  <script src="lib/moment.js">
  </script>
  <script src="lib/formvalidation/dist/js/FormValidation.min.js">
  </script>
  <script src="lib/formvalidation/dist/js/plugins/Wizard.min.js">
  </script>
  <script src="lib/formvalidation/dist/js/plugins/Bootstrap3.min.js">
  </script>
  <script src="lib/formvalidation/dist/js/plugins/J.min.js">
  </script>
  <script src="lib/bootstrap-datetimepicker-4.17.47/js/bootstrap-datetimepicker.min.js">
  </script>
  <script src="lib/bootstrap-dialog-1.35.4/bootstrap-dialog.min.js">
  </script>
  <script src="lib/clipboard.js">
  </script>
  <script src="https://www.gstatic.com/charts/loader.js" type="text/javascript">
  </script>
  <script src="jquery-conditonally-enable.js">
  </script>
  <script src="jquery-conditonally-display.js">
  </script>
  <script src="jqueryui-vista-filemanAutocomplete.js">
  </script>
  <script src="vapals.js">
  </script>
  <script src="init.js">
  </script>
  <script src="nodule-grid.js">
  </script>
  <!--System Navigation-->
  <nav class="navbar navbar-default" role="navigation">
   <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
     <button class="navbar-toggle collapsed" data-target="#navbar-main" data-toggle="collapse" type="button">
      <span class="sr-only">
       Toggle navigation
      </span>
      <span class="icon-bar">
      </span>
      <span class="icon-bar">
      </span>
      <span class="icon-bar">
      </span>
     </button>
     <a class="text-nowrap" href="/vapals" style="text-decoration: none">
      <img alt="VAPALS-ELCAP Logo" class="hidden-xs" height="50" src="img/logo_transparent.png" title="VAPALS-ELCAP"/>
      <img alt="VAPALS-ELCAP Logo" height="50" src="img/logo_name.png" title="VAPALS-ELCAP"/>
     </a>
    </div>
    <div class="navbar-collapse collapse navbar-right" id="navbar-main">
     <ul class="nav navbar-nav">
      <li>
       <a href="/vapals">
        Home
       </a>
      </li>
      <li id="studyIdMenu" style="display:none;">
       <a class="navigation" data-method="post" data-samiroute="casereview" href="#!">
        Case Review
       </a>
      </li>
      <li class="dropdown">
       <a aria-expanded="false" aria-haspopup="true" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
        Reports
        <span class="caret">
        </span>
       </a>
       <ul class="dropdown-menu">
        <li>
         <a class="navigation" data-method="post" data-samireporttype="followup" data-samiroute="report" href="#!">
          Participant
                            Follow-up
         </a>
        </li>
        <li>
         <a class="navigation" data-method="post" data-samireporttype="activity" data-samiroute="report" href="#!">
          Activity
         </a>
        </li>
        <li>
         <a class="navigation" data-method="post" data-samireporttype="missingct" data-samiroute="report" href="#!">
          Missing
                            Image &amp; CT Evaluation
         </a>
        </li>
        <li>
         <a class="navigation" data-method="post" data-samireporttype="incomplete" data-samiroute="report" href="#!">
          Incomplete
                            Form
         </a>
        </li>
        <li>
         <a class="navigation" data-method="post" data-samireporttype="outreach" data-samiroute="report" href="#!">
          Outreach
         </a>
        </li>
        <li>
         <a class="navigation" data-method="post" data-samireporttype="enrollment" data-samiroute="report" href="#!">
          Enrollment
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
   </div>
  </nav>
  <div class="container-fluid" style="max-width:1550px">
   <h1>
    Sample, Sammy G
    <small class="text-muted" title="Study ID">
     ST0001
    </small>
   </h1>
   <h2>
    Lung Screening and Surveillance Intake Form
    <small class="text-muted" title="Medical Record Number">
     1234567890
    </small>
   </h2>
   <hr/>
   <form action="/vapals" class="validated" id="main-form" method="post">
    <input name="samiroute" type="hidden" value="postform"/>
    <input name="studyid" type="hidden" value="@@SID@@"/>
    <input name="form" type="hidden" value="@@FORMKEY@@"/>
    <h3>
     Pre-enrollment Eligibility
    </h3>
    <div class="row" id="pre-enrollment-questions">
     <div class="col-sm-3">
      <label class="required" for="sipechrt">
       Eligible based on chart?
      </label>
     </div>
     <div class="col-sm-3 form-group">
      <label class="radio-inline" for="sipechrt-y">
       <input id="sipechrt-y" name="sipechrt" required="required" type="radio" value="y"/>
       Yes
      </label>
      <label class="radio-inline" for="sipechrt-n">
       <input id="sipechrt-n" name="sipechrt" required="required" type="radio" value="n"/>
       No
      </label>
     </div>
     <div class="col-sm-6">
      <div class="alert alert-info" id="sipechrt-y-alert" style="display:none;">
       Complete the remainder of the form; an intake note will be generated.
      </div>
      <div class="alert alert-info" id="sipechrt-n-alert" style="display:none;">
       Indicate one or more reasons why the patient is not eligible for lung screening. No intake note will
                    be generated.
      </div>
     </div>
    </div>
    <div class="row" id="discussion-container">
     <div class="col-sm-3">
      <label class="required" for="sipedisc">
       Eligible based on discussion with patient?
      </label>
     </div>
     <div class="col-sm-3 form-group">
      <label class="radio-inline" for="sipedisc-y">
       <input id="sipedisc-y" name="sipedisc" required="required" type="radio" value="y"/>
       Yes
      </label>
      <label class="radio-inline" for="sipedisc-n">
       <input id="sipedisc-n" name="sipedisc" required="required" type="radio" value="n"/>
       No
      </label>
     </div>
    </div>
    <div class="row" id="reason-container">
     <div class="col-md-12 form-group">
      <h4>
       Reason(s)
      </h4>
     </div>
     <div class="col-md-12 form-group form-inline" id="reason-medical-container">
      <label for="siremhlc">
       Medical History
      </label>
      <br/>
      <label class="checkbox-inline ">
       <input name="siremhlc" type="hidden" value=""/>
       <input id="siremhlc" name="siremhlc" type="checkbox" value="y"/>
       lung cancer
      </label>
      <label class="checkbox-inline ">
       <input name="siremhhs" type="hidden" value=""/>
       <input id="siremhhs" name="siremhhs" type="checkbox" value="y"/>
       health status
      </label>
      <label class="checkbox-inline ">
       <input name="siremhot" type="hidden" value=""/>
       <input id="siremhot" name="siremhot" type="checkbox" value="y"/>
       other
      </label>
      <input class="form-control" id="sireemhoo" name="sireemhoo" placeholder="specify" required="required" type="text"/>
     </div>
     <div class="col-md-12" id="reason-elsewhere-container">
      <div class="form-group form-group-sm form-inline">
       <label>
        Receiving Care Elsewhere
       </label>
       <br/>
       <label class="checkbox-inline ">
        <input name="sirecepc" type="hidden" value=""/>
        <input id="sirecepc" name="sirecepc" type="checkbox" value="y"/>
        followed in pulmonary clinic
       </label>
       <label class="checkbox-inline ">
        <input name="sirecenc" type="hidden" value=""/>
        <input id="sirecenc" name="sirecenc" type="checkbox" value="y"/>
        followed in nodule clinic
       </label>
       <label class="checkbox-inline ">
        <input name="sireceho" type="hidden" value=""/>
        <input id="sireceho" name="sireceho" type="checkbox" value="y"/>
        followed in Hematology-Oncology
       </label>
       <label class="checkbox-inline ">
        <input name="sirecepc" type="hidden" value=""/>
        <input id="sirecepc" name="sirecepc" type="checkbox" value="y"/>
        private care
       </label>
       <label class="checkbox-inline ">
        <input name="sireceot" type="hidden" value=""/>
        <input id="sireceot" name="sireceot" type="checkbox" value="y"/>
        other
       </label>
       <input class="form-control form-inline" id="sireceoo" name="sireceoo" placeholder="specify" required="required" type="text"/>
      </div>
     </div>
     <div class="col-md-12" id="reason-smoking-container">
      <div class="form-group form-group-sm form-inline">
       <label>
        Smoking History
       </label>
       <br/>
       <label class="checkbox-inline ">
        <input name="sireshqd" type="hidden" value=""/>
        <input id="sireshqd" name="sireshqd" type="checkbox" value="y"/>
        quit date greater than 15 years
       </label>
       <label class="checkbox-inline ">
        <input name="sireshpy" type="hidden" value=""/>
        <input id="sireshpy" name="sireshpy" type="checkbox" value="y"/>
        less than 30 pack years
       </label>
       <label class="checkbox-inline ">
        <input name="sireshnc" type="hidden" value=""/>
        <input id="sireshnc" name="sireshnc" type="checkbox" value="y"/>
        non-cigarette Use (e.g. pipe, smokeless, vape, cannabis)
       </label>
       <label class="checkbox-inline ">
        <input name="sireshot" type="hidden" value=""/>
        <input id="sireshot" name="sireshot" type="checkbox" value="y"/>
        other
       </label>
       <input class="form-control form-inline" id="sireshoo" name="sireshoo" placeholder="specify" required="required" type="text"/>
      </div>
     </div>
     <div class="col-md-12" id="reason-contact-container">
      <div class="form-group form-group-sm form-inline">
       <label>
        Unable To Contact
       </label>
       <br/>
       <label class="checkbox-inline ">
        <input name="sireucvm" type="hidden" value=""/>
        <input id="sireucvm" name="sireucvm" type="checkbox" value="y"/>
        left voice message
       </label>
       <label class="checkbox-inline ">
        <input name="sireucbp" type="hidden" value=""/>
        <input id="sireucbp" name="sireucbp" type="checkbox" value="y"/>
        bad phone number
       </label>
       <label class="checkbox-inline ">
        <input name="sireucot" type="hidden" value=""/>
        <input id="sireucot" name="sireucot" type="checkbox" value="y"/>
        other
       </label>
       <input class="form-control form-inline" id="sireucoo" name="sireucoo" placeholder="specify" required="required" type="text"/>
      </div>
     </div>
    </div>
    <h3>
     Contact Information
    </h3>
    <div class="row">
     <div class="col-sm-4 col-md-3 form-group">
      <label class="required" for="sidc">
       Date of contact
      </label>
      <div class="input-group datepicker">
       <input aria-describedby="sidc-addon" class="form-control" data-restriction="past" id="sidc" name="sidc" required="required"/>
       <div class="input-group-addon">
        <div class="input-group-text" id="sidc-addon">
         <i aria-hidden="true" class="fa fa-calendar">
         </i>
        </div>
       </div>
      </div>
      <small class="form-text text-muted">
       MM/DD/YYYY
      </small>
     </div>
     <div class="col-sm-8 col-md-9 form-group">
      <label>
       How did you learn about the Lung Screening and Surveillance (LSS) program?
      </label>
      <div class="checkbox">
       <label>
        <input name="silnph" type="hidden" value=""/>
        <input id="silnph" name="silnph" type="checkbox" value="1"/>
        Phone
       </label>
      </div>
      <div class="checkbox">
       <label>
        <input name="silnls" type="hidden" value=""/>
        <input id="silnls" name="silnls" type="checkbox" value="1"/>
        Letter sent
       </label>
      </div>
      <div class="checkbox">
       <label>
        <input name="silnpu" type="hidden" value=""/>
        <input id="silnpu" name="silnpu" type="checkbox" value="1"/>
        Pulmonary
       </label>
      </div>
      <div class="checkbox">
       <label>
        <input name="silnpc" type="hidden" value=""/>
        <input id="silnpc" name="silnpc" type="checkbox" value="1"/>
        PCP
       </label>
      </div>
      <div class="checkbox">
       <label>
        <input name="silnpn" type="hidden" value=""/>
        <input id="silnpn" name="silnpn" type="checkbox" value="1"/>
        Oncology
       </label>
      </div>
      <div class="checkbox">
       <label>
        <input name="silnpp" type="hidden" value=""/>
        <input id="silnpp" name="silnpp" type="checkbox" value="1"/>
        Smoking cessation program
       </label>
      </div>
      <div class="checkbox">
       <label>
        <input name="silnpo" type="hidden" value=""/>
        <input id="silnpo" name="silnpo" type="checkbox" value="1"/>
        Other
       </label>
      </div>
      <input class="form-control input-sm" id="silnpos" name="silnpos" required="required" title="Other" type="text"/>
     </div>
    </div>
    <div class="row">
     <div class="col-md-12 form-group">
      <label class="required">
       Primary address verified
      </label>
      <label class="radio-inline" for="sipav-y">
       <input id="sipav-y" name="sipav" required="required" type="radio" value="y"/>
       Yes
      </label>
      <label class="radio-inline" for="sipav-n">
       <input id="sipav-n" name="sipav" type="radio" value="n"/>
       No
      </label>
     </div>
    </div>
    <div class="row">
     <div class="form-group col-sm-6 ">
      <label for="sipsa">
       Preferred address
      </label>
      <input class="form-control" id="sipsa" name="sipsa" type="text"/>
     </div>
     <div class="form-group col-sm-2">
      <label for="sipan">
       Apt #
      </label>
      <input class="form-control" id="sipan" name="sipan" type="text"/>
     </div>
     <div class="form-group col-sm-4">
      <label for="sipcn">
       County
      </label>
      <input class="form-control" id="sipcn" name="sipcn" type="text"/>
     </div>
    </div>
    <div class="row">
     <div class="form-group col-md-6">
      <label for="sipc">
       City
      </label>
      <input class="form-control" id="sipc" name="sipc" type="text"/>
     </div>
     <div class="form-group col-md-1">
      <label for="sips">
       State
      </label>
      <input class="form-control" id="sips" name="sips" type="text"/>
     </div>
     <div class="form-group col-md-2">
      <label for="sipz">
       Zip
      </label>
      <input class="form-control" id="sipz" name="sipz" type="text"/>
     </div>
     <div class="form-group col-md-3">
      <label for="sipcr">
       Country
      </label>
      <input class="form-control" id="sipcr" name="sipcr" type="text"/>
     </div>
    </div>
    <div class="row">
     <div class="form-group col-sm-6 ">
      <label for="sippn">
       Phone number
      </label>
      <input class="form-control" id="sippn" name="sippn" type="text"/>
     </div>
    </div>
    <div class="row">
     <div class="col-md-12 form-group">
      <label class="required">
       Rural status
      </label>
      <label class="radio-inline" for="sirs-u">
       <input id="sirs-u" name="sirs" required="required" type="radio" value="u"/>
       Urban
      </label>
      <label class="radio-inline" for="sirs-r">
       <input id="sirs-r" name="sirs" type="radio" value="r"/>
       Rural
      </label>
      <label class="radio-inline" for="sirs-n">
       <input id="sirs-n" name="sirs" type="radio" value="n"/>
       Unknown
      </label>
     </div>
    </div>
    <hr/>
    <h3>
     Smoking History
    </h3>
    <div class="row">
     <div class="col-md-12 form-group">
      <label for="sies">
       Have you ever smoked
      </label>
      <input class="form-control" id="sies" name="sies" type="text"/>
      <div class="checkbox">
       <label>
        <input name="siesn" type="hidden" value=""/>
        <input id="siesn" name="siesn" type="checkbox" value="1"/>
        Never smoked
       </label>
      </div>
      <div class="checkbox">
       <label>
        <input name="siesp" type="hidden" value=""/>
        <input id="siesp" name="siesp" type="checkbox" value="1"/>
        Past
       </label>
      </div>
      <div class="checkbox">
       <label>
        <input name="siesc" type="hidden" value=""/>
        <input id="siesc" name="siesc" type="checkbox" value="1"/>
        Current
       </label>
      </div>
      <div class="checkbox">
       <label>
        <input name="siesq" type="hidden" value=""/>
        <input id="siesq" name="siesq" type="checkbox" value="1"/>
        Willing to quit
       </label>
      </div>
     </div>
    </div>
    <div class="row">
     <div class="col-md-4">
      <label class="visible-xs visible-sm required" for="sicpd">
       How many cigarettes did you smoke per day?
      </label>
      <label class="text-right pull-right hidden-xs hidden-sm required" for="sicpd">
       How many cigarettes did you smoke per day?
      </label>
     </div>
     <div class="col-sm-2 form-group">
      <input class="form-control numeric" id="sicpd" maxlength="4" name="sicpd" required="required" type="text"/>
     </div>
    </div>
    <div class="row">
     <div class="col-md-4">
      <label class="visible-xs visible-sm " for="sippd">
       How many packs of cigarettes did you smoke per day (PPD)?
      </label>
      <label class="text-right pull-right hidden-xs hidden-sm " for="sippd">
       How many packs of cigarettes did you smoke per day (PPD)?
      </label>
     </div>
     <div class="col-sm-2 form-group">
      <span class="control-label" id="sippd-val">
      </span>
     </div>
     <input id="sippd" name="sippd" type="hidden"/>
    </div>
    <div class="row">
     <div class="col-md-4">
      <label class="visible-xs visible-sm required" for="sisny">
       # of years
      </label>
      <label class="text-right pull-right hidden-xs hidden-sm required" for="sisny">
       # of years
      </label>
     </div>
     <div class="col-sm-2 form-group">
      <input class="form-control numeric decimalformat" id="sisny" maxlength="4" name="sisny" required="required" type="text"/>
     </div>
    </div>
    <div class="row">
     <div class="col-md-4">
      <label class="visible-xs visible-sm " for="sippy">
       Reported pack years
      </label>
      <label class="text-right pull-right hidden-xs hidden-sm " for="sippy">
       Reported pack years
      </label>
     </div>
     <div class="col-sm-2 form-group">
      <span id="sippy-val">
      </span>
     </div>
     <input id="sippy" name="sippy" type="hidden"/>
    </div>
    <div class="row">
     <div class="col-md-4">
      <label class="visible-xs visible-sm " for="siq">
       Quit
      </label>
      <label class="text-right pull-right hidden-xs hidden-sm " for="siq">
       Quit
      </label>
     </div>
     <div class="col-sm-4 col-md-3 col-lg-2 form-group">
      <div class="input-group datepicker">
       <input aria-describedby="siq-addon" class="form-control" data-restriction="past" id="siq" name="siq"/>
       <div class="input-group-addon">
        <div class="input-group-text" id="siq-addon">
         <i aria-hidden="true" class="fa fa-calendar">
         </i>
        </div>
       </div>
      </div>
      <small class="form-text text-muted">
       MM/DD/YYYY
      </small>
     </div>
    </div>
    <div class="row">
     <div class="col-md-4">
      <label class="visible-xs visible-sm " for="sicep">
       Smoking cessation education provided
      </label>
      <label class="text-right pull-right hidden-xs hidden-sm " for="sicep">
       Smoking cessation education provided
      </label>
     </div>
     <div class="col-md-8 form-group">
      <textarea class="form-control" id="sicep" name="sicep" type="text"></textarea>
     </div>
    </div>
    <div class="row">
     <div class="col-md-4">
      <label class="visible-xs visible-sm " for="sicadx">
       Lung CA Dx (if applicable)
      </label>
      <label class="text-right pull-right hidden-xs hidden-sm " for="sicadx">
       Lung CA Dx (if applicable)
      </label>
     </div>
     <div class="col-md-4 form-group">
      <div class="input-group datepicker">
       <input aria-describedby="sicadx-addon" class="form-control" data-restriction="past" id="sicadx" name="sicadx"/>
       <div class="input-group-addon">
        <div class="input-group-text" id="sicadx-addon">
         <i aria-hidden="true" class="fa fa-calendar">
         </i>
        </div>
       </div>
      </div>
      <small class="form-text text-muted">
       MM/DD/YYYY
      </small>
     </div>
     <div class="col-md-4 form-group">
      <input class="form-control" id="sicadxl" name="sicadxl" type="text"/>
      <span class="help-block">
       Location if not in VA
      </span>
     </div>
    </div>
    <div class="row">
     <div class="col-md-4">
      <label class="visible-xs visible-sm " for="sipldct">
       Prior LDCT
      </label>
      <label class="text-right pull-right hidden-xs hidden-sm " for="sipldct">
       Prior LDCT
      </label>
     </div>
     <div class="col-md-4 form-group">
      <div class="input-group datepicker">
       <input aria-describedby="sipldct-addon" class="form-control" data-restriction="past" id="sipldct" name="sipldct"/>
       <div class="input-group-addon">
        <div class="input-group-text" id="sipldct-addon">
         <i aria-hidden="true" class="fa fa-calendar">
         </i>
        </div>
       </div>
      </div>
      <small class="form-text text-muted">
       MM/DD/YYYY
      </small>
     </div>
     <div class="col-md-4 form-group">
      <input class="form-control" id="sipldctl" name="sipldctl" type="text"/>
      <span class="help-block">
       Location if not in VA
      </span>
     </div>
    </div>
    <hr/>
    <div id="enrollment-container">
     <div class="row">
      <div class="col-md-12 form-group">
       <div class="checkbox">
        <label class="required">
         <input name="siidmdc" type="hidden" value=""/>
         <input id="siidmdc" name="siidmdc" required="required" type="checkbox" value="1"/>
         Informed decision making discussion complete
        </label>
       </div>
      </div>
     </div>
     <p class="alert alert-warning">
      Veteran of age and exposure to cigarette smoke as described above, and without a current
                diagnosis or obvious symptoms suggestive of lung cancer, has been educated today about the
                estimated risk for lung cancer, the possibility of a cure or live prolonging if an early lung
                cancer were to be found during screening, the possibility of imaging abnormalities not being
                lung cancer, the possibility of complications from additional diagnostic procedures, and the
                approximate amount of radiation exposure associated with each screening procedure. In addition,
                the Veteran has been educated today about the importance of avoiding exposure to cigarette
                smoke, available tobacco cessation programs and available lung screening services at this VA
                facility. Education material was provided to the veteran.
      <br/>
     </p>
     <div class="row">
      <div class="col-md-12 form-group">
       <label class="required">
        Based on this information, the Veteran has opted to
       </label>
       <div class="radio">
        <label>
         <input id="sildct-n" name="sildct" required="required" type="radio" value="n"/>
         Not enroll
        </label>
       </div>
       <div class="radio">
        <label>
         <input id="sildct-l" name="sildct" type="radio" value="l"/>
         Not enroll at this time, okay to contact in the future
        </label>
       </div>
       <div class="radio">
        <label>
         <input id="sildct-y" name="sildct" type="radio" value="y"/>
         Enroll in the Lung Screening and Surveillance (LSS) program and have an LDCT ordered.
                            Coordination of care will be made by the LSS team
        </label>
       </div>
      </div>
     </div>
    </div>
    <div class="row">
     <div class="col-md-12 form-group">
      <label class="control-label" for="siclin">
       Clinical Indications for Initial Screening CT
      </label>
      <textarea class="form-control" id="siclin" name="siclin" rows="3"></textarea>
     </div>
    </div>
    <hr/>
    <h3>
     Current Status
    </h3>
    <div class="row">
     <div class="col-md-12 form-group">
      <label class="required" for="sistatus">
       Enrollment
      </label>
      <br/>
      <label class="radio-inline" for="sistatus-active">
       <input id="sistatus-active" name="sistatus" required="required" type="radio" value="active"/>
       Active
      </label>
      <label class="radio-inline" for="sistatus-inactive">
       <input id="sistatus-inactive" name="sistatus" type="radio" value="inactive"/>
       Not active
      </label>
     </div>
    </div>
    <div id="reason-for-change-container" style="display: none;">
     <hr/>
     <h3>
      Reason for change
     </h3>
     <div class="row">
      <div class="col-md-12 form-group">
       <label class="required" for="sistachg">
        Reason
       </label>
       <br/>
       <select class="form-control" id="sistachg" name="sistachg" required="required">
        <option value="">
         -
        </option>
        <option value="transferred">
         Transferred to another institution (specify)
        </option>
        <option value="medical">
         Unable due to medical reason (specify)
        </option>
        <option value="unwilling">
         Unwilling due to personal reason (specify)
        </option>
        <option value="refused">
         Refused to continue
        </option>
        <option value="illadvised">
         Physician advised against
        </option>
        <option value="radiation">
         Concern about radiation
        </option>
        <option value="moved">
         Moved and unable to return
        </option>
        <option value="insurance">
         No insurance, can't have Dx CT
        </option>
        <option value="cost">
         Burden of cost
        </option>
        <option value="other">
         Other (specify)
        </option>
        <option value="excluded">
         Excluded (specify)
        </option>
        <option value="complete">
         Study complete
        </option>
        <option value="noresponse">
         No response to 3 calls + 3 letters
        </option>
        <option value="nocontact">
         Unable to contact
        </option>
        <option value="followed">
         Being followed elsewhere (get results)
        </option>
       </select>
      </div>
     </div>
     <div class="row">
      <div class="col-md-8 form-group">
       <label class="required" for="sistreas">
        Explanation
       </label>
       <br/>
       <textarea class="form-control" id="sistreas" name="sistreas" type="text"></textarea>
      </div>
     </div>
    </div>
    <div class="row" id="change-log-container">
     <div class="col-sm-12">
      <h4>
       Change Log
      </h4>
      <pre class="prettyprint source linenums" id="changelog"></pre>
     </div>
    </div>
    <hr/>
    <div class="pull-left">
     <input name="samistatus" type="hidden" value=""/>
     <button class="btn btn-default" id="save-for-later-button" type="submit">
      Save for Later
     </button>
     <button class="btn btn-primary" id="submit-button" type="submit">
      Submit
     </button>
    </div>
    <div class="pull-right">
     <a class="btn btn-danger" id="delete-form">
      <span class="glyphicon glyphicon-trash">
      </span>
      Delete
     </a>
    </div>
   </form>
  </div>
  <div class="modal fade" id="delete-confirm-modal" role="dialog" tabindex="-1">
   <div class="modal-dialog" role="document">
    <div class="modal-content">
     <div class="modal-header">
      <button aria-label="Close" class="close" data-dismiss="modal" type="button">
       <span aria-hidden="true">
        Ã—
       </span>
      </button>
      <h4 class="modal-title">
       Warning
      </h4>
     </div>
     <div class="modal-body">
      <p>
       Are you certain you want to delete this form?
      </p>
     </div>
     <div class="modal-footer">
      <a class="btn btn-primary" data-dismiss="modal" id="delete-form-cancel">
       No
      </a>
      <a class="btn btn-danger navigation" data-form="@@FORMKEY@@" data-method="post" data-samiroute="deleteform" href="#!" id="delete-form-btn">
       Yes
      </a>
     </div>
    </div>
   </div>
  </div>
  <span id="studyid-html-element" style="display:none;" value="@@SID@@">
  </span>
  <footer>
   <div class="container-fluid" style="max-width:1550px">
    <hr/>
    <a href="https://issues.osehra.org/browse/VAP" tabindex="9000" target="_blank">
     Submit feedback
    </a>
    <span id="sami-version" style="float:right; font-family: Courier,monospace">
     <span id="formMode">
     </span>
     2019.01.02
    </span>
   </div>
  </footer>
  <script language="JavaScript">
   const studyIdVal = $("#studyid-html-element").attr('value');
    const studyId = $.trim(studyIdVal);
    if (studyId && studyId.indexOf("@@") === -1) {
        //store studyid value for use in pages that don't go through the forms processor
        localStorage.setItem("studyid", studyId);
        $("#studyIdMenu").show();
    }

    //purposefully executed before DOM is rendered so delete button is never visible
    const frozen = "@@FROZEN@@";
    if (frozen == "true") {
        $("#delete-form").remove();
    }


    $(function () {
        /** These snippets ensure all fields are wrapped in a form-group, which is necessary for form-validation to work properly. **/
        const $forms = $("form.validated");
        $.each($forms.find("select, textarea, input:visible"), function () {
            const $input = $(this);
            if ($input.closest(".form-group").length === 0) {
                console.error("VAPALS: " + $input.attr('name') + " is not wrapped in a form-group; can cause FV 'too much recursion");
            }
        });

        $.each($forms.find("input[type=hidden][required]"), function () {
            console.error("VAPALS: " + $(this).attr('name') + " should not have a required attribute; can cause FV 'too much recursion'");
        });

        $.ajax("/ctversion", {
            success: function (data) {
                const v = data.ctversion;
                $("#formMode").text(v.toUpperCase());
            },
            error: function () {
                $("#formMode").text("UNKNOWN");
            }
        });

        $("input[type=checkbox]").change(function () {
            const checked = $(this).is(":checked");
            const fieldName = $(this).attr('name');
            $("input[type=hidden][name='" + fieldName + "']").prop('disabled', function () {
                return checked;
            });
        });

        $.each($("input[type=checkbox]:checked"), function (i, el) {
            $(el).trigger("change");
        })
    })
  </script>
  <script language="JavaScript">
   //purposefully executed before DOM is rendered so section is never visible
    const newForm = "@@NEWFORM@@";
    if (newForm == "true") {
        $("#reason-for-change-container").remove();
        $("#change-log-container").remove();
    }

    const enrolled = $("#sildct-y").is(":checked");
    if (enrolled) {
        const $preSection = $("#pre-enrollment-questions").html("");
        const $preCol = $('<div class="col-lg-5 col-md-6 col-sm-8"/>');
        const $preAlert = $("<div class=\"alert alert-info\">Patient was eligible based on chart and patient discussion.</div>");
        $preCol.append($('<input type="hidden" id="sipechrt" name="sipechrt" value="y"/>'));
        $preCol.append($('<input type="hidden" id="sipedisc" name="sipedisc" value="y"/>'));
        $preCol.append($preAlert);
        $preSection.append($preCol);

        $("#discussion-container").remove();
        $("#reason-container").remove();

        const $enrollSection = $("#enrollment-container").html("");
        const $enrollCol = $('<div class="col-lg-5 col-md-6 col-sm-8"/>');
        const $enrollAlert = $("<div class=\"alert alert-info\">Informed decision making was completed and patient " +
            "has been enrolled in the Lung Screening and Surveillance (LSS) program.</div>");
        $enrollCol.append($('<input type="hidden" id="sildct" name="sildct" value="y"/>')); //veterans' option to enroll
        $enrollCol.append($('<input type="hidden" id="siidmdc" name="siidmdc" value="1"/>')); //informed decision making

        $enrollCol.append($enrollAlert);
        $enrollSection.append($enrollCol);
    }


    function createFormValidator() {

        const $form = $('#main-form');
        const multiInputValidators = ['sipechrt', 'sipedisc', 'siremhlc', 'sipav', 'sirs', 'sistatus'];

        $form.formValidation({
                fields: {
                    siremhlc: { //use a real element name for the field so conditional plugins can toggle the field
                        selector: '[name^=sire]',
                        validators: {choice: {min: 1, message: 'Select one or more reasons'}}
                    },
                    siremhoo: {validators: {notEmpty: {message: 'Other is required'}}},
                    sireshoo: {validators: {notEmpty: {message: 'Other is required'}}},
                    sireceoo: {validators: {notEmpty: {message: 'Other is required'}}},
                    sireucoo: {validators: {notEmpty: {message: 'Other is required'}}},
                    sidc: {
                        validators: {
                            notEmpty: {message: 'Contact date is required'},
                            date: {max: VAPALS.todaysDate(), message: 'Contact date may not be in the future'}
                        }
                    },
                    silnpos: {validators: {notEmpty: {message: 'Other is required'}}},
                    sipav: {validators: {notEmpty: {message: 'Primary address verification is required'}}},
                    sippn: {validators: {phone: {message: 'Not a valid US phone number', country: 'US'}}},
                    sirs: {validators: {notEmpty: {message: 'Rural status is required'}}},
                    sicpd: {
                        validators: {
                            notEmpty: {message: 'Packs per day is required'},
                            integer: {message: 'must be a whole number'}
                        }
                    },
                    sisny: {
                        validators: {
                            notEmpty: {message: 'Number of years is required'},
                            integer: {message: 'must be a whole number'}
                        }
                    },
                    siidmdc: {validators: {notEmpty: {message: 'Informed decision making is required'}}},
                    sistatus: {validators: {notEmpty: {message: 'Enrollment status is required'}}},
                    sistachg: {validators: {notEmpty: {message: 'Reason for change is required'}}},
                    sistreas: {validators: {notEmpty: {message: 'Explanation is required'}}},
                },
                plugins: {
                    trigger: new FormValidation.plugins.Trigger(),
                    bootstrap3: new FormValidation.plugins.Bootstrap3(),
                    submitButton: new FormValidation.plugins.SubmitButton({selector: "#submit-button"}),
                    defaultSubmit: new FormValidation.plugins.DefaultSubmit(),
                    excluded: new FormValidation.plugins.Excluded(), //disable validators on hidden, disabled fields
                    icon: new FormValidation.plugins.Icon({
                        valid: '',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh',
                        onPlaced: function (e) {
                            if (multiInputValidators.indexOf(e.field) > -1) {

                                let selector = "";
                                if (e.element.id) {
                                    selector = "#" + e.element.id
                                }
                                else {
                                    selector = "[name=" + e.element.name + "]"
                                }

                                $(selector).closest(".form-group").append(e.iconElement);
                            }
                        },
                    })
                }
            }
        );


        const fv = $form.data('formValidation');
        if (!enrolled) {
            fv.addField('sipechrt', {validators: {notEmpty: {message: 'Chart review is required'}}});
            fv.addField('sipedisc', {validators: {notEmpty: {message: 'Discussion review is required'}}});
            fv.addField('sildct', {validators: {notEmpty: {message: 'Veterans\' option is required'}}});
        }
        fv.on('core.form.invalid', VAPALS.autoScrollToErrorField);
        fv.on('core.element.validated', VAPALS.hideSuccessFormatting);

        return fv;
    }

    $(function () {

        const fv = createFormValidator();

        $("#sicpd").on('keyup change', function () {
            const cigsPerDay = $("#sicpd").val();
            const $sippd = $("#sippd");
            const $sippdVal = $("#sippd-val");
            if (cigsPerDay >= 0) {
                const cpd = (cigsPerDay / 20).toFixed(2);
                if (cpd > 0) {
                    $sippd.val(cpd);
                    $sippdVal.text(cpd);
                }
                else {
                    $sippd.val("");
                    $sippdVal.text("-");
                }
                $sippd.change();
            }
        }).trigger('change');

        $("#sippd, #sisny").on('keyup change', function () {
            const packsPerDay = $("#sippd").val();
            const cigYears = $("#sisny").val();
            if (packsPerDay > 0 && cigYears > 0) {
                const packYears = (packsPerDay * cigYears).toFixed(1);
                if (packYears > 0) {
                    $("#sippy").val(packYears);
                    $("#sippy-val").text(packYears);
                }
            } else {
                $("#sippy").val("");
                $("#sippy-val").text("-");
            }

        }).first().trigger('change');


        //Pre enrollment: Chart eligibility
        $("[name=sipechrt]").conditionallyDisplay({
            sourceValues: "n",
            enable: "#reason-container, #reason-medical-container, #reason-smoking-container, #reason-elsewhere-container",
            disable: "#discussion-container, #reason-contact-container"
        }).on('change', function () {
            const value = $("[name=sipechrt]:checked").val();
            const $yesAlert = $("#sipechrt-y-alert"), $noAlert = $("#sipechrt-n-alert");
            const fields = [
                'sidc',     //contact date
                'sicpd',    //packs per day
                'sisny',    //packs per year
                'siidmdc',  //informed decision making
                'sildct'    //enrollment
            ];

            if (value === "n") {
                $yesAlert.hide();
                $noAlert.show();

                $.each(fields, function (i, s) {
                    //disable the validiator and remove required asterisk from associated labels
                    fv.disableValidator(s);
                    $("[name='" + s + "']").closest(".form-group").find('label').removeClass('required')
                });

                //auto-select "inactive" status
                $("#sistatus-inactive").click();

            }
            else if (value === "y") {
                $yesAlert.show();
                $noAlert.hide();

                $.each(fields, function (i, s) {
                    //disable the validiator and remove required asterisk from associated labels
                    fv.enableValidator(s);
                    $("[name='" + s + "']").closest(".form-group").find('label').first().addClass('required')
                });

            }
            else {
                $yesAlert.hide();
                $noAlert.hide();
            }
        });

        //Pre-Enrollment: Patient discussion
        $("[name=sipedisc]").conditionallyDisplay({
            sourceValues: "n",
            enable: "#reason-container, #reason-medical-container, #reason-smoking-container, #reason-elsewhere-container, #reason-contact-container"
        });

        //Pre enrollment - other reason fields
        $("#siremhot").conditionallyDisplay({value: "y", enable: "#sireemhoo"});
        $("#sireshot").conditionallyDisplay({value: "y", enable: "#sireshoo"});
        $("#sireceot").conditionallyDisplay({value: "y", enable: "#sireceoo"});
        $("#sireucot").conditionallyDisplay({value: "y", enable: "#sireucoo"});


        //Contact info - how did you learn about LCS
        $("#silnpo").conditionallyEnable({sourceValues: "1", enable: "#silnpos"});


        $("[name=sistatus]").on('change', function () {
            //require reason fields when marking patient as "not active"
            $("#reason-for-change-container").toggle($("#sistatus-inactive").is(":checked"));

        });
    });
  </script>
 </body>
</html>